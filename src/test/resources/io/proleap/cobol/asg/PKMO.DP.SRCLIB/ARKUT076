000100***************************************************************** 00001001
000200 IDENTIFICATION DIVISION.                                         00002001
000300***************************************************************** 00003001
000400                                                                  00004001
000500 PROGRAM-ID.             ARKUT076.                                00005001
000600 AUTHOR.                 CHERI PARMLEY.                           00006001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00007001
000800 DATE-WRITTEN            APRIL 2017.                              00008001
000900 DATE-COMPILED.                                                   00009001
001000                                                                  00009101
001100***************************************************************** 00009201
001200*  PURPOSE:                                                       00009301
001300*  THIS PROGRAM WILL READ THE TERM'D WORKDAY FILE AND CHECK       00009401
001400*  THE DATE. IF ITS EOM ON A SATURDAY IT WILL SET THE RETURN CODE 00009501
001600*  TO 04. IF EMPTY FILE (NO TERM'D ASSOCIATES IT WILL SET RETURN  00009601
001600*  CODE TO 4095.                                                  00009701
001710*                                                                 00009801
001800*  INPUT FILES :   EMP-FILE                  DDNAME = INP01       00009901
001900*  OUTPUT FILES:   EMP-FILE-OUT              DDNAME = OUT01       00010001
002000*                                                                 00010101
002100***************************************************************** 00010201
002200*----------------------------------------------------------------*00010301
002300*                                                                *00010401
002400* DATE:        04/07/2017                                        *00010501
002500* WR/IR#:      CHG0??????                                        *00010601
002600* PROGRAMMER:  CHERI PARMLEY                                     *00010701
002700* DESCRIPTION: INITIAL VERSION                                   *00010801
002900*                                                                *00010901
003000*----------------------------------------------------------------*00011001
003100***************************************************************** 00011101
003200 ENVIRONMENT DIVISION.                                            00011201
003300***************************************************************** 00011301
003400                                                                  00011401
003500 CONFIGURATION SECTION.                                           00011501
003600                                                                  00011601
003700 SOURCE-COMPUTER.        IBM-3090.                                00011701
003800                                                                  00011801
003900 OBJECT-COMPUTER.        IBM-3090.                                00011901
004000                                                                  00012001
004100 INPUT-OUTPUT SECTION.                                            00012101
004200                                                                  00012201
004300 FILE-CONTROL.                                                    00012301
004400                                                                  00012401
004500     SELECT EMP-FILE                                              00012501
004600         ASSIGN TO INP01.                                         00012601
004700                                                                  00012701
004800     SELECT EMP-FILE-OUT                                          00012801
004900         ASSIGN TO OUT01.                                         00012901
005000                                                                  00013001
006900******************************************************************00013101
007000 DATA DIVISION.                                                   00013201
007100******************************************************************00013301
007200                                                                  00013401
007300 FILE SECTION.                                                    00013501
007400                                                                  00013601
007500 FD  EMP-FILE                                                     00013701
007600     RECORDING MODE IS F                                          00013801
007700     BLOCK CONTAINS 0 RECORDS                                     00013901
007800     LABEL RECORDS ARE STANDARD.                                  00014001
007900                                                                  00014101
008000 01  EMP-RECORD                  PIC X(200).                      00014201
008100                                                                  00014301
008200 FD  EMP-FILE-OUT                                                 00014401
008300     RECORDING MODE IS F                                          00014501
008400     BLOCK CONTAINS 0 RECORDS                                     00014601
008500     LABEL RECORDS ARE STANDARD.                                  00014701
008600                                                                  00014801
008700 01  EMP-RECORD-OUT              PIC X(200).                      00014901
008800                                                                  00015001
013500******************************************************************00015101
013600 WORKING-STORAGE SECTION.                                         00015201
013700******************************************************************00015301
013800 01  FILLER                            PIC X(50)  VALUE           00015401
013900     ' *** WORKING STORAGE STARTS HERE FOR ARKUT076 *** '.        00015501
014000                                                                  00015601
014100 01  PS-PROGRAM-SWITCHES.                                         00015701
014200     05  PS-END-OF-FILE-SW          PIC X(01)  VALUE 'N'.         00015801
014300         88  PS-NOT-END-OF-FILE                VALUE 'N'.         00015901
014400         88  PS-END-OF-FILE                    VALUE 'Y'.         00016001
014500     05  PS-ACCT-SSN                PIC X(08)  VALUE SPACES.      00016101
014600         88  PS-ACCT-NBR                       VALUE 'ACCT NBR'.  00016201
014700         88  PS-SSN-NBR                        VALUE 'SSN NBR'.   00016301
008800     05  PS-ASSOC-DTL-SW            PIC X(04)  VALUE SPACES.      00016401
009200         88  PS-ASSOC-ENTR-NM                  VALUE 'ENTR'.      00016501
015400                                                                  00016601
015500 01  PC-CONSTANTS.                                                00016701
015600     05  PC-PROGRAM-NAME               PIC  X(08) VALUE           00016801
015700                                                 'ARKUT076'.      00016901
           05  PC-SATURDAY                     PIC 9(01)   VALUE 7.     00017005
           05  PC-CALENDAR-TYPE                PIC X(02)   VALUE 'F2'.  00017105
                                                                        00017205
015800 01  PV-PROGRAM-VARIABLES.                                        00017301
015900     05  PV-READ-COUNT                 PIC  9(09) VALUE ZEROES.   00017401
016000     05  PV-WRITE-COUNT                PIC  9(09) VALUE ZEROES.   00017501
016700     05  PV-INPUT-LEN                  PIC  9(09) VALUE ZEROES.   00017601
016701     05  PV-OUTPUT-RECORD              PIC  X(200) VALUE SPACES.  00017701
010000     05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACES.   00017801
010100     05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACE.    00017901
010200     05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACE.    00018001
010300     05  PV-INP-READ-COUNT             PIC  9(09) VALUE ZEROES.   00018101
010400     05  PV-OUT-WRITE-COUNT            PIC  9(09) VALUE ZEROES.   00019001
                                                                        00019112
           05  PV-FISCAL-MONTH-END-DATE.                                00019212
               10 PV-FISCAL-YY               PIC 9(04)  VALUE ZEROES.   00019312
               10 PV-FISCAL-MM               PIC 9(02)  VALUE ZEROES.   00019412
               10 PV-FISCAL-DD               PIC 9(02)  VALUE ZEROES.   00019512
017400     05  PV-INPUT-DATE.                                           00019612
               10 PV-HDR-CC                     PIC 9(02).              00019713
               10 PV-HDR-YY                     PIC 9(02).              00019813
               10 PV-HDR-MM                     PIC 9(02).              00019913
               10 PV-HDR-DD                     PIC 9(02).              00020013
016800                                                                  00020112
016900 01  ABEND-CODE                        PIC S9(04) VALUE ZERO      00020212
016910                                                  COMP SYNC.      00020312
008300     88  ABEND-4008-CONVERSION-ERROR              VALUE +4008.    00020412
017000                                                                  00020512
017100******************************************************************00020612
017200* RECORD LAYOUT FOR HEADER REC                                   *00020712
017300******************************************************************00020812
017400 01  WD-HEADER-REC.                                               00020912
           05 WD-HDR-CC                     PIC 9(02).                  00021012
           05 WD-HDR-YY                     PIC 9(02).                  00021112
           05 WD-HDR-MM                     PIC 9(02).                  00021212
           05 WD-HDR-DD                     PIC 9(02).                  00021312
           05 WD-HDR-TM                     PIC 9(06).                  00021412
           05 FILLER                        PIC X(186).                 00021512
                                                                        00021612
017500                                                                  00021712
017100******************************************************************00021812
017200* RECORD LAYOUT FOR WORKDAY FILE                                 *00021912
017300******************************************************************00022012
017400     COPY ARRD100.                                                00022112
                                                                        00022212
005420*----------------------------------------------------------------*00022312
005430* WORKING STORAGE FOR DATE ROUTINE                               *00022412
005440*----------------------------------------------------------------*00022512
005500     COPY DPWS500.                                                00022612
005510                                                                  00022712
016600******************************************************************00022812
020000                                                                  00022912
020100 PROCEDURE DIVISION.                                              00023012
020200                                                                  00023112
020300 0000-MAINLINE-PARA.                                              00023212
020400                                                                  00023312
020500     PERFORM 1000-INITIALIZE.                                     00023412
020600                                                                  00023512
           IF RETURN-CODE NOT = 04                                      00023619
                                                                        00023719
020700         PERFORM 2000-PROCESS-PARA                                00023819
020800               UNTIL PS-END-OF-FILE                               00023919
021900         PERFORM 9000-EOJ-ROUTINE                                 00024019
           ELSE                                                         00024219
021900         PERFORM 9000-EOJ-ROUTINE                                 00024319
           END-IF.                                                      00024419
022000                                                                  00024512
022100     STOP RUN.                                                    00024612
022200                                                                  00024712
022300******************************************************************00024812
022400* 1000-INITIALIZE                                                 00024912
022500*     INITIALIZE THE VARIABLES, OPEN THE INPUT AND OUTPUT FILES   00025012
022600*     AND READ THE INPUT FILE                                     00025112
022700******************************************************************00025212
022800 1000-INITIALIZE.                                                 00025312
022900                                                                  00025412
023000     DISPLAY 'PROGRAM - ' PC-PROGRAM-NAME.                        00025512
023100     INITIALIZE PV-PROGRAM-VARIABLES.                             00025612
023300                                                                  00025712
023400     OPEN INPUT  EMP-FILE                                         00025812
023500          OUTPUT EMP-FILE-OUT.                                    00025912
024200                                                                  00026012
      *    READ HEADER                                                  00026119
024300     PERFORM 2100-READ-FILE.                                      00026212
           PERFORM 2300-CHECK-CALENDAR.                                 00026319
      *    READ NEXT RECORD                                             00026419
024300     PERFORM 2200-READ-FILE.                                      00026519
024400                                                                  00026712
025100******************************************************************00026812
025200* 2000-PROCESS-PARA                                               00026912
025600******************************************************************00027112
025700 2000-PROCESS-PARA.                                               00028012
026017     PERFORM 2200-WRITE-FILE.                                     00029019
026018     PERFORM 2200-READ-FILE.                                      00029104
026019                                                                  00029201
028900******************************************************************00029301
029000* 2100-READ-FILE                                                  00029401
029100*      READ THE HEADER RECORD ON THE WORKDAY FILE                 00029503
029200******************************************************************00029703
029300 2100-READ-FILE.                                                  00029803
029400                                                                  00029903
029500     READ EMP-FILE INTO WD-HEADER-REC                             00030004
029600        AT END                                                    00030103
029700           SET PS-END-OF-FILE  TO TRUE                            00030203
029800        NOT AT END                                                00030303
029900           ADD 1               TO PV-READ-COUNT                   00030403
                 DISPLAY 'HEADER READ = ' WD-HEADER-REC                 00030518
030000     END-READ.                                                    00030603
030100                                                                  00030703
028900******************************************************************00030804
029000* 2200-READ-FILE                                                  00030904
029100*      READ NEXT RECORD ON WORKDAY FILE                           00031004
029200******************************************************************00031104
029300 2200-READ-FILE.                                                  00031204
029400                                                                  00031304
029500     READ EMP-FILE INTO AR100-WD-EMPLOYEE-REC                     00031404
029600        AT END                                                    00031504
029700           SET PS-END-OF-FILE  TO TRUE                            00031604
029800        NOT AT END                                                00031704
029900           ADD 1               TO PV-READ-COUNT                   00031804
030000     END-READ.                                                    00031904
030100                                                                  00032004
030200******************************************************************00032103
030300* 2200-WRITE-FILE                                                 00032203
030400*      WRITE THE RECORDS TO OUTPUT                                00032303
030500******************************************************************00032403
030600 2200-WRITE-FILE.                                                 00032503
030700                                                                  00032603
030800     INITIALIZE PV-OUTPUT-RECORD.                                 00032703
030801     MOVE AR100-WD-EMPLOYEE-REC    TO PV-OUTPUT-RECORD.           00032803
030802                                                                  00032903
030803     WRITE EMP-RECORD-OUT FROM PV-OUTPUT-RECORD.                  00033003
030900     ADD 1                       TO PV-WRITE-COUNT.               00033103
031000                                                                  00033203
       2300-CHECK-CALENDAR.                                             00033303
                                                                        00033403
      ***************************************************************   00033503
      *    READ THE CALENDAR DB.                                        00033603
      *    CHECK IF DATE IS LAST SATURDAY OF THE MONTH IN QUESTION      00033704
      ***************************************************************   00033803
                                                                        00033904
           IF WD-HDR-CC IS NUMERIC AND                                  00034015
              WD-HDR-YY IS NUMERIC AND                                  00034115
              WD-HDR-MM IS NUMERIC AND                                  00034215
              WD-HDR-DD IS NUMERIC                                      00034315
               MOVE PC-CALENDAR-TYPE     TO  DPG51-CALENDAR-TYPE        00034715
               SET DPG52-LK-DTE-GREG     TO  TRUE                       00034815
               MOVE WD-HDR-CC            TO  PV-HDR-CC                  00034915
               MOVE WD-HDR-MM            TO  DPG52-GREG-DATE-MO         00035315
                                             PV-HDR-MM                  00035415
               MOVE WD-HDR-DD            TO  DPG52-GREG-DATE-DY         00035515
                                             PV-HDR-DD                  00035615
               MOVE WD-HDR-YY            TO  DPG52-GREG-DATE-YR         00035715
                                             PV-HDR-YY                  00035815
               DISPLAY WD-HDR-MM ' ' WD-HDR-DD ' '  WD-HDR-YY           00035915
                                                                        00036012
               CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51            00036115
                                                       DPG52            00036215
                                                       DPG53            00036315
                                                       DPG54            00036415
                                                       DPG55            00036515
                                                       DPG56            00036615
                                                                        00036712
               MOVE DPG56-LAST-FP-GREG-CC-YR TO PV-FISCAL-YY            00036816
               MOVE DPG56-LAST-FP-GREG-CC-MO TO PV-FISCAL-MM            00036916
               MOVE DPG56-LAST-FP-GREG-CC-DY TO PV-FISCAL-DD            00037016
                                                                        00037116
               DISPLAY 'INPUT      DTE ' PV-INPUT-DATE                  00037216
               DISPLAY 'FISCAL EOM DTE ' PV-FISCAL-MONTH-END-DATE       00037315
                                                                        00037512
               IF  DPG55-NUMERIC-WEEK-DAY EQUAL PC-SATURDAY AND         00037615
                   PV-FISCAL-MONTH-END-DATE = PV-INPUT-DATE             00037715
                   DISPLAY 'DATE IS A SATURDAY EOM'                     00037815
                   MOVE 04         TO RETURN-CODE                       00037915
               ELSE                                                     00038015
                    DISPLAY 'DATE IS NOT A SATURDAY EOM'                00038115
               END-IF                                                   00038215
                                                                        00038315
               DISPLAY  DPG56-LAST-FP-GREG-CC-N                         00038515
                                                                        00038615
      *        MOVE DPG56-LAST-FP-GREG-CC-YR TO PV-FISCAL-YY            00038716
      *        MOVE DPG56-LAST-FP-GREG-CC-MO TO PV-FISCAL-MM            00038816
      *        MOVE DPG56-LAST-FP-GREG-CC-DY TO PV-FISCAL-DD            00038916
           ELSE                                                         00039015
               DISPLAY '*** ABEND *** IN ARKUT076'                      00039115
               DISPLAY 'DATE ON HEADER IS NOT NUMBERIC '                00039215
               DISPLAY 'CCYYMMDDHHMMSS FORMAT'                          00039317
               DISPLAY 'DATE = ' WD-HEADER-REC                          00039416
               MOVE +4003 TO ABEND-CODE                                 00039615
               CALL 'ILBOABN0' USING ABEND-CODE                         00039715
           END-IF.                                                      00039815
                                                                        00040002
050300******************************************************************00063301
050400* 9000-EOJ-ROUTINE                                                00063401
050500*      CLOSE THE INPUT AND OUTPUT FILES, DISPLAY THE MESSAGES     00063501
050600*      AND TERMINATE THE PROCESS.                                 00063601
050700******************************************************************00063701
050800 9000-EOJ-ROUTINE.                                                00063801
050900                                                                  00063901
051000     CLOSE EMP-FILE                                               00064001
051100           EMP-FILE-OUT.                                          00064101
051800                                                                  00064201
051900     IF PV-READ-COUNT = 0                                         00064301
052000        DISPLAY 'INPUT FILE IS EMPTY'                             00064401
052100     ELSE                                                         00064501
052200        DISPLAY 'RECORDS READ   : ' PV-READ-COUNT                 00064601
052300        DISPLAY 'RECORDS WRITTEN: ' PV-WRITE-COUNT                00064701
052310     END-IF.                                                      00064801
052400                                                                  00064901
049000******************************************************************00065001
049100* 9999-ABEND                                                      00065101
049300******************************************************************00065201
049400                                                                  00065301
049500 9999-ABEND.                                                      00065401
049600     DISPLAY '** ABEND           **'.                             00065501
049700     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          00065601
049800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        00065701
049900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       00065801
050000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       00065901
050100     CALL 'ILBOABN0' USING ABEND-CODE.                            00066001
050200                                                                  00066101
