000001******************************************************************00000156
000002*   PROCEDURE DIVISION FOR THE REAL-TIME PDE SQL PROGRAMS         00000257
000003******************************************************************00000357
000004                                                                  00000457
000005******************************************************************00000557
000006* 1000-INITIALIZATION - INITIALIZE VARIABLES; OTHERWISE, VALUES   00000657
000007* FROM LAST CALL ARE LEFT IN MEMORY.                              00000757
000008******************************************************************00000857
000009 1000-INITIALIZATION.                                             00000957
000010                                                                  00001057
000020     MOVE ZEROES              TO PV-PROMO-ID                      00002057
000030                                 PV-INDEX                         00003057
000040                                 PV-DISC-GP-QTY                   00004057
000050                                 PV-DISC-PRCG-AMT.                00005057
000060     MOVE 'Y'                 TO XS047-SUCCESSFUL-COMPLETE-IND.   00006057
000070     SET PS-NO-ERROR-FOUND             TO TRUE.                   00007057
000071     SET PS-NO-PROMO-PRICG-FOUND       TO TRUE.                   00007157
000072                                                                  00007257
000073     PERFORM 1050-INIT-RULES-ENG-FIELDS.                          00007357
000074     PERFORM 1100-SET-PV-VALUES.                                  00007457
000075     PERFORM 1200-CHECK-FOR-ERRORS.                               00007557
000076                                                                  00007657
000077     IF PS-NO-ERROR-FOUND                                         00007757
000078         PERFORM 1300-GET-MDSE-INFO                               00007857
000079     END-IF.                                                      00007957
000080                                                                  00008057
000090******************************************************************00009057
000100* IN CASE THE RULES MODULE IS NOT CALLED, VALUES THAT ARE PASSED  00010057
000200* BACK FROM IT WILL BE POPULATED.                                 00020057
000300******************************************************************00030057
000400 1050-INIT-RULES-ENG-FIELDS.                                      00040057
000500                                                                  00050057
000600     MOVE XS047-STR           TO XS045-STORE.                     00060057
000700     MOVE XS047-DTE           TO XS045-DATE.                      00070057
000800     MOVE ZEROES              TO XS045-INTR-UPC-ID.               00080057
000900     MOVE XS047-INCLD-LST-SIX-WK-PRIC-SW                          00090057
001000                              TO XS045-LWST-SIX-WK-NEEDED-IND.    00100057
001100     MOVE ZEROES              TO XS045-RGLR-PRICE.                00110057
001200     MOVE ZEROES              TO XS045-REG-GRP-PRICG-QTY.         00120057
001300     MOVE ZEROES              TO XS045-REG-GRP-PRICG-DLR.         00130057
001400                                                                  00140057
001500     INITIALIZE XS045-VARIABLES-SENT-BACK.                        00150057
001600     PERFORM 8200-INIT-XS045-TIER                                 00160057
001700         VARYING PV-SUB                                           00170057
001800         FROM 1 BY 1                                              00180057
001810         UNTIL PV-SUB > PC-NBR-OF-TIERS.                          00181057
001820     INITIALIZE XS045-ELIG-PROMO-TBL-ELMT(1).                     00182057
001830                                                                  00183057
001840******************************************************************00184057
001850* MOVE VALUES FROM LINKAGE VALUES TO PROGRAM VARIBLES.            00185057
001860******************************************************************00186057
001870 1100-SET-PV-VALUES.                                              00187057
001880                                                                  00188057
001890     MOVE XS047-STR           TO PV-STR.                          00189057
001900     MOVE XS047-DTE           TO PV-DT.                           00190057
002000     MOVE XS047-TM            TO PV-TM.                           00200057
002100     MOVE XS047-PROMO-ID      TO PV-PROMO-ID.                     00210057
002200                                                                  00220057
002300     MOVE XS047-SKU           TO PV-SKU.                          00230057
002400     MOVE XS047-INTR-UPC-ID   TO PV-INTR-UPC-ID-10.               00240057
002500     MOVE PV-INTR-UPC-ID-10   TO PV-INTR-UPC-ID.                  00250057
002600     MOVE XS047-UPC           TO PV-UPC-16.                       00260057
002700     MOVE PV-UPC-16           TO PV-UPC.                          00270057
002800                                                                  00280057
002900     MOVE PV-DT               TO PV-TMST-DATE.                    00290057
003000     MOVE '-'                 TO PV-TMST-HYPHEN1.                 00300057
003100     MOVE PV-TM               TO PV-TMST-TIME.                    00310057
003200     MOVE '.'                 TO PV-TMST-DOT1.                    00320057
003300     MOVE '000000'            TO PV-TMST-SUBS.                    00330057
003400                                                                  00340057
003500******************************************************************00350057
003600* CHECK IF INPUTS ARE POPULATED                                   00360057
003700******************************************************************00370057
003800 1200-CHECK-FOR-ERRORS.                                           00380057
003900                                                                  00390057
004000     MOVE SPACES                TO XS047-INVALID-INPUT-CODE.      00400057
004100                                                                  00410057
004200     IF PV-STR = 0                                                00420057
004300         MOVE 'STORE MISSING FROM INPUT'                          00430057
004400                                TO XS047-ERROR-SECTION-NAME       00440057
004500         MOVE 'S'               TO XS047-INVALID-INPUT-CODE       00450057
004600         PERFORM 9000-DISPLAY-ERRORS                              00460057
004700     END-IF.                                                      00470057
004800                                                                  00480057
004900     IF PS-NO-ERROR-FOUND                                         00490057
004910         PERFORM 1210-CHECK-DATE                                  00491057
004920     END-IF.                                                      00492057
004930                                                                  00493057
004940     IF PS-NO-ERROR-FOUND                                         00494057
004950         PERFORM 1220-CHECK-TIME                                  00495057
004960     END-IF.                                                      00496057
004970                                                                  00497057
004980     IF PS-NO-ERROR-FOUND                                         00498057
004990         IF PV-INTR-UPC-ID   = 0 AND                              00499057
005000            PV-SKU           = 0 AND                              00500057
005100            PV-UPC           = 0                                  00510057
005200             MOVE 'INTR-UPC, SKU, OR UPC MISSING'                 00520057
005300                                    TO XS047-ERROR-SECTION-NAME   00530057
005400             MOVE 'M'               TO XS047-INVALID-INPUT-CODE   00540057
005500             PERFORM 9000-DISPLAY-ERRORS                          00550057
005600         END-IF                                                   00560057
005700     END-IF.                                                      00570057
005800                                                                  00580057
005900     IF PS-NO-ERROR-FOUND                                         00590057
006000         PERFORM 1230-CHECK-INCLD-SWITCHES                        00600057
006100     END-IF.                                                      00610057
006200                                                                  00620057
006300******************************************************************00630057
006400 1210-CHECK-DATE.                                                 00640057
006500******************************************************************00650057
006600                                                                  00660057
006700     IF PV-DT = SPACES                                            00670057
006800         MOVE 'DATE WAS MISSING FROM INPUT'                       00680057
006900                                TO XS047-ERROR-SECTION-NAME       00690057
007000         MOVE 'D'               TO XS047-INVALID-INPUT-CODE       00700057
007100         PERFORM 9000-DISPLAY-ERRORS                              00710057
007200     ELSE                                                         00720057
007300         IF (PV-DATE-HY1 NOT = '-'  OR                            00730057
007400             PV-DATE-MM      < '00' OR                            00740057
007500             PV-DATE-MM      > '12' OR                            00750057
007600             PV-DATE-HY2 NOT = '-'  OR                            00760057
007700             PV-DATE-DD      < '00' OR                            00770057
007800             PV-DATE-DD      > '31')                              00780057
007900             MOVE 'DATE NOT IN CORRECT FORMAT'                    00790057
008000                                    TO XS047-ERROR-SECTION-NAME   00800057
008100             MOVE 'D'               TO XS047-INVALID-INPUT-CODE   00810057
008200             PERFORM 9000-DISPLAY-ERRORS                          00820057
008300         END-IF                                                   00830057
008400     END-IF.                                                      00840057
008500                                                                  00850057
008600******************************************************************00860057
008700 1220-CHECK-TIME.                                                 00870057
008800******************************************************************00880057
008900                                                                  00890057
009000     IF PV-TM = SPACES OR ZEROES                                  00900057
009100         MOVE PC-ZERO-TIME TO PV-TM                               00910057
009200     ELSE                                                         00920057
009300         IF (PV-TIME-HH      < '00' OR                            00930057
009400             PV-TIME-HH      > '23' OR                            00940057
009500             PV-TIME-MM      < '00' OR                            00950057
009600             PV-TIME-MM      > '59' OR                            00960057
009700             PV-TIME-SS      < '00' OR                            00970057
009800             PV-TIME-SS      > '59')                              00980057
009900             MOVE 'TIME NOT IN CORRECT FORMAT'                    00990057
010000                                    TO XS047-ERROR-SECTION-NAME   01000057
010100             MOVE 'T'               TO XS047-INVALID-INPUT-CODE   01010057
010200             PERFORM 9000-DISPLAY-ERRORS                          01020057
010300         ELSE                                                     01030057
010400             IF PV-TIME-CO1 = '.' OR ':' AND                      01040057
010500                PV-TIME-CO2 = '.' OR ':'                          01050057
010600                 MOVE '.'           TO PV-TIME-CO1                01060057
010700                                       PV-TIME-CO2                01070057
010800             ELSE                                                 01080057
010900                 MOVE 'TIME NOT IN CORRECT FORMAT'                01090057
011000                                    TO XS047-ERROR-SECTION-NAME   01100057
011100                 MOVE 'T'           TO XS047-INVALID-INPUT-CODE   01110057
011200                 PERFORM 9000-DISPLAY-ERRORS                      01120057
011300             END-IF                                               01130057
011400         END-IF                                                   01140057
011500     END-IF.                                                      01150057
011600                                                                  01160057
011700******************************************************************01170057
011800 1230-CHECK-INCLD-SWITCHES.                                       01180057
011900******************************************************************01190057
012000                                                                  01200057
012100     IF XS047-INCLD-UNADVERTISED-SW = 'N' OR 'Y'                  01210057
012200         CONTINUE                                                 01220057
012300     ELSE                                                         01230057
012400         MOVE 'W'               TO XS047-INVALID-INPUT-CODE       01240057
012500         MOVE 'INCLD-UNAD SWITCH NOT SET'                         01250057
012600                                TO XS047-ERROR-SECTION-NAME       01260057
012700         PERFORM 9000-DISPLAY-ERRORS                              01270057
012800     END-IF.                                                      01280057
012900                                                                  01290057
013000     IF PS-NO-ERROR-FOUND                                         01300057
013010         IF XS047-INCLD-PARTIAL-DAY-SW = 'N' OR 'Y'               01301057
013020             CONTINUE                                             01302057
013030         ELSE                                                     01303057
013040             MOVE 'W'               TO XS047-INVALID-INPUT-CODE   01304057
013050             MOVE 'INCLD-PARTIAL-DAY SWITCH NOT SET'              01305057
013060                                    TO XS047-ERROR-SECTION-NAME   01306057
013070             PERFORM 9000-DISPLAY-ERRORS                          01307057
013080         END-IF                                                   01308057
013090     END-IF.                                                      01309057
013100                                                                  01310057
013200     IF PS-NO-ERROR-FOUND                                         01320057
013300         IF XS047-INCLD-GOLDSTAR-SW = 'N' OR 'Y'                  01330057
013400             CONTINUE                                             01340057
013500         ELSE                                                     01350057
013600             MOVE 'W'               TO XS047-INVALID-INPUT-CODE   01360057
013700             MOVE 'INCLD-GOLDSTAR SWITCH NOT SET'                 01370057
013800                                    TO XS047-ERROR-SECTION-NAME   01380057
013900             PERFORM 9000-DISPLAY-ERRORS                          01390057
014000         END-IF                                                   01400057
014100     END-IF.                                                      01410057
014200                                                                  01420057
014300     IF PS-NO-ERROR-FOUND                                         01430057
014400         IF XS047-INCLD-LST-SIX-WK-PRIC-SW = 'N' OR 'Y'           01440057
014500             CONTINUE                                             01450057
014600         ELSE                                                     01460057
014700             MOVE 'W'               TO XS047-INVALID-INPUT-CODE   01470057
014800             MOVE 'INCLD-LST-SIX-WK SWITCH NOT SET'               01480057
014900                                    TO XS047-ERROR-SECTION-NAME   01490057
015000             PERFORM 9000-DISPLAY-ERRORS                          01500057
015100         END-IF                                                   01510057
015200     END-IF.                                                      01520057
015300                                                                  01530057
015400     IF PS-NO-ERROR-FOUND                                         01540057
015500         IF XS047-INCLD-PROMO-GRP-PRIC-SW = 'N' OR 'Y'            01550057
015600             CONTINUE                                             01560057
015700         ELSE                                                     01570057
015800             MOVE 'W'               TO XS047-INVALID-INPUT-CODE   01580057
015900             MOVE 'INCLD-LST-SIX-WK SWITCH NOT SET'               01590057
016000                                    TO XS047-ERROR-SECTION-NAME   01600057
016100             PERFORM 9000-DISPLAY-ERRORS                          01610057
016200         END-IF                                                   01620057
016300     END-IF.                                                      01630057
016400                                                                  01640057
016500     IF PS-NO-ERROR-FOUND                                         01650057
016600         IF XS047-INCLD-GWP-PWP-PROMO-SW = 'N' OR 'Y'             01660057
016700             CONTINUE                                             01670057
016800         ELSE                                                     01680057
016900             MOVE 'W'               TO XS047-INVALID-INPUT-CODE   01690057
017000             MOVE 'INCLD-GWP-PWP-PROMO SWITCH NOT SET'            01700057
017100                                    TO XS047-ERROR-SECTION-NAME   01710057
017200             PERFORM 9000-DISPLAY-ERRORS                          01720057
017300         END-IF                                                   01730057
017310     END-IF.                                                      01731057
017320                                                                  01732057
017330     IF PS-NO-ERROR-FOUND                                         01733057
017340         IF XS047-INCLD-TIERED-PROMO-SW = 'N' OR 'Y'              01734057
017350             CONTINUE                                             01735057
017360         ELSE                                                     01736057
017370             MOVE 'W'               TO XS047-INVALID-INPUT-CODE   01737057
017380             MOVE 'INCLD-TIERED-PROMO SWITCH NOT SET'             01738057
017390                                    TO XS047-ERROR-SECTION-NAME   01739057
017400             PERFORM 9000-DISPLAY-ERRORS                          01740057
017500         END-IF                                                   01750057
017600     END-IF.                                                      01760057
017700                                                                  01770057
017800     IF PS-NO-ERROR-FOUND                                         01780057
017900         IF XS047-INCLD-ADD-PCT-AMT-OFF-SW = 'N' OR 'Y'           01790057
018000             CONTINUE                                             01800057
018100         ELSE                                                     01810057
018200             MOVE 'W'               TO XS047-INVALID-INPUT-CODE   01820057
018300             MOVE 'INCLD-ADD-PCT-AMT SWITCH NOT SET'              01830057
018400                                    TO XS047-ERROR-SECTION-NAME   01840057
018500             PERFORM 9000-DISPLAY-ERRORS                          01850057
018600         END-IF                                                   01860057
018700     END-IF.                                                      01870057
018800                                                                  01880057
018900***************************************************************** 01890057
019000* FIND THE RETAIL PRICE AND MDSE HIERARCHY INFORMATION            01900057
019100***************************************************************** 01910057
019200 1300-GET-MDSE-INFO.                                              01920057
019300                                                                  01930057
019400     IF PV-INTR-UPC-ID > 0                                        01940057
019500         PERFORM 1310-GET-INTR-UPC-ID                             01950057
019600     ELSE                                                         01960057
019700         IF PV-SKU > 0                                            01970057
019800             PERFORM 1320-GET-SKU                                 01980057
019900         ELSE                                                     01990057
020000             IF PV-UPC > 0                                        02000057
020100                 PERFORM 1330-GET-UPC                             02010057
020200             ELSE                                                 02020057
020300                 MOVE '1300-GET-MDSE-INFO'                        02030057
020400                                     TO XS047-ERROR-SECTION-NAME  02040057
020500                 MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND02050057
020600                 MOVE 'M'            TO XS047-INVALID-INPUT-CODE  02060057
020700                 PERFORM 9000-DISPLAY-ERRORS                      02070057
020800             END-IF                                               02080057
020900         END-IF                                                   02090057
021000     END-IF.                                                      02100057
021100                                                                  02110065
021200***************************************************************** 02120057
021300* GET RETAIL PRICE WHEN INTR_UPC_ID IS POPULATED                  02130057
021400***************************************************************** 02140057
021500 1310-GET-INTR-UPC-ID.                                            02150057
021600                                                                  02160057
021601     EXEC SQL                                                     02160157
021602         SELECT L.UNT_RTL_AMT                                     02160257
021603              , L.LOC_SKU_STAT_CDE                                02160357
021604              , L.INTR_UPC_ID                                     02160457
021605              , L.GP_RTL_QTY                                      02160557
021606              , L.GP_RTL_AMT                                      02160657
021607              , L.UNT_RTL_CHG_DTE                                 02160757
021608              , L.UPC_STAT_CHG_DTE                                02160857
021609              , S.SKU_NBR                                         02160957
021610              , S.STYL_ID                                         02161057
021611              , S.REGN_PRIC_IND                                   02161157
021612              , V.DEPT_NBR                                        02161257
021613              , V.MAJ_CL_NBR                                      02161357
021614              , V.SUB_CL_NBR                                      02161457
021615           INTO :XST00008-UNT-RTL-AMT                             02161557
021616              , :XST00008-LOC-SKU-STAT-CDE                        02161657
021617              , :XST00008-INTR-UPC-ID                             02161757
021618              , :XST00008-GP-RTL-QTY                              02161857
021619                :PV-GP-RTL-QTY-NULL-IND                           02161957
021620              , :XST00008-GP-RTL-AMT                              02162057
021621                :PV-GP-RTL-AMT-NULL-IND                           02162157
021622              , :XST00008-UNT-RTL-CHG-DTE                         02162257
021623              , :XST00008-UPC-STAT-CHG-DTE                        02162357
021624              , :XST00010-SKU-NBR                                 02162457
021625              , :XST00010-STYL-ID                                 02162557
021626              , :XST00010-REGN-PRIC-IND                           02162657
021627              , :XST00013-DEPT-NBR                                02162757
021628              , :XST00013-MAJ-CL-NBR                              02162857
021629              , :XST00013-SUB-CL-NBR                              02162957
021630           FROM XST_SKU_LOC  L                                    02163057
021631              , XST_SKU      S                                    02163157
021632              , XST_VND_STYL V                                    02163257
021633          WHERE L.LOC_NBR     = SMALLINT(0)                       02163381
021634            AND L.INTR_UPC_ID = :PV-INTR-UPC-ID                   02163457
021635            AND S.INTR_UPC_ID = L.INTR_UPC_ID                     02163557
021636            AND S.STYL_ID     = V.STYL_ID                         02163657
021637            AND L.BEG_TMST   <= :PV-FULL-TMST                     02163757
021638            AND (L.END_TMST  >= :PV-FULL-TMST                     02163857
021639             OR L.END_TMST   IS NULL)                             02163957
021640           WITH UR                                                02164057
021641     END-EXEC.                                                    02164157
021642                                                                  02164257
021643     EVALUATE TRUE                                                02164357
021644         WHEN SQLCODE = ZERO                                      02164457
021645             IF PV-GP-RTL-QTY-NULL-IND < 0                        02164557
021646                 MOVE ZEROES    TO XST00008-GP-RTL-QTY            02164657
021647             END-IF                                               02164757
021648             IF PV-GP-RTL-AMT-NULL-IND < 0                        02164857
021649                 MOVE ZEROES    TO XST00008-GP-RTL-AMT            02164957
021650             END-IF                                               02165057
021651                                                                  02165157
021652* IF THE SKU IS NOT FOUND, WE DON'T WANT TO CONTINUE.             02165257
021653         WHEN OTHER                                               02165357
021654             MOVE '1310-GET-INTR-UPC-ID      '                    02165457
021655                              TO XS047-ERROR-SECTION-NAME         02165557
021656             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             02165657
021657             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    02165757
021658             MOVE 'M'         TO XS047-INVALID-INPUT-CODE         02165857
021659             PERFORM 9000-DISPLAY-ERRORS                          02165957
021660     END-EVALUATE.                                                02166057
021661                                                                  02166157
021662******************************************************************02166257
021663* GET RETAIL PRICE WHEN SKU IS POPULATED                          02166357
021664******************************************************************02166457
021665 1320-GET-SKU.                                                    02166557
021666                                                                  02166657
021667     EXEC SQL                                                     02166757
021668          SELECT L.UNT_RTL_AMT                                    02166857
021669               , L.LOC_SKU_STAT_CDE                               02166957
021670               , L.INTR_UPC_ID                                    02167057
021671               , L.GP_RTL_QTY                                     02167157
021672               , L.GP_RTL_AMT                                     02167257
021673               , L.UNT_RTL_CHG_DTE                                02167357
021674               , L.UPC_STAT_CHG_DTE                               02167457
021675               , S.SKU_NBR                                        02167557
021676               , S.STYL_ID                                        02167657
021677               , S.REGN_PRIC_IND                                  02167757
021678               , V.DEPT_NBR                                       02167857
021679               , V.MAJ_CL_NBR                                     02167957
021680               , V.SUB_CL_NBR                                     02168057
021681           INTO :XST00008-UNT-RTL-AMT                             02168157
021682              , :XST00008-LOC-SKU-STAT-CDE                        02168257
021683              , :XST00008-INTR-UPC-ID                             02168357
021684              , :XST00008-GP-RTL-QTY                              02168457
021685                :PV-GP-RTL-QTY-NULL-IND                           02168557
021686              , :XST00008-GP-RTL-AMT                              02168657
021687                :PV-GP-RTL-AMT-NULL-IND                           02168757
021688              , :XST00008-UNT-RTL-CHG-DTE                         02168857
021689              , :XST00008-UPC-STAT-CHG-DTE                        02168957
021690              , :XST00010-SKU-NBR                                 02169057
021691              , :XST00010-STYL-ID                                 02169157
021692              , :XST00010-REGN-PRIC-IND                           02169257
021693              , :XST00013-DEPT-NBR                                02169357
021694              , :XST00013-MAJ-CL-NBR                              02169457
021695              , :XST00013-SUB-CL-NBR                              02169557
021696            FROM XST_SKU      S                                   02169657
021697               , XST_SKU_LOC  L                                   02169757
021698               , XST_VND_STYL V                                   02169857
021699           WHERE S.SKU_NBR     = :PV-SKU                          02169957
021700             AND L.LOC_NBR     = SMALLINT(0)                      02170081
021701             AND L.INTR_UPC_ID = S.INTR_UPC_ID                    02170157
021702             AND S.STYL_ID     = V.STYL_ID                        02170257
021703             AND L.BEG_TMST   <= :PV-FULL-TMST                    02170357
021704             AND (L.END_TMST  >= :PV-FULL-TMST                    02170457
021705              OR L.END_TMST   IS NULL)                            02170557
021706            WITH UR                                               02170657
021707     END-EXEC.                                                    02170757
021708                                                                  02170857
021709     EVALUATE TRUE                                                02170957
021710         WHEN SQLCODE = ZERO                                      02171057
021711             IF PV-GP-RTL-QTY-NULL-IND < 0                        02171157
021712                 MOVE ZEROES  TO XST00008-GP-RTL-QTY              02171257
021713             END-IF                                               02171357
021714             IF PV-GP-RTL-AMT-NULL-IND < 0                        02171457
021715                 MOVE ZEROES  TO XST00008-GP-RTL-AMT              02171557
021716             END-IF                                               02171657
021717                                                                  02171757
021718* IF THE SKU IS NOT FOUND, WE DON'T WANT TO CONTINUE.             02171857
021719         WHEN OTHER                                               02171957
021720             MOVE '1320-GET-SKU'                                  02172057
021721                              TO XS047-ERROR-SECTION-NAME         02172157
021722             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             02172257
021723             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    02172357
021724             MOVE 'M'         TO XS047-INVALID-INPUT-CODE         02172457
021725             PERFORM 9000-DISPLAY-ERRORS                          02172557
021726     END-EVALUATE.                                                02172657
021727                                                                  02172757
021728***************************************************************** 02172857
021729* OPEN RETAIL PRICE WHEN UPC IS POPULATED                         02172957
021730***************************************************************** 02173057
021731 1330-GET-UPC.                                                    02173157
021732                                                                  02173257
021733     EXEC SQL                                                     02173357
021734         SELECT L.UNT_RTL_AMT                                     02173457
021735              , L.LOC_SKU_STAT_CDE                                02173557
021736              , L.INTR_UPC_ID                                     02173657
021737              , L.GP_RTL_QTY                                      02173757
021738              , L.GP_RTL_AMT                                      02173857
021739              , L.UNT_RTL_CHG_DTE                                 02173957
021740              , L.UPC_STAT_CHG_DTE                                02174057
021741              , S.SKU_NBR                                         02174157
021742              , S.STYL_ID                                         02174257
021743              , S.REGN_PRIC_IND                                   02174357
021744              , V.DEPT_NBR                                        02174457
021745              , V.MAJ_CL_NBR                                      02174557
021746              , V.SUB_CL_NBR                                      02174657
021747           INTO :XST00008-UNT-RTL-AMT                             02174757
021748              , :XST00008-LOC-SKU-STAT-CDE                        02174857
021749              , :XST00008-INTR-UPC-ID                             02174957
021750              , :XST00008-GP-RTL-QTY                              02175057
021751                :PV-GP-RTL-QTY-NULL-IND                           02175157
021752              , :XST00008-GP-RTL-AMT                              02175257
021753                :PV-GP-RTL-AMT-NULL-IND                           02175357
021754              , :XST00008-UNT-RTL-CHG-DTE                         02175457
021755              , :XST00008-UPC-STAT-CHG-DTE                        02175557
021756              , :XST00010-SKU-NBR                                 02175657
021757              , :XST00010-STYL-ID                                 02175757
021758              , :XST00010-REGN-PRIC-IND                           02175857
021759              , :XST00013-DEPT-NBR                                02175957
021760              , :XST00013-MAJ-CL-NBR                              02176057
021761              , :XST00013-SUB-CL-NBR                              02176157
021762           FROM XST_UPC      U                                    02176257
021763              , XST_SKU_LOC  L                                    02176357
021764              , XST_SKU      S                                    02176457
021765              , XST_VND_STYL V                                    02176557
021766          WHERE U.UPC_NBR        = :PV-UPC                        02176657
021767            AND U.UPC_TYP_CDE   <> 'R'                            02176757
021768            AND U.LAST_ACTN_CDE <> 'D'                            02176857
021769            AND L.LOC_NBR        = SMALLINT(0)                    02176981
021770            AND L.INTR_UPC_ID    = U.INTR_UPC_ID                  02177057
021771            AND S.INTR_UPC_ID    = L.INTR_UPC_ID                  02177157
021772            AND S.STYL_ID        = V.STYL_ID                      02177257
021773            AND L.BEG_TMST      <= :PV-FULL-TMST                  02177357
021774            AND (L.END_TMST     >= :PV-FULL-TMST                  02177457
021775             OR L.END_TMST      IS NULL)                          02177557
021776           WITH UR                                                02177657
021777     END-EXEC.                                                    02177757
021778                                                                  02177857
021779     EVALUATE TRUE                                                02177957
021780         WHEN SQLCODE = ZERO                                      02178057
021781             IF PV-GP-RTL-QTY-NULL-IND < 0                        02178157
021782                 MOVE ZEROES    TO XST00008-GP-RTL-QTY            02178257
021783             END-IF                                               02178357
021784             IF PV-GP-RTL-AMT-NULL-IND < 0                        02178457
021785                 MOVE ZEROES    TO XST00008-GP-RTL-AMT            02178557
021786             END-IF                                               02178657
021787                                                                  02178757
021788* IF THE SKU IS NOT FOUND, WE DON'T WANT TO CONTINUE.             02178857
021789         WHEN OTHER                                               02178957
021790             MOVE '1330-GET-UPC              '                    02179057
021791                              TO XS047-ERROR-SECTION-NAME         02179157
021792             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             02179257
021793             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    02179357
021794             MOVE 'M'         TO XS047-INVALID-INPUT-CODE         02179457
021795             PERFORM 9000-DISPLAY-ERRORS                          02179557
021796     END-EVALUATE.                                                02179657
021797                                                                  02179757
021798******************************************************************02179857
021799* PROCESS MERCH VALUES PASSED INTO THIS PROGRAM                   02179957
021800******************************************************************02180057
021810 2000-PROCESS-MERCH.                                              02181057
021820                                                                  02182057
021830     MOVE XST00008-UNT-RTL-AMT      TO HV-UNT-RTL-AMT.            02183057
021840     MOVE XST00008-GP-RTL-QTY       TO HV-GP-RTL-QTY.             02184057
021850     MOVE XST00008-GP-RTL-AMT       TO HV-GP-RTL-AMT.             02185057
021860     MOVE XST00008-LOC-SKU-STAT-CDE TO HV-LOC-SKU-STAT-CDE.       02186057
021870     MOVE XST00008-UNT-RTL-CHG-DTE  TO HV-UNT-RTL-CHG-DTE.        02187057
021880     MOVE XST00008-UPC-STAT-CHG-DTE TO HV-UPC-STAT-CHG-DTE.       02188057
021890                                                                  02189057
021900     IF XST00010-REGN-PRIC-IND = 'Y'                              02190057
022000         PERFORM 2100-CHECK-FOR-REG-CLEAR                         02200057
022100         IF PS-NO-ERROR-FOUND                                     02210057
022200             IF PS-REG-CLEAR-FOUND                                02220057
022300                 MOVE XST00008-UNT-RTL-AMT                        02230057
022400                                            TO HV-UNT-RTL-AMT     02240057
022500                 MOVE XST00008-GP-RTL-QTY                         02250057
022600                                            TO HV-GP-RTL-QTY      02260057
022700                 MOVE XST00008-GP-RTL-AMT                         02270057
022800                                            TO HV-GP-RTL-AMT      02280057
022900                 MOVE XST00008-LOC-SKU-STAT-CDE                   02290057
023000                                            TO HV-LOC-SKU-STAT-CDE02300057
023100                 MOVE XST00008-UNT-RTL-CHG-DTE                    02310057
023200                                            TO HV-UNT-RTL-CHG-DTE 02320057
023300                 MOVE XST00008-UPC-STAT-CHG-DTE                   02330057
023400                                            TO HV-UPC-STAT-CHG-DTE02340057
023500             END-IF                                               02350057
023600         END-IF                                                   02360057
023700     END-IF.                                                      02370057
023800                                                                  02380057
023900     IF PS-NO-ERROR-FOUND                                         02390057
024000         PERFORM 2200-CHECK-FOR-FUT-PERM-CHGS                     02400057
024100     END-IF.                                                      02410057
024200                                                                  02420057
024300     IF PS-NO-ERROR-FOUND                                         02430057
024400         PERFORM 8000-POPULATE-BASE-BRM-LINKAGE                   02440057
024500         IF HV-LOC-SKU-STAT-CDE = '30'                            02450057
024600             IF XS047-INCLD-GOLDSTAR-SW = 'Y'                     02460057
024700                 PERFORM 2300-CHECK-CLEARANCE                     02470057
024800             END-IF                                               02480057
024900         ELSE                                                     02490057
025000             PERFORM 2400-GET-PROMO-PRICING                       02500057
025100         END-IF                                                   02510057
025200     END-IF.                                                      02520057
025300                                                                  02530057
025400******************************************************************02540057
025500* NEED TO CHECK REGIONAL CLEARANCE                                02550057
025600******************************************************************02560057
025700 2100-CHECK-FOR-REG-CLEAR.                                        02570057
025800                                                                  02580057
025900     EXEC SQL                                                     02590057
026000          SELECT L.UNT_RTL_AMT                                    02600057
026100               , L.LOC_SKU_STAT_CDE                               02610057
026200               , L.GP_RTL_QTY                                     02620057
026300               , L.GP_RTL_AMT                                     02630057
026400               , L.UNT_RTL_CHG_DTE                                02640057
026500               , L.UPC_STAT_CHG_DTE                               02650057
026600            INTO :XST00008-UNT-RTL-AMT                            02660057
026700               , :XST00008-LOC-SKU-STAT-CDE                       02670057
026800               , :XST00008-GP-RTL-QTY                             02680057
026900                 :PV-GP-RTL-QTY-NULL-IND                          02690057
027000               , :XST00008-GP-RTL-AMT                             02700057
027100                 :PV-GP-RTL-AMT-NULL-IND                          02710057
027200               , :XST00008-UNT-RTL-CHG-DTE                        02720057
027300               , :XST00008-UPC-STAT-CHG-DTE                       02730057
027400            FROM XST_SKU_LOC L                                    02740057
027500           WHERE L.LOC_NBR      = :PV-STR                         02750057
027600             AND L.INTR_UPC_ID  = :XST00008-INTR-UPC-ID           02760057
027700             AND L.BEG_TMST    <= :PV-FULL-TMST                   02770057
027800             AND (L.END_TMST   >= :PV-FULL-TMST                   02780057
027900                 OR L.END_TMST IS NULL)                           02790057
028000            WITH UR                                               02800057
028100     END-EXEC.                                                    02810057
028200                                                                  02820057
028300     EVALUATE TRUE                                                02830057
028400         WHEN SQLCODE = +0                                        02840057
028500             SET PS-REG-CLEAR-FOUND TO TRUE                       02850057
028600             IF PV-GP-RTL-QTY-NULL-IND < 0                        02860057
028700                 MOVE ZEROES  TO XST00008-GP-RTL-QTY              02870057
028710             END-IF                                               02871057
028720             IF PV-GP-RTL-AMT-NULL-IND < 0                        02872057
028730                 MOVE ZEROES  TO XST00008-GP-RTL-AMT              02873057
028731             END-IF                                               02873157
028732                                                                  02873257
028733         WHEN SQLCODE = +100                                      02873357
028734             SET PS-REG-CLEAR-NOT-FOUND TO TRUE                   02873457
028735                                                                  02873557
028736         WHEN OTHER                                               02873657
028737             MOVE '2100-CHECK-FOR-REG-CLEAR '                     02873757
028738                              TO XS047-ERROR-SECTION-NAME         02873857
028739             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             02873957
028740             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    02874057
028741             PERFORM 9000-DISPLAY-ERRORS                          02874157
028742     END-EVALUATE.                                                02874257
028743                                                                  02874357
028744******************************************************************02874457
028745* CHECK FOR FUTURE RETAIL, GRP PRICE, AND STATUS CHANGES          02874557
028746******************************************************************02874657
028747 2200-CHECK-FOR-FUT-PERM-CHGS.                                    02874757
028748                                                                  02874857
           SET PS-NO-PRICE-CHG-APPLIED           TO TRUE.               02874975
                                                                        02875075
      *    DETERMINE TICKET COLOR BEFORE CHECKING FUTURE PRICE CHANGE   02875175
028749     PERFORM 2240-DET-ITEM-TKT-COLOR.                             02875257
028750                                                                  02875357
           PERFORM 2220-SELECT-FUT-PERM-EVNT.                           02875480
                                                                        02876575
           IF PS-FUT-PERM-EVNT-FOUND AND                                02883077
              PS-NO-ERROR-FOUND                                         02883177
               EVALUATE XST00063-EVNT-CTG-CDE                           02883275
                   WHEN 'ACT'                                           02883375
                       EVALUATE XST00063-PRCHG-TYP-CDE                  02883475
                           WHEN 'MUA'                                   02883575
                           WHEN 'MDA'                                   02883675
                               IF PS-WHITE-TKT-ITEM                     02883775
                                   MOVE '20' TO PV-FUT-PERM-STATUS-CDE  02883875
                                   PERFORM 2260-DET-FUT-PERM-EVNT-CHGS  02883975
                               END-IF                                   02884075
                           WHEN 'CTA'                                   02884175
                               IF PS-YELLOW-TKT-ITEM OR                 02884275
                                  PS-RED-TKT-ITEM                       02884375
                                   MOVE '20' TO PV-FUT-PERM-STATUS-CDE  02884475
                                   PERFORM 2260-DET-FUT-PERM-EVNT-CHGS  02884575
                               END-IF                                   02884675
                       END-EVALUATE                                     02884775
                   WHEN 'CLR'                                           02884875
                       EVALUATE XST00063-PRCHG-TYP-CDE                  02884975
                           WHEN 'CLR'                                   02885075
                           WHEN 'RCP'                                   02885175
                           WHEN 'MK2'                                   02885291
                           WHEN 'FNL'                                   02885391
                               PERFORM 3200-PROCESS-CLR-PRICE-CHANGE    02885475
                       END-EVALUATE                                     02885575
               END-EVALUATE                                             02885675
           ELSE                                                         02885775
               IF (PS-YELLOW-TKT-ITEM OR PS-RED-TKT-ITEM) AND           02885879
                  PS-NO-ERROR-FOUND                                     02885979
                   PERFORM 2900-CHECK-FOR-FUT-CNTCLR                    02886279
                   IF PS-FUT-RED-EVNT-FOUND AND                         02886379
                      PS-NO-ERROR-FOUND                                 02886479
                       PERFORM 2250-CONTCLR-EDITS                       02886578
                       IF PS-VALID-FUT-TKT-EVNT                         02886675
                           PERFORM 2270-LOOK-FOR-RED-TKT-GRID           02886775
                           IF PS-NO-ERROR-FOUND AND                     02886889
                              PS-VALID-FUT-TKT-EVNT                     02886989
                               PERFORM 2265-DET-CNTCLR-EVNT-CHGS        02887077
                           END-IF                                       02887177
                       END-IF                                           02887277
                   END-IF                                               02887377
               END-IF                                                   02887477
           END-IF.                                                      02887577
028798                                                                  02887677
028856******************************************************************02889977
      * GET FUTURE WHITE AND YELLOW TICKET PERM EVENTS                  02890080
      * THESE EVENTS ARE INTERFACED TO THE SUBSCRIBING SYSTEMS AT A     02890180
      * SKU LEVEL.  IF THE INTERFACE EVER CHANGES, THIS PROGRAM WILL    02890280
      * NEED TO CHANGE.                                                 02890380
      * NOTE:  PV-HOST-VAR-DTE ADDED FOR PERFORMANCE TUNING.            02890480
      ******************************************************************02890580
       2220-SELECT-FUT-PERM-EVNT.                                       02890680
028858                                                                  02890777
028859     EXEC SQL                                                     02890880
092500        SELECT PRCHG.PRCHG_TYP_CDE                                02890980
092600             , STRGP.PRCHG_EFF_DTE                                02891080
092700             , MDSE.UNT_RTL_AMT                                   02891180
092800             , MDSE.GP_RTL_QTY                                    02891280
092900             , MDSE.GP_RTL_AMT                                    02891380
093300             , PRCHG.EVNT_CTG_CDE                                 02891480
                                                                        02891580
028861          INTO :XST00063-PRCHG-TYP-CDE                            02891680
028862             , :XST00064-PRCHG-EFF-DTE                            02891780
028863             , :XST00065-UNT-RTL-AMT                              02891880
028864               :PV-UNT-RTL-AMT-NULL-IND                           02891980
028866             , :XST00065-GP-RTL-QTY                               02892080
028867               :PV-GP-RTL-QTY-NULL-IND                            02892180
028868             , :XST00065-GP-RTL-AMT                               02892280
028869               :PV-GP-RTL-AMT-NULL-IND                            02892380
                   , :XST00063-EVNT-CTG-CDE                             02892480
                                                                        02892580
095500          FROM XST_STR_GP_PRCHG  STRGP                            02892680
095600             , XST_STR_GP_MBSHP  MBSHP                            02892780
095700             , XST_PRCHG_MDSE    MDSE                             02892880
095800             , XST_PRCHG         PRCHG                            02892980
095900                                                                  02893080
096000         WHERE STRGP.PRCHG_EFF_DTE <= :PV-DT                      02893180
096000           AND STRGP.PRCHG_EFF_DTE  > CURRENT DATE                02893292
096200                                                                  02893380
096300           AND MBSHP.STR_NBR          = :PV-STR                   02893480
096400           AND MBSHP.EFF_BEG_DTE     <= :PV-DT                    02893580
                 AND MBSHP.EFF_BEG_DTE      > :PV-HOST-VAR-DTE          02893680
096500           AND (MBSHP.EFF_END_DTE    >= :PV-DT                    02893780
096600                OR MBSHP.EFF_END_DTE IS NULL)                     02893880
096700                                                                  02893980
096800           AND MBSHP.STR_GP_TYP_CDE   = STRGP.STR_GP_TYP_CDE      02894080
096900           AND MBSHP.STR_GP_ID        = STRGP.STR_GP_ID           02894180
097000                                                                  02894280
097100           AND MDSE.STR_GP_TYP_CDE   = MBSHP.STR_GP_TYP_CDE       02894380
097200           AND MDSE.STR_GP_ID        = MBSHP.STR_GP_ID            02894480
                                                                        02894580
097300           AND MDSE.PRCHG_ID          > 0                         02894680
097300           AND STRGP.PRCHG_ID         = MDSE.PRCHG_ID             02894780
097500           AND PRCHG.PRCHG_ID         = STRGP.PRCHG_ID            02894880
097600                                                                  02894980
                 AND MDSE.MDSE_HIER_CDE     = 'SKU'                     02895080
                 AND MDSE.SKU_NBR           = :XST00010-SKU-NBR         02895180
098900                                                                  02895280
                 AND PRCHG.EVNT_CTG_CDE    IN ('ACT','CLR')             02895380
                 AND PRCHG.PRCHG_TYP_CDE   IN ('MUA','MDA','CTA',       02895480
                                               'CLR',                   02895591
                                               'RCP','MK2','FNL')       02895691
099300           AND PRCHG.PRCHG_ST_CDE     = 'APR'                     02895791
099000           AND PRCHG.LAST_ACTN_CDE   <> 'D'                       02895891
099100           AND STRGP.LAST_ACTN_CDE   <> 'D'                       02895991
099200           AND MDSE.LAST_ACTN_CDE    <> 'D'                       02896091
104600         WITH UR                                                  02896191
104700     END-EXEC.                                                    02896291
028924                                                                  02896963
028925     EVALUATE TRUE                                                02897063
028926         WHEN SQLCODE = ZERO                                      02897163
                   SET PS-FUT-PERM-EVNT-FOUND TO TRUE                   02897275
                   IF PV-UNT-RTL-AMT-NULL-IND < 0                       02897375
                       MOVE ZEROES  TO XST00065-UNT-RTL-AMT             02897475
                   END-IF                                               02897575
028927             IF PV-GP-RTL-QTY-NULL-IND < 0                        02897663
028928                 MOVE ZEROES  TO XST00065-GP-RTL-QTY              02897763
028930             END-IF                                               02898063
029000             IF PV-GP-RTL-AMT-NULL-IND < 0                        02900063
029007                 MOVE ZEROES  TO XST00065-GP-RTL-AMT              02900763
029008             END-IF                                               02900857
029017                                                                  02901767
029018         WHEN SQLCODE = +100                                      02901867
                   SET PS-FUT-PERM-EVNT-NOT-FOUND TO TRUE               02902080
029020                                                                  02902167
029021         WHEN OTHER                                               02902267
                   MOVE '2220-SELECT-FUT-PERM-EVNT  '                   02902680
029023                              TO XS047-ERROR-SECTION-NAME         02902967
029024             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             02903067
029025             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    02903167
029026             PERFORM 9000-DISPLAY-ERRORS                          02903267
029027     END-EVALUATE.                                                02903367
029028                                                                  02903467
029050******************************************************************02905667
029051* DETERMINE WHAT TICKET COLOR THE ITEM IS/WILL BE FOR THE EVENT.  02905767
029052******************************************************************02905867
029053 2240-DET-ITEM-TKT-COLOR.                                         02905967
029054                                                                  02906067
029055     IF HV-LOC-SKU-STAT-CDE = '30'                                02906167
029056       IF HV-UNT-RTL-CHG-DTE <= HV-UPC-STAT-CHG-DTE               02906267
029057         SET PS-YELLOW-TKT-ITEM TO TRUE                           02906367
029058       END-IF                                                     02906467
029059       IF HV-UNT-RTL-CHG-DTE > HV-UPC-STAT-CHG-DTE                02906567
029060         SET PS-RED-TKT-ITEM TO TRUE                              02906667
029061       END-IF                                                     02906767
029062     ELSE                                                         02906867
029063       SET PS-WHITE-TKT-ITEM TO TRUE                              02906967
029064     END-IF.                                                      02907067
029065                                                                  02907167
029066******************************************************************02907267
029067* DETERMINE IF THE ITEM QUALIFIES FOR THE CONTINUED CLEARANCE     02907380
029067* EVENT                                                           02907480
029068******************************************************************02907580
029069 2250-CONTCLR-EDITS.                                              02907680
029070                                                                  02907780
029071     SET PS-VALID-FUT-TKT-EVNT TO TRUE.                           02907880
029072                                                                  02907980
029097*** ONLY SKU'S WHICH ARE RED TICKET ON THE EVENT EFFECTIVE        02909767
029098*** DATE QUALIFY FOR THIS RED TICKET EVENT.                       02909867
           IF (PS-YELLOW-TKT-ITEM OR PS-YELLOW-TKT-APPLIED)             02910075
           AND XST00065-CLR-TYP-CDE = 'C'                               02910175
029100         SET PS-INVALID-FUT-TKT-EVNT TO TRUE                      02910275
029101     END-IF.                                                      02910375
029102                                                                  02910467
029103*** ONLY SKU'S WHICH ARE YELLOW TICKET ON THE EVENT EFFECTIVE     02910567
029104*** DATE QUALIFY FOR THIS RED TICKET EVENT.                       02910667
           IF PS-RED-TKT-ITEM AND XST00065-CLR-TYP-CDE = 'F'            02910778
               SET PS-INVALID-FUT-TKT-EVNT TO TRUE                      02910878
           END-IF.                                                      02910978
029108                                                                  02911067
029111******************************************************************02911367
029112* DETERMINE WHAT FUTURE PERM CHANGES WILL BE MADE.                02911467
029113******************************************************************02911567
029114 2260-DET-FUT-PERM-EVNT-CHGS.                                     02911667
029115                                                                  02911767
029116* THE FOLLOWING DATES NEED TO BE SET TO CORRECTLY                 02911875
029117* IDENTIFY GOLDSTAR BY TICKET COLOR                               02911967
029118                                                                  02912067
029119     IF XST00065-UNT-RTL-AMT = HV-UNT-RTL-AMT                     02912167
029120       CONTINUE                                                   02912267
029121     ELSE                                                         02912367
029122* THE FUTURE CHANGE IS RELATED TO UNIT RETAIL AMOUNT              02912467
029123       MOVE XST00064-PRCHG-EFF-DTE   TO HV-UNT-RTL-CHG-DTE        02912567
029124       MOVE XST00065-UNT-RTL-AMT     TO HV-UNT-RTL-AMT            02912667
029125     END-IF.                                                      02912767
029126                                                                  02912867
029127     IF XST00065-GP-RTL-QTY = HV-GP-RTL-QTY                       02912967
029128       CONTINUE                                                   02913067
029129     ELSE                                                         02913167
029130* THE FUTURE CHANGE IS RELATED TO GROUP RETAIL QTY                02913267
029131       MOVE XST00064-PRCHG-EFF-DTE TO HV-UNT-RTL-CHG-DTE          02913367
029132       MOVE XST00065-GP-RTL-QTY    TO HV-GP-RTL-QTY               02913467
029133     END-IF.                                                      02913567
029134                                                                  02913667
029135     IF XST00065-GP-RTL-AMT = HV-GP-RTL-AMT                       02913767
029136       CONTINUE                                                   02913867
029137     ELSE                                                         02913967
029138* THE FUTURE CHANGE IS RELATED TO GROUP RETAIL AMT                02914067
029139       MOVE XST00064-PRCHG-EFF-DTE TO HV-UNT-RTL-CHG-DTE          02914167
029140       MOVE XST00065-GP-RTL-AMT    TO HV-GP-RTL-AMT               02914267
029141     END-IF.                                                      02914367
029142                                                                  02914467
029143     IF PV-FUT-PERM-STATUS-CDE = HV-LOC-SKU-STAT-CDE              02914567
             EVALUATE XST00063-PRCHG-TYP-CDE                            02914691
                 WHEN 'MK2'                                             02914791
                 WHEN 'FNL'                                             02914891
      * THE STATUS CHANGE DATE NEEDS TO BE UPDATED IN ORDER TO HAVE     02914991
      * THE TICKET COLOR TO STILL APPEAR YELLOW (YELLOW TO YELLOW)      02915091
                   MOVE XST00064-PRCHG-EFF-DTE TO HV-UPC-STAT-CHG-DTE   02915191
             END-EVALUATE                                               02915291
029145     ELSE                                                         02915467
029146* THE FUTURE CHANGE IS RELATED TO STATUS                          02915567
029147       MOVE XST00064-PRCHG-EFF-DTE TO HV-UPC-STAT-CHG-DTE         02915667
029148       MOVE PV-FUT-PERM-STATUS-CDE TO HV-LOC-SKU-STAT-CDE         02915767
029149     END-IF.                                                      02915867
029150                                                                  02915967
      ******************************************************************02916075
      * DETERMINE WHAT FUTURE CONTINUE CLEARANCE CHANGES WILL BE MADE   02916175
      ******************************************************************02916275
       2265-DET-CNTCLR-EVNT-CHGS.                                       02916375
                                                                        02916475
      * THE FOLLOWING DATES NEED TO BE SET TO CORRECTLY                 02916575
      * IDENTIFY GOLDSTAR BY TICKET COLOR                               02916675
                                                                        02916775
           IF XST00085-NEW-UNT-RTL-AMT = HV-UNT-RTL-AMT                 02916875
               CONTINUE                                                 02916975
           ELSE                                                         02917075
      * THE FUTURE CHANGE IS RELATED TO UNIT RETAIL AMOUNT              02917175
               MOVE PV-CONTCLR-PRCHG-EFF-DTE                            02917275
                                           TO HV-UNT-RTL-CHG-DTE        02917375
               MOVE XST00085-NEW-UNT-RTL-AMT                            02917475
                                           TO HV-UNT-RTL-AMT            02917575
           END-IF.                                                      02917675
                                                                        02917775
029151******************************************************************02917868
029152* GET THE RED TICKET PRICE                                        02917968
029153******************************************************************02918068
029154 2270-LOOK-FOR-RED-TKT-GRID.                                      02918168
029155                                                                  02918268
029156     PERFORM 2271-OPN-RED-TKT-GRID-CSR.                           02918368
029157                                                                  02918468
029158     PERFORM 2272-FETCH-RED-TKT-GRID-CSR.                         02918568
029159                                                                  02918668
029160     PERFORM 2273-CLS-RED-TKT-GRID-CSR.                           02918768
029161                                                                  02918868
029162******************************************************************02918968
029163* OPEN RED TICKET GRID TABLE CURSOR.                              02919068
029164******************************************************************02919168
029165 2271-OPN-RED-TKT-GRID-CSR.                                       02919268
029166                                                                  02919368
029167     EXEC SQL                                                     02919468
029168       OPEN RED-TKT-GRID-CSR                                      02919568
029169     END-EXEC.                                                    02919668
029174                                                                  02919768
029175     EVALUATE TRUE                                                02919868
029176       WHEN SQLCODE = +0                                          02919971
029177         CONTINUE                                                 02920068
029178                                                                  02920168
029179       WHEN OTHER                                                 02920268
029180         MOVE '2271-OPN-RED-TKT-GRID-CSR'                         02920368
029181                          TO XS047-ERROR-SECTION-NAME             02920468
029182         MOVE SQLCODE     TO XS047-ERROR-SQL-CODE                 02920568
029183         MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND        02920669
029184         PERFORM 9000-DISPLAY-ERRORS                              02920768
029185     END-EVALUATE.                                                02920868
029186                                                                  02920968
029187******************************************************************02921068
029188* GET RED TICKET GRID TABLE RECORDS.                              02921168
029189******************************************************************02921268
029190 2272-FETCH-RED-TKT-GRID-CSR.                                     02921368
029191                                                                  02921468
029192     EXEC SQL                                                     02921568
029200       FETCH RED-TKT-GRID-CSR                                     02921668
029201        INTO :XST00085-NEW-UNT-RTL-AMT                            02921775
029204     END-EXEC.                                                    02921868
029205                                                                  02921968
029208     EVALUATE TRUE                                                02922068
029209         WHEN SQLCODE = +0                                        02922171
                 SET PS-VALID-FUT-TKT-EVNT     TO TRUE                  02922289
                                                                        02922389
               WHEN SQLCODE = +100                                      02922489
                 SET PS-INVALID-FUT-TKT-EVNT   TO TRUE                  02922589
029214                                                                  02922668
029223         WHEN OTHER                                               02922768
029224           MOVE '2272-FETCH-RED-TKT-GRID-CSR'                     02922868
029225                            TO XS047-ERROR-SECTION-NAME           02922968
029226           MOVE SQLCODE     TO XS047-ERROR-SQL-CODE               02923068
029227           MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND      02923169
029228           PERFORM 9000-DISPLAY-ERRORS                            02923268
029229     END-EVALUATE.                                                02923368
029230                                                                  02923468
029231******************************************************************02923568
029232* CLOSE RED TICKET GRID TABLE CURSOR.                             02923668
029233******************************************************************02923768
029234 2273-CLS-RED-TKT-GRID-CSR.                                       02923868
029235                                                                  02923968
029236     EXEC SQL                                                     02924068
029237       CLOSE RED-TKT-GRID-CSR                                     02924168
029238     END-EXEC.                                                    02924268
029239                                                                  02924368
029240     EVALUATE TRUE                                                02924468
029241       WHEN SQLCODE = +0                                          02924571
029242         CONTINUE                                                 02924668
029243                                                                  02924768
029244       WHEN OTHER                                                 02924868
029245         MOVE '2273-CLS-RED-TKT-GRID-CSR'                         02924968
029246                          TO XS047-ERROR-SECTION-NAME             02925068
029247         MOVE SQLCODE     TO XS047-ERROR-SQL-CODE                 02925168
029248         MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND        02925269
029249         PERFORM 9000-DISPLAY-ERRORS                              02925368
029250     END-EVALUATE.                                                02925468
029251                                                                  02925568
029252******************************************************************02925667
029253* NEED TO CHECK CLEARANCE CURSORS                                 02925767
029254******************************************************************02925867
029255 2300-CHECK-CLEARANCE.                                            02925967
029256                                                                  02926067
029257     IF XS047-PROMO-ID = 0                                        02926167
029258         SET PS-HIER-SKU-CDE    TO TRUE                           02926267
029259         PERFORM 2310-GET-SKU-CLR-NOID                            02926367
029260                                                                  02926467
029261         IF PS-NO-ERROR-FOUND                                     02926567
029262             SET PS-HIER-STY-CDE    TO TRUE                       02926657
029270             PERFORM 2320-GET-STY-CLR-NOID                        02927057
029300         END-IF                                                   02930057
029400                                                                  02940057
029500         IF PS-NO-ERROR-FOUND                                     02950057
029600             SET PS-HIER-SCL-CDE    TO TRUE                       02960057
029700             PERFORM 2330-GET-SCL-CLR-NOID                        02970057
029800         END-IF                                                   02980057
029900                                                                  02990057
030000         IF PS-NO-ERROR-FOUND                                     03000057
030100             SET PS-HIER-MCL-CDE    TO TRUE                       03010057
030200             PERFORM 2340-GET-MCL-CLR-NOID                        03020057
030300         END-IF                                                   03030057
030400                                                                  03040057
030500         IF PS-NO-ERROR-FOUND                                     03050057
030600             SET PS-HIER-DPT-CDE    TO TRUE                       03060057
030700             PERFORM 2350-GET-DPT-CLR-NOID                        03070057
030800         END-IF                                                   03080057
030900     ELSE                                                         03090057
031000         SET PS-HIER-SKU-CDE    TO TRUE                           03100057
031100         PERFORM 2360-GET-SKU-CLR-WID                             03110057
031200                                                                  03120057
031300         IF PS-NO-ERROR-FOUND                                     03130057
031400             SET PS-HIER-STY-CDE    TO TRUE                       03140057
031500             PERFORM 2370-GET-STY-CLR-WID                         03150057
031600         END-IF                                                   03160057
031700                                                                  03170057
031800         IF PS-NO-ERROR-FOUND                                     03180057
031900             SET PS-HIER-SCL-CDE    TO TRUE                       03190057
032000             PERFORM 2380-GET-SCL-CLR-WID                         03200057
032100         END-IF                                                   03210057
032200                                                                  03220057
032300         IF PS-NO-ERROR-FOUND                                     03230057
032400             SET PS-HIER-MCL-CDE    TO TRUE                       03240057
032500             PERFORM 2390-GET-MCL-CLR-WID                         03250057
032600         END-IF                                                   03260057
032700                                                                  03270057
032800         IF PS-NO-ERROR-FOUND                                     03280057
032900             SET PS-HIER-DPT-CDE    TO TRUE                       03290057
033000             PERFORM 2395-GET-DPT-CLR-WID                         03300057
033100         END-IF                                                   03310057
033200     END-IF.                                                      03320057
033300                                                                  03330057
033400******************************************************************03340057
033500* CHECK SKU LEVEL CLEARANCE W/NO PROMO-ID                         03350057
033600******************************************************************03360057
033700 2310-GET-SKU-CLR-NOID.                                           03370057
033800                                                                  03380057
033900     SET PS-NOT-END-OF-CSR    TO TRUE.                            03390057
034000     PERFORM 2311-OPN-SKU-CLR-NOID-CSR.                           03400057
034100     IF PS-NO-ERROR-FOUND                                         03410057
034200         PERFORM 2313-FET-SKU-CLR-NOID-CSR                        03420057
034300     END-IF.                                                      03430057
034400     PERFORM 2312-PROCESS-SKU-CLR-NOID-CSR                        03440057
034500         UNTIL PS-END-OF-CSR                                      03450057
034600            OR PS-ERROR-FOUND.                                    03460057
034700     PERFORM 2314-CLS-SKU-CLR-NOID-CSR.                           03470057
034800                                                                  03480057
034900******************************************************************03490057
035000* OPEN CLEARANCE PRICE - PRICED AT SKU LEVEL W/NO PROMO ID        03500057
035100******************************************************************03510057
035200 2311-OPN-SKU-CLR-NOID-CSR.                                       03520057
035300                                                                  03530057
035400     EXEC SQL                                                     03540057
035500          OPEN SKU-CLR-NOID-CSR                                   03550057
035600     END-EXEC.                                                    03560057
035700                                                                  03570057
035800     EVALUATE TRUE                                                03580057
035900         WHEN SQLCODE = ZERO                                      03590057
036000             CONTINUE                                             03600057
036100                                                                  03610057
036200         WHEN OTHER                                               03620057
036300             MOVE '2311-OPN-SKU-CLR-NOID-CSR'                     03630057
036400                              TO XS047-ERROR-SECTION-NAME         03640057
036500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             03650057
036600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    03660057
036700             PERFORM 9000-DISPLAY-ERRORS                          03670057
036800     END-EVALUATE.                                                03680057
036900                                                                  03690057
037000******************************************************************03700057
037100* PROCESS SKU LEVEL CLEARENCE PRICE W/NO PROMO-ID                 03710057
037200******************************************************************03720057
037300 2312-PROCESS-SKU-CLR-NOID-CSR.                                   03730057
037400                                                                  03740057
037500     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        03750057
037600     PERFORM 2313-FET-SKU-CLR-NOID-CSR.                           03760057
037700                                                                  03770057
037800******************************************************************03780057
037900* GET CLEARANCE PRICE - PRICED AT SKU LEVEL W/NO PROMO ID         03790057
038000******************************************************************03800057
038100 2313-FET-SKU-CLR-NOID-CSR.                                       03810057
038200                                                                  03820057
038300     EXEC SQL                                                     03830057
038400          FETCH SKU-CLR-NOID-CSR                                  03840057
038500           INTO :XST00028-PROMO-INTFC-ID                          03850057
038600              , :XST00028-MDSE-LNE-ID                             03860057
038700              , :XST00028-PRICG-TYP-CDE                           03870057
038800              , :XST00028-ADV-CDE                                 03880057
038900                :PV-ADV-CDE-NULL-IND                              03890057
039000              , :XST00028-PROMO-ID                                03900057
039100              , :XST00028-TKT-CLOR-CDE                            03910057
039200     END-EXEC.                                                    03920057
039300                                                                  03930057
039400     EVALUATE TRUE                                                03940057
039500         WHEN SQLCODE = ZERO                                      03950057
039600             IF PV-ADV-CDE-NULL-IND < 0                           03960057
039700                 MOVE SPACES  TO XST00028-ADV-CDE                 03970057
039800             END-IF                                               03980057
039900                                                                  03990057
040000         WHEN SQLCODE = +100                                      04000057
040100             SET PS-END-OF-CSR TO TRUE                            04010057
040200                                                                  04020057
040300         WHEN OTHER                                               04030057
040400             MOVE '2313-FET-SKU-CLR-NOID-CSR'                     04040057
040500                              TO XS047-ERROR-SECTION-NAME         04050057
040600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             04060057
040700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    04070057
040800             PERFORM 9000-DISPLAY-ERRORS                          04080057
040900     END-EVALUATE.                                                04090057
041000                                                                  04100057
041100******************************************************************04110057
041200* CLOSE CLEARANCE PRICE - PRICED AT SKU LEVEL W/NO PROMO ID       04120057
041300******************************************************************04130057
041400 2314-CLS-SKU-CLR-NOID-CSR.                                       04140057
041500                                                                  04150057
041600     EXEC SQL                                                     04160057
041700          CLOSE SKU-CLR-NOID-CSR                                  04170057
041800     END-EXEC.                                                    04180057
041900                                                                  04190057
042000     EVALUATE TRUE                                                04200057
042100         WHEN SQLCODE = ZERO                                      04210057
042200             CONTINUE                                             04220057
042300                                                                  04230057
042400         WHEN OTHER                                               04240057
042500             MOVE '2314-CLS-SKU-CLR-NOID-CSR'                     04250057
042600                              TO XS047-ERROR-SECTION-NAME         04260057
042700             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             04270057
042800             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    04280057
042900             PERFORM 9000-DISPLAY-ERRORS                          04290057
043000     END-EVALUATE.                                                04300057
043100                                                                  04310057
043200******************************************************************04320057
043300* CHECK STYLE LEVEL CLEARANCE W/NO PROMO-ID                       04330057
043400******************************************************************04340057
043500 2320-GET-STY-CLR-NOID.                                           04350057
043600                                                                  04360057
043700     SET PS-NOT-END-OF-CSR    TO TRUE.                            04370057
043800     PERFORM 2321-OPN-STY-CLR-NOID-CSR.                           04380057
043900     IF PS-NO-ERROR-FOUND                                         04390057
044000         PERFORM 2323-FET-STY-CLR-NOID-CSR                        04400057
044100     END-IF.                                                      04410057
044200     PERFORM 2322-PROCESS-STY-CLR-NOID-CSR                        04420057
044300         UNTIL PS-END-OF-CSR                                      04430057
044400            OR PS-ERROR-FOUND.                                    04440057
044500     PERFORM 2324-CLS-STY-CLR-NOID-CSR.                           04450057
044600                                                                  04460057
044700******************************************************************04470057
044800* OPEN CLEARANCE PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID      04480057
044900******************************************************************04490057
045000 2321-OPN-STY-CLR-NOID-CSR.                                       04500057
045100                                                                  04510057
045200     EXEC SQL                                                     04520057
045300          OPEN STY-CLR-NOID-CSR                                   04530057
045400     END-EXEC.                                                    04540057
045500                                                                  04550057
045600     EVALUATE TRUE                                                04560057
045700         WHEN SQLCODE = ZERO                                      04570057
045800             CONTINUE                                             04580057
045900                                                                  04590057
046000         WHEN OTHER                                               04600057
046100             MOVE '2321-OPN-STY-CLR-NO-ID-CSR'                    04610057
046200                              TO XS047-ERROR-SECTION-NAME         04620057
046300             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             04630057
046400             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    04640057
046500             PERFORM 9000-DISPLAY-ERRORS                          04650057
046600     END-EVALUATE.                                                04660057
046700                                                                  04670057
046800******************************************************************04680057
046900* PROCESS STY LEVEL CLEARENCE PRICE W/NO PROMO-ID                 04690057
047000******************************************************************04700057
047100 2322-PROCESS-STY-CLR-NOID-CSR.                                   04710057
047200                                                                  04720057
047300     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        04730057
047400     PERFORM 2323-FET-STY-CLR-NOID-CSR.                           04740057
047500                                                                  04750057
047600******************************************************************04760057
047700* GET CLEARANCE PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID       04770057
047800******************************************************************04780057
047900 2323-FET-STY-CLR-NOID-CSR.                                       04790057
048000                                                                  04800057
048100     EXEC SQL                                                     04810057
048200          FETCH STY-CLR-NOID-CSR                                  04820057
048300           INTO :XST00028-PROMO-INTFC-ID                          04830057
048400              , :XST00028-MDSE-LNE-ID                             04840057
048500              , :XST00028-PRICG-TYP-CDE                           04850057
048600              , :XST00028-ADV-CDE                                 04860057
048700                :PV-ADV-CDE-NULL-IND                              04870057
048800              , :XST00028-PROMO-ID                                04880057
048900              , :XST00028-TKT-CLOR-CDE                            04890057
049000     END-EXEC.                                                    04900057
049100                                                                  04910057
049200     EVALUATE TRUE                                                04920057
049300         WHEN SQLCODE = ZERO                                      04930057
049400             IF PV-ADV-CDE-NULL-IND < 0                           04940057
049500                 MOVE SPACES  TO XST00028-ADV-CDE                 04950057
049600             END-IF                                               04960057
049700                                                                  04970057
049800         WHEN SQLCODE = +100                                      04980057
049900             SET PS-END-OF-CSR TO TRUE                            04990057
050000                                                                  05000057
050100         WHEN OTHER                                               05010057
050200             MOVE '2323-FET-STY-CLR-NOID-CSR'                     05020057
050300                              TO XS047-ERROR-SECTION-NAME         05030057
050400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             05040057
050500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    05050057
050600             PERFORM 9000-DISPLAY-ERRORS                          05060057
050700     END-EVALUATE.                                                05070057
050800                                                                  05080057
050900******************************************************************05090057
051000* CLOSE CLEARANCE PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID     05100057
051100******************************************************************05110057
051200 2324-CLS-STY-CLR-NOID-CSR.                                       05120057
051300                                                                  05130057
051400     EXEC SQL                                                     05140057
051500          CLOSE STY-CLR-NOID-CSR                                  05150057
051600     END-EXEC.                                                    05160057
051700                                                                  05170057
051800     EVALUATE TRUE                                                05180057
051900         WHEN SQLCODE = ZERO                                      05190057
052000             CONTINUE                                             05200057
052100                                                                  05210057
052200         WHEN OTHER                                               05220057
052300             MOVE '2324-CLS-STY-CLR-NOID-CSR'                     05230057
052400                              TO XS047-ERROR-SECTION-NAME         05240057
052500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             05250057
052600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    05260057
052700             PERFORM 9000-DISPLAY-ERRORS                          05270057
052800     END-EVALUATE.                                                05280057
052900                                                                  05290057
053000******************************************************************05300057
053100* CHECK SUB CLASS LEVEL CLEARANCE W/NO PROMO-ID                   05310057
053200******************************************************************05320057
053300 2330-GET-SCL-CLR-NOID.                                           05330057
053400                                                                  05340057
053500     SET PS-NOT-END-OF-CSR    TO TRUE.                            05350057
053600     PERFORM 2331-OPN-SCL-CLR-NOID-CSR.                           05360057
053700     IF PS-NO-ERROR-FOUND                                         05370057
053800         PERFORM 2333-FET-SCL-CLR-NOID-CSR                        05380057
053900     END-IF.                                                      05390057
054000     PERFORM 2332-PROCESS-SCL-CLR-NOID-CSR                        05400057
054100        UNTIL PS-END-OF-CSR                                       05410057
054200           OR PS-ERROR-FOUND.                                     05420057
054300     PERFORM 2334-CLS-SCL-CLR-NOID-CSR.                           05430057
054400                                                                  05440057
054500******************************************************************05450057
054600* OPEN CLEARANCE PRICE - PRICED AT SCL LEVEL W/NO PROMO ID        05460057
054700******************************************************************05470057
054800 2331-OPN-SCL-CLR-NOID-CSR.                                       05480057
054900                                                                  05490057
055000     EXEC SQL                                                     05500057
055100          OPEN SCL-CLR-NOID-CSR                                   05510057
055200     END-EXEC.                                                    05520057
055300                                                                  05530057
055400     EVALUATE TRUE                                                05540057
055500         WHEN SQLCODE = ZERO                                      05550057
055600             CONTINUE                                             05560057
055700                                                                  05570057
055800         WHEN OTHER                                               05580057
055900             MOVE '2331-OPN-SCL-CLR-NOID-CSR'                     05590057
056000                              TO XS047-ERROR-SECTION-NAME         05600057
056100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             05610057
056200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    05620057
056300             PERFORM 9000-DISPLAY-ERRORS                          05630057
056400     END-EVALUATE.                                                05640057
056500                                                                  05650057
056600******************************************************************05660057
056700* PROCESS SCL LEVEL CLEARENCE PRICE W/NO PROMO-ID                 05670057
056800******************************************************************05680057
056900 2332-PROCESS-SCL-CLR-NOID-CSR.                                   05690057
057000                                                                  05700057
057100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        05710057
057200     PERFORM 2333-FET-SCL-CLR-NOID-CSR.                           05720057
057300                                                                  05730057
057400******************************************************************05740057
057500* GET CLEARANCE PRICE - PRICED AT SCL LEVEL W/NO PROMO ID         05750057
057600******************************************************************05760057
057700 2333-FET-SCL-CLR-NOID-CSR.                                       05770057
057800                                                                  05780057
057900     EXEC SQL                                                     05790057
058000          FETCH SCL-CLR-NOID-CSR                                  05800057
058100           INTO :XST00028-PROMO-INTFC-ID                          05810057
058200              , :XST00028-MDSE-LNE-ID                             05820057
058300              , :XST00028-PRICG-TYP-CDE                           05830057
058400              , :XST00028-ADV-CDE                                 05840057
058500                :PV-ADV-CDE-NULL-IND                              05850057
058600              , :XST00028-PROMO-ID                                05860057
058700              , :XST00028-TKT-CLOR-CDE                            05870057
058800              , :XST00013-MAJ-CL-NBR                              05880057
058900              , :XST00013-SUB-CL-NBR                              05890057
059000     END-EXEC.                                                    05900057
059100                                                                  05910057
059200     EVALUATE TRUE                                                05920057
059300         WHEN SQLCODE = ZERO                                      05930057
059400             IF PV-ADV-CDE-NULL-IND < 0                           05940057
059500                 MOVE SPACES  TO XST00028-ADV-CDE                 05950057
059600             END-IF                                               05960057
059700                                                                  05970057
059800         WHEN SQLCODE = +100                                      05980057
059900             SET PS-END-OF-CSR TO TRUE                            05990057
060000                                                                  06000057
060100         WHEN OTHER                                               06010057
060200             MOVE '2333-FET-SCL-CLR-NOID-CSR'                     06020057
060300                              TO XS047-ERROR-SECTION-NAME         06030057
060400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             06040057
060500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    06050057
060600             PERFORM 9000-DISPLAY-ERRORS                          06060057
060700     END-EVALUATE.                                                06070057
060800                                                                  06080057
060900******************************************************************06090057
061000* CLOSE CLEARANCE PRICE - PRICED AT SCL LEVEL W/NO PROMO ID       06100057
061100******************************************************************06110057
061200 2334-CLS-SCL-CLR-NOID-CSR.                                       06120057
061300                                                                  06130057
061400     EXEC SQL                                                     06140057
061500          CLOSE SCL-CLR-NOID-CSR                                  06150057
061600     END-EXEC.                                                    06160057
061700                                                                  06170057
061800     EVALUATE TRUE                                                06180057
061900         WHEN SQLCODE = ZERO                                      06190057
062000             CONTINUE                                             06200057
062100                                                                  06210057
062200         WHEN OTHER                                               06220057
062300             MOVE '2334-CLS-SCL-CLR-NOID-CSR'                     06230057
062400                              TO XS047-ERROR-SECTION-NAME         06240057
062500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             06250057
062600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    06260057
062700             PERFORM 9000-DISPLAY-ERRORS                          06270057
062800     END-EVALUATE.                                                06280057
062900                                                                  06290057
063000******************************************************************06300057
063100* CHECK MAJ CLASS LEVEL CLEARANCE W/NO PROMO-ID                   06310057
063200******************************************************************06320057
063300 2340-GET-MCL-CLR-NOID.                                           06330057
063400                                                                  06340057
063500     SET PS-NOT-END-OF-CSR    TO TRUE.                            06350057
063600     PERFORM 2341-OPN-MCL-CLR-NOID-CSR.                           06360057
063700     IF PS-NO-ERROR-FOUND                                         06370057
063800         PERFORM 2343-FET-MCL-CLR-NOID-CSR                        06380057
063900     END-IF.                                                      06390057
064000     PERFORM 2342-PROCESS-MCL-CLR-NOID-CSR                        06400057
064100        UNTIL PS-END-OF-CSR                                       06410057
064200           OR PS-ERROR-FOUND.                                     06420057
064300     PERFORM 2344-CLS-MCL-CLR-NOID-CSR.                           06430057
064400                                                                  06440057
064500******************************************************************06450057
064600* OPEN CLEARANCE PRICE - PRICED AT MCL LEVEL W/NO PROMO ID        06460057
064700******************************************************************06470057
064800 2341-OPN-MCL-CLR-NOID-CSR.                                       06480057
064900                                                                  06490057
065000     EXEC SQL                                                     06500057
065100          OPEN MCL-CLR-NOID-CSR                                   06510057
065200     END-EXEC.                                                    06520057
065300                                                                  06530057
065400     EVALUATE TRUE                                                06540057
065500         WHEN SQLCODE = ZERO                                      06550057
065600             CONTINUE                                             06560057
065700                                                                  06570057
065800         WHEN OTHER                                               06580057
065900             MOVE '2341-OPN-MCL-CLR-NOID-CSR'                     06590057
066000                              TO XS047-ERROR-SECTION-NAME         06600057
066100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             06610057
066200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    06620057
066300             PERFORM 9000-DISPLAY-ERRORS                          06630057
066400     END-EVALUATE.                                                06640057
066500                                                                  06650057
066600******************************************************************06660057
066700* PROCESS MCL LEVEL CLEARENCE PRICE W/NO PROMO-ID                 06670057
066800******************************************************************06680057
066900 2342-PROCESS-MCL-CLR-NOID-CSR.                                   06690057
067000                                                                  06700057
067100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        06710057
067200     PERFORM 2343-FET-MCL-CLR-NOID-CSR.                           06720057
067300                                                                  06730057
067400******************************************************************06740057
067500* GET CLEARANCE PRICE - PRICED AT MCL LEVEL W/NO PROMO ID         06750057
067600******************************************************************06760057
067700 2343-FET-MCL-CLR-NOID-CSR.                                       06770057
067800                                                                  06780057
067900     EXEC SQL                                                     06790057
068000          FETCH MCL-CLR-NOID-CSR                                  06800057
068100           INTO :XST00028-PROMO-INTFC-ID                          06810057
068200              , :XST00028-MDSE-LNE-ID                             06820057
068300              , :XST00028-PRICG-TYP-CDE                           06830057
068400              , :XST00028-ADV-CDE                                 06840057
068500                :PV-ADV-CDE-NULL-IND                              06850057
068600              , :XST00028-PROMO-ID                                06860057
068700              , :XST00028-TKT-CLOR-CDE                            06870057
068800              , :XST00013-MAJ-CL-NBR                              06880057
068900              , :XST00013-SUB-CL-NBR                              06890057
069000     END-EXEC.                                                    06900057
069100                                                                  06910057
069200     EVALUATE TRUE                                                06920057
069300         WHEN SQLCODE = ZERO                                      06930057
069400             IF PV-ADV-CDE-NULL-IND < 0                           06940057
069500                 MOVE SPACES  TO XST00028-ADV-CDE                 06950057
069600             END-IF                                               06960057
069700                                                                  06970057
069800         WHEN SQLCODE = +100                                      06980057
069900             SET PS-END-OF-CSR TO TRUE                            06990057
070000                                                                  07000057
070100         WHEN OTHER                                               07010057
070200             MOVE '2343-FET-MCL-CLR-NOID-CSR'                     07020057
070300                              TO XS047-ERROR-SECTION-NAME         07030057
070400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             07040057
070500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    07050057
070600             PERFORM 9000-DISPLAY-ERRORS                          07060057
070700     END-EVALUATE.                                                07070057
070800                                                                  07080057
070900******************************************************************07090057
071000* CLOSE CLEARANCE PRICE - PRICED AT MCL LEVEL W/NO PROMO ID       07100057
071100******************************************************************07110057
071200 2344-CLS-MCL-CLR-NOID-CSR.                                       07120057
071300                                                                  07130057
071400     EXEC SQL                                                     07140057
071500          CLOSE MCL-CLR-NOID-CSR                                  07150057
071600     END-EXEC.                                                    07160057
071700                                                                  07170057
071800     EVALUATE TRUE                                                07180057
071900         WHEN SQLCODE = ZERO                                      07190057
072000             CONTINUE                                             07200057
072100                                                                  07210057
072200         WHEN OTHER                                               07220057
072300             MOVE '2344-CLS-MCL-CLR-NOID-CSR'                     07230057
072400                              TO XS047-ERROR-SECTION-NAME         07240057
072500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             07250057
072600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    07260057
072700             PERFORM 9000-DISPLAY-ERRORS                          07270057
072800     END-EVALUATE.                                                07280057
072900                                                                  07290057
073000******************************************************************07300057
073100* CHECK DEPT LEVEL CLEARANCE W/NO PROMO-ID                        07310057
073200******************************************************************07320057
073300 2350-GET-DPT-CLR-NOID.                                           07330057
073400                                                                  07340057
073500     SET PS-NOT-END-OF-CSR    TO TRUE.                            07350057
073600     PERFORM 2351-OPN-DPT-CLR-NOID-CSR.                           07360057
073700     IF PS-NO-ERROR-FOUND                                         07370057
073800         PERFORM 2353-FET-DPT-CLR-NOID-CSR                        07380057
073900     END-IF.                                                      07390057
074000     PERFORM 2352-PROCESS-DPT-CLR-NOID-CSR                        07400057
074100        UNTIL PS-END-OF-CSR                                       07410057
074200           OR PS-ERROR-FOUND.                                     07420057
074300     PERFORM 2354-CLS-DPT-CLR-NOID-CSR.                           07430057
074400                                                                  07440057
074500******************************************************************07450057
074600* OPEN CLEARANCE PRICE - PRICED AT DPT LEVEL W/NO PROMO ID        07460057
074700******************************************************************07470057
074800 2351-OPN-DPT-CLR-NOID-CSR.                                       07480057
074900                                                                  07490057
075000     EXEC SQL                                                     07500057
075100          OPEN DPT-CLR-NOID-CSR                                   07510057
075200     END-EXEC.                                                    07520057
075300                                                                  07530057
075400     EVALUATE TRUE                                                07540057
075500         WHEN SQLCODE = ZERO                                      07550057
075600             CONTINUE                                             07560057
075700                                                                  07570057
075800         WHEN OTHER                                               07580057
075900             MOVE '2351-OPN-DPT-CLR-NOID-CSR'                     07590057
076000                              TO XS047-ERROR-SECTION-NAME         07600057
076100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             07610057
076200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    07620057
076300             PERFORM 9000-DISPLAY-ERRORS                          07630057
076400     END-EVALUATE.                                                07640057
076500                                                                  07650057
076600******************************************************************07660057
076700* PROCESS DPT LEVEL CLEARENCE PRICE W/NO PROMO-ID                 07670057
076800******************************************************************07680057
076900 2352-PROCESS-DPT-CLR-NOID-CSR.                                   07690057
077000                                                                  07700057
077100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        07710057
077200     PERFORM 2353-FET-DPT-CLR-NOID-CSR.                           07720057
077300                                                                  07730057
077400******************************************************************07740057
077500* GET CLEARANCE PRICE - PRICED AT DPT LEVEL W/NO PROMO ID         07750057
077600******************************************************************07760057
077700 2353-FET-DPT-CLR-NOID-CSR.                                       07770057
077800                                                                  07780057
077900     EXEC SQL                                                     07790057
078000          FETCH DPT-CLR-NOID-CSR                                  07800057
078100           INTO :XST00028-PROMO-INTFC-ID                          07810057
078200              , :XST00028-MDSE-LNE-ID                             07820057
078300              , :XST00028-PRICG-TYP-CDE                           07830057
078400              , :XST00028-ADV-CDE                                 07840057
078500                :PV-ADV-CDE-NULL-IND                              07850057
078600              , :XST00028-PROMO-ID                                07860057
078700              , :XST00028-TKT-CLOR-CDE                            07870057
078800              , :XST00013-MAJ-CL-NBR                              07880057
078900              , :XST00013-SUB-CL-NBR                              07890057
079000     END-EXEC.                                                    07900057
079100                                                                  07910057
079200     EVALUATE TRUE                                                07920057
079300         WHEN SQLCODE = ZERO                                      07930057
079400             IF PV-ADV-CDE-NULL-IND < 0                           07940057
079500                 MOVE SPACES  TO XST00028-ADV-CDE                 07950057
079600             END-IF                                               07960057
079700                                                                  07970057
079800         WHEN SQLCODE = +100                                      07980057
079900             SET PS-END-OF-CSR TO TRUE                            07990057
080000                                                                  08000057
080100         WHEN OTHER                                               08010057
080200             MOVE '2353-FET-DPT-CLR-NOID-CSR'                     08020057
080300                              TO XS047-ERROR-SECTION-NAME         08030057
080400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             08040057
080500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    08050057
080600             PERFORM 9000-DISPLAY-ERRORS                          08060057
080700     END-EVALUATE.                                                08070057
080800                                                                  08080057
080900******************************************************************08090057
081000* CLOSE CLEARANCE PRICE - PRICED AT DPT LEVEL W/NO PROMO ID       08100057
081100******************************************************************08110057
081200 2354-CLS-DPT-CLR-NOID-CSR.                                       08120057
081300                                                                  08130057
081400     EXEC SQL                                                     08140057
081500          CLOSE DPT-CLR-NOID-CSR                                  08150057
081600     END-EXEC.                                                    08160057
081700                                                                  08170057
081800     EVALUATE TRUE                                                08180057
081900         WHEN SQLCODE = ZERO                                      08190057
082000             CONTINUE                                             08200057
082100                                                                  08210057
082200         WHEN OTHER                                               08220057
082300             MOVE '2354-CLS-DPT-CLR-NOID-CSR'                     08230057
082400                              TO XS047-ERROR-SECTION-NAME         08240057
082500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             08250057
082600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    08260057
082700             PERFORM 9000-DISPLAY-ERRORS                          08270057
082800     END-EVALUATE.                                                08280057
082900                                                                  08290057
083000******************************************************************08300057
083100* CHECK SKU LEVEL CLEARANCE W/ PROMO-ID                           08310057
083200******************************************************************08320057
083300 2360-GET-SKU-CLR-WID.                                            08330057
083400                                                                  08340057
083500     SET PS-NOT-END-OF-CSR    TO TRUE.                            08350057
083600     PERFORM 2361-OPN-SKU-CLR-WID-CSR.                            08360057
083700     IF PS-NO-ERROR-FOUND                                         08370057
083800         PERFORM 2363-FET-SKU-CLR-WID-CSR                         08380057
083900     END-IF.                                                      08390057
084000     PERFORM 2362-PROCESS-SKU-CLR-WID-CSR                         08400057
084100        UNTIL PS-END-OF-CSR                                       08410057
084200           OR PS-ERROR-FOUND.                                     08420057
084300     PERFORM 2364-CLS-SKU-CLR-WID-CSR.                            08430057
084400                                                                  08440057
084500******************************************************************08450057
084600* OPEN CLEARANCE PRICE - PRICED AT SKU LEVEL W/ PROMO ID          08460057
084700******************************************************************08470057
084800 2361-OPN-SKU-CLR-WID-CSR.                                        08480057
084900                                                                  08490057
085000     EXEC SQL                                                     08500057
085100          OPEN SKU-CLR-WID-CSR                                    08510057
085200     END-EXEC.                                                    08520057
085300                                                                  08530057
085400     EVALUATE TRUE                                                08540057
085500         WHEN SQLCODE = ZERO                                      08550057
085600             CONTINUE                                             08560057
085700                                                                  08570057
085800         WHEN OTHER                                               08580057
085900             MOVE '2361-OPN-SKU-CLR-WID-CSR'                      08590057
086000                              TO XS047-ERROR-SECTION-NAME         08600057
086100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             08610057
086200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    08620057
086300             PERFORM 9000-DISPLAY-ERRORS                          08630057
086400     END-EVALUATE.                                                08640057
086500                                                                  08650057
086600******************************************************************08660057
086700* PROCESS SKU LEVEL CLEARENCE PRICE W/NO PROMO-ID                 08670057
086800******************************************************************08680057
086900 2362-PROCESS-SKU-CLR-WID-CSR.                                    08690057
087000                                                                  08700057
087100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        08710057
087200     PERFORM 2363-FET-SKU-CLR-WID-CSR.                            08720057
087300                                                                  08730057
087400******************************************************************08740057
087500* GET CLEARANCE PRICE - PRICED AT SKU LEVEL W/ PROMO ID           08750057
087600******************************************************************08760057
087700 2363-FET-SKU-CLR-WID-CSR.                                        08770057
087800                                                                  08780057
087900     EXEC SQL                                                     08790057
088000          FETCH SKU-CLR-WID-CSR                                   08800057
088100           INTO :XST00028-PROMO-INTFC-ID                          08810057
088200              , :XST00028-MDSE-LNE-ID                             08820057
088300              , :XST00028-PRICG-TYP-CDE                           08830057
088400              , :XST00028-ADV-CDE                                 08840057
088500                :PV-ADV-CDE-NULL-IND                              08850057
088600              , :XST00028-PROMO-ID                                08860057
088700              , :XST00028-TKT-CLOR-CDE                            08870057
088800     END-EXEC.                                                    08880057
088900                                                                  08890057
089000     EVALUATE TRUE                                                08900057
089100         WHEN SQLCODE = ZERO                                      08910057
089200             IF PV-ADV-CDE-NULL-IND < 0                           08920057
089300                 MOVE SPACES  TO XST00028-ADV-CDE                 08930057
089400             END-IF                                               08940057
089500                                                                  08950057
089600         WHEN SQLCODE = +100                                      08960057
089700             SET PS-END-OF-CSR TO TRUE                            08970057
089800                                                                  08980057
089900         WHEN OTHER                                               08990057
090000             MOVE '2363-FET-SKU-CLR-WID-CSR'                      09000057
090100                              TO XS047-ERROR-SECTION-NAME         09010057
090200             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             09020057
090300             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    09030057
090400             PERFORM 9000-DISPLAY-ERRORS                          09040057
090500     END-EVALUATE.                                                09050057
090600                                                                  09060057
090700******************************************************************09070057
090800* CLOSE CLEARANCE PRICE - PRICED AT SKU LEVEL W/ PROMO ID         09080057
090900******************************************************************09090057
091000 2364-CLS-SKU-CLR-WID-CSR.                                        09100057
091100                                                                  09110057
091200     EXEC SQL                                                     09120057
091300          CLOSE SKU-CLR-WID-CSR                                   09130057
091400     END-EXEC.                                                    09140057
091500                                                                  09150057
091600     EVALUATE TRUE                                                09160057
091700         WHEN SQLCODE = ZERO                                      09170057
091800             CONTINUE                                             09180057
091900                                                                  09190057
092000         WHEN OTHER                                               09200057
092100             MOVE '2364-CLS-SKU-CLR-WID-CSR'                      09210057
092200                              TO XS047-ERROR-SECTION-NAME         09220057
092300             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             09230057
092400             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    09240057
092500             PERFORM 9000-DISPLAY-ERRORS                          09250057
092600     END-EVALUATE.                                                09260057
092700                                                                  09270057
092800******************************************************************09280057
092900* CHECK STYLE LEVEL CLEARANCE W/ PROMO-ID                         09290057
093000******************************************************************09300057
093100 2370-GET-STY-CLR-WID.                                            09310057
093200                                                                  09320057
093300     SET PS-NOT-END-OF-CSR    TO TRUE.                            09330057
093400     PERFORM 2371-OPN-STY-CLR-WID-CSR.                            09340057
093500     IF PS-NO-ERROR-FOUND                                         09350057
093600         PERFORM 2373-FET-STY-CLR-WID-CSR                         09360057
093700     END-IF.                                                      09370057
093800     PERFORM 2372-PROCESS-STY-CLR-WID-CSR                         09380057
093900        UNTIL PS-END-OF-CSR                                       09390057
094000           OR PS-ERROR-FOUND.                                     09400057
094100     PERFORM 2374-CLS-STY-CLR-WID-CSR.                            09410057
094200                                                                  09420057
094300******************************************************************09430057
094400* OPEN CLEARANCE PRICE - PRICED AT STYLE LEVEL W/ PROMO ID        09440057
094500******************************************************************09450057
094600 2371-OPN-STY-CLR-WID-CSR.                                        09460057
094700                                                                  09470057
094800     EXEC SQL                                                     09480057
094900          OPEN STY-CLR-WID-CSR                                    09490057
095000     END-EXEC.                                                    09500057
095100                                                                  09510057
095200     EVALUATE TRUE                                                09520057
095300         WHEN SQLCODE = ZERO                                      09530057
095400             CONTINUE                                             09540057
095500                                                                  09550057
095600         WHEN OTHER                                               09560057
095700             MOVE '2371-OPN-STY-CLR-WID-CSR'                      09570057
095800                              TO XS047-ERROR-SECTION-NAME         09580057
095900             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             09590057
096000             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    09600057
096100             PERFORM 9000-DISPLAY-ERRORS                          09610057
096200     END-EVALUATE.                                                09620057
096300                                                                  09630057
096400******************************************************************09640057
096500* PROCESS STY LEVEL CLEARENCE PRICE W/ PROMO-ID                   09650057
096600******************************************************************09660057
096700 2372-PROCESS-STY-CLR-WID-CSR.                                    09670057
096800                                                                  09680057
096900     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        09690057
097000     PERFORM 2373-FET-STY-CLR-WID-CSR.                            09700057
097100                                                                  09710057
097200******************************************************************09720057
097300* GET CLEARANCE PRICE - PRICED AT STYLE LEVEL W/ PROMO ID         09730057
097400******************************************************************09740057
097500 2373-FET-STY-CLR-WID-CSR.                                        09750057
097600                                                                  09760057
097700     EXEC SQL                                                     09770057
097800          FETCH STY-CLR-WID-CSR                                   09780057
097900           INTO :XST00028-PROMO-INTFC-ID                          09790057
098000              , :XST00028-MDSE-LNE-ID                             09800057
098100              , :XST00028-PRICG-TYP-CDE                           09810057
098200              , :XST00028-ADV-CDE                                 09820057
098300                :PV-ADV-CDE-NULL-IND                              09830057
098400              , :XST00028-PROMO-ID                                09840057
098500              , :XST00028-TKT-CLOR-CDE                            09850057
098600     END-EXEC.                                                    09860057
098700                                                                  09870057
098800     EVALUATE TRUE                                                09880057
098900         WHEN SQLCODE = ZERO                                      09890057
099000             IF PV-ADV-CDE-NULL-IND < 0                           09900057
099100                 MOVE SPACES  TO XST00028-ADV-CDE                 09910057
099200             END-IF                                               09920057
099300                                                                  09930057
099400         WHEN SQLCODE = +100                                      09940057
099500             SET PS-END-OF-CSR TO TRUE                            09950057
099600                                                                  09960057
099700         WHEN OTHER                                               09970057
099800             MOVE '2373-FET-STY-CLR-WID-CSR'                      09980057
099900                              TO XS047-ERROR-SECTION-NAME         09990057
100000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             10000057
100100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    10010057
100200             PERFORM 9000-DISPLAY-ERRORS                          10020057
100300     END-EVALUATE.                                                10030057
100400                                                                  10040057
100500******************************************************************10050057
100600* CLOSE CLEARANCE PRICE - PRICED AT STYLE LEVEL W/ PROMO ID       10060057
100700******************************************************************10070057
100800 2374-CLS-STY-CLR-WID-CSR.                                        10080057
100900                                                                  10090057
101000     EXEC SQL                                                     10100057
101100          CLOSE STY-CLR-WID-CSR                                   10110057
101200     END-EXEC.                                                    10120057
101300                                                                  10130057
101400     EVALUATE TRUE                                                10140057
101500         WHEN SQLCODE = ZERO                                      10150057
101600             CONTINUE                                             10160057
101700                                                                  10170057
101800         WHEN OTHER                                               10180057
101900             MOVE '2374-CLS-STY-CLR-WID-CSR'                      10190057
102000                              TO XS047-ERROR-SECTION-NAME         10200057
102100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             10210057
102200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    10220057
102300             PERFORM 9000-DISPLAY-ERRORS                          10230057
102400     END-EVALUATE.                                                10240057
102500                                                                  10250057
102600******************************************************************10260057
102700* CHECK SUB CLASS LEVEL CLEARANCE W/ PROMO-ID                     10270057
102800******************************************************************10280057
102900 2380-GET-SCL-CLR-WID.                                            10290057
103000                                                                  10300057
103100     SET PS-NOT-END-OF-CSR    TO TRUE.                            10310057
103200     PERFORM 2381-OPN-SCL-CLR-WID-CSR.                            10320057
103300     IF PS-NO-ERROR-FOUND                                         10330057
103400         PERFORM 2383-FET-SCL-CLR-WID-CSR                         10340057
103500     END-IF.                                                      10350057
103600     PERFORM 2382-PROCESS-SCL-CLR-WID-CSR                         10360057
103700        UNTIL PS-END-OF-CSR                                       10370057
103800           OR PS-ERROR-FOUND.                                     10380057
103900     PERFORM 2384-CLS-SCL-CLR-WID-CSR.                            10390057
104000                                                                  10400057
104100******************************************************************10410057
104200* OPEN CLEARANCE PRICE - PRICED AT SCL LEVEL W/ PROMO ID          10420057
104300******************************************************************10430057
104400 2381-OPN-SCL-CLR-WID-CSR.                                        10440057
104500                                                                  10450057
104600     EXEC SQL                                                     10460057
104700          OPEN SCL-CLR-WID-CSR                                    10470057
104800     END-EXEC.                                                    10480057
104900                                                                  10490057
105000     EVALUATE TRUE                                                10500057
105100         WHEN SQLCODE = ZERO                                      10510057
105200             CONTINUE                                             10520057
105300                                                                  10530057
105400         WHEN OTHER                                               10540057
105500             MOVE '2381-OPN-SCL-CLR-WID-CSR'                      10550057
105600                              TO XS047-ERROR-SECTION-NAME         10560057
105700             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             10570057
105800             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    10580057
105900             PERFORM 9000-DISPLAY-ERRORS                          10590057
106000     END-EVALUATE.                                                10600057
106100                                                                  10610057
106200******************************************************************10620057
106300* PROCESS SCL LEVEL CLEARENCE PRICE W/ PROMO-ID                   10630057
106400******************************************************************10640057
106500 2382-PROCESS-SCL-CLR-WID-CSR.                                    10650057
106600                                                                  10660057
106700     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        10670057
106800     PERFORM 2383-FET-SCL-CLR-WID-CSR.                            10680057
106900                                                                  10690057
107000******************************************************************10700057
107100* GET CLEARANCE PRICE - PRICED AT SCL LEVEL W/ PROMO ID           10710057
107200******************************************************************10720057
107300 2383-FET-SCL-CLR-WID-CSR.                                        10730057
107400                                                                  10740057
107500     EXEC SQL                                                     10750057
107600          FETCH SCL-CLR-WID-CSR                                   10760057
107700           INTO :XST00028-PROMO-INTFC-ID                          10770057
107800              , :XST00028-MDSE-LNE-ID                             10780057
107900              , :XST00028-PRICG-TYP-CDE                           10790057
108000              , :XST00028-ADV-CDE                                 10800057
108100                :PV-ADV-CDE-NULL-IND                              10810057
108200              , :XST00028-PROMO-ID                                10820057
108300              , :XST00028-TKT-CLOR-CDE                            10830057
108400              , :XST00013-MAJ-CL-NBR                              10840057
108500              , :XST00013-SUB-CL-NBR                              10850057
108600     END-EXEC.                                                    10860057
108700                                                                  10870057
108800     EVALUATE TRUE                                                10880057
108900         WHEN SQLCODE = ZERO                                      10890057
109000             IF PV-ADV-CDE-NULL-IND < 0                           10900057
109100                 MOVE SPACES  TO XST00028-ADV-CDE                 10910057
109200             END-IF                                               10920057
109300                                                                  10930057
109400         WHEN SQLCODE = +100                                      10940057
109500             SET PS-END-OF-CSR TO TRUE                            10950057
109600                                                                  10960057
109700         WHEN OTHER                                               10970057
109800             MOVE '2383-FET-SCL-CLR-WID-CSR'                      10980057
109900                              TO XS047-ERROR-SECTION-NAME         10990057
110000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             11000057
110100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    11010057
110200             PERFORM 9000-DISPLAY-ERRORS                          11020057
110300     END-EVALUATE.                                                11030057
110400                                                                  11040057
110500******************************************************************11050057
110600* CLOSE CLEARANCE PRICE - PRICED AT SCL LEVEL W/ PROMO ID         11060057
110700******************************************************************11070057
110800 2384-CLS-SCL-CLR-WID-CSR.                                        11080057
110900                                                                  11090057
111000     EXEC SQL                                                     11100057
111100          CLOSE SCL-CLR-WID-CSR                                   11110057
111200     END-EXEC.                                                    11120057
111300                                                                  11130057
111400     EVALUATE TRUE                                                11140057
111500         WHEN SQLCODE = ZERO                                      11150057
111600             CONTINUE                                             11160057
111700                                                                  11170057
111800         WHEN OTHER                                               11180057
111900             MOVE '2384-CLS-SCL-CLR-WID-CSR'                      11190057
112000                              TO XS047-ERROR-SECTION-NAME         11200057
112100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             11210057
112200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    11220057
112300             PERFORM 9000-DISPLAY-ERRORS                          11230057
112400     END-EVALUATE.                                                11240057
112500                                                                  11250057
112600******************************************************************11260057
112700* CHECK MAJ CLASS LEVEL CLEARANCE W/ PROMO-ID                     11270057
112800******************************************************************11280057
112900 2390-GET-MCL-CLR-WID.                                            11290057
113000                                                                  11300057
113100     SET PS-NOT-END-OF-CSR    TO TRUE.                            11310057
113200     PERFORM 2391-OPN-MCL-CLR-WID-CSR.                            11320057
113300     IF PS-NO-ERROR-FOUND                                         11330057
113400         PERFORM 2393-FET-MCL-CLR-WID-CSR                         11340057
113500     END-IF.                                                      11350057
113600     PERFORM 2392-PROCESS-MCL-CLR-WID-CSR                         11360057
113700        UNTIL PS-END-OF-CSR                                       11370057
113800           OR PS-ERROR-FOUND.                                     11380057
113900     PERFORM 2394-CLS-MCL-CLR-WID-CSR.                            11390057
114000                                                                  11400057
114100******************************************************************11410057
114200* OPEN CLEARANCE PRICE - PRICED AT MCL LEVEL W/ PROMO ID          11420057
114300******************************************************************11430057
114400 2391-OPN-MCL-CLR-WID-CSR.                                        11440057
114500                                                                  11450057
114600     EXEC SQL                                                     11460057
114700          OPEN MCL-CLR-WID-CSR                                    11470057
114800     END-EXEC.                                                    11480057
114900                                                                  11490057
115000     EVALUATE TRUE                                                11500057
115100         WHEN SQLCODE = ZERO                                      11510057
115200             CONTINUE                                             11520057
115300                                                                  11530057
115400         WHEN OTHER                                               11540057
115500             MOVE '2391-OPN-MCL-CLR-WID-CSR'                      11550057
115600                              TO XS047-ERROR-SECTION-NAME         11560057
115700             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             11570057
115800             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    11580057
115900             PERFORM 9000-DISPLAY-ERRORS                          11590057
116000     END-EVALUATE.                                                11600057
116100                                                                  11610057
116200******************************************************************11620057
116300* PROCESS MCL LEVEL CLEARENCE PRICE W/ PROMO-ID                   11630057
116400******************************************************************11640057
116500 2392-PROCESS-MCL-CLR-WID-CSR.                                    11650057
116600                                                                  11660057
116700     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        11670057
116800     PERFORM 2393-FET-MCL-CLR-WID-CSR.                            11680057
116900                                                                  11690057
117000******************************************************************11700057
117100* GET CLEARANCE PRICE - PRICED AT MCL LEVEL W/ PROMO ID           11710057
117200******************************************************************11720057
117300 2393-FET-MCL-CLR-WID-CSR.                                        11730057
117400                                                                  11740057
117500     EXEC SQL                                                     11750057
117600          FETCH MCL-CLR-WID-CSR                                   11760057
117700           INTO :XST00028-PROMO-INTFC-ID                          11770057
117800              , :XST00028-MDSE-LNE-ID                             11780057
117900              , :XST00028-PRICG-TYP-CDE                           11790057
118000              , :XST00028-TKT-CLOR-CDE                            11800057
118100              , :XST00013-MAJ-CL-NBR                              11810057
118200              , :XST00013-SUB-CL-NBR                              11820057
118300              , :XST00028-ADV-CDE                                 11830057
118400                :PV-ADV-CDE-NULL-IND                              11840057
118500              , :XST00028-PROMO-ID                                11850057
118600     END-EXEC.                                                    11860057
118700                                                                  11870057
118800     EVALUATE TRUE                                                11880057
118900         WHEN SQLCODE = ZERO                                      11890057
119000             IF PV-ADV-CDE-NULL-IND < 0                           11900057
119100                 MOVE SPACES  TO XST00028-ADV-CDE                 11910057
119200             END-IF                                               11920057
119300                                                                  11930057
119400         WHEN SQLCODE = +100                                      11940057
119500             SET PS-END-OF-CSR TO TRUE                            11950057
119600                                                                  11960057
119700         WHEN OTHER                                               11970057
119800             MOVE '2393-FET-MCL-CLR-WID-CSR'                      11980057
119900                              TO XS047-ERROR-SECTION-NAME         11990057
120000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             12000057
120100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    12010057
120200             PERFORM 9000-DISPLAY-ERRORS                          12020057
120300     END-EVALUATE.                                                12030057
120400                                                                  12040057
120500******************************************************************12050057
120600* CLOSE CLEARANCE PRICE - PRICED AT MCL LEVEL W/ PROMO ID         12060057
120700******************************************************************12070057
120800 2394-CLS-MCL-CLR-WID-CSR.                                        12080057
120900                                                                  12090057
121000     EXEC SQL                                                     12100057
121100          CLOSE MCL-CLR-WID-CSR                                   12110057
121200     END-EXEC.                                                    12120057
121300                                                                  12130057
121400     EVALUATE TRUE                                                12140057
121500         WHEN SQLCODE = ZERO                                      12150057
121600             CONTINUE                                             12160057
121700                                                                  12170057
121800         WHEN OTHER                                               12180057
121900             MOVE '2394-CLS-MCL-CLR-WID-CSR'                      12190057
122000                              TO XS047-ERROR-SECTION-NAME         12200057
122100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             12210057
122200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    12220057
122300             PERFORM 9000-DISPLAY-ERRORS                          12230057
122400     END-EVALUATE.                                                12240057
122500                                                                  12250057
122600******************************************************************12260057
122700* CHECK DPT LEVEL CLEARANCE W/ PROMO-ID                           12270057
122800******************************************************************12280057
122900 2395-GET-DPT-CLR-WID.                                            12290057
123000                                                                  12300057
123100     SET PS-NOT-END-OF-CSR    TO TRUE.                            12310057
123200     PERFORM 2396-OPN-DPT-CLR-WID-CSR.                            12320057
123300     IF PS-NO-ERROR-FOUND                                         12330057
123400         PERFORM 2398-FET-DPT-CLR-WID-CSR                         12340057
123500     END-IF.                                                      12350057
123600     PERFORM 2397-PROCESS-DPT-CLR-WID-CSR                         12360057
123700        UNTIL PS-END-OF-CSR                                       12370057
123800           OR PS-ERROR-FOUND.                                     12380057
123900     PERFORM 2399-CLS-DPT-CLR-WID-CSR.                            12390057
124000                                                                  12400057
124100******************************************************************12410057
124200* OPEN CLEARANCE PRICE - PRICED AT DPT LEVEL W/ PROMO ID          12420057
124300******************************************************************12430057
124400 2396-OPN-DPT-CLR-WID-CSR.                                        12440057
124500                                                                  12450057
124600     EXEC SQL                                                     12460057
124700          OPEN DPT-CLR-WID-CSR                                    12470057
124800     END-EXEC.                                                    12480057
124900                                                                  12490057
125000     EVALUATE TRUE                                                12500057
125100         WHEN SQLCODE = ZERO                                      12510057
125200             CONTINUE                                             12520057
125300                                                                  12530057
125400         WHEN OTHER                                               12540057
125500             MOVE '2396-OPN-DPT-CLR-WID-CSR'                      12550057
125600                              TO XS047-ERROR-SECTION-NAME         12560057
125700             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             12570057
125800             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    12580057
125900             PERFORM 9000-DISPLAY-ERRORS                          12590057
126000     END-EVALUATE.                                                12600057
126100                                                                  12610057
126200******************************************************************12620057
126300* PROCESS DPT LEVEL CLEARENCE PRICE W/ PROMO-ID                   12630057
126400******************************************************************12640057
126500 2397-PROCESS-DPT-CLR-WID-CSR.                                    12650057
126600                                                                  12660057
126700     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        12670057
126800     PERFORM 2398-FET-DPT-CLR-WID-CSR.                            12680057
126900                                                                  12690057
127000******************************************************************12700057
127100* GET CLEARANCE PRICE - PRICED AT DPT LEVEL W/ PROMO ID           12710057
127200******************************************************************12720057
127300 2398-FET-DPT-CLR-WID-CSR.                                        12730057
127400                                                                  12740057
127500     EXEC SQL                                                     12750057
127600          FETCH DPT-CLR-WID-CSR                                   12760057
127700           INTO :XST00028-PROMO-INTFC-ID                          12770057
127800              , :XST00028-MDSE-LNE-ID                             12780057
127900              , :XST00028-PRICG-TYP-CDE                           12790057
128000              , :XST00028-ADV-CDE                                 12800057
128100                :PV-ADV-CDE-NULL-IND                              12810057
128200              , :XST00028-PROMO-ID                                12820057
128300              , :XST00028-TKT-CLOR-CDE                            12830057
128400              , :XST00013-MAJ-CL-NBR                              12840057
128500              , :XST00013-SUB-CL-NBR                              12850057
128600     END-EXEC.                                                    12860057
128700                                                                  12870057
128800     EVALUATE TRUE                                                12880057
128900         WHEN SQLCODE = ZERO                                      12890057
129000             IF PV-ADV-CDE-NULL-IND < 0                           12900057
129100                 MOVE SPACES  TO XST00028-ADV-CDE                 12910057
129200             END-IF                                               12920057
129300                                                                  12930057
129400         WHEN SQLCODE = +100                                      12940057
129500             SET PS-END-OF-CSR TO TRUE                            12950057
129600                                                                  12960057
129700         WHEN OTHER                                               12970057
129800             MOVE '2398-FET-DPT-CLR-WID-CSR'                      12980057
129900                              TO XS047-ERROR-SECTION-NAME         12990057
130000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             13000057
130100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    13010057
130200             PERFORM 9000-DISPLAY-ERRORS                          13020057
130300     END-EVALUATE.                                                13030057
130400                                                                  13040057
130500******************************************************************13050057
130600* CLOSE CLEARANCE PRICE - PRICED AT DPT LEVEL W/ PROMO ID         13060057
130700******************************************************************13070057
130800 2399-CLS-DPT-CLR-WID-CSR.                                        13080057
130900                                                                  13090057
131000     EXEC SQL                                                     13100057
131100          CLOSE DPT-CLR-WID-CSR                                   13110057
131200     END-EXEC.                                                    13120057
131300                                                                  13130057
131400     EVALUATE TRUE                                                13140057
131500         WHEN SQLCODE = ZERO                                      13150057
131600             CONTINUE                                             13160057
131700                                                                  13170057
131800         WHEN OTHER                                               13180057
131900             MOVE '2399-CLS-DPT-CLR-WID-CSR'                      13190057
132000                              TO XS047-ERROR-SECTION-NAME         13200057
132100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             13210057
132200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    13220057
132300             PERFORM 9000-DISPLAY-ERRORS                          13230057
132400     END-EVALUATE.                                                13240057
132500                                                                  13250057
132600******************************************************************13260057
132700* NEED TO CHECK PROMO PRICING                                     13270057
132800******************************************************************13280057
132900 2400-GET-PROMO-PRICING.                                          13290057
133000                                                                  13300057
133100     IF XS047-PROMO-ID = 0                                        13310057
133200         SET PS-HIER-SKU-CDE    TO TRUE                           13320057
133300         PERFORM 2410-GET-SKU-PROMO-NOID                          13330057
133400                                                                  13340057
133500         IF PS-NO-ERROR-FOUND                                     13350057
133600             SET PS-HIER-STY-CDE    TO TRUE                       13360057
133700             PERFORM 2420-GET-STY-PROMO-NOID                      13370057
133800         END-IF                                                   13380057
133900                                                                  13390057
134000         IF PS-NO-ERROR-FOUND                                     13400057
134100             SET PS-HIER-SCL-CDE    TO TRUE                       13410057
134200             PERFORM 2430-GET-SCL-PROMO-NOID                      13420057
134300         END-IF                                                   13430057
134400                                                                  13440057
134500         IF PS-NO-ERROR-FOUND                                     13450057
134600             SET PS-HIER-MCL-CDE    TO TRUE                       13460057
134700             PERFORM 2440-GET-MCL-PROMO-NOID                      13470057
134800         END-IF                                                   13480057
134900                                                                  13490057
135000         IF PS-NO-ERROR-FOUND                                     13500057
135100             SET PS-HIER-DPT-CDE    TO TRUE                       13510057
135200             PERFORM 2450-GET-DPT-PROMO-NOID                      13520057
135300         END-IF                                                   13530057
135400     ELSE                                                         13540057
135500         SET PS-HIER-SKU-CDE    TO TRUE                           13550057
135600         PERFORM 2460-GET-SKU-PROMO-WID                           13560057
135700                                                                  13570057
135800         IF PS-NO-ERROR-FOUND                                     13580057
135900             SET PS-HIER-STY-CDE    TO TRUE                       13590057
136000             PERFORM 2470-GET-STY-PROMO-WID                       13600057
136100         END-IF                                                   13610057
136200                                                                  13620057
136300         IF PS-NO-ERROR-FOUND                                     13630057
136400             SET PS-HIER-SCL-CDE    TO TRUE                       13640057
136500             PERFORM 2480-GET-SCL-PROMO-WID                       13650057
136600         END-IF                                                   13660057
136700                                                                  13670057
136800         IF PS-NO-ERROR-FOUND                                     13680057
136900             SET PS-HIER-MCL-CDE    TO TRUE                       13690057
137000             PERFORM 2490-GET-MCL-PROMO-WID                       13700057
137100         END-IF                                                   13710057
137200                                                                  13720057
137300         IF PS-NO-ERROR-FOUND                                     13730057
137400             SET PS-HIER-DPT-CDE    TO TRUE                       13740057
137500             PERFORM 2495-GET-DPT-PROMO-WID                       13750057
137600         END-IF                                                   13760057
137700     END-IF.                                                      13770057
137800                                                                  13780057
137900******************************************************************13790057
138000* CHECK SKU LEVEL PROMO PRICE W/NO PROMO-ID                       13800057
138100******************************************************************13810057
138200 2410-GET-SKU-PROMO-NOID.                                         13820057
138300                                                                  13830057
138400     SET PS-NOT-END-OF-CSR    TO TRUE.                            13840057
138500     PERFORM 2411-OPN-SKU-PROMO-NOID-CSR.                         13850057
138600     IF PS-NO-ERROR-FOUND                                         13860057
138700         PERFORM 2413-FET-SKU-PROMO-NOID-CSR                      13870057
138800     END-IF.                                                      13880057
138900     PERFORM 2412-PROCESS-SKU-PROMO-NOID                          13890057
139000        UNTIL PS-END-OF-CSR                                       13900057
139100           OR PS-ERROR-FOUND.                                     13910057
139200     PERFORM 2414-CLS-SKU-PROMO-NOID-CSR.                         13920057
139300                                                                  13930057
139400******************************************************************13940057
139500* OPEN PROMO PRICE - PRICED AT SKU LEVEL W/NO PROMO ID            13950057
139600******************************************************************13960057
139700 2411-OPN-SKU-PROMO-NOID-CSR.                                     13970057
139800                                                                  13980057
139900     EXEC SQL                                                     13990057
140000          OPEN SKU-PROMO-NOID-CSR                                 14000057
140100     END-EXEC.                                                    14010057
140200                                                                  14020057
140300     EVALUATE TRUE                                                14030057
140400         WHEN SQLCODE = ZERO                                      14040057
140500             CONTINUE                                             14050057
140600                                                                  14060057
140700         WHEN OTHER                                               14070057
140800             MOVE '2411-OPN-SKU-PROMO-NOID-CSR'                   14080057
140900                              TO XS047-ERROR-SECTION-NAME         14090057
141000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             14100057
141100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    14110057
141200*            PERFORM 9000-DISPLAY-ERRORS                          14120057
141300     END-EVALUATE.                                                14130057
141400                                                                  14140057
141500******************************************************************14150057
141600* GET PROMO PRICE - PRICED AT SKU LEVEL W/NO PROMO ID             14160057
141700******************************************************************14170057
141800 2413-FET-SKU-PROMO-NOID-CSR.                                     14180057
141900                                                                  14190057
142000     EXEC SQL                                                     14200057
142100          FETCH SKU-PROMO-NOID-CSR                                14210057
142200           INTO :XST00028-PROMO-INTFC-ID                          14220057
142300              , :XST00028-MDSE-LNE-ID                             14230057
142400              , :XST00028-PRICG-TYP-CDE                           14240057
142500              , :XST00028-ADV-CDE                                 14250057
142600                :PV-ADV-CDE-NULL-IND                              14260057
142700              , :XST00028-PROMO-ID                                14270057
142800              , :XST00026-REG-PROMO-TYP-CDE                       14280057
142900     END-EXEC.                                                    14290057
143000                                                                  14300057
143100     EVALUATE TRUE                                                14310057
143200         WHEN SQLCODE = ZERO                                      14320057
143300             IF PV-ADV-CDE-NULL-IND < 0                           14330057
143400                 MOVE SPACES  TO XST00028-ADV-CDE                 14340057
143500             END-IF                                               14350057
143600                                                                  14360057
143700         WHEN SQLCODE = +100                                      14370057
143800             SET PS-END-OF-CSR TO TRUE                            14380057
143900                                                                  14390057
144000         WHEN OTHER                                               14400057
144100             MOVE '2413-FET-SKU-PROMO-NOID-CSR'                   14410057
144200                              TO XS047-ERROR-SECTION-NAME         14420057
144300             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             14430057
144400             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    14440057
144500             PERFORM 9000-DISPLAY-ERRORS                          14450057
144600     END-EVALUATE.                                                14460057
144700                                                                  14470057
144800******************************************************************14480057
144900* PROCESS SKU LEVEL PROMO PRICE W/NO PROMO-ID                     14490057
145000******************************************************************14500057
145100 2412-PROCESS-SKU-PROMO-NOID.                                     14510057
145200                                                                  14520057
145300     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        14530057
145400     PERFORM 2413-FET-SKU-PROMO-NOID-CSR.                         14540057
145500                                                                  14550057
145600******************************************************************14560057
145700* CLOSE PROMO PRICE - PRICED AT SKU LEVEL W/NO PROMO ID           14570057
145800******************************************************************14580057
145900 2414-CLS-SKU-PROMO-NOID-CSR.                                     14590057
146000                                                                  14600057
146100     EXEC SQL                                                     14610057
146200          CLOSE SKU-PROMO-NOID-CSR                                14620057
146300     END-EXEC.                                                    14630057
146400                                                                  14640057
146500     EVALUATE TRUE                                                14650057
146600         WHEN SQLCODE = ZERO                                      14660057
146700             CONTINUE                                             14670057
146800                                                                  14680057
146900         WHEN OTHER                                               14690057
147000             MOVE '2414-CLS-SKU-PROMO-NOID-CSR'                   14700057
147100                              TO XS047-ERROR-SECTION-NAME         14710057
147200             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             14720057
147300             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    14730057
147400             PERFORM 9000-DISPLAY-ERRORS                          14740057
147500     END-EVALUATE.                                                14750057
147600                                                                  14760057
147700******************************************************************14770057
147800* CHECK STYLE LEVEL PROMO PRICE W/NO PROMO-ID                     14780057
147900******************************************************************14790057
148000 2420-GET-STY-PROMO-NOID.                                         14800057
148100                                                                  14810057
148200     SET PS-NOT-END-OF-CSR    TO TRUE.                            14820057
148300     PERFORM 2421-OPN-STY-PROMO-NOID-CSR.                         14830057
148400     IF PS-NO-ERROR-FOUND                                         14840057
148500         PERFORM 2423-FET-STY-PROMO-NOID-CSR                      14850057
148600     END-IF.                                                      14860057
148700     PERFORM 2422-PROCESS-STY-PROMO-NOID                          14870057
148800        UNTIL PS-END-OF-CSR                                       14880057
148900           OR PS-ERROR-FOUND.                                     14890057
149000     PERFORM 2424-CLS-STY-PROMO-NOID-CSR.                         14900057
149100                                                                  14910057
149200******************************************************************14920057
149300* OPEN PROMO PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID          14930057
149400******************************************************************14940057
149500 2421-OPN-STY-PROMO-NOID-CSR.                                     14950057
149600                                                                  14960057
149700     EXEC SQL                                                     14970057
149800          OPEN STY-PROMO-NOID-CSR                                 14980057
149900     END-EXEC.                                                    14990057
150000                                                                  15000057
150100     EVALUATE TRUE                                                15010057
150200         WHEN SQLCODE = ZERO                                      15020057
150300             CONTINUE                                             15030057
150400                                                                  15040057
150500         WHEN OTHER                                               15050057
150600             MOVE '2421-OPN-STY-PROMO-NOID-CSR'                   15060057
150700                              TO XS047-ERROR-SECTION-NAME         15070057
150800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             15080057
150900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    15090057
151000             PERFORM 9000-DISPLAY-ERRORS                          15100057
151100     END-EVALUATE.                                                15110057
151200                                                                  15120057
151300******************************************************************15130057
151400* GET PROMO PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID           15140057
151500******************************************************************15150057
151600 2423-FET-STY-PROMO-NOID-CSR.                                     15160057
151700                                                                  15170057
151800     EXEC SQL                                                     15180057
151900          FETCH STY-PROMO-NOID-CSR                                15190057
152000           INTO :XST00028-PROMO-INTFC-ID                          15200057
152100              , :XST00028-MDSE-LNE-ID                             15210057
152200              , :XST00028-PRICG-TYP-CDE                           15220057
152300              , :XST00028-ADV-CDE                                 15230057
152400                :PV-ADV-CDE-NULL-IND                              15240057
152500              , :XST00028-PROMO-ID                                15250057
152600              , :XST00026-REG-PROMO-TYP-CDE                       15260057
152700     END-EXEC.                                                    15270057
152800                                                                  15280057
152900     EVALUATE TRUE                                                15290057
153000         WHEN SQLCODE = ZERO                                      15300057
153100             IF PV-ADV-CDE-NULL-IND < 0                           15310057
153200                 MOVE SPACES  TO XST00028-ADV-CDE                 15320057
153300             END-IF                                               15330057
153400                                                                  15340057
153500         WHEN SQLCODE = +100                                      15350057
153600             SET PS-END-OF-CSR TO TRUE                            15360057
153700                                                                  15370057
153800         WHEN OTHER                                               15380057
153900             MOVE '2423-FET-STY-PROMO-NOID-CSR'                   15390057
154000                              TO XS047-ERROR-SECTION-NAME         15400057
154100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             15410057
154200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    15420057
154300             PERFORM 9000-DISPLAY-ERRORS                          15430057
154400     END-EVALUATE.                                                15440057
154500                                                                  15450057
154600******************************************************************15460057
154700* PROCESS STY LEVEL PROMO PRICE W/NO PROMO-ID                     15470057
154800******************************************************************15480057
154900 2422-PROCESS-STY-PROMO-NOID.                                     15490057
155000                                                                  15500057
155100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        15510057
155200     PERFORM 2423-FET-STY-PROMO-NOID-CSR.                         15520057
155300                                                                  15530057
155400******************************************************************15540057
155500* CLOSE PROMO PRICE - PRICED AT STYLE LEVEL W/NO PROMO ID         15550057
155600******************************************************************15560057
155700 2424-CLS-STY-PROMO-NOID-CSR.                                     15570057
155800                                                                  15580057
155900     EXEC SQL                                                     15590057
156000          CLOSE STY-PROMO-NOID-CSR                                15600057
156100     END-EXEC.                                                    15610057
156200                                                                  15620057
156300     EVALUATE TRUE                                                15630057
156400         WHEN SQLCODE = ZERO                                      15640057
156500             CONTINUE                                             15650057
156600                                                                  15660057
156700         WHEN OTHER                                               15670057
156800             MOVE '2424-CLS-STY-PROMO-NOID-CSR'                   15680057
156900                              TO XS047-ERROR-SECTION-NAME         15690057
157000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             15700057
157100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    15710057
157200             PERFORM 9000-DISPLAY-ERRORS                          15720057
157300     END-EVALUATE.                                                15730057
157400                                                                  15740057
157500******************************************************************15750057
157600* CHECK SUB CLASS LEVEL PROMO PRICE W/NO PROMO-ID                 15760057
157700******************************************************************15770057
157800 2430-GET-SCL-PROMO-NOID.                                         15780057
157900                                                                  15790057
158000     SET PS-NOT-END-OF-CSR    TO TRUE.                            15800057
158100     PERFORM 2431-OPN-SCL-PROMO-NOID-CSR.                         15810057
158200     IF PS-NO-ERROR-FOUND                                         15820057
158300         PERFORM 2433-FET-SCL-PROMO-NOID-CSR                      15830057
158400     END-IF.                                                      15840057
158500     PERFORM 2432-PROCESS-SCL-PROMO-NOID                          15850057
158600        UNTIL PS-END-OF-CSR                                       15860057
158700           OR PS-ERROR-FOUND.                                     15870057
158800     PERFORM 2434-CLS-SCL-PROMO-NOID-CSR.                         15880057
158900                                                                  15890057
159000******************************************************************15900057
159100* OPEN PROMO PRICE - PRICED AT SCL LEVEL W/NO PROMO ID            15910057
159200******************************************************************15920057
159300 2431-OPN-SCL-PROMO-NOID-CSR.                                     15930057
159400                                                                  15940057
159500     EXEC SQL                                                     15950057
159600          OPEN SCL-PROMO-NOID-CSR                                 15960057
159700     END-EXEC.                                                    15970057
159800                                                                  15980057
159900     EVALUATE TRUE                                                15990057
160000         WHEN SQLCODE = ZERO                                      16000057
160100             CONTINUE                                             16010057
160200                                                                  16020057
160300         WHEN OTHER                                               16030057
160400             MOVE '2431-OPN-SCL-PROMO-NOID-CSR'                   16040057
160500                              TO XS047-ERROR-SECTION-NAME         16050057
160600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             16060057
160700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    16070057
160800             PERFORM 9000-DISPLAY-ERRORS                          16080057
160900     END-EVALUATE.                                                16090057
161000                                                                  16100057
161100******************************************************************16110057
161200* GET PROMO PRICE - PRICED AT SCL LEVEL W/NO PROMO ID             16120057
161300******************************************************************16130057
161400 2433-FET-SCL-PROMO-NOID-CSR.                                     16140057
161500                                                                  16150057
161600     EXEC SQL                                                     16160057
161700          FETCH SCL-PROMO-NOID-CSR                                16170057
161800           INTO :XST00028-PROMO-INTFC-ID                          16180057
161900              , :XST00028-MDSE-LNE-ID                             16190057
162000              , :XST00028-PRICG-TYP-CDE                           16200057
162100              , :XST00028-ADV-CDE                                 16210057
162200                :PV-ADV-CDE-NULL-IND                              16220057
162300              , :XST00028-PROMO-ID                                16230057
162400              , :XST00026-REG-PROMO-TYP-CDE                       16240057
162500              , :XST00013-MAJ-CL-NBR                              16250057
162600              , :XST00013-SUB-CL-NBR                              16260057
162700     END-EXEC.                                                    16270057
162800                                                                  16280057
162900     EVALUATE TRUE                                                16290057
163000         WHEN SQLCODE = ZERO                                      16300057
163100             IF PV-ADV-CDE-NULL-IND < 0                           16310057
163200                 MOVE SPACES  TO XST00028-ADV-CDE                 16320057
163300             END-IF                                               16330057
163400                                                                  16340057
163500         WHEN SQLCODE = +100                                      16350057
163600             SET PS-END-OF-CSR TO TRUE                            16360057
163700                                                                  16370057
163800         WHEN OTHER                                               16380057
163900             MOVE '2433-FET-SCL-PROMO-NOID-CSR'                   16390057
164000                              TO XS047-ERROR-SECTION-NAME         16400057
164100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             16410057
164200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    16420057
164300             PERFORM 9000-DISPLAY-ERRORS                          16430057
164400     END-EVALUATE.                                                16440057
164500                                                                  16450057
164600******************************************************************16460057
164700* PROCESS SCL LEVEL PROMO PRICE W/NO PROMO-ID                     16470057
164800******************************************************************16480057
164900 2432-PROCESS-SCL-PROMO-NOID.                                     16490057
165000                                                                  16500057
165100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        16510057
165200     PERFORM 2433-FET-SCL-PROMO-NOID-CSR.                         16520057
165300                                                                  16530057
165400******************************************************************16540057
165500* CLOSE PROMO PRICE - PRICED AT SCL LEVEL W/NO PROMO ID           16550057
165600******************************************************************16560057
165700 2434-CLS-SCL-PROMO-NOID-CSR.                                     16570057
165800                                                                  16580057
165900     EXEC SQL                                                     16590057
166000          CLOSE SCL-PROMO-NOID-CSR                                16600057
166100     END-EXEC.                                                    16610057
166200                                                                  16620057
166300     EVALUATE TRUE                                                16630057
166400         WHEN SQLCODE = ZERO                                      16640057
166500             CONTINUE                                             16650057
166600                                                                  16660057
166700         WHEN OTHER                                               16670057
166800             MOVE '2434-CLS-SCL-PROMO-NOID-CSR'                   16680057
166900                              TO XS047-ERROR-SECTION-NAME         16690057
167000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             16700057
167100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    16710057
167200             PERFORM 9000-DISPLAY-ERRORS                          16720057
167300     END-EVALUATE.                                                16730057
167400                                                                  16740057
167500******************************************************************16750057
167600* CHECK MAJ CLASS LEVEL PROMO PRICE W/NO PROMO-ID                 16760057
167700******************************************************************16770057
167800 2440-GET-MCL-PROMO-NOID.                                         16780057
167900                                                                  16790057
168000     SET PS-NOT-END-OF-CSR    TO TRUE.                            16800057
168100     PERFORM 2441-OPN-MCL-PROMO-NOID-CSR.                         16810057
168200     IF PS-NO-ERROR-FOUND                                         16820057
168300         PERFORM 2443-FET-MCL-PROMO-NOID-CSR                      16830057
168400     END-IF.                                                      16840057
168500     PERFORM 2442-PROCESS-MCL-PROMO-NOID                          16850057
168600         UNTIL PS-END-OF-CSR                                      16860057
168700            OR PS-ERROR-FOUND.                                    16870057
168800     PERFORM 2444-CLS-MCL-PROMO-NOID-CSR.                         16880057
168900                                                                  16890057
169000******************************************************************16900057
169100* OPEN PROMO PRICE - PRICED AT MCL LEVEL W/NO PROMO ID            16910057
169200******************************************************************16920057
169300 2441-OPN-MCL-PROMO-NOID-CSR.                                     16930057
169400                                                                  16940057
169500     EXEC SQL                                                     16950057
169600          OPEN MCL-PROMO-NOID-CSR                                 16960057
169700     END-EXEC.                                                    16970057
169800                                                                  16980057
169900     EVALUATE TRUE                                                16990057
170000         WHEN SQLCODE = ZERO                                      17000057
170100             CONTINUE                                             17010057
170200                                                                  17020057
170300         WHEN OTHER                                               17030057
170400             MOVE '2441-OPN-MCL-PROMO-NOID-CSR'                   17040057
170500                              TO XS047-ERROR-SECTION-NAME         17050057
170600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             17060057
170700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    17070057
170800             PERFORM 9000-DISPLAY-ERRORS                          17080057
170900     END-EVALUATE.                                                17090057
171000                                                                  17100057
171100******************************************************************17110057
171200* GET PROMO PRICE - PRICED AT MCL LEVEL W/NO PROMO ID             17120057
171300******************************************************************17130057
171400 2443-FET-MCL-PROMO-NOID-CSR.                                     17140057
171500                                                                  17150057
171600     EXEC SQL                                                     17160057
171700          FETCH MCL-PROMO-NOID-CSR                                17170057
171800           INTO :XST00028-PROMO-INTFC-ID                          17180057
171900              , :XST00028-MDSE-LNE-ID                             17190057
172000              , :XST00028-PRICG-TYP-CDE                           17200057
172100              , :XST00028-ADV-CDE                                 17210057
172200                :PV-ADV-CDE-NULL-IND                              17220057
172300              , :XST00028-PROMO-ID                                17230057
172400              , :XST00013-MAJ-CL-NBR                              17240057
172500              , :XST00013-SUB-CL-NBR                              17250057
172600              , :XST00026-REG-PROMO-TYP-CDE                       17260057
172700     END-EXEC.                                                    17270057
172800                                                                  17280057
172900     EVALUATE TRUE                                                17290057
173000         WHEN SQLCODE = ZERO                                      17300057
173100             IF PV-ADV-CDE-NULL-IND < 0                           17310057
173200                 MOVE SPACES  TO XST00028-ADV-CDE                 17320057
173300             END-IF                                               17330057
173400                                                                  17340057
173500         WHEN SQLCODE = +100                                      17350057
173600             SET PS-END-OF-CSR TO TRUE                            17360057
173700                                                                  17370057
173800         WHEN OTHER                                               17380057
173900             MOVE '2443-FET-MCL-PROMO-NOID-CSR'                   17390057
174000                              TO XS047-ERROR-SECTION-NAME         17400057
174100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             17410057
174200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    17420057
174300             PERFORM 9000-DISPLAY-ERRORS                          17430057
174400     END-EVALUATE.                                                17440057
174500                                                                  17450057
174600******************************************************************17460057
174700* PROCESS MCL LEVEL PROMO PRICE W/NO PROMO-ID                     17470057
174800******************************************************************17480057
174900 2442-PROCESS-MCL-PROMO-NOID.                                     17490057
175000                                                                  17500057
175100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        17510057
175200     PERFORM 2443-FET-MCL-PROMO-NOID-CSR.                         17520057
175300                                                                  17530057
175400******************************************************************17540057
175500* CLOSE PROMO PRICE - PRICED AT MCL LEVEL W/NO PROMO ID           17550057
175600******************************************************************17560057
175700 2444-CLS-MCL-PROMO-NOID-CSR.                                     17570057
175800                                                                  17580057
175900     EXEC SQL                                                     17590057
176000          CLOSE MCL-PROMO-NOID-CSR                                17600057
176100     END-EXEC.                                                    17610057
176200                                                                  17620057
176300     EVALUATE TRUE                                                17630057
176400         WHEN SQLCODE = ZERO                                      17640057
176500             CONTINUE                                             17650057
176600                                                                  17660057
176700         WHEN OTHER                                               17670057
176800             MOVE '2444-CLS-MCL-PROMO-NOID-CSR'                   17680057
176900                              TO XS047-ERROR-SECTION-NAME         17690057
177000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             17700057
177100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    17710057
177200             PERFORM 9000-DISPLAY-ERRORS                          17720057
177300     END-EVALUATE.                                                17730057
177400                                                                  17740057
177500******************************************************************17750057
177600* CHECK DEPT LEVEL PROMO PRICE W/NO PROMO-ID                      17760057
177700******************************************************************17770057
177800 2450-GET-DPT-PROMO-NOID.                                         17780057
177900                                                                  17790057
178000     SET PS-NOT-END-OF-CSR    TO TRUE.                            17800057
178100     PERFORM 2451-OPN-DPT-PROMO-NOID-CSR.                         17810057
178200     IF PS-NO-ERROR-FOUND                                         17820057
178300         PERFORM 2453-FET-DPT-PROMO-NOID-CSR                      17830057
178400     END-IF.                                                      17840057
178500     PERFORM 2452-PROCESS-DPT-PROMO-NOID                          17850057
178600         UNTIL PS-END-OF-CSR                                      17860057
178700            OR PS-ERROR-FOUND.                                    17870057
178800     PERFORM 2454-CLS-DPT-PROMO-NOID-CSR.                         17880057
178900                                                                  17890057
179000******************************************************************17900057
179100* OPEN PROMO PRICE - PRICED AT DPT LEVEL W/NO PROMO ID            17910057
179200******************************************************************17920057
179300 2451-OPN-DPT-PROMO-NOID-CSR.                                     17930057
179400                                                                  17940057
179500     EXEC SQL                                                     17950057
179600          OPEN DPT-PROMO-NOID-CSR                                 17960057
179700     END-EXEC.                                                    17970057
179800                                                                  17980057
179900     EVALUATE TRUE                                                17990057
180000         WHEN SQLCODE = ZERO                                      18000057
180100             CONTINUE                                             18010057
180200                                                                  18020057
180300         WHEN OTHER                                               18030057
180400             MOVE '2451-OPN-DPT-PROMO-NOID-CSR'                   18040057
180500                              TO XS047-ERROR-SECTION-NAME         18050057
180600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             18060057
180700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    18070057
180800             PERFORM 9000-DISPLAY-ERRORS                          18080057
180900     END-EVALUATE.                                                18090057
181000                                                                  18100057
181100******************************************************************18110057
181200* GET PROMO PRICE - PRICED AT DPT LEVEL W/NO PROMO ID             18120057
181300******************************************************************18130057
181400 2453-FET-DPT-PROMO-NOID-CSR.                                     18140057
181500                                                                  18150057
181600     EXEC SQL                                                     18160057
181700          FETCH DPT-PROMO-NOID-CSR                                18170057
181800           INTO :XST00028-PROMO-INTFC-ID                          18180057
181900              , :XST00028-MDSE-LNE-ID                             18190057
182000              , :XST00028-PRICG-TYP-CDE                           18200057
182100              , :XST00028-ADV-CDE                                 18210057
182200                :PV-ADV-CDE-NULL-IND                              18220057
182300              , :XST00028-PROMO-ID                                18230057
182400              , :XST00013-MAJ-CL-NBR                              18240057
182500              , :XST00013-SUB-CL-NBR                              18250057
182600              , :XST00026-REG-PROMO-TYP-CDE                       18260057
182700     END-EXEC.                                                    18270057
182800                                                                  18280057
182900     EVALUATE TRUE                                                18290057
183000         WHEN SQLCODE = ZERO                                      18300057
183100             IF PV-ADV-CDE-NULL-IND < 0                           18310057
183200                 MOVE SPACES  TO XST00028-ADV-CDE                 18320057
183300             END-IF                                               18330057
183400                                                                  18340057
183500         WHEN SQLCODE = +100                                      18350057
183600             SET PS-END-OF-CSR TO TRUE                            18360057
183700                                                                  18370057
183800         WHEN OTHER                                               18380057
183900             MOVE '2453-FET-DPT-PROMO-NOID-CSR'                   18390057
184000                              TO XS047-ERROR-SECTION-NAME         18400057
184100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             18410057
184200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    18420057
184300             PERFORM 9000-DISPLAY-ERRORS                          18430057
184400     END-EVALUATE.                                                18440057
184500                                                                  18450057
184600******************************************************************18460057
184700* PROCESS DPT LEVEL PROMO PRICE W/NO PROMO-ID                     18470057
184800******************************************************************18480057
184900 2452-PROCESS-DPT-PROMO-NOID.                                     18490057
185000                                                                  18500057
185100     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        18510057
185200     PERFORM 2453-FET-DPT-PROMO-NOID-CSR.                         18520057
185300                                                                  18530057
185400******************************************************************18540057
185500* CLOSE PROMO PRICE - PRICED AT DPT LEVEL W/NO PROMO ID           18550057
185600******************************************************************18560057
185700 2454-CLS-DPT-PROMO-NOID-CSR.                                     18570057
185800                                                                  18580057
185900     EXEC SQL                                                     18590057
186000          CLOSE DPT-PROMO-NOID-CSR                                18600057
186100     END-EXEC.                                                    18610057
186200                                                                  18620057
186300     EVALUATE TRUE                                                18630057
186400         WHEN SQLCODE = ZERO                                      18640057
186500             CONTINUE                                             18650057
186600                                                                  18660057
186700         WHEN OTHER                                               18670057
186800             MOVE '2454-CLS-DPT-PROMO-NOID-CSR'                   18680057
186900                              TO XS047-ERROR-SECTION-NAME         18690057
187000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             18700057
187100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    18710057
187200             PERFORM 9000-DISPLAY-ERRORS                          18720057
187300     END-EVALUATE.                                                18730057
187400                                                                  18740057
187500******************************************************************18750057
187600* CHECK SKU LEVEL PROMO PRICE W/ PROMO-ID                         18760057
187700******************************************************************18770057
187800 2460-GET-SKU-PROMO-WID.                                          18780057
187900                                                                  18790057
188000     SET PS-NOT-END-OF-CSR    TO TRUE.                            18800057
188100     PERFORM 2461-OPN-SKU-PROMO-WID-CSR.                          18810057
188200     IF PS-NO-ERROR-FOUND                                         18820057
188300         PERFORM 2463-FET-SKU-PROMO-WID-CSR                       18830057
188400     END-IF.                                                      18840057
188500     PERFORM 2462-PROCESS-SKU-PROMO-WID                           18850057
188600         UNTIL PS-END-OF-CSR                                      18860057
188700            OR PS-ERROR-FOUND.                                    18870057
188800     PERFORM 2464-CLS-SKU-PROMO-WID-CSR.                          18880057
188900                                                                  18890057
189000******************************************************************18900057
189010* OPEN PROMO PRICE - PRICED AT SKU LEVEL W/ PROMO ID              18901057
189020******************************************************************18902057
189030 2461-OPN-SKU-PROMO-WID-CSR.                                      18903057
189040                                                                  18904057
189050     EXEC SQL                                                     18905057
189060          OPEN SKU-PROMO-WID-CSR                                  18906057
189070     END-EXEC.                                                    18907057
189080                                                                  18908057
189090     EVALUATE TRUE                                                18909057
189100         WHEN SQLCODE = ZERO                                      18910057
189200             CONTINUE                                             18920057
189300                                                                  18930057
189400         WHEN OTHER                                               18940057
189500             MOVE '2461-OPN-SKU-PROMO-WID-CSR'                    18950057
189600                              TO XS047-ERROR-SECTION-NAME         18960057
189700             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             18970057
189800             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    18980057
189900             PERFORM 9000-DISPLAY-ERRORS                          18990057
190000     END-EVALUATE.                                                19000057
190100                                                                  19010057
190200******************************************************************19020057
190300* GET PROMO PRICE - PRICED AT SKU LEVEL W/ PROMO ID               19030057
190400******************************************************************19040057
190500 2463-FET-SKU-PROMO-WID-CSR.                                      19050057
190600                                                                  19060057
190700     EXEC SQL                                                     19070057
190800          FETCH SKU-PROMO-WID-CSR                                 19080057
190900           INTO :XST00028-PROMO-INTFC-ID                          19090057
191000              , :XST00028-MDSE-LNE-ID                             19100057
191100              , :XST00028-PRICG-TYP-CDE                           19110057
191200              , :XST00028-ADV-CDE                                 19120057
191300                :PV-ADV-CDE-NULL-IND                              19130057
191400              , :XST00028-PROMO-ID                                19140057
191500              , :XST00026-REG-PROMO-TYP-CDE                       19150057
191600     END-EXEC.                                                    19160057
191700                                                                  19170057
191800     EVALUATE TRUE                                                19180057
191900         WHEN SQLCODE = ZERO                                      19190057
192000             IF PV-ADV-CDE-NULL-IND < 0                           19200057
192100                 MOVE SPACES  TO XST00028-ADV-CDE                 19210057
192200             END-IF                                               19220057
192300                                                                  19230057
192400         WHEN SQLCODE = +100                                      19240057
192500             SET PS-END-OF-CSR TO TRUE                            19250057
192600                                                                  19260057
192700         WHEN OTHER                                               19270057
192800             MOVE '2463-FET-SKU-PROMO-WID-CSR'                    19280057
192900                              TO XS047-ERROR-SECTION-NAME         19290057
193000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             19300057
193100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    19310057
193200             PERFORM 9000-DISPLAY-ERRORS                          19320057
193300     END-EVALUATE.                                                19330057
193400                                                                  19340057
193500******************************************************************19350057
193600* PROCESS SKU LEVEL PROMO PRICE W/ PROMO-ID                       19360057
193700******************************************************************19370057
193800 2462-PROCESS-SKU-PROMO-WID.                                      19380057
193900                                                                  19390057
194000     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        19400057
194100     PERFORM 2463-FET-SKU-PROMO-WID-CSR.                          19410057
194200                                                                  19420057
194300******************************************************************19430057
194400* CLOSE PROMO PRICE - PRICED AT SKU LEVEL W/ PROMO ID             19440057
194500******************************************************************19450057
194600 2464-CLS-SKU-PROMO-WID-CSR.                                      19460057
194700                                                                  19470057
194800     EXEC SQL                                                     19480057
194900          CLOSE SKU-PROMO-WID-CSR                                 19490057
195000     END-EXEC.                                                    19500057
195100                                                                  19510057
195200     EVALUATE TRUE                                                19520057
195300         WHEN SQLCODE = ZERO                                      19530057
195400             CONTINUE                                             19540057
195500                                                                  19550057
195600         WHEN OTHER                                               19560057
195700             MOVE '2464-CLS-SKU-PROMO-WID-CSR'                    19570057
195800                              TO XS047-ERROR-SECTION-NAME         19580057
195900             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             19590057
196000             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    19600057
196100             PERFORM 9000-DISPLAY-ERRORS                          19610057
196200     END-EVALUATE.                                                19620057
196300                                                                  19630057
196400******************************************************************19640057
196500* CHECK STYLE LEVEL PROMO PRICE W/ PROMO-ID                       19650057
196600******************************************************************19660057
196700 2470-GET-STY-PROMO-WID.                                          19670057
196800                                                                  19680057
196900     SET PS-NOT-END-OF-CSR    TO TRUE.                            19690057
197000     PERFORM 2471-OPN-STY-PROMO-WID-CSR.                          19700057
197100     IF PS-NO-ERROR-FOUND                                         19710057
197200         PERFORM 2473-FET-STY-PROMO-WID-CSR                       19720057
197300     END-IF.                                                      19730057
197400     PERFORM 2472-PROCESS-STY-PROMO-WID                           19740057
197500         UNTIL PS-END-OF-CSR                                      19750057
197600            OR PS-ERROR-FOUND.                                    19760057
197700     PERFORM 2474-CLS-STY-PROMO-WID-CSR.                          19770057
197800                                                                  19780057
197900******************************************************************19790057
198000* OPEN PROMO PRICE - PRICED AT STYLE LEVEL W/ PROMO ID            19800057
198100******************************************************************19810057
198200 2471-OPN-STY-PROMO-WID-CSR.                                      19820057
198300                                                                  19830057
198400     EXEC SQL                                                     19840057
198500          OPEN STY-PROMO-WID-CSR                                  19850057
198600     END-EXEC.                                                    19860057
198700                                                                  19870057
198800     EVALUATE TRUE                                                19880057
198900         WHEN SQLCODE = ZERO                                      19890057
199000             CONTINUE                                             19900057
199100                                                                  19910057
199200         WHEN OTHER                                               19920057
199300             MOVE '2471-OPN-STY-PROMO-WID-CSR'                    19930057
199400                              TO XS047-ERROR-SECTION-NAME         19940057
199500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             19950057
199600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    19960057
199700             PERFORM 9000-DISPLAY-ERRORS                          19970057
199800     END-EVALUATE.                                                19980057
199900                                                                  19990057
200000******************************************************************20000057
200100* GET PROMO PRICE - PRICED AT STYLE LEVEL W/ PROMO ID             20010057
200200******************************************************************20020057
200300 2473-FET-STY-PROMO-WID-CSR.                                      20030057
200400                                                                  20040057
200500     EXEC SQL                                                     20050057
200600          FETCH STY-PROMO-WID-CSR                                 20060057
200700           INTO :XST00028-PROMO-INTFC-ID                          20070057
200800              , :XST00028-MDSE-LNE-ID                             20080057
200900              , :XST00028-PRICG-TYP-CDE                           20090057
201000              , :XST00028-ADV-CDE                                 20100057
201100                :PV-ADV-CDE-NULL-IND                              20110057
201200              , :XST00028-PROMO-ID                                20120057
201300              , :XST00026-REG-PROMO-TYP-CDE                       20130057
201400     END-EXEC.                                                    20140057
201500                                                                  20150057
201600     EVALUATE TRUE                                                20160057
201700         WHEN SQLCODE = ZERO                                      20170057
201800             IF PV-ADV-CDE-NULL-IND < 0                           20180057
201900                 MOVE SPACES  TO XST00028-ADV-CDE                 20190057
202000             END-IF                                               20200057
202100                                                                  20210057
202200         WHEN SQLCODE = +100                                      20220057
202300             SET PS-END-OF-CSR TO TRUE                            20230057
202400                                                                  20240057
202500         WHEN OTHER                                               20250057
202600             MOVE '2473-FET-STY-PROMO-WID-CSR'                    20260057
202700                              TO XS047-ERROR-SECTION-NAME         20270057
202800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             20280057
202900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    20290057
203000             PERFORM 9000-DISPLAY-ERRORS                          20300057
203100     END-EVALUATE.                                                20310057
203200                                                                  20320057
203300******************************************************************20330057
203400* PROCESS STY LEVEL PROMO PRICE W/NO PROMO-ID                     20340057
203500******************************************************************20350057
203600 2472-PROCESS-STY-PROMO-WID.                                      20360057
203700                                                                  20370057
203800     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        20380057
203900     PERFORM 2473-FET-STY-PROMO-WID-CSR.                          20390057
204000                                                                  20400057
204100******************************************************************20410057
204200* CLOSE PROMO PRICE - PRICED AT STYLE LEVEL W/ PROMO ID           20420057
204300******************************************************************20430057
204400 2474-CLS-STY-PROMO-WID-CSR.                                      20440057
204500                                                                  20450057
204600     EXEC SQL                                                     20460057
204700          CLOSE STY-PROMO-WID-CSR                                 20470057
204800     END-EXEC.                                                    20480057
204900                                                                  20490057
205000     EVALUATE TRUE                                                20500057
205100         WHEN SQLCODE = ZERO                                      20510057
205200             CONTINUE                                             20520057
205300                                                                  20530057
205400         WHEN OTHER                                               20540057
205500             MOVE '2474-CLS-STY-PROMO-WID-CSR'                    20550057
205600                              TO XS047-ERROR-SECTION-NAME         20560057
205700             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             20570057
205800             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    20580057
205900             PERFORM 9000-DISPLAY-ERRORS                          20590057
206000     END-EVALUATE.                                                20600057
206100                                                                  20610057
206200******************************************************************20620057
206300* CHECK SUB CLASS LEVEL PROMO PRICE W/ PROMO-ID                   20630057
206400******************************************************************20640057
206500 2480-GET-SCL-PROMO-WID.                                          20650057
206600                                                                  20660057
206700     SET PS-NOT-END-OF-CSR    TO TRUE.                            20670057
206800     PERFORM 2481-OPN-SCL-PROMO-WID-CSR.                          20680057
206900     IF PS-NO-ERROR-FOUND                                         20690057
207000         PERFORM 2483-FET-SCL-PROMO-WID-CSR                       20700057
207100     END-IF.                                                      20710057
207200     PERFORM 2482-PROCESS-SCL-PROMO-WID                           20720057
207300         UNTIL PS-END-OF-CSR                                      20730057
207400            OR PS-ERROR-FOUND.                                    20740057
207500     PERFORM 2484-CLS-SCL-PROMO-WID-CSR.                          20750057
207600                                                                  20760057
207700******************************************************************20770057
207800* OPEN PROMO PRICE - PRICED AT SCL LEVEL W/ PROMO ID              20780057
207810******************************************************************20781057
207820 2481-OPN-SCL-PROMO-WID-CSR.                                      20782057
207830                                                                  20783057
207840     EXEC SQL                                                     20784057
207850          OPEN SCL-PROMO-WID-CSR                                  20785057
207860     END-EXEC.                                                    20786057
207870                                                                  20787057
207880     EVALUATE TRUE                                                20788057
207890         WHEN SQLCODE = ZERO                                      20789057
207900             CONTINUE                                             20790057
208000                                                                  20800057
208100         WHEN OTHER                                               20810057
208200             MOVE '2481-OPN-SCL-PROMO-WID-CSR'                    20820057
208300                              TO XS047-ERROR-SECTION-NAME         20830057
208400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             20840057
208500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    20850057
208600             PERFORM 9000-DISPLAY-ERRORS                          20860057
208700     END-EVALUATE.                                                20870057
208800                                                                  20880057
208900******************************************************************20890057
209000* GET PROMO PRICE - PRICED AT SCL LEVEL W/ PROMO ID               20900057
209100******************************************************************20910057
209200 2483-FET-SCL-PROMO-WID-CSR.                                      20920057
209300                                                                  20930057
209400     EXEC SQL                                                     20940057
209500          FETCH SCL-PROMO-WID-CSR                                 20950057
209600           INTO :XST00028-PROMO-INTFC-ID                          20960057
209700              , :XST00028-MDSE-LNE-ID                             20970057
209800              , :XST00028-PRICG-TYP-CDE                           20980057
209900              , :XST00028-ADV-CDE                                 20990057
210000                :PV-ADV-CDE-NULL-IND                              21000057
210100              , :XST00028-PROMO-ID                                21010057
210200              , :XST00026-REG-PROMO-TYP-CDE                       21020057
210300              , :XST00013-MAJ-CL-NBR                              21030057
210400              , :XST00013-SUB-CL-NBR                              21040057
210500     END-EXEC.                                                    21050057
210600                                                                  21060057
210700     EVALUATE TRUE                                                21070057
210800         WHEN SQLCODE = ZERO                                      21080057
210900             IF PV-ADV-CDE-NULL-IND < 0                           21090057
211000                 MOVE SPACES  TO XST00028-ADV-CDE                 21100057
211100             END-IF                                               21110057
211200                                                                  21120057
211300         WHEN SQLCODE = +100                                      21130057
211400             SET PS-END-OF-CSR TO TRUE                            21140057
211500                                                                  21150057
211600         WHEN OTHER                                               21160057
211700             MOVE '2483-FET-SCL-PROMO-WID-CSR'                    21170057
211800                              TO XS047-ERROR-SECTION-NAME         21180057
211900             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             21190057
212000             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    21200057
212100             PERFORM 9000-DISPLAY-ERRORS                          21210057
212200     END-EVALUATE.                                                21220057
212300                                                                  21230057
212400******************************************************************21240057
212500* PROCESS SCL LEVEL PROMO PRICE W/NO PROMO-ID                     21250057
212600******************************************************************21260057
212700 2482-PROCESS-SCL-PROMO-WID.                                      21270057
212800                                                                  21280057
212900     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        21290057
213000     PERFORM 2483-FET-SCL-PROMO-WID-CSR.                          21300057
213100                                                                  21310057
213200******************************************************************21320057
213300* CLOSE PROMO PRICE - PRICED AT SCL LEVEL W/ PROMO ID             21330057
213400******************************************************************21340057
213500 2484-CLS-SCL-PROMO-WID-CSR.                                      21350057
213600                                                                  21360057
213700     EXEC SQL                                                     21370057
213800          CLOSE SCL-PROMO-WID-CSR                                 21380057
213900     END-EXEC.                                                    21390057
214000                                                                  21400057
214100     EVALUATE TRUE                                                21410057
214200         WHEN SQLCODE = ZERO                                      21420057
214300             CONTINUE                                             21430057
214400                                                                  21440057
214500         WHEN OTHER                                               21450057
214600             MOVE '2484-CLS-SCL-PROMO-WID-CSR'                    21460057
214700                              TO XS047-ERROR-SECTION-NAME         21470057
214800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             21480057
214900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    21490057
215000             PERFORM 9000-DISPLAY-ERRORS                          21500057
215100     END-EVALUATE.                                                21510057
215200                                                                  21520057
215300******************************************************************21530057
215400* CHECK MAJ CLASS LEVEL PROMO PRICE W/ PROMO-ID                   21540057
215500******************************************************************21550057
215600 2490-GET-MCL-PROMO-WID.                                          21560057
215700                                                                  21570057
215800     SET PS-NOT-END-OF-CSR    TO TRUE.                            21580057
215900     PERFORM 2491-OPN-MCL-PROMO-WID-CSR.                          21590057
216000     IF PS-NO-ERROR-FOUND                                         21600057
216100         PERFORM 2493-FET-MCL-PROMO-WID-CSR                       21610057
216200     END-IF.                                                      21620057
216300     PERFORM 2492-PROCESS-MCL-PROMO-WID                           21630057
216400         UNTIL PS-END-OF-CSR                                      21640057
216500            OR PS-ERROR-FOUND.                                    21650057
216600     PERFORM 2494-CLS-MCL-PROMO-WID-CSR.                          21660057
216700                                                                  21670057
216800******************************************************************21680057
216900* OPEN PROMO PRICE - PRICED AT MCL LEVEL W/ PROMO ID              21690057
217000******************************************************************21700057
217100 2491-OPN-MCL-PROMO-WID-CSR.                                      21710057
217200                                                                  21720057
217300     EXEC SQL                                                     21730057
217400          OPEN MCL-PROMO-WID-CSR                                  21740057
217500     END-EXEC.                                                    21750057
217600                                                                  21760057
217700     EVALUATE TRUE                                                21770057
217800         WHEN SQLCODE = ZERO                                      21780057
217900             CONTINUE                                             21790057
218000                                                                  21800057
218100         WHEN OTHER                                               21810057
218200             MOVE '2491-OPN-MCL-PROMO-WID-CSR'                    21820057
218300                              TO XS047-ERROR-SECTION-NAME         21830057
218400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             21840057
218500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    21850057
218600             PERFORM 9000-DISPLAY-ERRORS                          21860057
218700     END-EVALUATE.                                                21870057
218800                                                                  21880057
218900******************************************************************21890057
219000* GET PROMO PRICE - PRICED AT MCL LEVEL W/ PROMO ID               21900057
219100******************************************************************21910057
219200 2493-FET-MCL-PROMO-WID-CSR.                                      21920057
219300                                                                  21930057
219400     EXEC SQL                                                     21940057
219500          FETCH MCL-PROMO-WID-CSR                                 21950057
219600           INTO :XST00028-PROMO-INTFC-ID                          21960057
219700              , :XST00028-MDSE-LNE-ID                             21970057
219800              , :XST00028-PRICG-TYP-CDE                           21980057
219900              , :XST00028-ADV-CDE                                 21990057
220000                :PV-ADV-CDE-NULL-IND                              22000057
220100              , :XST00028-PROMO-ID                                22010057
220200              , :XST00013-MAJ-CL-NBR                              22020057
220300              , :XST00013-SUB-CL-NBR                              22030057
220400              , :XST00026-REG-PROMO-TYP-CDE                       22040057
220500     END-EXEC.                                                    22050057
220600                                                                  22060057
220700     EVALUATE TRUE                                                22070057
220800         WHEN SQLCODE = ZERO                                      22080057
220900             IF PV-ADV-CDE-NULL-IND < 0                           22090057
221000                 MOVE SPACES  TO XST00028-ADV-CDE                 22100057
221100             END-IF                                               22110057
221200                                                                  22120057
221300         WHEN SQLCODE = +100                                      22130057
221400             SET PS-END-OF-CSR TO TRUE                            22140057
221500                                                                  22150057
221600         WHEN OTHER                                               22160057
221700             MOVE '2493-FET-MCL-PROMO-WID-CSR'                    22170057
221800                              TO XS047-ERROR-SECTION-NAME         22180057
221900             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             22190057
222000             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    22200057
222100             PERFORM 9000-DISPLAY-ERRORS                          22210057
222200     END-EVALUATE.                                                22220057
222300                                                                  22230057
222400******************************************************************22240057
222500* PROCESS MCL LEVEL PROMO PRICE W/NO PROMO-ID                     22250057
222600******************************************************************22260057
222700 2492-PROCESS-MCL-PROMO-WID.                                      22270057
222800                                                                  22280057
222900     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        22290057
223000     PERFORM 2493-FET-MCL-PROMO-WID-CSR.                          22300057
223100                                                                  22310057
223200******************************************************************22320057
223300* CLOSE PROMO PRICE - PRICED AT MCL LEVEL W/ PROMO ID             22330057
223400******************************************************************22340057
223500 2494-CLS-MCL-PROMO-WID-CSR.                                      22350057
223600                                                                  22360057
223700     EXEC SQL                                                     22370057
223800          CLOSE MCL-PROMO-WID-CSR                                 22380057
223900     END-EXEC.                                                    22390057
224000                                                                  22400057
224100     EVALUATE TRUE                                                22410057
224200         WHEN SQLCODE = ZERO                                      22420057
224300             CONTINUE                                             22430057
224400                                                                  22440057
224500         WHEN OTHER                                               22450057
224600             MOVE '2494-CLS-MCL-PROMO-WID-CSR'                    22460057
224700                              TO XS047-ERROR-SECTION-NAME         22470057
224800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             22480057
224900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    22490057
225000             PERFORM 9000-DISPLAY-ERRORS                          22500057
225100     END-EVALUATE.                                                22510057
225200                                                                  22520057
225300******************************************************************22530057
225400* CHECK DEPT LEVEL PROMO PRICE W/ PROMO-ID                        22540057
225500******************************************************************22550057
225600 2495-GET-DPT-PROMO-WID.                                          22560057
225700                                                                  22570057
225800     SET PS-NOT-END-OF-CSR    TO TRUE.                            22580057
225900     PERFORM 2496-OPN-DPT-PROMO-WID-CSR.                          22590057
226000     IF PS-NO-ERROR-FOUND                                         22600057
226100         PERFORM 2498-FET-DPT-PROMO-WID-CSR                       22610057
226200     END-IF.                                                      22620057
226300     PERFORM 2497-PROCESS-DPT-PROMO-WID                           22630057
226400         UNTIL PS-END-OF-CSR                                      22640057
226500            OR PS-ERROR-FOUND.                                    22650057
226600     PERFORM 2499-CLS-DPT-PROMO-WID-CSR.                          22660057
226700                                                                  22670057
226800******************************************************************22680057
226900* OPEN PROMO PRICE - PRICED AT DPT LEVEL W/ PROMO ID              22690057
227000******************************************************************22700057
227100 2496-OPN-DPT-PROMO-WID-CSR.                                      22710057
227200                                                                  22720057
227300     EXEC SQL                                                     22730057
227400          OPEN DPT-PROMO-WID-CSR                                  22740057
227500     END-EXEC.                                                    22750057
227600                                                                  22760057
227700     EVALUATE TRUE                                                22770057
227800         WHEN SQLCODE = ZERO                                      22780057
227900             CONTINUE                                             22790057
228000                                                                  22800057
228100         WHEN OTHER                                               22810057
228200             MOVE '2496-OPN-DPT-PROMO-WID-CSR'                    22820057
228300                              TO XS047-ERROR-SECTION-NAME         22830057
228400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             22840057
228500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    22850057
228600             PERFORM 9000-DISPLAY-ERRORS                          22860057
228700     END-EVALUATE.                                                22870057
228800                                                                  22880057
228900******************************************************************22890057
229000* GET PROMO PRICE - PRICED AT DPT LEVEL W/ PROMO ID               22900057
229100******************************************************************22910057
229200 2498-FET-DPT-PROMO-WID-CSR.                                      22920057
229300                                                                  22930057
229400     EXEC SQL                                                     22940057
229500          FETCH DPT-PROMO-WID-CSR                                 22950057
229600           INTO :XST00028-PROMO-INTFC-ID                          22960057
229700              , :XST00028-MDSE-LNE-ID                             22970057
229800              , :XST00028-PRICG-TYP-CDE                           22980057
229900              , :XST00028-ADV-CDE                                 22990057
230000                :PV-ADV-CDE-NULL-IND                              23000057
230100              , :XST00028-PROMO-ID                                23010057
230200              , :XST00013-MAJ-CL-NBR                              23020057
230300              , :XST00013-SUB-CL-NBR                              23030057
230400              , :XST00026-REG-PROMO-TYP-CDE                       23040057
230500     END-EXEC.                                                    23050057
230600                                                                  23060057
230700     EVALUATE TRUE                                                23070057
230800         WHEN SQLCODE = ZERO                                      23080057
230900             IF PV-ADV-CDE-NULL-IND < 0                           23090057
231000                 MOVE SPACES  TO XST00028-ADV-CDE                 23100057
231100             END-IF                                               23110057
231200                                                                  23120057
231300         WHEN SQLCODE = +100                                      23130057
231400             SET PS-END-OF-CSR TO TRUE                            23140057
231500                                                                  23150057
231600         WHEN OTHER                                               23160057
231700             MOVE '2498-FET-DPT-PROMO-WID-CSR'                    23170057
231800                              TO XS047-ERROR-SECTION-NAME         23180057
231900             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23190057
232000             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23200057
232100             PERFORM 9000-DISPLAY-ERRORS                          23210057
232200     END-EVALUATE.                                                23220057
232300                                                                  23230057
232400******************************************************************23240057
232500* PROCESS DPT LEVEL PROMO PRICE W/NO PROMO-ID                     23250057
232600******************************************************************23260057
232700 2497-PROCESS-DPT-PROMO-WID.                                      23270057
232800                                                                  23280057
232900     PERFORM 5000-VALIDATE-FETCHED-RECORD.                        23290057
233000     PERFORM 2498-FET-DPT-PROMO-WID-CSR.                          23300057
233100                                                                  23310057
233200******************************************************************23320057
233300* CLOSE PROMO PRICE - PRICED AT DPT LEVEL W/ PROMO ID             23330057
233400******************************************************************23340057
233500 2499-CLS-DPT-PROMO-WID-CSR.                                      23350057
233600                                                                  23360057
233700     EXEC SQL                                                     23370057
233800          CLOSE DPT-PROMO-WID-CSR                                 23380057
233900     END-EXEC.                                                    23390057
234000                                                                  23400057
234100     EVALUATE TRUE                                                23410057
234200         WHEN SQLCODE = ZERO                                      23420057
234300             CONTINUE                                             23430057
234400                                                                  23440057
234500         WHEN OTHER                                               23450057
234600             MOVE '2499-CLS-DPT-PROMO-WID-CSR'                    23460057
234700                              TO XS047-ERROR-SECTION-NAME         23470057
234800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23480057
234900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23490057
235000             PERFORM 9000-DISPLAY-ERRORS                          23500057
235100     END-EVALUATE.                                                23510057
235200                                                                  23520057
      ******************************************************************23520179
      * CHECK FOR FUTURE CONTINUED CLEARANCE.                           23520279
      ******************************************************************23520379
       2900-CHECK-FOR-FUT-CNTCLR.                                       23520479
                                                                        23520784
      *    THE PERM SYSTEM DOES NOT ALLOW A SKU TO BE SET UP IN         23520879
      *    MORE THAN ONE LEVEL OF THE MERCHANDISE HIERARCHY IN A        23520979
      *    CONTINUED CLEARANCE EVENT. --SPRING 2005                     23521079
                                                                        23521179
           SET PS-FUT-RED-EVNT-NOT-FOUND         TO TRUE.               23521279
           SET PS-NOT-END-OF-CONCLR-CSR          TO TRUE.               23521379
           IF PS-NO-ERROR-FOUND                                         23521484
               PERFORM 2901-OPN-FUT-CNTCLR-DPT-CSR                      23521584
           END-IF.                                                      23521679
           IF PS-NO-ERROR-FOUND                                         23521779
               PERFORM 2902-FET-FUT-CNTCLR-DPT-CSR                      23521883
           END-IF.                                                      23521979
           IF PS-NO-ERROR-FOUND                                         23522079
               PERFORM 2903-CLS-FUT-CNTCLR-DPT-CSR                      23522183
           END-IF.                                                      23522279
                                                                        23522379
           IF PS-FUT-RED-EVNT-NOT-FOUND AND                             23522479
              PS-NO-ERROR-FOUND                                         23522579
               SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                23522679
               PERFORM 2910-OPN-FUT-CNTCLR-MCL-CSR                      23522779
               IF PS-NO-ERROR-FOUND                                     23522879
                   PERFORM 2911-FET-FUT-CNTCLR-MCL-CSR                  23522979
               END-IF                                                   23523079
               IF PS-NO-ERROR-FOUND                                     23523179
                   PERFORM 2912-CLS-FUT-CNTCLR-MCL-CSR                  23523279
               END-IF                                                   23523379
           END-IF.                                                      23523479
                                                                        23523579
           IF PS-FUT-RED-EVNT-NOT-FOUND AND                             23523679
              PS-NO-ERROR-FOUND                                         23523779
               SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                23523879
               PERFORM 2920-OPN-FUT-CNTCLR-SCL-CSR                      23523979
               IF PS-NO-ERROR-FOUND                                     23524079
                   PERFORM 2921-FET-FUT-CNTCLR-SCL-CSR                  23524179
               END-IF                                                   23524279
               IF PS-NO-ERROR-FOUND                                     23524379
                   PERFORM 2922-CLS-FUT-CNTCLR-SCL-CSR                  23524479
               END-IF                                                   23524579
           END-IF.                                                      23524679
                                                                        23524779
           IF PS-FUT-RED-EVNT-NOT-FOUND AND                             23524879
              PS-NO-ERROR-FOUND                                         23524979
               SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                23525079
               PERFORM 2930-OPN-FUT-CNTCLR-STY-CSR                      23525179
               IF PS-NO-ERROR-FOUND                                     23525279
                   PERFORM 2931-FET-FUT-CNTCLR-STY-CSR                  23525379
               END-IF                                                   23525479
               IF PS-NO-ERROR-FOUND                                     23525579
                   PERFORM 2932-CLS-FUT-CNTCLR-STY-CSR                  23525679
               END-IF                                                   23525779
           END-IF.                                                      23525879
                                                                        23525979
           IF PS-FUT-RED-EVNT-NOT-FOUND AND                             23526079
              PS-NO-ERROR-FOUND                                         23526179
               SET PS-NOT-END-OF-CONCLR-CSR      TO TRUE                23526279
               PERFORM 2940-OPN-FUT-CNTCLR-SKU-CSR                      23526379
               IF PS-NO-ERROR-FOUND                                     23526479
                   PERFORM 2941-FET-FUT-CNTCLR-SKU-CSR                  23526579
               END-IF                                                   23526679
               IF PS-NO-ERROR-FOUND                                     23526779
                   PERFORM 2942-CLS-FUT-CNTCLR-SKU-CSR                  23526879
               END-IF                                                   23526979
           END-IF.                                                      23527079
                                                                        23527179
      ******************************************************************23527275
      * OPEN FUTURE CONTINUED CLEARANCE AT THE DEPT LEVEL CURSOR        23527375
      ******************************************************************23527475
       2901-OPN-FUT-CNTCLR-DPT-CSR.                                     23527579
                                                                        23527675
           EXEC SQL                                                     23527775
                OPEN FUT-CNTCLR-DPT-CSR                                 23527875
           END-EXEC.                                                    23528075
                                                                        23529075
           EVALUATE TRUE                                                23529175
               WHEN SQLCODE = ZERO                                      23529275
                   CONTINUE                                             23529375
                                                                        23529475
               WHEN OTHER                                               23529575
                   MOVE '2901-OPN-FUT-CNTCLR-DPT-CSR'                   23529779
                                    TO XS047-ERROR-SECTION-NAME         23529875
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23529975
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23530075
                   PERFORM 9000-DISPLAY-ERRORS                          23530175
           END-EVALUATE.                                                23530775
                                                                        23530875
      ******************************************************************23530975
      * GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       23531075
      * AT THE DEPARTMENT LEVEL.                                        23531175
      ******************************************************************23531275
       2902-FET-FUT-CNTCLR-DPT-CSR.                                     23531383
                                                                        23531475
           EXEC SQL                                                     23531575
                FETCH FUT-CNTCLR-DPT-CSR                                23531675
                 INTO :PV-CONTCLR-PRCHG-EFF-DTE                         23531775
                    , :XST00065-CLR-TYP-CDE                             23531875
                    , :XST00065-PRICG-GRID-ID                           23531975
           END-EXEC.                                                    23532075
                                                                        23532175
           EVALUATE TRUE                                                23532275
               WHEN SQLCODE = ZERO                                      23532375
                   SET PS-FUT-RED-EVNT-FOUND TO TRUE                    23532475
                                                                        23532575
               WHEN SQLCODE = +100                                      23532675
                   SET PS-END-OF-CONCLR-CSR  TO TRUE                    23532775
                                                                        23532875
               WHEN OTHER                                               23532975
                   MOVE '2902-FET-FUT-CNTCLR-DPT-CSR'                   23533183
                                    TO XS047-ERROR-SECTION-NAME         23533275
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23533375
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23533475
                   PERFORM 9000-DISPLAY-ERRORS                          23533575
           END-EVALUATE.                                                23534175
                                                                        23534275
      ******************************************************************23534375
      * CLOSE FUTURE CONTINUED CLEARANCE AT THE DEPT LEVEL CURSOR       23534475
      ******************************************************************23534575
       2903-CLS-FUT-CNTCLR-DPT-CSR.                                     23534683
                                                                        23534775
           EXEC SQL                                                     23534875
                CLOSE FUT-CNTCLR-DPT-CSR                                23534975
           END-EXEC.                                                    23535075
                                                                        23535175
           EVALUATE TRUE                                                23535275
             WHEN SQLCODE = +0                                          23535375
                 CONTINUE                                               23535475
                                                                        23535575
             WHEN OTHER                                                 23535675
                 MOVE '2903-CLS-FUT-CNTCLR-DPT-CSR'                     23536083
                                  TO XS047-ERROR-SECTION-NAME           23536475
                 MOVE SQLCODE     TO XS047-ERROR-SQL-CODE               23536575
                 MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND      23536675
                 PERFORM 9000-DISPLAY-ERRORS                            23536775
           END-EVALUATE.                                                23536875
                                                                        23536975
      ******************************************************************23537075
      * OPEN FUTURE CONTINUED CLEARANCE AT THE MAJOR CLASS LEVEL CSR    23537175
      ******************************************************************23537275
       2910-OPN-FUT-CNTCLR-MCL-CSR.                                     23537375
                                                                        23537475
           EXEC SQL                                                     23537575
                OPEN FUT-CNTCLR-MCL-CSR                                 23537675
           END-EXEC.                                                    23537775
                                                                        23537875
           EVALUATE TRUE                                                23537975
               WHEN SQLCODE = ZERO                                      23538075
                   CONTINUE                                             23538175
                                                                        23538275
               WHEN OTHER                                               23538375
                   MOVE '2910-OPN-FUT-CNTCLR-MCL-CSR'                   23538875
                                    TO XS047-ERROR-SECTION-NAME         23539275
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23539375
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23539475
                   PERFORM 9000-DISPLAY-ERRORS                          23539575
           END-EVALUATE.                                                23539675
                                                                        23539775
      ******************************************************************23539875
      * GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       23539975
      * AT THE MAJOR CLASS LEVEL.                                       23540075
      ******************************************************************23540175
       2911-FET-FUT-CNTCLR-MCL-CSR.                                     23540275
                                                                        23540375
           EXEC SQL                                                     23540475
                FETCH FUT-CNTCLR-MCL-CSR                                23540575
                 INTO :PV-CONTCLR-PRCHG-EFF-DTE                         23540675
                    , :XST00065-CLR-TYP-CDE                             23540775
                    , :XST00065-PRICG-GRID-ID                           23540875
           END-EXEC.                                                    23540975
                                                                        23541075
           EVALUATE TRUE                                                23541175
               WHEN SQLCODE = ZERO                                      23541275
                   SET PS-FUT-RED-EVNT-FOUND TO TRUE                    23541375
                                                                        23541475
               WHEN SQLCODE = +100                                      23541575
                   SET PS-END-OF-CONCLR-CSR  TO TRUE                    23541675
                                                                        23541775
               WHEN OTHER                                               23541875
                   MOVE '2911-FET-FUT-CNTCLR-MCL-CSR'                   23542375
                                    TO XS047-ERROR-SECTION-NAME         23542775
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23542875
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23542975
                   PERFORM 9000-DISPLAY-ERRORS                          23543075
           END-EVALUATE.                                                23543175
                                                                        23543275
      ******************************************************************23543375
      * CLOSE FUTURE CONTINUED CLEARANCE AT THE MAJOR CLASS LEVEL CSR   23543475
      ******************************************************************23543575
       2912-CLS-FUT-CNTCLR-MCL-CSR.                                     23543675
                                                                        23543775
           EXEC SQL                                                     23543875
                CLOSE FUT-CNTCLR-MCL-CSR                                23543975
           END-EXEC.                                                    23544075
                                                                        23544175
           EVALUATE TRUE                                                23544275
             WHEN SQLCODE = +0                                          23544375
                 CONTINUE                                               23544475
                                                                        23544575
             WHEN OTHER                                                 23544675
                 MOVE '2912-CLS-FUT-CNTCLR-MCL-CSR'                     23545175
                                  TO XS047-ERROR-SECTION-NAME           23545575
                 MOVE SQLCODE     TO XS047-ERROR-SQL-CODE               23545675
                 MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND      23545775
                 PERFORM 9000-DISPLAY-ERRORS                            23545875
           END-EVALUATE.                                                23545975
                                                                        23546075
      ******************************************************************23546175
      * OPEN FUTURE CONTINUED CLEARANCE AT THE SUB CLASS LEVEL CSR      23546275
      ******************************************************************23546375
       2920-OPN-FUT-CNTCLR-SCL-CSR.                                     23546475
                                                                        23546575
           EXEC SQL                                                     23546675
                OPEN FUT-CNTCLR-SCL-CSR                                 23546775
           END-EXEC.                                                    23546875
                                                                        23546975
           EVALUATE TRUE                                                23547075
               WHEN SQLCODE = ZERO                                      23547175
                   CONTINUE                                             23547275
                                                                        23547375
               WHEN OTHER                                               23547475
                   MOVE '2920-OPN-FUT-CNTCLR-SCL-CSR'                   23548075
                                    TO XS047-ERROR-SECTION-NAME         23548475
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23548575
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23548675
                   PERFORM 9000-DISPLAY-ERRORS                          23548775
           END-EVALUATE.                                                23548875
                                                                        23548975
      ******************************************************************23549075
      * GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       23549175
      * AT THE SUB CLASS LEVEL.                                         23549275
      ******************************************************************23549375
       2921-FET-FUT-CNTCLR-SCL-CSR.                                     23549475
                                                                        23549575
           EXEC SQL                                                     23549675
                FETCH FUT-CNTCLR-SCL-CSR                                23549775
                 INTO :PV-CONTCLR-PRCHG-EFF-DTE                         23549875
                    , :XST00065-CLR-TYP-CDE                             23549975
                    , :XST00065-PRICG-GRID-ID                           23550075
           END-EXEC.                                                    23550175
                                                                        23550275
           EVALUATE TRUE                                                23550375
               WHEN SQLCODE = ZERO                                      23550475
                   SET PS-FUT-RED-EVNT-FOUND TO TRUE                    23550575
                                                                        23550675
               WHEN SQLCODE = +100                                      23550775
                   SET PS-END-OF-CONCLR-CSR  TO TRUE                    23550875
                                                                        23550975
               WHEN OTHER                                               23551075
                   MOVE '2921-FET-FUT-CNTCLR-SCL-CSR'                   23551675
                                    TO XS047-ERROR-SECTION-NAME         23552075
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23552175
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23552275
                   PERFORM 9000-DISPLAY-ERRORS                          23552375
           END-EVALUATE.                                                23552475
                                                                        23552575
      ******************************************************************23552675
      * CLOSE FUTURE CONTINUED CLEARANCE AT THE SUB CLASS LEVEL CSR     23552775
      ******************************************************************23552875
       2922-CLS-FUT-CNTCLR-SCL-CSR.                                     23552975
                                                                        23553075
           EXEC SQL                                                     23553175
                CLOSE FUT-CNTCLR-SCL-CSR                                23553275
           END-EXEC.                                                    23553375
                                                                        23553475
           EVALUATE TRUE                                                23553575
             WHEN SQLCODE = +0                                          23553675
                 CONTINUE                                               23553775
                                                                        23553875
             WHEN OTHER                                                 23553975
                 MOVE '2922-CLS-FUT-CNTCLR-SCL-CSR'                     23554575
                                  TO XS047-ERROR-SECTION-NAME           23554975
                 MOVE SQLCODE     TO XS047-ERROR-SQL-CODE               23555075
                 MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND      23555175
                 PERFORM 9000-DISPLAY-ERRORS                            23555275
           END-EVALUATE.                                                23555375
                                                                        23555475
      ******************************************************************23555575
      * OPEN FUTURE CONTINUED CLEARANCE AT THE STYLE LEVEL CSR          23555675
      ******************************************************************23555775
       2930-OPN-FUT-CNTCLR-STY-CSR.                                     23555875
                                                                        23555975
           EXEC SQL                                                     23556075
                OPEN FUT-CNTCLR-STY-CSR                                 23556175
           END-EXEC.                                                    23556275
                                                                        23556375
           EVALUATE TRUE                                                23556475
               WHEN SQLCODE = ZERO                                      23556575
                   CONTINUE                                             23556675
                                                                        23556775
               WHEN OTHER                                               23556875
                   MOVE '2930-OPN-FUT-CNTCLR-STY-CSR'                   23557275
                                    TO XS047-ERROR-SECTION-NAME         23557675
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23557775
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23557875
                   PERFORM 9000-DISPLAY-ERRORS                          23557975
           END-EVALUATE.                                                23558075
                                                                        23558175
      ******************************************************************23558275
      * GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       23558375
      * AT THE STYLE LEVEL.                                             23558475
      ******************************************************************23558575
       2931-FET-FUT-CNTCLR-STY-CSR.                                     23558675
                                                                        23558775
           EXEC SQL                                                     23558875
                FETCH FUT-CNTCLR-STY-CSR                                23558975
                 INTO :PV-CONTCLR-PRCHG-EFF-DTE                         23559075
                    , :XST00065-CLR-TYP-CDE                             23559175
                    , :XST00065-PRICG-GRID-ID                           23559275
           END-EXEC.                                                    23559375
                                                                        23559475
           EVALUATE TRUE                                                23559575
               WHEN SQLCODE = ZERO                                      23559675
                   SET PS-FUT-RED-EVNT-FOUND TO TRUE                    23559775
                                                                        23559875
               WHEN SQLCODE = +100                                      23559975
                   SET PS-END-OF-CONCLR-CSR  TO TRUE                    23560075
                                                                        23560175
               WHEN OTHER                                               23560275
                   MOVE '2931-FET-FUT-CNTCLR-STY-CSR'                   23560675
                                    TO XS047-ERROR-SECTION-NAME         23561075
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23561175
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23561275
                   PERFORM 9000-DISPLAY-ERRORS                          23561375
           END-EVALUATE.                                                23561475
                                                                        23561575
      ******************************************************************23561675
      * CLOSE FUTURE CONTINUED CLEARANCE AT THE STYLE LEVEL CSR         23561775
      ******************************************************************23561875
       2932-CLS-FUT-CNTCLR-STY-CSR.                                     23561975
                                                                        23562075
           EXEC SQL                                                     23562175
                CLOSE FUT-CNTCLR-STY-CSR                                23562275
           END-EXEC.                                                    23562375
                                                                        23562475
           EVALUATE TRUE                                                23562575
               WHEN SQLCODE = +0                                        23562675
                   CONTINUE                                             23562775
                                                                        23562875
               WHEN OTHER                                               23562975
                   MOVE '2932-CLS-FUT-CNTCLR-STY-CSR'                   23563375
                                    TO XS047-ERROR-SECTION-NAME         23563775
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23563875
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23563975
                   PERFORM 9000-DISPLAY-ERRORS                          23564075
           END-EVALUATE.                                                23564175
                                                                        23564275
      ******************************************************************23564375
      * OPEN FUTURE CONTINUED CLEARANCE AT THE SKU LEVEL CSR            23564475
      ******************************************************************23564575
       2940-OPN-FUT-CNTCLR-SKU-CSR.                                     23564675
                                                                        23564775
           EXEC SQL                                                     23564875
                OPEN FUT-CNTCLR-SKU-CSR                                 23564975
           END-EXEC.                                                    23565075
                                                                        23565175
           EVALUATE TRUE                                                23565275
               WHEN SQLCODE = ZERO                                      23565375
                   CONTINUE                                             23565475
                                                                        23565575
               WHEN OTHER                                               23565675
                   MOVE '2940-OPN-FUT-CNTCLR-SKU-CSR'                   23566075
                                    TO XS047-ERROR-SECTION-NAME         23566475
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23566575
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23566675
                   PERFORM 9000-DISPLAY-ERRORS                          23566775
           END-EVALUATE.                                                23566875
                                                                        23566975
      ******************************************************************23567075
      * GET FUTURE CONTINUED CLEARANCE (RED TICKET) EVENTS SET UP       23567175
      * AT THE SKU LEVEL.                                               23567275
      ******************************************************************23567375
       2941-FET-FUT-CNTCLR-SKU-CSR.                                     23567475
                                                                        23567575
           EXEC SQL                                                     23567675
                FETCH FUT-CNTCLR-SKU-CSR                                23567775
                 INTO :PV-CONTCLR-PRCHG-EFF-DTE                         23567875
                    , :XST00065-CLR-TYP-CDE                             23567975
                    , :XST00065-PRICG-GRID-ID                           23568075
           END-EXEC.                                                    23568175
                                                                        23568275
           EVALUATE TRUE                                                23568375
               WHEN SQLCODE = ZERO                                      23568475
                   SET PS-FUT-RED-EVNT-FOUND TO TRUE                    23568575
                                                                        23568675
               WHEN SQLCODE = +100                                      23568775
                   SET PS-END-OF-CONCLR-CSR  TO TRUE                    23568875
                                                                        23568975
               WHEN OTHER                                               23569075
                   MOVE '2941-FET-FUT-CNTCLR-SKU-CSR'                   23569475
                                    TO XS047-ERROR-SECTION-NAME         23569875
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23569975
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23570075
                   PERFORM 9000-DISPLAY-ERRORS                          23570175
           END-EVALUATE.                                                23570275
                                                                        23570375
      ******************************************************************23570475
      * CLOSE FUTURE CONTINUED CLEARANCE AT THE SKU LEVEL CSR           23570575
      ******************************************************************23570675
       2942-CLS-FUT-CNTCLR-SKU-CSR.                                     23570775
                                                                        23570875
           EXEC SQL                                                     23570975
                CLOSE FUT-CNTCLR-SKU-CSR                                23571075
           END-EXEC.                                                    23571175
                                                                        23571275
           EVALUATE TRUE                                                23571375
               WHEN SQLCODE = +0                                        23571475
                   CONTINUE                                             23571575
                                                                        23571675
               WHEN OTHER                                               23571775
                   MOVE '2942-CLS-FUT-CNTCLR-SKU-CSR'                   23572175
                                    TO XS047-ERROR-SECTION-NAME         23572575
                   MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             23572675
                   MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    23572775
                   PERFORM 9000-DISPLAY-ERRORS                          23572875
           END-EVALUATE.                                                23572975
                                                                        23573075
      ******************************************************************23573175
      * APPLY YELLOW TICKET AND APPLY RED TICKET PRICE CHANGE IF        23573275
      * APPLICABLE.                                                     23573375
      ******************************************************************23573475
       3200-PROCESS-CLR-PRICE-CHANGE.                                   23573575
                                                                        23573675
           IF PS-WHITE-TKT-ITEM                                         23573975
               MOVE '30'                 TO PV-FUT-PERM-STATUS-CDE      23574075
               PERFORM 2260-DET-FUT-PERM-EVNT-CHGS                      23574175
               SET PS-YELLOW-TKT-APPLIED TO TRUE                        23574275
                                                                        23574375
               PERFORM 2900-CHECK-FOR-FUT-CNTCLR                        23574479
                                                                        23574579
               IF PS-FUT-RED-EVNT-FOUND                                 23574675
                                                                        23574784
      *            IF THE CONTINUED CLEARANCE EFFECTIVE DATE IS         23575075
      *            GREATER THAN THE YELLOW TICKET EFFECTIVE DATE        23575175
      *            APPLY THE RED TICKET (CONTINUED CLEARANCE) EVENT     23575275
      *                                                                 23575375
      *            WE DON'T WANT TO APPLY THE RED TICKET EVENT IF THE   23575475
      *            DATES ARE EQUAL (POS AND RF DO NOT DISPLAY THIS      23575575
      *            INFORMATION IN THE FUTURE).                          23575675
                                                                        23575775
                   IF PV-CONTCLR-PRCHG-EFF-DTE > XST00064-PRCHG-EFF-DTE 23576084
                       PERFORM 2250-CONTCLR-EDITS                       23576184
                       IF PS-VALID-FUT-TKT-EVNT                         23576284
                           PERFORM 2270-LOOK-FOR-RED-TKT-GRID           23576484
                           IF PS-NO-ERROR-FOUND                         23576584
                               PERFORM 2265-DET-CNTCLR-EVNT-CHGS        23576684
                           END-IF                                       23576784
                       END-IF                                           23576884
                   END-IF                                               23576984
               END-IF                                                   23577084
           ELSE                                                         23577191
      *        ITEM IS ALREADY YELLOW TICKET, TAKING YELLOW TO YELLOW   23577291
      *                                                                 23577391
      *        CONTINUED CLEARANCE (RED TICKETS) ARE NOT GOING TO       23577491
      *        BE TAKEN ON MK2 AND FNL PRICE CHANGES.  IF THIS EVER     23577591
      *        CHANGES, THE CODE BELOW COULD BE DELETED.  WE WOULD      23577691
      *        JUST EXECUTE THE CODE ABOVE THE ELSE FOR WHITE AND       23577791
      *        YELLOW TICKET MERCHANDISE.                               23577891
                                                                        23577991
               MOVE '30'                 TO PV-FUT-PERM-STATUS-CDE      23578091
               PERFORM 2260-DET-FUT-PERM-EVNT-CHGS                      23578191
               SET PS-YELLOW-TKT-APPLIED TO TRUE                        23578291
                                                                        23578484
           END-IF.                                                      23578584
                                                                        23578684
235300******************************************************************23578784
235400* VALIDATE THE FETCHED RECORD                                     23578884
235500******************************************************************23578984
235600 5000-VALIDATE-FETCHED-RECORD.                                    23579084
235700                                                                  23579157
235800     SET PS-DONT-FETCH-NEXT   TO TRUE.                            23580057
235900                                                                  23590057
236000     IF XS047-INCLD-UNADVERTISED-SW = 'Y'                         23600057
236100         PERFORM 5100-VALIDATE-STORE                              23610057
236200         IF PS-NO-ERROR-FOUND                                     23620057
236300             IF PS-NO-STORE-FOUND                                 23630057
236400                 SET PS-FETCH-NEXT    TO TRUE                     23640057
236500             END-IF                                               23650057
236600         END-IF                                                   23660057
236610     ELSE                                                         23661057
236620*        UNADVERTISED SHOULD NOT BE INCLUDED                      23662057
236630*        REG PROMO TYP CDE = A WHICH MEANS ADVERTISED             23663057
236640         IF XST00026-REG-PROMO-TYP-CDE = 'A'                      23664057
236650             IF XST00028-ADV-CDE = 'Y'                            23665057
236660                 PERFORM 5100-VALIDATE-STORE                      23666057
236670                 IF PS-NO-ERROR-FOUND                             23667057
236680                     IF PS-NO-STORE-FOUND                         23668057
236690                         SET PS-FETCH-NEXT TO TRUE                23669057
236700                     END-IF                                       23670057
236800                 END-IF                                           23680057
236900             ELSE                                                 23690057
237000*                THE PROMO ITEM IS UNAD TIED TO A PROMOTION       23700057
237100*                WHICH SHOULD NOT BE INCLUDED                     23710057
237200                 SET PS-FETCH-NEXT  TO TRUE                       23720057
237300             END-IF                                               23730057
237400         ELSE                                                     23740057
237500*            REG PROMO TYP CDE = U WHICH MEANS UNADVERTISED       23750057
237600             SET PS-FETCH-NEXT    TO TRUE                         23760057
237700         END-IF                                                   23770057
237800     END-IF.                                                      23780057
237900                                                                  23790057
238000     IF PS-DONT-FETCH-NEXT                                        23800057
238100         IF XS047-INCLD-PARTIAL-DAY-SW = 'Y'                      23810057
238200             CONTINUE                                             23820057
238300         ELSE                                                     23830057
238400*            PARTIAL DAY PROMOTIONS SHOULD NOT BE INCLUDED        23840057
238500             IF (PV-STRT-TM-HM = '00.00' AND                      23850057
238600                 PV-END-TM-HM  = '23.59')                         23860057
238700                 CONTINUE                                         23870057
238800             ELSE                                                 23880057
238900*                THE PROMOTION IS A PARTIAL DAY                   23890057
239000                 SET PS-FETCH-NEXT TO TRUE                        23900057
239100             END-IF                                               23910057
239200         END-IF                                                   23920057
239300     END-IF.                                                      23930057
239400                                                                  23940057
239500****************************************************************  23950057
239600* PRICING TYPE CODE VALUES                                        23960057
239700****************************************************************  23970057
239800*****                                                             23980057
239900*****  SIMPLE PRICE                                               23990057
240000*****                                                             24000057
240100*                  SPO = SIMPLE PERCENT OFF                       24010057
240200*                  SRP = SIMPLE REGULAR PRICE                     24020057
240300*                  SPP = SIMPLE PRICE POINT                       24030057
240400*                  MPP = COMPETITIVE PRICING (CONSIDERED SIMPLE)  24040057
240500*                  SAO = SIMPLE AMOUNT OFF                        24050057
240600*****                                                             24060057
240700*****  CLEARANCE SIMPLE PRICE ** GOLDSTAR **********************  24070057
240800*****                                                             24080057
240900*                  CPO = CLEARANCE PERCENT OFF                    24090057
241000*                  CPP = CLEARANCE PRICE POINT                    24100057
241100*                  CAO = CLEARANCE AMOUNT OFF                     24110057
241101*****                                                             24110157
241102*****  TIER PRICE                                                 24110257
241103*****                                                             24110357
241104*                  TAP = TIER THRESHOLD AMOUNT, PERCENT OFF       24110457
241105*                  TQP = TIER THRESHOLD QUANTITY, PERCENT OFF     24110557
241106*     (PHASE 2)    TAA = TIER THRESHOLD AMOUNT, AMOUNT OFF        24110657
241107*     (PHASE 2)    TQA = TIER THRESHOLD QUANTITY, AMOUNT OFF      24110757
241108*****                                                             24110857
241109*****  ADDITIONAL PRICE OFF (PHASE 2)                             24110957
241110*****                                                             24111057
241120*                  APO = ADDITIONAL PERCENT OFF                   24112057
241130*                  AAO = ADDITIONAL AMOUNT OFF                    24113057
241140*****                                                             24114057
241150***** GROUP PRICING                                               24115057
241160*****                                                             24116057
241170*                  GAO = GROUP AMOUNT OFF                         24117057
241171*                  GBL = GROUP BOGO (BUY ONE GET ONE FREE)        24117157
241172*                  GBD = GROUP BOGO DOLLAR                        24117257
241173*                  GBP = GROUP BOGO PERCENT                       24117357
241174*      (PHASE 2)   GPO = PERCENT OFF REGULAR GROUP PRICING        24117457
241175****************************************************************  24117557
241176     IF PS-DONT-FETCH-NEXT                                        24117657
241177         EVALUATE XST00028-PRICG-TYP-CDE                          24117757
241178             WHEN 'SPO'                                           24117857
241179             WHEN 'SRP'                                           24117957
241180             WHEN 'SPP'                                           24118057
241190             WHEN 'MPP'                                           24119057
241200             WHEN 'SAO'                                           24120057
241300                 PERFORM 7000-PROCESS-SIMPLE-PRICE                24130057
241400             WHEN 'CPO'                                           24140057
241500             WHEN 'CPP'                                           24150057
241600             WHEN 'CAO'                                           24160057
241700                 PERFORM 5300-CHECK-TICKET-COLOR                  24170057
241800             WHEN 'TAP'                                           24180057
241900             WHEN 'TQP'                                           24190057
242000*P2          WHEN 'TAA'                                           24200057
242100*P2          WHEN 'TQA'                                           24210057
242200                 IF XS047-INCLD-TIERED-PROMO-SW = 'Y'             24220057
242300                     PERFORM 7200-SELECT-TIER-PRICE               24230057
242400                 ELSE                                             24240057
242500                     SET PS-FETCH-NEXT TO TRUE                    24250057
242600                 END-IF                                           24260057
242700*P2          WHEN 'APO'                                           24270057
242800*P2          WHEN 'AAO'                                           24280057
242900*P2              IF XS047-INCLD-ADD-PCT-AMT-OFF-SW = 'Y'          24290057
243000*P2                  PERFORM 7300-SELECT-ADDL-PRICE-OFF           24300057
243100*P2              ELSE                                             24310057
243200*P2                  SET PS-FETCH-NEXT TO TRUE                    24320057
243300*P2              END-IF                                           24330057
243400             WHEN 'GAO'                                           24340057
243500             WHEN 'GBL'                                           24350057
243600             WHEN 'GBD'                                           24360057
243700             WHEN 'GBP'                                           24370057
243800*P2          WHEN 'GPO'                                           24380057
243900                 IF XS047-INCLD-PROMO-GRP-PRIC-SW = 'Y'           24390057
244000                     PERFORM 7400-SELECT-GRP-PRICE                24400057
244100                 ELSE                                             24410057
244200                     SET PS-FETCH-NEXT TO TRUE                    24420057
244300                 END-IF                                           24430057
244400****************************************************************  24440057
244500***** GIFT W/ PURCHASE ************** GIFT W/ PURCHASE *****      24450057
244600****************************************************************  24460057
244700*P2          WHEN 'GBQ'                                           24470057
244800*P2          WHEN 'GBA'                                           24480057
244900*P2          WHEN 'PBQ'                                           24490057
245000*P2          WHEN 'PBA'                                           24500057
245100*P2          WHEN 'GWP'                                           24510057
245200*P2          WHEN 'PGO'                                           24520057
245300*P2          WHEN 'PGA'                                           24530057
245400*P2          WHEN 'PGP'                                           24540057
245500*P2              IF XS047-INCLD-GWP-PWP-PROMO-SW = 'Y'            24550057
245600*P2                  PERFORM 7500-SELECT-GIFT-W-PURCHASE          24560057
245700*P2              ELSE                                             24570057
245800*P2                  SET PS-FETCH-NEXT TO TRUE                    24580057
245900*P2              END-IF                                           24590057
246000****************************************************************  24600057
246100******* NO PRICING FOUND ************* NO PRICING FOUND ********  24610057
246200****************************************************************  24620057
246300             WHEN OTHER                                           24630057
246400                 MOVE 'VALUE IN PRICG-TYP-CDE UNKNOWN '           24640057
246500                                  TO XS047-ERROR-SECTION-NAME     24650057
246600                 MOVE ZEROES      TO XS047-ERROR-SQL-CODE         24660057
246700                 MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND24670057
246800         END-EVALUATE                                             24680057
246900     END-IF.                                                      24690057
247000                                                                  24700057
247100******************************************************************24710057
247200* VALIDATE STORE GROUPS                                           24720057
247300******************************************************************24730057
247400 5100-VALIDATE-STORE.                                             24740057
247500                                                                  24750057
247600     PERFORM 5110-OPN-STANDARD-STR-GRP.                           24760057
247700     IF PS-NO-ERROR-FOUND                                         24770057
247800         PERFORM 5120-FET-STANDARD-STR-GRP                        24780057
247900     END-IF.                                                      24790057
248000     PERFORM 5140-CLS-STANDARD-STR-GRP.                           24800057
248100                                                                  24810057
248200     IF PS-NO-ERROR-FOUND                                         24820057
248300         IF PS-NO-STORE-FOUND                                     24830057
248400             PERFORM 5210-OPN-AD-HOC-STR-GRP                      24840057
248500             IF PS-NO-ERROR-FOUND                                 24850057
248600                 PERFORM 5220-FET-AD-HOC-STR-GRP                  24860057
248700             END-IF                                               24870057
248800             PERFORM 5240-CLS-AD-HOC-STR-GRP                      24880057
248900         END-IF                                                   24890057
249000     END-IF.                                                      24900057
249100                                                                  24910057
249200******************************************************************24920057
249300* OPENS STANDARD STORE GROUP CURSOR                               24930057
249400******************************************************************24940057
249500 5110-OPN-STANDARD-STR-GRP.                                       24950057
249600                                                                  24960057
249700     EXEC SQL                                                     24970057
249800          OPEN STD-STORE-GRP-CSR                                  24980057
249900     END-EXEC.                                                    24990057
250000                                                                  25000057
250100     EVALUATE TRUE                                                25010057
250200         WHEN SQLCODE = ZERO                                      25020057
250300             CONTINUE                                             25030057
250400                                                                  25040057
250500         WHEN OTHER                                               25050057
250600             MOVE '5110-OPN-STANDARD-STR-GRP '                    25060057
250700                              TO XS047-ERROR-SECTION-NAME         25070057
250800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             25080057
250900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    25090057
251000             PERFORM 9000-DISPLAY-ERRORS                          25100057
251100     END-EVALUATE.                                                25110057
251200                                                                  25120057
251300******************************************************************25130057
251400* FETCH STANDARD STORE GROUP CURSOR                               25140057
251500******************************************************************25150057
251600 5120-FET-STANDARD-STR-GRP.                                       25160057
251700                                                                  25170057
251800     EXEC SQL                                                     25180057
251900          FETCH STD-STORE-GRP-CSR                                 25190057
252000           INTO :PV-PROMO-STRT-TMST                               25200057
252100              , :PV-PROMO-END-TMST                                25210057
252200              , :XST00029-STR-SELN-HIER-CDE                       25220057
252300     END-EXEC.                                                    25230057
252400                                                                  25240057
252500     EVALUATE TRUE                                                25250057
252600         WHEN SQLCODE = +0                                        25260057
252700             SET PS-STORE-FOUND    TO TRUE                        25270057
252800                                                                  25280057
252900         WHEN SQLCODE = +100                                      25290057
253000             SET PS-NO-STORE-FOUND TO TRUE                        25300057
253100                                                                  25310057
253200         WHEN OTHER                                               25320057
253300             MOVE '5120-FET-STANDARD-STR-GRP'                     25330057
253400                                   TO XS047-ERROR-SECTION-NAME    25340057
253500             MOVE SQLCODE          TO XS047-ERROR-SQL-CODE        25350057
253600             MOVE 'N'            TO XS047-SUCCESSFUL-COMPLETE-IND 25360057
253700             PERFORM 9000-DISPLAY-ERRORS                          25370057
253800     END-EVALUATE.                                                25380057
253900                                                                  25390057
254000******************************************************************25400057
254100* CLOSE STANDARD STORE GROUP CURSOR                               25410057
254200******************************************************************25420057
254300 5140-CLS-STANDARD-STR-GRP.                                       25430057
254400                                                                  25440057
254500     EXEC SQL                                                     25450057
254600          CLOSE STD-STORE-GRP-CSR                                 25460057
254700     END-EXEC.                                                    25470057
254800                                                                  25480057
254900     EVALUATE TRUE                                                25490057
255000         WHEN SQLCODE = ZERO                                      25500057
255100             CONTINUE                                             25510057
255200                                                                  25520057
255300         WHEN OTHER                                               25530057
255400             MOVE '5140-CLS-STANDARD-STR-GRP '                    25540057
255500                              TO XS047-ERROR-SECTION-NAME         25550057
255600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             25560057
255700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    25570057
255800             PERFORM 9000-DISPLAY-ERRORS                          25580057
255900     END-EVALUATE.                                                25590057
256000                                                                  25600057
256100******************************************************************25610057
256200* OPEN AD-HOC STORE GROUPS CURSOR                                 25620057
256300******************************************************************25630057
256400 5210-OPN-AD-HOC-STR-GRP.                                         25640057
256500                                                                  25650057
256600     EXEC SQL                                                     25660057
256700          OPEN AD-HOC-STR-GRP-CSR                                 25670057
256800     END-EXEC.                                                    25680057
256900                                                                  25690057
257000     EVALUATE TRUE                                                25700057
257100         WHEN SQLCODE = ZERO                                      25710057
257200             CONTINUE                                             25720057
257300                                                                  25730057
257400         WHEN OTHER                                               25740057
257500             MOVE '5210-OPN-AD-HOC-STR-GRP '                      25750057
257600                              TO XS047-ERROR-SECTION-NAME         25760057
257700             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             25770057
257800             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    25780057
257900             PERFORM 9000-DISPLAY-ERRORS                          25790057
258000     END-EVALUATE.                                                25800057
258100                                                                  25810057
258200******************************************************************25820057
258300* FETCH AD-HOC STORE GROUPS CURSOR                                25830057
258400******************************************************************25840057
258500 5220-FET-AD-HOC-STR-GRP.                                         25850057
258600                                                                  25860057
258700     EXEC SQL                                                     25870057
258800          FETCH AD-HOC-STR-GRP-CSR                                25880057
258900           INTO :PV-PROMO-STRT-TMST                               25890057
259000              , :PV-PROMO-END-TMST                                25900057
259100              , :XST00031-STR-SELN-HIER-CDE                       25910057
259200     END-EXEC.                                                    25920057
259300                                                                  25930057
259400     EVALUATE TRUE                                                25940057
259500         WHEN SQLCODE = +0                                        25950057
259600             SET PS-STORE-FOUND    TO TRUE                        25960057
259700                                                                  25970057
259800         WHEN SQLCODE = +100                                      25980057
259900             SET PS-NO-STORE-FOUND TO TRUE                        25990057
260000                                                                  26000057
260100         WHEN OTHER                                               26010057
260200             MOVE '5220-FET-AD-HOC-STR-GRP'                       26020057
260300                                   TO XS047-ERROR-SECTION-NAME    26030057
260400             MOVE SQLCODE          TO XS047-ERROR-SQL-CODE        26040057
260500             MOVE 'N'            TO XS047-SUCCESSFUL-COMPLETE-IND 26050057
260600             PERFORM 9000-DISPLAY-ERRORS                          26060057
260700     END-EVALUATE.                                                26070057
260800                                                                  26080057
260900******************************************************************26090057
261000* CLOSE AD-HOC STORE GROUPS CURSOR                                26100057
261100******************************************************************26110057
261200 5240-CLS-AD-HOC-STR-GRP.                                         26120057
261300                                                                  26130057
261400     EXEC SQL                                                     26140057
261500          CLOSE AD-HOC-STR-GRP-CSR                                26150057
261600     END-EXEC.                                                    26160057
261700                                                                  26170057
261800     EVALUATE TRUE                                                26180057
261900         WHEN SQLCODE = ZERO                                      26190057
262000             CONTINUE                                             26200057
262100                                                                  26210057
262200         WHEN OTHER                                               26220057
262300             MOVE '5240-CLS-AD-HOC-STR-GRP '                      26230057
262400                              TO XS047-ERROR-SECTION-NAME         26240057
262500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             26250057
262600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    26260057
262700             PERFORM 9000-DISPLAY-ERRORS                          26270057
262800     END-EVALUATE.                                                26280057
262900                                                                  26290057
263000******************************************************************26300057
263100* GOLDSTARS CAN BE SET UP TO APPLY TO ALL CLEARANCE, ONLY         26310057
263200* CONTINUOUS CLEARANCE, OR TO ONLY FIRST-HIT CLEARANCE.           26320057
263300******************************************************************26330057
263400 5300-CHECK-TICKET-COLOR.                                         26340057
263500                                                                  26350057
263600     EVALUATE XST00028-TKT-CLOR-CDE                               26360057
263700****************************************************************  26370057
263800*****  ALL TYPES OF CLEARANCE RECEIVE THIS GOLDSTAR          ***  26380057
263900****************************************************************  26390057
264000         WHEN PC-ALL-TICKET                                       26400057
264100             PERFORM 7000-PROCESS-SIMPLE-PRICE                    26410057
264200                                                                  26420057
264300****************************************************************  26430057
264400*****  ONLY RED TICKET (CONTINUOUS) CLEARANCE ITEMS RECEIVE  ***  26440057
264500*****  THIS GOLDSTAR                                         ***  26450057
264600****************************************************************  26460057
264700         WHEN PC-RED-TICKET                                       26470057
264800             IF HV-UNT-RTL-CHG-DTE >                              26491087
264900                HV-UPC-STAT-CHG-DTE                               26492087
265000                 PERFORM 7000-PROCESS-SIMPLE-PRICE                26500057
265100             END-IF                                               26510057
265200                                                                  26520057
265300****************************************************************  26530057
265400*****  ONLY YELLOW TICKET (FIRST-HIT) CLEARANCE ITEMS        ***  26540057
265500*****  RECEIVE THIS GOLDSTAR                                 ***  26550057
265600****************************************************************  26560057
265700         WHEN PC-YELLOW-TICKET                                    26570057
265800             IF HV-UNT-RTL-CHG-DTE <=                             26591087
265900                HV-UPC-STAT-CHG-DTE                               26592087
266000                 PERFORM 7000-PROCESS-SIMPLE-PRICE                26600057
266100             END-IF                                               26610057
266200                                                                  26620057
266300****************************************************************  26630057
266400*****  A VALUE OTHER THAN ALL, RED, OR YELLOW TICKET WAS     ***  26640057
266500*****  PLACED IN THE XST_MDSE_LNE_SELN TABLE FOR THIS        ***  26650057
266600*****  GOLDSTAR                                                   26660057
266700****************************************************************  26670057
266800         WHEN OTHER                                               26680057
266900             MOVE SPACES TO XS047-ERROR-SECTION-NAME              26690057
267000             STRING '5300-CHECK-TICKET-COLOR '                    26700057
267100                XST00028-TKT-CLOR-CDE                             26710057
267200                ' '                                               26720057
267300                DELIMITED BY SIZE                                 26730057
267400                INTO XS047-ERROR-SECTION-NAME                     26740057
267500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    26750057
267600             PERFORM 9000-DISPLAY-ERRORS                          26760057
267700                                                                  26770057
267800     END-EVALUATE.                                                26780057
267900                                                                  26790057
268000******************************************************************26800057
268100* CHECK IF EXCLUSIONS EXIST                                       26810057
268200******************************************************************26820057
268300 6000-CHECK-FOR-EXCLUSIONS.                                       26830057
268400                                                                  26840057
268500     SET PS-NO-EXCL-FOUND     TO TRUE.                            26850057
268600     PERFORM 6100-DO-EXCLUSIONS-EXIST.                            26860057
268700                                                                  26870057
268800     IF PS-NO-ERROR-FOUND                                         26880057
268900         IF PS-EXCL-EXISTS                                        26890057
269000             EVALUATE TRUE                                        26900057
269100                 WHEN PS-HIER-DPT-CDE                             26910057
269200                     PERFORM 6200-MAJOR-CLASS-EXCLUSION           26920057
269300                     IF PS-NO-ERROR-FOUND                         26930057
269400                         IF PS-NO-EXCL-FOUND                      26940057
269500                             PERFORM 6300-SUB-CLASS-EXCLUSION     26950057
269600                         END-IF                                   26960057
269700                     END-IF                                       26970057
269800                     IF PS-NO-ERROR-FOUND                         26980057
269900                         IF PS-NO-EXCL-FOUND                      26990057
270000                             PERFORM 6400-STYLE-EXCLUSION         27000057
270100                         END-IF                                   27010057
270200                     END-IF                                       27020057
270300                     IF PS-NO-ERROR-FOUND                         27030057
270400                         IF PS-NO-EXCL-FOUND                      27040057
270500                             PERFORM 6500-SKU-EXCLUSION           27050057
270600                         END-IF                                   27060057
270700                     END-IF                                       27070057
270800                                                                  27080057
270900                 WHEN PS-HIER-MCL-CDE                             27090057
271000                     PERFORM 6300-SUB-CLASS-EXCLUSION             27100057
271100                     IF PS-NO-ERROR-FOUND                         27110057
271200                       IF PS-NO-EXCL-FOUND                        27120057
271300                           PERFORM 6400-STYLE-EXCLUSION           27130057
271400                       END-IF                                     27140057
271500                     END-IF                                       27150057
271600                     IF PS-NO-ERROR-FOUND                         27160057
271700                         IF PS-NO-EXCL-FOUND                      27170057
271800                             PERFORM 6500-SKU-EXCLUSION           27180057
271900                         END-IF                                   27190057
272000                     END-IF                                       27200057
272100                                                                  27210057
272200                 WHEN PS-HIER-SCL-CDE                             27220057
272300                     PERFORM 6400-STYLE-EXCLUSION                 27230057
272400                     IF PS-NO-ERROR-FOUND                         27240057
272500                         IF PS-NO-EXCL-FOUND                      27250057
272600                             PERFORM 6500-SKU-EXCLUSION           27260057
272700                         END-IF                                   27270057
272800                     END-IF                                       27280057
272900                                                                  27290057
273000                 WHEN PS-HIER-STY-CDE                             27300057
273100                     PERFORM 6500-SKU-EXCLUSION                   27310057
273200                                                                  27320057
273300                 WHEN PS-HIER-SKU-CDE                             27330057
273400                     CONTINUE                                     27340057
273500             END-EVALUATE                                         27350057
273600         END-IF                                                   27360057
273700     END-IF.                                                      27370057
273800                                                                  27380057
273900******************************************************************27390057
274000* CHECK IF EXCLUSIONS EXIST OR NOT                                27400057
274100******************************************************************27410057
274200 6100-DO-EXCLUSIONS-EXIST.                                        27420057
274300                                                                  27430057
274400     EXEC SQL                                                     27440057
274500         SELECT 1                                                 27450057
274600           INTO :PV-EXCL-EXISTS                                   27460057
274700           FROM XST_EXCL_MDSE E                                   27470057
274800          WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID   27480057
274900            AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID      27490057
275000            AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID     27500057
275100            AND E.STAT_CDE           = 'S'                        27510057
275200          FETCH FIRST ROW ONLY                                    27520057
275300          WITH UR                                                 27530057
275400     END-EXEC.                                                    27540057
275500                                                                  27550057
275600     EVALUATE TRUE                                                27560057
275700         WHEN SQLCODE = +0                                        27570057
275800             SET PS-EXCL-EXISTS TO TRUE                           27580057
275900                                                                  27590057
276000         WHEN SQLCODE = +100                                      27600057
276100             SET PS-NO-EXCL-EXISTS TO TRUE                        27610057
276200                                                                  27620057
276300         WHEN OTHER                                               27630057
276400             MOVE '6100-DO-EXCLUSIONS-EXIST      '                27640057
276500                              TO XS047-ERROR-SECTION-NAME         27650057
276600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             27660057
276700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    27670057
276800             PERFORM 9000-DISPLAY-ERRORS                          27680057
276900     END-EVALUATE.                                                27690057
277000                                                                  27700057
277100******************************************************************27710057
277200* CHECK IF EXCLUSIONS AT MAJOR CLASS                              27720057
277300******************************************************************27730057
277400 6200-MAJOR-CLASS-EXCLUSION.                                      27740057
277500                                                                  27750057
277600     EXEC SQL                                                     27760057
277700          SELECT 1                                                27770057
277800            INTO :PV-EXCL-EXISTS                                  27780057
277900            FROM XST_EXCL_MDSE E                                  27790057
278000           WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  27800057
278100             AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     27810057
278200             AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    27820057
278300             AND E.STAT_CDE           = 'S'                       27830057
278400             AND E.MAJ_CL_NBR         = :XST00013-MAJ-CL-NBR      27840057
278500             AND E.MDSE_HIER_CDE      = 'MCL'                     27850057
278600          FETCH FIRST ROW ONLY                                    27860057
278700            WITH UR                                               27870057
278800     END-EXEC.                                                    27880057
278900                                                                  27890057
279000     EVALUATE TRUE                                                27900057
279100         WHEN SQLCODE = +0                                        27910057
279200             SET PS-EXCL-FOUND TO TRUE                            27920057
279300                                                                  27930057
279400         WHEN SQLCODE = +100                                      27940057
279500             CONTINUE                                             27950057
279600                                                                  27960057
279700         WHEN OTHER                                               27970057
279800             MOVE '6200-MAJOR-CLASS-EXCLUSION    '                27980057
279900                              TO XS047-ERROR-SECTION-NAME         27990057
280000             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             28000057
280100             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    28010057
280200             PERFORM 9000-DISPLAY-ERRORS                          28020057
280300     END-EVALUATE.                                                28030057
280400                                                                  28040057
280500******************************************************************28050057
280600* CHECK IF EXCLUSIONS AT SUB CLASS                                28060057
280700******************************************************************28070057
280800 6300-SUB-CLASS-EXCLUSION.                                        28080057
280900                                                                  28090057
281000     EXEC SQL                                                     28100057
281100          SELECT 1                                                28110057
281200            INTO :PV-EXCL-EXISTS                                  28120057
281300            FROM XST_EXCL_MDSE E                                  28130057
281400           WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  28140057
281500             AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     28150057
281600             AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    28160057
281700             AND E.STAT_CDE           = 'S'                       28170057
281800             AND E.MAJ_CL_NBR         = :XST00013-MAJ-CL-NBR      28180057
281900             AND E.SUB_CL_NBR         = :XST00013-SUB-CL-NBR      28190057
282000             AND E.MDSE_HIER_CDE      = 'SCL'                     28200057
282100          FETCH FIRST ROW ONLY                                    28210057
282200            WITH UR                                               28220057
282300     END-EXEC.                                                    28230057
282400                                                                  28240057
282500     EVALUATE TRUE                                                28250057
282600         WHEN SQLCODE = +0                                        28260057
282700             SET PS-EXCL-FOUND TO TRUE                            28270057
282800                                                                  28280057
282900         WHEN SQLCODE = +100                                      28290057
283000             CONTINUE                                             28300057
283100                                                                  28310057
283200         WHEN OTHER                                               28320057
283300             MOVE '6300-SUB-CLASS-EXCLUSION      '                28330057
283400                              TO XS047-ERROR-SECTION-NAME         28340057
283500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             28350057
283600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    28360057
283700             PERFORM 9000-DISPLAY-ERRORS                          28370057
283800     END-EVALUATE.                                                28380057
283900                                                                  28390057
284000******************************************************************28400057
284100* CHECK IF EXCLUSIONS AT STYLE                                    28410057
284200******************************************************************28420057
284300 6400-STYLE-EXCLUSION.                                            28430057
284400                                                                  28440057
284500     EXEC SQL                                                     28450057
284600          SELECT 1                                                28460057
284700            INTO :PV-EXCL-EXISTS                                  28470057
284800            FROM XST_EXCL_MDSE E                                  28480057
284900           WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  28490057
285000             AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     28500057
285100             AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    28510057
285200             AND E.STAT_CDE           = 'S'                       28520057
285500             AND E.STYL_ID            = :XST00010-STYL-ID         28550057
285600             AND E.MDSE_HIER_CDE      = 'STY'                     28560057
285700          FETCH FIRST ROW ONLY                                    28570057
285800            WITH UR                                               28580057
285900     END-EXEC.                                                    28590057
286000                                                                  28600057
286100     EVALUATE TRUE                                                28610057
286200         WHEN SQLCODE = +0                                        28620057
286300             SET PS-EXCL-FOUND TO TRUE                            28630057
286400                                                                  28640057
286500         WHEN SQLCODE = +100                                      28650057
286600             CONTINUE                                             28660057
286700                                                                  28670057
286800         WHEN OTHER                                               28680057
286900             MOVE '6400-STYLE-EXCLUSION          '                28690057
287000                              TO XS047-ERROR-SECTION-NAME         28700057
287100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             28710057
287200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    28720057
287300             PERFORM 9000-DISPLAY-ERRORS                          28730057
287400     END-EVALUATE.                                                28740057
287500                                                                  28750057
287600******************************************************************28760057
287700* CHECK IF EXCLUSIONS AT SKU                                      28770057
287800******************************************************************28780057
287900 6500-SKU-EXCLUSION.                                              28790057
288000                                                                  28800057
288100     EXEC SQL                                                     28810057
288200          SELECT 1                                                28820057
288300            INTO :PV-EXCL-EXISTS                                  28830057
288400            FROM XST_EXCL_MDSE E                                  28840057
288500           WHERE E.PROMO_INTFC_ID     = :XST00028-PROMO-INTFC-ID  28850057
288600             AND E.MDSE_LNE_ID        = :XST00028-MDSE-LNE-ID     28860057
288700             AND E.PROMO_INTFC_SUB_ID = :PV-PROMO-INTFC-SUB-ID    28870057
288800             AND E.STAT_CDE           = 'S'                       28880057
288900             AND E.SKU_NBR            = :XST00010-SKU-NBR         28890057
289000             AND E.MDSE_HIER_CDE      = 'SKU'                     28900057
289010          FETCH FIRST ROW ONLY                                    28901057
289020            WITH UR                                               28902057
289030     END-EXEC.                                                    28903057
289040                                                                  28904057
289050     EVALUATE TRUE                                                28905057
289060         WHEN SQLCODE = +0                                        28906057
289070             SET PS-EXCL-FOUND TO TRUE                            28907057
289080                                                                  28908057
289090         WHEN SQLCODE = +100                                      28909057
289100             CONTINUE                                             28910057
289200                                                                  28920057
289300         WHEN OTHER                                               28930057
289400             MOVE '6500-SKU-EXCLUSION            '                28940057
289500                              TO XS047-ERROR-SECTION-NAME         28950057
289600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             28960057
289700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    28970057
289800             PERFORM 9000-DISPLAY-ERRORS                          28980057
289900     END-EVALUATE.                                                28990057
290000                                                                  29000057
290100******************************************************************29010057
290200* PROCESS SIMPLE PRICE                                            29020057
290300******************************************************************29030057
290400 7000-PROCESS-SIMPLE-PRICE.                                       29040057
290500                                                                  29050057
290600     PERFORM 7100-SELECT-SIMPLE-PRICE.                            29060057
290700                                                                  29070057
290800     IF PS-NO-ERROR-FOUND                                         29080057
290900         IF PS-SIMPLE-PRICE-FOUND                                 29090057
291000             MOVE ZEROES                TO PV-PROMO-INTFC-SUB-ID  29100057
291100             PERFORM 6000-CHECK-FOR-EXCLUSIONS                    29110057
291200             IF PS-NO-ERROR-FOUND                                 29120057
291300                 IF PS-EXCL-FOUND                                 29130057
291400                     SET PS-FETCH-NEXT          TO TRUE           29140057
291500                 ELSE                                             29150057
291600                     PERFORM 8010-POPULATE-BRM-LINKAGE            29160057
291700                 END-IF                                           29170057
291800             END-IF                                               29180057
291900         END-IF                                                   29190057
292000     END-IF.                                                      29200057
292100                                                                  29210057
292200******************************************************************29220057
292300* SELECT SIMPLE PRICE                                             29230057
292400******************************************************************29240057
292500 7100-SELECT-SIMPLE-PRICE.                                        29250057
292600                                                                  29260057
292700     EXEC SQL                                                     29270057
292800          SELECT DISC_PRCG_AMT                                    29280057
292900            INTO :XST00030-DISC-PRCG-AMT                          29290057
293000            FROM XST_SMP_PRICG                                    29300057
293100           WHERE PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID        29310057
293200             AND MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID           29320057
293300             AND STAT_CDE       = 'S'                             29330057
293400            WITH UR                                               29340057
293500     END-EXEC.                                                    29350057
293600                                                                  29360057
293700     EVALUATE TRUE                                                29370057
293800         WHEN SQLCODE = +0                                        29380057
293900             MOVE XST00030-DISC-PRCG-AMT TO PV-DISC-PRCG-AMT      29390057
294000             SET PS-SIMPLE-PRICE-FOUND   TO TRUE                  29400057
294100                                                                  29410057
294200         WHEN SQLCODE = +100                                      29420057
294300             SET PS-SIMPLE-PRICE-NOT-FOUND TO TRUE                29430057
294400                                                                  29440057
294500         WHEN OTHER                                               29450057
294600             MOVE '7100-SELECT-SIMPLE-PRICE      '                29460057
294700                              TO XS047-ERROR-SECTION-NAME         29470057
294800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             29480057
294900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    29490057
295000             PERFORM 9000-DISPLAY-ERRORS                          29500057
295100     END-EVALUATE.                                                29510057
295200                                                                  29520057
295300******************************************************************29530057
295400* SELECT TIER PRICING                                             29540057
295500******************************************************************29550057
295600 7200-SELECT-TIER-PRICE.                                          29560057
295700                                                                  29570057
295800     SET PS-NOT-END-OF-TIER-CSR TO TRUE.                          29580057
295900     SET PS-FIRST-TIER-ROW      TO TRUE.                          29590057
296000                                                                  29600057
296100     EVALUATE XST00028-PRICG-TYP-CDE                              29610057
296200         WHEN 'TAP'                                               29620057
296300             PERFORM 7210-SELECT-TAP-PRICE                        29630057
296400         WHEN 'TQP'                                               29640057
296500             PERFORM 7220-SELECT-TQP-PRICE                        29650057
296600*P2      WHEN 'TAA'                                               29660057
296700*P2          PERFORM 7230-SELECT-TAA-PRICE                        29670057
296800*P2      WHEN 'TQA'                                               29680057
296900*P2          PERFORM 7240-SELECT-TQA-PRICE                        29690057
297000     END-EVALUATE.                                                29700057
297100                                                                  29710057
297200******************************************************************29720057
297300* SELECT (TAP) TIER PRICING                                       29730057
297400******************************************************************29740057
297500 7210-SELECT-TAP-PRICE.                                           29750057
297600                                                                  29760057
297700     PERFORM 7211-OPN-TAP-PRICE-CSR.                              29770057
297800     IF PS-NO-ERROR-FOUND                                         29780057
297900         PERFORM 7212-FET-TAP-PRICE-CSR                           29790057
298000     END-IF.                                                      29800057
298100     PERFORM 7213-PROCESS-TAP-PRICE                               29810057
298200         UNTIL PS-END-OF-TIER-CSR                                 29820057
298300            OR PS-FETCH-NEXT                                      29830057
298400            OR PS-ERROR-FOUND.                                    29840057
298500     PERFORM 7214-CLS-TAP-PRICE-CSR.                              29850057
298600                                                                  29860057
298700******************************************************************29870057
298800* OPEN (TAP) TIER PRICING                                         29880057
298810******************************************************************29881057
298820 7211-OPN-TAP-PRICE-CSR.                                          29882057
298830                                                                  29883057
298840     EXEC SQL                                                     29884057
298850          OPEN TAP-TIER-CSR                                       29885057
298860     END-EXEC.                                                    29886057
298870                                                                  29887057
298880     EVALUATE TRUE                                                29888057
298890         WHEN SQLCODE = ZERO                                      29889057
298900             CONTINUE                                             29890057
299000                                                                  29900057
299100         WHEN OTHER                                               29910057
299200             MOVE '7211-OPN-TAP-TIER-CSR  '                       29920057
299300                              TO XS047-ERROR-SECTION-NAME         29930057
299400             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             29940057
299500             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    29950057
299600             PERFORM 9000-DISPLAY-ERRORS                          29960057
299700     END-EVALUATE.                                                29970057
299800                                                                  29980057
299900******************************************************************29990057
300000* FETCH (TAP) TIER PRICING                                        30000057
300100******************************************************************30010057
300200 7212-FET-TAP-PRICE-CSR.                                          30020057
300300                                                                  30030057
300400     EXEC SQL                                                     30040057
300500          FETCH TAP-TIER-CSR                                      30050057
300600           INTO :XST00035-PROMO-INTFC-SUB-ID                      30060057
300700              , :XST00035-THRS-AMT                                30070057
300800              , :XST00035-DISC-PCT                                30080057
300900     END-EXEC.                                                    30090057
301000                                                                  30100057
301100     EVALUATE TRUE                                                30110057
301200         WHEN SQLCODE = +0                                        30120057
301300             CONTINUE                                             30130057
301400                                                                  30140057
301500         WHEN SQLCODE = +100                                      30150057
301600             SET PS-END-OF-TIER-CSR  TO TRUE                      30160057
301700                                                                  30170057
301800         WHEN OTHER                                               30180057
301900             MOVE '7212-FET-TAP-PRICE-CSR   '                     30190057
302000                              TO XS047-ERROR-SECTION-NAME         30200057
302100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             30210057
302200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    30220057
302300             PERFORM 9000-DISPLAY-ERRORS                          30230057
302400     END-EVALUATE.                                                30240057
302500                                                                  30250057
302600******************************************************************30260057
302700* PROCESS (TAP) TIER PRICING                                      30270057
302800******************************************************************30280057
302900 7213-PROCESS-TAP-PRICE.                                          30290057
303000                                                                  30300057
303100     PERFORM 7299-TIER-PROCESS.                                   30310057
303200                                                                  30320057
303300     IF PS-NO-ERROR-FOUND                                         30330057
303400       IF PS-DONT-FETCH-NEXT                                      30340057
303500           PERFORM 7212-FET-TAP-PRICE-CSR                         30350057
303600       END-IF                                                     30360057
303700     END-IF.                                                      30370057
303800                                                                  30380057
303900******************************************************************30390057
304000* CLOSE (TAP) TIER PRICING                                        30400057
304100******************************************************************30410057
304200 7214-CLS-TAP-PRICE-CSR.                                          30420057
304300                                                                  30430057
304400     EXEC SQL                                                     30440057
304500          CLOSE TAP-TIER-CSR                                      30450057
304600     END-EXEC.                                                    30460057
304700                                                                  30470057
304800     EVALUATE TRUE                                                30480057
304900         WHEN SQLCODE = ZERO                                      30490057
305000             CONTINUE                                             30500057
305100                                                                  30510057
305200         WHEN OTHER                                               30520057
305300             MOVE '7214-CLS-TAP-TIER-CSR  '                       30530057
305400                              TO XS047-ERROR-SECTION-NAME         30540057
305500             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             30550057
305600             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    30560057
305700             PERFORM 9000-DISPLAY-ERRORS                          30570057
305800     END-EVALUATE.                                                30580057
305900                                                                  30590057
306000******************************************************************30600057
306100* SELECT (TQP) TIER PRICING                                       30610057
306200******************************************************************30620057
306300 7220-SELECT-TQP-PRICE.                                           30630057
306400                                                                  30640057
306500     PERFORM 7221-OPN-TQP-PRICE-CSR.                              30650057
306600     IF PS-NO-ERROR-FOUND                                         30660057
306700         PERFORM 7222-FET-TQP-PRICE-CSR                           30670057
306800     END-IF.                                                      30680057
306900     PERFORM 7223-PROCESS-TQP-PRICE                               30690057
307000         UNTIL PS-END-OF-TIER-CSR                                 30700057
307100            OR PS-FETCH-NEXT                                      30710057
307200            OR PS-ERROR-FOUND.                                    30720057
307300     PERFORM 7224-CLS-TQP-PRICE-CSR.                              30730057
307400                                                                  30740057
307500******************************************************************30750057
307600* OPEN (TQP) TIER PRICING                                         30760057
307700******************************************************************30770057
307800 7221-OPN-TQP-PRICE-CSR.                                          30780057
307900                                                                  30790057
308000     EXEC SQL                                                     30800057
308100          OPEN TQP-TIER-CSR                                       30810057
308200     END-EXEC.                                                    30820057
308300                                                                  30830057
308400     EVALUATE TRUE                                                30840057
308500         WHEN SQLCODE = ZERO                                      30850057
308600             CONTINUE                                             30860057
308700                                                                  30870057
308800         WHEN OTHER                                               30880057
308900             MOVE '7221-OPN-TQP-TIER-CSR  '                       30890057
309000                              TO XS047-ERROR-SECTION-NAME         30900057
309100             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             30910057
309200             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    30920057
309300             PERFORM 9000-DISPLAY-ERRORS                          30930057
309400     END-EVALUATE.                                                30940057
309500                                                                  30950057
309600******************************************************************30960057
309700* FETCH (TQP) TIER PRICING                                        30970057
309800******************************************************************30980057
309900 7222-FET-TQP-PRICE-CSR.                                          30990057
310000                                                                  31000057
310100     EXEC SQL                                                     31010057
310200          FETCH TQP-TIER-CSR                                      31020057
310300           INTO :XST00035-PROMO-INTFC-SUB-ID                      31030057
310400              , :XST00035-THRS-QTY                                31040057
310500              , :XST00035-DISC-PCT                                31050057
310600     END-EXEC.                                                    31060057
310700                                                                  31070057
310800     EVALUATE TRUE                                                31080057
310900         WHEN SQLCODE = +0                                        31090057
311000             CONTINUE                                             31100057
311100                                                                  31110057
311200         WHEN SQLCODE = +100                                      31120057
311300             SET PS-END-OF-TIER-CSR  TO TRUE                      31130057
311400                                                                  31140057
311500         WHEN OTHER                                               31150057
311600             MOVE '7222-FET-TQP-PRICE-CSR   '                     31160057
311700                              TO XS047-ERROR-SECTION-NAME         31170057
311800             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             31180057
311900             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    31190057
312000             PERFORM 9000-DISPLAY-ERRORS                          31200057
312100     END-EVALUATE.                                                31210057
312200                                                                  31220057
312300******************************************************************31230057
312400* PROCESS (TQP) TIER PRICING                                      31240057
312500******************************************************************31250057
312600 7223-PROCESS-TQP-PRICE.                                          31260057
312700                                                                  31270057
312800     PERFORM 7299-TIER-PROCESS.                                   31280057
312900                                                                  31290057
313000     IF PS-NO-ERROR-FOUND                                         31300057
313100         IF PS-DONT-FETCH-NEXT                                    31310057
313200             PERFORM 7222-FET-TQP-PRICE-CSR                       31320057
313300         END-IF                                                   31330057
313400     END-IF.                                                      31340057
313500                                                                  31350057
313600******************************************************************31360057
313700* CLOSE (TQP) TIER PRICING                                        31370057
313800******************************************************************31380057
313810 7224-CLS-TQP-PRICE-CSR.                                          31381057
313820                                                                  31382057
313830     EXEC SQL                                                     31383057
313840          CLOSE TQP-TIER-CSR                                      31384057
313850     END-EXEC.                                                    31385057
313860                                                                  31386057
313870     EVALUATE TRUE                                                31387057
313880         WHEN SQLCODE = ZERO                                      31388057
313890             CONTINUE                                             31389057
313900                                                                  31390057
314000         WHEN OTHER                                               31400057
314100             MOVE '7224-CLS-TQP-TIER-CSR  '                       31410057
314200                              TO XS047-ERROR-SECTION-NAME         31420057
314300             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             31430057
314400             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    31440057
314500             PERFORM 9000-DISPLAY-ERRORS                          31450057
314600     END-EVALUATE.                                                31460057
314700                                                                  31470057
314800******************************************************************31480057
314900*                                                                 31490057
315000******************************************************************31500057
315100 7299-TIER-PROCESS.                                               31510057
315200                                                                  31520057
315300     IF PS-FIRST-TIER-ROW                                         31530057
315400         MOVE XST00035-PROMO-INTFC-SUB-ID                         31540057
315500                                        TO PV-PROMO-INTFC-SUB-ID  31550057
315600         PERFORM 6000-CHECK-FOR-EXCLUSIONS                        31560057
315700         IF PS-NO-ERROR-FOUND                                     31570057
315800             IF PS-EXCL-FOUND                                     31580057
315900                 SET PS-FETCH-NEXT          TO TRUE               31590057
316000             ELSE                                                 31600057
316100                 PERFORM 8010-POPULATE-BRM-LINKAGE                31610057
316200                 SET PS-NOT-FIRST-TIER-ROW  TO TRUE               31620057
316300                 SET XS045-ELIG-TIER-INDEX  TO 1                  31630057
316400             END-IF                                               31640057
316500         END-IF                                                   31650057
316600     ELSE                                                         31660057
316700         SET XS045-ELIG-TIER-INDEX UP BY 1                        31670057
316800     END-IF.                                                      31680057
316900                                                                  31690057
317000     IF PS-NO-ERROR-FOUND                                         31700057
317010         IF PS-DONT-FETCH-NEXT                                    31701057
317020             PERFORM 8020-POPULATE-TIER-TABLE                     31702057
317030         END-IF                                                   31703057
317040     END-IF.                                                      31704057
317050                                                                  31705057
317060******************************************************************31706057
317070* SELECT GROUP PRICING                                            31707057
317080******************************************************************31708057
317090 7400-SELECT-GRP-PRICE.                                           31709057
317100                                                                  31710057
317101     PERFORM 7410-SELECT-PRICE.                                   31710157
317102     IF PS-GROUP-PRICE-FOUND                                      31710257
317103         MOVE ZEROES                    TO PV-PROMO-INTFC-SUB-ID  31710357
317104         PERFORM 6000-CHECK-FOR-EXCLUSIONS                        31710457
317105         IF PS-NO-ERROR-FOUND                                     31710557
317106             IF PS-EXCL-FOUND                                     31710657
317107                 SET PS-FETCH-NEXT          TO TRUE               31710757
317108             ELSE                                                 31710857
317109                 PERFORM 8010-POPULATE-BRM-LINKAGE                31710957
317110             END-IF                                               31711057
317120         END-IF                                                   31712057
317130     END-IF.                                                      31713057
317140                                                                  31714057
317150******************************************************************31715057
317160* SELECT GAO, GBL, GBD, & GBP PRICE                               31716057
317170******************************************************************31717057
317180 7410-SELECT-PRICE.                                               31718057
317190                                                                  31719057
317200     EXEC SQL                                                     31720057
317300          SELECT DISC_GP_QTY                                      31730057
317400               , DISC_PRCG_AMT                                    31740057
317500            INTO :XST00030-DISC-GP-QTY                            31750057
317600               , :XST00030-DISC-PRCG-AMT                          31760057
317700            FROM XST_SMP_PRICG                                    31770057
317800           WHERE PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID        31780057
317900             AND MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID           31790057
318000             AND STAT_CDE       = 'S'                             31800057
318100            WITH UR                                               31810057
318200     END-EXEC.                                                    31820057
318300                                                                  31830057
318400     EVALUATE TRUE                                                31840057
318500         WHEN SQLCODE = +0                                        31850057
318600             MOVE XST00030-DISC-GP-QTY TO PV-DISC-GP-QTY          31860057
318700             MOVE XST00030-DISC-PRCG-AMT TO PV-DISC-PRCG-AMT      31870057
318800             SET PS-GROUP-PRICE-FOUND    TO TRUE                  31880057
318900                                                                  31890057
319000         WHEN SQLCODE = +100                                      31900057
319100             SET PS-GROUP-PRICE-NOT-FOUND TO TRUE                 31910057
319200                                                                  31920057
319300         WHEN OTHER                                               31930057
319400             MOVE '7410-SELECT-PRICE             '                31940057
319500                              TO XS047-ERROR-SECTION-NAME         31950057
319600             MOVE SQLCODE     TO XS047-ERROR-SQL-CODE             31960057
319700             MOVE 'N'         TO XS047-SUCCESSFUL-COMPLETE-IND    31970057
319800             PERFORM 9000-DISPLAY-ERRORS                          31980057
319900     END-EVALUATE.                                                31990057
320000                                                                  32000057
320100***************************************************************** 32010057
320200* SELECT GIFT W/ PURCHASE PRICE                                   32020057
320300***************************************************************** 32030057
320400*7500-SELECT-GIFT-W-PURCHASE.                                     32040057
320500*P2                                                               32050057
320600*P2  EVALUATE XST00028-PRICG-TYP-CDE                              32060057
320700*P2      WHEN 'GBQ'                                               32070057
320800*P2          PERFORM 7410-SELECT-GBQ-PRICE                        32080057
320900*P2      WHEN 'GBA'                                               32090057
321000*P2          PERFORM 7420-SELECT-GBA-PRICE                        32100057
321100*P2      WHEN 'PBQ'                                               32110057
321200*P2          PERFORM 7430-SELECT-PBQ-PRICE                        32120057
321300*P2      WHEN 'PBA'                                               32130057
321400*P2          PERFORM 7440-SELECT-PBA-PRICE                        32140057
321500*P2      WHEN 'GWP'                                               32150057
321600*P2          PERFORM 7450-SELECT-GWP-PRICE                        32160057
321700*P2      WHEN 'PGO'                                               32170057
321800*P2          PERFORM 7460-SELECT-PGO-PRICE                        32180057
321900*P2      WHEN 'PGA'                                               32190057
322000*P2          PERFORM 7470-SELECT-PGA-PRICE                        32200057
322100*P2      WHEN 'PGP'                                               32210057
322200*P2          PERFORM 7480-SELECT-PGP-PRICE                        32220057
322300*P2  END-EVALUATE.                                                32230057
322400*P2                                                               32240057
322500******************************************************************32250057
322600* MOVE VALUES TO BASE BUSINESS RULES LINKAGE SECTION              32260057
322700******************************************************************32270057
322800 8000-POPULATE-BASE-BRM-LINKAGE.                                  32280057
322900                                                                  32290057
323000     MOVE XS047-STR           TO XS045-STORE.                     32300057
323100     MOVE XS047-DTE           TO XS045-DATE.                      32310057
323200     MOVE XST00008-INTR-UPC-ID                                    32320057
323300                              TO XS045-INTR-UPC-ID.               32330057
323400     MOVE XS047-INCLD-LST-SIX-WK-PRIC-SW                          32340057
323500                              TO XS045-LWST-SIX-WK-NEEDED-IND.    32350057
323600                                                                  32360057
323700     MOVE HV-UNT-RTL-AMT      TO XS045-RGLR-PRICE.                32370057
323800     MOVE HV-GP-RTL-QTY       TO XS045-REG-GRP-PRICG-QTY.         32380057
323900     MOVE HV-GP-RTL-AMT       TO XS045-REG-GRP-PRICG-DLR.         32390057
324000                                                                  32400057
324100******************************************************************32410057
324200* MOVE VALUES TO BUSINESS RULES LINKAGE SECTION                   32420057
324300******************************************************************32430057
324400 8010-POPULATE-BRM-LINKAGE.                                       32440057
324500                                                                  32450057
324600     SET PS-PROMO-PRICG-FOUND TO TRUE.                            32460057
324700     ADD 1                    TO PV-INDEX.                        32470057
324800     MOVE XST00028-PROMO-ID   TO XS045-ELIG-PROMO-ID(PV-INDEX).   32480057
324900     MOVE XST00028-PROMO-INTFC-ID                                 32490057
325000                              TO XS045-ELIG-PROMO-INTFC-ID        32500057
325100                                     (PV-INDEX).                  32510057
325200     MOVE PV-PROMO-STRT-TMST  TO XS045-PROMO-STRT-DTE(PV-INDEX).  32520057
325300     MOVE PV-PROMO-END-TMST   TO XS045-PROMO-END-DTE(PV-INDEX).   32530057
325400     MOVE XST00028-PRICG-TYP-CDE                                  32540057
325500                              TO XS045-PRICG-TYP-CDE(PV-INDEX).   32550057
325600     MOVE PS-MDSE-HIER-CDE    TO XS045-MRCH-HIER-CDE(PV-INDEX).   32560057
325700     MOVE PV-DISC-GP-QTY      TO XS045-DISC-GP-QTY(PV-INDEX).     32570057
325800     MOVE PV-DISC-PRCG-AMT    TO XS045-DISC-GP-AMT(PV-INDEX).     32580057
325900                                                                  32590057
326000     PERFORM 8011-INITIALIZE-TIER-TABLE                           32600057
326100         VARYING PV-SUB                                           32610057
326200         FROM 1 BY 1                                              32620057
326300         UNTIL PV-SUB > PC-NBR-OF-TIERS.                          32630057
326400                                                                  32640057
326500     MOVE ZEROES              TO PV-DISC-GP-QTY                   32650057
326600                                 PV-DISC-PRCG-AMT.                32660057
326700                                                                  32670057
326800******************************************************************32680057
326900* INITIALIZE TIER TABLE.                                          32690057
327000******************************************************************32700057
327100 8011-INITIALIZE-TIER-TABLE.                                      32710057
327200                                                                  32720057
327300     SET XS045-ELIG-TIER-INDEX TO PV-SUB.                         32730057
327400                                                                  32740057
327500     MOVE ZEROES              TO XS045-BUY-QTY(PV-INDEX,          32750057
327600                                     XS045-ELIG-TIER-INDEX)       32760057
327700                                 XS045-BUY-DLR(PV-INDEX,          32770057
327800                                     XS045-ELIG-TIER-INDEX)       32780057
327900                                 XS045-GET-PCT(PV-INDEX,          32790057
328000                                     XS045-ELIG-TIER-INDEX)       32800057
328100                                 XS045-GET-DLR(PV-INDEX,          32810057
328200                                     XS045-ELIG-TIER-INDEX)       32820057
328300                                 XS045-PROMO-INTFC-SUB-ID         32830057
328400                                     (PV-INDEX,                   32840057
328500                                     XS045-ELIG-TIER-INDEX).      32850057
328600                                                                  32860057
328700******************************************************************32870057
328800* MOVE VALUES TO BUSINESS RULES LINKAGE - THE TABLE IN A TABLE    32880057
328900******************************************************************32890057
329000 8020-POPULATE-TIER-TABLE.                                        32900057
329100                                                                  32910057
329200     MOVE XST00035-PROMO-INTFC-SUB-ID                             32920057
329300                              TO XS045-PROMO-INTFC-SUB-ID         32930057
329400                                     (PV-INDEX,                   32940057
329500                                     XS045-ELIG-TIER-INDEX).      32950057
329600                                                                  32960057
329700     EVALUATE XST00028-PRICG-TYP-CDE                              32970057
329800         WHEN 'TAP'                                               32980057
329900             MOVE ZEROES       TO XS045-BUY-QTY(PV-INDEX,         32990057
330000                                     XS045-ELIG-TIER-INDEX)       33000057
330100             MOVE XST00035-THRS-AMT                               33010057
330200                               TO XS045-BUY-DLR(PV-INDEX,         33020057
330300                                     XS045-ELIG-TIER-INDEX)       33030057
330400             MOVE XST00035-DISC-PCT                               33040057
330500                               TO XS045-GET-PCT(PV-INDEX,         33050057
330600                                     XS045-ELIG-TIER-INDEX)       33060057
330700             MOVE ZEROES      TO XS045-GET-DLR(PV-INDEX,          33070057
330800                                     XS045-ELIG-TIER-INDEX)       33080057
330900         WHEN 'TQP'                                               33090057
331000             MOVE XST00035-THRS-QTY                               33100057
331100                               TO XS045-BUY-QTY(PV-INDEX,         33110057
331200                                     XS045-ELIG-TIER-INDEX)       33120057
331300             MOVE ZEROES       TO XS045-BUY-DLR(PV-INDEX,         33130057
331400                                     XS045-ELIG-TIER-INDEX)       33140057
331500             MOVE XST00035-DISC-PCT                               33150057
331600                               TO XS045-GET-PCT(PV-INDEX,         33160057
331700                                     XS045-ELIG-TIER-INDEX)       33170057
331800             MOVE ZEROES      TO XS045-GET-DLR(PV-INDEX,          33180057
331900                                     XS045-ELIG-TIER-INDEX)       33190057
332000*P2      WHEN 'TAA'                                               33200057
332100*P2          MOVE ZEROES       TO XS045-BUY-QTY(PV-INDEX,         33210057
332200*P2                                  XS045-ELIG-TIER-INDEX)       33220057
332300*P2          MOVE XST00035-THRS-AMT                               33230057
332400*P2                            TO XS045-BUY-DLR(PV-INDEX,         33240057
332500*P2                                  XS045-ELIG-TIER-INDEX)       33250057
332600*P2          MOVE ZEROES       TO XS045-GET-PCT(PV-INDEX,         33260057
332700*P2                                  XS045-ELIG-TIER-INDEX)       33270057
332800*P2          MOVE XST00035-DISC-AMT                               33280057
332810*P2                           TO XS045-GET-DLR(PV-INDEX,          33281057
332820*P2                                  XS045-ELIG-TIER-INDEX)       33282057
332830*P2      WHEN 'TQA'                                               33283057
332831*P2          MOVE XST00035-THRS-QTY                               33283157
332832*P2                            TO XS045-BUY-QTY(PV-INDEX,         33283257
332833*P2                                  XS045-ELIG-TIER-INDEX)       33283357
332834*P2          MOVE ZEROES       TO XS045-BUY-DLR(PV-INDEX,         33283457
332835*P2                                  XS045-ELIG-TIER-INDEX)       33283557
332836*P2          MOVE ZEROES       TO XS045-GET-PCT(PV-INDEX,         33283657
332837*P2                                  XS045-ELIG-TIER-INDEX)       33283757
332838*P2          MOVE XST00035-DISC-AMT                               33283857
332839*P2                           TO XS045-GET-DLR(PV-INDEX,          33283957
332840*P2                                  XS045-ELIG-TIER-INDEX)       33284057
332850     END-EVALUATE.                                                33285057
332851                                                                  33285157
332852******************************************************************33285257
332853 8200-INIT-XS045-TIER.                                            33285357
332854                                                                  33285457
332855     SET TIER-INDEX          TO PV-SUB.                           33285557
332856                                                                  33285657
332857     MOVE ZEROES             TO XS045-TIER-BUY-QTY(TIER-INDEX).   33285757
332858     MOVE ZEROES             TO XS045-TIER-BUY-DLR(TIER-INDEX).   33285857
332859     MOVE ZEROES             TO XS045-TIER-GET-PCT(TIER-INDEX).   33285957
332860     MOVE ZEROES             TO XS045-TIER-GET-DLR(TIER-INDEX).   33286057
332870                                                                  33287057
