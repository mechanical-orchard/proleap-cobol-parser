000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.   DLKUT037.                                          00020000
000300 AUTHOR.       GERMAN BANDA.                                      00030000
000400 INSTALLATION. KOHLS DEPARTMENT STORES.                           00040000
000500 DATE-WRITTEN. JUNE 2015.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*             CREATE TEAM ASSIGNMENT DATA FOR LM                  00080000
000900*                                                                 00090000
001000* THIS PROGRAM WILL USE THE EXTRACT FILE CREATED IN DLKUT038 AND  00100000
001100* POPULATE THE TEAM CODE FIELD TO SEND TO LM LABOR MANAGEMENT     00110000
001200******************************************************************00120000
001300 ENVIRONMENT DIVISION.                                            00130000
001400******************************************************************00140000
001500 CONFIGURATION SECTION.                                           00150000
001600 SOURCE-COMPUTER.        IBM-3090.                                00160000
001700 OBJECT-COMPUTER.        IBM-3090.                                00170000
001800******************************************************************00180000
001900 INPUT-OUTPUT SECTION.                                            00190000
002000 FILE-CONTROL.                                                    00200000
002100                                                                  00210000
002200     SELECT INPUT-EXPORT-FILE                                     00220000
002300         ASSIGN TO INP01.                                         00230000
002400                                                                  00240000
002500     SELECT OUTPUT-EXPORT-FILE                                    00250000
002600         ASSIGN TO OUT01.                                         00260000
002700                                                                  00270000
002800                                                                  00280000
002900 DATA DIVISION.                                                   00290000
003000 FILE SECTION.                                                    00300000
003100 FD  INPUT-EXPORT-FILE                                            00310000
003200     RECORDING MODE IS F                                          00320000
003300     LABEL RECORDS ARE STANDARD                                   00330000
003400     RECORD CONTAINS 900                                          00340000
003500     BLOCK CONTAINS 0 RECORDS                                     00350000
003600     DATA RECORD IS INPUT-EXPORT-RECORD.                          00360000
003700                                                                  00370000
003800 01  INPUT-EXPORT-RECORD       PIC  X(900).                       00380000
003900                                                                  00390000
004000 FD  OUTPUT-EXPORT-FILE                                           00400000
004100     RECORDING MODE IS F                                          00410000
004200     LABEL RECORDS ARE STANDARD                                   00420000
004300     BLOCK CONTAINS 0 RECORDS.                                    00430000
004400                                                                  00440000
004500 01  OUTPUT-EXPORT-RECORD             PIC X(900).                 00450000
004600                                                                  00460000
004700 WORKING-STORAGE SECTION.                                         00470000
004800                                                                  00480000
004900                                                                  00490000
005000 01  PS-PROGRAM-SWITCHES.                                         00500000
005100     05  PS-END-OF-EXTRACT-SW        PIC X(01)       VALUE 'N'.   00510000
005200         88  PS-END-OF-EXTRACT-YES                   VALUE 'Y'.   00520000
005300         88  PS-END-OF-EXTRACT-NO                    VALUE 'N'.   00530000
005400     05  PS-END-OF-EXT-CSR-SW        PIC  X(01)      VALUE 'N'.   00540000
005500         88  PS-END-OF-EXT-CSR-YES                   VALUE 'Y'.   00550000
005600         88  PS-END-OF-EXT-CSR-NO                    VALUE 'N'.   00560000
005700     05  PS-PROCESS-CURSOR-SW          PIC  X(01)    VALUE 'N'.   00570000
005800         88  PS-PROCESS-CURSOR-YES                   VALUE 'Y'.   00580000
005900         88  PS-PROCESS-CURSOR-NO                    VALUE 'N'.   00590000
005910     05  PS-VALID-EVNT-OBJ-ACTN-TXT      PIC  X(18)  VALUE SPACE. 00591001
005920         88  PS-VALID-EVNT-OBJ-ACTN-YES                           00592001
005930                                     VALUE  'DOOR SUMMARY      '  00593001
006000                                            'PALLET MANUAL SCAN' ,00600001
006010                                            'CARTON MANUAL SCAN' ,00601001
006020                                            'TRAILER OPEN      ' ,00602001
006030                                            'TRAILER CLOSE     ' .00603001
006040         88  PS-EVNT-OBJ-ACTN-DOOR   VALUE  'DOOR SUMMARY      '. 00604001
006050         88  PS-EVNT-OBJ-ACTN-PALLET VALUE  'PALLET MANUAL SCAN'. 00605001
006060         88  PS-EVNT-OBJ-ACTN-CARTON VALUE  'CARTON MANUAL SCAN'. 00606001
006070         88  PS-EVNT-OBJ-ACTN-TRLR-O VALUE  'TRAILER OPEN      '. 00607001
006080         88  PS-EVNT-OBJ-ACTN-TRLR-C VALUE  'TRAILER CLOSE     '. 00608001
006100 01  PC-PROGRAM-CONSTANTS.                                        00610000
006200     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'DLKUT037'.  00620000
006300     05  PC-PGM-NAME                 PIC X(08) VALUE 'DLKUT037'.  00630000
006400     05  PC-JOB-NAME                 PIC X(08) VALUE SPACES.      00640000
006500                                                                  00650000
006600 01  CC-CONTROL-CARD-PARAMETERS.                                  00660000
006700      05 CC-DC-NBR                      PIC 9(04).                00670000
006800      05 FILLER                         PIC X(76) VALUE SPACE.    00680000
006900                                                                  00690000
007000 01  DK-DB-KEYS.                                                  00700000
007100     05 DK-ASGMT-STRT-DTE             PIC X(10).                  00710000
007200     05 DK-ASGMT-NBR-TXT              PIC X(10).                  00720000
007300     05 DK-EVNT-KY-1-TMST             PIC X(26).                  00730000
007400     05 DK-ASGMT-NBR-SEQ-NBR          PIC S9(09) COMP.            00740000
007500     05 DK-OPER-UNT-ID                PIC S9(04) COMP.            00750000
007600     05 DK-EVENT-CRE-TMST             PIC X(26).                  00760000
007700                                                                  00770000
007800 01  PA-TOTALS.                                                   00780000
007900     05  PA-INPUT-COUNT              PIC  9(9) VALUE 0.           00790000
008000     05  PA-OUTPUT-COUNT             PIC  9(9) VALUE 0.           00800000
008100                                                                  00810000
008200 01  ABEND-CODE                      PIC S9(4) VALUE +0           00820000
008300                                               COMP SYNC.         00830000
008400                                                                  00840000
008500 01  PV-PROGRAM-VARIABLES.                                        00850000
008600     05  PV-PROCESS-TIMESTAMP        PIC X(26) VALUE SPACE.       00860000
008700     05  PV-CURRENT-TMST             PIC X(26) VALUE SPACE.       00870000
008800     05  PV-INPUT-TMST.                                           00880000
008810         10 PV-INPUT-TMST-DATE.                                   00881000
008820             15 PV-INPUT-TMST-YR      PIC 9(04).                  00882000
008830             15 FILLER                PIC X.                      00883000
008840             15 PV-INPUT-TMST-MO      PIC 9(02).                  00884000
008850             15 FILLER                PIC X.                      00885000
008860             15 PV-INPUT-TMST-DA      PIC 9(02).                  00886000
008870         10 FILLER                    PIC X.                      00887000
008880         10 PV-INPUT-TMST-TIME.                                   00888000
008890             15 PV-INPUT-TMST-HR      PIC 9(02).                  00889000
008891             15 FILLER                PIC X.                      00889100
008892             15 PV-INPUT-TMST-MN      PIC 9(02).                  00889200
008893             15 FILLER                PIC X.                      00889300
008894             15 PV-INPUT-TMST-SS      PIC 9(02).                  00889400
008895         10 FILLER                PIC X.                          00889500
008896         10 FILLER                PIC X(06).                      00889600
008897     05  PV-DC-NBR                   PIC 9(4).                    00889700
008898     05  PV-EXTRACT                  PIC X(30) VALUE SPACES.      00889800
008899     05  PV-RESTART-COUNT            PIC 9(09) VALUE 0.           00889900
008900     05  PC-MAX-RETRIES              PIC S9(03) VALUE 3 COMP-3.   00890000
009000     05  PC-RUN-IN-PROGRESS-CODE     PIC X(01)  VALUE '9'.        00900000
009100     05  PC-RUN-COMPLETE-CODE        PIC X(01)  VALUE '0'.        00910000
009200     05  PV-CKPT-STAT-CODE           PIC X(01)  VALUE SPACES.     00920000
009300     05  PV-DLSHOT-FUNC-QTY          PIC S9(9)  VALUE 0 COMP.     00930000
009400     05  PV-JN-TMST-DIFF             PIC X(15) VALUE SPACE.       00940000
009500*                                                                 00950000
009600     05  PV-TEAM-COUNT                    PIC S9(04)  VALUE +0    00960000
009700                                                       COMP SYNC. 00970000
009800     05  PV-FETCH-COUNTER                 PIC S9(04)  VALUE +0    00980000
009900                                                       COMP SYNC. 00990000
010000     05  PV-DETAIL-TEXT.                                          01000000
010100         10  PV-DETL-ASGMT-STRT-DTE.                              01010000
010200             15  PV-DETL-ASGMT-STRT-YYYY        PIC  9(04).       01020000
010300             15  PV-DETL-ASGMT-STRT-DASH1       PIC  X(01).       01030000
010400             15  PV-DETL-ASGMT-STRT-MM          PIC  9(02).       01040000
010500             15  PV-DETL-ASGMT-STRT-DASH2       PIC  X(01).       01050000
010600             15  PV-DETL-ASGMT-STRT-DD          PIC  9(02).       01060000
010700         10  PV-DETL-ASGMT-NBR-TXT              PIC  X(10).       01070000
010800         10  PV-DETL-ASGMT-NBR-SEQ-NBR          PIC  9(09).       01080000
010900         10  PV-DETL-ASGMT-SEQ-DTL-NBR          PIC  9(09).       01090000
011000                                                                  01100000
011100     05  PV-P2L-TEAM-CODE.                                        01110000
011200         10  PV-P2L-TEXT                        PIC  X(03).       01120000
011300         10  PV-P2L-MOD                         PIC  X(03).       01130000
011400 01  PV-ABEND-VARIABLES.                                          01140000
011500     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP      01150000
011600                                                        SYNC.     01160000
011700     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP.     01170000
011800     05  PV-SQLCODE                  PIC S9(9).                   01180000
011900     05  SUB1                        PIC 9(7) VALUE 0.            01190000
012000     05  PV-DISPLAY-SQLCODE          PIC -------999.              01200000
012100     05  PV-DISPLAY-TEXT-1           PIC X(10) VALUE SPACES.      01210000
012200     05  PV-DISPLAY-NUMBER           PIC 9999999999.              01220000
012300     05  PV-DISPLAY-NUMBER-2         PIC 9999999999.              01230000
012400     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'DLKUT037'.  01240000
012500     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      01250000
012600     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      01260000
012700     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01270000
012800     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01280000
012900                                                                  01290000
013000******************************************************************01300000
013100******************************************************************01310000
013200*    EXTRACT FILE LAYOUT                                          01320000
013300******************************************************************01330000
013400     COPY DLRD003.                                                01340000
013500                                                                  01350000
013600******************************************************************01360000
013700*  COMMUNICATIONS AREA FOR DB2                                    01370000
013800******************************************************************01380000
013900     EXEC SQL                                                     01390000
014000         INCLUDE SQLCA                                            01400000
014100     END-EXEC.                                                    01410000
014200                                                                  01420000
014300******************************************************************01430000
014400*  DL TEAM ASSIGNMENT TABLE  DLT_TEM_ASGMT                        01440000
014500******************************************************************01450000
014600     EXEC SQL                                                     01460000
014700         INCLUDE DLT00003                                         01470000
014800     END-EXEC.                                                    01480000
014900                                                                  01490000
015000******************************************************************01500000
015100******************************************************************01510000
015200*  DL TEAM ASSIGNMENT TABLE  DLT_ASGMT                            01520000
015300******************************************************************01530000
015400     EXEC SQL                                                     01540000
015500         INCLUDE DLT00004                                         01550000
015600     END-EXEC.                                                    01560000
015700                                                                  01570000
015800******************************************************************01580000
015900*  DB2 FORMATTED MESSAGE AREA                                     01590000
016000******************************************************************01600000
016100     COPY DPWS004.                                                01610000
016200                                                                  01620000
016300******************************************************************01630000
016400*  PCT_BUS_EVNT_EXPRT - BUSINESS EVENT EXPORT TABLE               01640000
016500******************************************************************01650000
016600     EXEC SQL                                                     01660000
016700         INCLUDE PCT00011                                         01670000
016800     END-EXEC.                                                    01680000
016900                                                                  01690000
017000******************************************************************01700000
017100*  PCT_BUS_EVNT_DTL -  BUSINESS EVENT EXPORT DETAIL               01710000
017200******************************************************************01720000
017300     EXEC SQL                                                     01730000
017400         INCLUDE PCT00012                                         01740000
017500     END-EXEC.                                                    01750000
017600                                                                  01760000
017700******************************************************************01770000
017800* COBOL CURSOR DECLARATION                                        01780000
017900******************************************************************01790000
018000     EXEC SQL                                                     01800000
018100        DECLARE ASSOCIATE-CURSOR CURSOR FOR                       01810000
018200         SELECT                                                   01820000
018300                COUNT(TEM.CRE_BY_USR_ID)                          01830000
018400              , ASG.WK_AREA_DESC                                  01840000
018500          FROM  DLT_TEM_ASGMT   TEM                               01850000
018600              , DLT_ASGMT       ASG                               01860000
018700                                                                  01870000
018800         WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID           01880000
018900           AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        01890000
019000           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         01900000
019100           AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR     01910000
019200           AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE        01920000
019300           AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT         01930000
019400           AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR     01940000
019500           AND  TEM.JN_TMST < :DL003-EVENT-DB-CRE-TMST            01950000
019600           AND  (TEM.LVE_TMST   > :DL003-EVENT-DB-CRE-TMST OR     01960000
019700                 TEM.LVE_TMST IS NULL)                            01970000
019800         GROUP BY ASG.WK_AREA_DESC                                01980000
019900     END-EXEC.                                                    01990000
020000                                                                  02000000
020100 PROCEDURE DIVISION.                                              02010000
020200                                                                  02020000
020300 0000-PROGRAM-MAINLINE.                                           02030000
020400                                                                  02040000
020500     PERFORM 1000-INITIALIZE.                                     02050000
020600                                                                  02060000
020700     PERFORM 2000-PROCESS-EXTRACT                                 02070000
020800        UNTIL PS-END-OF-EXTRACT-YES.                              02080000
020900                                                                  02090000
021000     PERFORM 8500-EOJ-ROUTINE.                                    02100000
021100                                                                  02110000
021200     GOBACK.                                                      02120000
021300                                                                  02130000
021400******************************************************************02140000
021500*                I N I T I A L I Z A T I O N                     *02150000
021600******************************************************************02160000
021700 1000-INITIALIZE.                                                 02170000
021800                                                                  02180000
021900     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                02190000
022000     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              02200000
022100             CC-CONTROL-CARD-PARAMETERS.                          02210000
022200     IF CC-DC-NBR NOT NUMERIC                                     02220000
022300         MOVE 85                    TO CC-DC-NBR                  02230000
022400     END-IF.                                                      02240000
022500     MOVE CC-DC-NBR                 TO DK-OPER-UNT-ID.            02250000
022600                                                                  02260000
022700     OPEN INPUT INPUT-EXPORT-FILE.                                02270000
022800     OPEN OUTPUT OUTPUT-EXPORT-FILE.                              02280000
022900                                                                  02290000
023000     INITIALIZE DL003-EXPORT-RECORD-LAYOUT.                       02300000
023100                                                                  02310000
023200     PERFORM 7000-READ-INPUT.                                     02320000
023300                                                                  02330000
023400******************************************************************02340000
023500* OPEN CURSOR TO CHECK TEAM ASSIGNMENT                            02350000
023600* THE FOLLOWING EVENTS ARE EITHER BYPASSED OR REWRITTEN           02360000
023700* AND NO DATABASE CHECK IS REQUIRED                               02370000
023800* BYPASS *                                                        02380000
023900* BYPASS THE FOLLOWING RECORDS                                    02390000
024000*'ASSIGNMENT CLOSE' - RECORDS NOT SENT TO LM IN DLKUT004          02400000
024100* REWRITE - NO DATABASE CHECK REQUIRED                            02410000
024200******************************************************************02420000
024300 2000-PROCESS-EXTRACT.                                            02430000
024400                                                                  02440000
024500     PERFORM 2100-PREPARE-CURSOR-DATA.                            02450000
024600     IF PS-PROCESS-CURSOR-YES                                     02460000
024700        SET PS-END-OF-EXT-CSR-NO TO TRUE                          02470000
024800        PERFORM 3000-OPEN-EXTRACT                                 02480000
024900        PERFORM 3100-FETCH-EXTRACT                                02490000
025000             UNTIL PS-END-OF-EXT-CSR-YES                          02500000
025100        PERFORM 3200-CLOSE-EXTRACT                                02510000
025200     END-IF.                                                      02520000
025300                                                                  02530000
025400     PERFORM 7000-READ-INPUT.                                     02540000
025500                                                                  02550000
025600 2100-PREPARE-CURSOR-DATA.                                        02560000
025700     IF DL003-EVNT-OBJ-TXT = 'DC LABOR'                           02570000
025800        IF DL003-EVNT-OBJ-ACTN-TXT  = 'ASSIGNMENT USER ADD'       02580000
025900          MOVE 'MANUAL ADD'  TO DL003-REF-ID                      02590000
026000          MOVE DL003-EVNT-KY-1-TMST TO PV-INPUT-TMST              02600000
026100          MOVE PV-INPUT-TMST-DATE   TO DK-ASGMT-STRT-DTE          02610000
026200          MOVE DL003-EVNT-KY-1-TXT  TO DK-ASGMT-NBR-TXT           02620000
026300          MOVE DL003-EVNT-KY-1-NBR  TO DK-ASGMT-NBR-SEQ-NBR       02630000
026310          MOVE DL003-EVNT-KY-2-NBR  TO PV-DC-NBR                  02631000
026320          MOVE PV-DC-NBR            TO DK-OPER-UNT-ID             02632000
026330* RPK - 07-24-2015 BEGIN                                          02633000
026331          SET PS-PROCESS-CURSOR-NO  TO TRUE                       02633100
026332* RPK - 07-24-2015 END                                            02633200
026333          PERFORM 3500-TEAM-ASGMENT-CHECK                         02633300
026334          PERFORM 2200-PREPARE-FILE-WRITE                         02633400
026335        ELSE                                                      02633500
026336          SET DL003-ONE TO TRUE                                   02633600
026337          MOVE SPACES     TO DL003-TEAM-CODE                      02633700
026338* RPK - 07-24-2015 BEGIN                                          02633800
026339          PERFORM 7200-WRITE-OUTPUT-RECORD                        02633900
026340          SET PS-PROCESS-CURSOR-NO  TO TRUE                       02634000
026350        END-IF                                                    02635000
026360* RPK - 07-24-2015 END                                            02636000
026370     ELSE                                                         02637000
026380        SET PS-PROCESS-CURSOR-YES TO TRUE                         02638000
026390        MOVE DL003-DTL-TXT-AREA        TO PV-DETAIL-TEXT          02639000
026400                                                                  02640000
026500        MOVE PV-DETL-ASGMT-STRT-DTE    TO DK-ASGMT-STRT-DTE       02650000
026600        MOVE PV-DETL-ASGMT-NBR-TXT     TO DK-ASGMT-NBR-TXT        02660000
026700        MOVE PV-DETL-ASGMT-NBR-SEQ-NBR TO DK-ASGMT-NBR-SEQ-NBR    02670000
026800        MOVE DL003-EVENT-DB-CRE-TMST   TO DK-EVENT-CRE-TMST       02680000
026900        IF DL003-EVNT-OBJ-TXT      = 'SHIPPING'                   02690001
026901           MOVE DL003-EVNT-OBJ-ACTN-TXT  TO                       02690101
026902                                PS-VALID-EVNT-OBJ-ACTN-TXT        02690201
026910         IF PS-VALID-EVNT-OBJ-ACTN-YES                            02691001
027000           SET PS-PROCESS-CURSOR-NO  TO TRUE                      02700000
027100           PERFORM 3500-TEAM-ASGMENT-CHECK                        02710000
027110           IF PS-EVNT-OBJ-ACTN-DOOR                               02711002
027200              PERFORM 4000-CHCK-KOHLS-DOOR-SUMM                   02720002
027310           END-IF                                                 02731002
027311           MOVE +2 TO PV-TEAM-COUNT                               02731102
027320           PERFORM 2200-PREPARE-FILE-WRITE                        02732002
027400        END-IF                                                    02740000
027500     END-IF.                                                      02750000
027600                                                                  02760000
027700 2200-PREPARE-FILE-WRITE.                                         02770000
027800                                                                  02780000
027900     IF PV-TEAM-COUNT > 1                                         02790000
028000       SET DL003-TEAM  TO TRUE                                    02800000
028100       IF DLT00004-WK-AREA-DESC(1:3)  = 'P2L'                     02810000
028200          MOVE DLT00004-WK-AREA-DESC(1:3)   TO PV-P2L-TEXT        02820000
028300          MOVE DLT00004-WK-AREA-DESC(14:3)  TO PV-P2L-MOD         02830000
028400          MOVE PV-P2L-TEAM-CODE             TO DL003-TEAM-CODE    02840000
028500       ELSE                                                       02850000
028600          MOVE DLT00004-WK-AREA-DESC TO DL003-TEAM-CODE           02860000
028700       END-IF                                                     02870000
028800     ELSE                                                         02880000
028900       SET DL003-ONE   TO TRUE                                    02890000
029000       MOVE SPACES     TO DL003-TEAM-CODE                         02900000
029100     END-IF.                                                      02910000
029200                                                                  02920000
029300     IF PS-PROCESS-CURSOR-YES AND PV-FETCH-COUNTER = 0            02930000
029400        DISPLAY 'OPER-UNT-ID      :' DK-OPER-UNT-ID               02940000
029500        DISPLAY 'ASGMT-STRT-DTE   :' DK-ASGMT-STRT-DTE            02950000
029600        DISPLAY 'ASGMT-NBR-TXT    :' DK-ASGMT-NBR-TXT             02960000
029700        DISPLAY 'ASGMT-NBR-SEQ-NBR:' DK-ASGMT-NBR-SEQ-NBR         02970000
029800        SET DL003-ONE   TO TRUE                                   02980000
029900        MOVE SPACES     TO DL003-TEAM-CODE                        02990000
030000     END-IF.                                                      03000000
030100                                                                  03010000
030200     PERFORM 7200-WRITE-OUTPUT-RECORD.                            03020000
030300******************************************************************03030000
030400* OPEN EXTRACT CURSOR                                             03040000
030500******************************************************************03050000
030600 3000-OPEN-EXTRACT.                                               03060000
030700     INITIALIZE DCLDLT00004.                                      03070000
030800     MOVE +0    TO PV-TEAM-COUNT                                  03080000
030900                                                                  03090000
031000     PERFORM                                                      03100000
031100         WITH TEST AFTER                                          03110000
031200         VARYING PV-RETRY-COUNTER                                 03120000
031300         FROM 1 BY 1                                              03130000
031400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03140000
031500            OR  (SQLCODE = +100)                                  03150000
031600            OR  (SQLCODE = +0))                                   03160000
031700                                                                  03170000
031800     EXEC SQL                                                     03180000
031900         OPEN ASSOCIATE-CURSOR                                    03190000
032000     END-EXEC                                                     03200000
032100                                                                  03210000
032200     EVALUATE TRUE                                                03220000
032300       WHEN SQLCODE = 0                                           03230000
032400       WHEN SQLCODE = -904                                        03240000
032500       WHEN SQLCODE = -913                                        03250000
032600       WHEN SQLCODE = -911                                        03260000
032700           CONTINUE                                               03270000
032800       WHEN OTHER                                                 03280000
032900           MOVE '3100-OPEN-EXTRACT-CRS'                           03290000
033000                                 TO PV-ABEND-PARAGRAPH            03300000
033100           MOVE 'OPEN EXTRACT'   TO PV-ABEND-OPERATION            03310000
033200           MOVE 'JOIN'           TO PV-ABEND-STRUCTURE-1          03320000
033300           MOVE 'OPEN CURSOR'    TO PV-DB2-OPERATION-MESSAGE-1    03330000
033400           PERFORM 9900-DB2-ABEND                                 03340000
033500     END-EVALUATE                                                 03350000
033600     END-PERFORM.                                                 03360000
033700                                                                  03370000
033800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    03380000
033900         SQLCODE NOT = ZERO                                       03390000
034000         DISPLAY '**************************************'         03400000
034100         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         03410000
034200         DISPLAY 'OPEN EXTRACT CURSOR    '                        03420000
034300         DISPLAY '**************************************'         03430000
034400         MOVE '3100-OPEN-EXTRACT-CRS'                             03440000
034500                               TO PV-ABEND-PARAGRAPH              03450000
034600         MOVE 'OPEN EXTRACT'   TO PV-ABEND-OPERATION              03460000
034700         MOVE 'JOIN'           TO PV-ABEND-STRUCTURE-1            03470000
034800         MOVE 'OPEN CURSOR'    TO PV-DB2-OPERATION-MESSAGE-1      03480000
034900         PERFORM 9900-DB2-ABEND                                   03490000
035000     END-IF.                                                      03500000
035100                                                                  03510000
035200******************************************************************03520000
035300* FETCH EXTRACT CURSOR                                            03530000
035400******************************************************************03540000
035500 3100-FETCH-EXTRACT.                                              03550000
035600                                                                  03560000
035700     PERFORM                                                      03570000
035800         WITH TEST AFTER                                          03580000
035900         VARYING PV-RETRY-COUNTER                                 03590000
036000         FROM 1 BY 1                                              03600000
036100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03610000
036200            OR  (SQLCODE = +100)                                  03620000
036300            OR  (SQLCODE = +0))                                   03630000
036400                                                                  03640000
036500     EXEC SQL                                                     03650000
036600          FETCH  ASSOCIATE-CURSOR                                 03660000
036700           INTO  :PV-TEAM-COUNT                                   03670000
036800              ,  :DLT00004-WK-AREA-DESC                           03680000
036900     END-EXEC                                                     03690000
037000                                                                  03700000
037100     EVALUATE TRUE                                                03710000
037200         WHEN SQLCODE = ZERO                                      03720000
037300             ADD +1 TO PV-FETCH-COUNTER                           03730000
037400             PERFORM 2200-PREPARE-FILE-WRITE                      03740000
037500         WHEN SQLCODE = +100                                      03750000
037600             SET PS-END-OF-EXT-CSR-YES TO TRUE                    03760000
037700         WHEN SQLCODE = -904                                      03770000
037800         WHEN SQLCODE = -913                                      03780000
037900         WHEN SQLCODE = -911                                      03790000
038000              CONTINUE                                            03800000
038100         WHEN OTHER                                               03810000
038200             MOVE '3100-FETCH-EXTRACT'                            03820000
038300                                 TO PV-ABEND-PARAGRAPH            03830000
038400             MOVE 'FETCH EXTRACT' TO PV-ABEND-OPERATION           03840000
038500             MOVE 'JOIN'       TO PV-ABEND-STRUCTURE-1            03850000
038600             MOVE 'FETCH CURSOR' TO PV-DB2-OPERATION-MESSAGE-1    03860000
038700             PERFORM 9900-DB2-ABEND                               03870000
038800     END-EVALUATE                                                 03880000
038900     END-PERFORM.                                                 03890000
039000                                                                  03900000
039100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    03910000
039200         SQLCODE NOT = ZERO                                       03920000
039300         DISPLAY '**************************************'         03930000
039400         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         03940000
039500         DISPLAY 'FETCH EXTRACT CURSOR   '                        03950000
039600         DISPLAY '**************************************'         03960000
039700         MOVE '3100-FETCH-EXTRACT'                                03970000
039800                              TO PV-ABEND-PARAGRAPH               03980000
039900         MOVE 'FETCH EXTRACT' TO PV-ABEND-OPERATION               03990000
040000         MOVE 'JOIN'       TO PV-ABEND-STRUCTURE-1                04000000
040100         MOVE 'FETCH CURSOR' TO PV-DB2-OPERATION-MESSAGE-1        04010000
040200         PERFORM 9900-DB2-ABEND                                   04020000
040300     END-IF.                                                      04030000
040400                                                                  04040000
040500******************************************************************04050000
040600* CLOSE EXTRACT CURSOR                                            04060000
040700******************************************************************04070000
040800 3200-CLOSE-EXTRACT.                                              04080000
040900                                                                  04090000
041000     PERFORM                                                      04100000
041100         WITH TEST AFTER                                          04110000
041200         VARYING PV-RETRY-COUNTER                                 04120000
041300         FROM 1 BY 1                                              04130000
041400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04140000
041500            OR  (SQLCODE = +100)                                  04150000
041600            OR  (SQLCODE = +0))                                   04160000
041700                                                                  04170000
041800     EXEC SQL                                                     04180000
041900         CLOSE ASSOCIATE-CURSOR                                   04190000
042000     END-EXEC                                                     04200000
042100                                                                  04210000
042200     EVALUATE TRUE                                                04220000
042300       WHEN SQLCODE = 0                                           04230000
042400       WHEN SQLCODE = -904                                        04240000
042500       WHEN SQLCODE = -913                                        04250000
042600       WHEN SQLCODE = -911                                        04260000
042700           CONTINUE                                               04270000
042800       WHEN OTHER                                                 04280000
042900           MOVE '3200-CLOSE-EXTRACT-CRS'                          04290000
043000                                 TO PV-ABEND-PARAGRAPH            04300000
043100           MOVE 'CLOSE EXTRACT'   TO PV-ABEND-OPERATION           04310000
043200           MOVE 'JOIN'           TO PV-ABEND-STRUCTURE-1          04320000
043300           MOVE 'CLOSE CURSOR'   TO PV-DB2-OPERATION-MESSAGE-1    04330000
043400           PERFORM 9900-DB2-ABEND                                 04340000
043500     END-EVALUATE                                                 04350000
043600     END-PERFORM.                                                 04360000
043700                                                                  04370000
043800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04380000
043900         SQLCODE NOT = ZERO                                       04390000
044000         DISPLAY '**************************************'         04400000
044100         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04410000
044200         DISPLAY 'CLOSE EXTRACT CURSOR   '                        04420000
044300         DISPLAY '**************************************'         04430000
044400         MOVE '3200-CLOSE-EXTRACT-CRS'                            04440000
044500                               TO PV-ABEND-PARAGRAPH              04450000
044600         MOVE 'CLOSE EXTRACT'   TO PV-ABEND-OPERATION             04460000
044700         MOVE 'JOIN'           TO PV-ABEND-STRUCTURE-1            04470000
044800         MOVE 'CLOSE CURSOR'   TO PV-DB2-OPERATION-MESSAGE-1      04480000
044900         PERFORM 9900-DB2-ABEND                                   04490000
045000     END-IF.                                                      04500000
045100                                                                  04510000
045200 3500-TEAM-ASGMENT-CHECK.                                         04520000
045300     EXEC SQL                                                     04530000
045400        SELECT                                                    04540000
045500               COUNT(TEM.CRE_BY_USR_ID)                           04550000
045600             , ASG.WK_AREA_DESC                                   04560000
045700         INTO  :PV-TEAM-COUNT                                     04570000
045800             , :DLT00004-WK-AREA-DESC                             04580000
045900         FROM  DLT_TEM_ASGMT   TEM                                04590000
046000             , DLT_ASGMT       ASG                                04600000
046100        WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID            04610000
046200          AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE         04620000
046300          AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT          04630000
046400          AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR      04640000
046500          AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE         04650000
046600          AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT          04660000
046700          AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR      04670000
046800        GROUP BY ASG.WK_AREA_DESC                                 04680000
046900     END-EXEC.                                                    04690000
047000                                                                  04700000
047100     EVALUATE TRUE                                                04710000
047200         WHEN SQLCODE = ZERO                                      04720000
047300         WHEN SQLCODE = +100                                      04730000
047400                 CONTINUE                                         04740000
047500         WHEN SQLWARN0 NOT = SPACE                                04750000
047600         WHEN SQLCODE  NOT = ZERO                                 04760000
047700             MOVE '3500-TEAM-ASGMENT-CHECK'                       04770000
047800                                       TO PV-ABEND-PARAGRAPH      04780000
047900             MOVE 'SELECT'             TO PV-ABEND-OPERATION      04790000
048000             MOVE 'DLT_TEM_ASGMT'   TO PV-ABEND-STRUCTURE-1       04800000
048100             MOVE DK-ASGMT-NBR-SEQ-NBR TO PV-DISPLAY-NUMBER       04810000
048200             STRING  'STRT-DTE'            DELIMITED BY SIZE      04820000
048300                     DK-ASGMT-STRT-DTE     DELIMITED BY SIZE      04830000
048400                 ' ASGMT-NBR-TXT '         DELIMITED BY SIZE      04840000
048500                     DK-ASGMT-NBR-TXT      DELIMITED BY SIZE      04850000
048600                 ' ASGMT-NBR-SEQ '         DELIMITED BY SIZE      04860000
048700                 PV-DISPLAY-NUMBER         DELIMITED BY SIZE      04870000
048800                                INTO PV-DB2-OPERATION-MESSAGE-1   04880000
048900             PERFORM 9900-DB2-ABEND                               04890000
049000     END-EVALUATE.                                                04900000
049100                                                                  04910000
049200 4000-CHCK-KOHLS-DOOR-SUMM.                                       04920000
049300     EXEC SQL                                                     04930000
049400         SELECT TEM.KOHLS_USR_ID                                  04940000
049500              , TEM.LVE_TMST                                      04950000
049600          INTO  :DLT00003-KOHLS-USR-ID                            04960000
049700              , :DLT00003-LVE-TMST                                04970000
049800          FROM  DLT_TEM_ASGMT   TEM                               04980000
049900              , DLT_ASGMT       ASG                               04990000
050000         WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID           05000000
050100           AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        05010000
050200           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         05020000
050300           AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR     05030000
050400           AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE        05040000
050500           AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT         05050000
050600           AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR     05060000
050700           AND  TEM.LVE_RSN_CDE       = 'T'                       05070000
050800          ORDER BY TEM.LVE_TMST DESC                              05080000
050900          FETCH FIRST 1 ROW ONLY                                  05090000
051000         WITH UR                                                  05100000
051100     END-EXEC                                                     05110000
051200                                                                  05120000
051300     EVALUATE TRUE                                                05130000
051400         WHEN SQLCODE = ZERO                                      05140000
051500         WHEN SQLCODE = -811                                      05150000
051600           MOVE DLT00003-KOHLS-USR-ID TO DL003-CRE-BY-USR-ID      05160000
051700         WHEN SQLCODE = +100                                      05170000
051800         WHEN SQLCODE = -305                                      05180000
051900              PERFORM 4050-CHCK-KOHLS-DOOR-SUM2                   05190000
052000         WHEN SQLWARN0 NOT = SPACE                                05200000
052100         WHEN SQLCODE  NOT = ZERO                                 05210000
052200             MOVE '4000-CHCK-KOHLS-DOOR-SUMM '                    05220000
052300                                       TO PV-ABEND-PARAGRAPH      05230000
052400             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05240000
052500             MOVE 'DLT_TEM_ASGMT'   TO PV-ABEND-STRUCTURE-1       05250000
052600             MOVE DK-ASGMT-NBR-SEQ-NBR TO PV-DISPLAY-NUMBER       05260000
052700             STRING  'STRT-DTE'            DELIMITED BY SIZE      05270000
052800                     DK-ASGMT-STRT-DTE     DELIMITED BY SIZE      05280000
052900                 ' ASGMT-NBR-TXT '         DELIMITED BY SIZE      05290000
053000                     DK-ASGMT-NBR-TXT      DELIMITED BY SIZE      05300000
053100                 ' ASGMT-NBR-SEQ '         DELIMITED BY SIZE      05310000
053200                 PV-DISPLAY-NUMBER         DELIMITED BY SIZE      05320000
053300                                INTO PV-DB2-OPERATION-MESSAGE-1   05330000
053400             PERFORM 9900-DB2-ABEND                               05340000
053500     END-EVALUATE.                                                05350000
053600                                                                  05360000
053700 4050-CHCK-KOHLS-DOOR-SUM2.                                       05370000
053800     EXEC SQL                                                     05380000
053900         SELECT TEM.KOHLS_USR_ID                                  05390000
054000              , TEM.LVE_TMST                                      05400000
054010          INTO  :DLT00003-KOHLS-USR-ID                            05401000
054020              , :DLT00003-LVE-TMST                                05402000
054030          FROM  DLT_TEM_ASGMT   TEM                               05403000
054040              , DLT_ASGMT       ASG                               05404000
054050         WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID           05405000
054060           AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        05406000
054070           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         05407000
054080           AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR     05408000
054090           AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE        05409000
054091           AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT         05409100
054092           AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR     05409200
054093          ORDER BY TEM.LVE_TMST DESC                              05409300
054094          FETCH FIRST 1 ROW ONLY                                  05409400
054095         WITH UR                                                  05409500
054096     END-EXEC                                                     05409600
054097                                                                  05409700
054098     EVALUATE TRUE                                                05409800
054099         WHEN SQLCODE = ZERO                                      05409900
054100         WHEN SQLCODE = -811                                      05410000
054101           MOVE DLT00003-KOHLS-USR-ID TO DL003-CRE-BY-USR-ID      05410100
054102         WHEN SQLCODE = +100                                      05410200
054103         WHEN SQLCODE = -305                                      05410300
054104              PERFORM 4100-CHCK-TEMP-DOOR-SUMM                    05410400
054105         WHEN SQLWARN0 NOT = SPACE                                05410500
054106         WHEN SQLCODE  NOT = ZERO                                 05410600
054107             MOVE '4050-CHCK-KOHLS-DOOR-SUM2 '                    05410700
054108                                       TO PV-ABEND-PARAGRAPH      05410800
054109             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05410900
054110             MOVE 'DLT_TEM_ASGMT'   TO PV-ABEND-STRUCTURE-1       05411000
054111             MOVE DK-ASGMT-NBR-SEQ-NBR TO PV-DISPLAY-NUMBER       05411100
054112             STRING  'STRT-DTE'            DELIMITED BY SIZE      05411200
054113                     DK-ASGMT-STRT-DTE     DELIMITED BY SIZE      05411300
054114                 ' ASGMT-NBR-TXT '         DELIMITED BY SIZE      05411400
054115                     DK-ASGMT-NBR-TXT      DELIMITED BY SIZE      05411500
054116                 ' ASGMT-NBR-SEQ '         DELIMITED BY SIZE      05411600
054117                 PV-DISPLAY-NUMBER         DELIMITED BY SIZE      05411700
054118                                INTO PV-DB2-OPERATION-MESSAGE-1   05411800
054119             PERFORM 9900-DB2-ABEND                               05411900
054120     END-EVALUATE.                                                05412000
054121                                                                  05412100
054122 4100-CHCK-TEMP-DOOR-SUMM.                                        05412200
054123     EXEC SQL                                                     05412300
054124         SELECT TEM.TMP_USR_ID                                    05412400
054125              , TEM.LVE_TMST                                      05412500
054126          INTO  :DLT00003-TMP-USR-ID                              05412600
054127              , :DLT00003-LVE-TMST                                05412700
054128          FROM  DLT_TEM_ASGMT   TEM                               05412800
054129              , DLT_ASGMT       ASG                               05412900
054130                                                                  05413000
054140         WHERE  ASG.DC_NBR            = :DK-OPER-UNT-ID           05414000
054150           AND  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        05415000
054160           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         05416000
054170           AND  TEM.ASGMT_NBR_SEQ_NBR = :DK-ASGMT-NBR-SEQ-NBR     05417000
054180           AND  TEM.ASGMT_STRT_DTE    = ASG.ASGMT_STRT_DTE        05418000
054190           AND  TEM.ASGMT_NBR_TXT     = ASG.ASGMT_NBR_TXT         05419000
054200           AND  TEM.ASGMT_NBR_SEQ_NBR = ASG.ASGMT_NBR_SEQ_NBR     05420000
054300          ORDER BY TEM.LVE_TMST DESC                              05430000
054400          FETCH FIRST 1 ROW ONLY                                  05440000
054500         WITH UR                                                  05450000
054600     END-EXEC                                                     05460000
054700                                                                  05470000
054800     EVALUATE TRUE                                                05480000
054900         WHEN SQLCODE = ZERO                                      05490000
055000         WHEN SQLCODE = -811                                      05500000
055100             MOVE DLT00003-TMP-USR-ID  TO DL003-CRE-BY-USR-ID     05510000
055200         WHEN SQLCODE = +100                                      05520000
055300         WHEN SQLCODE = -305                                      05530000
055400             CONTINUE                                             05540000
055500         WHEN SQLWARN0 NOT = SPACE                                05550000
055600         WHEN SQLCODE  NOT = ZERO                                 05560000
055700             MOVE '4100-CHCK-TEMP-DOOR-SUMM '                     05570000
055800                                       TO PV-ABEND-PARAGRAPH      05580000
055900             MOVE 'SELECT'             TO PV-ABEND-OPERATION      05590000
056000             MOVE DK-ASGMT-NBR-SEQ-NBR TO PV-DISPLAY-NUMBER       05600000
056100             MOVE 'DLT_TEM_ASGMT'   TO PV-ABEND-STRUCTURE-1       05610000
056200             STRING  'STRT-DTE'            DELIMITED BY SIZE      05620000
056300                     DK-ASGMT-STRT-DTE     DELIMITED BY SIZE      05630000
056400                 ' ASGMT-NBR-TXT '         DELIMITED BY SIZE      05640000
056500                     DK-ASGMT-NBR-TXT      DELIMITED BY SIZE      05650000
056600                 ' ASGMT-NBR-SEQ '         DELIMITED BY SIZE      05660000
056700                 PV-DISPLAY-NUMBER         DELIMITED BY SIZE      05670000
056800                                INTO PV-DB2-OPERATION-MESSAGE-1   05680000
056900             PERFORM 9900-DB2-ABEND                               05690000
057000     END-EVALUATE.                                                05700000
057100                                                                  05710000
057200******************************************************************05720000
057300*  READ THE INPUT FILE                                            05730000
057400******************************************************************05740000
057500 7000-READ-INPUT.                                                 05750000
057600                                                                  05760000
057700     READ INPUT-EXPORT-FILE                                       05770000
057800       INTO DL003-EXPORT-RECORD-LAYOUT                            05780000
057900           AT END                                                 05790000
058000               SET PS-END-OF-EXTRACT-YES TO TRUE.                 05800000
058100                                                                  05810000
058200     IF PS-END-OF-EXTRACT-NO                                      05820000
058300        ADD 1 TO PA-INPUT-COUNT                                   05830000
058400     END-IF.                                                      05840000
058500                                                                  05850000
058600******************************************************************05860000
058700*  WRITE THE OUTPUT KEY RECORD                                    05870000
058800******************************************************************05880000
058900 7200-WRITE-OUTPUT-RECORD.                                        05890000
059000                                                                  05900000
059100     ADD 1 TO PA-OUTPUT-COUNT.                                    05910000
059200     WRITE OUTPUT-EXPORT-RECORD FROM                              05920000
059300           DL003-EXPORT-RECORD-LAYOUT.                            05930000
059400                                                                  05940000
059500     MOVE +0  TO PV-FETCH-COUNTER.                                05950000
059600******************************************************************05960000
059700* EOJ DISPLAYS                                                    05970000
059800******************************************************************05980000
059900 8500-EOJ-ROUTINE.                                                05990000
060000                                                                  06000000
060100     CLOSE INPUT-EXPORT-FILE                                      06010000
060200           OUTPUT-EXPORT-FILE.                                    06020000
060300                                                                  06030000
060400     DISPLAY '*******************************************'        06040000
060500     DISPLAY '      * DLKUT037 SUMMARY STATISTICS *      '        06050000
060600     DISPLAY ' '                                                  06060000
060700     DISPLAY '        ---------------------------        '        06070000
060800     DISPLAY '             KEY DATA EXTRACT              '        06080000
060900     DISPLAY '        ---------------------------        '        06090000
061000     DISPLAY ' '                                                  06100000
061100     DISPLAY ' INPUT  COUNT: ' PA-INPUT-COUNT.                    06110000
061200     DISPLAY ' OUTPUT COUNT: ' PA-OUTPUT-COUNT.                   06120000
061300     DISPLAY ' '                                                  06130000
061400     DISPLAY '************  END OF DLKUT037  ***************'.    06140000
061500                                                                  06150000
061600******************************************************************06160000
061700******************************************************************06170000
061800* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      06180000
061900* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 06190000
062000******************************************************************06200000
062100 9900-DB2-ABEND.                                                  06210000
062200                                                                  06220000
062300     MOVE SQLCODE    TO PV-SQLCODE.                               06230000
062400     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       06240000
062500     DISPLAY '*** DB2 ERROR ***'.                                 06250000
062600     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               06260000
062700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 06270000
062800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06280000
062900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06290000
063000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       06300000
063100     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             06310000
063200                                                                  06320000
063300******************************************************************06330000
063400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06340000
063500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06350000
063600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06360000
063700* FORMAT.                                                         06370000
063800******************************************************************06380000
063900     COPY DPPD004.                                                06390000
064000                                                                  06400000
064100     MOVE +4013         TO PV-ABEND-CODE.                         06410000
064200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06420000
064300******************************************************************06430000
