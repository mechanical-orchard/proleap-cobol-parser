      *-----------------------*                                         00010099
       IDENTIFICATION DIVISION.                                         00020099
      *-----------------------*                                         00030099
       PROGRAM-ID.    TFKCS450.                                         00040099
       AUTHOR.        JACK KRAMER.                                      00050099
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
       DATE-WRITTEN.  JANUARY 1997.                                     00070099
       DATE-COMPILED.                                                   00080099
      *-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=*00090099
      * CONTAINS LOGIC TO OVERRIDE MENOMONEE FALLS AND FINDLAY DC'S TO *00100099
      * RTV'S. (085 BECOMES 801 AND 810 BECOMES 811).                  *00110099
      *-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=*00120099
      *----------------------------------------------------------------*00130099
      *    P450 - RECEIVE TRANSFER.                                    *00140099
      *                                                                *00150099
      *    THIS PROGRAM ALLOWS THE USER TO SPECIFY THE TRANSFER        *00160099
      *    NUMBER TO BE RECEIVED.                                      *00170099
      ******************************************************************00180099
      * 11/17/2003 - RAY GRAF                                           00181099
      *   SORT1/SORT2 TRANSFER TYPES.                                   00182099
      ******************************************************************00183099
      **DATE:08/02/2004 CHANGED BY: RAY GRAF                            00184099
      **     NO LONGER ACCESS DP020-LOCATION. USE DPO20-LOCATION-NBR    00185099
      ***************************************************************** 00186099
      **DATE:10/04/2004 CHANGED BY: RAY GRAF                            00187099
      **     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00188099
      ***************************************************************** 00189099
021605**DATE:02/16/2005 CHANGED BY: DAVID WELLER                        00189199
021605**     STANDARDIZE USAGE OF TFWS008                               00189299
021605***************************************************************** 00189399
051705*  DATE 05/17/05 RAY GRAF                                         00189499
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00189599
051705******************************************************************00189699
060110*  DATE 06/01/10 JACKIE HELING                                    00189799
060110*  BLOCK CERTAIN LOCATIONS FROM SENDING/RECEIVING TRANSFERS.      00189899
060110******************************************************************00189999
033111* WR39649 -  DAVID WELLER - 03/31/2011                            00190099
033111*            MLOF - DO NOT EXCLUDE LOCATIONS 807, 808 AND 809     00190199
033111***************************************************************** 00190299
      * DATE:        09/24/2021                                         00190399
      * WR/IR#:      CHG0261678                                         00190499
      * PROGRAMMER:  GERMAN BANDA                                       00190599
      * DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00190699
      *              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00190799
      *              MAKING THE CALL DYNAMIC VS STATIC                  00190899
      *----------------------------------------------------------------*00190999
CICS  * CHANGED 11/17/2022    BY JIM HUNTER      WR: CHG0278345         00191099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00191199
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00191299
CICS  *-----------------------------------------------------------------00191399
                                                                        00191499
       ENVIRONMENT DIVISION.                                            00191599
                                                                        00191699
       DATA DIVISION.                                                   00191799
                                                                        00191899
                                                                        00191999
       WORKING-STORAGE SECTION.                                         00192099
      *                                                                 00200099
       01  PC-PROGRAM-CONSTANTS.                                        00210099
           05  PC-CURRENT-MAP-NAME     PIC  X(08) VALUE 'TF450A  '.     00220099
           05  PC-CURRENT-MAPSET-NAME  PIC  X(08) VALUE 'TFKM450 '.     00230099
           05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'TFKCS450'.     00240099
           05  PC-COMPLETED                    PIC  X(02)  VALUE 'CM'.  00250099
           05  PC-ASSUMPTIVELY-RECEIVED        PIC  X(02)  VALUE 'AR'.  00260099
           05  PC-POSITIVE-RECEIPT             PIC  X(02)  VALUE 'PR'.  00270099
           05  PC-INTERMEDIATELY-RECEIVED      PIC  X(02)  VALUE 'IR'.  00280099
           05  PC-DEFECTIVE-DAMAGE-SORT1       PIC  X(02)  VALUE '00'.  00290099
           05  PC-DEFECTIVE-DAMAGE-SORT2       PIC  X(02)  VALUE '01'.  00300099
           05  PC-CALLBACK                     PIC  X(02)  VALUE '02'.  00310099
           05  PC-STOCK-BALANCE-CORPORATE      PIC  X(02)  VALUE '03'.  00320099
           05  PC-STOCK-BALANCE-STORE          PIC  X(02)  VALUE '04'.  00330099
           05  PC-CUSTOMER                     PIC  X(02)  VALUE '05'.  00340099
           05  PC-NON-RETAIL                   PIC  X(02)  VALUE '06'.  00350099
           05  PC-OFFSITE-STORAGE              PIC  X(02)  VALUE '07'.  00360099
           05  PC-HAND-CARRY                   PIC  X(02)  VALUE '05'.  00370099
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   00380099
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   00390099
           05  PC-RTV                          PIC  X(02)  VALUE 'RV'.  00400099
           05  PC-RTV-MEN-FLS                  PIC  9(04)  VALUE  801.  00410099
           05  PC-DC-MEN-FLS                   PIC  9(05)  VALUE  085.  00420099
           05  PC-RTV-FINDLAY                  PIC  9(04)  VALUE  811.  00430099
           05  PC-DC-FINDLAY                   PIC  9(05)  VALUE  810.  00440099
           05  PC-DEPT-STORE                   PIC  X(02)  VALUE 'DS'.  00450099
           05  PC-VOID-STATUS                  PIC  X(02)  VALUE 'VD'.  00460099
           05  PC-OP-CO-NMBR                   PIC  X(02)  VALUE '03'.  00470099
           05  PC-MAX-RETRIES                  PIC S9(03)  VALUE 3      00500099
                                                           COMP-3.      00510099
           05  PC-TSYMSG-NUMBERS.                                       00520099
               10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00530099
               10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00540099
               10  PC-TSYMSG-00010       PIC  9(05)  VALUE  00010.      00550099
               10  PC-TSYMSG-01442       PIC  9(05)  VALUE  01442.      00560099
               10  PC-TSYMSG-01443       PIC  9(05)  VALUE  01443.      00570099
               10  PC-TSYMSG-01444       PIC  9(05)  VALUE  01444.      00580099
               10  PC-TSYMSG-01505       PIC  9(05)  VALUE  01505.      00590099
               10  PC-TSYMSG-01507       PIC  9(05)  VALUE  01507.      00600099
               10  PC-TSYMSG-01510       PIC  9(05)  VALUE  01510.      00610099
               10  PC-TSYMSG-01516       PIC  9(05)  VALUE  01516.      00620099
               10  PC-TSYMSG-01614       PIC  9(05)  VALUE  01614.      00630099
               10  PC-TSYMSG-01615       PIC  9(05)  VALUE  01615.      00640099
               10  PC-TSYMSG-01660       PIC  9(05)  VALUE  01660.      00650099
060110         10  PC-TSYMSG-03685       PIC  9(05)  VALUE  03685.      00651099
      *                                                                 00660099
       01  PS-PROGRAM-SWITCHES.                                         00670099
           05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00680099
               88  PS-ERROR                          VALUE  'Y'.        00690099
               88  PS-NO-ERROR                       VALUE  'N'.        00700099
           05  PS-WARNING-SW             PIC  X(01)  VALUE  'N'.        00710099
               88  PS-WARNING                        VALUE  'Y'.        00720099
               88  PS-NO-WARNING                     VALUE  'N'.        00730099
           05  PS-TYPE-FOUND-SW          PIC  X(01)  VALUE  'N'.        00740099
               88  PS-TYPE-FOUND                     VALUE  'Y'.        00750099
               88  PS-TYPE-NOT-FOUND                 VALUE  'N'.        00760099
           05  PS-TRANSFER-FOUND-SW     PIC X.                          00770099
               88  PS-TRANSFER-FOUND             VALUE 'Y'.             00780099
               88  PS-TRANSFER-NOT-FOUND         VALUE 'N'.             00790099
               88  PS-TRANSFER-VOIDED            VALUE 'V'.             00800099
      *                                                                 00810099
       01  PV-PROGRAM-VARIABLES.                                        00820099
           05  PV-CHK-DIGIT                    PIC  9(01)  VALUE ZEROS. 00830099
           05  PV-RETRY-COUNT                 PIC S9(04)  VALUE +0      00840099
                                                          COMP SYNC.    00850099
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 00860099
           05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  01080099
                                                           COMP SYNC.   01090099
                                                                        01100099
       01  PM-PROGRAM-MESSAGES.                                         01110099
           05  PM-ABEND-INFO-A.                                         01120099
               10  FILLER                PIC X(15)   VALUE              01130099
                                         'DP020-SRC-AID: '.             01140099
               10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01150099
               10  FILLER                PIC X(19)   VALUE              01160099
                                         '. DP020-FK-ACTION: '.         01170099
               10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01180099
               10  FILLER                PIC X(22)   VALUE              01190099
                                         '. DP020-FK-DISPN-IND: '.      01200099
               10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01210099
               10  FILLER                PIC X(01)   VALUE '.'.         01220099
               10  FILLER                PIC X(19)   VALUE SPACE.       01230099
                                                                        01240099
       01  DK-DB2-KEYS.                                                 01250099
           05  DK-STORE-NBR              PIC S9(04) COMP  VALUE +0.     01260099
           05  DK-FR-STR-NBR             PIC S9(04) COMP  VALUE +0.     01280099
           05  DK-XFER-SEQ-NBR           PIC S9(09) COMP  VALUE +0.     01290099
           05  DK-XFER-DKEY-ID           PIC S9(09) COMP  VALUE +0.     01300099
                                                                        01310099
      *----------------------------------------------------------------*01320099
      *    CHECK DIGIT COPYBOOK                                        *01330099
      *----------------------------------------------------------------*01340099
           COPY TFWS008.                                                01350099
                                                                        01360099
060110*----------------------------------------------------------------*01361099
060110*  LIST OF LOCATION EXCLUSIONS                                    01362099
060110*----------------------------------------------------------------*01363099
060110     COPY TFWS010.                                                01364099
                                                                        01365099
      *----------------------------------------------------------------*01370099
      *    MAP LAYOUT                                                  *01380099
      *----------------------------------------------------------------*01390099
                                                                        01400099
           COPY TFKM450.                                                01410099
           EJECT                                                        01420099
      *                                                                 01430099
      *----------------------------------------------------------------*01440099
      *    ATTRIBUTE SETTINGS COPYBOOK.                                *01450099
      *----------------------------------------------------------------*01460099
                                                                        01470099
           COPY DPWS015.                                                01480099
                                                                        01490099
      *----------------------------------------------------------------*01500099
      *    FUNCTION KEYS COPYBOOK                                      *01510099
      *----------------------------------------------------------------*01520099
                                                                        01530099
           COPY DPWS016.                                                01540099
       EJECT                                                            01550099
      ******************************************************************01560099
      ** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01570099
      ** SUB-ROUTINE (DPKUT100).                                      **01580099
      ******************************************************************01590099
           COPY DPWS010I.                                               01600099
       EJECT                                                            01610099
      ******************************************************************01620099
      ** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01630099
      ** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01640099
      ******************************************************************01650099
           COPY DPWS030.                                                01660099
CICS       COPY DPWS930.                                                01661099
       EJECT                                                            01670099
      ***************************************************************** 01680099
      *    STANDARD COMMAREA.                                           01690099
      ***************************************************************** 01700099
                                                                        01710099
           COPY DPWS020.                                                01720099
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01730099
                                                                        01740099
      ***************************************************************** 01750099
      *    INTER-APPLICATION COMMAREA.                                  01760099
      ***************************************************************** 01770099
                                                                        01780099
               10  INTER-APPL-COMM-AREA PIC X(200).                     01790099
           COPY TFWS006.                                                01800099
      ***************************************************************** 01810099
      *    SPECIFIC COMMMAREA FOR TFKCS450                              01820099
      ***************************************************************** 01830099
               10  ASC-SPECIFIC-COMMAREA.                               01840099
                   15  ASC-STORE-NBR               PIC  9(04).          01850099
                   15  ASC-TO-STORE-NBR            PIC  9(04).          01860099
                   15  ASC-TYPE-CODE               PIC  X(02).          01870099
                   15  ASC-HOLD-XFER-NBR           PIC  X(10).          01880099
                   15  ASC-XFER-NBR.                                    01890099
                       20  ASC-XFER-FR-STR.                             01900099
                           25  ASC-XFER-FR-STR-N   PIC  9(04).          01910099
                       20  ASC-XFER-SEQ-NBR.                            01920099
                           25  ASC-XFER-SEQ-NBR-N  PIC  9(06).          01930099
                   15  ASC-XFER-NBR-N REDEFINES ASC-XFER-NBR            01940099
                                                   PIC  9(10).          01950099
                   15  ASC-XFER-CHECK-DIGIT.                            01960099
                       20  ASC-XFER-CHECK-DIGIT-N  PIC  9(01).          01970099
                   15  ASC-XFER-DKEY-ID            PIC S9(09) COMP.     01980099
                   15  ASC-XFER-TYP-CDE            PIC  X(02).          01990099
                   15  ASC-CONTNR-TYP-CDE          PIC  X(02).          02000099
                   15  ASC-CMPLT-DATE              PIC  X(10).          02010099
                   15  ASC-CURRENT-TIMESTAMP       PIC  X(26).          02020099
                   15  ASC-CONTINUE-OVERRIDE-SW    PIC  X(01).          02030099
                       88  ASC-CONTINUE-OVERRIDE       VALUE 'Y'.       02040099
                       88  ASC-NO-CONTINUE-OVERRIDE    VALUE 'N'.       02050099
                   15  ASC-IR-WRITTEN-SW           PIC  X(01).          02060099
                       88  ASC-IR-WRITTEN              VALUE 'Y'.       02070099
                       88  ASC-IR-NOT-WRITTEN          VALUE 'N'.       02080099
                   15  ASC-RCV-STR-OVRRID-IND      PIC  X(01).          02090099
                       88  ASC-RCV-STR-OVERRIDE      VALUE 'Y'.         02100099
                       88  ASC-NO-RCV-STR-OVERRIDE   VALUE 'N'.         02110099
                   15  ASC-CALL-IC-IND             PIC  X(01).          02120099
                       88  ASC-CALL-INV-CONTROL      VALUE 'Y'.         02130099
                       88  ASC-NO-CALL-INV-CONTROL   VALUE ' '.         02140099
           EJECT                                                        02150099
      *----------------------------------------------------------------*02160099
      *    ABEND PROCESSING COPYBOOK.                                  *02170099
      *----------------------------------------------------------------*02180099
                                                                        02190099
           COPY DPWS013.                                                02200099
                                                                        02210099
      *---------------------------------------------------------------* 02220099
      *    DB2 AREA FOR TRANSFER MASTER TABLE                         * 02230099
      *---------------------------------------------------------------* 02240099
           EXEC SQL                                                     02250099
                INCLUDE TTFMSTR                                         02260099
           END-EXEC.                                                    02270099
      *---------------------------------------------------------------* 02280099
      *    DB2 AREA FOR TRANSFER RECEIPT TABLE                        * 02290099
      *---------------------------------------------------------------* 02300099
           EXEC SQL                                                     02310099
                INCLUDE TTFRCPT                                         02320099
           END-EXEC.                                                    02330099
      *---------------------------------------------------------------* 02340099
      *    DB2 AREA FOR TRANSFER DISCREPANCY TABLE                    * 02350099
      *---------------------------------------------------------------* 02360099
           EXEC SQL                                                     02370099
                INCLUDE TTFDSCP                                         02380099
           END-EXEC.                                                    02390099
      *---------------------------------------------------------------* 02400099
      *    DB2 AREA FOR TRANSFER STATUS CODE TABLE                    * 02410099
      *---------------------------------------------------------------* 02420099
           EXEC SQL                                                     02430099
                INCLUDE TTFSTCD                                         02440099
           END-EXEC.                                                    02450099
      *---------------------------------------------------------------* 02460099
      *    DB2 AREA FOR TRANSFER STATUS TABLE                         * 02470099
      *---------------------------------------------------------------* 02480099
           EXEC SQL                                                     02490099
                INCLUDE TTFSTAT                                         02500099
           END-EXEC.                                                    02510099
      *---------------------------------------------------------------* 02520099
      *    DB2 AREA FOR XST_LOC TABLE                                 * 02530099
      *---------------------------------------------------------------* 02540099
           EXEC SQL                                                     02550099
                INCLUDE XST00001                                        02560099
           END-EXEC.                                                    02570099
      *---------------------------------------------------------------* 02700099
      *    DB2 AREA FOR COMMUNICATIONS                                * 02710099
      *---------------------------------------------------------------* 02720099
           EXEC SQL                                                     02730099
                INCLUDE SQLCA                                           02740099
           END-EXEC.                                                    02750099
                                                                        02760099
       EJECT                                                            02770099
       LINKAGE SECTION.                                                 02780099
                                                                        02790099
       01  DFHCOMMAREA.                                                 02800099
           05  FILLER                         OCCURS  1 TO 4072 TIMES   02810099
                                              DEPENDING ON EIBCALEN.    02820099
               10  FILLER                     PIC X.                    02830099
                                                                        02840099
                                                                        02850099
       PROCEDURE DIVISION.                                              02860099
      ***************************************************************** 02870099
      ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02880099
      ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02890099
      ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02900099
      **                                                             ** 02910099
      ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02920099
      ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02930099
      ***************************************************************** 02940099
       0000-MAIN-MODULE.                                                02950099
           INITIALIZE DP030-CICS-API-FIELDS.                            02960099
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02970099
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02980099
           MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02990099
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03000099
           MOVE LENGTH OF TF450AI        TO DP030-MAP-LENGTH (1).       03010099
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03020099
           PERFORM 0001-CALL-CICS-ARCH-API.                             03030099
      *                                                                 03040099
           PERFORM 1000-CONTROL-PROCESSING                              03050099
      *                                                                 03060099
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03070099
           PERFORM 0001-CALL-CICS-ARCH-API.                             03080099
                                                                        03090099
       0001-CALL-CICS-ARCH-API.                                         03100099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03110099
                                          DFHCOMMAREA                   03120099
                                          DP030-CICS-API-FIELDS         03130099
                                          DP020-STANDARD-COMMAREA       03140099
                                          TF450AI.                      03150099
      *                                                                 03160099
           IF  DP030-RC-CALL-SUCCESSFUL                                 03170099
               CONTINUE                                                 03180099
           ELSE                                                         03190099
               SET DP013-NO-ROLLBACK                                    03200099
                   DP013-XCTL-DISPLAY-RESTART                           03210099
                   DP013-CICS-ABEND      TO TRUE                        03220099
               MOVE 'BEFORE 0000-MAIN-MODULE'                           03230099
                                         TO DP013-PARAGRAPH             03240099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03241099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03242099
               MOVE DP030-RETURN-CODE                                   03270099
                                         TO DP013-MESSAGE-TEXT (3)      03280099
               PERFORM DP013-0000-PROCESS-ABEND                         03290099
           END-IF.                                                      03300099
       EJECT                                                            03310099
      *----------------------------------------------------------------*03320099
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03330099
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03340099
      *----------------------------------------------------------------*03350099
                                                                        03360099
       1000-CONTROL-PROCESSING.                                         03370099
                                                                        03380099
           EVALUATE TRUE                                                03390099
               WHEN DP020-NEXT-ACT-INITIAL                              03400099
                   MOVE SPACES           TO ASC-SPECIFIC-COMMAREA       03410099
                   SET ASC-IR-NOT-WRITTEN       TO TRUE                 03420099
                   PERFORM 4000-BUILD-INITIAL-PANEL                     03430099
                                                                        03440099
               WHEN DP020-NEXT-ACT-READ-MAP                             03450099
                   PERFORM 2000-FKEY-PROCESSING                         03460099
                                                                        03470099
               WHEN DP020-NEXT-ACT-RETURN                               03480099
                   SET ASC-NO-CONTINUE-OVERRIDE TO TRUE                 03490099
                   IF TF006-RCV-STR-OVERRIDE                            03500099
                       MOVE TF006-RCV-STR-NBR   TO ASC-STORE-NBR        03510099
                       SET ASC-RCV-STR-OVERRIDE                         03520099
                           ASC-IR-NOT-WRITTEN   TO TRUE                 03530099
                       PERFORM 5000-READ-XST-LOC                        03540099
                       MOVE XST00001-LOC-TYP-CDE TO ASC-TYPE-CODE       03550099
060110                 MOVE ASC-STORE-NBR TO PV-LOC-EXCLUSION           03551099
060110                 IF PV-EXCLUDE                                    03552099
060110                    SET DP020-MSG-FATAL        TO TRUE            03553099
060110                    MOVE DP015-UNP-ALP-BRT-OFF TO ARCVSTRA        03554099
060110                    MOVE DP015-RED             TO ARCVSTRC        03556099
060110                    MOVE DP015-REVERSE         TO ARCVSTRH        03557099
060110*            -- INVALID LOCATION                                  03558099
060110                    IF PS-NO-ERROR                                03559099
060110                       MOVE PC-TSYMSG-03685 TO DP020-MSG-NUMBER   03559199
060110                       MOVE -1           TO ARCVSTRL              03559299
060110                       SET DP030-SET-CURSOR-APPL-1 TO TRUE        03559399
060110                       SET PS-ERROR                TO TRUE        03559599
060110                    END-IF                                        03559699
060110                 END-IF                                           03559799
                   END-IF                                               03560099
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03570099
                                                                        03580099
               WHEN OTHER                                               03590099
                   SET DP013-LOGIC-ABEND                                03600099
                       DP013-NO-ROLLBACK TO TRUE                        03610099
                   MOVE '1000-CONTROL-PROCESSING'                       03620099
                                         TO  DP013-PARAGRAPH            03630099
                   MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03640099
                                         TO  DP013-MESSAGE-TEXT(1)      03650099
                   MOVE DP020-NEXT-APPL-ACTIVITY                        03660099
                                         TO DP013-MESSAGE-TEXT(2)       03670099
                   PERFORM DP013-0000-PROCESS-ABEND                     03680099
           END-EVALUATE.                                                03690099
                                                                        03700099
      *----------------------------------------------------------------*03710099
      * FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03720099
      * SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03730099
      * EDITS.                                                         *03740099
      *----------------------------------------------------------------*03750099
                                                                        03760099
       2000-FKEY-PROCESSING.                                            03770099
                                                                        03780099
           EVALUATE TRUE                                                03790099
                                                                        03800099
               WHEN DP020-SRC-AID = DP016-ENTER                         03810099
                   SET ASC-NO-CONTINUE-OVERRIDE TO TRUE                 03820099
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03830099
                   PERFORM 3200-RESET-ATTRIBUTES                        03840099
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03850099
                                                                        03860099
               WHEN DP020-SRC-AID = DP016-CLEAR                         03870099
                   SET ASC-NO-CONTINUE-OVERRIDE TO TRUE                 03880099
                   PERFORM 3200-RESET-ATTRIBUTES                        03890099
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03900099
                                                                        03910099
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03920099
                   MOVE SPACES           TO ASC-SPECIFIC-COMMAREA       03930099
                   SET ASC-IR-NOT-WRITTEN       TO TRUE                 03940099
                   PERFORM 4000-BUILD-INITIAL-PANEL                     03950099
                                                                        03960099
               WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03970099
      * ------- RECV STR -----------------------------------------------03980099
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03990099
                   SET DP030-CONTINUE-GO TO TRUE                        04000099
                   PERFORM 2140-PREPARE-INTER-APPL-COMM                 04010099
                                                                        04020099
               WHEN OTHER                                               04030099
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04040099
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04050099
                   IF  PS-NO-ERROR                                      04060099
                       SET DP030-CONTINUE-GO TO TRUE                    04070099
                       PERFORM 2100-CHECK-FUNCTION-KEY                  04080099
                   ELSE                                                 04090099
                       SET DP030-OVERRIDE-GO TO TRUE                    04100099
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04110099
                   END-IF                                               04120099
           END-EVALUATE.                                                04130099
      ******************************************************************04140099
      ** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04150099
      ** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04160099
      ** FROM THE CICS ARCHITECTURE API.                              **04170099
      ******************************************************************04180099
       2100-CHECK-FUNCTION-KEY.                                         04190099
           EVALUATE TRUE                                                04200099
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04210099
                                                                        04630099
                   IF ASC-IR-NOT-WRITTEN                                04640099
                       SET ASC-IR-WRITTEN    TO TRUE                    04650099
                       PERFORM 7000-SELECT-CURRENT-TIMESTAMP            04660099
                       PERFORM 7600-INSERT-XFER-RECEIPT-ROW             04670099
                       PERFORM 7650-INSERT-XFER-IR-STAT-ROW             04680099
                   END-IF                                               04690099
                                                                        04700099
                   IF PS-NO-ERROR                                       04710099
                       IF ASC-TO-STORE-NBR NOT = ASC-STORE-NBR          04720099
                           PERFORM 3050-CHECK-MISDIRECT                 04730099
                       END-IF                                           04740099
                   END-IF                                               04750099
                   IF PS-ERROR                                          04760099
                       SET DP030-OVERRIDE-GO TO TRUE                    04770099
                   ELSE                                                 04780099
                       IF PS-NO-WARNING                                 04790099
                           PERFORM 2140-PREPARE-INTER-APPL-COMM         04800099
                           MOVE ZERO       TO DP020-MSG-NUMBER          04810099
                       ELSE                                             04820099
                           IF ASC-CONTINUE-OVERRIDE                     04830099
                               PERFORM 2140-PREPARE-INTER-APPL-COMM     04840099
                               MOVE ZERO       TO DP020-MSG-NUMBER      04850099
                           ELSE                                         04860099
                               SET DP030-OVERRIDE-GO TO TRUE            04870099
      * -- THIS TRANSFER IS A MISDIRECT, PRESS 'F17' AGAIN TO CONTINUE  04880099
                               MOVE PC-TSYMSG-01510 TO  DP020-MSG-NUMBER04890099
                               MOVE 'F17'           TO  DP020-MSG-TEXT  04900099
                               SET DP020-MSG-WARNING                    04910099
                                   ASC-CONTINUE-OVERRIDE    TO TRUE     04920099
                           END-IF                                       04930099
                       END-IF                                           04940099
                   END-IF                                               04950099
                                                                        04960099
               WHEN OTHER                                               04970099
                   SET DP013-NO-ROLLBACK                                04980099
                       DP013-XCTL-DISPLAY-RESTART                       04990099
                       DP013-CICS-ABEND  TO TRUE                        05000099
                   MOVE '2100-CHECK-FUNCTION-KEY'                       05010099
                                         TO DP013-PARAGRAPH             05020099
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05030099
                                         TO DP013-MESSAGE-TEXT (1)      05040099
                   MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 05050099
                                         TO DP013-MESSAGE-TEXT (2)      05060099
                   MOVE DP020-SRC-AID    TO PM-A-SRC-AID                05070099
                   MOVE DP020-FK-ACTION (DP020-SRC-AID)                 05080099
                                         TO PM-A-FK-ACTION              05090099
                   MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              05100099
                                         TO PM-A-FK-DISPN               05110099
                   MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      05120099
                   MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        05130099
                                         TO DP013-MESSAGE-TEXT (4)      05140099
                   PERFORM DP013-0000-PROCESS-ABEND                     05150099
           END-EVALUATE.                                                05160099
      *----------------------------------------------------------------*05170099
      *  CHECK TO SEE IF SOMEONE ELSE HAS STARTED RECEIVING THE         05180099
      *  TRANSFER ON A PTC.                                             05190099
      *----------------------------------------------------------------*05200099
       2110-CHK-XFER-STATUS.                                            05210099
           PERFORM 7050-SELECT-MAX-STAT-TMST.                           05220099
           PERFORM 7100-SELECT-CURRENT-STATUS.                          05230099
                                                                        05240099
           EVALUATE TFSTAT-XFER-STAT-CDE                                05250099
               WHEN PC-COMPLETED                                        05260099
               WHEN PC-INTERMEDIATELY-RECEIVED                          05270099
               WHEN PC-ASSUMPTIVELY-RECEIVED                            05280099
                   CONTINUE                                             05290099
               WHEN OTHER                                               05300099
                   MOVE TFSTCD-XFER-STAT-DESC  TO  DP020-MSG-TEXT       05310099
                   SET  DP020-MSG-FATAL                                 05320099
                        DP030-OVERRIDE-GO                               05330099
                        PS-ERROR               TO  TRUE                 05340099
                   MOVE PC-TSYMSG-01443        TO  DP020-MSG-NUMBER     05350099
           END-EVALUATE.                                                05360099
      *                                                                 05370099
       2120-CHK-XFER-IN-USE.                                            05380099
           PERFORM 7150-SELECT-MAX-RCPT-TMST.                           05390099
                                                                        05400099
           IF PV-NULL-IND IS NOT NEGATIVE                               05410099
               PERFORM 7200-SELECT-CURRENT-RCPT                         05420099
               IF TFRCPT-RCV-XFER-BEG-TMST  =  TFRCPT-RCV-XFER-END-TMST 05430099
                   SET  DP020-MSG-FATAL                                 05440099
                        DP030-OVERRIDE-GO                               05450099
                        PS-ERROR               TO  TRUE                 05460099
                   MOVE PC-TSYMSG-01444  TO  DP020-MSG-NUMBER           05470099
               END-IF                                                   05480099
           END-IF.                                                      05490099
      *                                                                 05500099
      ******************************************************************05510099
      ** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **05520099
      ** INTER-APPLICATION COMMAREA.                                  **05530099
      ******************************************************************05540099
       2140-PREPARE-INTER-APPL-COMM.                                    05550099
           INITIALIZE TF006-INTER-APPL-COMMAREA.                        05560099
           MOVE ASC-XFER-NBR-N          TO TF006-XFER-NBR.              05570099
           MOVE ASC-XFER-DKEY-ID        TO TF006-DKEY-ID.               05580099
           MOVE ASC-XFER-TYP-CDE        TO TF006-XFER-TYPE.             05590099
           MOVE ASC-CONTNR-TYP-CDE      TO TF006-CONTNR-TYPE.           05600099
           MOVE ASC-XFER-CHECK-DIGIT-N  TO TF006-CHECK-DIGIT.           05610099
           MOVE ASC-CURRENT-TIMESTAMP   TO TF006-RCV-XFER-BEG-TMST.     05620099
           MOVE ASC-STORE-NBR           TO TF006-RCV-STR-NBR.           05630099
           MOVE ASC-RCV-STR-OVRRID-IND  TO TF006-RCV-STR-OVRRID-IND.    05640099
           MOVE ASC-CALL-IC-IND         TO TF006-CALL-IC-IND.           05650099
       EJECT                                                            05660099
      *----------------------------------------------------------------*05670099
      * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*05680099
      * THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *05690099
      * APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *05700099
      *----------------------------------------------------------------*05710099
                                                                        05720099
       2200-MOVE-SCREEN-TO-COMMAREA.                                    05730099
           IF  AFRMSTRL > 0                                             05740099
               MOVE AFRMSTRI             TO ASC-XFER-FR-STR             05750099
           ELSE                                                         05760099
               IF  AFRMSTRF = DP015-ERASE-EOF                           05770099
                   MOVE ZERO             TO ASC-XFER-FR-STR             05780099
               END-IF                                                   05790099
           END-IF.                                                      05800099
                                                                        05810099
           IF  ASEQNBRL > 0                                             05820099
               MOVE ASEQNBRI             TO ASC-XFER-SEQ-NBR            05830099
           ELSE                                                         05840099
               IF  ASEQNBRF = DP015-ERASE-EOF                           05850099
                   MOVE ZERO             TO ASC-XFER-SEQ-NBR            05860099
               END-IF                                                   05870099
           END-IF.                                                      05880099
                                                                        05890099
           IF  ACHKDGTL > 0                                             05900099
               MOVE ACHKDGTI             TO ASC-XFER-CHECK-DIGIT        05910099
           ELSE                                                         05920099
               IF  ACHKDGTF = DP015-ERASE-EOF                           05930099
                   MOVE ZERO             TO ASC-XFER-CHECK-DIGIT        05940099
               END-IF                                                   05950099
           END-IF.                                                      05960099
                                                                        05970099
      *----------------------------------------------------------------*05980099
      * ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *05990099
      * CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *06000099
      * A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*06010099
      * IN THE DESTINATION PROGRAM, NOT HERE.                          *06020099
      *----------------------------------------------------------------*06030099
                                                                        06040099
       3000-EDIT-DATA-IN-COMMAREA.                                      06050099
           SET PS-NO-ERROR                                              06060099
               ASC-NO-CALL-INV-CONTROL                                  06070099
               PS-NO-WARNING             TO TRUE.                       06080099
           PERFORM 3200-RESET-ATTRIBUTES.                               06090099
           IF ASC-XFER-FR-STR > SPACE                                   06100099
               MOVE ASC-XFER-FR-STR      TO DP010I-UNEDITED-FIELD       06110099
               MOVE LENGTH OF ASC-XFER-FR-STR                           06120099
                                         TO DP010I-MAXIMUM-DIGITS       06130099
               MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     06140099
               SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06150099
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         06161099
                         USING DP010I-NUMERIC-EDIT-AREA                 06162099
               IF  DP010I-ERROR-DETECTED                                06170099
                   SET DP020-MSG-FATAL   TO TRUE                        06180099
      *            -- MUST BE NUMERIC --                                06190099
                   MOVE DP015-UNP-ALP-BRT-OFF                           06200099
                                         TO AFRMSTRA                    06210099
                   MOVE DP015-RED        TO AFRMSTRC                    06220099
                   MOVE DP015-REVERSE    TO AFRMSTRH                    06230099
                   IF PS-NO-ERROR                                       06240099
                       MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         06250099
                       MOVE -1           TO AFRMSTRL                    06260099
                       SET DP030-SET-CURSOR-APPL-1                      06270099
                                         TO TRUE                        06280099
                       SET PS-ERROR      TO TRUE                        06290099
                   END-IF                                               06300099
               ELSE                                                     06310099
                   MOVE DP010I-NUMERIC-FIELD                            06320099
                                         TO ASC-XFER-FR-STR-N           06330099
                   IF ASC-XFER-FR-STR-N NOT > 0                         06340099
                       SET DP020-MSG-FATAL   TO TRUE                    06350099
      *            -- CAN NOT BE ZERO --                                06360099
                       MOVE DP015-UNP-ALP-BRT-OFF                       06370099
                                             TO AFRMSTRA                06380099
                       MOVE DP015-RED        TO AFRMSTRC                06390099
                       MOVE DP015-REVERSE    TO AFRMSTRH                06400099
                       IF PS-NO-ERROR                                   06410099
                           MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER     06420099
                           MOVE -1           TO AFRMSTRL                06430099
                           SET DP030-SET-CURSOR-APPL-1                  06440099
                                             TO TRUE                    06450099
                           SET PS-ERROR      TO TRUE                    06460099
                       END-IF                                           06470099
                   ELSE                                                 06480099
                       IF ASC-XFER-FR-STR-N = ASC-STORE-NBR             06490099
                           SET DP020-MSG-FATAL   TO TRUE                06500099
      *  -- CAN NOT RECEIVE YOUR OWN TRANSFER --                        06510099
                           MOVE DP015-UNP-ALP-BRT-OFF                   06520099
                                                 TO AFRMSTRA            06530099
                           MOVE DP015-RED        TO AFRMSTRC            06540099
                           MOVE DP015-REVERSE    TO AFRMSTRH            06550099
                           IF PS-NO-ERROR                               06560099
                               MOVE PC-TSYMSG-01516 TO DP020-MSG-NUMBER 06570099
                               MOVE -1           TO AFRMSTRL            06580099
                               SET DP030-SET-CURSOR-APPL-1              06590099
                                                 TO TRUE                06600099
                               SET PS-ERROR      TO TRUE                06610099
                           END-IF                                       06620099
                       END-IF                                           06630099
                   END-IF                                               06640099
               END-IF                                                   06650099
           ELSE                                                         06660099
               SET DP020-MSG-FATAL   TO TRUE                            06670099
      *            -- REQUIRED FIELD --                                 06680099
               MOVE DP015-UNP-ALP-BRT-OFF                               06690099
                                     TO AFRMSTRA                        06700099
               MOVE DP015-RED        TO AFRMSTRC                        06710099
               MOVE DP015-REVERSE    TO AFRMSTRH                        06720099
               IF PS-NO-ERROR                                           06730099
                   MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             06740099
                   MOVE -1           TO AFRMSTRL                        06750099
                   SET DP030-SET-CURSOR-APPL-1                          06760099
                                     TO TRUE                            06770099
                   SET PS-ERROR      TO TRUE                            06780099
               END-IF                                                   06790099
           END-IF.                                                      06800099
                                                                        06800199
060110     MOVE ASC-XFER-FR-STR-N TO PV-LOC-EXCLUSION.                  06801099
060110     IF PV-EXCLUDE                                                06802099
060110         SET DP020-MSG-FATAL   TO TRUE                            06803099
060110         MOVE DP015-UNP-ALP-BRT-OFF                               06803199
060110                               TO AFRMSTRA                        06803299
060110         MOVE DP015-RED        TO AFRMSTRC                        06803399
060110         MOVE DP015-REVERSE    TO AFRMSTRH                        06803499
060110*  -- NOT ALLOWED TO RECEIVE A TRANSFER FROM THIS LOCATION        06804099
060110         IF PS-NO-ERROR                                           06805099
060110             MOVE PC-TSYMSG-03685 TO DP020-MSG-NUMBER             06806099
060110             MOVE -1           TO AFRMSTRL                        06807099
060110             SET DP030-SET-CURSOR-APPL-1                          06808099
060110                               TO TRUE                            06809099
060110             SET PS-ERROR      TO TRUE                            06809199
060110         END-IF                                                   06809299
060110     END-IF.                                                      06809399
                                                                        06809499
060110     MOVE ASC-STORE-NBR TO PV-LOC-EXCLUSION                       06809599
060110     IF PV-EXCLUDE                                                06809699
060110        SET DP020-MSG-FATAL        TO TRUE                        06809799
060110        MOVE DP015-UNP-ALP-BRT-OFF TO ARCVSTRA                    06809899
060110        MOVE DP015-RED             TO ARCVSTRC                    06809999
060110        MOVE DP015-REVERSE         TO ARCVSTRH                    06810099
060110*   -- INVALID LOCATION                                           06810199
060110        IF PS-NO-ERROR                                            06810299
060110            MOVE PC-TSYMSG-03685 TO DP020-MSG-NUMBER              06810399
060110            MOVE -1           TO ARCVSTRL                         06810499
060110            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   06810599
060110            SET PS-ERROR                TO TRUE                   06810699
060110         END-IF                                                   06810799
060110     END-IF.                                                      06810899
                                                                        06810999
           IF ASC-XFER-SEQ-NBR > SPACE                                  06811099
               MOVE ASC-XFER-SEQ-NBR     TO DP010I-UNEDITED-FIELD       06820099
               MOVE 6                    TO DP010I-MAXIMUM-DIGITS       06830099
               MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     06840099
               SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06850099
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         06861099
                         USING DP010I-NUMERIC-EDIT-AREA                 06862099
               IF  DP010I-ERROR-DETECTED                                06870099
                   SET DP020-MSG-FATAL   TO TRUE                        06880099
      *            -- MUST BE NUMERIC --                                06890099
                   MOVE DP015-UNP-ALP-BRT-OFF                           06900099
                                         TO ASEQNBRA                    06910099
                   MOVE DP015-RED        TO ASEQNBRC                    06920099
                   MOVE DP015-REVERSE    TO ASEQNBRH                    06930099
                   IF PS-NO-ERROR                                       06940099
                       MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         06950099
                       MOVE -1           TO ASEQNBRL                    06960099
                       SET DP030-SET-CURSOR-APPL-1                      06970099
                                         TO TRUE                        06980099
                       SET PS-ERROR      TO TRUE                        06990099
                   END-IF                                               07000099
               ELSE                                                     07010099
                   MOVE DP010I-NUMERIC-FIELD                            07020099
                                         TO ASC-XFER-SEQ-NBR-N          07030099
                   IF ASC-XFER-SEQ-NBR-N NOT > 0                        07040099
                       SET DP020-MSG-FATAL   TO TRUE                    07050099
      *            -- CAN NOT BE ZERO --                                07060099
                       MOVE DP015-UNP-ALP-BRT-OFF                       07070099
                                             TO ASEQNBRA                07080099
                       MOVE DP015-RED        TO ASEQNBRC                07090099
                       MOVE DP015-REVERSE    TO ASEQNBRH                07100099
                       IF PS-NO-ERROR                                   07110099
                           MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER     07120099
                           MOVE -1           TO ASEQNBRL                07130099
                           SET DP030-SET-CURSOR-APPL-1                  07140099
                                             TO TRUE                    07150099
                           SET PS-ERROR      TO TRUE                    07160099
                       END-IF                                           07170099
                   END-IF                                               07180099
               END-IF                                                   07190099
           ELSE                                                         07200099
               SET DP020-MSG-FATAL   TO TRUE                            07210099
      *            -- REQUIRED FIELD --                                 07220099
               MOVE DP015-UNP-ALP-BRT-OFF                               07230099
                                     TO ASEQNBRA                        07240099
               MOVE DP015-RED        TO ASEQNBRC                        07250099
               MOVE DP015-REVERSE    TO ASEQNBRH                        07260099
               IF PS-NO-ERROR                                           07270099
                   MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             07280099
                   MOVE -1           TO ASEQNBRL                        07290099
                   SET DP030-SET-CURSOR-APPL-1                          07300099
                                     TO TRUE                            07310099
                   SET PS-ERROR      TO TRUE                            07320099
               END-IF                                                   07330099
           END-IF.                                                      07340099
           IF ASC-XFER-CHECK-DIGIT NOT > SPACE                          07350099
               SET DP020-MSG-FATAL   TO TRUE                            07360099
      *            -- REQUIRED FIELD --                                 07370099
               MOVE DP015-UNP-ALP-BRT-OFF                               07380099
                                     TO ACHKDGTA                        07390099
               MOVE DP015-RED        TO ACHKDGTC                        07400099
               MOVE DP015-REVERSE    TO ACHKDGTH                        07410099
               IF PS-NO-ERROR                                           07420099
                   MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             07430099
                   MOVE -1           TO ACHKDGTL                        07440099
                   SET DP030-SET-CURSOR-APPL-1                          07450099
                                     TO TRUE                            07460099
                   SET PS-ERROR      TO TRUE                            07470099
               END-IF                                                   07480099
           ELSE                                                         07490099
               IF ASC-XFER-CHECK-DIGIT-N NOT NUMERIC                    07500099
                   SET DP020-MSG-FATAL   TO TRUE                        07510099
      *            -- MUST BE NUMERIC --                                07520099
                   MOVE DP015-UNP-ALP-BRT-OFF                           07530099
                                         TO ACHKDGTA                    07540099
                   MOVE DP015-RED        TO ACHKDGTC                    07550099
                   MOVE DP015-REVERSE    TO ACHKDGTH                    07560099
                   IF PS-NO-ERROR                                       07570099
                       MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         07580099
                       MOVE -1           TO ACHKDGTL                    07590099
                       SET DP030-SET-CURSOR-APPL-1                      07600099
                                         TO TRUE                        07610099
                       SET PS-ERROR      TO TRUE                        07620099
                   END-IF                                               07630099
               END-IF                                                   07640099
           END-IF.                                                      07650099
           IF PS-NO-ERROR                                               07660099
021605         MOVE ASC-XFER-FR-STR-N    TO TF008-XFER-FROM-STORE-NBR   07670099
021605         MOVE ASC-XFER-SEQ-NBR-N   TO TF008-XFER-SEQ-NBR          07680099
               PERFORM TFPD008-GET-CHK-DIGIT                            07690099
021605         MOVE TF008-CHK-DIGIT      TO PV-CHK-DIGIT                07700099
               IF ASC-XFER-CHECK-DIGIT-N NOT = PV-CHK-DIGIT             07710099
                   SET DP020-MSG-FATAL   TO TRUE                        07720099
      *            -- TRANSFER NOT FOUND --                             07730099
                   MOVE DP015-UNP-ALP-BRT-OFF                           07740099
                                         TO AFRMSTRA                    07750099
                                            ASEQNBRA                    07760099
                                            ACHKDGTA                    07770099
                   MOVE DP015-RED        TO AFRMSTRC                    07780099
                                            ASEQNBRC                    07790099
                                            ACHKDGTC                    07800099
                   MOVE DP015-REVERSE    TO AFRMSTRH                    07810099
                                            ASEQNBRH                    07820099
                                            ACHKDGTH                    07830099
                   IF PS-NO-ERROR                                       07840099
                       MOVE PC-TSYMSG-01442 TO DP020-MSG-NUMBER         07850099
                       MOVE -1           TO AFRMSTRL                    07860099
                       SET DP030-SET-CURSOR-APPL-1                      07870099
                                         TO TRUE                        07880099
                       SET PS-ERROR      TO TRUE                        07890099
                   END-IF                                               07900099
               END-IF                                                   07910099
           END-IF.                                                      07920099
           IF PS-NO-ERROR                                               07930099
               SET PS-TRANSFER-NOT-FOUND TO TRUE                        07940099
               PERFORM 4100-GET-TRANSFER                                07950099
               IF PS-TRANSFER-NOT-FOUND                                 07960099
                   SET DP020-MSG-FATAL   TO TRUE                        07970099
      *            -- TRANSFER NOT FOUND --                             07980099
                   MOVE DP015-UNP-ALP-BRT-OFF                           07990099
                                         TO AFRMSTRA                    08000099
                                            ASEQNBRA                    08010099
                                            ACHKDGTA                    08020099
                   MOVE DP015-RED        TO AFRMSTRC                    08030099
                                            ASEQNBRC                    08040099
                                            ACHKDGTC                    08050099
                   MOVE DP015-REVERSE    TO AFRMSTRH                    08060099
                                            ASEQNBRH                    08070099
                                            ACHKDGTH                    08080099
                   IF PS-NO-ERROR                                       08090099
                       MOVE PC-TSYMSG-01442 TO DP020-MSG-NUMBER         08100099
                       MOVE -1           TO AFRMSTRL                    08110099
                       SET DP030-SET-CURSOR-APPL-1                      08120099
                                         TO TRUE                        08130099
                       SET PS-ERROR      TO TRUE                        08140099
                   END-IF                                               08150099
               END-IF                                                   08160099
           END-IF.                                                      08170099
           IF PS-NO-ERROR                                               08180099
               PERFORM 2110-CHK-XFER-STATUS                             08190099
               IF PS-NO-ERROR                                           08200099
                   PERFORM 2120-CHK-XFER-IN-USE                         08210099
               END-IF                                                   08220099
           END-IF.                                                      08230099
                                                                        08240099
           IF  PS-NO-ERROR                                              08250099
             AND ASC-XFER-NBR NOT = ASC-HOLD-XFER-NBR                   08260099
               SET ASC-IR-NOT-WRITTEN   TO TRUE                         08270099
           END-IF.                                                      08280099
                                                                        08290099
           IF  PS-NO-ERROR                                              08300099
               MOVE ASC-XFER-NBR     TO ASC-HOLD-XFER-NBR               08310099
           END-IF.                                                      08320099
                                                                        08330099
      *----------------------------------------------------------------*08340099
      * IF TRANSFER WAS MISDIRECTED, ONLY AN RTV LOCATION CAN RECEIVE   08350099
      * A DEFECTIVE/DAMAGE OR CALLBACK, ONLY A DEPT. STORE CAN RECEIVE  08360099
      * A STOCK BALANCE, AND A CUSTOMER TRANSFER CAN NOT BE RECEIVED.   08370099
      *----------------------------------------------------------------*08380099
       3050-CHECK-MISDIRECT.                                            08390099
           SET DP020-MSG-FATAL   TO TRUE                                08400099
      *  -- RETURN TO TRUCK. YOU ARE NOT ALLOWED TO RECEIVE THIS XFER - 08410099
           MOVE DP015-UNP-ALP-BRT-OFF       TO AFRMSTRA                 08420099
                                               ASEQNBRA                 08430099
                                               ACHKDGTA.                08440099
           MOVE DP015-RED                   TO AFRMSTRC                 08450099
                                               ASEQNBRC                 08460099
                                               ACHKDGTC.                08470099
           MOVE DP015-REVERSE               TO AFRMSTRH                 08480099
                                               ASEQNBRH                 08490099
                                               ACHKDGTH.                08500099
           MOVE PC-TSYMSG-01505          TO DP020-MSG-NUMBER.           08510099
           MOVE -1                       TO AFRMSTRL.                   08520099
           SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       08530099
           EVALUATE ASC-XFER-TYP-CDE                                    08540099
              WHEN PC-CALLBACK                                          08550099
              WHEN PC-DEFECTIVE-DAMAGE-SORT1                            08560099
              WHEN PC-DEFECTIVE-DAMAGE-SORT2                            08570099
                  IF ASC-TYPE-CODE NOT = PC-RTV                         08580099
                      SET PS-ERROR         TO TRUE                      08590099
                  ELSE                                                  08600099
                      SET PS-WARNING       TO TRUE                      08610099
                  END-IF                                                08620099
              WHEN PC-CUSTOMER                                          08630099
      *  ALLOW INVENTORY CONTROL TO RECEIVE A TRANSFER TO ANY LOCATION  08640099
      *  USING THE RECEIVE STORE OVERRIDE FUNCTION                      08650099
                  IF ASC-RCV-STR-OVERRIDE                               08660099
                      SET PS-WARNING       TO TRUE                      08670099
                  ELSE                                                  08680099
                      SET PS-ERROR             TO TRUE                  08690099
                  END-IF                                                08700099
              WHEN PC-NON-RETAIL                                        08710099
              WHEN PC-OFFSITE-STORAGE                                   08720099
                  SET PS-ERROR             TO TRUE                      08730099
               WHEN PC-STOCK-BALANCE-CORPORATE                          08740099
               WHEN PC-STOCK-BALANCE-STORE                              08750099
                  IF ASC-TYPE-CODE NOT = PC-DEPT-STORE                  08760099
      *  ALLOW INVENTORY CONTROL TO RECEIVE A TRANSFER TO ANY LOCATION  08770099
      *  USING THE RECEIVE STORE OVERRIDE FUNCTION                      08780099
                      IF ASC-RCV-STR-OVERRIDE                           08790099
                          SET PS-WARNING       TO TRUE                  08800099
                      ELSE                                              08810099
                          SET PS-ERROR         TO TRUE                  08820099
                      END-IF                                            08830099
                  ELSE                                                  08840099
                      SET PS-WARNING       TO TRUE                      08850099
                  END-IF                                                08860099
           END-EVALUATE.                                                08870099
      ******************************************************************11580099
      ** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **11590099
      ** MAP.                                                         **11600099
      ******************************************************************11610099
       3200-RESET-ATTRIBUTES.                                           11620099
           MOVE DP015-UNP-ALP-NOR-OFF    TO AFRMSTRA                    11630099
                                            ASEQNBRA                    11640099
                                            ACHKDGTA.                   11650099
           MOVE DP015-GREEN              TO AFRMSTRC                    11660099
                                            ASEQNBRC                    11670099
                                            ACHKDGTC.                   11680099
           MOVE DP015-UNDERLINE          TO AFRMSTRH                    11690099
                                            ASEQNBRH                    11700099
                                            ACHKDGTH.                   11710099
       EJECT                                                            11720099
      *                                                                 11730099
      *----------------------------------------------------------------*11740099
      *  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *11750099
      *  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *11760099
      *  IT HERE.                                                      *11770099
      *----------------------------------------------------------------*11780099
       4000-BUILD-INITIAL-PANEL.                                        11790099
                                                                        11800099
           IF DP020-LOCATION-NBR = PC-DC-MEN-FLS                        11810099
               MOVE PC-RTV-MEN-FLS           TO ASC-STORE-NBR           11820099
           ELSE                                                         11830099
               IF DP020-LOCATION-NBR = PC-DC-FINDLAY                    11840099
                   MOVE PC-RTV-FINDLAY       TO ASC-STORE-NBR           11850099
               ELSE                                                     11860099
                   MOVE DP020-LOCATION-NBR   TO ASC-STORE-NBR           11870099
               END-IF                                                   11880099
           END-IF.                                                      11890099
           PERFORM 5000-READ-XST-LOC.                                   11900099
           MOVE XST00001-LOC-TYP-CDE     TO ASC-TYPE-CODE.              11910099
           SET DP030-SET-CURSOR-APPL-1   TO TRUE                        11920099
           MOVE -1                       TO AFRMSTRL.                   11930099
           PERFORM 3200-RESET-ATTRIBUTES.                               11940099
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11950099
       EJECT                                                            11960099
      *----------------------------------------------------------------*11970099
      * SELECT DATA FROM THE TRANSFER TABLES                            11980099
      *----------------------------------------------------------------*11990099
       4100-GET-TRANSFER.                                               12000099
           INITIALIZE DCLTTFMSTR.                                       12010099
           MOVE ASC-XFER-FR-STR-N             TO TFMSTR-FR-STR-NBR.     12020099
           MOVE ASC-XFER-SEQ-NBR-N            TO DK-XFER-SEQ-NBR.       12030099
           PERFORM                                                      12040099
               WITH TEST AFTER                                          12050099
               VARYING PV-RETRY-COUNT                                   12060099
               FROM 1 BY 1                                              12070099
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 12080099
                         OR (SQLCODE = ZERO)                            12090099
                         OR (SQLCODE = +100))                           12100099
      *                                                                 12110099
               EXEC SQL                                                 12120099
                   SELECT XFER_DKEY_ID                                  12130099
                         ,XFER_TYP_CDE                                  12140099
                         ,CONTNR_TYP_CDE                                12150099
                         ,TO_STR_NBR                                    12160099
                         ,CMPT_XFER_END_TMST                            12170099
                   INTO   :TFMSTR-XFER-DKEY-ID                          12180099
                         ,:TFMSTR-XFER-TYP-CDE                          12190099
                         ,:TFMSTR-CONTNR-TYP-CDE                        12200099
                         ,:TFMSTR-TO-STR-NBR                            12210099
                         ,:TFMSTR-CMPT-XFER-END-TMST                    12220099
                    FROM  TTFMSTR                                       12230099
                   WHERE  (FR_STR_NBR      =  :TFMSTR-FR-STR-NBR        12240099
                     AND   XFER_SEQ_NBR    =  :DK-XFER-SEQ-NBR)         12250099
               END-EXEC                                                 12260099
                                                                        12270099
               EVALUATE TRUE                                            12280099
                   WHEN SQLCODE = ZERO                                  12290099
                      SET PS-TRANSFER-FOUND      TO TRUE                12300099
                      MOVE TFMSTR-XFER-DKEY-ID   TO ASC-XFER-DKEY-ID    12310099
                      MOVE TFMSTR-XFER-TYP-CDE   TO ASC-XFER-TYP-CDE    12320099
                      MOVE TFMSTR-CONTNR-TYP-CDE TO ASC-CONTNR-TYP-CDE  12330099
                      MOVE TFMSTR-TO-STR-NBR     TO ASC-TO-STORE-NBR    12340099
                      MOVE TFMSTR-CMPT-XFER-END-TMST                    12350099
                                                 TO ASC-CMPLT-DATE      12360099
                   WHEN SQLCODE = +100                                  12370099
                   WHEN SQLCODE = -904                                  12380099
                   WHEN SQLCODE = -913                                  12390099
                       CONTINUE                                         12400099
                   WHEN OTHER                                           12410099
                       MOVE '4100-GET-TRANSFER'                         12420099
                                         TO DP013-PARAGRAPH             12430099
                       MOVE 'SELECT TRANSFER DATA'                      12440099
                                         TO DP013-MESSAGE-TEXT (1)      12450099
                       MOVE SQLCA        TO DP013-SQLCA                 12460099
                       MOVE 'TTFMSTR'    TO DP013-DB2-TABLE-NAME (1)    12470099
                       SET DP013-DB2-ABEND                              12480099
                           DP013-XCTL-DISPLAY-RESTART                   12490099
                                         TO TRUE                        12500099
                       PERFORM DP013-0000-PROCESS-ABEND                 12510099
               END-EVALUATE                                             12520099
           END-PERFORM.                                                 12530099
      *                                                                 12540099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          12550099
               MOVE '4100-GET-TRANSFER'                                 12560099
                                         TO DP013-PARAGRAPH             12570099
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     12580099
                                         TO DP013-MESSAGE-TEXT (1)      12590099
               MOVE 'TRANSFER DATA'      TO DP013-MESSAGE-TEXT (2)      12600099
               MOVE SQLCA                TO DP013-SQLCA                 12610099
               MOVE 'TTFMSTR'            TO DP013-DB2-TABLE-NAME (1)    12620099
               SET DP013-DB2-ABEND                                      12630099
                   DP013-XCTL-DISPLAY-RESTART                           12640099
                                         TO TRUE                        12650099
               PERFORM DP013-0000-PROCESS-ABEND                         12660099
           END-IF.                                                      12670099
       EJECT                                                            12680099
      *                                                                 12690099
      *----------------------------------------------------------------*12700099
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *12710099
      *----------------------------------------------------------------*12720099
       4400-MOVE-COMMAREA-TO-SCREEN.                                    12730099
           MOVE ASC-STORE-NBR            TO ARCVSTRO.                   12740099
           MOVE ASC-XFER-FR-STR          TO AFRMSTRO.                   12750099
           MOVE ASC-XFER-SEQ-NBR         TO ASEQNBRO.                   12760099
           MOVE ASC-XFER-CHECK-DIGIT     TO ACHKDGTO.                   12770099
           IF PS-NO-ERROR                                               12780099
               MOVE -1           TO AFRMSTRL                            12790099
               SET DP030-SET-CURSOR-APPL-1  TO TRUE                     12800099
           END-IF.                                                      12810099
       EJECT                                                            12820099
      *----------------------------------------------------------------*12830099
      *    GET THE STORE TYPE CODE                                     *12840099
      *----------------------------------------------------------------*12850099
       5000-READ-XST-LOC.                                               12860099
           MOVE ASC-STORE-NBR           TO DK-STORE-NBR.                12870099
           PERFORM WITH TEST AFTER                                      12880099
               VARYING PV-RETRY-COUNT                                   12890099
               FROM 1 BY 1                                              12900099
               UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES)                  12910099
                    OR SQLCODE = ZERO                                   12920099
                    OR SQLCODE = +100                                   12930099
               EXEC SQL                                                 12940099
                   SELECT  LOC_TYP_CDE                                  12950099
                     INTO  :XST00001-LOC-TYP-CDE                        12960099
                     FROM  XST_LOC                                      12970099
                    WHERE  (LOC_NBR = :DK-STORE-NBR)                    12980099
               END-EXEC                                                 12990099
               EVALUATE TRUE                                            13000099
                   WHEN SQLCODE = ZERO                                  13010099
                       CONTINUE                                         13020099
                   WHEN SQLCODE = -904                                  13030099
                   WHEN SQLCODE = -913                                  13040099
                   WHEN SQLCODE = +100                                  13050099
                       MOVE 'XX'           TO XST00001-LOC-TYP-CDE      13060099
                   WHEN OTHER                                           13070099
                       MOVE '5000-READ-XST-LOC'                         13080099
                                         TO DP013-PARAGRAPH             13090099
                       MOVE 'SELECT A ROW FROM XST-LOC'                 13100099
                                         TO DP013-MESSAGE-TEXT (1)      13110099
                       MOVE SQLCA        TO DP013-SQLCA                 13120099
                       MOVE 'XST-LOC'    TO DP013-DB2-TABLE-NAME (1)    13130099
                       SET DP013-DB2-ABEND                              13140099
                           DP013-XCTL-DISPLAY-RESTART                   13150099
                                         TO TRUE                        13160099
                       PERFORM DP013-0000-PROCESS-ABEND                 13170099
               END-EVALUATE                                             13180099
           END-PERFORM.                                                 13190099
                                                                        13200099
      *                                                                 13210099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          13220099
               MOVE '5000-READ-XST-LOC'                                 13230099
                                         TO DP013-PARAGRAPH             13240099
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13250099
                                         TO DP013-MESSAGE-TEXT (1)      13260099
               MOVE 'A ROW FROM XST-LOC' TO DP013-MESSAGE-TEXT (2)      13270099
               MOVE SQLCA                TO DP013-SQLCA                 13280099
               MOVE 'XST_LOC'            TO DP013-DB2-TABLE-NAME (1)    13290099
               SET DP013-DB2-ABEND                                      13300099
                   DP013-XCTL-DISPLAY-RESTART                           13310099
                                         TO TRUE                        13320099
               PERFORM DP013-0000-PROCESS-ABEND                         13330099
           END-IF.                                                      13340099
       EJECT                                                            13350099
      *----------------------------------------------------------------*13360099
      *  GET THE CURRENT SYSTEM TIMESTAMP TO BE USED FOR THE RECEIPT.   13370099
      *----------------------------------------------------------------*13380099
       7000-SELECT-CURRENT-TIMESTAMP.                                   13390099
                                                                        13400099
           EXEC SQL                                                     13410099
               SET  :ASC-CURRENT-TIMESTAMP =   CURRENT TIMESTAMP        13420099
           END-EXEC.                                                    13430099
                                                                        13440099
           EVALUATE TRUE                                                13450099
               WHEN SQLCODE = ZERO                                      13460099
                   CONTINUE                                             13470099
               WHEN OTHER                                               13480099
                   MOVE '7000-SELECT-CURRENT-TIMESTAMP'                 13490099
                                             TO DP013-PARAGRAPH         13500099
                   MOVE 'SELECT THE CURRENT TIMESTAMP'                  13510099
                                             TO DP013-MESSAGE-TEXT (1)  13520099
                   MOVE SQLCA                TO DP013-SQLCA             13530099
                   SET DP013-DB2-ABEND                                  13540099
                   DP013-XCTL-DISPLAY-RESTART                           13550099
                                            TO TRUE                     13560099
                   PERFORM DP013-0000-PROCESS-ABEND                     13570099
           END-EVALUATE.                                                13580099
      *----------------------------------------------------------------*13590099
      *  GET THE MAX STATUS TIMESTAMP FOR THIS TRANSFER SO THE CURRENT  13600099
      *  STATUS ROW CAN BE READ.                                        13610099
      *----------------------------------------------------------------*13620099
       7050-SELECT-MAX-STAT-TMST.                                       13630099
           INITIALIZE DCLTTFSTAT.                                       13640099
                                                                        13650099
           PERFORM                                                      13660099
               WITH TEST AFTER                                          13670099
               VARYING PV-RETRY-COUNT                                   13680099
               FROM 1 BY 1                                              13690099
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 13700099
                   OR (SQLCODE = +0)                                    13710099
                   OR (SQLCODE = +100))                                 13720099
                                                                        13730099
               EXEC SQL                                                 13740099
                   SELECT  MAX(XFER_STAT_TMST)                          13750099
                     INTO  :TFSTAT-XFER-STAT-TMST                       13760099
                               :PV-NULL-IND                             13770099
                     FROM  TTFSTAT                                      13780099
                    WHERE  (XFER_DKEY_ID  =  :TFMSTR-XFER-DKEY-ID)      13790099
               END-EXEC                                                 13800099
                                                                        13810099
               EVALUATE TRUE                                            13820099
                   WHEN SQLCODE = ZERO                                  13830099
                   WHEN SQLCODE = +100                                  13840099
                   WHEN SQLCODE = -904                                  13850099
                   WHEN SQLCODE = -913                                  13860099
                       CONTINUE                                         13870099
                   WHEN OTHER                                           13880099
                       MOVE '7050-SELECT-MAX-STAT-TMST'                 13890099
                                             TO DP013-PARAGRAPH         13900099
                       MOVE 'SELECT MAX TIMESTAMP FOR DATALESS KEY: '   13910099
                                             TO DP013-MESSAGE-TEXT (1)  13920099
                       MOVE TFMSTR-XFER-DKEY-ID                         13930099
                                             TO PV-DISPLAY-XFER-DKEY-ID 13940099
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     13950099
                                             TO DP013-MESSAGE-TEXT (2)  13960099
                       MOVE SQLCA            TO DP013-SQLCA             13970099
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)13980099
                       SET DP013-DB2-ABEND                              13990099
                           DP013-XCTL-DISPLAY-RESTART                   14000099
                                             TO TRUE                    14010099
                       PERFORM DP013-0000-PROCESS-ABEND                 14020099
               END-EVALUATE                                             14030099
           END-PERFORM.                                                 14040099
                                                                        14050099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          14060099
               MOVE '7050-SELECT-MAX-STAT-TMST'                         14070099
                                             TO DP013-PARAGRAPH         14080099
               MOVE 'MAX RETRIES EXCEEDED FOR'                          14090099
                                        TO DP013-MESSAGE-TEXT (1)       14100099
               MOVE 'SELECT MAX TIMESTAMP FOR DATALESS KEY: '           14110099
                                             TO DP013-MESSAGE-TEXT (2)  14120099
               MOVE TFMSTR-XFER-DKEY-ID                                 14130099
                                             TO PV-DISPLAY-XFER-DKEY-ID 14140099
               MOVE PV-DISPLAY-XFER-DKEY-ID                             14150099
                                             TO DP013-MESSAGE-TEXT (3)  14160099
               MOVE SQLCA               TO DP013-SQLCA                  14170099
               MOVE 'TTFSTAT '          TO DP013-DB2-TABLE-NAME (1)     14180099
               SET DP013-DB2-ABEND                                      14190099
                   DP013-XCTL-DISPLAY-RESTART                           14200099
                                        TO TRUE                         14210099
               PERFORM DP013-0000-PROCESS-ABEND                         14220099
           END-IF.                                                      14230099
      *                                                                 14240099
      *----------------------------------------------------------------*14250099
      *  GET THE CURRENT STATUS OF THIS TRANSFER.                       14260099
      *----------------------------------------------------------------*14270099
       7100-SELECT-CURRENT-STATUS.                                      14280099
           PERFORM                                                      14290099
               WITH TEST AFTER                                          14300099
               VARYING PV-RETRY-COUNT                                   14310099
               FROM 1 BY 1                                              14320099
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 14330099
                   OR (SQLCODE = +0)                                    14340099
                   OR (SQLCODE = +100))                                 14350099
                                                                        14360099
               EXEC SQL                                                 14370099
                   SELECT  A.XFER_STAT_CDE,                             14380099
                           B.XFER_STAT_DESC                             14390099
                     INTO  :TFSTAT-XFER-STAT-CDE,                       14400099
                           :TFSTCD-XFER-STAT-DESC                       14410099
                     FROM  TTFSTAT  A,                                  14420099
                           TTFSTCD  B                                   14430099
                    WHERE  (XFER_DKEY_ID     =  :TFMSTR-XFER-DKEY-ID    14440099
                      AND   XFER_STAT_TMST   =  :TFSTAT-XFER-STAT-TMST  14450099
                      AND   A.XFER_STAT_CDE  =  B.XFER_STAT_CDE)        14460099
               END-EXEC                                                 14470099
                                                                        14480099
               EVALUATE TRUE                                            14490099
                   WHEN SQLCODE = ZERO                                  14500099
                   WHEN SQLCODE = +100                                  14510099
                   WHEN SQLCODE = -904                                  14520099
                   WHEN SQLCODE = -913                                  14530099
                       CONTINUE                                         14540099
                   WHEN OTHER                                           14550099
                       MOVE '7100-SELECT-CURRENT-STATUS'                14560099
                                             TO DP013-PARAGRAPH         14570099
                       MOVE 'SELECT CURRENT STATUS FOR DATALESS KEY/TIME14580099
      -                 'STAMP: '            TO DP013-MESSAGE-TEXT (1)  14590099
                       MOVE TFMSTR-XFER-DKEY-ID                         14600099
                                             TO PV-DISPLAY-XFER-DKEY-ID 14610099
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     14620099
                                             TO DP013-MESSAGE-TEXT (2)  14630099
                       MOVE TFSTAT-XFER-STAT-TMST                       14640099
                                             TO DP013-MESSAGE-TEXT (3)  14650099
                       MOVE SQLCA            TO DP013-SQLCA             14660099
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)14670099
                       MOVE 'TTFSTCD'        TO DP013-DB2-TABLE-NAME (2)14680099
                       SET DP013-DB2-ABEND                              14690099
                           DP013-XCTL-DISPLAY-RESTART                   14700099
                                             TO TRUE                    14710099
                       PERFORM DP013-0000-PROCESS-ABEND                 14720099
               END-EVALUATE                                             14730099
           END-PERFORM.                                                 14740099
                                                                        14750099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          14760099
               MOVE '7100-SELECT-CURRENT-STATUS'                        14770099
                                             TO DP013-PARAGRAPH         14780099
               MOVE 'SELECT CURRENT STATUS FOR DATALESS KEY/TIMESTAMP'  14790099
                                             TO DP013-MESSAGE-TEXT (1)  14800099
               MOVE TFMSTR-XFER-DKEY-ID                                 14810099
                                             TO PV-DISPLAY-XFER-DKEY-ID 14820099
               MOVE PV-DISPLAY-XFER-DKEY-ID                             14830099
                                             TO DP013-MESSAGE-TEXT (2)  14840099
               MOVE TFSTAT-XFER-STAT-TMST                               14850099
                                             TO DP013-MESSAGE-TEXT (3)  14860099
               MOVE SQLCA               TO DP013-SQLCA                  14870099
               MOVE 'TTFSTAT '          TO DP013-DB2-TABLE-NAME (1)     14880099
               MOVE 'TTFSTCD '          TO DP013-DB2-TABLE-NAME (2)     14890099
               SET DP013-DB2-ABEND                                      14900099
                   DP013-XCTL-DISPLAY-RESTART                           14910099
                                        TO TRUE                         14920099
               PERFORM DP013-0000-PROCESS-ABEND                         14930099
           END-IF.                                                      14940099
      *                                                                 14950099
      *----------------------------------------------------------------*14960099
      *  GET THE MAX RECEIPT TIMESTAMP.                                 14970099
      *----------------------------------------------------------------*14980099
       7150-SELECT-MAX-RCPT-TMST.                                       14990099
           PERFORM                                                      15000099
               WITH TEST AFTER                                          15010099
               VARYING PV-RETRY-COUNT                                   15020099
               FROM 1 BY 1                                              15030099
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 15040099
                   OR (SQLCODE = +0)                                    15050099
                   OR (SQLCODE = +100))                                 15060099
                                                                        15070099
               EXEC SQL                                                 15080099
                   SELECT  MAX(RCV_XFER_BEG_TMST)                       15090099
                     INTO  :TFRCPT-RCV-XFER-BEG-TMST                    15100099
                               :PV-NULL-IND                             15110099
                     FROM  TTFRCPT                                      15120099
                    WHERE  (XFER_DKEY_ID  =  :TFMSTR-XFER-DKEY-ID)      15130099
               END-EXEC                                                 15140099
                                                                        15150099
               EVALUATE TRUE                                            15160099
                   WHEN SQLCODE = ZERO                                  15170099
                   WHEN SQLCODE = +100                                  15180099
                   WHEN SQLCODE = -904                                  15190099
                   WHEN SQLCODE = -913                                  15200099
                       CONTINUE                                         15210099
                   WHEN OTHER                                           15220099
                       MOVE '7150-SELECT-MAX-RCPT-TMST'                 15230099
                                             TO DP013-PARAGRAPH         15240099
                       MOVE 'SELECT MAX TIMESTAMP FOR DATALESS KEY: '   15250099
                                             TO DP013-MESSAGE-TEXT (1)  15260099
                       MOVE TFMSTR-XFER-DKEY-ID                         15270099
                                             TO PV-DISPLAY-XFER-DKEY-ID 15280099
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     15290099
                                             TO DP013-MESSAGE-TEXT (2)  15300099
                       MOVE SQLCA            TO DP013-SQLCA             15310099
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)15320099
                       SET DP013-DB2-ABEND                              15330099
                           DP013-XCTL-DISPLAY-RESTART                   15340099
                                             TO TRUE                    15350099
                       PERFORM DP013-0000-PROCESS-ABEND                 15360099
               END-EVALUATE                                             15370099
           END-PERFORM.                                                 15380099
                                                                        15390099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15400099
                   MOVE '7150-SELECT-MAX-RCPT-TMST'                     15410099
                                             TO DP013-PARAGRAPH         15420099
                   MOVE 'SELECT MAX TIMESTAMP FOR DATALESS KEY: '       15430099
                                             TO DP013-MESSAGE-TEXT (1)  15440099
                   MOVE TFMSTR-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 15450099
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         15460099
                                             TO DP013-MESSAGE-TEXT (2)  15470099
                   MOVE SQLCA                TO DP013-SQLCA             15480099
                   MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)15490099
                   SET DP013-DB2-ABEND                                  15500099
                       DP013-XCTL-DISPLAY-RESTART                       15510099
                                            TO TRUE                     15520099
                   PERFORM DP013-0000-PROCESS-ABEND                     15530099
           END-IF.                                                      15540099
      *                                                                 15550099
      *----------------------------------------------------------------*15560099
      *  GET THE CURRENT RECEIPT END TIMESTAMP.                         15570099
      *----------------------------------------------------------------*15580099
       7200-SELECT-CURRENT-RCPT.                                        15590099
           PERFORM                                                      15600099
               WITH TEST AFTER                                          15610099
               VARYING PV-RETRY-COUNT                                   15620099
               FROM 1 BY 1                                              15630099
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 15640099
                   OR (SQLCODE = +0)                                    15650099
                   OR (SQLCODE = +100))                                 15660099
                                                                        15670099
               EXEC SQL                                                 15680099
                   SELECT  RCV_XFER_END_TMST                            15690099
                     INTO  :TFRCPT-RCV-XFER-END-TMST                    15700099
                     FROM  TTFRCPT                                      15710099
                    WHERE  (XFER_DKEY_ID  =  :TFMSTR-XFER-DKEY-ID  AND  15720099
                       RCV_XFER_BEG_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST) 15730099
               END-EXEC                                                 15740099
                                                                        15750099
               EVALUATE TRUE                                            15760099
                   WHEN SQLCODE = ZERO                                  15770099
                   WHEN SQLCODE = +100                                  15780099
                   WHEN SQLCODE = -904                                  15790099
                   WHEN SQLCODE = -913                                  15800099
                       CONTINUE                                         15810099
                   WHEN OTHER                                           15820099
                       MOVE '7200-SELECT-CURRENT-RCPT'                  15830099
                                             TO DP013-PARAGRAPH         15840099
                       MOVE 'SELECT CURRENT RECEIPT FOR DATALESS KEY/TIM15850099
      -                 'MP: '           TO DP013-MESSAGE-TEXT (1)      15860099
                       MOVE TFMSTR-XFER-DKEY-ID                         15870099
                                             TO PV-DISPLAY-XFER-DKEY-ID 15880099
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     15890099
                                             TO DP013-MESSAGE-TEXT (2)  15900099
                       MOVE TFRCPT-RCV-XFER-BEG-TMST                    15910099
                                             TO DP013-MESSAGE-TEXT (3)  15920099
                       MOVE SQLCA            TO DP013-SQLCA             15930099
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)15940099
                       SET DP013-DB2-ABEND                              15950099
                       DP013-XCTL-DISPLAY-RESTART                       15960099
                                            TO TRUE                     15970099
                       PERFORM DP013-0000-PROCESS-ABEND                 15980099
               END-EVALUATE                                             15990099
           END-PERFORM.                                                 16000099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          16010099
                   MOVE '7200-SELECT-CURRENT-RCPT'                      16020099
                                             TO DP013-PARAGRAPH         16030099
                   MOVE 'SELECT CURRENT RECEIPT FOR DATALESS KEY/TIMESTA16040099
      -                 'MP: '               TO DP013-MESSAGE-TEXT (1)  16050099
                   MOVE TFMSTR-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 16060099
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         16070099
                                             TO DP013-MESSAGE-TEXT (2)  16080099
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        16090099
                                             TO DP013-MESSAGE-TEXT (3)  16100099
                   MOVE SQLCA                TO DP013-SQLCA             16110099
                   MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)16120099
                   SET DP013-DB2-ABEND                                  16130099
                       DP013-XCTL-DISPLAY-RESTART                       16140099
                                            TO TRUE                     16150099
                   PERFORM DP013-0000-PROCESS-ABEND                     16160099
           END-IF.                                                      16170099
      *----------------------------------------------------------------*16180099
      *  INSERT A ROW IN THE TRANSFER RECEIPT TABLE.                   *16190099
      *----------------------------------------------------------------*16200099
       7600-INSERT-XFER-RECEIPT-ROW.                                    16210099
           MOVE ASC-STORE-NBR          TO TFRCPT-STR-NBR.               16220099
           MOVE ASC-XFER-DKEY-ID       TO DK-XFER-DKEY-ID.              16230099
           IF ASC-RCV-STR-OVERRIDE                                      16240099
               MOVE PC-YES             TO TFRCPT-RCV-STR-OVRRID-IND     16250099
           ELSE                                                         16260099
               MOVE PC-NO              TO TFRCPT-RCV-STR-OVRRID-IND     16270099
           END-IF.                                                      16280099
           MOVE DP020-USERID           TO TFRCPT-RCV-BY-USR-ID.         16290099
           IF ASC-CALL-INV-CONTROL   AND                                16300099
              PS-ERROR                                                  16310099
               MOVE PC-YES             TO TFRCPT-RCVG-PROB-IND          16320099
           ELSE                                                         16330099
               MOVE PC-NO              TO TFRCPT-RCVG-PROB-IND          16340099
           END-IF.                                                      16350099
                                                                        16360099
           PERFORM                                                      16370099
               WITH TEST AFTER                                          16380099
               VARYING PV-RETRY-COUNT                                   16390099
               FROM 1 BY 1                                              16400099
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 16410099
                   OR (SQLCODE = +0))                                   16420099
                                                                        16430099
               EXEC SQL                                                 16440099
                   INSERT INTO TTFRCPT                                  16450099
                       (XFER_DKEY_ID,                                   16460099
                        RCV_XFER_BEG_TMST,                              16470099
                        ENTR_MTHD_TYP_CDE,                              16480099
                        STR_NBR,                                        16490099
                        RCV_XFER_END_TMST,                              16500099
                        RCV_BY_USR_ID,                                  16510099
                        RCV_STR_OVRRID_IND,                             16520099
                        RCVG_PROB_IND)                                  16530099
                   VALUES                                               16540099
                       (:DK-XFER-DKEY-ID,                               16550099
                        :ASC-CURRENT-TIMESTAMP,                         16560099
                        '02',                                           16570099
                        :TFRCPT-STR-NBR,                                16580099
                        CURRENT TIMESTAMP,                              16590099
                        :TFRCPT-RCV-BY-USR-ID,                          16600099
                        :TFRCPT-RCV-STR-OVRRID-IND,                     16610099
                        :TFRCPT-RCVG-PROB-IND)                          16620099
               END-EXEC                                                 16630099
                                                                        16640099
               EVALUATE TRUE                                            16650099
                   WHEN SQLCODE = ZERO                                  16660099
                   WHEN SQLCODE = -904                                  16670099
                   WHEN SQLCODE = -913                                  16680099
                       CONTINUE                                         16690099
                   WHEN OTHER                                           16700099
                       MOVE '7600-INSERT-XFER-RECEIPT-ROW'              16710099
                                             TO DP013-PARAGRAPH         16720099
                       MOVE 'INSERT A TRANSFER RECEIPT ROW FOR DATALESS 16730099
      -                 'KEY VALUE: '        TO DP013-MESSAGE-TEXT (1)  16740099
                       MOVE DK-XFER-DKEY-ID                             16750099
                                             TO PV-DISPLAY-XFER-DKEY-ID 16760099
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     16770099
                                             TO DP013-MESSAGE-TEXT (2)  16780099
                       MOVE SQLCA            TO DP013-SQLCA             16790099
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)16800099
                       SET DP013-DB2-ABEND                              16810099
                       DP013-XCTL-DISPLAY-RESTART                       16820099
                                            TO TRUE                     16830099
                       PERFORM DP013-0000-PROCESS-ABEND                 16840099
               END-EVALUATE                                             16850099
           END-PERFORM.                                                 16860099
                                                                        16870099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          16880099
                   MOVE '7600-INSERT-XFER-RECEIPT-ROW'                  16890099
                                             TO DP013-PARAGRAPH         16900099
                   MOVE 'INSERT A TRANSFER RECEIPT ROW FOR DATALESS KEY 16910099
      -                 'VALUE: '            TO DP013-MESSAGE-TEXT (1)  16920099
                   MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID     16930099
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         16940099
                                             TO DP013-MESSAGE-TEXT (2)  16950099
                   MOVE SQLCA                TO DP013-SQLCA             16960099
                   MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)16970099
                   SET DP013-DB2-ABEND                                  16980099
                       DP013-XCTL-DISPLAY-RESTART                       16990099
                                            TO TRUE                     17000099
                   PERFORM DP013-0000-PROCESS-ABEND                     17010099
           END-IF.                                                      17020099
      *                                                                 17030099
      *----------------------------------------------------------------*17040099
      *  INSERT THE INTERMEDIATE RECEIPT STATUS ROW.                    17050099
      *----------------------------------------------------------------*17060099
       7650-INSERT-XFER-IR-STAT-ROW.                                    17070099
                                                                        17080099
           PERFORM                                                      17090099
               WITH TEST AFTER                                          17100099
               VARYING PV-RETRY-COUNT                                   17110099
               FROM 1 BY 1                                              17120099
               UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 17130099
                   OR (SQLCODE = +0))                                   17140099
                                                                        17150099
               EXEC SQL                                                 17160099
                   INSERT INTO TTFSTAT                                  17170099
                       (XFER_DKEY_ID,                                   17180099
                        XFER_STAT_TMST,                                 17190099
                        XFER_STAT_CDE)                                  17200099
                   VALUES                                               17210099
                       (:DK-XFER-DKEY-ID,                               17220099
                        :ASC-CURRENT-TIMESTAMP,                         17230099
                        'IR')                                           17240099
               END-EXEC                                                 17250099
                                                                        17260099
               EVALUATE TRUE                                            17270099
                   WHEN SQLCODE = ZERO                                  17280099
                   WHEN SQLCODE = -904                                  17290099
                   WHEN SQLCODE = -913                                  17300099
                       CONTINUE                                         17310099
                   WHEN OTHER                                           17320099
                       MOVE '7650-INSERT-XFER-IR-STAT-ROW'              17330099
                                             TO DP013-PARAGRAPH         17340099
                      MOVE 'INSERT A TRANSFER STATUS ROW OF POSITIVELY' 17350099
                                             TO DP013-MESSAGE-TEXT (1)  17360099
                       MOVE 'RECEIVED FOR DATALESS KEY VALUE: '         17370099
                                             TO DP013-MESSAGE-TEXT (2)  17380099
                       MOVE DK-XFER-DKEY-ID                             17390099
                                             TO PV-DISPLAY-XFER-DKEY-ID 17400099
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     17410099
                                             TO DP013-MESSAGE-TEXT (2)  17420099
                       MOVE SQLCA            TO DP013-SQLCA             17430099
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)17440099
                       SET DP013-DB2-ABEND                              17450099
                       DP013-XCTL-DISPLAY-RESTART                       17460099
                                            TO TRUE                     17470099
                       PERFORM DP013-0000-PROCESS-ABEND                 17480099
               END-EVALUATE                                             17490099
           END-PERFORM.                                                 17500099
                                                                        17510099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          17520099
                   MOVE '7650-INSERT-XFER-IR-STAT-ROW'                  17530099
                                             TO DP013-PARAGRAPH         17540099
                   MOVE 'INSERT A TRANSFER STATUS ROW OF POSITIVELY'    17550099
                                             TO DP013-MESSAGE-TEXT (1)  17560099
                   MOVE 'RECEIVED FOR DATALESS KEY VALUE: '             17570099
                                             TO DP013-MESSAGE-TEXT (2)  17580099
                   MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID     17590099
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         17600099
                                             TO DP013-MESSAGE-TEXT (2)  17610099
                   MOVE SQLCA                TO DP013-SQLCA             17620099
                   MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (1)17630099
                   SET DP013-DB2-ABEND                                  17640099
                       DP013-XCTL-DISPLAY-RESTART                       17650099
                                            TO TRUE                     17660099
                   PERFORM DP013-0000-PROCESS-ABEND                     17670099
           END-IF.                                                      17680099
                                                                        19640099
      *                                                                 19650099
      *----------------------------------------------------------------*19660099
      *    CHECK DIGIT MODULE                                          *19670099
      *----------------------------------------------------------------*19680099
           COPY TFPD008.                                                19690099
      *                                                                 19700099
      *----------------------------------------------------------------*19710099
      *    ABEND PROCESSOR MODULE                                      *19720099
      *----------------------------------------------------------------*19730099
                                                                        19740099
           COPY DPPD013.                                                19750099
