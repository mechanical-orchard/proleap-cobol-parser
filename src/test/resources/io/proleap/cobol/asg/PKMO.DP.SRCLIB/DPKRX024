/* REXX */                                                                      
/* DPKRX024 - Build the default printer file.  Merge the user file    */        
/* with the printer ids defined for each recipient in the IPACP and   */        
/* IPACS regions to serve as input.  If no printer id was defined in  */        
/* IPACP, then use whatever is defined in IPACS (which may also be    */        
/* undefined).  Build a default printer record for each merged record.*/        
/**********************************************************************/        
/* Set values for constants.                                          */        
/**********************************************************************/        
CURRPGM = ' DPKRX024 - '                                                        
USER_FILE_END_OF_FILE = 'Y'                                                     
USER_FILE_NOT_END_OF_FILE = 'N'                                                 
                                                                                
/**********************************************************************/        
/* Initialize local variables.                                        */        
/**********************************************************************/        
USER_FILE_EOF = USER_FILE_NOT_END_OF_FILE                                       
                                                                                
/**********************************************************************/        
/* Program mainline.                                                  */        
/**********************************************************************/        
SAY CURRPGM                                                                     
CALL READ_USER_RECORD                                                           
DO WHILE (USER_FILE_EOF = USER_FILE_NOT_END_OF_FILE)                            
    PARSE PULL INP01_RECORD                                                     
    USER_RECORD = SUBSTR(INP01_RECORD,1,54)                                     
    IPACP_DEFAULT_PRINTER = SUBSTR(INP01_RECORD,55,8)                           
    IPACS_DEFAULT_PRINTER = SUBSTR(INP01_RECORD,63,8)                           
    IF (STRIP(IPACP_DEFAULT_PRINTER) = '') THEN                                 
        DEFAULT_PRINTER = IPACS_DEFAULT_PRINTER                                 
    ELSE                                                                        
        DEFAULT_PRINTER = IPACP_DEFAULT_PRINTER                                 
    DEFAULT_PRINTER_RECORD = USER_RECORD || DEFAULT_PRINTER                     
    CALL WRITE_DEFAULT_PRINTER_RECORD                                           
    CALL READ_USER_RECORD                                                       
END                                                                             
                                                                                
"EXECIO 0 DISKR INP01 (FINIS"                                                   
"EXECIO 0 DISKR OUT01 (FINIS"                                                   
EXIT 0                                                                          
/* ----------------------------------------------------------------- */         
/* Subroutines                                                       */         
/* ----------------------------------------------------------------- */         
/* ----------------------------------------------------------------- */         
/* READ_USER_RECORD                                                  */         
/*                                                                   */         
/* Read a user record merged with Infopac printer information.       */         
/* ----------------------------------------------------------------- */         
READ_USER_RECORD:                                                               
    "EXECIO 1 DISKR INP01"              /* read one record           */         
    IF RC = 2 THEN                                                              
        USER_FILE_EOF = USER_FILE_END_OF_FILE                                   
    RETURN                                                                      
/* ----------------------------------------------------------------- */         
/* WRITE_DEFAULT_PRINTER_RECORD                                      */         
/*                                                                   */         
/* Write a default printer record.                                   */         
/* ----------------------------------------------------------------- */         
WRITE_DEFAULT_PRINTER_RECORD:                                                   
    OUT01_RECORD = LEFT(DEFAULT_PRINTER_RECORD,80)                              
    PUSH OUT01_RECORD                                                           
    "EXECIO 1 DISKW OUT01"                                                      
    RETURN                                                                      
