000100*-----------------------*                                         00010079
000200 IDENTIFICATION DIVISION.                                         00020079
000300*-----------------------*                                         00030079
000400 PROGRAM-ID.    INKCS032.                                         00040079
000500 AUTHOR.        TESS BESTE.                                       00050079
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060079
000700 DATE-WRITTEN.  10-18-99.                                         00070079
000800 DATE-COMPILED.                                                   00080079
000900                                                                  00090079
001000*----------------------------------------------------------------*00100079
001100*         I032 - SHEET INVENTORY LIST PROGRAM                     00110079
001200*                                                                 00120079
001300* THIS PROGRAM LISTS THE SHEET NUMBERS OF THE SHEETS THAT WERE    00130079
001400* ENTERED FOR THE SHEET INVENTORY OF A PARTICULAR STORE.          00140079
001500*                                                                 00150079
001600* THE STORE NUMBER AND SHEET NUMBER ARE ENTERED ON THE CRITERIA   00160079
001700* SPEC SCREEN.  IF THE SHEET NUMBER CONTAINS ASTERISKS, ALL       00170079
001800* SHEETS FOR THE STORE ARE LISTED.                                00180079
001900*                                                                 00190079
002000* FOR EACH SHEET, THE TOTAL RETAIL AMOUNT, TOTAL INVENTORIED      00200079
002100* QUANTITY, AND TOTAL EXTENDED RETAIL AMOUNT ARE ALSO DISPLAYED.  00210079
002200*                                                                 00220079
002300* THE APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS    00230079
002400* ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.                   00240079
002500*                                                                 00250079
002600* CHANGED: 1/24/2000  SCOTT JACKSON   CHANGE ID: J2K             *00260079
002700*   ADDED 'TOTS' ENTRY TO APPEAR AT THE END OF A LIST SHEET      *00270079
002800*   SELECTION. THIS PROVIDES SHEET TOTALS FOR A STORE (OR SHEET) *00280079
002900*                                                                 00290079
003000*  WR26600  07/  /2004  PHYSICAL INVENTORY STORE EXPANSION        00300079
003100*                       ALSO DISPLAYED STORE NAME WITH THE        00310079
003200*                       LOCATION ID (STORE NUMBER)                00320079
003300*                       M JOHNSON                                 00330079
003400*  W28545   08-22-2005  ROD JANSSEN THE NEW TRANSFER PROCESS      00340079
003500*----------------------------------------------------------------*00350079
003600* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126         00360079
003700* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00370079
003800* MAKING THE CALL DYNAMIC VS STATIC.                              00380079
003900*----------------------------------------------------------------*00390079
004000* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188         00400079
004100* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING 00410079
004200* THE CICS ARCHITECTURE API.                                      00420079
004300*---------------------------------------------------------------* 00430079
004400                                                                  00440079
004500                                                                  00450079
004600 ENVIRONMENT DIVISION.                                            00460079
004700                                                                  00470079
004800 DATA DIVISION.                                                   00480079
004900                                                                  00490079
005000 WORKING-STORAGE SECTION.                                         00500079
005100                                                                  00510079
005200                                                                  00520079
005300 01  PC-PROGRAM-CONSTANTS.                                        00530079
005400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00540079
005500                                                    'IN032A  '.   00550079
005600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00560079
005700                                                    'INKM032 '.   00570079
005800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00580079
005900                                                    'INKCS032'.   00590079
006000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00600079
006100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00610079
006200     05  PC-FORMAT-IND-CRIT-SPEC        PIC  X      VALUE '1'.    00620079
006300     05  PC-FORMAT-IND-INQ              PIC  X      VALUE '2'.    00630079
006400     05  PC-FORMAT-IND-UPD              PIC  X      VALUE '3'.    00640079
006500     05  PC-FORMAT-IND-DEL              PIC  X      VALUE '4'.    00650079
006600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00660079
006700                                                    COMP SYNC.    00670079
006800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00680079
006900                                                    COMP SYNC.    00690079
007000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00700079
007100                                                    +1000000      00710079
007200                                                    COMP-3.       00720079
007300     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00730079
007400                                                    COMP SYNC.    00740079
007500     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00750079
007600     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00760079
007700     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00770079
007800     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00780079
007900     05  PC-SHEET-TYP-CDE-KEYED         PIC X     VALUE 'K'.      00790079
008000     05  PC-TOTAL                       PIC X(04)  VALUE 'TOTS'.  00800079
008100                                                                  00810079
008200     05  PC-TSYMSG-NUMBERS.                                       00820079
008300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00830079
008400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00840079
008500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00850079
008600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00860079
008700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00870079
008800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00880079
008900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00890079
009000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00900079
009100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00910079
009200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00920079
009300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00930079
009400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00940079
009500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00950079
009600         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00960079
009700         10  PC-TSYMSG-02137            PIC  9(05)  VALUE 02137.  00970079
009800                                                                  00980079
009900                                                                  00990079
010000 01  PS-PROGRAM-SWITCHES.                                         01000079
010100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01010079
010200         88  PS-NO-ERROR                            VALUE 'Y'.    01020079
010300         88  PS-ERROR                               VALUE 'N'.    01030079
010400     05  PS-START-ITEM-ERROR-SW         PIC  X(01)  VALUE 'Y'.    01040079
010500         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    01050079
010600         88  PS-START-ITEM-ERROR                    VALUE 'N'.    01060079
010700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01070079
010800         88  PS-DONE                                VALUE 'Y'.    01080079
010900         88  PS-NOT-DONE                            VALUE 'N'.    01090079
011000                                                                  01100079
011100                                                                  01110079
011200 01  PV-PROGRAM-VARIABLES.                                        01120079
011300     05  PV-SUB                 PIC S9(04)  VALUE +0 COMP SYNC.   01130079
011400     05  PV-REMAINDER           PIC S9(04)  VALUE +0 COMP SYNC.   01140079
011500     05  PV-READ-COUNT          PIC S9(09)  VALUE +0 COMP-3.      01150079
011600     05  PV-ITEMS-PROCESSED     PIC S9(09)  VALUE +0 COMP-3.      01160079
011700     05  PV-HOLD-SELECTED-ITEMS PIC S9(09)  VALUE +0 COMP-3.      01170079
011800     05  PV-ITEM-IN-USE         PIC S9(09)  VALUE +0 COMP-3.      01180079
011900     05  PV-TOP-ITEM            PIC S9(09)  VALUE +0 COMP-3.      01190079
012000     05  PV-BOTTOM-ITEM         PIC S9(09)  VALUE +0 COMP-3.      01200079
012100     05  PV-TEMP-BLOCK-NUMBER   PIC S9(09)  VALUE +0 COMP-3.      01210079
012200     05  PV-BLOCK-NUMBER        PIC S9(04)  VALUE +0 COMP SYNC.   01220079
012300     05  PV-CICS-RESP           PIC S9(04)  VALUE +0 COMP SYNC.   01230079
012400     05  PV-ITEM                PIC S9(04)  VALUE +0 COMP SYNC.   01240079
012500     05  PV-SEL-QUEUE-ITEM      PIC S9(04)  VALUE +0 COMP SYNC.   01250079
012600     05  PV-SAVE-ITEM           PIC S9(04)  VALUE +0 COMP SYNC.   01260079
012700     05  PV-HIGHEST-BLOCK-WRITTEN                                 01270079
012800                                PIC S9(04)  VALUE +0 COMP SYNC.   01280079
012900     05  PV-LIST-ITEM-NUMBER    PIC S9(04)  VALUE +0 COMP SYNC.   01290079
013000     05  PV-FIRST-BLOCK-IN-ARRAY                                  01300079
013100                                PIC S9(04)  VALUE +0 COMP SYNC.   01310079
013200     05  PV-NEXT-BLOCK-IN-ARRAY PIC S9(04)  VALUE +0 COMP SYNC.   01320079
013300     05  PV-PREV-BLOCK-IN-ARRAY PIC S9(04)  VALUE +0 COMP SYNC.   01330079
013400     05  PV-FIRST-BLOCK-IN-RANGE                                  01340079
013500                                PIC S9(04)  VALUE +0 COMP SYNC.   01350079
013600     05  PV-LAST-BLOCK-IN-RANGE PIC S9(04)  VALUE +0 COMP SYNC.   01360079
013700     05  PV-START-OF-SELECTED-RANGE                               01370079
013800                                PIC S9(04)  VALUE +0 COMP SYNC.   01380079
013900     05  PV-END-OF-SELECTED-RANGE                                 01390079
014000                                PIC S9(04)  VALUE +0 COMP SYNC.   01400079
014100     05  PV-STR-NBR             PIC 9(04)            VALUE ZEROS. 01410079
014200     05  PV-DB2-STR-NBR         PIC S9(04)           COMP.        01420079
014300     05  PV-DB2-SHEET-NBR       PIC S9(09)           COMP.        01430079
014400     05  PV-DB2-TYPE-CDE        PIC X(01).                        01440079
014500     05  PV-SUM-UNT-RTL-AMT     PIC S9(09)V99        COMP-3.      01450079
014600     05  PV-SUM-EXTD-RTL-AMT    PIC S9(11)V99        COMP-3.      01460079
014700     05  PV-UNIT-RTL-TOTAL      PIC S9(09)V99  VALUE +0           01470079
014800                                                    COMP SYNC.    01480079
014900     05  PV-INV-QTY-TOTAL       PIC S9(09)V99  VALUE +0           01490079
015000                                                    COMP SYNC.    01500079
015100     05  PV-EXTD-RTL-TOTAL      PIC S9(11)V99 VALUE +0            01510079
015200                                                    COMP-3.       01520079
015300                                                                  01530079
015400                                                                  01540079
015500*---------------------------------------------------------------* 01550079
015600* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.  THIS 01560079
015700* MUST BE THE EXACT SAME FORMAT A BLOCK IN THE APPLICATION        01570079
015800* SPECIFIC COMMAREA.                                              01580079
015900*---------------------------------------------------------------* 01590079
016000 01  LQW-LIST-QUEUE-WORK-AREA.                                    01600079
016100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01610079
016200     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01620079
016300                                        INDEXED BY LQW-IDX.       01630079
016400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)    COMP-3.     01640079
016500         10  LQW-TEMP-SELECTED-SW       PIC X.                    01650079
016600         10  LQW-SELECTED-SW            PIC X.                    01660079
016700             88  LQW-SELECT                           VALUE 'S'.  01670079
016800             88  LQW-DESELECT                         VALUE ' '.  01680079
016900         10  LQW-ACTION                 PIC X(03).                01690079
017000         10  LQW-SHEET-NBR              PIC S9(09)    COMP.       01700079
017100         10  LQW-TYPE-CDE               PIC X(01).                01710079
017200         10  LQW-SUM-UNT-RTL-AMT        PIC S9(09)V99 COMP-3.     01720079
017300         10  LQW-SUM-INV-QTY            PIC S9(09)    COMP.       01730079
017400         10  LQW-SUM-EXTD-RTL-AMT       PIC S9(11)V99 COMP-3.     01740079
017500                                                                  01750079
017600*---------------------------------------------------------------* 01760079
017700*  RECORD LAYOUT FOR THE SHEET INVENTORY TEMP STORAGE SELECTION * 01770079
017800*  QUEUE.                                                       * 01780079
017900*---------------------------------------------------------------* 01790079
018000                                                                  01800079
018100     COPY INWS031.                                                01810079
018200                                                                  01820079
018300                                                                  01830079
018400*---------------------------------------------------------------* 01840079
018500*    MAP LAYOUT                                                 * 01850079
018600*---------------------------------------------------------------* 01860079
018700                                                                  01870079
018800     COPY INKM032.                                                01880079
018900                                                                  01890079
019000                                                                  01900079
019100 01  MR-OCCURS-LAYOUT                   REDEFINES  IN032AO.       01910079
019200     05  FILLER                         PIC X(79).                01920079
019300     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01930079
019400         10  MR-SELECTL                 PIC S9(04) COMP.          01940079
019500         10  MR-SELECTA                 PIC X.                    01950079
019600         10  MR-SELECTC                 PIC X.                    01960079
019700         10  MR-SELECTH                 PIC X.                    01970079
019800         10  MR-SELECTI                 PIC X.                    01980079
019900                                                                  01990079
020000         10  MR-ACTIONL                 PIC S9(04) COMP.          02000079
020100         10  MR-ACTIONA                 PIC X.                    02010079
020200         10  MR-ACTIONC                 PIC X.                    02020079
020300         10  MR-ACTIONH                 PIC X.                    02030079
020400         10  MR-ACTION                  PIC X(03).                02040079
020500                                                                  02050079
020600         10  MR-SHEET-NBRL              PIC S9(04) COMP.          02060079
020700         10  MR-SHEET-NBRA              PIC X.                    02070079
020800         10  MR-SHEET-NBRC              PIC X.                    02080079
020900         10  MR-SHEET-NBRH              PIC X.                    02090079
021000         10  MR-SHEET-NBR-X.                                      02100079
021100             15  MR-SHEET-NBR           PIC Z(06).                02110079
021200                                                                  02120079
021300         10  MR-TYPE-CDEL              PIC S9(04) COMP.           02130079
021400         10  MR-TYPE-CDEA              PIC X.                     02140079
021500         10  MR-TYPE-CDEC              PIC X.                     02150079
021600         10  MR-TYPE-CDEH              PIC X.                     02160079
021700         10  MR-TYPE-CDE               PIC X(01).                 02170079
021800                                                                  02180079
021900         10  MR-SUM-UNT-RTL-AMTL        PIC S9(04) COMP.          02190079
022000         10  MR-SUM-UNT-RTL-AMTA        PIC X.                    02200079
022100         10  MR-SUM-UNT-RTL-AMTC        PIC X.                    02210079
022200         10  MR-SUM-UNT-RTL-AMTH        PIC X.                    02220079
022300         10  MR-SUM-UNT-RTL-AMT-X.                                02230079
022400             15  MR-SUM-UNT-RTL-AMT     PIC ZZZ,ZZZ,ZZZ.99.       02240079
022500                                                                  02250079
022600         10  MR-SUM-INV-QTYL            PIC S9(04) COMP.          02260079
022700         10  MR-SUM-INV-QTYA            PIC X.                    02270079
022800         10  MR-SUM-INV-QTYC            PIC X.                    02280079
022900         10  MR-SUM-INV-QTYH            PIC X.                    02290079
023000         10  MR-SUM-INV-QTY-X.                                    02300079
023100             15  MR-SUM-INV-QTY         PIC Z,ZZZ,ZZZ.            02310079
023200                                                                  02320079
023300         10  MR-SUM-EXTD-RTL-AMTL       PIC S9(04) COMP.          02330079
023400         10  MR-SUM-EXTD-RTL-AMTA       PIC X.                    02340079
023500         10  MR-SUM-EXTD-RTL-AMTC       PIC X.                    02350079
023600         10  MR-SUM-EXTD-RTL-AMTH       PIC X.                    02360079
023700         10  MR-SUM-EXTD-RTL-AMT-X.                               02370079
023800             15  MR-SUM-EXTD-RTL-AMT    PIC Z,ZZZ,ZZZ,ZZZ.99.     02380079
023900                                                                  02390079
024000                                                                  02400079
024100*---------------------------------------------------------------* 02410079
024200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02420079
024300*---------------------------------------------------------------* 02430079
024400                                                                  02440079
024500     COPY DPWS015.                                                02450079
024600                                                                  02460079
024700                                                                  02470079
024800*---------------------------------------------------------------* 02480079
024900*    FUNCTION KEYS COPYBOOK.                                    * 02490079
025000*---------------------------------------------------------------* 02500079
025100                                                                  02510079
025200     COPY DPWS016.                                                02520079
025300                                                                  02530079
025400                                                                  02540079
025500*---------------------------------------------------------------* 02550079
025600*    NUMERIC EDIT LAYOUT.                                       * 02560079
025700*---------------------------------------------------------------* 02570079
025800                                                                  02580079
025900     COPY DPWS010I.                                               02590079
026000                                                                  02600079
026100                                                                  02610079
026200*---------------------------------------------------------------* 02620079
026300*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 02630079
026400*---------------------------------------------------------------* 02640079
026500                                                                  02650079
026600     COPY DPWS030.                                                02660079
026700     COPY DPWS930.                                                02670079
026800                                                                  02680079
026900                                                                  02690079
027000*---------------------------------------------------------------* 02700079
027100*    STANDARD COMMAREA.                                         * 02710079
027200*---------------------------------------------------------------* 02720079
027300                                                                  02730079
027400     COPY DPWS020.                                                02740079
027500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02750079
027600                                                                  02760079
027700*---------------------------------------------------------------* 02770079
027800*  THIS IS THE INTER-APPLICATION COMMAREA FOR THE PHYSICAL      * 02780079
027900*  INVENTORY SHEET INVENTORY SCREENS.                           * 02790079
028000*---------------------------------------------------------------* 02800079
028100         10  INTER-APPL-COMM-AREA       PIC X(200).               02810079
028200     COPY INWS030.                                                02820079
028300                                                                  02830079
028400*---------------------------------------------------------------* 02840079
028500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02850079
028600*---------------------------------------------------------------* 02860079
028700         10  ASC-SPECIFIC-COMMAREA.                               02870079
028800             15  ASC-LIST-KEYS.                                   02880079
028900                 20  ASC-KEY-STR-NBR                 PIC S9(04)   02890079
029000                                                         COMP.    02900079
029100                 20  ASC-KEY-SHEET-NBR               PIC S9(09)   02910079
029200                                                         COMP.    02920079
029300                 20  ASC-KEY-TYPE-CDE           PIC X(01).        02930079
029400                     88  ASC-TYPE-ALL-SHEETS    VALUE '*'.        02940079
029500                     88  ASC-TYPE-TFR-SHEETS    VALUE 'T'.        02950079
029600                     88  ASC-TYPE-MANI-SHEETS   VALUE 'M'.        02960079
029700                     88  ASC-TYPE-ENTRD-SHEETS  VALUE 'K'.        02970079
029800             15  ASC-TYPE-CDE-DESC              PIC X(25).        02980079
029900                 88  ASC-DESC-ALL-SHEETS                          02990079
030000                     VALUE 'ALL SHEETS'.                          03000079
030100                 88  ASC-DESC-TFR-SHEETS                          03010079
030200                     VALUE 'TRANSFER STORE SHEETS'.               03020079
030300                 88  ASC-DESC-MANI-SHEETS                         03030079
030400                     VALUE 'MANIFEST TRAILER SHEETS'.             03040079
030500                 88  ASC-DESC-ENTRD-SHEETS                        03050079
030600                     VALUE 'USER ENTERED SHEETS'.                 03060079
030700             15  ASC-STORE-NAME                      PIC X(25).   03070079
030800             15  ASC-SHEET-INV-IND                   PIC X.       03080079
030900                 88  ASC-SHEET-INV-COMPLETED         VALUE 'Y'.   03090079
031000                 88  ASC-SHEET-INV-NOT-COMPLETED     VALUE 'N'.   03100079
031100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03110079
031200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03120079
031300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03130079
031400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03140079
031500                                                                  03150079
031600                 20  ASC-ITEM-ARRAY.                              03160079
031700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03170079
031800                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   03180079
031900                                                     COMP-3.      03190079
032000                         30  ASC-TEMP-SELECTED-SW    PIC  X.      03200079
032100                             88  ASC-VALID-SELECT    VALUE ' '    03210079
032200                                                           'S'    03220079
032300                                                           'B'    03230079
032400                                                           'E'.   03240079
032500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03250079
032600                             88  ASC-TEMP-SELECT     VALUE 'S'.   03260079
032700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03270079
032800                             88  ASC-TEMP-END        VALUE 'E'.   03280079
032900                         30  ASC-SELECTED-SW         PIC  X.      03290079
033000                             88  ASC-NO-SELECT       VALUE ' '.   03300079
033100                             88  ASC-SELECT          VALUE 'S'.   03310079
033200                             88  ASC-BEGIN           VALUE 'B'.   03320079
033300                             88  ASC-END             VALUE 'E'.   03330079
033400                         30  ASC-ACTION              PIC  X(03).  03340079
033500                         30  ASC-SHEET-NBR           PIC S9(09)   03350079
033600                                                          COMP.   03360079
033700                         30  ASC-SHEET-NBR-X REDEFINES            03370079
033800                             ASC-SHEET-NBR           PIC  9(04).  03380079
033900                         30  ASC-SHEET-NBR-TOT REDEFINES          03390079
034000                             ASC-SHEET-NBR-X         PIC  X(04).  03400079
034100                         30  ASC-TYPE-CDE            PIC  X(01).  03410079
034200                         30  ASC-SUM-UNT-RTL-AMT     PIC S9(09)V9903420079
034300                                                          COMP-3. 03430079
034400                         30  ASC-SUM-INV-QTY         PIC S9(09)   03440079
034500                                                          COMP.   03450079
034600                         30  ASC-SUM-EXTD-RTL-AMT    PIC S9(11)V9903460079
034700                                                          COMP-3. 03470079
034800                                                                  03480079
034900             15  ASC-BLK-SUB                         PIC S9(04)   03490079
035000                                                          COMP    03500079
035100                                                          SYNC.   03510079
035200             15  ASC-ITEM-SUB                        PIC S9(04)   03520079
035300                                                          COMP    03530079
035400                                                          SYNC.   03540079
035500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03550079
035600                                                          COMP-3. 03560079
035700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03570079
035800                                                          COMP-3. 03580079
035900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03590079
036000                                                          COMP-3. 03600079
036100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03610079
036200                                                          COMP-3. 03620079
036300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03630079
036400                                                          COMP-3. 03640079
036500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03650079
036600                                                          COMP    03660079
036700                                                          SYNC.   03670079
036800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03680079
036900                                                          COMP-3. 03690079
037000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03700079
037100                                                          COMP-3. 03710079
037200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03720079
037300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03730079
037400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03740079
037500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03750079
037600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03760079
037700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03770079
037800             15  ASC-LIST-QUEUE-NAME.                             03780079
037900                 20  ASC-LIST-TERM-ID                PIC  X(04).  03790079
038000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03800079
038100                                                          COMP-3. 03810079
038200                 20  ASC-LIST-SEQ                    PIC  9(01).  03820079
038300             15  ASC-SEL-QUEUE-NAME.                              03830079
038400                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03840079
038500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03850079
038600                                                          COMP-3. 03860079
038700                 20  ASC-SEL-SEQ                     PIC  9(01).  03870079
038800                                                                  03880079
038900             15  ASC-CURSOR-SW                       PIC X(01).   03890079
039000                 88  ASC-STR-NBR-CSR                 VALUE 'S'.   03900079
039100                 88  ASC-SHEET-NBR-CSR               VALUE 'T'.   03910079
039200                 88  ASC-STR-NBR-CSR2                VALUE 'X'.   03920079
039300                 88  ASC-SHEET-NBR-CSR2              VALUE 'Y'.   03930079
039400             15  ASC-START-ITEM-REQUEST.                          03940079
039500                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03950079
039600                                                                  03960079
039700         10  FILLER                     PIC X(1974).              03970079
039800                                                                  03980079
039900*---------------------------------------------------------------* 03990079
040000*    ABEND PROCESSING COPYBOOK.                                 * 04000079
040100*---------------------------------------------------------------* 04010079
040200                                                                  04020079
040300     COPY DPWS013.                                                04030079
040400                                                                  04040079
040500                                                                  04050079
040600*---------------------------------------------------------------* 04060079
040700*    DB2 AREA FOR INVENTORY SHEET ENTRY TABLE                   * 04070079
040800*---------------------------------------------------------------* 04080079
040900     EXEC SQL                                                     04090079
041000          INCLUDE TINENTY                                         04100079
041100     END-EXEC.                                                    04110079
041200                                                                  04120079
041300                                                                  04130079
041400*---------------------------------------------------------------* 04140079
041500*    DB2 AREA FOR COMMUNICATIONS                                * 04150079
041600*---------------------------------------------------------------* 04160079
041700     EXEC SQL                                                     04170079
041800          INCLUDE SQLCA                                           04180079
041900     END-EXEC.                                                    04190079
042000                                                                  04200079
042100                                                                  04210079
042200*---------------------------------------------------------------* 04220079
042300*    SHEET INVENTORY CURSOR USED WHEN ALL SHEETS FOR A STORE ARE  04230079
042400*    SELECTED. <SHEET TYPE CODE SPECIFIC LOOKUP>                  04240079
042500*---------------------------------------------------------------* 04250079
042600                                                                  04260079
042700     EXEC SQL                                                     04270079
042800         DECLARE  STR-NBR-CSR CURSOR FOR                          04280079
042900         SELECT   SHEET_NBR                                       04290079
043000                , SHEET_TYP_CDE                                   04300079
043100                , SUM(UNT_RTL_AMT)                                04310079
043200                , SUM(INV_QTY)                                    04320079
043300                , SUM(EXTD_RTL_AMT)                               04330079
043400         FROM     TINENTY                                         04340079
043500         WHERE    STR_NBR       = :PV-DB2-STR-NBR                 04350079
043600           AND    SHEET_TYP_CDE = :PV-DB2-TYPE-CDE                04360079
043700*****      AND    SHEET_TYP_CDE = :PC-SHEET-TYP-CDE-KEYED         04370079
043800         GROUP BY SHEET_NBR, SHEET_TYP_CDE                        04380079
043900         ORDER BY SHEET_NBR, SHEET_TYP_CDE                        04390079
044000     END-EXEC.                                                    04400079
044100                                                                  04410079
044200*---------------------------------------------------------------* 04420079
044300*    SHEET INVENTORY CURSOR USED WHEN A SPECIFIC SHEET FOR A      04430079
044400*    STORE IS SELECTED. <SHEET TYPE CODE SPECIFIC LOOKUP>         04440079
044500*---------------------------------------------------------------* 04450079
044600                                                                  04460079
044700     EXEC SQL                                                     04470079
044800         DECLARE  SHEET-NBR-CSR CURSOR FOR                        04480079
044900         SELECT   SHEET_NBR                                       04490079
045000                , SHEET_TYP_CDE                                   04500079
045100                , SUM(UNT_RTL_AMT)                                04510079
045200                , SUM(INV_QTY)                                    04520079
045300                , SUM(EXTD_RTL_AMT)                               04530079
045400         FROM     TINENTY                                         04540079
045500         WHERE    STR_NBR       = :PV-DB2-STR-NBR                 04550079
045600           AND    SHEET_NBR     = :PV-DB2-SHEET-NBR               04560079
045700           AND    SHEET_TYP_CDE = :PV-DB2-TYPE-CDE                04570079
045800*****      AND    SHEET_TYP_CDE = :PC-SHEET-TYP-CDE-KEYED         04580079
045900         GROUP BY SHEET_NBR, SHEET_TYP_CDE                        04590079
046000     END-EXEC.                                                    04600079
046100                                                                  04610079
046200                                                                  04620079
046300*---------------------------------------------------------------* 04630079
046400*    SHEET INVENTORY CURSOR USED WHEN ALL SHEETS FOR A STORE ARE  04640079
046500*    SELECTED. <LOOKUP ALL SHEET TYPE CODE(S)>                    04650079
046600*---------------------------------------------------------------* 04660079
046700                                                                  04670079
046800     EXEC SQL                                                     04680079
046900         DECLARE  STR-NBR-CSR2 CURSOR FOR                         04690079
047000         SELECT   SHEET_NBR                                       04700079
047100                , SHEET_TYP_CDE                                   04710079
047200                , SUM(UNT_RTL_AMT)                                04720079
047300                , SUM(INV_QTY)                                    04730079
047400                , SUM(EXTD_RTL_AMT)                               04740079
047500         FROM     TINENTY                                         04750079
047600         WHERE    STR_NBR       = :PV-DB2-STR-NBR                 04760079
047700         GROUP BY SHEET_NBR, SHEET_TYP_CDE                        04770079
047800         ORDER BY SHEET_NBR, SHEET_TYP_CDE                        04780079
047900     END-EXEC.                                                    04790079
048000                                                                  04800079
048100*---------------------------------------------------------------* 04810079
048200*    SHEET INVENTORY CURSOR USED WHEN A SPECIFIC SHEET FOR A      04820079
048300*    STORE IS SELECTED. <LOOKUP ALL SHEET TYPE CODE(S)>           04830079
048400*---------------------------------------------------------------* 04840079
048500                                                                  04850079
048600     EXEC SQL                                                     04860079
048700         DECLARE  SHEET-NBR-CSR2 CURSOR FOR                       04870079
048800         SELECT   SHEET_NBR                                       04880079
048900                , SHEET_TYP_CDE                                   04890079
049000                , SUM(UNT_RTL_AMT)                                04900079
049100                , SUM(INV_QTY)                                    04910079
049200                , SUM(EXTD_RTL_AMT)                               04920079
049300         FROM     TINENTY                                         04930079
049400         WHERE    STR_NBR       = :PV-DB2-STR-NBR                 04940079
049500           AND    SHEET_NBR     = :PV-DB2-SHEET-NBR               04950079
049600         GROUP BY SHEET_NBR, SHEET_TYP_CDE                        04960079
049700     END-EXEC.                                                    04970079
049800                                                                  04980079
049900 LINKAGE SECTION.                                                 04990079
050000                                                                  05000079
050100 01  DFHCOMMAREA.                                                 05010079
050200     05  FILLER                         OCCURS  1 TO 4072 TIMES   05020079
050300                                        DEPENDING ON EIBCALEN.    05030079
050400         10  FILLER                     PIC X.                    05040079
050500                                                                  05050079
050600                                                                  05060079
050700                                                                  05070079
050800 PROCEDURE DIVISION.                                              05080079
050900                                                                  05090079
051000*----------------------------------------------------------------*05100079
051100*  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.    05110079
051200*  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM     05120079
051300*  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.    05130079
051400*----------------------------------------------------------------*05140079
051500 0000-MAIN-MODULE.                                                05150079
051600                                                                  05160079
051700     INITIALIZE DP030-CICS-API-FIELDS.                            05170079
051800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05180079
051900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05190079
052000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05200079
052100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05210079
052200     MOVE LENGTH OF IN032AI        TO DP030-MAP-LENGTH (1).       05220079
052300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05230079
052400     PERFORM 0001-CALL-CICS-ARCH-API.                             05240079
052500                                                                  05250079
052600     PERFORM 1000-CONTROL-PROCESSING                              05260079
052700                                                                  05270079
052800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05280079
052900     PERFORM 0001-CALL-CICS-ARCH-API.                             05290079
053000                                                                  05300079
053100                                                                  05310079
053200*----------------------------------------------------------------*05320079
053300* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE       05330079
053400* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.             05340079
053500*----------------------------------------------------------------*05350079
053600 0001-CALL-CICS-ARCH-API.                                         05360079
053700                                                                  05370079
053800*    CALL 'DPKCS030' USING DFHEIBLK                               05380079
053900     CALL DP930-CICS-ARCH-API                                     05390079
054000                     USING DFHEIBLK                               05400079
054100                           DFHCOMMAREA                            05410079
054200                           DP030-CICS-API-FIELDS                  05420079
054300                           DP020-STANDARD-COMMAREA                05430079
054400                           IN032AI.                               05440079
054500                                                                  05450079
054600     IF  DP030-RC-CALL-SUCCESSFUL                                 05460079
054700         CONTINUE                                                 05470079
054800     ELSE                                                         05480079
054900         SET DP013-NO-ROLLBACK                                    05490079
055000             DP013-XCTL-DISPLAY-RESTART                           05500079
055100             DP013-CICS-ABEND      TO TRUE                        05510079
055200         MOVE '0001-CALL-CICS-ARCH-API'                           05520079
055300                                   TO DP013-PARAGRAPH             05530079
055400*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05540079
055500*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05550079
055600         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05560079
055700-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05570079
055800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05580079
055900         PERFORM DP013-0000-PROCESS-ABEND                         05590079
056000     END-IF.                                                      05600079
056100                                                                  05610079
056200                                                                  05620079
056300*----------------------------------------------------------------*05630079
056400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05640079
056500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05650079
056600*                                                                *05660079
056700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05670079
056800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05680079
056900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05690079
057000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05700079
057100*----------------------------------------------------------------*05710079
057200 1000-CONTROL-PROCESSING.                                         05720079
057300                                                                  05730079
057400     EVALUATE TRUE                                                05740079
057500         WHEN DP020-NEXT-ACT-INITIAL                              05750079
057600             INITIALIZE ASC-SPECIFIC-COMMAREA                     05760079
057700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05770079
057800                                      ASC-SEL-TERM-ID             05780079
057900             MOVE DP020-SRC-TASK-NUMBER                           05790079
058000                                   TO ASC-LIST-TASK-NUMBER        05800079
058100                                      ASC-SEL-TASK-NUMBER         05810079
058200             MOVE PC-LIST-QUEUE-SEQ                               05820079
058300                                   TO ASC-LIST-SEQ                05830079
058400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05840079
058500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05850079
058600             PERFORM 4000-BUILD-INITIAL-PANEL                     05860079
058700                                                                  05870079
058800         WHEN DP020-NEXT-ACT-READ-MAP                             05880079
058900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05890079
059000                                   TO PV-TOP-ITEM                 05900079
059100             PERFORM 2000-PROCESS-PANEL                           05910079
059200                                                                  05920079
059300         WHEN DP020-NEXT-ACT-RETURN                               05930079
059400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05940079
059500                                   TO PV-TOP-ITEM                 05950079
059600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05960079
059700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05970079
059800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05980079
059900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05990079
060000                                                                  06000079
060100         WHEN OTHER                                               06010079
060200             SET DP013-LOGIC-ABEND TO TRUE                        06020079
060300             SET DP013-NO-ROLLBACK TO TRUE                        06030079
060400             MOVE '1000-CONTROL-PROCESSING'                       06040079
060500                                   TO DP013-PARAGRAPH             06050079
060600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06060079
060700                                   TO DP013-MESSAGE-TEXT(1)       06070079
060800             PERFORM DP013-0000-PROCESS-ABEND                     06080079
060900     END-EVALUATE.                                                06090079
061000                                                                  06100079
061100                                                                  06110079
061200*----------------------------------------------------------------*06120079
061300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06130079
061400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06140079
061500*----------------------------------------------------------------*06150079
061600 1100-PROCESS-INTER-APPL-COMM.                                    06160079
061700                                                                  06170079
061800     MOVE SPACE                   TO ASC-START-ITEM-REQUEST.      06180079
061900     IF  DP020-INT-APPL-FORMAT-IND = PC-FORMAT-IND-CRIT-SPEC      06190079
062000         MOVE IN030-STR-NBR       TO ASC-KEY-STR-NBR              06200079
062100         MOVE IN030-SHEET-NBR     TO ASC-KEY-SHEET-NBR            06210079
062200         MOVE IN030-TYPE-CDE      TO ASC-KEY-TYPE-CDE             06220079
062300         MOVE IN030-TYPE-CDE-DESC TO ASC-TYPE-CDE-DESC            06230079
062400         MOVE IN030-STORE-NAME    TO ASC-STORE-NAME               06240079
062500         MOVE IN030-SHEET-INV-IND TO ASC-SHEET-INV-IND            06250079
062600     END-IF.                                                      06260079
062700                                                                  06270079
062800                                                                  06280079
062900*----------------------------------------------------------------*06290079
063000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06300079
063100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06310079
063200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06320079
063300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06330079
063400* FUNCTION KEYS CAN GET THIS FAR.                                *06340079
063500*----------------------------------------------------------------*06350079
063600 2000-PROCESS-PANEL.                                              06360079
063700                                                                  06370079
063800     EVALUATE TRUE                                                06380079
063900         WHEN DP020-SRC-AID = DP016-CLEAR                         06390079
064000             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                06400079
064100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06410079
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06420079
064300                                                                  06430079
064400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06440079
064500             PERFORM 2050-DELETE-LIST-QUEUE                       06450079
064600             PERFORM 4000-BUILD-INITIAL-PANEL                     06460079
064700                                                                  06470079
064800         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06480079
064900             PERFORM 2140-DESELECT-ALL-ITEMS                      06490079
065000             PERFORM 3200-RESET-ATTRIBUTES                        06500079
065100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06510079
065200                                                                  06520079
065300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06530079
065400             PERFORM 2150-SELECT-ALL-ITEMS                        06540079
065500             PERFORM 3200-RESET-ATTRIBUTES                        06550079
065600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06560079
065700                                                                  06570079
065800         WHEN OTHER                                               06580079
065900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06590079
066000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06600079
066100             IF  PS-NO-ERROR                                      06610079
066200                 SET DP030-CONTINUE-GO TO TRUE                    06620079
066300                 PERFORM 2100-CHECK-FUNCTION-KEY                  06630079
066400             ELSE                                                 06640079
066500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06650079
066600                 SET DP030-OVERRIDE-GO TO TRUE                    06660079
066700             END-IF                                               06670079
066800     END-EVALUATE.                                                06680079
066900                                                                  06690079
067000                                                                  06700079
067100*----------------------------------------------------------------*06710079
067200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06720079
067300*----------------------------------------------------------------*06730079
067400 2050-DELETE-LIST-QUEUE.                                          06740079
067500                                                                  06750079
067600     EXEC CICS                                                    06760079
067700         DELETEQ TS                                               06770079
067800             QUEUE (ASC-LIST-QUEUE-NAME)                          06780079
067900             RESP  (PV-CICS-RESP)                                 06790079
068000     END-EXEC.                                                    06800079
068100                                                                  06810079
068200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06820079
068300        (PV-CICS-RESP = DFHRESP(QIDERR))                          06830079
068400         CONTINUE                                                 06840079
068500     ELSE                                                         06850079
068600         SET DP013-CICS-ABEND      TO TRUE                        06860079
068700         SET DP013-NO-ROLLBACK     TO TRUE                        06870079
068800                                                                  06880079
068900         MOVE '2050-DELETE-LIST-QUEUE'                            06890079
069000                                   TO DP013-PARAGRAPH             06900079
069100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06910079
069200                                   TO DP013-MESSAGE-TEXT (1)      06920079
069300         PERFORM DP013-0000-PROCESS-ABEND                         06930079
069400     END-IF.                                                      06940079
069500                                                                  06950079
069600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06960079
069700                                                                  06970079
069800                                                                  06980079
069900*----------------------------------------------------------------*06990079
070000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07000079
070100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07010079
070200* CICS ARCHITECTURE API.                                         *07020079
070300*----------------------------------------------------------------*07030079
070400 2100-CHECK-FUNCTION-KEY.                                         07040079
070500                                                                  07050079
070600     EVALUATE TRUE                                                07060079
070700         WHEN  DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)             07070079
070800         WHEN  DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)             07080079
070900         WHEN  DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)             07090079
071000             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07100079
071100*                IF UPDATE OR DELETE PFKEY HIT AND SHEET          07110079
071200*                INVENTORY IS ALREADY COMPLETE, RETURN ERROR.     07120079
071300                 IF  (DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)      07130079
071400                 OR   DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID))     07140079
071500                 AND ASC-SHEET-INV-COMPLETED                      07150079
071600                     SET DP030-OVERRIDE-GO TO TRUE                07160079
071700*                    ---- SHEET INVENTORY ALREADY PROCESSED ----  07170079
071800                     MOVE PC-TSYMSG-02137  TO DP020-MSG-NUMBER    07180079
071900                     SET DP020-MSG-FATAL   TO TRUE                07190079
072000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07200079
072100                 ELSE                                             07210079
072200                     PERFORM 2105-PREPARE-INTER-APPL-COMM         07220079
072300                     INITIALIZE IN030-NUMBER-OF-TS-ITEMS          07230079
072400                                IN030-SEL-QUEUE-NAME              07240079
072500                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            07250079
072600                       TO IN030-NUMBER-OF-SELECTED-ITEMS          07260079
072700                     PERFORM 5000-PREPARE-SEL-QUEUE               07270079
072800                 END-IF                                           07280079
072900             ELSE                                                 07290079
073000                 SET DP030-OVERRIDE-GO TO TRUE                    07300079
073100*                ---- A LIST ITEM MUST BE SELECTED ----           07310079
073200                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        07320079
073300                 SET DP020-MSG-WARNING TO TRUE                    07330079
073400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07340079
073500             END-IF                                               07350079
073600                                                                  07360079
073700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07370079
073800             MOVE +1               TO PV-TOP-ITEM                 07380079
073900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07390079
074000                                                                  07400079
074100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07410079
074200             PERFORM 2110-BROWSE-BACKWARD                         07420079
074300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07430079
074400                                                                  07440079
074500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07450079
074600             PERFORM 2120-BROWSE-FORWARD                          07460079
074700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07470079
074800                                                                  07480079
074900         WHEN DP020-SRC-AID = DP016-ENTER                         07490079
075000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07500079
075100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07510079
075200                                                                  07520079
075300         WHEN OTHER                                               07530079
075400             SET DP013-NO-ROLLBACK                                07540079
075500                 DP013-XCTL-DISPLAY-RESTART                       07550079
075600                 DP013-CICS-ABEND  TO TRUE                        07560079
075700             MOVE '2100-CHECK-FUNCTION-KEY'                       07570079
075800                                   TO DP013-PARAGRAPH             07580079
075900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07590079
076000                                   TO DP013-MESSAGE-TEXT (1)      07600079
076100             PERFORM DP013-0000-PROCESS-ABEND                     07610079
076200     END-EVALUATE.                                                07620079
076300                                                                  07630079
076400                                                                  07640079
076500 2105-PREPARE-INTER-APPL-COMM.                                    07650079
076600                                                                  07660079
076700     MOVE ASC-KEY-STR-NBR     TO IN030-STR-NBR.                   07670079
076800     MOVE ASC-KEY-SHEET-NBR   TO IN030-SHEET-NBR.                 07680079
076900     MOVE ASC-KEY-TYPE-CDE    TO IN030-TYPE-CDE.                  07690079
077000     MOVE ASC-TYPE-CDE-DESC   TO IN030-TYPE-CDE-DESC.             07700079
077100     MOVE ASC-STORE-NAME      TO IN030-STORE-NAME.                07710079
077200     MOVE ASC-SHEET-INV-IND   TO IN030-SHEET-INV-IND.             07720079
077300                                                                  07730079
077400                                                                  07740079
077500*----------------------------------------------------------------*07750079
077600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07760079
077700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07770079
077800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07780079
077900*    MESSAGE.                                                    *07790079
078000*----------------------------------------------------------------*07800079
078100 2110-BROWSE-BACKWARD.                                            07810079
078200                                                                  07820079
078300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07830079
078400         GIVING PV-TOP-ITEM.                                      07840079
078500                                                                  07850079
078600     IF  ((PV-TOP-ITEM < +1)                                      07860079
078700       OR (PV-TOP-ITEM = +1))                                     07870079
078800         MOVE +1                   TO PV-TOP-ITEM                 07880079
078900*        -- TOP OF LIST --                                        07890079
079000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07900079
079100         SET DP020-MSG-INFORMATIONAL TO TRUE                      07910079
079200     END-IF.                                                      07920079
079300                                                                  07930079
079400                                                                  07940079
079500*----------------------------------------------------------------*07950079
079600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07960079
079700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07970079
079800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07980079
079900*----------------------------------------------------------------*07990079
080000 2120-BROWSE-FORWARD.                                             08000079
080100                                                                  08010079
080200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08020079
080300         GIVING PV-TOP-ITEM.                                      08030079
080400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08040079
080500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08050079
080600                                   TO PV-TOP-ITEM                 08060079
080700*        -- BOTTOM OF LIST --                                     08070079
080800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08080079
080900         SET DP020-MSG-INFORMATIONAL                              08090079
081000                                   TO TRUE                        08100079
081100     ELSE                                                         08110079
081200         COMPUTE PV-BOTTOM-ITEM =                                 08120079
081300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08130079
081400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08140079
081500*            -- BOTTOM OF LIST --                                 08150079
081600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08160079
081700             SET DP020-MSG-INFORMATIONAL                          08170079
081800                                   TO TRUE                        08180079
081900         END-IF                                                   08190079
082000     END-IF.                                                      08200079
082100                                                                  08210079
082200                                                                  08220079
082300*----------------------------------------------------------------*08230079
082400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08240079
082500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08250079
082600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08260079
082700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08270079
082800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08280079
082900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08290079
083000*----------------------------------------------------------------*08300079
083100 2130-CHECK-FOR-JUMP-BROWSE.                                      08310079
083200                                                                  08320079
083300     IF (ASC-START-ITEM-REQUEST = SPACE)                          08330079
083400         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             08340079
083500     ELSE                                                         08350079
083600         MOVE ASC-START-ITEM-REQUEST   TO DP010I-UNEDITED-FIELD   08360079
083700         MOVE PC-ITEM-NUMBER-LENGTH    TO DP010I-MAXIMUM-DIGITS   08370079
083800         MOVE +0                       TO DP010I-MAXIMUM-DECIMALS 08380079
083900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08390079
084000         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08400079
084100              USING DP010I-NUMERIC-EDIT-AREA                      08410079
084200                                                                  08420079
084300         IF  NOT DP010I-ERROR-DETECTED                            08430079
084400             MOVE DP010I-NUMERIC-FIELD                            08440079
084500                                   TO  ASC-START-ITEM-REQUEST-N   08450079
084600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08460079
084700                 IF  ASC-START-ITEM-REQUEST-N >                   08470079
084800                                          ASC-NUMBER-OF-ITEMS-READ08480079
084900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08490079
085000                     COMPUTE PV-TOP-ITEM =                        08500079
085100                               ASC-NUMBER-OF-ITEMS-READ           08510079
085200                             - PC-ITEMS-PER-PANEL + 1             08520079
085300                     IF  PV-TOP-ITEM < +1                         08530079
085400                         MOVE +1   TO PV-TOP-ITEM                 08540079
085500*                        ---- BOTTOM OF LIST ----                 08550079
085600                         MOVE PC-TSYMSG-00070                     08560079
085700                                   TO DP020-MSG-NUMBER            08570079
085800                         SET DP020-MSG-INFORMATIONAL              08580079
085900                                   TO TRUE                        08590079
086000                     END-IF                                       08600079
086100                 ELSE                                             08610079
086200                     MOVE ASC-START-ITEM-REQUEST-N                08620079
086300                                   TO PV-TOP-ITEM                 08630079
086400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08640079
086500                     COMPUTE PV-BOTTOM-ITEM =                     08650079
086600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08660079
086700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08670079
086800*                        -- BOTTOM OF LIST --                     08680079
086900                         MOVE PC-TSYMSG-00070                     08690079
087000                                   TO DP020-MSG-NUMBER            08700079
087100                         SET DP020-MSG-INFORMATIONAL              08710079
087200                                   TO TRUE                        08720079
087300                     END-IF                                       08730079
087400                 END-IF                                           08740079
087500             ELSE                                                 08750079
087600*                --- VALUE OUT OF RANGE ----                      08760079
087700                 MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER     08770079
087800                 MOVE -1                  TO ASTRTITL             08780079
087900                 SET DP030-SET-CURSOR-APPL-1                      08790079
088000                                          TO TRUE                 08800079
088100                 MOVE DP015-REVERSE       TO ASTRTITH             08810079
088200                 MOVE DP015-RED           TO ASTRTITC             08820079
088300                 MOVE DP015-UNP-NUM-BRT-OFF                       08830079
088400                                          TO ASTRTITA             08840079
088500                 SET DP020-MSG-FATAL      TO TRUE                 08850079
088600                 SET PS-START-ITEM-ERROR TO TRUE                  08860079
088700             END-IF                                               08870079
088800                                                                  08880079
088900         ELSE                                                     08890079
089000*            ---- MUST BE NUMERIC ----                            08900079
089100             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      08910079
089200             MOVE -1                     TO ASTRTITL              08920079
089300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08930079
089400             MOVE DP015-REVERSE          TO ASTRTITH              08940079
089500             MOVE DP015-RED              TO ASTRTITC              08950079
089600             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              08960079
089700             SET DP020-MSG-FATAL         TO TRUE                  08970079
089800             SET PS-START-ITEM-ERROR     TO TRUE                  08980079
089900         END-IF                                                   08990079
090000     END-IF.                                                      09000079
090100                                                                  09010079
090200                                                                  09020079
090300*----------------------------------------------------------------*09030079
090400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09040079
090500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09050079
090600*----------------------------------------------------------------*09060079
090700 2140-DESELECT-ALL-ITEMS.                                         09070079
090800                                                                  09080079
090900     MOVE +1                       TO ASC-BLK-SUB.                09090079
091000                                                                  09100079
091100     PERFORM 2141-CLEAR-SELECTED-INDS                             09110079
091200         VARYING ASC-ITEM-SUB                                     09120079
091300         FROM 1 BY 1                                              09130079
091400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09140079
091500                                                                  09150079
091600     ADD +1                        TO ASC-BLK-SUB.                09160079
091700                                                                  09170079
091800     PERFORM 2141-CLEAR-SELECTED-INDS                             09180079
091900         VARYING ASC-ITEM-SUB                                     09190079
092000         FROM 1 BY 1                                              09200079
092100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09210079
092200                                                                  09220079
092300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09230079
092400                                   TO PV-LIST-ITEM-NUMBER.        09240079
092500                                                                  09250079
092600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09260079
092700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09270079
092800                                                                  09280079
092900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09290079
093000        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09300079
093100         MOVE +1                   TO ASC-BLK-SUB                 09310079
093200                                                                  09320079
093300         PERFORM 5100-WRITE-TEMP-STORAGE                          09330079
093400                                                                  09340079
093500         MOVE +1                   TO PV-BLOCK-NUMBER             09350079
093600                                                                  09360079
093700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09370079
093800             PV-FIRST-BLOCK-IN-ARRAY - 1                          09380079
093900                                                                  09390079
094000         PERFORM                                                  09400079
094100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09410079
094200                                                                  09420079
094300             PERFORM 4410-READ-TEMP-STORAGE                       09430079
094400                                                                  09440079
094500             PERFORM 2141-CLEAR-SELECTED-INDS                     09450079
094600                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09460079
094700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09470079
094800                                                                  09480079
094900             PERFORM 5100-WRITE-TEMP-STORAGE                      09490079
095000                                                                  09500079
095100             ADD +1                TO PV-BLOCK-NUMBER             09510079
095200                                                                  09520079
095300         END-PERFORM                                              09530079
095400                                                                  09540079
095500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09550079
095600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09560079
095700                                                                  09570079
095800         PERFORM                                                  09580079
095900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09590079
096000                   ASC-HIGHEST-BLOCK-WRITTEN                      09600079
096100                                                                  09610079
096200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09620079
096300                                   TO PV-BLOCK-NUMBER             09630079
096400                                                                  09640079
096500             PERFORM 4410-READ-TEMP-STORAGE                       09650079
096600                                                                  09660079
096700             PERFORM 2141-CLEAR-SELECTED-INDS                     09670079
096800                 VARYING ASC-ITEM-SUB                             09680079
096900                 FROM 1 BY 1                                      09690079
097000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09700079
097100                                                                  09710079
097200             PERFORM 5100-WRITE-TEMP-STORAGE                      09720079
097300                                                                  09730079
097400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09740079
097500                                                                  09750079
097600         END-PERFORM                                              09760079
097700                                                                  09770079
097800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09780079
097900                                   TO PV-BLOCK-NUMBER             09790079
098000                                                                  09800079
098100         PERFORM 4410-READ-TEMP-STORAGE                           09810079
098200     END-IF.                                                      09820079
098300                                                                  09830079
098400     MOVE +0   TO ASC-NUMBER-OF-SELECTED-ITEMS.                   09840079
098500     MOVE +0   TO ASC-START-OF-SELECTED-RANGE.                    09850079
098600     MOVE +0   TO ASC-END-OF-SELECTED-RANGE.                      09860079
098700                                                                  09870079
098800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09880079
098900                                                                  09890079
099000                                                                  09900079
099100*----------------------------------------------------------------*09910079
099200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09920079
099300*----------------------------------------------------------------*09930079
099400 2141-CLEAR-SELECTED-INDS.                                        09940079
099500                                                                  09950079
099600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO09960079
099700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09970079
099800         OR  NOT ASC-TEMP-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)     09980079
099900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09990079
100000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10000079
100100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10010079
100200                                   TO TRUE                        10020079
100300         END-IF                                                   10030079
100400     END-IF.                                                      10040079
100500                                                                  10050079
100600                                                                  10060079
100700*----------------------------------------------------------------*10070079
100800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *10080079
100900*  FOR ALL ITEMS.                                                *10090079
101000*----------------------------------------------------------------*10100079
101100 2150-SELECT-ALL-ITEMS.                                           10110079
101200                                                                  10120079
101300     MOVE +1                        TO ASC-BLK-SUB.               10130079
101400                                                                  10140079
101500     PERFORM 2151-SET-SELECTED-INDS                               10150079
101600         VARYING ASC-ITEM-SUB                                     10160079
101700         FROM 1 BY 1                                              10170079
101800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10180079
101900                                                                  10190079
102000     ADD +1                         TO ASC-BLK-SUB.               10200079
102100                                                                  10210079
102200     PERFORM 2151-SET-SELECTED-INDS                               10220079
102300         VARYING ASC-ITEM-SUB                                     10230079
102400         FROM 1 BY 1                                              10240079
102500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10250079
102600                                                                  10260079
102700     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       10270079
102800                                                                  10280079
102900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10290079
103000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10300079
103100                                                                  10310079
103200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10320079
103300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10330079
103400         MOVE +1                    TO ASC-BLK-SUB                10340079
103500                                                                  10350079
103600         PERFORM 5100-WRITE-TEMP-STORAGE                          10360079
103700                                                                  10370079
103800         MOVE +1                    TO PV-BLOCK-NUMBER            10380079
103900                                                                  10390079
104000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10400079
104100             PV-FIRST-BLOCK-IN-ARRAY - 1                          10410079
104200                                                                  10420079
104300         PERFORM                                                  10430079
104400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10440079
104500                                                                  10450079
104600             PERFORM 4410-READ-TEMP-STORAGE                       10460079
104700                                                                  10470079
104800             PERFORM 2151-SET-SELECTED-INDS                       10480079
104900                 VARYING ASC-ITEM-SUB                             10490079
105000                 FROM 1 BY 1                                      10500079
105100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10510079
105200                                                                  10520079
105300             PERFORM 5100-WRITE-TEMP-STORAGE                      10530079
105400                                                                  10540079
105500             ADD +1                 TO PV-BLOCK-NUMBER            10550079
105600                                                                  10560079
105700         END-PERFORM                                              10570079
105800                                                                  10580079
105900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10590079
106000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10600079
106100                                                                  10610079
106200         PERFORM                                                  10620079
106300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10630079
106400                   ASC-HIGHEST-BLOCK-WRITTEN                      10640079
106500                                                                  10650079
106600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10660079
106700                                   TO PV-BLOCK-NUMBER             10670079
106800                                                                  10680079
106900             PERFORM 4410-READ-TEMP-STORAGE                       10690079
107000                                                                  10700079
107100             PERFORM 2151-SET-SELECTED-INDS                       10710079
107200                 VARYING ASC-ITEM-SUB                             10720079
107300                 FROM 1 BY 1                                      10730079
107400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10740079
107500                                                                  10750079
107600             PERFORM 5100-WRITE-TEMP-STORAGE                      10760079
107700                                                                  10770079
107800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10780079
107900                                                                  10790079
108000         END-PERFORM                                              10800079
108100                                                                  10810079
108200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10820079
108300                                   TO PV-BLOCK-NUMBER             10830079
108400                                                                  10840079
108500         PERFORM 4410-READ-TEMP-STORAGE                           10850079
108600     END-IF.                                                      10860079
108700                                                                  10870079
108800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10880079
108900                       ASC-NUMBER-OF-SELECTED-ITEMS.              10890079
109000     IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                       10900079
109100         SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            10910079
109200     END-IF.                                                      10920079
109300                                                                  10930079
109400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10940079
109500                                                                  10950079
109600                                                                  10960079
109700*----------------------------------------------------------------*10970079
109800*    MARK EACH ITEM AS BEING SELECTED.                           *10980079
109900*----------------------------------------------------------------*10990079
110000 2151-SET-SELECTED-INDS.                                          11000079
110100                                                                  11010079
110200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO11020079
110300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11030079
110400           AND (NOT ASC-SHEET-NBR-TOT(ASC-BLK-SUB ASC-ITEM-SUB)   11040079
110500                                                    = PC-TOTAL)   11050079
110600             EVALUATE TRUE                                        11060079
110700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11070079
110800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11080079
110900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11090079
111000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11100079
111100             END-EVALUATE                                         11110079
111200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11120079
111300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11130079
111400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11140079
111500                               TO  TRUE                           11150079
111600         END-IF                                                   11160079
111700     END-IF.                                                      11170079
111800                                                                  11180079
111900                                                                  11190079
112000*----------------------------------------------------------------*11200079
112100* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       11210079
112200* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    11220079
112300*----------------------------------------------------------------*11230079
112400 2200-MOVE-SCREEN-TO-COMMAREA.                                    11240079
112500                                                                  11250079
112600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11260079
112700     MOVE +1                       TO PV-SUB.                     11270079
112800                                                                  11280079
112900     PERFORM 3100-SET-SUBSCRIPTS.                                 11290079
113000     IF  ASTRTITL > ZERO                                          11300079
113100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11310079
113200     ELSE                                                         11320079
113300         IF ASTRTITF = DP015-ERASE-EOF                            11330079
113400             MOVE SPACE TO ASC-START-ITEM-REQUEST                 11340079
113500         END-IF.                                                  11350079
113600                                                                  11360079
113700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11370079
113800         VARYING PV-SUB                                           11380079
113900         FROM 1 BY 1                                              11390079
114000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11400079
114100                                                                  11410079
114200                                                                  11420079
114300*----------------------------------------------------------------*11430079
114400* MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA.  11440079
114500*----------------------------------------------------------------*11450079
114600 2210-MOVE-LINES-TO-COMMAREA.                                     11460079
114700                                                                  11470079
114800     IF MR-SELECTL (PV-SUB) > ZERO                                11480079
114900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11490079
115000         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        11500079
115100                                     (ASC-BLK-SUB, ASC-ITEM-SUB)  11510079
115200     ELSE                                                         11520079
115300         IF MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                 11530079
115400             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         11540079
115500             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        11550079
115600                                     (ASC-BLK-SUB, ASC-ITEM-SUB)  11560079
115700         END-IF                                                   11570079
115800     END-IF.                                                      11580079
115900                                                                  11590079
116000     ADD +1                        TO ASC-ITEM-SUB.               11600079
116100                                                                  11610079
116200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11620079
116300         ADD +1                    TO ASC-BLK-SUB                 11630079
116400         MOVE +1                   TO ASC-ITEM-SUB                11640079
116500     END-IF.                                                      11650079
116600                                                                  11660079
116700                                                                  11670079
116800*----------------------------------------------------------------*11680079
116900* EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE         11690079
117000* COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).    11700079
117100*----------------------------------------------------------------*11710079
117200 3000-EDIT-DATA-IN-COMMAREA.                                      11720079
117300                                                                  11730079
117400     SET PS-NO-ERROR               TO TRUE.                       11740079
117500     PERFORM 3200-RESET-ATTRIBUTES.                               11750079
117600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11760079
117700                                                                  11770079
117800*    CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.           11780079
117900*    EDITING IS DONE FROM THE BOTTOM UP.                          11790079
118000                                                                  11800079
118100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11810079
118200         ASC-ITEMS-DISPLAYED - 1.                                 11820079
118300     PERFORM 3100-SET-SUBSCRIPTS.                                 11830079
118400     PERFORM 3300-EDIT-SELECTIONS VARYING PV-SUB FROM PV-SUB BY -111840079
118500       UNTIL PV-SUB < +1.                                         11850079
118600                                                                  11860079
118700     IF PS-NO-ERROR                                               11870079
118800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11880079
118900     END-IF.                                                      11890079
119000                                                                  11900079
119100     IF  ((PS-NO-ERROR)                                           11910079
119200     AND (ASC-START-OF-SELECTED-RANGE > ZERO)                     11920079
119300     AND (ASC-END-OF-SELECTED-RANGE > ZERO))                      11930079
119400         PERFORM 3500-MARK-RANGE-AS-SELECTED                      11940079
119500     END-IF.                                                      11950079
119600                                                                  11960079
119700                                                                  11970079
119800*----------------------------------------------------------------*11980079
119900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  11990079
120000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL 12000079
120100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   12010079
120200*                                                                 12020079
120300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS    12030079
120400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT     12040079
120500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION   12050079
120600*    US IN THE 2ND BLOCK OF THE ARRAY.                            12060079
120700*----------------------------------------------------------------*12070079
120800 3100-SET-SUBSCRIPTS.                                             12080079
120900                                                                  12090079
121000     COMPUTE ASC-ITEM-SUB =                                       12100079
121100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12110079
121200                                                                  12120079
121300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12130079
121400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12140079
121500                                                                  12150079
121600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12160079
121700     ELSE                                                         12170079
121800         MOVE +1                     TO ASC-BLK-SUB               12180079
121900     END-IF.                                                      12190079
122000                                                                  12200079
122100                                                                  12210079
122200*----------------------------------------------------------------*12220079
122300*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.       12230079
122400*----------------------------------------------------------------*12240079
122500 3200-RESET-ATTRIBUTES.                                           12250079
122600                                                                  12260079
122700     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   12270079
122800     MOVE DP015-GREEN              TO ASTRTITC.                   12280079
122900     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12290079
123000                                                                  12300079
123100     PERFORM                                                      12310079
123200         VARYING PV-SUB                                           12320079
123300         FROM 1 BY 1                                              12330079
123400         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12340079
123500         MOVE DP015-UNP-ALP-NOR-OFF                               12350079
123600                                   TO MR-SELECTA (PV-SUB)         12360079
123700         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         12370079
123800         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         12380079
123900     END-PERFORM.                                                 12390079
124000                                                                  12400079
124100                                                                  12410079
124200*----------------------------------------------------------------*12420079
124300* EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS       12430079
124400* WHAT WAS PREVIOUSLY CHECKED AND CORRECT.   'TEMP-SELECTED-SW'   12440079
124500* IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITED, OR       12450079
124600* WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.                12460079
124700*----------------------------------------------------------------*12470079
124800 3300-EDIT-SELECTIONS.                                            12480079
124900                                                                  12490079
125000     EVALUATE TRUE                                                12500079
125100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12510079
125200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12520079
125300                 CONTINUE                                         12530079
125400         WHEN ASC-TEMP-SELECT   (ASC-BLK-SUB ASC-ITEM-SUB)        12540079
125500             EVALUATE TRUE                                        12550079
125600                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12560079
125700                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12570079
125800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12580079
125900                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12590079
126000             END-EVALUATE                                         12600079
126100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12610079
126200                 ADD +1    TO ASC-NUMBER-OF-SELECTED-ITEMS        12620079
126300                 MOVE ASC-TEMP-SELECTED-SW                        12630079
126400                                (ASC-BLK-SUB ASC-ITEM-SUB)        12640079
126500                           TO ASC-SELECTED-SW                     12650079
126600                                (ASC-BLK-SUB ASC-ITEM-SUB)        12660079
126700             END-IF                                               12670079
126800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12680079
126900                 = SPACE                                          12690079
127000             EVALUATE TRUE                                        12700079
127100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12710079
127200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12720079
127300                     MOVE SPACE TO ASC-SELECTED-SW                12730079
127400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12740079
127500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12750079
127600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12760079
127700                     MOVE SPACE TO ASC-SELECTED-SW                12770079
127800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12780079
127900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12790079
128000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12800079
128100                     MOVE SPACE TO ASC-SELECTED-SW                12810079
128200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12820079
128300             END-EVALUATE                                         12830079
128400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12840079
128500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12850079
128600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12860079
128700             END-IF                                               12870079
128800             PERFORM 3310-EDIT-RANGE                              12880079
128900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12890079
129000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12900079
129100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12910079
129200             END-IF                                               12920079
129300             PERFORM 3310-EDIT-RANGE                              12930079
129400         WHEN OTHER                                               12940079
129500*            ---- INVALID VALUE ----                              12950079
129600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12960079
129700             SET DP020-MSG-FATAL    TO TRUE                       12970079
129800             MOVE -1                TO MR-SELECTL (PV-SUB)        12980079
129900             SET DP030-SET-CURSOR-APPL-1                          12990079
130000                                    TO TRUE                       13000079
130100             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13010079
130200             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13020079
130300             SET PS-ERROR TO TRUE                                 13030079
130400             EVALUATE TRUE                                        13040079
130500                 WHEN  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)      13050079
130600                     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS 13060079
130700                     MOVE SPACE TO ASC-SELECTED-SW                13070079
130800                                  (ASC-BLK-SUB ASC-ITEM-SUB)      13080079
130900                 WHEN ASC-BEGIN   (ASC-BLK-SUB ASC-ITEM-SUB)      13090079
131000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13100079
131100                 WHEN ASC-END     (ASC-BLK-SUB ASC-ITEM-SUB)      13110079
131200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13120079
131300             END-EVALUATE                                         13130079
131400     END-EVALUATE.                                                13140079
131500                                                                  13150079
131600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13160079
131700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13170079
131800     IF  ASC-ITEM-SUB < 1                                         13180079
131900         SUBTRACT +1 FROM ASC-BLK-SUB                             13190079
132000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13200079
132100     END-IF.                                                      13210079
132200                                                                  13220079
132300                                                                  13230079
132400*----------------------------------------------------------------*13240079
132500* IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A         13250079
132600* RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1       13260079
132700* ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)   13270079
132800* THE ENDING.                                                     13280079
132900*----------------------------------------------------------------*13290079
133000 3310-EDIT-RANGE.                                                 13300079
133100                                                                  13310079
133200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13320079
133300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13330079
133400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13340079
133500                                   TO ASC-SELECTED-SW             13350079
133600                                        (ASC-BLK-SUB ASC-ITEM-SUB)13360079
133700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13370079
133800         ELSE                                                     13380079
133900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13390079
134000                 CONTINUE                                         13400079
134100             ELSE                                                 13410079
134200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13420079
134300                 MOVE PC-TSYMSG-00054                             13430079
134400                                   TO DP020-MSG-NUMBER            13440079
134500                 SET DP020-MSG-FATAL                              13450079
134600                                   TO TRUE                        13460079
134700                 MOVE -1           TO MR-SELECTL (PV-SUB)         13470079
134800                 SET DP030-SET-CURSOR-APPL-1                      13480079
134900                                   TO TRUE                        13490079
135000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13500079
135100                 MOVE DP015-UNDERLINE                             13510079
135200                                   TO MR-SELECTH (PV-SUB)         13520079
135300                 SET PS-ERROR      TO TRUE                        13530079
135400             END-IF                                               13540079
135500         END-IF                                                   13550079
135600     ELSE                                                         13560079
135700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13570079
135800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13580079
135900                                   TO ASC-SELECTED-SW             13590079
136000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13600079
136100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13610079
136200         ELSE                                                     13620079
136300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13630079
136400                 CONTINUE                                         13640079
136500             ELSE                                                 13650079
136600*                -- ONLY ONE END-OF-RANGE ALLOWED --              13660079
136700                 MOVE PC-TSYMSG-00055      TO DP020-MSG-NUMBER    13670079
136800                 SET DP020-MSG-FATAL       TO TRUE                13680079
136900                 MOVE -1                   TO MR-SELECTL (PV-SUB) 13690079
137000                 SET DP030-SET-CURSOR-APPL-1                      13700079
137100                                           TO TRUE                13710079
137200                 SET PS-ERROR              TO TRUE                13720079
137300             END-IF                                               13730079
137400         END-IF                                                   13740079
137500     END-IF.                                                      13750079
137600                                                                  13760079
137700                                                                  13770079
137800*----------------------------------------------------------------*13780079
137900* IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,       13790079
138000* MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.     13800079
138100*----------------------------------------------------------------*13810079
138200 3400-CHECK-RANGE-SEQUENCE.                                       13820079
138300                                                                  13830079
138400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13840079
138500     AND ASC-END-OF-SELECTED-RANGE   > ZERO                       13850079
138600     AND ASC-START-OF-SELECTED-RANGE > ASC-END-OF-SELECTED-RANGE  13860079
138700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13870079
138800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13880079
138900         SET DP020-MSG-FATAL  TO TRUE                             13890079
139000         SET PS-ERROR         TO TRUE                             13900079
139100         PERFORM 3410-POSITION-AT-ERROR                           13910079
139200     ELSE                                                         13920079
139300         MOVE -1 TO MR-SELECTL (1)                                13930079
139400     END-IF.                                                      13940079
139500                                                                  13950079
139600     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       13960079
139700                                                                  13970079
139800                                                                  13980079
139900*----------------------------------------------------------------*13990079
140000* BECAUSE RANGES CAN SPAN MULTIPLE PAGES, A SEPARATE PARAGRAPH    14000079
140100* (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR SHOULD BE    14010079
140200* POSITIONED ON A RANGE ERROR.                                    14020079
140300*----------------------------------------------------------------*14030079
140400 3410-POSITION-AT-ERROR.                                          14040079
140500                                                                  14050079
140600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14060079
140700                    - PV-TOP-ITEM + 1.                            14070079
140800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14080079
140900         CONTINUE                                                 14090079
141000     ELSE                                                         14100079
141100         MOVE -1                   TO MR-SELECTL (PV-SUB)         14110079
141200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14120079
141300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14130079
141400     END-IF.                                                      14140079
141500                                                                  14150079
141600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14160079
141700                    - PV-TOP-ITEM + 1.                            14170079
141800                                                                  14180079
141900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14190079
142000         CONTINUE                                                 14200079
142100     ELSE                                                         14210079
142200         MOVE -1                   TO MR-SELECTL (PV-SUB)         14220079
142300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14230079
142400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14240079
142500     END-IF.                                                      14250079
142600                                                                  14260079
142700                                                                  14270079
142800*----------------------------------------------------------------*14280079
142900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14290079
143000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14300079
143100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14310079
143200*----------------------------------------------------------------*14320079
143300 3500-MARK-RANGE-AS-SELECTED.                                     14330079
143400                                                                  14340079
143500     MOVE +1 TO  ASC-BLK-SUB.                                     14350079
143600     PERFORM 3510-MARK-SELECTED-INDS                              14360079
143700     VARYING ASC-ITEM-SUB FROM 1 BY 1                             14370079
143800       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                   14380079
143900                                                                  14390079
144000     ADD +1  TO ASC-BLK-SUB.                                      14400079
144100     PERFORM 3510-MARK-SELECTED-INDS                              14410079
144200     VARYING ASC-ITEM-SUB FROM 1 BY 1                             14420079
144300       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                   14430079
144400                                                                  14440079
144500     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO  PV-LIST-ITEM-NUMBER.      14450079
144600                                                                  14460079
144700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14470079
144800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14480079
144900               PC-ITEMS-PER-PANEL).                               14490079
145000                                                                  14500079
145100     MOVE ASC-START-OF-SELECTED-RANGE                             14510079
145200                                   TO PV-START-OF-SELECTED-RANGE. 14520079
145300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14530079
145400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14540079
145500               PC-ITEMS-PER-PANEL).                               14550079
145600                                                                  14560079
145700     MOVE ASC-END-OF-SELECTED-RANGE                               14570079
145800                                   TO  PV-END-OF-SELECTED-RANGE.  14580079
145900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14590079
146000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14600079
146100               PC-ITEMS-PER-PANEL).                               14610079
146200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14620079
146300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14630079
146400                                                                  14640079
146500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14650079
146600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14660079
146700         MOVE +1                   TO ASC-BLK-SUB                 14670079
146800         PERFORM 5100-WRITE-TEMP-STORAGE                          14680079
146900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14690079
147000             PV-FIRST-BLOCK-IN-ARRAY - 1                          14700079
147100                                                                  14710079
147200         PERFORM                                                  14720079
147300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14730079
147400                   PV-PREV-BLOCK-IN-ARRAY                         14740079
147500             MOVE PV-FIRST-BLOCK-IN-RANGE                         14750079
147600                                   TO PV-BLOCK-NUMBER             14760079
147700             PERFORM 4410-READ-TEMP-STORAGE                       14770079
147800             PERFORM 3510-MARK-SELECTED-INDS                      14780079
147900                 VARYING ASC-ITEM-SUB                             14790079
148000                 FROM 1 BY 1                                      14800079
148100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14810079
148200             PERFORM 5100-WRITE-TEMP-STORAGE                      14820079
148300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14830079
148400         END-PERFORM                                              14840079
148500                                                                  14850079
148600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14860079
148700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14870079
148800         PERFORM                                                  14880079
148900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14890079
149000                   PV-LAST-BLOCK-IN-RANGE                         14900079
149100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14910079
149200                                   TO PV-BLOCK-NUMBER             14920079
149300             PERFORM 4410-READ-TEMP-STORAGE                       14930079
149400             PERFORM 3510-MARK-SELECTED-INDS                      14940079
149500                 VARYING ASC-ITEM-SUB                             14950079
149600                 FROM 1 BY 1                                      14960079
149700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14970079
149800             PERFORM 5100-WRITE-TEMP-STORAGE                      14980079
149900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14990079
150000         END-PERFORM                                              15000079
150100                                                                  15010079
150200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15020079
150300                                   TO PV-BLOCK-NUMBER             15030079
150400         PERFORM 4410-READ-TEMP-STORAGE                           15040079
150500     END-IF.                                                      15050079
150600                                                                  15060079
150700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15070079
150800                                      ASC-END-OF-SELECTED-RANGE.  15080079
150900                                                                  15090079
151000                                                                  15100079
151100*----------------------------------------------------------------*15110079
151200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15120079
151300*----------------------------------------------------------------*15130079
151400 3510-MARK-SELECTED-INDS.                                         15140079
151500                                                                  15150079
151600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15160079
151700                                ASC-ITEM-SUB) >                   15170079
151800         ASC-START-OF-SELECTED-RANGE)                             15180079
151900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15190079
152000                                ASC-ITEM-SUB) =                   15200079
152100         ASC-START-OF-SELECTED-RANGE)                             15210079
152200                                                                  15220079
152300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15230079
152400                                    ASC-ITEM-SUB) <               15240079
152500             ASC-END-OF-SELECTED-RANGE)                           15250079
152600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15260079
152700                                    ASC-ITEM-SUB) =               15270079
152800             ASC-END-OF-SELECTED-RANGE)                           15280079
152900                                                                  15290079
153000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15300079
153100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15310079
153200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15320079
153300                               TO TRUE                            15330079
153400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15340079
153500                               TO TRUE                            15350079
153600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15360079
153700             END-IF                                               15370079
153800         END-IF                                                   15380079
153900     END-IF.                                                      15390079
154000                                                                  15400079
154100                                                                  15410079
154200*----------------------------------------------------------------*15420079
154300* INITIALIZE BOTH BLOCKS IN THE ARRAY.  INITIALIZE ALL COUNTERS   15430079
154400* AND FLAGS.  READ THE DATABASE FOR THE 1ST TIME AND FILL THE     15440079
154500* ARRAY.  DISPLAY THE PANEL TO THE USER.                          15450079
154600*----------------------------------------------------------------*15460079
154700 4000-BUILD-INITIAL-PANEL.                                        15470079
154800                                                                  15480079
154900     INITIALIZE  ASC-BLOCK-ENTRIES (1)                            15490079
155000                 ASC-BLOCK-ENTRIES (2).                           15500079
155100     MOVE +1  TO ASC-BLK-SUB.                                     15510079
155200     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           15520079
155300                                                                  15530079
155400     MOVE +0 TO ASC-ITEM-SUB                                      15540079
155500                ASC-NUMBER-OF-ITEMS-READ                          15550079
155600                ASC-NUMBER-OF-SELECTED-ITEMS                      15560079
155700                ASC-HIGHEST-BLOCK-WRITTEN                         15570079
155800                ASC-START-OF-SELECTED-RANGE                       15580079
155900                ASC-END-OF-SELECTED-RANGE                         15590079
156000                ASC-ITEM-AT-TOP-OF-PANEL.                         15600079
156100                                                                  15610079
156200     MOVE ASC-KEY-STR-NBR      TO PV-DB2-STR-NBR.                 15620079
156300                                                                  15630079
156400     IF ASC-KEY-SHEET-NBR = ZERO                                  15640079
156500       IF ASC-TYPE-ALL-SHEETS                                     15650079
156600         SET ASC-STR-NBR-CSR2   TO TRUE                           15660079
156700       ELSE                                                       15670079
156800         SET ASC-STR-NBR-CSR    TO TRUE                           15680079
156900       END-IF                                                     15690079
157000     ELSE                                                         15700079
157100       MOVE ASC-KEY-SHEET-NBR TO PV-DB2-SHEET-NBR                 15710079
157200       IF ASC-TYPE-ALL-SHEETS                                     15720079
157300         SET ASC-SHEET-NBR-CSR2 TO TRUE                           15730079
157400       ELSE                                                       15740079
157500         SET ASC-SHEET-NBR-CSR  TO TRUE                           15750079
157600       END-IF                                                     15760079
157700     END-IF.                                                      15770079
157800                                                                  15780079
157900     MOVE SPACES                TO PV-DB2-TYPE-CDE.               15790079
158000     IF ASC-TYPE-TFR-SHEETS                                       15800079
158100         STRING 'T' DELIMITED BY SIZE                             15810079
158200                                INTO PV-DB2-TYPE-CDE              15820079
158300     ELSE                                                         15830079
158400     IF ASC-TYPE-MANI-SHEETS                                      15840079
158500         STRING 'M' DELIMITED BY SIZE                             15850079
158600                                INTO PV-DB2-TYPE-CDE              15860079
158700     ELSE                                                         15870079
158800     IF ASC-TYPE-ENTRD-SHEETS                                     15880079
158900         STRING 'K' DELIMITED BY SIZE                             15890079
159000                                INTO PV-DB2-TYPE-CDE              15900079
159100     END-IF.                                                      15910079
159200                                                                  15920079
159300     PERFORM 4010-OPEN-CURSOR.                                    15930079
159400                                                                  15940079
159500     IF SQLCODE = ZERO                                            15950079
159600         PERFORM 4300-READ-ITEMS-FROM-DB                          15960079
159700                                                                  15970079
159800         PERFORM 4020-CLOSE-CURSOR                                15980079
159900                                                                  15990079
160000         MOVE +1                   TO  PV-TOP-ITEM                16000079
160100         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      16010079
160200             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                16020079
160300             SET DP020-MSG-FATAL   TO  TRUE                       16030079
160400*            ---- NO LIST ITEMS FOUND FOR CRITERIA ----           16040079
160500             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           16050079
160600         ELSE                                                     16060079
160700             MOVE -1               TO MR-SELECTL (1)              16070079
160800             SET DP030-SET-CURSOR-APPL-1                          16080079
160900                                   TO TRUE                        16090079
161000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16100079
161100         END-IF                                                   16110079
161200     ELSE                                                         16120079
161300         SET  DP020-NEXT-ACT-APPL-ERROR                           16130079
161400              DP020-MSG-WARNING         TO TRUE                   16140079
161500*        ---- WAIT 15 SECONDS, THEN RETRY ----                    16150079
161600         MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER               16160079
161700     END-IF.                                                      16170079
161800                                                                  16180079
161900                                                                  16190079
162000*----------------------------------------------------------------*16200079
162100* OPEN THE SHEET INVENTORY CURSOR.  ONE OF TWO DIFFERENT CURSORS  16210079
162200* WILL BE OPENED, DEPENDING UPON THE CRITERIA SPECIFIED BY THE    16220079
162300* USER.                                                           16230079
162400*----------------------------------------------------------------*16240079
162500 4010-OPEN-CURSOR.                                                16250079
162600                                                                  16260079
162700     EVALUATE TRUE                                                16270079
162800         WHEN ASC-STR-NBR-CSR                                     16280079
162900             MOVE 'CURSOR: STR-NBR-CSR'   TO DP013-MESSAGE-TEXT(2)16290079
163000             EXEC SQL                                             16300079
163100                  OPEN STR-NBR-CSR                                16310079
163200             END-EXEC                                             16320079
163300                                                                  16330079
163400         WHEN ASC-SHEET-NBR-CSR                                   16340079
163500             MOVE 'CURSOR: SHEET-NBR-CSR' TO DP013-MESSAGE-TEXT(2)16350079
163600             EXEC SQL                                             16360079
163700                  OPEN SHEET-NBR-CSR                              16370079
163800             END-EXEC                                             16380079
163900                                                                  16390079
164000         WHEN ASC-STR-NBR-CSR2                                    16400079
164100             MOVE 'CURSOR: STR-NBR-CSR2' TO DP013-MESSAGE-TEXT(2) 16410079
164200             EXEC SQL                                             16420079
164300                  OPEN STR-NBR-CSR2                               16430079
164400             END-EXEC                                             16440079
164500                                                                  16450079
164600         WHEN ASC-SHEET-NBR-CSR2                                  16460079
164700             MOVE 'CURSOR: SHEET-NBR-CSR2'                        16470079
164800                                          TO DP013-MESSAGE-TEXT(2)16480079
164900             EXEC SQL                                             16490079
165000                  OPEN SHEET-NBR-CSR2                             16500079
165100             END-EXEC                                             16510079
165200                                                                  16520079
165300     END-EVALUATE.                                                16530079
165400                                                                  16540079
165500     EVALUATE TRUE                                                16550079
165600         WHEN SQLCODE = ZERO                                      16560079
165700         WHEN SQLCODE = -904                                      16570079
165800         WHEN SQLCODE = -913                                      16580079
165900             CONTINUE                                             16590079
166000         WHEN SQLWARN0 NOT = SPACES                               16600079
166100         WHEN SQLCODE  NOT = ZERO                                 16610079
166200             MOVE '4010-OPEN-CURSOR'                              16620079
166300                               TO DP013-PARAGRAPH                 16630079
166400             MOVE 'OPEN SHEET INVENTORY CURSOR - '                16640079
166500                               TO DP013-MESSAGE-TEXT (1)          16650079
166600             MOVE SQLCA        TO DP013-SQLCA                     16660079
166700             MOVE 'TINENTY '   TO DP013-DB2-TABLE-NAME (1)        16670079
166800             SET DP013-DB2-ABEND                                  16680079
166900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16690079
167000             PERFORM DP013-0000-PROCESS-ABEND                     16700079
167100     END-EVALUATE.                                                16710079
167200                                                                  16720079
167300                                                                  16730079
167400*----------------------------------------------------------------*16740079
167500* CLOSE THE SHEET INVENTORY CURSOR.  ONE OF TWO DIFFERENT CURSORS 16750079
167600* WILL BE CLOSED DEPENDING UPON THE CRITERIA SPECIFIED BY THE     16760079
167700* USER.                                                           16770079
167800*----------------------------------------------------------------*16780079
167900 4020-CLOSE-CURSOR.                                               16790079
168000                                                                  16800079
168100     EVALUATE TRUE                                                16810079
168200         WHEN ASC-STR-NBR-CSR                                     16820079
168300             MOVE 'CURSOR: STR-NBR-CSR'   TO DP013-MESSAGE-TEXT(2)16830079
168400             EXEC SQL                                             16840079
168500                 CLOSE STR-NBR-CSR                                16850079
168600             END-EXEC                                             16860079
168700                                                                  16870079
168800         WHEN ASC-SHEET-NBR-CSR                                   16880079
168900             MOVE 'CURSOR: SHEET-NBR-CSR' TO DP013-MESSAGE-TEXT(2)16890079
169000             EXEC SQL                                             16900079
169100                 CLOSE SHEET-NBR-CSR                              16910079
169200             END-EXEC                                             16920079
169300                                                                  16930079
169400         WHEN ASC-STR-NBR-CSR2                                    16940079
169500             MOVE 'CURSOR: STR-NBR-CSR2'  TO DP013-MESSAGE-TEXT(2)16950079
169600             EXEC SQL                                             16960079
169700                 CLOSE STR-NBR-CSR2                               16970079
169800             END-EXEC                                             16980079
169900                                                                  16990079
170000         WHEN ASC-SHEET-NBR-CSR2                                  17000079
170100             MOVE 'CURSOR: SHEET-NBR-CSR2'                        17010079
170200                                          TO DP013-MESSAGE-TEXT(2)17020079
170300             EXEC SQL                                             17030079
170400                 CLOSE SHEET-NBR-CSR2                             17040079
170500             END-EXEC                                             17050079
170600                                                                  17060079
170700     END-EVALUATE.                                                17070079
170800                                                                  17080079
170900     EVALUATE TRUE                                                17090079
171000         WHEN SQLCODE = ZERO                                      17100079
171100             CONTINUE                                             17110079
171200         WHEN SQLWARN0 NOT = SPACES                               17120079
171300         WHEN SQLCODE  NOT = ZERO                                 17130079
171400             MOVE '4020-CLOSE-CURSOR'   TO DP013-PARAGRAPH        17140079
171500             MOVE 'CLOSE SHEET INVENTORY CURSOR'                  17150079
171600                                        TO DP013-MESSAGE-TEXT(1)  17160079
171700             MOVE SQLCA                 TO DP013-SQLCA            17170079
171800             MOVE 'TINENTY '            TO DP013-DB2-TABLE-NAME(1)17180079
171900             SET DP013-DB2-ABEND                                  17190079
172000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17200079
172100             PERFORM DP013-0000-PROCESS-ABEND                     17210079
172200     END-EVALUATE.                                                17220079
172300                                                                  17230079
172400                                                                  17240079
172500*----------------------------------------------------------------*17250079
172600*  READ THE ITEMS FROM THE DATABASE AND MOVE THEM INTO THE BLOCKS 17260079
172700*  IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE 17270079
172800*  1ST BLOCK TO TEMP STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY TO  17280079
172900*  THE 1ST BLOCK, AND INITIALIZE THE 2ND BLOCK, MAKING IT         17290079
173000*  AVAILABLE TO BE USED.                                          17300079
173100*                                                                 17310079
173200*  DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE ROWS  17320079
173300*  ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM          17330079
173400*  UPON INITIALIZATION.                                           17340079
173500*----------------------------------------------------------------*17350079
173600 4300-READ-ITEMS-FROM-DB.                                         17360079
173700                                                                  17370079
173800     PERFORM                                                      17380079
173900         VARYING PV-READ-COUNT FROM 1 BY 1                        17390079
174000           UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                  17400079
174100              OR (ASC-NO-ITEMS-LEFT-ON-DB))                       17410079
174200                                                                  17420079
174300         PERFORM 4310-FETCH                                       17430079
174400                                                                  17440079
174500*        IF  ASC-ITEMS-LEFT-ON-DB                                 17450079
174600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17460079
174700                 ADD  +1           TO ASC-ITEM-SUB                17470079
174800             ELSE                                                 17480079
174900                 ADD  +1           TO ASC-BLK-SUB                 17490079
175000                 MOVE +1           TO ASC-ITEM-SUB                17500079
175100                                                                  17510079
175200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17520079
175300                     MOVE +1       TO ASC-BLK-SUB                 17530079
175400                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           17540079
175500                     PERFORM 5100-WRITE-TEMP-STORAGE              17550079
175600                     MOVE ASC-BLOCK-ENTRIES                       17560079
175700                                          (PC-MAX-BLOCKS-IN-ARRAY)17570079
175800                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)17580079
175900                     ADD +1      TO ASC-BLK-SUB                   17590079
176000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17600079
176100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17610079
176200                                                           TO TRUE17620079
176300                 END-IF                                           17630079
176400             END-IF                                               17640079
176500         IF  ASC-ITEMS-LEFT-ON-DB                                 17650079
176600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17660079
176700             MOVE ASC-NUMBER-OF-ITEMS-READ                        17670079
176800                TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)17680079
176900             MOVE INENTY-SHEET-NBR                                17690079
177000                TO ASC-SHEET-NBR        (ASC-BLK-SUB ASC-ITEM-SUB)17700079
177100             MOVE INENTY-SHEET-TYP-CDE                            17710079
177200                TO ASC-TYPE-CDE         (ASC-BLK-SUB ASC-ITEM-SUB)17720079
177300             MOVE PV-SUM-UNT-RTL-AMT                              17730079
177400                TO ASC-SUM-UNT-RTL-AMT  (ASC-BLK-SUB ASC-ITEM-SUB)17740079
177500             MOVE INENTY-INV-QTY                                  17750079
177600                TO ASC-SUM-INV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)17760079
177700             MOVE PV-SUM-EXTD-RTL-AMT                             17770079
177800                TO ASC-SUM-EXTD-RTL-AMT (ASC-BLK-SUB ASC-ITEM-SUB)17780079
177900* ADD TOTAL LINE TO END OF LIST ITEMS                             17790079
178000             ADD  PV-SUM-UNT-RTL-AMT    TO PV-UNIT-RTL-TOTAL      17800079
178100             ADD  INENTY-INV-QTY        TO PV-INV-QTY-TOTAL       17810079
178200             ADD  PV-SUM-EXTD-RTL-AMT   TO PV-EXTD-RTL-TOTAL      17820079
178300         ELSE                                                     17830079
178400           IF ASC-NUMBER-OF-ITEMS-READ > ZERO                     17840079
178500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17850079
178600             MOVE ASC-NUMBER-OF-ITEMS-READ                        17860079
178700                TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)17870079
178800             MOVE PC-TOTAL         TO  ASC-SHEET-NBR-TOT          17880079
178900                                        (ASC-BLK-SUB ASC-ITEM-SUB)17890079
179000*            MOVE INENTY-SHEET-NBR                                17900079
179100*               TO ASC-SHEET-NBR        (ASC-BLK-SUB ASC-ITEM-SUB)17910079
179200             MOVE PV-UNIT-RTL-TOTAL                               17920079
179300                TO ASC-SUM-UNT-RTL-AMT  (ASC-BLK-SUB ASC-ITEM-SUB)17930079
179400             MOVE PV-INV-QTY-TOTAL                                17940079
179500                TO ASC-SUM-INV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB)17950079
179600             MOVE PV-EXTD-RTL-TOTAL                               17960079
179700                TO ASC-SUM-EXTD-RTL-AMT (ASC-BLK-SUB ASC-ITEM-SUB)17970079
179800           END-IF                                                 17980079
179900         END-IF                                                   17990079
180000     END-PERFORM.                                                 18000079
180100                                                                  18010079
180200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18020079
180300         MOVE +1 TO ASC-BLK-SUB                                   18030079
180400         PERFORM 5100-WRITE-TEMP-STORAGE                          18040079
180500         ADD  +1 TO ASC-BLK-SUB                                   18050079
180600         PERFORM 5100-WRITE-TEMP-STORAGE                          18060079
180700                                                                  18070079
180800         MOVE 1  TO ASC-BLK-SUB                                   18080079
180900                    PV-BLOCK-NUMBER                               18090079
181000         PERFORM 4410-READ-TEMP-STORAGE                           18100079
181100         IF  ASC-HIGHEST-BLOCK-WRITTEN > 1                        18110079
181200             MOVE 2 TO ASC-BLK-SUB                                18120079
181300                       PV-BLOCK-NUMBER                            18130079
181400             PERFORM 4410-READ-TEMP-STORAGE                       18140079
181500         END-IF                                                   18150079
181600     END-IF.                                                      18160079
181700                                                                  18170079
181800                                                                  18180079
181900*----------------------------------------------------------------*18190079
182000* FETCH FROM THE SHEET INVENTORY CURSOR.                          18200079
182100*----------------------------------------------------------------*18210079
182200 4310-FETCH.                                                      18220079
182300                                                                  18230079
182400     EVALUATE TRUE                                                18240079
182500         WHEN ASC-STR-NBR-CSR                                     18250079
182600              EXEC SQL                                            18260079
182700                   FETCH STR-NBR-CSR                              18270079
182800                   INTO  :INENTY-SHEET-NBR                        18280079
182900                       , :INENTY-SHEET-TYP-CDE                    18290079
183000                       , :PV-SUM-UNT-RTL-AMT                      18300079
183100                       , :INENTY-INV-QTY                          18310079
183200                       , :PV-SUM-EXTD-RTL-AMT                     18320079
183300              END-EXEC                                            18330079
183400                                                                  18340079
183500         WHEN ASC-SHEET-NBR-CSR                                   18350079
183600              EXEC SQL                                            18360079
183700                   FETCH SHEET-NBR-CSR                            18370079
183800                   INTO  :INENTY-SHEET-NBR                        18380079
183900                       , :INENTY-SHEET-TYP-CDE                    18390079
184000                       , :PV-SUM-UNT-RTL-AMT                      18400079
184100                       , :INENTY-INV-QTY                          18410079
184200                       , :PV-SUM-EXTD-RTL-AMT                     18420079
184300              END-EXEC                                            18430079
184400                                                                  18440079
184500         WHEN ASC-STR-NBR-CSR2                                    18450079
184600              EXEC SQL                                            18460079
184700                   FETCH STR-NBR-CSR2                             18470079
184800                   INTO  :INENTY-SHEET-NBR                        18480079
184900                       , :INENTY-SHEET-TYP-CDE                    18490079
185000                       , :PV-SUM-UNT-RTL-AMT                      18500079
185100                       , :INENTY-INV-QTY                          18510079
185200                       , :PV-SUM-EXTD-RTL-AMT                     18520079
185300              END-EXEC                                            18530079
185400                                                                  18540079
185500         WHEN ASC-SHEET-NBR-CSR2                                  18550079
185600              EXEC SQL                                            18560079
185700                   FETCH SHEET-NBR-CSR2                           18570079
185800                   INTO  :INENTY-SHEET-NBR                        18580079
185900                       , :INENTY-SHEET-TYP-CDE                    18590079
186000                       , :PV-SUM-UNT-RTL-AMT                      18600079
186100                       , :INENTY-INV-QTY                          18610079
186200                       , :PV-SUM-EXTD-RTL-AMT                     18620079
186300              END-EXEC                                            18630079
186400     END-EVALUATE.                                                18640079
186500                                                                  18650079
186600     EVALUATE TRUE                                                18660079
186700         WHEN SQLCODE = ZERO                                      18670079
186800             CONTINUE                                             18680079
186900         WHEN SQLCODE = +100                                      18690079
187000             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  18700079
187100         WHEN SQLWARN0 NOT = SPACE                                18710079
187200         WHEN SQLCODE  NOT = ZERO                                 18720079
187300              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         18730079
187400              MOVE 'FETCH STOCKROOM WITHDRAWAL CURSOR'            18740079
187500                                       TO DP013-MESSAGE-TEXT (1)  18750079
187600              MOVE SQLCA               TO DP013-SQLCA             18760079
187700              SET DP013-DB2-ABEND      TO TRUE                    18770079
187800              PERFORM DP013-0000-PROCESS-ABEND                    18780079
187900     END-EVALUATE.                                                18790079
188000                                                                  18800079
188100                                                                  18810079
188200*----------------------------------------------------------------*18820079
188300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18830079
188400*----------------------------------------------------------------*18840079
188500 4400-MOVE-COMMAREA-TO-SCREEN.                                    18850079
188600                                                                  18860079
188700*    MOVE ASC-STORE-NAME TO ASTNAMEO.                             18870079
188800     MOVE IN030-STR-NBR                 TO PV-STR-NBR             18880079
188900     STRING                                                       18890079
189000       PV-STR-NBR SPACE '-' SPACE                                 18900079
189100       ASC-STORE-NAME                                             18910079
189200       DELIMITED BY SIZE INTO ASTNAMEO.                           18920079
189300                                                                  18930079
189400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18940079
189500     AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))              18950079
189600     OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))              18960079
189700         MOVE +1    TO ASC-BLK-SUB                                18970079
189800         PERFORM 5100-WRITE-TEMP-STORAGE                          18980079
189900         ADD +1     TO ASC-BLK-SUB                                18990079
190000         PERFORM 5100-WRITE-TEMP-STORAGE                          19000079
190100         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 19010079
190200             GIVING PV-BLOCK-NUMBER                               19020079
190300             REMAINDER PV-REMAINDER                               19030079
190400         IF  PV-REMAINDER > ZERO                                  19040079
190500             ADD +1 TO PV-BLOCK-NUMBER                            19050079
190600         END-IF                                                   19060079
190700         MOVE +1    TO ASC-BLK-SUB                                19070079
190800         PERFORM 4410-READ-TEMP-STORAGE                           19080079
190900         ADD +1     TO ASC-BLK-SUB                                19090079
191000                       PV-BLOCK-NUMBER                            19100079
191100         PERFORM 4410-READ-TEMP-STORAGE                           19110079
191200     END-IF.                                                      19120079
191300                                                                  19130079
191400     MOVE +1            TO ASC-BLK-SUB.                           19140079
191500     COMPUTE ASC-ITEM-SUB =                                       19150079
191600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19160079
191700         + PC-ITEMS-PER-PANEL).                                   19170079
191800                                                                  19180079
191900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19190079
192000         ADD +1         TO ASC-BLK-SUB                            19200079
192100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19210079
192200     END-IF.                                                      19220079
192300                                                                  19230079
192400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19240079
192500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19250079
192600                                                                  19260079
192700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19270079
192800                                                                  19280079
192900     PERFORM 4420-FORMAT-LIST-LINES                               19290079
193000     VARYING PV-SUB FROM PC-ITEMS-PER-PANEL BY -1                 19300079
193100       UNTIL PV-SUB < +1.                                         19310079
193200                                                                  19320079
193300     COMPUTE ASC-ITEMS-DISPLAYED =                                19330079
193400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19340079
193500     IF PS-NO-START-ITEM-ERROR                                    19350079
193600         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL19360079
193700                                          ASTRTITO                19370079
193800         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  19380079
193900     ELSE                                                         19390079
194000         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                19400079
194100     END-IF.                                                      19410079
194200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19420079
194300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19430079
194400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19440079
194500                                   TO ASELITO.                    19450079
194600                                                                  19460079
194700     IF  DP020-MSG-NUMBER-X = SPACE                               19470079
194800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19480079
194900*            --- MORE ITEMS TO DISPLAY ----                       19490079
195000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19500079
195100             SET DP020-MSG-INFORMATIONAL TO TRUE                  19510079
195200         END-IF                                                   19520079
195300     END-IF.                                                      19530079
195400                                                                  19540079
195500                                                                  19550079
195600*----------------------------------------------------------------*19560079
195700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19570079
195800*----------------------------------------------------------------*19580079
195900 4410-READ-TEMP-STORAGE.                                          19590079
196000                                                                  19600079
196100     EXEC CICS                                                    19610079
196200         READQ TS                                                 19620079
196300             QUEUE (ASC-LIST-QUEUE-NAME)                          19630079
196400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19640079
196500             ITEM  (PV-BLOCK-NUMBER)                              19650079
196600             RESP  (PV-CICS-RESP)                                 19660079
196700     END-EXEC.                                                    19670079
196800                                                                  19680079
196900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19690079
197000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19700079
197100         CONTINUE                                                 19710079
197200     ELSE                                                         19720079
197300         SET DP013-CICS-ABEND     TO TRUE                         19730079
197400         SET DP013-NO-ROLLBACK    TO TRUE                         19740079
197500         MOVE '4410-READ-TEMP-STORAGE'                            19750079
197600                                  TO DP013-PARAGRAPH              19760079
197700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19770079
197800                                  TO DP013-MESSAGE-TEXT(1)        19780079
197900         PERFORM DP013-0000-PROCESS-ABEND                         19790079
198000     END-IF.                                                      19800079
198100                                                                  19810079
198200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19820079
198300                                                                  19830079
198400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19840079
198500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19850079
198600     END-IF.                                                      19860079
198700                                                                  19870079
198800                                                                  19880079
198900*----------------------------------------------------------------*19890079
199000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19900079
199100*----------------------------------------------------------------*19910079
199200 4420-FORMAT-LIST-LINES.                                          19920079
199300                                                                  19930079
199400     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       19940079
199500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19950079
199600         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA            (PV-SUB) 19960079
199700         MOVE SPACE             TO MR-SELECTI            (PV-SUB) 19970079
199800                                   MR-ACTION             (PV-SUB) 19980079
199900                                   MR-SHEET-NBR-X        (PV-SUB) 19990079
200000                                   MR-TYPE-CDE           (PV-SUB) 20000079
200100                                   MR-SUM-UNT-RTL-AMT-X  (PV-SUB) 20010079
200200                                   MR-SUM-INV-QTY-X      (PV-SUB) 20020079
200300                                   MR-SUM-EXTD-RTL-AMT-X (PV-SUB) 20030079
200400     ELSE                                                         20040079
200500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20050079
200600                                                   > SPACE        20060079
200700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20070079
200800                                 TO MR-SELECTI (PV-SUB)           20080079
200900         ELSE                                                     20090079
201000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20100079
201100                                 TO MR-SELECTI (PV-SUB)           20110079
201200         END-IF                                                   20120079
201300                                                                  20130079
201400         IF  DP030-SET-CURSOR-TRAILER                             20140079
201500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20150079
201600                 > SPACE)                                         20160079
201700             OR (PV-SUB = 1))                                     20170079
201800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20180079
201900                MOVE -1          TO MR-SELECTL (PV-SUB)           20190079
202000             END-IF                                               20200079
202100         END-IF                                                   20210079
202200                                                                  20220079
202300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20230079
202400             MOVE ASC-ACTION           (ASC-BLK-SUB ASC-ITEM-SUB) 20240079
202500               TO MR-ACTION            (PV-SUB)                   20250079
202600             MOVE ASC-SHEET-NBR        (ASC-BLK-SUB ASC-ITEM-SUB) 20260079
202700               TO MR-SHEET-NBR         (PV-SUB)                   20270079
202800             MOVE ASC-TYPE-CDE         (ASC-BLK-SUB ASC-ITEM-SUB) 20280079
202900               TO MR-TYPE-CDE          (PV-SUB)                   20290079
203000             MOVE ASC-SUM-UNT-RTL-AMT  (ASC-BLK-SUB ASC-ITEM-SUB) 20300079
203100               TO MR-SUM-UNT-RTL-AMT   (PV-SUB)                   20310079
203200             MOVE ASC-SUM-INV-QTY      (ASC-BLK-SUB ASC-ITEM-SUB) 20320079
203300               TO MR-SUM-INV-QTY       (PV-SUB)                   20330079
203400             MOVE ASC-SUM-EXTD-RTL-AMT (ASC-BLK-SUB ASC-ITEM-SUB) 20340079
203500               TO MR-SUM-EXTD-RTL-AMT  (PV-SUB)                   20350079
203600                                                                  20360079
203700             IF  ASC-SHEET-NBR-X (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL 20370079
203800                 PC-TOTAL                                         20380079
203900                 MOVE ASC-SHEET-NBR-X (ASC-BLK-SUB ASC-ITEM-SUB)  20390079
204000                   TO MR-SHEET-NBR-X   (PV-SUB)                   20400079
204100*            MOVE SPACE      TO  MR-PR-AMT-X      (PV-SUB)        20410079
204200                 MOVE DP015-ASK-DRK-OFF                           20420079
204300                                TO  MR-SELECTA   (PV-SUB)         20430079
204400             END-IF                                               20440079
204500                                                                  20450079
204600         END-IF                                                   20460079
204700     END-IF.                                                      20470079
204800                                                                  20480079
204900                                                                  20490079
205000     SUBTRACT +1 FROM ASC-ITEM-SUB                                20500079
205100     IF  ASC-ITEM-SUB < + 1                                       20510079
205200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20520079
205300         MOVE +1                 TO ASC-BLK-SUB                   20530079
205400     END-IF.                                                      20540079
205500                                                                  20550079
205600                                                                  20560079
205700*----------------------------------------------------------------*20570079
205800* IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF RANGE20580079
205900* WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING, ISSUEA        20590079
206000* WARNING.                                                        20600079
206100*----------------------------------------------------------------*20610079
206200 4430-CHECK-FOR-BEGIN-AND-END.                                    20620079
206300                                                                  20630079
206400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20640079
206500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20650079
206600*            -- NO END-OF-RANGE SPECFIED ---                      20660079
206700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20670079
206800             SET DP020-MSG-WARNING TO TRUE                        20680079
206900             PERFORM 4431-POSITION-AT-WARNING                     20690079
207000         END-IF                                                   20700079
207100     ELSE                                                         20710079
207200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20720079
207300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20730079
207400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20740079
207500             SET DP020-MSG-WARNING TO TRUE                        20750079
207600             PERFORM 4431-POSITION-AT-WARNING                     20760079
207700         END-IF                                                   20770079
207800     END-IF.                                                      20780079
207900                                                                  20790079
208000                                                                  20800079
208100*----------------------------------------------------------------*20810079
208200* ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,     20820079
208300* DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE      20830079
208400* IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND           20840079
208500* POSITION THE CURSOR THERE.                                      20850079
208600*----------------------------------------------------------------*20860079
208700                                                                  20870079
208800 4431-POSITION-AT-WARNING.                                        20880079
208900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20890079
209000                    - PV-TOP-ITEM + 1.                            20900079
209100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20910079
209200         CONTINUE                                                 20920079
209300     ELSE                                                         20930079
209400         SET DP030-SET-CURSOR-APPL-1                              20940079
209500                                   TO TRUE                        20950079
209600         MOVE -1                   TO MR-SELECTL (PV-SUB)         20960079
209700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20970079
209800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20980079
209900     END-IF.                                                      20990079
210000                                                                  21000079
210100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21010079
210200                    - PV-TOP-ITEM + 1.                            21020079
210300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21030079
210400         CONTINUE                                                 21040079
210500     ELSE                                                         21050079
210600         SET DP030-SET-CURSOR-APPL-1                              21060079
210700                                   TO TRUE                        21070079
210800         MOVE -1                   TO MR-SELECTL (PV-SUB)         21080079
210900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21090079
211000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21100079
211100     END-IF.                                                      21110079
211200                                                                  21120079
211300                                                                  21130079
211400*----------------------------------------------------------------*21140079
211500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21150079
211600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21160079
211700* FOR THE SELECTED ITEMS QUEUE.                                  *21170079
211800*                                                                *21180079
211900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21190079
212000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21200079
212100* THE ARRAY IS FULL.                                             *21210079
212200*----------------------------------------------------------------*21220079
212300 5000-PREPARE-SEL-QUEUE.                                          21230079
212400                                                                  21240079
212500     MOVE +1                   TO  ASC-BLK-SUB.                   21250079
212600     PERFORM 5100-WRITE-TEMP-STORAGE.                             21260079
212700     ADD +1                    TO  ASC-BLK-SUB.                   21270079
212800     PERFORM 5100-WRITE-TEMP-STORAGE.                             21280079
212900                                                                  21290079
213000     MOVE ASC-SEL-QUEUE-NAME   TO  IN030-SEL-QUEUE-NAME.          21300079
213100     PERFORM 6010-DELETE-SEL-QUEUE.                               21310079
213200                                                                  21320079
213300     SET ASC-UPDATE-TSQ        TO  TRUE.                          21330079
213400                                                                  21340079
213500     SET IN031-IDX             TO  1.                             21350079
213600     MOVE ZERO                 TO IN030-NUMBER-OF-TS-ITEMS.       21360079
213700     INITIALIZE IN031-SELECTED-ITEM-ARRAY.                        21370079
213800                                                                  21380079
213900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21390079
214000             VARYING PV-ITEM                                      21400079
214100             FROM 1 BY 1                                          21410079
214200             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           21420079
214300                                                                  21430079
214400     IF  IN031-IDX > 1                                            21440079
214500         PERFORM 5205-WRITE-SEL-QUEUE                             21450079
214600         ADD +1                TO IN030-NUMBER-OF-TS-ITEMS        21460079
214700     END-IF.                                                      21470079
214800                                                                  21480079
214900                                                                  21490079
215000*----------------------------------------------------------------*21500079
215100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21510079
215200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21520079
215300*----------------------------------------------------------------*21530079
215400 5100-WRITE-TEMP-STORAGE.                                         21540079
215500                                                                  21550079
215600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21560079
215700                                   TO PV-LIST-ITEM-NUMBER.        21570079
215800     COMPUTE PV-BLOCK-NUMBER =                                    21580079
215900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21590079
216000                                                                  21600079
216100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21610079
216200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21620079
216300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21630079
216400             PERFORM 5105-REWRITE-ASC-LISTQ                       21640079
216500         END-IF                                                   21650079
216600     ELSE                                                         21660079
216700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21670079
216800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21680079
216900         PERFORM 5110-WRITE-ASC-LISTQ                             21690079
217000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21700079
217100     END-IF.                                                      21710079
217200                                                                  21720079
217300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21730079
217400                                                                  21740079
217500                                                                  21750079
217600*----------------------------------------------------------------*21760079
217700* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       21770079
217800* SPECIFIC COMMAREA.                                              21780079
217900*----------------------------------------------------------------*21790079
218000 5105-REWRITE-ASC-LISTQ.                                          21800079
218100     EXEC CICS                                                    21810079
218200         WRITEQ TS                                                21820079
218300             QUEUE (ASC-LIST-QUEUE-NAME)                          21830079
218400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21840079
218500             ITEM  (PV-BLOCK-NUMBER)                              21850079
218600             REWRITE                                              21860079
218700             RESP  (PV-CICS-RESP)                                 21870079
218800     END-EXEC.                                                    21880079
218900                                                                  21890079
219000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           21900079
219100         CONTINUE                                                 21910079
219200     ELSE                                                         21920079
219300         SET DP013-CICS-ABEND            TO TRUE                  21930079
219400         SET DP013-NO-ROLLBACK           TO TRUE                  21940079
219500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       21950079
219600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     21960079
219700                                         TO DP013-MESSAGE-TEXT(1) 21970079
219800         PERFORM DP013-0000-PROCESS-ABEND                         21980079
219900     END-IF.                                                      21990079
220000                                                                  22000079
220100                                                                  22010079
220200*----------------------------------------------------------------*22020079
220300* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-         22030079
220400* SPECIFIC COMMAREA.                                              22040079
220500*----------------------------------------------------------------*22050079
220600 5110-WRITE-ASC-LISTQ.                                            22060079
220700                                                                  22070079
220800     EXEC CICS                                                    22080079
220900         WRITEQ TS                                                22090079
221000             QUEUE (ASC-LIST-QUEUE-NAME)                          22100079
221100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22110079
221200             ITEM  (PV-BLOCK-NUMBER)                              22120079
221300             RESP  (PV-CICS-RESP)                                 22130079
221400     END-EXEC.                                                    22140079
221500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22150079
221600         SET DP013-CICS-ABEND      TO TRUE                        22160079
221700         SET DP013-NO-ROLLBACK     TO TRUE                        22170079
221800         MOVE '5110-WRITE-ASC-LISTQ'                              22180079
221900                                   TO DP013-PARAGRAPH             22190079
222000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22200079
222100                                   TO DP013-MESSAGE-TEXT(1)       22210079
222200         PERFORM DP013-0000-PROCESS-ABEND                         22220079
222300     END-IF.                                                      22230079
222400                                                                  22240079
222500                                                                  22250079
222600*----------------------------------------------------------------*22260079
222700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22270079
222800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22280079
222900*----------------------------------------------------------------*22290079
223000 5200-FILL-SEL-QUEUE-RECORD.                                      22300079
223100                                                                  22310079
223200     PERFORM 6112-READ-LIST-QUEUE.                                22320079
223300                                                                  22330079
223400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22340079
223500         PERFORM VARYING LQW-IDX  FROM 1 BY 1                     22350079
223600           UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                     22360079
223700              OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            22370079
223800                                                                  22380079
223900             IF  LQW-SELECT (LQW-IDX)                             22390079
224000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              22400079
224100                                   TO IN031-ITEM (IN031-IDX)      22410079
224200                 MOVE LQW-SHEET-NBR (LQW-IDX)                     22420079
224300                                   TO IN031-SHEET-NBR (IN031-IDX) 22430079
224400                 MOVE LQW-TYPE-CDE (LQW-IDX)                      22440079
224500                                   TO IN031-TYPE-CDE (IN031-IDX)  22450079
224600                 MOVE SPACE        TO IN031-ACTION-SW (IN031-IDX) 22460079
224700                 SET IN031-IDX UP BY 1                            22470079
224800                 IF  IN031-IDX > IN031-MAX-ITEMS                  22480079
224900                     PERFORM 5205-WRITE-SEL-QUEUE                 22490079
225000                     ADD +1        TO IN030-NUMBER-OF-TS-ITEMS    22500079
225100                     INITIALIZE IN031-SELECTED-ITEM-ARRAY         22510079
225200                     SET IN031-IDX TO  1                          22520079
225300                 END-IF                                           22530079
225400             END-IF                                               22540079
225500         END-PERFORM                                              22550079
225600     END-IF.                                                      22560079
225700                                                                  22570079
225800                                                                  22580079
225900*----------------------------------------------------------------*22590079
226000*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *22600079
226100*----------------------------------------------------------------*22610079
226200 5205-WRITE-SEL-QUEUE.                                            22620079
226300                                                                  22630079
226400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22640079
226500                                   TO IN031-SELECTED-ITEMS.       22650079
226600                                                                  22660079
226700     EXEC CICS                                                    22670079
226800          WRITEQ TS                                               22680079
226900              QUEUE (ASC-SEL-QUEUE-NAME)                          22690079
227000              FROM  (IN031-SHEET-SEL-REC)                         22700079
227100              ITEM  (PV-SEL-QUEUE-ITEM)                           22710079
227200              RESP  (PV-CICS-RESP)                                22720079
227300     END-EXEC.                                                    22730079
227400                                                                  22740079
227500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22750079
227600         CONTINUE                                                 22760079
227700     ELSE                                                         22770079
227800         SET DP013-CICS-ABEND      TO TRUE                        22780079
227900         SET DP013-NO-ROLLBACK     TO TRUE                        22790079
228000         MOVE '5205-WRITE-SEL-QUEUE'                              22800079
228100                                   TO DP013-PARAGRAPH             22810079
228200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          22820079
228300                                   TO DP013-MESSAGE-TEXT(1)       22830079
228400         PERFORM DP013-0000-PROCESS-ABEND                         22840079
228500     END-IF.                                                      22850079
228600                                                                  22860079
228700                                                                  22870079
228800*----------------------------------------------------------------*22880079
228900* WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, SET22890079
229000* UP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT THE   22900079
229100* SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO THE USER. 22910079
229200*----------------------------------------------------------------*22920079
229300 6000-REFRESH-PANEL-FROM-TEMP.                                    22930079
229400                                                                  22940079
229500     IF  ASC-UPDATE-TSQ                                           22950079
229600         SET ASC-NO-TSQ-UPDATE TO TRUE                            22960079
229700         MOVE ZERO                 TO PV-SAVE-ITEM                22970079
229800                                      PV-SEL-QUEUE-ITEM           22980079
229900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22990079
230000                                   TO PV-HOLD-SELECTED-ITEMS      23000079
230100         PERFORM 6100-UPDATE-TSQ                                  23010079
230200           UNTIL PV-ITEMS-PROCESSED > ASC-NUMBER-OF-SELECTED-ITEMS23020079
230300         PERFORM 6010-DELETE-SEL-QUEUE                            23030079
230400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23040079
230500                    ASC-BLOCK-ENTRIES (2)                         23050079
230600                                                                  23060079
230700         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 23070079
230800                GIVING PV-BLOCK-NUMBER                            23080079
230900                REMAINDER PV-REMAINDER                            23090079
231000         IF  PV-REMAINDER > ZERO                                  23100079
231100             ADD +1     TO PV-BLOCK-NUMBER                        23110079
231200         END-IF                                                   23120079
231300         MOVE +1        TO ASC-BLK-SUB                            23130079
231400         PERFORM 4410-READ-TEMP-STORAGE                           23140079
231500         ADD +1         TO ASC-BLK-SUB                            23150079
231600                           PV-BLOCK-NUMBER                        23160079
231700         PERFORM 4410-READ-TEMP-STORAGE                           23170079
231800                                                                  23180079
231900     END-IF.                                                      23190079
232000                                                                  23200079
232100                                                                  23210079
232200*----------------------------------------------------------------*23220079
232300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23230079
232400*----------------------------------------------------------------*23240079
232500 6010-DELETE-SEL-QUEUE.                                           23250079
232600                                                                  23260079
232700     EXEC CICS                                                    23270079
232800         DELETEQ TS                                               23280079
232900             QUEUE (ASC-SEL-QUEUE-NAME)                           23290079
233000             RESP  (PV-CICS-RESP)                                 23300079
233100     END-EXEC.                                                    23310079
233200                                                                  23320079
233300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23330079
233400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23340079
233500         CONTINUE                                                 23350079
233600     ELSE                                                         23360079
233700         SET DP013-CICS-ABEND TO TRUE                             23370079
233800         SET DP013-NO-ROLLBACK TO TRUE                            23380079
233900         MOVE '6010-DELETE-SEL-QUEUE'                             23390079
234000                        TO DP013-PARAGRAPH                        23400079
234100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         23410079
234200                        TO DP013-MESSAGE-TEXT (1)                 23420079
234300         PERFORM DP013-0000-PROCESS-ABEND                         23430079
234400     END-IF.                                                      23440079
234500                                                                  23450079
234600                                                                  23460079
234700*----------------------------------------------------------------*23470079
234800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *23480079
234900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *23490079
235000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *23500079
235100*    THE TEMP QUEUE.                                             *23510079
235200*----------------------------------------------------------------*23520079
235300 6100-UPDATE-TSQ.                                                 23530079
235400                                                                  23540079
235500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             23550079
235600     PERFORM 6105-READ-SEL-QUEUE.                                 23560079
235700     PERFORM VARYING IN031-IDX FROM 1 BY 1                        23570079
235800       UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)       23580079
235900         OR   (IN031-IDX > IN031-MAX-ITEMS))                      23590079
236000         IF  IN031-ACTION-SW (IN031-IDX) > SPACE                  23600079
236100             PERFORM 6110-PROCESS-ITEMS                           23610079
236200         END-IF                                                   23620079
236300         ADD +1                TO PV-ITEMS-PROCESSED              23630079
236400     END-PERFORM.                                                 23640079
236500     PERFORM 6111-WRITE-LIST-QUEUE.                               23650079
236600                                                                  23660079
236700                                                                  23670079
236800*----------------------------------------------------------------*23680079
236900*    READ THE LIST QUEUE RECORD.                                 *23690079
237000*----------------------------------------------------------------*23700079
237100 6105-READ-SEL-QUEUE.                                             23710079
237200                                                                  23720079
237300     EXEC CICS                                                    23730079
237400          READQ TS                                                23740079
237500              QUEUE (ASC-SEL-QUEUE-NAME)                          23750079
237600              INTO  (IN031-SHEET-SEL-REC)                         23760079
237700              ITEM  (PV-SEL-QUEUE-ITEM)                           23770079
237800              RESP  (PV-CICS-RESP)                                23780079
237900     END-EXEC.                                                    23790079
238000                                                                  23800079
238100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23810079
238200         CONTINUE                                                 23820079
238300     ELSE                                                         23830079
238400         SET DP013-CICS-ABEND       TO  TRUE                      23840079
238500         SET DP013-NO-ROLLBACK      TO  TRUE                      23850079
238600         MOVE '6105-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           23860079
238700         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           23870079
238800                                    TO  DP013-MESSAGE-TEXT(1)     23880079
238900         PERFORM DP013-0000-PROCESS-ABEND                         23890079
239000     END-IF.                                                      23900079
239100                                                                  23910079
239200                                                                  23920079
239300*----------------------------------------------------------------*23930079
239400* CALCULATE THE LIST QUEUE ITEM THAT MUST BE READ AND READ IT.    23940079
239500* REWRITE THE CURRENT LIST QUEUE ITEM IF NECESSARY.  CALCULATE    23950079
239600* THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.               23960079
239700*----------------------------------------------------------------*23970079
239800 6110-PROCESS-ITEMS.                                              23980079
239900                                                                  23990079
240000     COMPUTE PV-ITEM = 1 + ((IN031-ITEM (IN031-IDX) - 1)          24000079
240100                     / PC-ITEMS-PER-PANEL).                       24010079
240200                                                                  24020079
240300     IF  PV-ITEM NOT = PV-SAVE-ITEM                               24030079
240400         IF  PV-SAVE-ITEM NOT = ZERO                              24040079
240500             PERFORM 6111-WRITE-LIST-QUEUE                        24050079
240600         END-IF                                                   24060079
240700                                                                  24070079
240800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24080079
240900                                                                  24090079
241000         PERFORM 6112-READ-LIST-QUEUE                             24100079
241100                                                                  24110079
241200         IF  PV-CICS-RESP NOT = DFHRESP(NORMAL)                   24120079
241300             CONTINUE                                             24130079
241400         END-IF                                                   24140079
241500     END-IF.                                                      24150079
241600                                                                  24160079
241700     COMPUTE PV-SUB = (IN031-ITEM (IN031-IDX)                     24170079
241800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24180079
241900     SET  LQW-DESELECT    (PV-SUB) TO TRUE                        24190079
242000     MOVE LQW-SELECTED-SW (PV-SUB)                                24200079
242100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24210079
242200     EVALUATE TRUE                                                24220079
242300         WHEN IN031-INQ (IN031-IDX)                               24230079
242400              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24240079
242500         WHEN IN031-UPD (IN031-IDX)                               24250079
242600              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             24260079
242700         WHEN IN031-DEL (IN031-IDX)                               24270079
242800              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             24280079
242900         WHEN IN031-ERR (IN031-IDX)                               24290079
243000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             24300079
243100     END-EVALUATE.                                                24310079
243200                                                                  24320079
243300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                24330079
243400                                                                  24340079
243500                                                                  24350079
243600*----------------------------------------------------------------*24360079
243700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *24370079
243800*----------------------------------------------------------------*24380079
243900 6111-WRITE-LIST-QUEUE.                                           24390079
244000                                                                  24400079
244100     EXEC CICS                                                    24410079
244200         WRITEQ TS                                                24420079
244300             QUEUE (ASC-LIST-QUEUE-NAME)                          24430079
244400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     24440079
244500             ITEM  (PV-SAVE-ITEM)                                 24450079
244600             REWRITE                                              24460079
244700             RESP  (PV-CICS-RESP)                                 24470079
244800     END-EXEC.                                                    24480079
244900                                                                  24490079
245000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24500079
245100         CONTINUE                                                 24510079
245200     ELSE                                                         24520079
245300         SET DP013-CICS-ABEND  TO  TRUE                           24530079
245400         SET DP013-NO-ROLLBACK TO  TRUE                           24540079
245500         MOVE '6111-WRITE-LIST-QUEUE'                             24550079
245600                               TO  DP013-PARAGRAPH                24560079
245700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  24570079
245800                               TO  DP013-MESSAGE-TEXT(1)          24580079
245900         PERFORM DP013-0000-PROCESS-ABEND                         24590079
246000     END-IF.                                                      24600079
246100                                                                  24610079
246200                                                                  24620079
246300*----------------------------------------------------------------*24630079
246400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24640079
246500*----------------------------------------------------------------*24650079
246600                                                                  24660079
246700 6112-READ-LIST-QUEUE.                                            24670079
246800                                                                  24680079
246900     EXEC CICS                                                    24690079
247000         READQ TS                                                 24700079
247100             QUEUE (ASC-LIST-QUEUE-NAME)                          24710079
247200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24720079
247300             ITEM  (PV-ITEM)                                      24730079
247400             RESP  (PV-CICS-RESP)                                 24740079
247500     END-EXEC.                                                    24750079
247600                                                                  24760079
247700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24770079
247800         CONTINUE                                                 24780079
247900     ELSE                                                         24790079
248000         SET DP013-CICS-ABEND        TO TRUE                      24800079
248100         SET DP013-NO-ROLLBACK       TO TRUE                      24810079
248200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           24820079
248300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    24830079
248400                                     TO DP013-MESSAGE-TEXT(1)     24840079
248500         PERFORM DP013-0000-PROCESS-ABEND                         24850079
248600     END-IF.                                                      24860079
248700                                                                  24870079
248800                                                                  24880079
248900*----------------------------------------------------------------*24890079
249000*    ABEND PROCESSOR MODULE                                      *24900079
249100*----------------------------------------------------------------*24910079
249200                                                                  24920079
249300     COPY DPPD013.                                                24930079
