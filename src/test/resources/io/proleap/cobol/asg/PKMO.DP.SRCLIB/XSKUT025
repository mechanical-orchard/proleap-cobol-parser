000100*----------------------------------------------------------       00010042
000200 IDENTIFICATION DIVISION.                                         00020042
000300*----------------------------------------------------------       00030042
000400 PROGRAM-ID.    XSKUT025.                                         00040042
000500 AUTHOR.        JOSEPH MENYAH.                                    00050042
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00060042
000700                                                                  00070042
000800*----------------------------------------------------------       00080042
000900*            PROMOTION BUSINESS EVENT EXTRACT                     00090042
001000*----------------------------------------------------------       00100042
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00110042
001020* EXTRACT FOR THE PROMOTION  BUSINESS EVENT.                      00120042
001124*                                                                 00130042
001125*----------------------------------------------------------       00140042
001126* HISTORY LOG:                                                    00150042
001127*                                                                 00160042
001128*----------------------------------------------------------       00170042
001129* DATE:   08/12/2010                                              00180049
001130* WR/IR#: WR # 38172                                              00190049
001131* PROGRAMMER:  CHERI PARMLEY                                      00200049
001140* DESCRIPTION: EXCLUDE 'RB' PROMO_TYP_CDE IN CURSOR               00210049
001150* TO COMPARE EQUALLY TO THE PM PROCESS.                           00220049
001160*----------------------------------------------------------       00230042
001170 ENVIRONMENT DIVISION.                                            00240042
001180*----------------------------------------------------------       00250042
001190 CONFIGURATION SECTION.                                           00260042
001200 SOURCE-COMPUTER. IBM-3090.                                       00270042
001300 OBJECT-COMPUTER. IBM-3090.                                       00280042
001400                                                                  00290042
001500 INPUT-OUTPUT SECTION.                                            00300042
001600                                                                  00310042
001700 FILE-CONTROL.                                                    00320042
001800                                                                  00330042
004900     SELECT DATE-RANGE-FILE                                       00340042
005000         ASSIGN TO INP01.                                         00350042
                                                                        00360042
004900     SELECT TMST-FILE                                             00370042
005000         ASSIGN TO INP02.                                         00380042
                                                                        00390042
004900     SELECT EXTRACT-FILE                                          00400042
005000         ASSIGN TO OUT01.                                         00410042
001900*----------------------------------------------------------       00420042
002000 DATA DIVISION.                                                   00430042
002100*----------------------------------------------------------       00440042
002200 FILE SECTION.                                                    00450042
002300                                                                  00460042
008000 FD  EXTRACT-FILE                                                 00470042
008100     RECORDING MODE IS F                                          00480042
008200     LABEL RECORDS ARE OMITTED                                    00490042
008300     RECORD CONTAINS 250 CHARACTERS                               00500042
008400     DATA RECORD IS PROMOTION-EVNT-RECORD.                        00510042
008500 01  PROMOTION-EVNT-RECORD       PIC X(250).                      00520042
008600                                                                  00530042
005800 FD  DATE-RANGE-FILE                                              00540042
005900     RECORDING MODE IS F                                          00550042
006000     LABEL RECORDS ARE STANDARD                                   00560042
006100     RECORD CONTAINS 80 CHARACTERS                                00570042
006200     BLOCK CONTAINS 0 RECORDS                                     00580042
006300     DATA RECORD IS DATE-RECORD.                                  00590042
006400 01  DATE-RECORD                 PIC X(80).                       00600042
006500                                                                  00610042
005800 FD  TMST-FILE                                                    00620042
005900     RECORDING MODE IS F                                          00630042
006000     LABEL RECORDS ARE STANDARD                                   00640042
006100     RECORD CONTAINS 80 CHARACTERS                                00650042
006200     BLOCK CONTAINS 0 RECORDS                                     00660042
006300     DATA RECORD IS DATE-RECORD.                                  00670042
006400 01  DATE-RECORD                 PIC X(80).                       00680042
006500                                                                  00690042
002500*---------------------------------------------------------        00700042
002600                                                                  00710042
002700 WORKING-STORAGE SECTION.                                         00720042
002800*---------------------------------------------------------        00730042
003500* PC- PROGRAM CONSTANTS                                           00740042
003600*----------------------------------------------------------       00750042
003700 01  PC-PROGRAM-CONSTANTS.                                        00760042
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT025'. 00770042
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00780042
004000                                                                  00790042
004100*----------------------------------------------------------       00800042
004200* PS- PROGRAM SWITCHES                                            00810042
004300*----------------------------------------------------------       00820042
004400 01  PS-PROGRAM-SWITCHES.                                         00830042
004500     05  PS-EOF-EXTRACT-SW           PIC X(01)  VALUE SPACE.      00840042
004600         88  PS-EOF-EXTRACT                      VALUE 'Y'.       00850042
004600         88  PS-NOT-EOF-EXTRACT                  VALUE 'N'.       00860042
           05  PS-DATE-RANGE-FILE-SW        PIC  X(01)  VALUE 'N'.      00870042
               88  PS-DATE-RANGE-FILE-END               VALUE 'Y'.      00880042
               88  PS-DATE-RANGE-FILE-START             VALUE 'N'.      00890042
           05  PS-TMST-FILE-SW              PIC  X(01)  VALUE 'N'.      00900042
               88  PS-TMST-FILE-END                     VALUE 'Y'.      00910042
               88  PS-TMST-FILE-START                   VALUE 'N'.      00920042
004800                                                                  00930042
004900*----------------------------------------------------------       00940042
005000* PV- PROGRAM VARIABLES                                           00950042
005100*----------------------------------------------------------       00960042
       01  CC-DATE-RANGE-FILE.                                          00970042
           05  CC-START-DATE                PIC X(10).                  00980042
           05  FILLER                       PIC X(01).                  00990042
           05  CC-END-DATE                  PIC X(10).                  01000042
                                                                        01010042
       01  CC-TMST-FILE.                                                01020042
           05  CC-LAST-UPD-TMST             PIC X(19).                  01030042
                                                                        01040042
005200 01 PV-PROGRAM-VARIABLES.                                         01050042
006000    05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      01060042
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 01070042
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   01080042
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         01090042
008600    05  PV-LAST-UPD-TMST.                                         01100042
008700        10  PV-AD-EVNT-END-DTE.                                   01110042
008800            15  PV-LAST-UPD-CCYY          PIC X(04).              01120042
008900            15  FILLER                    PIC X(01) VALUE '-'.    01130042
009000            15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              01140042
009100            15  FILLER                    PIC X(01) VALUE '-'.    01150042
009200            15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              01160042
009100            15  PV-TIME-FILLER            PIC X(01) VALUE '.'.    01170042
009300        10  PV-AD-EVNT-END-TM             PIC X(15).              01180042
005710    05  PV-EVNT-ID                    PIC S9(09) VALUE +0.        01190042
005800    05  PV-ACTION-CODE                PIC X(01).                  01200042
005810        88  PV-INSERT-DATA                       VALUE 'I'.       01210042
005820        88  PV-UPDATE-DATA                       VALUE 'U'.       01220042
                                                                        01230042
006000    05  PV-LD-STATUS-CDE              PIC X(02).                  01240042
006100        88  PV-NO-ERROR                          VALUE '00'.      01250042
006200        88  PV-CRITICAL-ERROR                    VALUE '01'.      01260042
006300        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      01270042
007000                                                                  01280042
007100    05  PV-STRT-PARM.                                             01290042
007200        10  PV-STRT-DTE-CC            PIC X(02).                  01300042
007200        10  PV-STRT-DTE-YY            PIC X(02).                  01310042
007400        10  PV-STRT-DTE-MM            PIC X(02).                  01320042
007600        10  PV-STRT-DTE-DD            PIC X(02).                  01330042
007400        10  FILLER                    PIC X.                      01340042
007400        10  PV-DECREMENT              PIC X(03).                  01350042
007400        10  FILLER                    PIC X(68).                  01360042
007700                                                                  01370042
007100    05  PV-EVNT-STRT-DTE              PIC X(10).                  01380042
                                                                        01390042
          05  PV-OPERATION-MSG              PIC  X(60)  VALUE SPACES.   01400042
          05  PV-OPERATION-MSG-1            PIC  X(40)  VALUE SPACES.   01410042
008500                                                                  01420042
008600    05  PV-EVNT-END-DTE-TM.                                       01430042
008700        10  PV-EVNT-END-DTE.                                      01440042
008800            15  PV-EVNT-DTE-TM2-CCYY      PIC X(04).              01450042
008900            15  FILLER                    PIC X(01).              01460042
009000            15  PV-EVNT-DTE-TM2-MM        PIC X(02).              01470042
009100            15  FILLER                    PIC X(01).              01480042
009200            15  PV-EVNT-DTE-TM2-DD        PIC X(02).              01490042
009300        10  PV-EVNT-END-TM                PIC X(16).              01500042
009400                                                                  01510042
004310    05  PV-NULLS-INDICATORS.                                      01520042
004320        10  PV-AD-EVNT-IND            PIC S9(4) VALUE +0 COMP.    01530042
004321        10  PV-REG-PROMO-ADV-IND      PIC S9(4) VALUE +0 COMP.    01540042
004321        10  PV-REG-PROMO-TYP-IND      PIC S9(4) VALUE +0 COMP.    01550042
004322        10  PV-PROMO-NM-IND           PIC S9(4) VALUE +0 COMP.    01560042
004323        10  PV-PROMO-ABBR-NM-IND      PIC S9(4) VALUE +0 COMP.    01570042
004324        10  PV-SKU-NBR-IND            PIC S9(4) VALUE +0 COMP.    01580042
004325        10  PV-PRICG-AMT-IND          PIC S9(4) VALUE +0 COMP.    01590042
004325        10  PV-ESL-TOPR-TYPE          PIC S9(4) VALUE +0 COMP.    01600043
                                                                        01610042
       01  PV-TOTAL-RECORD.                                             01620042
           05 PV-BUSINESS-EVNT-ID              PIC 9(03) VALUE ZERO.    01630042
           05 PV-ACTION-CDE                    PIC X(01) VALUE 'T'.     01640042
           05 PV-TOTAL-NBR-OF-RECS             PIC 9(11) VALUE ZERO.    01650042
010900*----------------------------------------------------------       01660042
011000* PROMOTION EVENT BUSINESS EVENT RECORD LAYOUT                    01670042
011100*----------------------------------------------------------       01680042
011200     COPY XSRD016.                                                01690042
011300                                                                  01700042
011400*----------------------------------------------------------       01710042
011500* DATE ROUTINE COPY MEMBERS                                       01720042
011600*----------------------------------------------------------       01730042
011700     COPY DPWS500.                                                01740042
011800                                                                  01750042
011900*----------------------------------------------------------       01760042
012000* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01770042
012100*----------------------------------------------------------       01780042
012200     COPY DPWS004.                                                01790042
012300                                                                  01800042
030160*---------------------------------------------                    01810042
030170*  DB2 COMMUNICATION AREA.                                        01820042
030180*---------------------------------------------                    01830042
030190     EXEC SQL                                                     01840042
030191          INCLUDE SQLCA                                           01850042
030192     END-EXEC.                                                    01860042
030193                                                                  01870042
023000     COPY SQLCA2.                                                 01880042
030194*---------------------------------------------                    01890042
030195*  DB2 TABLE XST00026(XST_PROMO) - PROMO EVENT TABLE              01900042
030196*---------------------------------------------                    01910042
030197     EXEC SQL                                                     01920042
030198          INCLUDE XST00026                                        01930042
030199     END-EXEC.                                                    01940042
030194*---------------------------------------------                    01950042
023300*   EXTRACT CURSOR  DB2 SELECT                                    01960042
030194*---------------------------------------------                    01970042
023400     EXEC SQL                                                     01980042
023500       DECLARE EXTRACT CURSOR FOR                                 01990042
033800        SELECT PROMO_ID,                                          02000042
033900               AD_EVNT_ID,                                        02010042
034000               PROMO_TYP_CDE,                                     02020042
034100               REG_PROMO_ADV_CDE,                                 02030042
034200               REG_PROMO_TYP_CDE,                                 02040042
034300               PROMO_NM,                                          02050042
034400               PROMO_ABBR_NM,                                     02060042
034500               STAT_CDE,                                          02070042
034600               DFLT_STRT_TMST,                                    02080042
034700               DFLT_END_TMST,                                     02090042
034800               LAST_UPD_TMST,                                     02100042
034800               ACTL_STRT_TMST,                                    02110042
034800               ACTL_END_TMST,                                     02120042
034800               ESL_TOPR_TYP_CDE,                                  02130043
034800               LAST_UPD_TMST,                                     02140042
034800               SOR_LAST_UPD_TMST                                  02150042
024100        FROM XST_PROMO                                            02160042
              WHERE                                                     02190042
                 DATE(DFLT_END_TMST) >=                                 02200042
                        :CC-START-DATE                                  02210042
              AND DATE(DFLT_STRT_TMST) <=                               02220042
                        :CC-END-DATE                                    02230042
              AND SOR_LAST_UPD_TMST <=                                  02240046
                     :CC-LAST-UPD-TMST                                  02250046
              AND PROMO_TYP_CDE <> 'RB'                                 02251049
               WITH UR                                                  02260042
024400     END-EXEC.                                                    02270042
030310                                                                  02280042
031400*----------------------------------------------------------       02290042
031500 PROCEDURE DIVISION.                                              02300042
032100*----------------------------------------------------------       02310042
032200 0000-MAINLINE.                                                   02320042
032300                                                                  02330042
032400     PERFORM 1000-INITIALIZATION.                                 02340042
032500                                                                  02350042
032600     PERFORM 2000-EXTRACT-DATA                                    02360042
032700             UNTIL PS-EOF-EXTRACT.                                02370042
035000                                                                  02380042
035100     PERFORM 9990-WRITE-RECORD-CNT.                               02390042
                                                                        02400042
035100     PERFORM 9999-WRAPUP.                                         02410042
035200                                                                  02420042
035500     GOBACK.                                                      02430042
035700                                                                  02440042
035701*0000-EXIT.                                                       02450042
035702 EJECT.                                                           02460042
035703                                                                  02470042
035800*----------------------------------------------------------       02480042
035900* 1000-INITIALIZATION.                                            02490042
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            02500042
036100*     UPDATE OR INSERT A RECORD.                                  02510042
036200*----------------------------------------------------------       02520042
036300 1000-INITIALIZATION.                                             02530042
                                                                        02540042
           SET PS-NOT-EOF-EXTRACT TO TRUE.                              02550042
                                                                        02560042
026600     OPEN INPUT DATE-RANGE-FILE                                   02570042
026600                TMST-FILE                                         02580042
026600          OUTPUT EXTRACT-FILE.                                    02590042
                                                                        02600042
051100     PERFORM 2010-COMPUTE-STRT-DTE                                02610042
051200        THRU 2010-EXIT.                                           02620042
038000                                                                  02630042
027900     EXEC SQL                                                     02640042
028000         OPEN EXTRACT                                             02650042
028100     END-EXEC.                                                    02660042
                                                                        02670042
055500     IF SQLCODE < 0                                               02680042
055600         DISPLAY 'OPEN  UNSUCCESSFUL FOR TABLE XST_PROMO'         02690042
055700         PERFORM U9980-SQL-ERROR                                  02700042
055800            THRU U9980-EXIT.                                      02710042
055900                                                                  02720042
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02730042
056100           SQLWARN0 = 'W'                                         02740042
056200         DISPLAY 'OPEN WARNING FOR TABLE XST_PROMO'               02750042
056300         PERFORM U9990-SQL-WARNING                                02760042
056400            THRU U9990-EXIT.                                      02770042
056500                                                                  02780042
036400                                                                  02790042
                                                                        02800042
036410     INITIALIZE DCLXST00026.                                      02810042
036515                                                                  02820042
037240*1100-EXIT.                                                       02830042
037250 EJECT.                                                           02840042
037251                                                                  02850042
037260*----------------------------------------------------------       02860042
037300* 2000-EXTRACT-DATA.                                              02870042
037400*     EXTRACT DATA FROM THE PROMO TABLES.                         02880042
037800*----------------------------------------------------------       02890042
037900 2000-EXTRACT-DATA.                                               02900042
                                                                        02910042
                                                                        02920042
051100     PERFORM 2100-FETCH-EXTRACT                                   02930042
051200        THRU 2100-EXIT.                                           02940042
038000                                                                  02950042
           IF PS-NOT-EOF-EXTRACT                                        02960042
051100         PERFORM 2200-FORMAT-EXTRACT-FILE                         02970042
051200            THRU 2200-EXIT                                        02980042
                                                                        02990042
051100         PERFORM 3000-WRITE-PROMO-EVNT-EXTRACT                    03000042
051200            THRU 3000-EXIT                                        03010042
           END-IF.                                                      03020042
038000                                                                  03030042
038110*2000-EXIT.                                                       03040042
038200 EJECT.                                                           03050042
030000 2010-COMPUTE-STRT-DTE.                                           03060042
           READ DATE-RANGE-FILE INTO CC-DATE-RANGE-FILE                 03070042
              AT END                                                    03080042
                 SET PS-DATE-RANGE-FILE-END TO TRUE                     03090042
           END-READ.                                                    03100042
                                                                        03110042
           IF PS-DATE-RANGE-FILE-END                                    03120042
               MOVE 'NO DATE RANGE FILE TO PROCESS'                     03130042
                                                 TO PV-OPERATION-MSG-1  03140042
               PERFORM Z910-ABEND                                       03160042
           ELSE                                                         03170042
               DISPLAY 'CC-START-DATE = ' CC-START-DATE                 03180042
               DISPLAY 'CC-END-DATE   = ' CC-END-DATE                   03190042
           END-IF.                                                      03200042
030100                                                                  03210042
           READ TMST-FILE INTO CC-TMST-FILE                             03220042
              AT END                                                    03230042
                 SET PS-TMST-FILE-END TO TRUE                           03240042
           END-READ.                                                    03250042
                                                                        03260042
           IF PS-TMST-FILE-END                                          03270042
               MOVE 'NO TMST FILE TO PROCESS'                           03280042
                                                 TO PV-OPERATION-MSG-1  03290042
               PERFORM Z910-ABEND                                       03310042
           ELSE                                                         03320042
               DISPLAY 'CC-LAST-UPD-TMST = ' CC-LAST-UPD-TMST           03330042
           END-IF.                                                      03340042
038110 2010-EXIT.                                                       03810042
           EXIT.                                                        03820042
038200 EJECT.                                                           03830042
038300*------------------------------------------------------           03840042
038400* 2100-FETCH-EXTRACT                                              03850042
038500*     FETCHES THE PROMOTIONS EVENT RECORD                         03860042
038600*------------------------------------------------------           03870042
038210                                                                  03880042
054400 2100-FETCH-EXTRACT.                                              03890042
054500                                                                  03900042
054600     EXEC SQL                                                     03910042
054700         FETCH EXTRACT                                            03920042
039800            INTO :XST00026-PROMO-ID,                              03930042
039810                 :XST00026-AD-EVNT-ID:PV-AD-EVNT-IND,             03940042
039820                 :XST00026-PROMO-TYP-CDE,                         03950042
039821                 :XST00026-REG-PROMO-ADV-CDE:PV-REG-PROMO-ADV-IND,03960042
039830                 :XST00026-REG-PROMO-TYP-CDE:PV-REG-PROMO-TYP-IND,03970042
039840                 :XST00026-PROMO-NM:PV-PROMO-NM-IND,              03980042
039860                 :XST00026-PROMO-ABBR-NM:PV-PROMO-ABBR-NM-IND,    03990042
039860                 :XST00026-STAT-CDE,                              04000042
039860                 :XST00026-DFLT-STRT-TMST,                        04010042
039860                 :XST00026-DFLT-END-TMST,                         04020042
039860                 :XST00026-LAST-UPD-TMST,                         04030042
039860                 :XST00026-ACTL-STRT-TMST,                        04040042
039860                 :XST00026-ACTL-END-TMST,                         04050042
039860                 :XST00026-ESL-TOPR-TYP-CDE:PV-ESL-TOPR-TYPE,     04060043
039860                 :XST00026-LAST-UPD-TMST,                         04070042
039860                 :XST00026-SOR-LAST-UPD-TMST                      04080042
055300     END-EXEC.                                                    04090042
055400                                                                  04120042
055500     IF SQLCODE < 0                                               04130042
055600         DISPLAY 'FETCH UNSUCCESSFUL FOR TABLE XST_PROMO'         04140042
055700         PERFORM U9980-SQL-ERROR                                  04150042
055800            THRU U9980-EXIT.                                      04160042
055900                                                                  04170042
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               04180042
056100           SQLWARN0 = 'W'                                         04190042
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_PROMO'              04200042
056200         DISPLAY 'SQLCODE ' SQLCODE                               04210042
056300         PERFORM U9990-SQL-WARNING                                04220042
056400            THRU U9990-EXIT.                                      04230042
056500                                                                  04240042
056600     IF SQLCODE = +100                                            04250042
056700         MOVE 'Y' TO PS-EOF-EXTRACT-SW.                           04260042
056800                                                                  04270042
056900 2100-EXIT.                                                       04280042
057000     EXIT.                                                        04290042
038300*------------------------------------------------------           04300042
038400* 2200-FORMAT-EXTRACT-FILE                                        04310042
038500*     FORMATS THE PROMOTION EVENT COPY BOOK.                      04320042
038600*------------------------------------------------------           04330042
038700 2200-FORMAT-EXTRACT-FILE.                                        04340042
016000     MOVE XST00026-PROMO-ID       TO XS016-PROMO-ID.              04350042
           IF PV-AD-EVNT-IND NOT =  ZERO                                04360042
              MOVE ZEROS TO XS016-AD-EVNT-ID                            04370042
           ELSE                                                         04380042
016100        MOVE XST00026-AD-EVNT-ID     TO XS016-AD-EVNT-ID          04390042
           END-IF.                                                      04400042
                                                                        04410042
016200     MOVE XST00026-PROMO-TYP-CDE  TO XS016-PROMO-TYP-CDE.         04420042
           IF PV-REG-PROMO-ADV-IND NOT = ZERO                           04430042
              MOVE SPACES TO XS016-SPECIFIC-PROMO-TYP-CDE               04440042
           ELSE                                                         04450042
016300        MOVE XST00026-REG-PROMO-ADV-CDE                           04460042
                                        TO XS016-SPECIFIC-PROMO-TYP-CDE 04470042
           END-IF.                                                      04480042
                                                                        04490042
           IF PV-REG-PROMO-TYP-IND NOT = ZERO                           04500042
              MOVE SPACES TO XS016-REG-PROMO-TYP-CDE                    04510042
           ELSE                                                         04520042
016500        MOVE XST00026-REG-PROMO-TYP-CDE                           04530042
016600                                  TO XS016-REG-PROMO-TYP-CDE      04540042
           END-IF.                                                      04550042
                                                                        04560042
           IF PV-PROMO-NM-IND NOT = ZERO                                04570042
              MOVE SPACES TO XS016-CPLT-NM                              04580042
           ELSE                                                         04590042
016700       MOVE XST00026-PROMO-NM       TO XS016-CPLT-NM              04600042
           END-IF.                                                      04610042
                                                                        04620042
           IF PV-PROMO-ABBR-NM-IND NOT = ZERO                           04630042
              MOVE SPACES TO XS016-ABBR-NM                              04640042
           ELSE                                                         04650042
016800        MOVE XST00026-PROMO-ABBR-NM  TO XS016-ABBR-NM             04660042
           END-IF.                                                      04670042
                                                                        04680042
016900     MOVE XST00026-STAT-CDE       TO XS016-STAT-CDE.              04690042
017000     MOVE XST00026-DFLT-STRT-TMST TO XS016-STRT-TMST.             04700042
017100     MOVE XST00026-DFLT-END-TMST  TO XS016-END-TMST.              04710042
017100     MOVE XST00026-ACTL-STRT-TMST TO XS016-ACT-STRT-TMST.         04720042
017100     MOVE XST00026-ACTL-END-TMST  TO XS016-ACT-END-TMST.          04730042
037200     MOVE XST00026-SOR-LAST-UPD-TMST   TO PV-LAST-UPD-TMST.       04750042
009100     MOVE '.'                          TO PV-TIME-FILLER.         04760042
037200     MOVE PV-LAST-UPD-TMST             TO XS016-LAST-UPD-TMST.    04770042
           IF PV-ESL-TOPR-TYPE NOT = ZERO                               04771045
              MOVE SPACES TO XS016-ESL-TOPR-TYP                         04772045
           ELSE                                                         04773045
              MOVE XST00026-ESL-TOPR-TYP-CDE TO XS016-ESL-TOPR-TYP      04780045
           END-IF.                                                      04781045
           MOVE 020                     TO XS016-BUSINESS-EVNT-ID.      04790042
           MOVE 'U'                     TO XS016-ACTION-CDE.            04800045
038800                                                                  04810042
043510 2200-EXIT.                                                       04820042
           EXIT.                                                        04830042
043600 EJECT.                                                           04840042
043610                                                                  04850042
043700*------------------------------------------------------           04860042
043800* 3000-WRITE-PROMO-EVNT-EXTRACT.                                  04870042
043900*     WRITE EXTRACT FILE.                                         04880042
044000*------------------------------------------------------           04890042
044100 3000-WRITE-PROMO-EVNT-EXTRACT.                                   04900042
           ADD 1 TO PV-RECORD-COUNT.                                    04910042
                                                                        04920042
062300     WRITE PROMOTION-EVNT-RECORD FROM XS016-PROMOTION-RECORD.     04930042
062300     INITIALIZE XS016-PROMOTION-RECORD.                           04940042
           MOVE SPACE TO XS016-CPLT-NM.                                 04950042
                                                                        04960042
047710 3000-EXIT.                                                       04990042
           EXIT.                                                        05000042
047800 EJECT.                                                           05010042
047810                                                                  05020042
056020                                                                  05030042
059800*----------------------------------------------------------       05040042
073900 U9980-SQL-ERROR.                                                 05050042
059800*----------------------------------------------------------       05060042
074000                                                                  05070042
074100     MOVE SQLCODE    TO SQLCODE2.                                 05080042
074200     MOVE SQLERRD(3) TO SQLERRD3.                                 05090042
074300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05100042
074400     DISPLAY '** PROGRAM        ** = XSKUT025'.                   05110042
074500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05120042
074600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05130042
074700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05140042
074800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05150042
074900                                                                  05160042
075000     MOVE 4013 TO ABEND-CODE.                                     05170042
075100     CALL 'ILBOABN0' USING ABEND-CODE.                            05180042
075200                                                                  05190042
075300 U9980-EXIT.                                                      05200042
075400     EXIT.                                                        05210042
                                                                        05220042
059800*----------------------------------------------------------       05230042
075600 U9990-SQL-WARNING.                                               05240042
059800*----------------------------------------------------------       05250042
075700                                                                  05260042
075800     MOVE SQLCODE    TO SQLCODE2.                                 05270042
075900     MOVE SQLERRD(3) TO SQLERRD3.                                 05280042
076000     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05290042
076100     DISPLAY '** PROGRAM        ** = XSKUT025'.                   05300042
077200                                                                  05310042
077300     MOVE 4013 TO ABEND-CODE.                                     05320042
077400     CALL 'ILBOABN0' USING ABEND-CODE.                            05330042
077500                                                                  05340042
077600 U9990-EXIT.                                                      05350042
077700     EXIT.                                                        05360042
                                                                        05370042
060100 9990-WRITE-RECORD-CNT.                                           05380042
           INITIALIZE XS016-PROMOTION-RECORD.                           05390042
           MOVE 020 TO PV-BUSINESS-EVNT-ID.                             05400042
           MOVE PV-RECORD-COUNT TO PV-TOTAL-NBR-OF-RECS.                05410042
           MOVE 'T' TO PV-ACTION-CDE.                                   05420042
062300     WRITE PROMOTION-EVNT-RECORD FROM PV-TOTAL-RECORD.            05430042
                                                                        05440042
060710*9990-EXIT.                                                       05450042
                                                                        05460042
059800*----------------------------------------------------------       05470042
059900* 9999-WRAPUP.                                                    05480042
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           05490042
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           05500042
059930*     PROGRAM.                                                    05510042
060000*----------------------------------------------------------       05520042
*                                                                       05530042
060100 9999-WRAPUP.                                                     05540042
           CLOSE DATE-RANGE-FILE                                        05550042
                 TMST-FILE                                              05560042
                 EXTRACT-FILE.                                          05570042
                                                                        05580042
072200     EXEC SQL                                                     05590042
072300         CLOSE EXTRACT                                            05600042
072400     END-EXEC.                                                    05610042
060200                                                                  05620042
060500                                                                  05630042
060710*9999-EXIT.                                                       05640042
060800 EJECT.                                                           05650042
060900                                                                  05660042
      ******************************************************************05670042
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *05680042
      ******************************************************************05690042
       Z910-ABEND.                                                      05700042
                                                                        05710042
           DISPLAY '** ABEND           **'.                             05720042
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         05750042
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       05760042
                                                                        05770042
           CALL 'ILBOABN0' USING ABEND-CODE.                            05780042
