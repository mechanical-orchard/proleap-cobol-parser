000100*-----------------------------*                                   00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------------*                                   00030000
000400 PROGRAM-ID.    RCKUT079.                                         00040000
000500 AUTHOR.        JOHN HUTCHINSON                                   00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  4/24/2003.                                        00070000
000800*--------------------------------------------------------------*  00080000
000900*  THIS PROGRAM WILL READ THE RECEIPTS EXTRACT FILE CREATED BY *  00090000
001000*  RCKUT079, AND CREATE A NEW EXTRACT FILE CONTAINING A COUNT  *  00100000
001100*  OF ALL PO'S.                                                *  00110000
001200*--------------------------------------------------------------*  00120000
001300*-----------------------------*                                   00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500*-----------------------------*                                   00150000
001600 INPUT-OUTPUT SECTION.                                            00160000
001700 FILE-CONTROL.                                                    00170000
001800     SELECT EXTRACT-FILE-IN     ASSIGN TO UT-S-IN01.              00180004
001900     SELECT EXTRACT-FILE-OUT    ASSIGN TO UT-S-OUT01.             00190004
002000                                                                  00200000
002100*-----------------------------*                                   00210000
002200 DATA DIVISION.                                                   00220000
002300*-----------------------------*                                   00230000
002400 FILE SECTION.                                                    00240000
002500                                                                  00250000
002600 FD  EXTRACT-FILE-IN                                              00260004
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     RECORD CONTAINS 400                                          00290000
003000     BLOCK CONTAINS 0 RECORDS.                                    00300000
003100 01  EXTRACT-RECORD               PIC X(400).                     00310007
003200                                                                  00320000
003300 FD  EXTRACT-FILE-OUT                                             00330004
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     RECORD CONTAINS 400                                          00360000
003700     BLOCK CONTAINS 0 RECORDS.                                    00370000
003800 01  NEW-EXTRACT-RECORD           PIC  X(400).                    00380007
003900                                                                  00390000
004000*-----------------------------*                                   00400000
004100 WORKING-STORAGE SECTION.                                         00410000
004200*-----------------------------*                                   00420000
004300 01  PS-PROGRAM-SWITCHES.                                         00430000
004400     05  PS-EXTRACT-SW            PIC  X(01) VALUE 'N'.           00440007
004500         88  PS-EXTRACT-EOF-YES             VALUE 'Y'.            00450000
004600         88  PS-EXTRACT-EOF-NO              VALUE 'N'.            00460002
004700                                                                  00470000
004800 01  PV-PROGRAM-VARIABLES.                                        00480000
004900     05  PV-EXTRACT-READ          PIC  9(09) VALUE ZEROS.         00490007
005000     05  PV-EXTRACT-WRITTEN       PIC  9(09) VALUE ZEROS.         00500007
005100     05  PV-DISPLAY-COUNT         PIC  ZZZ,ZZZ,ZZ9.               00510007
005200     05  PV-EXTENT-CFY-SLSRNK-NBR PIC S9(04) VALUE +0 COMP.       00520007
005300                                                                  00530000
005400 01  PV-ABEND-FIELDS.                                             00540000
005500     05  PV-SQLCODE               PIC  Z(8)9-.                    00550007
005600     05  PV-ABEND-CODE            PIC S9(04) VALUE +0 COMP.       00560007
005700     05  PV-ABEND-PROGRAM         PIC  X(08) VALUE 'RCKUT079'.    00570007
005800     05  PV-ABEND-PARAGRAPH       PIC  X(50) VALUE SPACES.        00580007
005900     05  PV-ABEND-MESSAGE-1       PIC  X(60) VALUE SPACES.        00590007
006000     05  PV-ABEND-MESSAGE-2       PIC  X(60) VALUE SPACES.        00600007
006100                                                                  00610000
006200 01  RUN-CONTROL-RECORD.                                          00620005
006300     05  CC-RUN-CONTROL           PIC  X(06).                     00630007
006400         88  CC-PERIOD                       VALUE 'PERIOD'.      00640007
006500         88  CC-YTD                          VALUE 'YTD   '.      00650007
006600     05  FILLER                   PIC  X(74).                     00660007
006700                                                                  00670000
006800* -------------------------------------------------------------- *00680000
006900*    COPYBOOK USED IN CREATING EXTRACT FILE.                     *00690000
007000* -------------------------------------------------------------- *00700000
007100     COPY RCRD065.                                                00710000
007200                                                                  00720000
007300* -------------------------------------------------------------- *00730007
007400*    DB2 MESSAGE AREAS                                            00740007
007500* -------------------------------------------------------------- *00750007
007600     COPY DPWS004.                                                00760007
007700                                                                  00770007
007800     EXEC SQL                                                     00780007
007900          INCLUDE SQLCA                                           00790007
008000     END-EXEC.                                                    00800007
008100                                                                  00810007
008200* -------------------------------------------------------------- *00820007
008300*    DB2 DCLGEN FOR TEXTENT TABLE                                *00830007
008400* -------------------------------------------------------------- *00840007
008500     EXEC SQL                                                     00850007
008600          INCLUDE TEXTENT                                         00860007
008700     END-EXEC.                                                    00870007
008800                                                                  00880007
008900*--------------------------*                                      00890000
009000 PROCEDURE DIVISION.                                              00900000
009100*--------------------------*                                      00910000
009200     PERFORM 1000-INITIALIZATION.                                 00920000
009300                                                                  00930000
009400     PERFORM 2000-PROCESS-EXTRACTS                                00940000
009500       UNTIL PS-EXTRACT-EOF-YES.                                  00950000
009600                                                                  00960000
009700     CLOSE EXTRACT-FILE-IN                                        00970004
009800           EXTRACT-FILE-OUT.                                      00980004
009900                                                                  00990000
010000     MOVE PV-EXTRACT-READ  TO  PV-DISPLAY-COUNT.                  01000000
010100                                                                  01010000
010200     DISPLAY 'NBR OF EXTRACT RECORDS READ    : ' PV-DISPLAY-COUNT.01020000
010300                                                                  01030000
010400     MOVE PV-EXTRACT-WRITTEN  TO PV-DISPLAY-COUNT.                01040000
010500                                                                  01050000
010600     DISPLAY 'NBR OF EXTRACT RECORDS WRITTEN : ' PV-DISPLAY-COUNT.01060000
010700     DISPLAY '                                      '.            01070000
010800     DISPLAY '--------------------------------------'.            01080000
010900                                                                  01090000
011000 PROGRAM-EXIT.                                                    01100000
011100     GOBACK.                                                      01110000
011200                                                                  01120000
011300*-------------------------------------------------------------    01130000
011400*-------------------------------------------------------------    01140000
011500 1000-INITIALIZATION.                                             01150000
011600                                                                  01160002
011700     ACCEPT RUN-CONTROL-RECORD FROM SYSIN.                        01170005
011800                                                                  01180005
011900     DISPLAY '--------------------------------------'.            01190002
012000     DISPLAY '-        PROGRAM - RCKUT079          -'.            01200002
012100     DISPLAY '--------------------------------------'.            01210002
012200     DISPLAY '                                      '.            01220002
012300                                                                  01230005
012400     DISPLAY 'CONTROL CARD SET-UP IS : ' RUN-CONTROL-RECORD.      01240005
012500                                                                  01250000
012600     OPEN INPUT  EXTRACT-FILE-IN                                  01260004
012700         OUTPUT  EXTRACT-FILE-OUT.                                01270004
012800                                                                  01280000
012900     PERFORM 3000-READ-EXTRACT.                                   01290007
013000                                                                  01300000
013100*-----------------------------------------------------------------01310000
013200*-----------------------------------------------------------------01320000
013300 2000-PROCESS-EXTRACTS.                                           01330000
013400     MOVE '2000-PROCESS-EXTRACTS'  TO PV-ABEND-PARAGRAPH.         01340000
013500                                                                  01350000
013600     MOVE +1 TO RC065-PO-COUNT.                                   01360000
013700                                                                  01370005
013800     IF CC-RUN-CONTROL = 'YTD   '                                 01380005
013900         MOVE '9999-09-09' TO RC065-MONTH-END-DATE                01390005
014000     END-IF.                                                      01400005
014100                                                                  01410007
014200*10/29/03 - RE-SET SALES RANK IN CASE IT CHANGED.                 01420007
014300     PERFORM 8000-TEXTENT-INFO.                                   01430007
014400                                                                  01440007
014500     WRITE NEW-EXTRACT-RECORD FROM RC065-RCVR-EXTRACT-RECORD.     01450000
014600                                                                  01460000
014700     ADD 1 TO PV-EXTRACT-WRITTEN.                                 01470007
014800                                                                  01480000
014900     PERFORM 3000-READ-EXTRACT.                                   01490007
015000                                                                  01500000
015100* ------------------------------------------------------------- * 01510000
015200* ------------------------------------------------------------- * 01520000
015300 3000-READ-EXTRACT.                                               01530007
015400     MOVE '3000-READ-EXTRACT'   TO PV-ABEND-PARAGRAPH.            01540007
015500                                                                  01550000
015600     READ EXTRACT-FILE-IN INTO RC065-RCVR-EXTRACT-RECORD          01560004
015700         AT END                                                   01570000
015800            SET PS-EXTRACT-EOF-YES TO TRUE                        01580001
015900         NOT AT END                                               01590001
016000            ADD 1  TO  PV-EXTRACT-READ                            01600001
016100     END-READ.                                                    01610001
016200                                                                  01620001
016300*-----------------------------------------------------------------01630007
016400*    GET CFY SALES RANK NUMBER FROM TABLE (TEXTENT)               01640007
016500*-----------------------------------------------------------------01650007
016600 8000-TEXTENT-INFO.                                               01660007
016700     MOVE '3700-TEXTENT-INFO' TO PV-ABEND-PARAGRAPH.              01670007
016800                                                                  01680007
016900     EXEC SQL                                                     01690007
017000          SELECT ENT_ID                                           01700007
017100               , CFY_SLSRNK_NBR                                   01710007
017200            INTO :EXTENT-ENT-ID                                   01720007
017300               , :EXTENT-CFY-SLSRNK-NBR                           01730007
017400            FROM TEXTENT                                          01740007
017500           WHERE ENT_ID = :RC065-ENT-ID                           01750007
017600     END-EXEC.                                                    01760007
017700                                                                  01770007
017800     EVALUATE SQLCODE                                             01780007
017900       WHEN +0                                                    01790007
018000           MOVE EXTENT-CFY-SLSRNK-NBR TO PV-EXTENT-CFY-SLSRNK-NBR 01800007
018100           MOVE PV-EXTENT-CFY-SLSRNK-NBR TO RC065-CFY-SLSRNK-NBR  01810007
018200                                                                  01820007
018300       WHEN +100                                                  01830007
018400           MOVE ZEROES TO PV-EXTENT-CFY-SLSRNK-NBR                01840007
018500           MOVE PV-EXTENT-CFY-SLSRNK-NBR TO RC065-CFY-SLSRNK-NBR  01850007
018600                                                                  01860007
018700       WHEN OTHER                                                 01870007
018800           MOVE 'SELECT TEXTENT   ' TO PV-ABEND-MESSAGE-1         01880007
018900           MOVE 'TEXTENT'           TO PV-ABEND-MESSAGE-2         01890007
019000           PERFORM 9998-SQL-ABEND                                 01900007
019100     END-EVALUATE.                                                01910007
019200                                                                  01920007
019300* ------------------------------------------------------------- * 01930007
019400* ------------------------------------------------------------- * 01940007
019500 9998-SQL-ABEND.                                                  01950007
019600                                                                  01960007
019700     MOVE SQLCODE TO PV-SQLCODE.                                  01970007
019800                                                                  01980007
019900     DISPLAY '** ABEND           ** = SQLABEND'.                  01990007
020000     DISPLAY '** PROGRAM         ** = ' PV-ABEND-PROGRAM.         02000007
020100     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.       02010007
020200     DISPLAY '** TABLE AFFECTED  ** = ' PV-ABEND-MESSAGE-1.       02020007
020300     DISPLAY '** OPERATION       ** = ' PV-ABEND-MESSAGE-2.       02030007
020400     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               02040007
020500                                                                  02050007
020600     COPY DPPD004.                                                02060007
020700                                                                  02070007
020800     MOVE +4013 TO PV-ABEND-CODE.                                 02080007
020900                                                                  02090007
021000     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       02100007
021100* ----------------------------------------------------------------02110007
021200* ----------------------------------------------------------------02120007
