000100******************************************************************00010000
000200*  I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES00020000
000300*  SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.       00030000
000400*  THIS PROGRAM USES MQSERIES.                                    00040000
000500*  !!!!! ALSO !!!!!! SET COMPILE SWITCH FOR "N" = NO DB2 !!!!!    00050000
000600******************************************************************00060000
000700 IDENTIFICATION DIVISION.                                         00070000
000800 PROGRAM-ID.        SNKUP101.                                     00080000
000900 AUTHOR.            JOE LAROSA.                                   00090000
001000 INSTALLATION.      KOHLS DEPARTMENT STORES.                      00100000
001100 DATE-WRITTEN.      OCTOBER 2005.                                 00110000
001200 DATE-COMPILED.                                                   00120000
001300******************************************************************00130000
001400*  E N D    R U N    O F    A S N    O R D E R    D O W N L O A D 00140000
001500*                                                                 00150000
001600* THIS PROGRAM WILL DO AN MQPUT1 CALL TO PLACE AN                 00160000
001700* END-RUN-OF-PROGRAM MESSAGE IN THE ASN QUEUE (SN.ASN.FROM.EDI.Q).00170001
001800*                                                                 00180001
001900* THE MQPUT1 CALL DOES NOT REQUIRE MQOPEN OR MQCLOSE CALLS.       00190001
002000*                                                                 00200001
002100* NOTICE THERE ISN'T A HANDLE IN THE PUT CALL.                    00210000
002200*                                                                 00220001
002300* THE PROGRAM THAT PULLS THE MESSAGES OFF THE QUEUE IS SNKUP100   00230000
002400* ASN ORDER DOWNLOAD. WHEN THE PROCESSING OF SNKUP100 ENCOUNTERS  00240000
002500* THE END-RUN-OF-PROGRAM MESSAGE, IT WILL STOP RUN. THIS IS       00250000
002600* NECESSARY BECAUSE SNKUP100 RUNS WHEN CICS COMES UP IN THE       00260000
002700* MORNING AND CONTINUES TO RUN ALL DAY AS A STARTED TASK.         00270000
002800******************************************************************00280000
002900 ENVIRONMENT DIVISION.                                            00290000
003000 CONFIGURATION SECTION.                                           00300000
003100 SOURCE-COMPUTER.        IBM-3090.                                00310000
003200 OBJECT-COMPUTER.        IBM-3090.                                00320000
003300                                                                  00330001
003400 INPUT-OUTPUT SECTION.                                            00340000
003500 FILE-CONTROL.                                                    00350000
003600* ------------------------------------------------------------- * 00360000
003700*  CONTROL CARD 1 = LOCAL QUEUE MANAGER NAME                      00370000
003800* ------------------------------------------------------------- * 00380000
003900     SELECT CONTROL-CARD-1                                        00390000
004000         FILE STATUS IS CONTROL-CARD-1-STATUS                     00400000
004100            ASSIGN TO UT-S-INP01.                                 00410000
004200                                                                  00420000
004300* ------------------------------------------------------------- * 00430000
004400*  CONTROL CARD 2 = TRANSACTION QUEUE NAME                        00440000
004500* ------------------------------------------------------------- * 00450000
004600     SELECT CONTROL-CARD-2                                        00460000
004700         FILE STATUS IS CONTROL-CARD-2-STATUS                     00470000
004800            ASSIGN TO UT-S-INP02.                                 00480000
004900                                                                  00490000
005000******************************************************************00500000
005100 DATA DIVISION.                                                   00510000
005200******************************************************************00520000
005300 FILE SECTION.                                                    00530000
005400                                                                  00540000
005500 FD  CONTROL-CARD-1                                               00550000
005600     RECORDING MODE F                                             00560000
005700     BLOCK CONTAINS 0 RECORDS                                     00570000
005800     LABEL RECORDS ARE OMITTED.                                   00580000
005900 01  CONTROL-CARD-1-LINE              PIC  X(80).                 00590000
006000                                                                  00600000
006100 FD  CONTROL-CARD-2                                               00610000
006200     RECORDING MODE F                                             00620000
006300     BLOCK CONTAINS 0 RECORDS                                     00630000
006400     LABEL RECORDS ARE OMITTED.                                   00640000
006500 01  CONTROL-CARD-2-LINE              PIC  X(80).                 00650000
006600                                                                  00660000
006700******************************************************************00670000
006800 WORKING-STORAGE SECTION.                                         00680000
006900******************************************************************00690000
007000 01  ABEND-CODE                      PIC S9(04) VALUE +0          00700001
007100                                                COMP SYNC.        00710001
007200 01  PA-PROGRAM-ACCUMULATORS.                                     00720000
007300     05  PA-TOTALS.                                               00730000
007400         10 PA-TOTAL-MSGS-PUT        PIC S9(09) VALUE +0 COMP-3.  00740001
007500         10 PA-TOTAL-COMMITS         PIC S9(09) VALUE +0 COMP-3.  00750001
007600 01  PS-PROGRAM-SWITCHES.                                         00760000
007700     05  PS-ABEND-SW                 PIC  X(01) VALUE 'N'.        00770001
007800         88  PS-ABEND-YES                       VALUE 'Y'.        00780001
007900         88  PS-ABEND-NO                        VALUE 'N'.        00790001
008000     05  PS-CONTROL-CARD-1-END-SW    PIC  X(01) VALUE 'N'.        00800001
008100         88  PS-CONTROL-CARD-1-END-YES          VALUE 'Y'.        00810001
008200         88  PS-CONTROL-CARD-1-END-NO           VALUE 'N'.        00820001
008300     05  PS-CONTROL-CARD-2-END-SW    PIC  X(01) VALUE 'N'.        00830001
008400         88  PS-CONTROL-CARD-2-END-YES          VALUE 'Y'.        00840001
008500         88  PS-CONTROL-CARD-2-END-NO           VALUE 'N'.        00850001
008600                                                                  00860000
008700***************************************************************** 00870000
008800* FILE OPEN STATUS'S ON THE CONTROL CARDS USED FOR GETTING        00880000
008900* MQ-SERIES QUEUE MANAGER AND QUEUE NAME.                         00890000
009000***************************************************************** 00900000
009100 01  CONTROL-CARD-1-STATUS           PIC  X(02) VALUE '00'.       00910001
009200     88  CONTROL-CARD-1-SUCCESS                 VALUE '00'.       00920001
009300     88  CONTROL-CARD-1-ERROR                   VALUE '42'.       00930001
009400 01  CONTROL-CARD-2-STATUS           PIC  X(02) VALUE '00'.       00940001
009500     88  CONTROL-CARD-2-SUCCESS                 VALUE '00'.       00950001
009600     88  CONTROL-CARD-2-ERROR                   VALUE '42'.       00960001
009700                                                                  00970000
009800 01  PC-PROGRAM-CONSTANTS.                                        00980000
009900     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SNKUP101'. 00990001
010000     05  PC-END-RUN-MSG              PIC  X(18) VALUE             01000001
010100                                            'END RUN OF PROGRAM'. 01010000
010200                                                                  01020000
010300 01  PV-PROGRAM-VARIABLES.                                        01030000
010400     05  PV-MSG-LENGTH               PIC S9(09) BINARY.           01040001
010500     05  PV-PARAGRAPH                PIC  X(48) VALUE SPACES.     01050001
010600     05  PV-HOLD-COMPLETION-CODE     PIC S9(09) BINARY.           01060001
010700     05  PV-HOLD-REASON              PIC S9(09) BINARY.           01070001
010800                                                                  01080000
010900 01  PV-ABEND-VARIABLES.                                          01090000
011000     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.01100001
011100         88  ABEND-4001-WRITE-ERROR            VALUE +4001.       01110001
011200         88  ABEND-4002-READ-ERROR             VALUE +4002.       01120001
011300         88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.       01130001
011400         88  ABEND-4004-TABLE-ERROR            VALUE +4004.       01140001
011500         88  ABEND-4005-OPEN-ERROR             VALUE +4005.       01150001
011600         88  ABEND-4006-CLOSE-ERROR            VALUE +4006.       01160001
011700         88  ABEND-4007-SEQUENCE-ERROR         VALUE +4007.       01170001
011800         88  ABEND-4008-DATA-ERROR             VALUE +4008.       01180001
011900         88  ABEND-4009-KEY-DATA-ERROR         VALUE +4009.       01190001
012000         88  ABEND-4013-DB2-ERROR              VALUE +4013.       01200001
012100         88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.       01210001
012200         88  ABEND-4020-MQ-ERROR               VALUE +4020.       01220001
012300         88  ABEND-4444-FORCED-ABEND           VALUE +4444.       01230001
012400                                                                  01240000
012500 01  PE-MQ-ABEND-VARIABLES.                                       01250000
012600     05  PE-MQ-QMANAGER              PIC  X(05) VALUE SPACES.     01260001
012700     05  PE-MQ-QMANAGER-REMOTE       PIC  X(30) VALUE SPACES.     01270001
012800     05  PE-MQ-QNAME                 PIC  X(30) VALUE SPACES.     01280001
012900     05  PE-MQ-COMPLETION-CODE       PIC  9(04) VALUE ZEROES.     01290001
013000     05  PE-MQ-REASON-CODE           PIC  9(04) VALUE ZEROES.     01300001
013100                                                                  01310000
013200****************************************************************  01320000
013300**     M Q   S E R I E S    W O R K I N G   S T O R A G E     **  01330001
013400**                                                            **  01340001
013500**                  M  Q    C O P Y B O O K S                 **  01350001
013600****************************************************************  01360000
013700 01  MQM-OBJECT-DESCRIPTOR.                                       01370000
013800     COPY CMQODV.                                                 01380000
013900                                                                  01390000
014000 01  MQM-MESSAGE-DESCRIPTOR.                                      01400000
014100     COPY CMQMDV.                                                 01410000
014200                                                                  01420000
014300 01  MQM-PUT-MESSAGE-OPTIONS.                                     01430000
014400     COPY CMQPMOV.                                                01440000
014500                                                                  01450000
014600 01  MQM-GET-MESSAGE-OPTIONS.                                     01460000
014700     COPY CMQGMOV.                                                01470000
014800                                                                  01480000
014900 01  MQM-CONSTANTS.                                               01490000
015000     COPY CMQV.                                                   01500000
015100                                                                  01510000
015200****************************************************************  01520000
015300** CONTROL CARDS FOR QUEUE MANAGER AND QUEUE NAME                 01530000
015400****************************************************************  01540000
015500* ------------------------------------------------------------- * 01550000
015600*  CONTROL CARD 1 = QUEUE MANAGER NAME                            01560000
015700*  READ CONTROL CARD TO GET QUEUE MANAGER NAME                    01570000
015800* ------------------------------------------------------------- * 01580000
015900 01  CC-CONTROL-CARD-1.                                           01590000
016000     05  CC-QMGR-NAME                PIC  X(48).                  01600001
016100     05  FILLER                      PIC  X(32).                  01610001
016200                                                                  01620000
016300* ------------------------------------------------------------- * 01630000
016400*  CONTROL CARD 2 = TRANSACTION QUEUE NAME                        01640000
016500*  READ CONTROL CARD TO GET THE TRANSACTION QUEUE NAME            01650000
016600* ------------------------------------------------------------- * 01660000
016700 01  CC-CONTROL-CARD-2.                                           01670000
016800     05  CC-TRANS-QUEUE-NAME         PIC  X(48).                  01680001
016900     05  FILLER                      PIC  X(32).                  01690001
017000                                                                  01700000
017100****************************************************************  01710000
017200** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS PUT AND    **  01720000
017300*  OPEN, CONNECT, DISCONNECT.                                     01730000
017400****************************************************************  01740000
017500 01  MQ-WORKING-STORAGE.                                          01750000
017600     05  PC-MQCONN                   PIC  X(08) VALUE 'CSQBCONN'. 01760001
017700     05  PC-MQOPEN                   PIC  X(08) VALUE 'CSQBOPEN'. 01770001
017800     05  PC-MQGET                    PIC  X(08) VALUE 'CSQBGET'.  01780001
017900     05  PC-MQINQ                    PIC  X(08) VALUE 'CSQBINQ'.  01790001
018000     05  PC-MQPUT                    PIC  X(08) VALUE 'CSQBPUT'.  01800001
018100     05  PC-MQPUT1                   PIC  X(08) VALUE 'CSQBPUT1'. 01810001
018200     05  PC-MQCMIT                   PIC  X(08) VALUE 'CSQBCOMM'. 01820001
018300     05  PC-MQBACK                   PIC  X(08) VALUE 'CSQBBACK'. 01830001
018400     05  PC-MQCLOSE                  PIC  X(08) VALUE 'CSQBCLOS'. 01840001
018500     05  PC-MQDISC                   PIC  X(08) VALUE 'CSQBDISC'. 01850001
018600     05  PC-QMGR-NAME                PIC  X(04) VALUE SPACES.     01860001
018700         88  PC-PROD-QMGR-NAME                  VALUE 'QKSP'.     01870000
018800         88  PC-ACCEPT-QMGR-NAME                VALUE 'QKSQ'.     01880000
018900         88  PC-TEST-QMGR-NAME                  VALUE 'QKST'.     01890000
019000     05  PC-WAIT-15-SECS             PIC S9(09) VALUE 15000.      01900001
019100     05  PC-WAIT-6-SECS              PIC S9(09) VALUE 6000.       01910001
019200     05  PC-DELAY-INTERVAL.                                       01920000
019300         10  FILLER                  PIC  X(02) VALUE SPACES.     01930001
019400         10  PC-DELAY-TIME           PIC  9(08) VALUE 1500.       01940001
019500                                                                  01950000
019600****************************************************************  01960000
019700** QUEUE MANAGER HANDLE                                           01970000
019800*  QUEUE HANDLE                                                   01980000
019900****************************************************************  01990000
020000 01  PV-MQ-PROGRAM-HANDLES.                                       02000001
020100     05  PV-QM-NAME                  PIC  X(48).                  02010001
020200     05  PV-HCONN                    PIC S9(09) BINARY VALUE 0.   02020001
020300                                                                  02030000
020400****************************************************************  02040000
020500* ERROR PROCESSING VARIABLES                                      02050000
020600* CODES FROM CALLS ARE STORED HERE                                02060000
020700****************************************************************  02070000
020800 01  PV-MQ-PROGRAM-VARIABLES.                                     02080001
020900     05  PV-COMPLETION-CODE          PIC S9(09) BINARY.           02090001
021000     05  PV-REASON                   PIC S9(09) BINARY.           02100001
021100     05  PV-CON-REASON               PIC S9(09) BINARY.           02110001
021200     05  PV-ERROR-MESSAGE            PIC  X(48) VALUE SPACES.     02120001
021300     05  PV-OPEN-OPTIONS             PIC S9(09) BINARY.           02130001
021400     05  PV-MSGBUFFER                PIC  X(4096) VALUE SPACES.   02140001
021500     05  PV-MQCHECK                  PIC  X(08) VALUE 'MQR2C'.    02150001
021600     05  PV-MQ-REASON-TEXT           PIC  X(30) VALUE SPACES.     02160001
021700                                                                  02170000
021800****************************************************************  02180000
021900**                     E N D   O F   M Q                          02190000
022000****************************************************************  02200000
022100******************************************************************02210000
022200 PROCEDURE DIVISION.                                              02220000
022300******************************************************************02230000
022400******************************************************************02240000
022500*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *02250000
022600******************************************************************02260000
022700 0000-PROGRAM-MAINLINE.                                           02270000
022800     DISPLAY '************ START OF SNKUP101 ***************'.    02280001
022900                                                                  02290000
023000*READ CONTROL CARDS                                               02300000
023100     PERFORM 1000-READ-CC-CARDS.                                  02310001
023200                                                                  02320000
023300*CONNECT TO QUEUE MANAGER                                         02330000
023400     PERFORM 1100-MQ-CONNECT-TO-QMGR.                             02340001
023500                                                                  02350000
023600*PUT MSG ON QUEUE.                                                02360000
023700     PERFORM 1200-MQ-PUT-TO-QUEUE.                                02370001
023800                                                                  02380000
023900*DISCONNECT FROM THE QMGR.                                        02390000
024000     PERFORM 1700-DISCONNECT-QMGR.                                02400001
024100                                                                  02410000
024200* END OF JOB ROUTINE.                                             02420000
024300     PERFORM 8000-EOJ-ROUTINE.                                    02430000
024400                                                                  02440000
024500     DISPLAY '************  END OF SNKUP101  ***************'     02450001
024600     STOP RUN.                                                    02460000
024700                                                                  02470000
024800****************************************************************  02480000
024900**   B E G I N     M Q    S E R I E S     P A R A G R A P H S **  02490000
025000****************************************************************  02500000
025100****************************************************************  02510000
025200* READ CONTROL CARDS FOR QMGR NAME AND QUEUE NQME.                02520000
025300* EACH CONTROL CARD MUST CONTAIN A NAME THAT IS NOT SPACES.       02530000
025400****************************************************************  02540000
025500 1000-READ-CC-CARDS.                                              02550001
025600                                                                  02560000
025700*OPEN CC CARD 1 TO OBTAIN QUEUE MANAGER NAME                      02570000
025800      OPEN INPUT CONTROL-CARD-1.                                  02580000
025900                                                                  02590001
026000      IF CONTROL-CARD-1-ERROR                                     02600001
026100          PERFORM 9200-MQ-ABEND                                   02610001
026200      END-IF.                                                     02620000
026300                                                                  02630001
026400      READ CONTROL-CARD-1 INTO CC-CONTROL-CARD-1                  02640000
026500        AT END                                                    02650000
026600          SET PS-CONTROL-CARD-1-END-YES TO TRUE                   02660001
026700      END-READ.                                                   02670000
026800                                                                  02680001
026900      IF PS-CONTROL-CARD-1-END-YES                                02690001
027000          DISPLAY PC-CURRENT-PROGRAM-NAME                         02700000
027100                  'CONTROL CARD MISSING - FOR QMGR NAME'          02710001
027200          MOVE 'QMGR NAME IS MISSING IN CARD?' TO PV-ERROR-MESSAGE02720001
027300          PERFORM 9200-MQ-ABEND                                   02730000
027400      ELSE                                                        02740000
027500          IF CC-QMGR-NAME EQUAL SPACES                            02750001
027600              DISPLAY PC-CURRENT-PROGRAM-NAME                     02760001
027700                      'CONTROL CARD MISSING - FOR QMGR NAME'      02770001
027800              MOVE 'QMGR NAME IS SPACES!' TO PV-ERROR-MESSAGE     02780001
027900              PERFORM 9200-MQ-ABEND                               02790001
028000          ELSE                                                    02800000
028100              DISPLAY PC-CURRENT-PROGRAM-NAME                     02810001
028200                      '- CONTROL CARD: ' CC-CONTROL-CARD-1        02820001
028300          END-IF                                                  02830000
028400      END-IF.                                                     02840000
028500                                                                  02850001
028600      CLOSE CONTROL-CARD-1.                                       02860000
028700                                                                  02870000
028800*OPEN CC CARD 2 TO OBTAIN QUEUE NAME                              02880000
028900      OPEN INPUT CONTROL-CARD-2.                                  02890000
029000                                                                  02900001
029100      IF CONTROL-CARD-2-ERROR                                     02910001
029200          PERFORM 9200-MQ-ABEND                                   02920001
029300      END-IF.                                                     02930000
029400                                                                  02940001
029500      READ CONTROL-CARD-2 INTO CC-CONTROL-CARD-2                  02950000
029600        AT END                                                    02960000
029700          SET PS-CONTROL-CARD-2-END-YES TO TRUE                   02970001
029800      END-READ.                                                   02980000
029900                                                                  02990001
030000      IF PS-CONTROL-CARD-2-END-YES                                03000001
030100          DISPLAY PC-CURRENT-PROGRAM-NAME                         03010000
030200                  'CONTROL CARD MISSING - FOR QUEUE NAME'         03020001
030300          MOVE 'QUEUE NAME IS MISSING IN CARD?'                   03030000
030400               TO PV-ERROR-MESSAGE                                03040001
030500          PERFORM 9200-MQ-ABEND                                   03050000
030600      ELSE                                                        03060000
030700          IF CC-TRANS-QUEUE-NAME EQUAL SPACES                     03070001
030800              DISPLAY PC-CURRENT-PROGRAM-NAME                     03080001
030900                      'CONTROL CARD MISSING - FOR QUEUE NAME'     03090001
031000              MOVE 'QUEUE NAME IS SPACES!' TO PV-ERROR-MESSAGE    03100001
031100              PERFORM 9200-MQ-ABEND                               03110001
031200          ELSE                                                    03120000
031300              DISPLAY PC-CURRENT-PROGRAM-NAME                     03130001
031400                      '- CONTROL CARD: ' CC-CONTROL-CARD-2        03140001
031500          END-IF                                                  03150000
031600      END-IF.                                                     03160000
031700                                                                  03170001
031800      CLOSE CONTROL-CARD-2.                                       03180000
031900                                                                  03190000
032000****************************************************************  03200000
032100** CONNECT TO THE QUEUE MANAGER                                   03210000
032200****************************************************************  03220000
032300 1100-MQ-CONNECT-TO-QMGR.                                         03230001
032400     MOVE '1100-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.              03240001
032500                                                                  03250001
032600* CONNECT TO THE QUEUE                                            03260000
032700* CONTROL CARD 1 - QMGR NAME                                      03270000
032800     MOVE CC-QMGR-NAME TO PV-QM-NAME.                             03280001
032900                                                                  03290000
033000     CALL PC-MQCONN USING PV-QM-NAME                              03300000
033100                          PV-HCONN                                03310000
033200                          PV-COMPLETION-CODE                      03320000
033300                          PV-REASON.                              03330000
033400                                                                  03340000
033500*IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE AND EXIT         03350000
033600     MOVE PV-REASON TO PV-CON-REASON.                             03360000
033700     IF PV-COMPLETION-CODE = MQCC-OK THEN                         03370000
033800         CONTINUE                                                 03380000
033900     ELSE                                                         03390000
034000         CALL PV-MQCHECK USING PV-REASON                          03400000
034100                               PV-MQ-REASON-TEXT                  03410000
034200         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              03420000
034300         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       03430000
034400         MOVE PV-REASON            TO PE-MQ-REASON-CODE           03440000
034500         MOVE '1100-MQ-CONNECT-TO-QMGR'                           03450001
034600                                   TO PV-ERROR-MESSAGE            03460001
034700         PERFORM 9200-MQ-ABEND                                    03470000
034800     END-IF.                                                      03480000
034900                                                                  03490000
035000****************************************************************  03500000
035100** PUT THE END RUN OF PROGRAM MESSAGE TO THE QUEUE.               03510000
035200****************************************************************  03520000
035300 1200-MQ-PUT-TO-QUEUE.                                            03530001
035400                                                                  03540000
035500     MOVE MQMI-NONE             TO MQMD-MSGID.                    03550000
035600     MOVE MQCI-NONE             TO MQMD-CORRELID.                 03560000
035700     MOVE MQFMT-STRING          TO MQMD-FORMAT.                   03570000
035800     MOVE +18                   TO PV-MSG-LENGTH.                 03580000
035900     MOVE MQPER-PERSISTENT      TO MQMD-PERSISTENCE.              03590000
036000     MOVE PV-QM-NAME            TO MQOD-OBJECTQMGRNAME.           03600000
036100     MOVE CC-TRANS-QUEUE-NAME   TO MQOD-OBJECTNAME.               03610000
036200     COMPUTE PV-OPEN-OPTIONS    = MQOO-OUTPUT                     03620000
036300                                + MQOO-FAIL-IF-QUIESCING.         03630000
036400     MOVE PC-END-RUN-MSG        TO PV-MSGBUFFER.                  03640000
036500                                                                  03650000
036600     CALL PC-MQPUT1 USING PV-HCONN                                03660000
036700                          MQM-OBJECT-DESCRIPTOR                   03670000
036800                          MQM-MESSAGE-DESCRIPTOR                  03680000
036900                          MQM-PUT-MESSAGE-OPTIONS                 03690000
037000                          PV-MSG-LENGTH                           03700000
037100                          PV-MSGBUFFER                            03710000
037200                          PV-COMPLETION-CODE                      03720000
037300                          PV-REASON.                              03730000
037400                                                                  03740000
037500*IF PUT FAILED THEN DISPLAY ERROR MESSAGE AND ABEND               03750000
037600     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        03760000
037700         CALL PV-MQCHECK USING PV-REASON                          03770000
037800                               PV-MQ-REASON-TEXT                  03780000
037900         MOVE '1200-MQ-PUT-TO-QUEUE'  TO PV-PARAGRAPH             03790001
038000         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         03800000
038100         MOVE PV-COMPLETION-CODE      TO PV-HOLD-COMPLETION-CODE  03810000
038200         MOVE PV-REASON               TO PV-HOLD-REASON           03820000
038300         PERFORM 1500-BACK-OUT-MQ                                 03830001
038400         MOVE PV-HOLD-COMPLETION-CODE TO PE-MQ-COMPLETION-CODE    03840000
038500         MOVE PV-HOLD-REASON          TO PE-MQ-REASON-CODE        03850000
038600         PERFORM 9200-MQ-ABEND                                    03860000
038700     ELSE                                                         03870000
038800         ADD 1 TO PA-TOTAL-MSGS-PUT                               03880000
038900         PERFORM 1600-MQ-COMMIT                                   03890001
039000     END-IF.                                                      03900000
039100                                                                  03910000
039200******************************************************************03920001
039300* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       03930001
039400******************************************************************03940001
039500 1500-BACK-OUT-MQ.                                                03950001
039600                                                                  03960001
039700     CALL PC-MQBACK USING PV-HCONN                                03970001
039800                          PV-COMPLETION-CODE                      03980001
039900                          PV-REASON.                              03990001
040000                                                                  04000001
040100     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        04010001
040200         CALL PV-MQCHECK USING PV-REASON                          04020001
040300                               PV-MQ-REASON-TEXT                  04030001
040400         MOVE '1500-BACK-OUT-MQ'  TO PV-PARAGRAPH                 04040001
040500         MOVE 'MQBACK ERROR'      TO PV-ERROR-MESSAGE             04050001
040600         PERFORM 9200-MQ-ABEND                                    04060001
040700     END-IF.                                                      04070001
040800                                                                  04080001
040900******************************************************************04090001
041000*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        04100001
041100******************************************************************04110001
041200 1600-MQ-COMMIT.                                                  04120001
041300                                                                  04130001
041400     CALL PC-MQCMIT USING PV-HCONN                                04140001
041500                          PV-COMPLETION-CODE                      04150001
041600                          PV-REASON.                              04160001
041700                                                                  04170001
041800     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        04180001
041900         CALL PV-MQCHECK USING PV-REASON                          04190001
042000                               PV-MQ-REASON-TEXT                  04200001
042100         MOVE '1600-COMMIT-MQ'   TO PV-PARAGRAPH                  04210001
042200         MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE              04220001
042300         MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE       04230001
042400         MOVE PV-REASON          TO PV-HOLD-REASON                04240001
042500         PERFORM 1500-BACK-OUT-MQ                                 04250001
042600         MOVE PV-HOLD-COMPLETION-CODE TO PE-MQ-COMPLETION-CODE    04260001
042700                                         PV-COMPLETION-CODE       04270001
042800         MOVE PV-HOLD-REASON     TO PE-MQ-REASON-CODE             04280001
042900                                    PV-REASON                     04290001
043000         PERFORM 9200-MQ-ABEND                                    04300001
043100     ELSE                                                         04310001
043200         ADD +1 TO PA-TOTAL-COMMITS                               04320001
043300     END-IF.                                                      04330001
043400                                                                  04340001
043500****************************************************************  04350000
043600** DISCONNECT FROM THE QUEUE MANAGER                              04360000
043700****************************************************************  04370000
043800 1700-DISCONNECT-QMGR.                                            04380001
043900     MOVE '1700-DISCONNECT-QMGR'    TO PV-PARAGRAPH.              04390001
044000                                                                  04400000
044100     CALL PC-MQDISC USING PV-HCONN                                04410000
044200                          PV-COMPLETION-CODE                      04420000
044300                          PV-REASON                               04430000
044400                                                                  04440000
044500     IF PV-COMPLETION-CODE = MQCC-OK                              04450001
044600         CONTINUE                                                 04460001
044700     ELSE                                                         04470000
044800         CALL PV-MQCHECK USING PV-REASON                          04480001
044900                               PV-MQ-REASON-TEXT                  04490001
045000         MOVE PV-QM-NAME             TO PE-MQ-QMANAGER            04500001
045100         MOVE CC-TRANS-QUEUE-NAME    TO PE-MQ-QNAME               04510001
045200         MOVE PV-COMPLETION-CODE     TO PE-MQ-COMPLETION-CODE     04520001
045300         MOVE PV-REASON              TO PE-MQ-REASON-CODE         04530001
045400         MOVE '1700-DISCONNECT-QMGR' TO PV-ERROR-MESSAGE          04540001
045500         PERFORM 9200-MQ-ABEND                                    04550001
045600     END-IF.                                                      04560000
045700                                                                  04570000
045800***************************************************************** 04580001
045900**    E N D   O F   M Q   S E R I E S   P A R A G R A P H S    ** 04590001
046000***************************************************************** 04600001
046100******************************************************************04610000
046200* DISPLAY STATISTICS FOR THE PROGRAM                              04620000
046300******************************************************************04630000
046400 8000-EOJ-ROUTINE.                                                04640000
046500                                                                  04650000
046600     DISPLAY ' ********************************************'      04660000
046700     DISPLAY '     * SNKUP101 SUMMARY STATISTICS *         '      04670001
046800     DISPLAY ' '                                                  04680000
046900     DISPLAY '       ---------------------------           '      04690000
047000     DISPLAY '         END ASN ORDER DOWNLOAD              '      04700001
047100     DISPLAY '       ---------------------------           '      04710000
047200     DISPLAY ' '                                                  04720000
047300     DISPLAY ' TOTAL MESSAGES PUT TO QUEUE:' PA-TOTAL-MSGS-PUT    04730000
047400     DISPLAY ' TOTAL MQ COMMITS           :' PA-TOTAL-COMMITS     04740000
047500     DISPLAY ' '                                                  04750000
047600     DISPLAY '********************************************'.      04760000
047700                                                                  04770000
047800****************************************************************  04780000
047900** PERFORM MQ-SERIES ABEND PROCESSING                             04790000
048000****************************************************************  04800000
048100 9200-MQ-ABEND.                                                   04810000
048200                                                                  04820000
048300     DISPLAY '**** ABEND *************************************'.  04830000
048400     DISPLAY '** MQSERIES ERROR **'.                              04840000
048500     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          04850000
048600     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    04860000
048700     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     04870000
048800     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 04880000
048900     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            04890000
049000     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                04900000
049100     DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                04910000
049200     DISPLAY '************************************************'.  04920000
049300     MOVE +4013 TO ABEND-CODE.                                    04930000
049400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04940000
049500                                                                  04950000
049600******************************************************************04960000
049700**                      END OF PROGRAM                          **04970000
049800******************************************************************04980000
