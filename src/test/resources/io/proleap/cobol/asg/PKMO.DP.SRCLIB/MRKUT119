000100 ID  DIVISION.                                                    00010000
000200 PROGRAM-ID.         MRKUT119.                                    00020001
000300 AUTHOR.             LINDA FRIESS.                                00030000
000400 INSTALLATION.       KOHL'S CORPORATION.                          00040000
000500 DATE-WRITTEN.       05-21-2001.                                  00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800***************************************************************** 00080000
000900*     THE PURPOSE OF THIS PROGRAM IS TO CAPTURE E-COMMERCE      * 00090000
001000*     INFOREM SKU/STORES (WITH FT=O) WHERE THE ONHAND = 0       * 00100015
001100*     ON ANY GIVEN DAY WITHIN THE WEEK.                         * 00110000
001200***************************************************************** 00120000
001300*                                                               * 00130000
001400*  CHANGED  99/99/99  AUTHOR.                     WR# 99998     * 00140000
001500*                                                               * 00150000
001700***************************************************************** 00160000
001710* 04/24/2002 - DON TOMLINSON  NI-SKU MR PHASE 4 CHANGES         * 00170003
001720* -  TSKXREF ADDED.                                             * 00180003
001730* -  ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES * 00190003
001740*    IN FIELDS.                                                 * 00200003
001750* -  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE DCLGEN       * 00210003
001760*    FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING STORAGE    * 00220003
001700***************************************************************** 00230012
001710* 06/10/2004 - BOB FORD  WR#26363 - STORE NUMBER EXPANSION      * 00240012
001720*    PROGRAM CHANGED TO HANDLE 5-DIGIT STORE NUMBERS.  CHANGED  * 00250012
001720*    COPYBOOK MRRD119, AND REPLACED TSTR000 WITH XMT_LOC.       * 00260012
001770***************************************************************** 00270003
001710* 05/15/2006 - CHRIS DOMINO  WR#30166 - PROGRAM CHANGED TO      * 00280020
001720*    TO REPLACE ONHAND < CSTOCK WITH ONHAND = 0                 * 00290020
001770***************************************************************** 00300013
001710* 07/21/2009 - TIM LANG WR#36513 ADDED C.LOC_NM = C.LOC_NM      * 00301024
001720*    TO CURSOR FOR OPTIMIZATION                                 * 00302023
001770***************************************************************** 00303023
001800*                                                               * 00310000
001900 ENVIRONMENT DIVISION.                                            00320000
002000 CONFIGURATION SECTION.                                           00330000
002100 SOURCE-COMPUTER.        IBM-370.                                 00340000
002200 OBJECT-COMPUTER.        IBM-370.                                 00350000
002300 INPUT-OUTPUT SECTION.                                            00360000
002400 FILE-CONTROL.                                                    00370000
002500     SELECT ZERO-ONHAND-FILE                                      00380014
002600         ORGANIZATION IS INDEXED                                  00390014
002700         RECORD KEY IS MR119-ZERO-ONHAND-KEY                      00400014
002800         ACCESS IS DYNAMIC                                        00410014
002900         FILE STATUS IS VSAM-STATUS                               00420014
003000         ASSIGN TO INOUT01.                                       00430014
003100                                                                  00440000
003200 DATA DIVISION.                                                   00450000
003300 FILE SECTION.                                                    00460000
003400 FD  ZERO-ONHAND-FILE.                                            00470014
003410     COPY MRRD119.                                                00480011
003420                                                                  00490000
003440 WORKING-STORAGE SECTION.                                         00500000
003450                                                                  00510000
003460 01  SWITCHES.                                                    00520000
003470     05  VSAM-STATUS                PIC X(2).                     00530000
003480         88  SUCCESSFUL                         VALUE '00'.       00540000
003490         88  DUPLICATE-KEY                      VALUE '22'.       00550000
003500     05  ZERO-ONHAND-SW             PIC X(1)    VALUE 'N'.        00560014
               88  END-OF-ZERO-ONHAND                 VALUE 'Y'.        00570014
               88  NOT-END-OF-ZERO-ONHAND             VALUE 'N'.        00580014
003800     05  DESC-SW                    PIC X(1)    VALUE 'N'.        00590000
003900         88  DESC-FOUND                         VALUE 'Y'.        00600000
004000         88  DESC-NOT-FOUND                     VALUE 'N'.        00610000
004100                                                                  00620000
004200 01  VARIABLES.                                                   00630000
004300     05  SQL-SUB                     PIC S9(4)  VALUE +0          00640000
004400                                                COMP SYNC.        00650000
004500     05  SAVE-ITEM-NMBR             PIC S9(15)  COMP-3.           00660000
004600     05  ABEND-CODE                 PIC S9(4)   VALUE 0           00670000
004700                                                COMP SYNC.        00680000
004800     05  RCDS-WRITTEN               PIC S9(9)   VALUE 0           00690000
004900                                                COMP-3.           00700000
005000     05  DISPLAY-RCDS-WRITTEN       PIC 9(9).                     00710000
005200                                                                  00720000
005300 01  CONSTANTS.                                                   00730000
005400     05  MAX-RETRIES                PIC S9(3)   VALUE +3          00740000
005500                                                COMP-3.           00750000
005600                                                                  00760000
005602**                                                                00770002
005603* NI SKU WORK FIELDS FOR CHANGING FIELD FORMATS AND LENGTHS       00780002
005604     COPY ISWS006.                                                00790002
005605                                                                  00800002
005610** NI-SKU DB2 CROSS REFERENCE TABLE                               00810002
005700     EXEC SQL                                                     00820000
005800         INCLUDE TSKXREF                                          00830002
005900     END-EXEC.                                                    00840000
006000                                                                  00850000
006010     EXEC SQL                                                     00860002
006020         INCLUDE TMRITST                                          00870002
006030     END-EXEC.                                                    00880002
006040                                                                  00890002
006100     EXEC SQL                                                     00900002
006200         INCLUDE TSKST                                            00910002
006300     END-EXEC.                                                    00920002
006400                                                                  00930002
006500     EXEC SQL                                                     00940002
006600         INCLUDE TSK                                              00950002
006700     END-EXEC.                                                    00960002
006800                                                                  00970002
006900     EXEC SQL                                                     00980002
007000         INCLUDE XMT00001                                         00990012
007100     END-EXEC.                                                    01000002
007200                                                                  01010002
007300*   DB2 COMMUNICATION AREA                                        01020002
007400     EXEC SQL                                                     01030002
007500        INCLUDE SQLCA                                             01040002
007600     END-EXEC.                                                    01050002
007700                                                                  01060002
007800*   DB2 COMMUNICATION AREA2                                       01070002
007900     COPY SQLCA2.                                                 01080002
008100                                                                  01090014
008100                                                                  01100014
008200     EXEC SQL                                                     01110014
008300         DECLARE ZERO-ONHAND-CSR CURSOR FOR                       01120014
008400         SELECT A.ITEM_NBR,                                       01130014
008500                A.STR_NBR                                         01140014
008600         FROM TMRITST A,                                          01150014
008700              TSKST   B,                                          01160014
008800              XMT_LOC C                                           01170014
008900         WHERE A.ITEM_NBR = B.ITEM_NMBR                           01180014
009000           AND A.STR_NBR  = B.LOC_NBR                             01190014
009100           AND A.STR_NBR  = C.LOC_NBR                             01200014
009200           AND B.ONHAND_QTY = 0                                   01210019
009300           AND A.FT_CDE     = 'O'                                 01220014
009400           AND C.E_BUS_IND  = 'Y'                                 01230014
                 AND C.LOC_NM = C.LOC_NM                                01231022
009500           AND LOC_TYP_CDE  = 'DS'                                01240014
009600         FOR FETCH ONLY                                           01250014
009700     END-EXEC.                                                    01260014
009800                                                                  01270002
009900 PROCEDURE DIVISION.                                              01280002
010000 M000-MAINLINE.                                                   01290002
010100                                                                  01300002
010200     PERFORM A100-INITIALIZATION.                                 01310002
010300                                                                  01320002
           PERFORM B100-COLLECT-ZERO-ONHAND-DATA                        01330014
              UNTIL END-OF-ZERO-ONHAND.                                 01340014
010600                                                                  01350002
010700     PERFORM C100-CLOSE.                                          01360002
010800                                                                  01370002
010900 M000-EXIT.                                                       01380002
011000     EXIT.                                                        01390002
011100     STOP RUN.                                                    01400002
011200                                                                  01410002
011300                                                                  01420002
011400 A100-INITIALIZATION.                                             01430002
011500                                                                  01440002
           OPEN I-O ZERO-ONHAND-FILE.                                   01450014
011700                                                                  01460002
011800     IF SUCCESSFUL                                                01470002
011900         NEXT SENTENCE                                            01480002
012000     ELSE                                                         01490002
               OPEN OUTPUT ZERO-ONHAND-FILE                             01500014
012200         IF SUCCESSFUL                                            01510002
012300             NEXT SENTENCE                                        01520002
012400         ELSE                                                     01530002
012500             DISPLAY 'OPEN UNSUCCESSFUL FOR VSAM FILE INOUT01'    01540002
012600             DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS            01550002
012700             DISPLAY 'PROGRAM = MRKUT119'                         01560002
012800             DISPLAY 'PARAGRAPH A100-INITIALIZATION'              01570002
012900             MOVE 4001 TO ABEND-CODE                              01580002
013000             CALL 'ILBOABN0'  USING ABEND-CODE                    01590014
013100         END-IF                                                   01600014
013200     END-IF.                                                      01610014
013300                                                                  01620014
           EXEC SQL                                                     01630014
               OPEN ZERO-ONHAND-CSR                                     01640014
           END-EXEC.                                                    01650014
013700                                                                  01660014
013800     IF SQLCODE < 0                                               01670014
013900         DISPLAY 'OPEN UNSUCCESSFUL FOR ZERO-ONHAND CURSOR'       01680014
014000         PERFORM U998-SQL-ERROR                                   01690014
014100     END-IF.                                                      01700014
014200                                                                  01710014
014300     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01720014
014400           SQLWARN0 = 'W'                                         01730014
014500         DISPLAY 'OPEN WARNING FOR ZERO-ONHAND CURSOR'            01740014
014600         PERFORM U999-SQL-WARNING                                 01750014
014700     END-IF.                                                      01760014
014800                                                                  01770002
014900 A100-EXIT.                                                       01780002
015000     EXIT.                                                        01790002
015100                                                                  01800002
015200                                                                  01810002
015300 B100-COLLECT-ZERO-ONHAND-DATA.                                   01820014
015400                                                                  01830002
015500     PERFORM B110-FETCH-ZERO-ONHAND.                              01840014
015600                                                                  01850002
015700     IF NOT-END-OF-ZERO-ONHAND                                    01860014
015800                                                                  01870002
015900       MOVE MRITST-STR-NBR        TO MR119-STORE-NBR              01880002
016000                                                                  01890002
016100       MOVE MRITST-ITEM-NBR       TO MR119-ITEM-NBR               01900002
016200                                     SAVE-ITEM-NMBR               01910002
016300                                                                  01920002
016400       SET DESC-FOUND TO TRUE                                     01930002
016500                                                                  01940002
016600       PERFORM B120-SELECT-TSK                                    01950002
016700                                                                  01960002
016800       IF DESC-FOUND                                              01970002
016900         MOVE SKXREF-DEPT           TO NI-DEPT-9-3                01980003
016910         MOVE NI-DEPT-X-3           TO MR119-DEPT-NBR             01990003
017000                                                                  02000002
017100         MOVE SKXREF-SUBCLASS       TO NI-SUB-CLASS-9-2           02010003
017110         MOVE NI-SUB-CLASS-X-2      TO MR119-CLASS-NBR            02020003
017200                                                                  02030002
017300         MOVE TSK-LONG-VENDOR-STYLE TO MR119-VENDOR-STYLE         02040002
017400                                                                  02050002
017500         MOVE TSK-LONG-COLOR-DESC   TO MR119-COLOR-DESC           02060002
017600                                                                  02070002
017900         PERFORM B130-WRITE-ZERO-ONHAND-RCD                       02080014
018000       END-IF                                                     02090002
018100                                                                  02100002
018200     END-IF.                                                      02110002
018300                                                                  02120002
018400 B100-EXIT.                                                       02130002
018500     EXIT.                                                        02140002
018600                                                                  02150002
018700                                                                  02160002
018800 B110-FETCH-ZERO-ONHAND.                                          02170014
018900                                                                  02180002
019000     PERFORM                                                      02190002
019100         WITH TEST AFTER                                          02200002
019200         VARYING SQL-SUB                                          02210002
019300         FROM 1 BY 1                                              02220002
019400         UNTIL SQL-SUB > MAX-RETRIES                              02230002
019500            OR SQLCODE = ZERO                                     02240002
019600            OR SQLCODE = +100                                     02250002
019700         EXEC SQL                                                 02260002
019800             FETCH ZERO-ONHAND-CSR                                02270014
019900                 INTO :MRITST-ITEM-NBR,                           02280002
020000                      :MRITST-STR-NBR                             02290002
020100         END-EXEC                                                 02300002
020200         EVALUATE TRUE                                            02310002
020300             WHEN SQLCODE = ZERO                                  02320002
020400             WHEN SQLCODE = -904                                  02330002
020500             WHEN SQLCODE = -913                                  02340002
020600                 CONTINUE                                         02350002
020700             WHEN SQLCODE = +100                                  02360002
020800                 SET END-OF-ZERO-ONHAND TO TRUE                   02370014
020900             WHEN SQLWARN0 NOT = SPACES                           02380002
021000             WHEN SQLCODE  NOT = ZERO                             02390002
021100                  PERFORM U998-SQL-ERROR                          02400002
021200         END-EVALUATE                                             02410002
021300     END-PERFORM.                                                 02420002
021400                                                                  02430002
021500 B110-EXIT.                                                       02440002
021600     EXIT.                                                        02450002
021700                                                                  02460002
021800                                                                  02470002
021900 B120-SELECT-TSK.                                                 02480002
022000                                                                  02490002
022010     MOVE SAVE-ITEM-NMBR          TO TSK-ITEM-NMBR.               02500002
022020                                                                  02510002
022100     PERFORM                                                      02520002
022200         WITH TEST AFTER                                          02530002
022300         VARYING SQL-SUB                                          02540002
022400         FROM 1 BY 1                                              02550002
022500         UNTIL SQL-SUB > MAX-RETRIES                              02560002
022600            OR SQLCODE = ZERO                                     02570002
022700            OR SQLCODE = +100                                     02580002
022800         EXEC SQL                                                 02590002
022900             SELECT B.DEPT,                                       02600002
023000                    B.SUBCLASS,                                   02610002
023100                    LONG_VENDOR_STYLE,                            02620002
023200                    LONG_COLOR_DESC                               02630002
023300             INTO  :SKXREF-DEPT,                                  02640002
023400                   :SKXREF-SUBCLASS,                              02650002
023500                   :TSK-LONG-VENDOR-STYLE,                        02660002
023600                   :TSK-LONG-COLOR-DESC                           02670002
023700             FROM TSK,                                            02680002
023710                  TSKXREF   B                                     02690002
023800             WHERE ITEM_NMBR = :TSK-ITEM-NMBR                     02700002
023810              AND  ITEM_NMBR = B.ITM_NBR                          02710002
023900         END-EXEC                                                 02720002
024000         EVALUATE TRUE                                            02730002
024100             WHEN SQLCODE = ZERO                                  02740002
024200             WHEN SQLCODE = -904                                  02750002
024300             WHEN SQLCODE = -913                                  02760002
024400                 CONTINUE                                         02770002
024500             WHEN SQLCODE = +100                                  02780002
024600                 SET DESC-NOT-FOUND TO TRUE                       02790002
024700             WHEN SQLWARN0 NOT = SPACES                           02800002
024800             WHEN SQLCODE  NOT = ZERO                             02810002
024900                  PERFORM U998-SQL-ERROR                          02820002
025000         END-EVALUATE                                             02830002
025100     END-PERFORM.                                                 02840002
025200                                                                  02850002
025300 B120-EXIT.                                                       02860002
025400     EXIT.                                                        02870002
025500                                                                  02880002
025600                                                                  02890002
025700 B130-WRITE-ZERO-ONHAND-RCD.                                      02900014
025800                                                                  02910002
025900     WRITE MR119-ZERO-ONHAND-RECORD.                              02920014
026100                                                                  02930008
026200     IF SUCCESSFUL                                                02940008
026300         ADD 1 TO RCDS-WRITTEN                                    02950008
026400     ELSE                                                         02960008
026500         IF DUPLICATE-KEY                                         02970008
026600            CONTINUE                                              02980008
026700         ELSE                                                     02990008
026800             DISPLAY 'WRITE UNSUCCESSFUL FOR VSAM FILE INOUT01'   03000008
026900             DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS            03010008
027000             DISPLAY 'VSAM KEY = ' MR119-ZERO-ONHAND-KEY          03020014
027100             DISPLAY 'PROGRAM = MRKUT119'                         03030008
027200             DISPLAY 'PARAGRAPH B130-WRITE-ZERO-ONHAND-RCD'       03040014
027300             MOVE 4001 TO ABEND-CODE                              03050012
027400             CALL 'ILBOABN0'  USING ABEND-CODE                    03060008
027500         END-IF                                                   03070008
027600     END-IF.                                                      03080008
027700                                                                  03090002
027800 B130-EXIT.                                                       03100002
027900     EXIT.                                                        03110002
028000                                                                  03120002
028100                                                                  03130002
028200 C100-CLOSE.                                                      03140002
028300                                                                  03150002
028400     CLOSE ZERO-ONHAND-FILE.                                      03160014
028500                                                                  03170002
028600     IF SUCCESSFUL                                                03180002
028800         NEXT SENTENCE                                            03190002
028900     ELSE                                                         03200002
029000         DISPLAY 'CLOSE UNSUCCESSFUL FOR VSAM FILE INOUT01'       03210002
029100         DISPLAY 'VSAM STATUS CODE = ' VSAM-STATUS                03220002
029200         DISPLAY 'PROGRAM = MRKUT119'                             03230002
029300         DISPLAY 'PARAGRAPH C100-CLOSE'                           03240002
029400         MOVE 4004 TO ABEND-CODE                                  03250002
029500         CALL 'ILBOABN0'  USING ABEND-CODE                        03260002
029600     END-IF.                                                      03270002
029700                                                                  03280002
029800     MOVE RCDS-WRITTEN TO DISPLAY-RCDS-WRITTEN.                   03290002
029900                                                                  03300002
030000     DISPLAY '*******************************************'.       03310002
030100     DISPLAY '*  TOTAL RCDS WRITTEN:  ' DISPLAY-RCDS-WRITTEN.     03320002
030200     DISPLAY '*******************************************'.       03330002
030300                                                                  03340002
030400     EXEC SQL                                                     03350002
030500         CLOSE ZERO-ONHAND-CSR                                    03360014
030600     END-EXEC.                                                    03370002
030700                                                                  03380002
030800     IF SQLCODE < 0                                               03390002
030900         DISPLAY 'CLOSE UNSUCCESSFUL FOR ZERO-ONHAND CURSOR'      03400014
031000         PERFORM U998-SQL-ERROR                                   03410002
031100     END-IF.                                                      03420002
031200                                                                  03430002
031300     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               03440002
031400           SQLWARN0 = 'W'                                         03450002
031500         DISPLAY 'CLOSE WARNING FOR ZERO-ONHAND CURSOR'           03460014
031600         PERFORM U999-SQL-WARNING                                 03470002
031700     END-IF.                                                      03480002
031800                                                                  03490002
031900 C100-EXIT.                                                       03500002
032000     EXIT.                                                        03510002
032100                                                                  03520002
032200                                                                  03530002
032300 U998-SQL-ERROR.                                                  03540002
032400                                                                  03550002
032500     MOVE SQLCODE    TO SQLCODE2.                                 03560002
032600     MOVE SQLERRD(3) TO SQLERRD3.                                 03570002
032700     DISPLAY '** ABEND **       ** = SQLWARNING'.                 03580002
032800     DISPLAY '** PROGRAM        ** = MRKUT119'.                   03590002
032900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  03600002
033000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  03610002
033100     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   03620002
033200     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  03630002
033300                                                                  03640002
033400     MOVE 4013 TO ABEND-CODE.                                     03650002
033500     CALL 'ILBOABN0' USING ABEND-CODE.                            03660002
033600                                                                  03670002
033700 U998-EXIT.                                                       03680002
033800     EXIT.                                                        03690002
033900                                                                  03700002
034000                                                                  03710002
034100 U999-SQL-WARNING.                                                03720002
034200                                                                  03730002
034300     MOVE SQLCODE    TO SQLCODE2.                                 03740002
034400     MOVE SQLERRD(3) TO SQLERRD3.                                 03750002
034500     DISPLAY '** ABEND **       ** = SQLWARNING'.                 03760002
034600     DISPLAY '** PROGRAM        ** = MRKUT119'.                   03770002
034700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  03780002
034800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  03790002
034900     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  03800002
035000     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  03810002
035100     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  03820002
035200     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  03830002
035300     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  03840002
035400     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  03850002
035500     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  03860002
035600     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  03870002
035700                                                                  03880002
035800     MOVE 4013 TO ABEND-CODE.                                     03890002
035900     CALL 'ILBOABN0' USING ABEND-CODE.                            03900002
