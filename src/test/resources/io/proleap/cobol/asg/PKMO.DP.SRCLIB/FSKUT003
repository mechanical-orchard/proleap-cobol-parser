00001 ******************************************************************08/29/95
00002  IDENTIFICATION DIVISION.                                         FSKUT003
00003 ******************************************************************   LV001
00004  PROGRAM-ID.    FSKUT003.                                         FSKUT003
00005  AUTHOR.        CHUCK ALBERTY -- EXACTA.                          FSKUT003
00006  INSTALLATION.  KOHLS.                                            FSKUT003
00007  DATE-WRITTEN   DECEMBER, 1991.                                   FSKUT003
00008  DATE-COMPILED.                                                   FSKUT003
00009 ******************************************************************FSKUT003
00010 *  THIS PROGRAM EXTRACTS DATA FROM THE MERCHANDISE BUSINESS       FSKUT003
00011 *  STRUCTURE TABLES WHICH IS THEN SORTED AND USED AS INPUT TO     FSKUT003
00012 *  A VARIETY OF PROGRAMS.  THIS PROGRAM CAN EXTRACT DATA FROM     FSKUT003
00013 *  MBS FOR 'ALL' ROWS OF MBS OR BY SPECIFIC SELECTION OF ANY      FSKUT003
00014 *  OF THE FOLLOWING:                                              FSKUT003
00015 *      GMM                                                        FSKUT003
00016 *      DMM                                                        FSKUT003
00017 *      BUYER                                                      FSKUT003
00018 *      DEPT                                                       FSKUT003
00019 *                                                                 FSKUT003
00020 *  BY SELECTING 'ALL', YOU WOULD GET THE FOLLOWING RESULTS:       FSKUT003
00021 *      ALL GMM         RECORDS                                    FSKUT003
00022 *      ALL DMM         RECORDS                                    FSKUT003
00023 *      ALL BUYER       RECORDS                                    FSKUT003
00024 *      ALL DEPARTMENT  RECORDS                                    FSKUT003
00025 *      ALL MAJOR CLASS RECORDS                                    FSKUT003
00026 *      ALL SUB CLASS   RECORDS                                    FSKUT003
00027 *                                                                 FSKUT003
00028 *  BY SELECTING A SPECIFIC GMM, YOU WOULD GET THE FOLLOWING       FSKUT003
00029 *  RESULTS:                                                       FSKUT003
00030 *      GMM RECORD                                                 FSKUT003
00031 *      DMM'S          WITHIN GMM                                  FSKUT003
00032 *      BUYERS         WITHIN DMM'S                                FSKUT003
00033 *      DEPARTMENTS    WITHIN BUYERS                               FSKUT003
00034 *      MAJOR CLASSES  WITHIN DEPARTMENTS                          FSKUT003
00035 *      SUB CLASSES    WITHIN MAJOR CLASSES                        FSKUT003
00036 *                                                                 FSKUT003
00037 *  BY SELECTING A SPECIFIC DMM, YOU WOULD GET THE FOLLOWING       FSKUT003
00038 *  RESULTS:                                                       FSKUT003
00039 *      GMM RECORD     FOR DMM                                     FSKUT003
00040 *      DMM RECORD                                                 FSKUT003
00041 *      BUYERS         WITHIN DMM                                  FSKUT003
00042 *      DEPARTMENTS    WITHIN BUYERS                               FSKUT003
00043 *      MAJOR CLASSES  WITHIN DEPARTMENTS                          FSKUT003
00044 *      SUB CLASSES    WITHIN MAJOR CLASSES                        FSKUT003
00045 *                                                                 FSKUT003
00046 *  BY SELECTING A SPECIFIC BUYER, YOU WOULD GET THE FOLLOWING     FSKUT003
00047 *  RESULTS:                                                       FSKUT003
00048 *      GMM RECORD     FOR BUYER                                   FSKUT003
00049 *      DMM RECORD     FOR BUYER                                   FSKUT003
00050 *      BUYER RECORD                                               FSKUT003
00051 *      DEPARTMENTS    WITHIN BUYER                                FSKUT003
00052 *      MAJOR CLASSES  WITHIN DEPARTMENTS                          FSKUT003
00053 *      SUB CLASSES    WITHIN MAJOR CLASSES                        FSKUT003
00054 *                                                                 FSKUT003
00055 *  BY SELECTING A SPECIFIC DEPARTMENT, YOU WOULD GET THE FOLLOWINGFSKUT003
00056 *  RESULTS:                                                       FSKUT003
00057 *      GMM RECORD     FOR DEPARTMENT                              FSKUT003
00058 *      DMM RECORD     FOR DEPARTMENT                              FSKUT003
00059 *      BUYER RECORD   FOR DEPARTMENT                              FSKUT003
00060 *      DEPARTMENT RECORD                                          FSKUT003
00061 *      MAJOR CLASSES  WITHIN DEPARTMENT                           FSKUT003
00062 *      SUB CLASSES    WITHIN MAJOR CLASSES                        FSKUT003
00063 ******************************************************************FSKUT003
00064 *                                                                 FSKUT003
00065 *                                                                 FSKUT003
00066 ******************************************************************FSKUT003
00067  ENVIRONMENT DIVISION.                                            FSKUT003
00068 ******************************************************************FSKUT003
00069  CONFIGURATION SECTION.                                           FSKUT003
00070 *                                                                 FSKUT003
00071  SOURCE-COMPUTER.        IBM-3090.                                FSKUT003
00072  OBJECT-COMPUTER.        IBM-3090.                                FSKUT003
00073 *                                                                 FSKUT003
00074  INPUT-OUTPUT SECTION.                                            FSKUT003
00075 *                                                                 FSKUT003
00076  FILE-CONTROL.                                                    FSKUT003
00077 *                                                                 FSKUT003
00078      SELECT CONTROL-CARD-FILE-IN                                  FSKUT003
00079          ASSIGN TO SYSIN.                                         FSKUT003
00080 *                                                                 FSKUT003
00081      SELECT MBS-STRUCTURE-FILE-OUT                                FSKUT003
00082          ASSIGN TO OUT01.                                         FSKUT003
00083 *                                                                 FSKUT003
00084 *                                                                 FSKUT003
00085 ******************************************************************FSKUT003
00086  DATA DIVISION.                                                   FSKUT003
00087 ******************************************************************FSKUT003
00088  FILE SECTION.                                                    FSKUT003
00089 *                                                                 FSKUT003
00090  FD  CONTROL-CARD-FILE-IN                                         FSKUT003
00091      RECORDING MODE IS F                                          FSKUT003
00092      BLOCK CONTAINS 0 RECORDS                                     FSKUT003
00093      LABEL RECORDS ARE STANDARD.                                  FSKUT003
00094 *                                                                 FSKUT003
00095  01  CONTROL-CARD-RECORD-IN           PIC X(80).                  FSKUT003
00096 *                                                                 FSKUT003
00097 *                                                                 FSKUT003
00098  FD  MBS-STRUCTURE-FILE-OUT                                       FSKUT003
00099      RECORDING MODE IS F                                          FSKUT003
00100      BLOCK CONTAINS 0 RECORDS                                     FSKUT003
00101      LABEL RECORDS ARE STANDARD.                                  FSKUT003
00102 *                                                                 FSKUT003
00103  01  MBS-STRUCTURE-RECORD-OUT        PIC  X(48).                  FSKUT003
00104 *                                                                 FSKUT003
00105 *                                                                 FSKUT003
00106  WORKING-STORAGE SECTION.                                         FSKUT003
00107 *                                                                 FSKUT003
00108  01  PC-PROGRAM-CONSTANTS.                                        FSKUT003
00109      05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          FSKUT003
00110          'FSKUT003'.                                              FSKUT003
00111                                                                   FSKUT003
00112      05  PC-CURRENT-OPER-CO          PIC  X(03)    VALUE '03'.    FSKUT003
00113      05  PC-APLSYS-FASHION-SALES     PIC  X(02)    VALUE 'FS'.    FSKUT003
00114      05  PC-MDSELV-GMA               PIC  X(03)    VALUE 'GMA'.   FSKUT003
00115      05  PC-MDSELV-DMA               PIC  X(03)    VALUE 'DMA'.   FSKUT003
00116      05  PC-MDSELV-DPT               PIC  X(03)    VALUE 'DPT'.   FSKUT003
00117      05  PC-MDSELV-MCL               PIC  X(03)    VALUE 'MCL'.   FSKUT003
00118      05  PC-MDSELV-SCL               PIC  X(03)    VALUE 'SCL'.   FSKUT003
00119      05  PC-RSPLVL-CDE-BYR           PIC  X(03)    VALUE 'BYR'.   FSKUT003
00120      05  PC-RSPLVL-CDE-DMM           PIC  X(03)    VALUE 'DMM'.   FSKUT003
00121      05  PC-RSPLVL-CDE-GMM           PIC  X(03)    VALUE 'GMM'.   FSKUT003
00122 *                                                                 FSKUT003
00123 *                                                                 FSKUT003
00124  01  CC-CONTROL-CARD.                                             FSKUT003
00125      05  CC-1-72.                                                 FSKUT003
00126          10  CC-CONTROL              PIC  X(07)    VALUE SPACES.  FSKUT003
00127              88  CC-CONTROL-VALID                  VALUE          FSKUT003
00128              'CONTROL'.                                           FSKUT003
00129          10  FILLER                  PIC  X(01)    VALUE SPACE.   FSKUT003
00130          10  CC-TYPE                 PIC  X(03)    VALUE SPACES.  FSKUT003
00131              88  CC-TYPE-GMM                       VALUE 'GMM'.   FSKUT003
00132              88  CC-TYPE-DMM                       VALUE 'DMM'.   FSKUT003
00133              88  CC-TYPE-BYR                       VALUE 'BYR'.   FSKUT003
00134              88  CC-TYPE-DPT                       VALUE 'DPT'.   FSKUT003
00135              88  CC-TYPE-ALL                       VALUE 'ALL'.   FSKUT003
00136          10  FILLER                  PIC  X(01)    VALUE SPACE.   FSKUT003
00137          10  CC-NUMBER               PIC  9(03)    VALUE ZERO.    FSKUT003
00138          10  CC-NUMBER-X REDEFINES CC-NUMBER                      FSKUT003
00139                                      PIC  X(03).                  FSKUT003
00140          10  FILLER                  PIC  X(57)    VALUE SPACES.  FSKUT003
00141      05  CC-73-80                    PIC  X(08)    VALUE SPACES.  FSKUT003
00142 *                                                                 FSKUT003
00143 *                                                                 FSKUT003
00144  01  PS-PROGRAM-SWITCHES.                                         FSKUT003
00145      05  PS-CONTROL-CARD-EOF-SW      PIC  X(03)    VALUE 'BOF'.   FSKUT003
00146          88  PS-CONTROL-CARD-EOF                   VALUE 'EOF'.   FSKUT003
00147      05  PS-CONTROL-CARD-VALID-SW    PIC  X(01)    VALUE SPACE.   FSKUT003
00148          88  PS-CONTROL-CARD-INVALID               VALUE 'N'.     FSKUT003
00149          88  PS-CONTROL-CARD-VALID                 VALUE 'Y'.     FSKUT003
00150 *                                                                 FSKUT003
00151 *                                                                 FSKUT003
00152  01  PV-PROGRAM-VARIABLES.                                        FSKUT003
00153      05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     FSKUT003
00154                                                    COMP.          FSKUT003
00155      05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  FSKUT003
00156      05  PV-CC-INPUT-CNT             PIC S9(03)    VALUE ZERO     FSKUT003
00157                                                    COMP-3.        FSKUT003
00158      05  PV-CC-MBS-VALID-CNT         PIC S9(03)    VALUE ZERO     FSKUT003
00159                                                    COMP-3.        FSKUT003
00160      05  PV-CC-MBS-INVALID-CNT       PIC S9(03)    VALUE ZERO     FSKUT003
00161                                                    COMP-3.        FSKUT003
00162      05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  FSKUT003
00163                                                                   FSKUT003
00164      05  PV-SAVE-BUYER               PIC  X(03)    VALUE SPACES.  FSKUT003
00165      05  PV-SAVE-DKEY                PIC S9(06)    VALUE ZERO     FSKUT003
00166                                                    COMP-3.        FSKUT003
00167      05  PV-GMM-DMM                  PIC  X(02)    VALUE SPACES.  FSKUT003
00168      05  PV-BYR-DPT                  PIC  X(03)    VALUE SPACES.  FSKUT003
00169 *                                                                 FSKUT003
00170 *                                                                 FSKUT003
00171  01  PE-PROGRAM-ERROR-MESSAGES.                                   FSKUT003
00172      05  PE-MSG-01                   PIC  X(30)    VALUE          FSKUT003
00173          'OPEN OF ALL_CSR               '.                        FSKUT003
00174      05  PE-MSG-02                   PIC  X(30)    VALUE          FSKUT003
00175          'FETCH OF ALL_CSR              '.                        FSKUT003
00176      05  PE-MSG-03                   PIC  X(30)    VALUE          FSKUT003
00177          'OPEN OF GMM_CSR               '.                        FSKUT003
00178      05  PE-MSG-04                   PIC  X(30)    VALUE          FSKUT003
00179          'FETCH OF GMM_CSR              '.                        FSKUT003
00180      05  PE-MSG-05                   PIC  X(30)    VALUE          FSKUT003
00181          'CLOSE OF GMM_CSR              '.                        FSKUT003
00182      05  PE-MSG-06                   PIC  X(30)    VALUE          FSKUT003
00183          'OPEN OF DMM_CSR               '.                        FSKUT003
00184      05  PE-MSG-07                   PIC  X(30)    VALUE          FSKUT003
00185          'FETCH OF DMM_CSR              '.                        FSKUT003
00186      05  PE-MSG-08                   PIC  X(30)    VALUE          FSKUT003
00187          'CLOSE OF DMM_CSR              '.                        FSKUT003
00188      05  PE-MSG-09                   PIC  X(30)    VALUE          FSKUT003
00189          'OPEN OF BYR_CSR               '.                        FSKUT003
00190      05  PE-MSG-10                   PIC  X(30)    VALUE          FSKUT003
00191          'FETCH OF BYR_CSR              '.                        FSKUT003
00192      05  PE-MSG-11                   PIC  X(30)    VALUE          FSKUT003
00193          'CLOSE OF BYR_CSR              '.                        FSKUT003
00194      05  PE-MSG-12                   PIC  X(30)    VALUE          FSKUT003
00195          'OPEN OF DPT_CSR               '.                        FSKUT003
00196      05  PE-MSG-13                   PIC  X(30)    VALUE          FSKUT003
00197          'FETCH OF DPT_CSR              '.                        FSKUT003
00198      05  PE-MSG-14                   PIC  X(30)    VALUE          FSKUT003
00199          'CLOSE OF DPT_CSR              '.                        FSKUT003
00200 *                                                                 FSKUT003
00201 *                                                                 FSKUT003
00202 ******************************************************************FSKUT003
00203 *  RECORD LAYOUT FOR MBS STRUCTURE RECORD                         FSKUT003
00204 ******************************************************************FSKUT003
00205      COPY FSRD001O.                                               FSKUT003
00206 *                                                                 FSKUT003
00207 *                                                                 FSKUT003
00208 ******************************************************************FSKUT003
00209 *  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       FSKUT003
00210 ******************************************************************FSKUT003
00211      COPY DPWS004.                                                FSKUT003
00212 *                                                                 FSKUT003
00213 *                                                                 FSKUT003
00214 ******************************************************************FSKUT003
00215 *  COMMUNICATIONS AREA FOR DB2                                    FSKUT003
00216 ******************************************************************FSKUT003
00217      EXEC SQL                                                     FSKUT003
00218           INCLUDE SQLCA                                           FSKUT003
00219      END-EXEC.                                                    FSKUT003
00220 *                                                                 FSKUT003
00221 *                                                                 FSKUT003
00222 ******************************************************************FSKUT003
00223 *  TMDSEAR DCLGEN  (MERCHANDISE AREA TABLE)                       FSKUT003
00224 ******************************************************************FSKUT003
00225      EXEC SQL                                                     FSKUT003
00226           INCLUDE TMDSEAR                                         FSKUT003
00227      END-EXEC.                                                    FSKUT003
00228 *                                                                 FSKUT003
00229 *                                                                 FSKUT003
00230 ******************************************************************FSKUT003
00231 *  TAPLAVL DCLGEN  (APPLICATION AVAILABILITY TABLE)               FSKUT003
00232 ******************************************************************FSKUT003
00233      EXEC SQL                                                     FSKUT003
00234           INCLUDE TAPLAVL                                         FSKUT003
00235      END-EXEC.                                                    FSKUT003
00236 *                                                                 FSKUT003
00237 *                                                                 FSKUT003
00238 ******************************************************************FSKUT003
00239 *  TRSPBAR DCLGEN  (RESPONSIBILITY AREA TABLE)                    FSKUT003
00240 ******************************************************************FSKUT003
00241      EXEC SQL                                                     FSKUT003
00242           INCLUDE TRSPBAR                                         FSKUT003
00243      END-EXEC.                                                    FSKUT003
00244 *                                                                 FSKUT003
00245 *                                                                 FSKUT003
00246 ******************************************************************FSKUT003
00247 **  CURSOR USED TO RETRIEVE SKU AND SKU/STORE COLUMNS FOR ONE     FSKUT003
00248 **  SPECIFIC GMM                                                  FSKUT003
00249 ******************************************************************FSKUT003
00250      EXEC SQL                                                     FSKUT003
00251           DECLARE GMM_CSR CURSOR FOR                              FSKUT003
00252            SELECT GMA_NBR,                                        FSKUT003
00253                   DMA_NBR,                                        FSKUT003
00254                   DEPT_NBR,                                       FSKUT003
00255                   MAJ_CL_NBR,                                     FSKUT003
00256                   SUB_CL_NBR,                                     FSKUT003
00257                   BYR_NBR,                                        FSKUT003
00258                   MDSELV_CDE,                                     FSKUT003
00259                   MDSEAR_DESC,                                    FSKUT003
00260                   A.MDSEAR_DKEY                                   FSKUT003
00261              FROM TMDSEAR A,                                      FSKUT003
00262                   TAPLAVL B                                       FSKUT003
00263             WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                   FSKUT003
00264               AND A.OPERCO_NBR  = :PC-CURRENT-OPER-CO             FSKUT003
00265               AND A.OPERCO_NBR  = B.OPERCO_NBR                    FSKUT003
00266               AND (MDSELV_CDE   = :PC-MDSELV-GMA                  FSKUT003
00267                    OR                                             FSKUT003
00268                    MDSELV_CDE   = :PC-MDSELV-DMA                  FSKUT003
00269                    OR                                             FSKUT003
00270                    MDSELV_CDE   = :PC-MDSELV-DPT                  FSKUT003
00271                    OR                                             FSKUT003
00272                    MDSELV_CDE   = :PC-MDSELV-MCL                  FSKUT003
00273                    OR                                             FSKUT003
00274                    MDSELV_CDE   = :PC-MDSELV-SCL)                 FSKUT003
00275               AND GMA_NBR       = :PV-GMM-DMM                     FSKUT003
00276               AND (CURRENT DATE                                   FSKUT003
00277                            BETWEEN CHAR(STRT_DTE,ISO)             FSKUT003
00278                                AND CHAR(END_DTE,ISO))             FSKUT003
00279               AND (CURRENT DATE                                   FSKUT003
00280                            BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)    FSKUT003
00281                                AND CHAR(B.MDSEAR_END_DTE,ISO))    FSKUT003
00282               AND B.APLSYS_CDE  = :PC-APLSYS-FASHION-SALES        FSKUT003
00283             ORDER BY GMA_NBR,                                     FSKUT003
00284                      DMA_NBR,                                     FSKUT003
00285                      DEPT_NBR,                                    FSKUT003
00286                      MAJ_CL_NBR,                                  FSKUT003
00287                      SUB_CL_NBR                                   FSKUT003
00288      END-EXEC.                                                    FSKUT003
00289 *                                                                 FSKUT003
00290 *                                                                 FSKUT003
00291 ******************************************************************FSKUT003
00292 **  CURSOR USED TO RETRIEVE SKU AND SKU/STORE COLUMNS FOR ONE     FSKUT003
00293 **  SPECIFIC DMM                                                  FSKUT003
00294 ******************************************************************FSKUT003
00295      EXEC SQL                                                     FSKUT003
00296           DECLARE DMM_CSR CURSOR FOR                              FSKUT003
00297            SELECT GMA_NBR,                                        FSKUT003
00298                   DMA_NBR,                                        FSKUT003
00299                   DEPT_NBR,                                       FSKUT003
00300                   MAJ_CL_NBR,                                     FSKUT003
00301                   SUB_CL_NBR,                                     FSKUT003
00302                   BYR_NBR,                                        FSKUT003
00303                   MDSELV_CDE,                                     FSKUT003
00304                   MDSEAR_DESC,                                    FSKUT003
00305                   A.MDSEAR_DKEY                                   FSKUT003
00306              FROM TMDSEAR A,                                      FSKUT003
00307                   TAPLAVL B                                       FSKUT003
00308             WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                   FSKUT003
00309               AND A.OPERCO_NBR  = :PC-CURRENT-OPER-CO             FSKUT003
00310               AND A.OPERCO_NBR  = B.OPERCO_NBR                    FSKUT003
00311               AND (MDSELV_CDE   = :PC-MDSELV-DMA                  FSKUT003
00312                    OR                                             FSKUT003
00313                    MDSELV_CDE   = :PC-MDSELV-DPT                  FSKUT003
00314                    OR                                             FSKUT003
00315                    MDSELV_CDE   = :PC-MDSELV-MCL                  FSKUT003
00316                    OR                                             FSKUT003
00317                    MDSELV_CDE   = :PC-MDSELV-SCL)                 FSKUT003
00318               AND DMA_NBR       = :PV-GMM-DMM                     FSKUT003
00319               AND (CURRENT DATE                                   FSKUT003
00320                            BETWEEN CHAR(STRT_DTE,ISO)             FSKUT003
00321                                AND CHAR(END_DTE,ISO))             FSKUT003
00322               AND (CURRENT DATE                                   FSKUT003
00323                            BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)    FSKUT003
00324                                AND CHAR(B.MDSEAR_END_DTE,ISO))    FSKUT003
00325               AND B.APLSYS_CDE  = :PC-APLSYS-FASHION-SALES        FSKUT003
00326             ORDER BY DMA_NBR,                                     FSKUT003
00327                      DEPT_NBR,                                    FSKUT003
00328                      MAJ_CL_NBR,                                  FSKUT003
00329                      SUB_CL_NBR                                   FSKUT003
00330      END-EXEC.                                                    FSKUT003
00331 *                                                                 FSKUT003
00332 *                                                                 FSKUT003
00333 ******************************************************************FSKUT003
00334 **  CURSOR USED TO RETRIEVE SKU AND SKU/STORE COLUMNS FOR ONE     FSKUT003
00335 **  SPECIFIC BUYER                                                FSKUT003
00336 ******************************************************************FSKUT003
00337      EXEC SQL                                                     FSKUT003
00338           DECLARE BYR_CSR CURSOR FOR                              FSKUT003
00339            SELECT GMA_NBR,                                        FSKUT003
00340                   DMA_NBR,                                        FSKUT003
00341                   DEPT_NBR,                                       FSKUT003
00342                   MAJ_CL_NBR,                                     FSKUT003
00343                   SUB_CL_NBR,                                     FSKUT003
00344                   BYR_NBR,                                        FSKUT003
00345                   MDSELV_CDE,                                     FSKUT003
00346                   MDSEAR_DESC,                                    FSKUT003
00347                   A.MDSEAR_DKEY                                   FSKUT003
00348              FROM TMDSEAR A,                                      FSKUT003
00349                   TAPLAVL B                                       FSKUT003
00350             WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                   FSKUT003
00351               AND A.OPERCO_NBR  = :PC-CURRENT-OPER-CO             FSKUT003
00352               AND A.OPERCO_NBR  = B.OPERCO_NBR                    FSKUT003
00353               AND (MDSELV_CDE   = :PC-MDSELV-DPT                  FSKUT003
00354                    OR                                             FSKUT003
00355                    MDSELV_CDE   = :PC-MDSELV-MCL                  FSKUT003
00356                    OR                                             FSKUT003
00357                    MDSELV_CDE   = :PC-MDSELV-SCL)                 FSKUT003
00358               AND BYR_NBR       = :PV-BYR-DPT                     FSKUT003
00359               AND (CURRENT DATE                                   FSKUT003
00360                            BETWEEN CHAR(STRT_DTE,ISO)             FSKUT003
00361                                AND CHAR(END_DTE,ISO))             FSKUT003
00362               AND (CURRENT DATE                                   FSKUT003
00363                            BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)    FSKUT003
00364                                AND CHAR(B.MDSEAR_END_DTE,ISO))    FSKUT003
00365               AND B.APLSYS_CDE  = :PC-APLSYS-FASHION-SALES        FSKUT003
00366             ORDER BY DEPT_NBR,                                    FSKUT003
00367                      MAJ_CL_NBR,                                  FSKUT003
00368                      SUB_CL_NBR                                   FSKUT003
00369      END-EXEC.                                                    FSKUT003
00370 *                                                                 FSKUT003
00371 *                                                                 FSKUT003
00372 ******************************************************************FSKUT003
00373 **  CURSOR USED TO RETRIEVE SKU AND SKU/STORE COLUMNS FOR ONE     FSKUT003
00374 **  SPECIFIC DEPARTMENT                                           FSKUT003
00375 ******************************************************************FSKUT003
00376      EXEC SQL                                                     FSKUT003
00377           DECLARE DPT_CSR CURSOR FOR                              FSKUT003
00378            SELECT GMA_NBR,                                        FSKUT003
00379                   DMA_NBR,                                        FSKUT003
00380                   DEPT_NBR,                                       FSKUT003
00381                   MAJ_CL_NBR,                                     FSKUT003
00382                   SUB_CL_NBR,                                     FSKUT003
00383                   BYR_NBR,                                        FSKUT003
00384                   MDSELV_CDE,                                     FSKUT003
00385                   MDSEAR_DESC,                                    FSKUT003
00386                   A.MDSEAR_DKEY                                   FSKUT003
00387              FROM TMDSEAR A,                                      FSKUT003
00388                   TAPLAVL B                                       FSKUT003
00389             WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                   FSKUT003
00390               AND A.OPERCO_NBR  = :PC-CURRENT-OPER-CO             FSKUT003
00391               AND A.OPERCO_NBR  = B.OPERCO_NBR                    FSKUT003
00392               AND (MDSELV_CDE   = :PC-MDSELV-DPT                  FSKUT003
00393                    OR                                             FSKUT003
00394                    MDSELV_CDE   = :PC-MDSELV-MCL                  FSKUT003
00395                    OR                                             FSKUT003
00396                    MDSELV_CDE   = :PC-MDSELV-SCL)                 FSKUT003
00397               AND DEPT_NBR      = :PV-BYR-DPT                     FSKUT003
00398               AND (CURRENT DATE                                   FSKUT003
00399                            BETWEEN CHAR(STRT_DTE,ISO)             FSKUT003
00400                                AND CHAR(END_DTE,ISO))             FSKUT003
00401               AND (CURRENT DATE                                   FSKUT003
00402                            BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)    FSKUT003
00403                                AND CHAR(B.MDSEAR_END_DTE,ISO))    FSKUT003
00404               AND B.APLSYS_CDE  = :PC-APLSYS-FASHION-SALES        FSKUT003
00405             ORDER BY DEPT_NBR,                                    FSKUT003
00406                      MAJ_CL_NBR,                                  FSKUT003
00407                      SUB_CL_NBR                                   FSKUT003
00408      END-EXEC.                                                    FSKUT003
00409 *                                                                 FSKUT003
00410 *                                                                 FSKUT003
00411 ******************************************************************FSKUT003
00412 **  CURSOR USED TO RETRIEVE SKU AND SKU/STORE COLUMNS FOR 'ALL'   FSKUT003
00413 **  OF MBS (ALL GMM'S, DMM'S, BUYERS AND DEPARTMENTS)             FSKUT003
00414 ******************************************************************FSKUT003
00415      EXEC SQL                                                     FSKUT003
00416           DECLARE ALL_CSR CURSOR FOR                              FSKUT003
00417            SELECT GMA_NBR,                                        FSKUT003
00418                   DMA_NBR,                                        FSKUT003
00419                   DEPT_NBR,                                       FSKUT003
00420                   MAJ_CL_NBR,                                     FSKUT003
00421                   SUB_CL_NBR,                                     FSKUT003
00422                   BYR_NBR,                                        FSKUT003
00423                   MDSELV_CDE,                                     FSKUT003
00424                   MDSEAR_DESC,                                    FSKUT003
00425                   A.MDSEAR_DKEY                                   FSKUT003
00426              FROM TMDSEAR A,                                      FSKUT003
00427                   TAPLAVL B                                       FSKUT003
00428             WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                   FSKUT003
00429               AND A.OPERCO_NBR  = :PC-CURRENT-OPER-CO             FSKUT003
00430               AND A.OPERCO_NBR  = B.OPERCO_NBR                    FSKUT003
00431               AND (MDSELV_CDE   = :PC-MDSELV-GMA                  FSKUT003
00432                    OR                                             FSKUT003
00433                    MDSELV_CDE   = :PC-MDSELV-DMA                  FSKUT003
00434                    OR                                             FSKUT003
00435                    MDSELV_CDE   = :PC-MDSELV-DPT                  FSKUT003
00436                    OR                                             FSKUT003
00437                    MDSELV_CDE   = :PC-MDSELV-MCL                  FSKUT003
00438                    OR                                             FSKUT003
00439                    MDSELV_CDE   = :PC-MDSELV-SCL)                 FSKUT003
00440               AND (CURRENT DATE                                   FSKUT003
00441                            BETWEEN CHAR(STRT_DTE,ISO)             FSKUT003
00442                                AND CHAR(END_DTE,ISO))             FSKUT003
00443               AND (CURRENT DATE                                   FSKUT003
00444                            BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)    FSKUT003
00445                                AND CHAR(B.MDSEAR_END_DTE,ISO))    FSKUT003
00446               AND B.APLSYS_CDE  = :PC-APLSYS-FASHION-SALES        FSKUT003
00447             ORDER BY GMA_NBR,                                     FSKUT003
00448                      DMA_NBR,                                     FSKUT003
00449                      BYR_NBR,                                     FSKUT003
00450                      DEPT_NBR,                                    FSKUT003
00451                      MAJ_CL_NBR,                                  FSKUT003
00452                      SUB_CL_NBR                                   FSKUT003
00453      END-EXEC.                                                    FSKUT003
00454 *                                                                 FSKUT003
00455 *                                                                 FSKUT003
00456 ******************************************************************FSKUT003
00457  PROCEDURE DIVISION.                                              FSKUT003
00458 ******************************************************************FSKUT003
00459                                                                   FSKUT003
00460 ******************************************************************FSKUT003
00461 *  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   FSKUT003
00462 ******************************************************************FSKUT003
00463  0000-PROGRAM-MAINLINE.                                           FSKUT003
00464      PERFORM 1000-INITIALIZE.                                     FSKUT003
00465 *                                                                 FSKUT003
00466      PERFORM 2000-PROCESS-CONTROL-CARDS                           FSKUT003
00467        UNTIL PS-CONTROL-CARD-EOF.                                 FSKUT003
00468 *                                                                 FSKUT003
00469      PERFORM 9000-EOJ-ROUTINE.                                    FSKUT003
00470 *                                                                 FSKUT003
00471      STOP RUN.                                                    FSKUT003
00472 *                                                                 FSKUT003
00473 *                                                                 FSKUT003
00474 ******************************************************************FSKUT003
00475 *  PERFORM PROGRAM INITIALIZATION TASKS:                          FSKUT003
00476 *    -- OPEN INPUT  FILE (CONTROL CARD FILE)                      FSKUT003
00477 *    -- OPEN OUTPUT FILE (MBS STRUCTURE FILE)                     FSKUT003
00478 *    -- PERFORM FIRST READ OF INPUT FILE                          FSKUT003
00479 ******************************************************************FSKUT003
00480  1000-INITIALIZE.                                                 FSKUT003
00481      OPEN INPUT  CONTROL-CARD-FILE-IN                             FSKUT003
00482           OUTPUT MBS-STRUCTURE-FILE-OUT.                          FSKUT003
00483 *                                                                 FSKUT003
00484      PERFORM 8000-READ-CONTROL-CARD.                              FSKUT003
00485 *                                                                 FSKUT003
00486 *                                                                 FSKUT003
00487 ******************************************************************FSKUT003
00488 *  LOOP THROUGH CONTROL CARD FILE.  PROCESS EACH CONTROL CARD.    FSKUT003
00489 *  IF ANY CONTROL CARD IS SET UP AS 'ALL', SET THE END OF FILE    FSKUT003
00490 *  SWITCH TO STOP PROCESSING.                                     FSKUT003
00491 ******************************************************************FSKUT003
00492  2000-PROCESS-CONTROL-CARDS.                                      FSKUT003
00493      PERFORM 2100-VALIDATE-CONTROL-CARD.                          FSKUT003
00494 *                                                                 FSKUT003
00495      IF  PS-CONTROL-CARD-VALID                                    FSKUT003
00496          EVALUATE TRUE                                            FSKUT003
00497              WHEN CC-TYPE-ALL                                     FSKUT003
00498                   PERFORM 3000-ALL-PROCESS                        FSKUT003
00499              WHEN CC-TYPE-GMM                                     FSKUT003
00500                   PERFORM 3100-GMM-PROCESS                        FSKUT003
00501              WHEN CC-TYPE-DMM                                     FSKUT003
00502                   PERFORM 3200-DMM-PROCESS                        FSKUT003
00503              WHEN CC-TYPE-BYR                                     FSKUT003
00504                   PERFORM 3300-BYR-PROCESS                        FSKUT003
00505              WHEN CC-TYPE-DPT                                     FSKUT003
00506                   PERFORM 3400-DPT-PROCESS                        FSKUT003
00507          END-EVALUATE                                             FSKUT003
00508      ELSE                                                         FSKUT003
00509          ADD 1                   TO PV-CC-MBS-INVALID-CNT         FSKUT003
00510      END-IF.                                                      FSKUT003
00511                                                                   FSKUT003
00512      IF  CC-TYPE-ALL                                              FSKUT003
00513          CONTINUE                                                 FSKUT003
00514      ELSE                                                         FSKUT003
00515          PERFORM 8000-READ-CONTROL-CARD                           FSKUT003
00516      END-IF.                                                      FSKUT003
00517 *                                                                 FSKUT003
00518 *                                                                 FSKUT003
00519 ******************************************************************FSKUT003
00520 *  DISPLAY AND VALIDATE THE CONTROL CARD.                         FSKUT003
00521 ******************************************************************FSKUT003
00522  2100-VALIDATE-CONTROL-CARD.                                      FSKUT003
00523      DISPLAY ' '.                                                 FSKUT003
00524      DISPLAY 'FSKUT003 CONTROL CARD -- ' CC-1-72.                 FSKUT003
00525      ADD 1                       TO PV-CC-INPUT-CNT.              FSKUT003
00526 *                                                                 FSKUT003
00527      IF  CC-CONTROL-VALID                                         FSKUT003
00528          SET PS-CONTROL-CARD-VALID                                FSKUT003
00529                                  TO TRUE                          FSKUT003
00530      ELSE                                                         FSKUT003
00531          SET PS-CONTROL-CARD-INVALID TO TRUE                      FSKUT003
00532          DISPLAY 'CONTROL CARD BYPASSED -- '                      FSKUT003
00533                  'CONTROL CONSTANT ENTERED ('                     FSKUT003
00534                   CC-CONTROL                                      FSKUT003
00535                   ') IS INVALID'                                  FSKUT003
00536      END-IF.                                                      FSKUT003
00537 *                                                                 FSKUT003
00538      EVALUATE TRUE                                                FSKUT003
00539          WHEN CC-TYPE-ALL                                         FSKUT003
00540               SET PS-CONTROL-CARD-EOF TO TRUE                     FSKUT003
00541               DISPLAY 'TYPE ALL -- END OF PROCESSING FORCED'      FSKUT003
00542          WHEN CC-TYPE-GMM                                         FSKUT003
00543          WHEN CC-TYPE-DMM                                         FSKUT003
00544               MOVE CC-NUMBER     TO PV-GMM-DMM                    FSKUT003
00545               IF  PV-GMM-DMM NUMERIC                              FSKUT003
00546                   CONTINUE                                        FSKUT003
00547               ELSE                                                FSKUT003
00548                   SET PS-CONTROL-CARD-INVALID TO TRUE             FSKUT003
00549                   DISPLAY 'CONTROL CARD BYPASSED -- '             FSKUT003
00550                           'NUMBER ENTERED ('                      FSKUT003
00551                           PV-GMM-DMM                              FSKUT003
00552                           ') IS INVALID'                          FSKUT003
00553               END-IF                                              FSKUT003
00554          WHEN CC-TYPE-BYR                                         FSKUT003
00555          WHEN CC-TYPE-DPT                                         FSKUT003
00556               MOVE CC-NUMBER     TO PV-BYR-DPT                    FSKUT003
00557               IF  PV-BYR-DPT NUMERIC                              FSKUT003
00558                   CONTINUE                                        FSKUT003
00559               ELSE                                                FSKUT003
00560                   SET PS-CONTROL-CARD-INVALID TO TRUE             FSKUT003
00561                   DISPLAY 'CONTROL CARD BYPASSED -- '             FSKUT003
00562                           'NUMBER ENTERED ('                      FSKUT003
00563                           PV-BYR-DPT                              FSKUT003
00564                           ') IS INVALID'                          FSKUT003
00565               END-IF                                              FSKUT003
00566          WHEN OTHER                                               FSKUT003
00567               SET PS-CONTROL-CARD-INVALID TO TRUE                 FSKUT003
00568               DISPLAY 'CONTROL CARD BYPASSED -- TYPE ENTERED ('   FSKUT003
00569                       CC-TYPE                                     FSKUT003
00570                       ') IS INVALID'                              FSKUT003
00571      END-EVALUATE.                                                FSKUT003
00572 *                                                                 FSKUT003
00573 *                                                                 FSKUT003
00574 ******************************************************************FSKUT003
00575 *  OPEN ALL CURSOR AND DO FIRST FETCH.  PERFORM A LOOP THAT WILL  FSKUT003
00576 *  CREATE ALL OUTPUT RECORDS FOR THE ENTIRE MBS STRUCTURE.        FSKUT003
00577 ******************************************************************FSKUT003
00578  3000-ALL-PROCESS.                                                FSKUT003
00579      PERFORM 7000-OPEN-ALL-CSR.                                   FSKUT003
00580      PERFORM 7010-FETCH-ALL-CSR.                                  FSKUT003
00581 *                                                                 FSKUT003
00582      IF  SQLCODE = ZERO                                           FSKUT003
00583          ADD 1                   TO PV-CC-MBS-VALID-CNT           FSKUT003
00584          DISPLAY 'CONTROL CARD PROCESSED'                         FSKUT003
00585          PERFORM 3010-ALL-LOOP                                    FSKUT003
00586            UNTIL SQLCODE = +100                                   FSKUT003
00587      ELSE                                                         FSKUT003
00588          ADD 1                   TO PV-CC-MBS-INVALID-CNT         FSKUT003
00589          DISPLAY 'CONTROL CARD BYPASSED -- ALL ENTERED ('         FSKUT003
00590                  CC-NUMBER-X                                      FSKUT003
00591                  '), BUT NO MBS DATA FOUND'                       FSKUT003
00592      END-IF.                                                      FSKUT003
00593 *                                                                 FSKUT003
00594 *                                                                 FSKUT003
00595 ******************************************************************FSKUT003
00596 *  CREATE THE 'GMM', 'DMM', 'BYR', 'DPT', 'MCL' AND 'SCL' OUTPUT  FSKUT003
00597 *  RECORDS FOR ALL OF MBS.  THIS PARAGRAPH IS A LOOP.             FSKUT003
00598 ******************************************************************FSKUT003
00599  3010-ALL-LOOP.                                                   FSKUT003
00600      EVALUATE TRUE                                                FSKUT003
00601          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-GMA                   FSKUT003
00602               PERFORM 3900-FORMAT-GMM-OUTPUT                      FSKUT003
00603          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DMA                   FSKUT003
00604               PERFORM 3910-FORMAT-DMM-OUTPUT                      FSKUT003
00605          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DPT                   FSKUT003
00606               PERFORM 3920-FORMAT-DPT-OUTPUT                      FSKUT003
00607          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-MCL                   FSKUT003
00608               PERFORM 3940-FORMAT-MCL-OUTPUT                      FSKUT003
00609          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-SCL                   FSKUT003
00610               PERFORM 3950-FORMAT-SCL-OUTPUT                      FSKUT003
00611      END-EVALUATE.                                                FSKUT003
00612 *                                                                 FSKUT003
00613      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00614       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00615 *                                                                 FSKUT003
00616      PERFORM 7010-FETCH-ALL-CSR.                                  FSKUT003
00617 *                                                                 FSKUT003
00618 *                                                                 FSKUT003
00619 ******************************************************************FSKUT003
00620 *  OPEN GMM CURSOR AND DO FIRST FETCH.  PERFORM A LOOP THAT WILL  FSKUT003
00621 *  WILL CREATE ALL OUTPUT RECORDS FOR THE SELECTED GMM.           FSKUT003
00622 ******************************************************************FSKUT003
00623  3100-GMM-PROCESS.                                                FSKUT003
00624      PERFORM 7100-OPEN-GMM-CSR.                                   FSKUT003
00625      PERFORM 7110-FETCH-GMM-CSR.                                  FSKUT003
00626 *                                                                 FSKUT003
00627      IF  SQLCODE = ZERO                                           FSKUT003
00628          ADD 1                   TO PV-CC-MBS-VALID-CNT           FSKUT003
00629          DISPLAY 'CONTROL CARD PROCESSED'                         FSKUT003
00630          PERFORM 3110-GMM-LOOP                                    FSKUT003
00631            UNTIL SQLCODE = +100                                   FSKUT003
00632      ELSE                                                         FSKUT003
00633          ADD 1                   TO PV-CC-MBS-INVALID-CNT         FSKUT003
00634          DISPLAY 'CONTROL CARD BYPASSED -- GMM ENTERED ('         FSKUT003
00635                  PV-GMM-DMM                                       FSKUT003
00636                  ') NOT FOUND'                                    FSKUT003
00637      END-IF.                                                      FSKUT003
00638 *                                                                 FSKUT003
00639      PERFORM 7120-CLOSE-GMM-CSR.                                  FSKUT003
00640 *                                                                 FSKUT003
00641 *                                                                 FSKUT003
00642 ******************************************************************FSKUT003
00643 *  CREATE THE 'GMM', 'DMM', 'BYR', 'DPT', 'MCL' AND 'SCL' OUTPUT  FSKUT003
00644 *  RECORDS FOR THE SELECTED GMM.  THIS PARAGRAPH IS A LOOP.       FSKUT003
00645 ******************************************************************FSKUT003
00646  3110-GMM-LOOP.                                                   FSKUT003
00647      EVALUATE TRUE                                                FSKUT003
00648          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-GMA                   FSKUT003
00649               PERFORM 3900-FORMAT-GMM-OUTPUT                      FSKUT003
00650          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DMA                   FSKUT003
00651               PERFORM 3910-FORMAT-DMM-OUTPUT                      FSKUT003
00652          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DPT                   FSKUT003
00653               PERFORM 3920-FORMAT-DPT-OUTPUT                      FSKUT003
00654          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-MCL                   FSKUT003
00655               PERFORM 3940-FORMAT-MCL-OUTPUT                      FSKUT003
00656          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-SCL                   FSKUT003
00657               PERFORM 3950-FORMAT-SCL-OUTPUT                      FSKUT003
00658      END-EVALUATE.                                                FSKUT003
00659 *                                                                 FSKUT003
00660      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00661       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00662 *                                                                 FSKUT003
00663      PERFORM 7110-FETCH-GMM-CSR.                                  FSKUT003
00664 *                                                                 FSKUT003
00665 *                                                                 FSKUT003
00666 ******************************************************************FSKUT003
00667 *  OPEN DMM CURSOR AND DO FIRST FETCH.  BUILD 'GMA' OUTPUT RECORD FSKUT003
00668 *  FOR THE SELECTED DMM.  PERFORM A LOOP THAT WILL CREATE ALL     FSKUT003
00669 *  OTHER OUTPUT RECORDS FOR THE SELECTED DMM.                     FSKUT003
00670 ******************************************************************FSKUT003
00671  3200-DMM-PROCESS.                                                FSKUT003
00672      PERFORM 7200-OPEN-DMM-CSR.                                   FSKUT003
00673      PERFORM 7210-FETCH-DMM-CSR.                                  FSKUT003
00674 *                                                                 FSKUT003
00675      IF  SQLCODE = ZERO                                           FSKUT003
00676          ADD 1                   TO PV-CC-MBS-VALID-CNT           FSKUT003
00677          DISPLAY 'CONTROL CARD PROCESSED'                         FSKUT003
00678          MOVE MDSEAR-DKEY        TO PV-SAVE-DKEY                  FSKUT003
00679          PERFORM 4000-SELECT-GMA                                  FSKUT003
00680          MOVE PV-SAVE-DKEY       TO MDSEAR-DKEY                   FSKUT003
00681          PERFORM 3210-DMM-LOOP                                    FSKUT003
00682            UNTIL SQLCODE = +100                                   FSKUT003
00683      ELSE                                                         FSKUT003
00684          ADD 1                   TO PV-CC-MBS-INVALID-CNT         FSKUT003
00685          DISPLAY 'CONTROL CARD BYPASSED -- DMM ENTERED ('         FSKUT003
00686                  PV-GMM-DMM                                       FSKUT003
00687                  ') NOT FOUND'                                    FSKUT003
00688      END-IF.                                                      FSKUT003
00689 *                                                                 FSKUT003
00690      PERFORM 7220-CLOSE-DMM-CSR.                                  FSKUT003
00691 *                                                                 FSKUT003
00692 *                                                                 FSKUT003
00693 ******************************************************************FSKUT003
00694 *  CREATE THE 'DMM', 'BYR', 'DPT', 'MCL' AND 'SCL' OUTPUT         FSKUT003
00695 *  RECORDS FOR THE SELECTED DMM.  THIS PARAGRAPH IS A LOOP.       FSKUT003
00696 ******************************************************************FSKUT003
00697  3210-DMM-LOOP.                                                   FSKUT003
00698      EVALUATE TRUE                                                FSKUT003
00699          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DMA                   FSKUT003
00700               PERFORM 3910-FORMAT-DMM-OUTPUT                      FSKUT003
00701          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DPT                   FSKUT003
00702               PERFORM 3920-FORMAT-DPT-OUTPUT                      FSKUT003
00703          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-MCL                   FSKUT003
00704               PERFORM 3940-FORMAT-MCL-OUTPUT                      FSKUT003
00705          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-SCL                   FSKUT003
00706               PERFORM 3950-FORMAT-SCL-OUTPUT                      FSKUT003
00707      END-EVALUATE.                                                FSKUT003
00708 *                                                                 FSKUT003
00709      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00710       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00711 *                                                                 FSKUT003
00712      PERFORM 7210-FETCH-DMM-CSR.                                  FSKUT003
00713 *                                                                 FSKUT003
00714 *                                                                 FSKUT003
00715 ******************************************************************FSKUT003
00716 *  OPEN BYR CURSOR AND DO FIRST FETCH.  BUILD 'GMA' AND 'DMA'     FSKUT003
00717 *  OUTPUT RECORDS FOR THE SELECTED BUYER.  PERFORM A LOOP THAT    FSKUT003
00718 *  WILL CREATE ALL OTHER OUTPUT RECORDS FOR THE SELECTED BUYER.   FSKUT003
00719 ******************************************************************FSKUT003
00720  3300-BYR-PROCESS.                                                FSKUT003
00721      PERFORM 7300-OPEN-BYR-CSR.                                   FSKUT003
00722      PERFORM 7310-FETCH-BYR-CSR.                                  FSKUT003
00723 *                                                                 FSKUT003
00724      IF  SQLCODE = ZERO                                           FSKUT003
00725          ADD 1                   TO PV-CC-MBS-VALID-CNT           FSKUT003
00726          DISPLAY 'CONTROL CARD PROCESSED'                         FSKUT003
00727          MOVE MDSEAR-DKEY        TO PV-SAVE-DKEY                  FSKUT003
00728          PERFORM 4000-SELECT-GMA                                  FSKUT003
00729          PERFORM 4100-SELECT-DMA                                  FSKUT003
00730          MOVE PV-SAVE-DKEY       TO MDSEAR-DKEY                   FSKUT003
00731          PERFORM 3310-BUYER-LOOP                                  FSKUT003
00732            UNTIL SQLCODE = +100                                   FSKUT003
00733      ELSE                                                         FSKUT003
00734          ADD 1                   TO PV-CC-MBS-INVALID-CNT         FSKUT003
00735          DISPLAY 'CONTROL CARD BYPASSED -- BUYER ENTERED ('       FSKUT003
00736                  CC-NUMBER-X                                      FSKUT003
00737                  ') NOT FOUND'                                    FSKUT003
00738      END-IF.                                                      FSKUT003
00739 *                                                                 FSKUT003
00740      PERFORM 7320-CLOSE-BYR-CSR.                                  FSKUT003
00741 *                                                                 FSKUT003
00742 *                                                                 FSKUT003
00743 ******************************************************************FSKUT003
00744 *  CREATE THE 'BYR', 'DPT', 'MCL' AND 'SCL' OUTPUT RECORDS FOR    FSKUT003
00745 *  THE SELECTED BUYER.  THIS PARAGRAPH IS A LOOP.                 FSKUT003
00746 ******************************************************************FSKUT003
00747  3310-BUYER-LOOP.                                                 FSKUT003
00748      EVALUATE TRUE                                                FSKUT003
00749          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DPT                   FSKUT003
00750               PERFORM 3920-FORMAT-DPT-OUTPUT                      FSKUT003
00751          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-MCL                   FSKUT003
00752               PERFORM 3940-FORMAT-MCL-OUTPUT                      FSKUT003
00753          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-SCL                   FSKUT003
00754               PERFORM 3950-FORMAT-SCL-OUTPUT                      FSKUT003
00755      END-EVALUATE.                                                FSKUT003
00756 *                                                                 FSKUT003
00757      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00758       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00759 *                                                                 FSKUT003
00760      PERFORM 7310-FETCH-BYR-CSR.                                  FSKUT003
00761 *                                                                 FSKUT003
00762 *                                                                 FSKUT003
00763 ******************************************************************FSKUT003
00764 *  OPEN DPT CURSOR AND DO FIRST FETCH.  BUILD 'GMA', 'DMA' AND    FSKUT003
00765 *  'BYR' OUTPUT RECORDS FOR THE SELECTED BUYER.  PERFORM A LOOP   FSKUT003
00766 *  THAT WILL CREATE ALL OTHER OUTPUT RECORDS FOR THE SELECTED     FSKUT003
00767 *  DEPARTMENT.                                                    FSKUT003
00768 *  RECORDS FOR THE SELECTED DEPARTMENT.                           FSKUT003
00769 ******************************************************************FSKUT003
00770  3400-DPT-PROCESS.                                                FSKUT003
00771      PERFORM 7400-OPEN-DPT-CSR.                                   FSKUT003
00772      PERFORM 7410-FETCH-DPT-CSR.                                  FSKUT003
00773 *                                                                 FSKUT003
00774      IF  SQLCODE = ZERO                                           FSKUT003
00775          ADD 1                   TO PV-CC-MBS-VALID-CNT           FSKUT003
00776          DISPLAY 'CONTROL CARD PROCESSED'                         FSKUT003
00777          MOVE MDSEAR-DKEY        TO PV-SAVE-DKEY                  FSKUT003
00778          PERFORM 4000-SELECT-GMA                                  FSKUT003
00779          PERFORM 4100-SELECT-DMA                                  FSKUT003
00780          MOVE PV-SAVE-DKEY       TO MDSEAR-DKEY                   FSKUT003
00781          PERFORM 3410-DEPT-LOOP                                   FSKUT003
00782            UNTIL SQLCODE = +100                                   FSKUT003
00783      ELSE                                                         FSKUT003
00784          ADD 1                   TO PV-CC-MBS-INVALID-CNT         FSKUT003
00785          DISPLAY 'CONTROL CARD BYPASSED -- DEPT ENTERED ('        FSKUT003
00786                  CC-NUMBER-X                                      FSKUT003
00787                  ') NOT FOUND'                                    FSKUT003
00788      END-IF.                                                      FSKUT003
00789 *                                                                 FSKUT003
00790      PERFORM 7420-CLOSE-DPT-CSR.                                  FSKUT003
00791 *                                                                 FSKUT003
00792 *                                                                 FSKUT003
00793 ******************************************************************FSKUT003
00794 *  CREATE THE 'DPT', 'MCL' AND 'SCL' OUTPUT RECORDS FOR THE       FSKUT003
00795 *  SELECTED DEPARTMENT.  THIS PARAGRAPH IS A LOOP.                FSKUT003
00796 ******************************************************************FSKUT003
00797  3410-DEPT-LOOP.                                                  FSKUT003
00798      EVALUATE TRUE                                                FSKUT003
00799          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-DPT                   FSKUT003
00800               MOVE MDSEAR-GMA-NBR    TO FS001O-GMM                FSKUT003
00801               MOVE MDSEAR-DMA-NBR    TO FS001O-DMM                FSKUT003
00802               MOVE MDSEAR-BYR-NBR    TO FS001O-BUYER              FSKUT003
00803               PERFORM 3930-FORMAT-BYR-OUTPUT                      FSKUT003
00804               MOVE MDSEAR-DEPT-NBR   TO FS001O-DEPT               FSKUT003
00805               MOVE SPACES            TO FS001O-MAJ-CLASS          FSKUT003
00806                                         FS001O-SUB-CLASS          FSKUT003
00807               MOVE MDSEAR-MDSELV-CDE TO FS001O-LEVEL              FSKUT003
00808               MOVE MDSEAR-DESC       TO FS001O-DESC               FSKUT003
00809          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-MCL                   FSKUT003
00810               PERFORM 3940-FORMAT-MCL-OUTPUT                      FSKUT003
00811          WHEN MDSEAR-MDSELV-CDE = PC-MDSELV-SCL                   FSKUT003
00812               PERFORM 3950-FORMAT-SCL-OUTPUT                      FSKUT003
00813      END-EVALUATE.                                                FSKUT003
00814 *                                                                 FSKUT003
00815      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00816       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00817 *                                                                 FSKUT003
00818      PERFORM 7410-FETCH-DPT-CSR.                                  FSKUT003
00819 *                                                                 FSKUT003
00820 *                                                                 FSKUT003
00821 ******************************************************************FSKUT003
00822 *  FORMAT 'GMM' OUTPUT RECORD                                     FSKUT003
00823 ******************************************************************FSKUT003
00824  3900-FORMAT-GMM-OUTPUT.                                          FSKUT003
00825      MOVE MDSEAR-GMA-NBR         TO FS001O-GMM.                   FSKUT003
00826      MOVE SPACES                 TO FS001O-DMM                    FSKUT003
00827                                     FS001O-BUYER                  FSKUT003
00828                                     FS001O-DEPT                   FSKUT003
00829                                     FS001O-MAJ-CLASS              FSKUT003
00830                                     FS001O-SUB-CLASS.             FSKUT003
00831      MOVE MDSEAR-MDSELV-CDE      TO FS001O-LEVEL.                 FSKUT003
00832      PERFORM 4200-GET-GMM-NAME.                                   FSKUT003
00833 *                                                                 FSKUT003
00834 *                                                                 FSKUT003
00835 ******************************************************************FSKUT003
00836 *  FORMAT 'DMM' OUTPUT RECORD                                     FSKUT003
00837 ******************************************************************FSKUT003
00838  3910-FORMAT-DMM-OUTPUT.                                          FSKUT003
00839      MOVE MDSEAR-GMA-NBR         TO FS001O-GMM.                   FSKUT003
00840      MOVE MDSEAR-DMA-NBR         TO FS001O-DMM.                   FSKUT003
00841      MOVE SPACES                 TO FS001O-BUYER                  FSKUT003
00842                                     FS001O-DEPT                   FSKUT003
00843                                     FS001O-MAJ-CLASS              FSKUT003
00844                                     FS001O-SUB-CLASS.             FSKUT003
00845      MOVE MDSEAR-MDSELV-CDE      TO FS001O-LEVEL.                 FSKUT003
00846      PERFORM 4300-GET-DMM-NAME.                                   FSKUT003
00847 *                                                                 FSKUT003
00848 *                                                                 FSKUT003
00849 ******************************************************************FSKUT003
00850 *  FORMAT 'DPT' OUTPUT RECORD                                     FSKUT003
00851 ******************************************************************FSKUT003
00852  3920-FORMAT-DPT-OUTPUT.                                          FSKUT003
00853      MOVE MDSEAR-GMA-NBR         TO FS001O-GMM.                   FSKUT003
00854      MOVE MDSEAR-DMA-NBR         TO FS001O-DMM.                   FSKUT003
00855      MOVE MDSEAR-BYR-NBR         TO FS001O-BUYER.                 FSKUT003
00856 *                                                                 FSKUT003
00857      IF  MDSEAR-BYR-NBR = PV-SAVE-BUYER                           FSKUT003
00858          CONTINUE                                                 FSKUT003
00859      ELSE                                                         FSKUT003
00860          PERFORM 3930-FORMAT-BYR-OUTPUT                           FSKUT003
00861          MOVE MDSEAR-BYR-NBR     TO PV-SAVE-BUYER                 FSKUT003
00862      END-IF.                                                      FSKUT003
00863 *                                                                 FSKUT003
00864      MOVE MDSEAR-DEPT-NBR        TO FS001O-DEPT.                  FSKUT003
00865      MOVE SPACES                 TO FS001O-MAJ-CLASS              FSKUT003
00866                                     FS001O-SUB-CLASS.             FSKUT003
00867      MOVE MDSEAR-MDSELV-CDE      TO FS001O-LEVEL.                 FSKUT003
00868      MOVE MDSEAR-DESC            TO FS001O-DESC.                  FSKUT003
00869 *                                                                 FSKUT003
00870 *                                                                 FSKUT003
00871 ******************************************************************FSKUT003
00872 *  FORMAT 'BYR' OUTPUT RECORD                                     FSKUT003
00873 ******************************************************************FSKUT003
00874  3930-FORMAT-BYR-OUTPUT.                                          FSKUT003
00875      MOVE SPACES                 TO FS001O-DEPT                   FSKUT003
00876                                     FS001O-MAJ-CLASS              FSKUT003
00877                                     FS001O-SUB-CLASS.             FSKUT003
00878      MOVE PC-RSPLVL-CDE-BYR      TO FS001O-LEVEL.                 FSKUT003
00879 *                                                                 FSKUT003
00880      PERFORM 4400-GET-BUYER-NAME.                                 FSKUT003
00881 *                                                                 FSKUT003
00882      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00883       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00884 *                                                                 FSKUT003
00885 *                                                                 FSKUT003
00886 ******************************************************************FSKUT003
00887 *  FORMAT 'MCL' OUTPUT RECORD                                     FSKUT003
00888 ******************************************************************FSKUT003
00889  3940-FORMAT-MCL-OUTPUT.                                          FSKUT003
00890      MOVE MDSEAR-GMA-NBR         TO FS001O-GMM.                   FSKUT003
00891      MOVE MDSEAR-DMA-NBR         TO FS001O-DMM.                   FSKUT003
00892      MOVE MDSEAR-BYR-NBR         TO FS001O-BUYER.                 FSKUT003
00893      MOVE MDSEAR-DEPT-NBR        TO FS001O-DEPT.                  FSKUT003
00894      MOVE MDSEAR-MAJ-CL-NBR      TO FS001O-MAJ-CLASS.             FSKUT003
00895      MOVE SPACES                 TO FS001O-SUB-CLASS.             FSKUT003
00896      MOVE MDSEAR-MDSELV-CDE      TO FS001O-LEVEL.                 FSKUT003
00897      MOVE MDSEAR-DESC            TO FS001O-DESC.                  FSKUT003
00898 *                                                                 FSKUT003
00899 *                                                                 FSKUT003
00900 ******************************************************************FSKUT003
00901 *  FORMAT 'SCL' OUTPUT RECORD                                     FSKUT003
00902 ******************************************************************FSKUT003
00903  3950-FORMAT-SCL-OUTPUT.                                          FSKUT003
00904      MOVE MDSEAR-GMA-NBR         TO FS001O-GMM.                   FSKUT003
00905      MOVE MDSEAR-DMA-NBR         TO FS001O-DMM.                   FSKUT003
00906      MOVE MDSEAR-BYR-NBR         TO FS001O-BUYER.                 FSKUT003
00907      MOVE MDSEAR-DEPT-NBR        TO FS001O-DEPT.                  FSKUT003
00908      MOVE MDSEAR-MAJ-CL-NBR      TO FS001O-MAJ-CLASS.             FSKUT003
00909      MOVE MDSEAR-SUB-CL-NBR      TO FS001O-SUB-CLASS.             FSKUT003
00910      MOVE MDSEAR-MDSELV-CDE      TO FS001O-LEVEL.                 FSKUT003
00911      MOVE MDSEAR-DESC            TO FS001O-DESC.                  FSKUT003
00912 *                                                                 FSKUT003
00913 *                                                                 FSKUT003
00914 ******************************************************************FSKUT003
00915 *  BUILD 'GMA' RECORD                                             FSKUT003
00916 ******************************************************************FSKUT003
00917  4000-SELECT-GMA.                                                 FSKUT003
00918      EXEC SQL                                                     FSKUT003
00919            SELECT MDSEAR_DKEY                                     FSKUT003
00920              INTO :MDSEAR-DKEY                                    FSKUT003
00921              FROM TMDSEAR                                         FSKUT003
00922             WHERE OPERCO_NBR   = :PC-CURRENT-OPER-CO              FSKUT003
00923               AND MDSELV_CDE   = :PC-MDSELV-GMA                   FSKUT003
00924               AND GMA_NBR      = :MDSEAR-GMA-NBR                  FSKUT003
00925               AND (CURRENT DATE                                   FSKUT003
00926                            BETWEEN CHAR(STRT_DTE,ISO)             FSKUT003
00927                                AND CHAR(END_DTE,ISO))             FSKUT003
00928      END-EXEC.                                                    FSKUT003
00929 *                                                                 FSKUT003
00930      EVALUATE TRUE                                                FSKUT003
00931          WHEN SQLCODE = ZERO                                      FSKUT003
00932               CONTINUE                                            FSKUT003
00933          WHEN SQLWARN0 NOT = SPACES                               FSKUT003
00934          WHEN SQLCODE < ZERO                                      FSKUT003
00935          WHEN SQLCODE > ZERO                                      FSKUT003
00936               MOVE '4000-SELECT-GMA'                              FSKUT003
00937                                  TO PV-ABEND-PARAGRAPH            FSKUT003
00938               MOVE 'SELECT OF TMDSEAR'                            FSKUT003
00939                                  TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
00940               PERFORM 9200-SQL-ABEND                              FSKUT003
00941      END-EVALUATE.                                                FSKUT003
00942 *                                                                 FSKUT003
00943      MOVE MDSEAR-GMA-NBR             TO FS001O-GMM.               FSKUT003
00944      MOVE SPACES                     TO FS001O-DMM                FSKUT003
00945                                         FS001O-BUYER              FSKUT003
00946                                         FS001O-DEPT               FSKUT003
00947                                         FS001O-MAJ-CLASS          FSKUT003
00948                                         FS001O-SUB-CLASS.         FSKUT003
00949      MOVE PC-MDSELV-GMA              TO FS001O-LEVEL.             FSKUT003
00950      PERFORM 4200-GET-GMM-NAME.                                   FSKUT003
00951      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00952       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00953 *                                                                 FSKUT003
00954 *                                                                 FSKUT003
00955 ******************************************************************FSKUT003
00956 *  BUILD 'DMA' RECORD                                             FSKUT003
00957 ******************************************************************FSKUT003
00958  4100-SELECT-DMA.                                                 FSKUT003
00959      EXEC SQL                                                     FSKUT003
00960            SELECT MDSEAR_DKEY                                     FSKUT003
00961              INTO :MDSEAR-DKEY                                    FSKUT003
00962              FROM TMDSEAR                                         FSKUT003
00963             WHERE OPERCO_NBR   = :PC-CURRENT-OPER-CO              FSKUT003
00964               AND MDSELV_CDE   = :PC-MDSELV-DMA                   FSKUT003
00965               AND GMA_NBR      = :MDSEAR-GMA-NBR                  FSKUT003
00966               AND DMA_NBR      = :MDSEAR-DMA-NBR                  FSKUT003
00967               AND (CURRENT DATE                                   FSKUT003
00968                            BETWEEN CHAR(STRT_DTE,ISO)             FSKUT003
00969                                AND CHAR(END_DTE,ISO))             FSKUT003
00970      END-EXEC.                                                    FSKUT003
00971 *                                                                 FSKUT003
00972      EVALUATE TRUE                                                FSKUT003
00973          WHEN SQLCODE = ZERO                                      FSKUT003
00974               CONTINUE                                            FSKUT003
00975          WHEN SQLWARN0 NOT = SPACES                               FSKUT003
00976          WHEN SQLCODE < ZERO                                      FSKUT003
00977          WHEN SQLCODE > ZERO                                      FSKUT003
00978               MOVE '4100-SELECT-DMA'                              FSKUT003
00979                                  TO PV-ABEND-PARAGRAPH            FSKUT003
00980               MOVE 'SELECT OF TMDSEAR'                            FSKUT003
00981                                  TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
00982               PERFORM 9200-SQL-ABEND                              FSKUT003
00983      END-EVALUATE.                                                FSKUT003
00984 *                                                                 FSKUT003
00985      MOVE MDSEAR-GMA-NBR             TO FS001O-GMM.               FSKUT003
00986      MOVE MDSEAR-DMA-NBR             TO FS001O-DMM.               FSKUT003
00987      MOVE SPACES                     TO FS001O-BUYER              FSKUT003
00988                                         FS001O-DEPT               FSKUT003
00989                                         FS001O-MAJ-CLASS          FSKUT003
00990                                         FS001O-SUB-CLASS.         FSKUT003
00991      MOVE PC-MDSELV-DMA              TO FS001O-LEVEL.             FSKUT003
00992      PERFORM 4300-GET-DMM-NAME.                                   FSKUT003
00993      WRITE MBS-STRUCTURE-RECORD-OUT                               FSKUT003
00994       FROM FS001O-MBS-STRUCTURE-RECORD.                           FSKUT003
00995 *                                                                 FSKUT003
00996 *                                                                 FSKUT003
00997 ******************************************************************FSKUT003
00998 *  GET THE GMM NAME                                               FSKUT003
00999 ******************************************************************FSKUT003
01000  4200-GET-GMM-NAME.                                               FSKUT003
01001      MOVE PC-RSPLVL-CDE-GMM      TO RSPBAR-RSPLVL-CDE.            FSKUT003
01002      PERFORM 4500-GET-WORKER-NAME.                                FSKUT003
01003 *                                                                 FSKUT003
01004      INITIALIZE FS001O-DESC.                                      FSKUT003
01005 *                                                                 FSKUT003
01006      EVALUATE TRUE                                                FSKUT003
01007          WHEN SQLCODE = ZERO                                      FSKUT003
01008               STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY '  '     FSKUT003
01009                                       SPACE DELIMITED BY SIZE     FSKUT003
01010                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE    FSKUT003
01011                 INTO FS001O-DESC                                  FSKUT003
01012               END-STRING                                          FSKUT003
01013          WHEN SQLCODE = +100                                      FSKUT003
01014               MOVE '*** GMM NOT FOUND ***'                        FSKUT003
01015                                  TO FS001O-DESC                   FSKUT003
01016          WHEN SQLWARN0 NOT = SPACES                               FSKUT003
01017          WHEN SQLCODE < ZERO                                      FSKUT003
01018          WHEN SQLCODE > ZERO                                      FSKUT003
01019               MOVE '4200-GET-GMM-NAME'                            FSKUT003
01020                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01021               MOVE 'SELECT OF TRSPBAR'                            FSKUT003
01022                                  TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01023               PERFORM 9200-SQL-ABEND                              FSKUT003
01024      END-EVALUATE.                                                FSKUT003
01025 *                                                                 FSKUT003
01026 *                                                                 FSKUT003
01027 ******************************************************************FSKUT003
01028 *  GET THE DMM NAME                                               FSKUT003
01029 ******************************************************************FSKUT003
01030  4300-GET-DMM-NAME.                                               FSKUT003
01031      MOVE PC-RSPLVL-CDE-DMM      TO RSPBAR-RSPLVL-CDE.            FSKUT003
01032      PERFORM 4500-GET-WORKER-NAME.                                FSKUT003
01033 *                                                                 FSKUT003
01034      INITIALIZE FS001O-DESC.                                      FSKUT003
01035 *                                                                 FSKUT003
01036      EVALUATE TRUE                                                FSKUT003
01037          WHEN SQLCODE = ZERO                                      FSKUT003
01038               STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY '  '     FSKUT003
01039                                       SPACE DELIMITED BY SIZE     FSKUT003
01040                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE    FSKUT003
01041                 INTO FS001O-DESC                                  FSKUT003
01042               END-STRING                                          FSKUT003
01043          WHEN SQLCODE = +100                                      FSKUT003
01044               MOVE '*** DMM NOT FOUND ***'                        FSKUT003
01045                                  TO FS001O-DESC                   FSKUT003
01046          WHEN SQLWARN0 NOT = SPACES                               FSKUT003
01047          WHEN SQLCODE < ZERO                                      FSKUT003
01048          WHEN SQLCODE > ZERO                                      FSKUT003
01049               MOVE '4300-GET-DMM-NAME'                            FSKUT003
01050                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01051               MOVE 'SELECT OF TRSPBAR'                            FSKUT003
01052                                  TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01053               PERFORM 9200-SQL-ABEND                              FSKUT003
01054      END-EVALUATE.                                                FSKUT003
01055 *                                                                 FSKUT003
01056 *                                                                 FSKUT003
01057 ******************************************************************FSKUT003
01058 *  GET THE BUYER NAME                                             FSKUT003
01059 ******************************************************************FSKUT003
01060  4400-GET-BUYER-NAME.                                             FSKUT003
01061      MOVE PC-RSPLVL-CDE-BYR      TO RSPBAR-RSPLVL-CDE.            FSKUT003
01062      PERFORM 4500-GET-WORKER-NAME.                                FSKUT003
01063 *                                                                 FSKUT003
01064      INITIALIZE FS001O-DESC.                                      FSKUT003
01065 *                                                                 FSKUT003
01066      EVALUATE TRUE                                                FSKUT003
01067          WHEN SQLCODE = ZERO                                      FSKUT003
01068               STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY '  '     FSKUT003
01069                                       SPACE DELIMITED BY SIZE     FSKUT003
01070                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE    FSKUT003
01071                 INTO FS001O-DESC                                  FSKUT003
01072               END-STRING                                          FSKUT003
01073          WHEN SQLCODE = +100                                      FSKUT003
01074               MOVE '*** BUYER NOT FOUND ***'                      FSKUT003
01075                                  TO FS001O-DESC                   FSKUT003
01076          WHEN SQLWARN0 NOT = SPACES                               FSKUT003
01077          WHEN SQLCODE < ZERO                                      FSKUT003
01078          WHEN SQLCODE > ZERO                                      FSKUT003
01079               MOVE '4400-GET-BUYER-NAME'                          FSKUT003
01080                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01081               MOVE 'SELECT OF TRSPBAR'                            FSKUT003
01082                                  TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01083               PERFORM 9200-SQL-ABEND                              FSKUT003
01084      END-EVALUATE.                                                FSKUT003
01085 *                                                                 FSKUT003
01086      INITIALIZE FS001O-DESC.                                      FSKUT003
01087 *                                                                 FSKUT003
01088      STRING  RSPBAR-WORKER-FIR-NAME DELIMITED BY '  '             FSKUT003
01089                               SPACE DELIMITED BY SIZE             FSKUT003
01090             RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE             FSKUT003
01091        INTO FS001O-DESC                                           FSKUT003
01092      END-STRING.                                                  FSKUT003
01093 *                                                                 FSKUT003
01094 *                                                                 FSKUT003
01095 ******************************************************************FSKUT003
01096 *  GET THE WORKER NAME                                            FSKUT003
01097 ******************************************************************FSKUT003
01098  4500-GET-WORKER-NAME.                                            FSKUT003
01099      EXEC SQL                                                     FSKUT003
01100           SELECT WORKER_FIR_NAME,                                 FSKUT003
01101                  WORKER_LAST_NAME                                 FSKUT003
01102             INTO :RSPBAR-WORKER-FIR-NAME,                         FSKUT003
01103                  :RSPBAR-WORKER-LAST-NAME                         FSKUT003
01104             FROM TRSPBAR                                          FSKUT003
01105            WHERE (MDSEAR_DKEY  = :MDSEAR-DKEY                     FSKUT003
01106                   AND                                             FSKUT003
01107                   (CURRENT DATE                                   FSKUT003
01108                            BETWEEN CHAR(WORKER_STRT_DTE,ISO)      FSKUT003
01109                                AND CHAR(WORKER_END_DTE,ISO))      FSKUT003
01110                   AND                                             FSKUT003
01111                   RSPLVL_CDE   = :RSPBAR-RSPLVL-CDE)              FSKUT003
01112      END-EXEC.                                                    FSKUT003
01113 *                                                                 FSKUT003
01114 *                                                                 FSKUT003
01115 ******************************************************************FSKUT003
01116 *  OPEN THE ALL_CSR                                               FSKUT003
01117 ******************************************************************FSKUT003
01118  7000-OPEN-ALL-CSR.                                               FSKUT003
01119      EXEC SQL                                                     FSKUT003
01120           OPEN ALL_CSR                                            FSKUT003
01121      END-EXEC.                                                    FSKUT003
01122 *                                                                 FSKUT003
01123      EVALUATE TRUE                                                FSKUT003
01124          WHEN SQLCODE = ZERO                                      FSKUT003
01125               CONTINUE                                            FSKUT003
01126          WHEN OTHER                                               FSKUT003
01127               MOVE '7000-OPEN-ALL-CSR'                            FSKUT003
01128                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01129               MOVE PE-MSG-01     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01130               PERFORM 9200-SQL-ABEND                              FSKUT003
01131      END-EVALUATE.                                                FSKUT003
01132 *                                                                 FSKUT003
01133 *                                                                 FSKUT003
01134 ******************************************************************FSKUT003
01135 *  FETCH THE NEXT DEPT/CLASS COMBINATION USING THE ALL_CSR        FSKUT003
01136 ******************************************************************FSKUT003
01137  7010-FETCH-ALL-CSR.                                              FSKUT003
01138      EXEC SQL                                                     FSKUT003
01139           FETCH ALL_CSR                                           FSKUT003
01140            INTO :MDSEAR-GMA-NBR,                                  FSKUT003
01141                 :MDSEAR-DMA-NBR,                                  FSKUT003
01142                 :MDSEAR-DEPT-NBR,                                 FSKUT003
01143                 :MDSEAR-MAJ-CL-NBR,                               FSKUT003
01144                 :MDSEAR-SUB-CL-NBR,                               FSKUT003
01145                 :MDSEAR-BYR-NBR,                                  FSKUT003
01146                 :MDSEAR-MDSELV-CDE,                               FSKUT003
01147                 :MDSEAR-DESC,                                     FSKUT003
01148                 :MDSEAR-DKEY                                      FSKUT003
01149      END-EXEC.                                                    FSKUT003
01150 *                                                                 FSKUT003
01151      EVALUATE TRUE                                                FSKUT003
01152          WHEN SQLCODE = ZERO                                      FSKUT003
01153          WHEN SQLCODE = +100                                      FSKUT003
01154               CONTINUE                                            FSKUT003
01155          WHEN OTHER                                               FSKUT003
01156               MOVE '7010-FETCH-ALL-CSR'                           FSKUT003
01157                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01158               MOVE PE-MSG-02     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01159               PERFORM 9200-SQL-ABEND                              FSKUT003
01160      END-EVALUATE.                                                FSKUT003
01161 *                                                                 FSKUT003
01162 *                                                                 FSKUT003
01163 ******************************************************************FSKUT003
01164 *  OPEN THE GMM_CSR                                               FSKUT003
01165 ******************************************************************FSKUT003
01166  7100-OPEN-GMM-CSR.                                               FSKUT003
01167      EXEC SQL                                                     FSKUT003
01168           OPEN GMM_CSR                                            FSKUT003
01169      END-EXEC.                                                    FSKUT003
01170 *                                                                 FSKUT003
01171      EVALUATE TRUE                                                FSKUT003
01172          WHEN SQLCODE = ZERO                                      FSKUT003
01173               CONTINUE                                            FSKUT003
01174          WHEN OTHER                                               FSKUT003
01175               MOVE '7100-OPEN-GMM-CSR'                            FSKUT003
01176                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01177               MOVE PE-MSG-03     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01178               PERFORM 9200-SQL-ABEND                              FSKUT003
01179      END-EVALUATE.                                                FSKUT003
01180 *                                                                 FSKUT003
01181 *                                                                 FSKUT003
01182 ******************************************************************FSKUT003
01183 *  FETCH THE NEXT DEPT/CLASS COMBINATION USING THE GMM_CSR        FSKUT003
01184 ******************************************************************FSKUT003
01185  7110-FETCH-GMM-CSR.                                              FSKUT003
01186      EXEC SQL                                                     FSKUT003
01187           FETCH GMM_CSR                                           FSKUT003
01188            INTO :MDSEAR-GMA-NBR,                                  FSKUT003
01189                 :MDSEAR-DMA-NBR,                                  FSKUT003
01190                 :MDSEAR-DEPT-NBR,                                 FSKUT003
01191                 :MDSEAR-MAJ-CL-NBR,                               FSKUT003
01192                 :MDSEAR-SUB-CL-NBR,                               FSKUT003
01193                 :MDSEAR-BYR-NBR,                                  FSKUT003
01194                 :MDSEAR-MDSELV-CDE,                               FSKUT003
01195                 :MDSEAR-DESC,                                     FSKUT003
01196                 :MDSEAR-DKEY                                      FSKUT003
01197      END-EXEC.                                                    FSKUT003
01198 *                                                                 FSKUT003
01199      EVALUATE TRUE                                                FSKUT003
01200          WHEN SQLCODE = ZERO                                      FSKUT003
01201          WHEN SQLCODE = +100                                      FSKUT003
01202               CONTINUE                                            FSKUT003
01203          WHEN OTHER                                               FSKUT003
01204               MOVE '7110-FETCH-GMM-CSR'                           FSKUT003
01205                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01206               MOVE PE-MSG-04     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01207               PERFORM 9200-SQL-ABEND                              FSKUT003
01208      END-EVALUATE.                                                FSKUT003
01209 *                                                                 FSKUT003
01210 *                                                                 FSKUT003
01211 ******************************************************************FSKUT003
01212 *  CLOSE THE GMM_CSR                                              FSKUT003
01213 ******************************************************************FSKUT003
01214  7120-CLOSE-GMM-CSR.                                              FSKUT003
01215      EXEC SQL                                                     FSKUT003
01216           CLOSE GMM_CSR                                           FSKUT003
01217      END-EXEC.                                                    FSKUT003
01218 *                                                                 FSKUT003
01219      EVALUATE TRUE                                                FSKUT003
01220          WHEN SQLCODE = ZERO                                      FSKUT003
01221               CONTINUE                                            FSKUT003
01222          WHEN OTHER                                               FSKUT003
01223               MOVE '7120-CLOSE-GMM-CSR'                           FSKUT003
01224                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01225               MOVE PE-MSG-05     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01226               PERFORM 9200-SQL-ABEND                              FSKUT003
01227      END-EVALUATE.                                                FSKUT003
01228 *                                                                 FSKUT003
01229 *                                                                 FSKUT003
01230 ******************************************************************FSKUT003
01231 *  OPEN THE DMM_CSR                                               FSKUT003
01232 ******************************************************************FSKUT003
01233  7200-OPEN-DMM-CSR.                                               FSKUT003
01234      EXEC SQL                                                     FSKUT003
01235           OPEN DMM_CSR                                            FSKUT003
01236      END-EXEC.                                                    FSKUT003
01237 *                                                                 FSKUT003
01238      EVALUATE TRUE                                                FSKUT003
01239          WHEN SQLCODE = ZERO                                      FSKUT003
01240               CONTINUE                                            FSKUT003
01241          WHEN OTHER                                               FSKUT003
01242               MOVE '7200-OPEN-DMM-CSR'                            FSKUT003
01243                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01244               MOVE PE-MSG-06     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01245               PERFORM 9200-SQL-ABEND                              FSKUT003
01246      END-EVALUATE.                                                FSKUT003
01247 *                                                                 FSKUT003
01248 *                                                                 FSKUT003
01249 ******************************************************************FSKUT003
01250 *  FETCH THE NEXT DEPT/CLASS COMBINATION USING THE DMM_CSR        FSKUT003
01251 ******************************************************************FSKUT003
01252  7210-FETCH-DMM-CSR.                                              FSKUT003
01253      EXEC SQL                                                     FSKUT003
01254           FETCH DMM_CSR                                           FSKUT003
01255            INTO :MDSEAR-GMA-NBR,                                  FSKUT003
01256                 :MDSEAR-DMA-NBR,                                  FSKUT003
01257                 :MDSEAR-DEPT-NBR,                                 FSKUT003
01258                 :MDSEAR-MAJ-CL-NBR,                               FSKUT003
01259                 :MDSEAR-SUB-CL-NBR,                               FSKUT003
01260                 :MDSEAR-BYR-NBR,                                  FSKUT003
01261                 :MDSEAR-MDSELV-CDE,                               FSKUT003
01262                 :MDSEAR-DESC,                                     FSKUT003
01263                 :MDSEAR-DKEY                                      FSKUT003
01264      END-EXEC.                                                    FSKUT003
01265 *                                                                 FSKUT003
01266      EVALUATE TRUE                                                FSKUT003
01267          WHEN SQLCODE = ZERO                                      FSKUT003
01268          WHEN SQLCODE = +100                                      FSKUT003
01269               CONTINUE                                            FSKUT003
01270          WHEN OTHER                                               FSKUT003
01271               MOVE '7210-FETCH-DMM-CSR'                           FSKUT003
01272                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01273               MOVE PE-MSG-07     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01274               PERFORM 9200-SQL-ABEND                              FSKUT003
01275      END-EVALUATE.                                                FSKUT003
01276 *                                                                 FSKUT003
01277 *                                                                 FSKUT003
01278 ******************************************************************FSKUT003
01279 *  CLOSE THE DMM_CSR                                              FSKUT003
01280 ******************************************************************FSKUT003
01281  7220-CLOSE-DMM-CSR.                                              FSKUT003
01282      EXEC SQL                                                     FSKUT003
01283           CLOSE DMM_CSR                                           FSKUT003
01284      END-EXEC.                                                    FSKUT003
01285 *                                                                 FSKUT003
01286      EVALUATE TRUE                                                FSKUT003
01287          WHEN SQLCODE = ZERO                                      FSKUT003
01288               CONTINUE                                            FSKUT003
01289          WHEN OTHER                                               FSKUT003
01290               MOVE '7220-CLOSE-DMM-CSR'                           FSKUT003
01291                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01292               MOVE PE-MSG-08     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01293               PERFORM 9200-SQL-ABEND                              FSKUT003
01294      END-EVALUATE.                                                FSKUT003
01295 *                                                                 FSKUT003
01296 *                                                                 FSKUT003
01297 ******************************************************************FSKUT003
01298 *  OPEN THE BYR_CSR                                               FSKUT003
01299 ******************************************************************FSKUT003
01300  7300-OPEN-BYR-CSR.                                               FSKUT003
01301      EXEC SQL                                                     FSKUT003
01302           OPEN BYR_CSR                                            FSKUT003
01303      END-EXEC.                                                    FSKUT003
01304 *                                                                 FSKUT003
01305      EVALUATE TRUE                                                FSKUT003
01306          WHEN SQLCODE = ZERO                                      FSKUT003
01307               CONTINUE                                            FSKUT003
01308          WHEN OTHER                                               FSKUT003
01309               MOVE '7300-OPEN-BYR-CSR'                            FSKUT003
01310                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01311               MOVE PE-MSG-09     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01312               PERFORM 9200-SQL-ABEND                              FSKUT003
01313      END-EVALUATE.                                                FSKUT003
01314 *                                                                 FSKUT003
01315 *                                                                 FSKUT003
01316 ******************************************************************FSKUT003
01317 *  FETCH THE NEXT DEPT/CLASS COMBINATION USING THE BYR_CSR        FSKUT003
01318 ******************************************************************FSKUT003
01319  7310-FETCH-BYR-CSR.                                              FSKUT003
01320      EXEC SQL                                                     FSKUT003
01321           FETCH BYR_CSR                                           FSKUT003
01322            INTO :MDSEAR-GMA-NBR,                                  FSKUT003
01323                 :MDSEAR-DMA-NBR,                                  FSKUT003
01324                 :MDSEAR-DEPT-NBR,                                 FSKUT003
01325                 :MDSEAR-MAJ-CL-NBR,                               FSKUT003
01326                 :MDSEAR-SUB-CL-NBR,                               FSKUT003
01327                 :MDSEAR-BYR-NBR,                                  FSKUT003
01328                 :MDSEAR-MDSELV-CDE,                               FSKUT003
01329                 :MDSEAR-DESC,                                     FSKUT003
01330                 :MDSEAR-DKEY                                      FSKUT003
01331      END-EXEC.                                                    FSKUT003
01332 *                                                                 FSKUT003
01333      EVALUATE TRUE                                                FSKUT003
01334          WHEN SQLCODE = ZERO                                      FSKUT003
01335          WHEN SQLCODE = +100                                      FSKUT003
01336               CONTINUE                                            FSKUT003
01337          WHEN OTHER                                               FSKUT003
01338               MOVE '7310-FETCH-BYR-CSR'                           FSKUT003
01339                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01340               MOVE PE-MSG-10     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01341               PERFORM 9200-SQL-ABEND                              FSKUT003
01342      END-EVALUATE.                                                FSKUT003
01343 *                                                                 FSKUT003
01344 *                                                                 FSKUT003
01345 ******************************************************************FSKUT003
01346 *  CLOSE THE BYR_CSR                                              FSKUT003
01347 ******************************************************************FSKUT003
01348  7320-CLOSE-BYR-CSR.                                              FSKUT003
01349      EXEC SQL                                                     FSKUT003
01350           CLOSE BYR_CSR                                           FSKUT003
01351      END-EXEC.                                                    FSKUT003
01352 *                                                                 FSKUT003
01353      EVALUATE TRUE                                                FSKUT003
01354          WHEN SQLCODE = ZERO                                      FSKUT003
01355               CONTINUE                                            FSKUT003
01356          WHEN OTHER                                               FSKUT003
01357               MOVE '7320-CLOSE-BYR-CSR'                           FSKUT003
01358                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01359               MOVE PE-MSG-11     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01360               PERFORM 9200-SQL-ABEND                              FSKUT003
01361      END-EVALUATE.                                                FSKUT003
01362 *                                                                 FSKUT003
01363 *                                                                 FSKUT003
01364 ******************************************************************FSKUT003
01365 *  OPEN THE DPT_CSR                                               FSKUT003
01366 ******************************************************************FSKUT003
01367  7400-OPEN-DPT-CSR.                                               FSKUT003
01368      EXEC SQL                                                     FSKUT003
01369           OPEN DPT_CSR                                            FSKUT003
01370      END-EXEC.                                                    FSKUT003
01371 *                                                                 FSKUT003
01372      EVALUATE TRUE                                                FSKUT003
01373          WHEN SQLCODE = ZERO                                      FSKUT003
01374               CONTINUE                                            FSKUT003
01375          WHEN OTHER                                               FSKUT003
01376               MOVE '7400-OPEN-DPT-CSR'                            FSKUT003
01377                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01378               MOVE PE-MSG-12     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01379               PERFORM 9200-SQL-ABEND                              FSKUT003
01380      END-EVALUATE.                                                FSKUT003
01381 *                                                                 FSKUT003
01382 *                                                                 FSKUT003
01383 ******************************************************************FSKUT003
01384 *  FETCH THE NEXT DEPT/CLASS COMBINATION USING THE DPT_CSR        FSKUT003
01385 ******************************************************************FSKUT003
01386  7410-FETCH-DPT-CSR.                                              FSKUT003
01387      EXEC SQL                                                     FSKUT003
01388           FETCH DPT_CSR                                           FSKUT003
01389            INTO :MDSEAR-GMA-NBR,                                  FSKUT003
01390                 :MDSEAR-DMA-NBR,                                  FSKUT003
01391                 :MDSEAR-DEPT-NBR,                                 FSKUT003
01392                 :MDSEAR-MAJ-CL-NBR,                               FSKUT003
01393                 :MDSEAR-SUB-CL-NBR,                               FSKUT003
01394                 :MDSEAR-BYR-NBR,                                  FSKUT003
01395                 :MDSEAR-MDSELV-CDE,                               FSKUT003
01396                 :MDSEAR-DESC,                                     FSKUT003
01397                 :MDSEAR-DKEY                                      FSKUT003
01398      END-EXEC.                                                    FSKUT003
01399 *                                                                 FSKUT003
01400      EVALUATE TRUE                                                FSKUT003
01401          WHEN SQLCODE = ZERO                                      FSKUT003
01402          WHEN SQLCODE = +100                                      FSKUT003
01403               CONTINUE                                            FSKUT003
01404          WHEN OTHER                                               FSKUT003
01405               MOVE '7410-FETCH-DPT-CSR'                           FSKUT003
01406                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01407               MOVE PE-MSG-13     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01408               PERFORM 9200-SQL-ABEND                              FSKUT003
01409      END-EVALUATE.                                                FSKUT003
01410 *                                                                 FSKUT003
01411 *                                                                 FSKUT003
01412 ******************************************************************FSKUT003
01413 *  CLOSE THE DPT_CSR                                              FSKUT003
01414 ******************************************************************FSKUT003
01415  7420-CLOSE-DPT-CSR.                                              FSKUT003
01416      EXEC SQL                                                     FSKUT003
01417           CLOSE DPT_CSR                                           FSKUT003
01418      END-EXEC.                                                    FSKUT003
01419 *                                                                 FSKUT003
01420      EVALUATE TRUE                                                FSKUT003
01421          WHEN SQLCODE = ZERO                                      FSKUT003
01422               CONTINUE                                            FSKUT003
01423          WHEN OTHER                                               FSKUT003
01424               MOVE '7420-CLOSE-DPT-CSR'                           FSKUT003
01425                                  TO PV-ABEND-PARAGRAPH            FSKUT003
01426               MOVE PE-MSG-14     TO PV-DB2-OPERATION-ATTEMPTED    FSKUT003
01427               PERFORM 9200-SQL-ABEND                              FSKUT003
01428      END-EVALUATE.                                                FSKUT003
01429 *                                                                 FSKUT003
01430 *                                                                 FSKUT003
01431 ******************************************************************FSKUT003
01432 *    READ THE CONTROL CARD FILE.                                  FSKUT003
01433 ******************************************************************FSKUT003
01434  8000-READ-CONTROL-CARD.                                          FSKUT003
01435      READ CONTROL-CARD-FILE-IN                                    FSKUT003
01436        INTO CC-CONTROL-CARD                                       FSKUT003
01437          AT END SET PS-CONTROL-CARD-EOF TO TRUE.                  FSKUT003
01438 *                                                                 FSKUT003
01439 *                                                                 FSKUT003
01440 ******************************************************************FSKUT003
01441 *  CLOSE ONE FILES ASSOCIATED WITH THE PROGRAM.                   FSKUT003
01442 ******************************************************************FSKUT003
01443  9000-EOJ-ROUTINE.                                                FSKUT003
01444      CLOSE CONTROL-CARD-FILE-IN                                   FSKUT003
01445            MBS-STRUCTURE-FILE-OUT.                                FSKUT003
01446                                                                   FSKUT003
01447      DISPLAY ' '.                                                 FSKUT003
01448      DISPLAY 'CONTROL CARDS PROCESSED -- ' PV-CC-INPUT-CNT.       FSKUT003
01449      DISPLAY 'CONTROL CARDS VALID ------ ' PV-CC-MBS-VALID-CNT.   FSKUT003
01450      DISPLAY 'CONTROL CARDS INVALID ---- ' PV-CC-MBS-INVALID-CNT. FSKUT003
01451                                                                   FSKUT003
01452      IF  PV-CC-MBS-VALID-CNT = ZERO                               FSKUT003
01453          DISPLAY ' '                                              FSKUT003
01454          DISPLAY '** ABEND **'                                    FSKUT003
01455          DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME        FSKUT003
01456          DISPLAY '** PARAGRAPH = 9000-EOJ-ROUTINE'                FSKUT003
01457          DISPLAY '** NO CONTROL CARDS WERE VALIDLY PROCESSED'     FSKUT003
01458          MOVE +4003              TO PV-ABEND-CODE                 FSKUT003
01459          CALL 'ILBOABN0' USING PV-ABEND-CODE                      FSKUT003
01460      END-IF.                                                      FSKUT003
01461 *                                                                 FSKUT003
01462 *                                                                 FSKUT003
01463 ******************************************************************FSKUT003
01464 *  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    FSKUT003
01465 *  ERROR OR WARNING CODE OCCURS.                                  FSKUT003
01466 ******************************************************************FSKUT003
01467  9200-SQL-ABEND.                                                  FSKUT003
01468      DISPLAY '9200-SQL-ABEND'.                                    FSKUT003
01469      DISPLAY '** ABEND     **'.                                   FSKUT003
01470      DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        FSKUT003
01471      DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             FSKUT003
01472      DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     FSKUT003
01473 *                                                                 FSKUT003
01474 *                                                                 FSKUT003
01475 ******************************************************************FSKUT003
01476 * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    FSKUT003
01477 * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         FSKUT003
01478 * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     FSKUT003
01479 * FORMAT.                                                         FSKUT003
01480 ******************************************************************FSKUT003
01481      COPY DPPD004.                                                FSKUT003
01482                                                                   FSKUT003
01483      IF  SQLCODE NOT = -911                                       FSKUT003
01484          EXEC SQL                                                 FSKUT003
01485               COMMIT                                              FSKUT003
01486          END-EXEC                                                 FSKUT003
01487      END-IF.                                                      FSKUT003
01488                                                                   FSKUT003
01489      MOVE +4013                  TO PV-ABEND-CODE.                FSKUT003
01490      CALL 'ILBOABN0' USING PV-ABEND-CODE.                         FSKUT003
