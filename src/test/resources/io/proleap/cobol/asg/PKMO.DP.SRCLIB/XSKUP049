000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.    XSKUP049.                                         00040000
000500 AUTHOR.        KOHLS DEPARTMENT STORES.                          00050000
000600 INSTALLATION.  LIHUA LIANG.                                      00060000
000700 DATE-WRITTEN.  03/24/2003.                                       00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*   THIS PROGRAM IS CALLED FROM XSKUT012 TO UPDATE SKU LOCATION   00100000
001100*   TABLE (XST_SKU_LOC) WHEN MESSAGE 080 IS ENCOUNTERED.          00110000
001100*   MESSAGE 080 IS SKU STORE PRICE AND/OR STATUS CHANGE.          00120000
001200******************************************************************00130000
071206*========================== CHANGE LOG ===========================00140000
071206*  AUTH     BY         DATE                 DESCRIPTION           00150000
001700*=================================================================00160000
071206* WR29434  S.NOWAK   07-12-06   YELLOW TICKET CHANGES             00170000
071206*                                                                 00180000
CL3132* CL3132   COGNIZANT 08-06-10   FINE TUNED PROGRAM FOR PERFORMANCE00190000
CL3132*                               IMPROVEMENT                       00200000
071206*========================== CHANGE LOG ===========================00210000
071206*  AUTH     BY         DATE                 DESCRIPTION           00220000
001700*=================================================================00230000
071206*                                                                 00240000
CL3132* CHG98908 COGNIZANT 11-14-14   ADDED DISPLAYS TO DEBUG -803 ERROR00250000
CL3132*                               FIND FOR TEST                     00260000
071206******************************************************************00270000
001300                                                                  00280000
001400******************************************************************00290000
001500 ENVIRONMENT DIVISION.                                            00300000
001600******************************************************************00310000
001700 CONFIGURATION SECTION.                                           00320000
001800 SOURCE-COMPUTER.  IBM-3090.                                      00330000
001900 OBJECT-COMPUTER.  IBM-3090.                                      00340000
002000 DATA DIVISION.                                                   00350000
002100                                                                  00360000
002200 WORKING-STORAGE SECTION.                                         00370000
002300******************************************************************00380000
002400*    PROGRAM SWITCHES.                                            00390000
002500******************************************************************00400000
002600 01  PS-PROGRAM-SWITCHES.                                         00410000
002700     05  PS-CONTINUE-SW               PIC  X(01) VALUE 'Y'.       00420000
002800         88  PS-CONTINUE-YES                     VALUE 'Y'.       00430000
002900         88  PS-CONTINUE-NO                      VALUE 'N'.       00440000
003000     05  PS-ACTION-IND                PIC  9(02) VALUE 00.        00450000
003100         88  PS-ACTION-REVERSE                   VALUE 01.        00460000
003200         88  PS-ACTION-NOTHING                   VALUE 02.        00470000
003300                                                                  00480000
003400******************************************************************00490000
003500*    PROGRAM CONSTANTS.                                           00500000
003600******************************************************************00510000
003700 01  PC-PROGRAM-CONSTANTS.                                        00520000
003800     05  PC-MAX-RETRIES               PIC  9(01) VALUE 3.         00530000
003800     05  PC-YES                       PIC  X(01) VALUE 'Y'.       00540000
003800     05  PC-NO                        PIC  X(01) VALUE 'N'.       00550000
003800     05  PC-CLEARANCE                 PIC  X(02) VALUE '30'.      00560000
003800     05  PC-MARK1                     PIC  X(01) VALUE '1'.       00570000
CL3132     05  PC-NULL-IND                  PIC S9(04) COMP VALUE -1.   00580000
003900                                                                  00590000
004000******************************************************************00600000
004100*    PROGRAM VARIABLES.                                           00610000
004200******************************************************************00620000
003700 01  PV-PROGRAM-VARIABLES.                                        00630000
004300     05  PC-10-DIGIT                  PIC 9(10)  VALUE ZEROS.     00640000
004300     05  PC-18-DIGIT                  PIC S9(18) COMP VALUE ZEROS.00650000
004300     05  PC-09-DIGIT                  PIC S9(09) COMP VALUE ZEROS.00660000
CL3132     05  PV-SUB                       PIC S9(04) COMP VALUE +0.   00670000
CL3132     05  PV-SUB1                      PIC S9(04) COMP VALUE +0.   00680000
CL3132     05  PV-ROWS                      PIC S9(04) COMP VALUE +0.   00690000
004300     05  PV-RETRIES                   PIC  9(01) VALUE ZEROS.     00700000
004400     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00710000
           05  PV-RETURN-SQLCODE            PIC S9(04) VALUE ZEROS.     00720000
003000     05  PV-END-TMST-IND              PIC S9(04) VALUE +0 COMP.   00730000
003100         88  PV-END-TMST-NULL                    VALUE -1.        00740000
003000     05  PV-GP-PRICE-IND              PIC S9(04) VALUE +0 COMP.   00750000
003100         88  PV-GP-PRICE-NULL                    VALUE -1.        00760000
003000     05  PV-GP-QTY-IND                PIC S9(04) VALUE +0 COMP.   00770000
003100         88  PV-GP-QTY-NULL                      VALUE -1.        00780000
003000     05  PV-GP-AMT-IND                PIC S9(04) VALUE +0 COMP.   00790000
003100         88  PV-GP-AMT-NULL                      VALUE -1.        00800000
003000     05  PV-MKDN-CDE-IND              PIC S9(04) VALUE +0 COMP.   00810000
003100         88  PV-MKDN-CDE-NULL                    VALUE -1.        00820000
003100         88  PV-MKDN-CDE-VALUE                   VALUE  0.        00830000
003000     05  PV-ORIG-CLR-DTE-IND          PIC S9(04) VALUE +0 COMP.   00840000
003100         88  PV-ORIG-CLR-DTE-NULL                VALUE -1.        00850000
003100         88  PV-ORIG-CLR-DTE-VALUE               VALUE  0.        00860000
CL3132     05  PV-COUNT                     PIC  9(02).                 00870000
004700     05  PV-SAVE-DATA.                                            00880000
004700         10 PV-INTR-UPC-ID            PIC S9(09) COMP.            00890000
004700         10 PV-LOC-NBR                PIC S9(04) COMP.            00900000
004700         10 PV-BEG-TMST               PIC  X(26).                 00910000
004700         10 PV-END-TMST               PIC  X(26).                 00920000
004700         10 PV-UNT-RTL-AMT            PIC S9(7)V9(2) COMP-3.      00930000
004700         10 PV-UNT-COST-AMT           PIC S9(7)V9(3) COMP-3.      00940000
004700         10 PV-LOC-SKU-STAT-CDE       PIC  X(02).                 00950000
004700         10 PV-UPC-STAT-CHG-DTE       PIC  X(10).                 00960000
004700         10 PV-UNT-RTL-CHG-DTE        PIC  X(10).                 00970000
004700         10 PV-GP-PRIC-ID             PIC S9(09) COMP.            00980000
004700         10 PV-GP-RTL-QTY             PIC S9(04) COMP.            00990000
004700         10 PV-GP-RTL-AMT             PIC S9(7)V9(2) COMP-3.      01000000
004700         10 PV-LAST-UPD-TMST          PIC  X(26).                 01010000
004700         10 PV-SOR-LAST-MSG-TMST      PIC  X(26).                 01020000
004700         10 PV-MKDN-CDE               PIC  X(01).                 01030000
004700         10 PV-ORIG-CLR-DTE           PIC  X(10).                 01040000
004800                                                                  01050000
004700     05  PV-MISC-DATA.                                            01060000
004700         10 PV-CORP-UPC-STAT-CHG-DTE    PIC  X(10).               01070000
004700         10 PV-CORP-ORIG-CLR-DTE        PIC  X(10).               01080000
003000         10 PV-CORP-ORIG-CLR-DTE-IND    PIC S9(04) VALUE +0 COMP. 01090000
004800                                                                  01100000
071206******************************************************************01110000
071206*                       NULL INDICATORS                           01120000
071206******************************************************************01130000
071206 01  NULL-INDICATORS.                                             01140000
071206     05  NI-CLR-DTE                      PIC S9(4)   COMP         01150000
071206                                                    VALUE ZERO.   01160000
071206                                                                  01170000
CL3132* HOST-VARIABLE FOR MULTI-ROW INSERT INTO XST_SKU_LOC             01180000
CL3132 01 TL-DCLHV8.                                                    01190000
CL3132     05 TL-HV8-INTR-UPC-ID      PIC  S9(9) COMP OCCURS 120 TIMES. 01200000
CL3132     05 TL-HV8-LOC-NBR          PIC  S9(4) COMP OCCURS 120 TIMES. 01210000
CL3132     05 TL-HV8-BEG-TMST         PIC  X(26) OCCURS 120 TIMES.      01220000
CL3132     05 TL-HV8-END-TMST         PIC  X(26) OCCURS 120 TIMES.      01230000
CL3132     05 TL-HV8-UNT-RTL-AMT      PIC  S9(7)V9(2) COMP-3            01240000
CL3132                                                OCCURS 120 TIMES. 01250000
CL3132     05 TL-HV8-UNT-COST-AMT     PIC  S9(7)V9(3) COMP-3            01260000
CL3132                                                OCCURS 120 TIMES. 01270000
CL3132     05 TL-HV8-LOC-SKU-STAT-CDE PIC  X(02) OCCURS 120 TIMES.      01280000
CL3132     05 TL-HV8-UPC-STAT-CHG-DTE PIC  X(10) OCCURS 120 TIMES.      01290000
CL3132     05 TL-HV8-UNT-RTL-CHG-DTE  PIC  X(10) OCCURS 120 TIMES.      01300000
CL3132     05 TL-HV8-GP-PRIC-ID       PIC  S9(9) COMP OCCURS 120 TIMES. 01310000
CL3132     05 TL-HV8-GP-RTL-QTY       PIC  S9(4) COMP OCCURS 120 TIMES. 01320000
CL3132     05 TL-HV8-GP-RTL-AMT       PIC  S9(7)V9(2) COMP-3            01330000
CL3132                                                OCCURS 120 TIMES. 01340000
CL3132     05 TL-HV8-LAST-UPD-TMST     PIC  X(26) OCCURS 120 TIMES.     01350000
CL3132     05 TL-HV8-SOR-LAST-MSG-TMST PIC X(26) OCCURS 120 TIMES.      01360000
CL3132     05 TL-HV8-MKDN-CDE         PIC  X(01) OCCURS 120 TIMES.      01370000
CL3132     05 TL-HV8-ORIG-CLR-DTE     PIC  X(10) OCCURS 120 TIMES.      01380000
CL3132     05 TL-HV8-END-TMST-IND     PIC  S9(4) COMP VALUE -1          01390000
CL3132                                                OCCURS 120 TIMES. 01400000
CL3132     05 TL-HV8-GP-PRIC-ID-IND   PIC  S9(4) COMP VALUE -1          01410000
CL3132                                                OCCURS 120 TIMES. 01420000
CL3132     05 TL-HV8-GP-RTL-QTY-IND   PIC  S9(4) COMP VALUE -1          01430000
CL3132                                                OCCURS 120 TIMES. 01440000
CL3132     05 TL-HV8-GP-RTL-AMT-IND   PIC  S9(4) COMP VALUE -1          01450000
CL3132                                                OCCURS 120 TIMES. 01460000
CL3132     05 TL-HV8-MKDN-CDE-IND     PIC  S9(4) COMP VALUE -1          01470000
CL3132                                                OCCURS 120 TIMES. 01480000
CL3132     05 TL-HV8-ORIG-CLR-DTE-IND PIC  S9(4) COMP VALUE -1          01490000
CL3132                                                OCCURS 120 TIMES. 01500000
CL3132* HOST-VARIABLE FOR MULTI-ROW INSERT INTO XST_SKU_LOC_ATTR        01510000
CL3132 01  TL-DCLHV41.                                                  01520000
CL3132     05 TL-HV41-INTR-UPC-ID     PIC  S9(9) COMP OCCURS 120 TIMES. 01530000
CL3132     05 TL-HV41-LOC-NBR         PIC  S9(4) COMP OCCURS 120 TIMES. 01540000
CL3132     05 TL-HV41-PRMPT-FOR-PRIC-IND PIC X(1) OCCURS 120 TIMES.     01550000
CL3132     05 TL-HV41-LAST-UPD-TMST      PIC  X(26) OCCURS 120 TIMES.   01560000
007000                                                                  01570000
004900******************************************************************01580000
005000*    TABLE                                                        01590000
005100******************************************************************01600000
004700 01 PV-STORE-AREA.                                                01610000
004700     05  PV-STORE-TABLE OCCURS 40 TIMES INDEXED BY PV-STR-IDX.    01620000
004700         10 PV-STORE                  PIC  9(04).                 01630000
004800                                                                  01640000
CL3132 01 TL-IMRD008-GROUP.                                             01650000
CL3132     05 TL-IMRD008-RECORD OCCURS 3 TIMES.                         01660000
CL3132        10 TL-IMRD008-REC             PIC  X(450) VALUE SPACES.   01670000
CL3132                                                                  01680000
CL3132 01 TL-SQLCODE-GROUP.                                             01690000
CL3132     05 TL-SQLCODE-RET-TBL OCCURS 3 TIMES.                        01700000
CL3132        10  TL-RETURN-SQLCODE-RET     PIC S9(04) VALUE ZEROS.     01710000
004900******************************************************************01720000
004900******************************************************************01730000
005000*    ABEND COPYBOOKS                                              01740000
005100******************************************************************01750000
005200     COPY DPWS004.                                                01760000
005300                                                                  01770000
005400******************************************************************01780000
005500*    DB2 MESSAGE AREA                                             01790000
005600******************************************************************01800000
005700     COPY SQLCA2.                                                 01810000
005800                                                                  01820000
005900******************************************************************01830000
006000*    ITEM COPYBOOK                                                01840000
006100******************************************************************01850000
006200     COPY IMRD008.                                                01860000
006300                                                                  01870000
006400******************************************************************01880000
006400******************************************************************01890000
006500*    DB2 COMMUNICATION AREA                                       01900000
006600******************************************************************01910000
006700     EXEC SQL                                                     01920000
006800          INCLUDE SQLCA                                           01930000
006900     END-EXEC.                                                    01940000
007000                                                                  01950000
007100******************************************************************01960000
007200*    XST_SKU_LOC TABLE                                            01970000
007300******************************************************************01980000
007400     EXEC SQL                                                     01990000
007500         INCLUDE XST00008                                         02000000
007600     END-EXEC.                                                    02010000
007700                                                                  02020000
007100******************************************************************02030000
007200*    XST_SKU_LOC_ATTR TABLE                                       02040000
007300******************************************************************02050000
007400     EXEC SQL                                                     02060000
007500         INCLUDE XST00041                                         02070000
007600     END-EXEC.                                                    02080000
007700                                                                  02090000
007800******************************************************************02100000
007900 LINKAGE SECTION.                                                 02110000
008000******************************************************************02120000
CL3132 01  LV-IMRD008-RECORD.                                           02130000
CL3132     10 LV-IMRD008-REC1               PIC  X(450).                02140000
CL3132     10 LV-IMRD008-REC2               PIC  X(450).                02150000
CL3132     10 LV-IMRD008-REC3               PIC  X(450).                02160000
008200 01  LV-RETURN-CODE                   PIC S9(04).                 02170000
008300 01  LV-ACTION-IND                    PIC  9(02).                 02180000
008400 01  LV-CURRENT-TIMESTAMP             PIC  X(26).                 02190000
CL3132 01  LV-MESSAGE-COUNT                 PIC  9(02).                 02200000
008500                                                                  02210000
008600******************************************************************02220000
008700 PROCEDURE DIVISION USING LV-IMRD008-RECORD,                      02230000
008800                          LV-RETURN-CODE,                         02240000
008900                          LV-ACTION-IND,                          02250000
CL3132                          LV-CURRENT-TIMESTAMP,                   02260000
CL3132                          LV-MESSAGE-COUNT.                       02270000
009100******************************************************************02280000
009200 0000-MAINLINE.                                                   02290000
009300                                                                  02300000
009400      PERFORM 1000-INITIALIZATION.                                02310000
009300                                                                  02320000
CL3132      PERFORM 1500-MESSAGE-LOOP                                   02330000
CL3132      VARYING PV-COUNT FROM 1 BY 1                                02340000
CL3132        UNTIL PV-COUNT > LV-MESSAGE-COUNT.                        02350000
009800                                                                  02360000
CL3132      IF PV-SUB > 0                                               02370000
CL3132         MOVE PV-SUB TO PV-ROWS                                   02380000
CL3132         PERFORM 4000-MULTI-INSERT-SKU-LOC                        02390000
CL3132      END-IF                                                      02400000
CL3132                                                                  02410000
CL3132      IF PV-SUB1 > 0                                              02420000
CL3132         MOVE PV-SUB1 TO PV-ROWS                                  02430000
CL3132         PERFORM 4100-MULTI-INSERT-SKU-LOC-ATTR                   02440000
CL3132      END-IF.                                                     02450000
CL3132                                                                  02460000
009900      PERFORM 9999-WRAPUP.                                        02470000
010000                                                                  02480000
010100***************************************************************** 02490000
010200 1000-INITIALIZATION.                                             02500000
010300*     INITIALIZATION AREA                                         02510000
010400***************************************************************** 02520000
010500                                                                  02530000
010600     SET PS-CONTINUE-YES              TO TRUE.                    02540000
010700                                                                  02550000
010800     INITIALIZE PV-RETRIES                                        02560000
010800                PV-SAVE-DATA                                      02570000
010800                PV-RETURN-SQLCODE                                 02580000
CL3132                PV-COUNT                                          02590000
CL3132                PV-SUB                                            02600000
CL3132                PV-SUB1                                           02610000
010800                DCLXST00008                                       02620000
CL3132                DCLXST00041                                       02630000
CL3132                TL-DCLHV8                                         02640000
CL3132                TL-DCLHV41                                        02650000
CL3132                TL-SQLCODE-GROUP.                                 02660000
010900                                                                  02670000
CL3132     MOVE LV-IMRD008-RECORD   TO  TL-IMRD008-GROUP.               02680000
CL3132***************************************************************** 02690000
CL3132 1500-MESSAGE-LOOP.                                               02700000
CL3132***************************************************************** 02710000
CL3132     SET PS-CONTINUE-YES              TO TRUE.                    02720000
CL3132     INITIALIZE PV-RETRIES                                        02730000
CL3132                PV-SAVE-DATA                                      02740000
CL3132                PV-RETURN-SQLCODE                                 02750000
CL3132                DCLXST00008                                       02760000
CL3132                DCLXST00041.                                      02770000
010900                                                                  02780000
CL3132     MOVE TL-IMRD008-RECORD (PV-COUNT) TO IMRD008-RECORD.         02790000
011000     MOVE IM008-STR-RTL-STORE-TABLE    TO PV-STORE-AREA.          02800000
010900                                                                  02810000
011300     MOVE IM008-ITEM-KEY-INTR-UPC-ID  TO PC-10-DIGIT.             02820000
011300     MOVE PC-10-DIGIT                 TO PC-18-DIGIT.             02830000
011300     MOVE PC-18-DIGIT                 TO PC-09-DIGIT.             02840000
011300     MOVE PC-09-DIGIT                 TO XST00008-INTR-UPC-ID.    02850000
011300                                                                  02860000
013300     MOVE IM008-STR-RTL-EFF-BEG-TMST  TO XST00008-BEG-TMST.       02870000
                                                                        02880000
           PERFORM 1600-SELECT-GLOBAL-SKU-LOC.                          02890000
012400                                                                  02900000
012300     IF PS-CONTINUE-NO                                            02910000
              MOVE SQLCODE TO PV-RETURN-SQLCODE                         02920000
              DISPLAY '** ERROR IN XSKUP049, PARAGRAPH '                02930000
                      PV-PARAGRAPH-NAME                                 02940000
              DISPLAY '   FOR INTR UPC ID '                             02950000
                      IM008-ITEM-KEY-INTR-UPC-ID ' **'                  02960000
012300     END-IF.                                                      02970000
                                                                        02980000
010800     INITIALIZE DCLXST00008.                                      02990000
                                                                        03000000
011300     MOVE PC-09-DIGIT                 TO XST00008-INTR-UPC-ID.    03010000
011300                                                                  03020000
013300     MOVE IM008-STR-RTL-EFF-BEG-TMST  TO XST00008-BEG-TMST.       03030000
015400                                                                  03040000
CL3132     PERFORM 2000-PROCESS-MESSAGE                                 03050000
CL3132        VARYING PV-STR-IDX                                        03060000
CL3132           FROM 1 BY 1                                            03070000
CL3132              UNTIL PV-STR-IDX > IM008-STR-RTL-STORE-COUNT        03080000
CL3132                 OR PS-CONTINUE-NO.                               03090000
CL3132     MOVE PV-RETURN-SQLCODE           TO                          03100000
CL3132          TL-RETURN-SQLCODE-RET (PV-COUNT).                       03110000
012500***************************************************************** 03120000
013100 1600-SELECT-GLOBAL-SKU-LOC.                                      03130000
012600*     SELECT UPC STATUS CHANGE DATE FROM CORP (GLOBAL OR STORE 0) 03140000
      *     ROW, TO USE AS DEFAULT VALUE IF NO OTHER IS AVAILABLE.      03150000
013000***************************************************************** 03160000
013200                                                                  03170000
013500     PERFORM                                                      03180000
013500        WITH TEST AFTER                                           03190000
013500        VARYING PV-RETRIES                                        03200000
013500        FROM 1 BY 1                                               03210000
013500        UNTIL PV-RETRIES > PC-MAX-RETRIES                         03220000
013500        OR SQLCODE = ZERO                                         03230000
013500        OR SQLCODE = +100                                         03240000
013500        OR PS-CONTINUE-NO                                         03250000
013600                                                                  03260000
013500        EXEC SQL                                                  03270000
013600           SELECT INTR_UPC_ID                                     03280000
013600                 ,UPC_STAT_CHG_DTE                                03290000
013600                 ,ORIG_CLR_DTE                                    03300000
013600             INTO :XST00008-INTR-UPC-ID                           03310000
013600                 ,:XST00008-UPC-STAT-CHG-DTE                      03320000
013600                 ,:XST00008-ORIG-CLR-DTE  :PV-ORIG-CLR-DTE-IND    03330000
013600             FROM XST_SKU_LOC                                     03340000
013700            WHERE INTR_UPC_ID = :XST00008-INTR-UPC-ID             03350000
013700              AND LOC_NBR     = 0                                 03360000
013700              AND BEG_TMST   <= :XST00008-BEG-TMST                03370000
013700              AND (END_TMST  IS NULL                              03380000
013700               OR  END_TMST  >= :XST00008-BEG-TMST)               03390000
013800        END-EXEC                                                  03400000
013900                                                                  03410000
014000        EVALUATE TRUE                                             03420000
014200           WHEN SQLCODE = ZERO                                    03430000
                    MOVE XST00008-UPC-STAT-CHG-DTE TO                   03440000
                         PV-CORP-UPC-STAT-CHG-DTE                       03450000
                    MOVE XST00008-ORIG-CLR-DTE     TO                   03460000
                         PV-CORP-ORIG-CLR-DTE                           03470000
                    MOVE PV-ORIG-CLR-DTE-IND       TO                   03480000
                         PV-CORP-ORIG-CLR-DTE-IND                       03490000
014200           WHEN SQLCODE = +100                                    03500000
014300              DISPLAY '!! GLOBAL ROW NOT FOUND FOR DEFAULT !!'    03510000
013300              MOVE '1600-SELECT-GLOBAL-SKU-LOC' TO                03520000
013300                   PV-PARAGRAPH-NAME                              03530000
014700              SET PS-CONTINUE-NO                TO TRUE           03540000
014500           WHEN SQLCODE = -904                                    03550000
014500           WHEN SQLCODE = -911                                    03560000
014500           WHEN SQLCODE = -913                                    03570000
014600              IF PV-RETRIES >= PC-MAX-RETRIES                     03580000
013300                 MOVE '1600-SELECT-GLOBAL-SKU-LOC'                03590000
013300                                      TO PV-PARAGRAPH-NAME        03600000
014700                 SET PS-CONTINUE-NO   TO TRUE                     03610000
015000              END-IF                                              03620000
015100           WHEN OTHER                                             03630000
013300              MOVE '1600-SELECT-GLOBAL-SKU-LOC'                   03640000
013300                                      TO PV-PARAGRAPH-NAME        03650000
014700              SET PS-CONTINUE-NO      TO TRUE                     03660000
015300        END-EVALUATE                                              03670000
015300     END-PERFORM.                                                 03680000
011100                                                                  03690000
011800***************************************************************** 03700000
011900 2000-PROCESS-MESSAGE.                                            03710000
012000*     CALLS PROCESS TO DELETE SKU FROM TABLES.                    03720000
012100***************************************************************** 03730000
013300     MOVE PV-STORE (PV-STR-IDX)       TO XST00008-LOC-NBR.        03740000
012200                                                                  03750000
012300     PERFORM 2100-DELETE-SKU-LOC.                                 03760000
012300                                                                  03770000
012300     IF PS-CONTINUE-YES                                           03780000
012300        PERFORM 2200-SELECT-CURRENT-SKU-LOC                       03790000
012300     END-IF.                                                      03800000
012300     IF PS-CONTINUE-YES                                           03810000
012300        IF SQLCODE = +100                                         03820000
      *          ** SKU LOC ROW NOT FOUND, SO MUST INSERT **            03830000
                 PERFORM 2420-POPULATE-FIELDS-NEW                       03840000
CL3132           PERFORM 2500-BUILD-NEW-ROW                             03850000
012300           IF PS-CONTINUE-YES                                     03860000
                                                                        03870000
012300              PERFORM 2800-DETM-PRICE-PRMPT-IND                   03880000
                                                                        03890000
CL3132              PERFORM 2900-BUILD-SKU-LOC-ATTR                     03900000
012300           END-IF                                                 03910000
                                                                        03920000
012300        ELSE                                                      03930000
      *          ** SKU LOC ROW FOUND, SO DETERMINE WHAT TO DO **       03940000
012300                                                                  03950000
012300           IF XST00008-BEG-TMST = IM008-STR-RTL-EFF-BEG-TMST      03960000
012300              PERFORM 2300-UPDATE-PRICE-STATUS                    03970000
                                                                        03980000
012300           ELSE                                                   03990000
012300              PERFORM 2400-END-CURRENT-ROW                        04000000
                                                                        04010000
012300              IF PS-CONTINUE-YES                                  04020000
012300                 PERFORM 2450-POPULATE-FIELDS                     04030000
CL3132                 PERFORM 2500-BUILD-NEW-ROW                       04040000
012300              END-IF                                              04050000
012300           END-IF                                                 04060000
012300                                                                  04070000
012300           IF PS-CONTINUE-YES                                     04080000
012300              PERFORM 2600-DETM-SKU-LOC-ATTR                      04090000
012300           END-IF                                                 04100000
012300        END-IF                                                    04110000
012300     END-IF.                                                      04120000
012400                                                                  04130000
                                                                        04140000
012300     IF PS-CONTINUE-NO                                            04150000
              MOVE SQLCODE TO PV-RETURN-SQLCODE                         04160000
              DISPLAY '** ERROR IN XSKUP049, PARAGRAPH '                04170000
                      PV-PARAGRAPH-NAME                                 04180000
              DISPLAY '   FOR INTR UPC ID '                             04190000
                      IM008-ITEM-KEY-INTR-UPC-ID                        04200000
                      ' AND LOC NBR '                                   04210000
013300                PV-STORE (PV-STR-IDX) '  **'                      04220000
012300     END-IF.                                                      04230000
012400                                                                  04240000
012500***************************************************************** 04250000
013100 2100-DELETE-SKU-LOC.                                             04260000
012600*     DELETES FUTURE ROW IN XST_SKU_LOC TABLE IF ONE EXIST.       04270000
013000***************************************************************** 04280000
013400                                                                  04290000
013500     PERFORM                                                      04300000
013500        WITH TEST AFTER                                           04310000
013500        VARYING PV-RETRIES                                        04320000
013500        FROM 1 BY 1                                               04330000
013500        UNTIL PV-RETRIES > PC-MAX-RETRIES                         04340000
013500        OR SQLCODE = ZERO                                         04350000
013500        OR SQLCODE = +100                                         04360000
013500        OR PS-CONTINUE-NO                                         04370000
013600                                                                  04380000
013600        EXEC SQL                                                  04390000
013600           DELETE                                                 04400000
013600             FROM XST_SKU_LOC                                     04410000
013700            WHERE INTR_UPC_ID = :XST00008-INTR-UPC-ID             04420000
013700              AND LOC_NBR     = :XST00008-LOC-NBR                 04430000
013700              AND BEG_TMST    > :XST00008-BEG-TMST                04440000
013800        END-EXEC                                                  04450000
013900                                                                  04460000
014000        EVALUATE TRUE                                             04470000
014200           WHEN SQLCODE = ZERO                                    04480000
014200           WHEN SQLCODE = +100                                    04490000
014300              CONTINUE                                            04500000
014500           WHEN SQLCODE = -904                                    04510000
014500           WHEN SQLCODE = -911                                    04520000
014500           WHEN SQLCODE = -913                                    04530000
014600              IF PV-RETRIES >= PC-MAX-RETRIES                     04540000
014700                 SET PS-CONTINUE-NO   TO TRUE                     04550000
013300                 MOVE '2100-DELETE-SKU-LOC'                       04560000
013300                                      TO PV-PARAGRAPH-NAME        04570000
015000              END-IF                                              04580000
015100           WHEN OTHER                                             04590000
013300              MOVE '2100-DELETE-SKU-LOC'                          04600000
013300                                      TO PV-PARAGRAPH-NAME        04610000
014700              SET PS-CONTINUE-NO      TO TRUE                     04620000
015300        END-EVALUATE                                              04630000
015300     END-PERFORM.                                                 04640000
015400                                                                  04650000
012500***************************************************************** 04660000
013100 2200-SELECT-CURRENT-SKU-LOC.                                     04670000
012600*     SELECT CURRENT ROW OF SKU LOCATION.                         04680000
013000***************************************************************** 04690000
013200                                                                  04700000
013500     PERFORM                                                      04710000
013500        WITH TEST AFTER                                           04720000
013500        VARYING PV-RETRIES                                        04730000
013500        FROM 1 BY 1                                               04740000
013500        UNTIL PV-RETRIES > PC-MAX-RETRIES                         04750000
013500        OR SQLCODE = ZERO                                         04760000
013500        OR SQLCODE = +100                                         04770000
013500        OR PS-CONTINUE-NO                                         04780000
013600                                                                  04790000
013500        EXEC SQL                                                  04800000
013600           SELECT INTR_UPC_ID                                     04810000
013600                 ,LOC_NBR                                         04820000
013600                 ,BEG_TMST                                        04830000
013600                 ,END_TMST                                        04840000
013600                 ,UNT_RTL_AMT                                     04850000
013600                 ,UNT_COST_AMT                                    04860000
013600                 ,LOC_SKU_STAT_CDE                                04870000
013600                 ,UPC_STAT_CHG_DTE                                04880000
013600                 ,UNT_RTL_CHG_DTE                                 04890000
013600                 ,GP_PRIC_ID                                      04900000
013600                 ,GP_RTL_QTY                                      04910000
013600                 ,GP_RTL_AMT                                      04920000
013600                 ,LAST_UPD_TMST                                   04930000
013600                 ,SOR_LAST_MSG_TMST                               04940000
013600                 ,MKDN_CDE                                        04950000
013600                 ,ORIG_CLR_DTE                                    04960000
013600             INTO :XST00008-INTR-UPC-ID                           04970000
013600                 ,:XST00008-LOC-NBR                               04980000
013600                 ,:XST00008-BEG-TMST                              04990000
013600                 ,:XST00008-END-TMST :PV-END-TMST-IND             05000000
013600                 ,:XST00008-UNT-RTL-AMT                           05010000
013600                 ,:XST00008-UNT-COST-AMT                          05020000
013600                 ,:XST00008-LOC-SKU-STAT-CDE                      05030000
013600                 ,:XST00008-UPC-STAT-CHG-DTE                      05040000
013600                 ,:XST00008-UNT-RTL-CHG-DTE                       05050000
013600                 ,:XST00008-GP-PRIC-ID :PV-GP-PRICE-IND           05060000
013600                 ,:XST00008-GP-RTL-QTY :PV-GP-QTY-IND             05070000
013600                 ,:XST00008-GP-RTL-AMT :PV-GP-AMT-IND             05080000
013600                 ,:XST00008-LAST-UPD-TMST                         05090000
013600                 ,:XST00008-SOR-LAST-MSG-TMST                     05100000
013600                 ,:XST00008-MKDN-CDE     :PV-MKDN-CDE-IND         05110000
013600                 ,:XST00008-ORIG-CLR-DTE :PV-ORIG-CLR-DTE-IND     05120000
013600             FROM XST_SKU_LOC                                     05130000
013700            WHERE INTR_UPC_ID = :XST00008-INTR-UPC-ID             05140000
013700              AND LOC_NBR     = :XST00008-LOC-NBR                 05150000
013700              AND BEG_TMST   <= :IM008-STR-RTL-EFF-BEG-TMST       05160000
013700              AND (END_TMST  IS NULL                              05170000
013700               OR  END_TMST  >= :IM008-STR-RTL-EFF-BEG-TMST)      05180000
013800        END-EXEC                                                  05190000
013900                                                                  05200000
014000        EVALUATE TRUE                                             05210000
014200           WHEN SQLCODE = ZERO                                    05220000
014200           WHEN SQLCODE = +100                                    05230000
TEST             IF XST00008-INTR-UPC-ID = 86197296 OR                  05240000
TEST                XST00008-INTR-UPC-ID = 23871248 OR                  05250003
TEST                XST00008-INTR-UPC-ID = 2090267008                   05251003
TEST              DISPLAY 'SQLCODE =' SQLCODE                           05260002
TEST              DISPLAY 'XST00008-INTR-UPC-ID=' XST00008-INTR-UPC-ID  05270002
TEST              DISPLAY 'XST00008-LOC-NBR=   ' XST00008-LOC-NBR       05280002
TEST              DISPLAY 'XST00008-BEG-TMST=  ' XST00008-BEG-TMST      05290002
TEST             END-IF                                                 05300000
TEST                CONTINUE                                            05310000
014500           WHEN SQLCODE = -904                                    05320000
014500           WHEN SQLCODE = -911                                    05330000
014500           WHEN SQLCODE = -913                                    05340000
014600              IF PV-RETRIES >= PC-MAX-RETRIES                     05350000
014700                 SET PS-CONTINUE-NO   TO TRUE                     05360000
013300                 MOVE '2200-SELECT-CURRENT-SKU-LOC'               05370000
013300                                      TO PV-PARAGRAPH-NAME        05380000
015000              END-IF                                              05390000
015100           WHEN OTHER                                             05400000
013300              MOVE '2200-SELECT-CURRENT-SKU-LOC'                  05410000
013300                                      TO PV-PARAGRAPH-NAME        05420000
014700              SET PS-CONTINUE-NO      TO TRUE                     05430000
015300        END-EVALUATE                                              05440000
015300     END-PERFORM.                                                 05450000
015400                                                                  05460000
012500***************************************************************** 05470000
013100 2300-UPDATE-PRICE-STATUS.                                        05480000
012600*     UPDATE PRICE AND STATUS DATA.                               05490000
013000***************************************************************** 05500000
013300                                                                  05510000
013300     IF IM008-STR-RTL-UNT-RTL-AMT-CHG                             05520000
013300        MOVE IM008-STR-RTL-UNT-RTL-AMT-N                          05530000
013300                                      TO XST00008-UNT-RTL-AMT     05540000
013300        MOVE IM008-STR-RTL-UNT-RTL-CHG-DTE                        05550000
013300                                      TO XST00008-UNT-RTL-CHG-DTE 05560000
013300     END-IF.                                                      05570000
013400                                                                  05580000
013300     IF IM008-STR-RTL-SKU-STAT-DSC-CHG                            05590000
013300        MOVE IM008-STR-RTL-UPC-STAT-CDE-N                         05600000
013300                                      TO XST00008-LOC-SKU-STAT-CDE05610000
013300        MOVE IM008-STR-RTL-UPC-STAT-CHG-DTE                       05620000
013300                                      TO XST00008-UPC-STAT-CHG-DTE05630000
013300     END-IF.                                                      05640000
                                                                        05650000
           IF IM008-STR-RTL-UPC-STAT-CDE-N = '30'                       05660000
      *       * CLEARANCE                       *                       05670000
              IF IM008-STR-RTL-MKDN-CDE <= SPACES                       05680000
      *          * NON-MARKDOWN OPTIMIZATION STORES *                   05690000
                 MOVE SPACES          TO XST00008-MKDN-CDE              05700000
                 SET PV-MKDN-CDE-NULL TO TRUE                           05710000
                                                                        05720000
                 IF IM008-STR-RTL-UNT-RTL-CHG-DTE <=                    05730000
                    IM008-STR-RTL-UPC-STAT-CHG-DTE                      05740000
      *             * YELLOW TICKET - SET ORIGINAL CLEARANCE DATE *     05750000
071206              PERFORM 3000-CHECK-CLR-DTE                          05760000
                                                                        05770000
                    SET PV-ORIG-CLR-DTE-VALUE           TO TRUE         05780000
                                                                        05790000
                 ELSE                                                   05800000
      *             * RED TICKET - CARRY OVER VALUES SET WHEN FIRST *   05810000
      *             * WENT TO YELLOW TICKET                         *   05820000
                    CONTINUE                                            05830000
                 END-IF                                                 05840000
              ELSE                                                      05850000
      *          * MARKDOWN OPTIMIZATION STORE *                        05860000
      *          * NON-MARKDOWN OPTIMIZATION STORE *                    05870000
                 MOVE IM008-STR-RTL-MKDN-CDE TO XST00008-MKDN-CDE       05880000
                 SET PV-MKDN-CDE-VALUE       TO TRUE                    05890000
                                                                        05900000
                 IF IM008-STR-RTL-MKDN-CDE = PC-MARK1                   05910000
      *             * MARK 1 CLEAR - SET ORIGINAL CLEARANCE DATE *      05920000
071206              PERFORM 3000-CHECK-CLR-DTE                          05930000
                                                                        05940000
                    SET PV-ORIG-CLR-DTE-VALUE TO TRUE                   05950000
                                                                        05960000
                 ELSE                                                   05970000
      *             * MARK 2 OR FINAL CLEAR - CARRY OVER VALUES SET *   05980000
      *             * WHEN FIRST WENT TO CLEARANCE                  *   05990000
                    CONTINUE                                            06000000
                 END-IF                                                 06010000
              END-IF                                                    06020000
           ELSE                                                         06030000
      *       * NOT CLEARANCE                   *                       06040000
              MOVE SPACES              TO XST00008-MKDN-CDE             06050000
              MOVE SPACES              TO XST00008-ORIG-CLR-DTE         06060000
              SET PV-MKDN-CDE-NULL     TO TRUE                          06070000
              SET PV-ORIG-CLR-DTE-NULL TO TRUE                          06080000
013300     END-IF.                                                      06090000
013400                                                                  06100000
013500     PERFORM                                                      06110000
013500        WITH TEST AFTER                                           06120000
013500        VARYING PV-RETRIES                                        06130000
013500        FROM 1 BY 1                                               06140000
013500        UNTIL PV-RETRIES > PC-MAX-RETRIES                         06150000
013500        OR SQLCODE = ZERO                                         06160000
013500        OR PS-CONTINUE-NO                                         06170000
013600                                                                  06180000
013500        EXEC SQL                                                  06190000
013600           UPDATE XST_SKU_LOC                                     06200000
013600              SET END_TMST          = NULL                        06210000
013300                 ,UNT_RTL_AMT       = :XST00008-UNT-RTL-AMT       06220000
013300                 ,LOC_SKU_STAT_CDE  = :XST00008-LOC-SKU-STAT-CDE  06230000
013300                 ,UPC_STAT_CHG_DTE  = :XST00008-UPC-STAT-CHG-DTE  06240000
013300                 ,UNT_RTL_CHG_DTE   = :XST00008-UNT-RTL-CHG-DTE   06250000
013600                 ,LAST_UPD_TMST     = CURRENT TIMESTAMP           06260000
013600                 ,SOR_LAST_MSG_TMST = :IM008-CRE-TMST             06270000
013300                 ,MKDN_CDE          = :XST00008-MKDN-CDE          06280000
013300                                      :PV-MKDN-CDE-IND            06290000
013300                 ,ORIG_CLR_DTE      = :XST00008-ORIG-CLR-DTE      06300000
013300                                      :PV-ORIG-CLR-DTE-IND        06310000
013700            WHERE INTR_UPC_ID       = :XST00008-INTR-UPC-ID       06320000
013700              AND LOC_NBR           = :XST00008-LOC-NBR           06330000
013700              AND BEG_TMST          = :XST00008-BEG-TMST          06340000
013800        END-EXEC                                                  06350000
TEST              IF XST00008-INTR-UPC-ID = 86197296 OR                 06351005
TEST                 XST00008-INTR-UPC-ID = 23871248 OR                 06352005
TEST                 XST00008-INTR-UPC-ID = 2090267008                  06353005
TEST          DISPLAY 'XSKUP049 LOG WHEN SKU_LOC UPDATE'                06354005
TEST          DISPLAY 'XST00008-INTR-UPC-ID=' XST00008-INTR-UPC-ID      06355005
TEST          DISPLAY 'XST00008-LOC-NBR=' XST00008-LOC-NBR              06356005
TEST          DISPLAY 'XST00008-BEG-TMST=' XST00008-BEG-TMST            06356105
TEST          DISPLAY 'SQLCODE=' SQLCODE                                06357005
TEST              END-IF                                                06358005
013900                                                                  06360000
014000        EVALUATE TRUE                                             06370000
014200           WHEN SQLCODE = ZERO                                    06380000
014300              CONTINUE                                            06390000
014500           WHEN SQLCODE = -904                                    06400000
014500           WHEN SQLCODE = -911                                    06410000
014500           WHEN SQLCODE = -913                                    06420000
014600              IF PV-RETRIES >= PC-MAX-RETRIES                     06430000
014700                 SET PS-CONTINUE-NO   TO TRUE                     06440000
013300                 MOVE '2300-UPDATE-PRICE-STATUS'                  06450000
013300                                      TO PV-PARAGRAPH-NAME        06460000
015000              END-IF                                              06470000
015100           WHEN OTHER                                             06480000
013300              MOVE '2300-UPDATE-PRICE-STATUS'                     06490000
013300                                      TO PV-PARAGRAPH-NAME        06500000
014700              SET PS-CONTINUE-NO      TO TRUE                     06510000
015300        END-EVALUATE                                              06520000
015300     END-PERFORM.                                                 06530000
015400                                                                  06540000
012500***************************************************************** 06550000
013100 2400-END-CURRENT-ROW.                                            06560000
012600*     PERFORM AN UPDATE TO END THE CURRENT ROW IN SKU LOCATION    06570000
012600*     TABLE.                                                      06580000
013000***************************************************************** 06590000
013200                                                                  06600000
013600     MOVE XST00008-INTR-UPC-ID        TO PV-INTR-UPC-ID.          06610000
013600     MOVE XST00008-LOC-NBR            TO PV-LOC-NBR.              06620000
013600     MOVE XST00008-BEG-TMST           TO PV-BEG-TMST.             06630000
013600     MOVE XST00008-UNT-RTL-AMT        TO PV-UNT-RTL-AMT.          06640000
013600     MOVE XST00008-UNT-COST-AMT       TO PV-UNT-COST-AMT.         06650000
013600     MOVE XST00008-LOC-SKU-STAT-CDE   TO PV-LOC-SKU-STAT-CDE.     06660000
013600     MOVE XST00008-UPC-STAT-CHG-DTE   TO PV-UPC-STAT-CHG-DTE.     06670000
013600     MOVE XST00008-UNT-RTL-CHG-DTE    TO PV-UNT-RTL-CHG-DTE.      06680000
013600     MOVE XST00008-LAST-UPD-TMST      TO PV-LAST-UPD-TMST.        06690000
013600     MOVE XST00008-SOR-LAST-MSG-TMST  TO PV-SOR-LAST-MSG-TMST.    06700000
013600     MOVE XST00008-END-TMST           TO PV-END-TMST.             06710000
013600     MOVE XST00008-GP-PRIC-ID         TO PV-GP-PRIC-ID.           06720000
013600     MOVE XST00008-GP-RTL-QTY         TO PV-GP-RTL-QTY.           06730000
013600     MOVE XST00008-GP-RTL-AMT         TO PV-GP-RTL-AMT.           06740000
013600     MOVE XST00008-MKDN-CDE           TO PV-MKDN-CDE.             06750000
013600     MOVE XST00008-ORIG-CLR-DTE       TO PV-ORIG-CLR-DTE.         06760000
013600                                                                  06770000
013500     PERFORM                                                      06780000
013500        WITH TEST AFTER                                           06790000
013500        VARYING PV-RETRIES                                        06800000
013500        FROM 1 BY 1                                               06810000
013500        UNTIL PV-RETRIES > PC-MAX-RETRIES                         06820000
013500        OR SQLCODE = ZERO                                         06830000
013500        OR PS-CONTINUE-NO                                         06840000
013600                                                                  06850000
013500        EXEC SQL                                                  06860000
013600           UPDATE XST_SKU_LOC                                     06870000
013600              SET END_TMST          = TIMESTAMP                   06880000
013600                  (:IM008-STR-RTL-EFF-BEG-TMST) - 1 MICROSECOND   06890000
013600                 ,LAST_UPD_TMST     = CURRENT TIMESTAMP           06900000
013600                 ,SOR_LAST_MSG_TMST = :IM008-CRE-TMST             06910000
013700            WHERE INTR_UPC_ID       = :XST00008-INTR-UPC-ID       06920000
013700              AND LOC_NBR           = :XST00008-LOC-NBR           06930000
013700              AND BEG_TMST          = :XST00008-BEG-TMST          06940000
013800        END-EXEC                                                  06950000
013900                                                                  06960000
014000        EVALUATE TRUE                                             06970000
014200           WHEN SQLCODE = ZERO                                    06980000
014300              CONTINUE                                            06990000
014500           WHEN SQLCODE = -904                                    07000000
014500           WHEN SQLCODE = -911                                    07010000
014500           WHEN SQLCODE = -913                                    07020000
014600              IF PV-RETRIES >= PC-MAX-RETRIES                     07030000
014700                 SET PS-CONTINUE-NO   TO TRUE                     07040000
013300                 MOVE '2400-END-CURRENT-ROW'                      07050000
013300                                      TO PV-PARAGRAPH-NAME        07060000
015000              END-IF                                              07070000
015100           WHEN OTHER                                             07080000
013300              MOVE '2400-END-CURRENT-ROW'                         07090000
013300                                      TO PV-PARAGRAPH-NAME        07100000
014700              SET PS-CONTINUE-NO      TO TRUE                     07110000
015300        END-EVALUATE                                              07120000
015300     END-PERFORM.                                                 07130000
015400                                                                  07140000
012500***************************************************************** 07150000
013100 2420-POPULATE-FIELDS-NEW.                                        07160000
012600*     POPULATE FIELDS FOR INSERTING A ROW TO XST_SKU_LOC WHEN     07170000
      *     NO ROW CURRENTLY EXISTS FOR SKU/STORE.                      07180000
013000***************************************************************** 07190000
                                                                        07200000
013500     MOVE IM008-STR-RTL-EFF-BEG-TMST    TO XST00008-BEG-TMST.     07210000
013500     MOVE IM008-CRE-TMST                TO                        07220000
013500          XST00008-SOR-LAST-MSG-TMST.                             07230000
013300     MOVE IM008-STR-RTL-UNT-RTL-AMT-N   TO XST00008-UNT-RTL-AMT.  07240000
013300     MOVE IM008-STR-RTL-UNT-RTL-CHG-DTE TO                        07250000
013300          XST00008-UNT-RTL-CHG-DTE.                               07260000
013300     MOVE IM008-STR-RTL-UPC-STAT-CDE-N  TO                        07270000
013300          XST00008-LOC-SKU-STAT-CDE.                              07280000
                                                                        07290000
           IF IM008-STR-RTL-UPC-STAT-CHG-DTE <= SPACES                  07300000
013300        MOVE PV-CORP-UPC-STAT-CHG-DTE       TO                    07310000
013300             XST00008-UPC-STAT-CHG-DTE                            07320000
           ELSE                                                         07330000
013300        MOVE IM008-STR-RTL-UPC-STAT-CHG-DTE TO                    07340000
013300             XST00008-UPC-STAT-CHG-DTE                            07350000
           END-IF.                                                      07360000
                                                                        07370000
013300     MOVE IM008-STR-RTL-UNT-COST-AMT-SUP    TO                    07380000
013300          XST00008-UNT-COST-AMT.                                  07390000
                                                                        07400000
           IF IM008-STR-RTL-UPC-STAT-CDE-N = '30'                       07410000
      *       * CLEARANCE                       *                       07420000
              IF IM008-STR-RTL-MKDN-CDE <= SPACES                       07430000
      *          * NON-MARKDOWN OPTIMIZATION STORES *                   07440000
                 MOVE SPACES          TO XST00008-MKDN-CDE              07450000
                 SET PV-MKDN-CDE-NULL TO TRUE                           07460000
                                                                        07470000
                 IF IM008-STR-RTL-UNT-RTL-CHG-DTE <=                    07480000
                    IM008-STR-RTL-UPC-STAT-CHG-DTE                      07490000
      *             * YELLOW TICKET - SET ORIGINAL CLEARANCE DATE *     07500000
071206              PERFORM 3000-CHECK-CLR-DTE                          07510000
                                                                        07520000
                    SET PV-ORIG-CLR-DTE-VALUE           TO TRUE         07530000
                                                                        07540000
                 ELSE                                                   07550000
      *             * RED TICKET - CARRY OVER VALUES SET WHEN FIRST *   07560000
      *             * WENT TO YELLOW TICKET - CARRY OVER CORP VALUES*   07570000
                    MOVE PV-CORP-ORIG-CLR-DTE           TO              07580000
                         XST00008-ORIG-CLR-DTE                          07590000
                    MOVE PV-CORP-ORIG-CLR-DTE-IND       TO              07600000
                         PV-ORIG-CLR-DTE-IND                            07610000
                 END-IF                                                 07620000
              ELSE                                                      07630000
      *          * MARKDOWN OPTIMIZATION STORE *                        07640000
      *          * NON-MARKDOWN OPTIMIZATION STORE *                    07650000
                 MOVE IM008-STR-RTL-MKDN-CDE TO XST00008-MKDN-CDE       07660000
                 SET PV-MKDN-CDE-VALUE       TO TRUE                    07670000
                                                                        07680000
                 IF IM008-STR-RTL-MKDN-CDE = PC-MARK1                   07690000
      *             * MARK 1 CLEAR - SET ORIGINAL CLEARANCE DATE *      07700000
071206              PERFORM 3000-CHECK-CLR-DTE                          07710000
                                                                        07720000
                    SET PV-ORIG-CLR-DTE-VALUE           TO TRUE         07730000
                                                                        07740000
                 ELSE                                                   07750000
      *             * MARK 2 OR FINAL CLEAR - CARRY OVER VALUES SET *   07760000
      *             * WHEN FIRST WENT TO CLEARANCE - CORP VALUES    *   07770000
                    MOVE PV-CORP-ORIG-CLR-DTE           TO              07780000
                         XST00008-ORIG-CLR-DTE                          07790000
                    MOVE PV-CORP-ORIG-CLR-DTE-IND       TO              07800000
                         PV-ORIG-CLR-DTE-IND                            07810000
                 END-IF                                                 07820000
              END-IF                                                    07830000
           ELSE                                                         07840000
      *       * NOT CLEARANCE                   *                       07850000
              MOVE SPACES              TO XST00008-MKDN-CDE             07860000
              MOVE SPACES              TO XST00008-ORIG-CLR-DTE         07870000
              SET PV-MKDN-CDE-NULL     TO TRUE                          07880000
              SET PV-ORIG-CLR-DTE-NULL TO TRUE                          07890000
013300     END-IF.                                                      07900000
015400                                                                  07910000
012500***************************************************************** 07920000
013100 2450-POPULATE-FIELDS.                                            07930000
012600*     POPULATE FIELDS FOR INSERTING A ROW TO XST_SKU_LOC.         07940000
013000***************************************************************** 07950000
013200                                                                  07960000
013300     MOVE PV-SAVE-DATA                TO DCLXST00008.             07970000
013500     MOVE IM008-STR-RTL-EFF-BEG-TMST  TO XST00008-BEG-TMST.       07980000
013500     MOVE IM008-CRE-TMST              TO                          07990000
013500          XST00008-SOR-LAST-MSG-TMST.                             08000000
013300                                                                  08010000
013300     IF IM008-STR-RTL-UNT-RTL-AMT-CHG                             08020000
013300        MOVE IM008-STR-RTL-UNT-RTL-AMT-N                          08030000
013300                                      TO XST00008-UNT-RTL-AMT     08040000
013300        MOVE IM008-STR-RTL-UNT-RTL-CHG-DTE                        08050000
013300                                      TO XST00008-UNT-RTL-CHG-DTE 08060000
013300     END-IF.                                                      08070000
013400                                                                  08080000
013300     IF IM008-STR-RTL-SKU-STAT-DSC-CHG                            08090000
013300        MOVE IM008-STR-RTL-UPC-STAT-CDE-N                         08100000
013300                                      TO XST00008-LOC-SKU-STAT-CDE08110000
013300        MOVE IM008-STR-RTL-UPC-STAT-CHG-DTE                       08120000
013300                                      TO XST00008-UPC-STAT-CHG-DTE08130000
013300     END-IF.                                                      08140000
                                                                        08150000
           IF IM008-STR-RTL-UPC-STAT-CDE-N = '30'                       08160000
      *       * CLEARANCE                       *                       08170000
              IF IM008-STR-RTL-MKDN-CDE <= SPACES                       08180000
      *          * NON-MARKDOWN OPTIMIZATION STORES *                   08190000
                 MOVE SPACES          TO XST00008-MKDN-CDE              08200000
                 SET PV-MKDN-CDE-NULL TO TRUE                           08210000
                                                                        08220000
                 IF IM008-STR-RTL-UNT-RTL-CHG-DTE <=                    08230000
                    IM008-STR-RTL-UPC-STAT-CHG-DTE                      08240000
      *             * YELLOW TICKET - SET ORIGINAL CLEARANCE DATE *     08250000
                                                                        08260000
071806              IF PV-ORIG-CLR-DTE <= SPACES                        08270000
071206                 PERFORM 3000-CHECK-CLR-DTE                       08280000
071806              ELSE                                                08290000
071806                 CONTINUE                                         08300000
071806              END-IF                                              08310000
                                                                        08320000
                    SET PV-ORIG-CLR-DTE-VALUE           TO TRUE         08330000
                                                                        08340000
                 ELSE                                                   08350000
      *             * RED TICKET - CARRY OVER VALUES SET WHEN FIRST *   08360000
      *             * WENT TO YELLOW TICKET - STORE VALUES          *   08370000
                    CONTINUE                                            08380000
                 END-IF                                                 08390000
              ELSE                                                      08400000
      *          * MARKDOWN OPTIMIZATION STORE *                        08410000
      *          * NON-MARKDOWN OPTIMIZATION STORE *                    08420000
                 MOVE IM008-STR-RTL-MKDN-CDE TO XST00008-MKDN-CDE       08430000
                 SET PV-MKDN-CDE-VALUE       TO TRUE                    08440000
                                                                        08450000
                 IF IM008-STR-RTL-MKDN-CDE = PC-MARK1                   08460000
      *             * MARK 1 CLEAR - SET ORIGINAL CLEARANCE DATE *      08470000
                                                                        08480000
071806              IF PV-ORIG-CLR-DTE <= SPACES                        08490000
071206                 PERFORM 3000-CHECK-CLR-DTE                       08500000
071806              ELSE                                                08510000
071806                 CONTINUE                                         08520000
071806              END-IF                                              08530000
                                                                        08540000
                    SET PV-ORIG-CLR-DTE-VALUE           TO TRUE         08550000
                                                                        08560000
                 ELSE                                                   08570000
      *             * MARK 2 OR FINAL CLEAR - CARRY OVER VALUES SET *   08580000
      *             * WHEN FIRST WENT TO CLEARANCE - STORE VALUES   *   08590000
                    CONTINUE                                            08600000
                 END-IF                                                 08610000
              END-IF                                                    08620000
           ELSE                                                         08630000
      *       * NOT CLEARANCE                   *                       08640000
              MOVE SPACES              TO XST00008-MKDN-CDE             08650000
              MOVE SPACES              TO XST00008-ORIG-CLR-DTE         08660000
              SET PV-MKDN-CDE-NULL     TO TRUE                          08670000
              SET PV-ORIG-CLR-DTE-NULL TO TRUE                          08680000
013300     END-IF.                                                      08690000
013400                                                                  08700000
012500***************************************************************** 08710000
CL3132 2500-BUILD-NEW-ROW.                                              08720000
CL3132*     POPULATE FILEDS FOR A MULTI-ROW INSERT INTO XST_SKU_LOC     08730000
013000***************************************************************** 08740000
CL3132     ADD +1 TO PV-SUB                                             08750000
CL3132     MOVE XST00008-INTR-UPC-ID  TO TL-HV8-INTR-UPC-ID (PV-SUB)    08760000
CL3132     MOVE XST00008-LOC-NBR      TO TL-HV8-LOC-NBR (PV-SUB)        08770000
CL3132     MOVE XST00008-BEG-TMST     TO TL-HV8-BEG-TMST (PV-SUB)       08780000
CL3132     MOVE SPACES                TO TL-HV8-END-TMST (PV-SUB)       08790000
CL3132     MOVE PC-NULL-IND           TO TL-HV8-END-TMST-IND (PV-SUB)   08800000
CL3132     MOVE XST00008-UNT-RTL-AMT  TO TL-HV8-UNT-RTL-AMT (PV-SUB)    08810000
CL3132     MOVE XST00008-UNT-COST-AMT TO TL-HV8-UNT-COST-AMT (PV-SUB)   08820000
CL3132     MOVE XST00008-LOC-SKU-STAT-CDE                               08830000
CL3132       TO TL-HV8-LOC-SKU-STAT-CDE (PV-SUB)                        08840000
CL3132     MOVE XST00008-UPC-STAT-CHG-DTE                               08850000
CL3132       TO TL-HV8-UPC-STAT-CHG-DTE (PV-SUB)                        08860000
CL3132     MOVE XST00008-UNT-RTL-CHG-DTE                                08870000
CL3132       TO TL-HV8-UNT-RTL-CHG-DTE (PV-SUB)                         08880000
CL3132     MOVE +0 TO TL-HV8-GP-PRIC-ID (PV-SUB)                        08890000
CL3132                TL-HV8-GP-RTL-QTY (PV-SUB)                        08900000
CL3132                TL-HV8-GP-RTL-AMT (PV-SUB)                        08910000
CL3132     MOVE PC-NULL-IND TO TL-HV8-GP-PRIC-ID-IND (PV-SUB)           08920000
CL3132                         TL-HV8-GP-RTL-QTY-IND (PV-SUB)           08930000
CL3132                         TL-HV8-GP-RTL-AMT-IND (PV-SUB)           08940000
CL3132     MOVE LV-CURRENT-TIMESTAMP  TO TL-HV8-LAST-UPD-TMST (PV-SUB)  08950000
CL3132     MOVE XST00008-SOR-LAST-MSG-TMST                              08960000
CL3132       TO TL-HV8-SOR-LAST-MSG-TMST (PV-SUB)                       08970000
CL3132     MOVE XST00008-MKDN-CDE     TO TL-HV8-MKDN-CDE (PV-SUB)       08980000
CL3132     MOVE PV-MKDN-CDE-IND       TO TL-HV8-MKDN-CDE-IND (PV-SUB)   08990000
CL3132     MOVE XST00008-ORIG-CLR-DTE TO TL-HV8-ORIG-CLR-DTE (PV-SUB)   09000000
CL3132     MOVE PV-ORIG-CLR-DTE-IND   TO                                09010000
            TL-HV8-ORIG-CLR-DTE-IND (PV-SUB).                           09020000
CL3132***************************************************************** 09030000
013100 2600-DETM-SKU-LOC-ATTR.                                          09040000
012600*     DETERMINE VALUE FOR PRMPT_FOR_PRIC_IND IN XST_SKU_LOC_ATTR. 09050000
013000***************************************************************** 09060000
013200                                                                  09070000
013300     IF IM008-STR-RTL-SKU-STAT-DSC-CHG                            09080000
013500        IF IM008-STR-RTL-UPC-STAT-CDE-N = PC-CLEARANCE            09090000
013500           IF IM008-STR-RTL-UPC-STAT-CHG-DTE <                    09100000
013500              IM008-STR-RTL-UNT-RTL-CHG-DTE                       09110000
013300              MOVE PC-NO              TO                          09120000
013300                   XST00041-PRMPT-FOR-PRIC-IND                    09130000
013500           ELSE                                                   09140000
013300              MOVE PC-NO              TO                          09150000
013300                   XST00041-PRMPT-FOR-PRIC-IND                    09160000
013500           END-IF                                                 09170000
013500           PERFORM 2700-UPDATE-SKU-LOC-ATTR                       09180000
013300        ELSE                                                      09190000
013300           IF IM008-STR-RTL-UPC-STAT-CDE = PC-CLEARANCE           09200000
013300              MOVE PC-YES             TO                          09210000
013300                   XST00041-PRMPT-FOR-PRIC-IND                    09220000
013500              PERFORM 2700-UPDATE-SKU-LOC-ATTR                    09230000
013500           END-IF                                                 09240000
013300        END-IF                                                    09250000
013300     ELSE                                                         09260000
013500        IF IM008-STR-RTL-UNT-RTL-AMT-CHG                          09270000
013500           IF IM008-STR-RTL-UPC-STAT-CDE-N = PC-CLEARANCE         09280000
013500              IF IM008-STR-RTL-UPC-STAT-CHG-DTE <                 09290000
013500                 IM008-STR-RTL-UNT-RTL-CHG-DTE                    09300000
013300                 MOVE PC-NO           TO                          09310000
013300                      XST00041-PRMPT-FOR-PRIC-IND                 09320000
013500              ELSE                                                09330000
013300                 MOVE PC-NO           TO                          09340000
013300                      XST00041-PRMPT-FOR-PRIC-IND                 09350000
013500              END-IF                                              09360000
013500              PERFORM 2700-UPDATE-SKU-LOC-ATTR                    09370000
013300           ELSE                                                   09380000
013300              MOVE PC-YES             TO                          09390000
013300                   XST00041-PRMPT-FOR-PRIC-IND                    09400000
013500              PERFORM 2700-UPDATE-SKU-LOC-ATTR                    09410000
013500           END-IF                                                 09420000
013300        END-IF                                                    09430000
013300     END-IF.                                                      09440000
013400                                                                  09450000
012500***************************************************************** 09460000
013100 2700-UPDATE-SKU-LOC-ATTR.                                        09470000
012600*     UPDATE TABLE XST_SKU_LOC_ATTR.                              09480000
013000***************************************************************** 09490000
013200                                                                  09500000
013500     PERFORM                                                      09510000
013500        WITH TEST AFTER                                           09520000
013500        VARYING PV-RETRIES                                        09530000
013500        FROM 1 BY 1                                               09540000
013500        UNTIL PV-RETRIES > PC-MAX-RETRIES                         09550000
013500        OR SQLCODE = ZERO                                         09560000
013500        OR PS-CONTINUE-NO                                         09570000
013600                                                                  09580000
013500        EXEC SQL                                                  09590000
013600           UPDATE XST_SKU_LOC_ATTR                                09600000
013600              SET PRMPT_FOR_PRIC_IND =                            09610000
013600                  :XST00041-PRMPT-FOR-PRIC-IND                    09620000
013600                 ,LAST_UPD_TMST      = CURRENT TIMESTAMP          09630000
013700            WHERE INTR_UPC_ID        = :XST00008-INTR-UPC-ID      09640000
013700              AND LOC_NBR            = :XST00008-LOC-NBR          09650000
013800        END-EXEC                                                  09660000
TEST              IF XST00008-INTR-UPC-ID = 86197296 OR                 09661005
TEST                 XST00008-INTR-UPC-ID = 23871248 OR                 09662005
TEST                 XST00008-INTR-UPC-ID = 2090267008                  09663005
TEST          DISPLAY 'XSKUP049 LOG WHEN SKU_LOC_ATTR UPDATE'           09664005
TEST          DISPLAY 'XST00008-INTR-UPC-ID=' XST00008-INTR-UPC-ID      09665005
TEST          DISPLAY 'XST00008-LOC-NBR=' XST00008-LOC-NBR              09666005
TEST          DISPLAY 'SQLCODE=' SQLCODE                                09668005
TEST              END-IF                                                09669005
014000                                                                  09670000
014000        EVALUATE TRUE                                             09680000
014200           WHEN SQLCODE = ZERO                                    09690000
014300              CONTINUE                                            09700000
014500           WHEN SQLCODE = -904                                    09710000
014500           WHEN SQLCODE = -911                                    09720000
014500           WHEN SQLCODE = -913                                    09730000
014600              IF PV-RETRIES >= PC-MAX-RETRIES                     09740000
014700                 SET PS-CONTINUE-NO   TO TRUE                     09750000
013300                 MOVE '2700-UPDATE-SKU-LOC-ATTR'                  09760000
013300                                      TO PV-PARAGRAPH-NAME        09770000
015000              END-IF                                              09780000
015100           WHEN OTHER                                             09790000
013300              MOVE '2700-UPDATE-SKU-LOC-ATTR'                     09800000
013300                                      TO PV-PARAGRAPH-NAME        09810000
014700              SET PS-CONTINUE-NO      TO TRUE                     09820000
015300        END-EVALUATE                                              09830000
015300     END-PERFORM.                                                 09840000
015400                                                                  09850000
012500***************************************************************** 09860000
013100 2800-DETM-PRICE-PRMPT-IND.                                       09870000
012600*     DETERMINE VALUE FOR PRMPT_FOR_PRIC_IND IN XST_SKU_LOC_ATTR. 09880000
013000***************************************************************** 09890000
013200                                                                  09900000
013500     IF IM008-STR-RTL-UPC-STAT-CDE-N = PC-CLEARANCE               09910000
013500        IF IM008-STR-RTL-UPC-STAT-CHG-DTE <                       09920000
013500           IM008-STR-RTL-UNT-RTL-CHG-DTE                          09930000
013300           MOVE PC-NO                 TO                          09940000
013300                XST00041-PRMPT-FOR-PRIC-IND                       09950000
013500        ELSE                                                      09960000
013300           MOVE PC-NO                 TO                          09970000
013300                XST00041-PRMPT-FOR-PRIC-IND                       09980000
013500        END-IF                                                    09990000
013300     ELSE                                                         10000000
013300        MOVE PC-NO                    TO                          10010000
013300             XST00041-PRMPT-FOR-PRIC-IND                          10020000
013300     END-IF.                                                      10030000
013400                                                                  10040000
012500***************************************************************** 10050000
CL3132 2900-BUILD-SKU-LOC-ATTR.                                         10060000
CL3132*     BUILD ROWS FOR MULTI-ROW INSERT INTO TABLE XST_SKU_LOC_ATTR.10070000
013000***************************************************************** 10080000
013200                                                                  10090000
CL3132     ADD +1 TO PV-SUB1.                                           10100000
CL3132     MOVE XST00008-INTR-UPC-ID   TO TL-HV41-INTR-UPC-ID (PV-SUB1) 10110000
CL3132     MOVE XST00008-LOC-NBR       TO TL-HV41-LOC-NBR (PV-SUB1)     10120000
CL3132     MOVE XST00041-PRMPT-FOR-PRIC-IND                             10130000
CL3132       TO TL-HV41-PRMPT-FOR-PRIC-IND (PV-SUB1)                    10140000
CL3132     MOVE LV-CURRENT-TIMESTAMP                                    10150000
CL3132       TO TL-HV41-LAST-UPD-TMST(PV-SUB1).                         10160000
CL3132***************************************************************** 10170000
CL3132* CHECK FOR THE CORRECT CLEARANCE DATE (STORE ROW)                10180000
CL3132***************************************************************** 10190000
071206 3000-CHECK-CLR-DTE.                                              10200000
071206                                                                  10210000
071206     EXEC SQL                                                     10220000
071206        SELECT ORIG_CLR_DTE                                       10230000
071206                                                                  10240000
071206          INTO :XST00008-ORIG-CLR-DTE :NI-CLR-DTE                 10250000
071206                                                                  10260000
071206          FROM XST_SKU_LOC                                        10270000
071206                                                                  10280000
071206         WHERE INTR_UPC_ID      = :XST00008-INTR-UPC-ID           10290000
071206           AND LOC_NBR          = :XST00008-LOC-NBR               10300000
071206           AND LOC_SKU_STAT_CDE = '30'                            10310000
071206           AND END_TMST         IS NULL                           10320000
071206                                                                  10330000
071206     END-EXEC.                                                    10340000
071206                                                                  10350000
071206** INDICATOR VALUE OF -1 INDICATES VALUE IS NULL, +0              10360000
071206** INDICATES NON-NULL VALUE                                       10370000
071206                                                                  10380000
071206     EVALUATE TRUE                                                10390000
071206        WHEN SQLCODE = ZERO                                       10400000
071206           IF  NI-CLR-DTE < ZERO                                  10410000
071206               PERFORM 3100-CHECK-COMP-CLR-DTE                    10420000
071206           ELSE                                                   10430000
071206               CONTINUE                                           10440000
071206           END-IF                                                 10450000
071206                                                                  10460000
071206        WHEN SQLCODE = +100                                       10470000
071206           PERFORM 3100-CHECK-COMP-CLR-DTE                        10480000
071206                                                                  10490000
071206        WHEN OTHER                                                10500000
071206           DISPLAY '          '                                   10510000
071206           DISPLAY 'UPC-ID  = ' XST00008-INTR-UPC-ID              10520000
071206           DISPLAY 'LOC-NBR = ' XST00008-LOC-NBR                  10530000
071206                                                                  10540000
071206           MOVE '3000-CHECK-CLR-DTE' TO PV-PARAGRAPH-NAME         10550000
071206           SET PS-CONTINUE-NO        TO TRUE                      10560000
071206                                                                  10570000
071206     END-EVALUATE.                                                10580000
071206                                                                  10590000
071206                                                                  10600000
071206***************************************************************** 10610000
071206* CHECK FOR THE CORRECT CLEARANCE DATE (COMPANY ROW)              10620000
071206***************************************************************** 10630000
071206 3100-CHECK-COMP-CLR-DTE.                                         10640000
071206                                                                  10650000
071206     EXEC SQL                                                     10660000
071206        SELECT ORIG_CLR_DTE                                       10670000
071206                                                                  10680000
071206          INTO :XST00008-ORIG-CLR-DTE :NI-CLR-DTE                 10690000
071206                                                                  10700000
071206          FROM XST_SKU_LOC                                        10710000
071206                                                                  10720000
071206         WHERE INTR_UPC_ID      = :XST00008-INTR-UPC-ID           10730000
071206           AND LOC_NBR          = 0                               10740000
071206           AND LOC_SKU_STAT_CDE = '30'                            10750000
071206           AND END_TMST         IS NULL                           10760000
071206                                                                  10770000
071206     END-EXEC.                                                    10780000
071206                                                                  10790000
071206** INDICATOR VALUE OF -1 INDICATES VALUE IS NULL, +0              10800000
071206** INDICATES NON-NULL VALUE                                       10810000
071206                                                                  10820000
071206     EVALUATE TRUE                                                10830000
071206        WHEN SQLCODE = ZERO                                       10840000
071206           IF  NI-CLR-DTE < ZERO                                  10850000
071206               MOVE IM008-STR-RTL-UPC-STAT-CHG-DTE                10860000
071206                                          TO XST00008-ORIG-CLR-DTE10870000
071206           ELSE                                                   10880000
071206               CONTINUE                                           10890000
071206           END-IF                                                 10900000
071206                                                                  10910000
071206        WHEN SQLCODE = +100                                       10920000
071206           MOVE IM008-STR-RTL-UPC-STAT-CHG-DTE                    10930000
071206                                          TO XST00008-ORIG-CLR-DTE10940000
071206                                                                  10950000
071206        WHEN OTHER                                                10960000
071206           DISPLAY '          '                                   10970000
071206           DISPLAY 'UPC-ID  = ' XST00008-INTR-UPC-ID              10980000
071206                                                                  10990000
071206           MOVE '3100-CHECK-COMP-CLR-DTE' TO PV-PARAGRAPH-NAME    11000000
071206           SET PS-CONTINUE-NO             TO TRUE                 11010000
071206                                                                  11020000
071206     END-EVALUATE.                                                11030000
071206                                                                  11040000
071206                                                                  11050000
071206                                                                  11060000
CL3132******************************************************************11070000
CL3132*MULTI ROW INSERT INTO TABLE XST_SKU_LOC                          11080000
CL3132*4000-MULTI-INSERT-SKU-LOC.                                       11090000
CL3132******************************************************************11100000
CL3132 4000-MULTI-INSERT-SKU-LOC.                                       11110000
CL3132                                                                  11120000
CL3132     PERFORM                                                      11130000
CL3132        WITH TEST AFTER                                           11140000
CL3132        VARYING PV-RETRIES                                        11150000
CL3132        FROM 1 BY 1                                               11160000
CL3132        UNTIL PV-RETRIES > PC-MAX-RETRIES                         11170000
CL3132        OR SQLCODE = ZERO                                         11180000
CL3132        OR PS-CONTINUE-NO                                         11190000
CL3132                                                                  11200000
CL3132        EXEC SQL                                                  11210000
CL3132           INSERT INTO XST_SKU_LOC                                11220000
CL3132              ( INTR_UPC_ID                                       11230000
CL3132               ,LOC_NBR                                           11240000
CL3132               ,BEG_TMST                                          11250000
CL3132               ,END_TMST                                          11260000
CL3132               ,UNT_RTL_AMT                                       11270000
CL3132               ,UNT_COST_AMT                                      11280000
CL3132               ,LOC_SKU_STAT_CDE                                  11290000
CL3132               ,UPC_STAT_CHG_DTE                                  11300000
CL3132               ,UNT_RTL_CHG_DTE                                   11310000
CL3132               ,GP_PRIC_ID                                        11320000
CL3132               ,GP_RTL_QTY                                        11330000
CL3132               ,GP_RTL_AMT                                        11340000
CL3132               ,LAST_UPD_TMST                                     11350000
CL3132               ,SOR_LAST_MSG_TMST                                 11360000
CL3132               ,MKDN_CDE                                          11370000
CL3132               ,ORIG_CLR_DTE)                                     11380000
CL3132           VALUES (                                               11390000
CL3132              :TL-HV8-INTR-UPC-ID                                 11400000
CL3132             ,:TL-HV8-LOC-NBR                                     11410000
CL3132             ,:TL-HV8-BEG-TMST                                    11420000
CL3132             ,:TL-HV8-END-TMST :TL-HV8-END-TMST-IND               11430000
CL3132             ,:TL-HV8-UNT-RTL-AMT                                 11440000
CL3132             ,:TL-HV8-UNT-COST-AMT                                11450000
CL3132             ,:TL-HV8-LOC-SKU-STAT-CDE                            11460000
CL3132             ,:TL-HV8-UPC-STAT-CHG-DTE                            11470000
CL3132             ,:TL-HV8-UNT-RTL-CHG-DTE                             11480000
CL3132             ,:TL-HV8-GP-PRIC-ID :TL-HV8-GP-PRIC-ID-IND           11490000
CL3132             ,:TL-HV8-GP-RTL-QTY :TL-HV8-GP-RTL-QTY-IND           11500000
CL3132             ,:TL-HV8-GP-RTL-AMT :TL-HV8-GP-RTL-AMT-IND           11510000
CL3132             ,:TL-HV8-LAST-UPD-TMST                               11520000
CL3132             ,:TL-HV8-SOR-LAST-MSG-TMST                           11530000
CL3132             ,:TL-HV8-MKDN-CDE :TL-HV8-MKDN-CDE-IND               11540000
CL3132             ,:TL-HV8-ORIG-CLR-DTE :TL-HV8-ORIG-CLR-DTE-IND       11550000
CL3132           )  FOR :PV-ROWS ROWS                                   11560000
CL3132        END-EXEC                                                  11570000
TEST              IF TL-HV8-INTR-UPC-ID(PV-SUB) = 86197296 OR           11571000
TEST                 TL-HV8-INTR-UPC-ID(PV-SUB) = 23871248 OR           11572003
TEST                 TL-HV8-INTR-UPC-ID(PV-SUB) = 2090267008            11573003
TEST          DISPLAY 'XSKUP049 LOGS FOR SKU_LOC INSERT'                11573105
TEST          DISPLAY 'PV-ROWS=' PV-ROWS                                11574001
TEST          DISPLAY 'TL-HV8-INTR-UPC-ID=' TL-HV8-INTR-UPC-ID(PV-SUB)  11575000
TEST          DISPLAY 'TL-HV8-LOC-NBR=' TL-HV8-LOC-NBR(PV-SUB)          11576000
TEST          DISPLAY 'TL-HV8-BEG-TMST=' TL-HV8-BEG-TMST(PV-SUB)        11577000
TEST          DISPLAY 'PV-RETURN-SQLCODE=' SQLCODE                      11578001
TEST              END-IF                                                11579000
CL3132                                                                  11580000
CL3132        EVALUATE TRUE                                             11590000
CL3132           WHEN SQLCODE = ZERO                                    11600000
TEST              IF TL-HV8-INTR-UPC-ID(PV-SUB) = 86197296 OR           11610000
TEST                 TL-HV8-INTR-UPC-ID(PV-SUB) = 23871248 OR           11620003
TEST                 TL-HV8-INTR-UPC-ID(PV-SUB) = 2090267008            11621003
TEST          DISPLAY 'XSKUP049 LOGS WHEN ZERO'                         11630000
TEST          DISPLAY 'PV-ROWS=' PV-ROWS                                11640001
TEST          DISPLAY 'TL-HV8-INTR-UPC-ID=' TL-HV8-INTR-UPC-ID(PV-SUB)  11650000
TEST          DISPLAY 'TL-HV8-LOC-NBR=' TL-HV8-LOC-NBR(PV-SUB)          11660000
TEST          DISPLAY 'TL-HV8-BEG-TMST=' TL-HV8-BEG-TMST(PV-SUB)        11670000
TEST          DISPLAY 'PV-RETURN-SQLCODE=' SQLCODE                      11680001
TEST              END-IF                                                11690000
TEST                CONTINUE                                            11700000
CL3132           WHEN SQLCODE = -904                                    11710000
CL3132           WHEN SQLCODE = -911                                    11720000
CL3132           WHEN SQLCODE = -913                                    11730000
CL3132              IF PV-RETRIES >= PC-MAX-RETRIES                     11740000
CL3132                 SET PS-CONTINUE-NO   TO TRUE                     11750000
CL3132              MOVE '4000-MULTI-INSERT-SKU-LOC'                    11760000
CL3132                                      TO PV-PARAGRAPH-NAME        11770000
CL3132              MOVE SQLCODE TO PV-RETURN-SQLCODE                   11780000
CL3132              END-IF                                              11790000
CL3132           WHEN OTHER                                             11800000
CL3132              MOVE SQLCODE TO PV-RETURN-SQLCODE                   11810000
CL3132              MOVE '4000-MULTI-INSERT-SKU-LOC'                    11820000
CL3132                                      TO PV-PARAGRAPH-NAME        11830000
CL3132              SET PS-CONTINUE-NO      TO TRUE                     11840000
CL3132                                                                  11850000
TEST               IF TL-HV8-INTR-UPC-ID(PV-SUB) = 86197296 OR          11860000
TEST                  TL-HV8-INTR-UPC-ID(PV-SUB) = 23871248 OR          11870003
TEST                  TL-HV8-INTR-UPC-ID(PV-SUB) = 2090267008           11871003
TEST        DISPLAY 'XSKUP049 LOGS WHEN OTHER'                          11880000
TEST        DISPLAY 'PV-ROWS=' PV-ROWS                                  11890001
TEST        DISPLAY 'TL-HV8-INTR-UPC-ID=' TL-HV8-INTR-UPC-ID(PV-SUB)    11900000
TEST        DISPLAY 'TL-HV8-LOC-NBR=' TL-HV8-LOC-NBR(PV-SUB)            11910000
TEST        DISPLAY 'TL-HV8-BEG-TMST=' TL-HV8-BEG-TMST(PV-SUB)          11920000
TEST        DISPLAY 'PV-RETURN-SQLCODE=' PV-RETURN-SQLCODE              11930001
TEST               END-IF                                               11940000
CL3132                                                                  11950000
CL3132        END-EVALUATE                                              11960000
CL3132     END-PERFORM.                                                 11970000
CL3132                                                                  11980000
CL3132******************************************************************11990000
CL3132*MULTI ROW INSERT INTO TABLE XST_SKU_LOC_ATTR                     12000000
CL3132*4100-MULTI-INSERT-SKU-LOC-ATTR.                                  12010000
CL3132******************************************************************12020000
CL3132 4100-MULTI-INSERT-SKU-LOC-ATTR.                                  12030000
CL3132                                                                  12040000
CL3132     PERFORM                                                      12050000
CL3132        WITH TEST AFTER                                           12060000
CL3132        VARYING PV-RETRIES                                        12070000
CL3132        FROM 1 BY 1                                               12080000
CL3132        UNTIL PV-RETRIES > PC-MAX-RETRIES                         12090000
CL3132        OR SQLCODE = ZERO                                         12100000
CL3132        OR PS-CONTINUE-NO                                         12110000
CL3132                                                                  12120000
CL3132        EXEC SQL                                                  12130000
CL3132           INSERT INTO XST_SKU_LOC_ATTR                           12140000
CL3132              ( INTR_UPC_ID                                       12150000
CL3132               ,LOC_NBR                                           12160000
CL3132               ,PRMPT_FOR_PRIC_IND                                12170000
CL3132               ,LAST_UPD_TMST)                                    12180000
CL3132           VALUES                                                 12190000
CL3132              ( :TL-HV41-INTR-UPC-ID                              12200000
CL3132               ,:TL-HV41-LOC-NBR                                  12210000
CL3132               ,:TL-HV41-PRMPT-FOR-PRIC-IND                       12220000
CL3132               ,:TL-HV41-LAST-UPD-TMST                            12230000
CL3132              ) FOR :PV-ROWS ROWS                                 12240000
CL3132        END-EXEC                                                  12250000
TEST                                                                    12250100
TEST              IF TL-HV41-INTR-UPC-ID(PV-SUB) = 86197296 OR          12251000
TEST                 TL-HV41-INTR-UPC-ID(PV-SUB) = 23871248 OR          12252003
TEST                 TL-HV41-INTR-UPC-ID(PV-SUB) = 2090267008           12252103
TEST          DISPLAY 'XSKUP049 LOGS FOR SKU_LOC_ATTR INSERT'           12252205
TEST          DISPLAY 'PV-ROWS=' PV-ROWS                                12253001
TEST          DISPLAY 'TL-HV41-INTR-UPC-ID=' TL-HV41-INTR-UPC-ID(PV-SUB)12254000
TEST          DISPLAY 'TL-HV41-LOC-NBR=' TL-HV41-LOC-NBR(PV-SUB)        12255000
TEST          DISPLAY 'PV-RETURN-SQLCODE=' SQLCODE                      12257001
TEST              END-IF                                                12258000
CL3132                                                                  12260000
CL3132        EVALUATE TRUE                                             12270000
CL3132           WHEN SQLCODE = ZERO                                    12280000
TEST              IF TL-HV41-INTR-UPC-ID(PV-SUB) = 86197296 OR          12281000
TEST                 TL-HV41-INTR-UPC-ID(PV-SUB) = 23871248 OR          12282003
TEST                 TL-HV41-INTR-UPC-ID(PV-SUB) = 2090267008           12282103
TEST          DISPLAY 'XSKUP049 - ATTR LOGS WHEN ZERO'                  12282205
TEST          DISPLAY 'PV-ROWS=' PV-ROWS                                12283001
TEST          DISPLAY 'TL-HV41-INTR-UPC-ID=' TL-HV41-INTR-UPC-ID(PV-SUB)12284000
TEST          DISPLAY 'TL-HV41-LOC-NBR=' TL-HV41-LOC-NBR(PV-SUB)        12285000
TEST          DISPLAY 'PV-RETURN-SQLCODE=' SQLCODE                      12286001
TEST              END-IF                                                12287000
CL3132              CONTINUE                                            12290000
CL3132           WHEN SQLCODE = -904                                    12300000
CL3132           WHEN SQLCODE = -911                                    12310000
CL3132           WHEN SQLCODE = -913                                    12320000
CL3132              IF PV-RETRIES >= PC-MAX-RETRIES                     12330000
CL3132                 SET PS-CONTINUE-NO   TO TRUE                     12340000
CL3132              MOVE '4100-MULTI-INSERT-SKU-LOC-ATTR'               12350000
CL3132                                      TO PV-PARAGRAPH-NAME        12360000
CL3132              MOVE SQLCODE TO PV-RETURN-SQLCODE                   12370000
CL3132              END-IF                                              12380000
CL3132           WHEN OTHER                                             12390000
TEST              IF TL-HV41-INTR-UPC-ID(PV-SUB) = 86197296 OR          12391000
TEST                 TL-HV41-INTR-UPC-ID(PV-SUB) = 23871248 OR          12392003
TEST                 TL-HV41-INTR-UPC-ID(PV-SUB) = 2090267008           12392103
TEST          DISPLAY 'XSKUP049 - ATTR LOGS WHEN OTHER'                 12393004
TEST          DISPLAY 'PV-ROWS=' PV-ROWS                                12394001
TEST          DISPLAY 'TL-HV41-INTR-UPC-ID=' TL-HV41-INTR-UPC-ID(PV-SUB)12395000
TEST          DISPLAY 'TL-HV41-LOC-NBR=' TL-HV41-LOC-NBR(PV-SUB)        12396000
TEST          DISPLAY 'PV-RETURN-SQLCODE=' SQLCODE                      12397001
TEST              END-IF                                                12398000
CL3132              MOVE SQLCODE TO PV-RETURN-SQLCODE                   12400000
CL3132              MOVE '4100-MULTI-INSERT-SKU-LOC-ATTR'               12410000
CL3132                                      TO PV-PARAGRAPH-NAME        12420000
CL3132              SET PS-CONTINUE-NO      TO TRUE                     12430000
CL3132        END-EVALUATE                                              12440000
CL3132     END-PERFORM.                                                 12450000
CL3132******************************************************************12460000
015600 9999-WRAPUP.                                                     12470000
015600*     MOVE RETURN CODE TO LINKAGE VARIABLE AND EXIT MODULE        12480000
015700******************************************************************12490000
015900                                                                  12500000
015900                                                                  12510000
CL3132     IF TL-RETURN-SQLCODE-RET (1) = ZEROS  AND                    12520000
CL3132        TL-RETURN-SQLCODE-RET (2) = ZEROS  AND                    12530000
CL3132        TL-RETURN-SQLCODE-RET (3) = ZEROS  AND                    12540000
CL3132        PV-RETURN-SQLCODE         = ZEROS                         12550000
CL3132        MOVE ZEROS                 TO LV-RETURN-CODE              12560000
CL3132     ELSE                                                         12570000
CL3132        IF TL-RETURN-SQLCODE-RET (1) NOT EQUAL ZEROS              12580000
CL3132           MOVE TL-RETURN-SQLCODE-RET (1)                         12590000
CL3132                                   TO LV-RETURN-CODE              12600000
CL3132        END-IF                                                    12610000
CL3132        IF TL-RETURN-SQLCODE-RET (2) NOT EQUAL ZEROS              12620000
CL3132           MOVE TL-RETURN-SQLCODE-RET (2)                         12630000
CL3132                                   TO LV-RETURN-CODE              12640000
CL3132        END-IF                                                    12650000
CL3132        IF TL-RETURN-SQLCODE-RET (3) NOT EQUAL ZEROS              12660000
CL3132           MOVE TL-RETURN-SQLCODE-RET (3)                         12670000
CL3132                                   TO LV-RETURN-CODE              12680000
CL3132        END-IF                                                    12690000
CL3132        IF PV-RETURN-SQLCODE         NOT EQUAL ZEROS              12700000
CL3132           MOVE PV-RETURN-SQLCODE  TO LV-RETURN-CODE              12710000
CL3132        END-IF                                                    12720000
CL3132      END-IF.                                                     12730000
016300     MOVE PS-ACTION-IND     TO LV-ACTION-IND.                     12740000
016400                                                                  12750000
016500     EXIT PROGRAM.                                                12760000
016600                                                                  12770000
