000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKRF516.                                00050000
000600 AUTHOR.                 MICHAEL WALTERS.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE CARTON AUDIT ASSOCIATE LOCATION       00120000
001300* SCREEN.                                                         00130000
001400******************************************************************00140000
001410*---------------------------------------------------------------* 00141002
001420* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00142003
001430* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00143003
001440* MAKING THE CALL DYNAMIC VS STATIC.                              00144003
001450*---------------------------------------------------------------* 00145003
001500                                                                  00150000
001600******************************************************************00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800******************************************************************00180000
001900                                                                  00190000
002000******************************************************************00200000
002100 DATA DIVISION.                                                   00210000
002200******************************************************************00220000
002300                                                                  00230000
002400******************************************************************00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700 01  CA-COMMAREA.                                                 00270000
002800     COPY SUWS006.                                                00280000
002900    05  CA-PROGRAM-COMMAREA.                                      00290000
003000         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACES.00300000
003100         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00310000
003200                                         PIC  9(01).              00320000
003300             88  CA-VALID-SELECTION      VALUE 1, 2, 3, 4.        00330000
003400             88  CA-CONTINUE-SELECTION   VALUE 1.                 00340000
003500             88  CA-POSTPONE-SELECTION   VALUE 2.                 00350000
003600             88  CA-CLOSE-SELECTION      VALUE 3.                 00360000
003700             88  CA-PRINT-SELECTION      VALUE 4.                 00370000
003800         10  CA-CONFIRM-IND              PIC  X      VALUE SPACES.00380000
003900             88  CA-CONFIRM-OFF          VALUE ' '.               00390000
004000             88  CA-CONFIRM-CONTINUE     VALUE 'C'.               00400000
004100         10  CA-PRTR-CNTL-IND            PIC  X(01).              00410000
004200         10  CA-TRACK-NBR                PIC  9(01).              00420000
004300         10  CA-LOGISTICS-PRINTER        PIC  X(08).              00430000
004310             88  CA-PRINT-TO-FILE             VALUE 'FILE'.       00431011
004400         10  CA-BRCDE-IND                PIC  X(08).              00440000
004500                                                                  00450000
004600*                                                                 00460000
004700 01  DK-DB2-KEYS.                                                 00470000
004800     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00480000
004900     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00490000
006100                                                                  00610000
006200 01  PC-PROGRAM-CONSTANTS.                                        00620000
006300     05  PC-01                           PIC  X(02)  VALUE '01'.  00630000
006400     05  PC-INPROCESS                    PIC  X(02)  VALUE 'IP'.  00640000
006500     05  PC-COMPLETE                     PIC  X(02)  VALUE 'CM'.  00650000
006600     05  PC-POSTPONED                    PIC  X(02)  VALUE 'PP'.  00660000
006700     05  PC-E                            PIC  X(01)  VALUE 'E'.   00670000
006800     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        00680000
006900         'SUKRP002'.                                              00690000
007000     05  PC-RETURN-PGM                   PIC  X(08)  VALUE        00700000
007100         'SUKRF511'.                                              00710000
007200     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        00720000
007300         'DPKCS060'.                                              00730000
007400     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00740000
007500         'SUKRF516'.                                              00750000
007600     05  PC-AUDIT-OPEN-PROGRAM-NAME     PIC  X(08)  VALUE         00760000
007700         'SUKRF509'.                                              00770000
007800     05  PC-OPEN-CARTON-PROGRAM-NAME     PIC  X(08)  VALUE        00780000
007900         'SUKRF511'.                                              00790000
008000     05  PC-PRINT-PROGRAM-NAME           PIC  X(08)  VALUE        00800000
008100         'SUKRF523'.                                              00810000
008200     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S516'.00820000
008300     05  PC-CANNOT-CLOSE-AUDIT           PIC  X(18)  VALUE        00830000
008400         'CANNOT CLOSE AUDIT'.                                    00840000
008500     05  PC-NOT-VALID-AUDIT-COMPLETE     PIC  X(18)  VALUE        00850000
008600         'INVALID-AUD COMPLT'.                                    00860000
008700     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE               00870000
008800                                           'TRANS NOT AVAILABLE'. 00880000
008810     05  PC-PRINT-TO-FILE                PIC  X(04) VALUE 'FILE'. 00881012
008820     05  PC-PRINT-TO-FILE-ERR-MSG   PIC X(19) VALUE               00882009
008830                                           'PRT-TO-FILE INVALID'. 00883009
008900                                                                  00890000
009000                                                                  00900000
009100 01  PS-PROGRAM-SWITCHES.                                         00910000
009200     05  PS-SYSTEM-AUDIT-FOUND-SW       PIC X(01)    VALUE 'N'.   00920000
009300         88  PS-SYSTEM-AUDIT-NOT-FOUND               VALUE 'N'.   00930000
009400         88  PS-SYSTEM-AUDIT-FOUND                   VALUE 'Y'.   00940000
009500     05  PS-ABEND-IND                   PIC X(01)    VALUE 'N'.   00950000
009600         88  PS-NO-ABEND-IN-PROGRESS                 VALUE 'N'.   00960000
009700         88  PS-ABEND-IN-PROGRESS                    VALUE 'Y'.   00970000
009800     05  PS-INTERNAL-READER-ENQ-DEQ-IND                           00980000
009900                                        PIC X(01)    VALUE 'D'.   00990000
010000         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   01000000
010100         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   01010000
010200     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01020000
010300         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01030000
010400         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01040000
010500     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   01050000
010600         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   01060000
010700         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   01070000
010800     05  PS-OVER-SHORT-IND               PIC  X(01)  VALUE 'N'.   01080000
010900         88  PS-OVER-SHORT-ERROR                     VALUE 'Y'.   01090000
011000         88  PS-NO-OVER-SHORT-ERROR                  VALUE 'N'.   01100000
011100     05  PS-CARTON-ITEM-CURSOR-IND       PIC  X(01)  VALUE 'N'.   01110000
011200         88  PS-NOT-EOC-CARTON-ITEM-CURSOR           VALUE 'N'.   01120000
011300         88  PS-EOC-CARTON-ITEM-CURSOR               VALUE 'Y'.   01130000
011400     05  PS-AUDIT-ITEM-CURSOR-IND        PIC  X(01)  VALUE 'N'.   01140000
011500         88  PS-NOT-EOC-AUDIT-ITEM-CURSOR            VALUE 'N'.   01150000
011600         88  PS-EOC-AUDIT-ITEM-CURSOR                VALUE 'Y'.   01160000
011610     05  PS-PRINT-TO-FILE-SW             PIC  X(01)  VALUE 'N'.   01161009
011620         88  PS-PRINT-TO-FILE-NO                     VALUE 'N'.   01162009
011630         88  PS-PRINT-TO-FILE-YES                    VALUE 'Y'.   01163009
011700                                                                  01170000
011800 01  PV-PROGRAM-VARIABLES.                                        01180000
012700     05  PV-DB2-COUNT                    PIC S9(09)  VALUE ZERO   01270000
012800                                                     COMP.        01280000
012900     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACE. 01290000
013000     05  PV-ITEM-COUNT-CARTON            PIC S9(04)  VALUE ZERO   01300000
013100                                                     COMP SYNC.   01310000
013200     05  PV-ITEM-COUNT-AUDIT             PIC S9(04)  VALUE ZERO   01320000
013300                                                     COMP SYNC.   01330000
013400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   01340000
013500                                                     COMP SYNC.   01350000
013600     05  PV-CLOSED-DAYS                  PIC S9(04)  VALUE ZERO   01360000
013700                                                     COMP.        01370000
013800     05  PV-CLOSED-HOURS                 PIC S9(02)  VALUE ZERO   01380000
013900                                                     COMP.        01390000
014000     05  PV-CLOSED-MINUTES               PIC S9(02)  VALUE ZERO   01400000
014100                                                     COMP.        01410000
014200     05  PV-TOTAL-CLOSED-MINUTES         PIC S9(09)  VALUE ZERO   01420000
014300                                                     COMP.        01430000
014600     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01460000
014700                                                     COMP SYNC.   01470000
014800     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01480000
014900*    05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  01490007
015000*                                                    COMP.        01500007
015100     05  PV-DISPLAY-OPER                 PIC  9(4)   VALUE ZEROS. 01510000
015200     05  PV-DISPLAY-AUD-NBR              PIC  9(9)   VALUE ZEROS. 01520000
015500     05  PV-EXPECT-INTR-UPC              PIC  S9(9)  COMP.        01550000
015700     05  PV-AUDIT-INTR-UPC               PIC  S9(9)  COMP.        01570000
015800                                                                  01580000
027900                                                                  02790000
028000                                                                  02800000
028100******************************************************************02810000
028200*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      02820000
028300******************************************************************02830000
028400     COPY DFHAID.                                                 02840000
028500                                                                  02850000
028600******************************************************************02860000
028700******************************************************************02870000
028800*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                02880000
028900******************************************************************02890000
029000     COPY DPWS013.                                                02900000
029100                                                                  02910000
029200******************************************************************02920000
029300*  SENDING/RECEIVING AREA FOR THE                                 02930000
029400*  PRINTER VALIDATION ROUTING (DPKCS060)                          02940000
029500******************************************************************02950000
029600     COPY DPWS072.                                                02960000
029700                                                                  02970000
029800******************************************************************02980000
029900*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        02990000
030000******************************************************************03000000
030100     COPY DPWS008.                                                03010000
030200                                                                  03020000
030300******************************************************************03030000
030400*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 03040000
030500*****************************************************************.03050000
030600     COPY DPWS010I.                                               03060000
030700                                                                  03070000
030800******************************************************************03080000
030900*  RANDOM NUMBER AREA.                                            03090000
031000******************************************************************03100000
031100     COPY DPWS902.                                                03110000
031200                                                                  03120000
031300******************************************************************03130000
031400*  GENERATED DSECT FOR THE SUKM516 MAPSET                         03140000
031500******************************************************************03150000
031600     COPY SUKM516.                                                03160000
031700                                                                  03170000
031800******************************************************************03180000
031900*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   03190000
032000******************************************************************03200000
032100     COPY DPWS015.                                                03210000
032200                                                                  03220000
032300*----------------------------------------------------------------*03230000
032400* HELP SCREEN COMMAREA                                            03240000
032500     COPY PCWS192.                                                03250000
032600*----------------------------------------------------------------*03260000
032700* HELP SCREEN WORK AREA                                           03270000
032800     COPY PCWS188.                                                03280000
032900                                                                  03290000
033000******************************************************************03300000
033100*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      03310000
033200*  TO BE DISPLAYED ON THE LRT                                     03320000
033300******************************************************************03330000
033400     COPY SUWS005.                                                03340000
033500                                                                  03350000
033600******************************************************************03360000
033700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE COMPANY CONTROL    03370000
033800*  TABLE (TCOCNTL)                                                03380000
033900******************************************************************03390000
034000     EXEC SQL                                                     03400000
034100         INCLUDE TCOCNTL                                          03410000
034200     END-EXEC.                                                    03420000
034300                                                                  03430000
034400******************************************************************03440000
034500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03450000
034600*  AUDIT TABLE (TSUNAUD)                                          03460000
034700******************************************************************03470000
034800     EXEC SQL                                                     03480000
034900         INCLUDE TSUNAUD                                          03490000
035000     END-EXEC.                                                    03500000
035100                                                                  03510000
035200******************************************************************03520000
035300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03530000
035400*  AUDIT TRANSATIONS(CARTONS) TABLE (TSUATRN)                     03540000
035500******************************************************************03550000
035600     EXEC SQL                                                     03560000
035700         INCLUDE TSUATRN                                          03570000
035800     END-EXEC.                                                    03580000
035900                                                                  03590000
036000******************************************************************03600000
036100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03610000
036200*  AUDIT CONTENT TABLE - UPC'S  (TSUAUPC)                         03620000
036300******************************************************************03630000
036400     EXEC SQL                                                     03640000
036500         INCLUDE TSUAUPC                                          03650000
036600     END-EXEC.                                                    03660000
036700                                                                  03670000
036800******************************************************************03680000
036900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03690000
037000*  UPC TABLE (SUT_OTBND_UPC)                                      03700000
037100******************************************************************03710000
037200     EXEC SQL                                                     03720000
037300         INCLUDE TSHUUPC                                          03730000
037400     END-EXEC.                                                    03740000
037500                                                                  03750000
037600******************************************************************03760000
037700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TABLE (XLT_UPC)03770000
037800******************************************************************03780000
037900     EXEC SQL                                                     03790000
038000         INCLUDE XLT00006                                         03800000
038100     END-EXEC.                                                    03810000
038200                                                                  03820000
038300******************************************************************03830000
038400*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 03840000
038500******************************************************************03850000
038600     EXEC SQL                                                     03860000
038700         INCLUDE SUT00015                                         03870000
038800     END-EXEC.                                                    03880000
038900                                                                  03890000
038910******************************************************************03891008
038920*    PARM TABLE                                                 * 03892008
038930******************************************************************03893008
038940     EXEC SQL                                                     03894008
038950         INCLUDE TKRPRPM                                          03895008
038960     END-EXEC.                                                    03896008
038970                                                                  03897008
039000******************************************************************03900000
039100*  COMMUNICATIONS AREA FOR DB2                                    03910000
039200******************************************************************03920000
039300     EXEC SQL                                                     03930000
039400         INCLUDE SQLCA                                            03940000
039500     END-EXEC.                                                    03950000
039600                                                                  03960000
039700******************************************************************03970000
039800*  CURSOR DECLARATION TO SELECT ALL THE ITEMS THAT ARE SUPPOSED   03980000
039900*  TO BE ON ALL THE CARTONS THAT WERE INVOLVED WITH THIS AUDIT    03990000
040000******************************************************************04000000
040100     EXEC SQL                                                     04010000
040200         DECLARE CARTON_ITEM_CURSOR CURSOR                        04020000
040300             FOR SELECT                                           04030000
040400                 B.INTR_UPC_ID                                    04040000
040500               , A.SHIPT_UNT_ID                                   04050000
040600               , SUM(A.SHPD_QTY)                                  04060000
040700             FROM TSHUUPC A                                       04070000
040800                , XLT_UPC B                                       04080000
040900                , TSUATRN C                                       04090000
041000             WHERE C.AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR            04100000
041100               AND A.SHIPT_UNT_ID = C.SHIPT_UNT_ID                04110000
041200               AND A.UPC_NBR = B.UPC_NBR                          04120000
041300             GROUP BY B.INTR_UPC_ID                               04130000
041400                    , A.SHIPT_UNT_ID                              04140000
041500             ORDER BY B.INTR_UPC_ID                               04150000
041600                    , A.SHIPT_UNT_ID                              04160000
041700     END-EXEC.                                                    04170000
041800                                                                  04180000
041900******************************************************************04190000
042000*  CURSOR DECLARATION TO SELECT ALL THE ITEMS THAT HAVE BEEN      04200000
042100*  SCANNED INTO EACH CARTON AUDIT OF THE ENTIRE AUDIT.            04210000
042200******************************************************************04220000
042300     EXEC SQL                                                     04230000
042400         DECLARE AUDIT_ITEM_CURSOR CURSOR                         04240000
042500             FOR SELECT                                           04250000
042600                 B.INTR_UPC_ID                                    04260000
042700               , SHIPT_UNT_ID                                     04270000
042800               , SUM(SCND_UNT_QTY)                                04280000
042900             FROM TSUAUPC A                                       04290000
043000                , XLT_UPC B                                       04300000
043100             WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR              04310000
043200               AND A.UPC_NBR = B.UPC_NBR                          04320000
043300               AND A.SCN_TYP_CDE <> :PC-E                         04330000
043400             GROUP BY B.INTR_UPC_ID                               04340000
043500                    , SHIPT_UNT_ID                                04350000
043600             ORDER BY B.INTR_UPC_ID                               04360000
043700                    , SHIPT_UNT_ID                                04370000
043800     END-EXEC.                                                    04380000
043900                                                                  04390000
044000******************************************************************04400000
044100 LINKAGE SECTION.                                                 04410000
044200******************************************************************04420000
044300 01  DFHCOMMAREA.                                                 04430000
044400     05  FILLER                         OCCURS  1 TO 4072 TIMES   04440000
044500                                        DEPENDING ON EIBCALEN.    04450000
044600         10  FILLER                     PIC X.                    04460000
044700                                                                  04470000
044800                                                                  04480000
044900******************************************************************04490000
045000 PROCEDURE DIVISION.                                              04500000
045100******************************************************************04510000
045200 0000-PROGRAM-MAINLINE.                                           04520000
045300     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           04530000
045400     MOVE LOW-VALUES   TO  SU516AI.                               04540000
045500                                                                  04550000
045600     EVALUATE TRUE                                                04560000
045700****************************************************************  04570000
045800* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        04580000
045900****************************************************************  04590000
046000         WHEN EIBTRNID = 'Z278'                                   04600000
046100             MOVE DFHCOMMAREA          TO PC192-COMMAREA          04610000
046200             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             04620000
046300             SET SU006-PROCESS-SCREEN                             04630000
046400                 CA-CONFIRM-OFF        TO  TRUE                   04640000
046500             PERFORM 1000-SETUP-SCREEN                            04650000
046600             PERFORM 8000-SEND-MAP                                04660000
046700             PERFORM 8200-RETURN-TRANID                           04670000
046800                                                                  04680000
046900         WHEN EIBCALEN = ZERO                                     04690000
047000         WHEN EIBAID = DFHCLEAR                                   04700000
047100         WHEN SU006-INITIALIZE-SCREEN                             04710000
047200             INITIALIZE CA-PROGRAM-COMMAREA                       04720000
047300             SET SU006-PROCESS-SCREEN                             04730000
047400                 CA-CONFIRM-OFF        TO  TRUE                   04740000
047500             PERFORM 1000-SETUP-SCREEN                            04750000
047600                                                                  04760000
047700             PERFORM 8000-SEND-MAP                                04770000
047800             PERFORM 8200-RETURN-TRANID                           04780000
047900                                                                  04790000
048000                                                                  04800000
048100         WHEN EIBAID = DFHENTER                                   04810000
048200             PERFORM 1200-RECEIVE-MAP                             04820000
048300             PERFORM 1300-EDIT-SELECTION                          04830000
048400             SET CA-CONFIRM-OFF        TO  TRUE                   04840000
048500             PERFORM 2000-PROCESS-SCREEN                          04850000
048600                                                                  04860000
048700         WHEN EIBAID = DFHPF2                                     04870000
048800             EVALUATE TRUE                                        04880000
048900               WHEN CA-CONFIRM-CONTINUE                           04890000
049000                   PERFORM 2200-CONTINUE-AUDIT                    04900000
049100                   MOVE PC-OPEN-CARTON-PROGRAM-NAME               04910000
049200                                        TO PV-TRANSFER-PROGRAM    04920000
049300                  PERFORM 2100-XCTL-TO-SELECTED-PROGRAM           04930000
049400               WHEN OTHER                                         04940000
049500                   MOVE PM-UNRECOGNIZED-PF-KEY-MSG                04950000
049600                                              TO  AMSGLNO         04960000
049700             END-EVALUATE                                         04970000
049800         WHEN EIBAID = DFHPF3                                     04980000
049900             MOVE PC-AUDIT-OPEN-PROGRAM-NAME                      04990000
050000                                    TO  PV-TRANSFER-PROGRAM       05000000
050100             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                05010000
050200                                                                  05020000
050300         WHEN EIBAID = DFHPF1                                     05030000
050400              PERFORM 1400-HELP-SCREEN                            05040000
050500                                                                  05050000
050600         WHEN OTHER                                               05060000
050700             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         05070000
050800                                                                  05080000
050900     END-EVALUATE.                                                05090000
051000                                                                  05100000
051100     PERFORM 8100-SEND-DATA-ONLY.                                 05110000
051200     PERFORM 8200-RETURN-TRANID.                                  05120000
051300                                                                  05130000
051400     GOBACK.                                                      05140000
051500****************************************************************  05150000
051600* 1000-SETUP-SCREEN                                               05160000
051700*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                     05170000
051800****************************************************************  05180000
051900 1000-SETUP-SCREEN.                                               05190000
052000                                                                  05200000
052100*    SET SHIPPING UNIT NUMBER (CARTON)                            05210000
052200     MOVE SU006-AUDIT-CNTL-NBR-X      TO AAUDITO.                 05220000
052300                                                                  05230000
052400*    IF NEEDED, GET DEFAULT PRINTER ID                            05240000
052500     IF SU006-PRINTER-DEST = SPACES                               05250000
052600         PERFORM 1010-GET-PRINTER-IDS                             05260000
052700                                                                  05270000
052800         EVALUATE TRUE                                            05280000
052900           WHEN  SU006-RECV-PRCS-AREA                             05290000
053000               MOVE COCNTL-CA-RCVG-PRTR-ID                        05300000
053100                                      TO SU006-PRINTER-DEST       05310000
053200           WHEN  SU006-FLAT-PRCS-AREA                             05320000
053300               MOVE COCNTL-CA-FLAT-PRTR-ID                        05330000
053400                                      TO SU006-PRINTER-DEST       05340000
053500           WHEN  SU006-SHIP-PRCS-AREA                             05350000
053600               MOVE COCNTL-CA-SHIP-PRTR-ID                        05360000
053700                                      TO SU006-PRINTER-DEST       05370000
053800         END-EVALUATE                                             05380000
053900         MOVE COCNTL-CA-LGS-PRTR-ID  TO CA-LOGISTICS-PRINTER      05390000
054000     END-IF.                                                      05400000
054100                                                                  05410000
054200     MOVE SU006-PRINTER-DEST TO ADESTO.                           05420000
054300                                                                  05430000
054400*    CHECK IF ANY OF THE SHIPPING UNIT AUDITS HAVE ERRORS... IF   05440000
054500*    SO, TELL THE USER.  IF NOT, CHECK ALL THE SHIPPING UNIT      05450000
054600*    AUDITS FOR OVER/SHORTAGES...IF ANY OF THOSE ARE FOUND, TELL  05460000
054700*    THE USER ALL ABOUT IT.                                       05470000
054800     PERFORM 1020-GET-UNT-AUD-ERR-IND                             05480000
054900     IF SU006-AUD-ERR                                             05490000
055000         MOVE PM-ERROR-EXISTS-MSG                                 05500000
055100                             TO AMSGLNO                           05510000
055200     ELSE                                                         05520000
055300         PERFORM 3100-CHECK-OVER-SHORT                            05530000
055400         IF PS-OVER-SHORT-ERROR                                   05540000
055500             MOVE PM-ERROR-EXISTS-MSG                             05550000
055600                             TO AMSGLNO                           05560000
055700         END-IF                                                   05570000
055800     END-IF.                                                      05580000
055900                                                                  05590000
056000     MOVE -1                  TO ASELECTL.                        05600000
056100                                                                  05610000
056200                                                                  05620000
056300******************************************************************05630000
056400* 1010-GET-PRINTER-IDS                                           *05640000
056500*    SELECT THE DEFAULT PROCESSING AREA PRINTER, AND THE DEFAULT *05650000
056600* LOGISTICS PRINTER FROM THE COMPANY CONTROL TABLE               *05660000
056700* THERE ARE DEFAULTS FOR EACH AUDITING PROCESS AREA & LOGISTICS  *05670000
056800* WITHIN EACH FACILITY.  SELECT OF ALL FOUR ID'S FOR THE GIVEN   *05680000
056900* OPER UNIT ID AND THEN DETERMINE WHICH TO DISPLAY.              *05690000
057000******************************************************************05700000
057100 1010-GET-PRINTER-IDS.                                            05710000
057200                                                                  05720000
057300     MOVE SU006-OPER-UNT-ID     TO DK-OPER-UNT-ID.                05730000
057400                                                                  05740000
057500     EXEC SQL                                                     05750000
057600            SELECT                                                05760000
057700                    CA_RCVG_PRTR_ID                               05770000
057800                   ,CA_FLAT_PRTR_ID                               05780000
057900                   ,CA_SHIP_PRTR_ID                               05790000
058000                   ,CA_LGS_PRTR_ID                                05800000
058100            INTO                                                  05810000
058200                   :COCNTL-CA-RCVG-PRTR-ID                        05820000
058300                  ,:COCNTL-CA-FLAT-PRTR-ID                        05830000
058400                  ,:COCNTL-CA-SHIP-PRTR-ID                        05840000
058500                  ,:COCNTL-CA-LGS-PRTR-ID                         05850000
058600            FROM                                                  05860000
058700                    TCOCNTL                                       05870000
058800            WHERE                                                 05880000
058900                  OPER_UNT_ID     = :DK-OPER-UNT-ID               05890000
059000              AND FCLTY_ID        = 1                             05900000
059100     END-EXEC.                                                    05910000
059200                                                                  05920000
059300     IF SQLCODE = ZERO                                            05930000
059400         CONTINUE                                                 05940000
059500     ELSE                                                         05950000
059600             MOVE '1010-GET-PRINTER-IDS'                          05960000
059700                                         TO DP013-PARAGRAPH       05970000
059800             MOVE 'SELECT OF TCOCNTL'    TO DP013-MESSAGE-TEXT (1)05980000
059900             MOVE DK-OPER-UNT-ID         TO PV-DISPLAY-OPER       05990000
060000             MOVE PV-DISPLAY-OPER        TO DP013-MESSAGE-TEXT (2)06000000
060100             MOVE SU006-AUDIT-CNTL-NBR   TO PV-DISPLAY-AUD-NBR    06010000
060200             MOVE PV-DISPLAY-AUD-NBR     TO DP013-MESSAGE-TEXT (3)06020000
060300             MOVE SQLCA                  TO DP013-SQLCA           06030000
060400             MOVE 'TCOCNTL'            TO DP013-DB2-TABLE-NAME (1)06040000
060500             SET DP013-DB2-ABEND         TO TRUE                  06050000
060600             SET DP013-NO-ROLLBACK       TO TRUE                  06060000
060700             PERFORM 9999-WRITE-CICS-LOG-MSG                      06070000
060800                                                                  06080000
060900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               06090000
061000             MOVE -1                     TO ASELECTL              06100000
061100             PERFORM 8100-SEND-DATA-ONLY                          06110000
061200             PERFORM 8200-RETURN-TRANID                           06120000
061300     END-IF.                                                      06130000
061400*                                                                 06140000
061500*                                                                 06150000
061600******************************************************************06160000
061700* 1020-GET-UNT-AUD-ERR-IND.                                      *06170000
061800*    CHECK ALL THE UNIT AUDITS WITHIN THIS AUDIT TO SEE IF ANY   *06180000
061900* OF THEM HAVE THEIR ERROR INDICATORS SET                        *06190000
062000******************************************************************06200000
062100 1020-GET-UNT-AUD-ERR-IND.                                        06210000
062200                                                                  06220000
062300     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              06230000
062400                                                                  06240000
062500     EXEC SQL                                                     06250000
062600            SELECT UNT_AUD_ERR_IND                                06260000
062700            INTO   :SUATRN-UNT-AUD-ERR-IND                        06270000
062800            FROM   TSUATRN                                        06280000
062900            WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR            06290000
063000              AND  UNT_AUD_ERR_IND = 'Y'                          06300000
063100     END-EXEC.                                                    06310000
063200                                                                  06320000
063300     EVALUATE TRUE                                                06330000
063400       WHEN SQLCODE = ZERO                                        06340000
063500       WHEN SQLCODE = -811                                        06350000
063600           SET SU006-AUD-ERR         TO TRUE                      06360000
063700       WHEN SQLCODE = +100                                        06370000
063800           SET SU006-NO-AUD-ERR      TO TRUE                      06380000
063900       WHEN OTHER                                                 06390000
064000           MOVE '1010-GET-DEFAULT-PRINTER'                        06400000
064100                                         TO DP013-PARAGRAPH       06410000
064200           MOVE 'SELECT OF TCOCNTL'    TO DP013-MESSAGE-TEXT (1)  06420000
064300           MOVE DK-OPER-UNT-ID         TO DP013-MESSAGE-TEXT (2)  06430000
064400           MOVE SQLCA                  TO DP013-SQLCA             06440000
064500           MOVE 'TCOCNTL'            TO DP013-DB2-TABLE-NAME (1)  06450000
064600           SET DP013-DB2-ABEND         TO TRUE                    06460000
064700           SET DP013-NO-ROLLBACK       TO TRUE                    06470000
064800           PERFORM 9999-WRITE-CICS-LOG-MSG                        06480000
064900                                                                  06490000
065000           MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO                 06500000
065100           MOVE -1                     TO ASELECTL                06510000
065200           PERFORM 8100-SEND-DATA-ONLY                            06520000
065300           PERFORM 8200-RETURN-TRANID                             06530000
065400     END-EVALUATE.                                                06540000
065500                                                                  06550000
065600*                                                                 06560000
065700*                                                                 06570000
065800 1200-RECEIVE-MAP.                                                06580000
065900     EXEC CICS                                                    06590000
066000         RECEIVE                                                  06600000
066100             MAP     ('SU516A')                                   06610000
066200             MAPSET  ('SUKM516')                                  06620000
066300             RESP    (PV-CICS-RESPONSE)                           06630000
066400     END-EXEC.                                                    06640000
066500                                                                  06650000
066600     EVALUATE TRUE                                                06660000
066700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06670000
066800              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  06680000
066900         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                06690000
067000              CONTINUE                                            06700000
067100         WHEN OTHER                                               06710000
067200              MOVE '1200-RECEIVE-MAP'                             06720000
067300                                     TO DP013-PARAGRAPH           06730000
067400              MOVE 'UNABLE TO RECEIVE MAP'                        06740000
067500                                     TO DP013-MESSAGE-TEXT (1)    06750000
067600              SET DP013-LOGIC-ABEND  TO TRUE                      06760000
067700              SET DP013-NO-ROLLBACK  TO TRUE                      06770000
067800              PERFORM 9999-WRITE-CICS-LOG-MSG                     06780000
067900     END-EVALUATE.                                                06790000
068000*                                                                 06800000
068100 1210-RECEIVE-SCREEN-FIELDS.                                      06810000
068200*                                                                 06820000
068300     IF  ASELECTL > ZERO                                          06830000
068400         MOVE ASELECTI               TO CA-SELECTION-X            06840000
068500     END-IF.                                                      06850000
068600*                                                                 06860000
068700     IF  ADESTL   > ZERO                                          06870000
068800         MOVE ADESTI                 TO SU006-PRINTER-DEST        06880000
068900     ELSE IF  ADESTF   = DP015-ERASE-EOF                          06890000
069000         MOVE SPACES                 TO SU006-PRINTER-DEST        06900000
069100                                        ADESTO                    06910000
069200     END-IF.                                                      06920000
069300*                                                                 06930000
069400**************************************************************    06940000
069500* EDIT ALL ENTERABLE FIELDS (OPERATING UNIT ID, AND SELECT)  *    06950000
069600**************************************************************    06960000
069700 1300-EDIT-SELECTION.                                             06970000
069800                                                                  06980000
069900*    CHECK TO MAKE SURE THE ENTERED SELECTION IS NUMERIC          06990000
070000     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    07000000
070100     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    07010000
070200     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  07020000
070300     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07030000
070400                                                                  07040000
070500     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07050003
070510          USING DP010I-NUMERIC-EDIT-AREA.                         07051003
070600                                                                  07060000
070700     IF  DP010I-ERROR-DETECTED                                    07070000
070800         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       07080000
070900                                     TO AMSGLNO                   07090000
071000         PERFORM 8100-SEND-DATA-ONLY                              07100000
071100         PERFORM 8200-RETURN-TRANID                               07110000
071200     ELSE                                                         07120000
071300         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              07130000
071400         IF NOT CA-VALID-SELECTION                                07140000
071500             MOVE PM-INVALID-SELECTION-MSG                        07150000
071600                                     TO AMSGLNO                   07160000
071700             PERFORM 8100-SEND-DATA-ONLY                          07170000
071800             PERFORM 8200-RETURN-TRANID                           07180000
071900         END-IF                                                   07190000
072000     END-IF.                                                      07200000
072100                                                                  07210000
072200*    IF THE CLOSE OPTION WAS SELECTED, VALIDATE THE PRINTER ID    07220000
072300     IF CA-CLOSE-SELECTION                                        07230000
072400         IF SU006-SYSTEM-GENERATED-AUDIT                          07240000
072500             MOVE PC-CANNOT-CLOSE-AUDIT       TO  AMSGLNO         07250000
072600             MOVE -1                          TO  ADESTL          07260000
072700             PERFORM 8100-SEND-DATA-ONLY                          07270000
072800             PERFORM 8200-RETURN-TRANID                           07280000
072900         END-IF                                                   07290000
073000         EVALUATE TRUE                                            07300000
073100           WHEN SU006-PRINTER-DEST = SPACES                       07310000
073200             MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO         07320000
073300             MOVE -1                          TO  ADESTL          07330000
073400             PERFORM 8100-SEND-DATA-ONLY                          07340000
073500             PERFORM 8200-RETURN-TRANID                           07350000
073600           WHEN SU006-OVERRIDE-PRINT                              07360000
073700             CONTINUE                                             07370000
073701                                                                  07370108
073710           WHEN SU006-PRINTER-DEST = PC-PRINT-TO-FILE             07371008
073711                SET PS-PRINT-TO-FILE-NO  TO TRUE                  07371108
073720                PERFORM 1320-VALIDATE-PRINT-TO-FILE               07372008
073721                                                                  07372108
073730                IF  PS-PRINT-TO-FILE-YES                          07373008
073750                    MOVE SPACES           TO  CA-PRTR-CNTL-IND    07375008
073760                                              CA-BRCDE-IND        07376010
073770                    MOVE ZEROES           TO  CA-TRACK-NBR        07377010
073791                ELSE                                              07379108
073792                    MOVE PC-PRINT-TO-FILE-ERR-MSG  TO  AMSGLNO    07379209
073793                    MOVE -1                        TO  ADESTL     07379308
073794                    PERFORM 8100-SEND-DATA-ONLY                   07379408
073795                    PERFORM 8200-RETURN-TRANID                    07379508
073796                END-IF                                            07379608
073797                                                                  07379708
073800           WHEN OTHER                                             07380000
073900             PERFORM 1310-VALIDATE-PRINTER                        07390000
074000             IF DP072-PRTR-PRTR-TRK-STAT-CDE EQUAL 'A'            07400000
074100                 MOVE DP072-PRTR-PRTR-CNTL-IND                    07410000
074200                                          TO  CA-PRTR-CNTL-IND    07420000
074600                 MOVE DP072-PRTR-TRACK-NBR                        07460000
074700                                          TO  CA-TRACK-NBR        07470000
074800                 MOVE DP072-PRTR-PRTR-BRCDE-IND                   07480000
074900                                          TO  CA-BRCDE-IND        07490000
075000             ELSE                                                 07500000
075100                 MOVE PM-INVALID-PRINTER-ID-MSG TO  AMSGLNO       07510000
075200                 MOVE -1                        TO  ADESTL        07520000
075300                 PERFORM 8100-SEND-DATA-ONLY                      07530000
075400                 PERFORM 8200-RETURN-TRANID                       07540000
075500             END-IF                                               07550000
075600         END-EVALUATE                                             07560000
075700     END-IF.                                                      07570000
075800                                                                  07580000
075900                                                                  07590000
076000***************************************************************** 07600000
076100*   1310-VALIDATE-PRINTER                                       * 07610000
076200* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                     * 07620000
076300***************************************************************** 07630000
076400 1310-VALIDATE-PRINTER.                                           07640000
076500                                                                  07650000
076600     MOVE SU006-PRINTER-DEST         TO DP072-PRINTER-ID.         07660000
076700     MOVE PC-REPORT-PGM              TO DP072-RPT-PGM-NME.        07670000
076800     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     07680000
076900     MOVE SU006-DFLT-OPER-UNT-ID     TO DP072-ORIGIN-OPER-UNT-ID. 07690000
077000     MOVE SU006-OPER-UNT-ID          TO DP072-OPER-UNT-ID.        07700000
077100     MOVE 1                          TO DP072-ORIGIN-FCLTY-ID     07710000
077200                                        DP072-FCLTY-ID.           07720000
077300     SET DP072-VALIDATE              TO TRUE.                     07730000
077400                                                                  07740000
077500     EXEC CICS                                                    07750000
077600         LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                   07760000
077700              COMMAREA (DP072-COMM-AREA)                          07770000
077800              RESP     (PV-CICS-RESPONSE)                         07780000
077900     END-EXEC                                                     07790000
078000                                                                  07800000
078100     EVALUATE TRUE                                                07810000
078200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07820000
078300             CONTINUE                                             07830000
078400         WHEN OTHER                                               07840000
078500               MOVE '1310-VALIDATE-PRINTER'                       07850000
078600                                    TO DP013-PARAGRAPH            07860000
078700               MOVE PV-CICS-RESPONSE                              07870000
078800                                    TO DP013-MESSAGE-TEXT(1)      07880000
078900               SET DP013-LINK-RETURN                              07890000
079000                   DP013-CICS-ABEND                               07900000
079100                   DP013-NO-ROLLBACK TO TRUE                      07910000
079200               PERFORM DP014-0000-PROCESS-ABEND                   07920000
079300     END-EVALUATE.                                                07930000
079400                                                                  07940000
079410                                                                  07941008
079411***************************************************************** 07941108
079412* CHECK TO SEE THAT DC IS SET UP TO SEND REPORT AS A .TXT       * 07941208
079413* INSTEAD OF PRINTING TO AN ACTUAL PRINTER.                     * 07941308
079414***************************************************************** 07941408
079420 1320-VALIDATE-PRINT-TO-FILE.                                     07942008
079426                                                                  07942608
079427     SET PS-PRINT-TO-FILE-NO  TO TRUE                             07942708
079428                                                                  07942808
079436     EXEC SQL                                                     07943608
079437            SELECT  FUNC_TXT                                      07943708
079442              INTO :KRPRPM-FUNC-TXT                               07944208
079448              FROM  TKRPRPM                                       07944808
079450             WHERE  LOC_ID            = :DK-OPER-UNT-ID           07945008
079451               AND  INTFC_SYS_CDE     = 'KHL'                     07945108
079452               AND  SYS_PRC_FUNC_CDE  = 'PRTFIL'                  07945208
079453               AND  FUNC_PRC_STAT_CDE = 'AC'                      07945308
079454               AND  FUNC_BEG_TMST    <= CURRENT TIMESTAMP         07945408
079455               AND  FUNC_END_TMST    >= CURRENT TIMESTAMP         07945508
079458               AND  FUNC_TXT          = 'Y'                       07945808
079460     END-EXEC.                                                    07946008
079461                                                                  07946108
079462     IF  SQLCODE = ZERO                                           07946208
079463         SET PS-PRINT-TO-FILE-YES TO TRUE                         07946308
079465     ELSE                                                         07946508
079466     IF  SQLCODE = +100                                           07946608
079467         SET PS-PRINT-TO-FILE-NO  TO TRUE                         07946708
079469     ELSE                                                         07946908
079470             MOVE '1320-VALIDATE-PRINT-TO-FILE'                   07947008
079471                                         TO DP013-PARAGRAPH       07947108
079472             MOVE 'TKRPRPM-PRTFIL  L'    TO DP013-MESSAGE-TEXT (1)07947208
079473             MOVE DK-OPER-UNT-ID         TO PV-DISPLAY-OPER       07947308
079474             MOVE PV-DISPLAY-OPER        TO DP013-MESSAGE-TEXT (2)07947408
079475             MOVE SU006-AUDIT-CNTL-NBR   TO PV-DISPLAY-AUD-NBR    07947508
079476             MOVE PV-DISPLAY-AUD-NBR     TO DP013-MESSAGE-TEXT (3)07947608
079477             MOVE SQLCA                  TO DP013-SQLCA           07947708
079478             MOVE 'TKRPRPM'            TO DP013-DB2-TABLE-NAME (1)07947808
079479             SET DP013-DB2-ABEND         TO TRUE                  07947908
079480             SET DP013-NO-ROLLBACK       TO TRUE                  07948008
079481             PERFORM 9999-WRITE-CICS-LOG-MSG                      07948108
079482                                                                  07948208
079483             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               07948308
079484             MOVE -1                     TO ASELECTL              07948408
079485             PERFORM 8100-SEND-DATA-ONLY                          07948508
079486             PERFORM 8200-RETURN-TRANID                           07948608
079487     END-IF.                                                      07948708
079509                                                                  07950908
079510                                                                  07951008
079511                                                                  07951108
079520 1400-HELP-SCREEN.                                                07952008
079600     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      07960000
079700     MOVE 'SUKRF516'                  TO PC192-PROGRAM-NAME       07970000
079800     COPY PCPD188.                                                07980000
079900     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      07990000
080000     PERFORM 4200-XCTL-TO-HELP.                                   08000000
080100                                                                  08010000
080200******************************************************************08020000
080300*2000-PROCESS-SCREEN                                             *08030000
080400* THIS PARAGRAPH WILL PROCESS THE DATA ON THE SCREEN DEPENDING ON*08040000
080500* THE OPTION SELECTED.                                           *08050000
080600******************************************************************08060000
080700 2000-PROCESS-SCREEN.                                             08070000
080800                                                                  08080000
080900      PERFORM 3200-SELECT-AUDIT.                                  08090000
081000      IF PS-SYSTEM-AUDIT-NOT-FOUND                                08100000
081100         CONTINUE                                                 08110000
081200      ELSE                                                        08120000
081300         IF SU006-SYSTEM-GENERATED-AUDIT AND                      08130000
081400            SUT00015-AUD-STAT-CDE = 'N'                           08140000
081500             IF CA-PRINT-SELECTION                                08150000
081600                 CONTINUE                                         08160000
081700             ELSE                                                 08170000
081800                 MOVE PC-NOT-VALID-AUDIT-COMPLETE                 08180000
081900                                        TO AMSGLNO                08190000
082000                 PERFORM 8100-SEND-DATA-ONLY                      08200000
082100                 PERFORM 8200-RETURN-TRANID                       08210000
082200             END-IF                                               08220000
082300         END-IF                                                   08230000
082400      END-IF                                                      08240000
082500                                                                  08250000
082600                                                                  08260000
082700     EVALUATE TRUE                                                08270000
082800*        THE USER WANTS TO CONTINUE WITH THE AUDIT.               08280000
082900*        XCNTL TO THE UPC SCAN SCREEN                             08290000
083000         WHEN CA-CONTINUE-SELECTION                               08300000
083100             IF SU006-AUDIT-COMPLETE OR SU006-AUDIT-POSTPONE      08310000
083200                SET CA-CONFIRM-CONTINUE TO TRUE                   08320000
083300                MOVE PM-CONFIRM-CONT-MSG TO AMSGLNO               08330000
083400             ELSE                                                 08340000
083500                MOVE PC-OPEN-CARTON-PROGRAM-NAME                  08350000
083600                                 TO  PV-TRANSFER-PROGRAM          08360000
083700                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             08370000
083800             END-IF                                               08380000
083900                                                                  08390000
084000*        THE USER WANTS TO CLOSE THE AUDIT.  UPDATE THE           08400000
084100*        STATUS TO "COMPLETE" (CM) AND UPDATE THE STOP TIMESTAMP  08410000
084200         WHEN CA-CLOSE-SELECTION                                  08420000
084300             IF SU006-AUDIT-COMPLETE                              08430000
084400                 MOVE PM-ALREADY-CLOSED-MSG                       08440000
084500                                        TO AMSGLNO                08450000
084600                 PERFORM 8100-SEND-DATA-ONLY                      08460000
084700                 PERFORM 8200-RETURN-TRANID                       08470000
084800             END-IF                                               08480000
084900                                                                  08490000
085000*            CHECK FOR OPEN CARTONS- CAN ONLY CLOSE IF ALL CARTONS08500000
085100*            ARE CLOSED                                           08510000
085200             PERFORM 2400-CHECK-OPEN-CARTONS                      08520000
085300             IF PV-DB2-COUNT > 0                                  08530000
085400                 MOVE PV-DB2-COUNT      TO PM-CTN-COUNT           08540000
085500                 MOVE PM-OPEN-CARTON-MSG                          08550000
085600                                        TO AMSGLNO                08560000
085700                 PERFORM 8100-SEND-DATA-ONLY                      08570000
085800                 PERFORM 8200-RETURN-TRANID                       08580000
085900             END-IF                                               08590000
086000                                                                  08600000
086100*            SET THE COMMAREA TO SHOW THAT IT IS CLOSED, AND      08610000
086200*            UPDATE DB2                                           08620000
086300             SET SU006-AUDIT-COMPLETE   TO TRUE                   08630000
086400             PERFORM 3000-CLOSE-AUDIT                             08640000
086500             MOVE PM-AUDIT-CLOSE-MSG    TO AMSGLNO                08650000
086600                                                                  08660000
088200*        THE USER WANTS TO POSTPONE THE SHIPPING UNIT.  UPDATE    08820000
088300*        THE STAUTUS TO "POSTPONE" (PP) AND UPDATE STOP TIMESTAMP.08830000
088310                                                                  08831003
088400         WHEN CA-POSTPONE-SELECTION                               08840000
088500             IF SU006-AUDIT-POSTPONE                              08850003
088600                 MOVE PM-ALREADY-POSTPONED-MSG                    08860003
088700                                        TO AMSGLNO                08870003
088800                 PERFORM 8100-SEND-DATA-ONLY                      08880003
088900                 PERFORM 8200-RETURN-TRANID                       08890003
089000             END-IF                                               08900003
089010                                                                  08901003
089100*         CHECKING IF THE AUDIT IS SYSTEM GENERATED AUDIT AND     08910003
089200*         THE AUDIT IS ALREADY CLOSED.                            08920003
089300                                                                  08930003
089400             PERFORM 3200-SELECT-AUDIT                            08940003
089500             IF  PS-SYSTEM-AUDIT-FOUND                            08950003
089600             AND ( SUT00015-AUD-STAT-CDE = 'N' OR 'P' OR 'F' )    08960003
089700                 MOVE PM-ALREADY-CLOSED-MSG                       08970003
089800                                        TO AMSGLNO                08980003
089900                 PERFORM 8100-SEND-DATA-ONLY                      08990003
090000                 PERFORM 8200-RETURN-TRANID                       09000003
090100             ELSE                                                 09010003
090200                SET SU006-AUDIT-POSTPONE TO TRUE                  09020003
090300                PERFORM 3000-CLOSE-AUDIT                          09030003
090400                MOVE PM-AUDIT-POSTPONED-MSG                       09040003
090500                                        TO AMSGLNO                09050003
090600             END-IF                                               09060003
090700*                                                                 09070003
090900         WHEN CA-PRINT-SELECTION                                  09090003
091000*            CONTINUE ON TO THE PRINT PROGRAM                     09100003
091010                                                                  09101003
091100             MOVE PC-PRINT-PROGRAM-NAME TO PV-TRANSFER-PROGRAM    09110003
091200             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                09120003
091300                                                                  09130003
091400     END-EVALUATE.                                                09140003
091500                                                                  09150003
091600                                                                  09160003
091700*                                                                 09170003
091800 2100-XCTL-TO-SELECTED-PROGRAM.                                   09180003
091900     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      09190003
092000     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        09200003
092100     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.        09210003
092200                                                                  09220003
092300     EXEC CICS                                                    09230003
092400         XCTL                                                     09240003
092500             PROGRAM   (PV-TRANSFER-PROGRAM)                      09250003
092600             COMMAREA  (CA-COMMAREA)                              09260003
092700             LENGTH    (PV-COMMAREA-LENGTH)                       09270003
092800             RESP      (PV-CICS-RESPONSE)                         09280003
092900     END-EXEC.                                                    09290003
093000                                                                  09300003
093100     EVALUATE TRUE                                                09310003
093200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09320003
093300              CONTINUE                                            09330003
093400         WHEN OTHER                                               09340003
093500              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                09350003
093600                                     TO DP013-PARAGRAPH           09360003
093700              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       09370003
093800                                     TO DP013-MESSAGE-TEXT (1)    09380003
093900              MOVE PV-TRANSFER-PROGRAM                            09390003
094000                                     TO DP013-MESSAGE-TEXT (2)    09400003
094100              SET DP013-CICS-ABEND   TO TRUE                      09410003
094200              SET DP013-NO-ROLLBACK  TO TRUE                      09420003
094300              PERFORM 9999-WRITE-CICS-LOG-MSG                     09430003
094400              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     09440003
094500                                     TO AMSGLNO                   09450003
094600              SET SU006-PROCESS-SCREEN TO TRUE                    09460003
094700              PERFORM 8100-SEND-DATA-ONLY                         09470003
094800              PERFORM 8200-RETURN-TRANID                          09480003
094900     END-EVALUATE.                                                09490003
095000                                                                  09500003
095100***************************************************************** 09510003
095200*  2200-CONTINUE-AUDIT                                          * 09520003
095300* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 09530003
095400* CALCULATE THE MINUTES IT WAS CLOSED/POSTPONED, AND RESET THE  * 09540003
095500* AUDIT STOP TIMESTAMP * *                                        09550003
095600***************************************************************** 09560003
095700 2200-CONTINUE-AUDIT.                                             09570003
095800*    DETERMINE IF THE STOP TIMESTAMP WAS UPDATED                  09580003
095900     PERFORM 2205-CHECK-IF-STOPPED.                               09590003
096000                                                                  09600003
096100     IF SUNAUD-AUD-STP-TMST NOT EQUAL TO                          09610003
096200                               '9999-09-09-09.09.09.999999'       09620003
096210                                                                  09621003
096300*    FIRST CALCULATED THE MINUTES SINCE IT WAS STOPPED            09630003
096310                                                                  09631003
096400         PERFORM 2210-CALC-STOP-MINUTES                           09640003
096500     ELSE                                                         09650003
096600         MOVE 0               TO PV-TOTAL-CLOSED-MINUTES          09660003
096700     END-IF.                                                      09670003
096800                                                                  09680003
096900*    UPDATE THE MINUTES POSTPONED/COMPLETED AND RESET THE         09690003
097000*    STOP TIMESTAMP                                               09700003
097010                                                                  09701003
097100     IF SU006-AUDIT-COMPLETE                                      09710003
097200         PERFORM 2220-UPDATE-COMPLETE-MINUTES                     09720003
097300     ELSE                                                         09730003
097400         IF SU006-AUDIT-POSTPONE                                  09740003
097500            PERFORM 2230-UPDATE-POSTPONE-MINUTES                  09750003
097600         END-IF                                                   09760003
097700     END-IF.                                                      09770003
097800                                                                  09780003
097900                                                                  09790003
098000***************************************************************** 09800003
098100*  2205-CHECK-IF-STOPPED.                                       * 09810003
098200* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 09820003
098300* DETERMINED IF THE AUDIT WAS STOPPED BY THE CORRECT PROCEDURE  * 09830003
098400* IF IT STOPPED BECAUSE OF FAILED COMMUNICATIONS, THE AUD-STP-TMST09840003
098500* WOULD NOT HAVE BEEN UPDATED.                                  * 09850003
098600***************************************************************** 09860003
098700 2205-CHECK-IF-STOPPED.                                           09870003
098800                                                                  09880003
098900     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              09890003
099000                                                                  09900003
099100     EXEC SQL                                                     09910003
099200         SELECT                                                   09920003
099300                AUD_STP_TMST                                      09930003
099400         INTO                                                     09940003
099500                :SUNAUD-AUD-STP-TMST                              09950003
099600         FROM                                                     09960003
099700                TSUNAUD                                           09970003
099800         WHERE                                                    09980003
099900                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             09990003
100000     END-EXEC.                                                    10000003
100100                                                                  10010003
100200     EVALUATE TRUE                                                10020003
100300         WHEN SQLCODE = ZERO                                      10030003
100400             CONTINUE                                             10040003
100500                                                                  10050003
100600         WHEN SQLWARN0 NOT = SPACES                               10060003
100700         WHEN SQLCODE < ZERO                                      10070003
100800         WHEN SQLCODE > ZERO                                      10080003
100900             MOVE '2205-CHECK-IF-STOPPED.'                        10090003
101000                 TO DP013-PARAGRAPH                               10100003
101100             MOVE 'SELECT OF TSUNAUD'                             10110003
101200                 TO DP013-MESSAGE-TEXT (1)                        10120003
101300             MOVE SU006-AUDIT-CNTL-NBR-X                          10130003
101400                 TO DP013-MESSAGE-TEXT (2)                        10140003
101500             MOVE SQLCA            TO DP013-SQLCA                 10150003
101600             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    10160003
101700             SET DP013-DB2-ABEND   TO TRUE                        10170003
101800             SET DP013-NO-ROLLBACK TO TRUE                        10180003
101900             PERFORM 9999-WRITE-CICS-LOG-MSG                      10190003
102000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               10200003
102100             PERFORM 8100-SEND-DATA-ONLY                          10210003
102200             PERFORM 8200-RETURN-TRANID                           10220003
102300     END-EVALUATE.                                                10230003
102400                                                                  10240003
102500                                                                  10250003
102600***************************************************************** 10260003
102700*  2210-CALC-STOP-MINUTES.                                      * 10270003
102800* RESTART THE COMPLETED/POSTPONED AUDIT.                        * 10280003
102900* CALCULATE THE MINUTES IT WAS CLOSED/POSTPONED, AND RESET THE  * 10290003
103000* AUDIT STOP TIMESTAMP * *                                        10300003
103100***************************************************************** 10310003
103200 2210-CALC-STOP-MINUTES.                                          10320003
103300                                                                  10330003
103400     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              10340003
103500                                                                  10350003
103600     EXEC SQL                                                     10360003
103700         SELECT                                                   10370003
103800                DAYS(CURRENT DATE)     - DAYS(AUD_STP_TMST)       10380003
103900              , HOUR(CURRENT TIME)    - HOUR(AUD_STP_TMST)        10390003
104000              , MINUTE(CURRENT TIME)  - MINUTE(AUD_STP_TMST)      10400003
104100         INTO                                                     10410003
104200                :PV-CLOSED-DAYS                                   10420003
104300              , :PV-CLOSED-HOURS                                  10430003
104400              , :PV-CLOSED-MINUTES                                10440003
104500         FROM                                                     10450003
104600                TSUNAUD                                           10460003
104700         WHERE                                                    10470003
104800                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             10480003
104900     END-EXEC.                                                    10490003
105000                                                                  10500003
105100     EVALUATE TRUE                                                10510003
105200         WHEN SQLCODE = ZERO                                      10520003
105300             COMPUTE PV-TOTAL-CLOSED-MINUTES =                    10530003
105400                ((PV-CLOSED-DAYS     * 1440) +                    10540003
105500                 (PV-CLOSED-HOURS    * 60)   +                    10550003
105600                  PV-CLOSED-MINUTES)                              10560003
105700                                                                  10570003
105800         WHEN SQLWARN0 NOT = SPACES                               10580003
105900         WHEN SQLCODE < ZERO                                      10590003
106000         WHEN SQLCODE > ZERO                                      10600003
106100             MOVE '2210-CALC-STOP-MINUTES.'                       10610003
106200                 TO DP013-PARAGRAPH                               10620003
106300             MOVE 'SELECT OF TSUNAUD'                             10630003
106400                 TO DP013-MESSAGE-TEXT (1)                        10640003
106500             MOVE SU006-AUDIT-CNTL-NBR-X                          10650003
106600                 TO DP013-MESSAGE-TEXT (2)                        10660003
106700             MOVE SQLCA            TO DP013-SQLCA                 10670003
106800             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    10680003
106900             SET DP013-DB2-ABEND   TO TRUE                        10690003
107000             SET DP013-NO-ROLLBACK TO TRUE                        10700003
107100             PERFORM 9999-WRITE-CICS-LOG-MSG                      10710003
107200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               10720003
107300             PERFORM 8100-SEND-DATA-ONLY                          10730003
107400             PERFORM 8200-RETURN-TRANID                           10740003
107500     END-EVALUATE.                                                10750003
107600                                                                  10760003
107700                                                                  10770003
107800***************************************************************** 10780003
107900*  2220-UPDATE-COMPLETE-MINUTES                                 * 10790003
108000* UPDATE THE TABLE WITH THE ADDITION OF THE CURRENT CLOSED      * 10800003
108100* MINUTES TO THE EXISTING CLOSED MINUTES -- UPDATE THE STOP     * 10810003
108200* TIMESTAMP TO THE DEFAULT VALUE                                * 10820003
108300***************************************************************** 10830003
108400 2220-UPDATE-COMPLETE-MINUTES.                                    10840003
108500                                                                  10850003
108600     SET SU006-AUDIT-INPROCESS TO TRUE.                           10860003
108700     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              10870003
108800                                                                  10880003
108900     EXEC SQL                                                     10890003
109000         UPDATE TSUNAUD                                           10900003
109100                                                                  10910003
109200         SET AUD_CLO_MNIT_QTY = AUD_CLO_MNIT_QTY +                10920003
109300                                :PV-TOTAL-CLOSED-MINUTES          10930003
109400           , AUD_STP_TMST     = '9999-09-09-09.09.09.999999'      10940003
109500           , AUD_STAT_CDE     = :SU006-AUDIT-STATUS               10950003
109600                                                                  10960003
109700         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             10970003
109800     END-EXEC.                                                    10980003
109900                                                                  10990003
110000     EVALUATE TRUE                                                11000003
110100         WHEN SQLCODE = ZERO                                      11010003
110200             CONTINUE                                             11020003
110300         WHEN SQLWARN0 NOT = SPACES                               11030003
110400         WHEN SQLCODE < ZERO                                      11040003
110500         WHEN SQLCODE > ZERO                                      11050003
110600             MOVE '2220-UPDATE-COMPLETE-MINUTES'                  11060003
110700                 TO DP013-PARAGRAPH                               11070003
110800             MOVE 'UPDATE OF TSUNAUD'                             11080003
110900                 TO DP013-MESSAGE-TEXT (1)                        11090003
111000             MOVE SU006-AUDIT-CNTL-NBR-X                          11100003
111100                 TO DP013-MESSAGE-TEXT (2)                        11110003
111200             MOVE SQLCA            TO DP013-SQLCA                 11120003
111300             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    11130003
111400             SET DP013-DB2-ABEND   TO TRUE                        11140003
111500             SET DP013-NO-ROLLBACK TO TRUE                        11150003
111600             PERFORM 9999-WRITE-CICS-LOG-MSG                      11160003
111700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11170003
111800             PERFORM 8100-SEND-DATA-ONLY                          11180003
111900             PERFORM 8200-RETURN-TRANID                           11190003
112000     END-EVALUATE.                                                11200003
112100                                                                  11210003
112200                                                                  11220003
112300***************************************************************** 11230003
112400*  2230-UPDATE-POSTPONE-MINUTES                                 * 11240003
112500* UPDATE THE TABLE WITH THE ADDITION OF THE CURRENT CLOSED      * 11250003
112600* MINUTES TO THE EXISTING POSTPONED MINUTES -- UPDATE THE STOP  * 11260003
112700* TIMESTAMP TO THE DEFAULT VALUE                                * 11270003
112800***************************************************************** 11280003
112900 2230-UPDATE-POSTPONE-MINUTES.                                    11290003
113000                                                                  11300003
113100     SET SU006-AUDIT-INPROCESS TO TRUE.                           11310003
113200     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              11320003
113300                                                                  11330003
113400     EXEC SQL                                                     11340003
113500         UPDATE TSUNAUD                                           11350003
113600                                                                  11360003
113700         SET AUD_PSPND_MNIT_QTY = AUD_PSPND_MNIT_QTY +            11370003
113800                                :PV-TOTAL-CLOSED-MINUTES          11380003
113900           , AUD_STP_TMST     = '9999-09-09-09.09.09.999999'      11390003
114000           , AUD_STAT_CDE     = :SU006-AUDIT-STATUS               11400003
114100                                                                  11410003
114200         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             11420003
114300     END-EXEC.                                                    11430003
114400                                                                  11440003
114500     EVALUATE TRUE                                                11450003
114600         WHEN SQLCODE = ZERO                                      11460003
114700             CONTINUE                                             11470003
114800         WHEN SQLWARN0 NOT = SPACES                               11480003
114900         WHEN SQLCODE < ZERO                                      11490003
115000         WHEN SQLCODE > ZERO                                      11500003
115100             MOVE '2230-UPDATE-POSTPONE-MINUTES'                  11510003
115200                 TO DP013-PARAGRAPH                               11520003
115300             MOVE 'UPDATE OF TSUNAUD'                             11530003
115400                 TO DP013-MESSAGE-TEXT (1)                        11540003
115500             MOVE SU006-AUDIT-CNTL-NBR-X                          11550003
115600                 TO DP013-MESSAGE-TEXT (2)                        11560003
115700             MOVE SQLCA            TO DP013-SQLCA                 11570003
115800             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    11580003
115900             SET DP013-DB2-ABEND   TO TRUE                        11590003
116000             SET DP013-NO-ROLLBACK TO TRUE                        11600003
116100             PERFORM 9999-WRITE-CICS-LOG-MSG                      11610003
116200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11620003
116300             PERFORM 8100-SEND-DATA-ONLY                          11630003
116400             PERFORM 8200-RETURN-TRANID                           11640003
116500     END-EVALUATE.                                                11650003
116600                                                                  11660003
116700                                                                  11670003
116800                                                                  11680003
116900******************************************************************11690003
117000*  2400-CHECK-OPEN-CARTONS.                                      *11700003
117100*  SELECT THE NUMBER OF CARTONS THAT ARE NOT CLOSED              *11710003
117200******************************************************************11720003
117300 2400-CHECK-OPEN-CARTONS.                                         11730003
117400                                                                  11740003
117500     MOVE SU006-AUDIT-CNTL-NBR  TO DK-AUDIT-CNTL-NBR              11750003
117600                                                                  11760003
117700     EXEC SQL                                                     11770003
117800         SELECT                                                   11780003
117900            COUNT (DISTINCT SHIPT_UNT_ID)                         11790003
118000         INTO                                                     11800003
118100            :PV-DB2-COUNT                                         11810003
118200         FROM                                                     11820003
118300                TSUATRN                                           11830003
118400         WHERE                                                    11840003
118500                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             11850003
118600           AND  UNT_AUD_STAT_CDE <> 'CM'                          11860003
118700     END-EXEC.                                                    11870003
118800                                                                  11880003
118900     EVALUATE TRUE                                                11890003
119000         WHEN SQLCODE = ZERO                                      11900003
119100             CONTINUE                                             11910003
119200                                                                  11920003
119300         WHEN SQLCODE = -305                                      11930003
119400             MOVE +0                 TO PV-DB2-COUNT              11940003
119500                                                                  11950003
119600         WHEN SQLWARN0 NOT = SPACES                               11960003
119700         WHEN SQLCODE < ZERO                                      11970003
119800         WHEN SQLCODE > ZERO                                      11980003
119900             MOVE '2200-CHECK-OPEN-CARTONS'                       11990003
120000                 TO DP013-PARAGRAPH                               12000003
120100             MOVE 'SELECT OF TSUNAUD TABLE'                       12010003
120200                 TO DP013-MESSAGE-TEXT (1)                        12020003
120300             MOVE SU006-AUDIT-CNTL-NBR-X                          12030003
120400                 TO DP013-MESSAGE-TEXT (2)                        12040003
120500             MOVE SQLCA            TO DP013-SQLCA                 12050003
120600             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    12060003
120700             SET DP013-DB2-ABEND   TO TRUE                        12070003
120800             SET DP013-NO-ROLLBACK TO TRUE                        12080003
120900             PERFORM 9999-WRITE-CICS-LOG-MSG                      12090003
121000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               12100003
121100             PERFORM 8100-SEND-DATA-ONLY                          12110003
121200             PERFORM 8200-RETURN-TRANID                           12120003
121300     END-EVALUATE.                                                12130003
121400                                                                  12140003
121500                                                                  12150003
126700******************************************************************12670003
126800*  3000-CLOSE-SHIP-UNIT                                          *12680003
126900*  THE USER WANTS TO CLOSE THE AUDIT                              12690003
127000*           1) UPDATE THE STOP DATE/TIME TO CURRENT VALUES       *12700003
127100*           2) UPDATE THE STATUS TO COMPLETE                     *12710003
127200******************************************************************12720003
127300 3000-CLOSE-AUDIT.                                                12730003
127400                                                                  12740003
127500*    UPDATE APPROPRIATE HOST VARIABLES                            12750003
127600     MOVE SU006-AUDIT-CNTL-NBR       TO DK-AUDIT-CNTL-NBR.        12760003
127700     MOVE SU006-AUDIT-STATUS         TO SUNAUD-AUD-STAT-CDE.      12770003
127800                                                                  12780003
127900     EXEC SQL                                                     12790003
128000         UPDATE TSUNAUD                                           12800003
128100            SET  AUD_STP_TMST    = CURRENT TIMESTAMP              12810003
128200               , AUD_STAT_CDE    = :SUNAUD-AUD-STAT-CDE           12820003
128300         WHERE                                                    12830003
128400                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             12840003
128500     END-EXEC.                                                    12850003
128600                                                                  12860003
128700     EVALUATE TRUE                                                12870003
128800         WHEN SQLCODE = ZERO                                      12880003
128900             CONTINUE                                             12890003
129000                                                                  12900003
129100         WHEN SQLWARN0 NOT = SPACES                               12910003
129200         WHEN SQLCODE < ZERO                                      12920003
129300         WHEN SQLCODE > ZERO                                      12930003
129400             MOVE '3000-CLOSE-AUDIT'                              12940003
129500                 TO DP013-PARAGRAPH                               12950003
129600             MOVE 'UPDATE THE STOP TIMESTAMP AND STATUS'          12960003
129700                 TO DP013-MESSAGE-TEXT (1)                        12970003
129800             MOVE SU006-AUDIT-CNTL-NBR-X                          12980003
129900                 TO DP013-MESSAGE-TEXT (2)                        12990003
130000             MOVE SQLCA            TO DP013-SQLCA                 13000003
130100             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    13010003
130200             SET DP013-DB2-ABEND   TO TRUE                        13020003
130300             SET DP013-NO-ROLLBACK TO TRUE                        13030003
130400             PERFORM 9999-WRITE-CICS-LOG-MSG                      13040003
130500                                                                  13050003
130600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               13060003
130700             PERFORM 8100-SEND-DATA-ONLY                          13070003
130800             PERFORM 8200-RETURN-TRANID                           13080003
130900     END-EVALUATE.                                                13090003
131000                                                                  13100003
131100                                                                  13110003
131200******************************************************************13120003
131300* 3100-CHECK-OVER-SHORT                                          *13130003
131400*  COMPARE EACH ITEM ON THE CARTON DATABASE, DO A SELECT OF THE  *13140003
131500* AUDIT DATABASE TO DETERMINE IF THE ITEM WAS ACTUALLY FOUND TO  *13150003
131600* BE IN IT, AND IF SO, HOW MUCH WAS IN IT (OVER/SHORT)           *13160003
131700******************************************************************13170003
131800 3100-CHECK-OVER-SHORT.                                           13180003
131900                                                                  13190003
132000     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              13200003
132100                                                                  13210003
132200     PERFORM 3101-OPEN-CARTON-ITEM-CURSOR.                        13220003
132300     PERFORM 3102-FETCH-CARTON-ITEM-CURSOR.                       13230003
132400                                                                  13240003
132500     PERFORM 3104-OPEN-AUDIT-ITEM-CURSOR.                         13250003
132600     PERFORM 3105-FETCH-AUDIT-ITEM-CURSOR.                        13260003
132700                                                                  13270003
132800                                                                  13280003
132900*    BUMP THE TWO ITEM CURSORS TOGETHER.  THE FIRST TIME THERE    13290003
133000*    IS A UPC ON ONE BUT NO THE OTHER, OR IF THE QUANTITIES DO    13300003
133100*    NOT MATCH, THERE IS AN OVERAGE OR A SHORTAGE ERROR.  BUMP    13310003
133200*    THE TWO UNTIL AN ERROR IS MATCH OR UNIT ONE OF THE CURSORS   13320003
133300*    ENDS                                                         13330003
133310                                                                  13331006
133400     PERFORM UNTIL PS-EOC-CARTON-ITEM-CURSOR                      13340003
133500                OR PS-EOC-AUDIT-ITEM-CURSOR                       13350003
133600                OR PS-OVER-SHORT-ERROR                            13360003
133700                                                                  13370003
133800         IF  PV-AUDIT-INTR-UPC   =  PV-EXPECT-INTR-UPC            13380003
133900         AND SUAUPC-SHIPT-UNT-ID =  SHUUPC-SHIPT-UNT-ID           13390003
134000         AND PV-ITEM-COUNT-AUDIT =  PV-ITEM-COUNT-CARTON          13400003
134100             PERFORM 3102-FETCH-CARTON-ITEM-CURSOR                13410003
134200             PERFORM 3105-FETCH-AUDIT-ITEM-CURSOR                 13420003
134300         ELSE                                                     13430003
134400             SET PS-OVER-SHORT-ERROR TO TRUE                      13440003
134500         END-IF                                                   13450003
134600                                                                  13460003
134700     END-PERFORM.                                                 13470003
134800                                                                  13480003
134900*    IF ONE CURSOR RAN OUT BEFORE THE OTHER, THERE IS AN          13490003
135000*    ERROR                                                        13500003
135100     IF (PS-EOC-CARTON-ITEM-CURSOR                                13510003
135200     AND PS-EOC-AUDIT-ITEM-CURSOR)                                13520003
135300      OR PS-OVER-SHORT-ERROR                                      13530003
135400          CONTINUE                                                13540003
135500     ELSE                                                         13550003
135600         SET PS-OVER-SHORT-ERROR   TO TRUE                        13560003
135700     END-IF.                                                      13570003
135800                                                                  13580003
135900*    CLOSE THE CURSORS                                            13590003
136000     PERFORM 3103-CLOSE-CARTON-ITEM-CURSOR.                       13600003
136100     PERFORM 3106-CLOSE-AUDIT-ITEM-CURSOR.                        13610003
136200                                                                  13620003
136300******************************************************************13630003
136400* 3101-OPEN-CARTON-ITEM-CURSOR                                   *13640003
136500*  OPEN THE PO LINE CURSOR                                       *13650003
136600******************************************************************13660003
136700 3101-OPEN-CARTON-ITEM-CURSOR.                                    13670003
136800                                                                  13680003
136900     EXEC SQL                                                     13690003
137000         OPEN CARTON_ITEM_CURSOR                                  13700003
137100     END-EXEC.                                                    13710003
137200                                                                  13720003
137300     EVALUATE TRUE                                                13730003
137400         WHEN SQLCODE = ZERO                                      13740003
137500             SET PS-NOT-EOC-CARTON-ITEM-CURSOR                    13750003
137600                 PS-NO-OVER-SHORT-ERROR       TO TRUE             13760003
137700                                                                  13770003
137800         WHEN SQLWARN0 NOT = SPACES                               13780003
137900         WHEN SQLCODE < ZERO                                      13790003
138000         WHEN SQLCODE > ZERO                                      13800003
138100             MOVE '3101-OPEN-PO-LINE-CUROSR'                      13810003
138200                                   TO DP013-PARAGRAPH             13820003
138300             MOVE 'OPEN OVER_SHORT_CUSOR'                         13830003
138400                                   TO DP013-MESSAGE-TEXT (1)      13840003
138500             MOVE SU006-AUDIT-CNTL-NBR                            13850003
138600                                   TO DP013-MESSAGE-TEXT (2)      13860003
138700             MOVE SQLCA            TO DP013-SQLCA                 13870003
138800             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    13880003
138900             MOVE 'XLT00006'       TO DP013-DB2-TABLE-NAME (2)    13890003
139000             MOVE 'TSUATRN '       TO DP013-DB2-TABLE-NAME (3)    13900003
139100             SET DP013-DB2-ABEND   TO TRUE                        13910003
139200             SET DP013-NO-ROLLBACK TO TRUE                        13920003
139300             PERFORM 9999-WRITE-CICS-LOG-MSG                      13930003
139400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               13940003
139500             PERFORM 8100-SEND-DATA-ONLY                          13950003
139600             PERFORM 8200-RETURN-TRANID                           13960003
139700     END-EVALUATE.                                                13970003
139800                                                                  13980003
139900******************************************************************13990003
140000* 3102-FETCH-CARTON-ITEM-CURSOR                                  *14000003
140100*  FETCH THE NEXT OCCURANCE OF THE OVER_SHORT_CUSOR              *14010003
140200******************************************************************14020003
140300 3102-FETCH-CARTON-ITEM-CURSOR.                                   14030003
140400                                                                  14040003
140500     EXEC SQL                                                     14050003
140600         FETCH CARTON_ITEM_CURSOR                                 14060003
140700         INTO    :PV-EXPECT-INTR-UPC                              14070003
140800              ,  :SHUUPC-SHIPT-UNT-ID                             14080003
140900              ,  :PV-ITEM-COUNT-CARTON                            14090003
141000     END-EXEC.                                                    14100003
141100                                                                  14110003
141200     EVALUATE TRUE                                                14120003
141300         WHEN SQLCODE = ZERO                                      14130003
141400             CONTINUE                                             14140003
141500                                                                  14150003
141600         WHEN SQLCODE = +100                                      14160003
141700             SET PS-EOC-CARTON-ITEM-CURSOR   TO TRUE              14170003
141800                                                                  14180003
141900         WHEN SQLWARN0 NOT = SPACES                               14190003
142000         WHEN SQLCODE < ZERO                                      14200003
142100         WHEN SQLCODE > ZERO                                      14210003
142200             MOVE '3102-FETCH-CARTON-ITEM-CURSOR'                 14220003
142300                                   TO DP013-PARAGRAPH             14230003
142400             MOVE 'FETCH OF PO_LINE_CUROSR'                       14240003
142500                                   TO DP013-MESSAGE-TEXT (1)      14250003
142600             MOVE SU006-AUDIT-CNTL-NBR                            14260003
142700                                   TO DP013-MESSAGE-TEXT (2)      14270003
142800             MOVE SQLCA            TO DP013-SQLCA                 14280003
142900             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    14290003
143000             MOVE 'XLT00006'       TO DP013-DB2-TABLE-NAME (2)    14300003
143100             MOVE 'TSUATRN '       TO DP013-DB2-TABLE-NAME (3)    14310003
143200             SET DP013-DB2-ABEND   TO TRUE                        14320003
143300             SET DP013-NO-ROLLBACK TO TRUE                        14330003
143400             PERFORM 9999-WRITE-CICS-LOG-MSG                      14340003
143500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               14350003
143600             PERFORM 8100-SEND-DATA-ONLY                          14360003
143700             PERFORM 8200-RETURN-TRANID                           14370003
143800     END-EVALUATE.                                                14380003
143900                                                                  14390003
144000******************************************************************14400003
144100* 3103-CLOSE-CARTON-ITEM-CURSOR                                  *14410003
144200*  CLOSE THE PO LINE CURSOR                                      *14420003
144300******************************************************************14430003
144400 3103-CLOSE-CARTON-ITEM-CURSOR.                                   14440003
144500                                                                  14450003
144600     EXEC SQL                                                     14460003
144700         CLOSE CARTON_ITEM_CURSOR                                 14470003
144800     END-EXEC.                                                    14480003
144900                                                                  14490003
145000     EVALUATE TRUE                                                14500003
145100         WHEN SQLCODE = ZERO                                      14510003
145200             CONTINUE                                             14520003
145300                                                                  14530003
145400         WHEN SQLWARN0 NOT = SPACES                               14540003
145500         WHEN SQLCODE < ZERO                                      14550003
145600         WHEN SQLCODE > ZERO                                      14560003
145700             MOVE '3103-CLOSE-CARTON-ITEM-CURSOR'                 14570003
145800                                   TO DP013-PARAGRAPH             14580003
145900             MOVE 'CLOSE OF OVER_SHORT_CUSOR'                     14590003
146000                                   TO DP013-MESSAGE-TEXT (1)      14600003
146100             MOVE SU006-AUDIT-CNTL-NBR                            14610003
146200                                   TO DP013-MESSAGE-TEXT (2)      14620003
146300             MOVE SQLCA            TO DP013-SQLCA                 14630003
146400             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    14640003
146500             MOVE 'XLT00006'       TO DP013-DB2-TABLE-NAME (2)    14650003
146600             MOVE 'TSUATRN '       TO DP013-DB2-TABLE-NAME (3)    14660003
146700             SET DP013-DB2-ABEND   TO TRUE                        14670003
146800             SET DP013-NO-ROLLBACK TO TRUE                        14680003
146900             PERFORM 9999-WRITE-CICS-LOG-MSG                      14690003
147000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               14700003
147100             PERFORM 8100-SEND-DATA-ONLY                          14710003
147200             PERFORM 8200-RETURN-TRANID                           14720003
147300     END-EVALUATE.                                                14730003
147400                                                                  14740003
147500                                                                  14750003
147600******************************************************************14760003
147700* 3104-OPEN-AUDIT-ITEM-CURSOR                                    *14770003
147800*  OPEN THE PO LINE CURSOR                                       *14780003
147900******************************************************************14790003
148000 3104-OPEN-AUDIT-ITEM-CURSOR.                                     14800003
148100                                                                  14810003
148200     EXEC SQL                                                     14820003
148300         OPEN AUDIT_ITEM_CURSOR                                   14830003
148400     END-EXEC.                                                    14840003
148500                                                                  14850003
148600     EVALUATE TRUE                                                14860003
148700         WHEN SQLCODE = ZERO                                      14870003
148800             SET PS-NOT-EOC-AUDIT-ITEM-CURSOR                     14880003
148900                 PS-NO-OVER-SHORT-ERROR       TO TRUE             14890003
149000                                                                  14900003
149100         WHEN SQLWARN0 NOT = SPACES                               14910003
149200         WHEN SQLCODE < ZERO                                      14920003
149300         WHEN SQLCODE > ZERO                                      14930003
149400             MOVE '3104-OPEN-AUDIT-ITEM-CURSOR'                   14940003
149500                                   TO DP013-PARAGRAPH             14950003
149600             MOVE 'OPEN AUDIT-ITEM-CURSOR'                        14960003
149700                                   TO DP013-MESSAGE-TEXT (1)      14970003
149800             MOVE SU006-AUDIT-CNTL-NBR-X                          14980003
149900                                   TO DP013-MESSAGE-TEXT (2)      14990003
150000             MOVE SU006-SHIP-UNIT-NBR-X                           15000003
150100                                   TO DP013-MESSAGE-TEXT (3)      15010003
150200             MOVE SQLCA            TO DP013-SQLCA                 15020003
150300             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    15030003
150400             MOVE 'XLT00006'       TO DP013-DB2-TABLE-NAME (2)    15040003
150500             SET DP013-DB2-ABEND   TO TRUE                        15050003
150600             SET DP013-NO-ROLLBACK TO TRUE                        15060003
150700             PERFORM 9999-WRITE-CICS-LOG-MSG                      15070003
150800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               15080003
150900             PERFORM 8100-SEND-DATA-ONLY                          15090003
151000             PERFORM 8200-RETURN-TRANID                           15100003
151100     END-EVALUATE.                                                15110003
151200                                                                  15120003
151300******************************************************************15130003
151400* 3105-FETCH-AUDIT-ITEM-CURSOR                                   *15140003
151500*  FETCH THE NEXT OCCURANCE OF THE OVER_SHORT_CUSOR              *15150003
151600******************************************************************15160003
151700 3105-FETCH-AUDIT-ITEM-CURSOR.                                    15170003
151800                                                                  15180003
151900     EXEC SQL                                                     15190003
152000         FETCH AUDIT_ITEM_CURSOR                                  15200003
152100         INTO    :PV-AUDIT-INTR-UPC                               15210003
152200              ,  :SUAUPC-SHIPT-UNT-ID                             15220003
152300              ,  :PV-ITEM-COUNT-AUDIT                             15230003
152400     END-EXEC.                                                    15240003
152500                                                                  15250003
152600     EVALUATE TRUE                                                15260003
152700         WHEN SQLCODE = ZERO                                      15270003
152800             CONTINUE                                             15280003
152900                                                                  15290003
153000         WHEN SQLCODE = +100                                      15300003
153100             SET PS-EOC-AUDIT-ITEM-CURSOR    TO TRUE              15310003
153200                                                                  15320003
153300         WHEN SQLWARN0 NOT = SPACES                               15330003
153400         WHEN SQLCODE < ZERO                                      15340003
153500         WHEN SQLCODE > ZERO                                      15350003
153600             MOVE '3105-FETCH-AUDIT-ITEM-CURSOR'                  15360003
153700                                   TO DP013-PARAGRAPH             15370003
153800             MOVE 'FETCH OF AUDIT_ITEM_CURSOR'                    15380003
153900                                   TO DP013-MESSAGE-TEXT (1)      15390003
154000             MOVE SU006-AUDIT-CNTL-NBR-X                          15400003
154100                                   TO DP013-MESSAGE-TEXT (2)      15410003
154200             MOVE SU006-SHIP-UNIT-NBR-X                           15420003
154300                                   TO DP013-MESSAGE-TEXT (3)      15430003
154400             MOVE SQLCA            TO DP013-SQLCA                 15440003
154500             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    15450003
154600             MOVE 'XLT00006'       TO DP013-DB2-TABLE-NAME (2)    15460003
154700             SET DP013-DB2-ABEND   TO TRUE                        15470003
154800             SET DP013-NO-ROLLBACK TO TRUE                        15480003
154900             PERFORM 9999-WRITE-CICS-LOG-MSG                      15490003
155000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               15500003
155100             PERFORM 8100-SEND-DATA-ONLY                          15510003
155200             PERFORM 8200-RETURN-TRANID                           15520003
155300     END-EVALUATE.                                                15530003
155400                                                                  15540003
155500******************************************************************15550003
155600* 3106-CLOSE-AUDIT-ITEM-CURSOR                                   *15560003
155700*  CLOSE THE PO LINE CURSOR                                      *15570003
155800******************************************************************15580003
155900 3106-CLOSE-AUDIT-ITEM-CURSOR.                                    15590003
156000                                                                  15600003
156100     EXEC SQL                                                     15610003
156200         CLOSE AUDIT_ITEM_CURSOR                                  15620003
156300     END-EXEC.                                                    15630003
156400                                                                  15640003
156500     EVALUATE TRUE                                                15650003
156600         WHEN SQLCODE = ZERO                                      15660003
156700             CONTINUE                                             15670003
156800                                                                  15680003
156900         WHEN SQLWARN0 NOT = SPACES                               15690003
157000         WHEN SQLCODE < ZERO                                      15700003
157100         WHEN SQLCODE > ZERO                                      15710003
157200             MOVE '3103-CLOSE-AUDIT-ITEM-CURSOR'                  15720003
157300                                   TO DP013-PARAGRAPH             15730003
157400             MOVE 'CLOSE OF AUDIT_ITEM_CURSOR'                    15740003
157500                                   TO DP013-MESSAGE-TEXT (1)      15750003
157600             MOVE SU006-AUDIT-CNTL-NBR-X                          15760003
157700                                   TO DP013-MESSAGE-TEXT (2)      15770003
157800             MOVE SU006-SHIP-UNIT-NBR-X                           15780003
157900                                   TO DP013-MESSAGE-TEXT (3)      15790003
158000             MOVE SQLCA            TO DP013-SQLCA                 15800003
158100             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    15810003
158200             MOVE 'XLT00006'       TO DP013-DB2-TABLE-NAME (2)    15820003
158300             SET DP013-DB2-ABEND   TO TRUE                        15830003
158400             SET DP013-NO-ROLLBACK TO TRUE                        15840003
158500             PERFORM 9999-WRITE-CICS-LOG-MSG                      15850003
158600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               15860003
158700             PERFORM 8100-SEND-DATA-ONLY                          15870003
158800             PERFORM 8200-RETURN-TRANID                           15880003
158900     END-EVALUATE.                                                15890003
159000                                                                  15900003
159100                                                                  15910003
159200 3200-SELECT-AUDIT.                                               15920003
159300                                                                  15930003
159400     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              15940003
159500                                                                  15950003
159600     EXEC SQL                                                     15960003
159700         SELECT                                                   15970003
159800                AUD_CNTL_NBR                                      15980003
159900             ,  AUD_STAT_CDE                                      15990003
160000         INTO                                                     16000003
160100                :SUT00015-AUD-CNTL-NBR                            16010003
160200             ,  :SUT00015-AUD-STAT-CDE                            16020003
160300         FROM                                                     16030003
160400                SUT_PO_AUD_REQ                                    16040003
160500         WHERE                                                    16050003
160600                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             16060003
160700     END-EXEC.                                                    16070003
160800                                                                  16080003
160900     EVALUATE TRUE                                                16090003
161000         WHEN SQLCODE = ZERO                                      16100003
161100             SET PS-SYSTEM-AUDIT-FOUND TO TRUE                    16110003
161200                                                                  16120003
161300         WHEN SQLCODE = +100                                      16130003
161400             SET PS-SYSTEM-AUDIT-NOT-FOUND TO TRUE                16140003
161500                                                                  16150003
161600         WHEN SQLWARN0 NOT = SPACES                               16160003
161700         WHEN SQLCODE < ZERO                                      16170003
161800         WHEN SQLCODE > ZERO                                      16180003
161900             MOVE '3200-SELECT-AUDIT'                             16190003
162000                 TO DP013-PARAGRAPH                               16200003
162100             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      16210003
162200                 TO DP013-MESSAGE-TEXT (1)                        16220003
162300             MOVE SU006-AUDIT-CNTL-NBR-X                          16230003
162400                 TO DP013-MESSAGE-TEXT (2)                        16240003
162500             MOVE SQLCA            TO DP013-SQLCA                 16250003
162600             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    16260003
162700             SET DP013-DB2-ABEND   TO TRUE                        16270003
162800             SET DP013-NO-ROLLBACK TO TRUE                        16280003
162900             PERFORM 9999-WRITE-CICS-LOG-MSG                      16290003
163000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               16300003
163100             PERFORM 8100-SEND-DATA-ONLY                          16310003
163200             PERFORM 8200-RETURN-TRANID                           16320003
163300     END-EVALUATE.                                                16330003
163400                                                                  16340003
163500*                                                                 16350003
163600 4200-XCTL-TO-HELP.                                               16360003
163700                                                                  16370003
163800     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      16380003
163900     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    16390003
164000     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    16400003
164100                                                                  16410003
164200     EXEC CICS                                                    16420003
164300         XCTL                                                     16430003
164400             PROGRAM   (PV-TRANSFER-PROGRAM)                      16440003
164500             COMMAREA  (PC192-COMMAREA)                           16450003
164600             LENGTH    (PV-COMMAREA-LENGTH)                       16460003
164700             RESP      (PV-CICS-RESPONSE)                         16470003
164800     END-EXEC.                                                    16480003
164900                                                                  16490003
165000     EVALUATE TRUE                                                16500003
165100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16510003
165200              CONTINUE                                            16520003
165300         WHEN OTHER                                               16530003
165400             MOVE '4200-XCTL-TO-HELP '                            16540003
165500                 TO DP013-PARAGRAPH                               16550003
165600             MOVE 'SUKRF516 - UNABLE TO XCTL TO PROGRAM: '        16560003
165700                 TO DP013-MESSAGE-TEXT (1)                        16570003
165800             MOVE PV-TRANSFER-PROGRAM                             16580003
165900                 TO DP013-MESSAGE-TEXT (2)                        16590003
166000             SET DP013-CICS-ABEND  TO TRUE                        16600003
166100             SET DP013-ROLLBACK TO TRUE                           16610003
166200             PERFORM 9999-WRITE-CICS-LOG-MSG                      16620003
166300             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             16630003
166400             SET SU006-PROCESS-SCREEN TO TRUE                     16640003
166500             PERFORM 8000-SEND-MAP                                16650003
166600             PERFORM 8200-RETURN-TRANID                           16660003
166700     END-EVALUATE.                                                16670003
166800                                                                  16680003
166810                                                                  16681006
166900******************************************************************16690003
167000*  8000-SEND-MAP                                                 *16700003
167100*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *16710003
167200******************************************************************16720003
167300 8000-SEND-MAP.                                                   16730003
167400     EXEC CICS                                                    16740003
167500         SEND                                                     16750003
167600             MAP     ('SU516A')                                   16760003
167700             MAPSET  ('SUKM516')                                  16770003
167800             ERASE                                                16780003
167900             RESP    (PV-CICS-RESPONSE)                           16790003
168000     END-EXEC.                                                    16800003
168100                                                                  16810003
168200     EVALUATE TRUE                                                16820003
168300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16830003
168400             CONTINUE                                             16840003
168500         WHEN OTHER                                               16850003
168600             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            16860003
168700             MOVE 'UNABLE TO SEND MAP'                            16870003
168800                                    TO DP013-MESSAGE-TEXT (1)     16880003
168900             SET DP013-CICS-ABEND   TO TRUE                       16890003
169000             SET DP013-NO-ROLLBACK  TO TRUE                       16900003
169100             PERFORM 9999-WRITE-CICS-LOG-MSG                      16910003
169200     END-EVALUATE.                                                16920003
169300*                                                                 16930003
169400 8100-SEND-DATA-ONLY.                                             16940003
169500                                                                  16950003
169600     EXEC CICS                                                    16960003
169700         SEND                                                     16970003
169800             MAP       ('SU516A')                                 16980003
169900             MAPSET    ('SUKM516')                                16990003
170000             CURSOR                                               17000003
170100             DATAONLY                                             17010003
170200             RESP      (PV-CICS-RESPONSE)                         17020003
170300     END-EXEC.                                                    17030003
170400                                                                  17040003
170500     EVALUATE TRUE                                                17050003
170600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 17060003
170700             CONTINUE                                             17070003
170800         WHEN OTHER                                               17080003
170900             MOVE '8100-SEND-DATA-ONLY'                           17090003
171000                                    TO DP013-PARAGRAPH            17100003
171100             MOVE 'UNABLE TO SEND DATA'                           17110003
171200                                    TO DP013-MESSAGE-TEXT (1)     17120003
171300             SET DP013-CICS-ABEND   TO TRUE                       17130003
171400             SET DP013-NO-ROLLBACK  TO TRUE                       17140003
171500             PERFORM 9999-WRITE-CICS-LOG-MSG                      17150003
171600     END-EVALUATE.                                                17160003
171700*                                                                 17170003
171800 8200-RETURN-TRANID.                                              17180003
171900     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          17190003
172000                                                                  17200003
172100     EXEC CICS                                                    17210003
172200         RETURN                                                   17220003
172300             TRANSID   (PC-CURRENT-TRANID)                        17230003
172400             COMMAREA  (CA-COMMAREA)                              17240003
172500             LENGTH    (PV-COMMAREA-LENGTH)                       17250003
172600             RESP      (PV-CICS-RESPONSE)                         17260003
172700     END-EXEC.                                                    17270003
172800                                                                  17280003
172900     EVALUATE TRUE                                                17290003
173000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 17300003
173100             CONTINUE                                             17310003
173200         WHEN OTHER                                               17320003
173300             MOVE '8200-RETURN-TRANID'                            17330003
173400                                    TO DP013-PARAGRAPH            17340003
173500             MOVE 'UNABLE TO RETURN TO TRANID'                    17350003
173600                                    TO DP013-MESSAGE-TEXT (1)     17360003
173700             SET DP013-CICS-ABEND   TO TRUE                       17370003
173800             SET DP013-NO-ROLLBACK  TO TRUE                       17380003
173900             PERFORM 9999-WRITE-CICS-LOG-MSG                      17390003
174000     END-EVALUATE.                                                17400003
174100                                                                  17410003
174200                                                                  17420003
198800 9999-WRITE-CICS-LOG-MSG.                                         19880003
198900     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            19890003
199000     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           19900003
199100     INITIALIZE DP013-SRC-TASK-NUMBER                             19910003
199200                DP013-STACK.                                      19920003
199300     SET DP013-LINK-RETURN           TO TRUE.                     19930003
199400                                                                  19940003
199500     EXEC CICS                                                    19950003
199600         LINK                                                     19960003
199700             PROGRAM   (DP013-NAME)                               19970003
199800             COMMAREA  (DP013-PARAMETERS)                         19980003
199900             LENGTH    (DP013-LENGTH)                             19990003
200000     END-EXEC.                                                    20000003
200100                                                                  20010003
200200*----------------------------------------------------------------*20020003
200300*    ABEND PROCESSOR MODULE                                      *20030003
200400*----------------------------------------------------------------*20040003
200500                                                                  20050003
200600     COPY DPPD014.                                                20060003
200700                                                                  20070003
200800                                                                  20080003
