000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000600******************************************************************00060004
000700 PROGRAM-ID.    CNKUP801.                                         00070099
000800 AUTHOR.        TKMA497.                                          00080007
000900 INSTALLATION.  KOHLS.                                            00090004
001000 DATE-WRITTEN   JULY, 2011.                                       00100007
001100 DATE-COMPILED.                                                   00110004
001200******************************************************************00120004
001210*  NEW DC - TCOCNTL INSERT                                        00121099
001300*  THIS PROGRAM INSERTS TCOCNTL DATA FROM A FLAT FILE TO THE      00130099
001400*  TCOCNTL TABLE                                                  00140099
006600******************************************************************00660004
007000 ENVIRONMENT DIVISION.                                            00700004
007100******************************************************************00710004
007200 CONFIGURATION SECTION.                                           00720004
007300*                                                                 00730004
007400 SOURCE-COMPUTER.        IBM-3090.                                00740004
007500 OBJECT-COMPUTER.        IBM-3090.                                00750004
007600*                                                                 00760004
007700 INPUT-OUTPUT SECTION.                                            00770004
007800*                                                                 00780004
007900 FILE-CONTROL.                                                    00790004
008000*                                                                 00800099
008400     SELECT CNTL-FILE-IN                                          00840099
008500         ASSIGN TO INP01.                                         00850060
008700*                                                                 00870004
008800******************************************************************00880004
008900 DATA DIVISION.                                                   00890004
009000******************************************************************00900004
009100 FILE SECTION.                                                    00910004
009200*                                                                 00920004
010000*                                                                 01000004
010100 FD  CNTL-FILE-IN                                                 01010099
010200     RECORDING MODE IS F                                          01020004
010300     BLOCK CONTAINS 0 RECORDS                                     01030004
010400     LABEL RECORDS ARE STANDARD.                                  01040004
010500*                                                                 01050004
010600 01  CNTL-RECORD-IN                 PIC  X(181).                  01060099
010700*                                                                 01070004
010800*                                                                 01080004
010900 WORKING-STORAGE SECTION.                                         01090004
011000*                                                                 01100004
011100 01  PC-PROGRAM-CONSTANTS.                                        01110004
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            01120019
011300         'CNKUP801'.                                              01130099
011400                                                                  01140004
011500 01  DK-DB2-KEYS.                                                 01150099
011600     05  DK-LOC-ID                  PIC S9(04)   VALUE ZERO       01160099
012600                                                       COMP.      01260099
014600*                                                                 01460004
014700 01  PS-PROGRAM-SWITCHES.                                         01470004
015000     05  PS-CONTROL-CARD-VALID-SW    PIC  X(01)    VALUE SPACE.   01500004
015100         88  PS-CONTROL-CARD-INVALID               VALUE 'N'.     01510004
015200         88  PS-CONTROL-CARD-VALID                 VALUE 'Y'.     01520004
015201     05  PS-END-OF-INPUT-SW          PIC  X(01)    VALUE 'N'.     01520199
015202         88 PS-END-OF-INPUT-NO                     VALUE 'N'.     01520299
015203         88 PS-END-OF-INPUT-YES                    VALUE 'Y'.     01520399
015204     05  PS-TCOCNTL-FOUND-SW         PIC  X(01)    VALUE 'N'.     01520499
015205         88 PS-TCOCNTL-FOUND-NO                    VALUE 'N'.     01520599
015206         88 PS-TCOCNTL-FOUND-YES                   VALUE 'Y'.     01520699
015300*                                                                 01530004
015400*                                                                 01540004
015500 01  PV-PROGRAM-VARIABLES.                                        01550004
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01560004
015700                                                   COMP.          01570004
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01580004
015810     05  PV-OPER-UNT-ID              PIC  9(04).                  01581099
015820     05  PV-COMMIT-CNT               PIC S9(03)    COMP-3.        01582099
015830     05  PV-INSERT-CNT               PIC S9(03)    COMP-3         01583099
015840                                                   VALUE +1.      01584099
015900     05  PV-TCOCNTL-CNT              PIC S9(05)    VALUE ZERO     01590099
016000                                                   COMP-3.        01600004
016100     05  PV-INPUT-CNT                PIC S9(05)    VALUE ZERO     01610066
016200                                                   COMP-3.        01620004
016300     05  PV-DISPLAY-CNT              PIC ZZZZ9.                   01630099
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01650004
020400*                                                                 02040004
021300******************************************************************02130004
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02140004
021500******************************************************************02150004
021600     COPY DPWS004.                                                02160004
021800*                                                                 02180004
021900******************************************************************02190004
022000*  COMMUNICATIONS AREA FOR DB2                                    02200004
022100******************************************************************02210004
022200     EXEC SQL                                                     02220004
022300          INCLUDE SQLCA                                           02230004
022400     END-EXEC.                                                    02240004
022500*                                                                 02250004
022510*----------------------------------------------------------------*02251099
022520*    DB2 COMPANY CONTROL TABLE                                    02252099
022530*----------------------------------------------------------------*02253099
022540     EXEC SQL                                                     02254099
022550          INCLUDE TCOCNTL                                         02255099
022560     END-EXEC.                                                    02256099
024900*                                                                 02490004
046100******************************************************************04610004
046200 PROCEDURE DIVISION.                                              04620004
046300******************************************************************04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   04660004
046700******************************************************************04670004
046800 0000-PROGRAM-MAINLINE.                                           04680004
046810     DISPLAY ' '.                                                 04681099
046820     DISPLAY 'PROGRAM:  CNKUP801'.                                04682099
046830     DISPLAY ' '.                                                 04683099
046840                                                                  04684099
046900     OPEN INPUT CNTL-FILE-IN.                                     04690099
047000*                                                                 04700004
047010     PERFORM 5000-READ-INPUT.                                     04701099
047020     PERFORM 2000-PROCESS-TCOCNTL                                 04702099
047030       UNTIL PS-END-OF-INPUT-YES.                                 04703099
047040*                                                                 04704099
047050     PERFORM 9000-DISPLAY-COUNTS.                                 04705099
047500*                                                                 04750004
047510     CLOSE CNTL-FILE-IN.                                          04751099
047520*                                                                 04752064
047600     STOP RUN.                                                    04760004
047700*                                                                 04770004
049620******************************************************************04962004
049700 2000-PROCESS-TCOCNTL.                                            04970099
058600*                                                                 05860004
058700     PERFORM 7100-SELECT-TCOCNTL.                                 05870099
058800     IF  PS-TCOCNTL-FOUND-NO                                      05880099
059200         PERFORM 7000-INSERT-TCOCNTL                              05920099
059300     ELSE                                                         05930099
059310         MOVE COCNTL-OPER-UNT-ID   TO PV-OPER-UNT-ID              05931099
059320         DISPLAY '*** OPER_UNT_ID ALREADY ON TCOCNTL: '           05932099
059330                  PV-OPER-UNT-ID                                  05933099
059400     END-IF.                                                      05940099
059800*                                                                 05980004
061910     PERFORM 5000-READ-INPUT.                                     06191067
062000*                                                                 06200004
062001 5000-READ-INPUT.                                                 06200166
062010     READ CNTL-FILE-IN                                            06201099
062021          INTO DCLTCOCNTL                                         06202199
062030            AT END                                                06203099
062040               SET PS-END-OF-INPUT-YES TO TRUE                    06204099
062050           NOT AT END                                             06205099
062060               ADD +1 TO PV-INPUT-CNT.                            06206099
111900*                                                                 11190004
112000******************************************************************11200004
112100*  INSERT COMPANY CONTROL ROW                                     11210099
112200******************************************************************11220004
112300 7000-INSERT-TCOCNTL.                                             11230099
112301*                                                                 11230168
112302     EXEC SQL                                                     11230269
112310     INSERT INTO TCOCNTL                                          11231099
112320               (OPER_UNT_ID                                       11232099
112330               ,FCLTY_ID                                          11233099
112340               ,SHIPT_OVRG_PCT                                    11234099
112350               ,SHIPT_SHTG_PCT                                    11235099
112360               ,DAYS_PR_CHG_NBR                                   11236099
112370               ,SHIPT_ERL_DAYS_NBR                                11237099
112380               ,SHIPT_LTE_DAYS_NBR                                11238099
112390               ,DFLT_SU_PRTR_ID                                   11239099
112391               ,DAYS_ALWD_ADJ_QTY                                 11239199
112392               ,BTCH_PRC_DTE                                      11239299
112393               ,PRT_TRLR_MFST_IND                                 11239399
112394               ,PRT_MKNG_APRN_IND                                 11239499
112395               ,PRT_APRN_HDR_IND                                  11239599
112396               ,PRT_MSTR_PO_IND                                   11239699
112397               ,PRT_TRBL_DOC_IND                                  11239799
112398               ,DFLT_TRIP_LBL_QTY                                 11239899
112399               ,DFLT_HDR_LBL_QTY                                  11239999
112400               ,CA_TRBL_CRE_IND                                   11240099
112401               ,CA_LGS_PRTR_ID                                    11240199
112402               ,CA_RCVG_PRTR_ID                                   11240299
112403               ,CA_FLAT_PRTR_ID                                   11240399
112404               ,CA_SHIP_PRTR_ID                                   11240499
112405               ,CA_SPTCK_DFLT_PCT                                 11240599
112406               ,CA_ERR_LMT_PCT                                    11240699
112407               ,NW_STR_OVRG_PCT                                   11240799
112408               ,NW_STR_SHTG_PCT                                   11240899
112409               ,P2L_DISTRB_TRN_ID                                 11240999
112410               ,P2L_CART_TRN_ID                                   11241099
112411               ,P2L_UPLD_TRN_ID                                   11241199
112412               ,IMPRT_OVRG_PCT                                    11241299
112413               ,IMPRT_SHTG_PCT                                    11241399
112414               ,IMPRT_AD_OVRG_PCT                                 11241499
112415               ,IMPRT_AD_SHTG_PCT                                 11241599
112416               ,SPLT_PRC_DAYS_QTY                                 11241699
112417               ,DFLT_CRE_LBL_CDE                                  11241799
112418               ,DFLT_PRT_ORD_CDE                                  11241899
112419               ,DFLT_CNSTK_LBL_QTY                                11241999
112420               ,DFLT_FCSE_AREA_ID                                 11242099
112421               ,IMPRTPPK_OVRG_PCT                                 11242199
112422               ,IMPRTPPK_SHTG_PCT                                 11242299
112423               ,PRT_LBL_ON_SCN_CNT                                11242399
112424               ,DFLT_OPER_SET_ID                                  11242499
112425               ,DFLT_CNSTK_PRTR_ID                                11242599
112426               ,CNSTK_PL_PRT_CD                                   11242699
112427               ,CNSTK_PL_NBR                                      11242799
112428               ,CK_NW_PL_MNIT_QTY                                 11242899
112429               ,CNSTK_STR_RPTG_IND                                11242999
112430               ,IMPADVPPK_OVRG_PCT                                11243099
112431               ,IMPADVPPK_SHTG_PCT                                11243199
112432               ,PREPK_OVRG_PCT                                    11243299
112433               ,PREPK_SHTG_PCT                                    11243399
112434               ,NWSTRPPK_OVRG_PCT                                 11243499
112435               ,NWSTRPPK_SHTG_PCT                                 11243599
112436               ,LNE_ODU_TOL_QTY                                   11243699
112437               ,LNE_ODU_TOL_AMT                                   11243799
112438               ,PREPK_ODU_TOL_QTY                                 11243899
112439               ,PREPK_ODU_TOL_AMT                                 11243999
112440               ,UNT_VRFN_VARN_PCT                                 11244099
112441               ,DOL_VRFN_VARN_PCT                                 11244199
112442               ,DOL_VARN_THRS_AMT                                 11244299
112443               ,SSCC_18_IND                                       11244399
112444               ,DFLT_CNSTK_LOC_ID                                 11244499
112445               ,P2L_SML_UPLD_ID)                                  11244599
112460       VALUES (:COCNTL-OPER-UNT-ID                                11246099
112470              ,:COCNTL-FCLTY-ID                                   11247099
112480              ,:COCNTL-SHIPT-OVRG-PCT                             11248099
112490              ,:COCNTL-SHIPT-SHTG-PCT                             11249099
112500              ,:COCNTL-DAYS-PR-CHG-NBR                            11250099
112600              ,:COCNTL-SHIPT-ERL-DAYS-NBR                         11260099
112610              ,:COCNTL-SHIPT-LTE-DAYS-NBR                         11261099
112620              ,:COCNTL-DFLT-SU-PRTR-ID                            11262099
112630              ,:COCNTL-DAYS-ALWD-ADJ-QTY                          11263099
112640              ,:COCNTL-BTCH-PRC-DTE                               11264099
112650              ,:COCNTL-PRT-TRLR-MFST-IND                          11265099
112660              ,:COCNTL-PRT-MKNG-APRN-IND                          11266099
112670              ,:COCNTL-PRT-APRN-HDR-IND                           11267099
112671              ,:COCNTL-PRT-MSTR-PO-IND                            11267199
112672              ,:COCNTL-PRT-TRBL-DOC-IND                           11267299
112673              ,:COCNTL-DFLT-TRIP-LBL-QTY                          11267399
112674              ,:COCNTL-DFLT-HDR-LBL-QTY                           11267499
112675              ,:COCNTL-CA-TRBL-CRE-IND                            11267599
112676              ,:COCNTL-CA-LGS-PRTR-ID                             11267699
112677              ,:COCNTL-CA-RCVG-PRTR-ID                            11267799
112678              ,:COCNTL-CA-FLAT-PRTR-ID                            11267899
112679              ,:COCNTL-CA-SHIP-PRTR-ID                            11267999
112680              ,:COCNTL-CA-SPTCK-DFLT-PCT                          11268099
112681              ,:COCNTL-CA-ERR-LMT-PCT                             11268199
112682              ,:COCNTL-NW-STR-OVRG-PCT                            11268299
112683              ,:COCNTL-NW-STR-SHTG-PCT                            11268399
112684              ,:COCNTL-P2L-DISTRB-TRN-ID                          11268499
112685              ,:COCNTL-P2L-CART-TRN-ID                            11268599
112686              ,:COCNTL-P2L-UPLD-TRN-ID                            11268699
112687              ,:COCNTL-IMPRT-OVRG-PCT                             11268799
112688              ,:COCNTL-IMPRT-SHTG-PCT                             11268899
112689              ,:COCNTL-IMPRT-AD-OVRG-PCT                          11268999
112690              ,:COCNTL-IMPRT-AD-SHTG-PCT                          11269099
112691              ,:COCNTL-SPLT-PRC-DAYS-QTY                          11269199
112692              ,:COCNTL-DFLT-CRE-LBL-CDE                           11269299
112693              ,:COCNTL-DFLT-PRT-ORD-CDE                           11269399
112694              ,:COCNTL-DFLT-CNSTK-LBL-QTY                         11269499
112695              ,:COCNTL-DFLT-FCSE-AREA-ID                          11269599
112696              ,:COCNTL-IMPRTPPK-OVRG-PCT                          11269699
112697              ,:COCNTL-IMPRTPPK-SHTG-PCT                          11269799
112698              ,:COCNTL-PRT-LBL-ON-SCN-CNT                         11269899
112699              ,:COCNTL-DFLT-OPER-SET-ID                           11269999
112700              ,:COCNTL-DFLT-CNSTK-PRTR-ID                         11270099
112701              ,:COCNTL-CNSTK-PL-PRT-CD                            11270199
112702              ,:COCNTL-CNSTK-PL-NBR                               11270299
112703              ,:COCNTL-CK-NW-PL-MNIT-QTY                          11270399
112704              ,:COCNTL-CNSTK-STR-RPTG-IND                         11270499
112705              ,:COCNTL-IMPADVPPK-OVRG-PCT                         11270599
112706              ,:COCNTL-IMPADVPPK-SHTG-PCT                         11270699
112707              ,:COCNTL-PREPK-OVRG-PCT                             11270799
112708              ,:COCNTL-PREPK-SHTG-PCT                             11270899
112709              ,:COCNTL-NWSTRPPK-OVRG-PCT                          11270999
112710              ,:COCNTL-NWSTRPPK-SHTG-PCT                          11271099
112711              ,:COCNTL-LNE-ODU-TOL-QTY                            11271199
112712              ,:COCNTL-LNE-ODU-TOL-AMT                            11271299
112713              ,:COCNTL-PREPK-ODU-TOL-QTY                          11271399
112714              ,:COCNTL-PREPK-ODU-TOL-AMT                          11271499
112715              ,:COCNTL-UNT-VRFN-VARN-PCT                          11271599
112716              ,:COCNTL-DOL-VRFN-VARN-PCT                          11271699
112717              ,:COCNTL-DOL-VARN-THRS-AMT                          11271799
112718              ,:COCNTL-SSCC-18-IND                                11271899
112719              ,:COCNTL-DFLT-CNSTK-LOC-ID                          11271999
112720              ,:COCNTL-P2L-SML-UPLD-ID)                           11272099
112721     END-EXEC.                                                    11272169
112730*                                                                 11273004
112800     EVALUATE TRUE                                                11280004
112900         WHEN SQLCODE = ZERO                                      11290004
112910              ADD +1 TO PV-TCOCNTL-CNT                            11291099
112920              PERFORM 8000-COMMIT                                 11292099
113100         WHEN OTHER                                               11310004
113101              PERFORM 9000-DISPLAY-COUNTS                         11310199
113102              MOVE COCNTL-OPER-UNT-ID   TO PV-OPER-UNT-ID         11310299
113103              DISPLAY '*** OPER_UNT_ID = ' PV-OPER-UNT-ID         11310399
113200              MOVE '7000-INSERT-TCOCNTL'                          11320099
113300                                 TO PV-ABEND-PARAGRAPH            11330022
113400              MOVE 'INSERT'      TO PV-DB2-OPERATION-ATTEMPTED    11340068
113500              PERFORM 9200-SQL-ABEND                              11350004
113600     END-EVALUATE.                                                11360004
143400*                                                                 14340004
143410******************************************************************14341099
143420*  SELECT COMPANY CONTROL                                         14342099
143430******************************************************************14343099
143440 7100-SELECT-TCOCNTL.                                             14344099
143450                                                                  14345099
143460     EXEC SQL                                                     14346099
143470         SELECT  OPER_UNT_ID                                      14347099
143551           INTO :COCNTL-OPER-UNT-ID                               14355199
143614           FROM  TCOCNTL                                          14361499
143615          WHERE  OPER_UNT_ID = :COCNTL-OPER-UNT-ID                14361599
143616           WITH  UR                                               14361699
143617     END-EXEC.                                                    14361799
143618*                                                                 14361899
143619     EVALUATE TRUE                                                14361999
143620         WHEN SQLCODE = ZERO                                      14362099
143622              SET PS-TCOCNTL-FOUND-YES  TO  TRUE                  14362299
143624         WHEN SQLCODE = +100                                      14362499
143625              SET PS-TCOCNTL-FOUND-NO   TO  TRUE                  14362599
143627         WHEN OTHER                                               14362799
143628              MOVE COCNTL-OPER-UNT-ID   TO PV-OPER-UNT-ID         14362899
143629              DISPLAY '*** ' PV-OPER-UNT-ID                       14362999
143644              MOVE '7000-SELECT-TCOCNTL'                          14364499
143645                                 TO PV-ABEND-PARAGRAPH            14364599
143646              MOVE 'SELECT'      TO PV-DB2-OPERATION-ATTEMPTED    14364699
143647              PERFORM 9200-SQL-ABEND                              14364799
143648     END-EVALUATE.                                                14364899
143649                                                                  14364999
143650 8000-COMMIT.                                                     14365098
143651     EXEC SQL                                                     14365198
143652          COMMIT                                                  14365298
143653     END-EXEC                                                     14365398
143654     IF  SQLCODE = ZERO                                           14365499
143655         CONTINUE                                                 14365599
143656     ELSE                                                         14365698
143657         PERFORM 9000-DISPLAY-COUNTS                              14365799
143660         MOVE COCNTL-OPER-UNT-ID                                  14366099
143700                           TO PV-OPER-UNT-ID                      14370099
143800         DISPLAY PV-OPER-UNT-ID                                   14380099
144300         MOVE '8000-COMMIT' TO PV-ABEND-PARAGRAPH                 14430099
144500         MOVE 'COMMIT'      TO PV-DB2-OPERATION-ATTEMPTED         14450098
144600         PERFORM 9200-SQL-ABEND                                   14460098
144610     END-IF.                                                      14461099
144700******************************************************************14470004
144800 9000-DISPLAY-COUNTS.                                             14480033
145100                                                                  14510004
145200     DISPLAY '********************************************'.      14520099
145310     DISPLAY '* CNKUP801                                 *'.      14531099
145330     MOVE PV-INPUT-CNT       TO PV-DISPLAY-CNT.                   14533099
145400     DISPLAY 'INPUT FILE COUNT ----: ' PV-DISPLAY-CNT.            14540099
145500     MOVE PV-TCOCNTL-CNT     TO PV-DISPLAY-CNT                    14550099
145501     DISPLAY 'TCOCNTL INSERTED ----: ' PV-DISPLAY-CNT.            14550199
145510     DISPLAY '********************************************'.      14551037
146600*                                                                 14660004
146700*                                                                 14670004
146800******************************************************************14680004
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    14690004
147000*  ERROR OR WARNING CODE OCCURS.                                  14700004
147100******************************************************************14710004
147200 9200-SQL-ABEND.                                                  14720004
147300     DISPLAY '9200-SQL-ABEND'.                                    14730004
147400     DISPLAY '** ABEND     **'.                                   14740004
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14750004
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             14760004
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14770004
147800*                                                                 14780004
147900*                                                                 14790004
148000******************************************************************14800004
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14810004
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14820004
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14830004
148400* FORMAT.                                                         14840004
148500******************************************************************14850004
148600     COPY DPPD004.                                                14860004
148700                                                                  14870004
148800     IF  SQLCODE NOT = -911                                       14880004
148900         EXEC SQL                                                 14890004
149000              COMMIT                                              14900004
149100         END-EXEC                                                 14910004
149200     END-IF.                                                      14920004
149300                                                                  14930004
149400     MOVE +4013                  TO PV-ABEND-CODE.                14940004
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14950004
