000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000600******************************************************************00060004
000700 PROGRAM-ID.    CNKUP800.                                         00070059
000800 AUTHOR.        TKMA497.                                          00080007
000900 INSTALLATION.  KOHLS.                                            00090004
001000 DATE-WRITTEN   JULY, 2011.                                       00100007
001100 DATE-COMPILED.                                                   00110004
001200******************************************************************00120004
001210*  NEW DC - TKRPRPM INSERT                                        00121099
001300*  THIS PROGRAM INSERTS TKRPRPM DATA FROM A FLAT FILE TO THE      00130059
001400*  TKRPRPM TABLE                                                  00140059
006600******************************************************************00660004
007000 ENVIRONMENT DIVISION.                                            00700004
007100******************************************************************00710004
007200 CONFIGURATION SECTION.                                           00720004
007300*                                                                 00730004
007400 SOURCE-COMPUTER.        IBM-3090.                                00740004
007500 OBJECT-COMPUTER.        IBM-3090.                                00750004
007600*                                                                 00760004
007700 INPUT-OUTPUT SECTION.                                            00770004
007800*                                                                 00780004
007900 FILE-CONTROL.                                                    00790004
008000*                                                                 00800099
008400     SELECT PARM-FILE-IN                                          00840060
008500         ASSIGN TO INP01.                                         00850060
008700*                                                                 00870004
008800******************************************************************00880004
008900 DATA DIVISION.                                                   00890004
009000******************************************************************00900004
009100 FILE SECTION.                                                    00910004
009200*                                                                 00920004
010000*                                                                 01000004
010100 FD  PARM-FILE-IN                                                 01010060
010200     RECORDING MODE IS F                                          01020004
010300     BLOCK CONTAINS 0 RECORDS                                     01030004
010400     LABEL RECORDS ARE STANDARD.                                  01040004
010500*                                                                 01050004
010600 01  PARM-RECORD-IN                 PIC  X(129).                  01060099
010700*                                                                 01070004
010800*                                                                 01080004
010900 WORKING-STORAGE SECTION.                                         01090004
010901 01  WS-TKRPRPM.                                                  01090199
010902     05  WS-PARM-DATA.                                            01090285
010903         10  WS-KRPRPM-LOC-ID            PIC  S9(4) COMP.         01090385
010904         10  WS-KRPRPM-INTFC-SYS-CDE     PIC   X(3).              01090485
010905         10  WS-KRPRPM-SYS-PRC-FUNC-CDE  PIC   X(6).              01090585
010906         10  WS-KRPRPM-FUNC-PRC-STAT-CDE PIC   X(2).              01090685
010907         10  WS-FUNC-PRC-STAT-CDE-NULL   PIC  S9(04) COMP.        01090785
010908         10  WS-KRPRPM-FUNC-BEG-TMST     PIC   X(26).             01090885
010909         10  WS-FUNC-BEG-TMST-NULL       PIC  S9(04) COMP.        01090985
010910         10  WS-KRPRPM-FUNC-END-TMST     PIC   X(26).             01091085
010911         10  WS-FUNC-END-TMST-NULL       PIC  S9(04) COMP.        01091185
010912         10  WS-KRPRPM-FUNC-QTY          PIC  S9(9) COMP.         01091285
010913         10  WS-FUNC-QTY-NULL            PIC  S9(04) COMP.        01091385
010914         10  WS-KRPRPM-FUNC-PCT          PIC  S9(1)V9(4) COMP-3.  01091485
010915         10  WS-FUNC-PCT-NULL            PIC  S9(04) COMP.        01091585
010916         10  WS-KRPRPM-FUNC-TXT          PIC   X(25).             01091685
010917         10  WS-FUNC-TXT-NULL            PIC  S9(04) COMP.        01091785
010918         10  WS-KRPRPM-FUNC-WD-QTY       PIC  S9(5)V9(4) COMP-3.  01091885
010919         10  WS-KRPRPM-FUNC-DPTH-QTY     PIC  S9(5)V9(4) COMP-3.  01091985
010920         10  WS-KRPRPM-FUNC-HT-QTY       PIC  S9(5)V9(4) COMP-3.  01092085
010921         10  WS-KRPRPM-FUNC-WT-QTY       PIC  S9(5)V9(4) COMP-3.  01092185
010937*                                                                 01093741
010938*** NULL INDICATORS                                               01093841
011000*                                                                 01100004
011100 01  PC-PROGRAM-CONSTANTS.                                        01110004
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            01120019
011300         'CNKUP800'.                                              01130059
011400                                                                  01140004
011500 01  DK-DB2-KEYS.                                                 01150019
011600     05  DK-LOC-ID                  PIC S9(04)   VALUE ZERO       01160099
012600                                                       COMP.      01260099
014600*                                                                 01460004
014700 01  PS-PROGRAM-SWITCHES.                                         01470004
015000     05  PS-CONTROL-CARD-VALID-SW    PIC  X(01)    VALUE SPACE.   01500004
015100         88  PS-CONTROL-CARD-INVALID               VALUE 'N'.     01510004
015200         88  PS-CONTROL-CARD-VALID                 VALUE 'Y'.     01520004
015201     05  PS-END-OF-INPUT-SW          PIC  X(01)    VALUE 'N'.     01520163
015210         88 PS-END-OF-INPUT-NO                     VALUE 'N'.     01521063
015220         88 PS-END-OF-INPUT-YES                    VALUE 'Y'.     01522063
015300*                                                                 01530004
015400*                                                                 01540004
015500 01  PV-PROGRAM-VARIABLES.                                        01550004
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01560004
015700                                                   COMP.          01570004
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01580004
015810     05  PV-LOC-ID                   PIC  9(04).                  01581087
015820     05  PV-COMMIT-CNT               PIC S9(03)    COMP-3.        01582090
015830     05  PV-INSERT-CNT               PIC S9(03)    COMP-3         01583093
015840                                                   VALUE +1.      01584093
015900     05  PV-TKRPRPM-CNT              PIC S9(05)    VALUE ZERO     01590033
016000                                                   COMP-3.        01600004
016100     05  PV-INPUT-CNT                PIC S9(05)    VALUE ZERO     01610066
016200                                                   COMP-3.        01620004
016410     05  PV-DISPLAY-CNT              PIC ZZZZ9.                   01641033
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01650004
017200*                                                                 01720004
020400*                                                                 02040004
021300******************************************************************02130004
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02140004
021500******************************************************************02150004
021600     COPY DPWS004.                                                02160004
021700*                                                                 02170004
021800*                                                                 02180004
021900******************************************************************02190004
022000*  COMMUNICATIONS AREA FOR DB2                                    02200004
022100******************************************************************02210004
022200     EXEC SQL                                                     02220004
022300          INCLUDE SQLCA                                           02230004
022400     END-EXEC.                                                    02240004
022500*                                                                 02250004
022510*----------------------------------------------------------------*02251035
022520*    DB2 TABLE FOR PARAMETERS                                     02252035
022530*----------------------------------------------------------------*02253035
022540     EXEC SQL                                                     02254035
022550          INCLUDE TKRPRPM                                         02255035
022560     END-EXEC.                                                    02256035
024900*                                                                 02490004
025000*                                                                 02500004
046000*                                                                 04600004
046100******************************************************************04610004
046200 PROCEDURE DIVISION.                                              04620004
046300******************************************************************04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   04660004
046700******************************************************************04670004
046800 0000-PROGRAM-MAINLINE.                                           04680004
046810     PERFORM 1000-INITIALIZE.                                     04681091
047000*                                                                 04700004
047010     PERFORM 5000-READ-INPUT.                                     04701066
047020     IF PS-END-OF-INPUT-NO                                        04702099
047029         PERFORM 2000-PROCESS-TKRPRPM                             04702999
047030             UNTIL PS-END-OF-INPUT-YES                            04703099
047050         PERFORM 8000-COMMIT                                      04705099
047060     END-IF.                                                      04706099
047480     PERFORM 9000-DISPLAY-COUNTS                                  04748043
047500*                                                                 04750004
047510     CLOSE PARM-FILE-IN.                                          04751064
047520*                                                                 04752064
047600     STOP RUN.                                                    04760004
047700*                                                                 04770004
048400******************************************************************04840004
048800*                                                                 04880004
048801 1000-INITIALIZE.                                                 04880191
048802     DISPLAY '**'.                                                04880299
048803     DISPLAY '** PROGRAM CNKUP800'.                               04880399
048804     DISPLAY '**'.                                                04880499
048805                                                                  04880599
048810     OPEN INPUT PARM-FILE-IN.                                     04881091
049100                                                                  04910094
049200     EXEC SQL                                                     04920091
049400          SELECT  FUNC_QTY                                        04940099
049500            INTO :PV-COMMIT-CNT                                   04950092
049593            FROM  TKRPRPM                                         04959399
049594           WHERE  LOC_ID           = 90                           04959499
049595             AND  INTFC_SYS_CDE    = 'KHL'                        04959599
049596             AND  SYS_PRC_FUNC_CDE = 'DCCOMT'                     04959699
049597         WITH UR                                                  04959791
049598     END-EXEC                                                     04959891
049599                                                                  04959999
049600     EVALUATE TRUE                                                04960095
049601         WHEN SQLCODE = ZERO                                      04960195
049602              CONTINUE                                            04960299
049603         WHEN OTHER                                               04960395
049605              DISPLAY 'SYS_PRC_FUNC_CDE = DCCOMT'                 04960599
049608              MOVE '1000-INITIALIZE'                              04960895
049609                                 TO PV-ABEND-PARAGRAPH            04960995
049610              MOVE 'SELECT'      TO PV-DB2-OPERATION-ATTEMPTED    04961095
049611              PERFORM 9200-SQL-ABEND                              04961195
049612     END-EVALUATE.                                                04961295
049613*                                                                 04961395
049620******************************************************************04962004
049700 2000-PROCESS-TKRPRPM.                                            04970027
058600*                                                                 05860004
059200     PERFORM 7000-INSERT-TKRPRPM                                  05920067
059800*                                                                 05980004
061910     PERFORM 5000-READ-INPUT.                                     06191067
062000*                                                                 06200004
062001 5000-READ-INPUT.                                                 06200166
062010     READ PARM-FILE-IN                                            06201064
062021          INTO WS-TKRPRPM                                         06202181
062030          AT END                                                  06203065
062040              SET PS-END-OF-INPUT-YES TO TRUE                     06204073
062050          NOT AT END                                              06205067
062060              ADD +1 TO PV-INPUT-CNT.                             06206067
111900*                                                                 11190004
112000******************************************************************11200004
112100*  INSERT PARMS                                                   11210067
112200******************************************************************11220004
112300 7000-INSERT-TKRPRPM.                                             11230067
112301*                                                                 11230168
112302     EXEC SQL                                                     11230269
112310     INSERT INTO TKRPRPM                                          11231068
112320           (LOC_ID                                                11232068
112330           ,INTFC_SYS_CDE                                         11233068
112340           ,SYS_PRC_FUNC_CDE                                      11234068
112350           ,FUNC_PRC_STAT_CDE                                     11235068
112360           ,FUNC_BEG_TMST                                         11236068
112370           ,FUNC_END_TMST                                         11237068
112380           ,FUNC_QTY                                              11238068
112390           ,FUNC_PCT                                              11239068
112391           ,FUNC_TXT                                              11239168
112392           ,FUNC_WD_QTY                                           11239268
112393           ,FUNC_DPTH_QTY                                         11239368
112394           ,FUNC_HT_QTY                                           11239468
112395           ,FUNC_WT_QTY)                                          11239568
112399   VALUES (:WS-KRPRPM-LOC-ID                                      11239986
112500          ,:WS-KRPRPM-INTFC-SYS-CDE                               11250086
112600          ,:WS-KRPRPM-SYS-PRC-FUNC-CDE                            11260086
112610          ,:WS-KRPRPM-FUNC-PRC-STAT-CDE                           11261086
112620               :WS-FUNC-PRC-STAT-CDE-NULL                         11262086
112630          ,:WS-KRPRPM-FUNC-BEG-TMST                               11263086
112640               :WS-FUNC-BEG-TMST-NULL                             11264086
112650          ,:WS-KRPRPM-FUNC-END-TMST                               11265086
112660               :WS-FUNC-END-TMST-NULL                             11266086
112670          ,:WS-KRPRPM-FUNC-QTY                                    11267086
112671               :WS-FUNC-QTY-NULL                                  11267186
112672          ,:WS-KRPRPM-FUNC-PCT                                    11267286
112673               :WS-FUNC-PCT-NULL                                  11267386
112674          ,:WS-KRPRPM-FUNC-TXT                                    11267486
112675               :WS-FUNC-TXT-NULL                                  11267586
112676          ,:WS-KRPRPM-FUNC-WD-QTY                                 11267686
112677          ,:WS-KRPRPM-FUNC-DPTH-QTY                               11267786
112678          ,:WS-KRPRPM-FUNC-HT-QTY                                 11267886
112679          ,:WS-KRPRPM-FUNC-WT-QTY)                                11267986
112680     END-EXEC.                                                    11268069
112700*                                                                 11270004
112800     EVALUATE TRUE                                                11280004
112900         WHEN SQLCODE = ZERO                                      11290004
112910              ADD +1 TO PV-TKRPRPM-CNT                            11291073
112911                        PV-INSERT-CNT                             11291197
112912              IF PV-INSERT-CNT > PV-COMMIT-CNT                    11291299
112920                   PERFORM 8000-COMMIT                            11292098
112930                   MOVE +1    TO PV-INSERT-CNT                    11293098
112933              END-IF                                              11293398
112934         WHEN SQLCODE = -803                                      11293498
112935              MOVE WS-KRPRPM-LOC-ID     TO PV-LOC-ID              11293598
112936              DISPLAY '*** DUPLICATE INSERT FOR: '                11293699
112940              DISPLAY '    ' PV-LOC-ID ' '                        11294096
112950              WS-KRPRPM-INTFC-SYS-CDE ' '                         11295096
112960              WS-KRPRPM-SYS-PRC-FUNC-CDE                          11296096
113100         WHEN OTHER                                               11310004
113101              PERFORM 9000-DISPLAY-COUNTS                         11310199
113102              MOVE WS-KRPRPM-LOC-ID     TO PV-LOC-ID              11310287
113103              DISPLAY PV-LOC-ID ' '                               11310387
113104                      WS-KRPRPM-INTFC-SYS-CDE ' '                 11310498
113105                      WS-KRPRPM-SYS-PRC-FUNC-CDE                  11310598
113200              MOVE '7000-INSERT-TKRPRPM'                          11320068
113300                                 TO PV-ABEND-PARAGRAPH            11330022
113400              MOVE 'INSERT'      TO PV-DB2-OPERATION-ATTEMPTED    11340068
113500              PERFORM 9200-SQL-ABEND                              11350004
113600     END-EVALUATE.                                                11360004
143400*                                                                 14340004
143500 8000-COMMIT.                                                     14350098
143510     EXEC SQL                                                     14351098
143520          COMMIT                                                  14352098
143530     END-EXEC                                                     14353098
143540     IF SQLCODE = ZERO                                            14354099
143551         MOVE WS-KRPRPM-LOC-ID     TO PV-LOC-ID                   14355198
143552         DISPLAY '*** COMMIT TAKEN AT: '                          14355299
143553                  PV-LOC-ID ' '                                   14355398
143554                  WS-KRPRPM-INTFC-SYS-CDE ' '                     14355498
143555                  WS-KRPRPM-SYS-PRC-FUNC-CDE                      14355598
143560     ELSE                                                         14356098
143600         MOVE WS-KRPRPM-LOC-ID                                    14360098
143700                           TO PV-LOC-ID                           14370098
143800         DISPLAY PV-LOC-ID ' '                                    14380098
143900                 WS-KRPRPM-INTFC-SYS-CDE ' '                      14390098
144000                 WS-KRPRPM-SYS-PRC-FUNC-CDE                       14400098
144100         PERFORM 9000-DISPLAY-COUNTS                              14410098
144300         MOVE '8000-COMMIT' TO PV-ABEND-PARAGRAPH                 14430099
144500         MOVE 'COMMIT'      TO PV-DB2-OPERATION-ATTEMPTED         14450098
144600         PERFORM 9200-SQL-ABEND                                   14460098
144610     END-IF.                                                      14461099
144700******************************************************************14470004
144800 9000-DISPLAY-COUNTS.                                             14480033
145100                                                                  14510004
145200     DISPLAY '********************************************'.      14520099
145300     DISPLAY '*                                          *'.      14530099
145310     MOVE PV-INPUT-CNT       TO PV-DISPLAY-CNT.                   14531099
145400     DISPLAY 'INTPUT FILE COUNT----: ' PV-DISPLAY-CNT.            14540071
145500     MOVE PV-TKRPRPM-CNT     TO PV-DISPLAY-CNT.                   14550099
145501     DISPLAY 'TKRPRPM INSERTED ----: ' PV-DISPLAY-CNT.            14550171
145502     DISPLAY '*                                          *'.      14550299
145510     DISPLAY '********************************************'.      14551037
146600*                                                                 14660004
146700*                                                                 14670004
146800******************************************************************14680004
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    14690004
147000*  ERROR OR WARNING CODE OCCURS.                                  14700004
147100******************************************************************14710004
147200 9200-SQL-ABEND.                                                  14720004
147300     DISPLAY '9200-SQL-ABEND'.                                    14730004
147400     DISPLAY '** ABEND     **'.                                   14740004
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14750004
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             14760004
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14770004
147800*                                                                 14780004
147900*                                                                 14790004
148000******************************************************************14800004
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14810004
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14820004
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14830004
148400* FORMAT.                                                         14840004
148500******************************************************************14850004
148600     COPY DPPD004.                                                14860004
148700                                                                  14870004
148800     IF  SQLCODE NOT = -911                                       14880004
148900         EXEC SQL                                                 14890004
149000              COMMIT                                              14900004
149100         END-EXEC                                                 14910004
149200     END-IF.                                                      14920004
149300                                                                  14930004
149400     MOVE +4013                  TO PV-ABEND-CODE.                14940004
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14950004
