00001 *-----------------------*                                         05/02/95
00002  IDENTIFICATION DIVISION.                                         DPKCS036
00003 *-----------------------*                                            LV002
00004  PROGRAM-ID.    VLKCS521.                                         DPKCS036
00005  AUTHOR.        MIKE WALTERS.                                     DPKCS036
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                          DPKCS036
00007  DATE-WRITTEN.  12-16-96.                                         DPKCS036
00008  DATE-COMPILED.                                                   DPKCS036
00009                                                                   DPKCS036
00010 *---------------------------------------------------------------* DPKCS036
00011 *    V521 - TICKET OFFICE LIST PROGRAM.                         * DPKCS036
00012 *                                                               * DPKCS036
00013 *    THIS PROGRAM GENERATES A LIST OF THE AVAILABLE TICKET      * DPKCS036
 0014 *    OFFICES.  THE USER CAN SELECT 1 OR MORE OFFICES, AND UPDATE* DPKCS036
00015 *    OR DELETE THEM...NO SELECTION IS NECESSARY TO ADD A NEW   *  DPKCS036
00016 *    TICKET OFFICE.                                             * DPKCS036
00019 *                                                               * DPKCS036
00020 *---------------------------------------------------------------* DPKCS036
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
00021  EJECT                                                            DPKCS036
00022  ENVIRONMENT DIVISION.                                            DPKCS036
00023                                                                   DPKCS036
00024  DATA DIVISION.                                                   DPKCS036
00025                                                                   DPKCS036
00026  WORKING-STORAGE SECTION.                                         DPKCS036
00027                                                                   DPKCS036
00038  01  PC-PROGRAM-CONSTANTS.                                        DPKCS036
00039      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         DPKCS036
00040                                                     'VL521A  '.   DPKCS036
00041      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         DPKCS036
00042                                                     'VLKM521 '.   DPKCS036
00043      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         DPKCS036
00044                                                     'VLKCS521'.   DPKCS036
00045      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      DPKCS036
00046      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      DPKCS036
00047      05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    DPKCS036
00048      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     DPKCS036
00049                                                     COMP SYNC.    DPKCS036
00050      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      DPKCS036
00051                                                     COMP SYNC.    DPKCS036
00052      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         DPKCS036
00053                                                     +1000000      DPKCS036
00054                                                     COMP-3.       DPKCS036
00055      05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      DPKCS036
00056                                                     COMP SYNC.    DPKCS036
00057      05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       DPKCS036
00058                                                     COMP-3.       DPKCS036
00059      05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    DPKCS036
00060      05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  DPKCS036
00061      05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  DPKCS036
00062      05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  DPKCS036
00063      05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  DPKCS036
00064 *                                                                 DPKCS036
00065      05  PC-TSYMSG-NUMBERS.                                       DPKCS036
00066          10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  DPKCS036
00067          10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  DPKCS036
00068          10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  DPKCS036
00069          10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  DPKCS036
00070          10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  DPKCS036
00071          10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  DPKCS036
00072          10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  DPKCS036
00073          10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  DPKCS036
00074          10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  DPKCS036
00075          10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  DPKCS036
00076          10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  DPKCS036
00077          10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  DPKCS036
00078          10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  DPKCS036
00079          10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  DPKCS036
00080 *                                                                 DPKCS036
00081  01  PS-PROGRAM-SWITCHES.                                         DPKCS036
00082      05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    DPKCS036
00083          88  PS-NO-ERROR                            VALUE 'Y'.    DPKCS036
00084          88  PS-ERROR                               VALUE 'N'.    DPKCS036
00085      05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    DPKCS036
00086          88  PS-COMMAREA-VALID                      VALUE 'Y'.    DPKCS036
00087          88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    DPKCS036
00088      05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    DPKCS036
00089          88  PS-DONE                                VALUE 'Y'.    DPKCS036
00090          88  PS-NOT-DONE                            VALUE 'N'.    DPKCS036
00091 *                                                                 DPKCS036
00092  01  PV-PROGRAM-VARIABLES.                                        DPKCS036
00093      05  PV-SUB                         PIC S9(04)  VALUE +0      DPKCS036
00094                                                     COMP SYNC.    DPKCS036
00095      05  PV-REMAINDER                   PIC S9(04)  VALUE +0      DPKCS036
00096                                                     COMP SYNC.    DPKCS036
00097      05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      DPKCS036
00098                                                     COMP-3.       DPKCS036
00099      05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      DPKCS036
00100                                                     COMP-3.       DPKCS036
00101      05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      DPKCS036
00102                                                     COMP-3.       DPKCS036
00103      05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      DPKCS036
00104                                                     COMP-3.       DPKCS036
00105      05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      DPKCS036
00106                                                     COMP-3.       DPKCS036
00107      05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      DPKCS036
00108                                                     COMP-3.       DPKCS036
00109      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      DPKCS036
00110                                                     COMP-3.       DPKCS036
00111      05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      DPKCS036
00112                                                     COMP SYNC.    DPKCS036
00113      05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      DPKCS036
00114                                                     COMP SYNC.    DPKCS036
00115      05  PV-ITEM                        PIC S9(04)  VALUE +0      DPKCS036
00116                                                     COMP SYNC.    DPKCS036
00117      05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      DPKCS036
00118                                                     COMP SYNC.    DPKCS036
00119      05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      DPKCS036
00120                                                     COMP SYNC.    DPKCS036
00121      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      DPKCS036
00122                                                     COMP SYNC.    DPKCS036
00123      05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      DPKCS036
00124                                                     COMP SYNC.    DPKCS036
00125      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      DPKCS036
00126                                                     COMP SYNC.    DPKCS036
00127      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
00128                                                     COMP SYNC.    DPKCS036
00129      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
00130                                                     COMP SYNC.    DPKCS036
00131      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      DPKCS036
00132                                                     COMP SYNC.    DPKCS036
00133      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      DPKCS036
00134                                                     COMP SYNC.    DPKCS036
00135      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      DPKCS036
00136                                                     COMP SYNC.    DPKCS036
00137      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      DPKCS036
00138                                                     COMP SYNC.    DPKCS036
00139      05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      DPKCS036
00140                                                     COMP SYNC.    DPKCS036
00141      05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      DPKCS036
00142                                                     COMP SYNC.    DPKCS036
00143 ******************************************************************DPKCS036
00144 **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **DPKCS036
00145 **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **DPKCS036
00146 **  APPLICATION-SPECIFIC COMMAREA.                              **DPKCS036
00147 ******************************************************************DPKCS036
00148  01  LQW-LIST-QUEUE-WORK-AREA.                                    DPKCS036
00149      05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  DPKCS036
00150      05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           DPKCS036
00151                                         INDEXED BY LQW-IDX.       DPKCS036
00152          10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       DPKCS036
00153          10  LQW-TEMP-SELECTED-SW       PIC  X(01).               DPKCS036
00154          10  LQW-SELECTED-SW            PIC  X(01).               DPKCS036
00155              88  LQW-SELECT                         VALUE 'S'.    DPKCS036
00156              88  LQW-DESELECT                       VALUE ' '.    DPKCS036
00157          10  LQW-ACTION                 PIC  X(03).               DPKCS036
00296          10  LQW-TKT-OFF-ID             PIC  X(06).                     36
00294          10  LQW-OPER-UNT-ID            PIC  9(04).                     36
00294          10  LQW-FACILITY-ID            PIC  9(04).                     36
00296          10  LQW-TKT-OFF-ADR-ID         PIC  X(08).                     36
00162                                                                   DPKCS036
00163      EJECT                                                        DPKCS036
00164 *---------------------------------------------------------------* DPKCS036
00165 *  RECORD LAYOUT FOR THE TICKET FORMAT SELECTION TEMP STORAGE   * DPKCS036
00166 *---------------------------------------------------------------* DPKCS036
00167                                                                   DPKCS036
00168      COPY VLWS014.                                                DPKCS036
00169                                                                   DPKCS036
00170      EJECT                                                        DPKCS036
00171 *---------------------------------------------------------------* DPKCS036
00172 *    MAP LAYOUT                                                 * DPKCS036
00173 *---------------------------------------------------------------* DPKCS036
00174                                                                   DPKCS036
00175      COPY VLKM521.                                                DPKCS036
00176 *                                                                 DPKCS036
00177  01  MR-OCCURS-LAYOUT                   REDEFINES  VL521AO.       DPKCS036
00178      05  FILLER                         PIC X(42).                DPKCS036
00179      05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          DPKCS036
00180          10  MR-SELECTL                 PIC S9(04) COMP.          DPKCS036
00181          10  MR-SELECTA                 PIC  X(01).               DPKCS036
00182          10  MR-SELECTC                 PIC  X(01).               DPKCS036
00183          10  MR-SELECTH                 PIC  X(01).               DPKCS036
00184          10  MR-SELECTI                 PIC  X(01).               DPKCS036
00185                                                                   DPKCS036
00186          10  MR-ACTIONL                 PIC S9(04) COMP.          DPKCS036
00187          10  MR-ACTIONA                 PIC  X(01).               DPKCS036
00188          10  MR-ACTIONC                 PIC  X(01).               DPKCS036
00189          10  MR-ACTIONH                 PIC  X(01).               DPKCS036
00190          10  MR-ACTION                  PIC  X(03).               DPKCS036
00191                                                                   DPKCS036
00192          10  MR-TKT-OFF-IDL             PIC S9(04) COMP.          DPKCS036
00193          10  MR-TKT-OFF-IDA             PIC  X(01).               DPKCS036
00194          10  MR-TKT-OFF-IDC             PIC  X(01).               DPKCS036
00195          10  MR-TKT-OFF-IDH             PIC  X(01).               DPKCS036
00196          10  MR-TKT-OFF-ID              PIC  X(06).               DPKCS036
00198                                                                   DPKCS036
00199          10  MR-OPER-UNT-IDL            PIC S9(04) COMP.          DPKCS036
00200          10  MR-OPER-UNT-IDA            PIC  X(01).               DPKCS036
00201          10  MR-OPER-UNT-IDC            PIC  X(01).               DPKCS036
00202          10  MR-OPER-UNT-IDH            PIC  X(01).               DPKCS036
00203          10  MR-OPER-UNT-ID             PIC  X(04).               DPKCS036
00204                                                                   DPKCS036
00199          10  MR-SLASHL                  PIC S9(04) COMP.          DPKCS036
00200          10  MR-SLASHA                  PIC  X(01).               DPKCS036
00201          10  MR-SLASHC                  PIC  X(01).               DPKCS036
00202          10  MR-SLASHH                  PIC  X(01).               DPKCS036
00203          10  MR-SLASH                   PIC  X(01).               DPKCS036
00204                                                                   DPKCS036
00199          10  MR-FACILITY-IDL            PIC S9(04) COMP.          DPKCS036
00200          10  MR-FACILITY-IDA            PIC  X(01).               DPKCS036
00201          10  MR-FACILITY-IDC            PIC  X(01).               DPKCS036
00202          10  MR-FACILITY-IDH            PIC  X(01).               DPKCS036
00203          10  MR-FACILITY-ID             PIC  X(04).               DPKCS036
00204                                                                   DPKCS036
00199          10  MR-TKT-OFF-ADR-IDL         PIC S9(04) COMP.          DPKCS036
00200          10  MR-TKT-OFF-ADR-IDA         PIC  X(01).               DPKCS036
00201          10  MR-TKT-OFF-ADR-IDC         PIC  X(01).               DPKCS036
00202          10  MR-TKT-OFF-ADR-IDH         PIC  X(01).               DPKCS036
00203          10  MR-TKT-OFF-ADR-ID          PIC  X(08).               DPKCS036
00204                                                                   DPKCS036
00216      EJECT                                                        DPKCS036
00217 *---------------------------------------------------------------* DPKCS036
00218 *    ATTRIBUTE SETTINGS COPYBOOK.                               * DPKCS036
00219 *---------------------------------------------------------------* DPKCS036
00220                                                                   DPKCS036
00221      COPY DPWS015.                                                DPKCS036
00222                                                                   DPKCS036
00223 *---------------------------------------------------------------* DPKCS036
00224 *    FUNCTION KEYS COPYBOOK.                                    * DPKCS036
00225 *---------------------------------------------------------------* DPKCS036
00226                                                                   DPKCS036
00227      COPY DPWS016.                                                DPKCS036
00228                                                                   DPKCS036
00229 *---------------------------------------------------------------* DPKCS036
00230 *    NUMERIC EDIT LAYOUT.                                       * DPKCS036
00231 *---------------------------------------------------------------* DPKCS036
00232                                                                   DPKCS036
00233      COPY DPWS010I.                                               DPKCS036
00234  EJECT                                                            DPKCS036
00235 *---------------------------------------------------------------* DPKCS036
00236 *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * DPKCS036
00237 *---------------------------------------------------------------* DPKCS036
00238                                                                   DPKCS036
00239      COPY DPWS030.                                                DPKCS036
CICS       COPY DPWS930.                                                DPKCS036
00240  EJECT                                                            DPKCS036
00241 *---------------------------------------------------------------* DPKCS036
00242 *    STANDARD COMMAREA.                                         * DPKCS036
00243 *---------------------------------------------------------------* DPKCS036
00244                                                                   DPKCS036
00245      COPY DPWS020.                                                DPKCS036
00246      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                DPKCS036
00247                                                                   DPKCS036
00248 *---------------------------------------------------------------* DPKCS036
00249 * INTER-APPLICATION COMMAREA.                                   * DPKCS036
00252 *   VLWS013 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * DPKCS036
00253 *             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * DPKCS036
00254 *---------------------------------------------------------------* DPKCS036
00255                                                                   DPKCS036
00256          10  INTER-APPL-COMM-AREA       PIC X(200).               DPKCS036
00257      COPY VLWS013.                                                DPKCS036
00259 *---------------------------------------------------------------* DPKCS036
00260 *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * DPKCS036
00261 *---------------------------------------------------------------* DPKCS036
00262          10  ASC-SPECIFIC-COMMAREA.                               DPKCS036
00269              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                DPKCS036
00270                  20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  DPKCS036
00271                      88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   DPKCS036
00272                      88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   DPKCS036
00273                                                                   DPKCS036
00274                  20  ASC-ITEM-ARRAY.                              DPKCS036
00275                      25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        DPKCS036
00276                          30  ASC-LIST-ITEM-NUMBER                 DPKCS036
00277                                                      PIC S9(09)   DPKCS036
00278                                                      COMP-3.      DPKCS036
00279                          30  ASC-TEMP-SELECTED-SW    PIC  X(01).  DPKCS036
00280                              88  ASC-VALID-SELECT    VALUE ' '    DPKCS036
00281                                                            'S'    DPKCS036
00282                                                            'B'    DPKCS036
00283                                                            'E'.   DPKCS036
00284                              88  ASC-TEMP-NO-SELECT  VALUE ' '.   DPKCS036
00285                              88  ASC-TEMP-SELECT     VALUE 'S'.   DPKCS036
00286                              88  ASC-TEMP-BEGIN      VALUE 'B'.   DPKCS036
00287                              88  ASC-TEMP-END        VALUE 'E'.   DPKCS036
00288                          30  ASC-SELECTED-SW         PIC  X(01).  DPKCS036
00289                              88  ASC-NO-SELECT       VALUE ' '.   DPKCS036
00290                              88  ASC-SELECT          VALUE 'S'.   DPKCS036
00291                              88  ASC-BEGIN           VALUE 'B'.   DPKCS036
00292                              88  ASC-END             VALUE 'E'.   DPKCS036
00293                          30  ASC-ACTION              PIC  X(03).  DPKCS036
00294                          30  ASC-TKT-OFF-ID          PIC  X(06).  DPKCS036
00296                          30  ASC-OPER-UNT-ID         PIC  X(04).  DPKCS036
00296                          30  ASC-FACILITY-ID         PIC  X(04).  DPKCS036
00296                          30  ASC-TKT-OFF-ADR-ID      PIC  X(08).        36
00299                                                                   DPKCS036
00300              15  ASC-BLK-SUB                         PIC S9(04)   DPKCS036
00301                                                           COMP    DPKCS036
00302                                                           SYNC.   DPKCS036
00303              15  ASC-ITEM-SUB                        PIC S9(04)   DPKCS036
00304                                                           COMP    DPKCS036
00305                                                           SYNC.   DPKCS036
00306              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   DPKCS036
00307                                                           COMP-3. DPKCS036
00308              15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   DPKCS036
00309                                                           COMP-3. DPKCS036
00310              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   DPKCS036
00311                                                           COMP-3. DPKCS036
00312              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   DPKCS036
00313                                                           COMP-3. DPKCS036
00314              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   DPKCS036
00315                                                           COMP-3. DPKCS036
00316              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   DPKCS036
00317                                                           COMP    DPKCS036
00318                                                           SYNC.   DPKCS036
00319              15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   DPKCS036
00320                                                           COMP-3. DPKCS036
00321              15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   DPKCS036
00322                                                           COMP-3. DPKCS036
00323              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  DPKCS036
00324                  88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   DPKCS036
00325                  88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   DPKCS036
00326              15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  DPKCS036
00327                  88  ASC-UPDATE-TSQ                  VALUE 'Y'.   DPKCS036
00328                  88  ASC-NO-TSQ-UPDATE               VALUE ' '.   DPKCS036
00329              15  ASC-LIST-QUEUE-NAME.                             DPKCS036
00330                  20  ASC-LIST-TERM-ID                PIC  X(04).  DPKCS036
00331                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)   DPKCS036
00332                                                           COMP-3. DPKCS036
00333                  20  ASC-LIST-SEQ                    PIC  9(01).  DPKCS036
00334              15  ASC-SEL-QUEUE-NAME.                              DPKCS036
00335                  20  ASC-SEL-TERM-ID                 PIC  X(04).  DPKCS036
00336                  20  ASC-SEL-TASK-NUMBER             PIC S9(05)   DPKCS036
00337                                                           COMP-3. DPKCS036
00338                  20  ASC-SEL-SEQ                     PIC  9(01).  DPKCS036
00339                                                                   DPKCS036
00340              15  ASC-CURSOR-SW                       PIC  X(01).  DPKCS036
00341                  88  ASC-NO-CURSOR                   VALUE 'Z'.   DPKCS036
00342                  88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   DPKCS036
00343                  88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   DPKCS036
00344                  88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   DPKCS036
00345              15  ASC-START-ITEM-REQUEST.                          DPKCS036
00346                  20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  DPKCS036
00347      EJECT                                                        DPKCS036
00348 *---------------------------------------------------------------* DPKCS036
00349 *    ABEND PROCESSING COPYBOOK.                                 * DPKCS036
00350 *---------------------------------------------------------------* DPKCS036
00351                                                                   DPKCS036
00352      COPY DPWS013.                                                DPKCS036
00353                                                                   DPKCS036
00354  EJECT                                                            DPKCS036
00355 *---------------------------------------------------------------* DPKCS036
00356 *    DB2 AREA FOR THE TICKET FORMAT TABLE                       * DPKCS036
00357 *---------------------------------------------------------------* DPKCS036
00358      EXEC SQL                                                     DPKCS036
00359           INCLUDE TTKTFMT                                         DPKCS036
00360      END-EXEC.                                                    DPKCS036
00355 *---------------------------------------------------------------* DPKCS036
00356 *    DB2 AREA FOR THE PRINT STOCK TABLE                         * DPKCS036
00357 *---------------------------------------------------------------* DPKCS036
00358      EXEC SQL                                                     DPKCS036
00359           INCLUDE TPRTSTK                                         DPKCS036
00360      END-EXEC.                                                    DPKCS036
00355 *---------------------------------------------------------------* DPKCS036
00356 *    DB2 AREA FOR THE VSM DEFAULT CHARACTERISTIC TABLE          * DPKCS036
00357 *---------------------------------------------------------------* DPKCS036
00358      EXEC SQL                                                     DPKCS036
00359           INCLUDE TVSCHAR                                         DPKCS036
00360      END-EXEC.                                                    DPKCS036
00355 *---------------------------------------------------------------* DPKCS036
00356 *    DB2 AREA FOR THE VSM DEFAULT CHARACTERISTIC VALUE TABLE    * DPKCS036
00357 *---------------------------------------------------------------* DPKCS036
00358      EXEC SQL                                                     DPKCS036
00359           INCLUDE TVSCHVL                                         DPKCS036
00360      END-EXEC.                                                    DPKCS036
00361 *---------------------------------------------------------------* DPKCS036
00362 *    DB2 AREA FOR COMMUNICATIONS                                * DPKCS036
00363 *---------------------------------------------------------------* DPKCS036
00364      EXEC SQL                                                     DPKCS036
00365           INCLUDE SQLCA                                           DPKCS036
00366      END-EXEC.                                                    DPKCS036
00367                                                                   DPKCS036
00368 *---------------------------------------------------------------* DPKCS036
00369 *    TMESSAGE CURSOR WHEN MESSAGE NUMBER IS REQUESTED           * DPKCS036
00370 *---------------------------------------------------------------* DPKCS036
00371                                                                   DPKCS036
00372      EXEC SQL                                                     DPKCS036
00373           DECLARE TKT_OFF_CURSOR CURSOR                           DPKCS036
00374           FOR SELECT                                              DPKCS036
                             A.TKT_OFF_ID                                       
                           , A.OPER_UNT_ID                                      
                           , A.FCLTY_ID                                         
                           , A.TKT_OFF_ADR_ID                                   
                    FROM                                                        
                            TTKTFMT A                                           
                    GROUP BY                                                    
                             A.TKT_OFF_ID                                       
                           , A.OPER_UNT_ID                                      
                           , A.FCLTY_ID                                         
                           , A.TKT_OFF_ADR_ID                                   
                    ORDER BY                                                    
                             A.TKT_OFF_ID                                       
                           , A.OPER_UNT_ID                                      
                           , A.FCLTY_ID                                         
                           , A.TKT_OFF_ADR_ID                                   
                                                                                
00385      END-EXEC.                                                    DPKCS036
00386                                                                   DPKCS036
00432  EJECT                                                            DPKCS036
00433  LINKAGE SECTION.                                                 DPKCS036
00434                                                                   DPKCS036
00435  01  DFHCOMMAREA.                                                 DPKCS036
00436      05  FILLER                         OCCURS  1 TO 4072 TIMES   DPKCS036
00437                                         DEPENDING ON EIBCALEN.    DPKCS036
00438          10  FILLER                     PIC X.                    DPKCS036
00439                                                                   DPKCS036
00440  EJECT                                                            DPKCS036
00441  PROCEDURE DIVISION.                                              DPKCS036
00442 ******************************************************************DPKCS036
00443 **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **DPKCS036
00444 **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **DPKCS036
00445 **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **DPKCS036
00446 ******************************************************************DPKCS036
00447  0000-MAIN-MODULE.                                                DPKCS036
00448      INITIALIZE DP030-CICS-API-FIELDS.                            DPKCS036
00449      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       DPKCS036
00450      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          DPKCS036
00451      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         DPKCS036
00452      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       DPKCS036
00453      MOVE LENGTH OF VL521AI        TO DP030-MAP-LENGTH (1).       DPKCS036
00454      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     DPKCS036
00455      PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
00456 *                                                                 DPKCS036
00457      PERFORM 1000-CONTROL-PROCESSING                              DPKCS036
00458 *                                                                 DPKCS036
00459      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     DPKCS036
00460      PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
00461                                                                   DPKCS036
00462 ******************************************************************DPKCS036
00463 **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **DPKCS036
00464 **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **DPKCS036
00465 ******************************************************************DPKCS036
00466  0001-CALL-CICS-ARCH-API.                                         DPKCS036
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
00468                                     DFHCOMMAREA                           
00469                                     DP030-CICS-API-FIELDS                 
00470                                     DP020-STANDARD-COMMAREA               
00471                                     VL521AI.                              
00472 *                                                                 DPKCS036
00473      IF  DP030-RC-CALL-SUCCESSFUL                                 DPKCS036
00474          CONTINUE                                                 DPKCS036
00475      ELSE                                                         DPKCS036
00476          SET DP013-NO-ROLLBACK                                    DPKCS036
00477              DP013-XCTL-DISPLAY-RESTART                           DPKCS036
00478              DP013-CICS-ABEND      TO TRUE                        DPKCS036
00479          MOVE '0001-CALL-CICS-ARCH-API'                           DPKCS036
00480                                    TO DP013-PARAGRAPH             DPKCS036
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
00483          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      DPKCS036
00484          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
00485      END-IF.                                                      DPKCS036
00486 *----------------------------------------------------------------*DPKCS036
00487 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *DPKCS036
00488 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *DPKCS036
00489 *                                                                *DPKCS036
00490 * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *DPKCS036
00491 *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *DPKCS036
00492 *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *DPKCS036
00493 *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *DPKCS036
00494 *----------------------------------------------------------------*DPKCS036
00495                                                                   DPKCS036
00496  1000-CONTROL-PROCESSING.                                         DPKCS036
00497                                                                   DPKCS036
00498      EVALUATE TRUE                                                DPKCS036
00499          WHEN DP020-NEXT-ACT-INITIAL                              DPKCS036
00500              INITIALIZE ASC-SPECIFIC-COMMAREA                     DPKCS036
00501              MOVE EIBTRMID         TO ASC-LIST-TERM-ID            DPKCS036
00502                                       ASC-SEL-TERM-ID             DPKCS036
00503              MOVE DP020-SRC-TASK-NUMBER                           DPKCS036
00504                                    TO ASC-LIST-TASK-NUMBER        DPKCS036
00505                                       ASC-SEL-TASK-NUMBER         DPKCS036
00506              MOVE PC-LIST-QUEUE-SEQ                               DPKCS036
00507                                    TO ASC-LIST-SEQ                DPKCS036
00508              MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 DPKCS036
00509              PERFORM 1100-PROCESS-INTER-APPL-COMM                 DPKCS036
00510 ***-----$TEMPLATE NOTE$-------------------------------------------DPKCS036
00511 *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,DPKCS036
00512 *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  DPKCS036
00513 *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.DPKCS036
00514 ***---------------------------------------------------------------DPKCS036
00515              IF  PS-COMMAREA-NOT-VALID                            DPKCS036
00516 ***              MOVE PC-TSYMSG-99901                             DPKCS036
00517 ***                                TO DP020-MSG-NUMBER            DPKCS036
00518 ***              SET DP020-MSG-FATAL                              DPKCS036
00519 ***                                TO TRUE                        DPKCS036
00520                  SET DP020-NEXT-ACT-APPL-ERROR                    DPKCS036
00521                                    TO TRUE                        DPKCS036
00522              ELSE                                                 DPKCS036
00523                  PERFORM 4000-BUILD-INITIAL-PANEL                 DPKCS036
00524              END-IF                                               DPKCS036
00525                                                                   DPKCS036
00526          WHEN DP020-NEXT-ACT-READ-MAP                             DPKCS036
00527              MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
00528                                    TO PV-TOP-ITEM                 DPKCS036
00529              PERFORM 2000-PROCESS-PANEL                           DPKCS036
00530                                                                   DPKCS036
00531          WHEN DP020-NEXT-ACT-RETURN                               DPKCS036
00532              MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
00533                                    TO PV-TOP-ITEM                 DPKCS036
00534              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
00535              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 DPKCS036
00536              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
00537              PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
00538                                                                   DPKCS036
00539          WHEN OTHER                                               DPKCS036
00540              SET DP013-LOGIC-ABEND TO TRUE                        DPKCS036
00541              SET DP013-NO-ROLLBACK TO TRUE                        DPKCS036
00542              MOVE '1000-CONTROL-PROCESSING'                       DPKCS036
00543                                    TO DP013-PARAGRAPH             DPKCS036
00544              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    DPKCS036
00545                                    TO DP013-MESSAGE-TEXT(1)       DPKCS036
00546              PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
00547      END-EVALUATE.                                                DPKCS036
00548                                                                   DPKCS036
00549  EJECT                                                            DPKCS036
00550 *----------------------------------------------------------------*DPKCS036
00551 * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *DPKCS036
00552 * IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *DPKCS036
00553 *----------------------------------------------------------------*DPKCS036
00554                                                                   DPKCS036
00555  1100-PROCESS-INTER-APPL-COMM.                                    DPKCS036
00556                                                                   DPKCS036
00557      SET PS-COMMAREA-VALID         TO TRUE.                       DPKCS036
00558      MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     DPKCS036
00577                                                                   DPKCS036
00578  EJECT                                                            DPKCS036
00579 *----------------------------------------------------------------*DPKCS036
00580 * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *DPKCS036
00581 * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *DPKCS036
00582 * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *DPKCS036
00583 * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *DPKCS036
00584 * FUNCTION KEYS CAN GET THIS FAR.                                *DPKCS036
00585 *----------------------------------------------------------------*DPKCS036
00586                                                                   DPKCS036
00587  2000-PROCESS-PANEL.                                              DPKCS036
00588      EVALUATE TRUE                                                DPKCS036
00589          WHEN DP020-SRC-AID = DP016-CLEAR                         DPKCS036
00590              MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
00591              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
00592              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
00593                                                                   DPKCS036
00594          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    DPKCS036
00603              PERFORM 2050-DELETE-LIST-QUEUE                       DPKCS036
00604              PERFORM 4000-BUILD-INITIAL-PANEL                     DPKCS036
00605                                                                   DPKCS036
00606          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    DPKCS036
00607              PERFORM 2140-DESELECT-ALL-ITEMS                      DPKCS036
00608              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
00609                                                                   DPKCS036
00610          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  DPKCS036
00611              PERFORM 2150-SELECT-ALL-ITEMS                        DPKCS036
00612              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
00613                                                                   DPKCS036
00614          WHEN OTHER                                               DPKCS036
00615              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 DPKCS036
00616              PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
00617              IF  PS-NO-ERROR                                      DPKCS036
00618                  SET DP030-CONTINUE-GO                            DPKCS036
00619                                  TO TRUE                          DPKCS036
00620                  PERFORM 2100-CHECK-FUNCTION-KEY                  DPKCS036
00621              ELSE                                                 DPKCS036
00622                  SET DP030-OVERRIDE-GO                            DPKCS036
00623                                  TO TRUE                          DPKCS036
00624              END-IF                                               DPKCS036
00625      END-EVALUATE.                                                DPKCS036
00626  EJECT                                                            DPKCS036
00627 *----------------------------------------------------------------*DPKCS036
00628 *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *DPKCS036
00629 *----------------------------------------------------------------*DPKCS036
00630  2050-DELETE-LIST-QUEUE.                                          DPKCS036
00631                                                                   DPKCS036
00632      EXEC CICS                                                    DPKCS036
00633          DELETEQ TS                                               DPKCS036
00634              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
00635              RESP  (PV-CICS-RESP)                                 DPKCS036
00636      END-EXEC.                                                    DPKCS036
00637                                                                   DPKCS036
00638      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       DPKCS036
00639         (PV-CICS-RESP = DFHRESP(QIDERR))                          DPKCS036
00640          CONTINUE                                                 DPKCS036
00641      ELSE                                                         DPKCS036
00642          SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
00643          SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
00644                                                                   DPKCS036
00645          MOVE '2050-DELETE-LIST-QUEUE'                            DPKCS036
00646                                    TO DP013-PARAGRAPH             DPKCS036
00647          MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    DPKCS036
00648                                    TO DP013-MESSAGE-TEXT (1)      DPKCS036
00649          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
00650      END-IF.                                                      DPKCS036
00651                                                                   DPKCS036
00652      MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  DPKCS036
00653  EJECT                                                            DPKCS036
00654 *----------------------------------------------------------------*DPKCS036
00655 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*DPKCS036
00656 * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *DPKCS036
00657 * CICS ARCHITECTURE API.                                         *DPKCS036
00658 *----------------------------------------------------------------*DPKCS036
00659  2100-CHECK-FUNCTION-KEY.                                         DPKCS036
00660      EVALUATE TRUE                                                DPKCS036
      *    WHEN ADD IS PRESSED                                                  
00661          WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              DPKCS036
00663              INITIALIZE VL013-INTER-APPL-COMMAREA                 DPKCS036
00664              MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    DPKCS036
00665                             TO VL013-NUMBER-OF-SELECTED-ITEMS     DPKCS036
00666              PERFORM 5000-PREPARE-SEL-QUEUE                       DPKCS036
00675                                                                   DPKCS036
      *    WHEN UPDATE (02) OR DELETE (03) IS PRESSED                           
00661          WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              DPKCS036
00661          WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              DPKCS036
00662              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              DPKCS036
00663                  INITIALIZE VL013-INTER-APPL-COMMAREA             DPKCS036
00664                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS                DPKCS036
00665                                 TO VL013-NUMBER-OF-SELECTED-ITEMS DPKCS036
00666                  PERFORM 5000-PREPARE-SEL-QUEUE                   DPKCS036
00667              ELSE                                                 DPKCS036
00668                  SET DP030-OVERRIDE-GO                            DPKCS036
00669                                    TO TRUE                        DPKCS036
00670                  MOVE PC-TSYMSG-00057                             DPKCS036
00671                                    TO DP020-MSG-NUMBER            DPKCS036
00672                  SET DP020-MSG-WARNING                            DPKCS036
00673                                    TO TRUE                        DPKCS036
00674              END-IF                                               DPKCS036
                                                                                
00676          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  DPKCS036
00677              MOVE +1               TO PV-TOP-ITEM                 DPKCS036
00678              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
00679                                                                   DPKCS036
00680          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   DPKCS036
00681              PERFORM 2110-BROWSE-BACKWARD                         DPKCS036
00682              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
00683                                                                   DPKCS036
00684          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   DPKCS036
00685              PERFORM 2120-BROWSE-FORWARD                          DPKCS036
00686              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
00687                                                                   DPKCS036
00688          WHEN DP020-SRC-AID = DP016-ENTER                         DPKCS036
00689              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   DPKCS036
00690              IF  PS-ERROR                                         DPKCS036
00691                  CONTINUE                                         DPKCS036
00692              ELSE                                                 DPKCS036
00693                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             DPKCS036
00694              END-IF                                               DPKCS036
00695                                                                   DPKCS036
00696          WHEN OTHER                                               DPKCS036
00697              SET DP013-NO-ROLLBACK                                DPKCS036
00698                  DP013-XCTL-DISPLAY-RESTART                       DPKCS036
00699                  DP013-CICS-ABEND  TO TRUE                        DPKCS036
00700              MOVE '2100-CHECK-FUNCTION-KEY'                       DPKCS036
00701                                    TO DP013-PARAGRAPH             DPKCS036
00702              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      DPKCS036
00703                                    TO DP013-MESSAGE-TEXT (1)      DPKCS036
00704              PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
00705      END-EVALUATE.                                                DPKCS036
00706 *                                                                 DPKCS036
00707 *----------------------------------------------------------------*DPKCS036
00708 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *DPKCS036
00709 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *DPKCS036
00710 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *DPKCS036
00711 *    MESSAGE.                                                    *DPKCS036
00712 *----------------------------------------------------------------*DPKCS036
00713                                                                   DPKCS036
00714  2110-BROWSE-BACKWARD.                                            DPKCS036
00715      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
00716          GIVING PV-TOP-ITEM.                                      DPKCS036
00717 *                                                                 DPKCS036
00718      IF  ((PV-TOP-ITEM < +1)                                      DPKCS036
00719        OR (PV-TOP-ITEM = +1))                                     DPKCS036
00720          MOVE +1                   TO PV-TOP-ITEM                 DPKCS036
00721 *        -- TOP OF LIST --                                        DPKCS036
00722          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            DPKCS036
00723          SET DP020-MSG-INFORMATIONAL TO TRUE                      DPKCS036
00724      END-IF.                                                      DPKCS036
00725                                                                   DPKCS036
00726  EJECT                                                            DPKCS036
00727 *----------------------------------------------------------------*DPKCS036
00728 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *DPKCS036
00729 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *DPKCS036
00730 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *DPKCS036
00731 *----------------------------------------------------------------*DPKCS036
00732                                                                   DPKCS036
00733  2120-BROWSE-FORWARD.                                             DPKCS036
00734                                                                   DPKCS036
00735      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              DPKCS036
00736          GIVING PV-TOP-ITEM.                                      DPKCS036
00737      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   DPKCS036
00738          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
00739                                    TO PV-TOP-ITEM                 DPKCS036
00740 *        -- BOTTOM OF LIST --                                     DPKCS036
00741          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            DPKCS036
00742          SET DP020-MSG-INFORMATIONAL                              DPKCS036
00743                                    TO TRUE                        DPKCS036
00744      ELSE                                                         DPKCS036
00745          COMPUTE PV-BOTTOM-ITEM =                                 DPKCS036
00746              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 DPKCS036
00747          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            DPKCS036
00748 *            -- BOTTOM OF LIST --                                 DPKCS036
00749              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            DPKCS036
00750              SET DP020-MSG-INFORMATIONAL                          DPKCS036
00751                                    TO TRUE                        DPKCS036
00752          END-IF                                                   DPKCS036
00753      END-IF.                                                      DPKCS036
00754  EJECT                                                            DPKCS036
00755 *----------------------------------------------------------------*DPKCS036
00756 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *DPKCS036
00757 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *DPKCS036
00758 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *DPKCS036
00759 *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *DPKCS036
00760 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *DPKCS036
00761 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *DPKCS036
00762 *----------------------------------------------------------------*DPKCS036
00763                                                                   DPKCS036
00764  2130-CHECK-FOR-JUMP-BROWSE.                                      DPKCS036
00765      SET PS-NO-ERROR               TO TRUE.                       DPKCS036
00766      IF (ASC-START-ITEM-REQUEST = SPACE)                          DPKCS036
00767          MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
00768                                    TO PV-TOP-ITEM                 DPKCS036
00769      ELSE                                                         DPKCS036
00770          MOVE ASC-START-ITEM-REQUEST                              DPKCS036
00771                                    TO DP010I-UNEDITED-FIELD       DPKCS036
00772          MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       DPKCS036
00773          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     DPKCS036
00774          SET DP010I-NEGATIVE-NOT-ALLOWED                          DPKCS036
00775                                    TO TRUE                        DPKCS036
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
00777                                                                   DPKCS036
00778          IF  NOT DP010I-ERROR-DETECTED                            DPKCS036
00779              MOVE DP010I-NUMERIC-FIELD                            DPKCS036
00780                                    TO  ASC-START-ITEM-REQUEST-N   DPKCS036
00781              IF  ASC-START-ITEM-REQUEST-N > ZERO                  DPKCS036
00782                  IF  ASC-START-ITEM-REQUEST-N >                   DPKCS036
00783                                           ASC-NUMBER-OF-ITEMS-READDPKCS036
00784                      MOVE SPACE TO ASC-START-ITEM-REQUEST         DPKCS036
00785                      COMPUTE PV-TOP-ITEM =                        DPKCS036
00786                              ASC-NUMBER-OF-ITEMS-READ             DPKCS036
00787                              - PC-ITEMS-PER-PANEL + 1             DPKCS036
00788                      IF  PV-TOP-ITEM < +1                         DPKCS036
00789                          MOVE +1   TO PV-TOP-ITEM                 DPKCS036
00790                          MOVE PC-TSYMSG-00070                     DPKCS036
00791                                    TO DP020-MSG-NUMBER            DPKCS036
00792                          SET DP020-MSG-INFORMATIONAL              DPKCS036
00793                                    TO TRUE                        DPKCS036
00794                      END-IF                                       DPKCS036
00795                  ELSE                                             DPKCS036
00796                      MOVE ASC-START-ITEM-REQUEST-N                DPKCS036
00797                                    TO PV-TOP-ITEM                 DPKCS036
00798                      MOVE SPACE    TO ASC-START-ITEM-REQUEST      DPKCS036
00799                      COMPUTE PV-BOTTOM-ITEM =                     DPKCS036
00800                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     DPKCS036
00801                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READDPKCS036
00802 *                        -- BOTTOM OF LIST --                     DPKCS036
00803                          MOVE PC-TSYMSG-00070                     DPKCS036
00804                                    TO DP020-MSG-NUMBER            DPKCS036
00805                          SET DP020-MSG-INFORMATIONAL              DPKCS036
00806                                    TO TRUE                        DPKCS036
00807                      END-IF                                       DPKCS036
00808                  END-IF                                           DPKCS036
00809              ELSE                                                 DPKCS036
00810 *                --- VALUE OUT OF RANGE ----                      DPKCS036
00811                  MOVE PC-TSYMSG-00101                             DPKCS036
00812                                    TO DP020-MSG-NUMBER            DPKCS036
00813                  MOVE -1           TO ASTRTITL                    DPKCS036
00814                  SET DP030-SET-CURSOR-APPL-1                      DPKCS036
00815                                    TO TRUE                        DPKCS036
00816                  MOVE DP015-REVERSE                               DPKCS036
00817                                    TO ASTRTITH                    DPKCS036
00818                  MOVE DP015-RED    TO ASTRTITC                    DPKCS036
00819                  MOVE DP015-UNP-NUM-BRT-MDT                       DPKCS036
00820                                    TO ASTRTITA                    DPKCS036
00821                  SET DP020-MSG-FATAL                              DPKCS036
00822                                    TO TRUE                        DPKCS036
00823                  SET PS-ERROR      TO TRUE                        DPKCS036
00824              END-IF                                               DPKCS036
00825                                                                   DPKCS036
00826          ELSE                                                     DPKCS036
00827              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            DPKCS036
00828              MOVE -1               TO ASTRTITL                    DPKCS036
00829              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  DPKCS036
00830              MOVE DP015-REVERSE    TO ASTRTITH                    DPKCS036
00831              MOVE DP015-RED        TO ASTRTITC                    DPKCS036
00832              MOVE DP015-UNP-NUM-BRT-MDT                           DPKCS036
00833                                    TO ASTRTITA                    DPKCS036
00834              SET DP020-MSG-FATAL   TO TRUE                        DPKCS036
00835              SET PS-ERROR          TO TRUE                        DPKCS036
00836          END-IF                                                   DPKCS036
00837      END-IF.                                                      DPKCS036
00838  EJECT                                                            DPKCS036
00839 *----------------------------------------------------------------*DPKCS036
00840 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *DPKCS036
00841 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *DPKCS036
00842 *----------------------------------------------------------------*DPKCS036
00843  2140-DESELECT-ALL-ITEMS.                                         DPKCS036
00844      MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
00845                                                                   DPKCS036
00846      PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
00847          VARYING ASC-ITEM-SUB                                     DPKCS036
00848          FROM 1 BY 1                                              DPKCS036
00849          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
00850                                                                   DPKCS036
00851      ADD +1                        TO ASC-BLK-SUB.                DPKCS036
00852                                                                   DPKCS036
00853      PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
00854          VARYING ASC-ITEM-SUB                                     DPKCS036
00855          FROM 1 BY 1                                              DPKCS036
00856          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
00857                                                                   DPKCS036
00858      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
00859                                    TO PV-LIST-ITEM-NUMBER.        DPKCS036
00860                                                                   DPKCS036
00861      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
00862          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
00863                                                                   DPKCS036
00864      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
00865         (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      DPKCS036
00866          MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
00867                                                                   DPKCS036
00868          PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
00869                                                                   DPKCS036
00870          MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
00871                                                                   DPKCS036
00872          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
00873              PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
00874                                                                   DPKCS036
00875          PERFORM                                                  DPKCS036
00876              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
00877                                                                   DPKCS036
00878              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
00879                                                                   DPKCS036
00880              PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
00881                  VARYING ASC-ITEM-SUB FROM 1 BY 1                 DPKCS036
00882                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
00883                                                                   DPKCS036
00884              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
00885                                                                   DPKCS036
00886              ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
00887                                                                   DPKCS036
00888          END-PERFORM                                              DPKCS036
00889                                                                   DPKCS036
00890          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
00891              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
00892                                                                   DPKCS036
00893          PERFORM                                                  DPKCS036
00894              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
00895                    ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
00896                                                                   DPKCS036
00897              MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
00898                                    TO PV-BLOCK-NUMBER             DPKCS036
00899                                                                   DPKCS036
00900              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
00901                                                                   DPKCS036
00902              PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
00903                  VARYING ASC-ITEM-SUB                             DPKCS036
00904                  FROM 1 BY 1                                      DPKCS036
00905                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
00906                                                                   DPKCS036
00907              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
00908                                                                   DPKCS036
00909              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
00910                                                                   DPKCS036
00911          END-PERFORM                                              DPKCS036
00912                                                                   DPKCS036
00913          MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
00914                                    TO PV-BLOCK-NUMBER             DPKCS036
00915                                                                   DPKCS036
00916          PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
00917      END-IF.                                                      DPKCS036
00918                                                                   DPKCS036
00919                                                                   DPKCS036
00920      MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. DPKCS036
00921      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.DPKCS036
00922      MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  DPKCS036
00923                                                                   DPKCS036
00924      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
00925                                                                   DPKCS036
00926  EJECT                                                            DPKCS036
00927 *----------------------------------------------------------------*DPKCS036
00928 *    MARK EACH ITEM AS BEING NOT SELECTED.                       *DPKCS036
00929 *----------------------------------------------------------------*DPKCS036
00930                                                                   DPKCS036
00931  2141-CLEAR-SELECTED-INDS.                                        DPKCS036
00932                                                                   DPKCS036
00933      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
00934              NOT EQUAL ZERO                                       DPKCS036
00935          IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
00936              SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
00937                  ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    DPKCS036
00938                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
00939                                    TO TRUE                        DPKCS036
00940          END-IF                                                   DPKCS036
00941      END-IF.                                                      DPKCS036
00942                                                                   DPKCS036
00943  EJECT                                                            DPKCS036
00944 *----------------------------------------------------------------*DPKCS036
00945 *  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *DPKCS036
00946 *  FOR ALL ITEMS.                                                *DPKCS036
00947 *----------------------------------------------------------------*DPKCS036
00948                                                                   DPKCS036
00949  2150-SELECT-ALL-ITEMS.                                           DPKCS036
00950                                                                   DPKCS036
00951      MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
00952                                                                   DPKCS036
00953      PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
00954          VARYING ASC-ITEM-SUB                                     DPKCS036
00955          FROM 1 BY 1                                              DPKCS036
00956          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
00957                                                                   DPKCS036
00958      ADD +1                        TO ASC-BLK-SUB.                DPKCS036
00959                                                                   DPKCS036
00960      PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
00961          VARYING ASC-ITEM-SUB                                     DPKCS036
00962          FROM 1 BY 1                                              DPKCS036
00963          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
00964                                                                   DPKCS036
00965      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
00966                                    TO PV-LIST-ITEM-NUMBER.        DPKCS036
00967                                                                   DPKCS036
00968      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
00969          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
00970                                                                   DPKCS036
00971      IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
00972         (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    DPKCS036
00973          MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
00974                                                                   DPKCS036
00975          PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
00976                                                                   DPKCS036
00977          MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
00978                                                                   DPKCS036
00979          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
00980              PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
00981                                                                   DPKCS036
00982          PERFORM                                                  DPKCS036
00983              UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
00984                                                                   DPKCS036
00985              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
00986                                                                   DPKCS036
00987              PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
00988                  VARYING ASC-ITEM-SUB                             DPKCS036
00989                  FROM 1 BY 1                                      DPKCS036
00990                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
00991                                                                   DPKCS036
00992              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
00993                                                                   DPKCS036
00994              ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
00995                                                                   DPKCS036
00996          END-PERFORM                                              DPKCS036
00997                                                                   DPKCS036
00998          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
00999              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
01000                                                                   DPKCS036
01001          PERFORM                                                  DPKCS036
01002              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
01003                    ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
01004                                                                   DPKCS036
01005              MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
01006                                    TO PV-BLOCK-NUMBER             DPKCS036
01007                                                                   DPKCS036
01008              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
01009                                                                   DPKCS036
01010              PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
01011                  VARYING ASC-ITEM-SUB                             DPKCS036
01012                  FROM 1 BY 1                                      DPKCS036
01013                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
01014                                                                   DPKCS036
01015              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
01016                                                                   DPKCS036
01017              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
01018                                                                   DPKCS036
01019          END-PERFORM                                              DPKCS036
01020                                                                   DPKCS036
01021          MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
01022                                    TO PV-BLOCK-NUMBER             DPKCS036
01023                                                                   DPKCS036
01024          PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
01025      END-IF.                                                      DPKCS036
01026                                                                   DPKCS036
01027                                                                   DPKCS036
01028      MOVE ASC-NUMBER-OF-ITEMS-READ TO                             DPKCS036
01029                        ASC-NUMBER-OF-SELECTED-ITEMS.              DPKCS036
01030                                                                   DPKCS036
01031      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
01032                                                                   DPKCS036
01033  EJECT                                                            DPKCS036
01034 *----------------------------------------------------------------*DPKCS036
01035 *    MARK EACH ITEM AS BEING SELECTED.                           *DPKCS036
01036 *----------------------------------------------------------------*DPKCS036
01037                                                                   DPKCS036
01038  2151-SET-SELECTED-INDS.                                          DPKCS036
01039                                                                   DPKCS036
01040      IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
01041              NOT EQUAL ZERO                                       DPKCS036
01042          IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
01043              SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
01044                  ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
01045                  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
01046                                TO  TRUE                           DPKCS036
01047          END-IF                                                   DPKCS036
01048      END-IF.                                                      DPKCS036
01049 ******************************************************************DPKCS036
01050 ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **DPKCS036
01051 ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **DPKCS036
01052 ******************************************************************DPKCS036
01053  2200-MOVE-SCREEN-TO-COMMAREA.                                    DPKCS036
01054                                                                   DPKCS036
01055      MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             DPKCS036
01056      MOVE +1                       TO PV-SUB.                     DPKCS036
01057 *                                                                 DPKCS036
01058      PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
01059      IF  ASTRTITL > ZERO                                          DPKCS036
01060          MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          DPKCS036
01061      ELSE                                                         DPKCS036
01062          IF  ASTRTITF = DP015-ERASE-EOF                           DPKCS036
01063              INITIALIZE ASC-START-ITEM-REQUEST                    DPKCS036
01064          END-IF                                                   DPKCS036
01065      END-IF.                                                      DPKCS036
01066      PERFORM 2210-MOVE-LINES-TO-COMMAREA                          DPKCS036
01067          VARYING PV-SUB                                           DPKCS036
01068          FROM 1 BY 1                                              DPKCS036
01069          UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      DPKCS036
01070 ******************************************************************DPKCS036
01071 ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**DPKCS036
01072 ******************************************************************DPKCS036
01073  2210-MOVE-LINES-TO-COMMAREA.                                     DPKCS036
01074      IF  MR-SELECTL (PV-SUB) > ZERO                               DPKCS036
01075          SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             DPKCS036
01076          MOVE MR-SELECTI (PV-SUB)                                 DPKCS036
01077                                    TO ASC-TEMP-SELECTED-SW        DPKCS036
01078                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
01079      ELSE                                                         DPKCS036
01080          IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                DPKCS036
01081                  SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     DPKCS036
01082                  MOVE SPACE        TO ASC-TEMP-SELECTED-SW        DPKCS036
01083                                  (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
01084          END-IF                                                   DPKCS036
01085      END-IF.                                                      DPKCS036
01086      ADD +1                        TO ASC-ITEM-SUB.               DPKCS036
01087      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
01088          ADD +1                    TO ASC-BLK-SUB                 DPKCS036
01089          MOVE +1                   TO ASC-ITEM-SUB                DPKCS036
01090      END-IF.                                                      DPKCS036
01091 ******************************************************************DPKCS036
01092 ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **DPKCS036
01093 ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **DPKCS036
01094 ******************************************************************DPKCS036
01095  3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
01096      SET PS-NO-ERROR               TO TRUE.                       DPKCS036
01097      PERFORM 3200-RESET-ATTRIBUTES.                               DPKCS036
01098      MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     DPKCS036
01099 **                                                                DPKCS036
01100 * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              DPKCS036
01101 * EDITTING IS DONE FROM THE BOTTOM UP.                            DPKCS036
01102 **                                                                DPKCS036
01103      COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
01104          ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
01105      PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
01106      PERFORM 3300-EDIT-SELECTIONS                                 DPKCS036
01107          VARYING PV-SUB                                           DPKCS036
01108          FROM PV-SUB BY -1                                        DPKCS036
01109          UNTIL PV-SUB < +1                                        DPKCS036
01110 *                                                                 DPKCS036
01111      IF  PS-NO-ERROR                                              DPKCS036
01112          PERFORM 3400-CHECK-RANGE-SEQUENCE                        DPKCS036
01113      END-IF.                                                      DPKCS036
01114 *                                                                 DPKCS036
01115      IF  ((PS-NO-ERROR)                                           DPKCS036
01116        AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   DPKCS036
01117        AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    DPKCS036
01118              PERFORM 3500-MARK-RANGE-AS-SELECTED                  DPKCS036
01119      END-IF.                                                      DPKCS036
01120  EJECT                                                            DPKCS036
01121 *----------------------------------------------------------------*DPKCS036
01122 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *DPKCS036
01123 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*DPKCS036
01124 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *DPKCS036
01125 *                                                                *DPKCS036
01126 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *DPKCS036
01127 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *DPKCS036
01128 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *DPKCS036
01129 *    US IN THE 2ND BLOCK OF THE ARRAY.                           *DPKCS036
01130 *----------------------------------------------------------------*DPKCS036
01131                                                                   DPKCS036
01132  3100-SET-SUBSCRIPTS.                                             DPKCS036
01133                                                                   DPKCS036
01134      COMPUTE ASC-ITEM-SUB =                                       DPKCS036
01135          (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        DPKCS036
01136                                                                   DPKCS036
01137      IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         DPKCS036
01138          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
01139                                                                   DPKCS036
01140          MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               DPKCS036
01141      ELSE                                                         DPKCS036
01142          MOVE +1                     TO ASC-BLK-SUB               DPKCS036
01143      END-IF.                                                      DPKCS036
01144 ******************************************************************DPKCS036
01145 ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **DPKCS036
01146 ******************************************************************DPKCS036
01147                                                                   DPKCS036
01148  3200-RESET-ATTRIBUTES.                                           DPKCS036
01149      MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   DPKCS036
01150      MOVE DP015-GREEN              TO ASTRTITC.                   DPKCS036
01151      MOVE DP015-UNDERLINE          TO ASTRTITH.                   DPKCS036
01152 *                                                                 DPKCS036
01153      PERFORM                                                      DPKCS036
01154          VARYING PV-SUB                                           DPKCS036
01155          FROM 1 BY 1                                              DPKCS036
01156          UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
01157          MOVE DP015-UNP-ALP-NOR-OFF                               DPKCS036
01158                                    TO MR-SELECTA (PV-SUB)         DPKCS036
01159          MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         DPKCS036
01160          MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         DPKCS036
01161      END-PERFORM.                                                 DPKCS036
01162 ******************************************************************DPKCS036
01163 ** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **DPKCS036
01164 ** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **DPKCS036
01165 ** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **DPKCS036
01166 ** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **DPKCS036
01167 ******************************************************************DPKCS036
01168  3300-EDIT-SELECTIONS.                                            DPKCS036
01169      EVALUATE TRUE                                                DPKCS036
01170          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
01171              = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
01172                  CONTINUE                                         DPKCS036
01173          WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
01174              IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
01175                  ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   DPKCS036
01176                  MOVE ASC-TEMP-SELECTED-SW                        DPKCS036
01177                                       (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
01178                                 TO ASC-SELECTED-SW                DPKCS036
01179                                       (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
01180              END-IF                                               DPKCS036
01181          WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
01182                  = SPACE                                          DPKCS036
01183              EVALUATE TRUE                                        DPKCS036
01184                  WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
01185                      SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSDPKCS036
01186                      MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
01187                                       (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
01188                  WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
01189                      MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    DPKCS036
01190                      MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
01191                                       (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
01192                  WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
01193                      MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      DPKCS036
01194                      MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
01195                                       (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
01196              END-EVALUATE                                         DPKCS036
01197          WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
01198              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
01199                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
01200              END-IF                                               DPKCS036
01201              PERFORM 3310-EDIT-RANGE                              DPKCS036
01202          WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
01203              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
01204                  SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
01205              END-IF                                               DPKCS036
01206              PERFORM 3310-EDIT-RANGE                              DPKCS036
01207          WHEN OTHER                                               DPKCS036
01208              MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           DPKCS036
01209              SET DP020-MSG-FATAL    TO TRUE                       DPKCS036
01210              MOVE -1                TO MR-SELECTL (PV-SUB)        DPKCS036
01211              SET DP030-SET-CURSOR-APPL-1                          DPKCS036
01212                                     TO TRUE                       DPKCS036
01213              MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        DPKCS036
01214              MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        DPKCS036
01215              SET PS-ERROR TO TRUE                                 DPKCS036
01216              IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
01217                  SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     DPKCS036
01218                  MOVE SPACE         TO ASC-SELECTED-SW            DPKCS036
01219                                         (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
01220              END-IF                                               DPKCS036
01221      END-EVALUATE.                                                DPKCS036
01222                                                                   DPKCS036
01223      SUBTRACT +1             FROM PV-ITEM-IN-USE.                 DPKCS036
01224      SUBTRACT +1 FROM ASC-ITEM-SUB.                               DPKCS036
01225      IF  ASC-ITEM-SUB < 1                                         DPKCS036
01226          SUBTRACT +1 FROM ASC-BLK-SUB                             DPKCS036
01227          MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                DPKCS036
01228      END-IF.                                                      DPKCS036
01229 ******************************************************************DPKCS036
01230 ** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **DPKCS036
01231 ** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **DPKCS036
01232 ** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**DPKCS036
01233 ** THE ENDING.                                                  **DPKCS036
01234 ******************************************************************DPKCS036
01235  3310-EDIT-RANGE.                                                 DPKCS036
01236      IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                DPKCS036
01237          IF  ASC-START-OF-SELECTED-RANGE = ZERO                   DPKCS036
01238              MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
01239                                    TO ASC-SELECTED-SW             DPKCS036
01240                                         (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
01241              MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE DPKCS036
01242          ELSE                                                     DPKCS036
01243              IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     DPKCS036
01244                  CONTINUE                                         DPKCS036
01245              ELSE                                                 DPKCS036
01246 *                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        DPKCS036
01247                  MOVE PC-TSYMSG-00054                             DPKCS036
01248                                    TO DP020-MSG-NUMBER            DPKCS036
01249                  SET DP020-MSG-FATAL                              DPKCS036
01250                                    TO TRUE                        DPKCS036
01251                  MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
01252                  SET DP030-SET-CURSOR-APPL-1                      DPKCS036
01253                                    TO TRUE                        DPKCS036
01254                  MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         DPKCS036
01255                  MOVE DP015-UNDERLINE                             DPKCS036
01256                                    TO MR-SELECTH (PV-SUB)         DPKCS036
01257                  SET PS-ERROR      TO TRUE                        DPKCS036
01258              END-IF                                               DPKCS036
01259          END-IF                                                   DPKCS036
01260      ELSE                                                         DPKCS036
01261          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
01262              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
01263                                    TO ASC-SELECTED-SW             DPKCS036
01264                                      (ASC-BLK-SUB ASC-ITEM-SUB)   DPKCS036
01265              MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   DPKCS036
01266          ELSE                                                     DPKCS036
01267              IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       DPKCS036
01268                  CONTINUE                                         DPKCS036
01269              ELSE                                                 DPKCS036
01270 *                -- ONLY ONE END-OF-RANGE ALLOWED --              DPKCS036
01271                  MOVE PC-TSYMSG-00055                             DPKCS036
01272                                    TO DP020-MSG-NUMBER            DPKCS036
01273                  SET DP020-MSG-FATAL                              DPKCS036
01274                                    TO TRUE                        DPKCS036
01275                  MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
01276                  SET DP030-SET-CURSOR-APPL-1                      DPKCS036
01277                                    TO TRUE                        DPKCS036
01278                  SET PS-ERROR      TO TRUE                        DPKCS036
01279              END-IF                                               DPKCS036
01280          END-IF                                                   DPKCS036
01281      END-IF.                                                      DPKCS036
01282 *                                                                 DPKCS036
01283 ******************************************************************DPKCS036
01284 ** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **DPKCS036
01285 ** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **DPKCS036
01286 ******************************************************************DPKCS036
01287  3400-CHECK-RANGE-SEQUENCE.                                       DPKCS036
01288      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
01289        AND  ASC-END-OF-SELECTED-RANGE > ZERO                      DPKCS036
01290        AND  ASC-START-OF-SELECTED-RANGE >                         DPKCS036
01291                                          ASC-END-OF-SELECTED-RANGEDPKCS036
01292 *        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                DPKCS036
01293          MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 DPKCS036
01294          SET DP020-MSG-FATAL TO TRUE                              DPKCS036
01295          SET PS-ERROR TO TRUE                                     DPKCS036
01296          PERFORM 3410-POSITION-AT-ERROR                           DPKCS036
01297      END-IF.                                                      DPKCS036
01298 ******************************************************************DPKCS036
01299 ** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **DPKCS036
01300 ** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **DPKCS036
01301 ** SHOULD BE POSITIONED ON A RANGE ERROR.                       **DPKCS036
01302 ******************************************************************DPKCS036
01303  3410-POSITION-AT-ERROR.                                          DPKCS036
01304      SET DP030-SET-CURSOR-APPL-1                                  DPKCS036
01305                                    TO TRUE.                       DPKCS036
01306      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
01307                     - PV-TOP-ITEM + 1.                            DPKCS036
01308      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
01309          CONTINUE                                                 DPKCS036
01310      ELSE                                                         DPKCS036
01311          MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
01312          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
01313          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
01314      END-IF.                                                      DPKCS036
01315 *                                                                 DPKCS036
01316      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
01317                     - PV-TOP-ITEM + 1.                            DPKCS036
01318      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
01319          CONTINUE                                                 DPKCS036
01320      ELSE                                                         DPKCS036
01321          MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
01322          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
01323          MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
01324      END-IF.                                                      DPKCS036
01325  EJECT                                                            DPKCS036
01326 *----------------------------------------------------------------*DPKCS036
01327 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *DPKCS036
01328 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *DPKCS036
01329 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *DPKCS036
01330 *----------------------------------------------------------------*DPKCS036
01331                                                                   DPKCS036
01332  3500-MARK-RANGE-AS-SELECTED.                                     DPKCS036
01333      MOVE +1                       TO  ASC-BLK-SUB.               DPKCS036
01334      PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
01335          VARYING ASC-ITEM-SUB                                     DPKCS036
01336          FROM 1 BY 1                                              DPKCS036
01337          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
01338                                                                   DPKCS036
01339      ADD +1                        TO ASC-BLK-SUB.                DPKCS036
01340      PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
01341          VARYING ASC-ITEM-SUB                                     DPKCS036
01342          FROM 1 BY 1                                              DPKCS036
01343          UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
01344                                                                   DPKCS036
01345      MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
01346                                    TO  PV-LIST-ITEM-NUMBER.       DPKCS036
01347      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
01348          1 + ((PV-LIST-ITEM-NUMBER - 1) /                         DPKCS036
01349                PC-ITEMS-PER-PANEL).                               DPKCS036
01350                                                                   DPKCS036
01351      MOVE ASC-START-OF-SELECTED-RANGE                             DPKCS036
01352                                    TO PV-START-OF-SELECTED-RANGE. DPKCS036
01353      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            DPKCS036
01354          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  DPKCS036
01355                PC-ITEMS-PER-PANEL).                               DPKCS036
01356                                                                   DPKCS036
01357      MOVE ASC-END-OF-SELECTED-RANGE                               DPKCS036
01358                                    TO  PV-END-OF-SELECTED-RANGE.  DPKCS036
01359      COMPUTE PV-LAST-BLOCK-IN-RANGE =                             DPKCS036
01360          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    DPKCS036
01361                PC-ITEMS-PER-PANEL).                               DPKCS036
01362      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             DPKCS036
01363          PV-FIRST-BLOCK-IN-ARRAY + 1.                             DPKCS036
01364                                                                   DPKCS036
01365      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    DPKCS036
01366         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        DPKCS036
01367          MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
01368          PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
01369          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
01370              PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
01371                                                                   DPKCS036
01372          PERFORM                                                  DPKCS036
01373              UNTIL PV-FIRST-BLOCK-IN-RANGE >                      DPKCS036
01374                    PV-PREV-BLOCK-IN-ARRAY                         DPKCS036
01375              MOVE PV-FIRST-BLOCK-IN-RANGE                         DPKCS036
01376                                    TO PV-BLOCK-NUMBER             DPKCS036
01377              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
01378              PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
01379                  VARYING ASC-ITEM-SUB                             DPKCS036
01380                  FROM 1 BY 1                                      DPKCS036
01381                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
01382              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
01383              ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     DPKCS036
01384          END-PERFORM                                              DPKCS036
01385                                                                   DPKCS036
01386          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
01387              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
01388          PERFORM                                                  DPKCS036
01389              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
01390                    PV-LAST-BLOCK-IN-RANGE                         DPKCS036
01391              MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
01392                                    TO PV-BLOCK-NUMBER             DPKCS036
01393              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
01394              PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
01395                  VARYING ASC-ITEM-SUB                             DPKCS036
01396                  FROM 1 BY 1                                      DPKCS036
01397                  UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
01398              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
01399              ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
01400          END-PERFORM                                              DPKCS036
01401                                                                   DPKCS036
01402          MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
01403                                    TO PV-BLOCK-NUMBER             DPKCS036
01404          PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
01405      END-IF.                                                      DPKCS036
01406                                                                   DPKCS036
01407      MOVE +0                       TO ASC-START-OF-SELECTED-RANGE DPKCS036
01408                                       ASC-END-OF-SELECTED-RANGE.  DPKCS036
01409                                                                   DPKCS036
01410  EJECT                                                            DPKCS036
01411 *----------------------------------------------------------------*DPKCS036
01412 * SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *DPKCS036
01413 *----------------------------------------------------------------*DPKCS036
01414                                                                   DPKCS036
01415  3510-MARK-SELECTED-INDS.                                         DPKCS036
01416                                                                   DPKCS036
01417      IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
01418                                 ASC-ITEM-SUB) >                   DPKCS036
01419          ASC-START-OF-SELECTED-RANGE)                             DPKCS036
01420      OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
01421                                 ASC-ITEM-SUB) =                   DPKCS036
01422          ASC-START-OF-SELECTED-RANGE)                             DPKCS036
01423                                                                   DPKCS036
01424          IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
01425                                     ASC-ITEM-SUB) <               DPKCS036
01426              ASC-END-OF-SELECTED-RANGE)                           DPKCS036
01427          OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
01428                                     ASC-ITEM-SUB) =               DPKCS036
01429              ASC-END-OF-SELECTED-RANGE)                           DPKCS036
01430                                                                   DPKCS036
01431              IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
01432                  SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
01433                      ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
01434                                TO TRUE                            DPKCS036
01435                  SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              DPKCS036
01436                                TO TRUE                            DPKCS036
01437                  ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
01438              END-IF                                               DPKCS036
01439          END-IF                                                   DPKCS036
01440      END-IF.                                                      DPKCS036
01441                                                                   DPKCS036
01442  EJECT                                                            DPKCS036
01443 *----------------------------------------------------------------*DPKCS036
01444 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *DPKCS036
01445 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *DPKCS036
01446 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *DPKCS036
01447 *    DISPLAY THE PANEL TO USER.                                  *DPKCS036
01448 *----------------------------------------------------------------*DPKCS036
01449                                                                   DPKCS036
01450  4000-BUILD-INITIAL-PANEL.                                        DPKCS036
01451                                                                   DPKCS036
01452      INITIALIZE                  ASC-BLOCK-ENTRIES (1)            DPKCS036
01453                                  ASC-BLOCK-ENTRIES (2).           DPKCS036
01454      MOVE +1                 TO ASC-BLK-SUB.                      DPKCS036
01455      SET ASC-ITEMS-LEFT-ON-DB                                     DPKCS036
01456                              TO TRUE.                             DPKCS036
01457                                                                   DPKCS036
01458      MOVE +0                 TO ASC-ITEM-SUB                      DPKCS036
01459                                 ASC-NUMBER-OF-ITEMS-READ          DPKCS036
01460                                 ASC-NUMBER-OF-SELECTED-ITEMS      DPKCS036
01461                                 ASC-HIGHEST-BLOCK-WRITTEN         DPKCS036
01462                                 ASC-START-OF-SELECTED-RANGE       DPKCS036
01463                                 ASC-END-OF-SELECTED-RANGE         DPKCS036
01464                                 ASC-ITEM-AT-TOP-OF-PANEL.         DPKCS036
01467      PERFORM 4010-OPEN-CURSOR.                                    DPKCS036
01468                                                                   DPKCS036
01469      PERFORM 4300-READ-ITEMS-FROM-DB.                             DPKCS036
01470                                                                   DPKCS036
01471      PERFORM 4020-CLOSE-CURSOR.                                   DPKCS036
01472                                                                   DPKCS036
01473      MOVE +1                   TO  PV-TOP-ITEM.                   DPKCS036
01474      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          DPKCS036
01475          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    DPKCS036
01476          SET DP020-MSG-FATAL   TO  TRUE                           DPKCS036
01477          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               DPKCS036
01478      ELSE                                                         DPKCS036
01479          MOVE -1               TO MR-SELECTL (1)                  DPKCS036
01480          SET DP030-SET-CURSOR-APPL-1                              DPKCS036
01481                                TO TRUE                            DPKCS036
01482          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     DPKCS036
01483      END-IF.                                                      DPKCS036
01484  EJECT                                                            DPKCS036
01485 *----------------------------------------------------------------*DPKCS036
01486 * OPEN THE TMESSAGE CURSOR.                                      *DPKCS036
01487 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *DPKCS036
01488 *   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *DPKCS036
01489 *   USER.                                                        *DPKCS036
01490 *----------------------------------------------------------------*DPKCS036
01491                                                                   DPKCS036
01492  4010-OPEN-CURSOR.                                                DPKCS036
01493      PERFORM                                                      DPKCS036
01494          WITH TEST AFTER                                          DPKCS036
01495          VARYING PV-RETRY-COUNTER                                 DPKCS036
01496          FROM 1 BY 1                                              DPKCS036
01497          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               DPKCS036
01498                    OR (SQLCODE = ZERO))                           DPKCS036
01499          EXEC SQL                                                       36
01500              OPEN TKT_OFF_CURSOR                                  DPKCS036
01501          END-EXEC                                                       36
01521                                                                   DPKCS036
01522          EVALUATE TRUE                                            DPKCS036
01523              WHEN SQLCODE = ZERO                                  DPKCS036
01524              WHEN SQLCODE = -904                                  DPKCS036
01525              WHEN SQLCODE = -913                                  DPKCS036
01526                  CONTINUE                                         DPKCS036
01527              WHEN SQLWARN0 NOT = SPACES                           DPKCS036
01528              WHEN SQLCODE < ZERO                                  DPKCS036
01529              WHEN SQLCODE > ZERO                                  DPKCS036
01530                  MOVE '4010-OPEN-CURSOR'                          DPKCS036
01531                                    TO DP013-PARAGRAPH             DPKCS036
01532                  MOVE 'OPEN TICKET_FOMRAT_CURSOR '                      36
01533                                    TO DP013-MESSAGE-TEXT (1)      DPKCS036
01534                  MOVE SQLCA        TO DP013-SQLCA                 DPKCS036
01535                  MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)    DPKCS036
01535                  MOVE 'TVSCHVL '   TO DP013-DB2-TABLE-NAME (2)    DPKCS036
01536                  SET DP013-DB2-ABEND                              DPKCS036
01537                      DP013-XCTL-DISPLAY-RESTART TO TRUE           DPKCS036
01538                  PERFORM DP013-0000-PROCESS-ABEND                 DPKCS036
01539          END-EVALUATE                                             DPKCS036
01540      END-PERFORM.                                                 DPKCS036
01541 *                                                                 DPKCS036
01542      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        DPKCS036
01543          MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             DPKCS036
01544          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   DPKCS036
01545                                    TO DP013-MESSAGE-TEXT (1)      DPKCS036
01546          MOVE SQLCA                TO DP013-SQLCA                 DPKCS036
01547          MOVE 'TTKTFMT '           TO DP013-DB2-TABLE-NAME (1)    DPKCS036
01547          MOVE 'TVSCHVL '           TO DP013-DB2-TABLE-NAME (2)    DPKCS036
01548          SET DP013-DB2-ABEND                                      DPKCS036
01549              DP013-XCTL-DISPLAY-RESTART                           DPKCS036
01550                                    TO TRUE                        DPKCS036
01551          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
01552      END-IF.                                                      DPKCS036
01553                                                                   DPKCS036
01554  EJECT                                                            DPKCS036
01555 *----------------------------------------------------------------*DPKCS036
01556 * CLOSE THE TMESSAGE CURSOR.                                     *DPKCS036
01557 *   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *DPKCS036
01558 *   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *DPKCS036
01559 *   USER.                                                        *DPKCS036
01560 *----------------------------------------------------------------*DPKCS036
01561                                                                   DPKCS036
01562  4020-CLOSE-CURSOR.                                               DPKCS036
01563      EXEC SQL                                                     DPKCS036
01564          CLOSE TKT_OFF_CURSOR                                     DPKCS036
01565      END-EXEC.                                                          36
01579 *                                                                 DPKCS036
01580      EVALUATE TRUE                                                DPKCS036
01581          WHEN SQLCODE = ZERO                                      DPKCS036
01582              CONTINUE                                             DPKCS036
01583          WHEN SQLWARN0 NOT = SPACES                               DPKCS036
01584          WHEN SQLCODE < ZERO                                      DPKCS036
01585          WHEN SQLCODE > ZERO                                      DPKCS036
01586              MOVE '4020-CLOSE-CURSOR'                             DPKCS036
01587                                TO DP013-PARAGRAPH                 DPKCS036
01588              MOVE 'CLOSE TKT_OFF_CURSOR  '                        DPKCS036
01589                                TO DP013-MESSAGE-TEXT (1)          DPKCS036
01590              MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
01592              SET DP013-DB2-ABEND                                  DPKCS036
01593                  DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
01594              PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
01595      END-EVALUATE.                                                DPKCS036
01665                                                                   DPKCS036
01666  EJECT                                                            DPKCS036
01667 *----------------------------------------------------------------*DPKCS036
01668 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *DPKCS036
01669 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *DPKCS036
01670 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *DPKCS036
01671 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *DPKCS036
01672 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *DPKCS036
01673 *                                                                *DPKCS036
01674 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *DPKCS036
01675 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *DPKCS036
01676 *    UPON INITIALIZATION.                                        *DPKCS036
01677 *----------------------------------------------------------------*DPKCS036
01678                                                                   DPKCS036
01679  4300-READ-ITEMS-FROM-DB.                                         DPKCS036
01680                                                                   DPKCS036
01681      PERFORM                                                      DPKCS036
01682          VARYING PV-READ-COUNT                                    DPKCS036
01683          FROM 1 BY 1                                              DPKCS036
01684          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    DPKCS036
01685             OR (ASC-NO-ITEMS-LEFT-ON-DB))                         DPKCS036
01686                                                                   DPKCS036
01687          PERFORM 4310-FETCH                                       DPKCS036
01688                                                                   DPKCS036
01689          IF  ASC-ITEMS-LEFT-ON-DB                                 DPKCS036
01690              IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
01691                  ADD +1            TO ASC-ITEM-SUB                DPKCS036
01692              ELSE                                                 DPKCS036
01693                  ADD +1            TO ASC-BLK-SUB                 DPKCS036
01694                  MOVE +1           TO ASC-ITEM-SUB                DPKCS036
01695                                                                   DPKCS036
01696                  IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
01697                      MOVE +1       TO ASC-BLK-SUB                 DPKCS036
01698                      SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
01699                                    TO TRUE                        DPKCS036
01700                      PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
01701                      MOVE ASC-BLOCK-ENTRIES                       DPKCS036
01702                                (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
01703                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
01704                      ADD +1        TO ASC-BLK-SUB                 DPKCS036
01705                      INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
01706                      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
01707                                    TO TRUE                        DPKCS036
01708                  END-IF                                           DPKCS036
01709              END-IF                                               DPKCS036
01710              ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    DPKCS036
01711              MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
01712                                    TO ASC-LIST-ITEM-NUMBER        DPKCS036
01713                                       (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
01714              MOVE TKTFMT-TKT-OFF-ID                                     36
01714                                    TO ASC-TKT-OFF-ID                    36
01715                                        (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
01716              MOVE TKTFMT-OPER-UNT-ID                              DPKCS036
01717                                    TO ASC-OPER-UNT-ID                   36
01718                                        (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
01717              MOVE TKTFMT-FCLTY-ID  TO ASC-FACILITY-ID                   36
01718                                        (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
01716              MOVE TKTFMT-TKT-OFF-ADR-ID                           DPKCS036
01717                                    TO ASC-TKT-OFF-ADR-ID                36
01718                                        (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
01725          END-IF                                                   DPKCS036
01726      END-PERFORM.                                                 DPKCS036
01727                                                                   DPKCS036
01728      IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          DPKCS036
01729          MOVE +1               TO ASC-BLK-SUB                     DPKCS036
01730          PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
01731          ADD +1                TO ASC-BLK-SUB                     DPKCS036
01732          PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
01733                                                                   DPKCS036
01734          MOVE 1                TO ASC-BLK-SUB                     DPKCS036
01735                                   PV-BLOCK-NUMBER                 DPKCS036
01736          PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
01737          IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             DPKCS036
01738              MOVE 2            TO ASC-BLK-SUB                     DPKCS036
01739                                   PV-BLOCK-NUMBER                 DPKCS036
01740              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
01741          END-IF                                                   DPKCS036
01742      END-IF.                                                      DPKCS036
01743  EJECT                                                            DPKCS036
01744 *----------------------------------------------------------------*DPKCS036
01745 *    FETCH THE MESSAGE CURSOR.                                   *DPKCS036
01746 *----------------------------------------------------------------*DPKCS036
01747                                                                   DPKCS036
01748  4310-FETCH.                                                      DPKCS036
01749                                                                   DPKCS036
01750      EXEC SQL                                                           36
01751          FETCH TKT_OFF_CURSOR                                     DPKCS036
01752          INTO  :TKTFMT-TKT-OFF-ID                                 DPKCS036
01752              , :TKTFMT-OPER-UNT-ID                                DPKCS036
01752              , :TKTFMT-FCLTY-ID                                   DPKCS036
01752              , :TKTFMT-TKT-OFF-ADR-ID                             DPKCS036
01758      END-EXEC.                                                          36
01759                                                                   DPKCS036
01781      EVALUATE TRUE                                                DPKCS036
01782          WHEN SQLCODE = ZERO                                      DPKCS036
01783          WHEN SQLCODE = +100                                      DPKCS036
01784               CONTINUE                                            DPKCS036
01785          WHEN SQLWARN0 NOT = SPACE                                DPKCS036
01786          WHEN SQLCODE NOT = ZERO                                  DPKCS036
01787               MOVE '4310-FETCH-CURSOR'                            DPKCS036
01788                                TO DP013-PARAGRAPH                 DPKCS036
01789               MOVE 'FETCH TKT_OFF_CURSOR'                         DPKCS036
01790                                TO DP013-MESSAGE-TEXT (1)          DPKCS036
01791               MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
01792               SET DP013-DB2-ABEND                                 DPKCS036
01793                                TO TRUE                            DPKCS036
01794               PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
01795      END-EVALUATE.                                                DPKCS036
01796                                                                   DPKCS036
01797      IF  SQLCODE EQUAL +100                                       DPKCS036
01798          SET ASC-NO-ITEMS-LEFT-ON-DB                              DPKCS036
01799                                    TO TRUE                        DPKCS036
01800      END-IF.                                                      DPKCS036
01801                                                                   DPKCS036
01802  EJECT                                                            DPKCS036
01803 *----------------------------------------------------------------*DPKCS036
01804 * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *DPKCS036
01805 *----------------------------------------------------------------*DPKCS036
01806                                                                   DPKCS036
01807  4400-MOVE-COMMAREA-TO-SCREEN.                                    DPKCS036
01808      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             DPKCS036
01809          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          DPKCS036
01810          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          DPKCS036
01811              MOVE +1    TO ASC-BLK-SUB                            DPKCS036
01812              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
01813              ADD +1     TO ASC-BLK-SUB                            DPKCS036
01814              PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
01815              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             DPKCS036
01816                  GIVING PV-BLOCK-NUMBER                           DPKCS036
01817                  REMAINDER PV-REMAINDER                           DPKCS036
01818              IF  PV-REMAINDER > ZERO                              DPKCS036
01819                  ADD +1 TO PV-BLOCK-NUMBER                        DPKCS036
01820              END-IF                                               DPKCS036
01821              MOVE +1    TO ASC-BLK-SUB                            DPKCS036
01822              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
01823              ADD +1     TO ASC-BLK-SUB                            DPKCS036
01824                            PV-BLOCK-NUMBER                        DPKCS036
01825              PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
01826      END-IF.                                                      DPKCS036
01827      MOVE +1            TO ASC-BLK-SUB.                           DPKCS036
01828      COMPUTE ASC-ITEM-SUB =                                       DPKCS036
01829          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              DPKCS036
01830          + PC-ITEMS-PER-PANEL).                                   DPKCS036
01831 *                                                                 DPKCS036
01832      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
01833          ADD +1         TO ASC-BLK-SUB                            DPKCS036
01834          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
01835      END-IF.                                                      DPKCS036
01836 *                                                                 DPKCS036
01837      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           DPKCS036
01838          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                DPKCS036
01839      PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        DPKCS036
01840      PERFORM 4420-FORMAT-LIST-LINES                               DPKCS036
01841          VARYING PV-SUB                                           DPKCS036
01842          FROM PC-ITEMS-PER-PANEL BY -1                            DPKCS036
01843          UNTIL PV-SUB < +1.                                       DPKCS036
01844 *                                                                 DPKCS036
01845      COMPUTE ASC-ITEMS-DISPLAYED =                                DPKCS036
01846          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          DPKCS036
01847      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
01848                                       ASTRTITO.                   DPKCS036
01849      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    DPKCS036
01850      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    DPKCS036
01851      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
01852                                    TO ATOTSELO.                   DPKCS036
01853 *                                                                 DPKCS036
01854      IF  DP020-MSG-NUMBER-X = SPACE                               DPKCS036
01855          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  DPKCS036
01856 *            --- MORE ITEMS TO DISPLAY ----                       DPKCS036
01857              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            DPKCS036
01858              SET DP020-MSG-INFORMATIONAL TO TRUE                  DPKCS036
01859          END-IF                                                   DPKCS036
01860      END-IF.                                                      DPKCS036
01861 *----------------------------------------------------------------*DPKCS036
01862 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *DPKCS036
01863 *----------------------------------------------------------------*DPKCS036
01864                                                                   DPKCS036
01865  4410-READ-TEMP-STORAGE.                                          DPKCS036
01866                                                                   DPKCS036
01867      EXEC CICS                                                    DPKCS036
01868          READQ TS                                                 DPKCS036
01869              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
01870              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
01871              ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
01872              RESP  (PV-CICS-RESP)                                 DPKCS036
01873      END-EXEC.                                                    DPKCS036
01874                                                                   DPKCS036
01875      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       DPKCS036
01876        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     DPKCS036
01877          CONTINUE                                                 DPKCS036
01878      ELSE                                                         DPKCS036
01879          SET DP013-CICS-ABEND     TO TRUE                         DPKCS036
01880          SET DP013-NO-ROLLBACK    TO TRUE                         DPKCS036
01881          MOVE '4410-READ-TEMP-STORAGE'                            DPKCS036
01882                                   TO DP013-PARAGRAPH              DPKCS036
01883          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      DPKCS036
01884                                   TO DP013-MESSAGE-TEXT(1)        DPKCS036
01885          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
01886      END-IF.                                                      DPKCS036
01887                                                                   DPKCS036
01888      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
01889 *                                                                 DPKCS036
01890      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         DPKCS036
01891          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               DPKCS036
01892      END-IF.                                                      DPKCS036
01893  EJECT                                                            DPKCS036
01894 *----------------------------------------------------------------*DPKCS036
01895 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *DPKCS036
01896 *----------------------------------------------------------------*DPKCS036
01897                                                                   DPKCS036
01898  4420-FORMAT-LIST-LINES.                                          DPKCS036
01899      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      DPKCS036
01900          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                DPKCS036
01901          MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           DPKCS036
01902          MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           DPKCS036
01903          MOVE SPACE              TO MR-SELECTI (PV-SUB)           DPKCS036
01904                                     MR-ACTION (PV-SUB)            DPKCS036
01905                                     MR-TKT-OFF-ID (PV-SUB)              36
01906                                     MR-OPER-UNT-ID (PV-SUB)       DPKCS036
01906                                     MR-SLASH (PV-SUB)             DPKCS036
01906                                     MR-FACILITY-ID (PV-SUB)       DPKCS036
01906                                     MR-TKT-OFF-ADR-ID (PV-SUB)          36
01909      ELSE                                                         DPKCS036
01910          IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
01911                                                    > SPACE        DPKCS036
01912              MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
01913                                  TO MR-SELECTI (PV-SUB)           DPKCS036
01914          ELSE                                                     DPKCS036
01915              MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
01916                                  TO MR-SELECTI (PV-SUB)           DPKCS036
01917          END-IF                                                   DPKCS036
01918 *                                                                 DPKCS036
01919          IF  DP030-SET-CURSOR-TRAILER                             DPKCS036
01920              IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
01921                  > SPACE)                                         DPKCS036
01922                OR (PV-SUB = 1))                                   DPKCS036
01923                 SET DP030-SET-CURSOR-APPL-1 TO TRUE               DPKCS036
01924                 MOVE -1          TO MR-SELECTL (PV-SUB)           DPKCS036
01925              END-IF                                               DPKCS036
01926          END-IF                                                   DPKCS036
01927 *                                                                 DPKCS036
01928          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           DPKCS036
01929              MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
01930                                  TO MR-ACTION (PV-SUB)            DPKCS036
01931              MOVE ASC-TKT-OFF-ID (ASC-BLK-SUB ASC-ITEM-SUB)             36
01932                                  TO MR-TKT-OFF-ID (PV-SUB)              36
01931              MOVE ASC-OPER-UNT-ID (ASC-BLK-SUB ASC-ITEM-SUB)            36
01932                                  TO MR-OPER-UNT-ID (PV-SUB)             36
01932              MOVE '/'            TO MR-SLASH (PV-SUB)                   36
01931              MOVE ASC-FACILITY-ID (ASC-BLK-SUB ASC-ITEM-SUB)            36
01932                                  TO MR-FACILITY-ID (PV-SUB)             36
01933              MOVE ASC-TKT-OFF-ADR-ID (ASC-BLK-SUB ASC-ITEM-SUB)         36
01934                                  TO MR-TKT-OFF-ADR-ID (PV-SUB)          36
01939          END-IF                                                   DPKCS036
01940      END-IF.                                                      DPKCS036
01941      SUBTRACT +1 FROM ASC-ITEM-SUB                                DPKCS036
01942      IF  ASC-ITEM-SUB < + 1                                       DPKCS036
01943          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  DPKCS036
01944          MOVE +1                 TO ASC-BLK-SUB                   DPKCS036
01945      END-IF.                                                      DPKCS036
01946 ******************************************************************DPKCS036
01947 ** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **DPKCS036
01948 ** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **DPKCS036
01949 ** ISSUE A WARNING.                                             **DPKCS036
01950 ******************************************************************DPKCS036
01951  4430-CHECK-FOR-BEGIN-AND-END.                                    DPKCS036
01952      IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
01953          IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
01954 *            -- NO END-OF-RANGE SPECFIED ---                      DPKCS036
01955              MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            DPKCS036
01956              SET DP020-MSG-WARNING TO TRUE                        DPKCS036
01957              PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
01958          END-IF                                                   DPKCS036
01959      ELSE                                                         DPKCS036
01960          IF  ASC-END-OF-SELECTED-RANGE > ZERO                     DPKCS036
01961 *            -- NO BEGINNING-OF-RANGE SPECFIED ---                DPKCS036
01962              MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            DPKCS036
01963              SET DP020-MSG-WARNING TO TRUE                        DPKCS036
01964              PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
01965          END-IF                                                   DPKCS036
01966      END-IF.                                                      DPKCS036
01967 ******************************************************************DPKCS036
01968 ** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **DPKCS036
01969 ** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **DPKCS036
01970 ** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **DPKCS036
01971 ** POSITION THE CURSOR THERE.                                   **DPKCS036
01972 ******************************************************************DPKCS036
01973  4431-POSITION-AT-WARNING.                                        DPKCS036
01974      COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
01975                     - PV-TOP-ITEM + 1.                            DPKCS036
01976      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
01977          CONTINUE                                                 DPKCS036
01978      ELSE                                                         DPKCS036
01979          SET DP030-SET-CURSOR-APPL-1                              DPKCS036
01980                                    TO TRUE                        DPKCS036
01981          MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
01982          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
01983          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
01984      END-IF.                                                      DPKCS036
01985 *                                                                 DPKCS036
01986      COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
01987                     - PV-TOP-ITEM + 1.                            DPKCS036
01988      IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
01989          CONTINUE                                                 DPKCS036
01990      ELSE                                                         DPKCS036
01991          SET DP030-SET-CURSOR-APPL-1                              DPKCS036
01992                                    TO TRUE                        DPKCS036
01993          MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
01994          MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
01995          MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
01996      END-IF.                                                      DPKCS036
01997  EJECT                                                            DPKCS036
01998 *----------------------------------------------------------------*DPKCS036
01999 * PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *DPKCS036
02000 * ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *DPKCS036
02001 * FOR THE SELECTED ITEMS QUEUE.                                  *DPKCS036
02002 *                                                                *DPKCS036
02003 * FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *DPKCS036
02004 * QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *DPKCS036
02005 * THE ARRAY IS FULL.                                             *DPKCS036
02006 *----------------------------------------------------------------*DPKCS036
02007                                                                   DPKCS036
02008  5000-PREPARE-SEL-QUEUE.                                          DPKCS036
02009                                                                   DPKCS036
02010      MOVE +1                   TO  ASC-BLK-SUB.                   DPKCS036
02011      PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
02012      ADD +1                    TO  ASC-BLK-SUB.                   DPKCS036
02013      PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
02014                                                                   DPKCS036
02015      MOVE ASC-SEL-QUEUE-NAME   TO  VL013-SEL-QUEUE-NAME.          DPKCS036
02016      PERFORM 6010-DELETE-SEL-QUEUE.                               DPKCS036
02017                                                                   DPKCS036
02018      SET ASC-UPDATE-TSQ        TO  TRUE.                          DPKCS036
02019                                                                   DPKCS036
02020      SET VL014-IDX             TO  1.                             DPKCS036
02021      MOVE ZERO                 TO VL013-NUMBER-OF-TS-ITEMS.       DPKCS036
02022      INITIALIZE VL014-SELECTED-ITEM-ARRAY.                        DPKCS036
02023                                                                   DPKCS036
02024      PERFORM 5200-FILL-SEL-QUEUE-RECORD                           DPKCS036
02025              VARYING PV-ITEM                                      DPKCS036
02026              FROM 1 BY 1                                          DPKCS036
02027              UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     DPKCS036
02028                                                                   DPKCS036
02029      IF  VL014-IDX > 1                                            DPKCS036
02030          PERFORM 5205-WRITE-SEL-QUEUE                             DPKCS036
02031          ADD +1                TO VL013-NUMBER-OF-TS-ITEMS        DPKCS036
02032      END-IF.                                                      DPKCS036
02033  EJECT                                                            DPKCS036
02034 *----------------------------------------------------------------*DPKCS036
02035 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *DPKCS036
02036 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *DPKCS036
02037 *----------------------------------------------------------------*DPKCS036
02038                                                                   DPKCS036
02039  5100-WRITE-TEMP-STORAGE.                                         DPKCS036
02040      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     DPKCS036
02041                                    TO PV-LIST-ITEM-NUMBER.        DPKCS036
02042      COMPUTE PV-BLOCK-NUMBER =                                    DPKCS036
02043          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
02044                                                                   DPKCS036
02045      IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
02046      OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
02047          IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      DPKCS036
02048              PERFORM 5105-REWRITE-ASC-LISTQ                       DPKCS036
02049          END-IF                                                   DPKCS036
02050      ELSE                                                         DPKCS036
02051          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       DPKCS036
02052          ASC-HIGHEST-BLOCK-WRITTEN + 1                            DPKCS036
02053          PERFORM 5110-WRITE-ASC-LISTQ                             DPKCS036
02054          ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   DPKCS036
02055      END-IF.                                                      DPKCS036
02056                                                                   DPKCS036
02057      SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
02058 ******************************************************************DPKCS036
02059 ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **DPKCS036
02060 ** SPECIFIC COMMAREA.                                           **DPKCS036
02061 ******************************************************************DPKCS036
02062  5105-REWRITE-ASC-LISTQ.                                          DPKCS036
02063      EXEC CICS                                                    DPKCS036
02064          WRITEQ TS                                                DPKCS036
02065              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
02066              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
02067              ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
02068              REWRITE                                              DPKCS036
02069              RESP  (PV-CICS-RESP)                                 DPKCS036
02070      END-EXEC.                                                    DPKCS036
02071                                                                   DPKCS036
02072      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           DPKCS036
02073          CONTINUE                                                 DPKCS036
02074      ELSE                                                         DPKCS036
02075          SET DP013-CICS-ABEND            TO TRUE                  DPKCS036
02076          SET DP013-NO-ROLLBACK           TO TRUE                  DPKCS036
02077          MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       DPKCS036
02078          MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     DPKCS036
02079                                          TO DP013-MESSAGE-TEXT(1) DPKCS036
02080          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02081      END-IF.                                                      DPKCS036
02082                                                                   DPKCS036
02083 ******************************************************************DPKCS036
02084 ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **DPKCS036
02085 ** SPECIFIC COMMAREA.                                           **DPKCS036
02086 ******************************************************************DPKCS036
02087  5110-WRITE-ASC-LISTQ.                                            DPKCS036
02088      EXEC CICS                                                    DPKCS036
02089          WRITEQ TS                                                DPKCS036
02090              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
02091              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
02092              ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
02093              RESP  (PV-CICS-RESP)                                 DPKCS036
02094      END-EXEC.                                                    DPKCS036
02095      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      DPKCS036
02096          SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
02097          SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
02098          MOVE '5110-WRITE-ASC-LISTQ'                              DPKCS036
02099                                    TO DP013-PARAGRAPH             DPKCS036
02100          MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           DPKCS036
02101                                    TO DP013-MESSAGE-TEXT(1)       DPKCS036
02102          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02103      END-IF.                                                      DPKCS036
02104  EJECT                                                            DPKCS036
02105 *----------------------------------------------------------------*DPKCS036
02106 * READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *DPKCS036
02107 * TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *DPKCS036
02108 *----------------------------------------------------------------*DPKCS036
02109                                                                   DPKCS036
02110  5200-FILL-SEL-QUEUE-RECORD.                                      DPKCS036
02111                                                                   DPKCS036
02112      PERFORM 6112-READ-LIST-QUEUE.                                DPKCS036
02113                                                                   DPKCS036
02114      IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       DPKCS036
02115          PERFORM                                                  DPKCS036
02116          VARYING LQW-IDX                                          DPKCS036
02117          FROM 1 BY 1                                              DPKCS036
02118          UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            DPKCS036
02119            OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          DPKCS036
02120                                                                   DPKCS036
02121              IF  LQW-SELECT (LQW-IDX)                             DPKCS036
02122                  MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              DPKCS036
02123                                    TO VL014-ITEM (VL014-IDX)      DPKCS036
02124                  MOVE LQW-TKT-OFF-ID (LQW-IDX)                          36
02125                                    TO VL014-TKT-OFF-ID            DPKCS036
02126                                         (VL014-IDX)               DPKCS036
02124                  MOVE LQW-OPER-UNT-ID (LQW-IDX)                         36
02125                                    TO VL014-OPER-UNT-ID           DPKCS036
02126                                         (VL014-IDX)               DPKCS036
02124                  MOVE LQW-FACILITY-ID (LQW-IDX)                         36
02125                                    TO VL014-FACILITY-ID           DPKCS036
02126                                         (VL014-IDX)               DPKCS036
02124                  MOVE LQW-TKT-OFF-ADR-ID (LQW-IDX)                      36
02125                                    TO VL014-TKT-OFF-ADR-ID        DPKCS036
02126                                         (VL014-IDX)               DPKCS036
02127                  MOVE SPACE        TO VL014-ACTION-SW (VL014-IDX) DPKCS036
02128                  SET VL014-IDX UP BY 1                            DPKCS036
02129                  IF  VL014-IDX > VL014-MAX-ITEMS                  DPKCS036
02130                      PERFORM 5205-WRITE-SEL-QUEUE                 DPKCS036
02131                      ADD +1        TO VL013-NUMBER-OF-TS-ITEMS    DPKCS036
02132                      INITIALIZE VL014-SELECTED-ITEM-ARRAY         DPKCS036
02133                      SET VL014-IDX TO  1                          DPKCS036
02134                  END-IF                                           DPKCS036
02135              END-IF                                               DPKCS036
02136          END-PERFORM                                              DPKCS036
02137      END-IF.                                                      DPKCS036
02138                                                                   DPKCS036
02139 *----------------------------------------------------------------*DPKCS036
02140 *    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *DPKCS036
02141 *----------------------------------------------------------------*DPKCS036
02142                                                                   DPKCS036
02143  5205-WRITE-SEL-QUEUE.                                            DPKCS036
02144                                                                   DPKCS036
02145      MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
02146                                    TO VL014-SELECTED-ITEMS.       DPKCS036
02147                                                                   DPKCS036
02148      EXEC CICS                                                    DPKCS036
02149           WRITEQ TS                                               DPKCS036
02150               QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
02151               FROM  (VL014-TKT-FMT-SEL-REC)                       DPKCS036
02152               ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
02153               RESP  (PV-CICS-RESP)                                DPKCS036
02154      END-EXEC.                                                    DPKCS036
02155                                                                   DPKCS036
02156      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02157          CONTINUE                                                 DPKCS036
02158      ELSE                                                         DPKCS036
02159          SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
02160          SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
02161          MOVE '5205-WRITE-SEL-QUEUE'                              DPKCS036
02162                                    TO DP013-PARAGRAPH             DPKCS036
02163          MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          DPKCS036
02164                                    TO DP013-MESSAGE-TEXT(1)       DPKCS036
02165          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02166      END-IF.                                                      DPKCS036
02167  EJECT                                                            DPKCS036
02168 ******************************************************************DPKCS036
02169 ** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **DPKCS036
02170 ** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **DPKCS036
02171 ** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **DPKCS036
02172 ** THE USER.                                                    **DPKCS036
02173 ******************************************************************DPKCS036
02174  6000-REFRESH-PANEL-FROM-TEMP.                                    DPKCS036
02175      IF  ASC-UPDATE-TSQ                                           DPKCS036
02176          SET ASC-NO-TSQ-UPDATE TO TRUE                            DPKCS036
02177          MOVE ZERO                 TO PV-SAVE-ITEM                DPKCS036
02178                                       PV-SEL-QUEUE-ITEM           DPKCS036
02179          MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        DPKCS036
02180                                    TO PV-HOLD-SELECTED-ITEMS      DPKCS036
02181          MOVE +1                   TO PV-ITEMS-PROCESSED          DPKCS036
02182          PERFORM 6100-UPDATE-TSQ                                  DPKCS036
02183              UNTIL PV-ITEMS-PROCESSED >                           DPKCS036
02184                                      PV-HOLD-SELECTED-ITEMS       DPKCS036
02185          PERFORM 6010-DELETE-SEL-QUEUE                            DPKCS036
02186          INITIALIZE ASC-BLOCK-ENTRIES (1)                         DPKCS036
02187                     ASC-BLOCK-ENTRIES (2)                         DPKCS036
02188      END-IF.                                                      DPKCS036
02189                                                                   DPKCS036
02190 *----------------------------------------------------------------*DPKCS036
02191 *    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *DPKCS036
02192 *----------------------------------------------------------------*DPKCS036
02193  6010-DELETE-SEL-QUEUE.                                           DPKCS036
02194                                                                   DPKCS036
02195      EXEC CICS                                                    DPKCS036
02196          DELETEQ TS                                               DPKCS036
02197              QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
02198              RESP  (PV-CICS-RESP)                                 DPKCS036
02199      END-EXEC.                                                    DPKCS036
02200 *                                                                 DPKCS036
02201      IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      DPKCS036
02202         (PV-CICS-RESP = DFHRESP(QIDERR)))                         DPKCS036
02203          CONTINUE                                                 DPKCS036
02204      ELSE                                                         DPKCS036
02205          SET DP013-CICS-ABEND TO TRUE                             DPKCS036
02206          SET DP013-NO-ROLLBACK TO TRUE                            DPKCS036
02207          MOVE '6010-DELETE-SEL-QUEUE'                             DPKCS036
02208                         TO DP013-PARAGRAPH                        DPKCS036
02209          MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         DPKCS036
02210                         TO DP013-MESSAGE-TEXT (1)                 DPKCS036
02211          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02212      END-IF.                                                      DPKCS036
02213                                                                   DPKCS036
02214 *----------------------------------------------------------------*DPKCS036
02215 *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *DPKCS036
02216 *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *DPKCS036
02217 *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *DPKCS036
02218 *    THE TEMP QUEUE.                                             *DPKCS036
02219 *----------------------------------------------------------------*DPKCS036
02220                                                                   DPKCS036
02221  6100-UPDATE-TSQ.                                                 DPKCS036
02222                                                                   DPKCS036
02223      ADD 1                     TO  PV-SEL-QUEUE-ITEM.             DPKCS036
02224      PERFORM 6105-READ-SEL-QUEUE.                                 DPKCS036
02225      PERFORM                                                      DPKCS036
02226          VARYING VL014-IDX                                        DPKCS036
02227          FROM 1 BY 1                                              DPKCS036
02228          UNTIL ((PV-ITEMS-PROCESSED >                             DPKCS036
02229                               PV-HOLD-SELECTED-ITEMS)             DPKCS036
02230          OR (VL014-IDX GREATER THAN VL014-MAX-ITEMS))             DPKCS036
02231          IF  VL014-ACTION-SW (VL014-IDX) > SPACE                  DPKCS036
02232              PERFORM 6110-PROCESS-ITEMS                           DPKCS036
02233          END-IF                                                   DPKCS036
02234          ADD +1                TO PV-ITEMS-PROCESSED              DPKCS036
02235      END-PERFORM.                                                 DPKCS036
02236      PERFORM 6111-WRITE-LIST-QUEUE.                               DPKCS036
02237 *----------------------------------------------------------------*DPKCS036
02238 *    READ THE LIST QUEUE RECORD.                                 *DPKCS036
02239 *----------------------------------------------------------------*DPKCS036
02240                                                                   DPKCS036
02241  6105-READ-SEL-QUEUE.                                             DPKCS036
02242                                                                   DPKCS036
02243      EXEC CICS                                                    DPKCS036
02244           READQ TS                                                DPKCS036
02245               QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
02246               INTO  (VL014-TKT-FMT-SEL-REC)                       DPKCS036
02247               ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
02248               RESP  (PV-CICS-RESP)                                DPKCS036
02249      END-EXEC.                                                    DPKCS036
02250 *                                                                 DPKCS036
02251      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02252          CONTINUE                                                 DPKCS036
02253      ELSE                                                         DPKCS036
02254          SET DP013-CICS-ABEND      TO  TRUE                       DPKCS036
02255          SET DP013-NO-ROLLBACK     TO  TRUE                       DPKCS036
02256          MOVE '6105-READ-SEL-QUEUE'                               DPKCS036
02257                                    TO  DP013-PARAGRAPH            DPKCS036
02258          MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           DPKCS036
02259                                    TO  DP013-MESSAGE-TEXT(1)      DPKCS036
02260          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02261      END-IF.                                                      DPKCS036
02262  EJECT                                                            DPKCS036
02263 *----------------------------------------------------------------*DPKCS036
02264 *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*DPKCS036
02265 *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*DPKCS036
02266 *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *DPKCS036
02267 *----------------------------------------------------------------*DPKCS036
02268                                                                   DPKCS036
02269  6110-PROCESS-ITEMS.                                              DPKCS036
02270                                                                   DPKCS036
02271      COMPUTE PV-ITEM = 1 + ((VL014-ITEM (VL014-IDX) - 1)          DPKCS036
02272                      / PC-ITEMS-PER-PANEL).                       DPKCS036
02273                                                                   DPKCS036
02274      IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           DPKCS036
02275          IF  PV-SAVE-ITEM NOT EQUAL ZERO                          DPKCS036
02276              PERFORM 6111-WRITE-LIST-QUEUE                        DPKCS036
02277          END-IF                                                   DPKCS036
02278          MOVE PV-ITEM          TO PV-SAVE-ITEM                    DPKCS036
02279                                                                   DPKCS036
02280          PERFORM 6112-READ-LIST-QUEUE                             DPKCS036
02281          IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               DPKCS036
02282              CONTINUE                                             DPKCS036
02283          END-IF                                                   DPKCS036
02284      END-IF.                                                      DPKCS036
02285                                                                   DPKCS036
02286      COMPUTE PV-SUB = (VL014-ITEM (VL014-IDX)                     DPKCS036
02287                     - LQW-LIST-ITEM-NUMBER (1)) + 1.              DPKCS036
02288      SET LQW-DESELECT (PV-SUB) TO    TRUE                         DPKCS036
02289      MOVE LQW-SELECTED-SW (PV-SUB)                                DPKCS036
02290                                TO LQW-TEMP-SELECTED-SW (PV-SUB).  DPKCS036
02291      EVALUATE TRUE                                                DPKCS036
02292          WHEN VL014-INQ (VL014-IDX)                               DPKCS036
02293               MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             DPKCS036
02294                                                                   DPKCS036
02295          WHEN VL014-UPD (VL014-IDX)                               DPKCS036
02296               MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             DPKCS036
02297                                                                   DPKCS036
02298          WHEN VL014-DEL (VL014-IDX)                               DPKCS036
02299               MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             DPKCS036
02300                                                                   DPKCS036
02301          WHEN VL014-ERR (VL014-IDX)                               DPKCS036
02302               MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             DPKCS036
02303      END-EVALUATE.                                                DPKCS036
02304                                                                   DPKCS036
02305      SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                DPKCS036
02306                                                                   DPKCS036
02307 *----------------------------------------------------------------*DPKCS036
02308 *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *DPKCS036
02309 *----------------------------------------------------------------*DPKCS036
02310                                                                   DPKCS036
02311  6111-WRITE-LIST-QUEUE.                                           DPKCS036
02312                                                                   DPKCS036
02313      EXEC CICS                                                    DPKCS036
02314          WRITEQ TS                                                DPKCS036
02315              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
02316              FROM  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
02317              ITEM  (PV-SAVE-ITEM)                                 DPKCS036
02318              REWRITE                                              DPKCS036
02319              RESP  (PV-CICS-RESP)                                 DPKCS036
02320      END-EXEC.                                                    DPKCS036
02321 *                                                                 DPKCS036
02322      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02323          CONTINUE                                                 DPKCS036
02324      ELSE                                                         DPKCS036
02325          SET DP013-CICS-ABEND  TO  TRUE                           DPKCS036
02326          SET DP013-NO-ROLLBACK TO  TRUE                           DPKCS036
02327          MOVE '6111-WRITE-LIST-QUEUE'                             DPKCS036
02328                                TO  DP013-PARAGRAPH                DPKCS036
02329          MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  DPKCS036
02330                                TO  DP013-MESSAGE-TEXT(1)          DPKCS036
02331          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02332      END-IF.                                                      DPKCS036
02333                                                                   DPKCS036
02334  EJECT                                                            DPKCS036
02335 *----------------------------------------------------------------*DPKCS036
02336 *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*DPKCS036
02337 *----------------------------------------------------------------*DPKCS036
02338                                                                   DPKCS036
02339  6112-READ-LIST-QUEUE.                                            DPKCS036
02340                                                                   DPKCS036
02341      EXEC CICS                                                    DPKCS036
02342          READQ TS                                                 DPKCS036
02343              QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
02344              INTO  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
02345              ITEM  (PV-ITEM)                                      DPKCS036
02346              RESP  (PV-CICS-RESP)                                 DPKCS036
02347      END-EXEC.                                                    DPKCS036
02348 *                                                                 DPKCS036
02349      IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
02350          CONTINUE                                                 DPKCS036
02351      ELSE                                                         DPKCS036
02352          SET DP013-CICS-ABEND        TO TRUE                      DPKCS036
02353          SET DP013-NO-ROLLBACK       TO TRUE                      DPKCS036
02354          MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           DPKCS036
02355          MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    DPKCS036
02356                                      TO DP013-MESSAGE-TEXT(1)     DPKCS036
02357          PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
02358      END-IF.                                                      DPKCS036
02359                                                                   DPKCS036
02360  EJECT                                                            DPKCS036
02361 *----------------------------------------------------------------*DPKCS036
02362 *    ABEND PROCESSOR MODULE                                      *DPKCS036
02363 *----------------------------------------------------------------*DPKCS036
02364                                                                   DPKCS036
02365      COPY DPPD013.                                                DPKCS036
