000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.             TMKRP022.                                00030099
000400 AUTHOR.                 TKMA497.                                 00040063
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN            FEBRUATY 2004.                           00060099
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900**************************************************************    00090015
001000* THIS PROGRAM CREATES WEEKLY 'FALSE FAILED AUDIT' DETAIL         00100099
001100* REPORTS.                                                        00110099
001200**************************************************************    00120015
001300                                                                  00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600                                                                  00160000
001700 FILE-CONTROL.                                                    00170000
001800                                                                  00180000
001900     SELECT TROUBLE-EXTRACT-FILE      ASSIGN TO INP01.            00190000
002000     SELECT FFA-REPORT-FILE           ASSIGN TO RPT01.            00200099
002100                                                                  00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 FILE SECTION.                                                    00250000
002600 FD  TROUBLE-EXTRACT-FILE                                         00260000
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     BLOCK CONTAINS 0 RECORDS.                                    00290000
003000                                                                  00300000
003100 01  TROUBLE-EXTRACT-RECORD         PIC X(300).                   00310099
003200                                                                  00320000
003300 FD  FFA-REPORT-FILE                                              00330099
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700                                                                  00370000
003800 01  FFA-REPORT-RECORD          PIC X(132).                       00380099
003900                                                                  00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100 01  PS-SWITCHES.                                                 00410000
004200     05  PS-EOF-INPUT-FILE-SW        PIC X(01) VALUE 'N'.         00420011
004300         88  PS-EOF-INPUT-FILE                     VALUE 'Y'.     00430005
004400         88  PS-NOT-EOF-INPUT-FILE                 VALUE 'N'.     00440005
004800     05  PS-NO-DETAILS-SW            PIC  X(01)    VALUE ' '.     00480000
004900         88  PS-NO-DETAILS                         VALUE 'N'.     00490000
005000     05  PS-FIRST-TIME-THRU-SW       PIC  X(01)    VALUE 'F'.     00500000
005100         88  PS-FIRST-TIME-THRU                    VALUE 'F'.     00510000
005200         88  PS-NOT-FIRST-TIME-THRU                VALUE 'N'.     00520000
005300     05  PS-FIRST-TIME-THRU-SW-2     PIC  X(01)    VALUE 'F'.     00530099
005400         88  PS-FIRST-TIME-THRU-2                  VALUE 'F'.     00540099
005500         88  PS-NOT-FIRST-TIME-THRU-2              VALUE 'N'.     00550099
005900                                                                  00590020
006000 01  PC-PROGRAM-CONSTANTS.                                        00600000
006100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00610000
006200                                    'TMKRP022'.                   00620099
006300     05  PC-MAX-REPORT-LINES         PIC S9(04)    VALUE +60      00630024
006400                                                   COMP SYNC.     00640000
006500     05  PC-MAX-RETRIES              PIC S9(4)     VALUE +3       00650068
006600                                                   COMP SYNC.     00660068
006700     05  PC-SPECIAL-RUN-NOTE         PIC X(27)     VALUE          00670000
006800                                    '** SPECIAL REQUESTED RUN **'.00680000
006900     05  PC-ONE                      PIC 9(01)     VALUE  1.      00690000
007000     05  PC-TWO                      PIC 9(01)     VALUE  2.      00700000
007100     05  PC-THREE                    PIC 9(01)     VALUE  3.      00710000
007300                                                                  00730011
007400 01  ABEND-CODE                          PIC S9(04) VALUE +0      00740010
007500                                                     COMP SYNC.   00750010
007600 01  PA-PROGRAM-ACCUMULATORS.                                     00760018
007700     05  PA-DC-TROUBLE-COUNT         PIC S9(09)    VALUE +0       00770018
007800                                                     COMP.        00780018
007900     05  PA-DC-NOTIFY-COUNT          PIC S9(09)    VALUE +0       00790099
008000                                                     COMP.        00800099
008100     05  PA-DC-TROUBLE-UNIT-QTY      PIC S9(09)    VALUE +0       00810018
008200                                                     COMP.        00820018
008300     05  PA-DC-NOTIFY-UNIT-QTY       PIC S9(09)    VALUE +0       00830099
008400                                                     COMP.        00840099
008500                                                                  00850099
008600 01  PV-PROGRAM-VARIABLES.                                        00860018
008700     05  PV-OPER-UNT-ID-NUM          PIC 9(04)     VALUE 0.       00870099
008800     05  PV-OPER-UNT-ID-X.                                        00880099
008900         10 FILLER                   PIC X(01)     VALUE SPACE.   00890099
009000         10 PV-OPER-UNT-ID           PIC X(03)     VALUE SPACE.   00900099
009100     05  PV-TRBL-RSN-CDE             PIC 9(04).                   00910073
009200                                                                  00920099
009300     05  PV-PARAGRAPH-NAME           PIC X(30)     VALUE SPACES.  00930018
009400     05  PV-DB2-OPERATION-ATTEMPTED  PIC X(80)     VALUE SPACES.  00940018
009500     05  PV-DB2-ERROR-DATA.                                       00950090
009600         10  FILLER                  PIC X(08)     VALUE          00960078
009700         ' PO NBR '.                                              00970078
009800         10  PV-ERR-PO-NBR           PIC 9(09).                   00980078
009900         10  FILLER                  PIC X(06)     VALUE          00990078
010000         ' RCVR '.                                                01000090
010100         10  PV-ERR-RCVR-NBR         PIC 9(4).                    01010090
010200         10  PV-ERR-RCVR-NBR-X REDEFINES PV-ERR-RCVR-NBR          01020093
010300                                     PIC X(4).                    01030090
010400         10  FILLER                  PIC X(06)     VALUE          01040090
010500         ' LINE '.                                                01050090
010600         10  PV-ERR-LINE-NBR         PIC 9(09).                   01060078
010700         10  FILLER                  PIC X(06)     VALUE          01070078
010800         ' PLAN '.                                                01080078
010900         10  PV-ERR-PLAN-NBR         PIC 9(4).                    01090078
011000         10  PV-ERR-PLAN-NBR-X REDEFINES PV-ERR-PLAN-NBR          01100079
011100                                     PIC X(4).                    01110079
011200         10  FILLER                  PIC X(05)     VALUE          01120091
011300         ' STR '.                                                 01130091
011400         10  PV-ERR-STR-NBR-X        PIC X(4)      VALUE SPACES.  01140091
011500         10  PV-ERR-STR-NBR   REDEFINES PV-ERR-STR-NBR-X          01150093
011600                                     PIC 9(4).                    01160091
011700         10  FILLER                  PIC X(05)     VALUE          01170099
011800         ' SQL '.                                                 01180099
011900         10  PV-ERR-SQL-CODE         PIC ---9.                    01190099
012000     05  PV-REPORT-LINE              PIC X(132)    VALUE SPACES.  01200010
012100     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01210000
012200                                                   COMP SYNC.     01220000
012300     05  PV-RETRY-COUNTER            PIC S9(4)     VALUE ZERO     01230068
012400                                                   COMP SYNC.     01240068
012500     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01250004
012600     05  PV-LINE-COUNT               PIC S9(04)    VALUE +80      01260000
012700                                                   COMP.          01270005
012600     05  PV-LINE-ADVANCE             PIC S9(04)    VALUE +1       01271099
012700                                                   COMP.          01272099
012800     05  PV-PAGE-NUMBER              PIC  S9(04)   VALUE ZERO     01280095
012900                                                   COMP.          01290005
013000     05  PV-START-DATE               PIC  X(08)    VALUE SPACE.   01300000
013100     05  PV-END-DATE                 PIC  X(08)    VALUE SPACE.   01310000
013200*                                                                 01320004
013300     05  PV-CURRENT-DATE             PIC X(10)     VALUE SPACE.   01340199
009000     05  PV-CURRENT-DATE-RDF REDEFINES PV-CURRENT-DATE.           01341099
009100         10 PV-CURRENT-YEAR          PIC 9(04).                   01342099
009200         10 FILLER                   PIC X(01).                   01343099
009300         10 PV-CURRENT-MONTH         PIC 9(02).                   01344099
009400         10 FILLER                   PIC X(01).                   01345099
009500         10 PV-CURRENT-DAY           PIC 9(02).                   01346099
013400     05  PV-CURRENT-TIME             PIC X(08)     VALUE SPACE.   01346199
009800     05  PV-CURRENT-TIME-RDF REDEFINES PV-CURRENT-TIME.           01347099
009900         10 PV-CURRENT-HOUR          PIC 9(02).                   01348099
010000         10 FILLER                   PIC X(01).                   01349099
010100         10 PV-CURRENT-MINUTE        PIC 9(02).                   01349199
010200         10 FILLER                   PIC X(01).                   01349299
010300         10 PV-CURRENT-SECOND        PIC 9(02).                   01349399
013500*                                                                 01350004
013600     05  PV-START-EXTRACT.                                        01360004
013700         10 PV-START-YYYY            PIC 9(04)     VALUE 0.       01370004
013800         10 FILLER                   PIC X(01)     VALUE SPACE.   01380004
013900         10 PV-START-MM              PIC 9(02)     VALUE 0.       01390004
014000         10 FILLER                   PIC X(01)     VALUE SPACE.   01400004
014100         10 PV-START-DD              PIC 9(02)     VALUE 0.       01410004
014200         10 FILLER                   PIC X(01)     VALUE SPACE.   01420004
014300     05  PV-END-EXTRACT.                                          01430000
014400         10 PV-END-YYYY              PIC 9(04)     VALUE 0.       01440000
014500         10 FILLER                   PIC X(01)     VALUE SPACE.   01450000
014600         10 PV-END-MM                PIC 9(02)     VALUE 0.       01460000
014700         10 FILLER                   PIC X(01)     VALUE SPACE.   01470000
014800         10 PV-END-DD                PIC 9(02)     VALUE 0.       01480000
014900         10 FILLER                   PIC X(01)     VALUE SPACE.   01490000
015000     05  PV-REPORT-DATE              PIC X(10)     VALUE SPACE.   01500000
015100     05  PV-TMST-HOLD.                                            01510000
015200         88  PV-TMST-ENROUTE                  VALUE               01520000
015300             '9999-09-09-09.09.09.999999'.                        01530000
015400         10 PV-TMST-YYYY            PIC X(04) VALUE SPACES.       01540000
015500         10 FILLER                  PIC X(01) VALUE SPACES.       01550000
015600         10 PV-TMST-MM              PIC X(02) VALUE SPACES.       01560000
015700         10 FILLER                  PIC X(01) VALUE SPACES.       01570000
015800         10 PV-TMST-DD              PIC X(02) VALUE SPACES.       01580000
015900         10 FILLER                  PIC X(01) VALUE SPACES.       01590000
016000         10 PV-TMST-HH              PIC X(02) VALUE SPACES.       01600000
016100         10 FILLER                  PIC X(01) VALUE SPACES.       01610000
016200         10 PV-TMST-MIN             PIC X(02) VALUE SPACES.       01620000
016300         10 FILLER                  PIC X(01) VALUE SPACES.       01630000
016400         10 PV-TMST-SS              PIC X(02) VALUE SPACES.       01640000
016500         10 FILLER                  PIC X(07) VALUE SPACES.       01650000
016700     05  PV-SAVE-VARIABLES.                                       01670005
016800         10  PV-SAVE-OPER-UNT-ID      PIC 9(04) VALUE ZERO.       01680099
011308         10  PV-SAVE-ASSOCIATE-NAME   PIC X(40) VALUE SPACES.     01690099
005900         10  PV-SAVE-TRBL-RSN-CDE     PIC 9(3)  VALUE ZERO.       01700099
017500                                                                  01750066
017600*01  PT-PROGRAM-TABLE.                                            01760099
017700*    05  PT-STORE-TABLE               OCCURS 800 TIMES.           01770099
017800                                                                  01780000
017900     COPY DPWS132O.                                               01790000
018000                                                                  01800000
018100 01  HL1-HEADING-LINE-1.                                          01810099
018200     05  FILLER                      PIC  X(02)    VALUE SPACES.  01820000
018300     05  HL1-SPECIAL-RUN-NOTE        PIC  X(27)    VALUE SPACES.  01830000
018400     05  FILLER                      PIC  X(08)    VALUE SPACES.  01840099
018500     05  FILLER                      PIC  X(48)    VALUE          01850099
018600             'WEEKLY FALSE FAILED AUDITS DETAIL REPORT ENDING '.  01860099
018700     05  HL1-REPORT-DATE             PIC  X(10)    VALUE SPACES.  01870000
018800*    05  FILLER                      PIC  X(04)    VALUE ' AT '.  01880099
018900*    05  HL1-REPORT-TIME             PIC  X(05)    VALUE SPACES.  01890099
019000     05  FILLER                      PIC  X(33)    VALUE SPACES.  01900099
020300 01  HL2-HEADING-LINE-2.                                          02030000
020400     05  FILLER                      PIC  X(06)    VALUE SPACES.  02040099
020500     05  FILLER                      PIC  X(11)    VALUE          02050099
020600                                                  'VENDOR NAME'.  02060099
020400     05  FILLER                      PIC  X(19)    VALUE SPACES.  02060199
020500     05  FILLER                      PIC  X(34)    VALUE          02060299
020600                           'VENDOR NBR    PO/RCVR  LINE/PACK  '.  02060399
020400     05  FILLER                      PIC  X(15)    VALUE          02061099
                                                    '        UPC    '.  02061199
020500     05  FILLER                      PIC  X(34)    VALUE          02062099
020600                           'SKU      AUDIT NBR  TROUBLE DESC  '.  02063099
020700     05  FILLER                      PIC  X(13)    VALUE SPACES.  02070099
020800                                                                  02080000
026500 01  DL1-DETAIL-LINE.                                             02081099
021100     05  FILLER                      PIC  X(02)    VALUE SPACES.  02081199
021100     05  FILLER                      PIC  X(04)    VALUE 'DC: '.  02081299
           05  DL1-DC                      PIC  9(04).                  02082099
           05  FILLER                      PIC  X(01)    VALUE SPACES.  02082199
           05  DL1-DC-NAME                 PIC  X(40).                  02083099
           05  FILLER                      PIC  X(81)    VALUE SPACES.  02084099
026500 01  DL2-DETAIL-LINE.                                             02085099
021100     05  FILLER                      PIC  X(04)    VALUE SPACES.  02086099
021100     05  FILLER                      PIC  X(11)    VALUE          02087099
                                                        'ASSOCIATE: '.  02087199
           05  DL2-ASSOCIATE-NAME          PIC  X(40).                  02089199
           05  FILLER                      PIC  X(77)    VALUE SPACES.  02089299
020900                                                                  02090000
021000 01  DL3-DETAIL-LINE.                                             02100099
021100     05  FILLER                      PIC  X(06)    VALUE SPACES.  02110099
021900     05  DL3-VENDOR-NAME             PIC  X(30)    VALUE ZERO.    02131099
021300     05  FILLER                      PIC  X(01)    VALUE SPACES.  02132099
021400     05  DL3-VENDOR-NBR-X.                                        02140099
021400         10  DL3-VENDOR-NBR          PIC  Z(8)9.                  02140199
021400     05  DL3-PO-RCVR.                                             02141099
021500         10 DL3-PO-NBR               PIC  Z(8)9.                  02150099
021600         10 DL3-DASH                 PIC  X(01)    VALUE '-'.     02160099
021700         10 DL3-REC-SEQ-NBR          PIC  9(03).                  02170099
021800     05  FILLER                      PIC  X(02)    VALUE SPACES.  02180028
022100     05  DL3-LINE-OR-PACK-X.                                      02210099
022200         10  DL3-LINE-OR-PACK        PIC  ZZ9.                    02220099
022300     05  FILLER                      PIC  X(02)    VALUE SPACES.  02230028
022400     05  DL3-UPC-NBR-X.                                           02240099
022400         10  DL3-UPC-NBR             PIC  Z(14)9   VALUE ZERO.    02240199
022300     05  FILLER                      PIC  X(02)    VALUE SPACES.  02240299
022400     05  DL3-SKU-NBR-X.                                           02240399
022400         10  DL3-SKU-NBR             PIC  9(08)    VALUE ZERO.    02240499
022300     05  FILLER                      PIC  X(02)    VALUE SPACES.  02260099
022400     05  DL3-AUDIT-NBR-X.                                         02270099
022400         10  FILLER                  PIC  X(01)    VALUE SPACE.   02271099
022400         10  DL3-AUDIT-NBR           PIC  9(09)    VALUE ZERO.    02272099
022300     05  FILLER                      PIC  X(02)    VALUE SPACES.  02280099
022400     05  DL3-TROUBLE-REASON          PIC  X(20)    VALUE ZERO.    02290099
023100     05  FILLER                      PIC  X(07)    VALUE SPACES.  02310099
025400                                                                  02540028
026500 01  BL-BLANK-LINE                   PIC  X(132)   VALUE SPACES.  02650000
026600                                                                  02660000
026700 01  ND-NO-DATA-LINE.                                             02670004
026800     05  FILLER                      PIC X(02)  VALUE SPACE.      02680000
026900     05  FILLER                      PIC X(23)  VALUE             02690000
027000                                     '** NO DATA TO REPORT **'.   02700000
027100     05  FILLER                      PIC X(108) VALUE SPACE.      02710000
027200                                                                  02720000
027300 01  ER-END-REPORT-LINE.                                          02730000
027400     05  FILLER                      PIC X(02)  VALUE SPACE.      02740000
027500     05  FILLER                      PIC X(16)  VALUE             02750000
027600                                     '** END REPORT **'.          02760000
027700     05  FILLER                      PIC X(116) VALUE SPACE.      02770000
027800*---------------------------------------------------------------* 02780099
027900*    DATE ROUTINE LAYOUT.                                       * 02790099
028000*---------------------------------------------------------------* 02800099
028100     COPY DPWS500.                                                02810099
028200                                                                  02820000
028300     COPY DPWS004.                                                02830000
028400                                                                  02840000
028500     COPY TMRD002.                                                02850099
028600                                                                  02860000
028700     EXEC SQL                                                     02870000
028800          INCLUDE SQLCA                                           02880000
028900     END-EXEC.                                                    02890000
029000***************************************************************** 02900000
029100 PROCEDURE DIVISION.                                              02910000
029200***************************************************************** 02920000
029300                                                                  02930000
029400 0000-MAINLINE.                                                   02940000
029500***************************************************************** 02950000
029600*  THIS PARAGRAPH DRIVES THE PROGRAM.                           * 02960000
029700***************************************************************** 02970000
029800     PERFORM 1000-INITIALIZE.                                     02980000
029900                                                                  02990000
030000     PERFORM 2000-MAIN-PROCESS                                    03000000
030100        UNTIL  PS-EOF-INPUT-FILE.                                 03010099
030200                                                                  03020000
030300     PERFORM 9000-END-PROCESS                                     03030006
030400                                                                  03040000
030500     STOP RUN.                                                    03050006
030600                                                                  03060000
030700******************************************************************03070004
030800* OPEN INPUT/OUTPUT FILES, READ THE FIRST INPUT FIELD.           *03080004
030900******************************************************************03090004
031000 1000-INITIALIZE.                                                 03100000
031100     OPEN INPUT  TROUBLE-EXTRACT-FILE                             03110099
031200          OUTPUT FFA-REPORT-FILE.                                 03120099
031300                                                                  03130005
031400     INITIALIZE PA-PROGRAM-ACCUMULATORS.                          03140018
031500                                                                  03150018
031600     EXEC SQL                                                     03160005
031700         SET :PV-CURRENT-DATE   = CURRENT DATE                    03170005
031800     END-EXEC.                                                    03180007
031900     IF SQLCODE = 0                                               03190006
032000         CONTINUE                                                 03200099
032100     ELSE                                                         03210006
032200         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              03220006
032300         MOVE 'SET THE CURRENT DATE'                              03230006
032400                               TO  PV-DB2-OPERATION-ATTEMPTED     03240006
032500         PERFORM 9999-SQL-ABEND                                   03250006
032600     END-IF.                                                      03260006
034600                                                                  03460099
034900     EXEC SQL                                                     03490005
035000         SET :PV-CURRENT-TIME   = CURRENT TIME                    03500005
035100     END-EXEC.                                                    03510007
035200     IF SQLCODE = 0                                               03520006
035300         CONTINUE                                                 03530099
035400     ELSE                                                         03540006
035500         MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME              03550006
035600         MOVE 'SET THE CURRENT TIME'                              03560006
035700                               TO  PV-DB2-OPERATION-ATTEMPTED     03570006
035800         PERFORM 9999-SQL-ABEND                                   03580006
035900     END-IF.                                                      03590006
036000                                                                  03600099
036500     MOVE PV-CURRENT-HOUR               TO DP132O-RUN-HOUR.       03650005
036600     MOVE PV-CURRENT-MINUTE             TO DP132O-RUN-MINUTE.     03660005
036700                                                                  03670005
036800     MOVE PV-CURRENT-YEAR               TO DP132O-RUN-YEAR.       03680005
036900     MOVE PV-CURRENT-MONTH              TO DP132O-RUN-MONTH.      03690005
037000     MOVE PV-CURRENT-DAY                TO DP132O-RUN-DAY.        03700005
037100                                                                  03710005
037200     MOVE PC-CURRENT-PROGRAM-NAME       TO DP132O-PROGRAM-NAME.   03720005
037300     MOVE 1                             TO DP132O-REPORT-NUMBER.  03730099
037400                                                                  03740004
037500     PERFORM 8000-READ-INPUT-FILE.                                03750005
037600                                                                  03760004
037700     EVALUATE TRUE                                                03770005
037800     WHEN PS-EOF-INPUT-FILE                                       03780005
088200         PERFORM 3000-PRINT-PAGE-HEADING                          03781099
111900         WRITE FFA-REPORT-RECORD                                  03782099
112000               FROM ND-NO-DATA-LINE                               03783099
112100         AFTER ADVANCING 3                                        03784099
038000                                                                  03800005
038100     WHEN OTHER                                                   03810099
038400         STRING TM002-END-MM '/'                                  03811099
038500                TM002-END-DD '/'                                  03812099
038600                TM002-END-YYYY DELIMITED BY SIZE                  03813099
038700                                  INTO HL1-REPORT-DATE            03814099
038200         IF TM002-RUN-SPECIAL                                     03820099
038300             MOVE PC-SPECIAL-RUN-NOTE   TO HL1-SPECIAL-RUN-NOTE   03830004
038400*            STRING TM002-END-MM '/'                              03840099
038500*                   TM002-END-DD '/'                              03850099
038600*                   TM002-END-YYYY DELIMITED BY SIZE              03860099
038700*                                     INTO HL1-REPORT-DATE        03870099
039900*        ELSE                                                     03990099
040000*            MOVE SPACES                TO HL1-SPECIAL-RUN-NOTE   04000099
040100*            STRING PV-CURRENT-MONTH '/'                          04010099
040200*                   PV-CURRENT-DAY  '/'                           04020099
040300*                   PV-CURRENT-YEAR  DELIMITED BY SIZE            04030099
040400*                                     INTO HL1-REPORT-DATE        04040099
040900*            STRING PV-CURRENT-HOUR ':'                           04090099
041000*                   PV-CURRENT-MINUTE  DELIMITED BY SIZE          04100099
041100*                                     INTO HL1-REPORT-TIME        04110099
041200         END-IF                                                   04120004
045200*        PERFORM 3000-PRINT-PAGE-HEADING                          04126099
042400     END-EVALUATE.                                                04240005
042500*                                                                 04250005
043600 2000-MAIN-PROCESS.                                               04360000
045400     PERFORM 2100-CREATE-FFA-TRBL-RPT                             04540099
037500     PERFORM 8000-READ-INPUT-FILE.                                04560099
048300                                                                  04830073
054600 2100-CREATE-FFA-TRBL-RPT.                                        05460099
044500     IF TM002-OPER-UNT-ID NOT = PV-SAVE-OPER-UNT-ID               05461099
118100         PERFORM 3000-PRINT-PAGE-HEADING                          05461199
118800*        ADD +3                 TO PV-LINE-COUNT                  05461299
      *        MOVE +3                TO PV-LINE-ADVANCE                05461399
      *        MOVE TM002-OPER-UNT-ID TO DL1-DC                         05461499
      *        MOVE TM002-DC-NAME     TO DL1-DC-NAME                    05461599
      *        MOVE DL1-DETAIL-LINE   TO FFA-REPORT-RECORD              05461699
056300*        PERFORM 8100-WRITE-REPORT-LINE                           05461799
044500         MOVE TM002-OPER-UNT-ID TO PV-SAVE-OPER-UNT-ID            05462299
044500         MOVE SPACES            TO PV-SAVE-ASSOCIATE-NAME         05462399
           END-IF.                                                      05462499
044500     IF TM002-ASSOCIATE-NAME NOT = PV-SAVE-ASSOCIATE-NAME         05462599
118800         ADD +3 TO PV-LINE-COUNT                                  05462699
      * * ADD +3 TO INCLUDE SPACE FOR 1 VENDOR DETAIL LINE ALSO         05462799
117800         IF PV-LINE-COUNT   > PC-MAX-REPORT-LINES                 05462899
118100             PERFORM 3000-PRINT-PAGE-HEADING                      05462999
               ELSE                                                     05463099
                   SUBTRACT +1 FROM PV-LINE-COUNT                       05463199
118200         END-IF                                                   05463299
               MOVE +2                TO PV-LINE-ADVANCE                05463399
               MOVE TM002-ASSOCIATE-NAME                                05463499
                                      TO DL2-ASSOCIATE-NAME             05463599
               MOVE DL2-DETAIL-LINE   TO FFA-REPORT-RECORD              05463699
056300         PERFORM 8100-WRITE-REPORT-LINE                           05463799
044500         MOVE TM002-ASSOCIATE-NAME                                05463899
044500                                TO PV-SAVE-ASSOCIATE-NAME         05463999
           END-IF.                                                      05464099
054700                                                                  05470005
054800     MOVE TM002-ENT-NAME-DESC        TO DL3-VENDOR-NAME           05480099
054800     IF TM002-ENT-ID NUMERIC                                      05490099
054800         MOVE TM002-ENT-ID           TO DL3-VENDOR-NBR            05490199
           ELSE                                                         05490299
054800         MOVE TM002-ENT-ID-X         TO DL3-VENDOR-NBR-X          05490399
           END-IF.                                                      05490499
054800     MOVE TM002-PO-NBR               TO DL3-PO-NBR.               05491099
054800     MOVE TM002-REC-SEQ-NBR          TO DL3-REC-SEQ-NBR.          05492099
           EVALUATE TM002-TRBL-RSN-CDE                                  05492199
054800         WHEN 805                                                 05492299
054800             MOVE TM002-PO-LNE-NBR   TO DL3-LINE-OR-PACK          05493099
               WHEN 804                                                 05494099
054800             MOVE TM002-PO-PREPK-ID  TO DL3-LINE-OR-PACK          05494199
               WHEN OTHER                                               05494299
054800             MOVE SPACES             TO DL3-LINE-OR-PACK-X        05494399
           END-EVALUATE.                                                05495099
054800     IF TM002-TRBL-RSN-CDE = 806                                  05496099
054800         MOVE SPACES                 TO DL3-UPC-NBR-X             05496199
054800                                        DL3-SKU-NBR-X             05496299
           ELSE                                                         05498099
054800         IF TM002-UPC-NBR NUMERIC                                 05499199
054800             MOVE TM002-UPC-NBR      TO DL3-UPC-NBR               05499299
               ELSE                                                     05499399
054800             MOVE TM002-UPC-NBR-X    TO DL3-UPC-NBR-X             05499499
               END-IF                                                   05499599
054800         IF TM002-SKU-NBR NUMERIC                                 05499699
054800             MOVE TM002-SKU-NBR      TO DL3-SKU-NBR               05499799
               ELSE                                                     05499899
054800             MOVE TM002-SKU-NBR-X    TO DL3-SKU-NBR-X             05499999
               END-IF                                                   05500099
           END-IF.                                                      05500199
054800     IF TM002-AUD-CNTL-NBR NUMERIC                                05501099
054800         MOVE TM002-AUD-CNTL-NBR     TO DL3-AUDIT-NBR             05502099
           ELSE                                                         05502199
054800         MOVE TM002-AUD-CNTL-NBR-X   TO DL3-AUDIT-NBR-X           05503099
           END-IF.                                                      05504099
054800     MOVE TM002-TRBL-LONG-DESC       TO DL3-TROUBLE-REASON.       05510099
056200                                                                  05620005
118800     ADD +1 TO PV-LINE-COUNT                                      05621099
117800     IF PV-LINE-COUNT   > PC-MAX-REPORT-LINES                     05622299
118100         PERFORM 3000-PRINT-PAGE-HEADING                          05622399
118200     END-IF.                                                      05622499
118300                                                                  05622599
           MOVE +1                         TO PV-LINE-ADVANCE           05622699
           MOVE DL3-DETAIL-LINE            TO FFA-REPORT-RECORD         05623099
056300     PERFORM 8100-WRITE-REPORT-LINE.                              05630005
056400                                                                  05640005
087800****************************************************************  08780006
087900* 3000-PRINT-PAGE-HEADING.                                     *  08790006
088000* PRINTS THE HEADINGS AT THE TOP OF EACH PAGE.                 *  08800006
088100****************************************************************  08810006
088200 3000-PRINT-PAGE-HEADING.                                         08820006
088300                                                                  08830006
088500     ADD +1                     TO PV-PAGE-NUMBER                 08850099
088600*    MOVE +5                    TO PV-LINE-COUNT                  08860099
088600     MOVE +7                    TO PV-LINE-COUNT                  08861099
088700     MOVE PV-PAGE-NUMBER        TO DP132O-PAGE-NUMBER             08870099
088800     MOVE 1                     TO DP132O-REPORT-NUMBER           08880099
088900     WRITE FFA-REPORT-RECORD                                      08890099
089000         FROM DP132O-STANDRD-HEADER-132-COLS                      08900099
089100     AFTER ADVANCING PAGE                                         08910099
089200     WRITE FFA-REPORT-RECORD                                      08920099
089300         FROM HL1-HEADING-LINE-1                                  08930099
089400     AFTER ADVANCING 2                                            08940099
089500     WRITE FFA-REPORT-RECORD                                      08950099
089600         FROM HL2-HEADING-LINE-2                                  08960099
089700     AFTER ADVANCING 2.                                           08970099
           MOVE TM002-OPER-UNT-ID TO DL1-DC                             08980099
           MOVE TM002-DC-NAME     TO DL1-DC-NAME                        08990099
           WRITE FFA-REPORT-RECORD                                      09000099
               FROM DL1-DETAIL-LINE                                     09010099
089700     AFTER ADVANCING 2.                                           09020099
091900                                                                  09190006
106600****************************************************************  10660018
106700* 3400-PRINT-BLANK-LINE                                        *  10670018
106800* PRINTS THE HEADING LINE ON A CHANGE IN DC                    *  10680018
106900****************************************************************  10690018
107000 3400-PRINT-BLANK-LINE.                                           10700018
107100                                                                  10710018
107300     WRITE FFA-REPORT-RECORD                                      10730099
107400           FROM BL-BLANK-LINE                                     10740099
107500           AFTER ADVANCING 1                                      10750099
107600     ADD +1 TO PV-LINE-COUNT.                                     10760099
108300                                                                  10830018
108400                                                                  10840018
116400*                                                                 11640099
116500 8000-READ-INPUT-FILE.                                            11650099
116600      READ TROUBLE-EXTRACT-FILE                                   11660099
116700            INTO TM002-TROUBLE-EXT-RECORD                         11670099
116800      AT END                                                      11680099
116900             SET PS-EOF-INPUT-FILE TO TRUE.                       11690099
117000                                                                  11700099
117100****************************************************************  11710099
117200* 8100-WRITE-REPORT-LINE                                       *  11720099
117300* WRITE A TROUBLE REPORT RECORD                                *  11730099
117400****************************************************************  11740099
117500 8100-WRITE-REPORT-LINE.                                          11750099
117600                                                                  11760006
118500     WRITE FFA-REPORT-RECORD                                      11850099
118700     AFTER ADVANCING PV-LINE-ADVANCE.                             11870099
119500                                                                  11950004
119600****************************************************************  11960006
119700* 9000-END-PROCESS.                                            *  11970006
119800* END OF PROGRAM PROCESSING                                    *  11980006
119900****************************************************************  11990006
120000 9000-END-PROCESS.                                                12000000
120300                                                                  12030042
120400     WRITE FFA-REPORT-RECORD                                      12040099
120500       FROM ER-END-REPORT-LINE                                    12050045
120600           AFTER ADVANCING 2 LINES.                               12060045
121000                                                                  12100045
121100     CLOSE  TROUBLE-EXTRACT-FILE                                  12110000
121200            FFA-REPORT-FILE.                                      12120099
121300                                                                  12130000
121400 9999-SQL-ABEND.                                                  12140006
121500                                                                  12150000
121600     DISPLAY '** ABEND     **'.                                   12160006
121700     DISPLAY '** PROGRAM   ** = TMKRP022'.                        12170099
121800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              12180006
121900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     12190006
122000                                                                  12200006
122100* DISPLAY SQLCA IN READABLE FORMAT.                               12210006
122200     COPY DPPD004.                                                12220000
122300                                                                  12230000
122400     MOVE +4013 TO PV-ABEND-CODE.                                 12240000
122500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12250000
122600                                                                  12260000
