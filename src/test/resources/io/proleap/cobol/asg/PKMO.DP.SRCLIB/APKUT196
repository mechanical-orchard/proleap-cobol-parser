000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.     APKUT196.                                        00020002
000300 AUTHOR.         NANCY EILBES                                     00030002
000400 DATE-WRITTEN.   JULY 2003.                                       00040002
000500 DATE-COMPILED.                                                   00050002
000600******************************************************************00060002
000700* COBOL 2 BATCH                                                  *00070002
000800*    SUMMARIZE JOURNALIZED IMPORT PO COST AND QUANTITY DATA      *00080002
000900*                                                                *00090002
001000*    THIS PROGRAM CREATES A SUMMARY REPORT FILE FOR THE IMPORT   *00100002
001100*    PURCHASE ORDERS JOURNALIZED DURING THE TIME PERIOD BEING    *00110002
001200*    REPORTED. THE PROGRAM USES THE IMPORT REPORT RECORDS FOR    *00120002
001300*    JOURNALIZED POS, PRINGING IN ONLY THE HEADER AND LANDED     *00130002
001400*    COST DETAIL RECORDS.  THESE RECORDS ARE USED TO CALCULATE   *00140002
001410*    THE DIFFERENCE BETWEEN RECEIPT AND INVOICE QUANTITY AND     *00141002
001600*    THE DIFFERENCE BETWEEN RECEIPT AND INVOICE COST.  THESE     *00160002
001800*    DIFFERENCES, ALONG WITH OTHER PERTINENT INFORMATION, ARE    *00180002
001900*    WRITTEN OUT TO A NEW FILE WHICH WILL BE SORTED BY THE       *00190007
002000*    QUANTITY DIFFERENCE AND COST DIFFERENCE AND THEN USED TO    *00200007
002100*    PRODUCE THE REPORT.                                         *00210002
002110*                                                                *00211002
002200* INPUT:                                                         *00220002
002300*  1. IMPORT PO COST VARIANCE REPORTING FILE  (APRD036)          *00230002
002400*                                                                *00240002
002500* OUTPUT:                                                        *00250002
002600*  1. JOURNALIZED IMPORT PO SUMMARY REPORT FILE (APRD080)        *00260002
002700*                                                                *00270002
002800*----------------------------------------------------------------*00280002
002900* CHANGE LOG:                                                    *00290002
003000* DATE  07/16/2003                                               *00300002
003100*     CHANGE MADE: INITIAL VERSION                               *00310002
003200*     MADE BY: NANCY EILBES            WR/IR #: WR24863          *00320002
003210*                                                                *00321008
003220* DATE  03/16/2009                                               *00322010
003230*     CHANGE MADE: RECOMPILE FOR ADDITION OF DMA-NBR TO APRD036. *00323009
003240*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR31546          *00324008
003900******************************************************************00390002
004000                                                                  00400002
004100                                                                  00410002
004200 ENVIRONMENT DIVISION.                                            00420002
004300 CONFIGURATION SECTION.                                           00430002
004400 SOURCE-COMPUTER.    IBM-3090.                                    00440002
004500 OBJECT-COMPUTER.    IBM-3090.                                    00450002
004600                                                                  00460002
004700 INPUT-OUTPUT SECTION.                                            00470002
004800 FILE-CONTROL.                                                    00480002
004900     SELECT IMPORT-PO-FILE ASSIGN TO UT-S-INP01.                  00490002
005000     SELECT SUMMARY-RPT-FILE ASSIGN TO UT-S-OUT01.                00500006
005100                                                                  00510002
005200 DATA DIVISION.                                                   00520002
005300 FILE SECTION.                                                    00530002
005400                                                                  00540002
005500 FD  IMPORT-PO-FILE                                               00550002
005600     RECORDING MODE IS F                                          00560002
005700     LABEL RECORDS ARE STANDARD                                   00570002
005800     BLOCK CONTAINS 0 RECORDS                                     00580002
005900     DATA RECORD IS IMPORT-PO-REC.                                00590002
006000 01  IMPORT-PO-REC                    PIC X(170).                 00600002
006100                                                                  00610002
006200 FD  SUMMARY-RPT-FILE                                             00620002
006300     RECORDING MODE IS F                                          00630002
006400     LABEL RECORDS ARE STANDARD                                   00640002
006500     BLOCK CONTAINS 0 RECORDS                                     00650002
006600     DATA RECORD IS SUMMARY-RPT-REC.                              00660002
006700 01  SUMMARY-RPT-REC                  PIC X(125).                 00670002
006800 EJECT                                                            00680002
006900                                                                  00690002
007000 WORKING-STORAGE SECTION.                                         00700002
007100                                                                  00710002
007200 01  PV-PROGRAM-VARIABLES.                                        00720002
007300     05  FILLER                      PIC X(30) VALUE              00730002
007400         '** BEGINING OF APKUT196 W/S **'.                        00740002
007600     05  PV-PROGRAM-NAME             PIC X(08) VALUE 'APKUT196'.  00760002
008800     05  SAVE-PO-NBR                 PIC X(9)  VALUE SPACES.      00880002
009000     05  PV-QTY-DIFF-AMT             PIC S9(9) VALUE ZERO         00900002
009100                                               COMP-3.            00910002
009200     05  PV-COST-DIFF-AMT            PIC S9(11)V99 VALUE ZERO     00920002
009300                                               COMP-3.            00930002
009900                                                                  00990002
010400 01  PS-PROGRAM-SWITCHES.                                         01040002
010500     05  PS-END-OF-IMPORT-FILE-SW PIC X(01)  VALUE 'N'.           01050002
010600         88  END-OF-IMPORT-FILE              VALUE 'Y'.           01060002
010700                                                                  01070002
010800 EJECT                                                            01080002
019800*----------------------------------------------------------------*01980002
019900*  INPUT COPYBOOK                                                *01990002
020000*----------------------------------------------------------------*02000002
020100     COPY APRD036.                                                02010002
020110 EJECT                                                            02011003
020120*----------------------------------------------------------------*02012003
020130*  OUTPUT COPYBOOK                                               *02013003
020140*----------------------------------------------------------------*02014003
020150     COPY APRD080.                                                02015003
020200 EJECT                                                            02020002
020300 PROCEDURE DIVISION.                                              02030002
020400 A100-MAIN.                                                       02040002
020500                                                                  02050002
020800     PERFORM B100-INITIALIZE.                                     02080002
020900                                                                  02090002
021000     PERFORM B200-CREATE-SUMMARY-REPORT                           02100002
021100         UNTIL END-OF-IMPORT-FILE.                                02110002
021200                                                                  02120002
021300     PERFORM B300-END-OF-PROGRAM.                                 02130002
021400     GOBACK.                                                      02140002
021500 EJECT                                                            02150002
021600*----------------------------------------------------------------*02160002
021700*    INITIALIZATION PROCESSING                                   *02170002
021900*----------------------------------------------------------------*02190002
022000 B100-INITIALIZE.                                                 02200002
022300                                                                  02230002
022400     OPEN INPUT  IMPORT-PO-FILE.                                  02240002
022500     OPEN OUTPUT SUMMARY-RPT-FILE.                                02250002
023900                                                                  02390002
024000     PERFORM R100-READ-IMPORT-PO-FILE.                            02400002
024400                                                                  02440002
024500 EJECT                                                            02450002
024600*----------------------------------------------------------------*02460002
024700* THE INPUT FILE WILL CONTAIN 2 RECORDS FOR EACH PO. THE NEEDED  *02470002
024800* FIELDS WILL BE MOVED FROM THE HEADER AND THE NEXT RECORD WILL  *02480002
024900* BE READ.  WHEN A DETAIL RECORD IS FOUND THAT IS TYPE 'M1' AND  *02490002
025000* THE PO MATCHES THE ONE FROM THE HEADER THAT WAS JUST PROCESSED,*02500002
025100* A RECORD WILL BE WRITTEN TO THE REPORT FILE.  OTHERWISE, A     *02510002
025200* MESSAGE WILL DISPLAY AND THE PO WILL BE BYPASSED.              *02520002
025300*----------------------------------------------------------------*02530002
025400 B200-CREATE-SUMMARY-REPORT.                                      02540002
025700                                                                  02570002
025800     IF AP036-HEADER                                              02580002
025900        MOVE AP036-VENDOR-NAME     TO AP080-VENDOR-NAME           02590002
026000        MOVE AP036-PO-NBR          TO AP080-PO-NBR                02600002
026100                                      SAVE-PO-NBR                 02610002
026200        MOVE AP036-DEPT-NBR        TO AP080-DEPT-NBR              02620002
026300        MOVE AP036-1ST-INVC-DTE    TO AP080-1ST-INVC-DTE          02630002
026400        MOVE AP036-RCV-UNT-QTY     TO AP080-RCV-UNT-QTY           02640002
026500        MOVE AP036-INV-UNT-QTY     TO AP080-INV-UNT-QTY           02650002
026600        COMPUTE PV-QTY-DIFF-AMT =                                 02660002
026700             AP036-INV-UNT-QTY - AP036-RCV-UNT-QTY                02670002
026800        MOVE PV-QTY-DIFF-AMT       TO AP080-QTY-DIFFERENCE        02680002
026900     ELSE                                                         02690002
027000        IF  AP036-DETAIL                                          02700002
027100        AND AP036-TOTAL-LANDED-COST                               02710002
027200        AND AP036-PO-NBR = SAVE-PO-NBR                            02720002
027300            MOVE AP036-RCV-COST-AMT  TO AP080-RCV-COST-AMT        02730004
027400            MOVE AP036-INV-COST-AMT  TO AP080-INV-COST-AMT        02740005
027500            COMPUTE PV-COST-DIFF-AMT =                            02750002
027600                 AP036-INV-COST-AMT - AP036-RCV-COST-AMT          02760002
027700            MOVE PV-COST-DIFF-AMT    TO AP080-COST-DIFFERENCE     02770002
027710            IF  AP080-COST-DIFFERENCE = 0                         02771002
027720            AND AP080-QTY-DIFFERENCE = 0                          02772002
027730                DISPLAY '----------------------------------'      02773002
027740                DISPLAY 'NO COST OR QUANTITY DIFFERENCES FOUND'   02774002
027750                        ' FOR PO ' AP080-PO-NBR                   02775002
027760            ELSE                                                  02776002
027800                PERFORM W100-WRITE-REPORT-RECORD                  02780002
027810            END-IF                                                02781002
027900        ELSE                                                      02790002
028000            DISPLAY '--------------------------------------'      02800002
028100            DISPLAY 'MATCHING DETAIL NOT FOUND FOR HEADER. '      02810002
028200                    'PO NUMBER = ' SAVE-PO-NBR                    02820002
028300        END-IF                                                    02830002
028400     END-IF.                                                      02840002
028500                                                                  02850002
028600     PERFORM R100-READ-IMPORT-PO-FILE.                            02860002
028700 EJECT                                                            02870002
028800                                                                  02880002
028900                                                                  02890002
029000*----------------------------------------------------------------*02900002
029100* PERFORMS END OF PROGRAM PROCESSES.                             *02910002
029200*----------------------------------------------------------------*02920002
029300 B300-END-OF-PROGRAM.                                             02930002
029400                                                                  02940002
030100     DISPLAY 'PROGRAM APKUT196 COMPLETE'.                         03010002
030200                                                                  03020002
030300     CLOSE IMPORT-PO-FILE                                         03030002
030400           SUMMARY-RPT-FILE.                                      03040002
030500                                                                  03050002
030600 EJECT                                                            03060002
030700*----------------------------------------------------------------*03070002
030800*    READS THE IMPORT PO REPORT FILE.                            *03080002
030900*----------------------------------------------------------------*03090002
031000 R100-READ-IMPORT-PO-FILE.                                        03100002
031300                                                                  03130002
031400     READ IMPORT-PO-FILE INTO AP036-IMPORT-REPORT-RECORD          03140002
031500        AT END SET END-OF-IMPORT-FILE TO TRUE.                    03150002
031600                                                                  03160002
031610                                                                  03161002
031620*----------------------------------------------------------------*03162002
031630*    WRITES SUMMARIZED RECORDS TO THE SUMMARY REPORT FILE.       *03163002
031640*----------------------------------------------------------------*03164002
031700 W100-WRITE-REPORT-RECORD.                                        03170002
032000                                                                  03200002
033200     WRITE SUMMARY-RPT-REC FROM AP080-IMPORT-EXCEPT-RPT-RECORD.   03320003
033400                                                                  03340002
