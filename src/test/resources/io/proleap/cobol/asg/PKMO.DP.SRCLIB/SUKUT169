000100******************************************************************00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300******************************************************************00030003
000400 PROGRAM-ID.    SUKUT169.                                         00040003
000500 AUTHOR.        GERMAN BANDA.                                     00050003
000600 INSTALLATION.  KOHLS.                                            00060003
000700 DATE-WRITTEN   JUNE, 2020.                                       00070003
000800 DATE-COMPILED.                                                   00080003
000900******************************************************************00090003
001000*  THIS PROGRAM WILL FETCH SEASONAL SET YEAR AND SHORT NAME       00100004
001100*  WHERE THE PURGE DATE IS EQUAL TO THE BATCH RUN DATE. THE       00110004
001110*  SET CODE(S) WILL BE DETERMINED BY A LOOKUP OF                  00111004
001120*  INTERGRATION PARM (PKHLDSET) AND WRITTEN TO AN OUTPUT FILE.    00112004
001160******************************************************************00116003
001170******************************************************************00117003
001180*  CHANGE LOG                                                     00118003
001190*  DATE       CHANGED BY    DESC                                  00119003
001200*  ---------- ------------- --------------------------------------00120003
001300*  00-00-2020 GERMAN BANDA  INITIAL PROGRAM FOR PACK AND HOLD     00130003
001400*                           PROCESSING FOR INVENTORY RECORD       00140004
001410*                           ARCHIVE PROCESSING                    00141004
001500******************************************************************00150003
001600 ENVIRONMENT DIVISION.                                            00160003
001700 CONFIGURATION SECTION.                                           00170003
001800                                                                  00180003
001900 SOURCE-COMPUTER.        IBM-3090.                                00190003
002000 OBJECT-COMPUTER.        IBM-3090.                                00200003
002100                                                                  00210003
002200 INPUT-OUTPUT SECTION.                                            00220003
002300 FILE-CONTROL.                                                    00230003
002400                                                                  00240003
002500     SELECT BATCH-DATE-IN                                         00250003
002600         ASSIGN TO INP01.                                         00260003
002700                                                                  00270003
002800     SELECT SEASET-PURGE-FILE                                     00280003
002900         ASSIGN TO OUT01.                                         00290003
003000                                                                  00300003
003100                                                                  00310003
003200******************************************************************00320003
003300 DATA DIVISION.                                                   00330003
003400 FILE SECTION.                                                    00340003
003500                                                                  00350003
003600 FD  BATCH-DATE-IN                                                00360003
003700     RECORDING MODE IS F                                          00370003
003800     LABEL RECORDS ARE STANDARD                                   00380003
003900     BLOCK CONTAINS 0 RECORDS.                                    00390003
004000                                                                  00400003
004100 01  BATCH-DATE-RECORD-IN               PIC  X(80).               00410003
004200*                                                                 00420003
004300 FD  SEASET-PURGE-FILE                                            00430003
004400     RECORDING MODE IS F                                          00440003
004500     LABEL RECORDS ARE STANDARD                                   00450003
004600     BLOCK CONTAINS 0 RECORDS.                                    00460003
004700                                                                  00470003
004800 01  SEASET-PURGE-RECORD     PIC  X(30).                          00480003
004900*                                                                 00490003
005000******************************************************************00500003
005100 WORKING-STORAGE SECTION.                                         00510003
005200******************************************************************00520003
005300******************************************************************00530003
005400*  CARTON OUTPUT FILE LAYOUT                                      00540003
005500******************************************************************00550003
005600     COPY SURD171.                                                00560003
005700                                                                  00570003
005800******************************************************************00580003
005900*  DB2 FORMATTED MESSAGE AREA                                     00590003
006000******************************************************************00600003
006100     COPY DPWS004.                                                00610003
006200*                                                                 00620003
006300******************************************************************00630003
006400*  COMMUNICATIONS AREA FOR DB2                                    00640003
006500******************************************************************00650003
006600     EXEC SQL                                                     00660003
006700          INCLUDE SQLCA                                           00670003
006800     END-EXEC.                                                    00680003
006900*                                                                 00690003
011900******************************************************************01190003
012000*     WST_INTGRTN_TYP TABLE                                       01200003
012100******************************************************************01210003
012200     EXEC SQL                                                     01220003
012300          INCLUDE WST00008                                        01230003
012400     END-EXEC.                                                    01240003
012500                                                                  01250003
012600******************************************************************01260003
012700*     WST_ATTR_DEFN TABLE                                         01270003
012800******************************************************************01280003
012900     EXEC SQL                                                     01290003
013000          INCLUDE WST00009                                        01300003
013100     END-EXEC.                                                    01310003
013200                                                                  01320003
013300******************************************************************01330003
013400*    WST_ATTR_ELEM TABLE                                          01340003
013500******************************************************************01350003
013600     EXEC SQL                                                     01360003
013700          INCLUDE WST00010                                        01370003
013800     END-EXEC.                                                    01380003
013900******************************************************************01390003
014000 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01400003
014100                                                   COMP SYNC.     01410003
014200 01  PV-INPUT-FILE.                                               01420003
014300     05  BTCH-RUN-DATE               PIC  X(10)    VALUE SPACES.  01430003
014400     05  FILLER                      PIC  X(70)    VALUE SPACES.  01440003
014600                                                                  01460003
014700 01  PS-PROGRAM-SWITCHES.                                         01470003
014800     05  PS-END-OF-CONTROL-SW        PIC  X(01)    VALUE 'N'.     01480003
014900         88  PS-END-OF-CONTROL                     VALUE 'Y'.     01490003
015000         88  PS-NOT-END-OF-CONTROL                 VALUE 'N'.     01500003
015100     05  PS-END-OF-SET-ELEM-CSR-SW PIC X(01)       VALUE 'N'.     01510003
015200         88  PS-END-OF-SET-ELEM-CSR                VALUE 'Y'.     01520003
015300         88  PS-NOT-END-OF-SET-ELEM-CSR            VALUE 'N'.     01530003
015400     05  PS-END-OF-CRTN-DETL-CSR-SW  PIC  X(01)    VALUE 'N'.     01540003
015500         88  PS-END-OF-CRTN-DETL-CSR               VALUE 'Y'.     01550003
015600         88  PS-NOT-END-OF-CRTN-DETL-CSR           VALUE 'N'.     01560003
015700                                                                  01570003
015800 01  PC-PROGRAM-CONSTANTS.                                        01580003
015900     05  PC-A                        PIC  X(01)    VALUE 'A'.     01590003
016000     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT169'. 01600003
016100     05  PC-CURRENT-TIMESTAMP        PIC  X(26) VALUE SPACES.     01610003
016200                                                                  01620003
016300 01  PV-PROGRAM-VARIABLES.                                        01630003
016400     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01640003
016500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01650003
016600     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01660003
016700     05  PV-PURGE-TIMESTAMP          PIC  X(26)    VALUE SPACE.   01670003
016800     05  PV-SEASET-YR                PIC   X(4)    VALUE SPACE.   01680003
016900     05  PV-SEASET-SHRT-NM           PIC   X(5)    VALUE SPACE.   01690003
017000     05  PV-DISPLAY-CARTON           PIC  9(18)    VALUE ZEROES.  01700003
017100                                                                  01710003
017200 01  COUNTERS.                                                    01720003
017300     05  PV-SET-ELEM-COUNTER         PIC  S9(9) COMP-3.           01730004
017400     05  PV-SCN-DETL-COUNTER         PIC  S9(9) COMP-3.           01740003
017500     05  PV-RECORDS-WRITTEN          PIC  S9(9) COMP-3.           01750003
017600     05  PV-CARTON-COUNT             PIC  S9(9) COMP-3.           01760003
017700                                                                  01770003
017800*---------------------------------------------------------------* 01780003
017900*    SCAN-CTN CURSOR                                              01790003
018000*---------------------------------------------------------------* 01800003
018100     EXEC SQL                                                     01810003
018200        DECLARE SET-ELEM-CSR CURSOR FOR                           01820003
018300        SELECT DISTINCT                                           01830003
018400             CC.ATTR_ELEM_TXT                                     01840003
018500           , DD.ATTR_ELEM_TXT                                     01850003
019600        FROM WST_INTGRTN_TYP  AA                                  01960003
019700           , WST_ATTR_DEFN    BB                                  01970003
019800           , WST_ATTR_ELEM    CC                                  01980003
019900           , WST_ATTR_ELEM    DD                                  01990003
020000           , WST_ATTR_ELEM    EE                                  02000003
020100           , WST_ATTR_ELEM    FF                                  02010003
020200           , WST_ATTR_ELEM    GG                                  02020003
020300           , WST_ATTR_ELEM    HH                                  02030003
021410        WHERE  DATE(GG.ATTR_ELEM_TMST) = :BTCH-RUN-DATE           02141004
021500           AND AA.INTGRTN_TYP_CDE   = 'PKHLDSET'                  02150003
021600           AND AA.INTGRTN_TYP_CDE   = BB.INTGRTN_TYP_CDE          02160003
021700           AND BB.ATTR_DEFN_SEQ_NBR = 1                           02170003
021800           AND BB.INTGRTN_TYP_CDE   = CC.INTGRTN_TYP_CDE          02180003
021900           AND CC.ATTR_DEFN_SEQ_NBR = 1                           02190003
022000           AND BB.INTGRTN_TYP_CDE   = DD.INTGRTN_TYP_CDE          02200003
022100           AND DD.ATTR_DEFN_SEQ_NBR = 2                           02210003
022200           AND BB.INTGRTN_TYP_CDE   = EE.INTGRTN_TYP_CDE          02220003
022300           AND EE.ATTR_DEFN_SEQ_NBR = 3                           02230003
022400           AND BB.INTGRTN_TYP_CDE   = FF.INTGRTN_TYP_CDE          02240003
022500           AND FF.ATTR_DEFN_SEQ_NBR = 4                           02250003
022600           AND BB.INTGRTN_TYP_CDE   = GG.INTGRTN_TYP_CDE          02260003
022700           AND GG.ATTR_DEFN_SEQ_NBR = 5                           02270003
022800           AND BB.INTGRTN_TYP_CDE   = HH.INTGRTN_TYP_CDE          02280003
022900           AND HH.ATTR_DEFN_SEQ_NBR = 6                           02290003
023000           AND CC.ATTR_ELEM_SEQ_NBR = DD.ATTR_ELEM_SEQ_NBR        02300003
023100           AND CC.ATTR_ELEM_SEQ_NBR = EE.ATTR_ELEM_SEQ_NBR        02310003
023200           AND CC.ATTR_ELEM_SEQ_NBR = FF.ATTR_ELEM_SEQ_NBR        02320003
023300           AND CC.ATTR_ELEM_SEQ_NBR = GG.ATTR_ELEM_SEQ_NBR        02330003
023400           AND CC.ATTR_ELEM_SEQ_NBR = HH.ATTR_ELEM_SEQ_NBR        02340003
023500           AND HH.ATTR_ELEM_TXT     = 'Y'                         02350003
023800           AND EE.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP           02380003
023900           AND FF.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP           02390003
023910          ORDER BY 1,2                                            02391007
024000        WITH UR                                                   02400003
024100     END-EXEC.                                                    02410003
024200                                                                  02420003
024300*---------------------------------------------------------------* 02430003
024806                                                                  02480603
024807******************************************************************02480703
024808 PROCEDURE DIVISION.                                              02480803
024809******************************************************************02480903
024810******************************************************************02481003
024820* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02482003
024830*      PROGRAM.                                                   02483003
024840******************************************************************02484003
024850 0000-PROGRAM-MAINLINE.                                           02485003
024860                                                                  02486003
024870     DISPLAY '***** SUKUT169 STARTED *****'.                      02487003
024880                                                                  02488003
024890     PERFORM 1000-INITIALIZE.                                     02489003
024900     IF PS-NOT-END-OF-CONTROL                                     02490003
025000         PERFORM 2000-PROCESS-SCAN-CRTN-DATA                      02500003
025100     END-IF.                                                      02510003
025200                                                                  02520003
025300     PERFORM 9000-EOJ-ROUTINE.                                    02530003
025400                                                                  02540003
025500     GOBACK.                                                      02550003
025600                                                                  02560003
025700******************************************************************02570003
025800*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02580003
025900*    -- OPEN INPUT FILE - DATE FILE                               02590003
026000*    -- OPEN OUTPUT FILE                                          02600003
026100******************************************************************02610003
026200 1000-INITIALIZE.                                                 02620003
026300                                                                  02630003
026400     INITIALIZE COUNTERS.                                         02640003
026500     OPEN INPUT  BATCH-DATE-IN.                                   02650003
026600     OPEN OUTPUT SEASET-PURGE-FILE.                               02660003
026700                                                                  02670003
026800     PERFORM 1200-READ-CONTROL-CARD.                              02680003
026900                                                                  02690003
026920                                                                  02692004
027000******************************************************************02700003
027100*  READ INPUT CONTROL CARD TO GET THE CURRENT BATCH PROCESSING    02710003
027200*  DATE.                                                          02720003
027300******************************************************************02730003
027400 1200-READ-CONTROL-CARD.                                          02740003
027500                                                                  02750003
027600     READ BATCH-DATE-IN                                           02760003
027700         INTO PV-INPUT-FILE                                       02770003
027800             AT END                                               02780003
027900                 MOVE 'Y' TO PS-END-OF-CONTROL-SW.                02790003
028000                                                                  02800003
028100     IF PS-END-OF-CONTROL                                         02810003
028200         DISPLAY ' '                                              02820003
028300         DISPLAY ' *** NO CONTROL CARD FOUND TO PROCESS ***'      02830003
028400         DISPLAY ' '                                              02840003
028500     ELSE                                                         02850003
028600         DISPLAY 'BATCH PROCESSING CONTROL CARD DATE  = '         02860003
028700                 BTCH-RUN-DATE                                    02870003
028800     END-IF.                                                      02880003
028900                                                                  02890003
029000******************************************************************02900003
029100*  BEGIN RETRIEVING THE NECESSARY DATA                            02910003
029200******************************************************************02920003
029300 2000-PROCESS-SCAN-CRTN-DATA.                                     02930003
029400                                                                  02940003
029500     INITIALIZE SU171-EXTRACT-RECORD.                             02950004
029600                                                                  02960003
029700     SET PS-NOT-END-OF-SET-ELEM-CSR TO TRUE.                      02970003
029800     PERFORM 2100-OPEN-SET-ELEM-CSR.                              02980003
029900     PERFORM 2200-FETCH-SET-ELEM-CSR.                             02990003
030000     PERFORM 2300-PROCESS-SET-ELEM-CSR UNTIL                      03000003
030100             PS-END-OF-SET-ELEM-CSR.                              03010003
030200     PERFORM 2400-CLOSE-SET-ELEM-CSR.                             03020003
030300                                                                  03030003
030400                                                                  03040003
030500******************************************************************03050003
030600*  OPEN SCANNED CARTON CURSOR.                                    03060003
030700******************************************************************03070003
030800 2100-OPEN-SET-ELEM-CSR.                                          03080003
030900                                                                  03090003
031000                                                                  03100003
031100     EXEC SQL                                                     03110003
031200         OPEN SET-ELEM-CSR                                        03120003
031300     END-EXEC.                                                    03130003
031400                                                                  03140003
031500     EVALUATE TRUE                                                03150003
031600         WHEN SQLCODE = ZERO                                      03160003
031700             CONTINUE                                             03170003
031800         WHEN SQLWARN0 NOT = SPACES                               03180003
031900         WHEN SQLCODE < ZERO                                      03190003
032000         WHEN SQLCODE > ZERO                                      03200003
032100             MOVE '2100-OPEN-SET-ELEM-CSR' TO    PV-PARAGRAPH-NAME03210003
032200             MOVE 'SELECT WST_ATTR_ELEM     '                     03220004
032300                                    TO PV-DB2-OPERATION-ATTEMPTED 03230003
032400             PERFORM 9100-SQL-ABEND                               03240003
032500     END-EVALUATE.                                                03250003
032600                                                                  03260003
032700                                                                  03270003
032800******************************************************************03280003
032900*  FETCH SCANNED CARTON CURSOR ROW.                               03290003
033000******************************************************************03300003
033100 2200-FETCH-SET-ELEM-CSR.                                         03310003
033200     EXEC SQL                                                     03320003
033300        FETCH SET-ELEM-CSR                                        03330003
033400         INTO  :PV-SEASET-YR                                      03340004
033500           ,   :PV-SEASET-SHRT-NM                                 03350004
034000     END-EXEC.                                                    03400003
034100                                                                  03410003
034200     EVALUATE TRUE                                                03420003
034300         WHEN SQLCODE = ZERO                                      03430003
034400             ADD +1 TO PV-SET-ELEM-COUNTER                        03440004
034500         WHEN SQLCODE = +100                                      03450003
034600             SET PS-END-OF-SET-ELEM-CSR TO     TRUE               03460003
034700         WHEN SQLWARN0 NOT = SPACES                               03470003
034800         WHEN SQLCODE < ZERO                                      03480003
034900         WHEN SQLCODE > ZERO                                      03490003
035000             MOVE '2200-FETCH-SET-ELEM-CSR' TO PV-PARAGRAPH-NAME  03500004
035100             MOVE 'SELECT WST_ATTR_ELEM     '                     03510004
035200                                   TO PV-DB2-OPERATION-ATTEMPTED  03520003
035300             PERFORM 9100-SQL-ABEND                               03530003
035400     END-EVALUATE.                                                03540003
035500                                                                  03550003
035600******************************************************************03560003
035700*  PROCESS INTEGRATION ELEMENT ROW.                               03570004
035800*  FETCH AND WRITE SEASONAL SET ROWS                              03580004
035900******************************************************************03590003
036000 2300-PROCESS-SET-ELEM-CSR.                                       03600003
036100                                                                  03610003
036200                                                                  03620003
036300     MOVE PV-SEASET-YR      TO SU171-SEASET-YR.                   03630004
036310     MOVE PV-SEASET-SHRT-NM TO SU171-SEASET-SHRT-NM.              03631004
036320     MOVE BTCH-RUN-DATE     TO SU171-BTCH-PRC-DTE.                03632004
036800                                                                  03680003
036900     PERFORM 8000-WRITE-OUTPUT.                                   03690004
036910                                                                  03691004
036920     PERFORM 2200-FETCH-SET-ELEM-CSR.                             03692006
036930                                                                  03693006
037000******************************************************************03700003
037100*  CLOSE SCANNED CARTON CURSOR.                                   03710003
037200******************************************************************03720003
037300 2400-CLOSE-SET-ELEM-CSR.                                         03730003
037400     EXEC SQL                                                     03740003
037500        CLOSE SET-ELEM-CSR                                        03750003
037600     END-EXEC.                                                    03760003
037700                                                                  03770003
037800     EVALUATE TRUE                                                03780003
037900         WHEN SQLCODE = ZERO                                      03790003
038000             CONTINUE                                             03800003
038100         WHEN SQLWARN0 NOT = SPACES                               03810003
038200         WHEN SQLCODE < ZERO                                      03820003
038300         WHEN SQLCODE > ZERO                                      03830003
038400             MOVE '2400-CLOSE-SET-ELEM-CSR' TO PV-PARAGRAPH-NAME  03840004
038500             MOVE 'SELECT WST_ATTR_ELEM   '                       03850004
038600                                   TO PV-DB2-OPERATION-ATTEMPTED  03860003
038700             PERFORM 9100-SQL-ABEND                               03870003
038800     END-EVALUATE.                                                03880003
038900                                                                  03890003
048900******************************************************************04890003
049000*  WRITE OUTPUT FILE.                                             04900003
049100******************************************************************04910003
049200 8000-WRITE-OUTPUT.                                               04920003
049300                                                                  04930003
049400     WRITE  SEASET-PURGE-RECORD                                   04940003
049500      FROM  SU171-EXTRACT-RECORD.                                 04950005
049600     ADD    +1   TO PV-RECORDS-WRITTEN.                           04960003
049700                                                                  04970003
049800******************************************************************04980003
049900*  DISPLAY COUNTERS.                                              04990003
050000******************************************************************05000003
050100 9000-EOJ-ROUTINE.                                                05010003
050200     CLOSE BATCH-DATE-IN                                          05020003
050300           SEASET-PURGE-FILE.                                     05030003
050400                                                                  05040003
050500     MOVE PV-SET-ELEM-COUNTER TO PV-DISPLAY-COUNT.                05050004
050600     DISPLAY 'SEASET ROWS FETCHED : '  PV-DISPLAY-COUNT.          05060004
050900     MOVE PV-RECORDS-WRITTEN TO PV-DISPLAY-COUNT.                 05090003
051000     DISPLAY 'TOTAL RECORDS OUT...: '  PV-DISPLAY-COUNT.          05100003
051100                                                                  05110003
051200     DISPLAY '*****  SUKUT169 ENDED  *****'.                      05120003
051300                                                                  05130003
051400******************************************************************05140003
051500*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05150003
051600*  ERROR OR WARNING CODE OCCURS.                                  05160003
051700******************************************************************05170003
051800 9100-SQL-ABEND.                                                  05180003
051900     DISPLAY '9100-SQL-ABEND'.                                    05190003
052000     DISPLAY '** ABEND     **'.                                   05200003
052100     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05210003
052200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05220003
052300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05230003
052500                                                                  05250003
052600******************************************************************05260003
052700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05270003
052800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05280003
052900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05290003
053000* FORMAT.                                                         05300003
053100******************************************************************05310003
053200     COPY DPPD004.                                                05320003
053300                                                                  05330003
053400     MOVE +4013                  TO ABEND-CODE.                   05340003
053500     CALL 'ILBOABN0' USING ABEND-CODE.                            05350003
053600                                                                  05360003
