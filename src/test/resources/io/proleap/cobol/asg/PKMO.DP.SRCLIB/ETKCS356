000100*-----------------------*                                         00010048
000200 IDENTIFICATION DIVISION.                                         00020048
000300*-----------------------*                                         00030048
000400 PROGRAM-ID.    ETKCS356.                                         00040048
000500 AUTHOR.        JILL LIN.                                         00050048
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060048
000700 DATE-WRITTEN.  08-24-07.                                         00070048
000800 DATE-COMPILED.                                                   00080048
000900                                                                  00090048
001000*---------------------------------------------------------------* 00100048
001100*    E356 - KOHLS EXTENDED SIZE LIST PROGRAM.                   * 00110048
001200*                                                               * 00120048
001300*    THIS PROGRAM GENERATES A LIST OF SIZES WITHIN A PARTICULAR * 00130048
001400*    SIZE GROUP.  THE NRF CODE, KOHLS, DESCRIPTION, PRIMARY     * 00140048
001500*    DESCRIPTION, AND SECONDARY DESCRIPTION ARE ALSO DISPLAYED. * 00150048
001600*    THE APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR       * 00160048
001700*    SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.      * 00170048
001800*                                                               * 00180048
001900*---------------------------------------------------------------* 00190048
001910* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00191050
001920*            - CHANGE CALL OF DPKUT100 TO                       * 00192050
001930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00193050
001940*              MAKING THE CALL DYNAMIC VS STATIC                * 00194050
001950*                                                               * 00195050
001900*---------------------------------------------------------------* 00195151
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00195251
CICS  *                                                               * 00195351
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00195451
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00195551
001950*                                                               * 00195651
001960*---------------------------------------------------------------* 00196050
002000 EJECT                                                            00200048
002100                                                                  00210048
002200 ENVIRONMENT DIVISION.                                            00220048
002300 DATA DIVISION.                                                   00230048
002400                                                                  00240048
002500 WORKING-STORAGE SECTION.                                         00250048
002600                                                                  00260048
002700 01  PC-PROGRAM-CONSTANTS.                                        00270048
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280048
002900                                                    'ET356A  '.   00290048
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300048
003100                                                    'ETKM356 '.   00310048
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320048
003300                                                    'ETKCS356'.   00330048
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340048
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350048
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00360048
003700                                                    COMP SYNC.    00370048
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00380048
003900                                                    COMP SYNC.    00390048
004000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00400048
004100                                                    +1000000      00410048
004200                                                    COMP-3.       00420048
004300     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00430048
004400                                                    COMP SYNC.    00440048
004500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00450048
004600                                                    COMP-3.       00460048
004700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00470048
004800                                                                  00480048
004900     05  PC-TSYMSG-NUMBERS.                                       00490048
005000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00500048
005100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00510048
005200         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00520048
005300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00530048
005400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00540048
005500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00550048
005600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00560048
005700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00570048
005800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00580048
005900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00590048
006000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00600048
006100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00610048
006200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00620048
006300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00630048
006400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00640048
006500                                                                  00650048
006600 01  PS-PROGRAM-SWITCHES.                                         00660048
006700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00670048
006800         88  PS-NO-ERROR                            VALUE 'Y'.    00680048
006900         88  PS-ERROR                               VALUE 'N'.    00690048
007000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00700048
007100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00710048
007200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00720048
007300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00730048
007400         88  PS-DONE                                VALUE 'Y'.    00740048
007500         88  PS-NOT-DONE                            VALUE 'N'.    00750048
007600     05  PS-READ-CURSOR-SW              PIC  X(01)  VALUE 'N'.    00760048
007700         88  PS-READ-CURSOR                         VALUE 'Y'.    00770048
007800         88  PS-READ-CURSOR-DONE                    VALUE 'N'.    00780048
007900                                                                  00790048
008000 01  PV-PROGRAM-VARIABLES.                                        00800048
008100     05  PV-SUB                         PIC S9(04)  VALUE +0      00810048
008200                                                    COMP SYNC.    00820048
008300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00830048
008400                                                    COMP SYNC.    00840048
008500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00850048
008600                                                    COMP-3.       00860048
008700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00870048
008800                                                    COMP-3.       00880048
008900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00890048
009000                                                    COMP-3.       00900048
009100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00910048
009200                                                    COMP-3.       00920048
009300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00930048
009400                                                    COMP-3.       00940048
009500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00950048
009600                                                    COMP-3.       00960048
009700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00970048
009800                                                    COMP-3.       00980048
009900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00990048
010000                                                    COMP SYNC.    01000048
010100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01010048
010200                                                    COMP SYNC.    01020048
010300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01030048
010400                                                    COMP SYNC.    01040048
010500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01050048
010600                                                    COMP SYNC.    01060048
010700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01070048
010800                                                    COMP SYNC.    01080048
010900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01090048
011000                                                    COMP SYNC.    01100048
011100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01110048
011200                                                    COMP SYNC.    01120048
011300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01130048
011400                                                    COMP SYNC.    01140048
011500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01150048
011600                                                    COMP SYNC.    01160048
011700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01170048
011800                                                    COMP SYNC.    01180048
011900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01190048
012000                                                    COMP SYNC.    01200048
012100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01210048
012200                                                    COMP SYNC.    01220048
012300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01230048
012400                                                    COMP SYNC.    01240048
012500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01250048
012600                                                    COMP SYNC.    01260048
012700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01270048
012800                                                    COMP SYNC.    01280048
012900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01290048
013000                                                    COMP SYNC.    01300048
013100******************************************************************01310048
013200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01320048
013300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01330048
013400**  APPLICATION-SPECIFIC COMMAREA.                              **01340048
013500******************************************************************01350048
013600 01  LQW-LIST-QUEUE-WORK-AREA.                                    01360048
013700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01370048
013800     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01380048
013900                                        INDEXED BY LQW-IDX.       01390048
014000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01400048
014100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01410048
014200         10  LQW-SELECTED-SW            PIC  X(01).               01420048
014300             88  LQW-SELECT                         VALUE 'S'.    01430048
014400             88  LQW-DESELECT                       VALUE ' '.    01440048
014500         10  LQW-EXTD-SZ-DESC           PIC  X(20).               01450048
014600                                                                  01460048
014700*---------------------------------------------------------------* 01470048
014800*    MAP LAYOUT                                                 * 01480048
014900*---------------------------------------------------------------* 01490048
015000     COPY ETKM356.                                                01500048
015100                                                                  01510048
015200 01  MR-OCCURS-LAYOUT REDEFINES ET356AO.                          01520048
015300     05  FILLER                         PIC X(42).                01530048
015400     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01540048
015500         10  MR-SELECTL                 PIC S9(04) COMP.          01550048
015600         10  MR-SELECTA                 PIC  X(01).               01560048
015700         10  MR-SELECTC                 PIC  X(01).               01570048
015800         10  MR-SELECTH                 PIC  X(01).               01580048
015900         10  MR-SELECTI                 PIC  X(01).               01590048
016000                                                                  01600048
016100         10  MR-EXTD-SZ-DESCL           PIC S9(04) COMP.          01610048
016200         10  MR-EXTD-SZ-DESCA           PIC  X(01).               01620048
016300         10  MR-EXTD-SZ-DESCC           PIC  X(01).               01630048
016400         10  MR-EXTD-SZ-DESCH           PIC  X(01).               01640048
016500         10  MR-EXTD-SZ-DESC            PIC  X(20).               01650048
016600                                                                  01660048
016700*---------------------------------------------------------------* 01670048
016800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01680048
016900*---------------------------------------------------------------* 01690048
017000     COPY DPWS015.                                                01700048
017100                                                                  01710048
017200*---------------------------------------------------------------* 01720048
017300*    FUNCTION KEYS COPYBOOK.                                    * 01730048
017400*---------------------------------------------------------------* 01740048
017500     COPY DPWS016.                                                01750048
017600                                                                  01760048
017700*---------------------------------------------------------------* 01770048
017800*    NUMERIC EDIT LAYOUT.                                       * 01780048
017900*---------------------------------------------------------------* 01790048
018000     COPY DPWS010I.                                               01800048
018100                                                                  01810048
018200*---------------------------------------------------------------* 01820048
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01830051
018400*---------------------------------------------------------------* 01840048
018500     COPY DPWS030.                                                01850048
CICS       COPY DPWS930.                                                01851051
018600                                                                  01860048
018700*---------------------------------------------------------------* 01870048
018800*    STANDARD COMMAREA.                                         * 01880048
018900*---------------------------------------------------------------* 01890048
019000     COPY DPWS020.                                                01900048
019100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01910048
019200         10  INTER-APPL-COMM-AREA        PIC X(200).              01920048
019300     COPY ETWS356.                                                01930048
019400*---------------------------------------------------------------* 01940048
019500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 01950048
019600*---------------------------------------------------------------* 01960048
019700         10  ASC-SPECIFIC-COMMAREA.                               01970048
019800             15  ASC-LIST-KEYS.                                   01980048
019900                 20  ASC-KEY-EXTD-SZ-CDE             PIC  X(02).  01990048
020000                 20  ASC-KEY-EXTD-SZ-DESC            PIC  X(20).  02000048
020100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02010048
020200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02020048
020300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02030048
020400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02040048
020500                                                                  02050048
020600                 20  ASC-ITEM-ARRAY.                              02060048
020700                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02070048
020800                         30  ASC-LIST-ITEM-NUMBER                 02080048
020900                                                     PIC S9(09)   02090048
021000                                                     COMP-3.      02100048
021100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02110048
021200                             88  ASC-VALID-SELECT    VALUE ' '    02120048
021300                                                           'S'.   02130048
021400                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02140048
021500                             88  ASC-TEMP-SELECT     VALUE 'S'.   02150048
021600                         30  ASC-SELECTED-SW         PIC  X(01).  02160048
021700                             88  ASC-NO-SELECT       VALUE ' '.   02170048
021800                             88  ASC-SELECT          VALUE 'S'.   02180048
021900                         30  ASC-EXTD-SZ-CDE         PIC  X(02).  02190048
022000                         30  ASC-EXTD-SZ-DESC        PIC  X(20).  02200048
022100                                                                  02210048
022200             15  ASC-BLK-SUB                         PIC S9(04)   02220048
022300                                                          COMP    02230048
022400                                                          SYNC.   02240048
022500             15  ASC-ITEM-SUB                        PIC S9(04)   02250048
022600                                                          COMP    02260048
022700                                                          SYNC.   02270048
022800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02280048
022900                                                          COMP-3. 02290048
023000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02300048
023100                                                          COMP-3. 02310048
023200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02320048
023300                                                          COMP-3. 02330048
023400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02340048
023500                                                          COMP-3. 02350048
023600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02360048
023700                                                          COMP-3. 02370048
023800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02380048
023900                                                          COMP    02390048
024000                                                          SYNC.   02400048
024100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02410048
024200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   02420048
024300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   02430048
024400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  02440048
024500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   02450048
024600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   02460048
024700             15  ASC-LIST-QUEUE-NAME.                             02470048
024800                 20  ASC-LIST-TERM-ID                PIC  X(04).  02480048
024900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02490048
025000                                                          COMP-3. 02500048
025100                 20  ASC-LIST-SEQ                    PIC  9(01).  02510048
025200             15  ASC-SEL-QUEUE-NAME.                              02520048
025300                 20  ASC-SEL-TERM-ID                 PIC  X(04).  02530048
025400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   02540048
025500                                                          COMP-3. 02550048
025600                 20  ASC-SEL-SEQ                     PIC  9(01).  02560048
025700                                                                  02570048
025800             15  ASC-START-ITEM-REQUEST.                          02580048
025900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  02590048
026000             15  ASC-SAVE-INPUT                      PIC  X(200). 02600048
026100                                                                  02610048
026200*---------------------------------------------------------------* 02620048
026300*    ABEND PROCESSING COPYBOOK.                                 * 02630048
026400*---------------------------------------------------------------* 02640048
026500     COPY DPWS013.                                                02650048
026600                                                                  02660048
026700*---------------------------------------------------------------* 02670048
026800*    DB2 AREA FOR EXTENDED SIZE DESC TABLE                      * 02680048
026900*---------------------------------------------------------------* 02690048
027000     EXEC SQL                                                     02700048
027100          INCLUDE IMT00025                                        02710048
027200     END-EXEC.                                                    02720048
027300                                                                  02730048
027400*---------------------------------------------------------------* 02740048
027500*    DB2 AREA FOR COMMUNICATIONS                                * 02750048
027600*---------------------------------------------------------------* 02760048
027700     EXEC SQL                                                     02770048
027800          INCLUDE SQLCA                                           02780048
027900     END-EXEC.                                                    02790048
028000                                                                  02800048
028100*---------------------------------------------------------------* 02810048
028200*    THE EXTD-SZ CURSOR                                         * 02820048
028300*---------------------------------------------------------------* 02830048
028400     EXEC SQL                                                     02840048
028500          DECLARE EXTD-SZ-CSRA CURSOR FOR                         02850048
028600           SELECT DISTINCT                                        02860048
028700                  EXTD_SZ_CDE                                     02870048
028800                 ,EXTD_SZ_DESC                                    02880048
028900             FROM IMT_EXTD_SZ                                     02890048
029000         ORDER BY EXTD_SZ_DESC                                    02900048
029100     END-EXEC.                                                    02910048
029200                                                                  02920048
029300 LINKAGE SECTION.                                                 02930048
029400                                                                  02940048
029500 01  DFHCOMMAREA.                                                 02950048
029600     05  FILLER                         OCCURS  1 TO 4072 TIMES   02960048
029700                                        DEPENDING ON EIBCALEN.    02970048
029800         10  FILLER                     PIC X.                    02980048
029900                                                                  02990048
030000 PROCEDURE DIVISION.                                              03000048
030100                                                                  03010048
030200     INITIALIZE DP030-CICS-API-FIELDS.                            03020048
030300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03030048
030400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03040048
030500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03050048
030600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03060048
030700     MOVE LENGTH OF ET356AI        TO DP030-MAP-LENGTH (1).       03070048
030800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03080048
030900                                                                  03090048
031000     PERFORM 0001-CALL-CICS-ARCH-API.                             03100048
031100                                                                  03110048
031200     PERFORM 1000-CONTROL-PROCESSING                              03120048
031300                                                                  03130048
031400     IF PS-ERROR OR                                               03140048
031500        DP020-NEXT-ACT-INITIAL OR                                 03150048
031600        DP020-NEXT-ACT-RETURN                                     03160048
031700         CONTINUE                                                 03170048
031800     ELSE                                                         03180048
031900         EVALUATE TRUE                                            03190048
032000*-->        ON ENTER                                              03200048
032100            WHEN DP020-SRC-AID = DP016-PF17                       03210048
032200                CONTINUE                                          03220048
032300            WHEN OTHER                                            03230048
032400                MOVE ASC-KEY-EXTD-SZ-CDE  TO ET356-EXTD-SZ-CDE    03240048
032500                MOVE ASC-KEY-EXTD-SZ-DESC TO ET356-EXTD-SZ-DESC   03250048
032600         END-EVALUATE                                             03260048
032700     END-IF.                                                      03270048
032800                                                                  03280048
032900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03290048
033000                                                                  03300048
033100     PERFORM 0001-CALL-CICS-ARCH-API.                             03310048
033200                                                                  03320048
033300******************************************************************03330048
033400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03340048
033500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **03350048
033600******************************************************************03360048
033700 0001-CALL-CICS-ARCH-API.                                         03370048
033800                                                                  03380048
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03390051
034000                                    DFHCOMMAREA                   03400051
034100                                    DP030-CICS-API-FIELDS         03410051
034200                                    DP020-STANDARD-COMMAREA       03420051
034300                                    ET356AI.                      03430051
034400                                                                  03440048
034500     IF DP030-RC-CALL-SUCCESSFUL                                  03450048
034600         CONTINUE                                                 03460048
034700     ELSE                                                         03470048
034800         SET DP013-NO-ROLLBACK                                    03480048
034900             DP013-XCTL-DISPLAY-RESTART                           03490048
035000             DP013-CICS-ABEND      TO TRUE                        03500048
035100         MOVE '0001-CALL-CICS-ARCH-API'                           03510048
035200                                   TO DP013-PARAGRAPH             03520048
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03530051
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03540051
035500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03550048
035600         PERFORM DP013-0000-PROCESS-ABEND                         03560048
035700     END-IF.                                                      03570048
035800*----------------------------------------------------------------*03580048
035900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03590048
036000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03600048
036100*----------------------------------------------------------------*03610048
036200 1000-CONTROL-PROCESSING.                                         03620048
036300                                                                  03630048
036400     EVALUATE TRUE                                                03640048
036500         WHEN DP020-NEXT-ACT-INITIAL                              03650048
036600             INITIALIZE ASC-SPECIFIC-COMMAREA                     03660048
036700             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       03670048
036800                                           ASC-SEL-TERM-ID        03680048
036900             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   03690048
037000                                           ASC-SEL-TASK-NUMBER    03700048
037100             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           03710048
037200             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ            03720048
037300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03730048
037400             PERFORM 4000-BUILD-INITIAL-PANEL                     03740048
037500                                                                  03750048
037600         WHEN DP020-NEXT-ACT-READ-MAP                             03760048
037700             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         03770048
037800             PERFORM 2000-PROCESS-PANEL                           03780048
037900                                                                  03790048
038000         WHEN DP020-NEXT-ACT-RETURN                               03800048
038100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         03810048
038200             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                03820048
038300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03830048
038400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03840048
038500                                                                  03850048
038600         WHEN OTHER                                               03860048
038700             SET DP013-LOGIC-ABEND                                03870048
038800                 DP013-NO-ROLLBACK TO TRUE                        03880048
038900             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    03890048
039000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03900048
039100                 TO DP013-MESSAGE-TEXT(1)                         03910048
039200             PERFORM DP013-0000-PROCESS-ABEND                     03920048
039300     END-EVALUATE.                                                03930048
039400                                                                  03940048
039500*----------------------------------------------------------------*03950048
039600* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *03960048
039700* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *03970048
039800*----------------------------------------------------------------*03980048
039900 1100-PROCESS-INTER-APPL-COMM.                                    03990048
040000                                                                  04000048
040100     SET PS-COMMAREA-VALID TO TRUE.                               04010048
040200     MOVE SPACE TO ASC-START-ITEM-REQUEST.                        04020048
040300     MOVE ET356-EXTD-SZ-CDE  TO ASC-KEY-EXTD-SZ-CDE.              04030048
040400     MOVE ET356-EXTD-SZ-DESC TO ASC-KEY-EXTD-SZ-DESC.             04040048
040500                                                                  04050048
040600*----------------------------------------------------------------*04060048
040700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04070048
040800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04080048
040900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04090048
041000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04100048
041100* FUNCTION KEYS CAN GET THIS FAR.                                *04110048
041200*----------------------------------------------------------------*04120048
041300 2000-PROCESS-PANEL.                                              04130048
041400                                                                  04140048
041500     EVALUATE TRUE                                                04150048
041600         WHEN DP020-SRC-AID = DP016-CLEAR                         04160048
041700              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL               04170048
041800                                                                  04180048
041900              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04190048
042000                                                                  04200048
042100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04210048
042200                                                                  04220048
042300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04230048
042400              PERFORM 2050-DELETE-LIST-QUEUE                      04240048
042500                                                                  04250048
042600              PERFORM 4000-BUILD-INITIAL-PANEL                    04260048
042700                                                                  04270048
042800         WHEN OTHER                                               04280048
042900              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                04290048
043000                                                                  04300048
043100              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04310048
043200                                                                  04320048
043300              IF PS-NO-ERROR                                      04330048
043400                  SET DP030-CONTINUE-GO TO TRUE                   04340048
043500                                                                  04350048
043600                  PERFORM 2100-CHECK-FUNCTION-KEY                 04360048
043700              ELSE                                                04370048
043800                  SET DP030-OVERRIDE-GO TO TRUE                   04380048
043900              END-IF                                              04390048
044000     END-EVALUATE.                                                04400048
044100                                                                  04410048
044200*----------------------------------------------------------------*04420048
044300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *04430048
044400*----------------------------------------------------------------*04440048
044500 2050-DELETE-LIST-QUEUE.                                          04450048
044600                                                                  04460048
044700     EXEC CICS                                                    04470048
044800         DELETEQ TS                                               04480048
044900             QUEUE (ASC-LIST-QUEUE-NAME)                          04490048
045000             RESP  (PV-CICS-RESP)                                 04500048
045100     END-EXEC.                                                    04510048
045200                                                                  04520048
045300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       04530048
045400        (PV-CICS-RESP = DFHRESP(QIDERR))                          04540048
045500         CONTINUE                                                 04550048
045600     ELSE                                                         04560048
045700         SET DP013-CICS-ABEND                                     04570048
045800             DP013-NO-ROLLBACK TO TRUE                            04580048
045900                                                                  04590048
046000         MOVE '2050-DELETE-LIST-QUEUE'                            04600048
046100                                   TO DP013-PARAGRAPH             04610048
046200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    04620048
046300                                   TO DP013-MESSAGE-TEXT (1)      04630048
046400         PERFORM DP013-0000-PROCESS-ABEND                         04640048
046500     END-IF.                                                      04650048
046600                                                                  04660048
046700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  04670048
046800                                                                  04680048
046900*----------------------------------------------------------------*04690048
047000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*04700048
047100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *04710048
047200* CICS ARCHITECTURE API.                                         *04720048
047300*----------------------------------------------------------------*04730048
047400 2100-CHECK-FUNCTION-KEY.                                         04740048
047500                                                                  04750048
047600     EVALUATE TRUE                                                04760048
047700         WHEN DP020-SRC-AID = DP016-PF17                          04770048
047800             IF ASC-NUMBER-OF-SELECTED-ITEMS > 1                  04780048
047900                 SET DP020-MSG-FATAL   TO TRUE                    04790048
048000                 SET PS-ERROR          TO TRUE                    04800048
048100                 MOVE PC-TSYMSG-00047  TO DP020-MSG-NUMBER        04810048
048200                 SET DP030-OVERRIDE-GO TO TRUE                    04820048
048300                 MOVE ASC-KEY-EXTD-SZ-CDE  TO ET356-EXTD-SZ-CDE   04830048
048400                 MOVE ASC-KEY-EXTD-SZ-DESC TO ET356-EXTD-SZ-DESC  04840048
048500             ELSE                                                 04850048
048600                 IF ASC-NUMBER-OF-SELECTED-ITEMS = 0              04860048
048700                     MOVE ASC-KEY-EXTD-SZ-CDE                     04870048
048800                         TO ET356-EXTD-SZ-CDE                     04880048
048900                     MOVE ASC-KEY-EXTD-SZ-DESC                    04890048
049000                         TO ET356-EXTD-SZ-DESC                    04900048
049100                 END-IF                                           04910048
049200             END-IF                                               04920048
049300                                                                  04930048
049400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  04940048
049500             MOVE +1               TO PV-TOP-ITEM                 04950048
049600                                                                  04960048
049700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04970048
049800                                                                  04980048
049900             PERFORM 3200-RESET-ATTRIBUTES                        04990048
050000                                                                  05000048
050100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05010048
050200             PERFORM 2110-BROWSE-BACKWARD                         05020048
050300                                                                  05030048
050400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05040048
050500                                                                  05050048
050600             PERFORM 3200-RESET-ATTRIBUTES                        05060048
050700                                                                  05070048
050800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05080048
050900             PERFORM 2120-BROWSE-FORWARD                          05090048
051000                                                                  05100048
051100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05110048
051200                                                                  05120048
051300             PERFORM 3200-RESET-ATTRIBUTES                        05130048
051400                                                                  05140048
051500         WHEN DP020-SRC-AID = DP016-ENTER                         05150048
051600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05160048
051700                                                                  05170048
051800             IF PS-ERROR                                          05180048
051900                 CONTINUE                                         05190048
052000             ELSE                                                 05200048
052100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05210048
052200             END-IF                                               05220048
052300                                                                  05230048
052400         WHEN OTHER                                               05240048
052500             SET DP013-NO-ROLLBACK                                05250048
052600                 DP013-XCTL-DISPLAY-RESTART                       05260048
052700                 DP013-CICS-ABEND  TO TRUE                        05270048
052800             MOVE '2100-CHECK-FUNCTION-KEY'                       05280048
052900                                   TO DP013-PARAGRAPH             05290048
053000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05300048
053100                                   TO DP013-MESSAGE-TEXT (1)      05310048
053200             PERFORM DP013-0000-PROCESS-ABEND                     05320048
053300     END-EVALUATE.                                                05330048
053400                                                                  05340048
053500*----------------------------------------------------------------*05350048
053600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *05360048
053700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *05370048
053800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *05380048
053900*    MESSAGE.                                                    *05390048
054000*----------------------------------------------------------------*05400048
054100 2110-BROWSE-BACKWARD.                                            05410048
054200                                                                  05420048
054300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    05430048
054400         GIVING PV-TOP-ITEM.                                      05440048
054500                                                                  05450048
054600     IF  ((PV-TOP-ITEM < +1)                                      05460048
054700       OR (PV-TOP-ITEM = +1))                                     05470048
054800         MOVE +1                   TO PV-TOP-ITEM                 05480048
054900*        -- TOP OF LIST --                                        05490048
055000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05500048
055100         SET DP020-MSG-INFORMATIONAL TO TRUE                      05510048
055200     END-IF.                                                      05520048
055300                                                                  05530048
055400*----------------------------------------------------------------*05540048
055500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *05550048
055600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *05560048
055700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *05570048
055800*----------------------------------------------------------------*05580048
055900 2120-BROWSE-FORWARD.                                             05590048
056000                                                                  05600048
056100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              05610048
056200         GIVING PV-TOP-ITEM.                                      05620048
056300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   05630048
056400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            05640048
056500                                   TO PV-TOP-ITEM                 05650048
056600*        -- BOTTOM OF LIST --                                     05660048
056700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05670048
056800         SET DP020-MSG-INFORMATIONAL                              05680048
056900                                   TO TRUE                        05690048
057000     ELSE                                                         05700048
057100         COMPUTE PV-BOTTOM-ITEM =                                 05710048
057200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 05720048
057300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            05730048
057400*            -- BOTTOM OF LIST --                                 05740048
057500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05750048
057600             SET DP020-MSG-INFORMATIONAL                          05760048
057700                                   TO TRUE                        05770048
057800         END-IF                                                   05780048
057900     END-IF.                                                      05790048
058000                                                                  05800048
058100*----------------------------------------------------------------*05810048
058200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *05820048
058300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *05830048
058400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *05840048
058500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *05850048
058600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *05860048
058700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *05870048
058800*----------------------------------------------------------------*05880048
058900 2130-CHECK-FOR-JUMP-BROWSE.                                      05890048
059000                                                                  05900048
059100     SET PS-NO-ERROR               TO TRUE.                       05910048
059200     IF (ASC-START-ITEM-REQUEST = SPACE)                          05920048
059300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            05930048
059400                                   TO PV-TOP-ITEM                 05940048
059500     ELSE                                                         05950048
059600         MOVE ASC-START-ITEM-REQUEST                              05960048
059700                                   TO DP010I-UNEDITED-FIELD       05970048
059800         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       05980048
059900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     05990048
060000         SET DP010I-NEGATIVE-NOT-ALLOWED                          06000048
060100                                   TO TRUE                        06010048
060210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06021049
060220                         USING DP010I-NUMERIC-EDIT-AREA           06022049
060300                                                                  06030048
060400         IF  NOT DP010I-ERROR-DETECTED                            06040048
060500             MOVE DP010I-NUMERIC-FIELD                            06050048
060600                                   TO  ASC-START-ITEM-REQUEST-N   06060048
060700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06070048
060800                 IF  ASC-START-ITEM-REQUEST-N >                   06080048
060900                                          ASC-NUMBER-OF-ITEMS-READ06090048
061000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06100048
061100                     COMPUTE PV-TOP-ITEM =                        06110048
061200                             ASC-NUMBER-OF-ITEMS-READ             06120048
061300                             - PC-ITEMS-PER-PANEL + 1             06130048
061400                     IF  PV-TOP-ITEM < +1                         06140048
061500                         MOVE +1   TO PV-TOP-ITEM                 06150048
061600                         MOVE PC-TSYMSG-00070                     06160048
061700                                   TO DP020-MSG-NUMBER            06170048
061800                         SET DP020-MSG-INFORMATIONAL              06180048
061900                                   TO TRUE                        06190048
062000                     END-IF                                       06200048
062100                 ELSE                                             06210048
062200                     MOVE ASC-START-ITEM-REQUEST-N                06220048
062300                                   TO PV-TOP-ITEM                 06230048
062400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06240048
062500                     COMPUTE PV-BOTTOM-ITEM =                     06250048
062600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06260048
062700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06270048
062800*                        -- BOTTOM OF LIST --                     06280048
062900                         MOVE PC-TSYMSG-00070                     06290048
063000                                   TO DP020-MSG-NUMBER            06300048
063100                         SET DP020-MSG-INFORMATIONAL              06310048
063200                                   TO TRUE                        06320048
063300                     END-IF                                       06330048
063400                 END-IF                                           06340048
063500             ELSE                                                 06350048
063600*                --- VALUE OUT OF RANGE ----                      06360048
063700                 MOVE PC-TSYMSG-00101                             06370048
063800                                   TO DP020-MSG-NUMBER            06380048
063900                 MOVE -1           TO ASTRTITL                    06390048
064000                 SET DP030-SET-CURSOR-APPL-1                      06400048
064100                                   TO TRUE                        06410048
064200                 MOVE DP015-REVERSE                               06420048
064300                                   TO ASTRTITH                    06430048
064400                 MOVE DP015-RED    TO ASTRTITC                    06440048
064500                 MOVE DP015-UNP-NUM-BRT-MDT                       06450048
064600                                   TO ASTRTITA                    06460048
064700                 SET DP020-MSG-FATAL                              06470048
064800                                   TO TRUE                        06480048
064900                 SET PS-ERROR      TO TRUE                        06490048
065000             END-IF                                               06500048
065100                                                                  06510048
065200         ELSE                                                     06520048
065300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            06530048
065400             MOVE -1               TO ASTRTITL                    06540048
065500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06550048
065600             MOVE DP015-REVERSE    TO ASTRTITH                    06560048
065700             MOVE DP015-RED        TO ASTRTITC                    06570048
065800             MOVE DP015-UNP-NUM-BRT-MDT                           06580048
065900                                   TO ASTRTITA                    06590048
066000             SET DP020-MSG-FATAL   TO TRUE                        06600048
066100             SET PS-ERROR          TO TRUE                        06610048
066200         END-IF                                                   06620048
066300     END-IF.                                                      06630048
066400                                                                  06640048
066500******************************************************************06650048
066600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **06660048
066700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **06670048
066800******************************************************************06680048
066900 2200-MOVE-SCREEN-TO-COMMAREA.                                    06690048
067000                                                                  06700048
067100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             06710048
067200     MOVE +1                       TO PV-SUB.                     06720048
067300                                                                  06730048
067400     PERFORM 3100-SET-SUBSCRIPTS.                                 06740048
067500     IF  ASTRTITL > ZERO                                          06750048
067600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          06760048
067700     ELSE                                                         06770048
067800         IF  ASTRTITF = DP015-ERASE-EOF                           06780048
067900             INITIALIZE ASC-START-ITEM-REQUEST                    06790048
068000         END-IF                                                   06800048
068100     END-IF.                                                      06810048
068200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          06820048
068300         VARYING PV-SUB                                           06830048
068400         FROM 1 BY 1                                              06840048
068500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      06850048
068600                                                                  06860048
068700******************************************************************06870048
068800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**06880048
068900******************************************************************06890048
069000 2210-MOVE-LINES-TO-COMMAREA.                                     06900048
069100                                                                  06910048
069200     IF  MR-SELECTL (PV-SUB) > ZERO                               06920048
069300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             06930048
069400         MOVE MR-SELECTI (PV-SUB)                                 06940048
069500                                   TO ASC-TEMP-SELECTED-SW        06950048
069600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      06960048
069700     ELSE                                                         06970048
069800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                06980048
069900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     06990048
070000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        07000048
070100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      07010048
070200         END-IF                                                   07020048
070300     END-IF.                                                      07030048
070400     ADD +1                        TO ASC-ITEM-SUB.               07040048
070500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        07050048
070600         ADD +1                    TO ASC-BLK-SUB                 07060048
070700         MOVE +1                   TO ASC-ITEM-SUB                07070048
070800     END-IF.                                                      07080048
070900                                                                  07090048
071000******************************************************************07100048
071100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **07110048
071200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **07120048
071300******************************************************************07130048
071400 3000-EDIT-DATA-IN-COMMAREA.                                      07140048
071500                                                                  07150048
071600     SET PS-NO-ERROR               TO TRUE.                       07160048
071700     PERFORM 3200-RESET-ATTRIBUTES.                               07170048
071800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     07180048
071900**                                                                07190048
072000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              07200048
072100* EDITTING IS DONE FROM THE BOTTOM UP.                            07210048
072200**                                                                07220048
072300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       07230048
072400         ASC-ITEMS-DISPLAYED - 1.                                 07240048
072500     PERFORM 3100-SET-SUBSCRIPTS.                                 07250048
072600     PERFORM 3300-EDIT-SELECTIONS                                 07260048
072700         VARYING PV-SUB                                           07270048
072800         FROM PV-SUB BY -1                                        07280048
072900         UNTIL PV-SUB < +1.                                       07290048
073000                                                                  07300048
073100*----------------------------------------------------------------*07310048
073200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *07320048
073300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*07330048
073400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *07340048
073500*                                                                *07350048
073600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *07360048
073700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *07370048
073800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *07380048
073900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *07390048
074000*----------------------------------------------------------------*07400048
074100 3100-SET-SUBSCRIPTS.                                             07410048
074200                                                                  07420048
074300     COMPUTE ASC-ITEM-SUB =                                       07430048
074400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        07440048
074500                                                                  07450048
074600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         07460048
074700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            07470048
074800                                                                  07480048
074900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               07490048
075000     ELSE                                                         07500048
075100         MOVE +1                     TO ASC-BLK-SUB               07510048
075200     END-IF.                                                      07520048
075300                                                                  07530048
075400******************************************************************07540048
075500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **07550048
075600******************************************************************07560048
075700 3200-RESET-ATTRIBUTES.                                           07570048
075800                                                                  07580048
075900     MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      07590048
076000     MOVE DP015-GREEN           TO ASTRTITC.                      07600048
076100     MOVE DP015-UNDERLINE       TO ASTRTITH.                      07610048
076200                                                                  07620048
076300     IF DP020-NEXT-ACT-RETURN OR                                  07630048
076400        DP020-NEXT-ACT-READ-MAP                                   07640048
076500         PERFORM VARYING PV-SUB  FROM 1 BY 1                      07650048
076600                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             07660048
076700                  MOVE DP015-UNP-ALP-NOR-OFF                      07670048
076800                                       TO MR-SELECTA (PV-SUB)     07680048
076900                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     07690048
077000                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     07700048
077100         END-PERFORM                                              07710048
077200     ELSE                                                         07720048
077300         PERFORM VARYING PV-SUB  FROM 1 BY 1                      07730048
077400                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              07740048
077500                  MOVE DP015-UNP-ALP-NOR-OFF                      07750048
077600                                       TO MR-SELECTA (PV-SUB)     07760048
077700                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     07770048
077800                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     07780048
077900         END-PERFORM                                              07790048
078000     END-IF.                                                      07800048
078100                                                                  07810048
078200******************************************************************07820048
078300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **07830048
078400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **07840048
078500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **07850048
078600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **07860048
078700******************************************************************07870048
078800 3300-EDIT-SELECTIONS.                                            07880048
078900                                                                  07890048
079000     EVALUATE TRUE                                                07900048
079100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     07910048
079200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         07920048
079300             IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)   07930048
079400                = 'S'                                             07940048
079500                 MOVE ASC-EXTD-SZ-CDE (ASC-BLK-SUB ASC-ITEM-SUB)  07950048
079600                                TO ET356-EXTD-SZ-CDE              07960048
079700                 MOVE ASC-EXTD-SZ-DESC (ASC-BLK-SUB ASC-ITEM-SUB) 07970048
079800                                TO ET356-EXTD-SZ-DESC             07980048
079900             END-IF                                               07990048
080000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         08000048
080100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        08010048
080200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   08020048
080300                 MOVE ASC-TEMP-SELECTED-SW                        08030048
080400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  08040048
080500                                TO ASC-SELECTED-SW                08050048
080600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  08060048
080700*-->         MOVE SELECTED EXTD-SZ-CDE TO COMMAREA                08070048
080800                 MOVE ASC-EXTD-SZ-CDE (ASC-BLK-SUB ASC-ITEM-SUB)  08080048
080900                                TO ET356-EXTD-SZ-CDE              08090048
081000                 MOVE ASC-EXTD-SZ-DESC (ASC-BLK-SUB ASC-ITEM-SUB) 08100048
081100                                TO ET356-EXTD-SZ-DESC             08110048
081200             END-IF                                               08120048
081300                                                                  08130048
081400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     08140048
081500                 = SPACE                                          08150048
081600             EVALUATE TRUE                                        08160048
081700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       08170048
081800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS08180048
081900                     MOVE SPACE TO ASC-SELECTED-SW                08190048
082000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  08200048
082100             END-EVALUATE                                         08210048
082200         WHEN OTHER                                               08220048
082300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           08230048
082400             SET DP020-MSG-FATAL    TO TRUE                       08240048
082500             MOVE -1                TO MR-SELECTL (PV-SUB)        08250048
082600             SET DP030-SET-CURSOR-APPL-1                          08260048
082700                                    TO TRUE                       08270048
082800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        08280048
082900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        08290048
083000             SET PS-ERROR TO TRUE                                 08300048
083100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            08310048
083200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     08320048
083300                 MOVE SPACE         TO ASC-SELECTED-SW            08330048
083400                                        (ASC-BLK-SUB ASC-ITEM-SUB)08340048
083500             END-IF                                               08350048
083600     END-EVALUATE.                                                08360048
083700                                                                  08370048
083800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 08380048
083900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               08390048
084000     IF  ASC-ITEM-SUB < 1                                         08400048
084100         SUBTRACT +1 FROM ASC-BLK-SUB                             08410048
084200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                08420048
084300     END-IF.                                                      08430048
084400                                                                  08440048
084500******************************************************************08450048
084600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **08460048
084700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **08470048
084800******************************************************************08480048
084900*----------------------------------------------------------------*08490048
085000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08500048
085100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08510048
085200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08520048
085300*    DISPLAY THE PANEL TO USER.                                  *08530048
085400*----------------------------------------------------------------*08540048
085500 4000-BUILD-INITIAL-PANEL.                                        08550048
085600                                                                  08560048
085700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             08570048
085800                ASC-BLOCK-ENTRIES (2).                            08580048
085900     MOVE +1 TO ASC-BLK-SUB.                                      08590048
086000     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            08600048
086100     MOVE +0 TO ASC-ITEM-SUB                                      08610048
086200                ASC-NUMBER-OF-ITEMS-READ                          08620048
086300                ASC-NUMBER-OF-SELECTED-ITEMS                      08630048
086400                ASC-HIGHEST-BLOCK-WRITTEN                         08640048
086500                ASC-ITEM-AT-TOP-OF-PANEL.                         08650048
086600                                                                  08660048
086700     PERFORM 4500-OPEN-CSRA.                                      08670048
086800     PERFORM 4200-READ-ITEMS-FROM-DB.                             08680048
086900     PERFORM 4700-CLOSE-CSRA.                                     08690048
087000                                                                  08700048
087100     MOVE +1 TO PV-TOP-ITEM.                                      08710048
087200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          08720048
087300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    08730048
087400         SET DP020-MSG-FATAL   TO  TRUE                           08740048
087500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               08750048
087600     ELSE                                                         08760048
087700         MOVE -1 TO MR-SELECTL (1)                                08770048
087800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08780048
087900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08790048
088000     END-IF.                                                      08800048
088100                                                                  08810048
088200*----------------------------------------------------------------*08820048
088300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *08830048
088400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *08840048
088500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *08850048
088600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *08860048
088700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *08870048
088800*----------------------------------------------------------------*08880048
088900 4200-READ-ITEMS-FROM-DB.                                         08890048
089000                                                                  08900048
089100     PERFORM VARYING PV-READ-COUNT  FROM 1 BY 1                   08910048
089200             UNTIL   PV-READ-COUNT > PC-MAX-ITEMS                 08920048
089300                 OR  ASC-NO-ITEMS-LEFT-ON-DB                      08930048
089400                                                                  08940048
089500             PERFORM 4600-FETCH-CSRA                              08950048
089600                                                                  08960048
089700             IF ASC-ITEMS-LEFT-ON-DB                              08970048
089800                IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL              08980048
089900                    CONTINUE                                      08990048
090000                ELSE                                              09000048
090100                    ADD  +1 TO ASC-BLK-SUB                        09010048
090200                    MOVE +0 TO ASC-ITEM-SUB                       09020048
090300                    IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY       09030048
090400                        MOVE +1 TO ASC-BLK-SUB                    09040048
090500                        SET ASC-BLOCK-MODIFIED (1) TO TRUE        09050048
090600                        PERFORM 5100-WRITE-TEMP-STORAGE           09060048
090700                        MOVE ASC-BLOCK-ENTRIES                    09070048
090800                                          (PC-MAX-BLOCKS-IN-ARRAY)09080048
090900                            TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)    09090048
091000                        ADD +1 TO ASC-BLK-SUB                     09100048
091100                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)09110048
091200                        SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB)09120048
091300                           TO TRUE                                09130048
091400                    END-IF                                        09140048
091500                END-IF                                            09150048
091600                PERFORM 4220-MOVE-EXTD-SZ-INFO THRU 4220-EXIT     09160048
091700             END-IF                                               09170048
091800     END-PERFORM.                                                 09180048
091900                                                                  09190048
092000     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           09200048
092100         MOVE +1 TO ASC-BLK-SUB                                   09210048
092200         PERFORM 5100-WRITE-TEMP-STORAGE                          09220048
092300         ADD  +1 TO ASC-BLK-SUB                                   09230048
092400         PERFORM 5100-WRITE-TEMP-STORAGE                          09240048
092500         MOVE 1  TO ASC-BLK-SUB                                   09250048
092600                    PV-BLOCK-NUMBER                               09260048
092700         PERFORM 4410-READ-TEMP-STORAGE                           09270048
092800         IF ASC-HIGHEST-BLOCK-WRITTEN > 1                         09280048
092900             MOVE 2 TO ASC-BLK-SUB                                09290048
093000                       PV-BLOCK-NUMBER                            09300048
093100             PERFORM 4410-READ-TEMP-STORAGE                       09310048
093200         END-IF                                                   09320048
093300     END-IF.                                                      09330048
093400                                                                  09340048
093500*----------------------------------------------------------------*09350048
093600* MOVE EXTD-SZ INFORMATION TO THE APPL SPECIFIC COMMAREA         *09360048
093700*----------------------------------------------------------------*09370048
093800 4220-MOVE-EXTD-SZ-INFO.                                          09380048
093900                                                                  09390048
094000     ADD +1 TO ASC-ITEM-SUB                                       09400048
094100               ASC-NUMBER-OF-ITEMS-READ.                          09410048
094200     MOVE ASC-NUMBER-OF-ITEMS-READ                                09420048
094300         TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB).      09430048
094400     MOVE IMT00025-EXTD-SZ-CDE                                    09440048
094500         TO ASC-EXTD-SZ-CDE (ASC-BLK-SUB ASC-ITEM-SUB).           09450048
094600     MOVE IMT00025-EXTD-SZ-DESC                                   09460048
094700         TO ASC-EXTD-SZ-DESC (ASC-BLK-SUB ASC-ITEM-SUB).          09470048
094800 4220-EXIT.                                                       09480048
094900     EXIT.                                                        09490048
095000                                                                  09500048
095100*----------------------------------------------------------------*09510048
095200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *09520048
095300*----------------------------------------------------------------*09530048
095400 4400-MOVE-COMMAREA-TO-SCREEN.                                    09540048
095500                                                                  09550048
095600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             09560048
095700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          09570048
095800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          09580048
095900             MOVE +1    TO ASC-BLK-SUB                            09590048
096000             PERFORM 5100-WRITE-TEMP-STORAGE                      09600048
096100             ADD +1     TO ASC-BLK-SUB                            09610048
096200             PERFORM 5100-WRITE-TEMP-STORAGE                      09620048
096300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             09630048
096400                 GIVING PV-BLOCK-NUMBER                           09640048
096500                 REMAINDER PV-REMAINDER                           09650048
096600             IF  PV-REMAINDER > ZERO                              09660048
096700                 ADD +1 TO PV-BLOCK-NUMBER                        09670048
096800             END-IF                                               09680048
096900             MOVE +1    TO ASC-BLK-SUB                            09690048
097000             PERFORM 4410-READ-TEMP-STORAGE                       09700048
097100             ADD +1     TO ASC-BLK-SUB                            09710048
097200                           PV-BLOCK-NUMBER                        09720048
097300             PERFORM 4410-READ-TEMP-STORAGE                       09730048
097400     END-IF.                                                      09740048
097500     MOVE +1            TO ASC-BLK-SUB.                           09750048
097600     COMPUTE ASC-ITEM-SUB =                                       09760048
097700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              09770048
097800         + PC-ITEMS-PER-PANEL).                                   09780048
097900                                                                  09790048
098000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09800048
098100         ADD +1         TO ASC-BLK-SUB                            09810048
098200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            09820048
098300     END-IF.                                                      09830048
098400                                                                  09840048
098500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           09850048
098600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                09860048
098700     PERFORM 4420-FORMAT-LIST-LINES                               09870048
098800         VARYING PV-SUB                                           09880048
098900         FROM PC-ITEMS-PER-PANEL BY -1                            09890048
099000         UNTIL PV-SUB < +1.                                       09900048
099100                                                                  09910048
099200     COMPUTE ASC-ITEMS-DISPLAYED =                                09920048
099300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          09930048
099400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    09940048
099500                                      ASTRTITO.                   09950048
099600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    09960048
099700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    09970048
099800                                                                  09980048
099900     IF  DP020-MSG-NUMBER-X = SPACE                               09990048
100000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  10000048
100100*            --- MORE ITEMS TO DISPLAY ----                       10010048
100200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            10020048
100300             SET DP020-MSG-INFORMATIONAL TO TRUE                  10030048
100400         END-IF                                                   10040048
100500     END-IF.                                                      10050048
100600                                                                  10060048
100700*----------------------------------------------------------------*10070048
100800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *10080048
100900*----------------------------------------------------------------*10090048
101000 4410-READ-TEMP-STORAGE.                                          10100048
101100                                                                  10110048
101200     EXEC CICS                                                    10120048
101300         READQ TS                                                 10130048
101400             QUEUE (ASC-LIST-QUEUE-NAME)                          10140048
101500             INTO  (ASC-BLOCK-ENTRIES (ASC-BLK-SUB))              10150048
101600             ITEM  (PV-BLOCK-NUMBER)                              10160048
101700             RESP  (PV-CICS-RESP)                                 10170048
101800     END-EXEC.                                                    10180048
101900                                                                  10190048
102000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       10200048
102100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     10210048
102200         CONTINUE                                                 10220048
102300     ELSE                                                         10230048
102400         SET DP013-CICS-ABEND     TO TRUE                         10240048
102500         SET DP013-NO-ROLLBACK    TO TRUE                         10250048
102600         MOVE '4410-READ-TEMP-STORAGE'                            10260048
102700                                  TO DP013-PARAGRAPH              10270048
102800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      10280048
102900                                  TO DP013-MESSAGE-TEXT(1)        10290048
103000         PERFORM DP013-0000-PROCESS-ABEND                         10300048
103100     END-IF.                                                      10310048
103200                                                                  10320048
103300     SET ASC-BLOCK-NOT-MODIFIED (ASC-BLK-SUB) TO TRUE.            10330048
103400                                                                  10340048
103500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         10350048
103600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               10360048
103700     END-IF.                                                      10370048
103800                                                                  10380048
103900*----------------------------------------------------------------*10390048
104000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *10400048
104100*----------------------------------------------------------------*10410048
104200 4420-FORMAT-LIST-LINES.                                          10420048
104300                                                                  10430048
104400     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       10440048
104500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                10450048
104600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      10460048
104700         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      10470048
104800                                    MR-EXTD-SZ-DESC (PV-SUB)      10480048
104900     ELSE                                                         10490048
105000         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       10500048
105100                                                           > SPACE10510048
105200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 10520048
105300                                           TO MR-SELECTI (PV-SUB) 10530048
105400         ELSE                                                     10540048
105500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      10550048
105600                                           TO MR-SELECTI (PV-SUB) 10560048
105700         END-IF                                                   10570048
105800                                                                  10580048
105900         IF DP030-SET-CURSOR-TRAILER                              10590048
106000             IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)   10600048
106100                                                           > SPACE10610048
106200                OR PV-SUB = 1                                     10620048
106300                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              10630048
106400                 MOVE -1 TO MR-SELECTL (PV-SUB)                   10640048
106500             END-IF                                               10650048
106600         END-IF                                                   10660048
106700                                                                  10670048
106800         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            10680048
106900             MOVE ASC-EXTD-SZ-DESC (ASC-BLK-SUB ASC-ITEM-SUB)     10690048
107000                 TO MR-EXTD-SZ-DESC (PV-SUB)                      10700048
107100         END-IF                                                   10710048
107200     END-IF.                                                      10720048
107300                                                                  10730048
107400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               10740048
107500                                                                  10750048
107600     IF ASC-ITEM-SUB < + 1                                        10760048
107700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  10770048
107800         MOVE +1                 TO ASC-BLK-SUB                   10780048
107900     END-IF.                                                      10790048
108000                                                                  10800048
108100*----------------------------------------------------------------*10810048
108200* OPEN THE SECOND EXTD-SZ CURSOR.                                *10820048
108300*----------------------------------------------------------------*10830048
108400 4500-OPEN-CSRA.                                                  10840048
108500                                                                  10850048
108600     PERFORM                                                      10860048
108700         WITH TEST AFTER                                          10870048
108800         VARYING PV-RETRY-COUNTER                                 10880048
108900         FROM 1 BY 1                                              10890048
109000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10900048
109100                   OR (SQLCODE = ZERO))                           10910048
109200             MOVE 'CURSOR:  EXTD-SZ-CSRA'                         10920048
109300                               TO DP013-MESSAGE-TEXT (2)          10930048
109400             EXEC SQL                                             10940048
109500                  OPEN EXTD-SZ-CSRA                               10950048
109600             END-EXEC                                             10960048
109700                                                                  10970048
109800         EVALUATE TRUE                                            10980048
109900             WHEN SQLCODE = ZERO                                  10990048
110000             WHEN SQLCODE = -904                                  11000048
110100             WHEN SQLCODE = -913                                  11010048
110200                 CONTINUE                                         11020048
110300             WHEN SQLWARN0 NOT = SPACES                           11030048
110400             WHEN SQLCODE < ZERO                                  11040048
110500             WHEN SQLCODE > ZERO                                  11050048
110600                 MOVE '4500-OPEN-CSRA'                            11060048
110700                                   TO DP013-PARAGRAPH             11070048
110800                 MOVE 'OPEN EXTD-SZ CURSOR A - '                  11080048
110900                                   TO DP013-MESSAGE-TEXT (1)      11090048
111000                 MOVE SQLCA        TO DP013-SQLCA                 11100048
111100                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    11110048
111200                 SET DP013-DB2-ABEND                              11120048
111300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11130048
111400                 PERFORM DP013-0000-PROCESS-ABEND                 11140048
111500         END-EVALUATE                                             11150048
111600     END-PERFORM.                                                 11160048
111700                                                                  11170048
111800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11180048
111900         MOVE '4500-OPEN-CSRA' TO DP013-PARAGRAPH                 11190048
112000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSRA'  11200048
112100                               TO DP013-MESSAGE-TEXT (1)          11210048
112200         MOVE SQLCA            TO DP013-SQLCA                     11220048
112300         MOVE 'TSYMSG  '       TO DP013-DB2-TABLE-NAME (1)        11230048
112400         SET DP013-DB2-ABEND                                      11240048
112500             DP013-XCTL-DISPLAY-RESTART                           11250048
112600            TO TRUE                                               11260048
112700         PERFORM DP013-0000-PROCESS-ABEND                         11270048
112800     END-IF.                                                      11280048
112900                                                                  11290048
113000*----------------------------------------------------------------*11300048
113100* FETCH THE SECOND EXTD-SZ CURSOR.                               *11310048
113200*----------------------------------------------------------------*11320048
113300 4600-FETCH-CSRA.                                                 11330048
113400                                                                  11340048
113500     EXEC SQL                                                     11350048
113600          FETCH EXTD-SZ-CSRA                                      11360048
113700          INTO  :IMT00025-EXTD-SZ-CDE                             11370048
113800               ,:IMT00025-EXTD-SZ-DESC                            11380048
113900     END-EXEC                                                     11390048
114000                                                                  11400048
114100     EVALUATE TRUE                                                11410048
114200         WHEN SQLCODE = ZERO                                      11420048
114300         WHEN SQLCODE = +100                                      11430048
114400              CONTINUE                                            11440048
114500         WHEN SQLWARN0 NOT = SPACE                                11450048
114600         WHEN SQLCODE NOT = ZERO                                  11460048
114700              MOVE '4600-FETCH-CSRA' TO DP013-PARAGRAPH           11470048
114800              MOVE 'FETCH EXTD-SZ CURSOR A'                       11480048
114900                  TO DP013-MESSAGE-TEXT (1)                       11490048
115000              MOVE SQLCA TO DP013-SQLCA                           11500048
115100              SET DP013-DB2-ABEND TO TRUE                         11510048
115200              PERFORM DP013-0000-PROCESS-ABEND                    11520048
115300     END-EVALUATE.                                                11530048
115400                                                                  11540048
115500     IF  SQLCODE EQUAL +100                                       11550048
115600         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      11560048
115700     END-IF.                                                      11570048
115800                                                                  11580048
115900*----------------------------------------------------------------*11590048
116000* CLOSE THE SECOND EXTD-SZ CURSOR.                               *11600048
116100*----------------------------------------------------------------*11610048
116200 4700-CLOSE-CSRA.                                                 11620048
116300                                                                  11630048
116400     EXEC SQL                                                     11640048
116500         CLOSE EXTD-SZ-CSRA                                       11650048
116600     END-EXEC                                                     11660048
116700                                                                  11670048
116800     EVALUATE TRUE                                                11680048
116900         WHEN SQLCODE = ZERO                                      11690048
117000             CONTINUE                                             11700048
117100         WHEN SQLWARN0 NOT = SPACES                               11710048
117200         WHEN SQLCODE < ZERO                                      11720048
117300         WHEN SQLCODE > ZERO                                      11730048
117400             MOVE '4700-CLOSE-CSRA'                               11740048
117500                               TO DP013-PARAGRAPH                 11750048
117600             MOVE 'CLOSE EXTD-SZ CURSOR A'                        11760048
117700                               TO DP013-MESSAGE-TEXT (1)          11770048
117800             MOVE SQLCA        TO DP013-SQLCA                     11780048
117900             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        11790048
118000             SET DP013-DB2-ABEND                                  11800048
118100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               11810048
118200             PERFORM DP013-0000-PROCESS-ABEND                     11820048
118300     END-EVALUATE.                                                11830048
118400                                                                  11840048
118500*----------------------------------------------------------------*11850048
118600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *11860048
118700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *11870048
118800*----------------------------------------------------------------*11880048
118900 5100-WRITE-TEMP-STORAGE.                                         11890048
119000                                                                  11900048
119100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     11910048
119200         TO PV-LIST-ITEM-NUMBER.                                  11920048
119300     COMPUTE PV-BLOCK-NUMBER =                                    11930048
119400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11940048
119500                                                                  11950048
119600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             11960048
119700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             11970048
119800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      11980048
119900             PERFORM 5105-REWRITE-ASC-LISTQ                       11990048
120000         END-IF                                                   12000048
120100     ELSE                                                         12010048
120200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       12020048
120300             ASC-HIGHEST-BLOCK-WRITTEN + 1                        12030048
120400         PERFORM 5110-WRITE-ASC-LISTQ                             12040048
120500         ADD +1 TO ASC-HIGHEST-BLOCK-WRITTEN                      12050048
120600     END-IF.                                                      12060048
120700                                                                  12070048
120800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             12080048
120900******************************************************************12090048
121000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **12100048
121100** SPECIFIC COMMAREA.                                           **12110048
121200******************************************************************12120048
121300 5105-REWRITE-ASC-LISTQ.                                          12130048
121400                                                                  12140048
121500     EXEC CICS                                                    12150048
121600         WRITEQ TS                                                12160048
121700             QUEUE (ASC-LIST-QUEUE-NAME)                          12170048
121800             FROM  (ASC-BLOCK-ENTRIES (ASC-BLK-SUB))              12180048
121900             ITEM  (PV-BLOCK-NUMBER)                              12190048
122000             REWRITE                                              12200048
122100             RESP  (PV-CICS-RESP)                                 12210048
122200     END-EXEC.                                                    12220048
122300                                                                  12230048
122400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           12240048
122500         CONTINUE                                                 12250048
122600     ELSE                                                         12260048
122700         SET DP013-CICS-ABEND          TO TRUE                    12270048
122800         SET DP013-NO-ROLLBACK         TO TRUE                    12280048
122900         MOVE '5105-REWRITE-ASC-LISTQ' TO DP013-PARAGRAPH         12290048
123000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     12300048
123100                                       TO DP013-MESSAGE-TEXT(1)   12310048
123200         PERFORM DP013-0000-PROCESS-ABEND                         12320048
123300     END-IF.                                                      12330048
123400                                                                  12340048
123500******************************************************************12350048
123600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **12360048
123700** SPECIFIC COMMAREA.                                           **12370048
123800******************************************************************12380048
123900 5110-WRITE-ASC-LISTQ.                                            12390048
124000                                                                  12400048
124100     EXEC CICS                                                    12410048
124200         WRITEQ TS                                                12420048
124300             QUEUE (ASC-LIST-QUEUE-NAME)                          12430048
124400             FROM  (ASC-BLOCK-ENTRIES (ASC-BLK-SUB))              12440048
124500             ITEM  (PV-BLOCK-NUMBER)                              12450048
124600             RESP  (PV-CICS-RESP)                                 12460048
124700     END-EXEC.                                                    12470048
124800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      12480048
124900         SET DP013-CICS-ABEND  TO TRUE                            12490048
125000         SET DP013-NO-ROLLBACK TO TRUE                            12500048
125100         MOVE '5110-WRITE-ASC-LISTQ'                              12510048
125200                               TO DP013-PARAGRAPH                 12520048
125300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           12530048
125400                               TO DP013-MESSAGE-TEXT(1)           12540048
125500         PERFORM DP013-0000-PROCESS-ABEND                         12550048
125600     END-IF.                                                      12560048
125700                                                                  12570048
125800                                                                  12580048
125900*----------------------------------------------------------------*12590048
126000*    ABEND PROCESSOR MODULE                                      *12600048
126100*----------------------------------------------------------------*12610048
126200     COPY DPPD013.                                                12620048
