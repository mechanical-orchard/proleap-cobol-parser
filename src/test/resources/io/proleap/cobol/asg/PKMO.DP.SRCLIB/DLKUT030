000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    DLKUT030.                                         00020001
000300 AUTHOR.        DENISE HAHN.                                      00030001
000400                                                                  00040001
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050001
000600 DATE-WRITTEN.  DECEMBER 2008.                                    00060001
000700 DATE-COMPILED.                                                   00070001
000800                                                                  00080001
000900 ENVIRONMENT DIVISION.                                            00090001
001000 CONFIGURATION SECTION.                                           00100001
001100 SOURCE-COMPUTER. IBM-3090.                                       00110001
001200 OBJECT-COMPUTER. IBM-3090.                                       00120001
001300                                                                  00130001
001400****************************************************************  00140001
001500*                                                              *  00150001
001600*  IF THERE ARE CURRENTLY MULTIPLE ASSIGNMENTS OPEN FOR THE    *  00160001
001700*  SAME DC/WORK TYPE/WORK AREA THIS MODULE IS CALLED TO        *  00170001
001800*  END THE ASSOCIATES ON THE ASSIGNMENT AND END THE ASSIGNMENT *  00180001
001900*                                                              *  00190001
002000*  THIS MODULE IS CALLED BY DLKCS410                           *  00200001
002100*                                                              *  00210001
002200*  DB2 ACCESS:                                                 *  00220001
002300*     DLT_TEM_ASGMT (DLT00003) TABLE                           *  00230001
002400*                SELECTS                                       *  00240001
002500*                                                              *  00250001
002600*     DLT_ASGMT (DLT00004) TABLE                               *  00260001
002700*                SELECTS                                       *  00270001
002800*                                                              *  00280001
002900*     TUPLDER (TUPLDER) - UPLOAD ERROR TABLE                   *  00290001
003000*                INSERTS                                       *  00300001
003100*                                                              *  00310001
003200****************************************************************  00320001
003300                                                                  00330001
003400 DATA DIVISION.                                                   00340001
003500 WORKING-STORAGE SECTION.                                         00350001
003600*                                                                 00360001
003700 01  DK-DB2-KEYS.                                                 00370001
003800     05  DK-ASGMT-DC-NBR          PIC S9(4) COMP.                 00380001
003900     05  DK-ASGMT-WK-TYPE         PIC  X(15).                     00390001
004000     05  DK-ASGMT-WK-AREA         PIC  X(20).                     00400001
004100     05  DK-USER-ID               PIC  X(08).                     00410001
004200     05  DK-CURRENT-TIMESTAMP     PIC  X(26)   VALUE SPACES.      00420001
004300     05  DK-CURRENT-TIMESTAMP-R REDEFINES DK-CURRENT-TIMESTAMP.   00430001
004400         10  DK-CURRENT-DATE      PIC  X(10).                     00440001
004500         10  FILLER               PIC  X(01).                     00450001
004600         10  DK-CURRENT-TIME      PIC  X(08).                     00460001
004700         10  FILLER               PIC  X(07).                     00470001
004800*                                                                 00480001
004900 01  PV-PROGRAM-VARIABLES.                                        00490001
005000     05  PV-CICS-RESP             PIC S9(04)  VALUE +0            00500004
005100                                                    COMP SYNC.    00510004
005200     05  PV-USR-TYP-CDE           PIC  X(01).                     00520001
005300         88  PV-USER-IS-KOHLS                VALUE 'K'.           00530001
005400         88  PV-USER-IS-TEMP                 VALUE 'T'.           00540001
005500     05  PV-DISPLAY-TEXT          PIC  XXXXX  VALUE ZEROS.        00550001
005600     05  PV-DISPLAY-SQLCODE       PIC  -999.                      00560001
005700     05  PV-DISPLAY-OPER          PIC  Z(04).                     00570001
005800     05  PV-HOLD-TIMESTAMP        PIC  X(26).                     00580001
005900     05  PV-LABOR-CURRENT-TMST    PIC  X(26).                     00590001
006000                                                                  00600001
006100     05  PV-ASGMT-COUNT                 PIC S9(09)  COMP.         00610001
006200                                                                  00620001
006300     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.        00630001
006400     05  PV-MODULE-FAIL-MSG.                                      00640001
006500         10  FILLER               PIC  X(05)  VALUE 'PARA:'.      00650001
006600         10  PV-MODULE-PARAGRPAH  PIC  X(30)  VALUE SPACE.        00660001
006700                                                                  00670001
006800     05  PV-MSG-AREA              PIC  X(80)  VALUE SPACE.        00680001
006900     05  PV-MSG-AREA2             PIC  X(100) VALUE SPACE.        00690001
007000     05  PV-MSG-HOLD.                                             00700001
007100         10  FILLER               PIC  X(01)  VALUE SPACE.        00710001
007200         10  PV-MSG-DATA          PIC  X(79)  VALUE SPACE.        00720001
007300     05  PV-COMMAREA-LENGTH       PIC S9(04)  COMP                00730001
007400                                              VALUE +0.           00740001
007500     05  PV-NULL-IND1             PIC S9(04)  VALUE ZEROS         00750001
007600                                              COMP SYNC.          00760001
007700     05  PV-NULL-IND2             PIC S9(04)  VALUE ZEROS         00770001
007800                                              COMP SYNC.          00780001
007900                                                                  00790001
008000 01  PS-SWITCHES.                                                 00800001
008100     05  PS-DISPLAY-PARA-SW           PIC X(01)  VALUE 'N'.       00810001
008200         88  PS-DISPLAY-PARA                     VALUE 'Y'.       00820001
008300         88  PS-DONT-DISPLAY-PARA                VALUE 'N'.       00830001
008400     05  PS-DISPLAY-DETAIL-SW         PIC X(01)  VALUE 'N'.       00840001
008500         88  PS-DISPLAY-DETAIL                   VALUE 'Y'.       00850001
008600         88  PS-DONT-DISPLAY-DETAIL              VALUE 'N'.       00860001
008700     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       00870001
008800         88  PS-END-OF-CURSOR                    VALUE 'Y'.       00880001
008900         88  PS-END-OF-CURSOR-NO                 VALUE 'N'.       00890001
009000     05  PS-CALLED-MODULE-ERROR-SW    PIC X(01)  VALUE 'N'.       00900001
009100         88  PS-CALLED-MODULE-ERROR              VALUE 'Y'.       00910001
009200         88  PS-CALLED-MODULE-ERROR-NO           VALUE 'N'.       00920001
009300     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00930001
009400         88  PS-ERROR                            VALUE 'Y'.       00940001
009500         88  PS-ERROR-NO                         VALUE 'N'.       00950001
009600                                                                  00960001
009700 01  PC-CONSTANTS.                                                00970001
009800     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00980001
009900     05  PC-ASTERISK-LINE         PIC X(40)  VALUE ALL '*'.       00990001
010000     05  PC-CURRENT-PROGRAM-NAME  PIC X(08)  VALUE 'DLKUT030'.    01000001
010100                                                                  01010001
010200*----------------------------------------------------------------*01020001
010300*    COMMAREA TO BE PASSED TO DLKUP002                            01030001
010400*----------------------------------------------------------------*01040001
010500     COPY DLWS005.                                                01050001
010600                                                                  01060001
010700*----------------------------------------------------------------*01070001
010800*    COMMAREA TO BE PASSED TO XLKUP033                            01080001
010900*----------------------------------------------------------------*01090001
011000     COPY XLWS072.                                                01100001
011100                                                                  01110001
011200*----------------------------------------------------------------*01120001
011300*  DLT_ASGMT - LABOR ASSIGNMENT HEADER                            01130001
011400*----------------------------------------------------------------*01140001
011500     EXEC SQL                                                     01150001
011600         INCLUDE DLT00004                                         01160001
011700     END-EXEC.                                                    01170001
011800                                                                  01180001
011900*----------------------------------------------------------------*01190001
012000*   DLT_TEM_ASGMT - ASSOCIATES THAT ARE ATTACHED TO ASSIGNMENT    01200001
012100*----------------------------------------------------------------*01210001
012200     EXEC SQL                                                     01220001
012300         INCLUDE DLT00003                                         01230001
012400     END-EXEC.                                                    01240001
012500                                                                  01250001
012600*----------------------------------------------------------------*01260001
012700*   TUPLDER - UPLOAD ERROR TABLE                                  01270001
012800*----------------------------------------------------------------*01280001
012900     EXEC SQL                                                     01290001
013000         INCLUDE TUPLDER                                          01300001
013100     END-EXEC.                                                    01310001
013200                                                                  01320001
013300*----------------------------------------------------------------*01330001
013400*                                                                 01340001
013500*----------------------------------------------------------------*01350001
013600     EXEC SQL                                                     01360001
013700          INCLUDE SQLCA                                           01370001
013800     END-EXEC.                                                    01380001
013900                                                                  01390001
014000*---------------------------------------------------------------* 01400001
014100*   CURSOR CONTAINING THE ACTIVE ASSIGNMENTS THAT ARE OPEN FOR  * 01410001
014200*   THE DC/WORK TYPE/WORK AREA AND THE ASSOCIATES               * 01420001
014300*---------------------------------------------------------------* 01430001
014400     EXEC SQL                                                     01440001
014500          DECLARE ACTIVE_ASGMT_CSR CURSOR WITH HOLD FOR           01450001
014600           SELECT A.ASGMT_STRT_DTE                                01460001
014700                 ,A.ASGMT_NBR_TXT                                 01470001
014800                 ,A.ASGMT_NBR_SEQ_NBR                             01480001
014900                 ,A.TEM_ASGMT_SEQ_NBR                             01490001
015000                 ,A.KOHLS_USR_ID                                  01500001
015100                 ,A.TMP_USR_ID                                    01510001
015200                 ,A.JN_TMST                                       01520001
015300                 ,A.CRE_BY_USR_ID                                 01530001
015400                 ,B.ASGMT_STRT_TM                                 01540001
015500                 ,B.WK_TYP_DESC                                   01550001
015600                 ,B.WK_AREA_DESC                                  01560001
015700                 ,B.DC_NBR                                        01570001
015800            FROM  DLT_TEM_ASGMT   A                               01580001
015900                 ,DLT_ASGMT       B                               01590001
016000           WHERE  B.DC_NBR            =  :DK-ASGMT-DC-NBR         01600001
016100             AND  B.WK_TYP_DESC       =  :DK-ASGMT-WK-TYPE        01610001
016200             AND  B.WK_AREA_DESC      =  :DK-ASGMT-WK-AREA        01620001
016300             AND  B.ASGMT_STRT_DTE    =  A.ASGMT_STRT_DTE         01630001
016400             AND  B.ASGMT_NBR_TXT     =  A.ASGMT_NBR_TXT          01640001
016500             AND  B.ASGMT_NBR_SEQ_NBR =  A.ASGMT_NBR_SEQ_NBR      01650001
016600             AND  B.ASGMT_STP_RSN_CDE = 'N'                       01660001
016700             AND  A.LVE_RSN_CDE       = 'N'                       01670001
016800           ORDER BY  A.JN_TMST                                    01680001
016900     END-EXEC.                                                    01690001
017000                                                                  01700001
017100 LINKAGE SECTION.                                                 01710001
017200     COPY DLWS026.                                                01720001
017300                                                                  01730001
017400                                                                  01740001
017500 PROCEDURE DIVISION USING DL026-ASGMT-COMMAREA.                   01750001
017600                                                                  01760001
017700     EXEC SQL                                                     01770001
017800          SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           01780001
017900     END-EXEC.                                                    01790001
018000                                                                  01800001
018100     SET DL026-SUCCESSFUL                                         01810001
018200         PS-ERROR-NO       TO  TRUE.                              01820001
018300                                                                  01830001
018400     MOVE  DL026-KEY-DC-NBR      TO  DK-ASGMT-DC-NBR.             01840001
018500     MOVE  DL026-KEY-WK-TYP      TO  DK-ASGMT-WK-TYPE.            01850001
018600     MOVE  DL026-KEY-WK-AREA     TO  DK-ASGMT-WK-AREA.            01860001
018700                                                                  01870001
018800     SET  PS-END-OF-CURSOR-NO TO  TRUE.                           01880001
018900                                                                  01890001
019000     PERFORM 4000-OPEN-CURSOR.                                    01900001
019100     PERFORM 4010-FETCH-CURSOR.                                   01910001
019200     IF  PS-END-OF-CURSOR-NO                                      01920001
019300         PERFORM 2000-PROCESS-CURSOR                              01930001
019400           UNTIL PS-END-OF-CURSOR                                 01940001
019500              OR PS-ERROR                                         01950001
019600     END-IF.                                                      01960001
019700     PERFORM 4020-CLOSE-CURSOR.                                   01970001
019800                                                                  01980001
019900     PERFORM 4030-COUNT-OPEN-ASGMTS.                              01990001
020000                                                                  02000001
020100                                                                  02010001
020200     GOBACK.                                                      02020001
020300                                                                  02030001
020400                                                                  02040001
020500*--------------------------------------------------------------*  02050001
020600*                                                              *  02060001
020700*--------------------------------------------------------------*  02070001
020800 2000-PROCESS-CURSOR.                                             02080001
020801                                                                  02080111
020900***  MOVE SPACES TO PV-MSG-AREA2                                  02090011
021000***  MOVE ' DLKUT030 -  2000-PROCESS-CURSOR         '             02100011
021100***    TO PV-MSG-AREA2                                            02110011
021200***  MOVE LENGTH OF PV-MSG-AREA2                                  02120011
021300***    TO PV-COMMAREA-LENGTH                                      02130011
021400***  PERFORM 9200-WRITE-TO-LOG                                    02140011
021600                                                                  02160001
021700                                                                  02170001
021800     IF  SQLCODE = ZERO                                           02180001
021900         PERFORM 4500-INSERT-TUPLDER                              02190001
022000         PERFORM 3000-PROCESS-ASGMT                               02200001
022100         IF  PS-ERROR-NO                                          02210001
022200            PERFORM 3500-CREATE-S-MOVE                            02220001
022300         END-IF                                                   02230001
022400     END-IF.                                                      02240001
022500                                                                  02250001
022600     IF  PS-ERROR-NO                                              02260001
022700         PERFORM 4010-FETCH-CURSOR                                02270001
022800     END-IF.                                                      02280001
022900                                                                  02290001
023000                                                                  02300001
023100*--------------------------------------------------------------*  02310001
023200* THE FOLLOWING IS TO PROCESS THE CALL TO DLKUP002 TO          *  02320001
023300* END ASSOCIATE FROM AN ASSIGNMENT                             *  02330001
023400*--------------------------------------------------------------*  02340001
023500 3000-PROCESS-ASGMT.                                              02350001
023600                                                                  02360001
023610***                                                               02361011
023700***  MOVE SPACES TO PV-MSG-AREA2                                  02370011
023800***  MOVE ' DLKUT030 -  3000-PROCESS-ASGMT          '             02380011
023900***    TO PV-MSG-AREA2                                            02390011
024000***  MOVE LENGTH OF PV-MSG-AREA2                                  02400011
024100***    TO PV-COMMAREA-LENGTH                                      02410011
024200***  PERFORM 9200-WRITE-TO-LOG.                                   02420011
024300                                                                  02430002
024400     INITIALIZE DL005-ASGMT-COMMAREA.                             02440001
024500                                                                  02450001
024600     MOVE DLT00003-ASGMT-STRT-DTE TO  DL005-KEY-START-DTE.        02460001
024700     MOVE DLT00003-ASGMT-NBR-TXT  TO  DL005-KEY-NBR-TXT.          02470001
024800     MOVE DLT00003-ASGMT-NBR-SEQ-NBR                              02480001
024900                                  TO  DL005-KEY-NBR-SEQ-NBR.      02490001
025000     MOVE DLT00003-TEM-ASGMT-SEQ-NBR                              02500001
025100                                  TO  DL005-KEY-TEM-ASGMT-SEQ-NBR.02510001
025200     MOVE DK-USER-ID              TO  DL005-KEY-ADD-BY-USER-ID    02520001
025300                                      DL005-KEY-USER-ID.          02530001
025400     MOVE PV-USR-TYP-CDE          TO  DL005-KEY-USR-TYPE-CDE.     02540001
025500     MOVE PC-CURRENT-PROGRAM-NAME TO  DL005-KEY-LVE-PGM-NM        02550001
025600                                      DL005-ORIG-CALLING-PGM-NM.  02560001
025700                                                                  02570001
025800     SET DL005-BY-ASGMT-NBR                                       02580001
025900         DL005-END-FROM-ASGMT                                     02590001
026000         DL005-COMMIT-UPDATE                                      02600001
026100         DL005-KEY-LVE-RSN-SMOVE                                  02610001
026200         PS-CALLED-MODULE-ERROR-NO TO TRUE.                       02620001
026300                                                                  02630001
026400     MOVE ' END ' TO PV-DISPLAY-TEXT.                             02640001
026500                                                                  02650001
026600     PERFORM 6300-CALL-DLKUP002.                                  02660001
026700                                                                  02670001
026800     IF  PS-CALLED-MODULE-ERROR                                   02680001
026900         SET PS-ERROR           TO TRUE                           02690001
027000         MOVE 'DLKUP002'        TO DL026-CALL-MOD-FAIL-NM         02700001
027100         MOVE DL005-RETURN-CODE TO DL026-CALL-MOD-FAIL-ERR-CDE    02710001
027200         SET DL026-CALLED-MODULE-FAILURE TO TRUE                  02720001
027300         IF  DL005-SQL-ERROR                                      02730001
027400             MOVE DL005-ASGMT-SQLCODE TO                          02740001
027500                  DL026-CALL-MOD-FAIL-SQL-CDE                     02750001
027600             MOVE DL005-SQL-ERROR-PARA TO                         02760001
027700                  DL026-CALL-MOD-FAIL-SQL-PARA                    02770001
027800         END-IF                                                   02780001
027900     END-IF.                                                      02790001
028000                                                                  02800001
028100                                                                  02810001
028200 3220-GET-TIMESTAMP.                                              02820001
028300                                                                  02830001
028400***  MOVE SPACES TO PV-MSG-AREA2                                  02840011
028500***  MOVE ' DLKUT030 -  3220-GET-TIMESTAMP          '             02850011
028600***    TO PV-MSG-AREA2                                            02860011
028700***  MOVE LENGTH OF PV-MSG-AREA2                                  02870011
028800***    TO PV-COMMAREA-LENGTH                                      02880011
028900***  PERFORM 9200-WRITE-TO-LOG.                                   02890011
029000                                                                  02900002
029100                                                                  02910002
029200     EXEC SQL                                                     02920001
029300          SET  :PV-LABOR-CURRENT-TMST =                           02930001
029400               (TIMESTAMP(:PV-HOLD-TIMESTAMP) - 1 SECOND)         02940001
029500     END-EXEC.                                                    02950001
029600                                                                  02960001
029700                                                                  02970001
029800*--------------------------------------------------------------*  02980001
029900* THE FOLLOWING IS TO PROCESS THE CALL TO XLKUP033 TO LOG AN   *  02990001
030000* INDIRECT CODE OF AN S (SYSTEM) MOVE FOR THE ASSOCIATE        *  03000001
030100*--------------------------------------------------------------*  03010001
030200 3500-CREATE-S-MOVE.                                              03020001
030300                                                                  03030001
030400***  MOVE SPACES TO PV-MSG-AREA2                                  03040011
030500***  MOVE ' DLKUT030 - 3500-CREATE-S-MOVE           '             03050011
030600***    TO PV-MSG-AREA2                                            03060011
030700***  MOVE LENGTH OF PV-MSG-AREA2                                  03070011
030800***    TO PV-COMMAREA-LENGTH                                      03080011
030900***  PERFORM 9200-WRITE-TO-LOG.                                   03090011
031000                                                                  03100006
031100                                                                  03110002
031200     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        03120001
031300                                                                  03130001
031400     SET XL072-PC-APP-ID                                          03140001
031500         XL072-COMMIT-UPDATE TO TRUE.                             03150001
031600                                                                  03160001
031700     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            03170001
031800                                                                  03180001
031900     MOVE ZEROES                  TO XL072-EVNT-KY-1-NBR          03190001
032000                                     XL072-EVNT-KY-2-NBR          03200001
032100                                     XL072-EVNT-KY-3-NBR          03210001
032200                                     XL072-EVNT-KY-4-NBR          03220001
032300                                     XL072-EVNT-KY-5-NBR.         03230001
032400                                                                  03240001
032500     MOVE SPACES                  TO XL072-EVNT-KY-1-TXT          03250001
032600                                     XL072-EVNT-KY-2-TXT          03260001
032700                                     XL072-EVNT-KY-3-TXT          03270001
032800                                     XL072-EVNT-KY-4-TXT          03280001
032900                                     XL072-EVNT-KY-5-TXT          03290001
033000                                     XL072-EVNT-KY-1-TMST         03300001
033100                                     XL072-EVNT-KY-2-TMST         03310001
033200                                     XL072-EVNT-KY-3-TMST         03320001
033300                                     XL072-EVNT-KY-4-TMST         03330001
033400                                     XL072-EVNT-KY-5-TMST.        03340001
033500                                                                  03350001
033600     MOVE 'DC LABOR'          TO XL072-EVNT-OBJ-TXT.              03360001
033700     MOVE 'INDIRECT LABOR'    TO XL072-EVNT-OBJ-ACTN-TXT.         03370001
033800     MOVE DK-USER-ID          TO XL072-CRE-BY-USR-ID.             03380001
033900     MOVE DL026-KEY-DC-NBR    TO XL072-EVNT-KY-1-NBR.             03390001
034000**                                                                03400001
034100     IF  DLT00004-WK-TYP-DESC   = 'RECV'                          03410001
034200         MOVE 'SRMOVE'        TO XL072-EVNT-KY-1-TXT              03420001
034300     END-IF.                                                      03430001
034400     IF  DLT00004-WK-TYP-DESC   = 'SHIP'                          03440001
034500         MOVE 'SSMOVE'        TO XL072-EVNT-KY-1-TXT              03450001
034600     END-IF.                                                      03460001
034700     IF  DLT00004-WK-TYP-DESC   = 'P2L'                           03470001
034800         MOVE 'SPMOVE'        TO XL072-EVNT-KY-1-TXT              03480001
034900     END-IF.                                                      03490001
035000     IF  DLT00004-WK-TYP-DESC   = 'FLAT'                          03500001
035100         MOVE 'SFMOVE'        TO XL072-EVNT-KY-1-TXT              03510001
035200     END-IF.                                                      03520001
035300     IF  DLT00004-WK-TYP-DESC   = 'RLABL'                         03530001
035400         MOVE 'SLMOVE'        TO XL072-EVNT-KY-1-TXT              03540001
035500     END-IF.                                                      03550001
035600     IF  DLT00004-WK-TYP-DESC   = 'MASTCON'                       03560001
035700         MOVE 'SMMOVE'        TO XL072-EVNT-KY-1-TXT              03570001
035800     END-IF.                                                      03580001
035900                                                                  03590001
036000     MOVE DL005-ASSOC-TMST    TO PV-HOLD-TIMESTAMP.               03600001
036100     PERFORM 3220-GET-TIMESTAMP.                                  03610001
036200     MOVE PV-LABOR-CURRENT-TMST  TO  XL072-EVNT-KY-1-TMST.        03620001
036300                                                                  03630001
036400     SET XL072-COPYBOOK-NOT-USED TO TRUE.                         03640001
036500                                                                  03650001
036600     PERFORM 6500-CALL-XLKUP033.                                  03660001
036700                                                                  03670001
036800     IF  PS-CALLED-MODULE-ERROR                                   03680001
036900         SET PS-ERROR TO TRUE                                     03690001
037000         MOVE 'XLKUP033'        TO DL026-CALL-MOD-FAIL-NM         03700001
037100         MOVE XL072-RETURN-CODE TO DL026-CALL-MOD-FAIL-ERR-CDE    03710001
037200         SET DL026-CALLED-MODULE-FAILURE TO TRUE                  03720001
037300         IF  XL072-SQL-ERROR                                      03730001
037400             MOVE XL072-EAI-DB-SQLCODE TO                         03740001
037500                  DL026-CALL-MOD-FAIL-SQL-CDE                     03750001
037600             MOVE XL072-SQL-ERROR-PARA TO                         03760001
037700                  DL026-CALL-MOD-FAIL-SQL-PARA                    03770001
037800         END-IF                                                   03780001
037900     END-IF.                                                      03790001
038000                                                                  03800001
038100                                                                  03810001
038200*--------------------------------------------------------------*  03820001
038300*                                                              *  03830001
038400*--------------------------------------------------------------*  03840001
038500 4000-OPEN-CURSOR.                                                03850001
038600                                                                  03860002
038700***  MOVE SPACES TO PV-MSG-AREA2                                  03870011
038800***  MOVE ' DLKUT030 -  4000-OPEN-CURSOR            '             03880011
038900***    TO PV-MSG-AREA2                                            03890011
039000***  MOVE LENGTH OF PV-MSG-AREA2                                  03900011
039100***    TO PV-COMMAREA-LENGTH                                      03910011
039200***  PERFORM 9200-WRITE-TO-LOG.                                   03920011
039300                                                                  03930002
039400     PERFORM                                                      03940001
039500         WITH TEST AFTER                                          03950001
039600             VARYING PV-RETRY-COUNTER                             03960001
039700             FROM 1 BY 1                                          03970001
039800             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              03980001
039900                OR SQLCODE = ZERO                                 03990001
040000                                                                  04000001
040100         EXEC SQL                                                 04010001
040200              OPEN  ACTIVE_ASGMT_CSR                              04020001
040300         END-EXEC                                                 04030001
040400                                                                  04040001
040500         EVALUATE TRUE                                            04050001
040600             WHEN SQLCODE = ZERO                                  04060001
040700                  CONTINUE                                        04070001
040800                                                                  04080001
040900             WHEN SQLCODE = +100                                  04090001
041000             WHEN SQLCODE = -904                                  04100001
041100             WHEN SQLCODE = -913                                  04110001
041200             WHEN SQLCODE = -911                                  04120001
041300             WHEN SQLWARN0 NOT = SPACES                           04130001
041400             WHEN SQLCODE NOT = ZERO                              04140001
041500                  MOVE +4             TO PV-RETRY-COUNTER         04150001
041600         END-EVALUATE                                             04160001
041700     END-PERFORM.                                                 04170001
041800                                                                  04180001
041900                                                                  04190001
042000     IF  SQLCODE = ZERO                                           04200001
042100         CONTINUE                                                 04210001
042200     ELSE                                                         04220001
042300         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    04230001
042400             MOVE '4000-'         TO DL026-CALL-MOD-FAIL-SQL-PARA 04240001
042500             MOVE SQLCODE         TO DL026-ASGMT-SQLCODE          04250001
042600             SET DL026-SQL-ERROR  TO TRUE                         04260001
042700             MOVE SQLCA           TO DL026-SQLCA                  04270001
042800                                                                  04280001
042900             MOVE SPACES TO PV-MSG-AREA2                          04290001
043000             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           04300001
043100             STRING ' DLKUT030 -'                                 04310001
043200                    PV-DISPLAY-OPER  '-'                          04320001
043300                    DL026-KEY-WK-TYP '-'                          04330001
043400                    DL026-KEY-WK-AREA                             04340001
043500                                             DELIMITED BY SIZE    04350001
043600                                        INTO PV-MSG-AREA2         04360001
043700             MOVE LENGTH OF PV-MSG-AREA2                          04370001
043800               TO PV-COMMAREA-LENGTH                              04380001
043900             PERFORM 9200-WRITE-TO-LOG                            04390001
044000                                                                  04400001
044100             MOVE SPACES TO PV-MSG-AREA2                          04410001
044200             MOVE SQLCODE          TO  PV-DISPLAY-SQLCODE         04420001
044300             STRING ' DLKUT030 -'                                 04430001
044400                   ' PARA: 4000 - '                               04440001
044500                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         04450001
044600                                       DELIMITED BY SIZE          04460001
044700                                  INTO PV-MSG-AREA2               04470001
044800             MOVE LENGTH OF PV-MSG-AREA2                          04480001
044900               TO PV-COMMAREA-LENGTH                              04490001
045000             PERFORM 9200-WRITE-TO-LOG                            04500001
045100        END-IF                                                    04510001
045200     END-IF.                                                      04520001
045300                                                                  04530001
045400                                                                  04540001
045500*--------------------------------------------------------------*  04550001
045600*                                                              *  04560001
045700*--------------------------------------------------------------*  04570001
045800 4010-FETCH-CURSOR.                                               04580001
045900                                                                  04590001
046000***  MOVE SPACES TO PV-MSG-AREA2                                  04600011
046100***  MOVE ' DLKUT030 -  4010-FETCH-CURSOR           '             04610011
046200***    TO PV-MSG-AREA2                                            04620011
046300***  MOVE LENGTH OF PV-MSG-AREA2                                  04630011
046400***    TO PV-COMMAREA-LENGTH                                      04640011
046500***  PERFORM 9200-WRITE-TO-LOG.                                   04650011
046600                                                                  04660002
046700     PERFORM                                                      04670001
046800         WITH TEST AFTER                                          04680001
046900         VARYING PV-RETRY-COUNTER                                 04690001
047000         FROM 1 BY 1                                              04700001
047100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  04710001
047200            OR SQLCODE = ZERO                                     04720001
047300            OR SQLCODE = +100                                     04730001
047400                                                                  04740001
047500         EXEC SQL                                                 04750001
047600             FETCH  ACTIVE_ASGMT_CSR                              04760001
047700                                                                  04770001
047800              INTO :DLT00003-ASGMT-STRT-DTE                       04780001
047900                 , :DLT00003-ASGMT-NBR-TXT                        04790001
048000                 , :DLT00003-ASGMT-NBR-SEQ-NBR                    04800001
048100                 , :DLT00003-TEM-ASGMT-SEQ-NBR                    04810001
048200                 , :DLT00003-KOHLS-USR-ID  :PV-NULL-IND1          04820001
048300                 , :DLT00003-TMP-USR-ID    :PV-NULL-IND2          04830001
048400                 , :DLT00003-JN-TMST                              04840001
048500                 , :DLT00003-CRE-BY-USR-ID                        04850001
048600                 , :DLT00004-ASGMT-STRT-TM                        04860001
048700                 , :DLT00004-WK-TYP-DESC                          04870001
048800                 , :DLT00004-WK-AREA-DESC                         04880001
048900                 , :DLT00004-DC-NBR                               04890001
049000                                                                  04900001
049100         END-EXEC                                                 04910001
049200                                                                  04920001
049300         EVALUATE TRUE                                            04930001
049400             WHEN SQLCODE = ZERO                                  04940001
049500                  IF  PV-NULL-IND1  =  -1                         04950001
049600                      MOVE  SPACES  TO  DLT00003-KOHLS-USR-ID     04960001
049700                      MOVE  DLT00003-TMP-USR-ID                   04970001
049800                        TO  DK-USER-ID                            04980001
049900                       SET  PV-USER-IS-TEMP   TO  TRUE            04990001
050000                  END-IF                                          05000001
050100                  IF  PV-NULL-IND2  =  -1                         05010001
050200                      MOVE  SPACES  TO  DLT00003-TMP-USR-ID       05020001
050300                      MOVE  DLT00003-KOHLS-USR-ID                 05030001
050400                        TO  DK-USER-ID                            05040001
050500                       SET  PV-USER-IS-KOHLS  TO  TRUE            05050001
050600                  END-IF                                          05060001
050700                                                                  05070001
050800             WHEN SQLCODE = +100                                  05080001
050900                  SET PS-END-OF-CURSOR TO TRUE                    05090001
051000                                                                  05100001
051100             WHEN SQLCODE = -904                                  05110001
051200             WHEN SQLCODE = -911                                  05120001
051300             WHEN SQLCODE = -913                                  05130001
051400             WHEN SQLWARN0 NOT = SPACES                           05140001
051500             WHEN SQLCODE NOT = ZERO                              05150001
051600                  MOVE +4             TO PV-RETRY-COUNTER         05160001
051700         END-EVALUATE                                             05170001
051800     END-PERFORM.                                                 05180001
051900                                                                  05190001
052000     IF SQLCODE = ZERO  OR                                        05200001
052100        SQLCODE = +100                                            05210001
052200        CONTINUE                                                  05220001
052300     ELSE                                                         05230001
052400        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     05240001
052500            MOVE '4010-'         TO DL026-CALL-MOD-FAIL-SQL-PARA  05250001
052600            MOVE SQLCODE         TO DL026-ASGMT-SQLCODE           05260001
052700            SET DL026-SQL-ERROR  TO TRUE                          05270001
052800            SET PS-ERROR         TO TRUE                          05280001
052900            MOVE SQLCA           TO DL026-SQLCA                   05290001
053000                                                                  05300001
053100             MOVE SPACES TO PV-MSG-AREA2                          05310001
053200             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           05320001
053300             STRING ' DLKUT030 -'                                 05330001
053400                    PV-DISPLAY-OPER  '-'                          05340001
053500                    DL026-KEY-WK-TYP '-'                          05350001
053600                    DL026-KEY-WK-AREA '-'                         05360001
053700                    DLT00003-KOHLS-USR-ID '-'                     05370001
053800                    DLT00003-TMP-USR-ID '-'                       05380001
053900                                             DELIMITED BY SIZE    05390001
054000                                        INTO PV-MSG-AREA2         05400001
054100             MOVE LENGTH OF PV-MSG-AREA2                          05410001
054200               TO PV-COMMAREA-LENGTH                              05420001
054300             PERFORM 9200-WRITE-TO-LOG                            05430001
054400                                                                  05440001
054500             MOVE SPACES TO PV-MSG-AREA2                          05450001
054600             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        05460001
054700             STRING ' DLKUT030 -'                                 05470001
054800                   ' PARA: 4010 - '                               05480001
054900                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         05490001
055000                                       DELIMITED BY SIZE          05500001
055100                                  INTO PV-MSG-AREA2               05510001
055200             MOVE LENGTH OF PV-MSG-AREA2                          05520001
055300               TO PV-COMMAREA-LENGTH                              05530001
055400             PERFORM 9200-WRITE-TO-LOG                            05540001
055500        END-IF                                                    05550001
055600     END-IF.                                                      05560001
055700                                                                  05570001
055800                                                                  05580001
055900*--------------------------------------------------------------*  05590001
056000*                                                              *  05600001
056100*--------------------------------------------------------------*  05610001
056200 4020-CLOSE-CURSOR.                                               05620001
056300                                                                  05630001
056400***  MOVE SPACES TO PV-MSG-AREA2                                  05640011
056500***  MOVE ' DLKUT030 -  4020-CLOSE-CURSOR           '             05650011
056600***    TO PV-MSG-AREA2                                            05660011
056700***  MOVE LENGTH OF PV-MSG-AREA2                                  05670011
056800***    TO PV-COMMAREA-LENGTH                                      05680011
056900***  PERFORM 9200-WRITE-TO-LOG.                                   05690011
057000                                                                  05700002
057100     PERFORM                                                      05710001
057200         WITH TEST AFTER                                          05720001
057300         VARYING PV-RETRY-COUNTER                                 05730001
057400         FROM 1 BY 1                                              05740001
057500         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  05750001
057600            OR SQLCODE = ZERO                                     05760001
057700                                                                  05770001
057800         EXEC SQL                                                 05780001
057900              CLOSE ACTIVE_ASGMT_CSR                              05790001
058000         END-EXEC                                                 05800001
058100                                                                  05810001
058200         EVALUATE TRUE                                            05820001
058300             WHEN SQLCODE = ZERO                                  05830001
058400                  CONTINUE                                        05840001
058500                                                                  05850001
058600             WHEN SQLCODE = -904                                  05860001
058700             WHEN SQLCODE = -913                                  05870001
058800             WHEN SQLCODE = -911                                  05880001
058900             WHEN SQLCODE = +100                                  05890001
059000             WHEN SQLWARN0 NOT = SPACES                           05900001
059100             WHEN SQLCODE NOT = ZERO                              05910001
059200                  MOVE +4             TO PV-RETRY-COUNTER         05920001
059300         END-EVALUATE                                             05930001
059400     END-PERFORM.                                                 05940001
059500                                                                  05950001
059600     IF SQLCODE = ZERO                                            05960001
059700        CONTINUE                                                  05970001
059800     ELSE                                                         05980001
059900        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     05990001
060000            MOVE '3000-'         TO DL026-CALL-MOD-FAIL-SQL-PARA  06000001
060100            MOVE SQLCODE         TO DL026-ASGMT-SQLCODE           06010001
060200            SET DL026-SQL-ERROR  TO TRUE                          06020001
060300            MOVE SQLCA           TO DL026-SQLCA                   06030001
060400                                                                  06040001
060500             MOVE SPACES TO PV-MSG-AREA2                          06050001
060600             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           06060001
060700             STRING ' DLKUT030 -'                                 06070001
060800                    PV-DISPLAY-OPER  '-'                          06080001
060900                    DL026-KEY-WK-TYP '-'                          06090001
061000                    DL026-KEY-WK-AREA '-'                         06100001
061100                    DLT00003-KOHLS-USR-ID '-'                     06110001
061200                    DLT00003-TMP-USR-ID  '-'                      06120001
061300                                             DELIMITED BY SIZE    06130001
061400                                        INTO PV-MSG-AREA2         06140001
061500             MOVE LENGTH OF PV-MSG-AREA2                          06150001
061600               TO PV-COMMAREA-LENGTH                              06160001
061700             PERFORM 9200-WRITE-TO-LOG                            06170001
061800                                                                  06180001
061900             MOVE SPACES TO PV-MSG-AREA2                          06190001
062000             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        06200001
062100             STRING ' DLKUT030 -'                                 06210001
062200                   ' PARA: 4020 - '                               06220001
062300                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         06230001
062400                                       DELIMITED BY SIZE          06240001
062500                                  INTO PV-MSG-AREA2               06250001
062600             MOVE LENGTH OF PV-MSG-AREA2                          06260001
062700               TO PV-COMMAREA-LENGTH                              06270001
062800             PERFORM 9200-WRITE-TO-LOG                            06280001
062900        END-IF                                                    06290001
063000     END-IF.                                                      06300001
063100                                                                  06310001
063200                                                                  06320001
063300*--------------------------------------------------------------*  06330001
063400*                                                              *  06340001
063500*--------------------------------------------------------------*  06350001
063600 4030-COUNT-OPEN-ASGMTS.                                          06360001
063700                                                                  06370001
063800***  MOVE SPACES TO PV-MSG-AREA2                                  06380011
063900***  MOVE ' DLKUT030 -  4030-COUNT-OPEN-ASGMTS      '             06390011
064000***    TO PV-MSG-AREA2                                            06400011
064100***  MOVE LENGTH OF PV-MSG-AREA2                                  06410011
064200***    TO PV-COMMAREA-LENGTH                                      06420011
064300***  PERFORM 9200-WRITE-TO-LOG.                                   06430011
064400                                                                  06440002
064500                                                                  06450001
064600     EXEC SQL                                                     06460001
064700          SELECT  COUNT(*)                                        06470001
064800            INTO :PV-ASGMT-COUNT                                  06480001
064900            FROM  DLT_ASGMT                                       06490001
065000           WHERE  DC_NBR              =  :DK-ASGMT-DC-NBR         06500001
065100             AND  WK_TYP_DESC         =  :DK-ASGMT-WK-TYPE        06510001
065200             AND  WK_AREA_DESC        =  :DK-ASGMT-WK-AREA        06520001
065300             AND  ASGMT_STRT_DTE     <=  :DK-CURRENT-DATE         06530001
065400             AND  ASGMT_STRT_TM      <=  :DK-CURRENT-TIME         06540001
065500             AND  ASGMT_STP_TMST     IS  NULL                     06550001
065600     END-EXEC                                                     06560001
065700                                                                  06570001
065800     EVALUATE TRUE                                                06580001
065900         WHEN SQLCODE = ZERO                                      06590001
066000              IF  PV-ASGMT-COUNT  > 0                             06600001
066100                  PERFORM 4040-END-ASGMT                          06610001
066200              END-IF                                              06620001
066300                                                                  06630001
066400         WHEN SQLCODE = +100                                      06640001
066500              CONTINUE                                            06650001
066600                                                                  06660001
066700         WHEN SQLCODE = -904                                      06670001
066800         WHEN SQLCODE = -911                                      06680001
066900         WHEN SQLCODE = -913                                      06690001
067000         WHEN SQLWARN0 NOT = SPACES                               06700001
067100         WHEN SQLCODE NOT = ZERO                                  06710001
067200                                                                  06720001
067300             MOVE '4030-'        TO DL026-CALL-MOD-FAIL-SQL-PARA  06730001
067400             MOVE SQLCODE        TO DL026-ASGMT-SQLCODE           06740001
067500             SET DL026-SQL-ERROR TO TRUE                          06750001
067600             SET PS-ERROR        TO TRUE                          06760001
067700             MOVE SQLCA          TO DL026-SQLCA                   06770001
067800                                                                  06780001
067900             MOVE SPACES TO PV-MSG-AREA2                          06790001
068000             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           06800001
068100             STRING ' DLKUT030 -'                                 06810001
068200                    PV-DISPLAY-OPER  '-'                          06820001
068300                    DL026-KEY-WK-TYP '-'                          06830001
068400                    DL026-KEY-WK-AREA '-'                         06840001
068500                    DLT00003-KOHLS-USR-ID '-'                     06850001
068600                    DLT00003-TMP-USR-ID '-'                       06860001
068700                                             DELIMITED BY SIZE    06870001
068800                                        INTO PV-MSG-AREA2         06880001
068900             MOVE LENGTH OF PV-MSG-AREA2                          06890001
069000               TO PV-COMMAREA-LENGTH                              06900001
069100             PERFORM 9200-WRITE-TO-LOG                            06910001
069200                                                                  06920001
069300             MOVE SPACES TO PV-MSG-AREA2                          06930001
069400             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        06940001
069500             STRING ' DLKUT030 -'                                 06950001
069600                   ' PARA: 4030 - '                               06960001
069700                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         06970001
069800                                       DELIMITED BY SIZE          06980001
069900                                  INTO PV-MSG-AREA2               06990001
070000             MOVE LENGTH OF PV-MSG-AREA2                          07000001
070100               TO PV-COMMAREA-LENGTH                              07010001
070200             PERFORM 9200-WRITE-TO-LOG                            07020001
070300                                                                  07030001
070400     END-EVALUATE.                                                07040001
070500                                                                  07050001
070600                                                                  07060001
070700*--------------------------------------------------------------*  07070001
070800*                                                              *  07080001
070900*--------------------------------------------------------------*  07090001
071000 4040-END-ASGMT.                                                  07100001
071100                                                                  07110001
071200***  MOVE SPACES TO PV-MSG-AREA2                                  07120011
071300***  MOVE ' DLKUT030 -  4040-END-ASGMT              '             07130011
071400***    TO PV-MSG-AREA2                                            07140011
071500***  MOVE LENGTH OF PV-MSG-AREA2                                  07150011
071600***    TO PV-COMMAREA-LENGTH                                      07160011
071700***  PERFORM 9200-WRITE-TO-LOG.                                   07170011
071800                                                                  07180002
071900     EXEC SQL                                                     07190001
072000          UPDATE  DLT_ASGMT                                       07200001
072100             SET  ASGMT_STP_TMST      =  CURRENT TIMESTAMP        07210001
072200                , ASGMT_STP_RSN_CDE   = 'S'                       07220001
072300                , STP_BY_PGM_NM       = 'DLKUT030'                07230001
072400           WHERE  DC_NBR              =  :DK-ASGMT-DC-NBR         07240001
072500             AND  WK_TYP_DESC         =  :DK-ASGMT-WK-TYPE        07250001
072600             AND  WK_AREA_DESC        =  :DK-ASGMT-WK-AREA        07260001
072700             AND  ASGMT_STRT_DTE     <=  :DK-CURRENT-DATE         07270001
072800             AND  ASGMT_STRT_TM      <=  :DK-CURRENT-TIME         07280001
072900             AND  ASGMT_STP_TMST     IS  NULL                     07290001
073000     END-EXEC                                                     07300001
073100                                                                  07310001
073200     EVALUATE TRUE                                                07320001
073300         WHEN SQLCODE = ZERO                                      07330001
073400         WHEN SQLCODE = +100                                      07340001
073401                                                                  07340108
073410         MOVE SPACES TO PV-MSG-AREA2                              07341008
073420         MOVE ' DLKUT030 -  MULT ASGMT OPEN FOR WK AREA '         07342008
073430           TO PV-MSG-AREA2                                        07343008
073440         MOVE LENGTH OF PV-MSG-AREA2                              07344008
073450           TO PV-COMMAREA-LENGTH                                  07345008
073460         PERFORM 9200-WRITE-TO-LOG                                07346008
073470                                                                  07347008
073480         MOVE SPACES           TO PV-MSG-AREA2                    07348009
073481         MOVE DK-ASGMT-DC-NBR  TO PV-DISPLAY-OPER                 07348109
073482         MOVE SQLCODE          TO PV-DISPLAY-SQLCODE              07348209
073483         STRING ' DLKUT030 - '                                    07348308
073484                 PV-DISPLAY-OPER   '-'                            07348408
073485                 DK-ASGMT-WK-TYPE  '-'                            07348508
073486                 DK-ASGMT-WK-AREA  ' - '                          07348608
073487                 DK-CURRENT-DATE   '-'                            07348708
073488                 DK-CURRENT-TIME   ' - '                          07348808
073489                 'SQLCODE= '                                      07348908
073491                 PV-DISPLAY-SQLCODE      DELIMITED BY SIZE        07349108
073492           INTO  PV-MSG-AREA2                                     07349208
073493         MOVE LENGTH OF PV-MSG-AREA2                              07349308
073494           TO PV-COMMAREA-LENGTH                                  07349408
073495         PERFORM 9200-WRITE-TO-LOG                                07349508
073600                                                                  07360001
073610         PERFORM 8000-SYNCPOINT                                   07361010
073630                                                                  07363010
073700         WHEN SQLCODE = -904                                      07370001
073800         WHEN SQLCODE = -911                                      07380001
073900         WHEN SQLCODE = -913                                      07390001
074000         WHEN SQLWARN0 NOT = SPACES                               07400001
074100         WHEN SQLCODE NOT = ZERO                                  07410001
074200                                                                  07420001
074300             MOVE '4040-'        TO DL026-CALL-MOD-FAIL-SQL-PARA  07430001
074400             MOVE SQLCODE        TO DL026-ASGMT-SQLCODE           07440001
074500             SET DL026-SQL-ERROR TO TRUE                          07450001
074600             SET PS-ERROR        TO TRUE                          07460001
074700             MOVE SQLCA          TO DL026-SQLCA                   07470001
074800                                                                  07480001
074900             MOVE SPACES TO PV-MSG-AREA2                          07490001
075000             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           07500001
075100             STRING ' DLKUT030 -'                                 07510001
075200                    PV-DISPLAY-OPER  '-'                          07520001
075300                    DL026-KEY-WK-TYP '-'                          07530001
075400                    DL026-KEY-WK-AREA '-'                         07540001
075500                    DLT00003-KOHLS-USR-ID '-'                     07550001
075600                    DLT00003-TMP-USR-ID '-'                       07560001
075700                                             DELIMITED BY SIZE    07570001
075800                                        INTO PV-MSG-AREA2         07580001
075900             MOVE LENGTH OF PV-MSG-AREA2                          07590001
076000               TO PV-COMMAREA-LENGTH                              07600001
076100             PERFORM 9200-WRITE-TO-LOG                            07610001
076200                                                                  07620001
076300             MOVE SPACES TO PV-MSG-AREA2                          07630001
076400             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        07640001
076500             STRING ' DLKUT030 -'                                 07650001
076600                   ' PARA: 4040 - '                               07660001
076700                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         07670001
076800                                       DELIMITED BY SIZE          07680001
076900                                  INTO PV-MSG-AREA2               07690001
077000             MOVE LENGTH OF PV-MSG-AREA2                          07700001
077100               TO PV-COMMAREA-LENGTH                              07710001
077200             PERFORM 9200-WRITE-TO-LOG                            07720001
077300                                                                  07730001
077400     END-EVALUATE.                                                07740001
077500                                                                  07750001
077600                                                                  07760001
077700*--------------------------------------------------------------*  07770001
077800*                                                              *  07780001
077900*--------------------------------------------------------------*  07790001
078000 4500-INSERT-TUPLDER.                                             07800001
078100                                                                  07810001
078200***  MOVE SPACES TO PV-MSG-AREA2                                  07820011
078300***  MOVE ' DLKUT030 -  4500-INSERT-TUPLDER         '             07830011
078400***    TO PV-MSG-AREA2                                            07840011
078500***  MOVE LENGTH OF PV-MSG-AREA2                                  07850011
078600***    TO PV-COMMAREA-LENGTH                                      07860011
078700***  PERFORM 9200-WRITE-TO-LOG.                                   07870011
078800                                                                  07880002
078900     MOVE DLT00004-DC-NBR              TO UPLDER-OPER-UNT-ID.     07890001
079000     MOVE 'F'                          TO UPLDER-UPLD-TRN-CDE.    07900001
079100     MOVE '102'                        TO UPLDER-ERR-CDE.         07910001
079200     MOVE  0                           TO UPLDER-UPLD-SEQ-NBR.    07920001
079300                                                                  07930001
079400     INITIALIZE  UPLDER-PKT-TXT.                                  07940001
079500     MOVE DLT00004-DC-NBR  TO  PV-DISPLAY-OPER                    07950001
079600     STRING   PV-DISPLAY-OPER         ' '                         07960001
079700              DLT00003-KOHLS-USR-ID   ' '                         07970001
079800              DLT00003-TMP-USR-ID     ' '                         07980001
079900              DLT00004-WK-TYP-DESC    ' '                         07990001
080000              DLT00004-WK-AREA-DESC   ' '                         08000001
080100              DLT00003-ASGMT-STRT-DTE ' '                         08010001
080200              DLT00003-ASGMT-NBR-TXT  ' '                         08020001
080300              DLT00003-JN-TMST        DELIMITED BY SIZE           08030001
080400                                     INTO UPLDER-PKT-TXT.         08040001
080500                                                                  08050001
080600     EXEC SQL                                                     08060001
080700         INSERT                                                   08070001
080800           INTO TUPLDER                                           08080001
080900             ( OPER_UNT_ID                                        08090001
081000             , UPLD_TRN_CDE                                       08100001
081100             , ERR_CDE                                            08110001
081200             , PRC_TMST                                           08120001
081300             , UPLD_SEQ_NBR                                       08130001
081400             , PKT_TXT                                            08140001
081500             )                                                    08150001
081600             VALUES                                               08160001
081700             ( :UPLDER-OPER-UNT-ID                                08170001
081800             , :UPLDER-UPLD-TRN-CDE                               08180001
081900             , :UPLDER-ERR-CDE                                    08190001
082000             ,  CURRENT TIMESTAMP                                 08200001
082100             , :UPLDER-UPLD-SEQ-NBR                               08210001
082200             , :UPLDER-PKT-TXT                                    08220001
082300             )                                                    08230001
082400     END-EXEC.                                                    08240001
082500                                                                  08250001
082600     EVALUATE TRUE                                                08260001
082700         WHEN SQLCODE = ZERO                                      08270001
082800             CONTINUE                                             08280001
082900         WHEN SQLWARN0 NOT = SPACES                               08290001
083000         WHEN SQLCODE  NOT = ZERO                                 08300001
083100                                                                  08310001
083200            MOVE '4500-'         TO DL026-CALL-MOD-FAIL-SQL-PARA  08320001
083300            MOVE SQLCODE         TO DL026-ASGMT-SQLCODE           08330001
083400            SET DL026-SQL-ERROR  TO TRUE                          08340001
083500            MOVE SQLCA           TO DL026-SQLCA                   08350001
083600                                                                  08360001
083700             MOVE SPACES TO PV-MSG-AREA2                          08370001
083800             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           08380001
083900             STRING ' DLKUT030 -'                                 08390001
084000                    PV-DISPLAY-OPER  '-'                          08400001
084100                    DL026-KEY-WK-TYP '-'                          08410001
084200                    DL026-KEY-WK-AREA '-'                         08420001
084300                    DLT00003-KOHLS-USR-ID '-'                     08430001
084400                    DLT00003-TMP-USR-ID '-'                       08440001
084500                                             DELIMITED BY SIZE    08450001
084600                                        INTO PV-MSG-AREA2         08460001
084700             MOVE LENGTH OF PV-MSG-AREA2                          08470001
084800               TO PV-COMMAREA-LENGTH                              08480001
084900             PERFORM 9200-WRITE-TO-LOG                            08490001
085000                                                                  08500001
085100             MOVE SPACES TO PV-MSG-AREA2                          08510001
085200             MOVE SQLCODE           TO  PV-DISPLAY-SQLCODE        08520001
085300             STRING ' DLKUT030 -'                                 08530001
085400                   ' PARA: 4500-INSERT-TUPLDER'                   08540001
085500                   ' SQLCODE: '        PV-DISPLAY-SQLCODE         08550001
085600                                       DELIMITED BY SIZE          08560001
085700                                  INTO PV-MSG-AREA2               08570001
085800             MOVE LENGTH OF PV-MSG-AREA2                          08580001
085900               TO PV-COMMAREA-LENGTH                              08590001
086000             PERFORM 9200-WRITE-TO-LOG                            08600001
086100                                                                  08610001
086200     END-EVALUATE.                                                08620001
086300                                                                  08630001
086400*-----------------------------------------------------------------08640001
086500*  CALL DLKUP002 TO EITHER END THE ASSOCIATE FORM AN ASSIGNMENT  *08650001
086600*  OR ADD THE ASSOCIATE TO AN ASSIGNMENT.                        *08660001
086700*-----------------------------------------------------------------08670001
086800 6300-CALL-DLKUP002.                                              08680001
086900                                                                  08690001
087000***  MOVE SPACES TO PV-MSG-AREA2                                  08700011
087100***  MOVE ' DLKUT030 -  6300-CALL-DLKUP002          '             08710011
087200***    TO PV-MSG-AREA2                                            08720011
087300***  MOVE LENGTH OF PV-MSG-AREA2                                  08730011
087400***    TO PV-COMMAREA-LENGTH                                      08740011
087500***  PERFORM 9200-WRITE-TO-LOG.                                   08750011
087600                                                                  08760002
087700     CALL DL005-USER-PGM USING DFHEIBLK                           08770005
087800                               DL005-COMMAREA                     08780005
087900                               DL005-ASGMT-COMMAREA.              08790005
088000                                                                  08800005
088100                                                                  08810001
088200     EVALUATE TRUE                                                08820001
088300         WHEN DL005-SUCCESSFUL                                    08830001
088400             CONTINUE                                             08840001
088500         WHEN OTHER                                               08850001
088600             SET PS-CALLED-MODULE-ERROR TO TRUE                   08860001
088700             MOVE SPACES TO PV-MSG-AREA2                          08870001
088800             STRING ' DLKUT030 - '           DELIMITED BY SIZE    08880001
088900                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    08890001
089000                                           INTO PV-MSG-AREA2      08900001
089100             MOVE LENGTH OF PV-MSG-AREA2                          08910001
089200               TO PV-COMMAREA-LENGTH                              08920001
089300             PERFORM 9200-WRITE-TO-LOG                            08930001
089400                                                                  08940001
089500             MOVE SPACES TO PV-MSG-AREA2                          08950001
089600             MOVE '6300-CALL-DLKUP002' TO PV-MODULE-PARAGRPAH     08960001
089700             MOVE DL005-ASGMT-SQLCODE  TO PV-DISPLAY-SQLCODE      08970001
089800             STRING ' DLKUT030 - '        PV-MODULE-FAIL-MSG      08980001
089900                    ' TO '                PV-DISPLAY-TEXT         08990001
090000                    ' ASSIGNMENT'                                 09000001
090100                    ' RETURN CODE: '      DL005-RETURN-CODE       09010001
090200                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      09020001
090300                                          DELIMITED BY SIZE       09030001
090400                                     INTO PV-MSG-AREA2            09040001
090500             MOVE LENGTH OF PV-MSG-AREA2                          09050001
090600               TO PV-COMMAREA-LENGTH                              09060001
090700             PERFORM 9200-WRITE-TO-LOG                            09070001
090800                                                                  09080001
090900             MOVE SPACES TO PV-MSG-AREA2                          09090001
091000             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           09100001
091100             STRING ' DLKUT030 -'                                 09110001
091200                    PV-DISPLAY-OPER  '-'                          09120001
091300                    DL026-KEY-WK-TYP '-'                          09130001
091400                    DL026-KEY-WK-AREA '-'                         09140001
091500                    DK-USER-ID        '-'                         09150001
091600                    PV-USR-TYP-CDE           DELIMITED BY SIZE    09160001
091700                                        INTO PV-MSG-AREA2         09170001
091800             MOVE LENGTH OF PV-MSG-AREA2                          09180001
091900               TO PV-COMMAREA-LENGTH                              09190001
092000             PERFORM 9200-WRITE-TO-LOG                            09200001
092100     END-EVALUATE.                                                09210001
092200                                                                  09220001
092300                                                                  09230001
092400*-----------------------------------------------------------------09240001
092500*  CALL XLKUP033 TO LOG AN INDIRECT SYSTEM MOVE TO THE EAI       *09250001
092600*  BUSINESS EVENT TABLES.                                        *09260001
092700*-----------------------------------------------------------------09270001
092800 6500-CALL-XLKUP033.                                              09280001
092900                                                                  09290002
093000***  MOVE SPACES TO PV-MSG-AREA2                                  09300011
093100***  MOVE ' DLKUT030 - 6500-CALL-XLKUP033           '             09310011
093200***    TO PV-MSG-AREA2                                            09320011
093300***  MOVE LENGTH OF PV-MSG-AREA2                                  09330011
093400***    TO PV-COMMAREA-LENGTH                                      09340011
093500***  PERFORM 9200-WRITE-TO-LOG.                                   09350011
093600                                                                  09360001
093700     CALL XL072-USER-PGM USING DFHEIBLK                           09370006
093800                              XL072-COMMAREA                      09380006
093900                              XL072-EAI-EXPORT-COMMAREA.          09390006
094000                                                                  09400001
094100     EVALUATE TRUE                                                09410001
094200         WHEN XL072-SUCCESSFUL                                    09420001
094300             CONTINUE                                             09430001
094400         WHEN OTHER                                               09440001
094500             SET PS-CALLED-MODULE-ERROR TO TRUE                   09450001
094600             MOVE SPACES TO PV-MSG-AREA2                          09460001
094700             STRING ' DLKUT030 - '                                09470001
094800                    'CALLED MODULE FAILED'   DELIMITED BY SIZE    09480001
094900                                           INTO PV-MSG-AREA2      09490001
095000             MOVE LENGTH OF PV-MSG-AREA2                          09500001
095100               TO PV-COMMAREA-LENGTH                              09510001
095200             PERFORM 9200-WRITE-TO-LOG                            09520001
095300                                                                  09530001
095400             MOVE SPACES TO PV-MSG-AREA2                          09540001
095500             MOVE '6500-CALL-XLKUP033' TO PV-MODULE-PARAGRPAH     09550001
095600             MOVE XL072-EAI-DB-SQLCODE TO PV-DISPLAY-SQLCODE      09560001
095700             STRING ' DLKUT030 - '        PV-MODULE-FAIL-MSG      09570001
095800                    ' RETURN CODE: '      XL072-RETURN-CODE       09580001
095900                    ' SQLCODE: '          PV-DISPLAY-SQLCODE      09590001
096000                                          DELIMITED BY SIZE       09600001
096100                                     INTO PV-MSG-AREA2            09610001
096200             MOVE LENGTH OF PV-MSG-AREA2                          09620001
096300               TO PV-COMMAREA-LENGTH                              09630001
096400             PERFORM 9200-WRITE-TO-LOG                            09640001
096500                                                                  09650001
096600             MOVE SPACES TO PV-MSG-AREA2                          09660001
096700             MOVE DL026-KEY-DC-NBR  TO  PV-DISPLAY-OPER           09670001
096800             STRING ' DLKUT030 -'                                 09680001
096900                    PV-DISPLAY-OPER  '-'                          09690001
097000                    DL026-KEY-WK-TYP '-'                          09700001
097100                    DL026-KEY-WK-AREA '-'                         09710001
097200                    DLT00003-KOHLS-USR-ID '-'                     09720001
097300                    DLT00003-TMP-USR-ID '-'                       09730001
097400                                             DELIMITED BY SIZE    09740001
097500                                        INTO PV-MSG-AREA2         09750001
097600             MOVE LENGTH OF PV-MSG-AREA2                          09760001
097700               TO PV-COMMAREA-LENGTH                              09770001
097800             PERFORM 9200-WRITE-TO-LOG                            09780001
097900     END-EVALUATE.                                                09790001
098000                                                                  09800001
098001                                                                  09800110
098010 8000-SYNCPOINT.                                                  09801010
098020                                                                  09802010
098030     EXEC CICS                                                    09803010
098040          SYNCPOINT                                               09804010
098050     END-EXEC.                                                    09805010
098060                                                                  09806010
098100                                                                  09810001
098200 9200-WRITE-TO-LOG.                                               09820001
098300                                                                  09830001
098400     EXEC CICS                                                    09840002
098500          WRITEQ TD                                               09850002
098600           QUEUE  ('CSSL')                                        09860002
098700            FROM  (PV-MSG-AREA2)                                  09870002
098800          LENGTH  (PV-COMMAREA-LENGTH)                            09880002
098900            RESP  (PV-CICS-RESP)                                  09890004
099000     END-EXEC.                                                    09900002
099100                                                                  09910001
