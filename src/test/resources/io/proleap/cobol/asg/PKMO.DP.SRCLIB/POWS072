000001******************************************************************00010001
      * THIS COPY BOOK MUST BE USED WITH POWS072A. PROGRAM WILL CRASH  *00020001
      * IF POWS072A IS NOT COPIED AND USED WITH POWS072. VARIABLE      *00030001
      * PV-EXEMPT-DEPT IS DEFINED IN COPYBOOK POWS072A.                *00040001
      ******************************************************************00050001
000002   POWS072-VERIFY-HANG-TAGS.                                      00060001
            MOVE 0 TO PV-COUNT.                                         00070001
            IF NOT PV-EXEMPT-DEPT                                       00080001
W24803      MOVE DK-PO-NBR TO PURCHS-PO-NBR                             00081001
  0000          EXEC SQL                                                00082001
  0001           SELECT COUNT(*)                                        00083001
  0001           INTO :PV-COUNT                                         00084001
  0002           FROM                                                   00085001
  0003              (SELECT DISTINCT F.TKT_FMT_NBR, F.TKT_FMT_DESC      00086001
  0005              FROM TPURCHS G,                                     00087001
  0006                   TPURITM H,                                     00088001
W24803*                  TSK A,                                         00089001
W24803*                  TUPCSKU B,                                     00090001
W24803*                  TUPC C,                                        00100001
W24803*                  TMDARVS D,                                     00110001
W24803*                  TVSCHVL E,                                     00120001
W24803                   XLT_SKU A,                                     00130001
W24803                   XLT_UPC B,                                     00140001
W24803                   XLT_VND_STYL C,                                00150001
  0012                   TTKTFMT F                                      00160001
W24803              WHERE G.PO_NBR =:PURCHS-PO-NBR                      00170001
W24803*             WHERE G.PO_NBR =:DK-PO-NBR                          00180001
  0014                AND G.VER_STATUS_CDE = 'A'                        00190001
  0015                AND NOT G.STATUS_CDE = 'CA'                       00200001
  0016                AND G.PO_NBR = H.PO_NBR                           00210001
  0017                AND H.VER_STATUS_CDE = 'A'                        00220001
  0018                AND NOT H.STATUS_CDE = 'CA'                       00230001
W24803                AND H.ITM_NBR  = A.ITM_NBR                        00240001
W24803                AND NOT A.SKU_STAT_CDE = '98'                     00250001
W24803                AND A.INTR_UPC_ID = B.INTR_UPC_ID                 00260001
W24803                AND B.UPC_TYP_CDE = 'I'                           00270001
W24803                AND A.STYL_ID = C.STYL_ID                         00271001
W24803                AND C.TKT_TYP_DESC = F.TKT_FMT_DESC) AS TEMP      00272001
W24803*               AND A.MERCH_DEPT_NMBR = G.DEPT_NBR                00273001
W24803*               AND A.MERCH_CLASS_NMBR = H.CL_NBR                 00274001
W24803*               AND A.SEQ_NMBR = H.SKU_SEQ_NBR                    00275001
W24803*               AND NOT A.STATUS_CODE = 98                        00276001
W24803*               AND A.ITEM_NMBR = B.ITEM_NBR                      00277001
W24803*               AND B.UPC_NBR = C.UPC_NBR                         00278001
W24803*               AND C.EFF_END_DTE IS NULL                         00279001
W24803*               AND C.UPC_TYP_CDE = 'I'                           00280001
W24803*               AND C.SUB_CL_MDSEAR_ID = D.SUB_CL_MDSEAR_ID       00290001
W24803*               AND C.VS_ID = D.VS_ID                             00300001
W24803*               AND D.TKT_TYP_SEQ_NBR = E.CHARTC_SEQ_NBR          00310001
W24803*               AND E.CHARTC_CDE = 2                              00320001
W24803*               AND E.CHARTC_VAL_DESC = F.TKT_FMT_DESC) AS TEMP   00330001
  0032             END-EXEC                                             00340001
  0032           EVALUATE TRUE                                          00350001
  0032               WHEN SQLCODE = ZERO                                00360001
  0032               WHEN SQLCODE = -904                                00370001
  0032               WHEN SQLCODE = -913                                00380001
  0032                   CONTINUE                                       00390001
  0032               WHEN SQLWARN0 NOT = SPACES                         00400001
  0032               WHEN SQLCODE < ZERO                                00410001
  0032               WHEN SQLCODE > ZERO                                00420001
  0032                   MOVE 'POWS072-VERIFY-HANG-TAGS'                00430001
  0032                                     TO DP013-PARAGRAPH           00440001
  0032                   MOVE 'SQL ERROR VERIFYING NUM HANG TAGS'       00450001
  0032                                     TO DP013-MESSAGE-TEXT (1)    00460001
  0032                   MOVE SQLCA        TO DP013-SQLCA               00470001
  0032                   MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)  00480001
  0032                   SET DP013-DB2-ABEND                            00490001
  0032                       DP013-XCTL-DISPLAY-RESTART TO TRUE         00500001
  0032                   PERFORM DP013-0000-PROCESS-ABEND               00510001
  0032           END-EVALUATE                                           00520001
  0032*                                                                 00530001
           END-IF.                                                      00540001
003302                                                                  00550001
003303******************************************************************00560001
003304* POWS072-VERIFY-HANG-TAGS DETERMINES WHETHER OR NOT ALL   *******00570001
003305* THE LINES ON A PURCHASE ORDER HAVE THE SAME HANG TAG     *******00580001
003306* NUMBER.  IF ALL THE LINES DO HAVE THE SAME HANG TAG      *******00590001
003307* NUMBER, POWS072-GET-HANG-TAG CAN BE USED TO RETRIEVE     *******00600001
003308* THE HANG TAG NUMBER.  THIS IS USED TO PASS THE HANG TAG  *******00610001
003309* TO THE EDI PURCHASE ORDER FILE.                          *******00620001
003310******************************************************************00630001
003311                                                                  00640001
003312   POWS072-GET-HANG-TAG.                                          00650001
003313                                                                  00660001
W24803        MOVE DK-PO-NBR TO PURCHS-PO-NBR.                          00670001
003320        EXEC SQL                                                  00680001
003321          SELECT DISTINCT F.TKT_FMT_NBR, F.TKT_FMT_DESC           00690001
003322           INTO :TKTFMT-TKT-FMT-NBR                               00700001
003323               ,:TKTFMT-TKT-FMT-DESC                              00710001
003324            FROM TPURCHS G,                                       00720001
003325                 TPURITM H,                                       00730001
W24803*                TSK A,                                           00740001
W24803*                TUPCSKU B,                                       00750001
W24803*                TUPC C,                                          00760001
W24803*                TMDARVS D,                                       00770001
W24803*                TVSCHVL E,                                       00780001
W24803                 XLT_SKU A,                                       00790001
W24803                 XLT_UPC B,                                       00800001
W24803                 XLT_VND_STYL C,                                  00810001
003331                 TTKTFMT F                                        00820001
W24803            WHERE G.PO_NBR =:PURCHS-PO-NBR                        00830001
W24803*           WHERE G.PO_NBR =:DK-PO-NBR                            00840001
003333              AND G.VER_STATUS_CDE = 'A'                          00850001
003334              AND NOT G.STATUS_CDE = 'CA'                         00860001
003335              AND G.PO_NBR = H.PO_NBR                             00870001
003336              AND H.VER_STATUS_CDE = 'A'                          00880001
003337              AND NOT H.STATUS_CDE = 'CA'                         00890001
W24803              AND H.ITM_NBR  = A.ITM_NBR                          00900001
W24803              AND NOT A.SKU_STAT_CDE = '98'                       00910001
W24803              AND A.INTR_UPC_ID = B.INTR_UPC_ID                   00911001
W24803              AND B.UPC_TYP_CDE = 'I'                             00912001
W24803              AND A.STYL_ID = C.STYL_ID                           00913001
W24803              AND C.TKT_TYP_DESC = F.TKT_FMT_DESC                 00914001
W24803*             AND A.MERCH_DEPT_NMBR = G.DEPT_NBR                  00915001
W24803*             AND A.MERCH_CLASS_NMBR = H.CL_NBR                   00916001
W24803*             AND A.SEQ_NMBR = H.SKU_SEQ_NBR                      00917001
W24803*             AND NOT A.STATUS_CODE = 98                          00918001
W24803*             AND A.ITEM_NMBR = B.ITEM_NBR                        00919001
W24803*             AND B.UPC_NBR = C.UPC_NBR                           00920001
W24803*             AND C.EFF_END_DTE IS NULL                           00930001
W24803*             AND C.UPC_TYP_CDE = 'I'                             00940001
W24803*             AND C.SUB_CL_MDSEAR_ID = D.SUB_CL_MDSEAR_ID         00950001
W24803*             AND C.VS_ID = D.VS_ID                               00960001
W24803*             AND D.TKT_TYP_SEQ_NBR = E.CHARTC_SEQ_NBR            00970001
W24803*             AND E.CHARTC_CDE = 2                                00980001
W24803*             AND E.CHARTC_VAL_DESC = F.TKT_FMT_DESC              00990001
003351           END-EXEC                                               01000001
003352         EVALUATE TRUE                                            01010001
003353             WHEN SQLCODE = ZERO                                  01020001
003354             WHEN SQLCODE = -904                                  01030001
003355             WHEN SQLCODE = -913                                  01040001
003356                 CONTINUE                                         01050001
003357             WHEN SQLWARN0 NOT = SPACES                           01060001
003358             WHEN SQLCODE < ZERO                                  01070001
003359             WHEN SQLCODE > ZERO                                  01080001
003360                 MOVE 'POWS072-GET-HANG-TAG'                      01090001
003361                                   TO DP013-PARAGRAPH             01100001
003362                 MOVE 'SQL ERROR SELECTING HANG TAG'              01110001
003363                                   TO DP013-MESSAGE-TEXT (1)      01120001
003364                 MOVE SQLCA        TO DP013-SQLCA                 01130001
003365                 MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)    01140001
003366                 SET DP013-DB2-ABEND                              01150001
003367                     DP013-XCTL-DISPLAY-RESTART TO TRUE           01160001
003368                 PERFORM DP013-0000-PROCESS-ABEND                 01170001
003369         END-EVALUATE.                                            01180001
003371                                                                  01190001
