000110******************************************************************00020001
000200 IDENTIFICATION DIVISION.                                         00030001
000300******************************************************************00040001
000400                                                                  00050001
000500 PROGRAM-ID.   RVKUT039.                                          00060002
000600 AUTHOR.       JOHN HUTCHINSON.                                   00070002
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                           00080001
000800 DATE-WRITTEN. SETPEMBER 2011.                                    00090002
000900 DATE-COMPILED.                                                   00100001
001000                                                                  00110001
001100*----------------------------------------------------------------*00120002
001200*  RTV - GENCO FILES: VERIFY THAT CONTROL RECORD EXISTS, AS WELL  00130002
001300*                     AS ENSURE THAT THE JOB IS ONLY PROCESSING   00140002
001400*                     ONE CONTROL RECORD AT A TIME.               00150002
001500*----------------------------------------------------------------*00160002
001600* DATE:        10/30/2011                                         00280001
001700* PROJ#:       3219  GENCO/RTV UPGRADE PROJECT                    00290001
001800* WR/IR#:      WR40134                                            00300001
001900* PROGRAMMER:  JOHN HUTCHINSON                                    00310001
002000*----------------------------------------------------------------*00350001
003100*                                                                 00400001
003110*----------------------------------------------------------------*00350001
003300 ENVIRONMENT DIVISION.                                            00420001
003310*----------------------------------------------------------------*00350001
003500                                                                  00440001
003600 CONFIGURATION SECTION.                                           00450001
003700                                                                  00460001
003800 SOURCE-COMPUTER.        IBM-3090.                                00470001
003900 OBJECT-COMPUTER.        IBM-3090.                                00480001
004000                                                                  00490001
004100 INPUT-OUTPUT SECTION.                                            00500001
004200                                                                  00510001
004300 FILE-CONTROL.                                                    00520001
004700                                                                  00560001
004900     SELECT RTV-DTL-FILE          ASSIGN TO INP01.                00580001
P41888     SELECT RTV-HDR-FILE          ASSIGN TO INP02.                00580001
005000                                                                  00560001
005100*----------------------------------------------------------------*00350001
006300 DATA DIVISION.                                                   00720001
006310*----------------------------------------------------------------*00350001
006500                                                                  00740001
006600 FILE SECTION.                                                    00750001
007400                                                                  00830001
007500 FD  RTV-DTL-FILE                                                 00840001
007600     RECORDING MODE IS F                                          00850001
007700     LABEL RECORDS ARE STANDARD                                   00860001
007800     BLOCK CONTAINS 0 RECORDS.                                    00870001
007900                                                                  00880001
008000 01  RTV-DTL-RECORD                   PIC X(200).                 00890001
008100                                                                  00880001
P41888 FD  RTV-HDR-FILE                                                 00840001
P41888     RECORDING MODE IS F                                          00850001
P41888     LABEL RECORDS ARE STANDARD                                   00860001
P41888     BLOCK CONTAINS 0 RECORDS.                                    00870001
P41888                                                                  00880001
P41888 01  RTV-HDR-RECORD                   PIC X(550).                 00890001
P41888                                                                  00880001
008200*----------------------------------------------------------------*00350001
011000 WORKING-STORAGE SECTION.                                         01190001
011010*----------------------------------------------------------------*00350001
011200                                                                  01210001
011710*----------------------------------------------------------------*00350001
011900* INPUT LAYOUT - RV052-GENCO-DTL-CNTL-RECORD.                     01280001
011910*----------------------------------------------------------------*00350001
011920                                                                  01260001
012100     COPY RVRD052.                                                01300001
016100                                                                  01900001
P41888*----------------------------------------------------------------*00350001
P41888* INPUT LAYOUT - RV050-GENCO-RTV-HEADER-RECORD.                   01280001
P41888*----------------------------------------------------------------*00350001
P41888                                                                  01260001
P41888     COPY RVRD050.                                                01300001
P41888                                                                  01900001
016803***  PROGRAM ACCUMULATORS                                         02000001
016804                                                                  01900001
016900 01  PA-PROGRAM-ACCUMULATORS.                                     02010001
017000     05  PA-TOTALS.                                               02020001
017310         10 PA-TOT-CTL-RECS-READ      PIC S9(09) VALUE +0 COMP-3. 02050001
P41888         10 PA-TOT-HDR-RECS-READ      PIC S9(09) VALUE +0 COMP-3. 02050001
P41888         10 PA-TOT-DTL-RECS-READ      PIC S9(09) VALUE +0 COMP-3. 02050001
021800                                                                  02500001
021900***  PROGRAM SWITCHES                                             02510001
022000 01  PS-PROGRAM-SWITCHES.                                         02520001
022400     05  PS-END-OF-DTL-INPUT-SW        PIC  X(01)    VALUE 'N'.   02560001
022500         88  PS-END-OF-DTL-INPUT-YES                 VALUE 'Y'.   02570001
022600         88  PS-END-OF-DTL-INPUT-NO                  VALUE 'N'.   02580001
P41888     05  PS-END-OF-HDR-INPUT-SW        PIC  X(01)    VALUE 'N'.   02560001
P41888         88  PS-END-OF-HDR-INPUT-YES                 VALUE 'Y'.   02570001
P41888         88  PS-END-OF-HDR-INPUT-NO                  VALUE 'N'.   02580001
025000                                                                  02810001
025100***  PROGRAM CONSTANTS                                            02820001
025200 01  PC-PROGRAM-CONSTANTS.                                        02830001
P41888*    05  PC-CURRENT-PROGRAM-NAME     PIC X(08)  VALUE 'RVKUT027'. 02850001
P41888     05  PC-CURRENT-PROGRAM-NAME     PIC X(08)  VALUE 'RVKUT039'. 02850001
048700                                                                  05440001
048710*----------------------------------------------------------------*00350001
048900 LINKAGE SECTION.                                                 05460001
048910*----------------------------------------------------------------*00350001
049100                                                                  05480001
049110*----------------------------------------------------------------*00350001
049300 PROCEDURE DIVISION.                                              05510001
049310*----------------------------------------------------------------*00350001
049410                                                                  05490001
049420*----------------------------------------------------------------*00350001
049600*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *05540001
049610*----------------------------------------------------------------*00350001
049710                                                                  05490001
049800 0000-PROGRAM-MAINLINE.                                           05560001
049900                                                                  05570001
050000     DISPLAY '************ START OF RVKUT039 ***************'     05580001
050100                                                                  05590001
050200     PERFORM 1000-INITIALIZE THRU 1000-EXIT.                      05600001
050300                                                                  05610001
P41888     IF PS-END-OF-HDR-INPUT-YES AND                                       
P41888        PS-END-OF-DTL-INPUT-YES                                           
P41888         DISPLAY ' '                                              05700001
P41888         DISPLAY '***** NO RECORDS ON HDR AND DTL FILE *********' 05710001
P41888         DISPLAY ' '                                              05720001
P41888         DISPLAY '************  END OF RVKUT039  ***************' 05800001
P41888         MOVE +4053 TO RETURN-CODE                                        
P41888     END-IF.                                                              
P41888                                                                          
050302     IF PS-END-OF-DTL-INPUT-NO                                    05630001
050303         PERFORM 2000-READ-RTV-DTL-FILE                           06370001
050304             UNTIL PS-END-OF-DTL-INPUT-YES                        06820001
050602     ELSE                                                         05680001
P41888         IF PS-END-OF-DTL-INPUT-YES AND                           05690001
P41888            PS-END-OF-HDR-INPUT-NO                                        
050700             DISPLAY ' '                                          05700001
050800             DISPLAY '***** NO RECORDS ON DETAIL INPUT FILE ****' 05710001
P41888             DISPLAY '** RECORDS PRESENT ON HEADER INPUT FILE **' 05710001
050900             DISPLAY ' '                                          05720001
P41888*            MOVE +0002 TO RETURN-CODE                            15740001
P41888             MOVE +4052 TO RETURN-CODE                            15740001
051000         END-IF                                                   05730001
051500     END-IF.                                                      05780001
051600                                                                  05790001
P41888     CLOSE RTV-DTL-FILE                                           05750001
P41888           RTV-HDR-FILE.                                                  
051620                                                                  05790001
051630     PERFORM 8000-EOJ-ROUTINE.                                    05790001
051640                                                                  05790001
051700     DISPLAY '************  END OF RVKUT039  ***************'     05800001
051800                                                                  05790001
051900     GOBACK.                                                      05820001
051902                                                                  05840001
051903*----------------------------------------------------------------*00350001
052100*    INITIALIZE VARIABLES.                                        05860001
052200*    OPEN FILES.                                                  05870001
052300*    DO A PRIME READ FOR THE DTL                                  05880001
052310*----------------------------------------------------------------*00350001
052410                                                                  05840001
052500 1000-INITIALIZE.                                                 05900001
052900                                                                  05940001
P41888     OPEN INPUT RTV-DTL-FILE                                      05970001
P41888                RTV-HDR-FILE.                                             
056800                                                                  06350001
056900**PRIME READ OF DTL FILE                                          06360001
056910                                                                  06350001
057000     PERFORM 2000-READ-RTV-DTL-FILE.                              06370001
057100                                                                  06380001
P41888**PRIME READ OF HDR FILE                                          06360001
P41888                                                                  06350001
P41888     PERFORM 3000-READ-RTV-HDR-FILE.                              06370001
P41888                                                                  06380001
060300 1000-EXIT.                                                       06700001
060400     EXIT.                                                        06710001
094817                                                                  10390001
094818*----------------------------------------------------------------*00350001
094820*    READ THE RTV DETAIL FILE                                     10410001
094821*----------------------------------------------------------------*00350001
094823                                                                  10390001
094824 2000-READ-RTV-DTL-FILE.                                          10430001
094825                                                                  10440001
094826     READ RTV-DTL-FILE INTO RV052-GENCO-DTL-CNTL-RECORD           10460001
094900         AT END                                                   10470001
095000             SET PS-END-OF-DTL-INPUT-YES TO TRUE                  10480001
095010     END-READ.                                                            
095100                                                                  10490001
095200     IF PS-END-OF-DTL-INPUT-NO                                    10500001
095300         IF RV052-CONTRL                                          10510001
095400             ADD 1 TO PA-TOT-CTL-RECS-READ                        10520001
P41888         ELSE                                                             
P41888             ADD 1 TO PA-TOT-DTL-RECS-READ                        10520001
095500         END-IF                                                   10530001
095510     END-IF.                                                      10530001
140100                                                                  15480001
P41888*----------------------------------------------------------------*00350001
P41888*    READ THE RTV HEADER FILE                                     10410001
P41888*----------------------------------------------------------------*00350001
P41888                                                                  10390001
P41888 3000-READ-RTV-HDR-FILE.                                          10430001
P41888                                                                  10440001
P41888     READ RTV-HDR-FILE INTO RV050-GENCO-RTV-HEADER-RECORD         10460001
P41888         AT END                                                   10470001
P41888             SET PS-END-OF-HDR-INPUT-YES TO TRUE                  10480001
P41888     END-READ.                                                            
P41888                                                                  10490001
P41888     IF PS-END-OF-HDR-INPUT-NO                                    10500001
P41888        ADD 1 TO PA-TOT-HDR-RECS-READ                             10520001
P41888     END-IF.                                                      10530001
P41888                                                                  10530001
140110*----------------------------------------------------------------*00350001
140300*    DISPLAY SUMMARY STATS AND VERIFY CONTROL RECORD COUNTS       15500001
140310*----------------------------------------------------------------*00350001
140410                                                                  15480001
140500 8000-EOJ-ROUTINE.                                                15520001
141300                                                                  15600001
141400     DISPLAY '***********************************************'.   15610001
141500     DISPLAY '**    * RVKUT039 SUMMARY STATISTICS *        **'.   15620001
141600     DISPLAY '**                                           **'.   15630001
141700     DISPLAY '**   ------------------------------------    **'.   15640001
141800     DISPLAY '**   VALIDATE GENCO CONTROL RECORD COUNTS    **'.   15650001
141900     DISPLAY '**   ------------------------------------    **'.   15660001
142000     DISPLAY '**                                           **'.   15630001
142200     DISPLAY '** TOT CTL RECS READ   : ' PA-TOT-CTL-RECS-READ.    15690001
142400     DISPLAY '***********************************************'.   15710001
142500                                                                  15720001
P41888     IF PA-TOT-CTL-RECS-READ GREATER THAN 1 AND                   15730001
P41888        PA-TOT-HDR-RECS-READ = ZERO                                       
P41888*        MOVE +0001 TO RETURN-CODE                                15740001
P41888         DISPLAY '********** HEADER FILE IS EMPTY           **'   15740001
P41888         DISPLAY '********** DTL FILE HAS > ONE CNTL RECORD **'   15740001
P41888         MOVE +4054 TO RETURN-CODE                                15740001
P41888     END-IF.                                                              
P41888                                                                          
P41888     IF PA-TOT-CTL-RECS-READ GREATER THAN 1 AND                   15730001
P41888        PA-TOT-HDR-RECS-READ > ZERO                                       
P41888         DISPLAY '********** HEADER FILE IS NOT EMPTY       **'   15740001
P41888         DISPLAY '********** DTL FILE HAS > ONE CNTL RECORD **'   15740001
P41888         MOVE +4055 TO RETURN-CODE                                15740001
P41888     END-IF.                                                              
P41888                                                                          
P41888     IF PS-END-OF-HDR-INPUT-NO AND                                        
P41888        PA-TOT-DTL-RECS-READ = ZERO AND                                   
P41888        PA-TOT-CTL-RECS-READ = 1                                          
P41888         DISPLAY '**** HEADER FILE HAS RECORDS           **'      15740001
P41888         DISPLAY '**** DTL FILE HAS ONLY ONE CNTL RECORD **'      15740001
P41888         DISPLAY '**** AND DO NOT HAVE DETAIL RECORDS    **'      15740001
P41888         MOVE +4051 TO RETURN-CODE                                15740001
P41888     END-IF.                                                      15770001
P41888                                                                  15770001
P41888     IF PS-END-OF-HDR-INPUT-YES AND                                       
P41888        PA-TOT-DTL-RECS-READ > ZERO AND                                   
P41888        PA-TOT-CTL-RECS-READ = 1                                          
P41888         DISPLAY ' '                                              05700001
P41888         DISPLAY '***** NO RECORDS ON HEADER INPUT FILE      ****'05710001
P41888         DISPLAY '***** RECORDS PRESENT ON DETAIL INPUT FILE ****'05710001
P41888         DISPLAY ' '                                              05720001
P41888         MOVE +4050 TO RETURN-CODE                                        
P41888     END-IF.                                                              
P41888                                                                          
146600                                                                  16140001
146610*----------------------------------------------------------------*00350001
146800*                       END OF PROGRAM                            16160001
146810*----------------------------------------------------------------*00350001
