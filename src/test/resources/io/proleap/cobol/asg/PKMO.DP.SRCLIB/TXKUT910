000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             TXKUT910.                                00050089
000600 AUTHOR.                 DANIEL OKYERE.                           00060089
000700 INSTALLATION.           KOHLS.                                   00070001
000800 DATE-WRITTEN            FRB 2006.                                00080089
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100***************************************************************** 00110001
001200*  THIS PROGRAM WILL CREATE A FILE OF SKUS THAT ARE ACTIVE IN PLU 00120001
001300*  FOR EACH STATE WHERE THE STORES ARE IN TRAINING MODE OR ACTIVE 00130012
001400*  IN THE PLU SYSTEM.                                             00140089
001700******************************************************************00170001
001800 ENVIRONMENT DIVISION.                                            00180001
001900***************************************************************** 00190001
002000                                                                  00200001
002100 CONFIGURATION SECTION.                                           00210001
002200                                                                  00220001
002300 SOURCE-COMPUTER.        IBM-3090.                                00230001
002400 OBJECT-COMPUTER.        IBM-3090.                                00240001
002500                                                                  00250001
002600 INPUT-OUTPUT SECTION.                                            00260001
002700                                                                  00270001
002800 FILE-CONTROL.                                                    00280001
002900                                                                  00290001
003000     SELECT CONTROL-FILE                                          00300001
003100         ASSIGN TO INP01.                                         00310001
003200                                                                  00320001
003300     SELECT SKU-LOC-FILE                                          00330089
003400         ASSIGN TO INP02.                                         00340032
003500                                                                  00350013
004200     SELECT SKU-FILE                                              00420001
004300         ASSIGN TO OUT01.                                         00430001
004400                                                                  00440001
004500******************************************************************00450001
004600 DATA DIVISION.                                                   00460001
004700******************************************************************00470001
004800                                                                  00480001
004900 FILE SECTION.                                                    00490001
005000                                                                  00500001
005100 FD  CONTROL-FILE                                                 00510001
005200     RECORDING MODE IS F                                          00520001
005300     BLOCK CONTAINS 0 RECORDS                                     00530001
005400     LABEL RECORDS ARE STANDARD.                                  00540001
005500                                                                  00550001
005600 01  CONTROL-RECORD                  PIC X(80).                   00560001
005700                                                                  00570001
005800 FD  SKU-LOC-FILE                                                 00580089
005900     RECORDING MODE IS F                                          00590013
006000     BLOCK CONTAINS 0                                             00600013
006100     LABEL RECORDS ARE STANDARD.                                  00610013
006200 01  SKU-LOC-RECORD                  PIC X(04).                   00620089
006300                                                                  00630013
007600 FD  SKU-FILE                                                     00760001
007700     RECORDING MODE IS F                                          00770001
007800     BLOCK CONTAINS 0  RECORDS.                                   00780001
007900                                                                  00790001
008000 01  SKU-RECORD                      PIC  X(60).                  00800086
008100******************************************************************00810001
008200 WORKING-STORAGE SECTION.                                         00820001
008300******************************************************************00830001
008400 01  FILLER                            PIC X(50)  VALUE           00840001
008500     ' *** WORKING STORAGE STARTS HERE FOR TXKUT910 *** '.        00850089
008600                                                                  00860001
008700******************************************************************00870001
008800* RECORD LAYOUT FOR INPUT CONTROL CARD                            00880001
008900*  THIS CARD HOLDS THE BATCH RUN TIMESTAMPS FROM THE MOST RECENT  00890009
009000*  (CURRENT) AND THE PREVIOUS RUN OF THE PLU AND XREF EXTRACT     00900009
009100*  PROCESS.                                                       00910009
009200******************************************************************00920001
009300     COPY EPWS105.                                                00930050
009400******************************************************************00940005
009500* RECORD LAYOUT FOR THE ITEM TAXABILITY EXTRACT ITEM OUTPUT FILE  00950009
009600******************************************************************00960005
009700     COPY TXRD911.                                                00970050
009800                                                                  00980005
009900***************************************************************** 00990089
010000* RECORD LAYOUT FOR INPUT SKU LOC FILE                          * 01000089
010100***************************************************************** 01010089
010200 01  TX-SKU-LOC-RECORD.                                           01020097
010200     05  TX-SKU-LOC-REC                PIC S9(9) COMP.            01021098
010300                                                                  01030089
011700 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01170001
011800                                                  COMP SYNC.      01180001
011900     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01190001
012100     88  AC-DB2-ERROR                             VALUE +4013.    01210001
012300                                                                  01230001
012400 01  PS-PROGRAM-SWITCHES.                                         01240001
012500     05  PS-END-OF-SKU-SW              PIC X(01)  VALUE 'N'.      01250001
012600         88  PS-END-OF-SKU                        VALUE 'Y'.      01260001
012700         88  PS-NOT-END-OF-SKU                    VALUE 'N'.      01270001
012800     05  PS-END-OF-CONTROL-SW          PIC X(01)  VALUE 'N'.      01280001
012900         88  PS-END-OF-CONTROL                    VALUE 'Y'.      01290001
013000         88  PS-NOT-END-OF-CONTROL                VALUE 'N'.      01300009
012800     05  PS-SKU-FOUND-SW               PIC X(01)  VALUE 'N'.      01310089
012900         88  PS-SKU-FOUND                         VALUE 'Y'.      01320089
013000         88  PS-SKU-NOT-FOUND                     VALUE 'N'.      01330089
014400 01  PC-CONSTANTS.                                                01440001
014600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01460001
014700                                                   'TXKUT910'.    01470089
014800                                                                  01480001
014900 01  PV-MISC-FIELDS.                                              01490001
015000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01500001
015100     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01510001
015200     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01520001
015300     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01530001
016200     05  PV-SKUS-READ                PIC S9(9)     VALUE ZERO     01620003
016300                                          COMP-3.                 01630003
016400     05  PV-RECORDS-WRITTEN          PIC S9(9)     VALUE ZERO     01640003
016500                                          COMP-3.                 01650003
016600     05  PV-SKUS-READ-DISPLAY        PIC ZZZ,ZZZ,ZZ9 VALUE ZERO.  01660003
016700     05  PV-RECORDS-WRITTEN-DISPLAY  PIC ZZZ,ZZZ,ZZ9 VALUE ZERO.  01670005
016800                                                                  01681099
016900******************************************************************01690001
017000*  TABLES FOR PROCESSING.                                         01700001
017100******************************************************************01710001
017900******************************************************************01790001
018000*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01800001
018100******************************************************************01810001
018200     COPY DPWS004.                                                01820020
018300                                                                  01830001
018400******************************************************************01840001
018500*  DB2 COMMUNICATION AREA.                                        01850001
018600******************************************************************01860001
018700     EXEC SQL                                                     01870001
018800          INCLUDE SQLCA                                           01880001
018900     END-EXEC.                                                    01890001
019510******************************************************************01951352
019520*  DB2 TABLE XST_SKU                                              01952047
019530******************************************************************01953047
019540     EXEC SQL                                                     01954047
019550          INCLUDE XST00010                                        01955047
019560     END-EXEC.                                                    01956047
019600******************************************************************01960001
019700*  DB2 TABLE XST_SKU_ATTR                                         01970001
019800******************************************************************01980001
019900     EXEC SQL                                                     01990001
020000          INCLUDE XST00011                                        02000001
020100     END-EXEC.                                                    02010001
020800******************************************************************02080001
020900*  DB2 TABLE XST_VND_STYL                                         02090090
021000******************************************************************02100001
021100     EXEC SQL                                                     02110001
021200          INCLUDE XST00013                                        02120090
021300     END-EXEC.                                                    02130001
027700                                                                  02770089
027800***************************************************************** 02780001
027900* PROCEDURE DIVISION.                                           * 02790001
028000***************************************************************** 02800001
028100 PROCEDURE DIVISION.                                              02810001
028200                                                                  02820001
028300 0000-MAINLINE-PROCESSING.                                        02830001
028400                                                                  02840001
028500     PERFORM 1000-INITIALIZE-PROGRAM.                             02850001
028600                                                                  02860001
028700     PERFORM 2000-CREATE-FILE                                     02870001
028800       UNTIL PS-END-OF-SKU.                                       02880001
028900                                                                  02890001
029000     CLOSE SKU-FILE.                                              02900001
029100                                                                  02910001
029200     MOVE PV-SKUS-READ       TO PV-SKUS-READ-DISPLAY.             02920003
029300     MOVE PV-RECORDS-WRITTEN TO PV-RECORDS-WRITTEN-DISPLAY.       02930003
029400     DISPLAY 'SKUS READ       ' PV-SKUS-READ-DISPLAY.             02940003
029500     DISPLAY 'RECORDS WRITTEN ' PV-RECORDS-WRITTEN-DISPLAY.       02950003
029600     GOBACK.                                                      02960001
029700                                                                  02970001
029800******************************************************************02980001
029900* 1000-INITIALIZE-PROGRAM                                        *02990032
030000* OPEN FILES, READ CONTROL CARD, INITIALIZE AND FILL STATE TABLE.*03000032
030100******************************************************************03010001
030200 1000-INITIALIZE-PROGRAM.                                         03020001
030300                                                                  03030001
030400     DISPLAY '***TXKUT910 MESSAGES***'                            03040089
030500                                                                  03050008
030600     OPEN INPUT  CONTROL-FILE                                     03060001
030700                 SKU-LOC-FILE                                     03070089
031000          OUTPUT SKU-FILE.                                        03100001
031100                                                                  03110001
031400     PERFORM 1010-READ-CONTROL-FILE.                              03140001
031500                                                                  03150001
031600     IF PS-END-OF-CONTROL                                         03160001
031700         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03170001
031800         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  03180001
031900         SET AC-CONTROL-CARD-ERROR TO TRUE                        03190001
032000         PERFORM 9999-ABEND                                       03200001
032100     END-IF.                                                      03210001
032200                                                                  03220001
032300     DISPLAY 'CURRENT PLU TIMESTAMP ' CC-EPCC105-CRNT-TIMESTAMP.  03230009
032400                                                                  03240009
038000     CLOSE CONTROL-FILE.                                          03800089
038400                                                                  03840001
038500     PERFORM 5000-READ-SKU-LOC-FILE.                              03850089
038600                                                                  03860089
039400******************************************************************03940001
039500* 1010-READ-CONTROL-FILE                                          03950001
039600* READ CONTROL CARD.                                              03960001
039700******************************************************************03970001
039800 1010-READ-CONTROL-FILE.                                          03980001
039900                                                                  03990001
040000     READ CONTROL-FILE INTO CC-EPCC105-CONTROL-CARD               04000001
040100        AT END                                                    04010001
040200           SET PS-END-OF-CONTROL TO TRUE.                         04020001
040300                                                                  04030001
057300******************************************************************05730001
057400* 2000-CREATE-FILE                                                05740001
057500* CREATE FILE OF CURRENT SKUS FOR ITEM TAXABILITY.                05750009
057600******************************************************************05760001
057700 2000-CREATE-FILE.                                                05770001
057800                                                                  05780001
057810     SET PS-SKU-NOT-FOUND TO TRUE.                                05781089
057820                                                                  05782089
057900     PERFORM 4000-GET-SKU-INFO.                                   05790089
057910                                                                  05791089
057920     IF PS-SKU-FOUND                                              05792089
058000         PERFORM 3000-PROCESS-SKU                                 05800089
058010     END-IF.                                                      05801089
058100                                                                  05810089
058200     PERFORM 5000-READ-SKU-LOC-FILE.                              05820089
058400                                                                  05840001
058500******************************************************************05850001
058600* 3000-PROCESS-SKU                                                05860001
058700* FOR EACH SKU, WRITE RECORD WITH ITEM TAXABILITY INFO.           05870009
058800******************************************************************05880001
058900 3000-PROCESS-SKU.                                                05890001
059000                                                                  05900001
059100     INITIALIZE TX911-TAX-ITEM-RECORD.                            05910003
059300                                                                  05930043
059400     MOVE XST00010-INTR-UPC-ID     TO TX911-INTR-UPC-ID.          05940032
059500     MOVE XST00013-DEPT-NBR        TO TX911-DEPT-NBR.             05950032
059600     MOVE XST00013-SUB-CL-NBR      TO TX911-SUB-CL-NBR.           05960032
059600     MOVE XST00013-MAJ-CL-NBR      TO TX911-MAJ-CL-NBR.           05961085
059700     MOVE XST00013-VS-NBR          TO TX911-VS-NBR                05970032
059800     MOVE XST00010-SKU-NBR         TO TX911-SKU-NBR.              05980032
059900     MOVE XST00010-TX-PRD-CDE-DESC TO TX911-TX-PRD-CDE.           05990032
060000                                                                  06000001
060010     PERFORM 7000-WRITE-RECORD.                                   06000199
060020                                                                  06000299
060100***************************************************************** 06001089
060200* 4000-GET-SKU-INFO                                               06002089
060300***************************************************************** 06003089
060400 4000-GET-SKU-INFO.                                               06004089
060500                                                                  06005089
060600     MOVE TX-SKU-LOC-REC TO XST00010-INTR-UPC-ID.                 06006095
060700                                                                  06007089
023500     EXEC SQL                                                     06008089
023700           SELECT A.INTR_UPC_ID                                   06009189
023800                 ,A.SKU_NBR                                       06009289
023900                 ,A.TX_PRD_CDE_DESC                               06009389
024000                 ,C.DEPT_NBR                                      06009489
024100                 ,C.SUB_CL_NBR                                    06009589
024200                 ,C.VS_NBR                                        06009689
024200                 ,C.MAJ_CL_NBR                                    06009789
024210            INTO :XST00010-INTR-UPC-ID,                           06009889
024220                 :XST00010-SKU-NBR,                               06009989
024230                 :XST00010-TX-PRD-CDE-DESC,                       06010089
024240                 :XST00013-DEPT-NBR,                              06010189
024250                 :XST00013-SUB-CL-NBR,                            06010289
024260                 :XST00013-VS-NBR,                                06010389
024270                 :XST00013-MAJ-CL-NBR                             06010489
024300           FROM   XST_SKU      A                                  06010589
024400                 ,XST_SKU_ATTR B                                  06010689
024500                 ,XST_VND_STYL C                                  06010789
024600           WHERE  A.INTR_UPC_ID = B.INTR_UPC_ID                   06010889
024610             AND  A.INTR_UPC_ID = :XST00010-INTR-UPC-ID           06010995
024700             AND  A.STYL_ID     = C.STYL_ID                       06011089
024800             AND  CRE_TMST < :CC-EPCC105-CRNT-TIMESTAMP           06011189
024900             AND  B.PLU_DWNLD_EXCL_IND = 'N'                      06011289
025100           WITH UR                                                06011389
025200     END-EXEC.                                                    06011489
027700                                                                  06011589
033000     EVALUATE TRUE                                                06011689
033100         WHEN SQLCODE = ZERO                                      06011789
033200             SET PS-SKU-FOUND TO TRUE                             06011889
033250         WHEN SQLCODE = +100                                      06011989
033260             CONTINUE                                             06012089
033300         WHEN SQLWARN0 NOT EQUAL SPACE                            06012189
033400         WHEN SQLCODE NOT EQUAL ZERO                              06012289
033450             DISPLAY 'INTR UPD ID: ' XST00010-INTR-UPC-ID         06012399
033500             MOVE '4000-GET-SKU-INFO'  TO PV-PARAGRAPH-NAME       06012489
033600                                                                  06012589
033700             MOVE 'SELECT OF SKU INFO' TO PV-DB2-OPERATION        06012691
033800                                                                  06012789
033900             PERFORM 9100-SQL-ABEND                               06012889
034000     END-EVALUATE.                                                06012989
034100                                                                  06013089
039400******************************************************************06014089
039500* 5000-READ-SKU-LOC-FILE                                          06020089
039600* READ CONTROL CARD.                                              06030089
039700******************************************************************06040089
039800 5000-READ-SKU-LOC-FILE.                                          06050089
039900                                                                  06060089
040000     READ SKU-LOC-FILE INTO TX-SKU-LOC-RECORD                     06070098
040100        AT END                                                    06080089
040200           SET PS-END-OF-SKU TO TRUE.                             06090089
040300                                                                  06100089
040400     ADD +1 TO PV-SKUS-READ.                                      06110099
040500                                                                  06120099
066700******************************************************************07590082
066700* 7000-WRITE-RECORD                                               07600082
066700* WRITE RECORD FOR EACH STATE IN THE STATE TABLE.                 07610082
066700******************************************************************07620082
066700 7000-WRITE-RECORD.                                               07630082
066700                                                                  07640082
066700     WRITE SKU-RECORD FROM TX911-TAX-ITEM-RECORD.                 07650082
066700     ADD +1 TO PV-RECORDS-WRITTEN.                                07651082
066700                                                                  07660082
077300******************************************************************07730001
077400* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      07740001
077500* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 07750001
077600******************************************************************07760001
077700 9100-SQL-ABEND.                                                  07770001
077800     DISPLAY '** ABEND     **'.                                   07780001
077900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07790001
078000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07800001
078100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               07810001
078200                                                                  07820001
078300******************************************************************07830001
078400* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     07840001
078500* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      07850001
078600******************************************************************07860001
078700     COPY DPPD004.                                                07870050
078800                                                                  07880001
078900     SET AC-DB2-ERROR TO TRUE.                                    07890001
079000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07900001
079100                                                                  07910001
079200******************************************************************07920001
079300* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           07930001
079400******************************************************************07940001
079500 9999-ABEND.                                                      07950001
079600     DISPLAY '** ABEND           **'.                             07960001
079700     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  07970001
079800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07980001
079900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       07990001
080000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       08000001
080100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         08010001
