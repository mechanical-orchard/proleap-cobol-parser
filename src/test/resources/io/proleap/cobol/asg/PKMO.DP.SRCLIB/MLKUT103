       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUT103.                                         00020000
       AUTHOR.        SCOTT JACKSON.                                    00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  08-01-2003.                                       00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      * MLKUT103 -  STORE PERFORMANCE RANKING MAIN EXTRACT              00090000
      *             (INCLUDES TYPE_CODES 'DS','RV','CS','DC' LOCATIONS) 00100000
      *                                                                 00110000
      * THIS PROGRAM WILL EXTRACT TWKDPTS INFORMATION FOR STORE GRADE   00120000
      * GRADE RANKING PROCESS (SALES, MARKDOWNS, INVENTORY LEVELS)      00130000
      *                                                                 00140000
      *  PROGRAM FLOW                                                   00150000
      *  1) READ CONTROL CARD (SPECIFY SEASON TO PROCESS)               00160000
      *  2) CREATE DATE-TABLE CONTAINING PERTINENT SEASON INFO          00170000
      *  3) CREATE STORE-TABLE USED TO DETERMINE STORE 'TYPE' BY SEASON 00180000
      *  4) CREATE DEPT-TABLE TO STORE MBS HIEARCHY INFORMATION         00190000
      ***                                                               00200000
      *  5) TWKDPTS CSR DRIVES THE PROCESSING (FOR EACH SEASON)         00210000
      *  5) PROCESS EACH SEASON INDIVIDUALLY AND EACH STORE/DEPT RECORD 00220000
      *  6) CREATE 2 EXTRACT FILES                                      00230000
      *     - MAIN EXTRACT CONTAINING ML SALES, MARKDOWNS, END INV RTL  00240000
      *     - SALES FILE CONTAINING STORE-TYPE COUNT BY SEASON          00250000
      *                                                                 00260000
W26602******************************************************************00270000
W26602* CHG ID   DATE        DESCRIPTION                               *00280000
W26602* ------   ----------  ----------------------------------------- *00290000
W26602* W26602   05-03-2004  STORE EXPANSION EFFORT                    *00300000
W26602*                      REPLACE TSTR000 WITH XMT_LOC.             *00310000
W26602*                      - SCOTT JACKSON                           *00320000
W26006* W26006   02-24-2005  REMOVE REFERENCES TO OBSOLETE STORE TABLE.*00321000
W26006*                      - ERIN SEARL                              *00323000
W30900* W30900   06-27-2006  ENHANCE THE STORE GRADING EXTRACT TO BE   *00324039
W30900*                      REPORT AT MONTHLY, QUARTERLY, AND SEASONAL*00325039
W30900*                      FREQUENCY.                                *00326039
      ******************************************************************00330000
      *                                                                 00340000
       ENVIRONMENT DIVISION.                                            00350000
      *                                                                 00360000
       CONFIGURATION SECTION.                                           00370000
      *                                                                 00380000
       SOURCE-COMPUTER.        IBM-3090.                                00390000
       OBJECT-COMPUTER.        IBM-3090.                                00400000
      *                                                                 00410000
       INPUT-OUTPUT SECTION.                                            00420000
       FILE-CONTROL.                                                    00430000
                                                                        00440000
           SELECT INPUT-CONTROL-FILE                                    00450000
               ASSIGN TO INP01.                                         00460000
                                                                        00470000
           SELECT SIZE-CONTROL-FILE                                     00471000
               ASSIGN TO INP02.                                         00472000
                                                                        00473000
           SELECT LOC-CONTROL-FILE                                      00474000
               ASSIGN TO INP03.                                         00475000
                                                                        00476000
           SELECT WKDPTS-EXTR-FILE                                      00480000
               ASSIGN TO OUT01.                                         00490000
                                                                        00500000
           SELECT STORE-EXTR-FILE                                       00510000
               ASSIGN TO OUT02.                                         00520000
                                                                        00530000
      ******************************************************************00540000
       DATA DIVISION.                                                   00550000
      ******************************************************************00560000
                                                                        00570000
       FILE SECTION.                                                    00580000
                                                                        00590000
       FD  INPUT-CONTROL-FILE                                           00600000
           RECORDING MODE IS F                                          00610000
           LABEL RECORDS ARE STANDARD                                   00620000
           BLOCK CONTAINS 0 RECORDS.                                    00630000
                                                                        00640000
       01  INPUT-CONTROL-REC           PIC X(80).                       00650000
                                                                        00660000
       FD  SIZE-CONTROL-FILE                                            00661000
           RECORDING MODE IS F                                          00662000
           LABEL RECORDS ARE STANDARD                                   00663000
           BLOCK CONTAINS 0 RECORDS.                                    00664000
                                                                        00665000
       01  SIZE-CONTROL-REC            PIC X(80).                       00666000
                                                                        00667000
       FD  LOC-CONTROL-FILE                                             00668000
           RECORDING MODE IS F                                          00669000
           LABEL RECORDS ARE STANDARD                                   00669100
           BLOCK CONTAINS 0 RECORDS.                                    00669200
                                                                        00669300
       01  LOC-CONTROL-REC            PIC X(80).                        00669400
                                                                        00669500
       FD  WKDPTS-EXTR-FILE                                             00670000
           RECORDING MODE IS F                                          00680000
           LABEL RECORDS ARE STANDARD                                   00690000
           BLOCK CONTAINS 0 RECORDS.                                    00700000
                                                                        00710000
       01  WKDPTS-EXTR-REC             PIC X(125).                      00720000
                                                                        00730000
       FD  STORE-EXTR-FILE                                              00740000
           RECORDING MODE IS F                                          00750000
           LABEL RECORDS ARE STANDARD                                   00760000
           BLOCK CONTAINS 0 RECORDS.                                    00770000
                                                                        00780000
       01  STORE-EXTR-REC              PIC X(100).                      00790000
                                                                        00800000
      *                                                                 00810000
      ******************************************************************00820000
       WORKING-STORAGE SECTION.                                         00830000
      ******************************************************************00840000
                                                                        00850000
       01  ABEND-CODE                        PIC S9(4) VALUE ZERO       00860000
                                                       COMP SYNC.       00870000
       01  PS-PROGRAM-SWITCHES.                                         00880000
           05 PS-FIRST-DATE-SW               PIC X     VALUE 'N'.       00890000
               88  PS-FIRST-DATE                       VALUE 'Y'.       00900000
               88  PS-NOT-FIRST-DATE                   VALUE 'N'.       00910000
           05  PS-LOAD-DATE-TABLE-SW         PIC X     VALUE 'N'.       00920000
               88  PS-DATE-TABLE-LOADED                VALUE 'Y'.       00930000
           05 PS-SEASON-SW                   PIC X     VALUE 'N'.       00940000
               88  PS-EOF-SEASON                       VALUE 'Y'.       00950000
               88  PS-MORE-SEASON-ROWS                 VALUE 'N'.       00960000
           05 PS-STORE-CSR-SW                PIC X     VALUE 'N'.       00970000
               88  PS-EOF-STORE-CSR                    VALUE 'Y'.       00980000
               88  PS-MORE-STORE-ROWS                  VALUE 'N'.       00990000
           05 PS-TWKDPTS-CSR-SW              PIC X     VALUE 'N'.       01000000
               88  PS-EOF-TWKDPTS-CSR                  VALUE 'Y'.       01010000
               88  PS-MORE-TWKDPTS-ROWS                VALUE 'N'.       01020000
           05 PS-DEPT-CSR-SW                 PIC X     VALUE 'N'.       01030000
               88  PS-EOF-DEPT-CSR                     VALUE 'Y'.       01040000
               88  PS-MORE-DEPT-ROWS                   VALUE 'N'.       01050000
           05  PS-STORE-TYPE-SW              PIC X(4)  VALUE SPACES.    01060000
               88  PS-COMP-STORE                       VALUE 'COMP'.    01070000
               88  PS-NON-COMP-STORE                   VALUE 'NCMP'.    01080000
               88  PS-NEW-STORE                        VALUE 'NEWS'.    01090000
               88  PS-BYPASS-STORE                     VALUE 'BYPS'.    01100000
               88  PS-REPLACE-STORE                    VALUE 'REPL'.    01110000
               88  PS-DC-LOCATION                      VALUE 'DC  '.    01120000
           05 PS-SPECIFIC-LOCS-SW            PIC X     VALUE 'N'.       01121000
               88  PS-NO-SPECIFIC-LOCS                 VALUE 'N'.       01122000
               88  PS-SPECIFIC-LOCS                    VALUE 'Y'.       01123000
           05 PS-LOC-FILE-SW                 PIC X     VALUE 'N'.       01124000
               88  PS-END-LOC-FILE                     VALUE 'Y'.       01125000
               88  PS-NOT-END-LOC-FILE                 VALUE 'N'.       01126000
                                                                        01130000
       01  PC-PROGRAM-CONSTANTS.                                        01140000
W26602*    05  PC-JOB-NAME             PIC  X(06)    VALUE 'MLK100'.    01150000
W26602     05  PC-JOB-NAME             PIC  X(06)    VALUE 'MLK102'.    01160000
           05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'MLKUT103'.  01170000
           05  PC-27-WEEKS             PIC  S9(4)    VALUE +27   COMP.  01180000
                                                                        01190000
       01  PA-PROGRAM-ACCUMULATORS.                                     01200000
           05  PA-SEASON-ACCUM                PIC  9(04)  VALUE ZERO.   01210000
           05  PA-NON-COMP-STORE-COUNT        PIC  9(04)  VALUE ZERO.   01220000
           05  PA-NEW-STORE-COUNT             PIC  9(04)  VALUE ZERO.   01230000
      *                                                                 01240000
       01  PV-PROGRAM-VARIABLES.                                        01250000
           05  PV-MAX-STORES                  PIC S9(4)    COMP.        01260000
           05  PV-SUB1                        PIC 9(04)  VALUE ZEROES.  01270000
           05  PV-SEAS-COUNTER                PIC 9(04)  VALUE ZEROES.  01280000
           05  PV-SEASON-SUB                  PIC 9(04)  VALUE ZEROES.  01290000
           05  PV-MAX-SEASON                  PIC 9(04)  VALUE ZEROES.  01300000
           05  PV-KEY-DATE                    PIC X(10)  VALUE SPACE.   01311037
           05  PV-STR-NBR-REPLACE             PIC S9(04) COMP.          01320000
           05  PV-OLD-STORE-NBR               PIC  9(04) VALUE ZEROES.  01330000
           05  PV-PLN-CTG-CDE                 PIC X(01)  VALUE SPACE.   01331000
      *                                                                 01340000
       01  PV-WKDPTS-VARIABLES.                                         01350000
           05  PV-WKDPTS-SLS-RTL-AMT        PIC S9(12)V9(2) VALUE ZEROES01360000
                                                            COMP-3.     01370000
           05  PV-WKDPTS-END-INV-RTL-AMT    PIC S9(12)V9(2) VALUE ZEROES01380000
                                                            COMP-3.     01390000
           05  PV-WKDPTS-MKDN-RTL-AMT       PIC S9(12)V9(2) VALUE ZEROES01400000
                                                             COMP-3.    01410000
      *                                                                 01420000
       01  PV-SEASON-DATES.                                             01430000
           05  PV-THIS-SEAS-END-DTE           PIC  X(10)  VALUE SPACE.  01430237
           05  PV-END-OF-SEASON-DATE          PIC  X(10)  VALUE SPACE.  01480000
W30900     05  PV-QTR-DESC                    PIC  X(01)  VALUE SPACE.  01481016
W30900     05  PV-QTR-BEG-DTE                 PIC  X(10)  VALUE SPACE.  01482012
W30900     05  PV-QTR-END-DTE                 PIC  X(10)  VALUE SPACE.  01483012
W30900     05  PV-PREV-QTR-END-DTE            PIC  X(10)  VALUE SPACE.  01484012
W30900     05  PV-PREV-QTR-JLN-DTE            PIC  S9(9) COMP.          01485012
W30900     05  PV-MONTH-DESC.                                           01486023
W30900         10 PV-MONTH-INITIAL-DESC       PIC   X(3)  VALUE SPACE.  01487026
W30900         10 FILLER                      PIC   X(6)  VALUE SPACE.  01488026
W30900     05  PV-MONTH-BEG-DTE               PIC  X(10)  VALUE SPACE.  01489026
W30900     05  PV-MONTH-END-DTE               PIC  X(10)  VALUE SPACE.  01489126
                                                                        01490000
       01  PV-VARIABLE-FIELDS.                                          01500000
           05  PV-FSCL-MN-IN-SEAS             PIC  9(02) VALUE ZERO.    01510000
           05  PV-MONTH-IN-SEASON             PIC  9(06) VALUE ZERO.    01520000
           05  PV-NEW-STORE-MONTH REDEFINES                             01530000
               PV-MONTH-IN-SEASON             PIC  X(06).               01540000
                                                                        01550000
           05  PV-SEAS-BEG-WK-NBR             PIC  X(02) VALUE SPACES.  01560000
           05  PV-SEAS-END-WK-NBR             PIC  X(02) VALUE SPACES.  01570000
           05  PV-SEAS-BEG-DTE                PIC  X(10) VALUE SPACES.  01580000
           05  PV-SEAS-END-WK-END-DTE         PIC  X(10) VALUE SPACES.  01590000
                                                                        01600000
           05  PV-HOLD-DEPT-NBR               PIC  X(03) VALUE SPACES.  01610000
           05  PV-HOLD-DEPT-NBR-NUM           PIC  9(03) VALUE ZEROES.  01620000
           05  PV-HOLD-STORE                  PIC  9(04) VALUE ZEROES.  01630000
           05  PV-HOLD-STR-NBR                PIC S9(04) COMP VALUE +0. 01640000
           05  PV-HOLD-END-INV-RTL            PIC S9(12)V9(2) COMP-3.   01650000
           05  PV-HOLD-NEW-STR-MN-NBR         PIC  9(06) VALUE ZEROES.  01660000
                                                                        01670000
           05  PV-HOLD-DATE                   PIC  X(10) VALUE SPACES.  01680000
           05  PV-PARAGRAPH-NAME              PIC  X(30) VALUE SPACES.  01690000
           05  PV-ABEND-MESSAGE               PIC  X(75) VALUE SPACES.  01700000
           05  PV-DB2-OPER-ATTEMPTED          PIC  X(30) VALUE SPACES.  01710000
W26602     05  PV-NULL-REPLACE-STR            PIC S9(04) COMP SYNC.     01720000
W26602     05  PV-NULL-SEA-SLS-INCL-DTE       PIC S9(04) COMP SYNC.     01730000
W26602     05  PV-NULL-SLS-INCL-DTE-CDE       PIC S9(04) COMP SYNC.     01740000
           05  PV-LOC-NBR                     PIC 9(04)  COMP.          01741000
           05  PV-LOC-COUNT                   PIC S9(04) COMP.          01742000
                                                                        01750000
       01  CC-CONTROL-CARD.                                             01761000
           05  CC-INPUT-FLAG.                                           01770000
               10  CC-PROCESSING-MODE         PIC  X(01)  VALUE SPACE.  01780000
               10  FILLER                     PIC  X(01)  VALUE SPACE.  01790000
W30900     05  CC-DATE-DRIVER                 PIC  X(10)  VALUE SPACE.  01800038
           05  FILLER                         PIC  X(01)  VALUE SPACE.  01820000
           05  CC-SEASONS-TO-PROCESS          PIC  9(02)  VALUE ZERO.   01830000
           05  FILLER                         PIC  X(01)  VALUE SPACE.  01840000
           05  CC-DPT-LEVEL-PROCESS           PIC  X(01).               01850000
               88  CC-DEPT-LEVEL                     VALUES ARE 'Y' 'X'.01860000
               88  CC-NO-DEPT                        VALUES ARE 'N' ' '.01870000
           05  FILLER                         PIC  X(01)  VALUE SPACE.  01880000
           05  CC-BYR-LEVEL-PROCESS           PIC  X(01).               01890000
               88  CC-BUYER-LEVEL                    VALUES ARE 'Y' 'X'.01900000
               88  CC-NO-BUYER                       VALUES ARE 'N' ' '.01910000
           05  FILLER                         PIC  X(01)  VALUE SPACE.  01920000
           05  CC-DMM-LEVEL-PROCESS           PIC  X(01).               01930000
               88  CC-DMM-LEVEL                      VALUES ARE 'Y' 'X'.01940000
               88  CC-NO-DMM                         VALUES ARE 'N' ' '.01950000
           05  FILLER                         PIC  X(01)  VALUE SPACE.  01960000
           05  CC-GMM-LEVEL-PROCESS           PIC  X(01).               01970000
               88  CC-GMM-LEVEL                      VALUES ARE 'Y' 'X'.01980000
               88  CC-NO-GMM                         VALUES ARE 'N' ' '.01990000
           05  FILLER                         PIC  X(01)  VALUE SPACE.  02000000
           05  CC-GRP-LEVEL-PROCESS           PIC  X(01).               02010000
               88  CC-BUS-GRP-LEVEL                  VALUES ARE 'Y' 'X'.02020000
               88  CC-NO-BUS-GRP                     VALUES ARE 'N' ' '.02030000
W30900     05  FILLER                         PIC  X(01)  VALUE SPACE.  02040001
W30900     05  CC-PROCESS-CYCLE-ID            PIC  X(03)  VALUE SPACE.  02041004
W30900         88  CC-SEASONAL                       VALUES ARE 'SEA'.  02041104
W30900         88  CC-QUARTERLY                      VALUES ARE 'QTR'.  02041304
W30900         88  CC-MONTHLY                        VALUES ARE 'MON'.  02041404
W30900     05  FILLER                         PIC  X(51)  VALUE SPACE.  02042004
                                                                        02050000
       01  SZ-CONTROL-CARD.                                             02051000
           05  SZ-PLN-CTG-CDE                 PIC X(01)  VALUE SPACE.   02052000
           05  FILLER                         PIC X(79)  VALUE SPACE.   02053000
                                                                        02053100
       01  LOC-CONTROL-CARD.                                            02054000
           05  LOC-NBR-SPC                    PIC X(05)  VALUE SPACE.   02054100
           05  LOC-NBR-SPC-9 REDEFINES                                  02054200
                  LOC-NBR-SPC                 PIC 9(05).                02054300
           05  FILLER                         PIC X(75)  VALUE SPACE.   02054400
                                                                        02057000
       01  DATE-TABLE.                                                  02060000
      *    SUBSCRIPTED PV-SUB1                                          02070000
           05  CONTROL-DATES OCCURS 5 TIMES.                            02080000
               10  DT-SEAS-DESC               PIC X(06) VALUE SPACES.   02090000
W30900         10  DT-QTR-DESC                PIC X(01) VALUE SPACES.   02091032
W30900         10  DT-MONTH-DESC              PIC X(03) VALUE SPACES.   02092032
               10  DT-SEAS-BEG-DTE            PIC X(10) VALUE SPACES.   02100000
               10  DT-SEAS-END-DTE            PIC X(10) VALUE SPACES.   02110000
               10  DT-PREV-SEA-END-DTE        PIC X(10) VALUE SPACES.   02120000
               10  DT-FSCL-WK-SEAS-END        PIC 9(02) VALUE ZEROS.    02130000
               10  DT-FSCL-YR-NBR             PIC X(04) VALUE ZEROS.    02140000
       01  SPECIFIC-LOC-TABLE.                                          02141000
      *    SUBSCRIPTED PV-SUB2                                          02142000
           05  SPECIFIC-LOC-NBR OCCURS 9999 TIMES                       02143000
                  INDEXED BY  PV-SUB2.                                  02143100
               10  LT-LOC-NBR                 PIC S9(04) COMP.          02144000
                                                                        02150000
       01  STORE-TABLE.                                                 02160000
W26602     05  STORE-ENTRIES OCCURS 9999 TIMES                          02180000
               INDEXED BY STR-IDX.                                      02190000
               10  ST-STR-NBR                 PIC S9(04) COMP.          02200000
W26602*        10  ST-REPL-STORE-NBR          PIC  X(03) VALUE SPACES.  02210000
W26602         10  ST-REPL-STORE-NBR          PIC S9(04)V  COMP-3.      02220000
               10  ST-OPENED-DATE             PIC  X(10) VALUE SPACES.  02230000
               10  ST-CLOSED-DATE             PIC  X(10) VALUE SPACES.  02240000
               10  ST-SEA-SLS-INCL-DTE        PIC  X(10) VALUE SPACES.  02250000
               10  ST-STR-CMPR-DTE-CDE        PIC  X(01) VALUE SPACES.  02260000
W26602*        10  ST-OLD-STORE-NMBR          PIC  X(03) VALUE SPACES.  02270000
W26602         10  ST-OLD-STORE-NMBR          PIC S9(04)V  COMP-3.      02280000
               10  ST-OLD-SEA-SLS-INCL-DTE    PIC  X(10) VALUE SPACES.  02290000
                                                                        02300000
       01  DEPARTMENT-TABLE.                                            02310000
           05  DEPT-INFO OCCURS 999 TIMES                               02320000
               INDEXED BY DPT-IDX.                                      02330000
               10  DP-GMA-NBR                 PIC  X(02) VALUE SPACES.  02340000
               10  DP-DMA-NBR                 PIC  X(02) VALUE SPACES.  02350000
               10  DP-MDSEBG-NBR              PIC  X(03) VALUE SPACES.  02360000
               10  DP-BYR-NBR                 PIC  X(03) VALUE SPACES.  02370000
               10  DP-DEPT-NBR                PIC  X(03) VALUE SPACES.  02380000
               10  DP-DEPT-DESC               PIC  X(25) VALUE SPACES.  02390000
                                                                        02400000
       EJECT                                                            02410000
                                                                        02420000
      ******************************************************************02430000
      *  INPUT STORE RANKING REQUEST CONTROL LAYOUT                     02440000
      ******************************************************************02450000
      *    COPY MLRD040.                                                02460000
      *                                                                 02470000
      ******************************************************************02480000
      *  OUTPUT LEDGER FINANCIAL DATA EXTRACT FILE LAYOUT               02490000
      ******************************************************************02500000
           COPY MLRD041.                                                02510000
      *                                                                 02520000
      ******************************************************************02530000
      *  OUTPUT STORE TYPE EXTRACT BY RANKING FILE LAYOUT               02540000
      ******************************************************************02550000
           COPY MLRD042.                                                02560000
      *                                                                 02570000
      ******************************************************************02580000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                02590000
      ******************************************************************02600000
           COPY DPWS004.                                                02610000
      *                                                                 02620000
      ******************************************************************02630000
      *  DB2 ERRORS                                                     02640000
      ******************************************************************02650000
           COPY SQLCA2.                                                 02660000
      *                                                                 02670000
      ******************************************************************02680000
      *  DB2 COMMUNICATION AREA                                         02690000
      ******************************************************************02700000
           EXEC SQL                                                     02710000
                INCLUDE SQLCA                                           02720000
           END-EXEC.                                                    02730000
                                                                        02740000
      ******************************************************************02750000
      *  DB2 TWKDPTS TABLE LAYOUT                                       02760000
      ******************************************************************02770000
           EXEC SQL                                                     02780000
                INCLUDE TWKDPTS                                         02790000
           END-EXEC.                                                    02800000
                                                                        02810000
      ****************************************************              02820000
      * M/L DATE TABLE AND CURRENT OPEN FISCAL DATE INFO *              02830000
      ****************************************************              02840000
           EXEC SQL                                                     02850000
               INCLUDE TDTATTR                                          02860000
           END-EXEC.                                                    02870000
                                                                        02880000
W26602****************************************************              02960000
W26602* LOCATION TABLE                                   *              02970000
W26602****************************************************              02980000
W26602     EXEC SQL                                                     02990000
W26602         INCLUDE XMT00001                                         03000000
W26602     END-EXEC.                                                    03010000
W26602                                                                  03020000
      ****************************************************              03030000
      * MBS TABLE                                        *              03040000
      ****************************************************              03050000
           EXEC SQL                                                     03060000
               INCLUDE TMDSEAR                                          03070000
           END-EXEC.                                                    03080000
                                                                        03090000
      ****************************************************              03100000
      * MBS BUSINESS GROUP TABLE                         *              03110000
      ****************************************************              03120000
           EXEC SQL                                                     03130000
               INCLUDE TMDSEDP                                          03140000
           END-EXEC.                                                    03150000
                                                                        03160000
      ******************************************************************03170000
      *  DB2 TWKDPTS CURSOR                                             03180000
      *    THIS CURSOR WILL SELECT SUMMARY SEASON DEPT STORES TOTALS    03190000
      ******************************************************************03200000
           EXEC SQL                                                     03210000
               DECLARE TWKDPTS_CURSOR CURSOR FOR                        03220000
               SELECT DEPT_NBR                                          03230000
                    , A.STR_NBR                                         03240000
                    , SUM(A.SLS_RTL_AMT)                                03250000
                    , SUM(A.MKDN_RTL_AMT)                               03260000
                    , SUM(A.END_INV_RTL_AMT)                            03270000
                    , B.PLN_CTG_CDE                                     03271000
               FROM TWKDPTS A                                           03280000
W26602             ,XMT_LOC B                                           03300000
               WHERE (FSCL_WK_NBR BETWEEN                               03310000
                          :PV-SEAS-BEG-WK-NBR                           03320000
                      AND :PV-SEAS-END-WK-NBR)                          03330000
                 AND (FSCL_WK_END_DTE BETWEEN                           03340000
                          :PV-SEAS-BEG-DTE                              03350000
                      AND :PV-SEAS-END-WK-END-DTE)                      03360000
W26602           AND A.STR_NBR = B.LOC_NBR                              03400000
W26602           AND B.LOC_TYP_CDE IN ('DS','RV','CS','DC')             03410000
W26602           AND B.E_BUS_IND = 'N'                                  03420000
               GROUP BY A.STR_NBR, DEPT_NBR, B.PLN_CTG_CDE              03430000
               ORDER BY A.STR_NBR, DEPT_NBR                             03440000
                                                                        03450000
           END-EXEC.                                                    03460000
                                                                        03470000
W26602******************************************************************03720000
W26602*  DB2 LOCATION_CURSOR                                            03730000
W26602******************************************************************03740000
W26602     EXEC SQL                                                     03750000
W26602         DECLARE LOCATION_CURSOR CURSOR FOR                       03760000
W26602             SELECT LOC_NBR                                       03770000
W26602                  , REPLT_STR_NBR                                 03780000
W26602                  , OPN_DTE                                       03790000
W26602                  , CLO_DTE                                       03800000
W26602                  , SEA_SLS_INCL_DTE                              03810000
W26602                  , SLS_INCL_DTE_CDE                              03820000
W26602              FROM XMT_LOC                                        03830000
W26602             WHERE ((LOC_TYP_CDE IN ('DS')                 AND    03840000
W26602                   ((OPN_DTE < :PV-THIS-SEAS-END-DTE)      OR     03850037
W26602                    (OPN_DTE > :PV-THIS-SEAS-END-DTE       AND    03860037
W26602                     SLS_INCL_DTE_CDE = 'R'))              AND    03870000
W26602                     SEA_SLS_INCL_DTE < '9999-09-09')             03880000
W26602                OR                                                03890000
W26602                    (LOC_TYP_CDE IN ('RV','CS','DC')       AND    03900000
W26602                     OPN_DTE < :PV-THIS-SEAS-END-DTE))            03910037
W26602               AND  E_BUS_IND = 'N'                               03920000
W26602             ORDER BY LOC_NBR                                     03930000
W26602     END-EXEC.                                                    03940000
W26602                                                                  03950000
      ******************************************************************03960000
      *  DB2 DEPARTMENT BUSINESS STRUCTURE CURSOR                       03970000
      ******************************************************************03980000
           EXEC SQL                                                     03990000
               DECLARE TMDSEAR_CURSOR CURSOR FOR                        04000000
                   SELECT GMA_NBR                                       04010000
                        , DMA_NBR                                       04020000
                        , MDSEBG_NBR                                    04030000
                        , BYR_NBR                                       04040000
                        , DEPT_NBR                                      04050000
                        , ARDEPT_DESC                                   04060000
                    FROM TMDSEAR A                                      04070000
                        ,TMDSEDP B                                      04080000
                   WHERE MDSELV_CDE = 'DPT'                             04090000
                     AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                  04100000
                   ORDER BY DEPT_NBR                                    04110000
           END-EXEC.                                                    04120000
                                                                        04130000
                                                                        04140000
      ******************************************************************04150000
       PROCEDURE DIVISION.                                              04160000
      ******************************************************************04170000
                                                                        04180000
      ******************************************************************04190000
       1000-MAIN-MODULE.                                                04200000
      ******************************************************************04210000
      *                                                                 04220000
           PERFORM 1100-INITIALIZE.                                     04230000
                                                                        04240000
           PERFORM 2000-PROCESS-DATA.                                   04250000
                                                                        04260000
           PERFORM 9900-EOJ-ROUTINE.                                    04270000
                                                                        04280000
           STOP RUN.                                                    04290000
                                                                        04300000
       EJECT                                                            04310000
                                                                        04320000
      ******************************************************************04330000
       1100-INITIALIZE.                                                 04340000
      ******************************************************************04350000
      *                                                                 04360000
           OPEN INPUT  INPUT-CONTROL-FILE                               04370000
                       SIZE-CONTROL-FILE                                04371000
                       LOC-CONTROL-FILE                                 04372000
                OUTPUT WKDPTS-EXTR-FILE                                 04380000
                       STORE-EXTR-FILE.                                 04390000
                                                                        04400000
           INITIALIZE PS-PROGRAM-SWITCHES                               04410000
                      PA-PROGRAM-ACCUMULATORS.                          04420000
                                                                        04430000
           PERFORM 4000-READ-CONTROL-FILE.                              04440000
           PERFORM 4050-READ-STORE-SIZE-FILE.                           04441000
           PERFORM 4051-READ-LOC-CONTROL-FILE.                          04442000
                                                                        04442100
           IF LOC-NBR-SPC IS NUMERIC                                    04443000
               AND LOC-NBR-SPC-9 NOT = ZEROS                            04444000
                                                                        04444100
               SET PS-SPECIFIC-LOCS TO TRUE                             04444200
               PERFORM 7900-BUILD-SPECIFIC-LOC-TABLE                    04445000
                   UNTIL PS-END-LOC-FILE                                04445100
                                                                        04445200
           ELSE                                                         04446000
               SET PS-NO-SPECIFIC-LOCS TO TRUE                          04447000
           END-IF.                                                      04448000
                                                                        04450000
           PERFORM 7000-SELECT-DB2-DATES.                               04460000
           PERFORM 7200-BUILD-STORE-TABLE.                              04470000
           PERFORM 7400-BUILD-DEPT-TABLE.                               04480000
                                                                        04490000
           MOVE 1   TO PV-SUB1.                                         04500000
           MOVE 'N' TO PS-STORE-CSR-SW.                                 04510000
                                                                        04520000
      ******************************************************************04530000
       2000-PROCESS-DATA.                                               04540000
      ******************************************************************04550000
           PERFORM 2100-PROCESS-SEASONAL-DATA                           04560032
               VARYING PV-SEASON-SUB                                    04570032
                   FROM 1 BY 1                                          04580032
                       UNTIL PV-SEASON-SUB > PV-MAX-SEASON.             04611032
      *                                                                 04630000
      ******************************************************************04640000
       2100-PROCESS-SEASONAL-DATA.                                      04650000
      ******************************************************************05012226
      *    PROCESS ONCE FOR EACH NUMBER OF SEASONS TO BE COMPARED       05012326
      *    THESE VALUES WILL BE USED BY THE TWKDPTS CURSOR              05012426
      *                                                                 05012526
           MOVE PV-SEASON-SUB TO PV-SUB1.                               05012626
      *                                                                 05012726
W30900     EVALUATE TRUE                                                05012834
W30900         WHEN CC-SEASONAL                                         05012934
W30900             IF DT-SEAS-DESC(PV-SUB1) = 'SPRING'                  05013034
W30900                 MOVE '01' TO PV-SEAS-BEG-WK-NBR                  05013134
W30900                 MOVE '26' TO PV-SEAS-END-WK-NBR                  05013234
W30900             ELSE                                                 05013334
W30900                 IF DT-SEAS-DESC(PV-SUB1) = 'FALL  '              05013434
W30900                     MOVE '27' TO PV-SEAS-BEG-WK-NBR              05013534
W30900*                    ACCOUNT FOR A 53-WEEK YEAR                   05013634
W30900                     MOVE DT-FSCL-WK-SEAS-END(PV-SUB1)            05013734
W30900                         TO PV-SEAS-END-WK-NBR                    05013834
W30900                 END-IF                                           05013934
W30900             END-IF                                               05014034
W30900         WHEN CC-QUARTERLY                                        05014134
W30900             EVALUATE DT-QTR-DESC(PV-SUB1)                        05014234
W30900                 WHEN '1'                                         05014334
W30900                     MOVE '01' TO PV-SEAS-BEG-WK-NBR              05014434
W30900                     MOVE '13' TO PV-SEAS-END-WK-NBR              05014534
W30900                 WHEN '2'                                         05014634
W30900                     MOVE '14' TO PV-SEAS-BEG-WK-NBR              05014734
W30900                     MOVE '26' TO PV-SEAS-END-WK-NBR              05014834
W30900                 WHEN '3'                                         05014934
W30900                     MOVE '27' TO PV-SEAS-BEG-WK-NBR              05015034
W30900                     MOVE '39' TO PV-SEAS-END-WK-NBR              05015134
W30900                 WHEN '4'                                         05015234
W30900                     MOVE '40' TO PV-SEAS-BEG-WK-NBR              05015334
W30900*                    ACCOUNT FOR A 53-WEEK YEAR                   05015734
W30900                     MOVE DT-FSCL-WK-SEAS-END(PV-SUB1)            05015834
W30900                         TO PV-SEAS-END-WK-NBR                    05015934
W30900             END-EVALUATE                                         05016134
W30900         WHEN CC-MONTHLY                                          05016234
W30900             EVALUATE DT-MONTH-DESC(PV-SUB1)                      05016334
W30900                 WHEN 'FEB'                                       05016434
W30900                     MOVE '01' TO PV-SEAS-BEG-WK-NBR              05016634
W30900                     MOVE '04' TO PV-SEAS-END-WK-NBR              05016734
W30900                 WHEN 'MAR'                                       05016834
W30900                     MOVE '05' TO PV-SEAS-BEG-WK-NBR              05016934
W30900                     MOVE '09' TO PV-SEAS-END-WK-NBR              05017034
W30900                 WHEN 'APR'                                       05017134
W30900                     MOVE '10' TO PV-SEAS-BEG-WK-NBR              05017234
W30900                     MOVE '13' TO PV-SEAS-END-WK-NBR              05017334
W30900                 WHEN 'MAY'                                       05017434
W30900                     MOVE '14' TO PV-SEAS-BEG-WK-NBR              05017534
W30900                     MOVE '17' TO PV-SEAS-END-WK-NBR              05017634
W30900                 WHEN 'JUN'                                       05017734
W30900                     MOVE '18' TO PV-SEAS-BEG-WK-NBR              05017834
W30900                     MOVE '22' TO PV-SEAS-END-WK-NBR              05017934
W30900                 WHEN 'JUL'                                       05018034
W30900                     MOVE '23' TO PV-SEAS-BEG-WK-NBR              05018134
W30900                     MOVE '26' TO PV-SEAS-END-WK-NBR              05018234
W30900                 WHEN 'AUG'                                       05018334
W30900                     MOVE '27' TO PV-SEAS-BEG-WK-NBR              05018434
W30900                     MOVE '30' TO PV-SEAS-END-WK-NBR              05018534
W30900                 WHEN 'SEP'                                       05018634
W30900                     MOVE '31' TO PV-SEAS-BEG-WK-NBR              05018734
W30900                     MOVE '35' TO PV-SEAS-END-WK-NBR              05018834
W30900                 WHEN 'OCT'                                       05018934
W30900                     MOVE '36' TO PV-SEAS-BEG-WK-NBR              05019034
W30900                     MOVE '39' TO PV-SEAS-END-WK-NBR              05019134
W30900                 WHEN 'NOV'                                       05019234
W30900                     MOVE '40' TO PV-SEAS-BEG-WK-NBR              05019334
W30900                     MOVE '43' TO PV-SEAS-END-WK-NBR              05019434
W30900                 WHEN 'DEC'                                       05019534
W30900                     MOVE '44' TO PV-SEAS-BEG-WK-NBR              05019634
W30900                     MOVE '48' TO PV-SEAS-END-WK-NBR              05019734
W30900                 WHEN 'JAN'                                       05019834
W30900                     MOVE '49' TO PV-SEAS-BEG-WK-NBR              05019934
W30900*                    ACCOUNT FOR A 53-WEEK YEAR                   05020234
W30900                     MOVE DT-FSCL-WK-SEAS-END(PV-SUB1)            05020334
W30900                         TO PV-SEAS-END-WK-NBR                    05020434
W30900             END-EVALUATE                                         05020534
W30900     END-EVALUATE.                                                05020636
                                                                        05020734
           MOVE DT-SEAS-BEG-DTE(PV-SUB1) TO PV-SEAS-BEG-DTE.            05020834
           MOVE DT-SEAS-END-DTE(PV-SUB1) TO PV-SEAS-END-WK-END-DTE.     05020934
                                                                        05021034
W30900     DISPLAY '-----------------------------'.                     05021137
W30900     DISPLAY 'THIS PERIOD PROCESSING DATES '.                     05021237
           DISPLAY '    BEGIN DATE : ', PV-SEAS-BEG-DTE.                05021334
           DISPLAY '      END DATE : ', PV-SEAS-END-WK-END-DTE.         05021434
W30900     DISPLAY '-----------------------------'.                     05021537
                                                                        05021634
W30900     DISPLAY 'STORE STATUS FOR THIS PERIOD EXTRACTED'.            05021737
                                                                        05021834
           PERFORM 2200-PROCESS-TWKDPTS-CSR                             05021934
               UNTIL PS-EOF-TWKDPTS-CSR.                                05022034
                                                                        05022134
           MOVE 'N' TO PS-TWKDPTS-CSR-SW.                               05022234
      *                                                                 05022334
      ******************************************************************05022434
       2200-PROCESS-TWKDPTS-CSR.                                        05023034
      ******************************************************************05030000
      *                                                                 05040000
           PERFORM 5400-OPEN-TWKDPTS-CSR.                               05050000
                                                                        05060000
           PERFORM 5500-FETCH-TWKDPTS-CSR.                              05070000
                                                                        05080000
           PERFORM 5600-PROCESS-TWKDPTS-ROWS                            05090000
                UNTIL PS-EOF-TWKDPTS-CSR                                05100000
                                                                        05110000
           PERFORM 5900-CLOSE-TWKDPTS-CSR.                              05120000
                                                                        05130000
      *                                                                 05140000
      ******************************************************************05150000
       2300-SET-STORE-TYPE.                                             05160000
      ******************************************************************05170000
      *                                                                 05180000
           SET  STR-IDX             TO  WKDPTS-STR-NBR.                 05190000
           MOVE ST-STR-NBR(STR-IDX) TO  PV-HOLD-STR-NBR.                05200000
      *                                                                 05210000
      *    STORES WILL BE FLAGGED AS BYPASS, COMP, NONCOMP, NEW, DC     05220000
      *                                                                 05230000
      *    BYPASS LOC IF NOT ON THE WORKING STORAGE STORE-TABLE         05240000
      *               OR NOT OPENED PRIOR TO THIS SEASONS END DATE      05250000
      *                                                                 05260000
           IF ((PV-HOLD-STR-NBR = ZEROES)                               05270000
                OR                                                      05280000
              ((ST-OPENED-DATE(STR-IDX) > PV-SEAS-END-WK-END-DTE)       05290000
                AND                                                     05300000
               (ST-OLD-SEA-SLS-INCL-DTE(STR-IDX) = SPACES)  OR          05310000
               (ST-OLD-SEA-SLS-INCL-DTE(STR-IDX) >                      05320000
                                            PV-SEAS-END-WK-END-DTE)))   05330000
                                                                        05340000
               SET PS-BYPASS-STORE TO TRUE                              05350000
BYPS           DISPLAY '** BYPS STORE :', WKDPTS-STR-NBR                05360000
                                                                        05370000
           ELSE                                                         05380000
               IF ((ST-OPENED-DATE(STR-IDX) >= PV-SEAS-BEG-DTE)         05390000
                    AND                                                 05400000
                   (ST-OPENED-DATE(STR-IDX) <= PV-SEAS-END-WK-END-DTE)  05410000
                    AND                                                 05420000
                    ST-STR-CMPR-DTE-CDE(STR-IDX) = 'Y'                  05430000
                    AND                                                 05440000
                    ST-OLD-SEA-SLS-INCL-DTE(STR-IDX) = SPACES)          05450000
                       SET PS-NEW-STORE TO TRUE                         05460000
NEWS                   DISPLAY '** NEW  STORE :', PV-HOLD-STR-NBR       05470000
               ELSE                                                     05480000
                   IF (ST-OPENED-DATE(STR-IDX) < PV-SEAS-BEG-DTE        05490000
                       AND ST-SEA-SLS-INCL-DTE(STR-IDX) = '9999-09-09') 05500000
                           SET PS-DC-LOCATION TO TRUE                   05510000
DC                      DISPLAY '** ''DC'' LOCATION:', PV-HOLD-STR-NBR  05520000
                   ELSE                                                 05530000
                       IF ((ST-OPENED-DATE(STR-IDX) < PV-SEAS-BEG-DTE)  05540000
                           AND (ST-SEA-SLS-INCL-DTE(STR-IDX) >          05550000
                                               PV-SEAS-END-WK-END-DTE)  05560000
                           AND ((ST-OLD-SEA-SLS-INCL-DTE(STR-IDX) =     05570000
                                                                 SPACES)05580000
                            OR  (ST-OLD-SEA-SLS-INCL-DTE(STR-IDX) >=    05590000
                                              PV-SEAS-END-WK-END-DTE))) 05600000
                               SET PS-NON-COMP-STORE TO TRUE            05610000
NCMP                           DISPLAY '** NCMP STORE :',               05620000
                                                         PV-HOLD-STR-NBR05630000
                       ELSE                                             05640000
                           SET PS-COMP-STORE TO TRUE                    05700000
COMP                       DISPLAY '** COMP STORE :', PV-HOLD-STR-NBR   05710000
      *                END-IF                                           05720000
                   END-IF                                               05730000
               END-IF                                                   05740000
           END-IF.                                                      05750000
      *                                                                 05760000
                                                                        05770000
      ******************************************************************05780000
       4000-READ-CONTROL-FILE.                                          05790000
      ******************************************************************05800000
      *                                                                 05810000
           READ INPUT-CONTROL-FILE INTO CC-CONTROL-CARD                 05820000
               AT END                                                   05830000
                   DISPLAY '** PROGRAM ABEND **'                        05840000
                   DISPLAY 'MLKUT103  - CONTROL CARD EMPTY'             05850000
                   MOVE +4003              TO ABEND-CODE                05860000
                   PERFORM 9999-ABEND.                                  05870000
                                                                        05880000
           DISPLAY '**************************************************'.05890000
           DISPLAY '** MLKUT103 CONTROL : ' CC-CONTROL-CARD.            05900000
           DISPLAY '**************************************************'.05910000
      *                                                                 05920000
      ******************************************************************05921000
       4050-READ-STORE-SIZE-FILE.                                       05922000
      ******************************************************************05923000
      *                                                                 05924000
           READ SIZE-CONTROL-FILE INTO SZ-CONTROL-CARD.                 05925000
                                                                        05929200
           DISPLAY '**************************************************'.05929300
           DISPLAY '** MLKUT103 STORE SIZE: ' SZ-PLN-CTG-CDE.           05929400
           DISPLAY '**************************************************'.05929500
      *                                                                 05929600
      ******************************************************************05929700
       4051-READ-LOC-CONTROL-FILE.                                      05929800
      ******************************************************************05929900
      *                                                                 05930000
           READ LOC-CONTROL-FILE INTO LOC-CONTROL-CARD                  05930100
              AT END SET PS-END-LOC-FILE TO TRUE.                       05930200
                                                                        05930300
      *                                                                 05930700
      ******************************************************************05931000
       4100-WRITE-EXTRACTS.                                             05940000
      ******************************************************************05950000
      *                                                                 05960000
           WRITE WKDPTS-EXTR-REC FROM ML041-SALES-INVENTORY-EXTRACT.    05970000
           WRITE STORE-EXTR-REC  FROM ML042-STORE-STATISTIC-EXTRACT.    05980000
      *                                                                 05990000
      ******************************************************************06010000
      * 5000-OPEN-STORE-CSR.                                            06020000
      * RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    06030000
      ******************************************************************06040000
      *                                                                 06050000
       5000-OPEN-STORE-CSR.                                             06060000
                                                                        06070000
           MOVE '5000-OPEN-STORE-CSR' TO PV-PARAGRAPH-NAME.             06080000
                                                                        06090000
           EXEC SQL                                                     06100000
W26602         OPEN LOCATION_CURSOR                                     06120000
           END-EXEC                                                     06130000
                                                                        06140000
           IF SQLCODE NOT = +0                                          06150000
               MOVE 'OPEN STORE CURSOR'   TO PV-DB2-OPER-ATTEMPTED      06160000
               PERFORM 9999-SQL-ABEND                                   06170000
           END-IF.                                                      06180000
      *                                                                 06190000
      ******************************************************************06210000
       5100-FETCH-STORE-CSR.                                            06220000
      ******************************************************************06230000
      *                                                                 06240000
           EXEC SQL                                                     06250000
W26602         FETCH LOCATION_CURSOR                                    06330000
  |              INTO :XMT00001-LOC-NBR                                 06340000
  |                  ,:XMT00001-REPLT-STR-NBR  :PV-NULL-REPLACE-STR     06350000
  |                  ,:XMT00001-OPN-DTE                                 06360000
  |                  ,:XMT00001-CLO-DTE                                 06370000
  |                  ,:XMT00001-SEA-SLS-INCL-DTE                        06380000
  |                                            :PV-NULL-SEA-SLS-INCL-DTE06390000
  |                  ,:XMT00001-SLS-INCL-DTE-CDE                        06400000
  |                                            :PV-NULL-SLS-INCL-DTE-CDE06410000
W26602                                                                  06420000
           END-EXEC.                                                    06430000
                                                                        06440000
           EVALUATE TRUE                                                06450000
               WHEN SQLCODE = 0                                         06460000
                   CONTINUE                                             06470000
               WHEN SQLCODE = +100                                      06480000
                   SET PS-EOF-STORE-CSR TO TRUE                         06490000
               WHEN OTHER                                               06500000
                   MOVE 'FETCH STORE_CURSOR'   TO PV-DB2-OPER-ATTEMPTED 06510000
                   PERFORM 9999-SQL-ABEND                               06520000
           END-EVALUATE.                                                06530000
      *                                                                 06540000
      ******************************************************************06550000
       5200-LOAD-STORE-TABLE.                                           06560000
      ******************************************************************06570000
      *                                                                 06580000
W26602*  REPLICATED TABLE MAY INCLUDE FIELDS THAT ARE ABSENT OF DATA.   06890000
W26602*  PRIOR TO LOADING STORE TABLE, INTERROGATE THE CURSOR VARIABLES 06900000
W26602*  TO DETERMINE IF FIELD IS NULL ( IE PV-NULL... < 0 ). IF NULL,  06910000
W26602*  HARD-CODE THE TABLE VARIABLES INSTEAD OF USING CURSOR VALUES.  06920000
W26602*                                                                 06930000
W26602*****  XMT-LOC NULL ENABLED FIELDS  ***************************   06940000
W26602*        PV-NULL-REPLACE-STR                                      06950000
W26602*        PV-NULL-SEA-SLS-INCL-DTE                                 06960000
W26602*        PV-NULL-SLS-INCL-DTE-CDE                                 06970000
W26602*                                                                 06980000
W26602     MOVE XMT00001-LOC-NBR     TO PV-HOLD-STORE.                  06990000
W26602     SET STR-IDX               TO PV-HOLD-STORE.                  07000000
W26602*                                                                 07010000
W26602     MOVE XMT00001-LOC-NBR          TO ST-STR-NBR(STR-IDX).       07020000
W26602     MOVE XMT00001-OPN-DTE          TO ST-OPENED-DATE(STR-IDX).   07030000
W26602     MOVE XMT00001-CLO-DTE          TO ST-CLOSED-DATE(STR-IDX).   07040000
W26602                                                                  07050000
W26602**** REPLACEMENT STORE                                            07060000
W26602     IF PV-NULL-REPLACE-STR < 0                                   07070000
W26602         MOVE ZERO TO ST-REPL-STORE-NBR(STR-IDX)                  07080000
W26602     ELSE                                                         07090000
W26602         MOVE XMT00001-REPLT-STR-NBR TO ST-REPL-STORE-NBR(STR-IDX)07100000
W26602     END-IF                                                       07110000
W26602                                                                  07120000
W26602**** SEASON SALES DATE WHERE FIRST INCLUDED                       07130000
W26602     IF PV-NULL-SEA-SLS-INCL-DTE < 0                              07140000
W26602         MOVE '9999-09-09' TO ST-SEA-SLS-INCL-DTE(STR-IDX)        07150000
W26602     ELSE                                                         07160000
W26602         MOVE XMT00001-SEA-SLS-INCL-DTE                           07170000
W26602                           TO ST-SEA-SLS-INCL-DTE(STR-IDX)        07180000
W26602     END-IF.                                                      07190000
W26602                                                                  07200000
W26602**** SEASON SALES COMP SALES COMPARE CODE                         07210000
W26602     IF PV-NULL-SLS-INCL-DTE-CDE < 0                              07220000
W26602         MOVE 'N'          TO ST-STR-CMPR-DTE-CDE(STR-IDX)        07230000
W26602     ELSE                                                         07240000
W26602         MOVE XMT00001-SLS-INCL-DTE-CDE                           07250000
W26602                           TO ST-STR-CMPR-DTE-CDE(STR-IDX)        07260000
W26602     END-IF.                                                      07270000
W26602                                                                  07280000
W26602*    DETERMINE IF THIS STORE HAS REPLACED ANOTHER CLOSED STORE    07290000
W26602     MOVE XMT00001-LOC-NBR          TO PV-STR-NBR-REPLACE.        07300000
W26602                                                                  07310000
W26602     PERFORM 7700-GET-REPLACE-STR-DATES                           07320000
W26602                                                                  07330000
W26602     IF PS-REPLACE-STORE                                          07340000
W26602                                                                  07350000
W26602         MOVE XMT00001-LOC-NBR TO                                 07360000
W26602                                  ST-OLD-STORE-NMBR(STR-IDX)      07370000
W26602         MOVE XMT00001-SEA-SLS-INCL-DTE TO                        07380000
W26602                                  ST-OLD-SEA-SLS-INCL-DTE(STR-IDX)07390000
W26602     ELSE                                                         07400000
W26602         MOVE ZEROES TO ST-OLD-STORE-NMBR(STR-IDX)                07410000
W26602         MOVE SPACES TO ST-OLD-SEA-SLS-INCL-DTE(STR-IDX)          07420000
W26602     END-IF.                                                      07430000
W26602*                                                                 07440000
      ******************************************************************07450000
       5300-CLOSE-STORE-CSR.                                            07460000
      ******************************************************************07470000
      *                                                                 07480000
           EXEC SQL                                                     07490000
W26602         CLOSE LOCATION_CURSOR                                    07510000
           END-EXEC.                                                    07520000
                                                                        07530000
           IF SQLCODE NOT = +0                                          07540000
               MOVE 'CLOSE STORE CSR'   TO PV-DB2-OPER-ATTEMPTED        07550000
               PERFORM 9999-SQL-ABEND                                   07560000
           END-IF.                                                      07570000
      *                                                                 07580000
      ******************************************************************07600000
      * 5400-OPEN-TWKDPTS-CSR                                           07610000
      * RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    07620000
      ******************************************************************07630000
      *                                                                 07640000
       5400-OPEN-TWKDPTS-CSR.                                           07650000
                                                                        07660000
           MOVE '5400-OPEN-TWKDPTS-CSR' TO PV-PARAGRAPH-NAME.           07670000
                                                                        07680000
           EXEC SQL                                                     07690000
               OPEN TWKDPTS_CURSOR                                      07700000
           END-EXEC                                                     07710000
                                                                        07720000
           IF SQLCODE NOT = +0                                          07730000
               MOVE 'OPEN TWKDPTS CURSOR'   TO PV-DB2-OPER-ATTEMPTED    07740000
               PERFORM 9999-SQL-ABEND                                   07750000
           END-IF.                                                      07760000
      *                                                                 07770000
      ******************************************************************07780000
       5500-FETCH-TWKDPTS-CSR.                                          07790000
      ******************************************************************07800000
      *                                                                 07810000
           EXEC SQL                                                     07820000
               FETCH TWKDPTS_CURSOR                                     07830000
                INTO :WKDPTS-DEPT-NBR                                   07840000
                    ,:WKDPTS-STR-NBR                                    07850000
                    ,:PV-WKDPTS-SLS-RTL-AMT                             07860000
                    ,:PV-WKDPTS-MKDN-RTL-AMT                            07870000
                    ,:PV-WKDPTS-END-INV-RTL-AMT                         07880000
                    ,:XMT00001-PLN-CTG-CDE                              07881000
           END-EXEC.                                                    07890000
                                                                        07900000
           EVALUATE TRUE                                                07910000
               WHEN SQLCODE = 0                                         07920000
                   CONTINUE                                             07930000
               WHEN SQLCODE = +100                                      07940000
                   MOVE 'Y' TO  PS-TWKDPTS-CSR-SW                       07950000
               WHEN OTHER                                               07960000
                   MOVE 'FETCH TWKDPTS_CURSOR' TO PV-DB2-OPER-ATTEMPTED 07970000
                   PERFORM 9999-SQL-ABEND                               07980000
           END-EVALUATE.                                                07990000
      *                                                                 08000000
      ******************************************************************08010000
      * THIS PARAGRAPH CONTROL THE MOVING OF FIELDS TO THE APPROPRIATE  08020000
      * OUTPUT RECORD FIELDS - COPYBOOKS MLRD041(MAIN)/MLRD042(STORE)   08030000
      ******************************************************************08040000
       5600-PROCESS-TWKDPTS-ROWS.                                       08050000
      ******************************************************************08060000
      *                                                                 08070000
           IF WKDPTS-STR-NBR NOT EQUAL PV-HOLD-STR-NBR                  08080000
               PERFORM 2300-SET-STORE-TYPE                              08090000
           END-IF.                                                      08100000
      *-JIM-------------------------------------------------------------08101000
           IF SZ-PLN-CTG-CDE = SPACE                                    08101100
               CONTINUE                                                 08101200
           ELSE                                                         08101300
               IF XMT00001-PLN-CTG-CDE NOT = SZ-PLN-CTG-CDE             08101400
                   SET PS-BYPASS-STORE TO TRUE                          08101500
               END-IF                                                   08101600
           END-IF.                                                      08101700
                                                                        08101800
           IF PS-SPECIFIC-LOCS                                          08101900
               PERFORM 7950-SEARCH-LOC-TABLE                            08102000
               IF WKDPTS-STR-NBR = PV-LOC-NBR                           08102100
                   CONTINUE                                             08102200
               ELSE                                                     08102300
                   SET PS-BYPASS-STORE TO TRUE                          08102400
               END-IF                                                   08102500
           END-IF.                                                      08102600
                                                                        08102700
      *-JIM-------------------------------------------------------------08103000
      *                                                                 08110000
      *                                                                 08120000
      *    IF THE LOCATION WAS SET TO BYPASS, DON'T WRITE ANY DATA      08130000
      *                                                                 08140000
      *                                                                 08150000
           IF PS-BYPASS-STORE                                           08160000
               CONTINUE                                                 08170000
           ELSE                                                         08180000
               PERFORM 5700-INIT-EXTR-FIELDS                            08190000
      *                                                                 08200000
W30900         EVALUATE TRUE                                            08271032
W30900             WHEN CC-SEASONAL                                     08272032
W30900                 IF DT-SEAS-DESC(PV-SUB1) = 'SPRING'              08273032
W30900                     MOVE '01' TO ML041-WEEK-NBR                  08276032
W30900                 ELSE                                             08277032
W30900                     IF DT-SEAS-DESC(PV-SUB1) = 'FALL  '          08278032
W30900                         MOVE '27' TO ML041-WEEK-NBR              08279232
W30900                     END-IF                                       08279332
W30900                 END-IF                                           08279432
W30900             WHEN CC-QUARTERLY                                    08279532
W30900                 IF DT-QTR-DESC(PV-SUB1) = '1' OR '2'             08279632
W30900                     IF DT-QTR-DESC(PV-SUB1) = '1'                08279932
W30900                         MOVE '01' TO ML041-WEEK-NBR              08280032
W30900                     ELSE                                         08280132
W30900                         MOVE '14' TO ML041-WEEK-NBR              08280232
W30900                     END-IF                                       08280332
W30900                 ELSE                                             08280432
W30900                     IF DT-QTR-DESC(PV-SUB1) = '3' OR '4'         08280532
W30900                         IF DT-QTR-DESC(PV-SUB1) = '3'            08280832
W30900                             MOVE '27' TO ML041-WEEK-NBR          08280932
W30900                         ELSE                                     08281032
W30900                             MOVE '40' TO ML041-WEEK-NBR          08281132
W30900                         END-IF                                   08281232
W30900                     END-IF                                       08281332
W30900                 END-IF                                           08281432
W30900             WHEN CC-MONTHLY                                      08281532
W30900                 EVALUATE DT-MONTH-DESC(PV-SUB1)                  08281632
W30900                     WHEN 'FEB'                                   08281732
W30900                         MOVE '01' TO ML041-WEEK-NBR              08282032
W30900                     WHEN 'MAR'                                   08282132
W30900                         MOVE '05' TO ML041-WEEK-NBR              08282432
W30900                     WHEN 'APR'                                   08282532
W30900                         MOVE '10' TO ML041-WEEK-NBR              08282832
W30900                     WHEN 'MAY'                                   08282932
W30900                         MOVE '14' TO ML041-WEEK-NBR              08283232
W30900                     WHEN 'JUN'                                   08283332
W30900                         MOVE '18' TO ML041-WEEK-NBR              08283632
W30900                     WHEN 'JUL'                                   08283732
W30900                         MOVE '23' TO ML041-WEEK-NBR              08284032
W30900                     WHEN 'AUG'                                   08284132
W30900                         MOVE '27' TO ML041-WEEK-NBR              08284432
W30900                     WHEN 'SEP'                                   08284532
W30900                         MOVE '31' TO ML041-WEEK-NBR              08284832
W30900                     WHEN 'OCT'                                   08284932
W30900                         MOVE '36' TO ML041-WEEK-NBR              08285232
W30900                     WHEN 'NOV'                                   08285332
W30900                         MOVE '40' TO ML041-WEEK-NBR              08285632
W30900                     WHEN 'DEC'                                   08285732
W30900                         MOVE '44' TO ML041-WEEK-NBR              08286032
W30900                     WHEN 'JAN'                                   08286132
W30900                         MOVE '49' TO ML041-WEEK-NBR              08286432
W30900                 END-EVALUATE                                     08286532
W30900         END-EVALUATE                                             08286636
      *                                                                 08287000
               IF PS-COMP-STORE                                         08290000
                   SET ML041-COMP-STORE TO TRUE                         08300000
                   MOVE +1 TO ML042-COMP-STORE-COUNT                    08310000
               ELSE                                                     08320000
                   IF PS-NON-COMP-STORE                                 08330000
                       SET ML041-NON-COMP-STORE TO TRUE                 08340000
                       MOVE +1 TO ML042-NON-COMP-STORE                  08350000
                   ELSE                                                 08360000
                       IF PS-NEW-STORE                                  08370000
                           PERFORM 6100-GET-NEW-STORE-INFO              08380000
                           MOVE DTATTR-FSCL-WK-NBR TO ML041-WEEK-NBR    08390000
                       ELSE                                             08400000
                           IF PS-DC-LOCATION                            08410000
                               SET ML041-DC-LOCATION TO TRUE            08420000
                               MOVE +1 TO ML042-DC-LOCATION             08430000
                           END-IF                                       08440000
                       END-IF                                           08450000
                   END-IF                                               08460000
               END-IF                                                   08470000
      *                                                                 08480000
               MOVE DT-FSCL-YR-NBR(PV-SUB1)   TO ML041-YEAR             08490000
                                                 ML042-YEAR             08500000
      *                                                                 08510000
               IF ST-REPL-STORE-NBR(STR-IDX) > ZERO                     08520000
                   MOVE ST-REPL-STORE-NBR(STR-IDX) TO ML041-STORE-NBR   08530000
                                                      ML042-STORE-NBR   08540000
               ELSE                                                     08550000
                   MOVE PV-HOLD-STR-NBR            TO ML041-STORE-NBR   08560000
                                                      ML042-STORE-NBR   08570000
               END-IF                                                   08580000
      *                                                                 08590000
      *        MOVE PV-HOLD-STR-NBR           TO ML041-STORE-NBR        08600000
----->*                                          ML042-STORE-NBR        08610000
      *                                                                 08620000
               PERFORM 6000-GET-HIERARCHY-DATA                          08630000
      *                                                                 08640000
      *        DOLLAR $$$ TOTALS                                        08650000
      *                                                                 08660000
      *                                                                 08670000
               MOVE PV-WKDPTS-END-INV-RTL-AMT TO PV-HOLD-END-INV-RTL    08680000
               MOVE ZEROES                TO PV-WKDPTS-END-INV-RTL-AMT  08690000
                                                                        08700000
               PERFORM 7800-PREV-END-INV-RTL                            08710000
                                                                        08720000
               ADD  PV-WKDPTS-END-INV-RTL-AMT TO PV-HOLD-END-INV-RTL    08730000
ENDINV         MOVE PV-HOLD-END-INV-RTL       TO ML041-END-INV-RTL      08740000
SALES          MOVE PV-WKDPTS-SLS-RTL-AMT     TO ML041-SLS-RTL          08750000
MKDOWN         MOVE PV-WKDPTS-MKDN-RTL-AMT    TO ML041-MKDN-RTL         08760000
      *                                                                 08770000
OLDSTR         MOVE ST-OLD-STORE-NMBR(STR-IDX) TO PV-OLD-STORE-NBR      08780000
OLDSTR         MOVE PV-OLD-STORE-NBR           TO ML041-OLD-STORE-NBR   08790000
      *                                                                 08800000
               PERFORM 4100-WRITE-EXTRACTS                              08810000
      *                                                                 08820000
           END-IF.                                                      08830000
      *                                                                 08840000
           PERFORM 5500-FETCH-TWKDPTS-CSR.                              08850000
      *                                                                 08860000
      *                                                                 08870000
      ******************************************************************08880000
       5700-INIT-EXTR-FIELDS.                                           08890000
      ******************************************************************08900000
      *                                                                 08910000
      *                                                                 08920000
           MOVE +0 TO ML042-COMP-STORE-COUNT                            08930000
                      ML042-NON-COMP-STORE                              08940000
                      ML042-DC-LOCATION                                 08950000
                      ML042-NEW-STORE-MN-1                              08960000
                      ML042-NEW-STORE-MN-2                              08970000
                      ML042-NEW-STORE-MN-3                              08980000
                      ML042-NEW-STORE-MN-4                              08990000
                      ML042-NEW-STORE-MN-5                              09000000
                      ML042-NEW-STORE-MN-6.                             09010000
      *                                                                 09020000
           MOVE SPACES TO ML041-STORE-TYPE.                             09030000
      *                                                                 09040000
      *                                                                 09050000
      ******************************************************************09060000
       5900-CLOSE-TWKDPTS-CSR.                                          09070000
      ******************************************************************09080000
      *                                                                 09090000
           EXEC SQL                                                     09100000
               CLOSE TWKDPTS_CURSOR                                     09110000
           END-EXEC.                                                    09120000
                                                                        09130000
           IF SQLCODE NOT = +0                                          09140000
               MOVE 'CLOSE TWKDPTS CSR'   TO PV-DB2-OPER-ATTEMPTED      09150000
               PERFORM 9999-SQL-ABEND                                   09160000
           END-IF.                                                      09170000
      *                                                                 09180000
      *                                                                 09190000
      ******************************************************************09200000
       6000-GET-HIERARCHY-DATA.                                         09210000
      ******************************************************************09220000
      *                                                                 09230000
      *    THE DEPARTMENT-TABLE IS INDEXED BY DEPARTMENT NUMBER         09240000
      *    SET THE INDEX SO DEPARMTENT MBS INFORMATION CAN BE RETRIEVED 09250000
      *                                                                 09260000
           MOVE WKDPTS-DEPT-NBR      TO PV-HOLD-DEPT-NBR                09270000
           MOVE PV-HOLD-DEPT-NBR     TO PV-HOLD-DEPT-NBR-NUM.           09280000
           SET DPT-IDX               TO PV-HOLD-DEPT-NBR-NUM.           09290000
      *                                                                 09300000
           IF CC-DEPT-LEVEL                                             09310000
               MOVE DP-DEPT-NBR(DPT-IDX)   TO ML041-DEPT-NBR            09320000
                                              ML042-DEPT-NBR            09330000
           ELSE                                                         09340000
               MOVE SPACES                 TO ML041-DEPT-NBR            09350000
                                              ML042-DEPT-NBR            09360000
           END-IF.                                                      09370000
      *                                                                 09380000
           IF CC-BUYER-LEVEL                                            09390000
               MOVE DP-BYR-NBR(DPT-IDX)    TO ML041-BUYER-NBR           09400000
                                              ML042-BUYER-NBR           09410000
           ELSE                                                         09420000
               MOVE SPACES                 TO ML041-BUYER-NBR           09430000
                                              ML042-BUYER-NBR           09440000
           END-IF.                                                      09450000
      *                                                                 09460000
           IF CC-DMM-LEVEL                                              09470000
               MOVE DP-DMA-NBR(DPT-IDX)    TO ML041-DMA-NBR             09480000
                                              ML042-DMA-NBR             09490000
           ELSE                                                         09500000
               MOVE SPACES                 TO ML041-DMA-NBR             09510000
                                              ML042-DMA-NBR             09520000
           END-IF.                                                      09530000
      *                                                                 09540000
           IF CC-GMM-LEVEL                                              09550000
               MOVE DP-GMA-NBR(DPT-IDX)    TO ML041-GMA-NBR             09560000
                                              ML042-GMA-NBR             09570000
           ELSE                                                         09580000
               MOVE SPACES                 TO ML041-GMA-NBR             09590000
                                              ML042-GMA-NBR             09600000
           END-IF.                                                      09610000
      *                                                                 09620000
           IF CC-BUS-GRP-LEVEL                                          09630000
               MOVE DP-MDSEBG-NBR(DPT-IDX) TO ML041-BUS-GRP-NBR         09640000
                                              ML042-BUS-GRP-NBR         09650000
           ELSE                                                         09660000
               MOVE SPACES                 TO ML041-BUS-GRP-NBR         09670000
                                              ML042-BUS-GRP-NBR         09680000
           END-IF.                                                      09690000
      *                                                                 09700000
      *    IF A DEPT IS NOT FOUND ON THE TABLE ( DP-DEPT-NBR(DPT-IDX) ),09710000
      *    ML041-DEPT-NBR (AND ALL MBS INFO) WILL EQUAL SPACES. IN THIS 09720000
      *    CASE, USE THE HOLD-DEPT VERSUS THE (NON) STORED TABLE VALUE. 09730000
      *                                                                 09740000
---->      IF ML041-DEPT-NBR = SPACES                                   09750000
- - -      AND CC-DEPT-LEVEL                                            09760000
---->          MOVE PV-HOLD-DEPT-NBR-NUM TO ML041-DEPT-NBR              09770000
---->                                       ML042-DEPT-NBR              09780000
---->      END-IF.                                                      09790000
                                                                        09800000
      *                                                                 09810000
      ******************************************************************09820000
       6100-GET-NEW-STORE-INFO.                                         09830000
      ******************************************************************09840000
      *                                                                 09850000
           EXEC SQL                                                     09860000
               SELECT FSCL_MN_NBR                                       09870000
                     ,FSCL_WK_NBR                                       09880000
                 INTO :DTATTR-FSCL-MN-NBR                               09890000
                     ,:DTATTR-FSCL-WK-NBR                               09900000
W26602           FROM XMT_LOC A                                         09920000
                     ,TDTATTR B                                         09930000
W26602          WHERE A.LOC_NBR = :PV-HOLD-STR-NBR                      09950000
                  AND KY_DTE = OPN_DTE                                  09960000
           END-EXEC.                                                    09970000
      *                                                                 09980000
           MOVE DTATTR-FSCL-MN-NBR TO PV-MONTH-IN-SEASON.               09990000
           MOVE PV-NEW-STORE-MONTH TO ML041-STORE-TYPE.                 10000000
                                                                        10010000
           IF PV-MONTH-IN-SEASON > 6                                    10020000
               COMPUTE PV-FSCL-MN-IN-SEAS = ( PV-MONTH-IN-SEASON - 6 )  10030000
           ELSE                                                         10040000
               COMPUTE PV-FSCL-MN-IN-SEAS =   PV-MONTH-IN-SEASON        10050000
           END-IF.                                                      10060000
      *                                                                 10070000
           IF PV-FSCL-MN-IN-SEAS = 1                                    10080000
               MOVE +1 TO ML042-NEW-STORE-MN-1                          10090000
           ELSE                                                         10100000
               IF PV-FSCL-MN-IN-SEAS = 2                                10110000
                   MOVE +1 TO ML042-NEW-STORE-MN-2                      10120000
               ELSE                                                     10130000
                   IF PV-FSCL-MN-IN-SEAS = 3                            10140000
                      MOVE +1 TO ML042-NEW-STORE-MN-3                   10150000
                   ELSE                                                 10160000
                       IF PV-FSCL-MN-IN-SEAS = 4                        10170000
                           MOVE +1 TO ML042-NEW-STORE-MN-4              10180000
                       ELSE                                             10190000
                           IF PV-FSCL-MN-IN-SEAS = 5                    10200000
                               MOVE +1 TO ML042-NEW-STORE-MN-5          10210000
                           ELSE                                         10220000
                               IF PV-FSCL-MN-IN-SEAS = 6                10230000
                                   MOVE +1 TO ML042-NEW-STORE-MN-6      10240000
                               END-IF                                   10250000
                           END-IF                                       10260000
                       END-IF                                           10270000
                   END-IF                                               10280000
               END-IF                                                   10290000
           END-IF.                                                      10300000
                                                                        10310000
                                                                        10320000
      *                                                                 10330000
      ******************************************************************10340000
      * 7000-SELECT-DB2-DATES.                                          10350000
      * RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    10360000
      ******************************************************************10370000
      *                                                                 10380000
       7000-SELECT-DB2-DATES.                                           10390000
      *                                                                 10400000
      *    CC-SEASONS-TO-PROCESS VARIABLE INDICATES THE NUMBER OF       10410000
      *    SEASONS THE USER WOULD LIKE TO SEE (INCLUDES CURRENT SEASON) 10420000
      *                                                                 10430000
           MOVE CC-SEASONS-TO-PROCESS TO PV-SUB1                        10440000
                                         PV-SEAS-COUNTER                10450000
                                         PV-MAX-SEASON.                 10460000
                                                                        10470000
           MOVE CC-DATE-DRIVER TO PV-KEY-DATE.                          10480037
           MOVE 'Y' TO PS-FIRST-DATE-SW.                                10480102
      *                                                                 10481003
W30900     EVALUATE TRUE                                                10481110
W30900         WHEN CC-SEASONAL                                         10482002
W30900             EXEC SQL                                             10482202
W30900                 SELECT SEA_END_DTE                               10482438
W30900                 INTO   :PV-THIS-SEAS-END-DTE                     10482638
W30900                 FROM   TDTATTR                                   10482702
W30900                 WHERE KY_DTE = :PV-KEY-DATE                      10482837
W30900             END-EXEC                                             10482902
W30900         WHEN CC-QUARTERLY                                        10483502
W30900             EXEC SQL                                             10483611
W30900                 SELECT MAX(A.KY_DTE)                             10483838
W30900                 INTO   :PV-THIS-SEAS-END-DTE                     10484038
W30900                 FROM   TDTATTR A                                 10484111
W30900                       ,TDTATTR B                                 10484215
W30900                 WHERE B.KY_DTE = :PV-KEY-DATE                    10484337
W30900                      AND A.FSCL_YR_NBR = B.FSCL_YR_NBR           10484411
W30900                      AND A.FSCL_QTR_NBR = B.FSCL_QTR_NBR         10484511
W30900             END-EXEC                                             10484611
W30900         WHEN CC-MONTHLY                                          10485303
W30900             EXEC SQL                                             10485503
W30900                 SELECT FSCL_MN_END_DTE                           10485738
W30900                 INTO   :PV-THIS-SEAS-END-DTE                     10485938
W30900                 FROM   TDTATTR                                   10486003
W30900                 WHERE KY_DTE = :PV-KEY-DATE                      10486137
W30900             END-EXEC                                             10486403
W30900     END-EVALUATE.                                                10490002
W30900                                                                  10590002
           IF SQLCODE NOT = +0                                          10600005
               MOVE '7000-SELECT-DB2-DATES'   TO PV-DB2-OPER-ATTEMPTED  10610005
               PERFORM 9999-SQL-ABEND                                   10630005
W30900     END-IF.                                                      10640005
      *                                                                 10641005
           MOVE PV-THIS-SEAS-END-DTE TO PV-KEY-DATE.                    10651037
      *                                                                 10660000
W30900     INITIALIZE DATE-TABLE.                                       10660141
W30900     EVALUATE TRUE                                                10661011
W30900         WHEN CC-SEASONAL                                         10662005
W30900             PERFORM 7100-SELECT-SEASONAL-DATES                   10670005
W30900                 UNTIL PV-SEAS-COUNTER = ZERO                     10690005
W30900         WHEN CC-QUARTERLY                                        10691005
W30900             PERFORM 7110-SELECT-QUARTERLY-DATES                  10691106
W30900                 UNTIL PV-SEAS-COUNTER = ZERO                     10691205
W30900         WHEN CC-MONTHLY                                          10692005
W30900             PERFORM 7120-SELECT-MONTHLY-DATES                    10692106
W30900                 UNTIL PV-SEAS-COUNTER = ZERO                     10692205
W30900     END-EVALUATE.                                                10693005
                                                                        10700000
           MOVE 1 TO PV-SUB1.                                           10710000
           DISPLAY 'FIRST SEASON END DATE ', DT-SEAS-END-DTE(PV-SUB1)   10720000
           DISPLAY 'THRU                  '.                            10730000
           MOVE CC-SEASONS-TO-PROCESS TO PV-SUB1.                       10740000
           DISPLAY 'LAST  SEASON END DATE ', DT-SEAS-END-DTE(PV-SUB1).  10750000
      *                                                                 10760000
W30900     PERFORM 7050-SET-EXTRACTS-WEEK-NBR.                          10761032
W30900*                                                                 10880032
W30900******************************************************************10890032
W30900* 7050-SET-EXTRACTS-WEEK-NBR.                                     10891032
      *    THIS IS SET ONCE FOR ALL RECORDS ON EACH EXTRACT             10892027
W30900******************************************************************10920032
W30900 7050-SET-EXTRACTS-WEEK-NBR.                                      10920132
W30900     EVALUATE TRUE                                                10920232
W30900         WHEN CC-SEASONAL                                         10920332
W30900             IF DT-SEAS-DESC(PV-SUB1) = 'SPRING'                  10920432
W30900                 SET ML041-SPRING-SEASON                          10920532
W30900                     ML042-SPRING-SEASON TO TRUE                  10920632
W30900                 MOVE '01' TO ML041-WEEK-NBR                      10920732
W30900             ELSE                                                 10920832
W30900                 IF DT-SEAS-DESC(PV-SUB1) = 'FALL  '              10920932
W30900                     SET ML041-FALL-SEASON                        10921032
W30900                         ML042-FALL-SEASON TO TRUE                10921132
W30900                     MOVE '27' TO ML041-WEEK-NBR                  10921232
W30900                 END-IF                                           10921332
W30900             END-IF                                               10921432
W30900         WHEN CC-QUARTERLY                                        10921532
W30900             IF DT-QTR-DESC(PV-SUB1) = '1' OR '2'                 10921632
W30900                 SET ML041-SPRING-SEASON                          10921732
W30900                     ML042-SPRING-SEASON TO TRUE                  10921832
W30900                 IF DT-QTR-DESC(PV-SUB1) = '1'                    10921932
W30900                     MOVE '01' TO ML041-WEEK-NBR                  10922032
W30900                 ELSE                                             10922132
W30900                     MOVE '14' TO ML041-WEEK-NBR                  10922232
W30900                 END-IF                                           10922332
W30900             ELSE                                                 10922432
W30900                 IF DT-QTR-DESC(PV-SUB1) = '3' OR '4'             10922532
W30900                     SET ML041-FALL-SEASON                        10922632
W30900                         ML042-FALL-SEASON TO TRUE                10922732
W30900                     IF DT-QTR-DESC(PV-SUB1) = '3'                10922832
W30900                         MOVE '27' TO ML041-WEEK-NBR              10922932
W30900                     ELSE                                         10923032
W30900                         MOVE '40' TO ML041-WEEK-NBR              10923132
W30900                     END-IF                                       10923232
W30900                 END-IF                                           10923332
W30900             END-IF                                               10923432
W30900         WHEN CC-MONTHLY                                          10923532
W30900             EVALUATE DT-MONTH-DESC(PV-SUB1)                      10923632
W30900                 WHEN 'FEB'                                       10923732
W30900                     SET ML041-SPRING-SEASON                      10923832
W30900                         ML042-SPRING-SEASON TO TRUE              10923932
W30900                     MOVE '01' TO ML041-WEEK-NBR                  10924032
W30900                 WHEN 'MAR'                                       10924132
W30900                     SET ML041-SPRING-SEASON                      10924232
W30900                         ML042-SPRING-SEASON TO TRUE              10924332
W30900                     MOVE '05' TO ML041-WEEK-NBR                  10924432
W30900                 WHEN 'APR'                                       10924532
W30900                     SET ML041-SPRING-SEASON                      10924632
W30900                         ML042-SPRING-SEASON TO TRUE              10924732
W30900                     MOVE '10' TO ML041-WEEK-NBR                  10924832
W30900                 WHEN 'MAY'                                       10924932
W30900                     SET ML041-SPRING-SEASON                      10925032
W30900                         ML042-SPRING-SEASON TO TRUE              10925132
W30900                     MOVE '14' TO ML041-WEEK-NBR                  10925232
W30900                 WHEN 'JUN'                                       10925332
W30900                     SET ML041-SPRING-SEASON                      10925432
W30900                         ML042-SPRING-SEASON TO TRUE              10925532
W30900                     MOVE '18' TO ML041-WEEK-NBR                  10925632
W30900                 WHEN 'JUL'                                       10925732
W30900                     SET ML041-SPRING-SEASON                      10925832
W30900                         ML042-SPRING-SEASON TO TRUE              10925932
W30900                     MOVE '23' TO ML041-WEEK-NBR                  10926032
W30900                 WHEN 'AUG'                                       10926132
W30900                     SET ML041-FALL-SEASON                        10926232
W30900                         ML042-FALL-SEASON TO TRUE                10926332
W30900                     MOVE '27' TO ML041-WEEK-NBR                  10926432
W30900                 WHEN 'SEP'                                       10926532
W30900                     SET ML041-FALL-SEASON                        10926632
W30900                         ML042-FALL-SEASON TO TRUE                10926732
W30900                     MOVE '31' TO ML041-WEEK-NBR                  10926832
W30900                 WHEN 'OCT'                                       10926932
W30900                     SET ML041-FALL-SEASON                        10927032
W30900                         ML042-FALL-SEASON TO TRUE                10927132
W30900                     MOVE '36' TO ML041-WEEK-NBR                  10927232
W30900                 WHEN 'NOV'                                       10927332
W30900                     SET ML041-FALL-SEASON                        10927432
W30900                         ML042-FALL-SEASON TO TRUE                10927532
W30900                     MOVE '40' TO ML041-WEEK-NBR                  10927632
W30900                 WHEN 'DEC'                                       10927732
W30900                     SET ML041-FALL-SEASON                        10927832
W30900                         ML042-FALL-SEASON TO TRUE                10927932
W30900                     MOVE '44' TO ML041-WEEK-NBR                  10928032
W30900                 WHEN 'JAN'                                       10928132
W30900                     SET ML041-FALL-SEASON                        10928232
W30900                         ML042-FALL-SEASON TO TRUE                10928332
W30900                     MOVE '49' TO ML041-WEEK-NBR                  10928432
W30900             END-EVALUATE                                         10928532
W30900     END-EVALUATE.                                                10928632
      *                                                                 10928727
      ******************************************************************10928827
      * 7100-SELECT-SEASONAL-DATES.                                    -10928927
      * RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    10929027
      ******************************************************************10929127
      *                                                                 10930000
       7100-SELECT-SEASONAL-DATES.                                      10940000
      *                                                                 10950000
      *                                                                 10960000
      **   RETRIEVE THE SEASON END DATE FOR THIS PARTICULAR SEASON      10970000
           EXEC SQL                                                     10980000
               SELECT SEA_DESC                                          10990000
                     ,SEA_BEG_DTE                                       11000000
                     ,SEA_END_DTE                                       11010000
                     ,PREV_SEA_END_DTE                                  11020000
                     ,FSCL_WK_NBR                                       11030000
                     ,FSCL_YR_NBR                                       11040000
               INTO   :DTATTR-SEA-DESC                                  11050000
                     ,:DTATTR-SEA-BEG-DTE                               11060000
                     ,:DTATTR-SEA-END-DTE                               11070000
                     ,:DTATTR-PREV-SEA-END-DTE                          11080000
                     ,:DTATTR-FSCL-WK-NBR                               11090000
                     ,:DTATTR-FSCL-YR-NBR                               11100000
               FROM   TDTATTR                                           11110000
               WHERE  KY_DTE = :PV-KEY-DATE                             11120037
           END-EXEC                                                     11130000
                                                                        11140000
           IF SQLCODE NOT = +0                                          11150000
               MOVE 'SELECT LY SEASON DATE' TO PV-DB2-OPER-ATTEMPTED    11160000
               PERFORM 9999-SQL-ABEND                                   11170000
           END-IF.                                                      11180000
      *                                                                 11190000
           MOVE DTATTR-SEA-DESC         TO DT-SEAS-DESC(PV-SUB1).       11200000
           MOVE DTATTR-SEA-BEG-DTE      TO DT-SEAS-BEG-DTE(PV-SUB1).    11210000
           MOVE DTATTR-SEA-END-DTE      TO DT-SEAS-END-DTE(PV-SUB1)     11220000
      *    THIS WILL BE USED TO GET A PRIOR YEAR (MULT SEASON REQUESTED)11230000
                                           PV-KEY-DATE.                 11240037
           MOVE DTATTR-PREV-SEA-END-DTE TO DT-PREV-SEA-END-DTE(PV-SUB1).11250000
           MOVE DTATTR-FSCL-WK-NBR      TO DT-FSCL-WK-SEAS-END(PV-SUB1).11260000
           MOVE DTATTR-FSCL-YR-NBR      TO DT-FSCL-YR-NBR(PV-SUB1).     11270000
                                                                        11280000
           COMPUTE PV-SUB1 = (PV-SUB1 - 1).                             11290000
           COMPUTE PV-SEAS-COUNTER = (PV-SEAS-COUNTER - 1).             11300000
      *                                                                 11310000
      **   RETRIEVE LAST YEARS SEASON END DATE FOR THE SAME SEASON      11320000
      *                                                                 11330000
           IF PV-SEAS-COUNTER > 0                                       11340000
               EXEC SQL                                                 11350000
                   SELECT LY_THIS_DAY_KY_DTE                            11360000
                   INTO   :PV-KEY-DATE                                  11370041
                   FROM   TDTATTR                                       11380000
                          WHERE KY_DTE = :DTATTR-SEA-END-DTE            11390000
               END-EXEC                                                 11400000
                                                                        11410000
               IF SQLCODE NOT = +0                                      11420000
W30900             MOVE 'SELECT LY THIS SEASON DATE'                    11430025
W30900                 TO PV-DB2-OPER-ATTEMPTED                         11431025
                   PERFORM 9999-SQL-ABEND                               11440000
               END-IF                                                   11450000
           END-IF.                                                      11460000
                                                                        11470000
W30900******************************************************************11471007
W30900* 7110-SELECT-QUARTERLY-DATES.                                    11472007
W30900* RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    11473007
W30900******************************************************************11474007
W30900 7110-SELECT-QUARTERLY-DATES.                                     11476007
W30900**   RETRIEVE THE QUARTER END DATE FOR THIS PARTICULAR QUARTER    11479007
W30900     EXEC SQL                                                     11479121
W30900         SELECT MIN(A.KY_DTE)                                     11479221
W30900               ,MAX(A.KY_DTE)                                     11479321
W30900         INTO   :PV-QTR-BEG-DTE                                   11479421
W30900               ,:PV-QTR-END-DTE                                   11479521
W30900         FROM   TDTATTR A                                         11479621
W30900               ,TDTATTR B                                         11479721
W30900         WHERE B.KY_DTE = :PV-KEY-DATE                            11479837
W30900              AND A.FSCL_YR_NBR = B.FSCL_YR_NBR                   11479921
W30900              AND A.FSCL_QTR_NBR = B.FSCL_QTR_NBR                 11480021
W30900     END-EXEC.                                                    11480121
W30900                                                                  11480221
W30900     IF SQLCODE NOT = +0                                          11480321
W30900         MOVE 'SELECT LY QUARTER DATE' TO PV-DB2-OPER-ATTEMPTED   11480421
W30900         PERFORM 9999-SQL-ABEND                                   11480521
W30900     END-IF.                                                      11480621
W30900                                                                  11480723
W30900     MOVE PV-QTR-BEG-DTE      TO DT-SEAS-BEG-DTE(PV-SUB1).        11480823
W30900     MOVE PV-QTR-END-DTE      TO DT-SEAS-END-DTE(PV-SUB1)         11480923
W30900*    THIS WILL BE USED TO GET A PRIOR YEAR (MULT QTR REQUESTED)   11481023
W30900                                 PV-KEY-DATE.                     11481137
W30900                                                                  11481323
W30900     EXEC SQL                                                     11481406
W30900         SELECT FSCL_QTR_NBR                                      11481518
W30900               ,FSCL_WK_NBR                                       11481618
W30900               ,FSCL_YR_NBR                                       11481718
W30900         INTO   :PV-QTR-DESC                                      11481806
W30900               ,:DTATTR-FSCL-WK-NBR                               11481907
W30900               ,:DTATTR-FSCL-YR-NBR                               11482007
W30900         FROM   TDTATTR                                           11482118
W30900         WHERE KY_DTE = :PV-KEY-DATE                              11482237
W30900     END-EXEC.                                                    11482320
W30900                                                                  11482807
W30900     IF SQLCODE NOT = +0                                          11482907
W30900         MOVE 'SELECT LY QUARTER INFO' TO PV-DB2-OPER-ATTEMPTED   11483021
W30900         PERFORM 9999-SQL-ABEND                                   11483107
W30900     END-IF.                                                      11483220
W30900*                                                                 11483307
W30900     MOVE PV-QTR-DESC         TO DT-QTR-DESC(PV-SUB1).            11483427
W30900     MOVE DTATTR-FSCL-WK-NBR  TO DT-FSCL-WK-SEAS-END(PV-SUB1).    11483923
W30900     MOVE DTATTR-FSCL-YR-NBR  TO DT-FSCL-YR-NBR(PV-SUB1).         11484023
W30900*                                                                 11484123
W30900     EXEC SQL                                                     11484323
W30900         SELECT JLN_DTE                                           11484423
W30900         INTO   :DTATTR-JLN-DTE                                   11484523
W30900         FROM   TDTATTR                                           11484623
W30900         WHERE KY_DTE = :PV-QTR-BEG-DTE                           11484740
W30900     END-EXEC.                                                    11484823
W30900                                                                  11484923
W30900     IF SQLCODE NOT = +0                                          11485023
W30900         MOVE 'SELECT LY THIS JLN DATE'                           11485123
W30900             TO PV-DB2-OPER-ATTEMPTED                             11485223
W30900         PERFORM 9999-SQL-ABEND                                   11485323
W30900     END-IF.                                                      11485423
W30900                                                                  11485523
W30900     COMPUTE PV-PREV-QTR-JLN-DTE = DTATTR-JLN-DTE - 1.            11485624
W30900                                                                  11485723
W30900     EXEC SQL                                                     11485823
W30900         SELECT KY_DTE                                            11485923
W30900         INTO   :PV-PREV-QTR-END-DTE                              11486023
W30900         FROM   TDTATTR                                           11486123
W30900         WHERE JLN_DTE = :PV-PREV-QTR-JLN-DTE                     11486223
W30900     END-EXEC.                                                    11486323
W30900                                                                  11486423
W30900     IF SQLCODE NOT = +0                                          11486523
W30900         MOVE 'SELECT LY PREV JLN DATE'                           11486623
W30900             TO PV-DB2-OPER-ATTEMPTED                             11486723
W30900         PERFORM 9999-SQL-ABEND                                   11486823
W30900     END-IF.                                                      11486923
W30900                                                                  11487023
W30900     MOVE PV-PREV-QTR-END-DTE TO DT-PREV-SEA-END-DTE(PV-SUB1).    11487123
W30900                                                                  11487423
W30900     COMPUTE PV-SUB1 = (PV-SUB1 - 1).                             11487523
W30900     COMPUTE PV-SEAS-COUNTER = (PV-SEAS-COUNTER - 1).             11487623
W30900*                                                                 11487723
W30900**   RETRIEVE LAST YEARS SEASON END DATE FOR THE SAME SEASON      11487823
W30900*                                                                 11487923
W30900     IF PV-SEAS-COUNTER > 0                                       11488023
W30900         EXEC SQL                                                 11488123
W30900             SELECT LY_THIS_DAY_KY_DTE                            11488223
W30900             INTO   :PV-KEY-DATE                                  11488337
W30900             FROM   TDTATTR                                       11488423
W30900                    WHERE KY_DTE = :PV-QTR-END-DTE                11488525
W30900         END-EXEC                                                 11488623
W30900                                                                  11488723
W30900         IF SQLCODE NOT = +0                                      11488823
W30900             MOVE 'SELECT LY THIS QTR DATE'                       11488923
W30900                 TO PV-DB2-OPER-ATTEMPTED                         11489023
W30900             PERFORM 9999-SQL-ABEND                               11489123
W30900         END-IF                                                   11489223
W30900     END-IF.                                                      11489323
W30900                                                                  11489423
W30900******************************************************************11489816
W30900* 7120-SELECT-MONTHLY-DATES.                                      11489916
W30900* RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    11490016
W30900******************************************************************11490116
W30900 7120-SELECT-MONTHLY-DATES.                                       11490216
W30900**   RETRIEVE THE MONTH END DATE FOR THIS PARTICULAR MONTH        11490316
W30900     EXEC SQL                                                     11490423
W30900         SELECT FSCL_MN_NM                                        11490523
W30900               ,FSCL_MN_BEG_DTE                                   11490623
W30900               ,FSCL_MN_END_DTE                                   11490723
W30900               ,PFM_END_DTE                                       11490825
W30900               ,FSCL_WK_NBR                                       11490925
W30900               ,FSCL_YR_NBR                                       11491025
W30900         INTO   :PV-MONTH-DESC                                    11491125
W30900               ,:PV-MONTH-BEG-DTE                                 11491225
W30900               ,:PV-MONTH-END-DTE                                 11491325
W30900               ,:DTATTR-PFM-END-DTE                               11491425
W30900               ,:DTATTR-FSCL-WK-NBR                               11491525
W30900               ,:DTATTR-FSCL-YR-NBR                               11491625
W30900         FROM   TDTATTR                                           11491723
W30900         WHERE KY_DTE = :PV-KEY-DATE                              11491837
W30900     END-EXEC.                                                    11491923
W30900                                                                  11493623
W30900     IF SQLCODE NOT = +0                                          11493723
W30900         MOVE 'SELECT LY MONTH DATE' TO PV-DB2-OPER-ATTEMPTED     11493825
W30900         PERFORM 9999-SQL-ABEND                                   11493923
W30900     END-IF.                                                      11494023
W30900*                                                                 11494123
W30900     MOVE PV-MONTH-INITIAL-DESC TO DT-MONTH-DESC(PV-SUB1).        11494827
W30900     MOVE PV-MONTH-BEG-DTE      TO DT-SEAS-BEG-DTE(PV-SUB1).      11494925
W30900     MOVE PV-MONTH-END-DTE      TO DT-SEAS-END-DTE(PV-SUB1)       11495025
W30900*    THIS WILL BE USED TO GET A PRIOR YEAR (MULT SEASON REQUESTED)11495123
W30900                                   PV-KEY-DATE.                   11495237
W30900     MOVE DTATTR-PFM-END-DTE    TO DT-PREV-SEA-END-DTE(PV-SUB1).  11495325
W30900     MOVE DTATTR-FSCL-WK-NBR    TO DT-FSCL-WK-SEAS-END(PV-SUB1).  11495425
W30900     MOVE DTATTR-FSCL-YR-NBR    TO DT-FSCL-YR-NBR(PV-SUB1).       11495525
W30900                                                                  11495623
W30900     COMPUTE PV-SUB1 = (PV-SUB1 - 1).                             11495723
W30900     COMPUTE PV-SEAS-COUNTER = (PV-SEAS-COUNTER - 1).             11495823
W30900*                                                                 11495923
W30900**   RETRIEVE LAST YEARS SEASON END DATE FOR THE SAME SEASON      11496023
W30900*                                                                 11496123
W30900     IF PV-SEAS-COUNTER > 0                                       11496223
W30900         EXEC SQL                                                 11496323
W30900             SELECT LY_THIS_DAY_KY_DTE                            11496423
W30900             INTO   :PV-KEY-DATE                                  11496537
W30900             FROM   TDTATTR                                       11496623
W30900                    WHERE KY_DTE = :PV-MONTH-END-DTE              11496725
W30900         END-EXEC                                                 11496831
W30900                                                                  11496923
W30900         IF SQLCODE NOT = +0                                      11497023
W30900             MOVE 'SELECT LY THIS MONTH DATE'                     11497125
W30900                 TO PV-DB2-OPER-ATTEMPTED                         11497225
W30900             PERFORM 9999-SQL-ABEND                               11497325
W30900         END-IF                                                   11497425
W30900     END-IF.                                                      11497525
W30900                                                                  11497625
      ******************************************************************11497725
      * 7200-BUILD-STORE-TABLE.                                         11498006
      * RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    11500000
      ******************************************************************11510000
      *                                                                 11520000
       7200-BUILD-STORE-TABLE.                                          11530000
                                                                        11540000
           PERFORM 5000-OPEN-STORE-CSR.                                 11550000
                                                                        11560000
           PERFORM 7300-PROCESS-STORE-CSR                               11570000
               UNTIL PS-EOF-STORE-CSR.                                  11580000
                                                                        11590000
           MOVE ST-STR-NBR(STR-IDX) TO PV-MAX-STORES.                   11600000
      *                                                                 11610000
           PERFORM 5300-CLOSE-STORE-CSR.                                11620000
      *                                                                 11630000
      ******************************************************************11640000
      * 7300-PROCESS-STORE-CSR.                                         11650000
      * RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    11660000
      ******************************************************************11670000
       7300-PROCESS-STORE-CSR.                                          11680000
                                                                        11690000
           PERFORM 5100-FETCH-STORE-CSR.                                11700000
                                                                        11710000
           PERFORM 5200-LOAD-STORE-TABLE.                               11720000
      *                                                                 11730000
      ******************************************************************11740000
      * 7400-BUILD-DEPT-TABLE.                                          11750000
      * RETRIEVE ALL NECESSARY HIERARCHY INFORMATION BASED ON DEPT_NBR  11760000
      ******************************************************************11770000
       7400-BUILD-DEPT-TABLE.                                           11780000
                                                                        11790000
           PERFORM 7450-OPEN-DEPT-CSR.                                  11800000
                                                                        11810000
           PERFORM 7500-FETCH-DEPT-CSR                                  11820000
               UNTIL PS-EOF-DEPT-CSR.                                   11830000
                                                                        11840000
           PERFORM 7600-CLOSE-DEPT-CSR.                                 11850000
      *                                                                 11860000
      *                                                                 11870000
      ******************************************************************11880000
      * 7450-OPEN-DEPT-CSR                                              11890000
      * RETRIEVE ALL NECESSARY DATES BASED ON THE CONTROL CARD SPECS    11900000
      ******************************************************************11910000
      *                                                                 11920000
       7450-OPEN-DEPT-CSR.                                              11930000
                                                                        11940000
           MOVE '7450-OPEN-DEPT-CSR' TO PV-PARAGRAPH-NAME.              11950000
                                                                        11960000
           EXEC SQL                                                     11970000
               OPEN TMDSEAR_CURSOR                                      11980000
           END-EXEC                                                     11990022
                                                                        12000000
           IF SQLCODE NOT = +0                                          12010000
               MOVE 'OPEN TMDSEAR CURSOR'   TO PV-DB2-OPER-ATTEMPTED    12020000
               PERFORM 9999-SQL-ABEND                                   12030000
           END-IF.                                                      12040000
      *                                                                 12050000
      ******************************************************************12060000
       7500-FETCH-DEPT-CSR.                                             12070000
      ******************************************************************12080000
                                                                        12090000
           EXEC SQL                                                     12100000
               FETCH TMDSEAR_CURSOR                                     12110000
                INTO :MDSEAR-GMA-NBR                                    12120000
                    ,:MDSEAR-DMA-NBR                                    12130000
                    ,:MDSEDP-MDSEBG-NBR                                 12140000
                    ,:MDSEAR-BYR-NBR                                    12150000
                    ,:MDSEAR-DEPT-NBR                                   12160000
                    ,:MDSEDP-ARDEPT-DESC                                12170000
           END-EXEC.                                                    12180000
                                                                        12190000
           EVALUATE SQLCODE                                             12200000
               WHEN +0                                                  12210000
                   PERFORM 7550-LOAD-DEPT-TABLE                         12220000
               WHEN +100                                                12230000
                   MOVE 'Y' TO PS-DEPT-CSR-SW                           12240000
               WHEN OTHER                                               12250000
                   MOVE 'FETCH MDSEAR CURSOR'   TO PV-DB2-OPER-ATTEMPTED12260000
                   PERFORM 9999-SQL-ABEND                               12270000
           END-EVALUATE.                                                12280000
                                                                        12290000
      *                                                                 12300000
      ******************************************************************12310000
       7550-LOAD-DEPT-TABLE.                                            12320000
      ******************************************************************12330000
           MOVE MDSEAR-DEPT-NBR     TO PV-HOLD-DEPT-NBR                 12340000
           MOVE PV-HOLD-DEPT-NBR    TO PV-HOLD-DEPT-NBR-NUM.            12350000
           SET DPT-IDX TO PV-HOLD-DEPT-NBR-NUM.                         12360000
      *    MOVE PV-HOLD-DEPT-NBR-NUM TO DPT-IDX.                        12370000
                                                                        12380000
           MOVE MDSEAR-GMA-NBR      TO DP-GMA-NBR(DPT-IDX).             12390000
           MOVE MDSEAR-DMA-NBR      TO DP-DMA-NBR(DPT-IDX).             12400000
           MOVE MDSEDP-MDSEBG-NBR   TO DP-MDSEBG-NBR(DPT-IDX).          12410000
           MOVE MDSEAR-BYR-NBR      TO DP-BYR-NBR(DPT-IDX).             12420000
           MOVE MDSEAR-DEPT-NBR     TO DP-DEPT-NBR(DPT-IDX).            12430000
           MOVE MDSEDP-ARDEPT-DESC  TO DP-DEPT-DESC(DPT-IDX).           12440000
      *                                                                 12450000
      ******************************************************************12460000
       7600-CLOSE-DEPT-CSR.                                             12470000
      ******************************************************************12480000
      *                                                                 12490000
           EXEC SQL                                                     12500000
               CLOSE TMDSEAR_CURSOR                                     12510000
           END-EXEC.                                                    12520000
                                                                        12530000
           IF SQLCODE NOT = +0                                          12540000
               MOVE 'CLOSE TMDSEAR CSR'   TO PV-DB2-OPER-ATTEMPTED      12550000
               PERFORM 9999-SQL-ABEND                                   12560000
           END-IF.                                                      12570000
      *                                                                 12580000
      *                                                                 12590000
      ******************************************************************12600000
       7700-GET-REPLACE-STR-DATES.                                      12610000
      ******************************************************************12620000
                                                                        12630000
W26602*    XMT00001 (XMT_LOC)                                           12770000
W26602*    DOMAIN TABLE DOES NOT CARRY MULTIPLE STORE FIELDS TO JOIN    12780000
W26602*    TOGETHER AS PREVIOUS QUERY COULD. TO YIELD THE SAME RESULTS  12790000
W26602*    AS THE ORIGINAL SQL, THE RETRIEVED LOC_NBR WILL BE EQUAL TO  12800000
W26602*    ORIGINAL STORE (THAT WAS REPLACED) AND THE REPLT_STR_NBR WILL12810000
W26602*    BE THE NEW STORE NUMBER (OR REPLACEMENT STORE).              12820000
W26602*                                                                 12830000
W26602     EXEC SQL                                                     12840000
W26602         SELECT LOC_NBR                                           12850000
W26602              , REPLT_STR_NBR                                     12860000
W26602              , SEA_SLS_INCL_DTE                                  12870000
W26602           INTO :XMT00001-LOC-NBR                                 12880000
W26602              , :XMT00001-REPLT-STR-NBR                           12890000
W26602              , :XMT00001-SEA-SLS-INCL-DTE                        12900000
W26602           FROM XMT_LOC                                           12910000
W26602          WHERE REPLT_STR_NBR = :PV-STR-NBR-REPLACE               12920000
W26602     END-EXEC.                                                    12930000
W26602                                                                  12940000
           EVALUATE TRUE                                                12950000
               WHEN SQLCODE = 0                                         12960000
                   SET PS-REPLACE-STORE TO TRUE                         12970000
               WHEN SQLCODE = +100                                      12980000
                   MOVE SPACES TO PS-STORE-TYPE-SW                      12990000
               WHEN OTHER                                               13000000
                   MOVE 'GET REPLACE STR DTES' TO PV-DB2-OPER-ATTEMPTED 13010000
                   PERFORM 9999-SQL-ABEND                               13020000
           END-EVALUATE.                                                13030000
      *                                                                 13040000
      ******************************************************************13050000
       7800-PREV-END-INV-RTL.                                           13060000
      ******************************************************************13070000
      *    ADD LAST SEASON'S ENDING INVENTORY RETAIL AMOUNT TO SEASON   13080000
                                                                        13090000
           MOVE DT-PREV-SEA-END-DTE(PV-SUB1) TO PV-END-OF-SEASON-DATE.  13100000
                                                                        13110000
           EXEC SQL                                                     13120000
               SELECT END_INV_RTL_AMT                                   13130000
                 INTO :PV-WKDPTS-END-INV-RTL-AMT                        13140000
               FROM TWKDPTS                                             13150000
               WHERE FSCL_WK_END_DTE = :PV-END-OF-SEASON-DATE           13160000
                 AND STR_NBR  = :PV-HOLD-STR-NBR                        13170000
                 AND DEPT_NBR = :PV-HOLD-DEPT-NBR                       13180000
           END-EXEC.                                                    13190000
                                                                        13200000
      ******************************************************************13201000
       7900-BUILD-SPECIFIC-LOC-TABLE.                                   13202000
      ******************************************************************13203000
      *    BUILDS INTERNAL TABLE OF LOCATION NUMBERS WHEN               13204000
      *    SPECIFIC LOCATIONS ARE ENTERED IN CONTROL CARD 3             13205000
                                                                        13206000
           MOVE LOC-NBR-SPC-9  TO  PV-LOC-NBR.                          13207000
           MOVE PV-LOC-NBR   TO  LT-LOC-NBR(PV-SUB2).                   13207100
           SET PV-SUB2 UP BY +1.                                        13208000
           ADD +1 TO PV-LOC-COUNT.                                      13209000
           PERFORM 4051-READ-LOC-CONTROL-FILE.                          13209100
                                                                        13210000
      ******************************************************************13211000
       7950-SEARCH-LOC-TABLE.                                           13212000
      ******************************************************************13213000
      *    IF SPECIFIC LOCATIONS HAVE BEEN SPECIFIED IN CONTROL CARD 3, 13214000
      *    SEARCH THE TABLE TO SEE IF CURRENT RECORD IS ONE OF THEM     13215000
                                                                        13215100
           PERFORM VARYING PV-SUB2 FROM 1 BY 1                          13215200
               UNTIL PV-LOC-NBR = WKDPTS-STR-NBR                        13215300
                  OR PV-SUB2 > PV-LOC-COUNT                             13215400
                                                                        13215500
                  MOVE LT-LOC-NBR(PV-SUB2) TO PV-LOC-NBR                13215600
                                                                        13215800
           END-PERFORM .                                                13216000
                                                                        13217000
      ******************************************************************13220000
       9900-EOJ-ROUTINE.                                                13230000
      ******************************************************************13240000
      *                                                                 13250000
           DISPLAY ' '.                                                 13260000
           DISPLAY '  PROGRAM MLKUT103-END OF PROCESSING '.             13270000
           DISPLAY '  -----------------------------------'.             13280000
           DISPLAY ' '.                                                 13290000
                                                                        13300000
           CLOSE  INPUT-CONTROL-FILE                                    13310000
                  WKDPTS-EXTR-FILE                                      13320000
                  STORE-EXTR-FILE.                                      13330000
                                                                        13340000
       EJECT                                                            13350000
                                                                        13360000
      ******************************************************************13370000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A NON-DB2 RELATED PROBLEM. 13380000
      ******************************************************************13390000
       9999-ABEND.                                                      13400000
                                                                        13410000
           DISPLAY '**  ABEND     **'.                                  13420000
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.              13430000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            13440000
           DISPLAY '**'                                                 13450000
           DISPLAY '**'                                                 13460000
           DISPLAY '**********************************'.                13470000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           13480000
                                                                        13490000
      *                                                                 13500000
      ******************************************************************13510000
      *  STANDARD DB2 ERROR ABEND ROUTINE                               13520000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             13530000
      ******************************************************************13540000
       9999-SQL-ABEND.                                                  13550000
                                                                        13560000
           MOVE +4013                 TO ABEND-CODE.                    13570000
           DISPLAY '**  ABEND     **'.                                  13580000
           DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              13590000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            13600000
           DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        13610000
                                                                        13620000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         13630000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        13640000
                                                                        13650000
           COPY DPPD004.                                                13660000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           13670000
      *                                                                 13680000
