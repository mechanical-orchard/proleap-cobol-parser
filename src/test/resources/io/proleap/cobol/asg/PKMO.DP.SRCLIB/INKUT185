       IDENTIFICATION DIVISION.                                                 
                                                                                
       PROGRAM-ID.              INKUT185.                                       
       AUTHOR.                  SCOTT JACKSON.                                  
       INSTALLATION.            KOHLS DEPARTMENT STORES.                        
       DATE-WRITTEN.            04/20/2000.                                     
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *   INVENTORY TIMESTAMP EDIT PROGRAM                                      
      *                                                                         
      *CHANGE HISTORY:                                                          
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                             
      * -------  ----------  ----------------------------------------           
24029 * 24029    09-20-2002  REVISE THE STORE BREAK PROCESS TO BREAK UN-        
24029 *                      CONDITIONALLY BY STORE. - ROD JANSSEN              
      ******************************************************************        
W21732* 11/18/2002        CHANGED BY J.S.NAVIS RAJA,IGSI   WR# W21732  *        
W21732* CHANGED CURRENT DEPT/CLASS/SEQ NUMBER TO NON-INTELLIGENT SKU.  *        
W21732******************************************************************        
W24521* CHANGED 03/21/2003    BY RONNA BUTZ     WR# W224521            *        
W24521* UPDATE TINVPAR TO INDICATE WHETHER THE TIMESTAMP EDITING       *        
W24521* WAS PROCESSED WITH ERRORS OR NO ERRORS.                        *        
W24521* INCREASE THE LENGTH OF THE VARIABLES THAT KEEP COUNT OF THE    *        
W24521* ERRORS.                                                                 
W24521******************************************************************        
RM0121* CHANGED 01/21/2004    BY RONNA BUTZ     WR#  W24521            *        
RM0121* ADD COMMIT LOGIC BECAUSE OF CONTENTION WITH A RECEIVING        *        
RM0121* ONLINE PROGRAM                                                 *        
      ******************************************************************        
      * CHANGED 08/18/2004    BY MARK JOHNSON   WR#  W26600            *        
      * STORE NUMBER EXPANSION CHANGES TO 4 DIGIT STORE NUMBER         *        
P28545* W28545 03-24-2006 ROD JANSSEN CYCLE INVENTORY PRICE MODULE SETUP        
P28545*                               (TINCNTL/TINVPAR MODIFICATIONS)           
W33304******************************************************************        
W33304* CHANGED 08/20/2008    BY THERESE RAMSEYER WR#  W33304                   
W33304*                       HILO - HOLD INVENTORY LEDGER OPEN                 
W33304*                     --> RECOMPILE TO PICK UP CHANGES IN                 
W33304*                         TINCNTL & TINVPAR                               
W33304*                     --> CHANGE "E" TO "CE" & "C" TO "TP"                
W33304*                         TO POPULATE TMST_EDT_STAT_CDE                   
W33304*                     --> ADD 'NON-DELETE LOCATION LOGIC' FILTER          
W33304*                         "A.LOC_INV_STAT_CDE = 'IN'" IN THE              
W33304*                         WHERE CLAUSE OF 7001-READ-TINVPAR               
W33304*                     --> ADD SOME SELECTION CRITERIA TO                  
W33304*                         7000-ENSURE-ACTV-STORE (RENAMED FROM            
W33304*                         7000-READ-TINVPAR                               
W33304*                     --> ADD PARAGRAPHS:                                 
W33304*                                 7010-CHECK-FOR-NON-ACTV-STR,            
W33304*                                 7020-BYPASS-NON-ACTV-STR-RECS,          
W33304*                                 7030-READ-INPUT                         
W33304*                         TO CHECK FOR A NON ACTV STORE AND BYPASS        
W33304*                         INPUT RECS WITH A LOC_NBR THAT IS A             
W33304*                         NON ACTV STORE.                                 
W33304*                     --> ADDED THE IF LOGIC IN 2000- & 2100-             
W33304*                         TO BYPASS PROCESS STATEMENTS WHEN               
W33304*                         THE CURRENT STORE IS NON ACTIVE                 
W33304*                         SHIFTING CODE +3 TO RIGHT, REMOVING             
W33304*                         PERIODS AND FRAMING STATEMENTS WITH             
W33304*                         CORRESPONDING 'END-IF'S WAS NEEDED.             
W33304*                     --> ADDED 6001-DISPLAY-STATS TO TABLULATE           
W33304*                         SUMMARY STATISTICS FOR BYPASSED RECS            
W33304******************************************************************        
SR3403* CHANGED 04/03/2012    BY ANUJ GUPTA     WR#  SR3403            *        
SR3403* LARGE RETAIL PROJECT                                           *        
SR3403******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT INPUT-CONTROL-FILE                                            
               ASSIGN TO INP01.                                                 
           SELECT INPUT-VALID-FILE                                              
               ASSIGN TO INP02.                                                 
           SELECT INPUT-STORE-FILE                                              
               ASSIGN TO INP03.                                                 
           SELECT OUT-OMIT-FILE                                                 
               ASSIGN TO OUT01.                                                 
           SELECT OUT-INCLUDE-FILE                                              
               ASSIGN TO OUT02.                                                 
           SELECT OUT-MESSAGE-FILE                                              
               ASSIGN TO OUT03.                                                 
           SELECT ERROR-REPORT-FILE                                             
               ASSIGN TO RPT01.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  INPUT-CONTROL-FILE                                                   
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  INPUT-CONTROL-RECORD    PIC X(80).                                   
                                                                                
       FD  INPUT-VALID-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
SR3403 01  INPUT-VALID-RECORD      PIC X(100).                                  
                                                                                
       FD  INPUT-STORE-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  INPUT-STORE-RECORD      PIC X(80).                                   
                                                                                
       FD  OUT-OMIT-FILE                                                        
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-OMIT-RECORD         PIC X(80).                                   
                                                                                
       FD  OUT-INCLUDE-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-INCLUDE-RECORD      PIC X(80).                                   
                                                                                
       FD  OUT-MESSAGE-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-MESSAGE-RECORD      PIC X(80).                                   
                                                                                
       FD  ERROR-REPORT-FILE                                                    
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  ERROR-REPORT-RECORD     PIC X(132).                                  
                                                                                
      /*****************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      *                                                                         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-EMPTY-DATE        PIC X(10)   VALUE '9999-09-09'.             
W33304     05  PC-CE                PIC X(02)   VALUE 'CE'.                     
W33304     05  PC-TP                PIC X(02)   VALUE 'TP'.                     
      *    05  PC-MAX-DAYS-PRIOR    PIC S9(01)   VALUE +3    COMP-3.            
           05  PC-MAX-DAYS-AFTER    PIC S9(01)   VALUE -1    COMP-3.            
           05  PC-ZERO              PIC S9(01)   VALUE +0    COMP-3.            
           05  PC-MAX-OVERRIDE-STRS PIC 9(02)   VALUE 25.                       
      * PC-START-END-MAX (05:00:00 AM)                                          
           05  PC-START-TIME-MIN    PIC S9(06) VALUE ZERO COMP-3.               
           05  PC-END-TIME-MAX      PIC S9(06) VALUE ZERO COMP-3.               
           05  PC-MAX-DAYS-PRIOR    PIC S9(03) VALUE ZERO COMP-3.               
      *                                                                         
      *MIN START TIME 050000 MAX END TIME 050000 MAX DAYS PRIOR 003             
       01  CC-CONTROL-TIMES.                                                    
           05  FILLER            PIC X(15).                                     
           05  CC-START-TIME-MIN PIC 9(06).                                     
           05  FILLER            PIC X(14).                                     
           05  CC-END-TIME-MAX   PIC 9(06).                                     
           05  FILLER            PIC X(16).                                     
           05  CC-MAX-DAYS-PRIOR PIC 9(03).                                     
           05  FILLER            PIC X(20).                                     
      *                                                                         
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-INPUT-COUNT       PIC S9(07)  VALUE ZERO   COMP-3.            
           05  PA-TOTAL-COUNT       PIC S9(07)  VALUE ZERO   COMP-3.            
           05  PA-STORE-COUNT       PIC S9(07)  VALUE ZERO   COMP-3.            
W33304     05  PA-TOT-NON-ACTV-STR-RECS-BYP PIC S9(07) COMP-3 VALUE +0.         
W33304     05  PA-TOT-INV-STR-RECS          PIC S9(07) COMP-3 VALUE +0.         
W33304     05  PA-TOT-RECS-READ             PIC S9(07) COMP-3 VALUE +0.         
           05  PA-MESSAGE-COUNT     PIC S9(07)  VALUE ZERO   COMP-3.            
R24521     05  PA-DATE-TIME-ERROR   PIC S9(06)  VALUE ZERO   COMP-3.            
R24521     05  PA-DATE-ERROR        PIC S9(06)  VALUE ZERO   COMP-3.            
R24521     05  PA-TIMESTAMP-ERROR   PIC S9(06)  VALUE ZERO   COMP-3.            
                                                                                
       01  PV-OVERRIDE-TABLE.                                                   
           05  PV-OVERRIDE-STORE-TAB OCCURS 25 TIMES.                           
W26600         10  PV-OVERRIDE-STORE PIC X(04).                                 
W24521*                                                                         
W24521 01  PV-PROGRAM-VARIABLES.                                                
W24521     05  PV-MAX-RETRIES          PIC S9(05)    COMP-3 VALUE +3.           
W33304     05  PV-ACTV-STORE           PIC 9(04)    VALUE ZEROES.               
W33304     05  PV-NON-ACTV-STORE       PIC 9(04)    VALUE ZEROES.               
W33304     05  PV-RETRY-COUNTER        PIC S9(04) VALUE +0 COMP SYNC.           
      *                                                                         
      * ALL STORES PROCESSED MUST HAVE SAME ACTL-INV-DATE (ELSE ABEND)          
      * USE SV-INVPAR-STORE(PV-STORE-SUB) TO WRITE TO SORT CARD RECS            
       01  SV-STORES-DATE-TABLE.                                                
W26600     05  SV-INVPAR-INV-DATE   OCCURS 500 TIMES.                           
W26600         10  SV-INVPAR-STORE             PIC X(04)  VALUE SPACES.         
               10  FILLER                      PIC X(01)  VALUE SPACES.         
               10  SV-INVPAR-ACTL-INV-DATE.                                     
                   15  SV-INVPAR-ACTL-CCYY.                                     
                       20  SV-INVPAR-ACTL-CC   PIC X(02)  VALUE SPACES.         
                       20  SV-INVPAR-ACTL-YY   PIC X(02)  VALUE SPACES.         
                   15  FILLER                  PIC X(01)  VALUE SPACES.         
                   15  SV-INVPAR-ACTL-MM       PIC X(02)  VALUE SPACES.         
                   15  FILLER                  PIC X(01)  VALUE SPACES.         
                   15  SV-INVPAR-ACTL-DD       PIC X(02)  VALUE SPACES.         
               10  FILLER                      PIC X(01)  VALUE SPACES.         
               10  SV-INVPAR-ACTL-JULIAN-DTE.                                   
                   15  SV-INVPAR-JULIAN-CCYY   PIC 9(04)  VALUE ZEROES.         
                   15  SV-INVPAR-JULIAN-DDD    PIC 9(03)  VALUE ZEROES.         
      *                                                                         
       01  PC-PRINT-CONTROL.                                                    
           05  PC-LINE-COUNT        PIC S9(03)  VALUE +099.                     
           05  PC-LINE-MAX          PIC S9(03)  VALUE +57.                      
           05  PC-ADVANCE           PIC S9(03)  VALUE ZERO.                     
           05  PC-PAGE              PIC S9(05)  VALUE ZERO.                     
           05  PC-MAX-RETRIES       PIC 9(03)   VALUE 3.                        
      *                                                                         
JS0398 01  CC-OVERRIDE-STORES.                                                  
W26600     05  CC-STORE             PIC X(04)  VALUE SPACES.                    
W26600     05  FILLER               PIC X(76)  VALUE SPACES.                    
      *                                                                         
       01  PS-PROGRAM-SWITCHES.                                                 
W33304     05  PS-ACTV-STORE-SW        PIC X    VALUE 'N'.                      
W33304         88  PS-ACTV-STORE                VALUE 'Y'.                      
W33304         88  PS-NON-ACTV-STORE            VALUE 'N'.                      
W33304*                                                                         
           05  PS-FIRST-TIME-SW        PIC X    VALUE 'Y'.                      
               88  PS-FIRST-TIME                VALUE 'Y'.                      
               88  PS-NOT-FIRST-TIME            VALUE 'N'.                      
      *                                                                         
           05  PS-FIRST-SORT-SW        PIC X    VALUE 'Y'.                      
               88  PS-FIRST-SORT-REC            VALUE 'Y'.                      
               88  PS-NOT-FIRST-SORT-REC        VALUE 'N'.                      
      *                                                                         
           05  PS-FIRST-EMAIL-SW       PIC X    VALUE 'Y'.                      
               88  PS-FIRST-EMAIL-REC           VALUE 'Y'.                      
               88  PS-NOT-FIRST-EMAIL-REC       VALUE 'N'.                      
      *    NUMERIC DATE                                                         
A          05  PS-NUMERIC-DATE-SW      PIC X    VALUE 'Y'.                      
               88  PS-NUMERIC-DATE              VALUE 'Y'.                      
               88  PS-NON-NUMERIC-DATE          VALUE 'N'.                      
      *    NUMERIC TIMESTAMP                                                    
B          05  PS-NUMERIC-TIME-SW      PIC X    VALUE 'Y'.                      
               88  PS-NUMERIC-TIME              VALUE 'Y'.                      
               88  PS-NON-NUMERIC-TIME          VALUE 'N'.                      
C     *    VALID DATE CHECK                                                     
           05  PS-VALID-DATE-SW        PIC X    VALUE 'Y'.                      
               88  PS-VALID-DATE                VALUE 'Y'.                      
               88  PS-INVALID-DATE              VALUE 'N'.                      
D     *    VALID TIMESTAMP CHECK                                                
           05  PS-VALID-TIMESTAMP-SW   PIC X    VALUE 'Y'.                      
               88  PS-VALID-TIMESTAMP           VALUE 'Y'.                      
               88  PS-INVALID-TIMESTAMP         VALUE 'N'.                      
      *                                                                         
           05  PS-END-OF-INVENTORY-SW     PIC X.                                
               88  PS-NOT-EOF-INVENTORY-FILE    VALUE 'N'.                      
               88  PS-EOF-INVENTORY-FILE        VALUE 'Y'.                      
                                                                                
           05  PS-END-OF-STORES           PIC X VALUE 'N'.                      
               88 PS-END-OF-STORES-CC           VALUE 'Y'.                      
                                                                                
           05  PS-OVERRIDE-STORE-SW       PIC X VALUE 'N'.                      
               88  PS-OVERRIDE-STORE-FOUND      VALUE 'Y'.                      
               88  PS-OVERRIDE-STORE-NOT-FOUND  VALUE 'N'.                      
      *                                                                         
       01  MSG-MESSAGES.                                                        
           05  MSG-BAD-DATE          PIC X(54)          VALUE                   
           '**** NON NUMERIC DATE            ****'.                             
           05  MSG-BAD-TIME          PIC X(54)          VALUE                   
           '**** NON NUMERIC TIMESTAMP       ****'.                             
           05  MSG-INV-DATE          PIC X(54)          VALUE                   
           '**** INVALID VALUE IN DATE       ****'.                             
           05  MSG-INV-TIME          PIC X(54)          VALUE                   
           '**** INVALID VALUE IN TIMESTAMP  ****'.                             
           05  MSG-INV-DATE-TIME     PIC X(54)          VALUE                   
           '**** INVALID DATE AND TIMESTAMP COMBINATION  ****'.                 
           05  MSG-EARLY-DATE        PIC X(54)          VALUE                   
           '**** SCAN DATE MORE THAN 3 DATES PRIOR TO INV ***'.                 
           05  MSG-LATE-DATE         PIC X(54)          VALUE                   
           '**** SCAN DATE IS AFTER ACTL INVENTORY DATE  ****'.                 
           05  MSG-EARLY-TIME        PIC X(54)          VALUE                   
           '**** INVENTORY START TIME IS BEFORE 5:00 AM  ****'.                 
           05  MSG-LATE-TIME         PIC X(54)          VALUE                   
           '**** INVENTORY  END  TIME IS AFTER  5:00 AM  ****'.                 
      *                                                                         
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-STORE-SUB         PIC S9(03)  VALUE ZERO  COMP-3.             
           05  PV-OVERRIDE-SUB      PIC S9(03)  VALUE ZERO  COMP-3.             
           05  PV-STORE-IN-PROCESS  PIC S9(03)  VALUE ZERO  COMP-3.             
           05  PV-SQL-SUB           PIC 9(03)  VALUE ZERO.                      
           05  PV-PARAGRAPH-NAME    PIC X(30)  VALUE SPACES.                    
           05  PV-DB2-OPER-ATTEMPTED PIC X(50)  VALUE SPACES.                   
W26600     05  PV-HOLD-SORT-STORE   PIC X(04)  VALUE SPACES.                    
      *    05  PV-HOLD-SORT-STORE   PIC S9(03) VALUE ZERO   COMP-3.             
           05  PV-CURRENT-DATE.                                                 
               10  PV-CC            PIC X(02)  VALUE SPACES.                    
               10  PV-YY            PIC X(02)  VALUE SPACES.                    
               10  FILLER           PIC X(01)  VALUE '-'.                       
               10  PV-MM            PIC X(02)  VALUE SPACES.                    
               10  FILLER           PIC X(01)  VALUE '-'.                       
               10  PV-DD            PIC X(02)  VALUE SPACES.                    
           05  PV-SCAN-DATE.                                                    
               10  PV-SCAN-DATE-MM  PIC  X(02)   VALUE SPACES.                  
               10  FILLER           PIC  X(01)   VALUE '-'.                     
               10  PV-SCAN-DATE-DD  PIC  X(02)   VALUE SPACES.                  
           05  PV-TIMESTAMP.                                                    
               10  PV-SCAN-TIME-HH  PIC  X(02)   VALUE SPACES.                  
               10  FILLER           PIC  X(01)   VALUE ':'.                     
               10  PV-SCAN-TIME-MM  PIC  X(02)   VALUE SPACES.                  
               10  FILLER           PIC  X(01)   VALUE ':'.                     
               10  PV-SCAN-TIME-SS  PIC  X(02)   VALUE SPACES.                  
       01  PV-MESSAGE-HEADER1.                                                  
           05  PV-DATASET-HEADER1      PIC X(53)  VALUE                         
              'THE FOLLOWING STORES HAVE INVALID INVENTORY TIMESTAMP'.          
           05  PV-DATASET-HEADER2      PIC X(19)  VALUE                         
              ' AND/OR DATE ERRORS'.                                            
       01  PV-MESSAGE-HEADER2.                                                  
           05  PV-DATASET-HEADER3      PIC X(60)  VALUE                         
              ' PLEASE REVIEW RDS REPORT - INK08910 - INKUT185-1'.              
                                                                                
       01  PV-MESSAGE-DETAIL.                                                   
           05  PV-MESSAGE-STORES.                                               
               10  FILLER              PIC X(02)  VALUE SPACES.                 
W26600         10  PV-MESSAGE-STR      PIC X(04)  VALUE SPACES.                 
               10  FILLER              PIC X(01)  VALUE SPACES.                 
               10  FILLER              PIC X(01)  VALUE '-'.                    
               10  FILLER              PIC X(01)  VALUE SPACES.                 
W24521         10  PV-MESSAGE-COUNT    PIC Z,ZZZ,ZZ9                            
W24521                                            VALUE ZEROES.                 
               10  FILLER              PIC X(01)  VALUE SPACES.                 
               10  FILLER              PIC X(15)  VALUE                         
                                                     'INVALID RECORDS'.         
W24521         10  FILLER              PIC X(47)  VALUE SPACES.                 
      *                                                                         
       01  SA-SAVE-AREAS.                                                       
W26600     05  SA-STORE-NUMBER      PIC X(04)   VALUE SPACES.                   
      *                                                                         
                                                                                
       01  SC-SORT-RECORD.                                                      
      *    05  FILLER                     PIC X(55) VALUE                       
      *    '  SORT FIELDS=(1,3,CH,A,22,8,CH,A,41,4,CH,A,45,6,CH,A)'.            
      *    05  FILLER                     PIC X(25) VALUE                       
           05  FILLER                     PIC X(18) VALUE                       
           '  SORT FIELDS=COPY'.                                                
           05  FILLER                     PIC X(62) VALUE SPACES.               
       01  SC-INCLUDE-FIELDS.                                                   
           05 FILLER                      PIC X(27) VALUE                       
W26600     '  INCLUDE COND=(1,4,CH,EQ,C'.                                       
           05  FILLER                     PIC X(01) VALUE QUOTE.                
W26600     05  FILLER                     PIC X(04) VALUE '0000'.               
           05  FILLER                     PIC X(01) VALUE QUOTE.                
           05  FILLER                     PIC X(01) VALUE ','.                  
W26600     05  FILLER                     PIC X(46) VALUE SPACES.               
       01  SC-OMIT-FIELDS.                                                      
           05 FILLER                      PIC X(24) VALUE                       
W26600     '  OMIT COND=(1,4,CH,EQ,C'.                                          
           05  FILLER                     PIC X(01) VALUE QUOTE.                
W26600     05  FILLER                     PIC X(04) VALUE '0000'.               
           05  FILLER                     PIC X(01) VALUE QUOTE.                
           05  FILLER                     PIC X(01) VALUE ','.                  
W26600     05  FILLER                     PIC X(49) VALUE SPACES.               
       01  SC-SORT-STORES.                                                      
           05  FILLER                     PIC X(15) VALUE                       
           '            OR,'.                                                   
           05 FILLER                      PIC X(11) VALUE                       
           '1,4,CH,EQ,C'.                                                       
           05  FILLER                     PIC X(01) VALUE QUOTE.                
W26600     05  SC-SORT-STR                PIC X(04) VALUE SPACE.                
           05  FILLER                     PIC X(01) VALUE QUOTE.                
           05  FILLER                     PIC X(01) VALUE ','.                  
           05  FILLER                     PIC X(48) VALUE SPACES.               
       01  SC-INCLUDE-FIELDS-LAST.                                              
           05  FILLER                     PIC X(15) VALUE                       
           '            OR,'.                                                   
           05 FILLER                      PIC X(11) VALUE                       
W26600     '1,4,CH,EQ,C'.                                                       
           05  FILLER                     PIC X(01) VALUE QUOTE.                
W26600     05  FILLER                     PIC X(04) VALUE '0000'.               
           05  FILLER                     PIC X(01) VALUE QUOTE.                
           05  FILLER                     PIC X(01) VALUE ')'.                  
      *    05  FILLER                     PIC X(48) VALUE SPACES.               
                                                                                
       01  SC-SORT-RECORD-END.                                                  
           05  FILLER                     PIC X(05) VALUE '  END'.              
      *    05  FILLER                     PIC X(75) VALUE SPACES.               
                                                                                
      *                                                                         
       01  IW-WORK-TIME.                                                        
           05  IW-TIME         PIC 9(8).                                        
           05  FILLER  REDEFINES IW-TIME.                                       
               10  IW-HOUR     PIC 99.                                          
               10  IW-MIN      PIC 99.                                          
               10  IW-SEC      PIC 99.                                          
               10  IW-THOUS    PIC 99.                                          
      *                                                                         
       01  CPU-DATE.                                                            
           05  CPU-YEAR        PIC 99           VALUE ZERO.                     
           05  CPU-MONTH       PIC 99           VALUE ZERO.                     
           05  CPU-DAY         PIC 99           VALUE ZERO.                     
                                                                                
       01  WS-JULIAN-DATE-VARIANCE.                                             
           05  WS-JULIAN-DAYS-GAP    PIC S9(03)  VALUE ZERO  COMP-3.            
                                                                                
       01  WS-SCAN-TIMESTAMP.                                                   
           05  WS-SCAN-TIME-HH PIC 99           VALUE ZERO.                     
           05  WS-SCAN-TIME-MM PIC 99           VALUE ZERO.                     
           05  WS-SCAN-TIME-SS PIC 99           VALUE ZERO.                     
                                                                                
       01  WS-DATE-CCYY.                                                        
           05  WS-DATE-CC      PIC 99           VALUE ZERO.                     
           05  WS-DATE-YY      PIC 99           VALUE ZERO.                     
                                                                                
       01  WS-SCAN-DATE.                                                        
           05  WS-SCAN-DATE-MM PIC 99           VALUE ZERO.                     
           05  WS-SCAN-DATE-DD PIC 99           VALUE ZERO.                     
                                                                                
       01  WS-SCAN-JULIAN-DATE.                                                 
           05  WS-JULIAN-CCYY  PIC  9(04)        VALUE ZERO.                    
           05  WS-JULIAN-DDD   PIC  9(03)        VALUE ZERO.                    
           05  WS-JULIAN-DDD-RED     REDEFINES                                  
               WS-JULIAN-DDD.                                                   
               10 WS-JULIAN-DAY PIC S9(03).                                     
                                                                                
       01  PC-CALENDAR-MODULE                 PIC X(8) VALUE 'DPKUT500'.        
       01  WS-CALENDAR-TYPE                   PIC X(2) VALUE 'F2'.              
      *                                                                         
       01  H1-HEADING.                                                          
           05  FILLER          PIC X(50)        VALUE SPACES.                   
           05  FILLER          PIC X(32)        VALUE                           
           '   TIMESTAMPING ERROR REPORT    '.                                  
           05  FILLER          PIC X(50)        VALUE SPACES.                   
      *                                                                         
24029  01   HL-HEADING-STORE.                                                   
   |       05  FILLER          PIC X(02)        VALUE SPACES.                   
   |       05  FILLER          PIC X(08)        VALUE 'STORE:  '.               
W26600     05  HHS-STORE       PIC X(04)        VALUE SPACES.                   
24029                                                                           
       01  H2-HEADING.                                                          
           05  FILLER          PIC X(03)        VALUE SPACES.                   
24029      05  FILLER          PIC X(05)        VALUE SPACES.                   
24029****  05   FILLER          PIC X(05)        VALUE 'STORE'.                 
           05  FILLER          PIC X(04)        VALUE SPACES.                   
           05  FILLER          PIC X(08)        VALUE 'INV DATE'.               
           05  FILLER          PIC X(07)        VALUE SPACES.                   
W21732     05  FILLER          PIC X(04)        VALUE 'SKU '.                   
           05  FILLER          PIC X(07)        VALUE SPACES.                   
           05  FILLER          PIC X(04)        VALUE 'AREA'.                   
           05  FILLER          PIC X(04)        VALUE SPACES.                   
           05  FILLER          PIC X(09)        VALUE 'INVENTORY'.              
           05  FILLER          PIC X(10)        VALUE ' TIMESTAMP'.             
           05  FILLER          PIC X(67)        VALUE SPACES.                   
      *                                                                         
       01  H2-HEADING-DASH.                                                     
           05  FILLER          PIC X(03)        VALUE SPACES.                   
24029      05  FILLER          PIC X(05)        VALUE SPACES.                   
24029 ***  05  FILLER          PIC X(05)        VALUE '-----'.                  
           05  FILLER          PIC X(03)        VALUE SPACES.                   
           05  FILLER          PIC X(10)        VALUE '----------'.             
           05  FILLER          PIC X(03)        VALUE SPACES.                   
W21732     05  FILLER          PIC X(08)        VALUE '--------'.               
W21732     05  FILLER          PIC X(05)        VALUE SPACES.                   
           05  FILLER          PIC X(06)        VALUE '------'.                 
           05  FILLER          PIC X(03)        VALUE SPACES.                   
           05  FILLER          PIC X(09)        VALUE '---------'.              
           05  FILLER          PIC X(10)        VALUE '----------'.             
           05  FILLER          PIC X(67)        VALUE SPACES.                   
      *                                                                         
       01  D1-DETAIL.                                                           
           05  FILLER          PIC X(04)        VALUE SPACES.                   
24029      05  FILLER          PIC X(03)        VALUE SPACES.                   
24029 ***  05  D1-STORE-NUMBER PIC X(03)        VALUE SPACES.                   
           05  FILLER          PIC X(04)        VALUE SPACES.                   
           05  D1-ACTL-INV-DTE PIC X(10)        VALUE SPACES.                   
           05  FILLER          PIC X(03)        VALUE SPACES.                   
W21732     05  D1-SKU          PIC X(08)        VALUE SPACES.                   
W21732     05  FILLER          PIC X(05)        VALUE SPACES.                   
           05  D1-AREA-NUMBER  PIC 9(06)        VALUE ZEROES.                   
           05  FILLER          PIC X(05)        VALUE SPACES.                   
           05  D1-SCAN-DATE.                                                    
               10  D1-SCAN-MM  PIC X(02)        VALUE SPACES.                   
               10  FILLER      PIC X(01)        VALUE ':'.                      
               10  D1-SCAN-DD  PIC X(02)        VALUE SPACES.                   
           05  FILLER          PIC X(03)        VALUE SPACES.                   
           05  D1-SCAN-TIME.                                                    
               10  D1-TIME-HH  PIC X(02)        VALUE SPACES.                   
               10  FILLER      PIC X(01)        VALUE ':'.                      
               10  D1-TIME-MM  PIC X(02)        VALUE SPACES.                   
               10  FILLER      PIC X(01)        VALUE ':'.                      
               10  D1-TIME-SS  PIC X(02)        VALUE SPACES.                   
           05  FILLER          PIC X(06)        VALUE SPACES.                   
           05  D1-ERROR-HOLD   PIC X(54)        VALUE SPACES.                   
           05  FILLER          PIC X(08)        VALUE SPACES.                   
      *                                                                         
      *****************************************************************         
      * RECORD LAYOUT FOR INPUT FILE / OUTPUT FILE                              
      *****************************************************************         
           COPY INWS009.                                                        
                                                                                
      *****************************************************************         
      *  WORK AREA FOR FISCAL DATE SUBROUTINE.                                  
      *****************************************************************         
           COPY DPWS500.                                                        
                                                                                
      *****************************************************************         
      *  STANDARD KOHLS HEADER (132 COLUMNS)                                    
      *****************************************************************         
           COPY DPWS132O.                                                       
      *                                                                         
      *****************************************************************         
      * ERROR MESSAGE AREA FOR DB2                                              
      *****************************************************************         
           COPY DPWS004.                                                        
      *                                                                         
P28545*****************************************************************         
P28545* TINCNTL DCLGEN                                                          
P28545*****************************************************************         
P28545     EXEC SQL                                                             
P28545        INCLUDE TINCNTL                                                   
P28545     END-EXEC.                                                            
P28545                                                                          
      *****************************************************************         
      * TINVPAR DCLGEN                                                          
      *****************************************************************         
           EXEC SQL                                                             
              INCLUDE TINVPAR                                                   
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * SQL COMM AREA DCLGEN                                                    
      *****************************************************************         
           EXEC SQL                                                             
              INCLUDE SQLCA                                                     
           END-EXEC.                                                            
                                                                                
           COPY SQLCA2.                                                         
                                                                                
       01  ABEND-CODE               PIC S9(04)  VALUE ZERO                      
                                                COMP SYNC.                      
                                                                                
      /****************************************************************         
      *****************************************************************         
       PROCEDURE DIVISION.                                                      
      *****************************************************************         
                                                                                
       1000-MAIN-MODULE.                                                        
                                                                                
           PERFORM 1100-INITIALIZE.                                             
           PERFORM 4000-READ-INPUT-FILE.                                        
W33304     IF IN009-STORE-NUMBER NOT = PV-ACTV-STORE                            
W33304      AND PS-NOT-EOF-INVENTORY-FILE                                       
W33304        PERFORM 7000-ENSURE-ACTV-STORE                                    
W33304          UNTIL PS-ACTV-STORE OR PS-EOF-INVENTORY-FILE                    
W33304     END-IF.                                                              
                                                                                
      *  IF INPUT FILE IS EMPTY, STILL CREATE SORT-CARD FILES                   
      *  REFERENCED IN FOLLOWING STEPS THEN ALLOW PROGRAM TO END                
                                                                                
           IF PS-EOF-INVENTORY-FILE                                             
               WRITE OUT-OMIT-RECORD         FROM SC-SORT-RECORD                
               WRITE OUT-OMIT-RECORD         FROM SC-OMIT-FIELDS                
               WRITE OUT-OMIT-RECORD         FROM SC-INCLUDE-FIELDS-LAST        
               WRITE OUT-INCLUDE-RECORD      FROM SC-SORT-RECORD                
               WRITE OUT-INCLUDE-RECORD      FROM SC-INCLUDE-FIELDS             
               WRITE OUT-INCLUDE-RECORD      FROM SC-INCLUDE-FIELDS-LAST        
               DISPLAY '*** EMPTY INPUT FILE ***'                               
               STOP RUN                                                         
           ELSE                                                                 
               MOVE IN009-STORE-NUMBER-X TO SA-STORE-NUMBER                     
           END-IF.                                                              
                                                                                
           PERFORM 2000-PROCESS-INVENTORY-RECORDS                               
               UNTIL PS-EOF-INVENTORY-FILE.                                     
                                                                                
           PERFORM 3000-PROCESS-STORE-BREAK.                                    
                                                                                
           PERFORM 5200-WRITE-SORT-RECS.                                        
                                                                                
           PERFORM 6000-CLOSE-FILES.                                            
                                                                                
W33304     PERFORM 6001-DISPLAY-STATS.                                          
W33304                                                                          
           STOP RUN.                                                            
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       1100-INITIALIZE.                                                         
                                                                                
           OPEN INPUT  INPUT-VALID-FILE                                         
                       INPUT-CONTROL-FILE                                       
                       INPUT-STORE-FILE                                         
                OUTPUT OUT-OMIT-FILE                                            
                       OUT-INCLUDE-FILE                                         
                       OUT-MESSAGE-FILE                                         
                       ERROR-REPORT-FILE.                                       
      *                                                                         
                                                                                
           ACCEPT CPU-DATE FROM DATE.                                           
           ACCEPT IW-TIME FROM TIME.                                            
                                                                                
      *** FOR SYSTEM TEST:                                                      
      *    MOVE 941229  TO CPU-DATE.                                            
                                                                                
           MOVE CPU-MONTH  TO DP132O-RUN-MONTH                                  
                              PV-MM.                                            
           MOVE CPU-DAY    TO DP132O-RUN-DAY                                    
                              PV-DD.                                            
           MOVE CPU-YEAR   TO DP132O-RUN-YEAR                                   
                              PV-YY.                                            
           IF CPU-YEAR < 80                                                     
               MOVE '20' TO   PV-CC                                             
           ELSE                                                                 
               MOVE '19' TO   PV-CC                                             
           END-IF.                                                              
           MOVE IW-HOUR    TO DP132O-RUN-HOUR.                                  
           MOVE IW-MIN     TO DP132O-RUN-MINUTE.                                
           MOVE 'INKUT185' TO DP132O-PROGRAM-NAME.                              
           MOVE  1         TO DP132O-REPORT-NUMBER.                             
                                                                                
           MOVE 'Y'        TO PS-NUMERIC-DATE-SW                                
                              PS-NUMERIC-TIME-SW                                
                              PS-VALID-DATE-SW                                  
                              PS-VALID-TIMESTAMP-SW.                            
                                                                                
           MOVE 'N'        TO PS-END-OF-INVENTORY-SW.                           
                                                                                
           PERFORM 1200-PROCESS-CONTROL-FILE.                                   
                                                                                
           PERFORM 1300-PROCESS-STORE-FILE                                      
               VARYING PV-OVERRIDE-SUB FROM 1 BY 1                              
               UNTIL PS-END-OF-STORES-CC.                                       
                                                                                
           INITIALIZE IN009-EDITED-INVENTORY-RECORD.                            
      *                                                                         
      ****************************************************************          
      *                                                                         
      ****************************************************************          
       1200-PROCESS-CONTROL-FILE.                                               
      *                                                                         
           READ INPUT-CONTROL-FILE                                              
              INTO CC-CONTROL-TIMES                                             
               AT END                                                           
                   DISPLAY '** PROGRAM ABEND **'                                
                   DISPLAY 'INKUT185  - CONTROL FILE EMPTY'                     
                   MOVE +4003              TO ABEND-CODE                        
                   PERFORM Z999-ABEND.                                          
                                                                                
           MOVE CC-START-TIME-MIN   TO PC-START-TIME-MIN.                       
           MOVE CC-END-TIME-MAX     TO PC-END-TIME-MAX.                         
           MOVE CC-MAX-DAYS-PRIOR   TO PC-MAX-DAYS-PRIOR.                       
      ****************************************************************          
      * READ STORE FILE INTO TABLE.                                             
      ****************************************************************          
       1300-PROCESS-STORE-FILE.                                                 
      *                                                                         
           READ INPUT-STORE-FILE INTO CC-STORE                                  
               AT END                                                           
                   MOVE 'Y' TO PS-END-OF-STORES.                                
                                                                                
           IF PS-END-OF-STORES-CC                                               
               CONTINUE                                                         
           ELSE                                                                 
               IF PV-OVERRIDE-SUB > PC-MAX-OVERRIDE-STRS                        
                   MOVE +4008                 TO ABEND-CODE                     
                   DISPLAY '**  ABEND     **'                                   
                   DISPLAY '**  PROGRAM   **  =  INKUT185'                      
                   DISPLAY '**  '                                               
                   DISPLAY '**  '                                               
                   DISPLAY                                                      
                    'PGM CAN PROCESS ONLY 25 STORES'                            
                   DISPLAY '**  '                                               
                   DISPLAY '**  '                                               
                   CALL 'ILBOABN0'  USING ABEND-CODE                            
               ELSE                                                             
                   MOVE CC-STORE TO PV-OVERRIDE-STORE(PV-OVERRIDE-SUB).         
      *                                                                         
      *                                                                         
      ****************************************************************          
      *                                                                         
      *                                                                         
      *                                                                         
      ****************************************************************          
       2000-PROCESS-INVENTORY-RECORDS.                                          
                                                                                
W33304     IF PS-ACTV-STORE                                                     
W33304        PERFORM 2100-STORE-IN-PROCESS                                     
W33304     END-IF.                                                              
                                                                                
W33304* HILO - ADDED THIS LOGIC TO BYPASS NON ACTV STORES                       
W33304*        SO SHIFT +3 TO THE RIGHT AND REMOVE PERIODS                      
W33304*        AND ADD 'END-PERFORM' TO THE INNER LOOP                          
W33304*        AND ADD 'END-IF' S TO THE NESTED LOGIC                           
W33304     IF PS-ACTV-STORE                                                     
W33304        SET PS-OVERRIDE-STORE-NOT-FOUND TO TRUE                           
|             PERFORM 2700-DET-OVERRIDE-STORE                                   
|                VARYING PV-OVERRIDE-SUB FROM 1 BY 1                            
|                UNTIL PV-OVERRIDE-SUB > PC-MAX-OVERRIDE-STRS                   
|                OR PS-OVERRIDE-STORE-FOUND                                     
|                                                                               
W33304        PERFORM 2200-NUMERIC-CHECK                                        
|                                                                               
|             IF (PS-NUMERIC-DATE   AND                                         
|                 PS-NUMERIC-TIME)                                              
|                 PERFORM 2300-VALIDATE-NUMERIC-DATA                            
|             END-IF                                                            
|                                                                               
|     *--->ACTUAL TIMESTAMP EDITS OF SCANNED DATA BEGINS HERE                   
|             IF (PS-VALID-TIMESTAMP AND                                        
|                 PS-VALID-DATE)                                                
|                 AND                                                           
|                (PS-NUMERIC-DATE   AND                                         
|                 PS-NUMERIC-TIME)                                              
|                    PERFORM 2600-INVENTORY-EDITS                               
W33304        END-IF                                                            
W33304     END-IF.                                                              
                                                                                
W33304     IF PS-NOT-EOF-INVENTORY-FILE                                         
W33304        PERFORM 4000-READ-INPUT-FILE                                      
W33304     END-IF.                                                              
W33304                                                                          
W33304     IF IN009-STORE-NUMBER NOT = PV-ACTV-STORE                            
W33304      AND PS-NOT-EOF-INVENTORY-FILE                                       
W33304        SET PS-NON-ACTV-STORE TO TRUE                                     
W33304        PERFORM 7000-ENSURE-ACTV-STORE                                    
W33304          UNTIL PS-ACTV-STORE OR PS-EOF-INVENTORY-FILE                    
W33304     ELSE                                                                 
W33304        IF PS-NOT-EOF-INVENTORY-FILE                                      
W33304           ADD +1 TO PA-TOT-INV-STR-RECS                                  
W33304        END-IF                                                            
W33304     END-IF.                                                              
      *                                                                         
                                                                                
      *                                                                         
      ****************************************************************          
      * 2100-STORE-IN-PROCESS.                                                  
      *    IF NEXT STORE <> PREVIOUS STORE, DISPLAY COUNTS FOR STORE            
      *    AND DETERMINE IF ERROR MESSAGE NEEDS TO BE WRITTEN                   
      ****************************************************************          
       2100-STORE-IN-PROCESS.                                                   
                                                                                
           IF IN009-STORE-NUMBER-X NOT EQUAL SA-STORE-NUMBER                    
              PERFORM 3000-PROCESS-STORE-BREAK                                  
              ADD  +1 TO PA-INPUT-COUNT                                         
              MOVE +1 TO PA-STORE-COUNT                                         
              MOVE +0 TO PA-DATE-ERROR                                          
                         PA-DATE-TIME-ERROR                                     
                         PA-TIMESTAMP-ERROR                                     
                         PA-MESSAGE-COUNT                                       
W33304        PERFORM 7000-ENSURE-ACTV-STORE                                    
W33304          UNTIL PS-ACTV-STORE OR PS-EOF-INVENTORY-FILE                    
              MOVE IN009-STORE-NUMBER-X TO SA-STORE-NUMBER                      
           ELSE                                                                 
              ADD 1 TO PA-INPUT-COUNT                                           
                       PA-STORE-COUNT                                           
           END-IF.                                                              
                                                                                
W33304* HILO - ADDED THE 'IF' LOGIC TO BYPASS MOVES IF STORE IS NOT ACTV        
W33304*        REMOVED PERIODS AFTER THE MOVE STATEMENTS                        
W33304     IF PS-ACTV-STORE                                                     
W33304        MOVE IN009-SCAN-DTE (1:2)       TO PV-SCAN-DATE-MM                
W33304        MOVE IN009-SCAN-DTE (3:2)       TO PV-SCAN-DATE-DD                
W33304        MOVE IN009-SCAN-TIMESTAMP (1:2) TO PV-SCAN-TIME-HH                
W33304        MOVE IN009-SCAN-TIMESTAMP (3:2) TO PV-SCAN-TIME-MM                
W33304        MOVE IN009-SCAN-TIMESTAMP (5:2) TO PV-SCAN-TIME-SS                
W33304     END-IF.                                                              
      *                                                                         
      ****************************************************************          
      * VALIDATE ENTRIES ARE NUMERIC                                            
      ****************************************************************          
       2200-NUMERIC-CHECK.                                                      
      *                                                                         
      * SCAN DATE (NUMERIC CHECK)                                               
           IF IN009-SCAN-DTE IS NUMERIC                                         
              SET PS-NUMERIC-DATE TO TRUE                                       
           ELSE                                                                 
              SET PS-NON-NUMERIC-DATE    TO TRUE                                
              MOVE MSG-BAD-DATE          TO D1-ERROR-HOLD                       
              ADD 1 TO PA-DATE-ERROR                                            
              PERFORM 5100-INVALID-DATA                                         
           END-IF.                                                              
      * SCAN TIMESTAMP (NUMERIC CHECK)                                          
           IF IN009-SCAN-TIMESTAMP IS NUMERIC                                   
              SET PS-NUMERIC-TIME        TO TRUE                                
           ELSE                                                                 
              SET PS-NON-NUMERIC-TIME    TO TRUE                                
              MOVE MSG-BAD-TIME          TO D1-ERROR-HOLD                       
              ADD 1 TO PA-TIMESTAMP-ERROR                                       
              PERFORM 5100-INVALID-DATA                                         
           END-IF.                                                              
                                                                                
      *                                                                         
      ****************************************************************          
      * VALIDATE NUMERIC DATA CONTAINS A VALID ENTRY                            
      ****************************************************************          
       2300-VALIDATE-NUMERIC-DATA.                                              
      *                                                                         
      * SCAN DATE OF '0000' IS INVALID                                          
           IF (IN009-SCAN-DTE = ZERO)                                           
ALLOW *        IF (IN009-SCAN-TIMESTAMP = ZERO)                                 
ZERO  *            SET PS-INVALID-TIMESTAMP TO TRUE                             
IN    *            MOVE MSG-INV-DATE-TIME  TO D1-ERROR-HOLD                     
TIME- *            ADD 1 TO PA-DATE-TIME-ERROR                                  
STAMP *            PERFORM 5100-INVALID-DATA                                    
FIELD *        ELSE                                                             
                   SET PS-INVALID-DATE TO TRUE                                  
                   MOVE MSG-INV-DATE       TO D1-ERROR-HOLD                     
                   ADD 1 TO PA-DATE-ERROR                                       
                   PERFORM 5100-INVALID-DATA                                    
      *        END-IF                                                           
      *    ELSE                                                                 
      *        IF (IN009-SCAN-TIMESTAMP = ZERO)                                 
      *            SET PS-INVALID-TIMESTAMP TO TRUE                             
      *            MOVE MSG-INV-TIME       TO D1-ERROR-HOLD                     
      *            ADD 1 TO PA-TIMESTAMP-ERROR                                  
      *            PERFORM 5100-INVALID-DATA                                    
           END-IF.                                                              
      *                                                                         
           IF (PS-VALID-TIMESTAMP AND                                           
               PS-VALID-DATE)                                                   
               MOVE IN009-SCAN-TIMESTAMP   TO WS-SCAN-TIMESTAMP                 
               IF (WS-SCAN-TIME-HH <= 24) AND                                   
                  (WS-SCAN-TIME-MM <= 59) AND                                   
                  (WS-SCAN-TIME-SS <= 59)                                       
                  CONTINUE                                                      
               ELSE                                                             
                   SET PS-INVALID-TIMESTAMP TO TRUE                             
                   MOVE MSG-INV-TIME        TO D1-ERROR-HOLD                    
                   ADD 1 TO PA-TIMESTAMP-ERROR                                  
                   PERFORM 5100-INVALID-DATA                                    
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
           IF (PS-VALID-TIMESTAMP AND                                           
               PS-VALID-DATE)                                                   
               PERFORM 2400-CALC-SCAN-DATE.                                     
      *                                                                         
      ****************************************************************          
      * VALIDATE NUMERIC SCAN DATA MEET INVENTORY EDITS.                        
      ****************************************************************          
       2400-CALC-SCAN-DATE.                                                     
                                                                                
            IF PV-CC IS NUMERIC                                                 
               MOVE PV-CC             TO WS-DATE-CC                             
            END-IF                                                              
            IF PV-YY IS NUMERIC                                                 
               MOVE PV-YY             TO WS-DATE-YY                             
            END-IF                                                              
                                                                                
           MOVE IN009-SCAN-DTE       TO WS-SCAN-DATE.                           
                                                                                
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                       
           MOVE WS-CALENDAR-TYPE     TO  DPG51-CALENDAR-TYPE                    
           SET DPG52-LK-DTE-GREG-CC  TO  TRUE                                   
                                                                                
           MOVE  WS-SCAN-DATE-MM     TO  DPG52-GREG-CC-DATE-MO                  
           MOVE  WS-SCAN-DATE-DD     TO  DPG52-GREG-CC-DATE-DY                  
           MOVE  WS-DATE-CCYY        TO  DPG52-GREG-CC-DATE-YR                  
                                                                                
           CALL PC-CALENDAR-MODULE USING DPG51                                  
                                         DPG52                                  
                                         DPG53                                  
                                         DPG54                                  
                                         DPG55                                  
                                         DPG56                                  
           IF (DPG54-DATE-VALID                                                 
           AND DPG54-NO-ERROR)                                                  
      * RETRIEVE JULIAN DATE (CCYYDDD) OF SCAN-DATE FOR COMPARISON OF           
      * SCAN DATES AGAINST INVENTORY EDITS                                      
               MOVE DPG55-JULIAN-DATE-CCYYDDD TO WS-SCAN-JULIAN-DATE            
           ELSE                                                                 
               SET PS-INVALID-DATE     TO TRUE                                  
               MOVE MSG-INV-DATE       TO D1-ERROR-HOLD                         
               ADD 1 TO PA-DATE-ERROR                                           
               PERFORM 5100-INVALID-DATA                                        
           END-IF.                                                              
      *                                                                         
      *                                                                         
      ****************************************************************          
      * VALIDATE NUMERIC SCAN DATA MEET INVENTORY EDITS.                        
      ****************************************************************          
       2500-CALC-TINVPAR-DATE.                                                  
                                                                                
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                       
           SET DPG52-LK-DTE-ISO-FMT  TO  TRUE                                   
           MOVE WS-CALENDAR-TYPE     TO  DPG51-CALENDAR-TYPE                    
           MOVE SV-INVPAR-ACTL-INV-DATE(PV-STORE-SUB)                           
                                     TO DPG52-LK-DATE-INPUT.                    
                                                                                
      *    CALL PC-CALENDAR-MODULE USING DPG51                                  
           CALL DP500-KOHLS-CALENDAR-ROUTINE                                    
                                   USING DPG51                                  
                                         DPG52                                  
                                         DPG53                                  
                                         DPG54                                  
                                         DPG55                                  
                                         DPG56                                  
           IF (DPG54-DATE-VALID                                                 
           AND DPG54-NO-ERROR)                                                  
      * RETRIEVE JULIAN DATE (CCYYDDD) OF SCAN-DATE FOR COMPARISON OF           
      * SCAN DATES AGAINST INVENTORY EDITS                                      
               MOVE DPG55-JULIAN-DATE-CCYYDDD TO                                
                                SV-INVPAR-ACTL-JULIAN-DTE (PV-STORE-SUB)        
           ELSE                                                                 
               DISPLAY 'ACTUAL INVENTORY DATE : ',                              
                                SV-INVPAR-ACTL-INV-DATE(PV-STORE-SUB)           
               DISPLAY 'ACTUAL INVENTORY JULIAN DATE : ',                       
                                SV-INVPAR-ACTL-JULIAN-DTE (PV-STORE-SUB)        
               PERFORM Z999-ABEND                                               
           END-IF.                                                              
      *                                                                         
      *                                                                         
      ****************************************************************          
      * ENSURE SCANNED DATA MEET PHYSICAL INVENTORY GUIDELINES                  
      ****************************************************************          
       2600-INVENTORY-EDITS.                                                    
                                                                                
      * EVALUATE TIME GAPS BETWEEN ACTUAL INV DATE AND SCANNED DATA             
      *   PC-MAX-DAYS-PRIOR (+3)         PC-MAX-DAYS-AFTER (-1)                 
      *   PC-START-END-MAX  (+0500)      (IE: 5:00 AM)                          
                                                                                
           COMPUTE WS-JULIAN-DAYS-GAP  EQUAL                                    
                       ( SV-INVPAR-JULIAN-DDD (PV-STORE-SUB)                    
                         -                                                      
                         WS-JULIAN-DAY).                                        
                                                                                
      * ACTL INV START TIME PRIOR TO 5:00 AM IS NOT VALID                       
           IF WS-JULIAN-DAYS-GAP = PC-ZERO                                      
               IF IN009-SCAN-TIMESTAMP < PC-START-TIME-MIN                      
                   IF PS-OVERRIDE-STORE-NOT-FOUND                               
                       SET PS-INVALID-TIMESTAMP TO TRUE                         
                       MOVE MSG-EARLY-TIME      TO D1-ERROR-HOLD                
                       ADD 1 TO PA-TIMESTAMP-ERROR                              
                       PERFORM 5100-INVALID-DATA                                
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      * ANY DATES MORE THAN 3 DAYS BEFORE ACTL DATE IS NOT VALID                
           IF WS-JULIAN-DAYS-GAP >  PC-MAX-DAYS-PRIOR                           
               SET PS-INVALID-DATE     TO TRUE                                  
               MOVE MSG-EARLY-DATE     TO D1-ERROR-HOLD                         
               ADD 1 TO PA-DATE-ERROR                                           
               PERFORM 5100-INVALID-DATA                                        
           END-IF.                                                              
                                                                                
           IF WS-JULIAN-DAYS-GAP <= PC-MAX-DAYS-AFTER                           
      * ACTL INV START TIME PRIOR TO 5:00 AM IS NOT VALID                       
               IF WS-JULIAN-DAYS-GAP = PC-MAX-DAYS-AFTER                        
                   IF IN009-SCAN-TIMESTAMP > PC-END-TIME-MAX                    
                       SET PS-INVALID-TIMESTAMP TO TRUE                         
                       MOVE MSG-LATE-TIME       TO D1-ERROR-HOLD                
                       ADD 1 TO PA-TIMESTAMP-ERROR                              
                       PERFORM 5100-INVALID-DATA                                
                   END-IF                                                       
               ELSE                                                             
      * TIMESTAMP DATE IS PAST THE INVENTORY DATE                               
                   IF WS-JULIAN-DAYS-GAP < PC-MAX-DAYS-AFTER                    
                       SET PS-INVALID-DATE     TO TRUE                          
                       MOVE MSG-LATE-DATE      TO D1-ERROR-HOLD                 
                       ADD 1 TO PA-DATE-ERROR                                   
                       PERFORM 5100-INVALID-DATA                                
                   END-IF                                                       
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *   SEARCH OVERRIDE STORE TABLE                                           
      ******************************************************************        
       2700-DET-OVERRIDE-STORE.                                                 
                                                                                
           IF IN009-STORE-NUMBER-X = PV-OVERRIDE-STORE(PV-OVERRIDE-SUB)         
               SET PS-OVERRIDE-STORE-FOUND TO TRUE.                             
                                                                                
      *                                                                         
      *                                                                         
      *                                                                         
      ****************************************************************          
      * 3000-PROCESS-STORE-BREAK                                                
      ****************************************************************          
       3000-PROCESS-STORE-BREAK.                                                
      *WRITE A BLANK LINE TO THE ERROR REPORT                                   
            COMPUTE PA-MESSAGE-COUNT EQUAL                                      
               (PA-DATE-ERROR + PA-TIMESTAMP-ERROR + PA-DATE-TIME-ERROR)        
      *                                                                         
            DISPLAY '                                      '.                   
            DISPLAY '**************************************'.                   
            DISPLAY 'STORE NUMBER : ', SA-STORE-NUMBER                          
            DISPLAY 'ACTUAL INVENTORY DATE : ',                                 
                                   SV-INVPAR-ACTL-INV-DATE(PV-STORE-SUB)        
            DISPLAY 'INPUT RECORD COUNT : ', PA-STORE-COUNT.                    
            DISPLAY 'DATE/TIME ERRORS   : ', PA-MESSAGE-COUNT.                  
            DISPLAY '**************************************'.                   
      *                                                                         
            IF PA-MESSAGE-COUNT > 0                                             
                PERFORM 5300-WRITE-EMAIL-ENTRIES                                
W33304          MOVE PC-CE TO INVPAR-TMST-EDT-STAT-CDE                          
W24521      ELSE                                                                
W33304          MOVE PC-TP TO INVPAR-TMST-EDT-STAT-CDE                          
W24521      END-IF.                                                             
W24521      MOVE SV-INVPAR-ACTL-INV-DATE(PV-STORE-SUB) TO                       
W24521                       INVPAR-ACTL-INV-DTE.                               
W24521                                                                          
W24521      PERFORM 7200-UPDATE-TINVPAR-ROW.                                    
24029                                                                           
24029       MOVE 99                 TO PC-LINE-COUNT.                           
24029                                                                           
      ****************************************************************          
      * 4000-READ-INPUT-FILE - READS THE INPUT FILE                             
      ****************************************************************          
       4000-READ-INPUT-FILE.                                                    
                                                                                
           READ INPUT-VALID-FILE                                                
                 AT END                                                         
W33304             MOVE 'Y' TO PS-END-OF-INVENTORY-SW                           
W33304           NOT AT END                                                     
W33304             ADD +1 TO PA-TOT-RECS-READ.                                  
                                                                                
           MOVE 'Y' TO PS-NUMERIC-DATE-SW                                       
                       PS-NUMERIC-TIME-SW                                       
                       PS-VALID-DATE-SW                                         
                       PS-VALID-TIMESTAMP-SW.                                   
                                                                                
           INITIALIZE IN009-EDITED-INVENTORY-RECORD.                            
           MOVE INPUT-VALID-RECORD TO IN009-EDITED-INVENTORY-RECORD.            
                                                                                
      ****************************************************************          
      * THIS ROUTINE WILL PRODUCE THE REPORT                                    
      * HEADING IF AN ERROR REPORT IS PRODUCED.                                 
      ****************************************************************          
       5000-CREATE-HEADINGS.                                                    
                                                                                
           ADD 1 TO PC-PAGE.                                                    
           MOVE PC-PAGE TO DP132O-PAGE-NUMBER.                                  
           MOVE DP132O-STANDRD-HEADER-132-COLS TO ERROR-REPORT-RECORD.          
           WRITE ERROR-REPORT-RECORD                                            
               AFTER ADVANCING PAGE.                                            
24029                                                                           
           MOVE 1 TO PC-ADVANCE                                                 
           MOVE 2 TO PC-LINE-COUNT.                                             
           MOVE H1-HEADING TO ERROR-REPORT-RECORD.                              
           PERFORM 5500-WRITE-ERROR-LINE.                                       
24029                                                                           
  |        MOVE 2                TO PC-ADVANCE                                  
  |        MOVE SA-STORE-NUMBER  TO HHS-STORE.                                  
  |        MOVE HL-HEADING-STORE TO ERROR-REPORT-RECORD.                        
  |        PERFORM 5500-WRITE-ERROR-LINE.                                       
24029                                                                           
           MOVE 2 TO PC-ADVANCE.                                                
           MOVE H2-HEADING TO ERROR-REPORT-RECORD.                              
           PERFORM 5500-WRITE-ERROR-LINE.                                       
24029                                                                           
           MOVE H2-HEADING-DASH TO ERROR-REPORT-RECORD.                         
           PERFORM 5500-WRITE-ERROR-LINE.                                       
                                                                                
      ****************************************************************          
      * WRITE INVALID DATA TO ERROR FILE                                        
      ****************************************************************          
       5100-INVALID-DATA.                                                       
                                                                                
           IF PC-LINE-COUNT > PC-LINE-MAX                                       
               PERFORM 5000-CREATE-HEADINGS                                     
           END-IF.                                                              
                                                                                
24029 ***  MOVE IN009-STORE-NUMBER-X    TO D1-STORE-NUMBER.                     
           MOVE SV-INVPAR-ACTL-INV-DATE(PV-STORE-SUB)                           
                                       TO D1-ACTL-INV-DTE.                      
W21732     MOVE IN009-SKU              TO D1-SKU.                               
           MOVE IN009-AREA-NUMBER      TO D1-AREA-NUMBER.                       
           MOVE PV-SCAN-DATE           TO D1-SCAN-DATE.                         
           MOVE PV-TIMESTAMP           TO D1-SCAN-TIME.                         
                                                                                
           MOVE D1-DETAIL TO ERROR-REPORT-RECORD.                               
           MOVE 1 TO PC-ADVANCE.                                                
           PERFORM 5500-WRITE-ERROR-LINE.                                       
                                                                                
           PERFORM 5200-WRITE-SORT-RECS.                                        
      *                                                                         
      *    PERFORM 5300-WRITE-EMAIL-ENTRIES.                                    
      *                                                                         
      *                                                                         
      ****************************************************************          
      * WRITE STORE NUMBER TO SORT DATASETS                                     
      ****************************************************************          
       5200-WRITE-SORT-RECS.                                                    
                                                                                
           IF PS-FIRST-SORT-REC                                                 
               WRITE OUT-OMIT-RECORD         FROM SC-SORT-RECORD                
               WRITE OUT-OMIT-RECORD         FROM SC-OMIT-FIELDS                
               WRITE OUT-INCLUDE-RECORD      FROM SC-SORT-RECORD                
               WRITE OUT-INCLUDE-RECORD      FROM SC-INCLUDE-FIELDS             
               MOVE IN009-STORE-NUMBER-X     TO PV-HOLD-SORT-STORE              
      *        MOVE IN009-STORE-NUMBER       TO PV-HOLD-SORT-STORE              
               SET PS-NOT-FIRST-SORT-REC     TO TRUE                            
                   IF PS-EOF-INVENTORY-FILE                                     
                       WRITE OUT-OMIT-RECORD                                    
                                             FROM SC-INCLUDE-FIELDS-LAST        
                       WRITE OUT-INCLUDE-RECORD                                 
                                             FROM SC-INCLUDE-FIELDS-LAST        
                       WRITE OUT-OMIT-RECORD     FROM SC-SORT-RECORD-END        
                       WRITE OUT-INCLUDE-RECORD  FROM SC-SORT-RECORD-END        
                   ELSE                                                         
                       MOVE IN009-STORE-NUMBER-X TO SC-SORT-STR                 
      *                MOVE IN009-STORE-NUMBER   TO SC-SORT-STR                 
                                                    PV-HOLD-SORT-STORE          
                       WRITE OUT-OMIT-RECORD     FROM SC-SORT-STORES            
                       WRITE OUT-INCLUDE-RECORD  FROM SC-SORT-STORES            
                   END-IF                                                       
           ELSE                                                                 
               IF PS-EOF-INVENTORY-FILE                                         
                   WRITE OUT-OMIT-RECORD                                        
                                         FROM SC-INCLUDE-FIELDS-LAST            
                   WRITE OUT-INCLUDE-RECORD                                     
                                         FROM SC-INCLUDE-FIELDS-LAST            
                   WRITE OUT-OMIT-RECORD     FROM SC-SORT-RECORD-END            
                   WRITE OUT-INCLUDE-RECORD  FROM SC-SORT-RECORD-END            
               ELSE                                                             
                   IF IN009-STORE-NUMBER-X EQUAL PV-HOLD-SORT-STORE             
      *            IF IN009-STORE-NUMBER   EQUAL PV-HOLD-SORT-STORE             
                       CONTINUE                                                 
                   ELSE                                                         
                       MOVE IN009-STORE-NUMBER-X TO SC-SORT-STR                 
      *                MOVE IN009-STORE-NUMBER   TO SC-SORT-STR                 
                                                    PV-HOLD-SORT-STORE          
                       WRITE OUT-OMIT-RECORD     FROM SC-SORT-STORES            
                       WRITE OUT-INCLUDE-RECORD  FROM SC-SORT-STORES            
                   END-IF                                                       
           END-IF.                                                              
                                                                                
           SET PS-NOT-FIRST-SORT-REC      TO TRUE.                              
      *                                                                         
      *                                                                         
      ****************************************************************          
      * CREATE EMAIL MESSAGE IF TIMESTAMP ERRORS WERE FOUND FOR STORE.          
      * WRITE MESSAGE FOR STORE IN-ERROR WHEN INPUT STORE CHANGES.              
      ****************************************************************          
       5300-WRITE-EMAIL-ENTRIES.                                                
                                                                                
           IF PA-MESSAGE-COUNT = 0                                              
               CONTINUE                                                         
           ELSE                                                                 
               IF PS-FIRST-EMAIL-REC                                            
                   WRITE OUT-MESSAGE-RECORD    FROM PV-MESSAGE-HEADER1          
                   WRITE OUT-MESSAGE-RECORD    FROM PV-MESSAGE-HEADER2          
                   MOVE  SA-STORE-NUMBER       TO   PV-MESSAGE-STR              
                   MOVE  PA-MESSAGE-COUNT      TO   PV-MESSAGE-COUNT            
                   WRITE OUT-MESSAGE-RECORD    FROM PV-MESSAGE-DETAIL           
                   MOVE 'N' TO PS-FIRST-EMAIL-SW                                
               ELSE                                                             
                   MOVE  SA-STORE-NUMBER       TO   PV-MESSAGE-STR              
                   MOVE  PA-MESSAGE-COUNT      TO   PV-MESSAGE-COUNT            
                   WRITE OUT-MESSAGE-RECORD    FROM PV-MESSAGE-DETAIL           
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      *                                                                 10150000
      ****************************************************************  10160000
      * 5500-WRITE-ERROR-LINE.  ERROR REPORT LINES WRITTEN              10170000
      ****************************************************************  10180000
       5500-WRITE-ERROR-LINE.                                           10190000
                                                                        10200000
           WRITE ERROR-REPORT-RECORD                                    10210000
               AFTER ADVANCING PC-ADVANCE.                              10220000
           ADD PC-ADVANCE TO PC-LINE-COUNT.                             10230000
      *                                                                 10240000
      *                                                                         
      ****************************************************************          
      * 6000-CLOSE-FILES.                                                       
      ****************************************************************          
       6000-CLOSE-FILES.                                                        
                                                                                
           CLOSE  INPUT-VALID-FILE                                              
                  INPUT-CONTROL-FILE                                            
                  OUT-OMIT-FILE                                                 
                  OUT-INCLUDE-FILE                                              
                  OUT-MESSAGE-FILE                                              
                  ERROR-REPORT-FILE.                                            
      *                                                                         
W33304****************************************************************          
W33304* DISPLAY THE PROGRAM ACCUMULATORS FOR BYPASSED DEL STR RECS              
W33304****************************************************************          
W33304 6001-DISPLAY-STATS.                                                      
W33304                                                                          
W33304     DISPLAY '***************************************'                    
W33304     DISPLAY '** INKUT185 SUMMARY STATISTICS FOR   **'                    
W33304     DISPLAY '**        NON ACTIV STORES           **'                    
W33304     DISPLAY '***************************************'                    
W33304     DISPLAY '** TOT INV STR RECS.:' PA-TOT-INV-STR-RECS                  
W33304     DISPLAY '** TOT RECS BYPASSED:' PA-TOT-NON-ACTV-STR-RECS-BYP         
W33304     DISPLAY '** TOT RECS READ....:' PA-TOT-RECS-READ                     
W33304     DISPLAY '***************************************'.                   
W33304                                                                          
W33304*****************************************************************         
W33304*                                                                         
W33304*****************************************************************         
W33304 7000-ENSURE-ACTV-STORE.                                                  
W33304                                                                          
W33304     MOVE IN009-STORE-NUMBER     TO INVPAR-LOC-NBR.                       
W33304                                                                          
W33304     EXEC SQL                                                             
W33304          SELECT A.ACTL_INV_DTE                                           
W33304                ,A.INV_ID                                                 
W33304            INTO :INVPAR-ACTL-INV-DTE                                     
W33304                ,:INVPAR-INV-ID                                           
W33304            FROM TINVPAR A,                                               
W33304                 TINCNTL B                                                
W33304            WHERE B.ACTV_IND = 'Y'                                        
W33304              AND A.INV_ID = B.INV_ID                                     
W33304              AND LOC_NBR = :INVPAR-LOC-NBR                               
W33304              AND A.LOC_INV_STAT_CDE = 'IN'                               
W33304            AND ACTL_FIN_BK_DTE = :PC-EMPTY-DATE                          
W33304     END-EXEC.                                                            
W33304                                                                          
W33304     EVALUATE TRUE                                                        
W33304         WHEN SQLCODE = 0                                                 
W33304             SET PS-ACTV-STORE TO TRUE                                    
W33304             ADD +1 TO PA-TOT-INV-STR-RECS                                
W33304             MOVE IN009-STORE-NUMBER TO PV-ACTV-STORE                     
W33304             PERFORM 7100-VALIDATE-TINVPAR-DATES                          
W33304         WHEN SQLCODE = +100                                              
W33304             PERFORM 7010-CHECK-FOR-NON-ACTV-STR                          
W33304         WHEN SQLWARN NOT = SPACES                                        
W33304         WHEN SQLCODE NOT = ZERO                                          
W33304             DISPLAY '****************************************'           
W33304             DISPLAY '*** STORE NBR   : ' IN009-STORE-NUMBER-X            
W33304             DISPLAY '*** ACTL-FIN-BK-DTE HAS ALREADY OCCURRED'           
W33304             DISPLAY '****************************************'           
W33304             MOVE '7000-ENSURE-ACTV-STORE'                                
W33304                           TO  PV-PARAGRAPH-NAME                          
W33304             MOVE 'RETRIEVE TINVPAR ACTUAL INV DATE'                      
W33304                           TO  PV-DB2-OPER-ATTEMPTED                      
W33304             PERFORM 9900-SQL-ABEND                                       
W33304     END-EVALUATE.                                                        
W33304*                                                                         
W33304*****************************************************************         
W33304*  CHECK TO SEE IF THE STORE MAY BE SOFT DELETED IN ANOTHER               
W33304*  CYCLE. IN ORDER TO CONTINUE PROCESSING, THE STORE SHOULD BE            
W33304*  ACTIVE IN THE CYCLE - MEANING LOC_INV_STAT_CDE = 'IN' AND              
W33304*  ACTL_FIN_BK_DTE = '9999-09-09'. ANY OTHER COMBINATION OF               
W33304*  LOC_INV_STAT_CDE & ACTL_FIN_BK_DTE MEANS THAT THE STORE REC            
W33304*  SHOULD NOT BE PASSED ON FOR FURTHER PROCESSING.                        
W33304*****************************************************************         
W33304 7010-CHECK-FOR-NON-ACTV-STR.                                             
W33304                                                                          
W33304     MOVE IN009-STORE-NUMBER     TO INVPAR-LOC-NBR.                       
W33304                                                                          
W33304     PERFORM WITH TEST AFTER                                              
W33304             VARYING PV-RETRY-COUNTER FROM 1 BY 1                         
W33304             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR                 
W33304                     SQLCODE = ZERO OR                                    
W33304                     SQLCODE = +100 OR                                    
W33304                     SQLCODE = -811                                       
W33304                                                                          
W33304     EXEC SQL                                                             
W33304          SELECT A.ACTL_INV_DTE                                           
W33304                ,A.INV_ID                                                 
W33304           INTO :INVPAR-ACTL-INV-DTE                                      
W33304               ,:INVPAR-INV-ID                                            
W33304            FROM TINVPAR A,                                               
W33304                 TINCNTL B                                                
W33304            WHERE B.ACTV_IND = 'Y'                                        
W33304              AND A.INV_ID     = B.INV_ID                                 
W33304              AND A.LOC_NBR    = :INVPAR-LOC-NBR                          
W33304              AND ((A.LOC_INV_STAT_CDE <> 'IN'                            
W33304              AND A.ACTL_FIN_BK_DTE = :PC-EMPTY-DATE)                     
W33304               OR (A.LOC_INV_STAT_CDE = 'IN'                              
W33304              AND A.ACTL_FIN_BK_DTE <> :PC-EMPTY-DATE))                   
W33304     END-EXEC                                                             
W33304                                                                          
W33304        EVALUATE TRUE                                                     
W33304         WHEN SQLCODE = 0 OR                                              
W33304              SQLCODE = -811                                              
W33304             SET PS-NON-ACTV-STORE TO TRUE                                
W33304             MOVE IN009-STORE-NUMBER TO PV-NON-ACTV-STORE                 
W33304             DISPLAY '------------------------------------'               
W33304             DISPLAY 'BYPASS NON ACTV STORE: ' INVPAR-LOC-NBR             
W33304             DISPLAY '------------------------------------'               
W33304             ADD +1 TO PA-TOT-NON-ACTV-STR-RECS-BYP                       
W33304             PERFORM 7020-BYPASS-NON-ACTV-STR-RECS                        
W33304             UNTIL IN009-STORE-NUMBER NOT = PV-NON-ACTV-STORE             
W33304                OR PS-EOF-INVENTORY-FILE                                  
W33304             MOVE ZEROES TO PV-NON-ACTV-STORE                             
W33304         WHEN SQLCODE = +100                                              
W33304* WHEN THIS 7010- PARAGRAPH IS EXECUTED BECAUSE THE LOC_NBR               
W33304* CHANGES DURING AN INPUT FILE READ, THIS SWITCH IS NECESSARY             
W33304* TO BREAK OUT OF THE PARAGRAPH AND SIGNAL THAT IT IS OK TO               
W33304* CONTINUE PROCESSING THIS LOCATION                                       
W33304             SET PS-ACTV-STORE TO TRUE                                    
W33304         WHEN OTHER                                                       
W33304             CONTINUE                                                     
W33304        END-EVALUATE                                                      
W33304     END-PERFORM.                                                         
W33304                                                                          
W33304     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
W33304         SQLCODE NOT = ZERO AND                                           
W33304         SQLCODE NOT = +100 AND                                           
W33304         SQLCODE NOT = -811                                               
W33304         DISPLAY '***********************************************'        
W33304         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO         *'        
W33304         DISPLAY '** SELECT FROM TINVPAR / TINCNTL              *'        
W33304         DISPLAY '** PARAGRAPH = 7010-CHECK-FOR-NON-ACTV-STR    *'        
W33304         DISPLAY '** TINVPAR LOC ' INVPAR-LOC-NBR                         
W33304         DISPLAY '***********************************************'        
W33304         PERFORM 9900-SQL-ABEND                                           
W33304     END-IF.                                                              
W33304*                                                                         
W33304*****************************************************************         
W33304* READ THE INPUT TO BYPASS RECS WHOSE LOC_NBR IS A NON ACTV STR.          
W33304*****************************************************************         
W33304 7020-BYPASS-NON-ACTV-STR-RECS.                                           
W33304                                                                          
W33304     PERFORM 7030-READ-INPUT.                                             
W33304     IF IN009-STORE-NUMBER = PV-NON-ACTV-STORE                            
W33304        ADD +1 TO PA-TOT-NON-ACTV-STR-RECS-BYP                            
W33304     END-IF.                                                              
W33304                                                                          
W33304     IF NOT PS-EOF-INVENTORY-FILE                                         
W33304        ADD +1 TO PA-TOT-RECS-READ                                        
W33304     END-IF.                                                              
W33304                                                                          
W33304******************************************************************INKUT169
W33304*                                                                *INKUT169
W33304*    READ THE INPUT FILE.                                        *INKUT169
W33304*                                                                *INKUT169
W33304******************************************************************INKUT169
W33304 7030-READ-INPUT.                                                 INKUT169
W33304                                                                  INKUT169
W33304     INITIALIZE IN009-EDITED-INVENTORY-RECORD.                            
W33304                                                                          
W33304     READ INPUT-VALID-FILE INTO IN009-EDITED-INVENTORY-RECORD             
W33304           AT END                                                         
W33304             MOVE 'Y' TO PS-END-OF-INVENTORY-SW                           
W33304     END-READ.                                                    INKUT169
W33304                                                                  INKUT169
      *****************************************************************         
      * ALL STORES ON FILE MUST MATCH ACTL INV DATE FROM FIRST STORE            
      * IF THEY DON'T - ABEND, WRITE STORE #, ACTL-INV-DATE TO SYSOUT           
      *****************************************************************         
       7100-VALIDATE-TINVPAR-DATES.                                             
      *                                                                 10240000
           ADD +1 TO PV-STORE-SUB .                                             
           MOVE IN009-STORE-NUMBER-X TO                                         
                                 SV-INVPAR-STORE(PV-STORE-SUB).                 
           MOVE INVPAR-ACTL-INV-DTE  TO                                         
                                 SV-INVPAR-ACTL-INV-DATE(PV-STORE-SUB).         
      *                                                                 10240000
           IF INVPAR-ACTL-INV-DTE EQUAL SV-INVPAR-ACTL-INV-DATE (1)     10240000
               CONTINUE                                                 10240000
           ELSE                                                         10240000
               MOVE PV-STORE-SUB    TO  PV-STORE-IN-PROCESS             10240000
               PERFORM                                                          
                  VARYING PV-STORE-SUB FROM 1 BY 1                              
                     UNTIL PV-STORE-SUB > PV-STORE-IN-PROCESS                   
      *                                                                         
                  DISPLAY 'STORE NUMBER : ',                                    
                           SV-INVPAR-STORE(PV-STORE-SUB),                       
                          'ACTL-INV-DTE : ',                                    
                           SV-INVPAR-ACTL-INV-DATE(PV-STORE-SUB)                
               END-PERFORM                                                      
      *                                                                         
               DISPLAY '***                                       '             
               DISPLAY '******************************************'             
               MOVE '7100-VALIDATE-TINVPAR-DATES'                               
                                 TO  PV-PARAGRAPH-NAME                          
               MOVE 'STORES ON FILE HAVE DIFFERENT ACTUAL INV DATES'            
                                 TO  PV-DB2-OPER-ATTEMPTED                      
               PERFORM 9900-SQL-ABEND                                           
           END-IF.                                                      10240000
      *                                                                 10240000
           PERFORM 2500-CALC-TINVPAR-DATE.                              10240000
      *                                                                         
      *                                                                 10240000
W24521*****************************************************************         
W24521* DB2 INVENTORY PARAMETERS TABLE TO RETRIEVE STORES ACT INV DATE          
W24521*****************************************************************         
W24521 7200-UPDATE-TINVPAR-ROW.                                                 
W26600                                                                          
W26600*    MOVE IN009-STORE-NUMBER     TO INVPAR-LOC-NBR.                       
W33304     MOVE SA-STORE-NUMBER        TO INVPAR-LOC-NBR.                       
W24521                                                                          
W24521     PERFORM WITH TEST AFTER                                              
W24521         VARYING PV-SQL-SUB                                               
W24521             FROM 1 BY 1                                                  
W24521             UNTIL (PV-SQL-SUB > PV-MAX-RETRIES) OR                       
W24521                 (SQLCODE = 0)                                            
W24521                                                                          
W24521         EXEC SQL                                                         
W24521             UPDATE TINVPAR                                               
W24521             SET TMST_EDT_STAT_CDE = :INVPAR-TMST-EDT-STAT-CDE            
W24521             WHERE LOC_NBR         = :INVPAR-LOC-NBR                      
P28545             AND INV_ID            = :INVPAR-INV-ID                       
W24521             AND ACTL_INV_DTE      = :INVPAR-ACTL-INV-DTE                 
W24521         END-EXEC                                                         
W24521                                                                          
W24521         EVALUATE TRUE                                                    
W24521             WHEN SQLCODE = ZERO                                          
W24521                 DISPLAY 'TINVPAR.TSMT_EDT_STAT_CDE UPDATED TO '          
W24521                         INVPAR-TMST-EDT-STAT-CDE ' FOR STORE '           
W24521                         SA-STORE-NUMBER                                  
W24521             WHEN SQLWARN0 NOT = SPACES                                   
W24521             WHEN SQLCODE LESS ZERO                                       
W24521             WHEN SQLCODE GREATER ZERO                                    
W33304              DISPLAY 'INVPAR-LOC-NBR.......:' INVPAR-LOC-NBR             
W33304              DISPLAY 'INVPAR-INV-ID........:' INVPAR-INV-ID              
W33304              DISPLAY 'INVPAR-ACTL-INV-DTE..:' INVPAR-ACTL-INV-DTE        
W24521                 MOVE '7200-UPDATE-TINVPAR-ROW'                           
W24521                     TO PV-PARAGRAPH-NAME                                 
W24521                 MOVE 'UPDATE TINVPAR ROW'                                
W24521                     TO PV-DB2-OPER-ATTEMPTED                             
W24521                 PERFORM 9900-SQL-ABEND                                   
W24521         END-EVALUATE                                                     
RM0121                                                                          
RM0121     EXEC SQL                                                             
RM0121         COMMIT                                                           
RM0121     END-EXEC                                                             
RM0121                                                                          
W24521     END-PERFORM.                                                         
W24521                                                                          
W24521     IF PV-SQL-SUB GREATER PV-MAX-RETRIES                                 
W24521         MOVE 'UPDATE-TINVPAR-ROW' TO PV-PARAGRAPH-NAME                   
W24521         MOVE 'EXCEEDED MAX RETRIES' TO PV-DB2-OPER-ATTEMPTED             
W24521         PERFORM 9900-SQL-ABEND                                           
W24521     END-IF.                                                              
W24521                                                                          
      *                                                                         
      ****************************************************************  10250000
      *    THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.        *  10260000
      ****************************************************************  10270000
       9900-SQL-ABEND.                                                  10280000
      *                                                                 10290000
           MOVE +4013                 TO ABEND-CODE.                    10300000
           DISPLAY '**  ABEND     **'.                                  10310000
           DISPLAY '**  PROGRAM   **  =  INKUT185'.                     10320000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            10330000
           DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        10340000
      *                                                                 10350000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         10360000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        10370000
      *                                                                 10380000
           COPY DPPD004.                                                10390001
      *                                                                 10400000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           10410000
      *                                                                 10420000
       Z999-ABEND.                                                              
                                                                                
           CALL 'ILBOABN0'             USING ABEND-CODE.                        
                                                                                
