000100 IDENTIFICATION DIVISION.                                         00010018
000200 PROGRAM-ID.         SUKCS769.                                    00020018
000300 AUTHOR.             R DELAURA.                                   00030018
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040018
000500 DATE-WRITTEN.       OCTOBER 2008.                                00050018
000600*                                                                 00060018
000700******************************************************************00070018
000800*              COMMON CARTON CLOSE SUBPROGRAM  (CICS)             00080018
000900*                                                                 00090018
001000* THIS PROGRAM WILL RECEIVE PARAMETERS FROM CALLING PROGRAM(S)    00100018
001100* AND ISSUE DIRECTIVE REQUESTS TO THE DIRECTIVE GENERATOR         00110018
001200* (SUKUT129).                                                     00120018
001300*                                                                 00130018
001400* CALLING PROGRAMS: SUKRF509 CARTON AUDIT ASSOCIATION             00140018
001500*                   SUKRF511 CARTON OPEN                          00150018
001600*                   SUKRF512 CARTON CONTINUATION                  00160018
001700*                   SUKRF515 AUDIT CARTON CLOSE                   00170018
001800*                   SUKRF536 AUDIT STATUS                         00180018
001900*                                                                 00190018
002000******************************************************************00200018
002100                                                                  00210018
002200 ENVIRONMENT DIVISION.                                            00220018
002300 CONFIGURATION SECTION.                                           00230018
002400 SOURCE-COMPUTER.    IBM-3090.                                    00240018
002500 OBJECT-COMPUTER.    IBM-3090.                                    00250018
002600                                                                  00260018
002700 DATA DIVISION.                                                   00270018
002800/                                                                 00280018
002900 WORKING-STORAGE SECTION.                                         00290018
003000                                                                  00300018
003100 01  WS-PGM-NAME                       PIC X(08)     VALUE        00310018
003200                       'SUKCS769'.                                00320018
003300 01  WS-DDG-PGM-NAME                   PIC X(08)     VALUE        00330018
003400                       'SUKUT129'.                                00340018
003500                                                                  00350018
003600 01  DK-DATABASE-KEYS.                                            00360018
003700     05  DK-OPER-UNT-ID                PIC S9(4)  COMP   VALUE +0.00370018
003800     05  DK-SHIPT-UNT-ID               PIC S9(18) COMP-3 VALUE  0.00380018
003810     05  DK-AUD-CNTL-NBR               PIC  S9(9) COMP.           00381018
003900                                                                  00382018
004000 01  WS-SWITCHES.                                                 00383018
004100     05  WS-ERROR-FOUND-SW             PIC X(01)     VALUE ' '.   00384018
004200         88  WS-ERROR-FOUND                          VALUE 'Y'.   00385018
004210     05  WS-PRIOR-DIRV-FOUND-SW        PIC X(01)     VALUE 'Y'.   00386018
004220         88  WS-PRIOR-DIRV-FOUND                     VALUE 'Y'.   00387018
014400     05  WS-FAILED-AUDITS-FOUND-SW       PIC  X(01)  VALUE 'N'.   00387118
014500         88  WS-RF-AUDITS-FOUND                      VALUE 'Y'.   00387218
014600         88  WS-NO-RF-AUDITS-FOUND                   VALUE 'N'.   00387318
014400     05  WS-QC-AUDITS-FOUND-SW           PIC  X(01)  VALUE 'N'.   00387418
014500         88  WS-QC-AUDITS-FOUND-YES                  VALUE 'Y'.   00387518
014600         88  WS-QC-AUDITS-FOUND-NO                   VALUE 'N'.   00387618
004300/                                                                 00387718
004400 01  WS-AUTO-CONVEYOR-PARAMETERS.                                 00387818
004500     05  WS-AUTOCY-DIRECTIVE-MODE      PIC X(01)     VALUE SPACES.00387918
004600         88  ALL-CARTONS-DIRECTIVES-MODE             VALUE 'A'.   00388018
004700         88  EXCEPTION-DIRECTIVES-MODE               VALUE 'E'.   00389018
004800         88  NO-DIRECTIVES-MODE                      VALUE 'N'.   00390018
004810     05  WS-DIRV-RSN-CDE               PIC   X(3)    VALUE SPACES.00400018
004900/                                                                 00410018
005000 01  PV-AREA.                                                     00420018
005100     05  PV-CICS-MSG-AREA.                                        00430018
005200         10  FILLER                    PIC X(19)     VALUE        00440018
005300                       'SUKCS769 CALLED BY '.                     00450018
005400         10  PV-MSG-PGM                PIC X(08)     VALUE SPACES.00460018
005500         10  PV-ERROR-TYPE             PIC X(14)     VALUE SPACES.00470018
005600             88  PV-PARM-ERROR                       VALUE        00480018
005700                       '  PARM ERROR: '.                          00490018
005800             88  PV-DB2-ERROR                        VALUE        00500018
005900                       '   DB2 ERROR: '.                          00510018
006000             88  PV-MQ-ERROR                         VALUE        00520018
006100                       '    MQ ERROR: '.                          00530018
006200             88  PV-OTHER-ERROR                      VALUE        00540018
006300                       ' OTHER ERROR: '.                          00550018
006400         10  PV-ERROR-DESC             PIC X(59)     VALUE SPACES.00560018
006500     05  PV-CICS-RESPONSE              PIC S9(08)    VALUE ZEROS  00570018
006600                                                     COMP SYNC.   00580018
006700     05  PV-COMMAREA-LENGTH            PIC S9(04)    VALUE ZERO   00590018
006800                                                     COMP SYNC.   00600018
006700     05  PV-RFID-AUDIT-CNTRL-NBR       PIC  S9(9) COMP.           00610018
006700     05  PV-RFID-AUDIT-STAT-CDE        PIC   X(1).                00620018
006900/                                                                 00630018
007000******************************************************************00640018
007100*    DIRECTIVE GENERATOR REQUEST COMMUNICATION AREA               00650018
007200******************************************************************00660018
007300     COPY SUWS090.                                                00670018
007400/                                                                 00680018
007500******************************************************************00690018
007600*    COMMON CARTON CLOSE COMMUNICATION AREA                       00700018
007700******************************************************************00710018
007800     COPY SUWS091.                                                00720018
007900/                                                                 00730018
008000******************************************************************00740018
008100*  COMMUNICATIONS AREA FOR DB2                                    00750018
008200******************************************************************00760018
008300     EXEC SQL                                                     00770018
008400          INCLUDE SQLCA                                           00780018
008500     END-EXEC.                                                    00790018
008600                                                                  00800018
008700     COPY SQLCA2.                                                 00810018
008800/                                                                 00820018
008900******************************************************************00830018
009000*  DB2 DECLARATION - CARTON DIRECTIVE TRACKING TABLE              00840018
009100*      TABLE (SUT_CART_DIRV_TRKG)                                 00850018
009200******************************************************************00860018
009300     EXEC SQL                                                     00870018
009400         INCLUDE SUT00102                                         00880018
009500     END-EXEC.                                                    00890018
009600/                                                                 00900018
009700******************************************************************00910018
008900******************************************************************00920018
009000*  DB2 DECLARATION - CARTON DIRECTIVE TRACKING TABLE              00921018
009100*      TABLE (SUT_PO_AUD_REQ )                                    00922018
009200******************************************************************00923018
009300     EXEC SQL                                                     00924018
009400         INCLUDE SUT00015                                         00925018
009500     END-EXEC.                                                    00926018
009600/                                                                 00927018
009700******************************************************************00928018
009800*  DB2 DECLARATION - PARAMETER TABLE                              00929018
009900*      TABLE (TKRPRPM)                                            00930018
010000******************************************************************00940018
010100     EXEC SQL                                                     00950018
010200         INCLUDE TKRPRPM                                          00960018
010300     END-EXEC.                                                    00970018
010400/                                                                 00980018
010500******************************************************************00990018
010600*  DB2 DECLARATION - SHIPPING UNIT CROSS REFERENCE TABLE          01000018
010700*      TABLE (TSULBXF)                                            01010018
010800******************************************************************01020018
010900     EXEC SQL                                                     01030018
011000         INCLUDE TSULBXF                                          01040018
011100     END-EXEC.                                                    01050018
011200/                                                                 01060018
011300 LINKAGE SECTION.                                                 01070018
011400                                                                  01080018
011500  01  DFHCOMMAREA.                                                01090018
011600      05  FILLER                     OCCURS  1 TO 4072 TIMES      01100018
011700                                     DEPENDING ON EIBCALEN.       01110018
011800          10  FILLER                   PIC X(01).                 01120018
011900                                                                  01130018
012000/                                                                 01140018
012100***************************************************************   01150018
012200 PROCEDURE DIVISION.                                              01160018
012300***************************************************************   01170018
012400 0000-MAINLINE.                                                   01180018
012500                                                                  01190018
012600     MOVE DFHCOMMAREA       TO CCC-REQUEST-COMMUNICATION-AREA.    01200018
012700     MOVE SU091-CALLING-PGM TO PV-MSG-PGM                         01210018
012800     PERFORM 1000-VALIDATE-CCC-REQUEST.                           01220018
012900                                                                  01230018
013000     IF ( WS-ERROR-FOUND )                                        01240018
013100         SET  PV-PARM-ERROR     TO TRUE                           01250018
013200         PERFORM 9999-WRITE-CSSL-MSG                              01260018
013300         MOVE '01'        TO SU091-RET-CODE                       01270018
013400         MOVE WS-PGM-NAME TO SU091-ERR-PROGRAM                    01280018
013500         MOVE '1000-'     TO SU091-ERR-PARAGRAPH                  01290018
013600         PERFORM 9999-CICS-RETURN                                 01300018
013700     END-IF.                                                      01310018
013800                                                                  01320018
013900     PERFORM 1010-SEL-AUTO-DIRECTIVE.                             01330018
014000                                                                  01340018
014100     IF ( WS-ERROR-FOUND )                                        01350018
014200         SET  PV-DB2-ERROR TO TRUE                                01360018
014300         MOVE SQLCODE      TO SQLCODE2                            01370018
014400         STRING '** DB2 ERROR - PARA 1010- SQLCODE = :' SQLCODE2  01380018
014500           DELIMITED BY SIZE INTO PV-ERROR-DESC                   01390018
014600         PERFORM 9999-WRITE-CSSL-MSG                              01400018
014700         MOVE '02'        TO SU091-RET-CODE                       01410018
014800         MOVE WS-PGM-NAME TO SU091-ERR-PROGRAM                    01420018
014900         MOVE '1010-'     TO SU091-ERR-PARAGRAPH                  01430018
015000         PERFORM 9999-CICS-RETURN                                 01440018
015100     END-IF.                                                      01450018
015200                                                                  01460018
015300     IF ( NO-DIRECTIVES-MODE )                                    01470018
015400         MOVE '00'        TO SU091-RET-CODE                       01480018
015500         PERFORM 9999-CICS-RETURN                                 01490018
015600     END-IF.                                                      01500018
015700                                                                  01510018
015800     INITIALIZE DCLSUT00102.                                      01520018
015900     INITIALIZE DCLTSULBXF.                                       01530018
016000     SET WS-NO-RF-AUDITS-FOUND  TO TRUE                           01540018
                                                                        01550018
016100     IF ( SU091-SHIPT-UNT-ID > ZERO )                             01560018
016200         PERFORM 1020-SEL-CARTON-DIRECTIVE                        01570018
016300         IF ( WS-ERROR-FOUND )                                    01580018
016400             SET  PV-DB2-ERROR TO TRUE                            01590018
016500             MOVE SQLCODE      TO SQLCODE2                        01600018
016600             STRING '** DB2 ERROR - PARA 1020- SQLCODE = :'       01610018
016700                    SQLCODE2                                      01620018
016800               DELIMITED BY SIZE INTO PV-ERROR-DESC               01630018
016900             PERFORM 9999-WRITE-CSSL-MSG                          01640018
017000             MOVE '02'        TO SU091-RET-CODE                   01650018
017100             MOVE WS-PGM-NAME TO SU091-ERR-PROGRAM                01660018
017200             MOVE '1020-'     TO SU091-ERR-PARAGRAPH              01670018
017300             PERFORM 9999-CICS-RETURN                             01680018
017400         END-IF                                                   01690018
017500     END-IF.                                                      01700018
017600                                                                  01710018
017601**** WE ALWAYS ASSUME DIRECTIVES WILL BE SENT, SO THE SWITCH      01720018
017602**** WS-PRIOR-DIRV-FOUND IS DEFAULTED TO 'Y'. IF WE ARE HERE      01730018
017603**** BECAUSE WE ARE SENDING A CARTON-LEVEL DIRECTIVE, PARAGRAPH   01740018
017604**** 1020 WILL HAVE RESET THE SWITCH IF NO PRIOR DIRECTIVES       01750018
017605**** WERE SENT, AND WE WILL NOT GENERATE DIRECTIVES. BUT, IF WE   01760018
017606**** ARE HERE BECAUSE WE ARE SENDING AUDIT GROUP LEVEL DIRECTIVES 01760118
017607**** ASSUMING PRIOR DIRECTIVES WERE FOUND WILL CAUSE THE          01760218
017608**** GENERATION OF DIRECTIVES FOR THE AUDIT GROUP.                01760318
017609                                                                  01760418
      ******************************************************************01760518
      *  MANUAL AUDITS FOR COMBO AUDIT                      *           01760618
      *  PROMPTED AUDITS THAT FAIL RECEIVE AN 'AUR' FAIL DIRECTIVE      01760718
      *  WHEN A MANUAL AUDIT IS PERFORMED, A 'RLC' DIRECTIVE IS         01760818
      *  SENT TO RELEASE THE CARTON                                     01760918
      *  IF AN RFID AUDIT IS PENDING OR FAILED, SEND A 'AUU' FOR        01761018
      *  A PENDING RFID AUDIT, OR "RFD" DIRECTIVE FOR A FAILED          01761118
      *  RFID AUDIT                                                     01761218
      ******************************************************************01761318
017610     IF WS-PRIOR-DIRV-FOUND                                       01761418
017611        PERFORM 2000-BUILD-REQUEST                                01761518
017612        IF SUT00102-DIRV-RSN-CDE = 'RFD' AND                      01761618
017613           SU090-CARTON-DIRECTIVE                                 01761718
017615           CONTINUE                                               01761818
017616        ELSE                                                      01761918
                 IF WS-RF-AUDITS-FOUND AND WS-QC-AUDITS-FOUND-NO        01762018
                     CONTINUE                                           01762118
                 ELSE                                                   01762218
017617              PERFORM 3000-CALL-DIRECTIVE-REQUEST                 01762318
                 END-IF                                                 01763126
                 IF SU091-MANUAL-AUDIT AND                              01763226
                    PV-RFID-AUDIT-STAT-CDE  = 'I' OR 'F'                01763326
                    PERFORM 2005-BUILD-REQUEST-2                        01763426
                    PERFORM 3000-CALL-DIRECTIVE-REQUEST                 01763526
                 ELSE                                                   01763626
      *GB 3/21/2014 BEG                                                 01763728
      *GB* WHEN CARTONS ARE INITIALLY CREATED WITH AN RFID              01763828
      ***  AUDIT NUMBER THE SAME AUDIT NUMBER NEEDS TO BE               01763928
      ***  PASSED TO RELEASE THE DIRECTVE                               01764028
      ***  OTHER FIELDS ARE ALREADY SET IN 2000- PARA                   01764128
                    IF SU091-RFID-AUD-DIR-YES AND                       01764228
                      (SU091-AUDIT-FAILED OR SU091-AUDIT-IN-PROCESS)    01764328
                       MOVE SU091-AUD-CNTL-NBR TO                       01764428
                                            SU090-AUD-CNTL-NBR          01764528
                       MOVE SU091-RFID-AUD-CNTL-NBR TO                  01764628
                                            SU090-RFID-AUD-CNTL-NBR     01764728
017617                 PERFORM 3000-CALL-DIRECTIVE-REQUEST              01764828
                    END-IF                                              01764928
                 END-IF                                                 01765028
      *GB 3/21/2014 END                                                 01765128
017618        END-IF                                                    01765228
017620     END-IF.                                                      01765328
                                                                        01765428
                                                                        01765528
017900     PERFORM 9999-CICS-RETURN.                                    01765628
018000                                                                  01765728
018100     GOBACK.                                                      01765828
018200/                                                                 01765928
018300******************************************************************01766028
018400* 1000-VALIDATE-CCC-REQUEST                                      *01766128
018500******************************************************************01766228
018600 1000-VALIDATE-CCC-REQUEST.                                       01766328
018700                                                                  01766428
018800     EVALUATE TRUE                                                01766528
018900         WHEN ( SU091-OPER-UNT-ID NOT NUMERIC ) OR                01766628
019000              ( SU091-OPER-UNT-ID = ZERO )                        01766728
019100               MOVE '** INVALID SU091-OPER-UNT-ID **'             01766828
019200                 TO PV-ERROR-DESC                                 01766928
019300               MOVE 'Y'  TO WS-ERROR-FOUND-SW                     01767028
019400               CONTINUE                                           01767128
019500         WHEN ( SU091-SHIPT-UNT-ID NOT NUMERIC )                  01767228
019600               MOVE '** INVALID SU091-SHIPT-UNT-ID **'            01767328
019700                 TO PV-ERROR-DESC                                 01767428
019800               MOVE 'Y'  TO WS-ERROR-FOUND-SW                     01768018
019900               CONTINUE                                           01769018
020000         WHEN ( SU091-AUD-CNTL-NBR NOT NUMERIC )                  01770018
020100               MOVE '** INVALID SU091-AUD-CNTL-NBR **'            01780018
020200                 TO PV-ERROR-DESC                                 01790018
020300               MOVE 'Y'  TO WS-ERROR-FOUND-SW                     01800018
020400               CONTINUE                                           01810018
020500         WHEN ( SU091-SHIPT-UNT-ID = ZERO ) AND                   01820018
020600              ( SU091-AUD-CNTL-NBR = ZERO )                       01830018
020700               MOVE '** SHIPT-UNT-ID OR AUD-CNTL-NBR REQUIRED **' 01840018
020800                 TO PV-ERROR-DESC                                 01850018
020900               MOVE 'Y'  TO WS-ERROR-FOUND-SW                     01860018
021000               CONTINUE                                           01870018
021100         WHEN ( NOT SU091-VALID-AUDIT-TYPE )                      01880018
021200               MOVE '** INVALID SU091-VALID-AUDIT-TYPE **'        01890018
021300                 TO PV-ERROR-DESC                                 01900018
021400               MOVE 'Y'  TO WS-ERROR-FOUND-SW                     01910018
021500               CONTINUE                                           01920018
021600         WHEN ( SU091-PROMPTED-AUDIT ) AND                        01930018
021700              ( NOT SU091-VALID-AUDIT-STAT-CDE )                  01940018
021800               MOVE '** INVALID SU091-AUD-STAT-CDE **'            01950018
021900                 TO PV-ERROR-DESC                                 01960018
022000               MOVE 'Y'  TO WS-ERROR-FOUND-SW                     01970018
022100               CONTINUE                                           01980018
022200         WHEN ( SU091-ASSOC-ID = SPACES )                         01990018
022300               MOVE '** INVALID SU091-ASSOC-ID **'                02000018
022400                 TO PV-ERROR-DESC                                 02010018
022500               MOVE 'Y'  TO WS-ERROR-FOUND-SW                     02020018
022600     END-EVALUATE.                                                02030018
022700/                                                                 02040018
022800******************************************************************02050018
022900* 1010-SEL-AUTO-DIRECTIVE                                        *02060018
023000*     DETERMINE AUTO CONVEYER MODE                               *02070018
023100*     'N' = NO DIRECTIVES                                        *02080018
023200*     'E' = ISSUED FOR EXCEPTIONS                                *02090018
023300*     'A' = ISSUED FOR ALL CARTONS                               *02100018
023400******************************************************************02110018
023500 1010-SEL-AUTO-DIRECTIVE.                                         02120018
023600                                                                  02130018
023700     MOVE SU091-OPER-UNT-ID TO DK-OPER-UNT-ID.                    02140018
023800                                                                  02150018
023900     EXEC SQL                                                     02160018
024000         SELECT FUNC_TXT                                          02170018
024100           INTO :WS-AUTOCY-DIRECTIVE-MODE                         02180018
024200           FROM TKRPRPM                                           02190018
024300          WHERE INTFC_SYS_CDE        = 'KHL'                      02200018
024400            AND SYS_PRC_FUNC_CDE     = 'ACAUDT'                   02210018
024500            AND FUNC_PRC_STAT_CDE    = 'AC'                       02220018
024600            AND FUNC_BEG_TMST       <=  CURRENT TIMESTAMP         02230018
024700            AND FUNC_END_TMST       >=  CURRENT TIMESTAMP         02240018
024800            AND LOC_ID               =  :DK-OPER-UNT-ID           02250018
024900     END-EXEC                                                     02260018
025000                                                                  02270018
025100     EVALUATE TRUE                                                02280018
025200       WHEN SQLCODE     = ZERO                                    02290018
025300           CONTINUE                                               02300018
025400       WHEN SQLCODE NOT = ZERO                                    02310018
025500           MOVE 'Y'  TO WS-ERROR-FOUND-SW                         02320018
025600     END-EVALUATE.                                                02330018
025700/                                                                 02340018
025800******************************************************************02350018
025900* 1020-SEL-CARTON-DIRECTIVE                                      *02360018
026000******************************************************************02370018
026100 1020-SEL-CARTON-DIRECTIVE.                                       02380018
026200                                                                  02390018
026300     MOVE SU091-SHIPT-UNT-ID TO DK-SHIPT-UNT-ID.                  02400018
026400                                                                  02410018
026500     EXEC SQL                                                     02420018
026600         SELECT DT1.BRCDE_NBR                                     02430018
026700               ,DT1.OPER_UNT_ID                                   02440018
026800               ,DT1.DIRV_RSN_CDE                                  02450018
026900               ,DT1.AUD_CNTL_NBR                                  02460018
027000               ,DT1.SHIPT_UNT_ID                                  02470018
027100               ,DT1.AUD_STAT_CDE                                  02480018
027200               ,DT1.PO_NBR                                        02490018
027300               ,DT1.RCVR_SEQ_NBR                                  02500018
027400               ,DT1.PO_LNE_NBR                                    02510018
027500               ,DT1.PREPK_ID                                      02520018
027600               ,DT1.STR_NBR                                       02530018
027700               ,DT1.LGCL_LOC_NM                                   02540018
027800               ,DT1.CASI_CDE                                      02550018
027900               ,DT1.CART_STAT_CDE                                 02560018
028000               ,DT1.AUD_FALR_RSN_NM                               02570018
028100               ,DT1.STR_ZN_ID                                     02580018
028200               ,DT1.SEASET_YR                                     02590018
028300               ,DT1.SEASET_SHRT_NM                                02600018
028400               ,XF.CART_LBL_TYP_CDE                               02610018
028500         INTO  :SUT00102-BRCDE-NBR                                02620018
028600              ,:SUT00102-OPER-UNT-ID                              02630018
028700              ,:SUT00102-DIRV-RSN-CDE                             02640018
028800              ,:SUT00102-AUD-CNTL-NBR                             02650018
028900              ,:SUT00102-SHIPT-UNT-ID                             02660018
029000              ,:SUT00102-AUD-STAT-CDE                             02670018
029100              ,:SUT00102-PO-NBR                                   02680018
029200              ,:SUT00102-RCVR-SEQ-NBR                             02690018
029300              ,:SUT00102-PO-LNE-NBR                               02700018
029400              ,:SUT00102-PREPK-ID                                 02710018
029500              ,:SUT00102-STR-NBR                                  02720018
029600              ,:SUT00102-LGCL-LOC-NM                              02730018
029700              ,:SUT00102-CASI-CDE                                 02740018
029800              ,:SUT00102-CART-STAT-CDE                            02750018
029900              ,:SUT00102-AUD-FALR-RSN-NM                          02760018
030000              ,:SUT00102-STR-ZN-ID                                02770018
030100              ,:SUT00102-SEASET-YR                                02780018
030200              ,:SUT00102-SEASET-SHRT-NM                           02790018
030300              ,:SULBXF-CART-LBL-TYP-CDE                           02800018
030400         FROM   SUT_CART_DIRV_TRKG  DT1                           02810018
030500         JOIN   TSULBXF              XF                           02820018
030600           ON   XF.BRCDE_NBR     =  DT1.BRCDE_NBR                 02830018
030700          AND   XF.SHIPT_UNT_ID  =  :DK-SHIPT-UNT-ID              02840018
030800         WHERE  DT1.CRE_TMST =                                    02850018
030900                   (                                              02860018
031000                    SELECT MAX(DT2.CRE_TMST)                      02870018
031100                    FROM   SUT_CART_DIRV_TRKG  DT2                02880018
031200                    WHERE  DT2.BRCDE_NBR     =  DT1.BRCDE_NBR     02890018
031300                   )                                              02900018
031400     END-EXEC                                                     02910018
031500                                                                  02920018
031600     EVALUATE SQLCODE                                             02930018
031700       WHEN +0                                                    02940018
031800           MOVE 'Y'  TO WS-PRIOR-DIRV-FOUND-SW                    02950018
031900       WHEN +100                                                  02960018
032000           MOVE ' '  TO WS-PRIOR-DIRV-FOUND-SW                    02970018
032010       WHEN OTHER                                                 02980018
032020           MOVE 'Y'  TO WS-ERROR-FOUND-SW                         02990018
032100     END-EVALUATE.                                                03000018
032200/                                                                 03010018
032210******************************************************************03020018
032220* 1050-PRIOR-AUD-DIRECTIVE.                                     * 03030018
032230******************************************************************03040018
032240 1050-PRIOR-AUD-DIRECTIVE.                                        03050018
032250                                                                  03060018
032260     MOVE SU091-AUD-CNTL-NBR TO DK-AUD-CNTL-NBR.                  03070018
032270     MOVE SPACES             TO WS-DIRV-RSN-CDE                   03080018
032271                                                                  03090018
032280     EXEC SQL                                                     03100018
032290        SELECT DIRV_RSN_CDE                                       03110018
032291          INTO :WS-DIRV-RSN-CDE                                   03120018
032300           FROM  SUT_CART_DIRV_TRKG  A                            03130018
032310          WHERE  A.AUD_CNTL_NBR   = :DK-AUD-CNTL-NBR              03140018
032320            AND  A.CRE_TMST       =                               03150018
032330                   ( SELECT MAX (CRE_TMST)                        03160018
032331                     FROM SUT_CART_DIRV_TRKG B                    03170018
032332                     WHERE A.AUD_CNTL_NBR  = B.AUD_CNTL_NBR       03180018
032333                     )                                            03190018
032338     END-EXEC                                                     03200018
032339                                                                  03210018
032340     EVALUATE SQLCODE                                             03220018
032341       WHEN +0                                                    03230018
032342           CONTINUE                                               03231018
032343       WHEN +100                                                  03232018
032344            MOVE SPACE TO WS-DIRV-RSN-CDE                         03233018
032345       WHEN OTHER                                                 03233118
032347             SET  PV-DB2-ERROR TO TRUE                            03233218
032348             MOVE SQLCODE      TO SQLCODE2                        03233318
032349             STRING '** DB2 ERROR - PARA 1050- SQLCODE = :'       03233418
032350                    SQLCODE2                                      03233518
032351               DELIMITED BY SIZE INTO PV-ERROR-DESC               03233618
032352             PERFORM 9999-WRITE-CSSL-MSG                          03233718
032353             MOVE '02'        TO SU091-RET-CODE                   03233818
032354             MOVE WS-PGM-NAME TO SU091-ERR-PROGRAM                03233918
032355             MOVE '1020-'     TO SU091-ERR-PARAGRAPH              03234018
032356             PERFORM 9999-CICS-RETURN                             03234118
032359     END-EVALUATE.                                                03234218
032360/                                                                 03234318
032370 2000-BUILD-REQUEST.                                              03234418
032400                                                                  03234518
032500     INITIALIZE SU090-DG-REQUEST-COMMAREA.                        03234618
032600                                                                  03234718
032700     MOVE '00'                    TO SU090-RET-CODE.              03234818
032800     MOVE SU091-CALLING-PGM       TO SU090-CALLING-PGM.           03234918
032900     SET  SU090-ONLINE            TO TRUE.                        03235018
033000     MOVE SU091-OPER-UNT-ID       TO SU090-OPER-UNT-ID.           03236018
033100                                                                  03237018
033200     EVALUATE TRUE                                                03238018
033300         WHEN SU091-MANUAL-AUDIT                                  03239018
033400             EVALUATE TRUE                                        03240018
033500                 WHEN EXCEPTION-DIRECTIVES-MODE                   03250018
033600                     SET SU090-DELETE-ACTION    TO TRUE           03260018
033700                     SET SU090-CARTON-DIRECTIVE TO TRUE           03270018
033800                 WHEN ALL-CARTONS-DIRECTIVES-MODE                 03280018
033900                     SET SU090-ADD-ACTION       TO TRUE           03290018
034000                     SET SU090-CARTON-DIRECTIVE TO TRUE           03300018
034100             END-EVALUATE                                         03310018
034200         WHEN SU091-PROMPTED-AUDIT                                03320018
034300             PERFORM 2010-CHECK-AUDIT-STATUS                      03330018
034400     END-EVALUATE.                                                03340018
034500                                                                  03350018
034600     MOVE SULBXF-CART-LBL-TYP-CDE TO SU090-BRCDE-TYP-CDE.         03360018
034700                                                                  03370018
034800     EVALUATE TRUE                                                03380018
034900         WHEN SU090-SML-BARCODE                                   03390018
035000             MOVE SUT00102-SHIPT-UNT-ID TO SU090-SML-BRCDE-NBR    03400018
035100             MOVE SPACES                TO SU090-P2L-BRCDE-NBR    03410018
035200         WHEN SU090-P2L-BARCODE                                   03420018
035300             MOVE ZEROS                 TO SU090-SML-BRCDE-NBR    03430018
035400             MOVE SUT00102-BRCDE-NBR    TO SU090-P2L-BRCDE-NBR    03440018
035800     END-EVALUATE.                                                03450018
035900                                                                  03460018
036000     MOVE SUT00102-PO-NBR       TO SU090-PO-NBR.                  03470018
036100     MOVE SUT00102-PO-LNE-NBR   TO SU090-PO-LNE-NBR.              03480018
036200     MOVE SUT00102-PREPK-ID     TO SU090-PO-PREPK-ID.             03490018
036300     MOVE SUT00102-RCVR-SEQ-NBR TO SU090-RCVR-SEQ-NBR.            03500018
036400                                                                  03510018
036500     EVALUATE TRUE                                                03520018
036600         WHEN SU091-AUDIT-FAILED                                  03530018
036700             MOVE 'R'   TO SU090-CASI-CDE                         03540018
036800             MOVE 'AUR' TO SU090-DIRV-RSN-CDE                     03550018
036900         WHEN SU091-AUDIT-IN-PROCESS                              03560018
037000             MOVE 'U'   TO SU090-CASI-CDE                         03570018
037100             MOVE 'AUU' TO SU090-DIRV-RSN-CDE                     03580018
037200         WHEN SU091-AUDIT-NOT-NEEDED                              03590018
037300             MOVE ' '   TO SU090-CASI-CDE                         03600018
037400             MOVE 'AUN' TO SU090-DIRV-RSN-CDE                     03610018
037500         WHEN SU091-AUDIT-PASSED                                  03620018
037600             MOVE ' '   TO SU090-CASI-CDE                         03630018
037700             MOVE 'AUP' TO SU090-DIRV-RSN-CDE                     03640018
037800         WHEN SU091-MANUAL-AUDIT                                  03650018
                   PERFORM 2020-CHECK-FOR-QC                            03660018
                   PERFORM 2030-CHECK-FOR-RFID                          03670018
037900             MOVE ' '   TO SU090-CASI-CDE                         03680018
038000             MOVE 'RLC' TO SU090-DIRV-RSN-CDE                     03690018
038100     END-EVALUATE.                                                03700018
038110**GB 3/11/09 BEG                                                  03710018
038120**CHECK TO SEE IF SENDING THE SAME DIRECTIVE AS THE LAST DIRECTIVE03720018
038130**SENT.  IF SO, DO NOT SEND A NEW DIRECTIVE                       03730018
038140     IF SU091-SHIPT-UNT-ID > 0                                    03740018
038150        IF SU091-MANUAL-AUDIT                                     03750018
038151           IF SUT00102-DIRV-RSN-CDE = SU090-DIRV-RSN-CDE          03760018
038152             MOVE '00'        TO SU091-RET-CODE                   03770018
038153             PERFORM 9999-CICS-RETURN                             03780018
038154           END-IF                                                 03790018
038155        END-IF                                                    03800018
038160     ELSE                                                         03810018
038200       PERFORM  1050-PRIOR-AUD-DIRECTIVE                          03811018
038201       IF SU090-DIRV-RSN-CDE = WS-DIRV-RSN-CDE                    03812018
038202           MOVE '00'        TO SU091-RET-CODE                     03813018
038203           PERFORM 9999-CICS-RETURN                               03814018
038204       END-IF                                                     03815018
038205     END-IF                                                       03816018
038206**GB 3/11/09 END                                                  03817018
038210                                                                  03818018
038220                                                                  03819018
038300     MOVE SUT00102-CART-STAT-CDE   TO SU090-CART-STAT-CDE.        03820018
038400                                                                  03820118
038500*    IF ( SU091-SHIPT-UNT-ID > ZERO )                             03820218
038600*        MOVE SUT00102-AUD-CNTL-NBR TO SU090-AUD-CNTL-NBR         03820318
038700*        MOVE SUT00102-AUD-STAT-CDE TO SU090-AUD-STAT-CDE         03820418
038800*    ELSE                                                         03820518
038900*        MOVE SU091-AUD-CNTL-NBR    TO SU090-AUD-CNTL-NBR         03820618
039000*        MOVE SU091-AUD-STAT-CDE    TO SU090-AUD-STAT-CDE         03820718
039100*    END-IF.                                                      03820818
039200***SLH 02/09/09                                                   03820918
039210     IF SU091-AUD-CNTL-NBR > ZERO                                 03821018
039250         MOVE SU091-AUD-CNTL-NBR    TO SU090-AUD-CNTL-NBR         03822018
039260         MOVE SU091-AUD-STAT-CDE    TO SU090-AUD-STAT-CDE         03823018
039261     ELSE                                                         03824018
039262         MOVE SUT00102-AUD-CNTL-NBR TO SU090-AUD-CNTL-NBR         03825018
039263         MOVE SUT00102-AUD-STAT-CDE TO SU090-AUD-STAT-CDE         03826018
039270     END-IF.                                                      03827018
039271                                                                  03828018
039272     IF SU091-MANUAL-AUDIT                                        03829018
039273        MOVE SPACES                 TO SU090-AUD-STAT-CDE         03830018
039274     END-IF.                                                      03840018
039280**SLH END 02/09/09                                                03850018
039290     IF ( SU091-AUD-FALR-STAT-RSN-NM > SPACES )                   03860018
039291         MOVE SU091-AUD-FALR-STAT-RSN-NM TO SU090-AUD-FAIL-RSN    03870018
039292     ELSE                                                         03880018
039300         MOVE SUT00102-AUD-FALR-RSN-NM   TO SU090-AUD-FAIL-RSN    03890018
039301     END-IF.                                                      03900018
039302                                                                  03910018
039400     MOVE SUT00102-STR-ZN-ID       TO SU090-STR-ZN.               03920018
039500     MOVE SUT00102-SEASET-YR       TO SU090-SEASET-YR.            03921018
039600     MOVE SUT00102-SEASET-SHRT-NM  TO SU090-SEASET-CDE.           03922018
039700     MOVE SUT00102-STR-NBR         TO SU090-STR-NBR.              03923018
039800     MOVE SU091-ASSOC-ID           TO SU090-ASSOC-ID.             03924018
      ***GB 1/22/14 BEG                                                 03925018
           IF  SU091-RFID-AUD-DIR-YES                                   03926018
             DISPLAY 'SUT00102-AUD-CNTL-NBR' SUT00102-AUD-CNTL-NBR      03926124
             DISPLAY 'SU090-AUD-CNTL-NBR   ' SU090-AUD-CNTL-NBR         03926224
             DISPLAY 'SU091-AUD-CNTL-NBR      'SU091-AUD-CNTL-NBR       03926524
             DISPLAY 'SU091-RFID-AUD-CNTL-NBR 'SU091-RFID-AUD-CNTL-NBR  03926624
             DISPLAY 'SU090-RFID-AUD-CNTL-NBR 'SU090-RFID-AUD-CNTL-NBR  03926724
               SET SU090-RFID-AUD-DIR-YES  TO TRUE                      03927018
               IF SUT00102-AUD-CNTL-NBR  = SU091-AUD-CNTL-NBR           03927121
                  MOVE SU091-RFID-AUD-CNTL-NBR TO SU090-AUD-CNTL-NBR    03928021
               END-IF                                                   03928421
               MOVE SU091-RFID-AUD-CNTL-NBR TO SU090-RFID-AUD-CNTL-NBR  03928525
               SET SU090-AUDIT-GROUP-DIRECTIVE  TO TRUE                 03928621
           END-IF.                                                      03929018
      ***GB 1/22/14 END                                                 03929118
039900/                                                                 03929218
032370 2005-BUILD-REQUEST-2.                                            03929318
032400                                                                  03929418
032500     INITIALIZE SU090-DG-REQUEST-COMMAREA.                        03929518
032600                                                                  03929618
032700     MOVE '00'                    TO SU090-RET-CODE.              03929718
032800     MOVE SU091-CALLING-PGM       TO SU090-CALLING-PGM.           03929818
032900     SET  SU090-ONLINE            TO TRUE.                        03929918
033000     MOVE SU091-OPER-UNT-ID       TO SU090-OPER-UNT-ID.           03930018
033100                                                                  03931018
033200     EVALUATE TRUE                                                03932018
033300         WHEN SU091-MANUAL-AUDIT                                  03933018
033400             EVALUATE TRUE                                        03934018
033500                 WHEN EXCEPTION-DIRECTIVES-MODE                   03935018
033600                     SET SU090-ADD-ACTION    TO TRUE              03936018
033700                     SET SU090-CARTON-DIRECTIVE TO TRUE           03937018
033800                 WHEN ALL-CARTONS-DIRECTIVES-MODE                 03938018
033900                     SET SU090-ADD-ACTION       TO TRUE           03939018
034000                     SET SU090-CARTON-DIRECTIVE TO TRUE           03939118
034100             END-EVALUATE                                         03939218
034400     END-EVALUATE.                                                03939318
034500                                                                  03939418
034600     MOVE SULBXF-CART-LBL-TYP-CDE TO SU090-BRCDE-TYP-CDE.         03939518
034700                                                                  03939618
034800     EVALUATE TRUE                                                03939718
034900         WHEN SU090-SML-BARCODE                                   03939818
035000             MOVE SUT00102-SHIPT-UNT-ID TO SU090-SML-BRCDE-NBR    03939918
035100             MOVE SPACES                TO SU090-P2L-BRCDE-NBR    03940018
035200         WHEN SU090-P2L-BARCODE                                   03941018
035300             MOVE ZEROS                 TO SU090-SML-BRCDE-NBR    03941118
035400             MOVE SUT00102-BRCDE-NBR    TO SU090-P2L-BRCDE-NBR    03941218
035800     END-EVALUATE.                                                03941318
035900                                                                  03941418
036000     MOVE SUT00102-PO-NBR       TO SU090-PO-NBR.                  03941518
036100     MOVE SUT00102-PO-LNE-NBR   TO SU090-PO-LNE-NBR.              03941618
036200     MOVE SUT00102-PREPK-ID     TO SU090-PO-PREPK-ID.             03941718
036300     MOVE SUT00102-RCVR-SEQ-NBR TO SU090-RCVR-SEQ-NBR.            03941818
036400     MOVE PV-RFID-AUDIT-STAT-CDE TO SU090-AUD-STAT-CDE            03941918
036400                                    SU091-AUD-STAT-CDE            03942018
                                                                        03942118
           IF SUT00015-RWRK-AUD-CNTL-NBR > 0                            03942218
039250        MOVE SUT00015-RWRK-AUD-CNTL-NBR TO SU090-AUD-CNTL-NBR     03942318
           END-IF                                                       03942418
                                                                        03942518
036500     EVALUATE TRUE                                                03942618
036600         WHEN SU091-AUDIT-FAILED                                  03942718
036700             MOVE 'R'   TO SU090-CASI-CDE                         03942818
036800             MOVE 'RFD' TO SU090-DIRV-RSN-CDE                     03942918
036900         WHEN SU091-AUDIT-IN-PROCESS                              03943018
037000             MOVE 'U'   TO SU090-CASI-CDE                         03943118
037100             MOVE 'AUU' TO SU090-DIRV-RSN-CDE                     03943218
038100     END-EVALUATE.                                                03943318
038300     MOVE SUT00102-CART-STAT-CDE   TO SU090-CART-STAT-CDE.        03943418
039400     MOVE SUT00102-STR-ZN-ID       TO SU090-STR-ZN.               03943518
039500     MOVE SUT00102-SEASET-YR       TO SU090-SEASET-YR.            03943618
039600     MOVE SUT00102-SEASET-SHRT-NM  TO SU090-SEASET-CDE.           03943718
039700     MOVE SUT00102-STR-NBR         TO SU090-STR-NBR.              03943818
039800     MOVE SU091-ASSOC-ID           TO SU090-ASSOC-ID.             03943918
039900/                                                                 03944018
040000******************************************************************03945018
040100* 2010-CHECK-AUDIT-STATUS                                        *03946018
040200*     'N' = NOT NEEDED                                           *03947018
040300*     'F' = FAILED                                               *03948018
040400*     'I' = IN PROCESS                                           *03949018
040500*     'P' = PASSED                                               *03950018
040600******************************************************************03960018
040700 2010-CHECK-AUDIT-STATUS.                                         03970018
040800                                                                  03980018
040900     EVALUATE TRUE                                                03990018
041000         WHEN SU091-AUDIT-NOT-NEEDED                              04000018
041001         WHEN SU091-AUDIT-PASSED                                  04010018
041100             EVALUATE TRUE                                        04020018
041200                 WHEN EXCEPTION-DIRECTIVES-MODE                   04030018
041300                     SET SU090-DELETE-ACTION         TO TRUE      04040018
041500                 WHEN ALL-CARTONS-DIRECTIVES-MODE                 04050018
041600                     SET SU090-ADD-ACTION            TO TRUE      04060018
041800             END-EVALUATE                                         04070018
041900             SET SU090-AUDIT-GROUP-DIRECTIVE         TO TRUE      04080018
042800         WHEN SU091-AUDIT-FAILED                                  04090018
042900             SET SU090-ADD-ACTION                    TO TRUE      04100018
043000             SET SU090-AUDIT-GROUP-DIRECTIVE         TO TRUE      04110018
043100         WHEN OTHER                                               04120018
043200             SET SU090-ADD-ACTION                    TO TRUE      04130018
043300             SET SU090-CARTON-DIRECTIVE              TO TRUE      04140018
043400     END-EVALUATE.                                                04150018
043500/                                                                 04160018
091800 2020-CHECK-FOR-QC.                                               04170018
091900                                                                  04180018
092000     EXEC SQL                                                     04190018
092100          SELECT AUD_CNTL_NBR                                     04200018
                    ,  AUD_STAT_CDE                                     04200118
092300          INTO   :SUT00015-AUD-CNTL-NBR                           04200218
                     , :SUT00015-AUD-STAT-CDE                           04200318
092500          FROM   SUT_PO_AUD_REQ                                   04200418
092600          WHERE  AUD_CNTL_NBR   = :SUT00102-AUD-CNTL-NBR          04200518
                  AND  PKGNG_TYP_CDE <> 'RF'                            04200618
093010     END-EXEC.                                                    04200718
093020                                                                  04200818
093030     EVALUATE TRUE                                                04200918
093040         WHEN SQLCODE = ZERO                                      04201018
093050         WHEN SQLCODE = -811                                      04201118
093060             SET WS-QC-AUDITS-FOUND-YES TO TRUE                   04201218
093070         WHEN SQLCODE = +100                                      04201318
093080             SET WS-QC-AUDITS-FOUND-NO TO TRUE                    04201418
032345         WHEN OTHER                                               04201518
032347             SET  PV-DB2-ERROR TO TRUE                            04201618
032348             MOVE SQLCODE      TO SQLCODE2                        04201718
032349             STRING '** DB2 ERROR - PARA 2020- SQLCODE = :'       04201818
032350                    SQLCODE2                                      04201918
032351               DELIMITED BY SIZE INTO PV-ERROR-DESC               04202018
032352             PERFORM 9999-WRITE-CSSL-MSG                          04202118
032353             MOVE '03'        TO SU091-RET-CODE                   04202218
032354             MOVE WS-PGM-NAME TO SU091-ERR-PROGRAM                04202318
032355             MOVE '2020-'     TO SU091-ERR-PARAGRAPH              04202418
032356             PERFORM 9999-CICS-RETURN                             04202518
032359     END-EVALUATE.                                                04202618
091800 2030-CHECK-FOR-RFID.                                             04202718
091900                                                                  04202818
092000     EXEC SQL                                                     04202918
092100          SELECT AUD_CNTL_NBR                                     04203018
                    ,  AUD_STAT_CDE                                     04204018
092300          INTO   :PV-RFID-AUDIT-CNTRL-NBR                         04205018
                     , :PV-RFID-AUDIT-STAT-CDE                          04206018
092500          FROM   SUT_PO_AUD_REQ                                   04207018
092600          WHERE  PO_NBR         = :SUT00102-PO-NBR                04208018
                  AND  RCVR_SEQ_NBR   = :SUT00102-RCVR-SEQ-NBR          04209018
                  AND  PKGNG_TYP_CDE  = 'RF'                            04209118
093010     END-EXEC.                                                    04209218
093020                                                                  04209318
093030     EVALUATE TRUE                                                04209418
093040         WHEN SQLCODE = ZERO                                      04209518
093050         WHEN SQLCODE = -811                                      04209618
093060             SET WS-RF-AUDITS-FOUND TO TRUE                       04209718
                   MOVE PV-RFID-AUDIT-CNTRL-NBR                         04209818
                     TO SUT00015-RWRK-AUD-CNTL-NBR                      04209918
093070         WHEN SQLCODE = +100                                      04210018
093080             SET WS-NO-RF-AUDITS-FOUND TO TRUE                    04210118
032345         WHEN OTHER                                               04210218
032347             SET  PV-DB2-ERROR TO TRUE                            04210318
032348             MOVE SQLCODE      TO SQLCODE2                        04210418
032349             STRING '** DB2 ERROR - PARA 2030- SQLCODE = :'       04210518
032350                    SQLCODE2                                      04210618
032351               DELIMITED BY SIZE INTO PV-ERROR-DESC               04210718
032352             PERFORM 9999-WRITE-CSSL-MSG                          04210818
032353             MOVE '04'        TO SU091-RET-CODE                   04210918
032354             MOVE WS-PGM-NAME TO SU091-ERR-PROGRAM                04211018
032355             MOVE '2030-'     TO SU091-ERR-PARAGRAPH              04211118
032356             PERFORM 9999-CICS-RETURN                             04211218
093122     END-EVALUATE.                                                04211318
043600******************************************************************04211418
043700* 3000-CALL-DIRECTIVE-REQUEST                                    *04211518
043800*     CALL PGM SUKUT129. CHECK FOR ERRORS UPON RETURN            *04211618
043900******************************************************************04211718
044000 3000-CALL-DIRECTIVE-REQUEST.                                     04211818
044100                                                                  04212122
044110     INSPECT SU090-DG-REQUEST-COMMAREA                            04212222
044120         REPLACING ALL LOW-VALUES BY '?'.                         04213018
044130                                                                  04214018
044200     CALL WS-DDG-PGM-NAME USING DFHEIBLK                          04215018
044300                                SU090-COMMAREA                    04216018
044400                                SU090-DG-REQUEST-COMMAREA.        04217018
044500                                                                  04218018
044600     IF ( SU090-SUCCESS )                                         04219018
044700         CONTINUE                                                 04220018
044800     ELSE                                                         04230018
044900         MOVE SU090-RET-CODE      TO SU091-RET-CODE               04240018
045000         MOVE SU090-ERR-PROGRAM   TO SU091-ERR-PROGRAM            04250018
045100         MOVE SU090-ERR-PARAGRAPH TO SU091-ERR-PARAGRAPH          04260018
045200         MOVE SU090-SQLCODE       TO SU091-SQLCODE                04270018
045300         MOVE SU090-SQLCA         TO SU091-SQLCA                  04280018
045400         MOVE SU090-MQ-COND-CODE  TO SU091-MQ-COND-CODE           04290018
045500         MOVE SU090-MQ-REAS-CODE  TO SU091-MQ-REAS-CODE           04300018
045600         MOVE SU090-MQ-REAS-TXT   TO SU091-MQ-REAS-TXT            04310018
045700         EVALUATE TRUE                                            04320018
045800             WHEN SU090-PARAMETER-ERROR                           04330018
045900                 SET PV-PARM-ERROR TO TRUE                        04340018
046000                 MOVE '** INVALID PARM UPON RETURN FROM SUKUT129 '04350018
046100                   TO PV-ERROR-DESC                               04360018
046300             WHEN SU090-DB2-ERROR                                 04370018
046400                 SET PV-DB2-ERROR   TO TRUE                       04380018
046500                 MOVE SU090-SQLCODE TO SQLCODE2                   04390018
046600                 STRING '** DB2 ERROR - '                         04400018
046700                        'PGM SUKUT129 - '                         04410018
046800                        'PARA - '         SU090-ERR-PARAGRAPH     04420018
046900                        ' SQLCODE =: '    SQLCODE2                04430018
047000                     DELIMITED BY SIZE INTO PV-ERROR-DESC         04440018
047200             WHEN SU090-MQ-ERROR                                  04450018
047300                 SET PV-MQ-ERROR         TO TRUE                  04460018
047400                 MOVE SU090-MQ-COND-CODE TO SQLCODE2              04470018
047500                 STRING '** MQ ERROR - '                          04480018
047600                        'PGM SUKUT129 - '                         04490018
047700                        'PARA - '         SU090-ERR-PARAGRAPH     04500018
047800                        ' MQCODE =: '     SQLCODE2                04510018
047900                     DELIMITED BY SIZE INTO PV-ERROR-DESC         04520018
048100             WHEN SU090-OTHER-ERROR                               04530018
048200                 SET PV-OTHER-ERROR TO TRUE                       04540018
048300                 STRING '** UNKNOWN ERROR UPON '                  04550018
048400                        'RETURN FROM SUKUT129 '                   04560018
048500                     DELIMITED BY SIZE INTO PV-ERROR-DESC         04570018
048700         END-EVALUATE                                             04580018
048710         PERFORM 9999-WRITE-CSSL-MSG                              04590018
048800     END-IF.                                                      04600018
048900                                                                  04610018
049000/                                                                 04620018
049100******************************************************************04630018
049200* 9999-WRITE-CSSL-MSG                                            *04640018
049300*     WRITE SPECIFIC ERROR MESSAGES TO THE CSSL QUEUE            *04650018
049400******************************************************************04660018
049500 9999-WRITE-CSSL-MSG.                                             04670018
049600                                                                  04680018
049700     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH.       04690018
049800                                                                  04700018
049900     EXEC CICS                                                    04710018
050000          WRITEQ TD                                               04720018
050100           QUEUE  ('CSSL')                                        04730018
050200            FROM  (PV-CICS-MSG-AREA)                              04740018
050300          LENGTH  (PV-COMMAREA-LENGTH)                            04750018
050400            RESP  (PV-CICS-RESPONSE)                              04760018
050500     END-EXEC.                                                    04770018
050600/                                                                 04780018
050700******************************************************************04790018
050800* 9999-CICS-RETURN                                               *04800018
050900******************************************************************04810018
051000 9999-CICS-RETURN.                                                04820018
051100                                                                  04830018
051200     MOVE CCC-REQUEST-COMMUNICATION-AREA TO DFHCOMMAREA.          04840018
051300                                                                  04850018
051400     EXEC CICS RETURN                                             04860018
051500     END-EXEC.                                                    04870018
051600                                                                  04880018
