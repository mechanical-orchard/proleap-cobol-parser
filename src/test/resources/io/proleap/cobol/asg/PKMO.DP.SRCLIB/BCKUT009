000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      BCKUT009.                                       00040000
000500 AUTHOR.          MIKE SOMMERS.                                   00050000
000600 DATE-WRITTEN.    FEBRUARY 2005.                                  00060000
000700                                                                  00070000
000800*        READ AN IDENTITY MANAGEMENT EXTRACT FILE AND A MERGED    00080000
000900*        PEOPLESOFT/LOTUS NOTES FILE.  MERGE THE IDENTITY         00090002
001000*        MANAGEMENT INFORMATION INTO THE PS/NOTES FILE.           00100002
001100                                                                  00110000
001200 ENVIRONMENT DIVISION.                                            00120000
001300 CONFIGURATION SECTION.                                           00130000
001400 SOURCE-COMPUTER. IBM-3090.                                       00140000
001500 OBJECT-COMPUTER. IBM-3090.                                       00150000
001600                                                                  00160000
001700 INPUT-OUTPUT SECTION.                                            00170000
001800 FILE-CONTROL.                                                    00180000
001900     SELECT EMPLOYEE-FILE              ASSIGN TO INP01.           00190042
002000     SELECT ID-MGMT-EXTRACT-FILE       ASSIGN TO INP02.           00200000
002100     SELECT MERGED-FILE                ASSIGN TO OUT01.           00210000
002400                                                                  00240042
002500***************                                                   00250000
002600 DATA DIVISION.                                                   00260000
002700***************                                                   00270000
002800 FILE SECTION.                                                    00280000
002900 FD  EMPLOYEE-FILE                                                00290042
003000                             BLOCK CONTAINS 0 RECORDS,            00300000
003100                             RECORD CONTAINS 728 CHARACTERS,      00310049
003200                             RECORDING MODE IS F,                 00320000
003300                             LABEL RECORDS ARE STANDARD,          00330000
003400                             DATA RECORD IS EMPLOYEE-REC.         00340042
003500 01  EMPLOYEE-REC            PIC X(728).                          00350049
003600                                                                  00360000
003700 FD  ID-MGMT-EXTRACT-FILE                                         00370000
003800                             BLOCK CONTAINS 0 RECORDS,            00380000
003900                             RECORD CONTAINS 348 CHARACTERS,      00390030
004000                             RECORDING MODE IS F,                 00400000
004100                             LABEL RECORDS ARE STANDARD,          00410000
004200                             DATA RECORD IS ID-MGMT-REC.          00420000
004300 01  ID-MGMT-REC             PIC X(348).                          00430030
004400                                                                  00440000
004500 FD  MERGED-FILE                                                  00450000
004600                             BLOCK CONTAINS 0 RECORDS,            00460000
004700                             RECORD CONTAINS 728 CHARACTERS,      00470049
004800                             RECORDING MODE IS F,                 00480000
004900                             LABEL RECORDS ARE STANDARD,          00490000
005000                             DATA RECORD IS MERGED-REC.           00500000
005100 01  MERGED-REC              PIC X(728).                          00510049
005200                                                                  00520000
006900*************************                                         00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100*************************                                         00710000
007110                                                                  00711042
007120 01  PS-PROGRAM-SWITCHES.                                         00712042
007150     05  PS-END-OF-EMPLOYEE-FILE-SW                               00715042
007160                                 PIC X(1)     VALUE 'N'.          00716042
007170         88  PS-END-OF-EMPLOYEE-FILE          VALUE 'Y'.          00717042
007171     05  PS-END-OF-ID-MGMT-FILE-SW                                00717142
007172                                 PIC X(1)     VALUE 'N'.          00717242
007173         88  PS-END-OF-ID-MGMT-FILE           VALUE 'Y'.          00717342
007180                                                                  00718042
007190 01  PC-PROGRAM-CONSTANTS.                                        00719042
007191     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'BCKUT009'.   00719142
007192     05  PC-COMMA                PIC X(1)     VALUE ','.          00719250
007193     05  PC-DOUBLE-QUOTE         PIC X(1)     VALUE '"'.          00719350
007194     05  PC-AT-DOMAIN-REFERENCE  PIC X(1)     VALUE '@'.          00719442
007195     05  PC-DOMAIN-EXTENSION     PIC X(1)     VALUE '.'.          00719552
007196     05  PC-NO-PHONE-NUMBER      PIC X(12)   VALUE '000-000-0000'.00719655
007197                                                                  00719752
007198 01  PV-PROGRAM-VARIABLES.                                        00719852
007199     05  PV-TALLY                PIC S9(4)    VALUE ZEROS         00719952
007200                                              COMP SYNC.          00720052
007201                                                                  00720152
007202 01  PT-PROGRAM-TOTALS.                                           00720252
007203     05  PT-EMPLOYEE-RCDS-READ   PIC S9(7)    VALUE ZEROS         00720342
007204                                              COMP-3.             00720442
007205     05  PT-ID-MGMT-RCDS-READ    PIC S9(7)    VALUE ZEROS         00720542
007206                                              COMP-3.             00720642
007207     05  PT-MERGED-RCDS-WRITTEN  PIC S9(7)    VALUE ZEROS         00720742
007208                                              COMP-3.             00720842
007209                                                                  00720942
007210 01  TD-TOTAL-DISPLAY-MESSAGE.                                    00721042
007211     05  TD-TOTAL-ID             PIC X(51)    VALUE SPACES.       00721142
007214         88  TD-EMPLOYEE-RCDS-READ-ID         VALUE               00721442
007215             'EMPLOYEE FILE RECORDS READ . . . . . . . . . . . .'.00721542
007216         88  TD-ID-MGMT-RCDS-READ-ID          VALUE               00721642
007217             'IDENTITY MANAGEMENT RECORDS READ . . . . . . . . .'.00721742
007218         88  TD-MERGED-RCDS-WRITTEN-ID        VALUE               00721842
007219             'MERGED EMPLOYEE CSV RECORDS WRITTEN  . . . . . . .'.00721942
007220     05  TD-TOTAL-AMOUNT         PIC Z,ZZZ,ZZ9                    00722042
007221                                              VALUE ZEROS.        00722142
007222                                                                  00722243
007230******************************************************************00723000
007300*   IDENTITY MANAGEMENT EXTRACT RECORD LAYOUT                     00730000
007400******************************************************************00740000
007500 01  IMR-IDENTITY-MGMT-RECORD.                                    00750030
007600     05  IMR-ASSOCIATE-ID            PIC X(7)      VALUE SPACES.  00760030
007610     05  IMR-EMPLOYEE-USER-ID        PIC X(7)      VALUE SPACES.  00761030
007620     05  IMR-EMPLOYEE-NAME           PIC X(40)     VALUE SPACES.  00762030
007630     05  IMR-DEPARTMENT              PIC X(7)      VALUE SPACES.  00763030
007640     05  IMR-LOCATION                PIC X(4)      VALUE SPACES.  00764030
007650     05  IMR-WORK-EMAIL-ADDRESS      PIC X(60)     VALUE SPACES.  00765030
007660     05  IMR-JOB-TITLE               PIC X(75)     VALUE SPACES.  00766030
007670     05  IMR-WORK-PHONE              PIC X(12)     VALUE SPACES.  00767036
007680     05  IMR-CELL-PHONE              PIC X(16)     VALUE SPACES.  00768030
007690     05  IMR-PAGER-PIN               PIC X(60)     VALUE SPACES.  00769030
007691     05  IMR-SUPERVISOR              PIC X(60)     VALUE SPACES.  00769130
007692                                                                  00769230
009900******************************************************************00990000
010000*   MERGED PEOPLESOFT/NOTES INFO RECORD LAYOUT                    01000000
010100******************************************************************01010000
010200     COPY BCRD001.                                                01020000
010300                                                                  01030000
019400 01  WS-WORKING-STORAGE.                                          01940000
019500     05  WS-USER-ID-FIELD.                                        01950000
019600         10  WS-USER-ID          PIC X(7)       VALUE SPACES.     01960000
019700         10  FILLER              PIC X(1)       VALUE SPACES.     01970000
020403     05  WS-PHONE.                                                02040336
020404         10  WS-PHONE1           PIC X(3)       VALUE SPACES.     02040436
020405         10  FILLER              PIC X(1)       VALUE SPACES.     02040536
020406         10  WS-PHONE2           PIC X(3)       VALUE SPACES.     02040636
020407         10  FILLER              PIC X(1)       VALUE SPACES.     02040736
020408         10  WS-PHONE3           PIC X(4)       VALUE SPACES.     02040839
025200                                                                  02520000
025500********************                                              02550000
025600 PROCEDURE DIVISION.                                              02560000
025700********************                                              02570000
027200     OPEN INPUT  EMPLOYEE-FILE                                    02720042
027300                 ID-MGMT-EXTRACT-FILE.                            02730000
027400     OPEN OUTPUT MERGED-FILE.                                     02740042
027700                                                                  02770000
027800     PERFORM A100-READ-EMPLOYEE-FILE.                             02780042
027900     PERFORM A200-READ-ID-MGMT-EXTRACT-FILE.                      02790000
028000     PERFORM B000-CHECK-EOF                                       02800000
028100         UNTIL ((PS-END-OF-EMPLOYEE-FILE)                         02810042
028200                 AND (PS-END-OF-ID-MGMT-FILE)).                   02820042
028210     PERFORM C000-DISPLAY-PROGRAM-TOTALS.                         02821042
028300                                                                  02830000
028400     CLOSE EMPLOYEE-FILE                                          02840042
028500           ID-MGMT-EXTRACT-FILE                                   02850000
028600           MERGED-FILE.                                           02860042
028900                                                                  02890000
029400     STOP RUN.                                                    02940000
029500                                                                  02950000
029600*************************                                         02960000
029700 A100-READ-EMPLOYEE-FILE.                                         02970042
029800*************************                                         02980000
029900     READ EMPLOYEE-FILE INTO BC001-MERGED-RECORD                  02990042
030000         AT END                                                   03000042
030100             SET PS-END-OF-EMPLOYEE-FILE TO TRUE                  03010042
030200     END-READ.                                                    03020042
030300                                                                  03030042
030400     IF (NOT PS-END-OF-EMPLOYEE-FILE)                             03040042
030500         ADD +1 TO PT-EMPLOYEE-RCDS-READ                          03050042
030510     END-IF.                                                      03051042
030600                                                                  03060000
030700********************************                                  03070000
030800 A200-READ-ID-MGMT-EXTRACT-FILE.                                  03080000
030900********************************                                  03090000
031310     READ ID-MGMT-EXTRACT-FILE INTO IMR-IDENTITY-MGMT-RECORD      03131042
031320         AT END                                                   03132042
031330             SET PS-END-OF-ID-MGMT-FILE TO TRUE                   03133042
031340     END-READ.                                                    03134042
031350                                                                  03135042
031360     IF (NOT PS-END-OF-ID-MGMT-FILE)                              03136042
031370         ADD +1 TO PT-ID-MGMT-RCDS-READ                           03137042
031380     END-IF.                                                      03138042
031700                                                                  03170000
031800****************                                                  03180000
031900 B000-CHECK-EOF.                                                  03190000
032000****************                                                  03200000
032400     IF PS-END-OF-EMPLOYEE-FILE                                   03240042
032500         PERFORM A200-READ-ID-MGMT-EXTRACT-FILE                   03250042
033000     ELSE                                                         03300042
033101         IF PS-END-OF-ID-MGMT-FILE                                03310142
033102             DISPLAY PC-CURRENT-PROGRAM-NAME ' - EMPL W/O '       03310245
033103                       'MATCHING ID MGMT FOR '                    03310345
033104                       BC001-EMPLOYEE-NUMBER ': '                 03310445
033105                       BC001-EMPLOYEE-USER-ID ' ' BC001-FIRST-NAME03310544
033106                       BC001-LAST-NAME ' LOC' BC001-LOCATION      03310644
033107                       ' DPT' BC001-DEPARTMENT                    03310744
033130             PERFORM D100-WRITE-OUTPUT                            03313042
033200             PERFORM A100-READ-EMPLOYEE-FILE                      03320042
033300         ELSE                                                     03330042
033400             PERFORM B100-COMPARE-FILES                           03340042
033500         END-IF                                                   03350042
033700     END-IF.                                                      03370000
033800                                                                  03380000
033900********************                                              03390000
034000 B100-COMPARE-FILES.                                              03400000
034100********************                                              03410000
035000     IF BC001-EMPLOYEE-NUMBER > IMR-ASSOCIATE-ID                  03500030
035600         PERFORM A200-READ-ID-MGMT-EXTRACT-FILE                   03560004
035700     ELSE                                                         03570004
035800         IF BC001-EMPLOYEE-NUMBER < IMR-ASSOCIATE-ID              03580030
035900             DISPLAY PC-CURRENT-PROGRAM-NAME ' - EMPL W/O '       03590045
036000                       'MATCHING ID MGMT FOR '                    03600045
036001                       BC001-EMPLOYEE-NUMBER ': '                 03600145
036002                       BC001-EMPLOYEE-USER-ID ' ' BC001-FIRST-NAME03600244
036003                       BC001-LAST-NAME ' LOC' BC001-LOCATION      03600344
036004                       ' DPT' BC001-DEPARTMENT                    03600444
036010             PERFORM D001-CHECK-PHONE                             03601040
036020             PERFORM D100-WRITE-OUTPUT                            03602009
036100             PERFORM A100-READ-EMPLOYEE-FILE                      03610043
036200         ELSE                                                     03620004
036300             PERFORM D000-BUILD-OUTPUT-RECORD                     03630004
036500             PERFORM D100-WRITE-OUTPUT                            03650004
036600             PERFORM A100-READ-EMPLOYEE-FILE                      03660042
036700             PERFORM A200-READ-ID-MGMT-EXTRACT-FILE               03670004
036800         END-IF                                                   03680004
037000     END-IF.                                                      03700000
037100                                                                  03710000
037200********************************                                  03720042
037300 C000-DISPLAY-PROGRAM-TOTALS.                                     03730042
037400********************************                                  03740042
037500     DISPLAY ' '.                                                 03750046
037600                                                                  03760046
038000     SET TD-EMPLOYEE-RCDS-READ-ID TO TRUE.                        03800042
038100     MOVE PT-EMPLOYEE-RCDS-READ TO TD-TOTAL-AMOUNT.               03810042
038200     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       03820042
038300               TD-TOTAL-DISPLAY-MESSAGE.                          03830042
038400                                                                  03840042
038410     SET TD-ID-MGMT-RCDS-READ-ID TO TRUE.                         03841042
038420     MOVE PT-ID-MGMT-RCDS-READ TO TD-TOTAL-AMOUNT.                03842042
038430     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       03843042
038440               TD-TOTAL-DISPLAY-MESSAGE.                          03844042
038450                                                                  03845042
038500     SET TD-MERGED-RCDS-WRITTEN-ID TO TRUE.                       03850042
038600     MOVE PT-MERGED-RCDS-WRITTEN TO TD-TOTAL-AMOUNT.              03860042
038700     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       03870042
038800               TD-TOTAL-DISPLAY-MESSAGE.                          03880042
041000                                                                  04100000
041100**************************                                        04110000
041200 D000-BUILD-OUTPUT-RECORD.                                        04120000
041300**************************                                        04130000
041410     MOVE BC001-EMPLOYEE-USER-ID     TO WS-USER-ID-FIELD.         04141018
041411     IF IMR-EMPLOYEE-USER-ID = SPACES                             04141130
041412         CONTINUE                                                 04141218
041413     ELSE                                                         04141318
041419         IF WS-USER-ID = IMR-EMPLOYEE-USER-ID                     04141930
041420             CONTINUE                                             04142018
041421         ELSE                                                     04142118
041424             MOVE IMR-EMPLOYEE-USER-ID TO BC001-EMPLOYEE-USER-ID  04142430
041425         END-IF                                                   04142518
041426     END-IF.                                                      04142618
041430     IF BC001-WORK-EMAIL-ADDRESS = SPACES                         04143018
042510         INITIALIZE PV-TALLY                                      04251043
042520         INSPECT IMR-WORK-EMAIL-ADDRESS                           04252043
042530             TALLYING PV-TALLY                                    04253043
042540             FOR ALL PC-AT-DOMAIN-REFERENCE                       04254043
042550         IF (PV-TALLY = 1)                                        04255043
042560             INITIALIZE PV-TALLY                                  04256052
042561             INSPECT IMR-WORK-EMAIL-ADDRESS                       04256152
042562                 TALLYING PV-TALLY                                04256252
042563                 FOR ALL PC-DOMAIN-EXTENSION                      04256352
042564                 AFTER INITIAL PC-AT-DOMAIN-REFERENCE             04256452
042565             IF (PV-TALLY >= 1)                                   04256557
042566                 MOVE IMR-WORK-EMAIL-ADDRESS TO                   04256652
042568                                       BC001-WORK-EMAIL-ADDRESS   04256852
042569                 INSPECT BC001-WORK-EMAIL-ADDRESS                 04256952
042570                     REPLACING ALL PC-COMMA BY SPACES             04257052
042571                                   PC-DOUBLE-QUOTE BY SPACES      04257152
042572             ELSE                                                 04257252
042573                 DISPLAY PC-CURRENT-PROGRAM-NAME ' - INVALID '    04257352
042574                           'WORK EMAIL ADDRESS FOR '              04257452
042575                           IMR-EMPLOYEE-USER-ID ' OF '            04257552
042576                           IMR-WORK-EMAIL-ADDRESS                 04257652
042582             END-IF                                               04258252
042583         ELSE                                                     04258343
042590             IF (IMR-WORK-EMAIL-ADDRESS NOT = SPACES)             04259043
042591                 DISPLAY PC-CURRENT-PROGRAM-NAME ' - INVALID '    04259143
042592                           'WORK EMAIL ADDRESS FOR '              04259243
042593                           IMR-EMPLOYEE-USER-ID ' OF '            04259343
042594                           IMR-WORK-EMAIL-ADDRESS                 04259443
042595         END-IF                                                   04259543
042600     END-IF.                                                      04260014
043100     IF BC001-JOB-TITLE          = SPACES                         04310033
043200         MOVE IMR-JOB-TITLE          TO BC001-JOB-TITLE           04320033
043210         INSPECT BC001-JOB-TITLE                                  04321050
043220             REPLACING ALL PC-COMMA BY SPACES                     04322050
043230                           PC-DOUBLE-QUOTE BY SPACES              04323050
043300     END-IF.                                                      04330033
044000     IF BC001-PAGER-PIN          = SPACES                         04400033
044100         MOVE IMR-PAGER-PIN          TO BC001-PAGER-PIN           04410033
044200     END-IF.                                                      04420033
044300     IF BC001-SUPERVISOR         = SPACES                         04430033
044400         MOVE IMR-SUPERVISOR         TO BC001-SUPERVISOR          04440033
044410         INSPECT BC001-SUPERVISOR                                 04441050
044420             REPLACING ALL PC-COMMA BY SPACES                     04442050
044430                           PC-DOUBLE-QUOTE BY SPACES              04443050
044500     END-IF.                                                      04450033
044510                                                                  04451041
044600*  IF PHONE NUMBER IS ZEROES, MOVE SPACES TO OUTPUT               04460041
044700     MOVE BC001-WORK-PHONE       TO WS-PHONE.                     04470041
044800     IF WS-PHONE2                = SPACES OR ZEROES               04480040
044900         MOVE IMR-WORK-PHONE     TO WS-PHONE                      04490041
045000         IF WS-PHONE2            = SPACES OR ZEROES               04500040
045100             MOVE SPACES         TO BC001-WORK-PHONE              04510041
045200         ELSE                                                     04520040
045300             MOVE IMR-WORK-PHONE TO BC001-WORK-PHONE              04530041
045400         END-IF                                                   04540040
045500     END-IF.                                                      04550040
045600                                                                  04560040
045700     MOVE BC001-CELL-PHONE       TO WS-PHONE.                     04570041
045800     IF WS-PHONE2                = SPACES OR ZEROES               04580040
045900         MOVE IMR-CELL-PHONE     TO WS-PHONE                      04590041
046000         IF WS-PHONE2            = SPACES OR ZEROES               04600040
046100             MOVE SPACES         TO BC001-CELL-PHONE              04610041
046200         ELSE                                                     04620040
046300             MOVE IMR-CELL-PHONE TO BC001-CELL-PHONE              04630041
046400         END-IF                                                   04640040
046500     END-IF.                                                      04650040
047308                                                                  04730852
047309     MOVE BC001-PHONE            TO WS-PHONE.                     04730952
047310     IF WS-PHONE2                = SPACES OR ZEROES               04731052
047311         MOVE SPACES             TO BC001-PHONE                   04731152
047312     END-IF.                                                      04731252
047313                                                                  04731352
047314     MOVE BC001-EMERGENCY-CONTACT-PHONE1 TO WS-PHONE.             04731452
047315     IF WS-PHONE2                = SPACES OR ZEROES               04731552
047316         MOVE SPACES             TO BC001-EMERGENCY-CONTACT-PHONE104731652
047317     END-IF.                                                      04731752
047318                                                                  04731852
047319     MOVE BC001-EMERGENCY-CONTACT-PHONE2 TO WS-PHONE.             04731952
047320     IF WS-PHONE2                = SPACES OR ZEROES               04732052
047321         MOVE SPACES             TO BC001-EMERGENCY-CONTACT-PHONE204732152
047322     END-IF.                                                      04732252
047330                                                                  04733052
047400******************                                                04740040
047500 D001-CHECK-PHONE.                                                04750040
047600******************                                                04760040
047610     MOVE BC001-PHONE            TO WS-PHONE.                     04761041
047620     IF WS-PHONE2                = SPACES OR ZEROES               04762040
047623         MOVE SPACES             TO BC001-PHONE                   04762341
047627     END-IF.                                                      04762740
047628                                                                  04762840
047629     MOVE BC001-WORK-PHONE       TO WS-PHONE.                     04762941
047630     IF WS-PHONE2                = SPACES OR ZEROES               04763041
047631         MOVE SPACES             TO BC001-WORK-PHONE              04763141
047632     END-IF.                                                      04763241
047633                                                                  04763341
047634     MOVE BC001-CELL-PHONE       TO WS-PHONE.                     04763441
047635     IF WS-PHONE2                = SPACES OR ZEROES               04763541
047636         MOVE SPACES             TO BC001-CELL-PHONE              04763641
047637     END-IF.                                                      04763740
047638                                                                  04763841
047639     MOVE BC001-EMERGENCY-CONTACT-PHONE1 TO WS-PHONE.             04763941
047640     IF WS-PHONE2                = SPACES OR ZEROES               04764041
047641         MOVE SPACES             TO BC001-EMERGENCY-CONTACT-PHONE104764141
047642     END-IF.                                                      04764241
047643                                                                  04764341
047644     MOVE BC001-EMERGENCY-CONTACT-PHONE2 TO WS-PHONE.             04764441
047645     IF WS-PHONE2                = SPACES OR ZEROES               04764541
047646         MOVE SPACES             TO BC001-EMERGENCY-CONTACT-PHONE204764641
047647     END-IF.                                                      04764741
047676                                                                  04767654
047677*******************                                               04767754
047678 D100-WRITE-OUTPUT.                                               04767854
047680*******************                                               04768041
047700     WRITE MERGED-REC FROM BC001-MERGED-RECORD.                   04770000
047800     ADD +1 TO PT-MERGED-RCDS-WRITTEN.                            04780042
