000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300******************************************************************00030099
000400                                                                  00040099
000500 PROGRAM-ID.             SUKRF512.                                00050099
000600 AUTHOR.                 MICHAEL WALTERS.                         00060099
000700 INSTALLATION.           KOHLS.                                   00070099
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080099
000900 DATE-COMPILED.                                                   00090099
001000                                                                  00100099
001100******************************************************************00110099
001200* THIS PROGRAM DISPLAYS THE CARTON CONTINUATION SCREEN            00120099
001300******************************************************************00130099
001400* 10/20/13 - JIM ARENDT   - CHG0068598                            00140099
001500* - CHANGED PROGRAM TO ALLOW IT TO PROCESS 2 AUDITS WHEN A        00150099
001600*   COMBINED (QC AND RFID) AUDIT IS BEING PERFORMED FOR A CARTON. 00160099
001700******************************************************************00170099
001710***RLK 04/14 BEG                                                  00171099
001720* 004/14/14 - RICH KELLEN - CHG0078145                            00172099
001730* - CHANGED PROGRAM TO SET SU006-AUD-ERR ON IN PARA 4190 WHEN     00173099
001740*   A TYPE '42' EXCEPTION IS CREATED.                             00174099
001750***RLK 04/14 END                                                  00175099
001760******************************************************************00176099
001761* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00176199
001762* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00176299
001763* MAKING THE CALL DYNAMIC VS STATIC.                              00176399
001764******************************************************************00176499
001765                                                                  00176599
001766******************************************************************00176699
001767 ENVIRONMENT DIVISION.                                            00176799
001768******************************************************************00176899
001769                                                                  00176999
001770******************************************************************00177099
001780 DATA DIVISION.                                                   00178099
001790******************************************************************00179099
001800                                                                  00180099
001900******************************************************************00190099
002000 WORKING-STORAGE SECTION.                                         00200099
002100******************************************************************00210099
002200 01  CA-COMMAREA.                                                 00220099
002300     COPY SUWS006.                                                00230099
002400    05  CA-PROGRAM-COMMAREA.                                      00240099
002500         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACES.00250099
002600         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00260099
002700                                         PIC  9(01).              00270099
002800             88  CA-VALID-SELECTION      VALUE                    00280099
002900                        1 2 3 4.                                  00290099
003000             88  CA-CONTINUE-SELECTION   VALUE 1.                 00300099
003100             88  CA-CLOSE-SELECTION      VALUE 2.                 00310099
003200             88  CA-RESTART-SELECTION    VALUE 3.                 00320099
003300             88  CA-PRINT-SELECTION      VALUE 4.                 00330099
003400         10  CA-CONFIRM-SW               PIC X(01)  VALUE SPACE.  00340099
003500             88  CA-CONFIRMED            VALUE 'C'.               00350099
003600             88  CA-IN-CONFIRM-STATE     VALUE 'Y'.               00360099
003700             88  CA-NOT-IN-CONFIRM-STATE VALUE 'N'.               00370099
003800     05  CA-PRTR-CNTL-IND                PIC  X(01).              00380099
003900     05  CA-TRACK-NBR                    PIC  9(01).              00390099
004000     05  CA-SYSTEM-ID.                                            00400099
004100         10  FILLER              PIC  X(04)   VALUE SPACE.        00410099
004200         10  CA-REGION-IND       PIC  X(01).                      00420099
004300             88  CA-TEST-CICS                 VALUE 'T'.          00430099
004400             88  CA-QA-CICS                   VALUE 'Q'.          00440099
004500             88  CA-PROD-CICS                 VALUE 'P'.          00450099
004600             88  CA-LEARN-CICS                VALUE 'L'.          00460099
004700         10  FILLER              PIC X(03)    VALUE SPACES.       00470099
004800     05  CA-OVER-SHORT-IND               PIC  X(01).              00480099
004900         88  CA-OVER-SHORT                    VALUE 'Y'.          00490099
005000         88  CA-OVER-SHORT-FALSE              VALUE 'Y'.          00500099
005100                                                                  00510099
005200 01  DK-DB2-KEYS.                                                 00520099
005300     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00530099
005400     05  DK-AUDIT-CNTL-NBR-X             PIC  X(09) VALUE SPACE.  00540099
005500     05  DK-SHIP-UNIT-NBR                PIC S9(18) COMP-3.       00550099
005600     05  DK-SUQADJ-SHIPT-UNT-ID          PIC S9(18) COMP-3.       00560099
005700     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00570099
005800     05  DK-LOC-ID                       PIC  S9(4) COMP.         00580099
005900                                                                  00590099
005910     05  DK-WST-RPT-NAME                 PIC X(050) VALUE SPACE.  00591099
005920     05  DK-WST-RPT-NBR                  PIC X(015) VALUE SPACE.  00592099
005930     05  DK-WST-JOB                      PIC X(008) VALUE SPACE.  00593099
005940     05  DK-WST-AC-IN                    PIC X(002) VALUE SPACE.  00594099
005950     05  DK-WST-PROG-NBR                 PIC X(008) VALUE SPACE.  00595099
005960     05  DK-WST-MENU-SEQ                 PIC  S9(9) COMP.         00596099
005970                                                                  00597099
006000 01  SE-SYSTEM-ERROR-MESSAGE.                                     00600099
006100     05  FILLER                  PIC X(43)    VALUE               00610099
006200         'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.           00620099
006300     05  FILLER                  PIC X(31)    VALUE               00630099
006400         'PROGRAM SUKRF512     EIBRESP = '.                       00640099
006500     05  SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.         00650099
006600     05  FILLER                  PIC X(2)     VALUE SPACES.       00660099
006700     05  FILLER                  PIC X(14)    VALUE               00670099
006800         'ATTEMPTING TO '.                                        00680099
006900     05  SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.       00690099
007000*                                                                 00700099
007100 01  PC-PROGRAM-CONSTANTS.                                        00710099
007200     05  PC-SUKUT701                 PIC X(08) VALUE 'SUKUT701'.  00720099
007300     05  PC-CARTON                   PIC X(08) VALUE 'CARTON  '.  00730099
007400     05  PC-AUDIT                    PIC X(08) VALUE 'AUDIT   '.  00740099
007500     05  PC-01                           PIC  X(02)  VALUE '01'.  00750099
007600     05  PC-A                            PIC  X(01)  VALUE 'A'.   00760099
007700     05  PC-STARTED-STATUS               PIC  X(18)  VALUE        00770099
007800         'IS ALREADY STARTED'.                                    00780099
007900     05  PC-CLOSED-STATUS                PIC  X(18)  VALUE        00790099
008000         'IS ALREADY CLOSED '.                                    00800099
008100     05  PC-AUDIT-NO-LONGER-NEEDED-MSG   PIC  X(19)  VALUE        00810099
008200         'AUDIT COMPLETE     '.                                   00820099
008300     05  PC-POSTPONE-TRY-AGAIN-MSG       PIC  X(19)  VALUE        00830099
008400         'POSTPONE/TRY AGAIN '.                                   00840099
008500     05  PC-CLOSED-W-FAILED-ADJ-MSG      PIC  X(19)  VALUE        00850099
008600         'CLOSED W/FAILED ADJ'.                                   00860099
008700     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        00870099
008800         'SUKRP002'.                                              00880099
008900     05  PC-RETURN-PGM                   PIC  X(08)  VALUE        00890099
009000         'SUKRF511'.                                              00900099
009100     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        00910099
009200         'DPKCS060'.                                              00920099
009300     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00930099
009400         'SUKRF512'.                                              00940099
009500     05  PC-UPC-SCAN-PROGRAM-NAME        PIC  X(08)  VALUE        00950099
009600         'SUKRF518'.                                              00960099
009700     05  PC-PREPK-QTY-SCREEN-PROGRAM     PIC  X(08)  VALUE        00970099
009800         'SUKRF540'.                                              00980099
009900     05  PC-PRINT-PROGRAM-NAME           PIC  X(08)  VALUE        00990099
010000         'SUKRF523'.                                              01000099
010100     05  PC-MESSAGE-SCREEN-PROGRAM-NAME  PIC  X(08)  VALUE        01010099
010200         'SUKRF514'.                                              01020099
010300     05  PC-AUDIT-STATUS-PROGRAM         PIC  X(08)  VALUE        01030099
010400         'SUKRF536'.                                              01040099
010500     05  PC-COMMON-CARTON-CLOSE-PGM      PIC  X(08)  VALUE        01050099
010600         'SUKCS769'.                                              01060099
010700     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S512'.01070099
010800     05  PC-INVALID-CLOSE-STATUS-MSG     PIC  X(19)  VALUE        01080099
010900         'NO CRTN ITMS SCANED'.                                   01090099
011000     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01100099
011100         'TRANS NOT AVAILABLE'.                                   01110099
011200     05  PC-CCC-PARM-ERR-MSG             PIC  X(19)  VALUE        01120099
011300         'PARM ERROR-SUKCS769'.                                   01130099
011400     05  PC-CCC-DB2-ERR-MSG              PIC  X(19)  VALUE        01140099
011500         'DB2  ERROR-SUKCS769'.                                   01150099
011600     05  PC-CCC-MQ-ERR-MSG               PIC  X(19)  VALUE        01160099
011700         'MQ   ERROR-SUKCS769'.                                   01170099
011800     05  PC-CCC-OTHR-ERR-MSG             PIC  X(19)  VALUE        01180099
011900         'OTHR ERROR-SUKCS769'.                                   01190099
011910     05  PC-PRINT-TO-FILE                PIC  X(04) VALUE 'FILE'. 01191099
011920     05  PC-PRINT-TO-FILE-ERR-MSG   PIC X(19) VALUE               01192099
011930                                           'PRT-TO-FILE INVALID'. 01193099
011940     05  PC-REPORT-TO-FILE-ERR-MSG  PIC X(19) VALUE               01194099
011950                                           'RPT-TO-FILE UNAVAIL'. 01195099
011960                                                                  01196099
012000                                                                  01200099
012100 01  PS-PROGRAM-SWITCHES.                                         01210099
012200     05  PS-CARTON-ALREADY-COMPLETE-SW  PIC X(01)    VALUE 'N'.   01220099
012300         88  PS-CARTON-ALREADY-COMPLETE              VALUE 'Y'.   01230099
012400         88  PS-CARTON-NOT-ALREADY-COMPLETE          VALUE 'N'.   01240099
012500     05  PS-PRIOR-ADJUSTMENTS-SW        PIC X(01)    VALUE 'N'.   01250099
012600         88  PS-PRIOR-ADJUSTMENTS                    VALUE 'Y'.   01260099
012700         88  PS-NO-PRIOR-ADJUSTMENTS                 VALUE 'N'.   01270099
012800     05  PS-OUTBOUND-CARTON-SW          PIC X(01)    VALUE 'Y'.   01280099
012900         88  PS-OUTBOUND-CARTON                      VALUE 'Y'.   01290099
013000         88  PS-NO-OUTBOUND-CARTON                   VALUE 'N'.   01300099
013100     05  PS-MANIFESTING-DC-SW           PIC X(01)    VALUE 'N'.   01310099
013200         88  PS-MANIFESTING-DC                       VALUE 'Y'.   01320099
013300         88  PS-NOT-MANIFESTING-DC                   VALUE 'N'.   01330099
013400     05  PS-CARTON-ADJUST-DC-SW         PIC X(01)    VALUE 'N'.   01340099
013500         88  PS-CARTON-ADJUST-DC                     VALUE 'Y'.   01350099
013600         88  PS-NOT-CARTON-ADJUST-DC                 VALUE 'N'.   01360099
013700     05  PS-PRINT-REPORT-SW             PIC X(01)    VALUE 'N'.   01370099
013800         88  PS-DO-PRINT-REPORT                      VALUE 'Y'.   01380099
013900         88  PS-DO-NOT-PRINT-REPORT                  VALUE 'N'.   01390099
014000     05  PS-CARTON-UPC-CURSOR-IND        PIC  X(01)  VALUE 'N'.   01400099
014100         88  PS-NOT-EOC-CARTON-UPC-CURSOR            VALUE 'N'.   01410099
014200         88  PS-EOC-CARTON-UPC-CURSOR                VALUE 'Y'.   01420099
014300     05  PS-AUDIT-UPC-CURSOR-IND         PIC  X(01)  VALUE 'N'.   01430099
014400         88  PS-NOT-EOC-AUDIT-UPC-CURSOR             VALUE 'N'.   01440099
014500         88  PS-EOC-AUDIT-UPC-CURSOR                 VALUE 'Y'.   01450099
014600     05  PS-SYSTEM-AUDIT-FOUND-SW       PIC X(01)    VALUE 'N'.   01460099
014700         88  PS-SYSTEM-AUDIT-NOT-FOUND               VALUE 'N'.   01470099
014800         88  PS-SYSTEM-AUDIT-FOUND                   VALUE 'Y'.   01480099
014900     05  PS-ABEND-IND                   PIC X(01)    VALUE 'N'.   01490099
015000         88  PS-NO-ABEND-IN-PROGRESS                 VALUE 'N'.   01500099
015100         88  PS-ABEND-IN-PROGRESS                    VALUE 'Y'.   01510099
015200     05  PS-INTERNAL-READER-ENQ-DEQ-IND                           01520099
015300                                        PIC X(01)    VALUE 'D'.   01530099
015400         88  PS-INTERNAL-READER-ENQUEUED             VALUE 'E'.   01540099
015500         88  PS-INTERNAL-READER-DEQUEUED             VALUE 'D'.   01550099
015600     05  PS-OPEN-CARTONS-IND             PIC  X(01)  VALUE 'N'.   01560099
015700         88  PS-OPEN-CARTONS                         VALUE 'Y'.   01570099
015800         88  PS-NO-OPEN-CARTONS                      VALUE 'N'.   01580099
015900     05  PS-CTN-EXCEPT-IND               PIC  X(01)  VALUE 'N'.   01590099
016000         88  PS-CTN-EXCEPT-EXIST                     VALUE 'Y'.   01600099
016100         88  PS-CTN-EXCEPT-DONT-EXIST                VALUE 'N'.   01610099
016200     05  PS-EXCEPTION-IND                PIC  X(01)  VALUE 'N'.   01620099
016300         88  PS-EXCEPTION-FOUND                      VALUE 'Y'.   01630099
016400         88  PS-NO-EXCEPTION-FOUND                   VALUE 'N'.   01640099
016500     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01650099
016600         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01660099
016700         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01670099
016800     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   01680099
016900         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   01690099
017000         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   01700099
017100     05  PS-OVER-SHORT-IND               PIC  X(01)  VALUE 'N'.   01710099
017200         88  PS-OVER-SHORT-ERROR                     VALUE 'Y'.   01720099
017300         88  PS-NO-OVER-SHORT-ERROR                  VALUE 'N'.   01730099
017400     05  PS-CARTON-ITEM-CURSOR-IND       PIC  X(01)  VALUE 'N'.   01740099
017500         88  PS-NOT-EOC-CARTON-ITEM-CURSOR           VALUE 'N'.   01750099
017600         88  PS-EOC-CARTON-ITEM-CURSOR               VALUE 'Y'.   01760099
017700     05  PS-AUDIT-ITEM-CURSOR-IND        PIC  X(01)  VALUE 'N'.   01770099
017800         88  PS-NOT-EOC-AUDIT-ITEM-CURSOR            VALUE 'N'.   01780099
017900         88  PS-EOC-AUDIT-ITEM-CURSOR                VALUE 'Y'.   01790099
018000     05  PS-DLX-LIVE-INTERFACE-IND       PIC  X(01)  VALUE 'N'.   01800099
018100         88  PS-DLX-LIVE-INTERFACE                   VALUE 'Y'.   01810099
018200         88  PS-DLX-NOT-LIVE-INTERFACE               VALUE 'N'.   01820099
018300     05  PS-CALLED-MODULE-IND            PIC  X(01)  VALUE 'N'.   01830099
018400         88  PS-CALLED-MODULE-OK                     VALUE 'Y'.   01840099
018500         88  PS-CALLED-MODULE-NOT-OK                 VALUE 'N'.   01850099
018600     05  PS-PRCS-SEC-AUDIT-SW            PIC  X(01)  VALUE 'F'.   01860099
018700         88  PS-PRCS-FIRST-AUDIT                     VALUE 'F'.   01870099
018800         88  PS-PRCS-SEC-AUDIT                       VALUE 'S'.   01880099
018900     05  PS-SCAN-CURSOR-IND              PIC  X(01)  VALUE 'N'.   01890099
019000         88  PS-NOT-EOC-SCAN-CURSOR                  VALUE 'N'.   01900099
019100         88  PS-EOC-SCAN-CURSOR                      VALUE 'Y'.   01910099
019110     05  PS-PRINT-TO-FILE-SW             PIC  X(01)  VALUE 'N'.   01911099
019120         88  PS-PRINT-TO-FILE-NO                     VALUE 'N'.   01912099
019130         88  PS-PRINT-TO-FILE-YES                    VALUE 'Y'.   01913099
019140     05  PS-REPORT-TO-FILE-SW            PIC  X(01)  VALUE 'N'.   01914099
019150         88  PS-REPORT-TO-FILE-NO                    VALUE 'N'.   01915099
019160         88  PS-REPORT-TO-FILE-YES                   VALUE 'Y'.   01916099
019200                                                                  01920099
019300 01  PV-PROGRAM-VARIABLES.                                        01930099
019400     05  PV-BRCDE-NBR                    PIC X(22).               01940099
019500     05  FILLER REDEFINES PV-BRCDE-NBR.                           01950099
019600         10  PV-BRCDE-NBR-FILLER-1       PIC  X(02).              01960099
019700         10  PV-BRCDE-NBR-N              PIC  9(18).              01970099
019800         10  PV-BRCDE-NBR-FILLER-2       PIC  X(02).              01980099
019900     05  PV-SAVE-SHIP-UNIT-STATUS        PIC  X(02).              01990099
020000     05  PV-DISP-COUNTS                  PIC 9(09).               02000099
020100     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACE. 02010099
020200     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   02020099
020300                                                     COMP SYNC.   02030099
020400     05  PV-DB2-COUNT                    PIC S9(09)  VALUE ZERO   02040099
020500                                                     COMP.        02050099
020600     05  PV-SCN-QTY                      PIC S9(09)  VALUE ZERO   02060099
020700                                                     COMP.        02070099
020800     05  PV-TOTAL-SCND-UNT-QTY           PIC S9(09)  VALUE ZERO   02080099
020900                                                     COMP.        02090099
021000     05  PV-SUQADJ-COUNT                 PIC S9(09)  VALUE ZERO   02100099
021100                                                     COMP.        02110099
021200     05  PV-ITEM-COUNT-CARTON            PIC S9(04)  VALUE ZERO   02120099
021300                                                     COMP.        02130099
021400     05  PV-ITEM-COUNT-AUDIT             PIC S9(04)  VALUE ZERO   02140099
021500                                                     COMP.        02150099
021600     05  PV-OPENED-DAYS                  PIC S9(04)  VALUE ZERO   02160099
021700                                                     COMP.        02170099
021800     05  PV-OPENED-HOURS                 PIC S9(02)  VALUE ZERO   02180099
021900                                                     COMP.        02190099
022000     05  PV-OPENED-MINUTES               PIC S9(02)  VALUE ZERO   02200099
022100                                                     COMP.        02210099
022200     05  PV-TOTAL-OPENED-MINUTES         PIC S9(09)  VALUE ZERO   02220099
022300                                                     COMP.        02230099
022400     05  PV-CLOSED-DAYS                  PIC S9(04)  VALUE ZERO   02240099
022500                                                     COMP.        02250099
022600     05  PV-CLOSED-HOURS                 PIC S9(02)  VALUE ZERO   02260099
022700                                                     COMP.        02270099
022800     05  PV-CLOSED-MINUTES               PIC S9(02)  VALUE ZERO   02280099
022900                                                     COMP.        02290099
023000     05  PV-TOTAL-CLOSED-MINUTES         PIC S9(09)  VALUE ZERO   02300099
023100                                                     COMP.        02310099
023200     05  PV-SCND-UNT-QTY                 PIC  S9(9)  COMP.        02320099
023300     05  PV-AUDIT-UPC-NBR                PIC  S9(15)V COMP-3.     02330099
023400     05  PV-AUDIT-SHPD-QTY               PIC  S9(9)V COMP-3.      02340099
023500     05  PV-CARTON-UPC-NBR               PIC  S9(15)V COMP-3.     02350099
023600     05  PV-CARTON-SHPD-QTY              PIC  S9(9)V COMP-3.      02360099
023700     05  PV-SCN-QTY-SHRT                 PIC 9(04)   VALUE ZERO.  02370099
023800     05  PV-DISPLAY-UPC-NBR              PIC   9(15).             02380099
023900     05  PV-DISPLAY-NUMBER               PIC   9(09).             02390099
024000     05  PV-DISPLAY-SQLCODE              PIC  -9(03).             02400099
024100     05  PV-DISPLAY-OPER                 PIC   9(05).             02410099
024200     05  PV-BLANKS                       PIC X(40) VALUE SPACES.  02420099
024300     05  PV-DISPLAY-KEYS.                                         02430099
024400         10 FILLER                       PIC X(12)                02440099
024500            VALUE 'KEY VALUES: '.                                 02450099
024600         10 PV-DISP-AUD-CNTL-NBR         PIC 9(09).               02460099
024700         10 FILLER                       PIC X(04)                02470099
024800            VALUE ' -- '.                                         02480099
024900         10 PV-DISP-SHIPT-UNT-ID         PIC 9(18).               02490099
025000         10 FILLER                       PIC X(04)                02500099
025100            VALUE ' -- '.                                         02510099
025200         10 PV-DISP-UPC-NBR              PIC 9(15).               02520099
025300         10 FILLER                       PIC X(04)                02530099
025400            VALUE ' -- '.                                         02540099
025500         10 PV-DISP-SCN-TMST             PIC X(26).               02550099
025600     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 02560099
025700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 02570099
025800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02580099
025900                                                     COMP SYNC.   02590099
026000     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 02600099
026100     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  02610099
026200                                                     COMP.        02620099
026300     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  02630099
026400                                                     COMP.        02640099
026500     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   02650099
026600                                                     COMP.        02660099
026700     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   02670099
026800                                                     COMP SYNC.   02680099
026900     05  PV-EXPECT-INTR-UPC              PIC  S9(9)  COMP.        02690099
027000     05  PV-AUDIT-HOLD-UPC-NBR           PIC  S9(15)V COMP-3.     02700099
027100     05  PV-EXPECT-HOLD-UPC-NBR          PIC  S9(15)V COMP-3.     02710099
027200     05  PV-INTR-UPC                     PIC   9(9).              02720099
027300     05  PV-AUDIT-INTR-UPC               PIC  S9(9)  COMP.        02730099
027400     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02740099
027500     05  PV-COMP-UPC-NBR                 PIC  S9(15)V COMP-3.     02750099
027600     05  PV-COMP-UPC-NBR2                PIC  S9(15)V COMP-3.     02760099
027700     05  PV-COMP-SCAN-QTY                PIC  S9(9)V COMP-3.      02770099
027800     05  PV-COMP-TAG-QTY                 PIC  S9(9)V COMP-3.      02780099
027810                                                                  02781099
027820     05  PV-WST-SEQ                      PIC S9(9) COMP.          02782099
027830     05  PV-WST-RPT-NAME                 PIC  X(50) VALUE SPACE.  02783099
027840     05  PV-WST-RPT-NBR                  PIC  X(15) VALUE SPACE.  02784099
027850     05  PV-WST-JOB                      PIC  X(08) VALUE SPACE.  02785099
027860     05  PV-WST-AC-IN                    PIC  X(02) VALUE SPACE.  02786099
027870     05  PV-WST-PROG-NBR                 PIC  X(08) VALUE SPACE.  02787099
027880     05  PV-WST-MENU-SEQ                 PIC S9(10)V9(5) COMP-3.  02788099
027890                                                                  02789099
027900*                                                                 02790099
028000******************************************************************02800099
028100*  JCL LINES FOR REQUESTING THE VARIOUS REPORT                    02810099
028200******************************************************************02820099
028300 01  JL-JCL-LINE-AREA.                                            02830099
028400     05  JL-JCL-LINE-1           PIC X(80).                       02840099
028500     05  JL-JOB-LINE-PROD.                                        02850099
028600         10  FILLER              PIC X(02)    VALUE               02860099
028700             '//'.                                                02870099
028800         10  JL-JOB-NAME         PIC X(08).                       02880099
028900         10  FILLER              PIC X(11)    VALUE               02890099
029000             ' JOB KOHLS,'.                                       02900099
029100         10  FILLER              PIC X(1)     VALUE QUOTE.        02910099
029200         10  JL-JOB-DESC         PIC X(13).                       02920099
029300         10  FILLER              PIC X(1)     VALUE QUOTE.        02930099
029400         10  FILLER              PIC X(19)    VALUE               02940099
029500             ',MSGCLASS=P,CLASS=Q'.                               02950099
029600         10  FILLER              PIC X(16)    VALUE SPACES.       02960099
029700     05  JL-JOB-LINE-TEST.                                        02970099
029800         10  FILLER              PIC X(02)    VALUE               02980099
029900             '//'.                                                02990099
030000         10  JL-TEST-JOB-NAME    PIC X(07)    VALUE SPACES.       03000099
030100         10  FILLER              PIC X(01)    VALUE               03010099
030200             'Q'.                                                 03020099
030300         10  FILLER              PIC X(11)    VALUE               03030099
030400             ' JOB KOHLS,'.                                       03040099
030500         10  FILLER              PIC X(1)     VALUE QUOTE.        03050099
030600         10  JL-TEST-JOB-DESC    PIC X(13).                       03060099
030700         10  FILLER              PIC X(1)     VALUE QUOTE.        03070099
030800         10  FILLER              PIC X(19)    VALUE               03080099
030900             ',MSGCLASS=X,CLASS=E'.                               03090099
031000         10  FILLER              PIC X(08)    VALUE               03100099
031100             ',NOTIFY='.                                          03110099
031200         10  JL-TEST-NOTIFY      PIC X(07)    VALUE SPACES.       03120099
031300         10  FILLER              PIC X(03)    VALUE SPACES.       03130099
031400     05  JL-JCL-LINE-3.                                           03140099
031500         10  FILLER              PIC X(13)    VALUE               03150099
031600             '/*JOBPARM K=0'.                                     03160099
031700         10  FILLER              PIC X(67)    VALUE SPACES.       03170099
031800     05  JL-JCL-LINE-4-PROD.                                      03180099
031900         10  FILLER              PIC X(39)    VALUE               03190099
032000             '//JOBLIB   DD DSN=PKMO.LOADLIB,DISP=SHR'.           03200099
032100         10  FILLER              PIC X(41)    VALUE SPACES.       03210099
032200     05  JL-JCL-LINE-4-TEST.                                      03220099
032300         10  FILLER              PIC X(39)    VALUE               03230099
032400             '//JOBLIB   DD DSN=TKMA.LOADLIB,DISP=SHR'.           03240099
032500         10  FILLER              PIC X(41)    VALUE SPACES.       03250099
032600                                                                  03260099
032700     05  JL-JCL-LINE-4-QA.                                        03270099
032800         10  FILLER              PIC X(39)    VALUE               03280099
032900             '//JOBLIB   DD DSN=QKMO.LOADLIB,DISP=SHR'.           03290099
033000         10  FILLER              PIC X(41)    VALUE SPACES.       03300099
033100     05  JL-JCL-LINE-4-LEARN.                                     03310099
033200         10  FILLER              PIC X(39)    VALUE               03320099
033300             '//JOBLIB   DD DSN=LKMO.LOADLIB,DISP=SHR'.           03330099
033400         10  FILLER              PIC X(41)    VALUE SPACES.       03340099
033500     05  JL-JCL-LINE-12.                                          03350099
033600         10  FILLER              PIC X(16)    VALUE               03360099
033700             '//PS020    EXEC '.                                  03370099
033800         10  JL-PROC-NAME        PIC X(08).                       03380099
033900         10  FILLER              PIC X(56)    VALUE SPACES.       03390099
034000     05  JL-JCL-LINE-13.                                          03400099
034100         10  FILLER              PIC  X(34)  VALUE                03410099
034200             '//JOBOUT01 OUTPUT FORMS=STD,FCB=8S'.                03420099
034300         10  FILLER              PIC  X(17)  VALUE                03430099
034400             ',CLASS=A,COPIES=1'.                                 03440099
034500         10  FILLER              PIC  X(06)  VALUE                03450099
034600             ',DEST='.                                            03460099
034700         10  JL-LINE-13-PRINTER  PIC  X(08)  VALUE SPACES.        03470099
034800         10  FILLER              PIC  X(16)  VALUE SPACE.         03480099
034900                                                                  03490099
035600     05  JL-SYSUT1-PARM-LINE.                                     03560099
035700         10  FILLER              PIC X(02)    VALUE               03570099
035800             '//'.                                                03580099
035900         10  JL-SYSUT1-STEP      PIC X(04)    VALUE SPACE.        03590099
036000         10  FILLER              PIC X(12)    VALUE               03600099
036100             '.SYSUT1 DD *'.                                      03610099
036200         10  FILLER              PIC X(62)    VALUE SPACES.       03620099
036300     05  JL-SYSUT1-PARM-VALUE    PIC X(80)    VALUE SPACES.       03630099
036400     05  JL-JCL-LINE-EOF.                                         03640099
036500         10  FILLER              PIC X(5)     VALUE '/*EOF'.      03650099
036600         10  FILLER              PIC X(75)    VALUE SPACES.       03660099
036700                                                                  03670099
036800 01  JL-SYSUT1-VALUES.                                            03680099
036900     05  JL-SYSUT1-AUD-CNTL-LINE.                                 03690099
037000         10  JL-SYSUT1-AUD-CNTL-NBR                               03700099
037100                                 PIC 9(09).                       03710099
037200         10  JL-SYSUT1-SHIP-UNT-NBR                               03720099
037300                                 PIC 9(18).                       03730099
037400                                                                  03740099
037500         10  JL-SYSTEM-MANUAL-AUDIT                               03750099
037600                                 PIC X(01)    VALUE SPACES.       03760099
037700             88  JL-SYSTEM-GENERATED-AUDIT    VALUE 'S'.          03770099
037800             88  JL-MANUAL-GENERATED-AUDIT    VALUE 'M'.          03780099
037900         10  JL-RFID-QC-AUDIT-IND                                 03790099
038000                                 PIC X(01)    VALUE SPACES.       03800099
038100             88  JL-RFID-AUDIT                VALUE 'R'.          03810099
038110             88  JL-QC-AUDIT                  VALUE 'S'.          03811099
038120         10  JL-RFID-QC-AUD-CMB-IND                               03812099
038130                                 PIC X(01)    VALUE SPACES.       03813099
038140             88  JL-RFID-AUD-ONLY             VALUE 'R'.          03814099
038150             88  JL-QC-AUD-ONLY               VALUE 'S'.          03815099
038160             88  JL-QC-AND-RFID-AUD           VALUE 'B'.          03816099
038170                                                                  03817099
038180         10  FILLER              PIC X(50)    VALUE SPACES.       03818099
038190     05  JL-SYSUT1-PRT-LINE.                                      03819099
038200         10  JL-SYSUT1-PRINTER   PIC X(08)    VALUE SPACES.       03820099
038300         10  JL-SYSUT1-PRTR-IND  PIC X(01)    VALUE SPACES.       03830099
038400         10  JL-SYSUT1-TRACK-NBR PIC  9(1)    VALUE 0.            03840099
038500                                                                  03850099
038600         10  JL-SYSUT1-BRCDE-IND PIC X(01)    VALUE SPACES.       03860099
038700         10  JL-SYSUT1-CUT-IND   PIC X(01)    VALUE SPACES.       03870099
038800         10  FILLER              PIC X(68)    VALUE SPACES.       03880099
038900                                                                  03890099
039000 01  TD-TRANSIENT-DATA-AREA.                                      03900099
039100     05  TD-QUEUE-NAME           PIC X(4)     VALUE 'IRTD'.       03910099
039200     05  TD-QUEUE-NAME-LENGTH    PIC S9(4)    VALUE +4            03920099
039300                                 COMP SYNC.                       03930099
039400     05  TD-JCL-LINE             PIC X(80)    VALUE SPACES.       03940099
039500     05  TD-JCL-LINE-LENGTH      PIC S9(4)    VALUE +80           03950099
039600                                 COMP SYNC.                       03960099
039700                                                                  03970099
039800*                                                                 03980099
039900 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  03990099
040000     05  TS-INFO-QUEUE-NAME.                                      04000099
040100         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 04010099
040200         10  FILLER                      PIC  X(04)  VALUE 'INFO'.04020099
040300                                                                  04030099
040400                                                                  04040099
040500*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      04050099
040600******************************************************************04060099
040700     COPY DFHAID.                                                 04070099
040800                                                                  04080099
040900******************************************************************04090099
041000* COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE              * 04100099
041100******************************************************************04110099
041200     COPY XLWS001.                                                04120099
041300                                                                  04130099
041400******************************************************************04140099
041500*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                04150099
041600******************************************************************04160099
041700     COPY DPWS013.                                                04170099
041800                                                                  04180099
041900******************************************************************04190099
042000*  SENDING/RECEIVING AREA FOR THE                                 04200099
042100*  PRINTER VALIDATION ROUTING (DPKCS060)                          04210099
042200******************************************************************04220099
042300     COPY DPWS072.                                                04230099
042400                                                                  04240099
042500******************************************************************04250099
042600*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        04260099
042700******************************************************************04270099
042800     COPY DPWS008.                                                04280099
042900                                                                  04290099
043000******************************************************************04300099
043100*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 04310099
043200******************************************************************04320099
043300     COPY DPWS010I.                                               04330099
043400                                                                  04340099
043500******************************************************************04350099
043600*  RANDOM NUMBER AREA.                                            04360099
043700******************************************************************04370099
043800     COPY DPWS902.                                                04380099
043900                                                                  04390099
044000******************************************************************04400099
044100*  GENERATED DSECT FOR THE SUKM512 MAPSET                         04410099
044200******************************************************************04420099
044300     COPY SUKM512.                                                04430099
044400                                                                  04440099
044500     COPY SUWS034.                                                04450099
044600/                                                                 04460099
044700******************************************************************04470099
044800*    COMMON CARTON CLOSE COMMUNICATION AREA                       04480099
044900******************************************************************04490099
045000     COPY SUWS091.                                                04500099
045100/                                                                 04510099
045200******************************************************************04520099
045300*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   04530099
045400******************************************************************04540099
045500     COPY DPWS015.                                                04550099
045600                                                                  04560099
045700*----------------------------------------------------------------*04570099
045800* HELP SCREEN COMMAREA                                            04580099
045900     COPY PCWS192.                                                04590099
046000*----------------------------------------------------------------*04600099
046100* HELP SCREEN WORK AREA                                           04610099
046200     COPY PCWS188.                                                04620099
046300                                                                  04630099
046400*----------------------------------------------------------------*04640099
046500*         DLKUP001 COMMAREA                                       04650099
046600*----------------------------------------------------------------*04660099
046700     COPY DLWS001.                                                04670099
046800                                                                  04680099
046900*----------------------------------------------------------------*04690099
047000*         DLKUT001 COMMAREA                                       04700099
047100*----------------------------------------------------------------*04710099
047200     COPY DLWS003.                                                04720099
047300                                                                  04730099
047400*----------------------------------------------------------------*04740099
047500*         DLWS011 COPYBOOK                                        04750099
047600*----------------------------------------------------------------*04760099
047700     COPY DLWS011.                                                04770099
047800                                                                  04780099
047900*----------------------------------------------------------------*04790099
048000*         DLKCS410 COMMAREA                                       04800099
048100*----------------------------------------------------------------*04810099
048200     COPY DLWS016.                                                04820099
048300                                                                  04830099
048400*----------------------------------------------------------------*04840099
048500*         XLKUP033 COMMAREA                                       04850099
048600*----------------------------------------------------------------*04860099
048700     COPY XLWS072.                                                04870099
048800                                                                  04880099
048900*----------------------------------------------------------------*04890099
049000*         XLKUP033 COPYBOOK TO DEFINE BUSINESS EVENT DETAILS      04900099
049100*----------------------------------------------------------------*04910099
049200     COPY SUWS050.                                                04920099
049300                                                                  04930099
049400******************************************************************04940099
049500*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      04950099
049600*  TO BE DISPLAYED ON THE LRT                                     04960099
049700******************************************************************04970099
049800     COPY SUWS005.                                                04980099
049900                                                                  04990099
050000******************************************************************05000099
050100*  COPY BOOK CONTAINING MESSAGES USED IN THE MESSAGE SCREEN       05010099
050200*  (SUKRF514)                                                     05020099
050300     COPY SUWS007.                                                05030099
050400                                                                  05040099
050500******************************************************************05050099
050600*  SQL AND COBOL DECLARATIONS FOR THE KOHLS/RETEK PARMS (TKRPRPM) 05060099
050700******************************************************************05070099
050800     EXEC SQL                                                     05080099
050900          INCLUDE TKRPRPM                                         05090099
051000     END-EXEC.                                                    05100099
051100                                                                  05110099
051200******************************************************************05120099
051300*    DB2 AREA FOR THE CHECK IN CROSS REFERENCE TABLE            * 05130099
051400******************************************************************05140099
051500     EXEC SQL                                                     05150099
051600         INCLUDE TSULBXF                                          05160099
051700     END-EXEC.                                                    05170099
051800                                                                  05180099
051900******************************************************************05190099
052000*    DB2 AREA FOR THE AUDIT ADJUSTMENTS TABLE                   * 05200099
052100******************************************************************05210099
052200     EXEC SQL                                                     05220099
052300         INCLUDE TSUQADJ                                          05230099
052400     END-EXEC.                                                    05240099
052500                                                                  05250099
052600******************************************************************05260099
052700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE COMPANY CONTROL    05270099
052800*  TABLE (TCOCNTL)                                                05280099
052900******************************************************************05290099
053000     EXEC SQL                                                     05300099
053100         INCLUDE TCOCNTL                                          05310099
053200     END-EXEC.                                                    05320099
053300                                                                  05330099
053400******************************************************************05340099
053500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05350099
053600*  UPC ASSOCIATION TABLE (TSHUUPC)                                05360099
053700******************************************************************05370099
053800     EXEC SQL                                                     05380099
053900         INCLUDE TSHUUPC                                          05390099
054000     END-EXEC.                                                    05400099
054100                                                                  05410099
054200******************************************************************05420099
054300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05430099
054400*  AUDIT TABLE (TSUNAUD)                                          05440099
054500******************************************************************05450099
054600     EXEC SQL                                                     05460099
054700         INCLUDE TSUNAUD                                          05470099
054800     END-EXEC.                                                    05480099
054900                                                                  05490099
055000******************************************************************05500099
055100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CARTON AUDIT       05510099
055200*  EXCEPTION TABLE (TCTEXCP)                                      05520099
055300******************************************************************05530099
055400     EXEC SQL                                                     05540099
055500         INCLUDE TCTEXCP                                          05550099
055600     END-EXEC.                                                    05560099
055700                                                                  05570099
055800******************************************************************05580099
055900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05590099
056000*  ITEM AUDIT EXCEPTION TABLE (TSUEXCP)                           05600099
056100******************************************************************05610099
056200     EXEC SQL                                                     05620099
056300         INCLUDE TSUEXCP                                          05630099
056400     END-EXEC.                                                    05640099
056500                                                                  05650099
056600******************************************************************05660099
056700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TABLE (XLT_UPC)05670099
056800******************************************************************05680099
056900     EXEC SQL                                                     05690099
057000         INCLUDE XLT00006                                         05700099
057100     END-EXEC.                                                    05710099
057200                                                                  05720099
057300******************************************************************05730099
057400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05740099
057500*  AUDIT TRANSATIONS(CARTONS) TABLE (TSUATRN)                     05750099
057600******************************************************************05760099
057700     EXEC SQL                                                     05770099
057800         INCLUDE TSUATRN                                          05780099
057900     END-EXEC.                                                    05790099
058000                                                                  05800099
058100******************************************************************05810099
058200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      05820099
058300*  AUDIT CONTENT TABLE - UPC'S  (TSUAUPC)                         05830099
058400******************************************************************05840099
058500     EXEC SQL                                                     05850099
058600         INCLUDE TSUAUPC                                          05860099
058700     END-EXEC.                                                    05870099
058800                                                                  05880099
058900******************************************************************05890099
059000*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 05900099
059100******************************************************************05910099
059200     EXEC SQL                                                     05920099
059300         INCLUDE SUT00015                                         05930099
059400     END-EXEC.                                                    05940099
059500                                                                  05950099
059610******************************************************************05961099
059620*    WST_INTGRTN_TYP                                              05962099
059630******************************************************************05963099
059640     EXEC SQL                                                     05964099
059650         INCLUDE WST00008                                         05965099
059660     END-EXEC.                                                    05966099
059670                                                                  05967099
059680******************************************************************05968099
059690*    WST_ATTR_DEFN                                                05969099
059691******************************************************************05969199
059692     EXEC SQL                                                     05969299
059693         INCLUDE WST00009                                         05969399
059694     END-EXEC.                                                    05969499
059695                                                                  05969599
059696******************************************************************05969699
059697*    WST_ATTR_ELEM                                                05969799
059698******************************************************************05969899
059699     EXEC SQL                                                     05969999
059700         INCLUDE WST00010                                         05970099
059701     END-EXEC.                                                    05970199
059702                                                                  05970299
059703******************************************************************05970399
059710*  COMMUNICATIONS AREA FOR DB2                                    05971099
059800******************************************************************05980099
059900     EXEC SQL                                                     05990099
060000         INCLUDE SQLCA                                            06000099
060100     END-EXEC.                                                    06010099
060200                                                                  06020099
060300******************************************************************06030099
060400*  CURSOR DECLARATION TO SELECT ALL THE ITEMS THAT ARE SUPPOSED   06040099
060500*  TO BE ON THE CARTON ALONG WITH THE QUANTITY OF EACH            06050099
060600*  (SUMMED BY INTERNAL UPC ID)                                    06060099
060700******************************************************************06070099
060800     EXEC SQL                                                     06080099
060900         DECLARE CARTON_ITEM_CURSOR CURSOR                        06090099
061000             FOR SELECT                                           06100099
061100                 B.INTR_UPC_ID                                    06110099
061200               , 0                                                06120099
061300               , SUM(A.SHPD_QTY)                                  06130099
061400             FROM TSHUUPC A                                       06140099
061500                , XLT_UPC B                                       06150099
061600             WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR               06160099
061700               AND A.UPC_NBR = B.UPC_NBR                          06170099
061800             GROUP BY B.INTR_UPC_ID                               06180099
061900         UNION                                                    06190099
062000             SELECT                                               06200099
062100                 999999999                                        06210099
062200               , A.UPC_NBR                                        06220099
062300               , SUM(A.SHPD_QTY)                                  06230099
062400             FROM TSHUUPC A                                       06240099
062500             WHERE A.SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR             06250099
062600               AND NOT EXISTS                                     06260099
062700              (SELECT  *                                          06270099
062800                 FROM XLT_UPC B                                   06280099
062900                 WHERE B.UPC_NBR = A.UPC_NBR)                     06290099
063000             GROUP BY A.UPC_NBR                                   06300099
063100         ORDER BY 1,2                                             06310099
063200     END-EXEC.                                                    06320099
063300                                                                  06330099
063400******************************************************************06340099
063500*  CURSOR DECLARATION TO SELECT ALL THE ITEMS THAT HAVE BEEN      06350099
063600*  SCANNED INTO THE AUDIT ALONG WITH THE QUANTITY OF EACH         06360099
063700*  (SUMMED BY INTERNAL UPC ID)                                    06370099
063800******************************************************************06380099
063900     EXEC SQL                                                     06390099
064000         DECLARE AUDIT_ITEM_CURSOR CURSOR                         06400099
064100             FOR SELECT                                           06410099
064200                 B.INTR_UPC_ID                                    06420099
064300               , 0                                                06430099
064400               , SUM(SCND_UNT_QTY)                                06440099
064500             FROM TSUAUPC A                                       06450099
064600                , XLT_UPC B                                       06460099
064700             WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR               06470099
064800               AND AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR              06480099
064900               AND A.UPC_NBR = B.UPC_NBR                          06490099
065000               AND A.SCN_TYP_CDE <> 'E'                           06500099
065100             GROUP BY B.INTR_UPC_ID                               06510099
065200         UNION                                                    06520099
065300             SELECT                                               06530099
065400                 999999999                                        06540099
065500               , A.UPC_NBR                                        06550099
065600               , SUM(SCND_UNT_QTY)                                06560099
065700             FROM TSUAUPC A                                       06570099
065800             WHERE A.SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR             06580099
065900               AND A.AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR            06590099
066000               AND A.SCN_TYP_CDE <> 'E'                           06600099
066100               AND NOT EXISTS                                     06610099
066200              (SELECT  *                                          06620099
066300                 FROM XLT_UPC B                                   06630099
066400                 WHERE A.UPC_NBR = B.UPC_NBR)                     06640099
066500             GROUP BY A.UPC_NBR                                   06650099
066600         ORDER BY 1,2                                             06660099
066700     END-EXEC.                                                    06670099
066800                                                                  06680099
066900******************************************************************06690099
067000     EXEC SQL                                                     06700099
067100         DECLARE CARTON_UPC_CURSOR CURSOR                         06710099
067200             FOR SELECT                                           06720099
067300                 A.UPC_NBR                                        06730099
067400               , SUM(A.SHPD_QTY)                                  06740099
067500             FROM TSHUUPC A                                       06750099
067600                , XLT_UPC B                                       06760099
067700             WHERE SHIPT_UNT_ID        = :DK-SHIP-UNIT-NBR        06770099
067800               AND A.UPC_NBR           = B.UPC_NBR                06780099
067900               AND B.INTR_UPC_ID       = :PV-EXPECT-INTR-UPC      06790099
068000             GROUP BY A.UPC_NBR                                   06800099
068100             ORDER BY A.UPC_NBR                                   06810099
068200     END-EXEC.                                                    06820099
068300                                                                  06830099
068400******************************************************************06840099
068500     EXEC SQL                                                     06850099
068600         DECLARE AUDIT_UPC_CURSOR CURSOR WITH HOLD                06860099
068700             FOR SELECT                                           06870099
068800                 A.UPC_NBR                                        06880099
068900               , SUM(A.SCND_UNT_QTY)                              06890099
069000             FROM TSUAUPC A                                       06900099
069100                , XLT_UPC B                                       06910099
069200             WHERE SHIPT_UNT_ID        = :DK-SHIP-UNIT-NBR        06920099
069300               AND AUD_CNTL_NBR        = :DK-AUDIT-CNTL-NBR       06930099
069400               AND A.UPC_NBR           = B.UPC_NBR                06940099
069500               AND B.INTR_UPC_ID       = :PV-EXPECT-INTR-UPC      06950099
069600               AND A.SCN_TYP_CDE      <> 'E'                      06960099
069700             GROUP BY A.UPC_NBR                                   06970099
069800             ORDER BY A.UPC_NBR                                   06980099
069900     END-EXEC.                                                    06990099
070000                                                                  07000099
070100******************************************************************07010099
070300                                                                  07030099
070400     EXEC SQL                                                     07040099
070500         DECLARE RFTAG_SCAN_CURSOR CURSOR WITH HOLD               07050099
070600             FOR SELECT                                           07060099
070700                 UPC_NBR                                          07070099
070800               , SUM(SCND_UNT_QTY)                                07080099
070900               , SUM(RFID_TGD_QTY)                                07090099
071000             FROM TSUAUPC                                         07100099
071100            WHERE AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR              07110099
071200              AND SHIPT_UNT_ID  = :DK-SHIP-UNIT-NBR               07120099
071300              AND SCN_TYP_CDE   = 'S'                             07130099
071400            GROUP BY UPC_NBR                                      07140099
071500            ORDER BY UPC_NBR                                      07150099
071600     END-EXEC.                                                    07160099
071700                                                                  07170099
072000******************************************************************07200099
072100 LINKAGE SECTION.                                                 07210099
072200******************************************************************07220099
072300 01  DFHCOMMAREA.                                                 07230099
072400     05  FILLER                         OCCURS  1 TO 4072 TIMES   07240099
072500                                        DEPENDING ON EIBCALEN.    07250099
072600         10  FILLER                     PIC X.                    07260099
072700                                                                  07270099
072800******************************************************************07280099
072900 PROCEDURE DIVISION.                                              07290099
073000******************************************************************07300099
073100 0000-PROGRAM-MAINLINE.                                           07310099
073200                                                                  07320099
073300     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           07330099
073400     MOVE LOW-VALUES   TO  SU512AI.                               07340099
073500                                                                  07350099
073600     EVALUATE TRUE                                                07360099
073700****************************************************************  07370099
073800* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        07380099
073900****************************************************************  07390099
074000         WHEN EIBTRNID = 'Z278'                                   07400099
074100             MOVE DFHCOMMAREA          TO PC192-COMMAREA          07410099
074200             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             07420099
074300             SET SU006-PROCESS-SCREEN  TO TRUE                    07430099
074400             MOVE -1                   TO  ASELECTL               07440099
074500             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          07450099
074600             PERFORM 8000-SEND-MAP                                07460099
074700             PERFORM 8200-RETURN-TRANID                           07470099
074800                                                                  07480099
074900         WHEN EIBCALEN = ZERO                                     07490099
075000         WHEN EIBAID = DFHCLEAR                                   07500099
075100         WHEN SU006-INITIALIZE-SCREEN                             07510099
075200             INITIALIZE CA-PROGRAM-COMMAREA                       07520099
075300             SET SU006-PROCESS-SCREEN  TO  TRUE                   07530099
075400             PERFORM 1000-SETUP-SCREEN                            07540099
075500                                                                  07550099
075600             MOVE -1                   TO  ASELECTL               07560099
075700             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          07570099
075800             PERFORM 8000-SEND-MAP                                07580099
075900             PERFORM 8200-RETURN-TRANID                           07590099
076000                                                                  07600099
076100                                                                  07610099
076200         WHEN EIBAID = DFHENTER                                   07620099
076300             PERFORM 1200-RECEIVE-MAP                             07630099
076400             PERFORM 1300-EDIT-SELECTION                          07640099
076500                                                                  07650099
076600             PERFORM 2000-PROCESS-SCREEN                          07660099
076700*          FOR COMBINED AUDITS (QC AND RFID) BOTH SETS OF AUDITS  07670099
076800*          MUST BE UPDATED AND KEPT IN SYNC                       07680099
076900             IF SU006-QC-AND-RFID-AUD                             07690099
077000                PERFORM 2050-PROCESS-SCREEN-FOR-CMBND             07700099
077100             END-IF                                               07710099
077200                                                                  07720099
077300*        F2 TO CONFIRM WAS PRESSED.  IF IT IS IN A CONFIRMED      07730099
077400*        STATE, SET FLAG TO SAY THE ACTION HAS BEEN CONFIRMED.    07740099
077500*        IF IT IS NOT IN A CONFIRMED STATE, IT IS AN INVALID KEY  07750099
077600         WHEN EIBAID = DFHPF2                                     07760099
077700             IF CA-IN-CONFIRM-STATE                               07770099
077800                SET CA-CONFIRMED                 TO TRUE          07780099
077900                PERFORM 2000-PROCESS-SCREEN                       07790099
078000*              FOR COMBINED AUDITS (QC AND RFID) BOTH SETS OF     07800099
078100*              AUDITS MUST BE UPDATED AND KEPT IN SYNC            07810099
078200                IF SU006-QC-AND-RFID-AUD                          07820099
078300                   PERFORM 2050-PROCESS-SCREEN-FOR-CMBND          07830099
078400                END-IF                                            07840099
078500             ELSE                                                 07850099
078600                MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO      07860099
078700             END-IF                                               07870099
078800                                                                  07880099
078900         WHEN EIBAID = DFHPF3                                     07890099
079000                                                                  07900099
079100              PERFORM 3500-SELECT-AUDIT                           07910099
079200              IF PS-SYSTEM-AUDIT-FOUND AND                        07920099
079300                 NOT SU006-SYSTEM-GENERATED-AUDIT                 07930099
079400                  MOVE SPACES TO PV-CICS-MSG-AREA2                07940099
079500                  STRING                                          07950099
079600                  ' SUKRF512 - SU006-SYSTEM-GENERATED-AUD ERR'    07960099
079700                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     07970099
079800                  PERFORM 999A-WRITE-CSSL-MSG                     07980099
079900                  MOVE SPACES TO PV-CICS-MSG-AREA2                07990099
080000                  STRING ' USER = ' SU006-USERID                  08000099
080100                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08010099
080200                  PERFORM 999A-WRITE-CSSL-MSG                     08020099
080300                  MOVE SPACES TO PV-CICS-MSG-AREA2                08030099
080400                  STRING ' AUDIT= ' SU006-AUDIT-CNTL-NBR          08040099
080500                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08050099
080600                  PERFORM 999A-WRITE-CSSL-MSG                     08060099
080700                  MOVE SPACES TO PV-CICS-MSG-AREA2                08070099
080800                  STRING ' CART = ' SU006-SHIP-UNIT-NBR           08080099
080900                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08090099
081000                  PERFORM 999A-WRITE-CSSL-MSG                     08100099
081100                  MOVE SPACES TO PV-CICS-MSG-AREA2                08110099
081200                  STRING ' PKG-CDE = ' SU006-PKGNG-CDE-IND        08120099
081300                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08130099
081400                  PERFORM 999A-WRITE-CSSL-MSG                     08140099
081500                  MOVE SPACES TO PV-CICS-MSG-AREA2                08150099
081600                  STRING ' AUDIT  = ' SU006-SYSTEM-MANUAL-AUDIT   08160099
081700                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08170099
081800                  PERFORM 999A-WRITE-CSSL-MSG                     08180099
081900                  MOVE SPACES TO PV-CICS-MSG-AREA2                08190099
082000                  STRING ' LOC    = ' SU006-LOCATION-LOGON-IND    08200099
082100                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08210099
082200                  PERFORM 999A-WRITE-CSSL-MSG                     08220099
082300                  SET SU006-SYSTEM-GENERATED-AUDIT TO TRUE        08230099
082400              ELSE                                                08240099
082500                IF PS-SYSTEM-AUDIT-FOUND                          08250099
082600                  IF (SUT00015-CART-QTY > SUT00015-AUD-CART-QTY   08260099
082700                     AND SUT00015-UNT-QTY > SUT00015-AUD-UNT-QTY) 08270099
082800                     OR                                           08280099
082900                    (SUT00015-CART-QTY > SUT00015-AUD-CART-QTY    08290099
083000                     AND SUT00015-UNT-QTY = 0)                    08300099
083100                      CONTINUE                                    08310099
083200                  ELSE                                            08320099
083300*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 08330099
083400*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS08340099
083500*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       08350099
083600*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  08360099
083700*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 08370099
083800*    SECOND IN THIS SCENARIO.                                     08380099
083900                   IF PS-PRCS-FIRST-AUDIT                         08390099
084000                   OR SU006-RFID-AUD-ONLY                         08400099
084100                   OR SU006-MANUAL-GENERATED-AUDIT                08410099
084200                      MOVE SU006-AUDIT-CNTL-NBR                   08420099
084300                                             TO DK-AUDIT-CNTL-NBR 08430099
084400                   ELSE                                           08440099
084500                      MOVE SU006-RFID-AUDIT-CNTL-NBR              08450099
084600                                             TO DK-AUDIT-CNTL-NBR 08460099
084700                   END-IF                                         08470099
084800                                                                  08480099
084900                   MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR  08490099
085000                   PERFORM 3050-GET-STAT-CDE                      08500099
085100                   IF NOT SU006-SHIP-UNIT-COMPLETE                08510099
085200                    MOVE SPACES TO PV-CICS-MSG-AREA2              08520099
085300                    STRING                                        08530099
085400                    ' SUKRF512 - SU006-SHIP-UNIT-COMPLETE-ERR'    08540099
085500                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08550099
085600                    PERFORM 999A-WRITE-CSSL-MSG                   08560099
085700                    MOVE SPACES TO PV-CICS-MSG-AREA2              08570099
085800                    STRING ' USER = ' SU006-USERID                08580099
085900                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08590099
086000                    PERFORM 999A-WRITE-CSSL-MSG                   08600099
086100                    MOVE SPACES TO PV-CICS-MSG-AREA2              08610099
086200                    STRING ' AUDIT= ' SU006-AUDIT-CNTL-NBR        08620099
086300                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08630099
086400                    PERFORM 999A-WRITE-CSSL-MSG                   08640099
086500                    MOVE SPACES TO PV-CICS-MSG-AREA2              08650099
086600                    STRING ' CART = ' SU006-SHIP-UNIT-NBR         08660099
086700                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08670099
086800                    PERFORM 999A-WRITE-CSSL-MSG                   08680099
086900                    MOVE SPACES TO PV-CICS-MSG-AREA2              08690099
087000                    STRING ' STATUS=' SU006-SHIP-UNIT-STATUS      08700099
087100                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08710099
087200                    PERFORM 999A-WRITE-CSSL-MSG                   08720099
087300                    MOVE SPACES TO PV-CICS-MSG-AREA2              08730099
087400                    STRING ' CTN STAT=' SUATRN-UNT-AUD-STAT-CDE   08740099
087500                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08750099
087600                    PERFORM 999A-WRITE-CSSL-MSG                   08760099
087700                                                                  08770099
087800                    MOVE SPACES TO PV-CICS-MSG-AREA2              08780099
087900                    MOVE SUT00015-CART-QTY     TO PV-DISP-COUNTS  08790099
088000                    STRING ' CTN QTY =' PV-DISP-COUNTS            08800099
088100                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08810099
088200                    PERFORM 999A-WRITE-CSSL-MSG                   08820099
088300                    MOVE SPACES TO PV-CICS-MSG-AREA2              08830099
088400                    MOVE SUT00015-AUD-CART-QTY TO PV-DISP-COUNTS  08840099
088500                    STRING ' AUD CTN QTY =' PV-DISP-COUNTS        08850099
088600                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08860099
088700                    PERFORM 999A-WRITE-CSSL-MSG                   08870099
088800                    MOVE SPACES TO PV-CICS-MSG-AREA2              08880099
088900                    MOVE SUT00015-UNT-QTY      TO PV-DISP-COUNTS  08890099
089000                    STRING ' UNT QTY =' PV-DISP-COUNTS            08900099
089100                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08910099
089200                    PERFORM 999A-WRITE-CSSL-MSG                   08920099
089300                    MOVE SPACES TO PV-CICS-MSG-AREA2              08930099
089400                    MOVE SUT00015-AUD-UNT-QTY  TO PV-DISP-COUNTS  08940099
089500                    STRING ' AUD UNT QTY =' PV-DISP-COUNTS        08950099
089600                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2     08960099
089700                    PERFORM 999A-WRITE-CSSL-MSG                   08970099
089800                                                                  08980099
089900                    IF SUATRN-UNT-AUD-STAT-CDE = 'CM'             08990099
090000                      SET SU006-SHIP-UNIT-COMPLETE  TO TRUE       09000099
090100                    END-IF                                        09010099
090200                   END-IF                                         09020099
090300                  END-IF                                          09030099
090400                END-IF                                            09040099
090500              END-IF                                              09050099
090600                                                                  09060099
090700             IF SU006-SHIP-UNIT-COMPLETE AND                      09070099
090800                SU006-SYSTEM-GENERATED-AUDIT                      09080099
090900               IF SU006-PRINTER-DEST = SPACES                     09090099
091000                  MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO    09100099
091100                  MOVE -1                          TO  ASELECTL   09110099
091200                  PERFORM 8100-SEND-DATA-ONLY                     09120099
091300                  PERFORM 8200-RETURN-TRANID                      09130099
091400               ELSE                                               09140099
091410                                                                  09141099
091411                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        09141199
091412                     SET PS-PRINT-TO-FILE-NO  TO TRUE             09141299
091413                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          09141399
091414                                                                  09141499
091415                     IF  PS-PRINT-TO-FILE-YES                     09141599
091416                         MOVE PC-AUDIT-STATUS-PROGRAM             09141699
091417                                        TO  PV-TRANSFER-PROGRAM   09141799
091418                         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM    09141899
091419                     END-IF                                       09141999
091420                                                                  09142099
091447                  ELSE                                            09144799
091450                                                                  09145099
091500                    PERFORM 1310-VALIDATE-PRINTER                 09150099
091600                    IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A' 09160099
091700                        MOVE PM-INVALID-PRINTER-ID-MSG TO AMSGLNO 09170099
091800                        MOVE -1                       TO ASELECTL 09180099
091900                        PERFORM 8100-SEND-DATA-ONLY               09190099
092000                        PERFORM 8200-RETURN-TRANID                09200099
092100                    ELSE                                          09210099
092200                        MOVE PC-AUDIT-STATUS-PROGRAM              09220099
092300                                        TO  PV-TRANSFER-PROGRAM   09230099
092400                        PERFORM 2100-XCTL-TO-SELECTED-PROGRAM     09240099
092500                    END-IF                                        09250099
092510                  END-IF                                          09251099
092600               END-IF                                             09260099
092700             ELSE                                                 09270099
092800                 MOVE PC-RETURN-PGM     TO  PV-TRANSFER-PROGRAM   09280099
092900                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            09290099
093000             END-IF                                               09300099
093100                                                                  09310099
093200         WHEN EIBAID = DFHPF1                                     09320099
093300              PERFORM 1400-HELP-SCREEN                            09330099
093400                                                                  09340099
093500         WHEN OTHER                                               09350099
093600             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          09360099
093700             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         09370099
093800                                                                  09380099
093900     END-EVALUATE.                                                09390099
094000                                                                  09400099
094100     PERFORM 8100-SEND-DATA-ONLY.                                 09410099
094200     PERFORM 8200-RETURN-TRANID.                                  09420099
094300                                                                  09430099
094400     GOBACK.                                                      09440099
094500                                                                  09450099
094600******************************************************************09460099
094700* 1000-SETUP-SCREEN                                              *09470099
094800*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                    *09480099
094900******************************************************************09490099
095000 1000-SETUP-SCREEN.                                               09500099
095100                                                                  09510099
095200*    SET STATUS FIELD                                             09520099
095300     EVALUATE TRUE                                                09530099
095400         WHEN SU006-SHIP-UNIT-INPROCESS                           09540099
095500         WHEN SU006-SHIP-UNIT-POSTPONE                            09550099
095600             MOVE PC-STARTED-STATUS   TO ASTATO                   09560099
095700                                                                  09570099
095800         WHEN SU006-SHIP-UNIT-COMPLETE                            09580099
095900             MOVE PC-CLOSED-STATUS    TO ASTATO                   09590099
096000     END-EVALUATE.                                                09600099
096100                                                                  09610099
096200*    SET SHIP-UNIT CONTROL NUMBER                                 09620099
096300     MOVE SU006-SHIP-UNIT-NBR-X       TO ACARTONO.                09630099
096400                                                                  09640099
096500*    IF NEEDED, GET DEFAULT PRINTER ID                            09650099
096600     IF SU006-PRINTER-DEST = SPACES                               09660099
096700         PERFORM 1010-GET-DEFAULT-PRINTER                         09670099
096800     END-IF.                                                      09680099
096900                                                                  09690099
097000     MOVE SU006-PRINTER-DEST TO ADESTO.                           09700099
097100                                                                  09710099
097200******************************************************************09720099
097300* 1010-GET-DEFAULT-PRINTER                                       *09730099
097400*    SELECT THE DEFAULT PRINTER FROM THE COMPANY CONTROL TABLE   *09740099
097500* THERE ARE DEFAULTS FOR EACH AUDITING PROCESS AREA & LOGISTICS  *09750099
097600* WITHIN EACH FACILITY.  SELECT OF ALL FOUR ID'S FOR THE GIVEN   *09760099
097700* OPER UNIT ID AND THEN DETERMINE WHICH TO DISPLAY.              *09770099
097800******************************************************************09780099
097900 1010-GET-DEFAULT-PRINTER.                                        09790099
098000                                                                  09800099
098100     MOVE SU006-OPER-UNT-ID     TO DK-OPER-UNT-ID.                09810099
098200                                                                  09820099
098300     EXEC SQL                                                     09830099
098400            SELECT  CA_RCVG_PRTR_ID                               09840099
098500                   ,CA_FLAT_PRTR_ID                               09850099
098600                   ,CA_SHIP_PRTR_ID                               09860099
098700            INTO   :COCNTL-CA-RCVG-PRTR-ID                        09870099
098800                  ,:COCNTL-CA-FLAT-PRTR-ID                        09880099
098900                  ,:COCNTL-CA-SHIP-PRTR-ID                        09890099
099000            FROM    TCOCNTL                                       09900099
099100            WHERE OPER_UNT_ID     = :DK-OPER-UNT-ID               09910099
099200              AND FCLTY_ID        = 1                             09920099
099300     END-EXEC.                                                    09930099
099400                                                                  09940099
099500     IF SQLCODE = ZERO                                            09950099
099600         EVALUATE TRUE                                            09960099
099700           WHEN  SU006-RECV-PRCS-AREA                             09970099
099800               MOVE COCNTL-CA-RCVG-PRTR-ID                        09980099
099900                                         TO SU006-PRINTER-DEST    09990099
100000                                                                  10000099
100100           WHEN  SU006-FLAT-PRCS-AREA                             10010099
100200               MOVE COCNTL-CA-FLAT-PRTR-ID                        10020099
100300                                         TO SU006-PRINTER-DEST    10030099
100400                                                                  10040099
100500           WHEN  SU006-SHIP-PRCS-AREA                             10050099
100600               MOVE COCNTL-CA-SHIP-PRTR-ID                        10060099
100700                                         TO SU006-PRINTER-DEST    10070099
100800         END-EVALUATE                                             10080099
100900     ELSE                                                         10090099
101000         MOVE '1010-GET-DEFAULT-PRINTER' TO DP013-PARAGRAPH       10100099
101100         MOVE 'SELECT OF TCOCNTL'        TO DP013-MESSAGE-TEXT (1)10110099
101200         MOVE DK-OPER-UNT-ID             TO DP013-MESSAGE-TEXT (2)10120099
101300         MOVE SQLCA                      TO DP013-SQLCA           10130099
101400         MOVE 'TCOCNTL'               TO DP013-DB2-TABLE-NAME (1) 10140099
101500         SET DP013-DB2-ABEND             TO TRUE                  10150099
101600         SET DP013-NO-ROLLBACK           TO TRUE                  10160099
101700         PERFORM 9999-WRITE-CICS-LOG-MSG                          10170099
101800         MOVE PM-DB2-FATAL-ERROR-MSG     TO AMSGLNO               10180099
101900         PERFORM 8100-SEND-DATA-ONLY                              10190099
102000         PERFORM 8200-RETURN-TRANID                               10200099
102100     END-IF.                                                      10210099
102200                                                                  10220099
102300******************************************************************10230099
102400 1200-RECEIVE-MAP.                                                10240099
102500                                                                  10250099
102600     EXEC CICS                                                    10260099
102700         RECEIVE                                                  10270099
102800             MAP     ('SU512A')                                   10280099
102900             MAPSET  ('SUKM512')                                  10290099
103000             RESP    (PV-CICS-RESPONSE)                           10300099
103100     END-EXEC.                                                    10310099
103200                                                                  10320099
103300     EVALUATE TRUE                                                10330099
103400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10340099
103500              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  10350099
103600                                                                  10360099
103700         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                10370099
103800              CONTINUE                                            10380099
103900                                                                  10390099
104000         WHEN OTHER                                               10400099
104100              MOVE '1200-RECEIVE-MAP'                             10410099
104200                                     TO DP013-PARAGRAPH           10420099
104300              MOVE 'UNABLE TO RECEIVE MAP'                        10430099
104400                                     TO DP013-MESSAGE-TEXT (1)    10440099
104500              SET DP013-LOGIC-ABEND  TO TRUE                      10450099
104600              SET DP013-NO-ROLLBACK  TO TRUE                      10460099
104700              PERFORM 9999-WRITE-CICS-LOG-MSG                     10470099
104800     END-EVALUATE.                                                10480099
104900                                                                  10490099
105000******************************************************************10500099
105100 1210-RECEIVE-SCREEN-FIELDS.                                      10510099
105200                                                                  10520099
105300     IF  ASELECTL > ZERO                                          10530099
105400         MOVE ASELECTI               TO CA-SELECTION-X            10540099
105500     END-IF.                                                      10550099
105600                                                                  10560099
105700     IF  ADESTL   > ZERO                                          10570099
105800         MOVE ADESTI                 TO SU006-PRINTER-DEST        10580099
105900     ELSE IF  ADESTF   = DP015-ERASE-EOF                          10590099
106000         MOVE SPACES                 TO SU006-PRINTER-DEST        10600099
106100                                        ADESTO                    10610099
106200     END-IF.                                                      10620099
106300                                                                  10630099
106400******************************************************************10640099
106500* EDIT ALL ENTERABLE FIELDS (OPERATING UNIT ID, AND SELECT)      *10650099
106600******************************************************************10660099
106700 1300-EDIT-SELECTION.                                             10670099
106800                                                                  10680099
106900*    CHECK TO MAKE SURE THE ENTERED SELECTION IS NUMERIC          10690099
107000     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    10700099
107100     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    10710099
107200     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  10720099
107300     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     10730099
107400                                                                  10740099
107500     CALL DP010I-NUMERIC-EDIT-ROUTINE                             10750099
107600          USING DP010I-NUMERIC-EDIT-AREA.                         10760099
107700                                                                  10770099
107800     IF  DP010I-ERROR-DETECTED                                    10780099
107900         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       10790099
108000                                     TO AMSGLNO                   10800099
108100         PERFORM 8100-SEND-DATA-ONLY                              10810099
108200         PERFORM 8200-RETURN-TRANID                               10820099
108300     ELSE                                                         10830099
108400         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              10840099
108500         IF NOT CA-VALID-SELECTION                                10850099
108600             MOVE PM-INVALID-SELECTION-MSG                        10860099
108700                                     TO AMSGLNO                   10870099
108800         END-IF                                                   10880099
108900     END-IF.                                                      10890099
109000     PERFORM 3500-SELECT-AUDIT.                                   10900099
109100     IF PS-SYSTEM-AUDIT-FOUND AND                                 10910099
109200        SUT00015-AUD-STAT-CDE = 'N'                               10920099
109300         PERFORM 3250-LINK-COMMON-CARTON-CLOSE                    10930099
109400         IF ( SU091-SUCCESS )                                     10940099
109500             MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG TO AMSGLNO        10950099
109600         ELSE                                                     10960099
109700             EVALUATE TRUE                                        10970099
109800                WHEN SU091-PARAMETER-ERROR                        10980099
109900                    MOVE PC-CCC-PARM-ERR-MSG    TO AMSGLNO        10990099
110000                                                                  11000099
110100                WHEN SU091-DB2-ERROR                              11010099
110200                    MOVE PC-CCC-DB2-ERR-MSG     TO AMSGLNO        11020099
110300                                                                  11030099
110400                WHEN SU091-MQ-ERROR                               11040099
110500                    MOVE PC-CCC-MQ-ERR-MSG      TO AMSGLNO        11050099
110600                                                                  11060099
110700                WHEN SU091-OTHER-ERROR                            11070099
110800                    MOVE PC-CCC-OTHR-ERR-MSG    TO AMSGLNO        11080099
110900             END-EVALUATE                                         11090099
111000         END-IF                                                   11100099
111100         PERFORM 8100-SEND-DATA-ONLY                              11110099
111200         PERFORM 8200-RETURN-TRANID                               11120099
111300     END-IF.                                                      11130099
111400                                                                  11140099
111500******************************************************************11150099
111600*   1310-VALIDATE-PRINTER                                        *11160099
111700* CALLS DPKCS060 TO VALIDATE THE PRINTER ID                      *11170099
111800******************************************************************11180099
111900 1310-VALIDATE-PRINTER.                                           11190099
112000                                                                  11200099
112100     MOVE SU006-PRINTER-DEST         TO DP072-PRINTER-ID.         11210099
112200     MOVE PC-REPORT-PGM              TO DP072-RPT-PGM-NME.        11220099
112300     MOVE PC-01                      TO DP072-RPT-PGM-TYP-ID.     11230099
112400     MOVE SU006-DFLT-OPER-UNT-ID     TO DP072-ORIGIN-OPER-UNT-ID. 11240099
112500     MOVE SU006-OPER-UNT-ID          TO DP072-OPER-UNT-ID.        11250099
112600     MOVE 1                          TO DP072-ORIGIN-FCLTY-ID     11260099
112700                                        DP072-FCLTY-ID.           11270099
112800     SET DP072-VALIDATE              TO TRUE.                     11280099
112900                                                                  11290099
113000     EXEC CICS                                                    11300099
113100         LINK PROGRAM  (PC-PRTR-VALIDATION-PGM)                   11310099
113200              COMMAREA (DP072-COMM-AREA)                          11320099
113300              RESP     (PV-CICS-RESPONSE)                         11330099
113400     END-EXEC                                                     11340099
113500                                                                  11350099
113600     EVALUATE TRUE                                                11360099
113700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11370099
113800             IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A'        11380099
113900                 MOVE SPACES TO PV-CICS-MSG-AREA2                 11390099
114000                 STRING ' SUKRF512 - DP072-PRTR-PRTR-ERROR'       11400099
114100                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      11410099
114200                 PERFORM 999A-WRITE-CSSL-MSG                      11420099
114300                                                                  11430099
114400                 MOVE SPACES TO PV-CICS-MSG-AREA2                 11440099
114500                 STRING ' USER = ' SU006-USERID                   11450099
114600                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      11460099
114700                 PERFORM 999A-WRITE-CSSL-MSG                      11470099
114800                 MOVE SPACES TO PV-CICS-MSG-AREA2                 11480099
114900                 STRING ' AUDIT= ' SU006-AUDIT-CNTL-NBR           11490099
115000                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      11500099
115100                 PERFORM 999A-WRITE-CSSL-MSG                      11510099
115200                                                                  11520099
115300                 MOVE SPACES TO PV-CICS-MSG-AREA2                 11530099
115400                 STRING ' PRINTER DEST = ' SU006-PRINTER-DEST     11540099
115500                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      11550099
115600                 PERFORM 999A-WRITE-CSSL-MSG                      11560099
115700                                                                  11570099
115800                 MOVE SPACES TO PV-CICS-MSG-AREA2                 11580099
115900                 STRING ' REPORT PGM = ' PC-REPORT-PGM            11590099
116000                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      11600099
116100                 PERFORM 999A-WRITE-CSSL-MSG                      11610099
116200                                                                  11620099
116300                 MOVE SPACES TO PV-CICS-MSG-AREA2                 11630099
116400                 STRING ' DEFALT OPR = ' SU006-DFLT-OPER-UNT-ID-X 11640099
116500                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      11650099
116600                 PERFORM 999A-WRITE-CSSL-MSG                      11660099
116700                                                                  11670099
116800                 MOVE SPACES TO PV-CICS-MSG-AREA2                 11680099
116900                 STRING ' OPER ID    = ' SU006-OPER-UNT-ID-X      11690099
117000                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      11700099
117100                 PERFORM 999A-WRITE-CSSL-MSG                      11710099
117200             END-IF                                               11720099
117300                                                                  11730099
117400         WHEN OTHER                                               11740099
117500               MOVE '1310-VALIDATE-PRINTER'                       11750099
117600                                    TO DP013-PARAGRAPH            11760099
117700               MOVE PV-CICS-RESPONSE                              11770099
117800                                    TO DP013-MESSAGE-TEXT(1)      11780099
117900               SET DP013-LINK-RETURN                              11790099
118000                   DP013-CICS-ABEND  TO TRUE                      11800099
118200               PERFORM DP014-0000-PROCESS-ABEND                   11820099
118300     END-EVALUATE.                                                11830099
118400                                                                  11840099
118410***************************************************************** 11841099
118420* CHECK TO SEE THAT DC IS SET UP TO SEND REPORT AS A .TXT       * 11842099
118430* INSTEAD OF PRINTING TO AN ACTUAL PRINTER.                     * 11843099
118440***************************************************************** 11844099
118450 1320-VALIDATE-PRINT-TO-FILE.                                     11845099
118460                                                                  11846099
118470     SET PS-PRINT-TO-FILE-NO  TO TRUE                             11847099
118480     MOVE  SU006-OPER-UNT-ID  TO  KRPRPM-LOC-ID                   11848099
118490                                                                  11849099
118491     EXEC SQL                                                     11849199
118492            SELECT  FUNC_TXT                                      11849299
118493              INTO :KRPRPM-FUNC-TXT                               11849399
118494              FROM  TKRPRPM                                       11849499
118495             WHERE  LOC_ID            = :KRPRPM-LOC-ID            11849599
118496               AND  INTFC_SYS_CDE     = 'KHL'                     11849699
118497               AND  SYS_PRC_FUNC_CDE  = 'PRTFIL'                  11849799
118498               AND  FUNC_PRC_STAT_CDE = 'AC'                      11849899
118499               AND  FUNC_BEG_TMST    <= CURRENT TIMESTAMP         11849999
118500               AND  FUNC_END_TMST    >= CURRENT TIMESTAMP         11850099
118501               AND  FUNC_TXT          = 'Y'                       11850199
118502     END-EXEC.                                                    11850299
118503                                                                  11850399
118504     IF  SQLCODE = ZERO                                           11850499
118505         SET PS-PRINT-TO-FILE-YES TO TRUE                         11850599
118506     ELSE                                                         11850699
118507     IF  SQLCODE = +100                                           11850799
118508         SET PS-PRINT-TO-FILE-NO  TO TRUE                         11850899
118509         MOVE PC-PRINT-TO-FILE-ERR-MSG TO AMSGLNO                 11850999
118510         MOVE -1                       TO ASELECTL                11851099
118511         PERFORM 8100-SEND-DATA-ONLY                              11851199
118512         PERFORM 8200-RETURN-TRANID                               11851299
118513     ELSE                                                         11851399
118514         MOVE '1320-VALIDATE-PRINT-TO-FILE'                       11851499
118515                                TO DP013-PARAGRAPH                11851599
118516         MOVE PV-CICS-RESPONSE  TO DP013-MESSAGE-TEXT(1)          11851699
118518         SET DP013-LINK-RETURN                                    11851899
118519             DP013-CICS-ABEND                                     11851999
118520             DP013-NO-ROLLBACK TO TRUE                            11852099
118521         PERFORM DP014-0000-PROCESS-ABEND                         11852199
118522     END-IF.                                                      11852299
118524                                                                  11852499
118534                                                                  11853499
118535***************************************************************** 11853599
118536* CHECK TO SEE IF THE REPORT IS SET UP TO BE PRINTED AS A .TXT  * 11853699
118537* FILE INSTEAD OF BEING PHYSICALLY PRINT.                       * 11853799
118538***************************************************************** 11853899
118539 1330-CHECK-PRNTTOFILE.                                           11853999
118540                                                                  11854099
118541     SET  PS-REPORT-TO-FILE-NO TO TRUE.                           11854199
118542                                                                  11854299
118543     MOVE 'CARTON DETAIL'          TO  DK-WST-RPT-NAME            11854399
118544     MOVE 'SUKRP012'               TO  DK-WST-RPT-NBR             11854499
118545     MOVE 'SUK915'                 TO  DK-WST-JOB                 11854599
118546     MOVE 'AC'                     TO  DK-WST-AC-IN               11854699
118547     MOVE PC-CURRENT-PROGRAM-NAME  TO  DK-WST-PROG-NBR            11854799
118548     MOVE 0                        TO  DK-WST-MENU-SEQ            11854899
118549                                                                  11854999
118560     EXEC SQL                                                     11856099
118561          SELECT C.ATTR_ELEM_SEQ_NBR                              11856199
118562               , C.ATTR_ELEM_TXT                                  11856299
118563               , D.ATTR_ELEM_TXT                                  11856399
118564               , E.ATTR_ELEM_TXT                                  11856499
118565               , F.ATTR_ELEM_TXT                                  11856599
118566               , G.ATTR_ELEM_TXT                                  11856699
118567               , H.ATTR_ELEM_NBR                                  11856799
118568            INTO :PV-WST-SEQ                                      11856899
118569               , :PV-WST-RPT-NAME                                 11856999
118570               , :PV-WST-RPT-NBR                                  11857099
118571               , :PV-WST-JOB                                      11857199
118572               , :PV-WST-AC-IN                                    11857299
118573               , :PV-WST-PROG-NBR                                 11857399
118574               , :PV-WST-MENU-SEQ                                 11857499
118575            FROM  WST_INTGRTN_TYP A                               11857599
118576               ,  WST_ATTR_DEFN   B                               11857699
118577               ,  WST_ATTR_ELEM   C                               11857799
118578               ,  WST_ATTR_ELEM   D                               11857899
118579               ,  WST_ATTR_ELEM   E                               11857999
118580               ,  WST_ATTR_ELEM   F                               11858099
118581               ,  WST_ATTR_ELEM   G                               11858199
118582               ,  WST_ATTR_ELEM   H                               11858299
118583           WHERE A.INTGRTN_TYP_CDE   = 'PRNTTOFILE'               11858399
118584             AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE          11858499
118585             AND B.ATTR_DEFN_SEQ_NBR = 1                          11858599
118586             AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE          11858699
118587             AND C.ATTR_DEFN_SEQ_NBR = 1                          11858799
118588             AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE          11858899
118589             AND D.ATTR_DEFN_SEQ_NBR = 2                          11858999
118590             AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE          11859099
118591             AND E.ATTR_DEFN_SEQ_NBR = 3                          11859199
118592             AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE          11859299
118593             AND F.ATTR_DEFN_SEQ_NBR = 4                          11859399
118594             AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE          11859499
118595             AND G.ATTR_DEFN_SEQ_NBR = 5                          11859599
118596             AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE          11859699
118597             AND H.ATTR_DEFN_SEQ_NBR = 6                          11859799
118598             AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR        11859899
118599             AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR        11859999
118600             AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR        11860099
118601             AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR        11860199
118602             AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR        11860299
118603             AND C.ATTR_ELEM_TXT     = :DK-WST-RPT-NAME           11860399
118604             AND D.ATTR_ELEM_TXT     = :DK-WST-RPT-NBR            11860499
118605             AND E.ATTR_ELEM_TXT     = :DK-WST-JOB                11860599
118606             AND F.ATTR_ELEM_TXT     = :DK-WST-AC-IN              11860699
118607             AND G.ATTR_ELEM_TXT     = :DK-WST-PROG-NBR           11860799
118608             AND H.ATTR_ELEM_NBR     = :DK-WST-MENU-SEQ           11860899
118609            WITH UR                                               11860999
118610     END-EXEC.                                                    11861099
118611                                                                  11861199
118612     IF  SQLCODE = ZERO                                           11861299
118613         SET PS-REPORT-TO-FILE-YES TO TRUE                        11861399
118614     ELSE                                                         11861499
118615     IF  SQLCODE = +100                                           11861599
118616         SET PS-REPORT-TO-FILE-NO  TO TRUE                        11861699
118617         MOVE PC-REPORT-TO-FILE-ERR-MSG  TO AMSGLNO               11861799
118618         MOVE -1                         TO ASELECTL              11861899
118619         PERFORM 8100-SEND-DATA-ONLY                              11861999
118620         PERFORM 8200-RETURN-TRANID                               11862099
118621     ELSE                                                         11862199
118622         MOVE '1330-CHECK-PRNTTOFILE'                             11862299
118623                                    TO DP013-PARAGRAPH            11862399
118624         MOVE PV-CICS-RESPONSE                                    11862499
118625                                    TO DP013-MESSAGE-TEXT(1)      11862599
118626         SET DP013-LINK-RETURN                                    11862699
118627             DP013-CICS-ABEND                                     11862799
118628             DP013-NO-ROLLBACK TO TRUE                            11862899
118629         PERFORM DP014-0000-PROCESS-ABEND                         11862999
118630     END-IF.                                                      11863099
118631                                                                  11863199
118632                                                                  11863299
118633                                                                  11863399
118634******************************************************************11863499
118640 1400-HELP-SCREEN.                                                11864099
118700                                                                  11870099
118800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      11880099
118900     MOVE 'SUKRF512'                  TO PC192-PROGRAM-NAME       11890099
119000     COPY PCPD188.                                                11900099
119100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      11910099
119200     PERFORM 4700-XCTL-TO-HELP.                                   11920099
119300                                                                  11930099
119400******************************************************************11940099
119500*2000-PROCESS-SCREEN                                             *11950099
119600* THIS PARAGRAPH WILL PROCESS THE DATA ON THE SCREEN DEPENDING ON*11960099
119700* THE OPTION SELECTED.                                           *11970099
119800******************************************************************11980099
119900* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **11990099
120000* ANY CHANGES TO THIS PARAGRAPH MAY NEED TO BE COPIED TO THE SAME*12000099
120100* SECTION IN SUKRF515 (CARTON CLOSE SCREEN)                      *12010099
120200* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **12020099
120300******************************************************************12030099
120400 2000-PROCESS-SCREEN.                                             12040099
120500                                                                  12050099
120600     EVALUATE TRUE                                                12060099
120700*        THE USER WANTS TO CONTINUE WITH THE SHIPPING UNIT AUDIT. 12070099
120800*        IF THE SHIPPING UNIT HAS ALREADY BEEN COMPLETED, RE-OPEN 12080099
120900*        IT, IF IT HAS BEEN POSTPONED, CONTINUE IT...             12090099
121000         WHEN CA-CONTINUE-SELECTION                               12100099
121100             IF SU006-PREPK-ITYPE-PKGNG-CDE AND                   12110099
121200                                          SU006-PREPACK-NOT-CLOSED12120099
121300*  SET UP MESSAGE SCREEN                                          12130099
121400                SET SU006-PREPACK-CLOSED TO TRUE                  12140099
121500                SET PM-PREPACK-PREV-CLOSED TO TRUE                12150099
121600                MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR     12160099
121700                MOVE PC-MESSAGE-SCREEN-PROGRAM-NAME               12170099
121800                                         TO PV-TRANSFER-PROGRAM   12180099
121900                MOVE PC-CURRENT-PROGRAM-NAME TO SU006-LAST-PROGRAM12190099
122000                                                                  12200099
122100                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             12210099
122200             END-IF                                               12220099
122300                                                                  12230099
122400             SET CA-NOT-IN-CONFIRM-STATE TO TRUE                  12240099
122500             IF SU006-SHIP-UNIT-COMPLETE                          12250099
122600**     BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE           12260099
122700**     SUT_PO_AUD_REQ TABLE FOR THIS AUDIT                        12270099
122800                 PERFORM 3500-SELECT-AUDIT                        12280099
122900                 IF PS-SYSTEM-AUDIT-FOUND                         12290099
123000                     IF SU006-QC-AUDIT                            12300099
123100                        PERFORM 3700-GET-SCN-QTY                  12310099
123200                     ELSE                                         12320099
123300                        PERFORM 3750-GET-TGD-QTY                  12330099
123400                     END-IF                                       12340099
123500                                                                  12350099
123600                     COMPUTE SUT00015-AUD-CART-QTY =              12360099
123700                             SUT00015-AUD-CART-QTY - 1            12370099
123800                     COMPUTE SUT00015-AUD-UNT-QTY =               12380099
123900                             SUT00015-AUD-UNT-QTY - PV-SCN-QTY    12390099
124000                     PERFORM 3800-UPDATE-SUT-PO-AUD-REQ           12400099
124100                 END-IF                                           12410099
124200                 PERFORM 3100-REOPEN-SHIP-UNIT                    12420099
124300                 PERFORM 3900-DELETE-E-RECORDS                    12430099
124400             ELSE                                                 12440099
124500                 IF SU006-SHIP-UNIT-POSTPONE                      12450099
124600                     PERFORM 3200-CONTINUE-SHIP-UNIT              12460099
124700                 END-IF                                           12470099
124800             END-IF                                               12480099
124900                                                                  12490099
125000*            FOR I-PREPACK AND NOT ECOMMERCE GO TO                12500099
125100*            PREPACK QTY SCREEN, OTHERWISE                        12510099
125200*            CONTINUE ON TO THE UPC SCAN PROGRAM                  12520099
125300                                                                  12530099
125900             IF SU006-QC-AND-RFID-AUD                             12590099
126000                CONTINUE                                          12600099
126100             ELSE                                                 12610099
126200                MOVE PC-UPC-SCAN-PROGRAM-NAME                     12620099
126300                                        TO PV-TRANSFER-PROGRAM    12630099
126400                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             12640099
126500             END-IF                                               12650099
126900                                                                  12690099
127200                                                                  12720099
127300*        THE USER WANTS TO CLOSE THE SHIPPING UNIT.               12730099
127400*      - IF IT IS ALREADY CLOSE - SEND MESSAGE TO SAY SO          12740099
127500*      - IF IT IS POSTPONED, FIRST CONTINUE IT (GET THE MINUTES   12750099
127600*          THAT IS WAS POSTPONED)                                 12760099
127700*      - CHECK THE OVER/SHORT                                     12770099
127800*      - CLOSE IT                                                 12780099
127900         WHEN CA-CLOSE-SELECTION                                  12790099
128000                                                                  12800099
128100             SET CA-NOT-IN-CONFIRM-STATE TO TRUE                  12810099
128200*            IF COMPLETE, TELL THEM                               12820099
128300             IF SU006-SHIP-UNIT-COMPLETE                          12830099
128400                 MOVE PM-ALREADY-CLOSED-MSG                       12840099
128500                                        TO AMSGLNO                12850099
128600                 PERFORM 8100-SEND-DATA-ONLY                      12860099
128700                 PERFORM 8200-RETURN-TRANID                       12870099
128800             ELSE                                                 12880099
128900                 IF SU006-SHIP-UNIT-POSTPONE                      12890099
129000                     PERFORM 3200-CONTINUE-SHIP-UNIT              12900099
129100                 END-IF                                           12910099
129200             END-IF                                               12920099
129300                                                                  12930099
129400*         IF THE AUDIT IS SYSTEM GENERATED, CHECK FOR OVER/SHORT, 12940099
129500*         SET THE APPROPRIATE INDICATORS AND CREATE EXCEPTIONS    12950099
129600             IF SU006-SYSTEM-GENERATED-AUDIT                      12960099
129700                IF SU006-PRINTER-DEST = SPACES                    12970099
129800                   MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO   12980099
129900                   MOVE -1                          TO  ASELECTL  12990099
130000                   PERFORM 8100-SEND-DATA-ONLY                    13000099
130100                   PERFORM 8200-RETURN-TRANID                     13010099
130110                                                                  13011099
130111                ELSE                                              13011199
130112                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        13011299
130113                     SET PS-PRINT-TO-FILE-NO  TO TRUE             13011399
130114                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          13011499
130115                                                                  13011599
130116                     IF  PS-PRINT-TO-FILE-YES                     13011699
130117                         IF SU006-RFID-AUDIT                      13011799
130118                            PERFORM 4220-TAG-SCAN-QUANTITY-RTN    13011899
130119                         ELSE                                     13011999
130120                            PERFORM 4150-CHECK-OVER-SHORT         13012099
130121                         END-IF                                   13012199
130122                         IF  PS-OVER-SHORT-ERROR                  13012299
130123                             SET SU006-AUD-ERR   TO TRUE          13012399
130124                             SET CA-OVER-SHORT   TO TRUE          13012499
130125                         END-IF                                   13012599
130131                     END-IF                                       13013199
130140                                                                  13014099
130200                  ELSE                                            13020099
130300                    PERFORM 1310-VALIDATE-PRINTER                 13030099
130400                    IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A' 13040099
130500                       MOVE PM-INVALID-PRINTER-ID-MSG TO  AMSGLNO 13050099
130600                       MOVE -1                       TO  ASELECTL 13060099
130700                       PERFORM 8100-SEND-DATA-ONLY                13070099
130800                       PERFORM 8200-RETURN-TRANID                 13080099
130900                    ELSE                                          13090099
131000                       IF SU006-RFID-AUDIT                        13100099
131100                          PERFORM 4220-TAG-SCAN-QUANTITY-RTN      13110099
131200                       ELSE                                       13120099
131300                          PERFORM 4150-CHECK-OVER-SHORT           13130099
131400                       END-IF                                     13140099
131500                       IF PS-OVER-SHORT-ERROR                     13150099
131600                           SET SU006-AUD-ERR   TO TRUE            13160099
131700                           SET CA-OVER-SHORT   TO TRUE            13170099
131800                       END-IF                                     13180099
131900                    END-IF                                        13190099
131910                  END-IF                                          13191099
132000                END-IF                                            13200099
132100             ELSE                                                 13210099
132200*            IF THERE ARE NO ERRORS, CHECK OVER/SHORT AND SET THE 13220099
132300*            INDICATOR APPROPRIATELY (NO EXCEPTION CREATED).  THIS13230099
132400*            INDICATOR WILL UPDATE THE TABLE ERROR INDICATOR IN   13240099
132500*            PARAGRAPH 3300-CLOSE-SHIP-UNIT                       13250099
132600                 IF SU006-NO-AUD-ERR                              13260099
132700                     IF SU006-RFID-AUDIT                          13270099
132800                        PERFORM 4220-TAG-SCAN-QUANTITY-RTN        13280099
132900                     ELSE                                         13290099
133000                        PERFORM 4100-CHECK-OVER-SHORT             13300099
133100                     END-IF                                       13310099
133200                     IF PS-OVER-SHORT-ERROR                       13320099
133300                         SET SU006-AUD-ERR   TO TRUE              13330099
133400                         SET CA-OVER-SHORT   TO TRUE              13340099
133500                     END-IF                                       13350099
133600                 END-IF                                           13360099
133700             END-IF                                               13370099
133800*    IF THE CLOSE OPTION WAS SELECTED AND ERRORS EXISTS THE       13380099
133900*    PRINTER ID IS REQUIRED                                       13390099
134000             PERFORM 2200-SELECT-PRINT-IND                        13400099
134100             IF SU006-AUD-ERR AND                                 13410099
134200                PS-DO-PRINT-REPORT                                13420099
134300               IF SU006-PRINTER-DEST = SPACES                     13430099
134400                  MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO    13440099
134500                  MOVE -1                          TO  ASELECTL   13450099
134600                  PERFORM 8100-SEND-DATA-ONLY                     13460099
134700                  PERFORM 8200-RETURN-TRANID                      13470099
134701                                                                  13470199
134710               ELSE                                               13471099
134720                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        13472099
134730                     SET PS-PRINT-TO-FILE-NO  TO TRUE             13473099
134740                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          13474099
134750                                                                  13475099
134760                     IF  PS-PRINT-TO-FILE-YES                     13476099
134770                         MOVE SPACES       TO  CA-PRTR-CNTL-IND   13477099
134780                         MOVE ZEROES       TO  CA-TRACK-NBR       13478099
134790                                                                  13479099
134798                         PERFORM 1330-CHECK-PRNTTOFILE            13479899
134799***                                                               13479999
134800*** NOTE:  THIS REPORT IS NOT SET UP TO PRINT TO A FILE AT        13480099
134801***        THIS TIME.  WHEN IT DOES PARAGRAPH 3600 WILL NEED TO   13480199
134802***        BE MODIFIED - OR A NEW PARAGRAPH EXECUTED.             13480299
134803***                                                               13480399
134804                         IF  PS-REPORT-TO-FILE-YES                13480499
134805                             PERFORM 3600-SUBMIT-CART-DETAIL      13480599
134812                         END-IF                                   13481299
134818                     END-IF                                       13481899
134819                                                                  13481999
134820                  ELSE                                            13482099
134900                     PERFORM 1310-VALIDATE-PRINTER                13490099
135000                     IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A'13500099
135100                        MOVE PM-INVALID-PRINTER-ID-MSG TO AMSGLNO 13510099
135200                        MOVE -1                        TO ASELECTL13520099
135300                        PERFORM 8100-SEND-DATA-ONLY               13530099
135400                        PERFORM 8200-RETURN-TRANID                13540099
135500                    ELSE                                          13550099
135600                        MOVE DP072-PRTR-PRTR-CNTL-IND             13560099
135700                                            TO CA-PRTR-CNTL-IND   13570099
135800                                                                  13580099
135900                        MOVE DP072-PRTR-AUTO-CUTTER-IND           13590099
136000                                            TO  JL-SYSUT1-CUT-IND 13600099
136100                        MOVE DP072-PRTR-TRACK-NBR TO CA-TRACK-NBR 13610099
136200                        PERFORM 3600-SUBMIT-CART-DETAIL           13620099
136300                    END-IF                                        13630099
136310                  END-IF                                          13631099
136400               END-IF                                             13640099
136500             END-IF                                               13650099
136600             MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR       13660099
136700             MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR        13670099
136800             PERFORM 3050-GET-STAT-CDE                            13680099
136900             IF SUATRN-UNT-AUD-STAT-CDE = 'CM'                    13690099
137000                 SET PS-CARTON-ALREADY-COMPLETE  TO TRUE          13700099
137100             ELSE                                                 13710099
137200                 SET PS-CARTON-NOT-ALREADY-COMPLETE  TO TRUE      13720099
137300             END-IF                                               13730099
137400             MOVE SU006-SHIP-UNIT-STATUS                          13740099
137500                                    TO PV-SAVE-SHIP-UNIT-STATUS   13750099
137600             SET SU006-SHIP-UNIT-COMPLETE TO TRUE                 13760099
137700             PERFORM 3300-CLOSE-SHIP-UNIT                         13770099
137800             IF SU006-MANUAL-GENERATED-AUDIT                      13780099
137900               PERFORM 3250-LINK-COMMON-CARTON-CLOSE              13790099
138000               IF ( SU091-SUCCESS )                               13800099
138100                   CONTINUE                                       13810099
138200               ELSE                                               13820099
138300                 EVALUATE TRUE                                    13830099
138400                    WHEN SU091-PARAMETER-ERROR                    13840099
138500                        MOVE PC-CCC-PARM-ERR-MSG    TO AMSGLNO    13850099
138600                    WHEN SU091-DB2-ERROR                          13860099
138700                        MOVE PC-CCC-DB2-ERR-MSG     TO AMSGLNO    13870099
138800                    WHEN SU091-MQ-ERROR                           13880099
138900                        MOVE PC-CCC-MQ-ERR-MSG      TO AMSGLNO    13890099
139000                    WHEN SU091-OTHER-ERROR                        13900099
139100                        MOVE PC-CCC-OTHR-ERR-MSG    TO AMSGLNO    13910099
139200                 END-EVALUATE                                     13920099
139300                 PERFORM 8100-SEND-DATA-ONLY                      13930099
139400                 PERFORM 8200-RETURN-TRANID                       13940099
139500               END-IF                                             13950099
139600             END-IF                                               13960099
139700             PERFORM 3500-SELECT-AUDIT                            13970099
139800             IF  PS-SYSTEM-AUDIT-FOUND                            13980099
139900             AND PS-CARTON-NOT-ALREADY-COMPLETE                   13990099
140000                 IF SU006-QC-AUDIT                                14000099
140100                    PERFORM 3700-GET-SCN-QTY                      14010099
140200                 ELSE                                             14020099
140300                    PERFORM 3750-GET-TGD-QTY                      14030099
140400                 END-IF                                           14040099
140500                                                                  14050099
140600                 COMPUTE SUT00015-AUD-CART-QTY =                  14060099
140700                         SUT00015-AUD-CART-QTY + 1                14070099
140800                 COMPUTE SUT00015-AUD-UNT-QTY =                   14080099
140900                         SUT00015-AUD-UNT-QTY + PV-SCN-QTY        14090099
141000                 PERFORM 3800-UPDATE-SUT-PO-AUD-REQ               14100099
141100             END-IF                                               14110099
141200             MOVE PM-SHIP-UNIT-CLOSE-MSG                          14120099
141300                                        TO AMSGLNO                14130099
141400***          CARTON ADJMNTS ONLY NEED TO BE MADE FOR QC AUDITS.   14140099
141500             IF SU006-QC-AUDIT                                    14150099
141600               PERFORM 4000-CHECK-FOR-ADJUSTMENTS                 14160099
141700             END-IF                                               14170099
141800             PERFORM 8100-SEND-DATA-ONLY                          14180099
141900             PERFORM 8200-RETURN-TRANID                           14190099
142000                                                                  14200099
142100*        THE USER WANTS TO RESTART THE SHIPPING UNIT FROM SCRATCH.14210099
142200*        IF IT IS COMPLETE OR POSPONED, IT WILL HAVE TO FIRST BE  14220099
142300*        RE-OPENED.  THEN DELETE THE DETAIL/EXCPETIONS FOR THE    14230099
142400*        SHIPPING UNIT, AND GO ON TO THE UPC SCAN SCREEN          14240099
142500         WHEN CA-RESTART-SELECTION                                14250099
142600*            IF THE USER HAS CONFIRMED THE RESTART -- DO IT       14260099
142700             IF CA-CONFIRMED                                      14270099
142800                 IF SU006-SHIP-UNIT-COMPLETE                      14280099
142900**     BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE           14290099
143000**     SUT_PO_AUD_REQ TABLE FOR THIS AUDIT                        14300099
143100                     PERFORM 3500-SELECT-AUDIT                    14310099
143200                     IF PS-SYSTEM-AUDIT-FOUND                     14320099
143300                        IF SU006-QC-AUDIT                         14330099
143400                           PERFORM 3700-GET-SCN-QTY               14340099
143500                        ELSE                                      14350099
143600                           PERFORM 3750-GET-TGD-QTY               14360099
143700                         END-IF                                   14370099
143800                                                                  14380099
143900                         COMPUTE SUT00015-AUD-CART-QTY =          14390099
144000                                 SUT00015-AUD-CART-QTY - 1        14400099
144100                         COMPUTE SUT00015-AUD-UNT-QTY =           14410099
144200                                 SUT00015-AUD-UNT-QTY - PV-SCN-QTY14420099
144300                         PERFORM 3800-UPDATE-SUT-PO-AUD-REQ       14430099
144400                     END-IF                                       14440099
144500                     PERFORM 3100-REOPEN-SHIP-UNIT                14450099
144600                 ELSE                                             14460099
144700                     IF SU006-SHIP-UNIT-POSTPONE                  14470099
144800                         PERFORM 3200-CONTINUE-SHIP-UNIT          14480099
144900                     END-IF                                       14490099
145000                 END-IF                                           14500099
145100                                                                  14510099
145200                 PERFORM 3400-RESTART-SHIP-UNIT                   14520099
145300                                                                  14530099
145400*            FOR I-PREPACK AND NOT ECOMMERCE GO TO                14540099
145500*            PREPACK QTY SCREEN, OTHERWISE                        14550099
145600*            CONTINUE ON TO THE UPC SCAN PROGRAM                  14560099
145700                                                                  14570099
145800                 IF SU006-PREPK-ITYPE-PKGNG-CDE                   14580099
145900                    SET SU006-PREPACK-NOT-CLOSED TO TRUE          14590099
146000                    MOVE PC-PREPK-QTY-SCREEN-PROGRAM              14600099
146100                                            TO PV-TRANSFER-PROGRAM14610099
146200                 ELSE                                             14620099
146300                    MOVE PC-UPC-SCAN-PROGRAM-NAME                 14630099
146400                                            TO PV-TRANSFER-PROGRAM14640099
146500                 END-IF                                           14650099
146600                                                                  14660099
146700*            IF NOT A COMBINED AUDIT XFER TO OTHER PROGRAM        14670099
146800                IF SU006-QC-AND-RFID-AUD                          14680099
146900                   CONTINUE                                       14690099
147000                ELSE                                              14700099
147100                   PERFORM 2100-XCTL-TO-SELECTED-PROGRAM          14710099
147200                END-IF                                            14720099
147300            ELSE                                                  14730099
147400*               THE PROGRAM IS EXPECTING TO CONFIRM IT, AND IT    14740099
147500*               WASN'T (IE AN ENTER WAS PRESSED), CANCEL THE      14750099
147600*               RESTART                                           14760099
147700                IF CA-IN-CONFIRM-STATE                            14770099
147800                    SET CA-NOT-IN-CONFIRM-STATE TO TRUE           14780099
147900                    MOVE PM-CANCEL-RESTART-MSG  TO AMSGLNO        14790099
148000                    MOVE SPACES                 TO ASELECTO       14800099
148100                                                   CA-SELECTION-X 14810099
148200*               IF IT GOT TO HERE, IT WAS NOT IN CONFIRM STATUS   14820099
148300*               (INITIAL SELECTION OF RESTART) SET TO CONFIRM     14830099
148400*               STATE AND DISPLAY KEY TO F2 TO CONFIRM.           14840099
148500                ELSE                                              14850099
148600                    PERFORM 3500-SELECT-AUDIT                     14860099
148700                    IF PS-SYSTEM-AUDIT-FOUND AND                  14870099
148800                      (SUT00015-AUD-STAT-CDE = 'N' OR             14880099
148900                       SUT00015-AUD-STAT-CDE = 'P' OR             14890099
149000                       SUT00015-AUD-STAT-CDE = 'F')               14900099
149100                        MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG        14910099
149200                          TO AMSGLNO                              14920099
149300                        IF ( SUT00015-AUD-STAT-CDE = 'N' )        14930099
149400                            PERFORM 3250-LINK-COMMON-CARTON-CLOSE 14940099
149500                        END-IF                                    14950099
149600                        PERFORM 8100-SEND-DATA-ONLY               14960099
149700                        PERFORM 8200-RETURN-TRANID                14970099
149800                    ELSE                                          14980099
149900                        PERFORM 3920-SELECT-TSUNAUD               14990099
150000                        IF SUNAUD-AUD-STAT-CDE = 'CM'             15000099
150100                            MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG    15010099
150200                              TO AMSGLNO                          15020099
150300                            IF ( NOT PS-SYSTEM-AUDIT-FOUND )      15030099
150400                                PERFORM                           15040099
150500                                  3250-LINK-COMMON-CARTON-CLOSE   15050099
150600                            END-IF                                15060099
150700                            PERFORM 8100-SEND-DATA-ONLY           15070099
150800                            PERFORM 8200-RETURN-TRANID            15080099
150900                        ELSE                                      15090099
151000                            IF SU006-QC-AND-RFID-AUD              15100099
151100                               CONTINUE                           15110099
151200                            ELSE                                  15120099
151300                               SET CA-IN-CONFIRM-STATE  TO TRUE   15130099
151400                            END-IF                                15140099
151500                            MOVE PM-CONFIRM-RESTART-MSG TO AMSGLNO15150099
151600                        END-IF                                    15160099
151700                    END-IF                                        15170099
151800                END-IF                                            15180099
151900                MOVE -1                         TO ASELECTL       15190099
152000            END-IF                                                15200099
152100                                                                  15210099
152200*        DUH, ITS A PRINT                                         15220099
152300         WHEN CA-PRINT-SELECTION                                  15230099
152400*            CONTINUE ON TO THE PRINT PROGRAM                     15240099
152500             SET CA-NOT-IN-CONFIRM-STATE TO TRUE                  15250099
152600*           IF NOT A COMBINED AUDIT XFER TO OTHER PROGRAM         15260099
152700             IF SU006-QC-AND-RFID-AUD                             15270099
152800                CONTINUE                                          15280099
152900             ELSE                                                 15290099
153000                MOVE PC-PRINT-PROGRAM-NAME TO PV-TRANSFER-PROGRAM 15300099
153100                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             15310099
153200             END-IF                                               15320099
153500                                                                  15350099
153700         WHEN OTHER                                               15370099
153800             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          15380099
153900             MOVE SPACES                 TO AMSGLNO               15390099
154000                                                                  15400099
154100     END-EVALUATE.                                                15410099
154200                                                                  15420099
154300     SET PS-PRCS-SEC-AUDIT               TO TRUE.                 15430099
154400                                                                  15440099
154500******************************************************************15450099
154600*2050-PROCESS-SCREEN-FOR-CMBND.                                  *15460099
154700* THIS PARAGRAPH WILL PROCESS THE DATA ON THE SCREEN DEPENDING ON*15470099
154800* THE OPTION SELECTED.                                           *15480099
154900******************************************************************15490099
155000* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **15500099
155100* ANY CHANGES TO THIS PARAGRAPH MAY NEED TO BE COPIED TO THE SAME*15510099
155200* SECTION IN SUKRF515 (CARTON CLOSE SCREEN)                      *15520099
155300* * * * * * * * *  N O T E  * * * * * *  N O T E  * * * * * * * **15530099
155400******************************************************************15540099
155500 2050-PROCESS-SCREEN-FOR-CMBND.                                   15550099
155600                                                                  15560099
155700     SET CA-OVER-SHORT-FALSE TO TRUE.                             15570099
155800     SET PS-NO-OVER-SHORT-ERROR TO TRUE.                          15580099
155900     IF SU006-MANUAL-GENERATED-AUDIT                              15590099
156000        MOVE SU006-AUDIT-CNTL-NBR          TO DK-AUDIT-CNTL-NBR   15600099
156100     ELSE                                                         15610099
156200        MOVE SU006-RFID-AUDIT-CNTL-NBR     TO DK-AUDIT-CNTL-NBR   15620099
156300     END-IF.                                                      15630099
156400     MOVE SU006-SHIP-UNIT-NBR              TO DK-SHIP-UNIT-NBR.   15640099
156500     PERFORM 3050-GET-STAT-CDE.                                   15650099
156600     IF  SUATRN-UNT-AUD-STAT-CDE = 'CM'                           15660099
156700     AND SU006-SYSTEM-GENERATED-AUDIT                             15670099
156800        SET PS-CARTON-ALREADY-COMPLETE     TO TRUE                15680099
156900     ELSE                                                         15690099
157000        SET PS-CARTON-NOT-ALREADY-COMPLETE TO TRUE                15700099
157100     END-IF.                                                      15710099
157200                                                                  15720099
157300     EVALUATE TRUE                                                15730099
157400*        THE USER WANTS TO CONTINUE WITH THE SHIPPING UNIT AUDIT. 15740099
157500*        IF THE SHIPPING UNIT HAS ALREADY BEEN COMPLETED, RE-OPEN 15750099
157600*        IT, IF IT HAS BEEN POSTPONED, CONTINUE IT...             15760099
157700         WHEN CA-CONTINUE-SELECTION                               15770099
157800             IF SU006-PREPK-ITYPE-PKGNG-CDE AND                   15780099
157900                                          SU006-PREPACK-NOT-CLOSED15790099
158000*  SET UP MESSAGE SCREEN                                          15800099
158100                SET SU006-PREPACK-CLOSED TO TRUE                  15810099
158200                SET PM-PREPACK-PREV-CLOSED TO TRUE                15820099
158300                MOVE PM-PGM-MSG-NBR      TO SU006-PGM-MSG-NBR     15830099
158400                MOVE PC-MESSAGE-SCREEN-PROGRAM-NAME               15840099
158500                                         TO PV-TRANSFER-PROGRAM   15850099
158600                MOVE PC-CURRENT-PROGRAM-NAME TO SU006-LAST-PROGRAM15860099
158700                                                                  15870099
158800                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             15880099
158900             END-IF                                               15890099
159000                                                                  15900099
159100             SET CA-NOT-IN-CONFIRM-STATE TO TRUE                  15910099
159200             IF  PS-CARTON-ALREADY-COMPLETE                       15920099
159300             AND SU006-SYSTEM-GENERATED-AUDIT                     15930099
159400**     BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE           15940099
159500**     SUT_PO_AUD_REQ TABLE FOR THIS AUDIT                        15950099
159600                 PERFORM 3500-SELECT-AUDIT                        15960099
159700                 IF PS-SYSTEM-AUDIT-FOUND                         15970099
159800                     PERFORM 3750-GET-TGD-QTY                     15980099
159900                     COMPUTE SUT00015-AUD-CART-QTY =              15990099
160000                             SUT00015-AUD-CART-QTY - 1            16000099
160100                     COMPUTE SUT00015-AUD-UNT-QTY =               16010099
160200                             SUT00015-AUD-UNT-QTY - PV-SCN-QTY    16020099
160300                     PERFORM 3800-UPDATE-SUT-PO-AUD-REQ           16030099
160400                 END-IF                                           16040099
160500                 PERFORM 3100-REOPEN-SHIP-UNIT                    16050099
160600                 PERFORM 3900-DELETE-E-RECORDS                    16060099
160700             ELSE                                                 16070099
160800                 IF SU006-SHIP-UNIT-POSTPONE                      16080099
160900                     PERFORM 3200-CONTINUE-SHIP-UNIT              16090099
161000                 END-IF                                           16100099
161100             END-IF                                               16110099
161200                                                                  16120099
161300*            FOR I-PREPACK AND NOT ECOMMERCE GO TO                16130099
161400*            PREPACK QTY SCREEN, OTHERWISE                        16140099
161500*            CONTINUE ON TO THE UPC SCAN PROGRAM                  16150099
161600             MOVE PC-UPC-SCAN-PROGRAM-NAME                        16160099
161700                                     TO PV-TRANSFER-PROGRAM       16170099
161800             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                16180099
161900                                                                  16190099
162000*        THE USER WANTS TO CLOSE THE SHIPPING UNIT.               16200099
162100*      - IF IT IS ALREADY CLOSE - SEND MESSAGE TO SAY SO          16210099
162200*      - IF IT IS POSTPONED, FIRST CONTINUE IT (GET THE MINUTES   16220099
162300*          THAT IS WAS POSTPONED)                                 16230099
162400*      - CHECK THE OVER/SHORT                                     16240099
162500*      - CLOSE IT                                                 16250099
162600         WHEN CA-CLOSE-SELECTION                                  16260099
162700                                                                  16270099
162800             SET CA-NOT-IN-CONFIRM-STATE TO TRUE                  16280099
162900*            IF COMPLETE, TELL THEM                               16290099
163000             IF  PS-CARTON-ALREADY-COMPLETE                       16300099
163100               AND SU006-SYSTEM-GENERATED-AUDIT                   16310099
163200                 MOVE PM-ALREADY-CLOSED-MSG                       16320099
163300                                        TO AMSGLNO                16330099
163400                 PERFORM 8100-SEND-DATA-ONLY                      16340099
163500                 PERFORM 8200-RETURN-TRANID                       16350099
163600             ELSE                                                 16360099
163700                 IF SU006-SHIP-UNIT-POSTPONE                      16370099
163800                     PERFORM 3200-CONTINUE-SHIP-UNIT              16380099
163900                 END-IF                                           16390099
164000             END-IF                                               16400099
164100                                                                  16410099
164200*         IF THE AUDIT IS SYSTEM GENERATED, CHECK FOR OVER/SHORT, 16420099
164300*         SET THE APPROPRIATE INDICATORS AND CREATE EXCEPTIONS    16430099
164400             IF SU006-SYSTEM-GENERATED-AUDIT                      16440099
164500                IF SU006-PRINTER-DEST = SPACES                    16450099
164600                   MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO   16460099
164700                   MOVE -1                          TO  ASELECTL  16470099
164800                   PERFORM 8100-SEND-DATA-ONLY                    16480099
164900                   PERFORM 8200-RETURN-TRANID                     16490099
165000                ELSE                                              16500099
165001                                                                  16500199
165010                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        16501099
165020                     SET PS-PRINT-TO-FILE-NO  TO TRUE             16502099
165030                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          16503099
165050                     IF  PS-PRINT-TO-FILE-YES                     16505099
165060                         MOVE SPACES       TO  CA-PRTR-CNTL-IND   16506099
165070                         MOVE ZEROES       TO  CA-TRACK-NBR       16507099
165071                                                                  16507199
165072                         PERFORM 4240-OTHER-QUANTITY-RTN          16507299
165073                         IF  PS-OVER-SHORT-ERROR                  16507399
165074                             SET SU006-AUD-ERR   TO TRUE          16507499
165075                             SET CA-OVER-SHORT   TO TRUE          16507599
165076                         END-IF                                   16507699
165080                     ELSE                                         16508099
165090                        MOVE PC-PRINT-TO-FILE-ERR-MSG TO AMSGLNO  16509099
165091                        MOVE -1                       TO ASELECTL 16509199
165092                        PERFORM 8100-SEND-DATA-ONLY               16509299
165093                        PERFORM 8200-RETURN-TRANID                16509399
165094                     END-IF                                       16509499
165095                  ELSE                                            16509599
165096                                                                  16509699
165100                    PERFORM 1310-VALIDATE-PRINTER                 16510099
165200                    IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A' 16520099
165300                       MOVE PM-INVALID-PRINTER-ID-MSG TO  AMSGLNO 16530099
165400                       MOVE -1                       TO  ASELECTL 16540099
165500                       PERFORM 8100-SEND-DATA-ONLY                16550099
165600                       PERFORM 8200-RETURN-TRANID                 16560099
165700                    ELSE                                          16570099
165800                       PERFORM 4240-OTHER-QUANTITY-RTN            16580099
165900                       IF PS-OVER-SHORT-ERROR                     16590099
166000                           SET SU006-AUD-ERR   TO TRUE            16600099
166100                           SET CA-OVER-SHORT   TO TRUE            16610099
166200                       END-IF                                     16620099
166300                    END-IF                                        16630099
166301                  END-IF                                          16630199
166400                END-IF                                            16640099
166500             ELSE                                                 16650099
166600*            IF THERE ARE NO ERRORS, CHECK OVER/SHORT AND SET THE 16660099
166700*            INDICATOR APPROPRIATELY (NO EXCEPTION CREATED).  THIS16670099
166800*            INDICATOR WILL UPDATE THE TABLE ERROR INDICATOR IN   16680099
166900*            PARAGRAPH 3300-CLOSE-SHIP-UNIT                       16690099
167000                 IF SU006-NO-AUD-ERR                              16700099
167100                     PERFORM 4100-CHECK-OVER-SHORT                16710099
167200                     IF PS-OVER-SHORT-ERROR                       16720099
167300                         SET SU006-AUD-ERR   TO TRUE              16730099
167400                         SET CA-OVER-SHORT   TO TRUE              16740099
167500                     END-IF                                       16750099
167600                 END-IF                                           16760099
167700                 IF SU006-QC-AUD-ONLY                             16770099
167800                   CONTINUE                                       16780099
167900                 ELSE                                             16790099
168000                   PERFORM 4220-TAG-SCAN-QUANTITY-RTN             16800099
168100                 END-IF                                           16810099
168200             END-IF                                               16820099
168300*    IF THE CLOSE OPTION WAS SELECTED AND ERRORS EXISTS THE       16830099
168400*    PRINTER ID IS REQUIRED                                       16840099
168500             PERFORM 2200-SELECT-PRINT-IND                        16850099
168600             IF CA-OVER-SHORT AND                                 16860099
168700                PS-DO-PRINT-REPORT                                16870099
168800               IF SU006-PRINTER-DEST = SPACES                     16880099
168900                  MOVE PM-PRINTER-ID-REQUIRED-MSG  TO  AMSGLNO    16890099
169000                  MOVE -1                          TO  ASELECTL   16900099
169100                  PERFORM 8100-SEND-DATA-ONLY                     16910099
169200                  PERFORM 8200-RETURN-TRANID                      16920099
169210                                                                  16921099
169211               ELSE                                               16921199
169220                  IF SU006-PRINTER-DEST = PC-PRINT-TO-FILE        16922099
169230                     SET PS-PRINT-TO-FILE-NO  TO TRUE             16923099
169240                     PERFORM 1320-VALIDATE-PRINT-TO-FILE          16924099
169250                     IF  PS-PRINT-TO-FILE-YES                     16925099
169260                         MOVE SPACES       TO  CA-PRTR-CNTL-IND   16926099
169270                         MOVE ZEROES       TO  CA-TRACK-NBR       16927099
169279                         PERFORM 1330-CHECK-PRNTTOFILE            16927999
169280***                                                               16928099
169281*** NOTE:  THIS REPORT IS NOT SET UP TO PRINT TO A FILE AT        16928199
169282***        THIS TIME.  WHEN IT DOES PARAGRAPH 3600 WILL NEED TO   16928299
169283***        BE MODIFIED - OR A NEW PARAGRAPH EXECUTED.             16928399
169284***                                                               16928499
169285                         IF  PS-REPORT-TO-FILE-YES                16928599
169286                             PERFORM 3600-SUBMIT-CART-DETAIL      16928699
169293                         END-IF                                   16929399
169296                                                                  16929699
169302                     END-IF                                       16930299
169303                  ELSE                                            16930399
169400                    PERFORM 1310-VALIDATE-PRINTER                 16940099
169500                    IF DP072-PRTR-PRTR-TRK-STAT-CDE NOT EQUAL 'A' 16950099
169600                       MOVE PM-INVALID-PRINTER-ID-MSG TO AMSGLNO  16960099
169700                       MOVE -1                       TO  ASELECTL 16970099
169800                       PERFORM 8100-SEND-DATA-ONLY                16980099
169900                       PERFORM 8200-RETURN-TRANID                 16990099
170000                    ELSE                                          17000099
170100                       MOVE DP072-PRTR-PRTR-CNTL-IND              17010099
170200                                            TO CA-PRTR-CNTL-IND   17020099
170300                       MOVE DP072-PRTR-AUTO-CUTTER-IND            17030099
170400                                            TO  JL-SYSUT1-CUT-IND 17040099
170500                       MOVE DP072-PRTR-TRACK-NBR TO CA-TRACK-NBR  17050099
170600                       PERFORM 3600-SUBMIT-CART-DETAIL            17060099
170700                    END-IF                                        17070099
170710                  END-IF                                          17071099
170800               END-IF                                             17080099
170900             END-IF                                               17090099
171000             MOVE SU006-RFID-AUDIT-CNTL-NBR                       17100099
171100                                     TO DK-AUDIT-CNTL-NBR         17110099
171200             MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR        17120099
171300             MOVE SU006-SHIP-UNIT-STATUS                          17130099
171400                                      TO PV-SAVE-SHIP-UNIT-STATUS 17140099
171500             SET PS-CARTON-ALREADY-COMPLETE TO TRUE               17150099
171600             IF SU006-SYSTEM-GENERATED-AUDIT                      17160099
171700                PERFORM 3300-CLOSE-SHIP-UNIT                      17170099
171800             END-IF                                               17180099
171900             PERFORM 3250-LINK-COMMON-CARTON-CLOSE                17190099
172000             IF ( SU091-SUCCESS )                                 17200099
172100                 CONTINUE                                         17210099
172200             ELSE                                                 17220099
172300                 EVALUATE TRUE                                    17230099
172400                    WHEN SU091-PARAMETER-ERROR                    17240099
172500                        MOVE PC-CCC-PARM-ERR-MSG    TO AMSGLNO    17250099
172600                    WHEN SU091-DB2-ERROR                          17260099
172700                        MOVE PC-CCC-DB2-ERR-MSG     TO AMSGLNO    17270099
172800                    WHEN SU091-MQ-ERROR                           17280099
172900                        MOVE PC-CCC-MQ-ERR-MSG      TO AMSGLNO    17290099
173000                    WHEN SU091-OTHER-ERROR                        17300099
173100                        MOVE PC-CCC-OTHR-ERR-MSG    TO AMSGLNO    17310099
173200                 END-EVALUATE                                     17320099
173300                 PERFORM 8100-SEND-DATA-ONLY                      17330099
173400                 PERFORM 8200-RETURN-TRANID                       17340099
173500             END-IF                                               17350099
173600             PERFORM 3500-SELECT-AUDIT                            17360099
173700             IF  PS-SYSTEM-AUDIT-FOUND                            17370099
173800             AND PS-CARTON-NOT-ALREADY-COMPLETE                   17380099
173900                 PERFORM 3750-GET-TGD-QTY                         17390099
174000                                                                  17400099
174100                 COMPUTE SUT00015-AUD-CART-QTY =                  17410099
174200                         SUT00015-AUD-CART-QTY + 1                17420099
174300                 COMPUTE SUT00015-AUD-UNT-QTY =                   17430099
174400                         SUT00015-AUD-UNT-QTY + PV-SCN-QTY        17440099
174500                 PERFORM 3800-UPDATE-SUT-PO-AUD-REQ               17450099
174600             END-IF                                               17460099
174700             MOVE PM-SHIP-UNIT-CLOSE-MSG                          17470099
174800                                        TO AMSGLNO                17480099
174900             PERFORM 8100-SEND-DATA-ONLY                          17490099
175000             PERFORM 8200-RETURN-TRANID                           17500099
175100                                                                  17510099
175200*        THE USER WANTS TO RESTART THE SHIPPING UNIT FROM SCRATCH.17520099
175300*        IF IT IS COMPLETE OR POSPONED, IT WILL HAVE TO FIRST BE  17530099
175400*        RE-OPENED.  THEN DELETE THE DETAIL/EXCPETIONS FOR THE    17540099
175500*        SHIPPING UNIT, AND GO ON TO THE UPC SCAN SCREEN          17550099
175600         WHEN CA-RESTART-SELECTION                                17560099
175700*            IF THE USER HAS CONFIRMED THE RESTART -- DO IT       17570099
175800             IF CA-CONFIRMED                                      17580099
175900                 IF PS-CARTON-ALREADY-COMPLETE                    17590099
176000**     BACK OUT THE CARTON AND UNIT QUANTITIES FROM THE           17600099
176100**     SUT_PO_AUD_REQ TABLE FOR THIS AUDIT                        17610099
176200                     PERFORM 3500-SELECT-AUDIT                    17620099
176300                     IF PS-SYSTEM-AUDIT-FOUND                     17630099
176400                         PERFORM 3750-GET-TGD-QTY                 17640099
176500                         COMPUTE SUT00015-AUD-CART-QTY =          17650099
176600                                 SUT00015-AUD-CART-QTY - 1        17660099
176700                         COMPUTE SUT00015-AUD-UNT-QTY =           17670099
176800                                 SUT00015-AUD-UNT-QTY - PV-SCN-QTY17680099
176900                         PERFORM 3800-UPDATE-SUT-PO-AUD-REQ       17690099
177000                     END-IF                                       17700099
177100                     PERFORM 3100-REOPEN-SHIP-UNIT                17710099
177200                 ELSE                                             17720099
177300                     IF SU006-SHIP-UNIT-POSTPONE                  17730099
177400                         PERFORM 3200-CONTINUE-SHIP-UNIT          17740099
177500                     END-IF                                       17750099
177600                 END-IF                                           17760099
177700                                                                  17770099
177800                 PERFORM 3400-RESTART-SHIP-UNIT                   17780099
177900                                                                  17790099
178000*            FOR I-PREPACK AND NOT ECOMMERCE GO TO                17800099
178100*            PREPACK QTY SCREEN, OTHERWISE                        17810099
178200*            CONTINUE ON TO THE UPC SCAN PROGRAM                  17820099
178300                 IF SU006-PREPK-ITYPE-PKGNG-CDE                   17830099
178400                    SET SU006-PREPACK-NOT-CLOSED TO TRUE          17840099
178500                    MOVE PC-PREPK-QTY-SCREEN-PROGRAM              17850099
178600                                            TO PV-TRANSFER-PROGRAM17860099
178700                 ELSE                                             17870099
178800                    MOVE PC-UPC-SCAN-PROGRAM-NAME                 17880099
178900                                            TO PV-TRANSFER-PROGRAM17890099
179000                 END-IF                                           17900099
179100                                                                  17910099
179200                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            17920099
179300            ELSE                                                  17930099
179400*               THE PROGRAM IS EXPECTING TO CONFIRM IT, AND IT    17940099
179500*               WASN'T (IE AN ENTER WAS PRESSED), CANCEL THE      17950099
179600*               RESTART                                           17960099
179700                IF CA-IN-CONFIRM-STATE                            17970099
179800                    SET CA-NOT-IN-CONFIRM-STATE TO TRUE           17980099
179900                    MOVE PM-CANCEL-RESTART-MSG  TO AMSGLNO        17990099
180000                    MOVE SPACES                 TO ASELECTO       18000099
180100                                                   CA-SELECTION-X 18010099
180200*               IF IT GOT TO HERE, IT WAS NOT IN CONFIRM STATUS   18020099
180300*               (INITIAL SELECTION OF RESTART) SET TO CONFIRM     18030099
180400*               STATE AND DISPLAY KEY TO F2 TO CONFIRM.           18040099
180500                ELSE                                              18050099
180600                    PERFORM 3500-SELECT-AUDIT                     18060099
180700                    IF  PS-SYSTEM-AUDIT-FOUND                     18070099
180800                    AND (SUT00015-AUD-STAT-CDE = 'N'              18080099
180900                     OR  SUT00015-AUD-STAT-CDE = 'P'              18090099
181000                     OR  SUT00015-AUD-STAT-CDE = 'F')             18100099
181100                        MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG        18110099
181200                                                TO AMSGLNO        18120099
181300                        IF ( SUT00015-AUD-STAT-CDE = 'N' )        18130099
181400                            PERFORM 3250-LINK-COMMON-CARTON-CLOSE 18140099
181500                        END-IF                                    18150099
181600                        PERFORM 8100-SEND-DATA-ONLY               18160099
181700                        PERFORM 8200-RETURN-TRANID                18170099
181800                    ELSE                                          18180099
181900                        PERFORM 3920-SELECT-TSUNAUD               18190099
182000                        IF SUNAUD-AUD-STAT-CDE = 'CM'             18200099
182100                            MOVE PC-AUDIT-NO-LONGER-NEEDED-MSG    18210099
182200                              TO AMSGLNO                          18220099
182300                            IF ( NOT PS-SYSTEM-AUDIT-FOUND )      18230099
182400                                PERFORM                           18240099
182500                                  3250-LINK-COMMON-CARTON-CLOSE   18250099
182600                            END-IF                                18260099
182700                            PERFORM 8100-SEND-DATA-ONLY           18270099
182800                            PERFORM 8200-RETURN-TRANID            18280099
182900                        ELSE                                      18290099
183000                            SET CA-IN-CONFIRM-STATE     TO TRUE   18300099
183100                            MOVE PM-CONFIRM-RESTART-MSG TO AMSGLNO18310099
183200                        END-IF                                    18320099
183300                    END-IF                                        18330099
183400                END-IF                                            18340099
183500                MOVE -1                         TO ASELECTL       18350099
183600            END-IF                                                18360099
183700                                                                  18370099
183800*        DUH, ITS A PRINT                                         18380099
183900         WHEN CA-PRINT-SELECTION                                  18390099
184000*            CONTINUE ON TO THE PRINT PROGRAM                     18400099
184100             SET CA-NOT-IN-CONFIRM-STATE TO TRUE                  18410099
184200                MOVE PC-PRINT-PROGRAM-NAME TO PV-TRANSFER-PROGRAM 18420099
184300                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             18430099
184700                                                                  18470099
184800         WHEN OTHER                                               18480099
184900             SET CA-NOT-IN-CONFIRM-STATE         TO TRUE          18490099
185000             MOVE SPACES                 TO AMSGLNO               18500099
185100                                                                  18510099
185200     END-EVALUATE.                                                18520099
185300                                                                  18530099
185400******************************************************************18540099
185500 2100-XCTL-TO-SELECTED-PROGRAM.                                   18550099
185600                                                                  18560099
185700     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      18570099
185800     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        18580099
185900     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.        18590099
186000                                                                  18600099
186100     EXEC CICS                                                    18610099
186200         XCTL                                                     18620099
186300             PROGRAM   (PV-TRANSFER-PROGRAM)                      18630099
186400             COMMAREA  (CA-COMMAREA)                              18640099
186500             LENGTH    (PV-COMMAREA-LENGTH)                       18650099
186600             RESP      (PV-CICS-RESPONSE)                         18660099
186700     END-EXEC.                                                    18670099
186800                                                                  18680099
186900     EVALUATE TRUE                                                18690099
187000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 18700099
187100              CONTINUE                                            18710099
187200                                                                  18720099
187300         WHEN OTHER                                               18730099
187400              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                18740099
187500                                     TO DP013-PARAGRAPH           18750099
187600              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       18760099
187700                                     TO DP013-MESSAGE-TEXT (1)    18770099
187800              MOVE PV-TRANSFER-PROGRAM                            18780099
187900                                     TO DP013-MESSAGE-TEXT (2)    18790099
188000              SET DP013-CICS-ABEND   TO TRUE                      18800099
188100                                                                  18810099
188200              PERFORM 9999-WRITE-CICS-LOG-MSG                     18820099
188300              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     18830099
188400                                     TO AMSGLNO                   18840099
188500              SET SU006-PROCESS-SCREEN TO TRUE                    18850099
188600              PERFORM 8100-SEND-DATA-ONLY                         18860099
188700              PERFORM 8200-RETURN-TRANID                          18870099
188800     END-EVALUATE.                                                18880099
188900                                                                  18890099
189000******************************************************************18900099
189100 2200-SELECT-PRINT-IND.                                           18910099
189200                                                                  18920099
189300     MOVE SU006-OPER-UNT-ID        TO DK-LOC-ID.                  18930099
189400                                                                  18940099
189500     EXEC SQL                                                     18950099
189600         SELECT FUNC_TXT                                          18960099
189700           INTO :KRPRPM-FUNC-TXT                                  18970099
189800           FROM TKRPRPM                                           18980099
189900          WHERE SYS_PRC_FUNC_CDE  = 'CAUDRP'                      18990099
190000            AND LOC_ID            = :DK-LOC-ID                    19000099
190100            AND INTFC_SYS_CDE     = 'KHL'                         19010099
190200            AND FUNC_PRC_STAT_CDE = 'AC'                          19020099
190300            AND (CURRENT DATE                                     19030099
190400        BETWEEN DATE(FUNC_BEG_TMST) AND                           19040099
190500                DATE(FUNC_END_TMST) )                             19050099
190600     END-EXEC.                                                    19060099
190700                                                                  19070099
190800     EVALUATE SQLCODE                                             19080099
190900         WHEN ZERO                                                19090099
191000             IF KRPRPM-FUNC-TXT = 'Y'                             19100099
191100                 SET PS-DO-PRINT-REPORT TO TRUE                   19110099
191200             ELSE                                                 19120099
191300                 SET PS-DO-NOT-PRINT-REPORT TO TRUE               19130099
191400             END-IF                                               19140099
191500                                                                  19150099
191600         WHEN OTHER                                               19160099
191700              MOVE '2200-SELECT-PRINT-IND'                        19170099
191800                               TO DP013-PARAGRAPH                 19180099
191900              MOVE 'SELECT CARTON BUILD IND'                      19190099
192000                               TO DP013-MESSAGE-TEXT (1)          19200099
192100              MOVE SQLCA       TO DP013-SQLCA                     19210099
192200              SET DP013-DB2-ABEND                                 19220099
192300                               TO TRUE                            19230099
192400              PERFORM DP014-0000-PROCESS-ABEND                    19240099
192500     END-EVALUATE.                                                19250099
192600                                                                  19260099
192700******************************************************************19270099
192800*  3000-GET-CLOSED-MINUTES.                                      *19280099
192900*  SELECT THE NUMBER OF DAYS, HOURS AND MINUTES SINCE THE CARTON *19290099
193000*  WAS CLOSED/POSTPONED.                                         *19300099
193100******************************************************************19310099
193200 3000-GET-CLOSED-MINUTES.                                         19320099
193300                                                                  19330099
193400     EXEC SQL                                                     19340099
193500         SELECT                                                   19350099
193600            UNT_PSPND_MNIT_QTY                                    19360099
193700          , UNT_CLO_MNIT_QTY                                      19370099
193800          , DAYS(CURRENT TIMESTAMP)    - DAYS(UNT_AUD_STP_TMST)   19380099
193900          , HOUR(CURRENT TIMESTAMP)    - HOUR(UNT_AUD_STP_TMST)   19390099
194000          , MINUTE(CURRENT TIMESTAMP)  - MINUTE(UNT_AUD_STP_TMST) 19400099
194100          , CURRENT TIMESTAMP                                     19410099
194200         INTO   :SUATRN-UNT-PSPND-MNIT-QTY                        19420099
194300              , :SUATRN-UNT-CLO-MNIT-QTY                          19430099
194400              , :PV-CLOSED-DAYS                                   19440099
194500              , :PV-CLOSED-HOURS                                  19450099
194600              , :PV-CLOSED-MINUTES                                19460099
194700              , :PV-CURRENT-TIMESTAMP                             19470099
194800         FROM   TSUATRN                                           19480099
194900         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             19490099
195000           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              19500099
195100     END-EXEC.                                                    19510099
195200                                                                  19520099
195300     EVALUATE TRUE                                                19530099
195400         WHEN SQLCODE = ZERO                                      19540099
195500             COMPUTE PV-TOTAL-CLOSED-MINUTES =                    19550099
195600                ((PV-CLOSED-DAYS     * 1440) +                    19560099
195700                 (PV-CLOSED-HOURS    * 60)   +                    19570099
195800                  PV-CLOSED-MINUTES)                              19580099
195900                                                                  19590099
196000         WHEN SQLWARN0 NOT = SPACES                               19600099
196100         WHEN SQLCODE < ZERO                                      19610099
196200         WHEN SQLCODE > ZERO                                      19620099
196300             MOVE '3000-GET-CLOSED-MINUTES'                       19630099
196400                 TO DP013-PARAGRAPH                               19640099
196500             MOVE 'SELECT OF TSUATRN TABLE'                       19650099
196600                 TO DP013-MESSAGE-TEXT (1)                        19660099
196700             MOVE SU006-AUDIT-CNTL-NBR-X                          19670099
196800                 TO DP013-MESSAGE-TEXT (2)                        19680099
196900             MOVE SU006-SHIP-UNIT-NBR-X                           19690099
197000                 TO DP013-MESSAGE-TEXT (3)                        19700099
197100             MOVE SQLCA            TO DP013-SQLCA                 19710099
197200             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    19720099
197300             SET DP013-DB2-ABEND   TO TRUE                        19730099
197400                                                                  19740099
197500             PERFORM 9999-WRITE-CICS-LOG-MSG                      19750099
197600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               19760099
197700             PERFORM 8100-SEND-DATA-ONLY                          19770099
197800             PERFORM 8200-RETURN-TRANID                           19780099
197900     END-EVALUATE.                                                19790099
198000                                                                  19800099
198100******************************************************************19810099
198200*  3001-GET-OPENED-MINUTES.                                      *19820099
198300*  SELECT THE NUMBER OF DAYS, HOURS AND MINUTES SINCE THE CARTON *19830099
198400*  WAS OPENED -- THIS IS USED WHEN RESTARTING THE AUDIT          *19840099
198500******************************************************************19850099
198600 3001-GET-OPENED-MINUTES.                                         19860099
198700                                                                  19870099
198800     EXEC SQL                                                     19880099
198900         SELECT                                                   19890099
199000            UNT_RSTRT_MNIT_QTY                                    19900099
199100          , UNT_PSPND_MNIT_QTY                                    19910099
199200          , UNT_CLO_MNIT_QTY                                      19920099
199300          , DAYS(CURRENT TIMESTAMP)   - DAYS(UNT_AUD_STRT_TMST)   19930099
199400          , HOUR(CURRENT TIMESTAMP)   - HOUR(UNT_AUD_STRT_TMST)   19940099
199500          , MINUTE(CURRENT TIMESTAMP) - MINUTE(UNT_AUD_STRT_TMST) 19950099
199600          , CURRENT TIMESTAMP                                     19960099
199700         INTO   :SUATRN-UNT-RSTRT-MNIT-QTY                        19970099
199800              , :SUATRN-UNT-PSPND-MNIT-QTY                        19980099
199900              , :SUATRN-UNT-CLO-MNIT-QTY                          19990099
200000              , :PV-OPENED-DAYS                                   20000099
200100              , :PV-OPENED-HOURS                                  20010099
200200              , :PV-OPENED-MINUTES                                20020099
200300              , :PV-CURRENT-TIMESTAMP                             20030099
200400         FROM   TSUATRN                                           20040099
200500         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             20050099
200600           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              20060099
200700     END-EXEC.                                                    20070099
200800                                                                  20080099
200900     EVALUATE TRUE                                                20090099
201000         WHEN SQLCODE = ZERO                                      20100099
201100*        THE CALCULATION OF THE OPENED MINUTES WILL FIRST CALC    20110099
201200*        THE NUMBER OF MINUTES FROM START TO CURRENT TIMESTAMP,   20120099
201300*        AND THEN SUBTRACT THE TOTAL POSTPONED AND CLOSED MINUTES.20130099
201400             COMPUTE PV-TOTAL-OPENED-MINUTES =                    20140099
201500               (((PV-OPENED-DAYS     * 1440) +                    20150099
201600                 (PV-OPENED-HOURS    * 60)   +                    20160099
201700                  PV-OPENED-MINUTES) -                            20170099
201800                 SUATRN-UNT-PSPND-MNIT-QTY -                      20180099
201900                 SUATRN-UNT-CLO-MNIT-QTY )                        20190099
202000                                                                  20200099
202100         WHEN SQLWARN0 NOT = SPACES                               20210099
202200         WHEN SQLCODE < ZERO                                      20220099
202300         WHEN SQLCODE > ZERO                                      20230099
202400             MOVE '3001-GET-OPENED-MINUTES'                       20240099
202500                 TO DP013-PARAGRAPH                               20250099
202600             MOVE 'SELECT OF TSUATRN TABLE'                       20260099
202700                 TO DP013-MESSAGE-TEXT (1)                        20270099
202800             MOVE SU006-AUDIT-CNTL-NBR-X                          20280099
202900                 TO DP013-MESSAGE-TEXT (2)                        20290099
203000             MOVE SU006-SHIP-UNIT-NBR-X                           20300099
203100                 TO DP013-MESSAGE-TEXT (3)                        20310099
203200             MOVE SQLCA            TO DP013-SQLCA                 20320099
203300             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    20330099
203400             SET DP013-DB2-ABEND   TO TRUE                        20340099
203500                                                                  20350099
203600             PERFORM 9999-WRITE-CICS-LOG-MSG                      20360099
203700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               20370099
203800             PERFORM 8100-SEND-DATA-ONLY                          20380099
203900             PERFORM 8200-RETURN-TRANID                           20390099
204000     END-EVALUATE.                                                20400099
204100                                                                  20410099
204200******************************************************************20420099
204300 3050-GET-STAT-CDE.                                               20430099
204400                                                                  20440099
204500     EXEC SQL                                                     20450099
204600         SELECT UNT_AUD_STAT_CDE                                  20460099
204700           INTO :SUATRN-UNT-AUD-STAT-CDE                          20470099
204800           FROM TSUATRN                                           20480099
204900          WHERE AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                20490099
205000            AND SHIPT_UNT_ID  = :DK-SHIP-UNIT-NBR                 20500099
205100     END-EXEC.                                                    20510099
205200                                                                  20520099
205300     EVALUATE TRUE                                                20530099
205400         WHEN SQLCODE = ZERO                                      20540099
205500             CONTINUE                                             20550099
205600                                                                  20560099
205700         WHEN SQLWARN0 NOT = SPACES                               20570099
205800         WHEN SQLCODE < ZERO                                      20580099
205900         WHEN SQLCODE > ZERO                                      20590099
206000             MOVE '3050-GET-STAT-CDE'                             20600099
206100                 TO DP013-PARAGRAPH                               20610099
206200             MOVE 'SELECT OF TSUATRN TABLE'                       20620099
206300                 TO DP013-MESSAGE-TEXT (1)                        20630099
206400             MOVE SU006-AUDIT-CNTL-NBR-X                          20640099
206500                 TO DP013-MESSAGE-TEXT (2)                        20650099
206600             MOVE SU006-SHIP-UNIT-NBR-X                           20660099
206700                 TO DP013-MESSAGE-TEXT (3)                        20670099
206800             MOVE SQLCA            TO DP013-SQLCA                 20680099
206900             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    20690099
207000             SET DP013-DB2-ABEND   TO TRUE                        20700099
207100                                                                  20710099
207200             PERFORM 9999-WRITE-CICS-LOG-MSG                      20720099
207300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               20730099
207400             PERFORM 8100-SEND-DATA-ONLY                          20740099
207500             PERFORM 8200-RETURN-TRANID                           20750099
207600     END-EVALUATE.                                                20760099
207700                                                                  20770099
207800******************************************************************20780099
207900*  3100-REOPEN-SHIP-UNIT.                                        *20790099
208000*  THE SHIPPING UNIT HAS BEEN CLOSED, BUT THE USER WANTS TO RE-  *20800099
208100*  OPEN IT: 1) UPDATE THE "CLOSED TIMESTAMP".  CALC MINUTES FROM *20810099
208200*              CURRENT TIMESTAMP TO CLOSE TIMESTAMP              *20820099
208300*           2) UPDATE THE STOP TIMESTAMP TO INITIAL VALUES       *20830099
208400*           3) UPDATE THE STATUS TO INPROCESS                    *20840099
208500******************************************************************20850099
208600 3100-REOPEN-SHIP-UNIT.                                           20860099
208700                                                                  20870099
208800*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 20880099
208900*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS20890099
209000*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       20900099
209100*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  20910099
209200*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 20920099
209300*    SECOND IN THIS SCENARIO.                                     20930099
209400     IF PS-PRCS-FIRST-AUDIT                                       20940099
209500     OR SU006-RFID-AUD-ONLY                                       20950099
209600     OR SU006-MANUAL-GENERATED-AUDIT                              20960099
209700         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         20970099
209800     ELSE                                                         20980099
209900         MOVE SU006-RFID-AUDIT-CNTL-NBR                           20990099
210000                                     TO DK-AUDIT-CNTL-NBR         21000099
210100     END-IF.                                                      21010099
210200                                                                  21020099
210300     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         21030099
210400                                                                  21040099
210500*    IF THE ERROR FLAG WAS SET TO "Y", DOUBLE CHECK THE EXCEPTION 21050099
210600*    TABLES.  IF THERE ARE NO EXCEPTIONS, THAT MEANS THE FLAG WAS 21060099
210700*    SET DUE TO AN OVER/SHORT CHECK AT CLOSE TIME, AND SHOULD BE  21070099
210800*    RESET TO 'N' FOR THE REOPEN OF THE CARTON                    21080099
210900     IF SU006-AUD-ERR                                             21090099
211000         PERFORM 3110-CHECK-EXCEPTION-TABLES                      21100099
211100     END-IF.                                                      21110099
211200                                                                  21120099
211300*    GET THE NUMBER OF MINUTES THE CARTON WAS CLOSED...           21130099
211400     PERFORM 3000-GET-CLOSED-MINUTES.                             21140099
211500                                                                  21150099
211600*    UPDATE THE HOST VARIABLES WITH THE NEW REOPENED VALUES...    21160099
211700     ADD PV-TOTAL-CLOSED-MINUTES TO SUATRN-UNT-CLO-MNIT-QTY.      21170099
211800     MOVE '9999-09-09-09.09.09.999999'                            21180099
211900                                 TO SUATRN-UNT-AUD-STP-TMST.      21190099
212000     SET SU006-SHIP-UNIT-INPROCESS TO TRUE.                       21200099
212100     MOVE SU006-SHIP-UNIT-STATUS TO SUATRN-UNT-AUD-STAT-CDE.      21210099
212200                                                                  21220099
212300*    UPDATE INFORMATION                                           21230099
212400     EXEC SQL                                                     21240099
212500         UPDATE TSUATRN                                           21250099
212600            SET  UNT_AUD_STP_TMST  = :SUATRN-UNT-AUD-STP-TMST     21260099
212700               , UNT_CLO_MNIT_QTY  = :SUATRN-UNT-CLO-MNIT-QTY     21270099
212800               , UNT_AUD_STAT_CDE  = :SUATRN-UNT-AUD-STAT-CDE     21280099
212900               , UNT_AUD_ERR_IND   = :SU006-AUD-ERR-IND           21290099
213000          WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR            21300099
213100            AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR             21310099
213200     END-EXEC.                                                    21320099
213300                                                                  21330099
213400     EVALUATE TRUE                                                21340099
213500         WHEN SQLCODE = ZERO                                      21350099
213600             CONTINUE                                             21360099
213700                                                                  21370099
213800         WHEN SQLWARN0 NOT = SPACES                               21380099
213900         WHEN SQLCODE < ZERO                                      21390099
214000         WHEN SQLCODE > ZERO                                      21400099
214100             MOVE '3100-REOPEN-SHIP-UNIT'                         21410099
214200                                   TO DP013-PARAGRAPH             21420099
214300             MOVE 'UPDATE OF TSUATRN TABLE'                       21430099
214400                                   TO DP013-MESSAGE-TEXT (1)      21440099
214500             MOVE SU006-AUDIT-CNTL-NBR-X                          21450099
214600                                   TO DP013-MESSAGE-TEXT (2)      21460099
214700             MOVE SU006-SHIP-UNIT-NBR-X                           21470099
214800                                   TO DP013-MESSAGE-TEXT (3)      21480099
214900             MOVE SQLCA            TO DP013-SQLCA                 21490099
215000             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    21500099
215100             SET DP013-DB2-ABEND   TO TRUE                        21510099
215200                                                                  21520099
215300             SET SU006-SHIP-UNIT-COMPLETE TO TRUE                 21530099
215400             PERFORM 9999-WRITE-CICS-LOG-MSG                      21540099
215500             MOVE PM-DB2-FATAL-ERROR-MSG  TO AMSGLNO              21550099
215600             PERFORM 8100-SEND-DATA-ONLY                          21560099
215700             PERFORM 8200-RETURN-TRANID                           21570099
215800     END-EVALUATE.                                                21580099
215900                                                                  21590099
216000******************************************************************21600099
216100*  3110-CHECK-EXCEPTION-TABLES.                                  *21610099
216200*  CHECK THE EXCEPTION TABLES TO DETERMINE IF THERE ARE ANY      *21620099
216300*  EXCEPTIONS FOR THIS SHIPPING UNIT                             *21630099
216400******************************************************************21640099
216500 3110-CHECK-EXCEPTION-TABLES.                                     21650099
216600                                                                  21660099
216700*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 21670099
216800*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS21680099
216900*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       21690099
217000*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  21700099
217100*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 21710099
217200*    SECOND IN THIS SCENARIO.                                     21720099
217300     IF PS-PRCS-FIRST-AUDIT                                       21730099
217400     OR SU006-RFID-AUD-ONLY                                       21740099
217500     OR SU006-MANUAL-GENERATED-AUDIT                              21750099
217600         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         21760099
217700     ELSE                                                         21770099
217800         MOVE SU006-RFID-AUDIT-CNTL-NBR                           21780099
217900                                     TO DK-AUDIT-CNTL-NBR         21790099
218000     END-IF.                                                      21800099
218100                                                                  21810099
218200     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         21820099
218300                                                                  21830099
218400*    FIRST CHECK THE ITEM EXCEPTIONS (TSUEXCP)                    21840099
218500     EXEC SQL                                                     21850099
218600         SELECT AUD_CNTL_NBR                                      21860099
218700           INTO :SUEXCP-AUD-CNTL-NBR                              21870099
218800           FROM TSUEXCP                                           21880099
218900          WHERE AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                21890099
219000            AND SHIPT_UNT_ID  = :DK-SHIP-UNIT-NBR                 21900099
219100     END-EXEC.                                                    21910099
219200                                                                  21920099
219300     EVALUATE TRUE                                                21930099
219400         WHEN SQLCODE = ZERO                                      21940099
219500         WHEN SQLCODE = -811                                      21950099
219600         WHEN SQLCODE = +100                                      21960099
219700             CONTINUE                                             21970099
219800                                                                  21980099
219900         WHEN SQLWARN0 NOT = SPACES                               21990099
220000         WHEN SQLCODE < ZERO                                      22000099
220100         WHEN SQLCODE > ZERO                                      22010099
220200             MOVE '3110-CHECK-EXCEPTION-TABLES.'                  22020099
220300                                   TO DP013-PARAGRAPH             22030099
220400             MOVE 'SELECT OF TSUEXCP TABLE'                       22040099
220500                                   TO DP013-MESSAGE-TEXT (1)      22050099
220600             MOVE SU006-AUDIT-CNTL-NBR-X                          22060099
220700                                   TO DP013-MESSAGE-TEXT (2)      22070099
220800             MOVE SU006-SHIP-UNIT-NBR-X                           22080099
220900                                   TO DP013-MESSAGE-TEXT (3)      22090099
221000             MOVE SQLCA            TO DP013-SQLCA                 22100099
221100             MOVE 'TSUEXCP'        TO DP013-DB2-TABLE-NAME (1)    22110099
221200             SET DP013-DB2-ABEND   TO TRUE                        22120099
221300             SET DP013-NO-ROLLBACK TO TRUE                        22130099
221400             PERFORM 9999-WRITE-CICS-LOG-MSG                      22140099
221500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               22150099
221600             PERFORM 8100-SEND-DATA-ONLY                          22160099
221700             PERFORM 8200-RETURN-TRANID                           22170099
221800     END-EVALUATE.                                                22180099
221900                                                                  22190099
222000*    IF NO ITEM EXCEPTIONS, CHECK THE CARTON EXCEPTIONS           22200099
222100     IF SQLCODE = +100                                            22210099
222200         EXEC SQL                                                 22220099
222300             SELECT AUD_CNTL_NBR                                  22230099
222400               INTO :CTEXCP-AUD-CNTL-NBR                          22240099
222500               FROM TCTEXCP                                       22250099
222600             WHERE                                                22260099
222700                    AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR         22270099
222800               AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR          22280099
222900         END-EXEC                                                 22290099
223000                                                                  22300099
223100         EVALUATE TRUE                                            22310099
223200             WHEN SQLCODE = ZERO                                  22320099
223300             WHEN SQLCODE = -811                                  22330099
223400             WHEN SQLCODE = +100                                  22340099
223500                 CONTINUE                                         22350099
223600                                                                  22360099
223700             WHEN SQLWARN0 NOT = SPACES                           22370099
223800             WHEN SQLCODE < ZERO                                  22380099
223900             WHEN SQLCODE > ZERO                                  22390099
224000                 MOVE '3110-CHECK-EXCEPTION-TABLES.'              22400099
224100                     TO DP013-PARAGRAPH                           22410099
224200                 MOVE 'SELECT OF TSUEXCP TABLE'                   22420099
224300                     TO DP013-MESSAGE-TEXT (1)                    22430099
224400                 MOVE SU006-AUDIT-CNTL-NBR-X                      22440099
224500                     TO DP013-MESSAGE-TEXT (2)                    22450099
224600                 MOVE SU006-SHIP-UNIT-NBR-X                       22460099
224700                     TO DP013-MESSAGE-TEXT (3)                    22470099
224800                 MOVE SQLCA            TO DP013-SQLCA             22480099
224900                 MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)22490099
225000                 SET DP013-DB2-ABEND   TO TRUE                    22500099
225100                 SET DP013-NO-ROLLBACK TO TRUE                    22510099
225200                 PERFORM 9999-WRITE-CICS-LOG-MSG                  22520099
225300                 MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO           22530099
225400                 PERFORM 8100-SEND-DATA-ONLY                      22540099
225500                 PERFORM 8200-RETURN-TRANID                       22550099
225600         END-EVALUATE                                             22560099
225700     END-IF.                                                      22570099
225800                                                                  22580099
225900*    IF THERE WERE NO EXCEPTIONS, SET THE FLAG ACCORDINGLY        22590099
226000     IF SQLCODE = +100                                            22600099
226100         SET SU006-NO-AUD-ERR        TO TRUE                      22610099
226200     ELSE                                                         22620099
226300         SET SU006-AUD-ERR           TO TRUE                      22630099
226400     END-IF.                                                      22640099
226500                                                                  22650099
226600******************************************************************22660099
226700*  3200-CONTINUE-SHIP-UNIT                                       *22670099
226800*  THE SHIPPING UNIT HAS BEEN POSTPONED, AND THE USER WANTS TO   *22680099
226900*  CONTINUE AUDITING:                                            *22690099
227000*           1) UPDATE THE POSTPONED MINUTES..CALC MINUTES FROM   *22700099
227100*              STOP DATE/TIME TO CURRENT DATE/TIME               *22710099
227200*           2) UPDATE THE STOP DATE/TIME TO INITIAL VALUES       *22720099
227300*           3) UPDATE THE STATUS TO INPROCESS                    *22730099
227400******************************************************************22740099
227500 3200-CONTINUE-SHIP-UNIT.                                         22750099
227600                                                                  22760099
227700*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 22770099
227800*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS22780099
227900*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       22790099
228000*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  22800099
228100*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 22810099
228200*    SECOND IN THIS SCENARIO.                                     22820099
228300     IF PS-PRCS-FIRST-AUDIT                                       22830099
228400     OR SU006-RFID-AUD-ONLY                                       22840099
228500     OR SU006-MANUAL-GENERATED-AUDIT                              22850099
228600         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         22860099
228700     ELSE                                                         22870099
228800         MOVE SU006-RFID-AUDIT-CNTL-NBR                           22880099
228900                                     TO DK-AUDIT-CNTL-NBR         22890099
229000     END-IF.                                                      22900099
229100                                                                  22910099
229200     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         22920099
229300                                                                  22930099
229400*    GET THE NUMBER OF MINUTES THE CARTON WAS CLOSED...           22940099
229500     PERFORM 3000-GET-CLOSED-MINUTES.                             22950099
229600                                                                  22960099
229700*    UPDATE THE HOST VARIABLES WITH THE NEW CONTINUED VALUES...   22970099
229800     ADD PV-TOTAL-CLOSED-MINUTES TO SUATRN-UNT-PSPND-MNIT-QTY.    22980099
229900     MOVE '9999-09-09-09.09.09.999999'                            22990099
230000                                 TO SUATRN-UNT-AUD-STP-TMST.      23000099
230100     SET SU006-SHIP-UNIT-INPROCESS TO TRUE.                       23010099
230200     MOVE SU006-SHIP-UNIT-STATUS TO SUATRN-UNT-AUD-STAT-CDE.      23020099
230300                                                                  23030099
230400*    UPDATE INFORMATION                                           23040099
230500     EXEC SQL                                                     23050099
230600         UPDATE TSUATRN                                           23060099
230700            SET  UNT_AUD_STP_TMST    = :SUATRN-UNT-AUD-STP-TMST   23070099
230800               , UNT_PSPND_MNIT_QTY  = :SUATRN-UNT-PSPND-MNIT-QTY 23080099
230900               , UNT_AUD_STAT_CDE    = :SUATRN-UNT-AUD-STAT-CDE   23090099
231000         WHERE                                                    23100099
231100                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             23110099
231200           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              23120099
231300     END-EXEC.                                                    23130099
231400                                                                  23140099
231500     EVALUATE TRUE                                                23150099
231600         WHEN SQLCODE = ZERO                                      23160099
231700             CONTINUE                                             23170099
231800                                                                  23180099
231900         WHEN SQLWARN0 NOT = SPACES                               23190099
232000         WHEN SQLCODE < ZERO                                      23200099
232100         WHEN SQLCODE > ZERO                                      23210099
232200             MOVE '3200-CONTINUE-SHIP-UNIT'                       23220099
232300                 TO DP013-PARAGRAPH                               23230099
232400             MOVE 'UPDATE OF TSUATRN TABLE'                       23240099
232500                 TO DP013-MESSAGE-TEXT (1)                        23250099
232600             MOVE SU006-AUDIT-CNTL-NBR-X                          23260099
232700                 TO DP013-MESSAGE-TEXT (2)                        23270099
232800             MOVE SU006-SHIP-UNIT-NBR-X                           23280099
232900                 TO DP013-MESSAGE-TEXT (3)                        23290099
233000             MOVE SQLCA            TO DP013-SQLCA                 23300099
233100             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    23310099
233200             SET DP013-DB2-ABEND   TO TRUE                        23320099
233300             SET DP013-NO-ROLLBACK TO TRUE                        23330099
233400             SET SU006-SHIP-UNIT-POSTPONE TO TRUE                 23340099
233500             PERFORM 9999-WRITE-CICS-LOG-MSG                      23350099
233600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               23360099
233700             PERFORM 8100-SEND-DATA-ONLY                          23370099
233800             PERFORM 8200-RETURN-TRANID                           23380099
233900     END-EVALUATE.                                                23390099
234000                                                                  23400099
234100******************************************************************23410099
234200* 3250-LINK-COMMON-CARTON-CLOSE                                  *23420099
234300*     WHEN APPLICABLE FILL IN COPYBOOK SUWS091                   *23430099
234400*                     LINK TO SUKCS769                           *23440099
234500*                     CHECK RETURN FOR ERRORS UPON RETURN        *23450099
234600******************************************************************23460099
234700 3250-LINK-COMMON-CARTON-CLOSE.                                   23470099
234800                                                                  23480099
234900     INITIALIZE CCC-REQUEST-COMMUNICATION-AREA.                   23490099
235000                                                                  23500099
235100*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 23510099
235200*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS23520099
235300*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       23530099
235400*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  23540099
235500*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 23550099
235600*    SECOND IN THIS SCENARIO.                                     23560099
235700     IF PS-PRCS-FIRST-AUDIT                                       23570099
235800     OR SU006-RFID-AUD-ONLY                                       23580099
235900     OR SU006-MANUAL-GENERATED-AUDIT                              23590099
236000         MOVE SU006-AUDIT-CNTL-NBR                                23600099
236100                                  TO SU091-AUD-CNTL-NBR           23610099
236200     ELSE                                                         23620099
236300         MOVE SU006-RFID-AUDIT-CNTL-NBR                           23630099
236400                                  TO SU091-AUD-CNTL-NBR           23640099
236500     END-IF.                                                      23650099
236600     MOVE '00'                    TO SU091-RET-CODE.              23660099
236700     MOVE PC-CURRENT-PROGRAM-NAME TO SU091-CALLING-PGM.           23670099
236800     MOVE SU006-OPER-UNT-ID       TO SU091-OPER-UNT-ID.           23680099
236900     MOVE SU006-SHIP-UNIT-NBR     TO SU091-SHIPT-UNT-ID.          23690099
237000                                                                  23700099
237100     MOVE SUT00015-AUD-STAT-CDE   TO SU091-AUD-STAT-CDE.          23710099
237200                                                                  23720099
237300     IF ( SU006-SYSTEM-GENERATED-AUDIT )                          23730099
237400         SET SU091-PROMPTED-AUDIT TO TRUE                         23740099
237500     ELSE                                                         23750099
237600         IF ( SU006-MANUAL-GENERATED-AUDIT )                      23760099
237700             SET SU091-MANUAL-AUDIT TO TRUE                       23770099
237800         END-IF                                                   23780099
237900     END-IF.                                                      23790099
238000                                                                  23800099
238100     MOVE SU006-USERID            TO SU091-ASSOC-ID.              23810099
238200                                                                  23820099
238300     EXEC CICS LINK                                               23830099
238400               PROGRAM  (PC-COMMON-CARTON-CLOSE-PGM)              23840099
238500               COMMAREA (CCC-REQUEST-COMMUNICATION-AREA)          23850099
238600               LENGTH   (LENGTH OF CCC-REQUEST-COMMUNICATION-AREA)23860099
238700               RESP     (PV-CICS-RESPONSE)                        23870099
238800     END-EXEC.                                                    23880099
238900                                                                  23890099
239000     EVALUATE TRUE                                                23900099
239100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 23910099
239200             CONTINUE                                             23920099
239300                                                                  23930099
239400         WHEN OTHER                                               23940099
239500             MOVE '3250-LINK-COMMON-CARTON-CLOSE'                 23950099
239600               TO DP013-PARAGRAPH                                 23960099
239700             MOVE 'BAD LINK TO PGM SUKCS769'                      23970099
239800               TO DP013-MESSAGE-TEXT (1)                          23980099
239900             SET DP013-CICS-ABEND   TO TRUE                       23990099
240000             SET DP013-NO-ROLLBACK  TO TRUE                       24000099
240100             PERFORM 9999-WRITE-CICS-LOG-MSG                      24010099
240200     END-EVALUATE.                                                24020099
240300                                                                  24030099
240400******************************************************************24040099
240500*  3300-CLOSE-SHIP-UNIT                                          *24050099
240600*  THE USER WANTS TO CLOSE A SHIPPING UNIT:                      *24060099
240700*           1) UPDATE THE STOP DATE/TIME TO CURRENT VALUES       *24070099
240800*           2) UPDATE THE STATUS TO COMPLETE                     *24080099
240900******************************************************************24090099
241000 3300-CLOSE-SHIP-UNIT.                                            24100099
241100                                                                  24110099
241200*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 24120099
241300*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS24130099
241400*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       24140099
241500*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  24150099
241600*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 24160099
241700*    SECOND IN THIS SCENARIO.                                     24170099
241800     IF PS-PRCS-FIRST-AUDIT                                       24180099
241900     OR SU006-RFID-AUD-ONLY                                       24190099
242000     OR SU006-MANUAL-GENERATED-AUDIT                              24200099
242100         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         24210099
242200     ELSE                                                         24220099
242300         MOVE SU006-RFID-AUDIT-CNTL-NBR                           24230099
242400                                     TO DK-AUDIT-CNTL-NBR         24240099
242500     END-IF.                                                      24250099
242600                                                                  24260099
242700     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         24270099
242800     SET SU006-SHIP-UNIT-COMPLETE TO TRUE.                        24280099
242900                                                                  24290099
243000     IF  SU006-SHIP-UNIT-COMPLETE                                 24300099
243100         IF  SU006-INSTREAM-AUDIT                                 24310099
243200             IF  SU006-DC-NOT-INTERFACED                          24320099
243300                 CONTINUE                                         24330099
243400             ELSE                                                 24340099
243500                 PERFORM 3310-CALL-DLKUP001                       24350099
243600             END-IF                                               24360099
243700         ELSE                                                     24370099
243800             IF  SU006-DLX-CHECK-DONE                             24380099
243900                 IF  SU006-DC-NOT-INTERFACED                      24390099
244000                     CONTINUE                                     24400099
244100                 ELSE                                             24410099
244200                     PERFORM 3310-CALL-DLKUP001                   24420099
244300                 END-IF                                           24430099
244400             ELSE                                                 24440099
244500                 PERFORM 3370-CHECK-DLX-INTERFACE                 24450099
244600                 SET SU006-DLX-CHECK-DONE TO TRUE                 24460099
244700                 IF  SU006-DC-NOT-INTERFACED                      24470099
244800                     CONTINUE                                     24480099
244900                 ELSE                                             24490099
245000                     PERFORM 3310-CALL-DLKUP001                   24500099
245100                 END-IF                                           24510099
245200             END-IF                                               24520099
245300         END-IF                                                   24530099
245400     ELSE                                                         24540099
245500         CONTINUE                                                 24550099
245600     END-IF.                                                      24560099
245700                                                                  24570099
245800*    UPDATE HOST VARIABLES WITH THE NEW CLOSED VALUES             24580099
245900     MOVE SU006-SHIP-UNIT-STATUS TO PV-SAVE-SHIP-UNIT-STATUS.     24590099
246000     MOVE SU006-SHIP-UNIT-STATUS TO SUATRN-UNT-AUD-STAT-CDE.      24600099
246100                                                                  24610099
246200*    UPDATE INFORMATION                                           24620099
246300     EXEC SQL                                                     24630099
246400         UPDATE TSUATRN                                           24640099
246500            SET  UNT_AUD_STP_TMST    = CURRENT TIMESTAMP          24650099
246600               , UNT_AUD_STAT_CDE    = :SUATRN-UNT-AUD-STAT-CDE   24660099
246700               , UNT_AUD_ERR_IND     = :SU006-AUD-ERR-IND         24670099
246800         WHERE                                                    24680099
246900                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             24690099
247000           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              24700099
247100     END-EXEC.                                                    24710099
247200                                                                  24720099
247300     EVALUATE TRUE                                                24730099
247400         WHEN SQLCODE = ZERO                                      24740099
247500             CONTINUE                                             24750099
247600                                                                  24760099
247700         WHEN SQLWARN0 NOT = SPACES                               24770099
247800         WHEN SQLCODE < ZERO                                      24780099
247900         WHEN SQLCODE > ZERO                                      24790099
248000             MOVE '3300-CLOSE-SHIP-UNIT'                          24800099
248100                 TO DP013-PARAGRAPH                               24810099
248200             MOVE 'SELECT OF TSUATRN TABLE'                       24820099
248300                 TO DP013-MESSAGE-TEXT (1)                        24830099
248400             MOVE SU006-AUDIT-CNTL-NBR-X                          24840099
248500                 TO DP013-MESSAGE-TEXT (2)                        24850099
248600             MOVE SU006-SHIP-UNIT-NBR-X                           24860099
248700                 TO DP013-MESSAGE-TEXT (3)                        24870099
248800             MOVE SQLCA            TO DP013-SQLCA                 24880099
248900             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    24890099
249000             SET DP013-DB2-ABEND   TO TRUE                        24900099
249100                                                                  24910099
249200             MOVE PV-SAVE-SHIP-UNIT-STATUS                        24920099
249300                                   TO SU006-SHIP-UNIT-STATUS      24930099
249400             PERFORM 9999-WRITE-CICS-LOG-MSG                      24940099
249500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               24950099
249600             PERFORM 8100-SEND-DATA-ONLY                          24960099
249700             PERFORM 8200-RETURN-TRANID                           24970099
249800     END-EVALUATE.                                                24980099
249900                                                                  24990099
250000******************************************************************25000099
250100 3310-CALL-DLKUP001.                                              25010099
250200                                                                  25020099
250300     INITIALIZE DL001-ASGMT-COMMAREA.                             25030099
250400                                                                  25040099
250500     SET DL001-BY-ASGMT-KEY         TO TRUE.                      25050099
250600     SET DL001-COMMIT-UPDATE        TO TRUE.                      25060099
250700     SET DL001-FIND-NEXT-ASGMT      TO TRUE.                      25070099
250800                                                                  25080099
250900     MOVE SU006-ASGMT-STRT-DTE TO DL001-KEY-START-DTE.            25090099
251000     MOVE SU006-ASGMT-NBR-TXT  TO DL001-KEY-NBR-TXT.              25100099
251100     MOVE SU006-ASGMT-NBR-SEQ-NBR TO DL001-KEY-NBR-SEQ-NBR.       25110099
251200                                                                  25120099
251300     MOVE 1 TO DL001-NBR-OF-NBRS-NEED-QTY.                        25130099
251400     MOVE PC-CURRENT-PROGRAM-NAME TO DL001-ORIG-CALLING-PGM-NM.   25140099
251500                                                                  25150099
251600     CALL DL001-USER-PGM USING DFHEIBLK                           25160099
251700                               DL001-COMMAREA                     25170099
251800                               DL001-ASGMT-COMMAREA.              25180099
251900                                                                  25190099
252000     IF DL001-SUCCESSFUL                                          25200099
252100*       **********************************************************25210099
252200*       *  ASSIGNMENT SENT IN HAS BEEN CLOSED, DLKUP001 HAS SENT *25220099
252300*       *  BACK CURRENT OPEN ASSIGNMENT.                         *25230099
252400*       *                                                        *25240099
252500*       **********************************************************25250099
252600        IF DL001-ASGMT-NEXT-USED                                  25260099
252700           MOVE DL001-NXT-START-DTE TO  SU006-ASGMT-STRT-DTE      25270099
252800           MOVE DL001-NXT-NBR-TXT   TO  SU006-ASGMT-NBR-TXT       25280099
252900           MOVE DL001-NXT-NBR-SEQ-NBR TO                          25290099
253000                              SU006-ASGMT-NBR-SEQ-NBR             25300099
253100        END-IF                                                    25310099
253200                                                                  25320099
253300        PERFORM 3320-CALL-XLKUP033                                25330099
253400     ELSE                                                         25340099
253500        STRING PC-CURRENT-PROGRAM-NAME                            25350099
253600               ' - ERROR FROM DLKUP001 - '                        25360099
253700               DL001-RETURN-CODE                                  25370099
253800               ' - START DATE -  '                                25380099
253900               DL001-KEY-START-DTE                                25390099
254000               PV-BLANKS                                          25400099
254100               DELIMITED BY SIZE                                  25410099
254200               INTO PV-CICS-MSG-AREA2                             25420099
254300        PERFORM 999A-WRITE-CSSL-MSG                               25430099
254400                                                                  25440099
254500        STRING 'DL001-KEY-NBR-TXT -------> '                      25450099
254600               DL001-KEY-NBR-TXT                                  25460099
254700               PV-BLANKS                                          25470099
254800               DELIMITED BY SIZE                                  25480099
254900               INTO PV-CICS-MSG-AREA2                             25490099
255000        PERFORM 999A-WRITE-CSSL-MSG                               25500099
255100                                                                  25510099
255200        SET  DP013-OTHER-ABEND TO TRUE                            25520099
255300        SET  DP013-NO-ROLLBACK TO TRUE                            25530099
255400        MOVE '4100-DETERMINE-EAI-CALL' TO DP013-PARAGRAPH         25540099
255500     END-IF.                                                      25550099
255600                                                                  25560099
255700******************************************************************25570099
255800 3320-CALL-XLKUP033.                                              25580099
255900                                                                  25590099
256000     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        25600099
256100                                                                  25610099
256200     SET XL072-SU-APP-ID          TO TRUE.                        25620099
256300                                                                  25630099
256400     MOVE PC-CARTON               TO XL072-EVNT-OBJ-TXT.          25640099
256500     MOVE PC-AUDIT                TO XL072-EVNT-OBJ-ACTN-TXT.     25650099
256600     MOVE SU006-USERID            TO XL072-CRE-BY-USR-ID.         25660099
256700     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            25670099
256800     MOVE DK-SHIP-UNIT-NBR        TO XL072-EVNT-KY-1-NBR.         25680099
256900                                                                  25690099
257000     PERFORM 3500-SELECT-AUDIT.                                   25700099
257100                                                                  25710099
257200     IF PS-SYSTEM-AUDIT-FOUND                                     25720099
257300        MOVE SUT00015-INBND-TRIP-ID TO XL072-EVNT-KY-2-NBR        25730099
257400     END-IF.                                                      25740099
257500                                                                  25750099
257600     MOVE DK-AUDIT-CNTL-NBR       TO XL072-EVNT-KY-3-NBR.         25760099
257700     SET XL072-DO-NOT-COMMIT-UPDATE TO TRUE.                      25770099
257800     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-ORIG-CALLING-PGM-NM.   25780099
257900                                                                  25790099
258000     SET XL072-SUWS050-COPYBOOK TO TRUE.                          25800099
258100                                                                  25810099
258200     INITIALIZE SU050-DTL-TXT-AREA.                               25820099
258300     SET SU050-CRTN-AUDIT       TO TRUE.                          25830099
258400     MOVE SU006-ASGMT-STRT-DTE  TO SU050-AD-ASGMT-STRT-DTE.       25840099
258500     MOVE SU006-ASGMT-NBR-TXT   TO SU050-AD-ASGMT-NBR-TXT.        25850099
258600     MOVE SU006-ASGMT-NBR-SEQ-NBR TO SU050-AD-ASGMT-NBR-SEQ-NBR.  25860099
258700     MOVE DL001-SEQ-START-NBR     TO SU050-AD-ASGMT-SEQ-DTL-NBR.  25870099
258800     MOVE SU006-DOOR-ID           TO SU050-AD-DOOR-NBR.           25880099
258900                                                                  25890099
259000     PERFORM 3340-SELECT-TSULBXF.                                 25900099
259100                                                                  25910099
259200     PERFORM 3360-SELECT-TSUAUPC.                                 25920099
259300                                                                  25930099
259400     MOVE SU050-DTL-TXT-AREA      TO XL072-DTL-TXT.               25940099
259500                                                                  25950099
259600     CALL XL072-USER-PGM USING DFHEIBLK                           25960099
259700                               XL072-COMMAREA                     25970099
259800                               XL072-EAI-EXPORT-COMMAREA.         25980099
259900                                                                  25990099
260000     IF XL072-SUCCESSFUL                                          26000099
260100        CONTINUE                                                  26010099
260200     ELSE                                                         26020099
260300        STRING PC-CURRENT-PROGRAM-NAME                            26030099
260400               ' - ERROR FROM XLKUP033 - '                        26040099
260500               XL072-RETURN-CODE                                  26050099
260600               ' - OBJECT TXT - '                                 26060099
260700               XL072-EVNT-OBJ-TXT                                 26070099
260800               ' - CRE USR - '                                    26080099
260900               XL072-CRE-BY-USR-ID                                26090099
261000               PV-BLANKS                                          26100099
261100               DELIMITED BY SIZE                                  26110099
261200               INTO PV-CICS-MSG-AREA2                             26120099
261300        PERFORM 999A-WRITE-CSSL-MSG                               26130099
261400                                                                  26140099
261500        STRING 'OBJECT ACTN TXT ---> '                            26150099
261600               XL072-EVNT-OBJ-ACTN-TXT                            26160099
261700               ' CRE PGM - '                                      26170099
261800               XL072-CRE-PGM-NM                                   26180099
261900               PV-BLANKS                                          26190099
262000               DELIMITED BY SIZE                                  26200099
262100               INTO PV-CICS-MSG-AREA2                             26210099
262200        PERFORM 999A-WRITE-CSSL-MSG                               26220099
262300                                                                  26230099
262400        SET  DP013-OTHER-ABEND TO TRUE                            26240099
262500        SET  DP013-NO-ROLLBACK TO TRUE                            26250099
262600        MOVE '3320-CALL-XLKUP033' TO DP013-PARAGRAPH              26260099
262700     END-IF.                                                      26270099
262800                                                                  26280099
262900******************************************************************26290099
263000 3340-SELECT-TSULBXF.                                             26300099
263100                                                                  26310099
263200     EXEC SQL                                                     26320099
263300         SELECT  SHIPT_UNT_ID                                     26330099
263400                ,CART_LBL_TYP_CDE                                 26340099
263500                ,DEST_OPER_UNT_ID                                 26350099
263600                                                                  26360099
263700           INTO :SULBXF-SHIPT-UNT-ID                              26370099
263800               ,:SULBXF-CART-LBL-TYP-CDE                          26380099
263900               ,:SULBXF-DEST-OPER-UNT-ID                          26390099
264000                                                                  26400099
264100           FROM TSULBXF                                           26410099
264200                                                                  26420099
264300          WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                  26430099
264400            AND STAT_CDE     = :PC-A                              26440099
264500     END-EXEC.                                                    26450099
264600                                                                  26460099
264700     EVALUATE TRUE                                                26470099
264800         WHEN SQLCODE = ZERO OR                                   26480099
264900              SQLCODE = -811                                      26490099
265000              EVALUATE TRUE                                       26500099
265100                  WHEN SULBXF-CART-LBL-TYP-CDE = 'P'              26510099
265200                       SET SU050-AD-CRTN-TO-P2L TO TRUE           26520099
265300                       MOVE 0 TO SU050-AD-CRTN-DEST-LOC-NBR       26530099
265400                                                                  26540099
265500                  WHEN OTHER                                      26550099
265600                       SET SU050-AD-CRTN-TO-LOC TO TRUE           26560099
265700                       MOVE SULBXF-DEST-OPER-UNT-ID TO            26570099
265800                                   SU050-AD-CRTN-DEST-LOC-NBR     26580099
265900                                                                  26590099
266000              END-EVALUATE                                        26600099
266100                                                                  26610099
266200         WHEN SQLCODE = +100                                      26620099
266300              SET SU050-AD-CRTN-TO-NONE TO TRUE                   26630099
266400              MOVE 0 TO SU050-AD-CRTN-DEST-LOC-NBR                26640099
266500                                                                  26650099
266600         WHEN SQLWARN0 NOT = SPACES                               26660099
266700         WHEN SQLCODE < ZERO                                      26670099
266800         WHEN SQLCODE > ZERO                                      26680099
266900             MOVE '3340-SELECT-TSULBXF'                           26690099
267000                 TO DP013-PARAGRAPH                               26700099
267100             MOVE 'SELECT OF TSULBXF TABLE'                       26710099
267200                 TO DP013-MESSAGE-TEXT (1)                        26720099
267300             MOVE SQLCA            TO DP013-SQLCA                 26730099
267400             MOVE 'TSULBXF'        TO DP013-DB2-TABLE-NAME (1)    26740099
267500             SET DP013-DB2-ABEND   TO TRUE                        26750099
267600             PERFORM 9999-WRITE-CICS-LOG-MSG                      26760099
267700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               26770099
267800             PERFORM 8100-SEND-DATA-ONLY                          26780099
267900             PERFORM 8200-RETURN-TRANID                           26790099
268000     END-EVALUATE.                                                26800099
268100                                                                  26810099
268200******************************************************************26820099
268300 3360-SELECT-TSUAUPC.                                             26830099
268400                                                                  26840099
268500     EXEC SQL                                                     26850099
268600          SELECT SUM(SCND_UNT_QTY)                                26860099
268700            INTO :PV-TOTAL-SCND-UNT-QTY                           26870099
268800            FROM TSUAUPC                                          26880099
268900            WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR               26890099
269000              AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                26900099
269100              AND SCN_TYP_CDE  IN ('S', 'P', 'O')                 26910099
269200     END-EXEC.                                                    26920099
269300                                                                  26930099
269400     EVALUATE TRUE                                                26940099
269500         WHEN SQLCODE = ZERO                                      26950099
269600              MOVE PV-TOTAL-SCND-UNT-QTY TO SU050-AD-AUDIT-QTY    26960099
269700                                                                  26970099
269800         WHEN SQLCODE = +100                                      26980099
269900         WHEN SQLCODE = -305                                      26990099
270000              MOVE 0 TO SU050-AD-AUDIT-QTY                        27000099
270100                                                                  27010099
270200         WHEN SQLWARN0 NOT = SPACES                               27020099
270300         WHEN SQLCODE < ZERO                                      27030099
270400         WHEN SQLCODE > ZERO                                      27040099
270500             MOVE '3360-SELECT-TSUAUPC'                           27050099
270600                 TO DP013-PARAGRAPH                               27060099
270700             MOVE 'SELECT OF TSUAUPC TABLE'                       27070099
270800                 TO DP013-MESSAGE-TEXT (1)                        27080099
270900             MOVE SQLCA            TO DP013-SQLCA                 27090099
271000             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    27100099
271100             SET DP013-DB2-ABEND   TO TRUE                        27110099
271200             PERFORM 9999-WRITE-CICS-LOG-MSG                      27120099
271300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               27130099
271400             PERFORM 8100-SEND-DATA-ONLY                          27140099
271500             PERFORM 8200-RETURN-TRANID                           27150099
271600     END-EVALUATE.                                                27160099
271700                                                                  27170099
271800******************************************************************27180099
271900*  3370-CHECK-DLX-INTERFACE                                      *27190099
272000*  WE HAVE GOTTEN TO THE PARAGRAPCH BECAUSE THE ASSOCIATE IS     *27200099
272100*  DOING AN AUDIT THAT IS NOT INSTREAM AND THE PROGRAM NEEDS     *27210099
272200*  TO DETERMINE IF IT NEEDS TO INTERFACE DATA TO THE EAI         *27220099
272300*  BUSINESS EVENT TABLES FOR THE CLOSE OF THE CARTON AUDIT.      *27230099
272400*                                                                *27240099
272500*  THE FIRST CHECK TO BE DONE WILL BE TO CHECK THE PARM TABLE    *27250099
272600*  TO DETERMINE IF THE DC IS INTERFACING TO DLX LABOR.           *27260099
272700*                                                                *27270099
272800*  IF IT IS INTERFACING TO DLX LABOR, THE PROGRAM WILL THEN GO   *27280099
272900*  TO THE 3380-CHECK-FOR-ASSIGNMENT PARAGRAPH TO DETERMINE IF    *27290099
273000*  THE ASSOCIATE IS ALREADY ON AN ASSIGNMENT AND IF THAT         *27300099
273100*  ASSIGNMENT CAN BE USED FOR THE INTERFACE OF THE CARTON AUDIT  *27310099
273200*  DATA (DEPENDING ON THE WORK TYPE ASSOCIATED TO THE            *27320099
273300*  ASSIGNMENT).                                                  *27330099
273400******************************************************************27340099
273500 3370-CHECK-DLX-INTERFACE.                                        27350099
273600                                                                  27360099
273700     SET PS-DLX-NOT-LIVE-INTERFACE TO TRUE.                       27370099
273800     PERFORM 3375-CHECK-DLX-IND.                                  27380099
273900                                                                  27390099
274000     IF  PS-DLX-LIVE-INTERFACE                                    27400099
274100         PERFORM 3380-CHECK-FOR-ASSIGNMENT                        27410099
274200         IF  PS-CALLED-MODULE-NOT-OK                              27420099
274300             CONTINUE                                             27430099
274400         ELSE                                                     27440099
274500             IF  DL003-ASGMT-NOT-FOUND                            27450099
274600                 SET PS-CALLED-MODULE-NOT-OK TO TRUE              27460099
274700                 PERFORM 3390-CALL-DLKCS410                       27470099
274800                 IF  PS-CALLED-MODULE-NOT-OK                      27480099
274900                     SET DP013-LINK-RETURN                        27490099
275000                         DP013-CICS-ABEND                         27500099
275100                         DP013-ROLLBACK TO TRUE                   27510099
275200                     PERFORM DP014-0000-PROCESS-ABEND             27520099
275300                     MOVE PV-SAVE-SHIP-UNIT-STATUS                27530099
275400                                      TO SU006-SHIP-UNIT-STATUS   27540099
275500                     MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO       27550099
275600                     PERFORM 8100-SEND-DATA-ONLY                  27560099
275700                     PERFORM 8200-RETURN-TRANID                   27570099
275800                 ELSE                                             27580099
275900                     MOVE DL016-ESO-ASGMT-START-DTE TO            27590099
276000                          SU006-ASGMT-STRT-DTE                    27600099
276100                     MOVE DL016-ESO-ASGMT-NBR-TXT TO              27610099
276200                          SU006-ASGMT-NBR-TXT                     27620099
276300                     MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR TO          27630099
276400                          SU006-ASGMT-NBR-SEQ-NBR                 27640099
276500                 END-IF                                           27650099
276600             ELSE                                                 27660099
276700                 IF  SU006-RECV-PRCS-AREA                         27670099
276800                     MOVE DL003-ASGMT-START-DTE TO                27680099
276900                          SU006-ASGMT-STRT-DTE                    27690099
277000                     MOVE DL003-ASGMT-NBR-TXT TO                  27700099
277100                          SU006-ASGMT-NBR-TXT                     27710099
277200                     MOVE DL003-ASGMT-NBR-SEQ-NBR TO              27720099
277300                          SU006-ASGMT-NBR-SEQ-NBR                 27730099
277400                 ELSE                                             27740099
277500                     MOVE DL003-ASGMT-WK-AREA-DESC TO             27750099
277600                          DL011-FLAT-FQA-WRK-AREA                 27760099
277700                     IF  DL011-FQ-WRK-AREA-1-3 = 'FQA'            27770099
277800                         MOVE DL003-ASGMT-START-DTE TO            27780099
277900                              SU006-ASGMT-STRT-DTE                27790099
278000                         MOVE DL003-ASGMT-NBR-TXT TO              27800099
278100                              SU006-ASGMT-NBR-TXT                 27810099
278200                         MOVE DL003-ASGMT-NBR-SEQ-NBR TO          27820099
278300                              SU006-ASGMT-NBR-SEQ-NBR             27830099
278400                     ELSE                                         27840099
278500                         SET PS-CALLED-MODULE-NOT-OK TO TRUE      27850099
278600                         PERFORM 3390-CALL-DLKCS410               27860099
278700                         IF  PS-CALLED-MODULE-NOT-OK              27870099
278800                             SET DP013-LINK-RETURN                27880099
278900                                 DP013-CICS-ABEND                 27890099
279000                                 DP013-ROLLBACK TO TRUE           27900099
279100                             PERFORM DP014-0000-PROCESS-ABEND     27910099
279200                             MOVE PV-SAVE-SHIP-UNIT-STATUS TO     27920099
279300                                  SU006-SHIP-UNIT-STATUS          27930099
279400                             MOVE PM-DB2-FATAL-ERROR-MSG TO       27940099
279500                                  AMSGLNO                         27950099
279600                             PERFORM 8100-SEND-DATA-ONLY          27960099
279700                             PERFORM 8200-RETURN-TRANID           27970099
279800                         ELSE                                     27980099
279900                             MOVE DL016-ESO-ASGMT-START-DTE TO    27990099
280000                                  SU006-ASGMT-STRT-DTE            28000099
280100                             MOVE DL016-ESO-ASGMT-NBR-TXT TO      28010099
280200                                  SU006-ASGMT-NBR-TXT             28020099
280300                             MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR TO  28030099
280400                                  SU006-ASGMT-NBR-SEQ-NBR         28040099
280500                         END-IF                                   28050099
280600                     END-IF                                       28060099
280700                 END-IF                                           28070099
280800             END-IF                                               28080099
280900         END-IF                                                   28090099
281000     END-IF.                                                      28100099
281100                                                                  28110099
281200******************************************************************28120099
281300 3375-CHECK-DLX-IND.                                              28130099
281400                                                                  28140099
281500     MOVE SU006-OPER-UNT-ID        TO DK-LOC-ID.                  28150099
281600                                                                  28160099
281700     EXEC SQL                                                     28170099
281800          SELECT  FUNC_TXT                                        28180099
281900            INTO :KRPRPM-FUNC-TXT                                 28190099
282000            FROM  TKRPRPM                                         28200099
282100           WHERE  LOC_ID            = :DK-LOC-ID                  28210099
282200             AND  INTFC_SYS_CDE     = 'DLX'                       28220099
282300             AND  SYS_PRC_FUNC_CDE  = 'DLLBIN'                    28230099
282400     END-EXEC.                                                    28240099
282500                                                                  28250099
282600     EVALUATE SQLCODE                                             28260099
282700         WHEN ZERO                                                28270099
282800              IF  KRPRPM-FUNC-TXT  = 'Y'                          28280099
282900                  SET PS-DLX-LIVE-INTERFACE TO TRUE               28290099
283000              END-IF                                              28300099
283100                                                                  28310099
283200         WHEN OTHER                                               28320099
283300              MOVE '3375-CHECK-DLX-IND'                           28330099
283400                               TO DP013-PARAGRAPH                 28340099
283500              MOVE 'DLX INTERFACE INDICATOR'                      28350099
283600                               TO DP013-MESSAGE-TEXT (1)          28360099
283700              MOVE SQLCA       TO DP013-SQLCA                     28370099
283800              SET DP013-DB2-ABEND                                 28380099
283900                               TO TRUE                            28390099
284000              PERFORM DP014-0000-PROCESS-ABEND                    28400099
284100     END-EVALUATE.                                                28410099
284200                                                                  28420099
284300******************************************************************28430099
284400 3380-CHECK-FOR-ASSIGNMENT.                                       28440099
284500                                                                  28450099
284600     SET PS-CALLED-MODULE-NOT-OK TO TRUE.                         28460099
284700     PERFORM 3385-CALL-DLKUT001.                                  28470099
284800                                                                  28480099
284900     IF  PS-CALLED-MODULE-NOT-OK                                  28490099
285000         SET DP013-LINK-RETURN                                    28500099
285100             DP013-CICS-ABEND                                     28510099
285200             DP013-ROLLBACK TO TRUE                               28520099
285300         PERFORM DP014-0000-PROCESS-ABEND                         28530099
285400         MOVE PV-SAVE-SHIP-UNIT-STATUS                            28540099
285500                          TO SU006-SHIP-UNIT-STATUS               28550099
285600         MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO                   28560099
285700         PERFORM 8100-SEND-DATA-ONLY                              28570099
285800         PERFORM 8200-RETURN-TRANID                               28580099
285900     END-IF.                                                      28590099
286000                                                                  28600099
286100******************************************************************28610099
286200 3385-CALL-DLKUT001.                                              28620099
286300                                                                  28630099
286400     INITIALIZE  DL003-ASGMT-COMMAREA.                            28640099
286500     SET DL003-BY-USER-KEY TO  TRUE.                              28650099
286600     MOVE SU006-USERID TO DL003-KEY-USER-ID.                      28660099
286700     MOVE PC-CURRENT-PROGRAM-NAME                                 28670099
286800                              TO  DL003-ORIG-CALLING-PGM-NM.      28680099
286900                                                                  28690099
287000     CALL DL003-USER-PGM USING DFHEIBLK                           28700099
287100                               DL003-COMMAREA                     28710099
287200                               DL003-ASGMT-COMMAREA.              28720099
287300                                                                  28730099
287400     EVALUATE TRUE                                                28740099
287500         WHEN DL003-SUCCESSFUL                                    28750099
287600             EVALUATE TRUE                                        28760099
287700                 WHEN DL003-ASGMT-FOUND                           28770099
287800                 WHEN DL003-ASGMT-NOT-FOUND                       28780099
287900                      SET PS-CALLED-MODULE-OK TO TRUE             28790099
288000                 WHEN DL003-ASGMT-MULT-FOUND                      28800099
288100                      SET PS-CALLED-MODULE-NOT-OK TO TRUE         28810099
288200                      MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER   28820099
288300                      MOVE DL003-ASGMT-FOUND-QTY TO               28830099
288400                           PV-DISPLAY-NUMBER                      28840099
288500                      INITIALIZE PV-CICS-MSG-AREA2                28850099
288600                      STRING ' SUKRF512-3385- '                   28860099
288700                              PV-DISPLAY-OPER   '-'               28870099
288800                             ' AUDIT NUMBER IS - '                28880099
288900                             SU006-AUDIT-CNTL-NBR                 28890099
289000                              ' MULTIPLE ASSIGNMENTS FOR - '      28900099
289100                              SU006-USERID                        28910099
289200                              ' FOUND - '                         28920099
289300                              PV-DISPLAY-NUMBER                   28930099
289400                              ' ASSIGNMENTS'                      28940099
289500                                                DELIMITED BY SIZE 28950099
289600                                           INTO PV-CICS-MSG-AREA2 28960099
289700                      PERFORM 999A-WRITE-CSSL-MSG                 28970099
289800             END-EVALUATE                                         28980099
289900                                                                  28990099
290000         WHEN DL003-SQL-CONTENTION                                29000099
290100              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 29010099
290200              MOVE DL003-ASGMT-SQLCODE TO                         29020099
290300                   PV-DISPLAY-SQLCODE                             29030099
290400              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           29040099
290500              INITIALIZE PV-CICS-MSG-AREA2                        29050099
290600              STRING ' SUKRF512-3385- '                           29060099
290700                      PV-DISPLAY-OPER   '-'                       29070099
290800                     ' AUDIT NUMBER IS - '                        29080099
290900                     SU006-AUDIT-CNTL-NBR                         29090099
291000                      ' DLKUT001 SQL CONTENTION FOR USER ID-'     29100099
291100                      SU006-USERID                                29110099
291200                      ' SQLCODE=' PV-DISPLAY-SQLCODE              29120099
291300                                        DELIMITED BY SIZE         29130099
291400                                   INTO PV-CICS-MSG-AREA2         29140099
291500              PERFORM 999A-WRITE-CSSL-MSG                         29150099
291600                                                                  29160099
291700               INITIALIZE PV-CICS-MSG-AREA2                       29170099
291800               STRING ' SUKRF512-' DL003-USER-PGM                 29180099
291900                      ' -- ' DL003-SQL-ERROR-PARA                 29190099
292000                      ' -- ' DL003-CALL-MOD-FAIL-NM               29200099
292100                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          29210099
292200                                                DELIMITED BY SIZE 29220099
292300                                           INTO PV-CICS-MSG-AREA2 29230099
292400              PERFORM 999A-WRITE-CSSL-MSG                         29240099
292500                                                                  29250099
292600         WHEN DL003-SQL-ERROR                                     29260099
292700              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 29270099
292800              MOVE DL003-ASGMT-SQLCODE TO                         29280099
292900                   PV-DISPLAY-SQLCODE                             29290099
293000              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           29300099
293100              INITIALIZE PV-CICS-MSG-AREA2                        29310099
293200              STRING ' SUKRF512-3385- '                           29320099
293300                      PV-DISPLAY-OPER   '-'                       29330099
293400                     ' AUDIT NUMBER IS - '                        29340099
293500                     SU006-AUDIT-CNTL-NBR                         29350099
293600                      ' DLKUT001 SQL ERROR FOR USER ID-'          29360099
293700                      SU006-USERID                                29370099
293800                      ' SQLCODE=' PV-DISPLAY-SQLCODE              29380099
293900                                        DELIMITED BY SIZE         29390099
294000                                   INTO PV-CICS-MSG-AREA2         29400099
294100              PERFORM 999A-WRITE-CSSL-MSG                         29410099
294200                                                                  29420099
294300               INITIALIZE PV-CICS-MSG-AREA2                       29430099
294400               STRING ' SUKRF512-' DL003-USER-PGM                 29440099
294500                      ' -- ' DL003-SQL-ERROR-PARA                 29450099
294600                      ' -- ' DL003-CALL-MOD-FAIL-NM               29460099
294700                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          29470099
294800                                                DELIMITED BY SIZE 29480099
294900                                           INTO PV-CICS-MSG-AREA2 29490099
295000              PERFORM 999A-WRITE-CSSL-MSG                         29500099
295100                                                                  29510099
295200         WHEN DL003-CALLED-MODULE-FAILURE                         29520099
295300              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 29530099
295400              MOVE DL003-ASGMT-SQLCODE TO                         29540099
295500                   PV-DISPLAY-SQLCODE                             29550099
295600              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           29560099
295700              INITIALIZE PV-CICS-MSG-AREA2                        29570099
295800              STRING ' SUKRF512-3385- '                           29580099
295900                      PV-DISPLAY-OPER   '-'                       29590099
296000                     ' AUDIT NUMBER IS - '                        29600099
296100                     SU006-AUDIT-CNTL-NBR                         29610099
296200                      ' DLKUT001 CALLED MODULE FAILURE FOR '      29620099
296300                      'USER ID - '                                29630099
296400                      SU006-USERID                                29640099
296500                      ' SQLCODE=' PV-DISPLAY-SQLCODE              29650099
296600                                        DELIMITED BY SIZE         29660099
296700                                   INTO PV-CICS-MSG-AREA2         29670099
296800              PERFORM 999A-WRITE-CSSL-MSG                         29680099
296900                                                                  29690099
297000               INITIALIZE PV-CICS-MSG-AREA2                       29700099
297100               STRING ' SUKRF512-' DL003-USER-PGM                 29710099
297200                      ' -- ' DL003-SQL-ERROR-PARA                 29720099
297300                      ' -- ' DL003-CALL-MOD-FAIL-NM               29730099
297400                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          29740099
297500                                                DELIMITED BY SIZE 29750099
297600                                           INTO PV-CICS-MSG-AREA2 29760099
297700              PERFORM 999A-WRITE-CSSL-MSG                         29770099
297800                                                                  29780099
297900         WHEN DL003-INVALID-ACCESS                                29790099
298000              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 29800099
298100              MOVE DL003-ASGMT-SQLCODE TO                         29810099
298200                   PV-DISPLAY-SQLCODE                             29820099
298300              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           29830099
298400              INITIALIZE PV-CICS-MSG-AREA2                        29840099
298500              STRING ' SUKRF512-3385- '                           29850099
298600                      PV-DISPLAY-OPER   '-'                       29860099
298700                     ' AUDIT NUMBER IS - '                        29870099
298800                     SU006-AUDIT-CNTL-NBR                         29880099
298900                      ' DLKUT001 INVALID ACCESS FAILURE FOR '     29890099
299000                      'USER ID - '                                29900099
299100                      SU006-USERID                                29910099
299200                      ' SQLCODE=' PV-DISPLAY-SQLCODE              29920099
299300                                        DELIMITED BY SIZE         29930099
299400                                   INTO PV-CICS-MSG-AREA2         29940099
299500              PERFORM 999A-WRITE-CSSL-MSG                         29950099
299600                                                                  29960099
299700               INITIALIZE PV-CICS-MSG-AREA2                       29970099
299800               STRING ' SUKRF512-' DL003-USER-PGM                 29980099
299900                      ' -- ' DL003-SQL-ERROR-PARA                 29990099
300000                      ' -- ' DL003-CALL-MOD-FAIL-NM               30000099
300100                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          30010099
300200                                                DELIMITED BY SIZE 30020099
300300                                           INTO PV-CICS-MSG-AREA2 30030099
300400              PERFORM 999A-WRITE-CSSL-MSG                         30040099
300500                                                                  30050099
300600         WHEN OTHER                                               30060099
300700              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 30070099
300800              MOVE DL003-ASGMT-SQLCODE TO                         30080099
300900                   PV-DISPLAY-SQLCODE                             30090099
301000              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           30100099
301100              INITIALIZE PV-CICS-MSG-AREA2                        30110099
301200              STRING ' SUKRF512-3385- '                           30120099
301300                      PV-DISPLAY-OPER   '-'                       30130099
301400                     ' AUDIT NUMBER IS - '                        30140099
301500                     SU006-AUDIT-CNTL-NBR                         30150099
301600                      ' DLKUT001 OTHER TYPE FAILURE FOR '         30160099
301700                      'USER ID - '                                30170099
301800                      SU006-USERID                                30180099
301900                      ' SQLCODE=' PV-DISPLAY-SQLCODE              30190099
302000                                        DELIMITED BY SIZE         30200099
302100                                   INTO PV-CICS-MSG-AREA2         30210099
302200              PERFORM 999A-WRITE-CSSL-MSG                         30220099
302300                                                                  30230099
302400               INITIALIZE PV-CICS-MSG-AREA2                       30240099
302500               STRING ' SUKRF512-' DL003-USER-PGM                 30250099
302600                      ' -- ' DL003-SQL-ERROR-PARA                 30260099
302700                      ' -- ' DL003-CALL-MOD-FAIL-NM               30270099
302800                      ' -- ' DL003-CALL-MOD-FAIL-ERR-CDE          30280099
302900                                                DELIMITED BY SIZE 30290099
303000                                           INTO PV-CICS-MSG-AREA2 30300099
303100              PERFORM 999A-WRITE-CSSL-MSG                         30310099
303200                                                                  30320099
303300     END-EVALUATE.                                                30330099
303400                                                                  30340099
303500******************************************************************30350099
303600 3390-CALL-DLKCS410.                                              30360099
303700                                                                  30370099
303800     INITIALIZE  DL016-PGM-COMMAREA.                              30380099
303900     SET DL016-ESTABLISH-ASGMT TO TRUE.                           30390099
304000     SET DL016-SUCCESSFUL TO TRUE.                                30400099
304100     SET DL016-COMMIT-UPDATE TO TRUE.                             30410099
304200     MOVE PC-CURRENT-PROGRAM-NAME TO                              30420099
304300          DL016-CALLING-PGM-NM.                                   30430099
304400     MOVE SPACES TO DL011-FLAT-FQA-WRK-AREA.                      30440099
304500     MOVE 'FQA'  TO DL011-FQ-WRK-AREA-1-3.                        30450099
304600     MOVE SU006-USERID TO DL016-SIGN-ON-USR-ID                    30460099
304700                          DL016-EAI-CRE-BY-USR-ID                 30470099
304800                          DL011-FQ-WRK-AREA-USER-ID.              30480099
304900     SET DL016-EAI-USR-IS-UNKNOWN TO TRUE.                        30490099
305000     MOVE SU006-OPER-UNT-ID TO DL016-EAI-DC-NBR.                  30500099
305100     IF  SU006-RECV-PRCS-AREA                                     30510099
305200         SET DL011-AN-RECV-WRK-TYP TO TRUE                        30520099
305300         MOVE DL011-KEY-ASGMT-NBR-WRK-TYP TO                      30530099
305400              DL016-ASGMT-NBR-WRK-TYP                             30540099
305500         SET DL011-RECV-WRK-TYP TO TRUE                           30550099
305600         MOVE DL011-KEY-WK-TYP TO DL016-EAI-WK-TYP-DESC           30560099
305700     ELSE                                                         30570099
305800         SET DL011-AN-FLAT-WRK-TYP TO TRUE                        30580099
305900         MOVE DL011-KEY-ASGMT-NBR-WRK-TYP TO                      30590099
306000              DL016-ASGMT-NBR-WRK-TYP                             30600099
306100         SET DL011-FLAT-WRK-TYP TO TRUE                           30610099
306200         MOVE DL011-KEY-WK-TYP TO DL016-EAI-WK-TYP-DESC           30620099
306300     END-IF.                                                      30630099
306400     MOVE DL011-FLAT-FQA-WRK-AREA TO                              30640099
306500          DL016-EAI-WK-AREA-DESC.                                 30650099
306600                                                                  30660099
307100     MOVE LENGTH OF DL016-PGM-COMMAREA                            30710099
307200                                      TO PV-COMMAREA-LENGTH.      30720099
307300                                                                  30730099
307400     EXEC CICS LINK                                               30740099
307500         PROGRAM  (DL016-USER-PGM)                                30750099
307600         COMMAREA (DL016-PGM-COMMAREA)                            30760099
307700         LENGTH   (PV-COMMAREA-LENGTH)                            30770099
307800         RESP     (PV-CICS-RESPONSE)                              30780099
307900     END-EXEC.                                                    30790099
308000                                                                  30800099
308100     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      30810099
308200                                                                  30820099
308300     EVALUATE TRUE                                                30830099
308400         WHEN DL016-SUCCESSFUL                                    30840099
308500              SET PS-CALLED-MODULE-OK TO TRUE                     30850099
308600                                                                  30860099
308700         WHEN DL016-SQL-ERROR                                     30870099
308800              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 30880099
308900              MOVE DL016-ASGMT-SQLCODE TO                         30890099
309000                   PV-DISPLAY-SQLCODE                             30900099
309100              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           30910099
309200              INITIALIZE PV-CICS-MSG-AREA2                        30920099
309300              STRING ' SUKRF512-3390- '                           30930099
309400                      PV-DISPLAY-OPER   '-'                       30940099
309500                     ' AUDIT NUMBER IS - '                        30950099
309600                     SU006-AUDIT-CNTL-NBR                         30960099
309700                      ' DLKCS410 SQL ERROR FOR USER ID-'          30970099
309800                      SU006-USERID                                30980099
309900                      ' SQLCODE=' PV-DISPLAY-SQLCODE              30990099
310000                                        DELIMITED BY SIZE         31000099
310100                                   INTO PV-CICS-MSG-AREA2         31010099
310200              PERFORM 999A-WRITE-CSSL-MSG                         31020099
310300                                                                  31030099
310400               INITIALIZE PV-CICS-MSG-AREA2                       31040099
310500               STRING ' SUKRF512-' DL016-USER-PGM                 31050099
310600                      ' -- ' DL016-CALL-MOD-FAIL-SQL-PARA         31060099
310700                      ' -- ' DL016-CALL-MOD-FAIL-NM               31070099
310800                      ' -- ' DL016-CALL-MOD-FAIL-ERR-CDE          31080099
310900                                                DELIMITED BY SIZE 31090099
311000                                           INTO PV-CICS-MSG-AREA2 31100099
311100              PERFORM 999A-WRITE-CSSL-MSG                         31110099
311200                                                                  31120099
311300         WHEN DL016-CALLED-MODULE-FAILURE                         31130099
311400              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 31140099
311500              MOVE DL016-CALL-MOD-FAIL-SQL-CDE TO                 31150099
311600                   PV-DISPLAY-SQLCODE                             31160099
311700              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           31170099
311800              INITIALIZE PV-CICS-MSG-AREA2                        31180099
311900              STRING ' SUKRF512-3390- '                           31190099
312000                      PV-DISPLAY-OPER   '-'                       31200099
312100                     ' AUDIT NUMBER IS - '                        31210099
312200                     SU006-AUDIT-CNTL-NBR                         31220099
312300                      ' DLKCS410 CALLED MODULE FAILURE FOR '      31230099
312400                      'USER ID - '                                31240099
312500                      SU006-USERID                                31250099
312600                                        DELIMITED BY SIZE         31260099
312700                                   INTO PV-CICS-MSG-AREA2         31270099
312800              PERFORM 999A-WRITE-CSSL-MSG                         31280099
312900                                                                  31290099
313000               INITIALIZE PV-CICS-MSG-AREA2                       31300099
313100               STRING ' SUKRF512-' DL016-USER-PGM                 31310099
313200                      ' -- ' DL016-CALL-MOD-FAIL-SQL-PARA         31320099
313300                      ' -- ' DL016-CALL-MOD-FAIL-NM               31330099
313400                      ' -- ' DL016-CALL-MOD-FAIL-ERR-CDE          31340099
313500                      ' -- ' PV-DISPLAY-SQLCODE                   31350099
313600                                                DELIMITED BY SIZE 31360099
313700                                           INTO PV-CICS-MSG-AREA2 31370099
313800              PERFORM 999A-WRITE-CSSL-MSG                         31380099
313900                                                                  31390099
314000         WHEN DL016-INVALID-ACCESS                                31400099
314100              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 31410099
314200              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           31420099
314300              INITIALIZE PV-CICS-MSG-AREA2                        31430099
314400              STRING ' SUKRF512-3390- '                           31440099
314500                      PV-DISPLAY-OPER   '-'                       31450099
314600                     ' AUDIT NUMBER IS - '                        31460099
314700                     SU006-AUDIT-CNTL-NBR                         31470099
314800                      ' DLKCS410 INVALID ACCESS FAILURE FOR '     31480099
314900                      'USER ID - '                                31490099
315000                      SU006-USERID                                31500099
315100                                        DELIMITED BY SIZE         31510099
315200                                   INTO PV-CICS-MSG-AREA2         31520099
315300              PERFORM 999A-WRITE-CSSL-MSG                         31530099
315400                                                                  31540099
315500               INITIALIZE PV-CICS-MSG-AREA2                       31550099
315600               STRING ' SUKRF512-' DL016-USER-PGM                 31560099
315700                      ' -- ' DL016-CALL-MOD-FAIL-SQL-PARA         31570099
315800                      ' -- ' DL016-CALL-MOD-FAIL-NM               31580099
315900                      ' -- ' DL016-CALL-MOD-FAIL-ERR-CDE          31590099
316000                                                DELIMITED BY SIZE 31600099
316100                                           INTO PV-CICS-MSG-AREA2 31610099
316200              PERFORM 999A-WRITE-CSSL-MSG                         31620099
316300                                                                  31630099
316400         WHEN OTHER                                               31640099
316500              SET PS-CALLED-MODULE-NOT-OK TO TRUE                 31650099
316600              MOVE SU006-OPER-UNT-ID TO PV-DISPLAY-OPER           31660099
316700              INITIALIZE PV-CICS-MSG-AREA2                        31670099
316800              STRING ' SUKRF512-3390- '                           31680099
316900                      PV-DISPLAY-OPER   '-'                       31690099
317000                     ' AUDIT NUMBER IS - '                        31700099
317100                     SU006-AUDIT-CNTL-NBR                         31710099
317200                      ' DLKCS410 OTHER TYPE FAILURE FOR '         31720099
317300                      'USER ID - '                                31730099
317400                      SU006-USERID                                31740099
317500                      ' RETURN CODE - ' DL016-RETURN-CODE         31750099
317600                                        DELIMITED BY SIZE         31760099
317700                                   INTO PV-CICS-MSG-AREA2         31770099
317800              PERFORM 999A-WRITE-CSSL-MSG                         31780099
317900                                                                  31790099
318000               INITIALIZE PV-CICS-MSG-AREA2                       31800099
318100               STRING ' SUKRF512-' DL016-USER-PGM                 31810099
318200                      ' DL016 EAI FIELDS '                        31820099
318300                      ' -- ' DL016-EAI-WK-TYP-DESC                31830099
318400                      ' -- ' DL016-EAI-WK-AREA-DESC               31840099
318500                      ' -- ' PV-DISPLAY-OPER                      31850099
318600                      ' -- ' DL016-EAI-CRE-BY-USR-ID              31860099
318700                      ' -- ' DL016-EAI-USR-TYP-CDE                31870099
318800                                                DELIMITED BY SIZE 31880099
318900                                           INTO PV-CICS-MSG-AREA2 31890099
319000              PERFORM 999A-WRITE-CSSL-MSG                         31900099
319100     END-EVALUATE                                                 31910099
319200                                                                  31920099
319300     ELSE                                                         31930099
319400         MOVE '3390-CALL-DLKCS410'                                31940099
319500                              TO DP013-PARAGRAPH                  31950099
319600         MOVE PV-CICS-RESPONSE                                    31960099
319700                              TO DP013-MESSAGE-TEXT(1)            31970099
319800         SET DP013-LINK-RETURN                                    31980099
319900             DP013-CICS-ABEND                                     31990099
320000             DP013-ROLLBACK TO TRUE                               32000099
320100         PERFORM DP014-0000-PROCESS-ABEND                         32010099
320200         MOVE PV-SAVE-SHIP-UNIT-STATUS                            32020099
320300                              TO SU006-SHIP-UNIT-STATUS           32030099
320400         MOVE PC-POSTPONE-TRY-AGAIN-MSG TO  AMSGLNO               32040099
320500         PERFORM 8100-SEND-DATA-ONLY                              32050099
320600         PERFORM 8200-RETURN-TRANID                               32060099
320700     END-IF.                                                      32070099
320800                                                                  32080099
320900******************************************************************32090099
321000*  3400-RESTART-SHIP-UNIT                                        *32100099
321100*  THE USER WANTS TO RE-START THE AUDIT OF A SHIPPING UNIT:      *32110099
321200*           1) DELETE THE AUDIT CONTENT OF THE SHIPPING UNIT     *32120099
321300*           2) GET THE NUMBER OF MINUTES SINCE IT WAS OPENED     *32130099
321400*              (THIS WILL BE ADDED TO THE RESTART MINUTE QTY)    *32140099
321500*           3) CHECK IF THERE ARE ANY CARTON LEVEL EXCEPTIONS... *32150099
321600*           4) UPDATE THE RESTART MINUTES WITH THE MINUTES CALC. *32160099
321700*              IN STEP #2, THE STAUS CODE TO "IP" AND THE ERROR  *32170099
321800*              CODE TO 'Y' IF CARTON LEVEL ERRORS EXISTS, OR 'N' *32180099
321900*              IF NO CARTON LEVEL ERRORS EXIST.                  *32190099
322000******************************************************************32200099
322100 3400-RESTART-SHIP-UNIT.                                          32210099
322200                                                                  32220099
322300*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 32230099
322400*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS32240099
322500*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       32250099
322600*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  32260099
322700*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 32270099
322800*    SECOND IN THIS SCENARIO.                                     32280099
322900     IF PS-PRCS-FIRST-AUDIT                                       32290099
323000     OR SU006-RFID-AUD-ONLY                                       32300099
323100     OR SU006-MANUAL-GENERATED-AUDIT                              32310099
323200         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         32320099
323300     ELSE                                                         32330099
323400         MOVE SU006-RFID-AUDIT-CNTL-NBR                           32340099
323500                                     TO DK-AUDIT-CNTL-NBR         32350099
323600     END-IF.                                                      32360099
323700**   MOVE SU006-AUDIT-CNTL-NBR       TO DK-AUDIT-CNTL-NBR.        32370099
323800     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         32380099
323900                                                                  32390099
324000*    DELETE OLD SHIP UNIT AUDIT DETAIL                            32400099
324100     PERFORM 3410-DELETE-SHIP-UNIT-DETAIL.                        32410099
324200                                                                  32420099
324300*    GET THE NUMBER OF MINUTES SINCE THE CARTON WAS OPENED...     32430099
324400     PERFORM 3001-GET-OPENED-MINUTES.                             32440099
324500                                                                  32450099
324600*    CHECK IF THERE ARE ANY CARTON LEVEL EXCEPTIONS...            32460099
324700     PERFORM 3430-CHECK-CARTON-EXCEPTIONS.                        32470099
324800                                                                  32480099
324900*    UPDATE HOST VARIABLES WITH RESTART INFORMATION...            32490099
325000*    THE TOTAL MINUTES THE CARTON HAS BEEN OPEN (THE MINUTES      32500099
325100*    FROM THE START TIMESTAMP TO THE CURRENT TIMESTAMP LESS       32510099
325200*    ANY MINUTES THE CARTON WAS CLOSED OR POSTPONED) WILL BE      32520099
325300*    ADDED TO ANY CURRENT RESTART MINUTES (IF IT HAD BEEN         32530099
325400*    PREVIOUSLY RESTARTED).  THE START TIMESTAMP WILL BE UPDATED  32540099
325500*    TO THE CURRENT TIMESTAMP, THE STOP TIMESTAMP WILL BE UPDATED 32550099
325600*    TO "NINES", THE POSTPONED AND CLOSED MINUTE BUCKETS WILL BE  32560099
325700*    INITIALIZED (ANY TIME IN THERE IS TAKEN INTO ACCOUNT IN THE  32570099
325800*    CALCULATION OF THE RESTART MINUTES), THE STATUS IS UPDATED   32580099
325900*    TO INPROCESS, AND THE AUDIT ERROR INDICATOR IS SET TO 'Y'    32590099
326000*    ONLY IF CARTON LEVEL EXCEPTIONS EXIST.                       32600099
326100     ADD  PV-TOTAL-OPENED-MINUTES  TO SUATRN-UNT-RSTRT-MNIT-QTY.  32610099
326200     MOVE '9999-09-09-09.09.09.999999'                            32620099
326300                                  TO SUATRN-UNT-AUD-STP-TMST.     32630099
326400     MOVE PV-CURRENT-TIMESTAMP    TO SUATRN-UNT-AUD-STRT-TMST.    32640099
326500     INITIALIZE  SUATRN-UNT-PSPND-MNIT-QTY                        32650099
326600                 SUATRN-UNT-CLO-MNIT-QTY.                         32660099
326700     MOVE SU006-SHIP-UNIT-STATUS TO PV-SAVE-SHIP-UNIT-STATUS.     32670099
326800     SET SU006-SHIP-UNIT-INPROCESS TO TRUE.                       32680099
326900     MOVE SU006-SHIP-UNIT-STATUS  TO SUATRN-UNT-AUD-STAT-CDE.     32690099
327000                                                                  32700099
327100*    IF CARTON LEVEL EXCEPTIONS STILL EXIST, THE ERROR CODE       32710099
327200*    MUST STAY A 'Y'.                                             32720099
327300     IF PS-CTN-EXCEPT-EXIST                                       32730099
327400         MOVE 'Y'                 TO SUATRN-UNT-AUD-ERR-IND       32740099
327500     ELSE                                                         32750099
327600         MOVE 'N'                 TO SUATRN-UNT-AUD-ERR-IND       32760099
327700     END-IF.                                                      32770099
327800                                                                  32780099
327900     PERFORM 3415-DELETE-TCTEXCP                                  32790099
328000                                                                  32800099
328100*    UPDATE INFORMATION                                           32810099
328200     PERFORM 3420-UPDATE-RESTART-INFO.                            32820099
328300     SET SU006-NO-AUD-ERR  TO TRUE.                               32830099
328400                                                                  32840099
328500******************************************************************32850099
328600*  3410-DELETE-SHIP-UNIT-DETAIL.                                 *32860099
328700*  DELETE ALL THE CARTON DETAIL (UPC'S)                          *32870099
328800******************************************************************32880099
328900 3410-DELETE-SHIP-UNIT-DETAIL.                                    32890099
329000                                                                  32900099
329100     EXEC SQL                                                     32910099
329200         DELETE FROM TSUAUPC                                      32920099
329300         WHERE                                                    32930099
329400                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             32940099
329500           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              32950099
329600     END-EXEC.                                                    32960099
329700                                                                  32970099
329800     EVALUATE TRUE                                                32980099
329900         WHEN SQLCODE = ZERO                                      32990099
330000         WHEN SQLCODE = +100                                      33000099
330100             CONTINUE                                             33010099
330200                                                                  33020099
330300         WHEN SQLWARN0 NOT = SPACES                               33030099
330400         WHEN SQLCODE < ZERO                                      33040099
330500         WHEN SQLCODE > ZERO                                      33050099
330600             MOVE '3410-DELETE-SHIP-UNIT-DETAIL'                  33060099
330700                 TO DP013-PARAGRAPH                               33070099
330800             MOVE 'DELETE OF TSUAUPC TABLE'                       33080099
330900                 TO DP013-MESSAGE-TEXT (1)                        33090099
331000             MOVE SU006-AUDIT-CNTL-NBR-X                          33100099
331100                 TO DP013-MESSAGE-TEXT (2)                        33110099
331200             MOVE SU006-SHIP-UNIT-NBR-X                           33120099
331300                 TO DP013-MESSAGE-TEXT (3)                        33130099
331400             MOVE SQLCA            TO DP013-SQLCA                 33140099
331500             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    33150099
331600             SET DP013-DB2-ABEND   TO TRUE                        33160099
331700                                                                  33170099
331800             PERFORM 9999-WRITE-CICS-LOG-MSG                      33180099
331900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               33190099
332000             PERFORM 8100-SEND-DATA-ONLY                          33200099
332100             PERFORM 8200-RETURN-TRANID                           33210099
332200     END-EVALUATE.                                                33220099
332300                                                                  33230099
332400******************************************************************33240099
332500*  3415-DELETE-TCTEXCP.                                           33250099
332600*  DELETE THE CARTON LEVEL EXCEPTIONS FOR PACK ERRORS ONLY       *33260099
332700*  VILN_GP_SEQ_NBR: 36  BAD PACK                                  33270099
332800*                   37  DEFINED AS I TYPE PREPK BUT IS NOT        33280099
332900******************************************************************33290099
333000 3415-DELETE-TCTEXCP.                                             33300099
333100                                                                  33310099
333200     EXEC SQL                                                     33320099
333300         DELETE FROM TCTEXCP                                      33330099
333400         WHERE                                                    33340099
333500                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             33350099
333600           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              33360099
333700           AND  VILN_GP_CDE      = 'VA'                           33370099
333800           AND  VILN_GP_SEQ_NBR  IN (36,37)                       33380099
333900     END-EXEC.                                                    33390099
334000                                                                  33400099
334100     EVALUATE TRUE                                                33410099
334200         WHEN SQLCODE = ZERO                                      33420099
334300         WHEN SQLCODE = +100                                      33430099
334400             CONTINUE                                             33440099
334500                                                                  33450099
334600         WHEN SQLWARN0 NOT = SPACES                               33460099
334700         WHEN SQLCODE < ZERO                                      33470099
334800         WHEN SQLCODE > ZERO                                      33480099
334900             MOVE '3415-DELETE-TCTEXCP '                          33490099
335000                 TO DP013-PARAGRAPH                               33500099
335100             MOVE 'DELETE OF TCTEXCP TABLE'                       33510099
335200                 TO DP013-MESSAGE-TEXT (1)                        33520099
335300             MOVE SU006-AUDIT-CNTL-NBR-X                          33530099
335400                 TO DP013-MESSAGE-TEXT (2)                        33540099
335500             MOVE SU006-SHIP-UNIT-NBR-X                           33550099
335600                 TO DP013-MESSAGE-TEXT (3)                        33560099
335700             MOVE SQLCA            TO DP013-SQLCA                 33570099
335800             MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)    33580099
335900             SET DP013-DB2-ABEND   TO TRUE                        33590099
336000                                                                  33600099
336100             PERFORM 9999-WRITE-CICS-LOG-MSG                      33610099
336200             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               33620099
336300             PERFORM 8100-SEND-DATA-ONLY                          33630099
336400             PERFORM 8200-RETURN-TRANID                           33640099
336500     END-EVALUATE.                                                33650099
336600                                                                  33660099
336700******************************************************************33670099
336800*  3420-UPDATE-RESTART-INFO.                                     *33680099
336900*  UPDATE THE SHIPPING UNIT TABLE WITH THE RESTART INFORMATION   *33690099
337000******************************************************************33700099
337100 3420-UPDATE-RESTART-INFO.                                        33710099
337200                                                                  33720099
337300     EXEC SQL                                                     33730099
337400         UPDATE TSUATRN                                           33740099
337500            SET  UNT_AUD_STRT_TMST   = :SUATRN-UNT-AUD-STRT-TMST  33750099
337600               , UNT_AUD_STP_TMST    = :SUATRN-UNT-AUD-STP-TMST   33760099
337700               , UNT_AUD_STAT_CDE    = :SUATRN-UNT-AUD-STAT-CDE   33770099
337800               , UNT_AUD_ERR_IND     = :SUATRN-UNT-AUD-ERR-IND    33780099
337900               , UNT_PSPND_MNIT_QTY  = :SUATRN-UNT-PSPND-MNIT-QTY 33790099
338000               , UNT_CLO_MNIT_QTY    = :SUATRN-UNT-CLO-MNIT-QTY   33800099
338100               , UNT_RSTRT_MNIT_QTY  = :SUATRN-UNT-RSTRT-MNIT-QTY 33810099
338200               , UNT_AUD_USR_ID      = :SU006-USERID              33820099
338300         WHERE                                                    33830099
338400                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             33840099
338500           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              33850099
338600     END-EXEC.                                                    33860099
338700                                                                  33870099
338800     EVALUATE TRUE                                                33880099
338900         WHEN SQLCODE = ZERO                                      33890099
339000             CONTINUE                                             33900099
339100                                                                  33910099
339200         WHEN SQLWARN0 NOT = SPACES                               33920099
339300         WHEN SQLCODE < ZERO                                      33930099
339400         WHEN SQLCODE > ZERO                                      33940099
339500             MOVE '3420-UPDATE-RESTART-INFO'                      33950099
339600                 TO DP013-PARAGRAPH                               33960099
339700             MOVE 'UPDATE OF TSUATRN TABLE'                       33970099
339800                 TO DP013-MESSAGE-TEXT (1)                        33980099
339900             MOVE SU006-AUDIT-CNTL-NBR-X                          33990099
340000                 TO DP013-MESSAGE-TEXT (2)                        34000099
340100             MOVE SU006-SHIP-UNIT-NBR-X                           34010099
340200                 TO DP013-MESSAGE-TEXT (3)                        34020099
340300             MOVE SQLCA            TO DP013-SQLCA                 34030099
340400             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    34040099
340500             SET DP013-DB2-ABEND   TO TRUE                        34050099
340600                                                                  34060099
340700             MOVE PV-SAVE-SHIP-UNIT-STATUS                        34070099
340800                                   TO SU006-SHIP-UNIT-STATUS      34080099
340900             PERFORM 9999-WRITE-CICS-LOG-MSG                      34090099
341000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               34100099
341100             PERFORM 8100-SEND-DATA-ONLY                          34110099
341200             PERFORM 8200-RETURN-TRANID                           34120099
341300     END-EVALUATE.                                                34130099
341400                                                                  34140099
341500******************************************************************34150099
341600*  3430-CHECK-CARTON-EXCEPTIONS.                                 *34160099
341700*  CHECK IF ANY CARTON LEVEL EXCEPTIONS EXIST                    *34170099
341800******************************************************************34180099
341900 3430-CHECK-CARTON-EXCEPTIONS.                                    34190099
342000                                                                  34200099
342100     EXEC SQL                                                     34210099
342200         SELECT OVRRID_SYS_DAT_TXT                                34220099
342300           INTO :CTEXCP-OVRRID-SYS-DAT-TXT                        34230099
342400           FROM TCTEXCP                                           34240099
342500          WHERE AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             34250099
342600            AND SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              34260099
342700            AND  VILN_GP_SEQ_NBR NOT IN (36,37)                   34270099
342800     END-EXEC.                                                    34280099
342900                                                                  34290099
343000     EVALUATE TRUE                                                34300099
343100         WHEN SQLCODE = ZERO                                      34310099
343200         WHEN SQLCODE = -811                                      34320099
343300             SET PS-CTN-EXCEPT-EXIST          TO TRUE             34330099
343400                                                                  34340099
343500         WHEN SQLCODE = +100                                      34350099
343600             SET PS-CTN-EXCEPT-DONT-EXIST     TO TRUE             34360099
343700                                                                  34370099
343800         WHEN SQLWARN0 NOT = SPACES                               34380099
343900         WHEN SQLCODE < ZERO                                      34390099
344000         WHEN SQLCODE > ZERO                                      34400099
344100             MOVE '3430-CHECK-CARTON-EXCEPTIONS'                  34410099
344200                 TO DP013-PARAGRAPH                               34420099
344300             MOVE 'SELECT OF TCTEXCP TABLE'                       34430099
344400                 TO DP013-MESSAGE-TEXT (1)                        34440099
344500             MOVE SU006-AUDIT-CNTL-NBR-X                          34450099
344600                 TO DP013-MESSAGE-TEXT (2)                        34460099
344700             MOVE SU006-SHIP-UNIT-NBR-X                           34470099
344800                 TO DP013-MESSAGE-TEXT (3)                        34480099
344900             MOVE SQLCA            TO DP013-SQLCA                 34490099
345000             MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)    34500099
345100             SET DP013-DB2-ABEND   TO TRUE                        34510099
345200                                                                  34520099
345300             PERFORM 9999-WRITE-CICS-LOG-MSG                      34530099
345400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               34540099
345500             PERFORM 8100-SEND-DATA-ONLY                          34550099
345600             PERFORM 8200-RETURN-TRANID                           34560099
345700     END-EVALUATE.                                                34570099
345800                                                                  34580099
345900******************************************************************34590099
346000 3500-SELECT-AUDIT.                                               34600099
346100                                                                  34610099
346200*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 34620099
346300*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS34630099
346400*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       34640099
346500*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  34650099
346600*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 34660099
346700*    SECOND IN THIS SCENARIO.                                     34670099
346800     IF PS-PRCS-FIRST-AUDIT                                       34680099
346900     OR SU006-RFID-AUD-ONLY                                       34690099
347000     OR SU006-MANUAL-GENERATED-AUDIT                              34700099
347100         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         34710099
347200     ELSE                                                         34720099
347300         MOVE SU006-RFID-AUDIT-CNTL-NBR                           34730099
347400                                     TO DK-AUDIT-CNTL-NBR         34740099
347500     END-IF.                                                      34750099
347600                                                                  34760099
347700                                                                  34770099
347800     EXEC SQL                                                     34780099
347900         SELECT AUD_CNTL_NBR                                      34790099
348000             ,  INBND_TRIP_ID                                     34800099
348100             ,  CART_QTY                                          34810099
348200             ,  UNT_QTY                                           34820099
348300             ,  AUD_CART_QTY                                      34830099
348400             ,  AUD_UNT_QTY                                       34840099
348500             ,  AUD_STAT_CDE                                      34850099
348600           INTO :SUT00015-AUD-CNTL-NBR                            34860099
348700             ,  :SUT00015-INBND-TRIP-ID                           34870099
348800             ,  :SUT00015-CART-QTY                                34880099
348900             ,  :SUT00015-UNT-QTY                                 34890099
349000             ,  :SUT00015-AUD-CART-QTY                            34900099
349100             ,  :SUT00015-AUD-UNT-QTY                             34910099
349200             ,  :SUT00015-AUD-STAT-CDE                            34920099
349300           FROM  SUT_PO_AUD_REQ                                   34930099
349400          WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR            34940099
349500     END-EXEC.                                                    34950099
349600                                                                  34960099
349700     EVALUATE TRUE                                                34970099
349800         WHEN SQLCODE = ZERO                                      34980099
349900             SET PS-SYSTEM-AUDIT-FOUND TO TRUE                    34990099
350000                                                                  35000099
350100         WHEN SQLCODE = +100                                      35010099
350200             SET PS-SYSTEM-AUDIT-NOT-FOUND TO TRUE                35020099
350300                                                                  35030099
350400         WHEN SQLWARN0 NOT = SPACES                               35040099
350500         WHEN SQLCODE < ZERO                                      35050099
350600         WHEN SQLCODE > ZERO                                      35060099
350700             MOVE '3500-SELECT-AUDIT'                             35070099
350800                 TO DP013-PARAGRAPH                               35080099
350900             MOVE 'SELECT OF SUT_PO_AUD_REQ'                      35090099
351000                 TO DP013-MESSAGE-TEXT (1)                        35100099
351100             MOVE SU006-AUDIT-CNTL-NBR-X                          35110099
351200                 TO DP013-MESSAGE-TEXT (2)                        35120099
351300             MOVE SQLCA            TO DP013-SQLCA                 35130099
351400             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    35140099
351500             SET DP013-DB2-ABEND   TO TRUE                        35150099
351600***          SET DP013-NO-ROLLBACK TO TRUE                        35160099
351700             PERFORM 9999-WRITE-CICS-LOG-MSG                      35170099
351800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               35180099
351900             PERFORM 8100-SEND-DATA-ONLY                          35190099
352000             PERFORM 8200-RETURN-TRANID                           35200099
352100     END-EVALUATE.                                                35210099
352200                                                                  35220099
352300******************************************************************35230099
352400*  3600-SUBMIT-CART-DETAIL.                                      *35240099
352500*  THIS PARAGRAPH WILL SUBMIT THE JCL TO PRODUCE THE CARTON      *35250099
352600*  DETAIL REPORT.                                                *35260099
352700******************************************************************35270099
352800 3600-SUBMIT-CART-DETAIL.                                         35280099
352900                                                                  35290099
353000     EXEC CICS ASSIGN                                             35300099
353100               APPLID(CA-SYSTEM-ID)                               35310099
353200     END-EXEC.                                                    35320099
353300                                                                  35330099
353400*    SET-UP VARIABLES IN THE JOB CARD                             35340099
353500     IF CA-TEST-CICS                                              35350099
353600         MOVE SU006-USERID           TO JL-TEST-JOB-NAME          35360099
353700                                        JL-TEST-NOTIFY            35370099
353800         MOVE 'SUK9151T'             TO JL-PROC-NAME              35380099
353900         MOVE 'CARTON DETAIL'        TO JL-TEST-JOB-DESC          35390099
354000     ELSE                                                         35400099
354100                                                                  35410099
354200     IF CA-QA-CICS                                                35420099
354300         MOVE SU006-USERID           TO JL-TEST-JOB-NAME          35430099
354400                                        JL-TEST-NOTIFY            35440099
354500         MOVE 'SUK9151Q'             TO JL-PROC-NAME              35450099
354600         MOVE 'CARTON DETAIL'        TO JL-TEST-JOB-DESC          35460099
354700     ELSE                                                         35470099
354800     IF CA-LEARN-CICS                                             35480099
354900         MOVE SU006-USERID           TO JL-TEST-JOB-NAME          35490099
355000                                        JL-TEST-NOTIFY            35500099
355100         MOVE 'SUK9151L'             TO JL-PROC-NAME              35510099
355200         MOVE 'CARTON DETAIL'        TO JL-TEST-JOB-DESC          35520099
355300     ELSE                                                         35530099
355400         MOVE 'SUK915'               TO JL-JOB-NAME               35540099
355500         MOVE 'SUK9151 '             TO JL-PROC-NAME              35550099
355600         MOVE 'CARTON DETAIL'        TO JL-JOB-DESC               35560099
355700     END-IF                                                       35570099
355800     END-IF                                                       35580099
355900     END-IF.                                                      35590099
356000                                                                  35600099
356100*    SUBMIT JOB QUEUE REQUEST TO THE INTERNAL READER              35610099
356200     PERFORM 9000-SUBMIT-REQUEST-START.                           35620099
356300*                                                                 35630099
356400     MOVE 'S010'                     TO JL-SYSUT1-STEP.           35640099
356500*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 35650099
356600*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS35660099
356700*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       35670099
356800*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  35680099
356900*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 35690099
357000*    SECOND IN THIS SCENARIO.                                     35700099
357100     IF PS-PRCS-FIRST-AUDIT                                       35710099
357200     OR SU006-RFID-AUD-ONLY                                       35720099
357300     OR SU006-MANUAL-GENERATED-AUDIT                              35730099
357400         MOVE SU006-AUDIT-CNTL-NBR   TO JL-SYSUT1-AUD-CNTL-NBR    35740099
357500     ELSE                                                         35750099
357600         MOVE SU006-RFID-AUDIT-CNTL-NBR                           35760099
357700                                     TO JL-SYSUT1-AUD-CNTL-NBR    35770099
357800     END-IF.                                                      35780099
357900                                                                  35790099
358000     MOVE SU006-SHIP-UNIT-NBR                                     35800099
358010                                    TO PV-DISP-SHIPT-UNT-ID       35801099
358020     MOVE SU006-SHIP-UNIT-NBR        TO JL-SYSUT1-SHIP-UNT-NBR.   35802099
358030                                                                  35803099
358040     MOVE SU006-SYSTEM-MANUAL-AUDIT  TO JL-SYSTEM-MANUAL-AUDIT.   35804099
358050     MOVE SU006-RFID-QC-AUDIT-IND    TO JL-RFID-QC-AUDIT-IND.     35805099
358060     MOVE SU006-RFID-QC-AUD-CMB-IND  TO JL-RFID-QC-AUD-CMB-IND.   35806099
358070                                                                  35807099
358080     MOVE JL-SYSUT1-AUD-CNTL-LINE    TO JL-SYSUT1-PARM-VALUE.     35808099
358090     PERFORM 9050-SUBMIT-SYMBOLIC-LINE.                           35809099
358100*                                                                 35810099
358200     MOVE 'S090'                     TO JL-SYSUT1-STEP.           35820099
358300     MOVE SU006-PRINTER-DEST         TO JL-SYSUT1-PRINTER         35830099
358400     MOVE CA-PRTR-CNTL-IND           TO JL-SYSUT1-PRTR-IND        35840099
358500     MOVE CA-TRACK-NBR               TO JL-SYSUT1-TRACK-NBR       35850099
358600     MOVE JL-SYSUT1-PRT-LINE         TO JL-SYSUT1-PARM-VALUE.     35860099
358700     PERFORM 9050-SUBMIT-SYMBOLIC-LINE.                           35870099
358800*                                                                 35880099
358900     PERFORM 9099-SUBMIT-REQUEST-STOP.                            35890099
359000                                                                  35900099
359100******************************************************************35910099
359200 3700-GET-SCN-QTY.                                                35920099
359300                                                                  35930099
359400*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 35940099
359500*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS35950099
359600*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       35960099
359700*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  35970099
359800*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 35980099
359900*    SECOND IN THIS SCENARIO.                                     35990099
360000     IF PS-PRCS-FIRST-AUDIT                                       36000099
360100     OR SU006-RFID-AUD-ONLY                                       36010099
360200     OR SU006-MANUAL-GENERATED-AUDIT                              36020099
360300         MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR           36030099
360400     ELSE                                                         36040099
360500         MOVE SU006-RFID-AUDIT-CNTL-NBR                           36050099
360600                                   TO DK-AUDIT-CNTL-NBR           36060099
360700     END-IF.                                                      36070099
360800                                                                  36080099
360900     MOVE SU006-SHIP-UNIT-NBR      TO DK-SHIP-UNIT-NBR.           36090099
361000                                                                  36100099
362200     EXEC SQL                                                     36220099
362300          SELECT SUM(SCND_UNT_QTY)                                36230099
362400            INTO :PV-SCN-QTY                                      36240099
362500            FROM TSUAUPC                                          36250099
362600            WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR               36260099
362700              AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                36270099
362800              AND SCN_TYP_CDE <> 'E'                              36280099
362900     END-EXEC.                                                    36290099
363000                                                                  36300099
363100*IF THE ASSOCIATE GOES TO THE CARTON CLOSE WITHOUT SCANNING A UPC 36310099
363200*THE SQLCODE WILL BE -305                                         36320099
363300                                                                  36330099
363400     EVALUATE TRUE                                                36340099
363500        WHEN SQLCODE = ZERO                                       36350099
363600          CONTINUE                                                36360099
363700                                                                  36370099
363800        WHEN SQLCODE = +100                                       36380099
363900        WHEN SQLCODE = -305                                       36390099
364000           MOVE ZEROES           TO PV-SCN-QTY                    36400099
364100                                                                  36410099
364200        WHEN OTHER                                                36420099
364300             MOVE '3700-GET-SCN-QTY'     TO DP013-PARAGRAPH       36430099
364400             MOVE 'SELECT OF TSUAUPC'    TO DP013-MESSAGE-TEXT (1)36440099
364500             MOVE DK-AUDIT-CNTL-NBR      TO DP013-MESSAGE-TEXT (2)36450099
364600             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (3)36460099
364700             MOVE SQLCA                  TO DP013-SQLCA           36470099
364800             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)36480099
364900             SET DP013-DB2-ABEND         TO TRUE                  36490099
365000                                                                  36500099
365100             PERFORM 9999-WRITE-CICS-LOG-MSG                      36510099
365200                                                                  36520099
365300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               36530099
365400             MOVE -1                     TO ASELECTL              36540099
365500             PERFORM 8100-SEND-DATA-ONLY                          36550099
365600             PERFORM 8200-RETURN-TRANID                           36560099
365700     END-EVALUATE.                                                36570099
365800                                                                  36580099
365900******************************************************************36590099
366000* 3750-GET-TGD-QTY                                               *36600099
366100*    SELECT THE QUANTITY TAGGED IN THE CARTON                    *36610099
366200******************************************************************36620099
366300 3750-GET-TGD-QTY.                                                36630099
366400                                                                  36640099
366500     MOVE SU006-AUDIT-CNTL-NBR  TO DK-AUDIT-CNTL-NBR.             36650099
366600     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              36660099
366700                                                                  36670099
366800     EXEC SQL                                                     36680099
366900          SELECT SUM(RFID_TGD_QTY)                                36690099
367000            INTO :PV-SCN-QTY                                      36700099
367100            FROM TSUAUPC                                          36710099
367200            WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR               36720099
367300              AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                36730099
367400              AND SCN_TYP_CDE <> 'E'                              36740099
367500     END-EXEC.                                                    36750099
367600                                                                  36760099
367700*IF THE ASSOCIATE GOES TO THE CARTON CLOSE WITHOUT TAGGING A UPC  36770099
367800*THE SQLCODE WILL BE -305                                         36780099
367900                                                                  36790099
368000     EVALUATE TRUE                                                36800099
368100        WHEN SQLCODE = ZERO                                       36810099
368200          CONTINUE                                                36820099
368300                                                                  36830099
368400        WHEN SQLCODE = +100                                       36840099
368500        WHEN SQLCODE = -305                                       36850099
368600           MOVE ZEROES                   TO PV-SCN-QTY            36860099
368700                                                                  36870099
368800        WHEN OTHER                                                36880099
368900             MOVE '3750-GET-TGD-QTY'     TO DP013-PARAGRAPH       36890099
369000             MOVE 'SELECT OF TSUAUPC'    TO DP013-MESSAGE-TEXT (1)36900099
369100             MOVE DK-AUDIT-CNTL-NBR      TO DP013-MESSAGE-TEXT (2)36910099
369200             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (3)36920099
369300             MOVE SQLCA                  TO DP013-SQLCA           36930099
369400             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)36940099
369500             SET DP013-DB2-ABEND         TO TRUE                  36950099
369600             SET DP013-NO-ROLLBACK       TO TRUE                  36960099
369700             PERFORM 9999-WRITE-CICS-LOG-MSG                      36970099
369800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               36980099
369900             MOVE -1                     TO ASELECTL              36990099
370000             PERFORM 8100-SEND-DATA-ONLY                          37000099
370100             PERFORM 8200-RETURN-TRANID                           37010099
370200     END-EVALUATE.                                                37020099
370300                                                                  37030099
370400******************************************************************37040099
370500 3800-UPDATE-SUT-PO-AUD-REQ.                                      37050099
370600                                                                  37060099
370700     EXEC SQL                                                     37070099
370800          UPDATE SUT_PO_AUD_REQ                                   37080099
370900          SET    AUD_CART_QTY   = :SUT00015-AUD-CART-QTY          37090099
371000              ,  AUD_UNT_QTY    = :SUT00015-AUD-UNT-QTY           37100099
371100          WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR              37110099
371200     END-EXEC.                                                    37120099
371300                                                                  37130099
371400     EVALUATE TRUE                                                37140099
371500         WHEN SQLCODE = ZERO                                      37150099
371600             CONTINUE                                             37160099
371700                                                                  37170099
371800         WHEN SQLWARN0 NOT = SPACES                               37180099
371900         WHEN SQLCODE NOT EQUAL ZERO                              37190099
372000             MOVE '3800-UPDATE-SUT-PO-AUD-REQ'                    37200099
372100                 TO DP013-PARAGRAPH                               37210099
372200             MOVE 'UPDATE OF SUT_PO_AUD_REQ'                      37220099
372300                 TO DP013-MESSAGE-TEXT (1)                        37230099
372400             MOVE SU006-AUDIT-CNTL-NBR-X                          37240099
372500                 TO DP013-MESSAGE-TEXT (2)                        37250099
372600             MOVE SQLCA            TO DP013-SQLCA                 37260099
372700             MOVE 'SUT00015'       TO DP013-DB2-TABLE-NAME (1)    37270099
372800             SET DP013-DB2-ABEND   TO TRUE                        37280099
372900                                                                  37290099
373000             PERFORM 9999-WRITE-CICS-LOG-MSG                      37300099
373100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               37310099
373200             PERFORM 8100-SEND-DATA-ONLY                          37320099
373300             PERFORM 8200-RETURN-TRANID                           37330099
373400     END-EVALUATE.                                                37340099
373500                                                                  37350099
373600******************************************************************37360099
373700 3900-DELETE-E-RECORDS.                                           37370099
373800                                                                  37380099
373900*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 37390099
374000*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS37400099
374100*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       37410099
374200*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  37420099
374300*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 37430099
374400*    SECOND IN THIS SCENARIO.                                     37440099
374500     IF PS-PRCS-FIRST-AUDIT                                       37450099
374600     OR SU006-RFID-AUD-ONLY                                       37460099
374700     OR SU006-MANUAL-GENERATED-AUDIT                              37470099
374800         MOVE SU006-AUDIT-CNTL-NBR   TO DK-AUDIT-CNTL-NBR         37480099
374900     ELSE                                                         37490099
375000         MOVE SU006-RFID-AUDIT-CNTL-NBR                           37500099
375100                                     TO DK-AUDIT-CNTL-NBR         37510099
375200     END-IF.                                                      37520099
375300                                                                  37530099
375400     MOVE SU006-SHIP-UNIT-NBR        TO DK-SHIP-UNIT-NBR.         37540099
375500                                                                  37550099
375600     PERFORM 3910-DELETE-SHIP-UNIT-E-RECS.                        37560099
375700                                                                  37570099
375800******************************************************************37580099
375900 3910-DELETE-SHIP-UNIT-E-RECS.                                    37590099
376000                                                                  37600099
376100     EXEC SQL                                                     37610099
376200         DELETE                                                   37620099
376300           FROM TSUAUPC                                           37630099
376400          WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR            37640099
376500            AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR             37650099
376600            AND  SCN_TYP_CDE      = 'E'                           37660099
376700     END-EXEC.                                                    37670099
376800                                                                  37680099
376900     EVALUATE TRUE                                                37690099
377000         WHEN SQLCODE = ZERO                                      37700099
377100         WHEN SQLCODE = +100                                      37710099
377200             CONTINUE                                             37720099
377300                                                                  37730099
377400         WHEN SQLWARN0 NOT = SPACES                               37740099
377500         WHEN SQLCODE < ZERO                                      37750099
377600         WHEN SQLCODE > ZERO                                      37760099
377700             MOVE '3910-DELETE-SHIP-UNIT-E-RECS'                  37770099
377800                 TO DP013-PARAGRAPH                               37780099
377900             MOVE 'DELETE OF TSUAUPC TABLE'                       37790099
378000                 TO DP013-MESSAGE-TEXT (1)                        37800099
378100             MOVE SU006-AUDIT-CNTL-NBR-X                          37810099
378200                 TO DP013-MESSAGE-TEXT (2)                        37820099
378300             MOVE SU006-SHIP-UNIT-NBR-X                           37830099
378400                 TO DP013-MESSAGE-TEXT (3)                        37840099
378500             MOVE SQLCA            TO DP013-SQLCA                 37850099
378600             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    37860099
378700             SET DP013-DB2-ABEND   TO TRUE                        37870099
378800                                                                  37880099
378900             PERFORM 9999-WRITE-CICS-LOG-MSG                      37890099
379000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               37900099
379100             PERFORM 8100-SEND-DATA-ONLY                          37910099
379200             PERFORM 8200-RETURN-TRANID                           37920099
379300     END-EVALUATE.                                                37930099
379400                                                                  37940099
379500******************************************************************37950099
379600 3920-SELECT-TSUNAUD.                                             37960099
379700                                                                  37970099
379800     EXEC SQL                                                     37980099
379900         SELECT AUD_STAT_CDE                                      37990099
380000         INTO   :SUNAUD-AUD-STAT-CDE                              38000099
380100         FROM   TSUNAUD                                           38010099
380200         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             38020099
380300     END-EXEC.                                                    38030099
380400                                                                  38040099
380500     EVALUATE TRUE                                                38050099
380600         WHEN SQLCODE = ZERO                                      38060099
380700             CONTINUE                                             38070099
380800                                                                  38080099
380900         WHEN SQLWARN0 NOT = SPACES                               38090099
381000         WHEN SQLCODE < ZERO                                      38100099
381100         WHEN SQLCODE > ZERO                                      38110099
381200             MOVE '3920-SELECT-TSUNAUD'                           38120099
381300                                   TO DP013-PARAGRAPH             38130099
381400             MOVE 'RETRIEVE AUDIT STAT CODE'                      38140099
381500                                   TO DP013-MESSAGE-TEXT (1)      38150099
381600             MOVE DK-AUDIT-CNTL-NBR                               38160099
381700                                   TO DK-AUDIT-CNTL-NBR-X         38170099
381800             STRING 'AUDIT NUMBER = '                             38180099
381900                     DK-AUDIT-CNTL-NBR-X                          38190099
382000                     DELIMITED BY SIZE                            38200099
382100                                 INTO DP013-MESSAGE-TEXT (2)      38210099
382200             MOVE SQLCA            TO DP013-SQLCA                 38220099
382300             MOVE 'TSUNAUD'        TO DP013-DB2-TABLE-NAME (1)    38230099
382400             SET DP013-DB2-ABEND   TO TRUE                        38240099
382500             SET DP013-NO-ROLLBACK TO TRUE                        38250099
382600             PERFORM DP014-0000-PROCESS-ABEND                     38260099
382700     END-EVALUATE.                                                38270099
382800                                                                  38280099
382900******************************************************************38290099
383000 4000-CHECK-FOR-ADJUSTMENTS.                                      38300099
383100                                                                  38310099
383200     PERFORM 4020-SELECT-SULBXF.                                  38320099
383300     IF PS-OUTBOUND-CARTON                                        38330099
383400         PERFORM 4090-SELECT-SUQADJ                               38340099
383500     END-IF.                                                      38350099
383600                                                                  38360099
383700     PERFORM 4060-CHECK-CARTON-ADJ-DC.                            38370099
383800     IF SU006-AUD-ERR                                             38380099
383900         IF (CA-OVER-SHORT OR                                     38390099
384000             PS-PRIOR-ADJUSTMENTS) AND                            38400099
384100            SULBXF-CART-LBL-TYP-CDE NOT = 'P' AND                 38410099
384300            PS-OUTBOUND-CARTON AND                                38430099
384400            PS-CARTON-ADJUST-DC AND                               38440099
384500            NOT SU006-NO-UNIT-ADJ                                 38450099
384600             PERFORM 4080-CARTON-ADJUSTMENTS                      38460099
384700         ELSE                                                     38470099
384800             PERFORM 4100-CHECK-OVER-SHORT                        38480099
384900             IF PS-OVER-SHORT-ERROR AND                           38490099
385000                SULBXF-CART-LBL-TYP-CDE NOT = 'P' AND             38500099
385200                PS-OUTBOUND-CARTON AND                            38520099
385300                PS-CARTON-ADJUST-DC AND                           38530099
385400                NOT SU006-NO-UNIT-ADJ                             38540099
385500                 PERFORM 4080-CARTON-ADJUSTMENTS                  38550099
385600             END-IF                                               38560099
385700         END-IF                                                   38570099
385800     ELSE                                                         38580099
385900         PERFORM 4100-CHECK-OVER-SHORT                            38590099
386000         IF (PS-OVER-SHORT-ERROR OR                               38600099
386100             PS-PRIOR-ADJUSTMENTS) AND                            38610099
386200            SULBXF-CART-LBL-TYP-CDE NOT = 'P' AND                 38620099
386400            PS-OUTBOUND-CARTON AND                                38640099
386500            PS-CARTON-ADJUST-DC AND                               38650099
386600            NOT SU006-NO-UNIT-ADJ                                 38660099
386700             PERFORM 4080-CARTON-ADJUSTMENTS                      38670099
386800         END-IF                                                   38680099
386900     END-IF.                                                      38690099
387000                                                                  38700099
387100******************************************************************38710099
387200 4020-SELECT-SULBXF.                                              38720099
387300                                                                  38730099
387400     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              38740099
387500                                                                  38750099
387600     EXEC SQL                                                     38760099
387700         SELECT CART_LBL_TYP_CDE                                  38770099
387800             ,  BRCDE_NBR                                         38780099
387900         INTO   :SULBXF-CART-LBL-TYP-CDE                          38790099
388000             ,  :SULBXF-BRCDE-NBR                                 38800099
388100          FROM  TSULBXF                                           38810099
388200          WHERE SHIPT_UNT_ID      = :DK-SHIP-UNIT-NBR             38820099
388300           AND  STAT_CDE          = 'A'                           38830099
388400     END-EXEC.                                                    38840099
388500                                                                  38850099
388600     EVALUATE TRUE                                                38860099
388700         WHEN SQLCODE = ZERO                                      38870099
388800              CONTINUE                                            38880099
388900                                                                  38890099
389000         WHEN SQLCODE = +100                                      38900099
389100              SET PS-NO-OUTBOUND-CARTON TO TRUE                   38910099
389200                                                                  38920099
389300         WHEN SQLWARN0 NOT = SPACES                               38930099
389400         WHEN SQLCODE NOT EQUAL ZERO                              38940099
389500             MOVE '4020-SELECT-SULBXF'  TO DP013-PARAGRAPH        38950099
389600             MOVE 'CHECK VALID CARTON'  TO DP013-MESSAGE-TEXT(1)  38960099
389700             MOVE SU006-SHIP-UNIT-NBR   TO DP013-MESSAGE-TEXT(2)  38970099
389800             MOVE SQLCA                 TO DP013-SQLCA            38980099
389900             MOVE 'TSULBXF'             TO DP013-DB2-TABLE-NAME(1)38990099
390000             SET DP013-DB2-ABEND                                  39000099
390100                 DP013-NO-ROLLBACK       TO TRUE                  39010099
390200             PERFORM 9999-WRITE-CICS-LOG-MSG                      39020099
390300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               39030099
390400             MOVE -1                     TO ASELECTL              39040099
390500             PERFORM 8100-SEND-DATA-ONLY                          39050099
390600             PERFORM 8200-RETURN-TRANID                           39060099
390700     END-EVALUATE.                                                39070099
390800                                                                  39080099
394600******************************************************************39460099
394700 4060-CHECK-CARTON-ADJ-DC.                                        39470099
394800                                                                  39480099
394900     MOVE SU006-OPER-UNT-ID        TO DK-LOC-ID.                  39490099
395000                                                                  39500099
395100     EXEC SQL                                                     39510099
395200         SELECT FUNC_TXT                                          39520099
395300           INTO :KRPRPM-FUNC-TXT                                  39530099
395400           FROM TKRPRPM                                           39540099
395500          WHERE SYS_PRC_FUNC_CDE  = 'CRTADJ'                      39550099
395600            AND LOC_ID            = :DK-LOC-ID                    39560099
395700            AND INTFC_SYS_CDE     = 'KHL'                         39570099
395800            AND FUNC_PRC_STAT_CDE = 'AC'                          39580099
395900            AND (CURRENT DATE                                     39590099
396000        BETWEEN DATE(FUNC_BEG_TMST) AND                           39600099
396100                DATE(FUNC_END_TMST) )                             39610099
396200     END-EXEC.                                                    39620099
396300                                                                  39630099
396400     EVALUATE SQLCODE                                             39640099
396500         WHEN ZERO                                                39650099
396600             IF KRPRPM-FUNC-TXT = 'Y'                             39660099
396700                 SET PS-CARTON-ADJUST-DC  TO TRUE                 39670099
396800             ELSE                                                 39680099
396900                 SET PS-NOT-CARTON-ADJUST-DC  TO TRUE             39690099
397000             END-IF                                               39700099
397100                                                                  39710099
397200         WHEN OTHER                                               39720099
397300              MOVE '4060-CHECK-CARTON-ADJ-DC'                     39730099
397400                               TO DP013-PARAGRAPH                 39740099
397500              MOVE 'SELECT CARTON ADJUSTMENT IND'                 39750099
397600                               TO DP013-MESSAGE-TEXT (1)          39760099
397700              MOVE SQLCA       TO DP013-SQLCA                     39770099
397800              SET DP013-DB2-ABEND                                 39780099
397900                               TO TRUE                            39790099
398000              PERFORM DP014-0000-PROCESS-ABEND                    39800099
398100     END-EVALUATE.                                                39810099
398200                                                                  39820099
398300******************************************************************39830099
398400 4080-CARTON-ADJUSTMENTS.                                         39840099
398500                                                                  39850099
398600     INITIALIZE SU034-COMM-AREA.                                  39860099
398700     MOVE SU006-SHIP-UNIT-NBR       TO SU034-SHIPT-UNT-ID.        39870099
398800     MOVE 'AUDITADJ'                TO SU034-PRC-RSN-CDE.         39880099
398900     MOVE SU006-OPER-UNT-ID         TO SU034-OPER-UNT-ID.         39890099
399000     MOVE 'U'                       TO SU034-ADJ-FUNC-CDE.        39900099
399100     MOVE SU006-AUDIT-CNTL-NBR      TO SU034-ADJ-AUDIT-CNTL-NBR.  39910099
399200     MOVE SU006-USERID              TO SU034-USER-ID.             39920099
399300     MOVE PC-CURRENT-PROGRAM-NAME   TO SU034-PROGRAM-NAME.        39930099
399400     MOVE SU006-STORE               TO SU034-STR-NBR.             39940099
399500                                                                  39950099
399600     MOVE LENGTH OF SU034-COMM-AREA TO PV-COMMAREA-LENGTH.        39960099
399700                                                                  39970099
399800     EXEC CICS                                                    39980099
399900         LINK PROGRAM  (PC-SUKUT701)                              39990099
400000              COMMAREA (SU034-COMM-AREA)                          40000099
400100              LENGTH   (PV-COMMAREA-LENGTH)                       40010099
400200              RESP     (PV-CICS-RESPONSE)                         40020099
400300     END-EXEC.                                                    40030099
400400                                                                  40040099
400500     EVALUATE TRUE                                                40050099
400600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 40060099
400700             IF NOT SU034-SUCCESSFUL                              40070099
400800                 MOVE SPACES TO PV-CICS-MSG-AREA2                 40080099
400900                 STRING ' SUKRF512 - CARTON ADJUSTMENT ERROR'     40090099
401000                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      40100099
401100                 PERFORM 999A-WRITE-CSSL-MSG                      40110099
401200                                                                  40120099
401300                 MOVE SPACES TO PV-CICS-MSG-AREA2                 40130099
401400                 STRING 'SHIPT UNIT = ' SU006-SHIP-UNIT-NBR       40140099
401500                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      40150099
401600                 PERFORM 999A-WRITE-CSSL-MSG                      40160099
401700                                                                  40170099
401800                 MOVE SPACES TO PV-CICS-MSG-AREA2                 40180099
401900                 STRING 'AUDIT= ' SU006-AUDIT-CNTL-NBR            40190099
402000                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      40200099
402100                 PERFORM 999A-WRITE-CSSL-MSG                      40210099
402200                                                                  40220099
402300                 MOVE SPACES TO PV-CICS-MSG-AREA2                 40230099
402400                 STRING 'SQLCODE  = ' SU034-SQLCA                 40240099
402500                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      40250099
402600                 PERFORM 999A-WRITE-CSSL-MSG                      40260099
402700                                                                  40270099
402800                 MOVE SPACES TO PV-CICS-MSG-AREA2                 40280099
402900                 STRING 'RETURN MSG = ' SU034-CRA-RET-MSG         40290099
403000                    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA2      40300099
403100                 PERFORM 999A-WRITE-CSSL-MSG                      40310099
403200                 SET DP013-LINK-RETURN                            40320099
403300                     DP013-CICS-ABEND                             40330099
403400                     DP013-ROLLBACK TO TRUE                       40340099
403500                 PERFORM DP014-0000-PROCESS-ABEND                 40350099
403600                 MOVE PV-SAVE-SHIP-UNIT-STATUS                    40360099
403700                                  TO SU006-SHIP-UNIT-STATUS       40370099
403800                 MOVE PC-POSTPONE-TRY-AGAIN-MSG TO  AMSGLNO       40380099
403900             END-IF                                               40390099
404000             IF SU034-FAILED-ADJ                                  40400099
404100                 MOVE PC-CLOSED-W-FAILED-ADJ-MSG TO AMSGLNO       40410099
404200             END-IF                                               40420099
404300                                                                  40430099
404400         WHEN OTHER                                               40440099
404500             MOVE '4080-CARTON-ADJUSTMENTS'                       40450099
404600                                  TO DP013-PARAGRAPH              40460099
404700             MOVE PV-CICS-RESPONSE                                40470099
404800                                  TO DP013-MESSAGE-TEXT(1)        40480099
404900             SET DP013-LINK-RETURN                                40490099
405000                 DP013-CICS-ABEND                                 40500099
405100                 DP013-ROLLBACK TO TRUE                           40510099
405200             PERFORM DP014-0000-PROCESS-ABEND                     40520099
405300             MOVE PV-SAVE-SHIP-UNIT-STATUS                        40530099
405400                                  TO SU006-SHIP-UNIT-STATUS       40540099
405500             MOVE PC-POSTPONE-TRY-AGAIN-MSG TO  AMSGLNO           40550099
405600     END-EVALUATE.                                                40560099
405700                                                                  40570099
405800******************************************************************40580099
405900  4090-SELECT-SUQADJ.                                             40590099
406000                                                                  40600099
406100     MOVE SULBXF-BRCDE-NBR         TO PV-BRCDE-NBR.               40610099
406200     MOVE PV-BRCDE-NBR-N           TO DK-SUQADJ-SHIPT-UNT-ID.     40620099
406300                                                                  40630099
406400     EXEC SQL                                                     40640099
406500         SELECT COUNT(*)                                          40650099
406600           INTO :PV-SUQADJ-COUNT                                  40660099
406700           FROM TSUQADJ                                           40670099
406800          WHERE SHIPT_UNT_ID      = :DK-SUQADJ-SHIPT-UNT-ID       40680099
406900     END-EXEC.                                                    40690099
407000                                                                  40700099
407100     EVALUATE SQLCODE                                             40710099
407200         WHEN ZERO                                                40720099
407300             IF PV-SUQADJ-COUNT > 0                               40730099
407400                 SET PS-PRIOR-ADJUSTMENTS TO TRUE                 40740099
407500             ELSE                                                 40750099
407600                 SET PS-NO-PRIOR-ADJUSTMENTS TO TRUE              40760099
407700             END-IF                                               40770099
407800                                                                  40780099
407900         WHEN OTHER                                               40790099
408000              MOVE '4090-SELECT-SUQADJ'                           40800099
408100                               TO DP013-PARAGRAPH                 40810099
408200              MOVE 'SELECT CARTON ADJUSTMENT IND'                 40820099
408300                               TO DP013-MESSAGE-TEXT (1)          40830099
408400              MOVE SQLCA       TO DP013-SQLCA                     40840099
408500              MOVE SULBXF-BRCDE-NBR                               40850099
408600                               TO DP013-MESSAGE-TEXT (2)          40860099
408700              SET DP013-DB2-ABEND                                 40870099
408800                               TO TRUE                            40880099
408900              PERFORM DP014-0000-PROCESS-ABEND                    40890099
409000     END-EVALUATE.                                                40900099
409100                                                                  40910099
409200******************************************************************40920099
409300* 4100-CHECK-OVER-SHORT                                          *40930099
409400*  COMPARE EACH ITEM ON THE CARTON DATABASE, DO A SELECT OF THE  *40940099
409500* AUDIT DATABASE TO DETERMINE IF THE ITEM WAS ACTUALLY FOUND TO  *40950099
409600* BE IN IT, AND IF SO, WHO MUCH WAS IN IT (OVER/SHORT)           *40960099
409700******************************************************************40970099
409800 4100-CHECK-OVER-SHORT.                                           40980099
409900                                                                  40990099
410000*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 41000099
410100*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS41010099
410200*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       41020099
410300*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  41030099
410400*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 41040099
410500*    SECOND IN THIS SCENARIO.                                     41050099
410600     IF PS-PRCS-FIRST-AUDIT                                       41060099
410700     OR SU006-RFID-AUD-ONLY                                       41070099
410800     OR SU006-MANUAL-GENERATED-AUDIT                              41080099
410900         MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR           41090099
411000     ELSE                                                         41100099
411100         MOVE SU006-RFID-AUDIT-CNTL-NBR                           41110099
411200                                   TO DK-AUDIT-CNTL-NBR           41120099
411300     END-IF.                                                      41130099
411400                                                                  41140099
411500     MOVE SU006-SHIP-UNIT-NBR      TO DK-SHIP-UNIT-NBR.           41150099
411600                                                                  41160099
411700     PERFORM 4101-OPEN-CARTON-ITEM-CURSOR.                        41170099
411800     PERFORM 4102-FETCH-CARTON-ITEM-CURSOR.                       41180099
411900                                                                  41190099
412000     PERFORM 4104-OPEN-AUDIT-ITEM-CURSOR.                         41200099
412100     PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR.                        41210099
412200                                                                  41220099
412300                                                                  41230099
412400*    BUMP THE TWO ITEM CURSORS TOGETHER.  THE FIRST TIME THERE    41240099
412500*    IS A SKU ON ONE BUT NOT THE OTHER, OR IF THE QUANTITIES DO   41250099
412600*    NOT MATCH, THERE IS AN OVERAGE OR A SHORTAGE ERROR.  BUMP    41260099
412700*    THE TWO UNTIL AN ERROR IS MATCH OR UNTIL ONE OF THE CURSORS  41270099
412800*    ENDS                                                         41280099
412900     PERFORM UNTIL PS-EOC-CARTON-ITEM-CURSOR                      41290099
413000                OR PS-EOC-AUDIT-ITEM-CURSOR                       41300099
413100                OR PS-OVER-SHORT-ERROR                            41310099
413200                                                                  41320099
413300         IF  PV-AUDIT-INTR-UPC   =  PV-EXPECT-INTR-UPC            41330099
413400         AND PV-ITEM-COUNT-AUDIT =  PV-ITEM-COUNT-CARTON          41340099
413500             PERFORM 4102-FETCH-CARTON-ITEM-CURSOR                41350099
413600             PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR                 41360099
413700         ELSE                                                     41370099
413800             SET PS-OVER-SHORT-ERROR TO TRUE                      41380099
413900         END-IF                                                   41390099
414000                                                                  41400099
414100     END-PERFORM.                                                 41410099
414200                                                                  41420099
414300*    IF ONE CURSOR RAN OUT BEFORE THE OTHER, THERE IS AN          41430099
414400*    ERROR                                                        41440099
414500     IF (PS-EOC-CARTON-ITEM-CURSOR                                41450099
414600     AND PS-EOC-AUDIT-ITEM-CURSOR)                                41460099
414700      OR PS-OVER-SHORT-ERROR                                      41470099
414800          CONTINUE                                                41480099
414900     ELSE                                                         41490099
415000         SET PS-OVER-SHORT-ERROR   TO TRUE                        41500099
415100     END-IF.                                                      41510099
415200                                                                  41520099
415300*    CLOSE THE CURSORS                                            41530099
415400     PERFORM 4103-CLOSE-CARTON-ITEM-CURSOR.                       41540099
415500     PERFORM 4106-CLOSE-AUDIT-ITEM-CURSOR.                        41550099
415600                                                                  41560099
415700******************************************************************41570099
415800* 4101-OPEN-CARTON-ITEM-CURSOR                                   *41580099
415900*  OPEN THE PO LINE CURSOR                                       *41590099
416000******************************************************************41600099
416100 4101-OPEN-CARTON-ITEM-CURSOR.                                    41610099
416200                                                                  41620099
416300     EXEC SQL                                                     41630099
416400         OPEN CARTON_ITEM_CURSOR                                  41640099
416500     END-EXEC.                                                    41650099
416600                                                                  41660099
416700     EVALUATE TRUE                                                41670099
416800         WHEN SQLCODE = ZERO                                      41680099
416900             SET PS-NOT-EOC-CARTON-ITEM-CURSOR                    41690099
417000                 PS-NO-OVER-SHORT-ERROR       TO TRUE             41700099
417100                                                                  41710099
417200         WHEN SQLWARN0 NOT = SPACES                               41720099
417300         WHEN SQLCODE < ZERO                                      41730099
417400         WHEN SQLCODE > ZERO                                      41740099
417500             MOVE '4101-OPEN-CARTON-ITEM-CURSOR'                  41750099
417600                                   TO DP013-PARAGRAPH             41760099
417700             MOVE 'OPEN CARTON_ITEM_CURSOR'                       41770099
417800                                   TO DP013-MESSAGE-TEXT (1)      41780099
417900             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   41790099
418000             MOVE SQLCA            TO DP013-SQLCA                 41800099
418100             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    41810099
418200             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    41820099
418300             SET DP013-DB2-ABEND   TO TRUE                        41830099
418400                                                                  41840099
418500             PERFORM 9999-WRITE-CICS-LOG-MSG                      41850099
418600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               41860099
418700             PERFORM 8100-SEND-DATA-ONLY                          41870099
418800             PERFORM 8200-RETURN-TRANID                           41880099
418900     END-EVALUATE.                                                41890099
419000                                                                  41900099
419100******************************************************************41910099
419200* 4102-FETCH-CARTON-ITEM-CURSOR                                  *41920099
419300*  FETCH THE NEXT OCCURANCE OF THE OVER_SHORT_CUSOR              *41930099
419400******************************************************************41940099
419500 4102-FETCH-CARTON-ITEM-CURSOR.                                   41950099
419600                                                                  41960099
419700     EXEC SQL                                                     41970099
419800         FETCH CARTON_ITEM_CURSOR                                 41980099
419900         INTO    :PV-EXPECT-INTR-UPC                              41990099
420000              ,  :PV-EXPECT-HOLD-UPC-NBR                          42000099
420100              ,  :PV-ITEM-COUNT-CARTON                            42010099
420200     END-EXEC.                                                    42020099
420300                                                                  42030099
420400     EVALUATE TRUE                                                42040099
420500         WHEN SQLCODE = ZERO                                      42050099
420600             CONTINUE                                             42060099
420700                                                                  42070099
420800         WHEN SQLCODE = +100                                      42080099
420900             SET PS-EOC-CARTON-ITEM-CURSOR   TO TRUE              42090099
421000                                                                  42100099
421100         WHEN SQLWARN0 NOT = SPACES                               42110099
421200         WHEN SQLCODE < ZERO                                      42120099
421300         WHEN SQLCODE > ZERO                                      42130099
421400             MOVE '4102-FETCH-CARTON-ITEM-CURSOR'                 42140099
421500                                   TO DP013-PARAGRAPH             42150099
421600             MOVE 'FETCH OF CARTON_ITEM_CUROSR'                   42160099
421700                                   TO DP013-MESSAGE-TEXT (1)      42170099
421800             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   42180099
421900             MOVE SQLCA            TO DP013-SQLCA                 42190099
422000             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    42200099
422100             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    42210099
422200             SET DP013-DB2-ABEND   TO TRUE                        42220099
422300                                                                  42230099
422400             PERFORM 9999-WRITE-CICS-LOG-MSG                      42240099
422500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               42250099
422600             PERFORM 8100-SEND-DATA-ONLY                          42260099
422700             PERFORM 8200-RETURN-TRANID                           42270099
422800     END-EVALUATE.                                                42280099
422900                                                                  42290099
423000******************************************************************42300099
423100* 4103-CLOSE-CARTON-ITEM-CURSOR                                  *42310099
423200*  CLOSE THE PO LINE CURSOR                                      *42320099
423300******************************************************************42330099
423400 4103-CLOSE-CARTON-ITEM-CURSOR.                                   42340099
423500                                                                  42350099
423600     EXEC SQL                                                     42360099
423700         CLOSE CARTON_ITEM_CURSOR                                 42370099
423800     END-EXEC.                                                    42380099
423900                                                                  42390099
424000     EVALUATE TRUE                                                42400099
424100         WHEN SQLCODE = ZERO                                      42410099
424200             CONTINUE                                             42420099
424300                                                                  42430099
424400         WHEN SQLWARN0 NOT = SPACES                               42440099
424500         WHEN SQLCODE < ZERO                                      42450099
424600         WHEN SQLCODE > ZERO                                      42460099
424700             MOVE '4103-CLOSE-CARTON-ITEM-CURSOR'                 42470099
424800                                   TO DP013-PARAGRAPH             42480099
424900             MOVE 'CLOSE OF CARTON_ITEM_CUSOR'                    42490099
425000                                   TO DP013-MESSAGE-TEXT (1)      42500099
425100             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   42510099
425200             MOVE SQLCA            TO DP013-SQLCA                 42520099
425300             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    42530099
425400             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    42540099
425500             SET DP013-DB2-ABEND   TO TRUE                        42550099
425600                                                                  42560099
425700             PERFORM 9999-WRITE-CICS-LOG-MSG                      42570099
425800             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               42580099
425900             PERFORM 8100-SEND-DATA-ONLY                          42590099
426000             PERFORM 8200-RETURN-TRANID                           42600099
426100     END-EVALUATE.                                                42610099
426200                                                                  42620099
426300******************************************************************42630099
426400* 4104-OPEN-AUDIT-ITEM-CURSOR                                    *42640099
426500*  OPEN THE PO LINE CURSOR                                       *42650099
426600******************************************************************42660099
426700 4104-OPEN-AUDIT-ITEM-CURSOR.                                     42670099
426800                                                                  42680099
426900     EXEC SQL                                                     42690099
427000         OPEN AUDIT_ITEM_CURSOR                                   42700099
427100     END-EXEC.                                                    42710099
427200                                                                  42720099
427300     EVALUATE TRUE                                                42730099
427400         WHEN SQLCODE = ZERO                                      42740099
427500             SET PS-NOT-EOC-AUDIT-ITEM-CURSOR                     42750099
427600                 PS-NO-OVER-SHORT-ERROR       TO TRUE             42760099
427700                                                                  42770099
427800         WHEN SQLWARN0 NOT = SPACES                               42780099
427900         WHEN SQLCODE < ZERO                                      42790099
428000         WHEN SQLCODE > ZERO                                      42800099
428100             MOVE '4104-OPEN-AUDIT-ITEM-CURSOR'                   42810099
428200                                   TO DP013-PARAGRAPH             42820099
428300             MOVE 'OPEN AUDIT_ITEM_CURSOR'                        42830099
428400                                   TO DP013-MESSAGE-TEXT (1)      42840099
428500             MOVE SU006-AUDIT-CNTL-NBR-X                          42850099
428600                                   TO DP013-MESSAGE-TEXT (2)      42860099
428700             MOVE SU006-SHIP-UNIT-NBR-X                           42870099
428800                                   TO DP013-MESSAGE-TEXT (3)      42880099
428900             MOVE SQLCA            TO DP013-SQLCA                 42890099
429000             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    42900099
429100             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    42910099
429200             SET DP013-DB2-ABEND   TO TRUE                        42920099
429300                                                                  42930099
429400             PERFORM 9999-WRITE-CICS-LOG-MSG                      42940099
429500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               42950099
429600             PERFORM 8100-SEND-DATA-ONLY                          42960099
429700             PERFORM 8200-RETURN-TRANID                           42970099
429800     END-EVALUATE.                                                42980099
429900                                                                  42990099
430000******************************************************************43000099
430100* 4105-FETCH-AUDIT-ITEM-CURSOR                                   *43010099
430200*  FETCH THE NEXT OCCURANCE OF THE OVER_SHORT_CUSOR              *43020099
430300******************************************************************43030099
430400 4105-FETCH-AUDIT-ITEM-CURSOR.                                    43040099
430500                                                                  43050099
430600     EXEC SQL                                                     43060099
430700         FETCH AUDIT_ITEM_CURSOR                                  43070099
430800         INTO    :PV-AUDIT-INTR-UPC                               43080099
430900              ,  :PV-AUDIT-HOLD-UPC-NBR                           43090099
431000              ,  :PV-ITEM-COUNT-AUDIT                             43100099
431100     END-EXEC.                                                    43110099
431200                                                                  43120099
431300     EVALUATE TRUE                                                43130099
431400         WHEN SQLCODE = ZERO                                      43140099
431500             CONTINUE                                             43150099
431600                                                                  43160099
431700         WHEN SQLCODE = +100                                      43170099
431800             SET PS-EOC-AUDIT-ITEM-CURSOR    TO TRUE              43180099
431900             MOVE 999999999        TO PV-AUDIT-INTR-UPC           43190099
432000             MOVE 0                TO PV-ITEM-COUNT-AUDIT         43200099
432100                                                                  43210099
432200         WHEN SQLWARN0 NOT = SPACES                               43220099
432300         WHEN SQLCODE < ZERO                                      43230099
432400         WHEN SQLCODE > ZERO                                      43240099
432500             MOVE '4105-FETCH-AUDIT-ITEM-CURSOR'                  43250099
432600                                   TO DP013-PARAGRAPH             43260099
432700             MOVE 'FETCH OF AUDIT_ITEM_CURSOR'                    43270099
432800                                   TO DP013-MESSAGE-TEXT (1)      43280099
432900             MOVE SU006-AUDIT-CNTL-NBR-X                          43290099
433000                                   TO DP013-MESSAGE-TEXT (2)      43300099
433100             MOVE SU006-SHIP-UNIT-NBR-X                           43310099
433200                                   TO DP013-MESSAGE-TEXT (3)      43320099
433300             MOVE SQLCA            TO DP013-SQLCA                 43330099
433400             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    43340099
433500             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    43350099
433600             SET DP013-DB2-ABEND   TO TRUE                        43360099
433700                                                                  43370099
433800             PERFORM 9999-WRITE-CICS-LOG-MSG                      43380099
433900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               43390099
434000             PERFORM 8100-SEND-DATA-ONLY                          43400099
434100             PERFORM 8200-RETURN-TRANID                           43410099
434200     END-EVALUATE.                                                43420099
434300                                                                  43430099
434400******************************************************************43440099
434500* 4106-CLOSE-AUDIT-ITEM-CURSOR                                   *43450099
434600*  CLOSE THE PO LINE CURSOR                                      *43460099
434700******************************************************************43470099
434800 4106-CLOSE-AUDIT-ITEM-CURSOR.                                    43480099
434900                                                                  43490099
435000     EXEC SQL                                                     43500099
435100         CLOSE AUDIT_ITEM_CURSOR                                  43510099
435200     END-EXEC.                                                    43520099
435300                                                                  43530099
435400     EVALUATE TRUE                                                43540099
435500         WHEN SQLCODE = ZERO                                      43550099
435600             CONTINUE                                             43560099
435700                                                                  43570099
435800         WHEN SQLWARN0 NOT = SPACES                               43580099
435900         WHEN SQLCODE < ZERO                                      43590099
436000         WHEN SQLCODE > ZERO                                      43600099
436100             MOVE '4106-CLOSE-AUDIT-ITEM-CURSOR'                  43610099
436200                                   TO DP013-PARAGRAPH             43620099
436300             MOVE 'CLOSE OF AUDIT_ITEM_CURSOR'                    43630099
436400                                   TO DP013-MESSAGE-TEXT (1)      43640099
436500             MOVE SU006-AUDIT-CNTL-NBR-X                          43650099
436600                                   TO DP013-MESSAGE-TEXT (2)      43660099
436700             MOVE SU006-SHIP-UNIT-NBR-X                           43670099
436800                                   TO DP013-MESSAGE-TEXT (3)      43680099
436900             MOVE SQLCA            TO DP013-SQLCA                 43690099
437000             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    43700099
437100             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    43710099
437200             SET DP013-DB2-ABEND   TO TRUE                        43720099
437300                                                                  43730099
437400             PERFORM 9999-WRITE-CICS-LOG-MSG                      43740099
437500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               43750099
437600             PERFORM 8100-SEND-DATA-ONLY                          43760099
437700             PERFORM 8200-RETURN-TRANID                           43770099
437800     END-EVALUATE.                                                43780099
437900                                                                  43790099
438000******************************************************************43800099
438100* 4150-CHECK-OVER-SHORT                                          *43810099
438200*  COMPARE EACH ITEM ON THE CARTON DATABASE, DO A SELECT OF THE  *43820099
438300* AUDIT DATABASE TO DETERMINE IF THE ITEM WAS ACTUALLY FOUND TO  *43830099
438400* BE IN IT, AND IF SO, WHO MUCH WAS IN IT (OVER/SHORT)           *43840099
438500******************************************************************43850099
438600 4150-CHECK-OVER-SHORT.                                           43860099
438700                                                                  43870099
438800*   IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT  43880099
438900*   AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS 43890099
439000*   AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE        43900099
439100*   CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,   43910099
439200*   THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS  43920099
439300*   SECOND IN THIS SCENARIO.                                      43930099
439400     IF PS-PRCS-FIRST-AUDIT                                       43940099
439500     OR SU006-RFID-AUD-ONLY                                       43950099
439600     OR SU006-MANUAL-GENERATED-AUDIT                              43960099
439700        MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR            43970099
439800     ELSE                                                         43980099
439900        MOVE SU006-RFID-AUDIT-CNTL-NBR                            43990099
440000                                  TO DK-AUDIT-CNTL-NBR            44000099
440100     END-IF.                                                      44010099
440200                                                                  44020099
440300     MOVE SU006-SHIP-UNIT-NBR     TO DK-SHIP-UNIT-NBR.            44030099
440400                                                                  44040099
440500     PERFORM 4101-OPEN-CARTON-ITEM-CURSOR.                        44050099
440600     PERFORM 4102-FETCH-CARTON-ITEM-CURSOR.                       44060099
440700                                                                  44070099
440800     PERFORM 4104-OPEN-AUDIT-ITEM-CURSOR.                         44080099
440900     PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR.                        44090099
441000                                                                  44100099
441100                                                                  44110099
441200**NO ITEMS FROM THE CARTON HAVE BEEN SCANNED *******************  44120099
441300     IF PS-EOC-AUDIT-ITEM-CURSOR                                  44130099
441400        MOVE PC-INVALID-CLOSE-STATUS-MSG TO  AMSGLNO              44140099
441500        MOVE -1                          TO  ASELECTL             44150099
441600        PERFORM 8100-SEND-DATA-ONLY                               44160099
441700        PERFORM 8200-RETURN-TRANID                                44170099
441800     END-IF                                                       44180099
441900                                                                  44190099
442000*    BUMP THE TWO ITEM CURSORS TOGETHER.  FOR EVERY ITEM WHERE    44200099
442100*    A UPC IS ON ONE BUT NO THE OTHER, OR IF THE QUANTITIES DO    44210099
442200*    NOT MATCH, THERE IS AN OVERAGE OR A SHORTAGE ERROR.  CHECK   44220099
442300*    EVERY ITEM AND CREATE AN EXCEPTION FOR EVERY OVERAGE OR      44230099
442400*    SHORTAGE.                                                    44240099
442500     PERFORM UNTIL PS-EOC-CARTON-ITEM-CURSOR                      44250099
442600                                                                  44260099
442700         IF  PV-AUDIT-INTR-UPC   =  PV-EXPECT-INTR-UPC            44270099
442800         AND PV-ITEM-COUNT-AUDIT =  PV-ITEM-COUNT-CARTON          44280099
442900             PERFORM 4102-FETCH-CARTON-ITEM-CURSOR                44290099
443000             PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR                 44300099
443100         ELSE                                                     44310099
443200             IF  PV-AUDIT-INTR-UPC   =  PV-EXPECT-INTR-UPC        44320099
443300             AND PV-ITEM-COUNT-AUDIT NOT =  PV-ITEM-COUNT-CARTON  44330099
443400                 IF PV-ITEM-COUNT-CARTON > PV-ITEM-COUNT-AUDIT    44340099
443500                     COMPUTE PV-SCND-UNT-QTY =                    44350099
443600                       PV-ITEM-COUNT-CARTON - PV-ITEM-COUNT-AUDIT 44360099
443700                     MOVE 30           TO SUEXCP-VILN-GP-SEQ-NBR  44370099
443800                 ELSE                                             44380099
443900                     COMPUTE PV-SCND-UNT-QTY =                    44390099
444000                       PV-ITEM-COUNT-AUDIT - PV-ITEM-COUNT-CARTON 44400099
444100                     MOVE 29           TO SUEXCP-VILN-GP-SEQ-NBR  44410099
444200                 END-IF                                           44420099
444300                 PERFORM 4400-DETERMINE-UPC                       44430099
444400                 SET PS-OVER-SHORT-ERROR TO TRUE                  44440099
444500                 PERFORM 4102-FETCH-CARTON-ITEM-CURSOR            44450099
444600                 PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR             44460099
444700             ELSE                                                 44470099
444800             IF PS-EOC-AUDIT-ITEM-CURSOR OR                       44480099
444900                 PV-AUDIT-INTR-UPC   >  PV-EXPECT-INTR-UPC        44490099
445000                 MOVE 30           TO SUEXCP-VILN-GP-SEQ-NBR      44500099
445100                 MOVE PV-ITEM-COUNT-CARTON  TO PV-SCND-UNT-QTY    44510099
445200                 PERFORM 4400-DETERMINE-UPC                       44520099
445300                 SET PS-OVER-SHORT-ERROR TO TRUE                  44530099
445400                 PERFORM 4102-FETCH-CARTON-ITEM-CURSOR            44540099
445500             ELSE                                                 44550099
445600                 SET PS-OVER-SHORT-ERROR TO TRUE                  44560099
445700                 PERFORM 4105-FETCH-AUDIT-ITEM-CURSOR             44570099
445800             END-IF                                               44580099
445900             END-IF                                               44590099
446000         END-IF                                                   44600099
446100                                                                  44610099
446200     END-PERFORM.                                                 44620099
446300                                                                  44630099
446400*    IF ONE CURSOR RAN OUT BEFORE THE OTHER, THERE IS AN          44640099
446500*    ERROR                                                        44650099
446600     IF (PS-EOC-CARTON-ITEM-CURSOR                                44660099
446700     AND PS-EOC-AUDIT-ITEM-CURSOR)                                44670099
446800      OR PS-OVER-SHORT-ERROR                                      44680099
446900          CONTINUE                                                44690099
447000     ELSE                                                         44700099
447100         SET PS-OVER-SHORT-ERROR   TO TRUE                        44710099
447200     END-IF.                                                      44720099
447300                                                                  44730099
447400*    CLOSE THE CURSORS                                            44740099
447500     PERFORM 4103-CLOSE-CARTON-ITEM-CURSOR.                       44750099
447600     PERFORM 4106-CLOSE-AUDIT-ITEM-CURSOR.                        44760099
447700                                                                  44770099
447800******************************************************************44780099
447900* 4190-CHECK-RFID-RTN.                                           *44790099
448000*  COMPARE THE TOTAL UNITS SCANNED TO THE UNITS WITH RFID TAGS   *44800099
448100* AND IF THERE IS ANY DIFFERENCE, AN EXCEPTION IS CREATED.       *44810099
448200* FOR A COMBINED AUDIT THE SCANNED QTY IS STORED ON THE QC ROW   *44820099
448300* IN TSUAUPC AND THE RFID TAGGED QTY IS STORED ON THE RFID ROW.  *44830099
448400******************************************************************44840099
448500 4190-CHECK-RFID-RTN.                                             44850099
448600                                                                  44860099
448700     IF PV-COMP-SCAN-QTY > PV-COMP-TAG-QTY                        44870099
448800     OR PV-COMP-SCAN-QTY < PV-COMP-TAG-QTY                        44880099
448900        MOVE 42                    TO SUEXCP-VILN-GP-SEQ-NBR      44890099
449000        SET PS-OVER-SHORT-ERROR    TO TRUE                        44900099
449200        SET SU006-AUD-ERR          TO TRUE                        44920099
449400     END-IF.                                                      44940099
449500                                                                  44950099
449600     IF PS-OVER-SHORT-ERROR                                       44960099
449700        MOVE PV-COMP-UPC-NBR       TO PV-CARTON-UPC-NBR           44970099
449800        PERFORM 5000-SELECT-TUPC-BY-UPC-NBR                       44980099
449900        MOVE PV-COMP-SCAN-QTY      TO SUAUPC-SCND-UNT-QTY         44990099
450000        MOVE PV-COMP-TAG-QTY       TO SUAUPC-RFID-TGD-QTY         45000099
450100        PERFORM 4200-CREATE-AUDIT-ROW                             45010099
450200        PERFORM 4300-CREATE-EXCEPTION                             45020099
450300     END-IF.                                                      45030099
450400                                                                  45040099
450500***************************************************************** 45050099
450600*   4200-CREATE-AUDIT-ROW                                       * 45060099
450700* CREATE AN AUDIT ROW FOR THE SCANNED/ENTERED UPC (OR ZEROS IF  * 45070099
450800* THERE IS NO UPC ENTERED                                       * 45080099
450900***************************************************************** 45090099
451000 4200-CREATE-AUDIT-ROW.                                           45100099
451100                                                                  45110099
451200*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 45120099
451300*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS45130099
451400*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       45140099
451500*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  45150099
451600*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 45160099
451700*    SECOND IN THIS SCENARIO.                                     45170099
451800     IF PS-PRCS-FIRST-AUDIT                                       45180099
451900     OR SU006-QC-AUD-ONLY                                         45190099
452000     OR SU006-RFID-AUD-ONLY                                       45200099
452100     OR SU006-MANUAL-GENERATED-AUDIT                              45210099
452200         MOVE SU006-AUDIT-CNTL-NBR      TO SUAUPC-AUD-CNTL-NBR    45220099
452300     ELSE                                                         45230099
452400         MOVE SU006-RFID-AUDIT-CNTL-NBR TO SUAUPC-AUD-CNTL-NBR    45240099
452500     END-IF.                                                      45250099
452600                                                                  45260099
452700     MOVE SU006-SHIP-UNIT-NBR           TO SUAUPC-SHIPT-UNT-ID.   45270099
452800     MOVE PV-CARTON-UPC-NBR             TO SUAUPC-UPC-NBR.        45280099
452900     MOVE SU006-USERID                  TO SUAUPC-AUD-USR-ID.     45290099
453300     MOVE 'E'                           TO SUAUPC-SCN-TYP-CDE.    45330099
453400                                                                  45340099
453500     EXEC SQL                                                     45350099
453600         SET :SUAUPC-SCN-TMST = CURRENT TIMESTAMP                 45360099
453700     END-EXEC.                                                    45370099
453800                                                                  45380099
453900     EXEC SQL                                                     45390099
454000         INSERT INTO TSUAUPC                                      45400099
454100             ( AUD_CNTL_NBR                                       45410099
454200              ,SHIPT_UNT_ID                                       45420099
454300              ,UPC_NBR                                            45430099
454400              ,SCN_TMST                                           45440099
454500              ,AUD_USR_ID                                         45450099
454600              ,DEPT_NBR                                           45460099
454700              ,MAJ_CL_NBR                                         45470099
454800              ,SUB_CL_NBR                                         45480099
454900              ,ITM_DESC                                           45490099
455000              ,VND_STYL_DESC                                      45500099
455100              ,UPC_CLOR_DESC                                      45510099
455200              ,UPC_SIZE_DESC                                      45520099
455300              ,UPC_RTL_AMT                                        45530099
455400              ,UPC_CERTD_IND                                      45540099
455500              ,SCND_UNT_QTY                                       45550099
455600              ,SCN_TYP_CDE                                        45560099
455700              ,SKU_NBR                                            45570099
455800             )                                                    45580099
455900         VALUES                                                   45590099
456000             (                                                    45600099
456100                :SUAUPC-AUD-CNTL-NBR                              45610099
456200              , :SUAUPC-SHIPT-UNT-ID                              45620099
456300              , :SUAUPC-UPC-NBR                                   45630099
456400              , :SUAUPC-SCN-TMST                                  45640099
456500              , :SUAUPC-AUD-USR-ID                                45650099
456600              , :SUAUPC-DEPT-NBR                                  45660099
456700              , :SUAUPC-MAJ-CL-NBR                                45670099
456800              , :SUAUPC-SUB-CL-NBR                                45680099
456900              , :SUAUPC-ITM-DESC                                  45690099
457000              , :SUAUPC-VND-STYL-DESC                             45700099
457100              , :SUAUPC-UPC-CLOR-DESC                             45710099
457200              , :SUAUPC-UPC-SIZE-DESC                             45720099
457300              , :SUAUPC-UPC-RTL-AMT                               45730099
457400              , :SUAUPC-UPC-CERTD-IND                             45740099
457500              , :SUAUPC-SCND-UNT-QTY                              45750099
457600              , :SUAUPC-SCN-TYP-CDE                               45760099
457700              , :SUAUPC-SKU-NBR                                   45770099
457800             )                                                    45780099
457900     END-EXEC.                                                    45790099
458000                                                                  45800099
458100     EVALUATE TRUE                                                45810099
458200         WHEN SQLCODE = ZERO                                      45820099
458300             MOVE SUAUPC-SCN-TMST        TO SU006-SCN-TMST        45830099
458400                                                                  45840099
458500         WHEN SQLCODE = -803                                      45850099
458600             CONTINUE                                             45860099
458700                                                                  45870099
458800         WHEN SQLWARN0 NOT = SPACES                               45880099
458900         WHEN SQLCODE < ZERO                                      45890099
459000         WHEN SQLCODE > ZERO                                      45900099
459100             MOVE '4200-CREATE-AUDIT-ROW'                         45910099
459200                                    TO DP013-PARAGRAPH            45920099
459300             MOVE 'INSERT TSUAUPC'  TO DP013-MESSAGE-TEXT(1)      45930099
459400             MOVE SUAUPC-AUD-CNTL-NBR                             45940099
459500                                    TO PV-DISP-AUD-CNTL-NBR       45950099
459600             MOVE SUAUPC-SHIPT-UNT-ID                             45960099
459700                                    TO PV-DISP-SHIPT-UNT-ID       45970099
459800             MOVE SUAUPC-UPC-NBR    TO PV-DISP-UPC-NBR            45980099
459900             MOVE SUAUPC-SCN-TMST   TO PV-DISP-SCN-TMST           45990099
460000             MOVE PV-DISPLAY-KEYS   TO DP013-MESSAGE-TEXT(2)      46000099
460100             MOVE SQLCA                  TO DP013-SQLCA           46010099
460200             MOVE 'TSUAUPC'         TO DP013-DB2-TABLE-NAME(1)    46020099
460300             SET DP013-DB2-ABEND         TO TRUE                  46030099
460400                                                                  46040099
460500             PERFORM 9999-WRITE-CICS-LOG-MSG                      46050099
460600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               46060099
460700             PERFORM 8100-SEND-DATA-ONLY                          46070099
460800             PERFORM 8200-RETURN-TRANID                           46080099
460900     END-EVALUATE.                                                46090099
461000                                                                  46100099
461100******************************************************************46110099
461200*   4220-TAG-SCAN-QUANTITY-RTN.                                  *46120099
461300* FOR NON COMBO AUDITS, RETRIEVE BOTH THE SCAN AND TAG QUANTITIES*46130099
461400* FROM TSUAUPC USING THE AUDIT CONTROL NUMBER.                   *46140099
461500******************************************************************46150099
461600 4220-TAG-SCAN-QUANTITY-RTN.                                      46160099
461700                                                                  46170099
461800     MOVE SU006-AUDIT-CNTL-NBR      TO DK-AUDIT-CNTL-NBR.         46180099
461900     MOVE SU006-SHIP-UNIT-NBR       TO DK-SHIP-UNIT-NBR.          46190099
462000     SET PS-NOT-EOC-SCAN-CURSOR     TO TRUE.                      46200099
462100     SET PS-NO-OVER-SHORT-ERROR     TO TRUE.                      46210099
462200                                                                  46220099
462300     PERFORM 4800-OPEN-TAG-SCAN-CURSOR.                           46230099
462400     PERFORM 4830-FETCH-TAG-SCAN-CURSOR.                          46240099
462500                                                                  46250099
462600     PERFORM                                                      46260099
462700        UNTIL PS-EOC-SCAN-CURSOR                                  46270099
462800           OR PS-OVER-SHORT-ERROR                                 46280099
462900                                                                  46290099
463000         PERFORM 4190-CHECK-RFID-RTN                              46300099
463100         PERFORM 4830-FETCH-TAG-SCAN-CURSOR                       46310099
463200                                                                  46320099
463300     END-PERFORM.                                                 46330099
463400     PERFORM 4860-CLOSE-TAG-SCAN-CURSOR.                          46340099
463500                                                                  46350099
463600******************************************************************46360099
463700*   4240-OTHER-QUANTITY-RTN.                                     *46370099
463800* FOR COMBO AUDITS, RETRIEVE THE SCAN QTY AND TAGGED QTY         *46380099
463900* FROM TSUAUPC USING THE RF AUDIT CONTROL NUMBER.                *46390099
464000******************************************************************46400099
464100 4240-OTHER-QUANTITY-RTN.                                         46410099
464200                                                                  46420099
464300     MOVE SU006-SHIP-UNIT-NBR       TO DK-SHIP-UNIT-NBR.          46430099
464400     MOVE SU006-RFID-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.         46440099
464500     SET PS-NOT-EOC-SCAN-CURSOR     TO TRUE.                      46450099
464600     SET PS-NO-OVER-SHORT-ERROR     TO TRUE.                      46460099
464700                                                                  46470099
464800     PERFORM 4800-OPEN-TAG-SCAN-CURSOR.                           46480099
464900     PERFORM 4830-FETCH-TAG-SCAN-CURSOR.                          46490099
465000                                                                  46500099
465100     PERFORM                                                      46510099
465200        UNTIL PS-EOC-SCAN-CURSOR                                  46520099
465300           OR PS-OVER-SHORT-ERROR                                 46530099
465400                                                                  46540099
465500         PERFORM 4190-CHECK-RFID-RTN                              46550099
465600         PERFORM 4830-FETCH-TAG-SCAN-CURSOR                       46560099
465700                                                                  46570099
465800     END-PERFORM.                                                 46580099
465900                                                                  46590099
466000     PERFORM 4860-CLOSE-TAG-SCAN-CURSOR.                          46600099
466100                                                                  46610099
466200******************************************************************46620099
466300*   4300-CREATE-EXCEPTION                                        *46630099
466400* CREATE THE APPROPRIATE EXCEPTION..........                     *46640099
466500******************************************************************46650099
466600 4300-CREATE-EXCEPTION.                                           46660099
466700                                                                  46670099
466800*    IF THIS IS THE FIRST AUDIT PROCESSED IT SHOULD BE A QC AUDIT 46680099
466900*    AND WE WANT TO PROCESS USING THE QC AUDIT NUMBER.  IF THIS IS46690099
467000*    AN RFID ONLY AUDIT, THEN THE RFID AUDIT NUMBER WILL BE       46700099
467100*    CONTAINED IN THIS FIELD AND WE WANT TO USE IT.  IF NEITHER,  46710099
467200*    THEN IT'S A COMBINED AUDIT AND THE RFID AUDIT SHOULD PROCESS 46720099
467300*    SECOND IN THIS SCENARIO.                                     46730099
467400     IF PS-PRCS-FIRST-AUDIT                                       46740099
467500     OR SU006-RFID-AUD-ONLY                                       46750099
467600     OR SU006-MANUAL-GENERATED-AUDIT                              46760099
467700         MOVE SU006-AUDIT-CNTL-NBR   TO SUEXCP-AUD-CNTL-NBR       46770099
467800     ELSE                                                         46780099
467900         MOVE SU006-RFID-AUDIT-CNTL-NBR                           46790099
468000                                     TO SUEXCP-AUD-CNTL-NBR       46800099
468100     END-IF.                                                      46810099
468200                                                                  46820099
468300     MOVE SU006-SHIP-UNIT-NBR        TO SUEXCP-SHIPT-UNT-ID.      46830099
468400     MOVE SU006-SCN-TMST             TO SUEXCP-SCN-TMST.          46840099
468500     MOVE PV-CARTON-UPC-NBR          TO SUEXCP-UPC-NBR.           46850099
468600     MOVE 'VA'                       TO SUEXCP-VILN-GP-CDE.       46860099
468700     MOVE SPACES                     TO SUEXCP-OVRRID-SYS-DAT-TXT.46870099
468800                                                                  46880099
468900     EXEC SQL                                                     46890099
469000         INSERT  INTO  TSUEXCP                                    46900099
469100                (AUD_CNTL_NBR                                     46910099
469200               , SHIPT_UNT_ID                                     46920099
469300               , UPC_NBR                                          46930099
469400               , SCN_TMST                                         46940099
469500               , VILN_GP_CDE                                      46950099
469600               , VILN_GP_SEQ_NBR                                  46960099
469700               , OVRRID_SYS_DAT_TXT)                              46970099
469800         VALUES                                                   46980099
469900             (                                                    46990099
470000                :SUEXCP-AUD-CNTL-NBR                              47000099
470100              , :SUEXCP-SHIPT-UNT-ID                              47010099
470200              , :SUEXCP-UPC-NBR                                   47020099
470300              , :SUEXCP-SCN-TMST                                  47030099
470400              , :SUEXCP-VILN-GP-CDE                               47040099
470500              , :SUEXCP-VILN-GP-SEQ-NBR                           47050099
470600              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       47060099
470700     END-EXEC.                                                    47070099
470800                                                                  47080099
470900     EVALUATE TRUE                                                47090099
471000         WHEN SQLCODE = ZERO                                      47100099
471100             CONTINUE                                             47110099
471200                                                                  47120099
471300         WHEN SQLWARN0 NOT = SPACES                               47130099
471400         WHEN SQLCODE < ZERO                                      47140099
471500         WHEN SQLCODE > ZERO                                      47150099
471600             MOVE '4300-CREATE-EXCEPTION'                         47160099
471700                 TO DP013-PARAGRAPH                               47170099
471800             MOVE 'INSERT TO TSUEXCP TABLE'                       47180099
471900                 TO DP013-MESSAGE-TEXT (1)                        47190099
472000             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(2) 47200099
472100             MOVE SQLCA                  TO DP013-SQLCA           47210099
472200             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME(1) 47220099
472300             SET DP013-DB2-ABEND         TO TRUE                  47230099
472400                                                                  47240099
472500             PERFORM 9999-WRITE-CICS-LOG-MSG                      47250099
472600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               47260099
472700             PERFORM 8100-SEND-DATA-ONLY                          47270099
472800             PERFORM 8200-RETURN-TRANID                           47280099
472900     END-EVALUATE.                                                47290099
473000                                                                  47300099
473100******************************************************************47310099
473200 4400-DETERMINE-UPC.                                              47320099
473300                                                                  47330099
473400     PERFORM 4500-OPEN-CARTON-UPC-CURSOR.                         47340099
473500     PERFORM 4530-FETCH-CARTON-UPC-CURSOR.                        47350099
473600                                                                  47360099
473700     PERFORM 4600-OPEN-AUDIT-UPC-CURSOR.                          47370099
473800     PERFORM 4630-FETCH-AUDIT-UPC-CURSOR.                         47380099
473900                                                                  47390099
474000     PERFORM UNTIL PS-EOC-CARTON-UPC-CURSOR                       47400099
474100                OR PV-SCND-UNT-QTY = 0                            47410099
474200                                                                  47420099
474300         IF PV-AUDIT-UPC-NBR  =  PV-CARTON-UPC-NBR                47430099
474400         AND PV-AUDIT-SHPD-QTY = PV-CARTON-SHPD-QTY               47440099
474500             PERFORM 4530-FETCH-CARTON-UPC-CURSOR                 47450099
474600             PERFORM 4630-FETCH-AUDIT-UPC-CURSOR                  47460099
474700         ELSE                                                     47470099
474800             IF PV-AUDIT-UPC-NBR  =  PV-CARTON-UPC-NBR            47480099
474900             AND PV-CARTON-SHPD-QTY NOT = PV-AUDIT-SHPD-QTY       47490099
475000                 IF SUEXCP-VILN-GP-SEQ-NBR  = 30 AND              47500099
475100                    PV-CARTON-SHPD-QTY > PV-AUDIT-SHPD-QTY        47510099
475200                     COMPUTE SUAUPC-SCND-UNT-QTY =                47520099
475300                        PV-CARTON-SHPD-QTY - PV-AUDIT-SHPD-QTY    47530099
475400                     IF SUAUPC-SCND-UNT-QTY > PV-SCND-UNT-QTY     47540099
475500                         MOVE PV-SCND-UNT-QTY TO                  47550099
475600                                              SUAUPC-SCND-UNT-QTY 47560099
475700                         MOVE 0       TO PV-SCND-UNT-QTY          47570099
475800                     ELSE                                         47580099
475900                         COMPUTE PV-SCND-UNT-QTY =                47590099
476000                             PV-SCND-UNT-QTY - SUAUPC-SCND-UNT-QTY47600099
476100                     END-IF                                       47610099
476200                     PERFORM 5000-SELECT-TUPC-BY-UPC-NBR          47620099
476300                     PERFORM 4200-CREATE-AUDIT-ROW                47630099
476400                     PERFORM 4300-CREATE-EXCEPTION                47640099
476500                 ELSE                                             47650099
476600                 IF SUEXCP-VILN-GP-SEQ-NBR  = 29 AND              47660099
476700                    PV-CARTON-SHPD-QTY < PV-AUDIT-SHPD-QTY        47670099
476800                     COMPUTE SUAUPC-SCND-UNT-QTY =                47680099
476900                        PV-AUDIT-SHPD-QTY - PV-CARTON-SHPD-QTY    47690099
477000                     IF SUAUPC-SCND-UNT-QTY > PV-SCND-UNT-QTY     47700099
477100                         MOVE PV-SCND-UNT-QTY TO                  47710099
477200                                              SUAUPC-SCND-UNT-QTY 47720099
477300                         MOVE 0       TO PV-SCND-UNT-QTY          47730099
477400                     ELSE                                         47740099
477500                         COMPUTE PV-SCND-UNT-QTY =                47750099
477600                             PV-SCND-UNT-QTY - SUAUPC-SCND-UNT-QTY47760099
477700                     END-IF                                       47770099
477800                     PERFORM 5000-SELECT-TUPC-BY-UPC-NBR          47780099
477900                     PERFORM 4200-CREATE-AUDIT-ROW                47790099
478000                     PERFORM 4300-CREATE-EXCEPTION                47800099
478100                 END-IF                                           47810099
478200                 END-IF                                           47820099
478300                 PERFORM 4530-FETCH-CARTON-UPC-CURSOR             47830099
478400                 PERFORM 4630-FETCH-AUDIT-UPC-CURSOR              47840099
478500             ELSE                                                 47850099
478600             IF  PV-AUDIT-UPC-NBR  >  PV-CARTON-UPC-NBR           47860099
478700                 IF PV-CARTON-SHPD-QTY > PV-SCND-UNT-QTY          47870099
478800                     MOVE PV-SCND-UNT-QTY   TO SUAUPC-SCND-UNT-QTY47880099
478900                 ELSE                                             47890099
479000                     MOVE PV-CARTON-SHPD-QTY                      47900099
479100                                            TO SUAUPC-SCND-UNT-QTY47910099
479200                 END-IF                                           47920099
479300                 COMPUTE PV-SCND-UNT-QTY =                        47930099
479400                     PV-SCND-UNT-QTY - SUAUPC-SCND-UNT-QTY        47940099
479500                 PERFORM 5000-SELECT-TUPC-BY-UPC-NBR              47950099
479600                 PERFORM 4200-CREATE-AUDIT-ROW                    47960099
479700                 PERFORM 4300-CREATE-EXCEPTION                    47970099
479800                 PERFORM 4530-FETCH-CARTON-UPC-CURSOR             47980099
479900             ELSE                                                 47990099
480000                 PERFORM 4630-FETCH-AUDIT-UPC-CURSOR              48000099
480100             END-IF                                               48010099
480200             END-IF                                               48020099
480300         END-IF                                                   48030099
480400                                                                  48040099
480500     END-PERFORM.                                                 48050099
480600                                                                  48060099
480700     PERFORM 4560-CLOSE-CARTON-UPC-CURSOR.                        48070099
480800     PERFORM 4660-CLOSE-AUDIT-UPC-CURSOR.                         48080099
480900                                                                  48090099
481000******************************************************************48100099
481100 4500-OPEN-CARTON-UPC-CURSOR.                                     48110099
481200                                                                  48120099
481300     EXEC SQL                                                     48130099
481400         OPEN CARTON_UPC_CURSOR                                   48140099
481500     END-EXEC.                                                    48150099
481600                                                                  48160099
481700     EVALUATE TRUE                                                48170099
481800         WHEN SQLCODE = ZERO                                      48180099
481900             SET PS-NOT-EOC-CARTON-UPC-CURSOR                     48190099
482000                                   TO TRUE                        48200099
482100                                                                  48210099
482200         WHEN SQLWARN0 NOT = SPACES                               48220099
482300         WHEN SQLCODE < ZERO                                      48230099
482400         WHEN SQLCODE > ZERO                                      48240099
482500             MOVE '4500-OPEN-CARTON-UPC-CURSOR'                   48250099
482600                                   TO DP013-PARAGRAPH             48260099
482700             MOVE 'OPEN CARTON_UPC_CURSOR'                        48270099
482800                                   TO DP013-MESSAGE-TEXT (1)      48280099
482900             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   48290099
483000             MOVE PV-EXPECT-INTR-UPC                              48300099
483100                                   TO PV-INTR-UPC                 48310099
483200             MOVE PV-INTR-UPC      TO DP013-MESSAGE-TEXT (3)      48320099
483300             MOVE SQLCA            TO DP013-SQLCA                 48330099
483400             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    48340099
483500             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    48350099
483600             SET DP013-DB2-ABEND   TO TRUE                        48360099
483700                                                                  48370099
483800             PERFORM 9999-WRITE-CICS-LOG-MSG                      48380099
483900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               48390099
484000             PERFORM 8100-SEND-DATA-ONLY                          48400099
484100             PERFORM 8200-RETURN-TRANID                           48410099
484200     END-EVALUATE.                                                48420099
484300                                                                  48430099
484400******************************************************************48440099
484500 4530-FETCH-CARTON-UPC-CURSOR.                                    48450099
484600                                                                  48460099
484700     EXEC SQL                                                     48470099
484800         FETCH CARTON_UPC_CURSOR                                  48480099
484900         INTO    :PV-CARTON-UPC-NBR                               48490099
485000              ,  :PV-CARTON-SHPD-QTY                              48500099
485100     END-EXEC.                                                    48510099
485200                                                                  48520099
485300     EVALUATE TRUE                                                48530099
485400         WHEN SQLCODE = ZERO                                      48540099
485500             CONTINUE                                             48550099
485600                                                                  48560099
485700         WHEN SQLCODE = +100                                      48570099
485800             SET PS-EOC-CARTON-UPC-CURSOR   TO TRUE               48580099
485900                                                                  48590099
486000         WHEN SQLWARN0 NOT = SPACES                               48600099
486100         WHEN SQLCODE < ZERO                                      48610099
486200         WHEN SQLCODE > ZERO                                      48620099
486300             MOVE '4530-FETCH-CARTON-UPC-CURSOR'                  48630099
486400                                   TO DP013-PARAGRAPH             48640099
486500             MOVE 'FETCH OF CARTON_UPC_CURSOR'                    48650099
486600                                   TO DP013-MESSAGE-TEXT (1)      48660099
486700             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   48670099
486800             MOVE PV-EXPECT-INTR-UPC                              48680099
486900                                   TO PV-INTR-UPC                 48690099
487000             MOVE PV-INTR-UPC      TO DP013-MESSAGE-TEXT (3)      48700099
487100             MOVE SQLCA            TO DP013-SQLCA                 48710099
487200             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    48720099
487300             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    48730099
487400             SET DP013-DB2-ABEND   TO TRUE                        48740099
487500                                                                  48750099
487600             PERFORM 9999-WRITE-CICS-LOG-MSG                      48760099
487700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               48770099
487800             PERFORM 8100-SEND-DATA-ONLY                          48780099
487900             PERFORM 8200-RETURN-TRANID                           48790099
488000     END-EVALUATE.                                                48800099
488100                                                                  48810099
488200******************************************************************48820099
488300 4560-CLOSE-CARTON-UPC-CURSOR.                                    48830099
488400                                                                  48840099
488500     EXEC SQL                                                     48850099
488600         CLOSE CARTON_UPC_CURSOR                                  48860099
488700     END-EXEC.                                                    48870099
488800                                                                  48880099
488900     EVALUATE TRUE                                                48890099
489000         WHEN SQLCODE = ZERO                                      48900099
489100             CONTINUE                                             48910099
489200                                                                  48920099
489300         WHEN SQLWARN0 NOT = SPACES                               48930099
489400         WHEN SQLCODE < ZERO                                      48940099
489500         WHEN SQLCODE > ZERO                                      48950099
489600             MOVE '4560-CLOSE-CARTON-UPC-CURSOR'                  48960099
489700                                   TO DP013-PARAGRAPH             48970099
489800             MOVE 'CLOSE OF CARTON_UPC_CURSOR'                    48980099
489900                                   TO DP013-MESSAGE-TEXT (1)      48990099
490000             MOVE SU006-SHIP-UNIT-NBR TO DP013-MESSAGE-TEXT (2)   49000099
490100             MOVE PV-EXPECT-INTR-UPC                              49010099
490200                                   TO PV-INTR-UPC                 49020099
490300             MOVE PV-INTR-UPC      TO DP013-MESSAGE-TEXT (3)      49030099
490400             MOVE SQLCA            TO DP013-SQLCA                 49040099
490500             MOVE 'TSHUUPC'        TO DP013-DB2-TABLE-NAME (1)    49050099
490600             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    49060099
490700             SET DP013-DB2-ABEND   TO TRUE                        49070099
490800                                                                  49080099
490900             PERFORM 9999-WRITE-CICS-LOG-MSG                      49090099
491000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               49100099
491100             PERFORM 8100-SEND-DATA-ONLY                          49110099
491200             PERFORM 8200-RETURN-TRANID                           49120099
491300     END-EVALUATE.                                                49130099
491400                                                                  49140099
491500******************************************************************49150099
491600 4600-OPEN-AUDIT-UPC-CURSOR.                                      49160099
491700                                                                  49170099
491800     EXEC SQL                                                     49180099
491900         OPEN AUDIT_UPC_CURSOR                                    49190099
492000     END-EXEC.                                                    49200099
492100                                                                  49210099
492200     EVALUATE TRUE                                                49220099
492300         WHEN SQLCODE = ZERO                                      49230099
492400             SET PS-NOT-EOC-AUDIT-UPC-CURSOR                      49240099
492500                                   TO TRUE                        49250099
492600                                                                  49260099
492700         WHEN SQLWARN0 NOT = SPACES                               49270099
492800         WHEN SQLCODE < ZERO                                      49280099
492900         WHEN SQLCODE > ZERO                                      49290099
493000             MOVE '4600-OPEN-AUDIT-UPC-CURSOR'                    49300099
493100                                   TO DP013-PARAGRAPH             49310099
493200             MOVE 'OPEN AUDIT_UPC_CURSOR'                         49320099
493300                                   TO DP013-MESSAGE-TEXT (1)      49330099
493400             MOVE SU006-AUDIT-CNTL-NBR-X                          49340099
493500                                   TO DP013-MESSAGE-TEXT (1)      49350099
493600             MOVE SU006-SHIP-UNIT-NBR-X                           49360099
493700                                   TO DP013-MESSAGE-TEXT (2)      49370099
493800             MOVE SQLCA            TO DP013-SQLCA                 49380099
493900             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    49390099
494000             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    49400099
494100             SET DP013-DB2-ABEND   TO TRUE                        49410099
494200                                                                  49420099
494300             PERFORM 9999-WRITE-CICS-LOG-MSG                      49430099
494400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               49440099
494500             PERFORM 8100-SEND-DATA-ONLY                          49450099
494600             PERFORM 8200-RETURN-TRANID                           49460099
494700     END-EVALUATE.                                                49470099
494800                                                                  49480099
494900******************************************************************49490099
495000 4630-FETCH-AUDIT-UPC-CURSOR.                                     49500099
495100                                                                  49510099
495200     EXEC SQL                                                     49520099
495300         FETCH AUDIT_UPC_CURSOR                                   49530099
495400         INTO    :PV-AUDIT-UPC-NBR                                49540099
495500              ,  :PV-AUDIT-SHPD-QTY                               49550099
495600     END-EXEC.                                                    49560099
495700                                                                  49570099
495800     EVALUATE TRUE                                                49580099
495900         WHEN SQLCODE = ZERO                                      49590099
496000             CONTINUE                                             49600099
496100                                                                  49610099
496200         WHEN SQLCODE = +100                                      49620099
496300             SET PS-EOC-AUDIT-UPC-CURSOR    TO TRUE               49630099
496400             MOVE 999999999999999 TO PV-AUDIT-UPC-NBR             49640099
496500             MOVE 0               TO PV-AUDIT-SHPD-QTY            49650099
496600                                                                  49660099
496700         WHEN SQLWARN0 NOT = SPACES                               49670099
496800         WHEN SQLCODE < ZERO                                      49680099
496900         WHEN SQLCODE > ZERO                                      49690099
497000             MOVE '4630-FETCH-AUDIT-UPC-CURSOR'                   49700099
497100                                   TO DP013-PARAGRAPH             49710099
497200             MOVE 'FETCH OF AUDIT_UPC_CURSOR'                     49720099
497300                                   TO DP013-MESSAGE-TEXT (1)      49730099
497400             MOVE SU006-AUDIT-CNTL-NBR-X                          49740099
497500                                   TO DP013-MESSAGE-TEXT (1)      49750099
497600             MOVE SU006-SHIP-UNIT-NBR-X                           49760099
497700                                   TO DP013-MESSAGE-TEXT (2)      49770099
497800             MOVE SQLCA            TO DP013-SQLCA                 49780099
497900             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    49790099
498000             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    49800099
498100             SET DP013-DB2-ABEND   TO TRUE                        49810099
498200                                                                  49820099
498300             PERFORM 9999-WRITE-CICS-LOG-MSG                      49830099
498400             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               49840099
498500             PERFORM 8100-SEND-DATA-ONLY                          49850099
498600             PERFORM 8200-RETURN-TRANID                           49860099
498700     END-EVALUATE.                                                49870099
498800                                                                  49880099
498900******************************************************************49890099
499000 4660-CLOSE-AUDIT-UPC-CURSOR.                                     49900099
499100                                                                  49910099
499200     EXEC SQL                                                     49920099
499300         CLOSE AUDIT_UPC_CURSOR                                   49930099
499400     END-EXEC.                                                    49940099
499500                                                                  49950099
499600     EVALUATE TRUE                                                49960099
499700         WHEN SQLCODE = ZERO                                      49970099
499800             CONTINUE                                             49980099
499900                                                                  49990099
500000         WHEN SQLWARN0 NOT = SPACES                               50000099
500100         WHEN SQLCODE < ZERO                                      50010099
500200         WHEN SQLCODE > ZERO                                      50020099
500300             MOVE '4660-CLOSE-AUDIT-UPC-CURSOR'                   50030099
500400                                   TO DP013-PARAGRAPH             50040099
500500             MOVE 'CLOSE OF AUDIT_UPC_CURSOR'                     50050099
500600                                   TO DP013-MESSAGE-TEXT (1)      50060099
500700             MOVE SU006-AUDIT-CNTL-NBR-X                          50070099
500800                                   TO DP013-MESSAGE-TEXT (1)      50080099
500900             MOVE SU006-SHIP-UNIT-NBR-X                           50090099
501000                                   TO DP013-MESSAGE-TEXT (2)      50100099
501100             MOVE SQLCA            TO DP013-SQLCA                 50110099
501200             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    50120099
501300             MOVE 'XLT_UPC '       TO DP013-DB2-TABLE-NAME (2)    50130099
501400             SET DP013-DB2-ABEND   TO TRUE                        50140099
501500                                                                  50150099
501600             PERFORM 9999-WRITE-CICS-LOG-MSG                      50160099
501700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               50170099
501800             PERFORM 8100-SEND-DATA-ONLY                          50180099
501900             PERFORM 8200-RETURN-TRANID                           50190099
502000     END-EVALUATE.                                                50200099
502100                                                                  50210099
502200******************************************************************50220099
502300 4700-XCTL-TO-HELP.                                               50230099
502400                                                                  50240099
502500     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      50250099
502600     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    50260099
502700     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    50270099
502800                                                                  50280099
502900     EXEC CICS                                                    50290099
503000         XCTL                                                     50300099
503100             PROGRAM   (PV-TRANSFER-PROGRAM)                      50310099
503200             COMMAREA  (PC192-COMMAREA)                           50320099
503300             LENGTH    (PV-COMMAREA-LENGTH)                       50330099
503400             RESP      (PV-CICS-RESPONSE)                         50340099
503500     END-EXEC.                                                    50350099
503600                                                                  50360099
503700     EVALUATE TRUE                                                50370099
503800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 50380099
503900              CONTINUE                                            50390099
504000                                                                  50400099
504100         WHEN OTHER                                               50410099
504200             MOVE '4700-XCTL-TO-HELP '                            50420099
504300                 TO DP013-PARAGRAPH                               50430099
504400             MOVE 'SUKRF512 - UNABLE TO XCTL TO PROGRAM: '        50440099
504500                 TO DP013-MESSAGE-TEXT (1)                        50450099
504600             MOVE PV-TRANSFER-PROGRAM                             50460099
504700                 TO DP013-MESSAGE-TEXT (2)                        50470099
504800             SET DP013-CICS-ABEND  TO TRUE                        50480099
504900             SET DP013-ROLLBACK TO TRUE                           50490099
505000             PERFORM 9999-WRITE-CICS-LOG-MSG                      50500099
505100             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             50510099
505200             SET SU006-PROCESS-SCREEN TO TRUE                     50520099
505300             PERFORM 8000-SEND-MAP                                50530099
505400             PERFORM 8200-RETURN-TRANID                           50540099
505500     END-EVALUATE.                                                50550099
505600                                                                  50560099
505700******************************************************************50570099
505800 4800-OPEN-TAG-SCAN-CURSOR.                                       50580099
505900                                                                  50590099
506000     EXEC SQL                                                     50600099
506100         OPEN RFTAG_SCAN_CURSOR                                   50610099
506200     END-EXEC.                                                    50620099
506300                                                                  50630099
506400     EVALUATE TRUE                                                50640099
506500         WHEN SQLCODE = ZERO                                      50650099
506600             SET PS-NOT-EOC-SCAN-CURSOR  TO TRUE                  50660099
506700                                                                  50670099
506800         WHEN SQLWARN0 NOT = SPACES                               50680099
506900         WHEN SQLCODE < ZERO                                      50690099
507000         WHEN SQLCODE > ZERO                                      50700099
507100             MOVE '4800-OPEN-TAG-SCAN-CURSOR'                     50710099
507200                                   TO DP013-PARAGRAPH             50720099
507300             MOVE 'OPEN RFTAG_SCAN_CURSOR'                        50730099
507400                                   TO DP013-MESSAGE-TEXT (1)      50740099
507500             MOVE DK-AUDIT-CNTL-NBR                               50750099
507600                                   TO DK-AUDIT-CNTL-NBR-X         50760099
507700             MOVE DK-AUDIT-CNTL-NBR-X                             50770099
507800                                   TO DP013-MESSAGE-TEXT (2)      50780099
507900             MOVE SU006-SHIP-UNIT-NBR-X                           50790099
508000                                   TO DP013-MESSAGE-TEXT (3)      50800099
508100             MOVE SQLCA            TO DP013-SQLCA                 50810099
508200             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    50820099
508300             SET DP013-DB2-ABEND   TO TRUE                        50830099
508400                                                                  50840099
508500             PERFORM 9999-WRITE-CICS-LOG-MSG                      50850099
508600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               50860099
508700             PERFORM 8100-SEND-DATA-ONLY                          50870099
508800             PERFORM 8200-RETURN-TRANID                           50880099
508900     END-EVALUATE.                                                50890099
509000                                                                  50900099
509100******************************************************************50910099
509200 4830-FETCH-TAG-SCAN-CURSOR.                                      50920099
509300                                                                  50930099
509400     EXEC SQL                                                     50940099
509500         FETCH RFTAG_SCAN_CURSOR                                  50950099
509600         INTO   :PV-COMP-UPC-NBR                                  50960099
509700               ,:PV-COMP-SCAN-QTY                                 50970099
509800               ,:PV-COMP-TAG-QTY                                  50980099
509900     END-EXEC.                                                    50990099
510000                                                                  51000099
510100     EVALUATE TRUE                                                51010099
510200         WHEN SQLCODE = ZERO                                      51020099
510300             CONTINUE                                             51030099
510400                                                                  51040099
510500         WHEN SQLCODE = +100                                      51050099
510600             SET PS-EOC-SCAN-CURSOR TO TRUE                       51060099
510700                                                                  51070099
510800         WHEN SQLWARN0 NOT = SPACES                               51080099
510900         WHEN SQLCODE < ZERO                                      51090099
511000         WHEN SQLCODE > ZERO                                      51100099
511100             MOVE '4830-FETCH-TAG-SCAN-CURSOR'                    51110099
511200                                   TO DP013-PARAGRAPH             51120099
511300             MOVE 'FETCH OF RFTAG_SCAN_CURSOR'                    51130099
511400                                   TO DP013-MESSAGE-TEXT (1)      51140099
511500             MOVE DK-AUDIT-CNTL-NBR                               51150099
511600                                   TO DK-AUDIT-CNTL-NBR-X         51160099
511700             MOVE DK-AUDIT-CNTL-NBR-X                             51170099
511800                                   TO DP013-MESSAGE-TEXT (2)      51180099
511900             MOVE SU006-SHIP-UNIT-NBR-X                           51190099
512000                                   TO DP013-MESSAGE-TEXT (3)      51200099
512100             MOVE SQLCA            TO DP013-SQLCA                 51210099
512200             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    51220099
512300             SET DP013-DB2-ABEND   TO TRUE                        51230099
512400***          SET DP013-NO-ROLLBACK TO TRUE                        51240099
512500             PERFORM 9999-WRITE-CICS-LOG-MSG                      51250099
512600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               51260099
512700             PERFORM 8100-SEND-DATA-ONLY                          51270099
512800             PERFORM 8200-RETURN-TRANID                           51280099
512900     END-EVALUATE.                                                51290099
513000                                                                  51300099
513100******************************************************************51310099
513200 4860-CLOSE-TAG-SCAN-CURSOR.                                      51320099
513300                                                                  51330099
513400     EXEC SQL                                                     51340099
513500         CLOSE RFTAG_SCAN_CURSOR                                  51350099
513600     END-EXEC.                                                    51360099
513700                                                                  51370099
513800     EVALUATE TRUE                                                51380099
513900         WHEN SQLCODE = ZERO                                      51390099
514000             CONTINUE                                             51400099
514100                                                                  51410099
514200         WHEN SQLWARN0 NOT = SPACES                               51420099
514300         WHEN SQLCODE < ZERO                                      51430099
514400         WHEN SQLCODE > ZERO                                      51440099
514500             MOVE '4860-CLOSE-TAG-SCAN-CURSOR'                    51450099
514600                                   TO DP013-PARAGRAPH             51460099
514700             MOVE 'CLOSE OF RFTAG_SCAN_CURSOR'                    51470099
514800                                   TO DP013-MESSAGE-TEXT (1)      51480099
514900             MOVE DK-AUDIT-CNTL-NBR                               51490099
515000                                   TO DK-AUDIT-CNTL-NBR-X         51500099
515100             MOVE DK-AUDIT-CNTL-NBR-X                             51510099
515200                                   TO DP013-MESSAGE-TEXT (2)      51520099
515300             MOVE SU006-SHIP-UNIT-NBR-X                           51530099
515400                                   TO DP013-MESSAGE-TEXT (3)      51540099
515500             MOVE SQLCA            TO DP013-SQLCA                 51550099
515600             MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME (1)    51560099
515700             SET DP013-DB2-ABEND   TO TRUE                        51570099
515800                                                                  51580099
515900             PERFORM 9999-WRITE-CICS-LOG-MSG                      51590099
516000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               51600099
516100             PERFORM 8100-SEND-DATA-ONLY                          51610099
516200             PERFORM 8200-RETURN-TRANID                           51620099
516300     END-EVALUATE.                                                51630099
516400                                                                  51640099
516500******************************************************************51650099
516600 5000-SELECT-TUPC-BY-UPC-NBR.                                     51660099
516700                                                                  51670099
516800     INITIALIZE XL001-ITEM-COMMAREA.                              51680099
516900                                                                  51690099
517000     MOVE PV-CARTON-UPC-NBR     TO XL001-KEY-UPC-NBR.             51700099
517100                                                                  51710099
517200     SET  XL001-BY-UPC-NBR                                        51720099
517300          XL001-SELECT-SKU                                        51730099
517400          XL001-SELECT-SKU-STR                                    51740099
517500          XL001-SELECT-VND-STYL TO TRUE.                          51750099
517600                                                                  51760099
517700     CALL XL001-VSM-PGM USING  DFHEIBLK                           51770099
517800                               XL001-COMMAREA                     51780099
517900                               XL001-ITEM-COMMAREA.               51790099
518000     EVALUATE TRUE                                                51800099
518100                                                                  51810099
518200         WHEN XL001-SKU-SQLCODE = +0                              51820099
518300             MOVE XL001-CSTM-CLOR-DESC TO SUAUPC-UPC-CLOR-DESC    51830099
518400             MOVE XL001-SKU-NBR       TO SUAUPC-SKU-NBR           51840099
518500             MOVE XL001-SKU-DESC      TO SUAUPC-ITM-DESC          51850099
518600             MOVE XL001-UNT-RTL-AMT   TO SUAUPC-UPC-RTL-AMT       51860099
518700             MOVE XL001-VS-NBR        TO SUAUPC-VND-STYL-DESC     51870099
518800             MOVE XL001-SIZE-DESC     TO SUAUPC-UPC-SIZE-DESC     51880099
518900             MOVE XL001-DEPT-NBR      TO SUAUPC-DEPT-NBR          51890099
519000             MOVE XL001-MAJ-CL-NBR    TO SUAUPC-MAJ-CL-NBR        51900099
519100             MOVE XL001-SUB-CL-NBR    TO SUAUPC-SUB-CL-NBR        51910099
519200                                                                  51920099
519800         WHEN OTHER                                               51980099
519900             PERFORM 9999-WRITE-CICS-LOG-MSG                      51990099
520000             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               52000099
520100             PERFORM 8100-SEND-DATA-ONLY                          52010099
520200             PERFORM 8200-RETURN-TRANID                           52020099
520300     END-EVALUATE.                                                52030099
520400                                                                  52040099
520500******************************************************************52050099
520600*  8000-SEND-MAP                                                 *52060099
520700*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *52070099
520800******************************************************************52080099
520900 8000-SEND-MAP.                                                   52090099
521000                                                                  52100099
521100     EXEC CICS                                                    52110099
521200         SEND                                                     52120099
521300             MAP     ('SU512A')                                   52130099
521400             MAPSET  ('SUKM512')                                  52140099
521500             ERASE                                                52150099
521600             RESP    (PV-CICS-RESPONSE)                           52160099
521700     END-EXEC.                                                    52170099
521800                                                                  52180099
521900     EVALUATE TRUE                                                52190099
522000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 52200099
522100             CONTINUE                                             52210099
522200                                                                  52220099
522300         WHEN OTHER                                               52230099
522400             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            52240099
522500             MOVE 'UNABLE TO SEND MAP'                            52250099
522600                                    TO DP013-MESSAGE-TEXT (1)     52260099
522700             SET DP013-CICS-ABEND   TO TRUE                       52270099
522800             SET DP013-NO-ROLLBACK  TO TRUE                       52280099
522900             PERFORM 9999-WRITE-CICS-LOG-MSG                      52290099
523000     END-EVALUATE.                                                52300099
523100                                                                  52310099
523200******************************************************************52320099
523300 8100-SEND-DATA-ONLY.                                             52330099
523400                                                                  52340099
523500     MOVE -1                     TO ASELECTL.                     52350099
523600                                                                  52360099
523700     EXEC CICS                                                    52370099
523800         SEND                                                     52380099
523900             MAP       ('SU512A')                                 52390099
524000             MAPSET    ('SUKM512')                                52400099
524100             CURSOR                                               52410099
524200             DATAONLY                                             52420099
524300             RESP      (PV-CICS-RESPONSE)                         52430099
524400     END-EXEC.                                                    52440099
524500                                                                  52450099
524600     EVALUATE TRUE                                                52460099
524700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 52470099
524800             CONTINUE                                             52480099
524900                                                                  52490099
525000         WHEN OTHER                                               52500099
525100             MOVE '8100-SEND-DATA-ONLY'                           52510099
525200                                    TO DP013-PARAGRAPH            52520099
525300             MOVE 'UNABLE TO SEND DATA'                           52530099
525400                                    TO DP013-MESSAGE-TEXT (1)     52540099
525500             SET DP013-CICS-ABEND   TO TRUE                       52550099
525600                                                                  52560099
525700             PERFORM 9999-WRITE-CICS-LOG-MSG                      52570099
525800     END-EVALUATE.                                                52580099
525900                                                                  52590099
526000******************************************************************52600099
526100 8200-RETURN-TRANID.                                              52610099
526200                                                                  52620099
526300     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          52630099
526400                                                                  52640099
526500     EXEC CICS                                                    52650099
526600         RETURN                                                   52660099
526700             TRANSID   (PC-CURRENT-TRANID)                        52670099
526800             COMMAREA  (CA-COMMAREA)                              52680099
526900             LENGTH    (PV-COMMAREA-LENGTH)                       52690099
527000             RESP      (PV-CICS-RESPONSE)                         52700099
527100     END-EXEC.                                                    52710099
527200                                                                  52720099
527300     EVALUATE TRUE                                                52730099
527400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 52740099
527500             CONTINUE                                             52750099
527600                                                                  52760099
527700         WHEN OTHER                                               52770099
527800             MOVE '8200-RETURN-TRANID'                            52780099
527900                                    TO DP013-PARAGRAPH            52790099
528000             MOVE 'UNABLE TO RETURN TO TRANID'                    52800099
528100                                    TO DP013-MESSAGE-TEXT (1)     52810099
528200             SET DP013-CICS-ABEND   TO TRUE                       52820099
528300                                                                  52830099
528400             PERFORM 9999-WRITE-CICS-LOG-MSG                      52840099
528500     END-EVALUATE.                                                52850099
528600                                                                  52860099
528700******************************************************************52870099
528800* QUEUE UP THE INTERNAL READER, SET-UP AND SEND THE JOB LINE     *52880099
528900* BY LINE UP TO THE SYMBOLIC INFO                                *52890099
529000******************************************************************52900099
529100 9000-SUBMIT-REQUEST-START.                                       52910099
529200                                                                  52920099
529300*    FIRE-UP THE INTERNAL READER                                  52930099
529400     PERFORM 9500-ENQUEUE-INTERNAL-READER.                        52940099
529500                                                                  52950099
529600*    SET-UP JOB DEPENDING ON THE REGION                           52960099
529700     IF CA-PROD-CICS                                              52970099
529800                                                                  52980099
529900          MOVE JL-JOB-LINE-PROD     TO  JL-JCL-LINE-1             52990099
530000          MOVE JL-JCL-LINE-1        TO TD-JCL-LINE                53000099
530100          PERFORM 9100-WRITE-TD-LINE                              53010099
530200                                                                  53020099
530300*         JOBPARM LINE                                            53030099
530400          MOVE JL-JCL-LINE-3        TO TD-JCL-LINE                53040099
530500          PERFORM 9100-WRITE-TD-LINE                              53050099
530600                                                                  53060099
530700*         JOBOUT LINE                                             53070099
530800          MOVE SU006-PRINTER-DEST   TO JL-LINE-13-PRINTER         53080099
530900          MOVE JL-JCL-LINE-13       TO TD-JCL-LINE                53090099
531000          PERFORM 9100-WRITE-TD-LINE                              53100099
531100                                                                  53110099
531200*         JOBLIB LINE                                             53120099
531300          MOVE JL-JCL-LINE-4-PROD   TO TD-JCL-LINE                53130099
531400          PERFORM 9100-WRITE-TD-LINE                              53140099
531500     ELSE                                                         53150099
531600          MOVE JL-JOB-LINE-TEST     TO  JL-JCL-LINE-1             53160099
531700          MOVE JL-JCL-LINE-1        TO TD-JCL-LINE                53170099
531800          PERFORM 9100-WRITE-TD-LINE                              53180099
531900                                                                  53190099
532000*         JOBOUT LINE                                             53200099
532100          MOVE SU006-PRINTER-DEST   TO JL-LINE-13-PRINTER         53210099
532200          MOVE JL-JCL-LINE-13       TO TD-JCL-LINE                53220099
532300          PERFORM 9100-WRITE-TD-LINE                              53230099
532400                                                                  53240099
532500*         JOBLIB LINE                                             53250099
532700          IF CA-QA-CICS                                           53270099
532800             MOVE JL-JCL-LINE-4-QA     TO TD-JCL-LINE             53280099
532900          ELSE                                                    53290099
533000             IF CA-LEARN-CICS                                     53300099
533100                MOVE JL-JCL-LINE-4-LEARN  TO TD-JCL-LINE          53310099
533200             ELSE                                                 53320099
533300                MOVE JL-JCL-LINE-4-TEST   TO TD-JCL-LINE          53330099
533400             END-IF                                               53340099
533500          END-IF                                                  53350099
533600          PERFORM 9100-WRITE-TD-LINE                              53360099
533700     END-IF.                                                      53370099
533800                                                                  53380099
533900*    EXEC PROC LINE                                               53390099
534000     MOVE JL-JCL-LINE-12 TO TD-JCL-LINE.                          53400099
534100     PERFORM 9100-WRITE-TD-LINE.                                  53410099
534200                                                                  53420099
534300******************************************************************53430099
534400* SEND ONE SYMBOLIC LINE                                         *53440099
534500******************************************************************53450099
534600 9050-SUBMIT-SYMBOLIC-LINE.                                       53460099
534700                                                                  53470099
534800*    SYMBOLIC REF LINE                                            53480099
534900     MOVE JL-SYSUT1-PARM-LINE   TO TD-JCL-LINE.                   53490099
535000     PERFORM 9100-WRITE-TD-LINE.                                  53500099
535100*    INSTREAM DATA LINE                                           53510099
535200     MOVE JL-SYSUT1-PARM-VALUE  TO TD-JCL-LINE.                   53520099
535300     PERFORM 9100-WRITE-TD-LINE.                                  53530099
535400                                                                  53540099
535500******************************************************************53550099
535600* SEND THE END OF PROC LINE, AND TURN OFF THE READER             *53560099
535700******************************************************************53570099
535800 9099-SUBMIT-REQUEST-STOP.                                        53580099
535900                                                                  53590099
536000*    SET-UP DEPENDING ON THE REGION                               53600099
536100*    IF CA-PROD-CICS  OR                                          53610099
536200*       CA-LEARN-CICS                                             53620099
536300*        AUTO SCHEDULE LINE                                       53630099
536400*        MOVE JL-JCL-LINE-AUTO-SCHD TO TD-JCL-LINE                53640099
536500*        PERFORM 9100-WRITE-TD-LINE                               53650099
536600*    END-IF.                                                      53660099
536700                                                                  53670099
536800*    END OF PROC LINE                                             53680099
536900     MOVE JL-JCL-LINE-EOF TO TD-JCL-LINE.                         53690099
537000     PERFORM 9100-WRITE-TD-LINE.                                  53700099
537100                                                                  53710099
537200*    SHUT IT OFF!!!!!                                             53720099
537300     PERFORM 9600-DEQUEUE-INTERNAL-READER.                        53730099
537400                                                                  53740099
537500******************************************************************53750099
537600*  WRITE A JCL LINE TO THE TRANSIENT DATA QUEUE FOR THE INTERNAL *53760099
537700*  READER.  ON ANY ERROR, DEQUEUE THE INTERNAL READER, DELETE    *53770099
537800*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *53780099
537900*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *53790099
538000*  FORMAT AND DISPLAY AN ERROR MESSAGE                           *53800099
538100******************************************************************53810099
538200 9100-WRITE-TD-LINE.                                              53820099
538300                                                                  53830099
538400     EXEC CICS                                                    53840099
538500         WRITEQ TD                                                53850099
538600             QUEUE(TD-QUEUE-NAME)                                 53860099
538700             FROM(TD-JCL-LINE)                                    53870099
538800             LENGTH(TD-JCL-LINE-LENGTH)                           53880099
538900             RESP(PV-CICS-RESPONSE)                               53890099
539000     END-EXEC.                                                    53900099
539100                                                                  53910099
539200     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    53920099
539300         SET PS-ABEND-IN-PROGRESS        TO TRUE                  53930099
539400         STRING 'WRITE TO TRANSIENT DATA QUEUE '                  53940099
539500                                                DELIMITED BY SIZE 53950099
539600                TD-QUEUE-NAME                   DELIMITED BY SIZE 53960099
539700                ' (INTERNAL READER)'            DELIMITED BY SIZE 53970099
539800             INTO SE-ATTEMPTED-ACTION                             53980099
539900         MOVE PV-CICS-RESPONSE           TO SE-CICS-RESPONSE      53990099
540000                                                                  54000099
540100         MOVE SE-SYSTEM-ERROR-MESSAGE    TO DP013-MESSAGE-TABLE   54010099
540200         MOVE '9100-WRITE-TD-LINE'       TO DP013-PARAGRAPH       54020099
540300         SET DP013-CICS-ABEND            TO TRUE                  54030099
540400         SET DP013-ROLLBACK              TO TRUE                  54040099
540500         PERFORM 9999-WRITE-CICS-LOG-MSG                          54050099
540600         MOVE PM-NO-PRINT-MSG            TO AMSGLNO               54060099
540700         PERFORM 9600-DEQUEUE-INTERNAL-READER                     54070099
540800     END-IF.                                                      54080099
540900                                                                  54090099
541000******************************************************************54100099
541100*  ENQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *54110099
541200*  THIS WILL PREVENT INTERLEAVING OF JCL SUBMITTED CONCURRENTLY  *54120099
541300*  BY MULTIPLE USERS.  IF THE QUEUE IS BUSY, THIS PROGRAM WILL   *54130099
541400*  WAIT TO ENQUEUE IT, BY NOT SPECIFICALLY HANDLING THE QBUSY    *54140099
541500*  CONDITION.  IF ANY OTHER ERRORS OCCUR, DELETE THE TEMPORARY   *54150099
541600*  STORAGE QUEUE (TO PREVENT OLD REQUEST INFORMATION FROM        *54160099
541700*  ACCIDENTALLY APPEARING ON A FUTURE REQUEST), FORMAT AND       *54170099
541800*  DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE CICS.          *54180099
541900******************************************************************54190099
542000 9500-ENQUEUE-INTERNAL-READER.                                    54200099
542100                                                                  54210099
542200     EXEC CICS                                                    54220099
542300         ENQ                                                      54230099
542400             RESOURCE(TD-QUEUE-NAME)                              54240099
542500             LENGTH(TD-QUEUE-NAME-LENGTH)                         54250099
542600             RESP(PV-CICS-RESPONSE)                               54260099
542700     END-EXEC.                                                    54270099
542800                                                                  54280099
542900     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    54290099
543000         SET PS-ABEND-IN-PROGRESS        TO TRUE                  54300099
543100         STRING 'ENQUEUE '               DELIMITED BY SIZE        54310099
543200                TD-QUEUE-NAME            DELIMITED BY SIZE        54320099
543300                ' (INTERNAL READER)'     DELIMITED BY SIZE        54330099
543400             INTO SE-ATTEMPTED-ACTION                             54340099
543500         MOVE PV-CICS-RESPONSE           TO SE-CICS-RESPONSE      54350099
543600         MOVE SE-SYSTEM-ERROR-MESSAGE    TO DP013-MESSAGE-TABLE   54360099
543700         MOVE '9500-ENQUEUE-INTERNAL-READER'                      54370099
543800                                         TO DP013-PARAGRAPH       54380099
543900         SET DP013-CICS-ABEND            TO TRUE                  54390099
544000         SET DP013-ROLLBACK              TO TRUE                  54400099
544100         PERFORM 9999-WRITE-CICS-LOG-MSG                          54410099
544200         MOVE PM-NO-PRINT-MSG            TO AMSGLNO               54420099
544300     END-IF.                                                      54430099
544400                                                                  54440099
544500     SET PS-INTERNAL-READER-ENQUEUED     TO TRUE.                 54450099
544600                                                                  54460099
544700******************************************************************54470099
544800*  DEQUEUE THE TRANSIENT DATA QUEUE FOR THE INTERNAL READER.     *54480099
544900*  THIS SHOULD BE DONE FOLLOWING A SUCCESSFUL REPORT REQUEST     *54490099
545000*  SUBMISSION, A CANCELLATION OF THE CURRENT REPORT REQUEST, OR  *54500099
545100*  ANY DETECTED ABENDS.  THIS WILL FREE UP THE INTERNAL READER   *54510099
545200*  FOR THE NEXT USER.  IF ANY ERRORS OCCUR, CHECK TO SEE IF      *54520099
545300*  ANY OTHER ABEND SITUATIONS HAVE ALREADY OCCURRED.  IF SO, DO  *54530099
545400*  NOT FORCE THE ABEND FOR THIS ERROR, AND ALLOW PROGRAM CONTROL *54540099
545500*  TO RETURN TO THE POINT WHERE THE FIRST ABEND OCCURRED, AND    *54550099
545600*  DISPLAY THE MESSAGE RELATING TO THAT ABEND.  IF NOT, DELETE   *54560099
545700*  THE TEMPORARY STORAGE QUEUE (TO PREVENT OLD REQUEST           *54570099
545800*  INFORMATION FROM ACCIDENTALLY APPEARING ON A FUTURE REQUEST), *54580099
545900*  FORMAT AND DISPLAY AN ERROR MESSAGE, AND RETURN TO NATIVE     *54590099
546000*  CICS.                                                         *54600099
546100******************************************************************54610099
546200 9600-DEQUEUE-INTERNAL-READER.                                    54620099
546300                                                                  54630099
546400     SET PS-INTERNAL-READER-DEQUEUED     TO TRUE.                 54640099
546500                                                                  54650099
546600     EXEC CICS                                                    54660099
546700         DEQ                                                      54670099
546800             RESOURCE(TD-QUEUE-NAME)                              54680099
546900             LENGTH(TD-QUEUE-NAME-LENGTH)                         54690099
547000             RESP(PV-CICS-RESPONSE)                               54700099
547100     END-EXEC.                                                    54710099
547200                                                                  54720099
547300     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    54730099
547400         IF PS-NO-ABEND-IN-PROGRESS                               54740099
547500             SET PS-ABEND-IN-PROGRESS        TO TRUE              54750099
547600             STRING 'DEQUEUE '            DELIMITED BY SIZE       54760099
547700                    TD-QUEUE-NAME         DELIMITED BY SIZE       54770099
547800                    ' (INTERNAL READER)'  DELIMITED BY SIZE       54780099
547900                 INTO SE-ATTEMPTED-ACTION                         54790099
548000             MOVE PV-CICS-RESPONSE       TO SE-CICS-RESPONSE      54800099
548100             MOVE SE-SYSTEM-ERROR-MESSAGE                         54810099
548200                                         TO DP013-MESSAGE-TABLE   54820099
548300             MOVE '9600-DEQUEUE-INTERNAL-READER'                  54830099
548400                                         TO DP013-PARAGRAPH       54840099
548500             SET DP013-CICS-ABEND        TO TRUE                  54850099
548600             SET DP013-ROLLBACK          TO TRUE                  54860099
548700             PERFORM 9999-WRITE-CICS-LOG-MSG                      54870099
548800             MOVE PM-NO-PRINT-MSG        TO AMSGLNO               54880099
548900         END-IF                                                   54890099
549000     END-IF.                                                      54900099
549100                                                                  54910099
549200******************************************************************54920099
549300 9999-WRITE-CICS-LOG-MSG.                                         54930099
549400                                                                  54940099
549500     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            54950099
549600     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           54960099
549700     INITIALIZE DP013-SRC-TASK-NUMBER                             54970099
549800                DP013-STACK.                                      54980099
549900     SET DP013-LINK-RETURN           TO TRUE.                     54990099
550000                                                                  55000099
550100     EXEC CICS                                                    55010099
550200         LINK                                                     55020099
550300             PROGRAM   (DP013-NAME)                               55030099
550400             COMMAREA  (DP013-PARAMETERS)                         55040099
550500             LENGTH    (DP013-LENGTH)                             55050099
550600     END-EXEC.                                                    55060099
550700                                                                  55070099
550800******************************************************************55080099
550900 999A-WRITE-CSSL-MSG.                                             55090099
551000                                                                  55100099
551100     MOVE LENGTH OF PV-CICS-MSG-AREA2 TO PV-COMMAREA-LENGTH.      55110099
551200                                                                  55120099
551300     EXEC CICS                                                    55130099
551400          WRITEQ TD                                               55140099
551500           QUEUE  ('CSSL')                                        55150099
551600            FROM  (PV-CICS-MSG-AREA2)                             55160099
551700          LENGTH  (PV-COMMAREA-LENGTH)                            55170099
551800            RESP  (PV-CICS-RESPONSE)                              55180099
551900     END-EXEC.                                                    55190099
552000                                                                  55200099
552100*----------------------------------------------------------------*55210099
552200*    ABEND PROCESSOR MODULE                                      *55220099
552300*----------------------------------------------------------------*55230099
552400                                                                  55240099
552500     COPY DPPD014.                                                55250099
552600                                                                  55260099
