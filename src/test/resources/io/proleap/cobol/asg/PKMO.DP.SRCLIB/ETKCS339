00001  IDENTIFICATION DIVISION.                                         00010001
00002                                                                   00020001
00003  PROGRAM-ID.    ETKCS339.                                         00030001
00004  AUTHOR.        TESS BESTE.                                       00040001
00005  INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050001
00006  DATE-WRITTEN.  01-28-94.                                         00060001
00007  DATE-COMPILED.                                                   00070001
00008 *----------------------------------------------------------------*00080001
00009 *          E339 - UPC CATALOG VENDOR ID ADD/UPDATE/DELETE         00090001
00010 *                                                                 00100001
00011 * THIS PROGRAM ALLOWS THE USER TO ADD, UPDATE, OR DELETE UPC      00110001
00012 * CATALOG VENDORS.                                                00120001
00013 *                                                                 00130001
00014 * THE ADD FUNCTION IS INVOKED FROM THE VENDOR LIST SCREEN.  THE   00140001
00015 * ENTITY ID AND VENDOR NAME ARE PASSED TO THIS PROGRAM IN THE     00150001
00016 * SELECTED ITEMS TS QUEUE.  WHEN THE INITIAL SCREEN IS DISPLAYED, 00160001
00017 * THE VENDOR NAME IS FILLED IN AND PROTECTED.  THE NETWORK NAME IS00170001
00018 * BLANK AND PROTECTED.  ALL OTHER FIELDS ARE BLANK AND            00180001
00019 * UNPROTECTED.  WHEN THE ENTER OR ADD KEY IS PRESSED, THE         00190001
00020 * UNPROTECTED FIELDS ARE EDITED.  IF THE NETWORK ID IS VALID, THE 00200001
00021 * NETWORK NAME IS FILLED IN.  A ROW FOR THE VENDOR IS INSERTED    00210001
00022 * INTO THE TNETVND TABLE IF THE ADD KEY WAS PRESSED AND NO ERRORS 00220001
00023 * WERE DETECTED DURING EDITING.                                   00230001
00024 *                                                                 00240001
00025 * THE UPDATE FUNCTION IS INVOKED FROM THE UPC CATALOG VENDOR ID   00250001
00026 * LIST SCREEN.  THE ENTITY ID, VENDOR NAME, AND NETWORK ID ARE    00260001
00027 * PASSED TO THIS PROGRAM IN THE SELECTED ITEMS TS QUEUE.  WHEN THE00270001
00028 * INITIAL SCREEN IS DISPLAYED, ALL FIELDS ARE FILLED IN WITH THE  00280001
00029 * EXISTING INFORMATION FOR THE VENDOR.  THE VENDOR NAME, NETWORK  00290001
00030 * ID, AND NETWORK NAME ARE PROTECTED.  THE REMAINING FIELDS ARE   00300001
00031 * UNPROTECTED.  WHEN THE ENTER OR UPDATE KEY IS PRESSED, THE      00310001
00032 * UNPROTECTED FIELDS ARE EDITED.  THE ROW FOR THE VENDOR IS       00320001
00033 * UPDATED ON THE TNETVND TABLE IF THE UPDATE KEY WAS PRESSED, ANY 00330001
00034 * OF THE UNPROTECTED FIELDS WERE CHANGED, AND NO ERRORS WERE      00340001
00035 * DETECTED DURING EDITING.                                        00350001
00036 *                                                                 00360001
00037 * THE DELETE FUNCTION IS INVOKED FROM THE UPC CATALOG VENDOR ID   00370001
00038 * LIST SCREEN.  THE ENTITY ID, VENDOR NAME, AND NETWORK ID ARE    00380001
00039 * PASSED TO THIS PROGRAM IN THE SELECTED ITEMS TS QUEUE.  WHEN THE00390001
00040 * INITIAL SCREEN IS DISPLAYED, ALL FIELDS ARE FILLED IN WITH THE  00400001
00041 * EXISTING INFORMATION FOR THE VENDOR.  ALL FIELDS ARE PROTECTED. 00410001
00042 * WHEN THE CONFIRM KEY IS PRESSED, THE ROW FOR THE VENDOR IS      00420001
00043 * DELETED FROM THE TNETVND TABLE.                                 00430001
00044 *----------------------------------------------------------------*00440001
00044 * APRIL 1996.. NRF COMPLIANT INDICATOR ADDED. UPDATE/DELETE/ADD  *00441007
00044 * ARE ALLOWED.                                                   *00441107
00044 *----------------------------------------------------------------*00442007
000340*----------------------------------------------------------------*   CL**1
      *    CHANGE MADE: THE NETWORK ID IS NOW MADE AN UPDATABLE        *   CL**1
      *                 FIELD. THIS IS BECAUSE ENT_ID IS CONSIDERED TO *   CL**1
      *                 TO BE UNIQUE.                                  *   CL**1
      *                 ALL CHANGES FOR THIS IS REFERRED BY THE LABEL  *   CL**1
      *                 CL**1.                                         *   CL**1
      *    MADE BY    : CTS                                            *   CL**1
      *----------------------------------------------------------------*   CL**1
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210        00450001
CICS  *                                                                 00450001
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00450001
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00450001
CICS  *----------------------------------------------------------------*   CL**1
00046                                                                   00460001
00047  ENVIRONMENT DIVISION.                                            00470001
00048                                                                   00480001
00049  DATA DIVISION.                                                   00490001
00050                                                                   00500001
00051  WORKING-STORAGE SECTION.                                         00510001
00052                                                                   00520001
00053  01  PC-PROGRAM-CONSTANTS.                                        00530001
00054      05  PC-CURRENT-MAP-NAME          PIC  X(8)     VALUE         00540001
00055                                                          'ET339A'.00550001
00056      05  PC-CURRENT-MAPSET-NAME       PIC  X(8)     VALUE         00560001
00057                                                         'ETKM339'.00570001
00058      05  PC-CURRENT-PROGRAM-NAME      PIC  X(8)     VALUE         00580001
00059                                                       'ETKCS339'. 00590001
00060      05  PC-TSYMSG-NUMBERS.                                       00600001
00061          10  PC-TSYMSG-00004          PIC  9(5)     VALUE 00004.  00610001
00062          10  PC-TSYMSG-00005          PIC  9(5)     VALUE 00005.  00620001
00063          10  PC-TSYMSG-00007          PIC  9(5)     VALUE 00007.  00630001
00064          10  PC-TSYMSG-00034          PIC  9(5)     VALUE 00034.  00640001
00065          10  PC-TSYMSG-00046          PIC  9(5)     VALUE 00046.  00650001
00066          10  PC-TSYMSG-00059          PIC  9(5)     VALUE 00059.  00660001
00067          10  PC-TSYMSG-00069          PIC  9(5)     VALUE 00069.  00670001
00068          10  PC-TSYMSG-00070          PIC  9(5)     VALUE 00070.  00680001
00069          10  PC-TSYMSG-00115          PIC  9(5)     VALUE 00115.  00690001
00070          10  PC-TSYMSG-00116          PIC  9(5)     VALUE 00116.  00700001
00071          10  PC-TSYMSG-00117          PIC  9(5)     VALUE 00117.  00710001
00072          10  PC-TSYMSG-00148          PIC  9(5)     VALUE 00148.  00720001
00073          10  PC-TSYMSG-00551          PIC  9(5)     VALUE 00551.  00730001
               10  PC-TSYMSG-00758          PIC  9(5)     VALUE 00758.     CL**1
00074                                                                   00740001
00075      05  PC-PREFERRED-NETWORK         PIC  X        VALUE 'Y'.    00750001
00075      05  PC-NRFCOMP-IND               PIC  X        VALUE 'Y'.    00760001
00076      05  PC-TYPE-CDE-PRIMARY          PIC  X(2)     VALUE '01'.   00770001
00077                                                                   00780001
00078  01  PS-PROGRAM-SWITCHES.                                         00790001
00079      05  PS-ERROR-SW                  PIC  X        VALUE 'N'.    00800001
00080          88  PS-ERROR                               VALUE 'Y'.    00810001
00081          88  PS-NO-ERROR                            VALUE 'N'.    00820001
00082      05  PS-LIST-END-SW               PIC X         VALUE 'N'.    00830001
00083          88  PS-LIST-END                            VALUE 'Y'.    00840001
00084          88  PS-NO-LIST-END                         VALUE 'N'.    00850001
00085      05  PS-UPDATES-REQUESTED-SW      PIC X         VALUE 'Y'.    00860001
00086          88  PS-UPDATES-REQUESTED                   VALUE 'Y'.    00870001
00087          88  PS-NO-UPDATES-REQUESTED                VALUE 'N'.    00880001
00088      05  PS-ADD-SUCCESSFUL-SW         PIC X         VALUE 'N'.    00890001
00089          88 PS-ADD-SUCCESSFUL                       VALUE 'Y'.    00900001
00090          88 PS-ADD-NOT-SUCCESSFUL                   VALUE 'N'.    00910001
00091                                                                   00920001
00092  01  PV-PROGRAM-VARIABLES.                                        00930001
00093      05  PV-CICS-RESP                 PIC S9(04)    COMP SYNC     00940001
00094                                                     VALUE +0.     00950001
00095      05  PV-SUB                       PIC S9(04)    COMP SYNC     00960001
00096                                                     VALUE ZERO.   00970001
00097      05  PV-SUB2                      PIC S9(04)    COMP SYNC.    00980001
00098                                                                   00990001
00099 *---------------------------------------------------------------* 01000001
00100 *    SELECTED ITEMS TS QUEUE RECORD LAYOUT.                       01010001
00101 *---------------------------------------------------------------* 01020001
00102      COPY ETWS301.                                                01030001
00103                                                                   01040001
00104 *----------------------------------------------------------------*01050001
00105 *    MAP LAYOUT                                                  *01060001
00106 *----------------------------------------------------------------*01070001
00107      COPY ETKM339.                                                01080001
00108                                                                   01090001
00109 *----------------------------------------------------------------*01100001
00110 *    ATTRIBUTE SETTINGS COPYBOOK.                                *01110001
00111 *----------------------------------------------------------------*01120001
00112      COPY DPWS015.                                                01130001
00113                                                                   01140001
00114 *----------------------------------------------------------------*01150001
00115 *    FUNCTION KEYS COPYBOOK                                      *01160001
00116 *----------------------------------------------------------------*01170001
00117      COPY DPWS016.                                                01180001
00118                                                                   01190001
00119 *-----------------------------------------------------------------01200001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            01210001
00121 *-----------------------------------------------------------------01220001
00122      COPY DPWS030.                                                01230001
CICS       COPY DPWS930.                                                01230001
00123                                                                   01240001
00124 *-----------------------------------------------------------------01250001
00125 *    STANDARD COMMAREA.                                           01260001
00126 *-----------------------------------------------------------------01270001
00127      COPY DPWS020.                                                01280001
00128      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01290001
00129                                                                   01300001
00130 *-----------------------------------------------------------------01310001
00131 *    INTER-APPLICATION COMMAREA.                                  01320001
00132 *-----------------------------------------------------------------01330001
00133          10  INTER-APPL-COMM-AREA PIC X(200).                     01340001
00134      COPY ETWS300.                                                01350001
00135                                                                   01360001
00136 *-----------------------------------------------------------------01370001
00137 *    APPLICATION SPECIFIC COMMMAREA FOR ETKCS339.                 01380001
00138 *-----------------------------------------------------------------01390001
00139          10  ASC-SPECIFIC-COMMAREA.                               01400001
00140              15  ASC-SEL-SUB          PIC S9(4)     COMP.         01410001
00141              15  ASC-SEL-ITEM         PIC S9(4)     COMP.         01420001
00142              15  ASC-NUMBER-OF-TS-ITEMS                           01430001
00143                                       PIC S9(5)     COMP-3.       01440001
00144              15  ASC-USE-SELECTION-QUEUE-IND                      01450001
00145                                       PIC  X.                     01460001
00146                  88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    01470001
00147              15  ASC-SEL-QUEUE-NAME.                              01480001
00148                  20  ASC-SEL-TERM-ID  PIC  X(4).                  01490001
00149                  20  ASC-SEL-TASK-NUMBER                          01500001
00150                                       PIC S9(05)    COMP-3.       01510001
00151                  20  ASC-SEL-SEQ      PIC  9.                     01520001
00152                                                                   01530001
00153              15  ASC-INT-APPL-FORMAT-IND                          01540001
00154                                       PIC X.                      01550001
00155                  88  ASC-INT-APPL-FORMAT-ADD        VALUE '1'.    01560001
00156                  88  ASC-INT-APPL-FORMAT-UPDATE     VALUE '3'.    01570001
00157                  88  ASC-INT-APPL-FORMAT-DELETE     VALUE '4'.    01580001
00158                                                                   01590001
00159              15  ASC-MAP-KEY-FIELDS.                              01600001
00160                  20  ASC-NETWORK-ID   PIC  X.                     01610001
00161                  20  ASC-ENT-ID       PIC S9(9)     COMP.         01620001
00162                  20  ASC-VENDOR-NAME  PIC  X(30).                 01630001
00163              15  ASC-MAP-DETAIL-FIELDS.                           01640001
00164                  20  ASC-NETWORK-NAME PIC  X(15).                 01650001
00165                  20  ASC-VENDOR-ID    PIC  X(15).                 01660001
00166                  20  ASC-PREFERRED-IND                            01670001
00167                                       PIC  X.                     01680001
00166                  20  ASC-NRFCOMP-IND  PIC  X.                     01690001
00168              15  ASC-ORIG-MAP-DETAIL-FIELDS.                      01700001
00169                  20  ASC-ORIG-VENDOR-ID                           01710001
00170                                       PIC X(15).                  01720001
00171                  20  ASC-ORIG-PREFERRED-IND                       01730001
00172                                       PIC  X.                     01740001
00171                  20  ASC-ORIG-NRFCOMP-IND                         01750001
00172                                       PIC  X.                     01760001
00173              15  ASC-DATA-EXISTS-SW   PIC X.                      01770001
00174                  88  ASC-DATA-EXISTS                VALUE 'Y'.    01780001
00175                  88  ASC-DATA-DOES-NOT-EXIST        VALUE 'N'.    01790001
00176              15  ASC-ITEM-HAS-BEEN-ADDED-SW                       01800001
00177                                        PIC X.                     01810001
00178                  88 ASC-ITEM-HAS-BEEN-ADDED         VALUE 'Y'.    01820001
00179                  88 ASC-ITEM-HAS-NOT-BEEN-ADDED     VALUE 'N'.    01830001
                   15  ASC-ORIG-NETWORK-ID      PIC  X.                    CL**1
00180                                                                   01840001
00181          10      FILLER                   PIC  X(2761).              CL**1
00182                                                                   01860001
00183 *----------------------------------------------------------------*01870001
00184 *    ABEND PROCESSING COPYBOOK.                                  *01880001
00185 *----------------------------------------------------------------*01890001
00186      COPY DPWS013.                                                01900001
00187                                                                   01910001
00188 *---------------------------------------------------------------* 01920001
00189 *    DB2 AREA FOR UPC CATALOG VENDOR TABLE                       *01930001
00190 *---------------------------------------------------------------* 01940001
00191      EXEC SQL                                                     01950001
00192           INCLUDE TNETVND                                         01960001
00193      END-EXEC.                                                    01970001
00194                                                                   01980001
00195 *---------------------------------------------------------------* 01990001
00196 *    DB2 AREA FOR NETWORK TABLE                                 * 02000001
00197 *---------------------------------------------------------------* 02010001
00198      EXEC SQL                                                     02020001
00199           INCLUDE TNETWRK                                         02030001
00200      END-EXEC.                                                    02040001
00201                                                                   02050001
00202 *---------------------------------------------------------------* 02060001
00203 *    DB2 AREA FOR COMMUNICATIONS                                  02070001
00204 *---------------------------------------------------------------* 02080001
00205      EXEC SQL                                                     02090001
00206           INCLUDE SQLCA                                           02100001
00207      END-EXEC.                                                    02110001
00208                                                                   02120001
00209                                                                   02130001
00210  LINKAGE SECTION.                                                 02140001
00211                                                                   02150001
00212  01  DFHCOMMAREA.                                                 02160001
00213      05  FILLER                       OCCURS  1 TO 4072 TIMES     02170001
00214                                       DEPENDING ON EIBCALEN.      02180001
00215          10  FILLER                   PIC  X.                     02190001
00216                                                                   02200001
00217  EJECT                                                            02210001
00218  PROCEDURE DIVISION.                                              02220001
00219                                                                   02230001
00220 *---------------------------------------------------------------* 02240001
00221 *  THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.  * 02250001
00222 *  THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API   * 02260001
00223 *  MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.             * 02270001
00224 *                                                               * 02280001
00225 *  THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE   * 02290001
00226 *  LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.        * 02300001
00227 *---------------------------------------------------------------* 02310001
00228  0000-MAIN-MODULE.                                                02320001
00229                                                                   02330001
00230      INITIALIZE DP030-CICS-API-FIELDS.                            02340001
00231      MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02350001
00232      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02360001
00233      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02370001
00234      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02380001
00235      MOVE LENGTH OF ET339AI        TO DP030-MAP-LENGTH (1).       02390001
00236      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02400001
00237      PERFORM 0001-CALL-CICS-ARCH-API.                             02410001
00238                                                                   02420001
00239      PERFORM 1000-CONTROL-PROCESSING                              02430001
00240                                                                   02440001
00241      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02450001
00242      PERFORM 0001-CALL-CICS-ARCH-API.                             02460001
00243                                                                   02470001
00244                                                                   02480001
00245  0001-CALL-CICS-ARCH-API.                                         02490001
00246                                                                   02500001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02510001
00248                                     DFHCOMMAREA                   02520001
00249                                     DP030-CICS-API-FIELDS         02530001
00250                                     DP020-STANDARD-COMMAREA       02540001
00251                                     ET339AI.                      02550001
00252                                                                   02560001
00253      IF  DP030-RC-CALL-SUCCESSFUL                                 02570001
00254          CONTINUE                                                 02580001
00255      ELSE                                                         02590001
00256          SET DP013-NO-ROLLBACK                                    02600001
00257              DP013-XCTL-DISPLAY-RESTART                           02610001
00258              DP013-CICS-ABEND      TO TRUE                        02620001
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           02630001
CICS                                     TO DP013-PARAGRAPH             02640001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02650001
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02660001
00263          PERFORM DP013-0000-PROCESS-ABEND                         02670001
00264      END-IF.                                                      02680001
00265                                                                   02690001
00266                                                                   02700001
00267 *----------------------------------------------------------------*02710001
00268 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02720001
00269 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02730001
00270 *----------------------------------------------------------------*02740001
00271  1000-CONTROL-PROCESSING.                                         02750001
00272                                                                   02760001
00273                                                                   02770001
00274      EVALUATE TRUE                                                02780001
00275          WHEN DP020-NEXT-ACT-INITIAL                              02790001
00276              INITIALIZE ASC-SPECIFIC-COMMAREA                     02800001
00277              MOVE DP020-INT-APPL-FORMAT-IND                       02810001
00278                  TO ASC-INT-APPL-FORMAT-IND                       02820001
00279              PERFORM 1100-PROCESS-INTER-APPL-COMM                 02830001
00280              PERFORM 4000-BUILD-INITIAL-PANEL                     02840001
00281                                                                   02850001
00282          WHEN DP020-NEXT-ACT-READ-MAP                             02860001
00283              PERFORM 2000-PROCESS-PANEL                           02870001
00284                                                                   02880001
00285          WHEN DP020-NEXT-ACT-RETURN                               02890001
00286              IF ASC-DATA-DOES-NOT-EXIST                           02900001
00287                  PERFORM 4500-SET-ATTRIBUTES-TO-PROT              02910001
00288 *                ---- DATA DOES NOT EXIST ----                    02920001
00289                  MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER         02930001
00290                  SET DP020-MSG-FATAL  TO TRUE                     02940001
00291              ELSE                                                 02950001
00292                  IF (ASC-INT-APPL-FORMAT-ADD   AND                02960001
00293                      ASC-ITEM-HAS-NOT-BEEN-ADDED)                 02970001
00294                  OR ASC-INT-APPL-FORMAT-UPDATE                    02980001
00295                      PERFORM 3000-EDIT-DATA-IN-COMMAREA           02990001
00296                  ELSE                                             03000001
00297                      PERFORM 4500-SET-ATTRIBUTES-TO-PROT          03010001
00298                      IF ASC-INT-APPL-FORMAT-DELETE                03020001
00299                          SET DP020-MSG-INFORMATIONAL TO TRUE      03030001
00300 *                        ---- PRESS F2 TO CONFIRM REQUEST ----    03040001
00301                          MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER 03050001
00302                      END-IF                                       03060001
00303                  END-IF                                           03070001
00304              END-IF                                               03080001
00305              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03090001
00306                                                                   03100001
00307          WHEN OTHER                                               03110001
00308              SET DP013-LOGIC-ABEND                                03120001
00309                  DP013-NO-ROLLBACK TO TRUE                        03130001
00310              MOVE '1000-CONTROL-PROCESSING'                       03140001
00311                                    TO DP013-PARAGRAPH             03150001
00312              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03160001
00313                                    TO DP013-MESSAGE-TEXT(1)       03170001
00314              MOVE DP020-NEXT-APPL-ACTIVITY                        03180001
00315                                    TO DP013-MESSAGE-TEXT(2)       03190001
00316              PERFORM DP013-0000-PROCESS-ABEND                     03200001
00317      END-EVALUATE.                                                03210001
00318                                                                   03220001
00319                                                                   03230001
00320  1100-PROCESS-INTER-APPL-COMM.                                    03240001
00321                                                                   03250001
00322      SET ASC-USE-SELECTION-QUEUE   TO TRUE.                       03260001
00323      MOVE ET300-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS.     03270001
00324      MOVE ET300-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME.         03280001
00325      PERFORM 1120-PREPARE-LIST-ENTRY.                             03290001
00326                                                                   03300001
00327                                                                   03310001
00328 *----------------------------------------------------------------*03320001
00329 * GET READY TO START AT THE FIRST ITEM ON THE LIST.               03330001
00330 *----------------------------------------------------------------*03340001
00331  1120-PREPARE-LIST-ENTRY.                                         03350001
00332                                                                   03360001
00333      MOVE ET301-MAX-ITEMS TO ASC-SEL-SUB.                         03370001
00334      MOVE ZERO            TO ASC-SEL-ITEM.                        03380001
00335      PERFORM 2140-GET-NEXT-VENDOR.                                03390001
00336                                                                   03400001
00337                                                                   03410001
00338 *----------------------------------------------------------------*03420001
00339 * FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03430001
00340 * SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03440001
00341 * EDITS.                                                         *03450001
00342 *----------------------------------------------------------------*03460001
00343  2000-PROCESS-PANEL.                                              03470001
00344                                                                   03480001
00345      EVALUATE TRUE                                                03490001
00346          WHEN DP020-SRC-AID = DP016-CLEAR                         03500001
00347              EVALUATE TRUE                                        03510001
00348                  WHEN ASC-INT-APPL-FORMAT-ADD                     03520001
00349                      IF ASC-ITEM-HAS-NOT-BEEN-ADDED               03530001
00350                          PERFORM 3000-EDIT-DATA-IN-COMMAREA       03540001
00351                      ELSE                                         03550001
00352                          PERFORM 4500-SET-ATTRIBUTES-TO-PROT      03560001
00353                      END-IF                                       03570001
00354                                                                   03580001
00355                  WHEN ASC-INT-APPL-FORMAT-UPDATE                  03590001
00356                      IF ASC-DATA-DOES-NOT-EXIST                   03600001
00357                          PERFORM 4500-SET-ATTRIBUTES-TO-PROT      03610001
00358 *                        ---- DATA DOES NOT EXIST ----            03620001
00359                          MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER 03630001
00360                          SET DP020-MSG-FATAL  TO TRUE             03640001
00361                      ELSE                                         03650001
00362                          PERFORM 3000-EDIT-DATA-IN-COMMAREA       03660001
00363                      END-IF                                       03670001
00364                                                                   03680001
00365                  WHEN ASC-INT-APPL-FORMAT-DELETE                  03690001
00366                      PERFORM 4500-SET-ATTRIBUTES-TO-PROT          03700001
00367                      IF ASC-DATA-DOES-NOT-EXIST                   03710001
00368 *                        ---- DATA DOES NOT EXIST ----            03720001
00369                          MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER 03730001
00370                          SET DP020-MSG-FATAL  TO TRUE             03740001
00371                      ELSE                                         03750001
00372                          SET DP020-MSG-INFORMATIONAL TO TRUE      03760001
00373 *                        ---- PRESS F2 TO CONFIRM REQUEST ----    03770001
00374                          MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER 03780001
00375                      END-IF                                       03790001
00376              END-EVALUATE                                         03800001
00377              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03810001
00378                                                                   03820001
00379          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03830001
00380              INITIALIZE ASC-MAP-DETAIL-FIELDS                     03840001
00381              PERFORM 4000-BUILD-INITIAL-PANEL                     03850001
00382                                                                   03860001
00383          WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             03870001
00384              PERFORM 2140-GET-NEXT-VENDOR                         03880001
00385              INITIALIZE ASC-MAP-DETAIL-FIELDS                     03890001
00386              PERFORM 4000-BUILD-INITIAL-PANEL                     03900001
00387              SET PS-NO-LIST-END TO TRUE                           03910001
00388                                                                   03920001
00389          WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             03930001
00390              PERFORM 2150-GET-PREV-VENDOR                         03940001
00391              INITIALIZE ASC-MAP-DETAIL-FIELDS                     03950001
00392              PERFORM 4000-BUILD-INITIAL-PANEL                     03960001
00393              SET PS-NO-LIST-END TO TRUE                           03970001
00394                                                                   03980001
00395          WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    03990001
00396              PERFORM 5200-DELETE-VENDOR                           04000001
00397                                                                   04010001
00398          WHEN OTHER                                               04020001
00399              EVALUATE TRUE                                        04030001
00400                  WHEN ASC-INT-APPL-FORMAT-ADD                     04040001
00401                      IF ASC-ITEM-HAS-NOT-BEEN-ADDED               04050001
00402                          PERFORM 2200-MOVE-SCREEN-TO-COMMAREA     04060001
00403                          PERFORM 3000-EDIT-DATA-IN-COMMAREA       04070001
00404                          IF  PS-NO-ERROR                          04080001
00405                              PERFORM 2100-CHECK-FUNCTION-KEY      04090001
00406                          END-IF                                   04100001
00407                      ELSE                                         04110001
00408                          PERFORM 4500-SET-ATTRIBUTES-TO-PROT      04120001
00409                      END-IF                                       04130001
00410                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         04140001
00411                                                                   04150001
00412                  WHEN ASC-INT-APPL-FORMAT-UPDATE                  04160001
00413                      IF ASC-DATA-EXISTS                           04170001
00414                          PERFORM 2200-MOVE-SCREEN-TO-COMMAREA     04180001
00415                          PERFORM 3000-EDIT-DATA-IN-COMMAREA       04190001
00416                          IF  PS-NO-ERROR                          04200001
00417                              PERFORM 2100-CHECK-FUNCTION-KEY      04210001
00418                          END-IF                                   04220001
00419                          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     04230001
00420                      ELSE                                         04240001
00421                          PERFORM 2100-CHECK-FUNCTION-KEY          04250001
00422                      END-IF                                       04260001
00423                                                                   04270001
00424                  WHEN ASC-INT-APPL-FORMAT-DELETE                  04280001
00425                      PERFORM 2100-CHECK-FUNCTION-KEY              04290001
00426                                                                   04300001
00427              END-EVALUATE                                         04310001
00428      END-EVALUATE.                                                04320001
00429                                                                   04330001
00430                                                                   04340001
00431 *----------------------------------------------------------------*04350001
00432 *  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *04360001
00433 *  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *04370001
00434 *  FROM THE CICS ARCHITECTURE API.                               *04380001
00435 *----------------------------------------------------------------*04390001
00436  2100-CHECK-FUNCTION-KEY.                                         04400001
00437                                                                   04410001
00438      EVALUATE TRUE                                                04420001
00439          WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              04430001
00440              EVALUATE TRUE                                        04440001
00441                  WHEN ASC-INT-APPL-FORMAT-ADD                     04450001
00442                      PERFORM 5000-ADD-NETWORK                     04460001
00443                      IF PS-ADD-SUCCESSFUL                         04470001
00444                          PERFORM 4500-SET-ATTRIBUTES-TO-PROT      04480001
00445 *                        ---- ADD SUCCESSFUL ----                 04490001
00446                          MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER04500001
00447                          SET  DP020-MSG-INFORMATIONAL TO TRUE     04510001
00448                      END-IF                                       04520001
00449                                                                   04530001
00450                  WHEN ASC-INT-APPL-FORMAT-UPDATE                  04540001
00451                      IF ASC-DATA-EXISTS                           04550001
00452                          IF PS-NO-UPDATES-REQUESTED               04560001
00453 *                            ---- DATA NOT CHNGD;NO UPD PERFORMED 04570001
00454                              MOVE PC-TSYMSG-00046                 04580001
00455                                                TO DP020-MSG-NUMBER04590001
00456                              SET DP020-MSG-WARNING TO TRUE        04600001
00457                          ELSE                                     04610001
00458                              PERFORM 5100-UPDATE-NETWORK          04620001
00459                          END-IF                                   04630001
00460                      ELSE                                         04640001
00461                          PERFORM 4500-SET-ATTRIBUTES-TO-PROT      04650001
00462 *                        ---- DATA DOES NOT EXIST ----            04660001
00463                          MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER 04670001
00464                          SET DP020-MSG-FATAL  TO TRUE             04680001
00465                      END-IF                                       04690001
00466                                                                   04700001
00467                  WHEN OTHER                                       04710001
00468                      SET DP013-NO-ROLLBACK                        04720001
00469                          DP013-XCTL-DISPLAY-RESTART               04730001
00470                          DP013-CICS-ABEND  TO TRUE                04740001
00471                      MOVE '2100-CHECK-FUNCTION-KEY'               04750001
00472                                        TO DP013-PARAGRAPH         04760001
00473                      MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY AP04770001
00474 -                         'I'          TO DP013-MESSAGE-TEXT (1)  04780001
00475                      PERFORM DP013-0000-PROCESS-ABEND             04790001
00476              END-EVALUATE                                         04800001
00477                                                                   04810001
00478          WHEN DP020-SRC-AID = DP016-ENTER                         04820001
00479              EVALUATE TRUE                                        04830001
00480                  WHEN ASC-INT-APPL-FORMAT-ADD                     04840001
00481                      CONTINUE                                     04850001
00482                                                                   04860001
00483                  WHEN ASC-INT-APPL-FORMAT-UPDATE                  04870001
00484                      IF ASC-DATA-DOES-NOT-EXIST                   04880001
00485                          SET DP020-MSG-FATAL  TO TRUE             04890001
00486 *                        ---- DATA DOES NOT EXIST ----            04900001
00487                          MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER 04910001
00488                      END-IF                                       04920001
00489                                                                   04930001
00490                  WHEN ASC-INT-APPL-FORMAT-DELETE                  04940001
00491                      IF ASC-DATA-EXISTS                           04950001
00492                          SET DP020-MSG-INFORMATIONAL TO TRUE      04960001
00493 *                        ---- PRESS F2 TO CONFIRM REQUEST ----    04970001
00494                          MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER 04980001
00495                      ELSE                                         04990001
00496                          SET DP020-MSG-FATAL  TO TRUE             05000001
00497 *                        ---- DATA DOES NOT EXIST ----            05010001
00498                          MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER 05020001
00499                      END-IF                                       05030001
00500              END-EVALUATE                                         05040001
00501                                                                   05050001
00502          WHEN OTHER                                               05060001
00503              SET DP013-NO-ROLLBACK                                05070001
00504                  DP013-XCTL-DISPLAY-RESTART                       05080001
00505                  DP013-CICS-ABEND  TO TRUE                        05090001
00506              MOVE '2100-CHECK-FUNCTION-KEY'                       05100001
00507                                    TO DP013-PARAGRAPH             05110001
00508              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05120001
00509                                    TO DP013-MESSAGE-TEXT (1)      05130001
00510              PERFORM DP013-0000-PROCESS-ABEND                     05140001
00511      END-EVALUATE.                                                05150001
00512                                                                   05160001
00513                                                                   05170001
00514  2140-GET-NEXT-VENDOR.                                            05180001
00515                                                                   05190001
00516      ADD +1                       TO ASC-SEL-SUB.                 05200001
00517      IF  ASC-SEL-SUB > ET301-MAX-ITEMS                            05210001
00518          ADD +1                   TO ASC-SEL-ITEM                 05220001
00519          MOVE +1                  TO ASC-SEL-SUB                  05230001
00520      END-IF.                                                      05240001
00521      IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05250001
00522          PERFORM 9100-READ-SEL-QUEUE                              05260001
00523          IF  ET301-ITEM (ASC-SEL-SUB) > ZERO                      05270001
00524              MOVE ET301-NETWK-ID    (ASC-SEL-SUB)                 05280001
00525                                                 TO ASC-NETWORK-ID 05290001
00526              MOVE ET301-ENT-ID      (ASC-SEL-SUB)                 05300001
00527                                                 TO ASC-ENT-ID     05310001
00528              MOVE ET301-VENDOR-NAME (ASC-SEL-SUB)                 05320001
00529                                                 TO ASC-VENDOR-NAME05330001
00530              IF ET301-ACTION-SW (ASC-SEL-SUB) = SPACE             05340001
00531                  SET ET301-INQ (ASC-SEL-SUB) TO TRUE              05350001
00532                  PERFORM 9200-REWRITE-SEL-QUEUE                   05360001
00533              END-IF                                               05370001
00534          ELSE                                                     05380001
00535              SUBTRACT +1 FROM ASC-SEL-SUB                         05390001
00536 *            ---- BOTTOM OF LIST ----                             05400001
00537              MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             05410001
00538              SET DP020-MSG-INFORMATIONAL                          05420001
00539                  PS-LIST-END             TO TRUE                  05430001
00540          END-IF                                                   05440001
00541      ELSE                                                         05450001
00542          SUBTRACT +1 FROM ASC-SEL-ITEM                            05460001
00543          MOVE ET301-MAX-ITEMS     TO ASC-SEL-SUB                  05470001
00544 *        ---- BOTTOM OF LIST ----                                 05480001
00545          MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             05490001
00546          SET DP020-MSG-INFORMATIONAL                              05500001
00547              PS-LIST-END             TO TRUE                      05510001
00548      END-IF.                                                      05520001
00549                                                                   05530001
00550                                                                   05540001
00551  2150-GET-PREV-VENDOR.                                            05550001
00552                                                                   05560001
00553      SUBTRACT +1 FROM ASC-SEL-SUB.                                05570001
00554      IF  ASC-SEL-SUB < +1                                         05580001
00555          SUBTRACT +1 FROM ASC-SEL-ITEM                            05590001
00556          MOVE ET301-MAX-ITEMS     TO ASC-SEL-SUB                  05600001
00557      END-IF.                                                      05610001
00558                                                                   05620001
00559      IF  ASC-SEL-ITEM > ZERO                                      05630001
00560          PERFORM 9100-READ-SEL-QUEUE                              05640001
00561          MOVE ET301-NETWK-ID    (ASC-SEL-SUB) TO ASC-NETWORK-ID   05650001
00562          MOVE ET301-ENT-ID      (ASC-SEL-SUB) TO ASC-ENT-ID       05660001
00563          MOVE ET301-VENDOR-NAME (ASC-SEL-SUB) TO ASC-VENDOR-NAME  05670001
00564      ELSE                                                         05680001
00565          MOVE +1                  TO ASC-SEL-ITEM                 05690001
00566                                      ASC-SEL-SUB                  05700001
00567 *        ---- TOP OF LIST ----                                    05710001
00568          MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             05720001
00569          SET DP020-MSG-INFORMATIONAL                              05730001
00570                  PS-LIST-END         TO TRUE                      05740001
00571      END-IF.                                                      05750001
00572                                                                   05760001
00573                                                                   05770001
00574 *----------------------------------------------------------------*05780001
00575 * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*05790001
00576 * THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *05800001
00577 * APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *05810001
00578 *----------------------------------------------------------------*05820001
00579  2200-MOVE-SCREEN-TO-COMMAREA.                                    05830001
00580                                                                   05840001
00581      IF ANTIDL > ZERO                                             05850001
00582          MOVE ANTIDI TO ASC-NETWORK-ID                            05860001
00583      ELSE                                                         05870001
00584          IF ANTIDF = DP015-ERASE-EOF                              05880001
00585              MOVE SPACE TO ASC-NETWORK-ID                         05890001
00586          END-IF                                                   05900001
00587      END-IF.                                                      05910001
00588                                                                   05920001
00589      IF AVNIDL > ZERO                                             05930001
00590          MOVE AVNIDI TO ASC-VENDOR-ID                             05940001
00591      ELSE                                                         05950001
00592          IF AVNIDF = DP015-ERASE-EOF                              05960001
00593              MOVE SPACE TO ASC-VENDOR-ID                          05970001
00594          END-IF                                                   05980001
00595      END-IF.                                                      05990001
00596                                                                   06000001
00597      IF APREFL > ZERO                                             06010001
00598          MOVE APREFI TO ASC-PREFERRED-IND                         06020001
00599      ELSE                                                         06030001
00600          IF APREFF = DP015-ERASE-EOF                              06040001
00601              MOVE SPACE TO ASC-PREFERRED-IND                      06050001
00602          END-IF                                                   06060001
00603      END-IF.                                                      06070001
00604                                                                   06080001
00597      IF ANRFCL > ZERO                                             06090001
00598          MOVE ANRFCI TO ASC-NRFCOMP-IND                           06100001
00599      ELSE                                                         06110001
00600          IF ANRFCF = DP015-ERASE-EOF                              06120003
00601              MOVE SPACE TO ASC-NRFCOMP-IND                        06130001
00602          END-IF                                                   06140001
00603      END-IF.                                                      06150001
00604                                                                   06160001
00605                                                                   06170001
00606 *----------------------------------------------------------------*06180001
00607 * EDIT EACH FIELD ENTERED BY THE USER. IF AN ERROR IS FOUND,      06190001
00608 * POSITION THE CURSOR ON THAT FIELD AND DISPLAY THE APPROPRIATE  *06200001
00609 * ERROR MESSAGE.                                                  06210001
00610 *----------------------------------------------------------------*06220001
00611  3000-EDIT-DATA-IN-COMMAREA.                                      06230001
00612                                                                   06240001
00613      PERFORM 3225-RESET-ATTRIBUTES.                               06250001
00614      PERFORM 3250-EDIT-MAP-DETAIL-FIELDS.                         06260001
00615                                                                   06270001
00616                                                                   06280001
00617      IF ASC-INT-APPL-FORMAT-UPDATE                                06290001
00618          IF  ASC-VENDOR-ID     = ASC-ORIG-VENDOR-ID               06300001
00619          AND ASC-PREFERRED-IND = ASC-ORIG-PREFERRED-IND           06310001
00619          AND ASC-NRFCOMP-IND = ASC-ORIG-NRFCOMP-IND               06320005
               AND ASC-NETWORK-ID  = ASC-ORIG-NETWORK-ID                   CL**1
00620              SET PS-NO-UPDATES-REQUESTED TO TRUE                  06330001
00621          END-IF                                                   06340001
00622      END-IF.                                                      06350001
00623                                                                   06360001
00624      IF PS-NO-ERROR                                               06370001
00625          IF ASC-INT-APPL-FORMAT-ADD                               06380001
00626              IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)           06390001
00627                  CONTINUE                                         06400001
00628              ELSE                                                 06410001
00629                  SET DP030-SET-CURSOR-APPL-1 TO TRUE              06420001
00630                  MOVE -1 TO ANTIDL                                06430001
00631          ELSE                                                     06440001
00632              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06450001
00633              MOVE -1 TO AVNIDL                                    06460001
00634      ELSE                                                         06470001
00635          SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06480001
00636      END-IF.                                                      06490001
00637                                                                   06500001
00638                                                                   06510001
00639  3225-RESET-ATTRIBUTES.                                           06520001
00640                                                                   06530001
00641 *    IF ASC-INT-APPL-FORMAT-UPDATE                                   CL**1
00642 *        MOVE DP015-PRO-NOR-OFF     TO ANTIDA                        CL**1
00643 *    ELSE                                                            CL**1
00644 *        MOVE DP015-UNP-ALP-NOR-OFF TO ANTIDA                        CL**1
00645 *    END-IF.                                                         CL**1
           MOVE DP015-UNP-ALP-NOR-OFF TO ANTIDA.                           CL**1
00646      MOVE DP015-UNP-ALP-NOR-OFF     TO AVNIDA                     06590001
00647                                        APREFA                     06600001
00647                                        ANRFCA.                    06610001
00648                                                                   06620001
00649 *    IF ASC-INT-APPL-FORMAT-UPDATE                                   CL**1
00650 *        MOVE DP015-BLUE            TO ANTIDC                        CL**1
00651 *    ELSE                                                            CL**1
00652 *        MOVE DP015-GREEN           TO ANTIDC                        CL**1
00653 *    END-IF.                                                         CL**1
           MOVE DP015-GREEN               TO ANTIDC.                       CL**1
00654      MOVE DP015-GREEN               TO AVNIDC                     06680001
00655                                        APREFC                     06690001
00655                                        ANRFCC.                    06700001
00656                                                                   06710001
00657 *    IF ASC-INT-APPL-FORMAT-UPDATE                                   CL**1
00658 *        MOVE DP015-HL-OFF          TO ANTIDH                        CL**1
00659 *    ELSE                                                            CL**1
00660 *        MOVE DP015-UNDERLINE       TO ANTIDH                        CL**1
00661 *    END-IF.                                                         CL**1
           MOVE DP015-UNDERLINE       TO ANTIDH                            CL**1
00662      MOVE DP015-UNDERLINE           TO AVNIDH                     06770001
00663                                        APREFH                     06780001
00663                                        ANRFCH.                    06790001
00664                                                                   06800001
00665                                                                   06810001
00666  3250-EDIT-MAP-DETAIL-FIELDS.                                     06820001
00667                                                                   06830001
00668 *    *------------------------------------------------------------06840001
00669 *    * EDIT THE PREFERRED NETWORK INDICATOR.                      06850001
00670 *    *------------------------------------------------------------06860001
00671                                                                   06870001
00672      EVALUATE TRUE                                                06880001
00673          WHEN ASC-PREFERRED-IND = SPACE                           06890001
00674              SET PS-ERROR                                         06900001
00675                  DP020-MSG-FATAL         TO TRUE                  06910001
00676 *            ---- REQUIRED VALUE ----                             06920001
00677              MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      06930001
00678              MOVE DP015-UNP-ALP-BRT-OFF  TO APREFA                06940001
00679              MOVE DP015-RED              TO APREFC                06950001
00680              MOVE DP015-REVERSE          TO APREFH                06960001
00681              MOVE -1                     TO APREFL                06970001
00682          WHEN ASC-PREFERRED-IND = 'N'                             06980001
00683              CONTINUE                                             06990001
00684          WHEN ASC-PREFERRED-IND = 'Y'                             07000001
                 IF ASC-INT-APPL-FORMAT-ADD OR                             CL**1
                    (ASC-INT-APPL-FORMAT-UPDATE AND                        CL**1
                     ASC-NETWORK-ID  = ASC-ORIG-NETWORK-ID)                CL**1
00685              PERFORM 4315-READ-TNETVND-FOR-PREF                   07010001
00686              IF  SQLCODE = ZERO                                   07020001
00687                  SET PS-ERROR                                     07030001
00688                      DP020-MSG-FATAL         TO TRUE              07040001
00689 *                ---- INVALID VALUE ----                          07050001
00690                  MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  07060001
00691                  MOVE DP015-UNP-ALP-BRT-OFF  TO APREFA            07070001
00692                  MOVE DP015-RED              TO APREFC            07080001
00693                  MOVE DP015-REVERSE          TO APREFH            07090001
00694                  MOVE -1                     TO APREFL            07100001
00695              END-IF                                               07110001
                 END-IF                                                    CL**1
00696          WHEN OTHER                                               07120001
00697              SET PS-ERROR                                         07130001
00698                  DP020-MSG-FATAL         TO TRUE                  07140001
00699 *            ---- INVALID VALUE ----                              07150001
00700              MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      07160001
00701              MOVE DP015-UNP-ALP-BRT-OFF  TO APREFA                07170001
00702              MOVE DP015-RED              TO APREFC                07180001
00703              MOVE DP015-REVERSE          TO APREFH                07190001
00704              MOVE -1                     TO APREFL                07200001
00705      END-EVALUATE.                                                07210001
00706                                                                   07220001
00668 *    *------------------------------------------------------------07230001
00669 *    * EDIT THE NRF COMP NETWORK INDICATOR.                       07240001
00670 *    *------------------------------------------------------------07250001
00671                                                                   07260001
00672      EVALUATE TRUE                                                07270001
00673          WHEN ASC-NRFCOMP-IND = SPACE                             07280001
00674              SET PS-ERROR                                         07290001
00675                  DP020-MSG-FATAL         TO TRUE                  07300001
00676 *            ---- REQUIRED VALUE ----                             07310001
00677              MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      07320001
00678              MOVE DP015-UNP-ALP-BRT-OFF  TO ANRFCA                07330001
00679              MOVE DP015-RED              TO ANRFCC                07340001
00680              MOVE DP015-REVERSE          TO ANRFCH                07350001
00681              MOVE -1                     TO ANRFCL                07360001
00682          WHEN ASC-NRFCOMP-IND = 'N'                               07370001
00683              CONTINUE                                             07380001
00684          WHEN ASC-NRFCOMP-IND = 'Y'                               07390001
00685              CONTINUE                                             07400006
00696          WHEN OTHER                                               07510001
00697              SET PS-ERROR                                         07520001
00698                  DP020-MSG-FATAL         TO TRUE                  07530001
00699 *            ---- INVALID VALUE ----                              07540001
00700              MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      07550001
00701              MOVE DP015-UNP-ALP-BRT-OFF  TO ANRFCA                07560001
00702              MOVE DP015-RED              TO ANRFCC                07570001
00703              MOVE DP015-REVERSE          TO ANRFCH                07580001
00704              MOVE -1                     TO ANRFCL                07590001
00705      END-EVALUATE.                                                07600001
00706                                                                   07610001
00707 *    *------------------------------------------------------------07620001
00708 *    * EDIT THE UPC CATALOG VENDOR ID.                            07630001
00709 *    *------------------------------------------------------------07640001
00710                                                                   07650001
00711      IF ASC-VENDOR-ID = SPACE                                     07660001
00712          SET PS-ERROR                                             07670001
00713              DP020-MSG-FATAL         TO TRUE                      07680001
00714 *        ---- REQUIRED VALUE ----                                 07690001
00715          MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          07700001
00716          MOVE DP015-UNP-ALP-BRT-OFF  TO AVNIDA                    07710001
00717          MOVE DP015-RED              TO AVNIDC                    07720001
00718          MOVE DP015-REVERSE          TO AVNIDH                    07730001
00719          MOVE -1                     TO AVNIDL                    07740001
00720      END-IF.                                                      07750001
00721                                                                   07760001
00722 *    *------------------------------------------------------------07770001
00723 *    * EDIT THE NETWORK ID. THIS EDIT IS ONLY PERFORMED FOR THE   07780001
00724 *    * ADD FUNCTION BECAUSE NETWORK ID IS A PROTECTED FIELD WHEN  07790001
00725 *    * THE UPDATE FUNCTION IS PERFORMED.                          07800001
00726 *    *------------------------------------------------------------07810001
00727                                                                   07820001
00728      IF ASC-INT-APPL-FORMAT-ADD                                   07830001
00729          IF ASC-NETWORK-ID = SPACE                                07840001
00730              MOVE SPACE TO ASC-NETWORK-NAME                       07850001
00731              SET PS-ERROR                                         07860001
00732                  DP020-MSG-FATAL         TO TRUE                  07870001
00733 *            ---- REQUIRED FIELD ----                             07880001
00734              MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      07890001
00735              MOVE DP015-UNP-ALP-BRT-OFF  TO ANTIDA                07900001
00736              MOVE DP015-RED              TO ANTIDC                07910001
00737              MOVE DP015-REVERSE          TO ANTIDH                07920001
00738              MOVE -1                     TO ANTIDL                07930001
00739          ELSE                                                     07940001
00740              PERFORM 4340-READ-TNETWRK-FOR-NAME                   07950001
00741              IF SQLCODE = +100                                    07960001
00742                  MOVE SPACE TO ASC-NETWORK-NAME                   07970001
00743                  SET PS-ERROR                                     07980001
00744                      DP020-MSG-FATAL         TO TRUE              07990001
00745 *                ---- INVALID VALUE ----                          08000001
00746                  MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  08010001
00747                  MOVE DP015-UNP-ALP-BRT-OFF  TO ANTIDA            08020001
00748                  MOVE DP015-RED              TO ANTIDC            08030001
00749                  MOVE DP015-REVERSE          TO ANTIDH            08040001
00750                  MOVE -1                     TO ANTIDL            08050001
00751              ELSE                                                 08060001
00752                  MOVE NETWRK-NETWK-NME TO ASC-NETWORK-NAME        08070001
00753                  PERFORM 4320-READ-TNETVND-FOR-DUP                08080001
00754                  IF SQLCODE = +100                                08090001
00755                      CONTINUE                                     08100001
00756                  ELSE                                             08110001
00757                      SET PS-ERROR                                 08120001
00758                          DP020-MSG-FATAL        TO TRUE           08130001
00759 *                    ---- CANNOT ADD - RECORD ALREADY EXISTS ---- 08140001
00760                      MOVE PC-TSYMSG-00117      TO DP020-MSG-NUMBER08150001
00761                      MOVE DP015-UNP-ALP-BRT-OFF TO ANTIDA         08160001
00762                      MOVE DP015-RED             TO ANTIDC         08170001
00763                      MOVE DP015-REVERSE         TO ANTIDH         08180001
00764                      MOVE -1                    TO ANTIDL         08190001
00765                  END-IF                                           08200001
00766              END-IF                                               08210001
00767          END-IF                                                   08220001
00768      END-IF.                                                      08230001
                                                                           CL**1
00728      IF ASC-INT-APPL-FORMAT-UPDATE                                   CL**1
00729          IF ASC-NETWORK-ID = SPACE                                   CL**1
00730              MOVE SPACE TO ASC-NETWORK-NAME                          CL**1
                   MOVE ASC-ORIG-NETWORK-ID TO ASC-NETWORK-ID                   
00731              SET PS-ERROR                                            CL**1
00732                  DP020-MSG-FATAL         TO TRUE                     CL**1
00733 *            ---- REQUIRED FIELD ----                                CL**1
00734              MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER         CL**1
00735              MOVE DP015-UNP-ALP-BRT-OFF  TO ANTIDA                   CL**1
00736              MOVE DP015-RED              TO ANTIDC                   CL**1
00737              MOVE DP015-REVERSE          TO ANTIDH                   CL**1
00738              MOVE -1                     TO ANTIDL                   CL**1
                END-IF                                                     CL**1
            END-IF.                                                        CL**1
00769                                                                   08240001
00770                                                                   08250001
00771 *-----------------------------------------------------------------08260001
00772 * DETERMINE WHAT FUNCTION WAS INVOKED AND DISPLAY THE APPROPRIATE 08270001
00773 * INFORMATION.                                                    08280001
00774 *                                                                 08290001
00775 * IF THE ADD FUNCTION WAS INVOKED, CHECK THE SELECTED ITEM'S      08300001
00776 * ACTION SWITCH TO SEE WHETHER OR NOT THE VENDOR HAS BEEN ADDED   08310001
00777 * YET. IF THE VENDOR HAS BEEN ADDED, RETRIEVE THE INFORMATION AND 08320001
00778 * DISPLAY IT WITH ALL FIELDS PROTECTED. IF THE VENDOR HAS NOT BEEN08330001
00779 * ADDED, DISPLAY THE SCREEN WITH ALL ENTERABLE FIELDS EMPTY AND   08340001
00780 * UNPROTECTED, AND THE CURSOR ON NETWORK ID.                      08350001
00781 *                                                                 08360001
00782 * IF THE UPDATE FUNCTION WAS INVOKED, RETRIEVE THE INFORMATION AND08370001
00783 * DISPLAY IT WITH THE NETWORK ID PROTECTED, ALL OTHER ENTERABLE   08380001
00784 * FIELDS UNPROTECTED, AND THE CURSOR ON VENDOR ID.                08390001
00785 *                                                                 08400001
00786 * IF THE DELETE FUNCTION WAS INVOKED, RETRIEVE THE INFORMATION AND08410001
00787 * DISPLAY IT WITH ALL FIELDS PROTECTED, AND A CONFIRMATION        08420001
00788 * MESSAGE DISPLAYED.                                              08430001
00789 *                                                                 08440001
00790 * IN ANY OF THE ABOVE CASES WHERE THE INFORMATION IS TO BE        08450001
00791 * RETRIEVED AND DISPLAYED, IF THE DATA IS NOT FOUND ON THE TNETVND08460001
00792 * TABLE, DISPLAY THE SCREEN WITH ALL ENTERABLE FIELDS EMPTY AND   08470001
00793 * PROTECTED, AND A MESSAGE INDICATING THAT THE DATA DOES NOT EXIST08480001
00794 * EXIT.                                                           08490001
00795 *-----------------------------------------------------------------08500001
00796  4000-BUILD-INITIAL-PANEL.                                        08510001
00797                                                                   08520001
00798      IF ASC-INT-APPL-FORMAT-ADD                                   08530001
00799          PERFORM 9100-READ-SEL-QUEUE                              08540001
00800          IF ET301-ADD (ASC-SEL-SUB)                               08550001
00801              SET ASC-ITEM-HAS-BEEN-ADDED TO TRUE                  08560001
00802          ELSE                                                     08570001
00803              SET ASC-ITEM-HAS-NOT-BEEN-ADDED TO TRUE              08580001
00804          END-IF                                                   08590001
00805      END-IF.                                                      08600001
00806                                                                   08610001
00807      IF ASC-INT-APPL-FORMAT-ADD                                   08620001
00808      AND ASC-ITEM-HAS-NOT-BEEN-ADDED                              08630001
00809          INITIALIZE ASC-NETWORK-ID                                08640001
00810          PERFORM 3225-RESET-ATTRIBUTES                            08650001
00811          SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08660001
00812          MOVE -1 TO ANTIDL                                        08670001
00813      ELSE                                                         08680001
00814          PERFORM 4300-GET-VENDOR-INFO                             08690001
00815          IF SQLCODE = +100                                        08700001
00816              SET ASC-DATA-DOES-NOT-EXIST TO TRUE                  08710001
00817              INITIALIZE ASC-NETWORK-ID                            08720001
00818              EVALUATE TRUE                                        08730001
00819                  WHEN DP020-FK-REFRESH (DP020-SRC-AID)            08740001
00820                      SET DP020-MSG-FATAL TO TRUE                  08750001
00821 *                    ---- DATA DOES NOT EXIST ----                08760001
00822                      MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER     08770001
00823                      PERFORM 4500-SET-ATTRIBUTES-TO-PROT          08780001
00824                      PERFORM 9100-READ-SEL-QUEUE                  08790001
00825                      SET ET301-DEL (ASC-SEL-SUB) TO TRUE          08800001
00826                      PERFORM 9200-REWRITE-SEL-QUEUE               08810001
00827                  WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)     08820001
00828                  WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)     08830001
00829                      IF PS-LIST-END                               08840001
00830                          CONTINUE                                 08850001
00831                      ELSE                                         08860001
00832                          SET DP020-MSG-FATAL TO TRUE              08870001
00833 *                        ---- DATA DOES NOT EXIST ----            08880001
00834                          MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER 08890001
00835                      END-IF                                       08900001
00836                      PERFORM 4500-SET-ATTRIBUTES-TO-PROT          08910001
00837                      PERFORM 9100-READ-SEL-QUEUE                  08920001
00838                      SET ET301-DEL (ASC-SEL-SUB) TO TRUE          08930001
00839                      PERFORM 9200-REWRITE-SEL-QUEUE               08940001
00840                  WHEN OTHER                                       08950001
00841                      SET DP020-NEXT-ACT-APPL-ERROR                08960001
00842                          DP020-MSG-FATAL           TO TRUE        08970001
00843 *                    ---- DATA DOES NOT EXIST ----                08980001
00844                      MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER     08990001
00845              END-EVALUATE                                         09000001
00846          ELSE                                                     09010001
00847              SET ASC-DATA-EXISTS TO TRUE                          09020001
00848              IF ASC-INT-APPL-FORMAT-DELETE                        09030001
00849              OR ASC-INT-APPL-FORMAT-ADD                           09040001
00850                  PERFORM 4500-SET-ATTRIBUTES-TO-PROT              09050001
00851                  IF  ASC-INT-APPL-FORMAT-DELETE                   09060001
00852                  AND PS-NO-LIST-END                               09070001
00853                      SET DP020-MSG-INFORMATIONAL TO TRUE          09080001
00854 *                    ---- PRESS F2 TO CONFIRM REQUEST ----        09090001
00855                      MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER     09100001
00856                  END-IF                                           09110001
00857              ELSE                                                 09120001
                       MOVE ASC-NETWORK-ID    TO ASC-ORIG-NETWORK-ID       CL**1
00858                  MOVE ASC-VENDOR-ID     TO ASC-ORIG-VENDOR-ID     09130001
00859                  MOVE ASC-PREFERRED-IND TO ASC-ORIG-PREFERRED-IND 09140001
00859                  MOVE ASC-NRFCOMP-IND TO ASC-ORIG-NRFCOMP-IND     09150001
00860                  PERFORM 3225-RESET-ATTRIBUTES                    09160001
00861**                MOVE -1                    TO AVNIDL             09170001
                       MOVE -1                    TO ANTIDL                CL**1
00862                  SET DP030-SET-CURSOR-APPL-1 TO TRUE              09180001
00863              END-IF                                               09190001
00864          END-IF                                                   09200001
00865      END-IF.                                                      09210001
00866                                                                   09220001
00867      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09230001
00868                                                                   09240001
00869                                                                   09250001
00870  4300-GET-VENDOR-INFO.                                            09260001
00871                                                                   09270001
00872      PERFORM 4310-READ-TNETVND.                                   09280001
00873                                                                   09290001
00874      EVALUATE TRUE                                                09300001
00875          WHEN SQLCODE = ZERO                                      09310001
00876              MOVE NETVND-NETWK-ID          TO ASC-NETWORK-ID      09320001
00877              MOVE NETWRK-NETWK-NME         TO ASC-NETWORK-NAME    09330001
00878              MOVE NETVND-UPC-CAT-VEND-ID   TO ASC-VENDOR-ID       09340001
00879              MOVE NETVND-PREF-NETWK-SW-IND TO ASC-PREFERRED-IND   09350001
00879              MOVE NETVND-NRF-CMPLIT-IND    TO ASC-NRFCOMP-IND     09360001
00880                                                                   09370001
00881          WHEN SQLCODE = +100                                      09380001
00882              CONTINUE                                             09390001
00883      END-EVALUATE.                                                09400001
00884                                                                   09410001
00885                                                                   09420001
00886  4310-READ-TNETVND.                                               09430001
00887                                                                   09440001
00888      EXEC SQL                                                     09450001
00889          SELECT   A.NETWK_ID                                      09460001
00890                 , A.UPC_CAT_VEND_ID                               09470001
00891                 , A.PREF_NETWK_SW_IND                             09480001
00891                 , A.NRF_CMPLIT_IND                                09490001
00892                 , B.NETWK_NME                                     09500001
00893           INTO   :NETVND-NETWK-ID                                 09510001
00894                 ,:NETVND-UPC-CAT-VEND-ID                          09520001
00895                 ,:NETVND-PREF-NETWK-SW-IND                        09530001
00895                 ,:NETVND-NRF-CMPLIT-IND                           09540001
00896                 ,:NETWRK-NETWK-NME                                09550001
00897          FROM     TNETVND A                                       09560001
00898                 , TNETWRK B                                       09570001
00899          WHERE A.NETWK_ID = :ASC-NETWORK-ID                       09580001
00900            AND A.ENT_ID   = :ASC-ENT-ID                           09590001
00901            AND A.NETWK_ID = B.NETWK_ID                            09600001
00902      END-EXEC.                                                    09610001
00903                                                                   09620001
00904      EVALUATE TRUE                                                09630001
00905          WHEN SQLCODE = ZERO                                      09640001
00906          WHEN SQLCODE = +100                                      09650001
00907              CONTINUE                                             09660001
00908          WHEN SQLWARN0 NOT = SPACE                                09670001
00909          WHEN SQLCODE  NOT = ZERO                                 09680001
00910              MOVE '4310-READ-TNETVND'  TO DP013-PARAGRAPH         09690001
00911              MOVE 'SELECT FROM JOINED TABLES'                     09700001
00912                                        TO DP013-MESSAGE-TEXT (1)  09710001
00913              MOVE SQLCA                TO DP013-SQLCA             09720001
00914              MOVE 'TNETVND'            TO DP013-DB2-TABLE-NAME (1)09730001
00915              MOVE 'TNETWRK '           TO DP013-DB2-TABLE-NAME (2)09740001
00916              SET DP013-DB2-ABEND       TO TRUE                    09750001
00917              PERFORM DP013-0000-PROCESS-ABEND                     09760001
00918      END-EVALUATE.                                                09770001
00919                                                                   09780001
00920                                                                   09790001
00921  4315-READ-TNETVND-FOR-PREF.                                      09800001
00922                                                                   09810001
00923      EXEC SQL                                                     09820001
00924          SELECT NETWK_ID                                          09830001
00925          INTO  :NETVND-NETWK-ID                                   09840001
00926          FROM   TNETVND                                           09850001
00927          WHERE  ENT_ID            = :ASC-ENT-ID                   09860001
00928            AND  NOT NETWK_ID      = :ASC-NETWORK-ID               09870001
00929            AND  PREF_NETWK_SW_IND = :PC-PREFERRED-NETWORK         09880001
00930      END-EXEC.                                                    09890001
00931                                                                   09900001
00932      EVALUATE TRUE                                                09910001
00933          WHEN SQLCODE = ZERO                                      09920001
00934          WHEN SQLCODE = +100                                      09930001
00935              CONTINUE                                             09940001
00936          WHEN SQLWARN0 NOT = SPACE                                09950001
00937          WHEN SQLCODE  NOT = ZERO                                 09960001
00938              MOVE '4315-READ-TNETVND-FOR-PREF'                    09970001
00939                                        TO  DP013-PARAGRAPH        09980001
00940              MOVE 'SELECT FROM TNETVND'                           09990001
00941                                        TO DP013-MESSAGE-TEXT (1)  10000001
00942              MOVE SQLCA                TO DP013-SQLCA             10010001
00943              MOVE 'TNETVND'            TO DP013-DB2-TABLE-NAME (1)10020001
00944              SET DP013-DB2-ABEND       TO TRUE                    10030001
00945              PERFORM DP013-0000-PROCESS-ABEND                     10040001
00946      END-EVALUATE.                                                10050001
00947                                                                   10060001
00948                                                                   10340001
00949  4320-READ-TNETVND-FOR-DUP.                                       10350001
00950                                                                   10360001
00951      EXEC SQL                                                     10370001
00952          SELECT NETWK_ID                                          10380001
00953          INTO  :NETVND-NETWK-ID                                   10390001
00954          FROM   TNETVND                                           10400001
00955 *        WHERE  NETWK_ID  = :ASC-NETWORK-ID                          CL**1
00956          WHERE  ENT_ID    = :ASC-ENT-ID                              CL**1
00957      END-EXEC.                                                    10430001
00958                                                                   10440001
00959      EVALUATE TRUE                                                10450001
00960          WHEN SQLCODE = ZERO                                      10460001
00961          WHEN SQLCODE = +100                                      10470001
00962              CONTINUE                                             10480001
00963          WHEN SQLWARN0 NOT = SPACE                                10490001
00964          WHEN SQLCODE  NOT = ZERO                                 10500001
00965              MOVE '4320-READ-TNETVND-FOR-DUP'                     10510001
00966                                        TO  DP013-PARAGRAPH        10520001
00967              MOVE 'SELECT FROM TNETVND'                           10530001
00968                                        TO DP013-MESSAGE-TEXT (1)  10540001
00969              MOVE SQLCA                TO DP013-SQLCA             10550001
00970              MOVE 'TNETVND'            TO DP013-DB2-TABLE-NAME (1)10560001
00971              SET DP013-DB2-ABEND       TO TRUE                    10570001
00972              PERFORM DP013-0000-PROCESS-ABEND                     10580001
00973      END-EVALUATE.                                                10590001
00974                                                                   10600001
00975                                                                   10610001
00976  4340-READ-TNETWRK-FOR-NAME.                                      10620001
00977                                                                   10630001
00978      EXEC SQL                                                     10640001
00979           SELECT NETWK_NME                                        10650001
00980           INTO  :NETWRK-NETWK-NME                                 10660001
00981           FROM   TNETWRK                                          10670001
00982           WHERE  NETWK_ID = :ASC-NETWORK-ID                       10680001
00983      END-EXEC.                                                    10690001
00984                                                                   10700001
00985      EVALUATE TRUE                                                10710001
00986          WHEN SQLCODE = ZERO                                      10720001
00987          WHEN SQLCODE = +100                                      10730001
00988              CONTINUE                                             10740001
00989          WHEN SQLWARN0 NOT = SPACE                                10750001
00990          WHEN SQLCODE  NOT = ZERO                                 10760001
00991              MOVE '4340-READ-TNETWRK-FOR-NAME'                    10770001
00992                                        TO DP013-PARAGRAPH         10780001
00993              MOVE 'SELECT FROM TNETWRK'                           10790001
00994                                        TO DP013-MESSAGE-TEXT (1)  10800001
00995              MOVE SQLCA                TO DP013-SQLCA             10810001
00996              MOVE 'TNETWRK'            TO DP013-DB2-TABLE-NAME (1)10820001
00997              SET DP013-DB2-ABEND       TO TRUE                    10830001
00998              PERFORM DP013-0000-PROCESS-ABEND                     10840001
00999      END-EVALUATE.                                                10850001
01000                                                                   10860001
01001                                                                   10870001
01002  4400-MOVE-COMMAREA-TO-SCREEN.                                    10880001
01003                                                                   10890001
01004      MOVE ASC-VENDOR-NAME           TO AVNMEO.                    10900001
01005      MOVE ASC-NETWORK-ID            TO ANTIDO.                    10910001
01006      MOVE ASC-NETWORK-NAME          TO ANAMEO.                    10920001
01007      MOVE ASC-VENDOR-ID             TO AVNIDO.                    10930001
01008      MOVE ASC-PREFERRED-IND         TO APREFO.                    10940001
01008      MOVE ASC-NRFCOMP-IND           TO ANRFCO.                    10950001
01009                                                                   10960001
01010                                                                   10970001
01011  4500-SET-ATTRIBUTES-TO-PROT.                                     10980001
01012                                                                   10990001
01013      MOVE DP015-PRO-NOR-OFF TO ANTIDA                             11000001
01014                                AVNIDA                             11010001
01015                                APREFA                             11020001
01015                                ANRFCA.                            11030001
01016                                                                   11040001
01017      MOVE DP015-BLUE        TO ANTIDC                             11050001
01018                                AVNIDC                             11060001
01019                                APREFC                             11070001
01019                                ANRFCC.                            11080001
01020                                                                   11090001
01021      MOVE DP015-HL-OFF      TO ANTIDH                             11100001
01022                                AVNIDH                             11110001
01023                                APREFH                             11120001
01023                                ANRFCH.                            11130001
01024                                                                   11140001
01025                                                                   11150001
01026  5000-ADD-NETWORK.                                                11160001
01027                                                                   11170001
01028      MOVE ASC-NETWORK-ID          TO NETVND-NETWK-ID.             11180001
01029      MOVE ASC-ENT-ID              TO NETVND-ENT-ID.               11190001
01030      MOVE ASC-VENDOR-ID           TO NETVND-UPC-CAT-VEND-ID.      11200001
01031      MOVE ASC-PREFERRED-IND       TO NETVND-PREF-NETWK-SW-IND.    11210001
01031      MOVE ASC-NRFCOMP-IND         TO NETVND-NRF-CMPLIT-IND.       11220001
01032                                                                   11230001
01033      PERFORM 5050-INSERT-TNETVND-ROW.                             11240001
01034                                                                   11250001
01035      IF SQLCODE = 0                                               11260001
01036          SET PS-ADD-SUCCESSFUL                                    11270001
01037              ASC-ITEM-HAS-BEEN-ADDED TO TRUE                      11280001
01038          PERFORM 9100-READ-SEL-QUEUE                              11290001
01039          SET ET301-ADD (ASC-SEL-SUB) TO TRUE                      11300001
01040          MOVE ASC-NETWORK-ID TO ET301-NETWK-ID (ASC-SEL-SUB)      11310001
01041          PERFORM 9200-REWRITE-SEL-QUEUE                           11320001
01042      ELSE                                                         11330001
01043          SET DP020-MSG-WARNING TO TRUE                            11340001
01044 *        ---- WAIT 15 SECONDS, THEN RETRY ----                    11350001
01045          MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER                11360001
01046      END-IF.                                                      11370001
01047                                                                   11380001
01048                                                                   11390001
01049  5050-INSERT-TNETVND-ROW.                                         11400001
01050                                                                   11410001
01051      EXEC SQL                                                     11420001
01052          INSERT INTO TNETVND                                      11430001
01053             (                                                     11440001
01054              NETWK_ID                                             11450001
01055             ,ENT_ID                                               11460001
01056             ,UPC_CAT_VEND_ID                                      11470001
01057             ,PREF_NETWK_SW_IND                                    11480001
01057             ,NRF_CMPLIT_IND                                       11490001
01058             )                                                     11500001
01059          VALUES                                                   11510001
01060             (                                                     11520001
01061              :NETVND-NETWK-ID                                     11530001
01062             ,:NETVND-ENT-ID                                       11540001
01063             ,:NETVND-UPC-CAT-VEND-ID                              11550001
01064             ,:NETVND-PREF-NETWK-SW-IND                            11560001
01064             ,:NETVND-NRF-CMPLIT-IND                               11570001
01065             )                                                     11580001
01066      END-EXEC.                                                    11590001
01067                                                                   11600001
01068      EVALUATE TRUE                                                11610001
01069          WHEN SQLCODE = ZERO                                      11620001
01070          WHEN SQLCODE = -904                                      11630001
01071          WHEN SQLCODE = -913                                      11640001
01072              CONTINUE                                             11650001
01073          WHEN SQLWARN0 NOT = SPACES                               11660001
01074          WHEN SQLCODE  NOT = ZERO                                 11670001
01075              MOVE '5150-INSERT-TNETVND-ROW'                       11680001
01076                                TO DP013-PARAGRAPH                 11690001
01077              MOVE 'INSERTING A ROW INTO THE TABLE'                11700001
01078                                TO DP013-MESSAGE-TEXT(1)           11710001
01079              MOVE 'TNETVND'    TO DP013-DB2-TABLE-NAME (1)        11720001
01080              MOVE SQLCA        TO DP013-SQLCA                     11730001
01081              SET DP013-DB2-ABEND                                  11740001
01082                  DP013-XCTL-DISPLAY-RESTART TO TRUE               11750001
01083              PERFORM DP013-0000-PROCESS-ABEND                     11760001
01084      END-EVALUATE.                                                11770001
01085                                                                   11780001
01086                                                                   11790001
01087  5100-UPDATE-NETWORK.                                             11800001
01088                                                                   11810001
01089      MOVE ASC-NETWORK-ID          TO NETVND-NETWK-ID.             11820001
01090      MOVE ASC-ENT-ID              TO NETVND-ENT-ID.               11830001
01091      MOVE ASC-VENDOR-ID           TO NETVND-UPC-CAT-VEND-ID.      11840001
01092      MOVE ASC-PREFERRED-IND       TO NETVND-PREF-NETWK-SW-IND.    11850001
01092      MOVE ASC-NRFCOMP-IND         TO NETVND-NRF-CMPLIT-IND.       11860001
01093                                                                   11870001
01094      PERFORM 5150-UPDATE-TNETVND-ROW.                             11880001
01095                                                                   11890001
01096      IF SQLCODE = ZERO                                            11900001
               MOVE ASC-NETWORK-ID     TO ASC-ORIG-NETWORK-ID              CL**1
01097          MOVE ASC-VENDOR-ID      TO ASC-ORIG-VENDOR-ID            11910001
01098          MOVE ASC-PREFERRED-IND  TO ASC-ORIG-PREFERRED-IND        11920001
01098          MOVE ASC-NRFCOMP-IND    TO ASC-ORIG-NRFCOMP-IND          11930001
01099          SET DP020-MSG-INFORMATIONAL TO TRUE                      11940001
01100 *        ---- UPDATES SUCCESSFUL ----                             11950001
01101          MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER          11960001
01102          PERFORM 9100-READ-SEL-QUEUE                              11970001
               MOVE ASC-NETWORK-ID TO ET301-NETWK-ID    (ASC-SEL-SUB)      CL**1
01103          SET ET301-UPD (ASC-SEL-SUB) TO TRUE                      11980001
01104          PERFORM 9200-REWRITE-SEL-QUEUE                           11990001
           ELSE                                                            CL**1
               IF SQLCODE = -530 OR -803                                   CL**1
      *           MOVE ASC-NETWORK-ID     TO ASC-ORIG-NETWORK-ID           CL**1
                  MOVE ASC-VENDOR-ID      TO ASC-ORIG-VENDOR-ID            CL**1
                  MOVE ASC-PREFERRED-IND  TO ASC-ORIG-PREFERRED-IND        CL**1
                  MOVE ASC-NRFCOMP-IND    TO ASC-ORIG-NRFCOMP-IND          CL**1
                  SET DP020-MSG-WARNING   TO TRUE                          CL**1
      *           ---- INVALID NETWORK ----                                CL**1
                  MOVE PC-TSYMSG-00758        TO DP020-MSG-NUMBER          CL**1
                  PERFORM 9100-READ-SEL-QUEUE                              CL**1
                  SET ET301-INQ (ASC-SEL-SUB) TO TRUE                      CL**1
                  PERFORM 9200-REWRITE-SEL-QUEUE                           CL**1
               END-IF                                                      CL**1
01105      END-IF.                                                      12000001
01106                                                                   12010001
01107                                                                   12020001
01108  5150-UPDATE-TNETVND-ROW.                                         12030001
01109                                                                   12040001
01110      EXEC SQL                                                     12050001
01111          UPDATE TNETVND                                           12060001
01112              SET                                                  12070001
01113                  UPC_CAT_VEND_ID    = :NETVND-UPC-CAT-VEND-ID     12080001
01114                 ,PREF_NETWK_SW_IND  = :NETVND-PREF-NETWK-SW-IND   12090001
01114                 ,NRF_CMPLIT_IND     = :NETVND-NRF-CMPLIT-IND      12091005
                      ,NETWK_ID = :NETVND-NETWK-ID                         CL**1
01115 *            WHERE NETWK_ID = :NETVND-NETWK-ID                       CL**1
01116 *              AND ENT_ID   = :NETVND-ENT-ID                         CL**1
                   WHERE ENT_ID   = :NETVND-ENT-ID                         CL**1
01117      END-EXEC.                                                    12120001
01118                                                                   12130001
01119      EVALUATE TRUE                                                12140001
01120          WHEN SQLCODE = ZERO                                      12150001
               WHEN SQLCODE = -530                                         CL**1
               WHEN SQLCODE = -803                                         CL**1
01121              CONTINUE                                             12160001
01122          WHEN SQLCODE = +100                                      12170001
01123              PERFORM 4500-SET-ATTRIBUTES-TO-PROT                  12180001
01124 *            ---- DATA DOES NOT EXIST ----                        12190001
01125              MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            12200001
01126              SET DP020-MSG-FATAL TO TRUE                          12210001
01127              INITIALIZE ASC-MAP-DETAIL-FIELDS                     12220001
01128          WHEN SQLCODE = -904                                      12230001
01129          WHEN SQLCODE = -913                                      12240001
01130              SET DP020-MSG-WARNING TO TRUE                        12250001
01131 *            ---- WAIT 15 SECONDS, THEN RETRY ----                12260001
01132              MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER            12270001
01133          WHEN SQLWARN0 NOT = SPACES                               12280001
01134          WHEN SQLCODE  NOT = ZERO                                 12290001
01135              MOVE '5150-UPDATE-TNETVND-ROW'                       12300001
01136                                TO DP013-PARAGRAPH                 12310001
01137              MOVE 'UPDATING A ROW IN THE TABLE'                   12320001
01138                                TO DP013-MESSAGE-TEXT(1)           12330001
01139              MOVE 'TNETVND'    TO DP013-DB2-TABLE-NAME (1)        12340001
01140              MOVE SQLCA        TO DP013-SQLCA                     12350001
01141              SET DP013-DB2-ABEND                                  12360001
01142                  DP013-XCTL-DISPLAY-RESTART TO TRUE               12370001
01143              PERFORM DP013-0000-PROCESS-ABEND                     12380001
01144      END-EVALUATE.                                                12390001
01145                                                                   12400001
01146                                                                   12410001
01147  5200-DELETE-VENDOR.                                              12420001
01148                                                                   12430001
01149      PERFORM 5250-DELETE-TNETVND-ROW.                             12440001
01150                                                                   12450001
01151      EVALUATE TRUE                                                12460001
01152          WHEN SQLCODE = 0                                         12470001
01153 *            ---- DELETE SUCCESSFUL ----                          12480001
01154              MOVE PC-TSYMSG-00115         TO DP020-MSG-NUMBER     12490001
01155              SET  DP020-MSG-INFORMATIONAL                         12500001
01156                  ASC-DATA-DOES-NOT-EXIST  TO TRUE                 12510001
01157              PERFORM 9100-READ-SEL-QUEUE                          12520001
01158              SET ET301-DEL (ASC-SEL-SUB)  TO TRUE                 12530001
01159              PERFORM 9200-REWRITE-SEL-QUEUE                       12540001
01160              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12550001
01161          WHEN SQLCODE = +100                                      12560001
01162 *            ---- CANNOT DELETE - RECORD DOES NOT EXIST ----      12570001
01163              MOVE PC-TSYMSG-00116         TO DP020-MSG-NUMBER     12580001
01164              SET  DP020-MSG-FATAL                                 12590001
01165                   ASC-DATA-DOES-NOT-EXIST TO TRUE                 12600001
01166          WHEN OTHER                                               12610001
01167              SET DP020-MSG-WARNING TO TRUE                        12620001
01168 *        ---- WAIT 15 SECONDS, THEN RETRY ----                    12630001
01169              MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER            12640001
01170      END-EVALUATE.                                                12650001
01171                                                                   12660001
01172                                                                   12670001
01173  5250-DELETE-TNETVND-ROW.                                         12680001
01174                                                                   12690001
01175      EXEC SQL                                                     12700001
01176          DELETE FROM TNETVND                                      12710001
01177          WHERE  NETWK_ID = :ASC-NETWORK-ID                        12720001
01178            AND  ENT_ID   = :ASC-ENT-ID                            12730001
01179      END-EXEC.                                                    12740001
01180                                                                   12750001
01181      EVALUATE TRUE                                                12760001
01182          WHEN SQLCODE = ZERO                                      12770001
01183          WHEN SQLCODE = +100                                      12780001
01184          WHEN SQLCODE = -904                                      12790001
01185          WHEN SQLCODE = -913                                      12800001
01186              CONTINUE                                             12810001
01187          WHEN SQLWARN0 NOT = SPACES                               12820001
01188          WHEN SQLCODE  NOT = ZERO                                 12830001
01189              MOVE '5250-DELETE-TNETVND-ROW'                       12840001
01190                                TO DP013-PARAGRAPH                 12850001
01191              MOVE 'DELETING A ROW FROM THE TABLE'                 12860001
01192                                TO DP013-MESSAGE-TEXT(1)           12870001
01193              MOVE 'TNETVND'    TO DP013-DB2-TABLE-NAME (1)        12880001
01194              MOVE SQLCA        TO DP013-SQLCA                     12890001
01195              SET DP013-DB2-ABEND                                  12900001
01196                  DP013-XCTL-DISPLAY-RESTART TO TRUE               12910001
01197              PERFORM DP013-0000-PROCESS-ABEND                     12920001
01198      END-EVALUATE.                                                12930001
01199                                                                   12940001
01200                                                                   12950001
01201 *----------------------------------------------------------------*12960001
01202 * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *12970001
01203 *----------------------------------------------------------------*12980001
01204  9100-READ-SEL-QUEUE.                                             12990001
01205                                                                   13000001
01206      EXEC CICS                                                    13010001
01207          READQ TS                                                 13020001
01208              QUEUE (ASC-SEL-QUEUE-NAME)                           13030001
01209              INTO  (ET301-SELECTED-VNDRS)                         13040001
01210              ITEM  (ASC-SEL-ITEM)                                 13050001
01211              RESP  (PV-CICS-RESP)                                 13060001
01212      END-EXEC.                                                    13070001
01213                                                                   13080001
01214      IF  PV-CICS-RESP = DFHRESP(NORMAL)                           13090001
01215          CONTINUE                                                 13100001
01216      ELSE                                                         13110001
01217          SET DP013-LOGIC-ABEND                                    13120001
01218              DP013-NO-ROLLBACK      TO TRUE                       13130001
01219          MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            13140001
01220          MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   13150001
01221                                     TO DP013-MESSAGE-TEXT (1)     13160001
01222          PERFORM DP013-0000-PROCESS-ABEND                         13170001
01223      END-IF.                                                      13180001
01224                                                                   13190001
01225                                                                   13200001
01226 *----------------------------------------------------------------*13210001
01227 * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *13220001
01228 *----------------------------------------------------------------*13230001
01229  9200-REWRITE-SEL-QUEUE.                                          13240001
01230                                                                   13250001
01231      EXEC CICS                                                    13260001
01232           WRITEQ TS                                               13270001
01233               QUEUE  (ASC-SEL-QUEUE-NAME)                         13280001
01234               FROM   (ET301-SELECTED-VNDRS)                       13290001
01235               ITEM   (ASC-SEL-ITEM)                               13300001
01236               RESP   (PV-CICS-RESP)                               13310001
01237               REWRITE                                             13320001
01238      END-EXEC.                                                    13330001
01239                                                                   13340001
01240      IF  PV-CICS-RESP NOT = DFHRESP(NORMAL)                       13350001
01241          SET DP013-CICS-ABEND                                     13360001
01242              DP013-NO-ROLLBACK         TO TRUE                    13370001
01243          MOVE '9200-REWRITE-SEL-QUEUE' TO DP013-PARAGRAPH         13380001
01244          MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   13390001
01245                                        TO DP013-MESSAGE-TEXT (1)  13400001
01246          PERFORM DP013-0000-PROCESS-ABEND                         13410001
01247      END-IF.                                                      13420001
01248                                                                   13430001
01249                                                                   13440001
01250 *----------------------------------------------------------------*13450001
01251 *    ABEND PROCESSOR MODULE                                      *13460001
01252 *----------------------------------------------------------------*13470001
01253                                                                   13480001
01254      COPY DPPD013.                                                13490001
