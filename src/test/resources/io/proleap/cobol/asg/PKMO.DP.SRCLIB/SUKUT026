000100***************************************************************** 00010030
000200 IDENTIFICATION DIVISION.                                         00020030
000300***************************************************************** 00030030
000400 PROGRAM-ID.    SUKUT026.                                         00040030
000500 AUTHOR.        JOE LAROSA.                                       00050030
000600 INSTALLATION.  KOHLS.                                            00060030
000700 DATE-WRITTEN   SEPTEMBER 1999.                                   00070030
000800 DATE-COMPILED.                                                   00080030
000900***************************************************************** 00090030
001000*  THIS PROGRAM CREATES AN EXTRACT FILE OF DATA FROM THE CARTON * 00100030
001100*  CHECK-IN DATABASE (TSHUNLO) FOR A GIVEN PERIOD OF TIME.  THE * 00110030
001200*  EXTRACT FILE (SURD007) WILL BE USED TO CREATE THE CHECK-IN   * 00120030
001300*  SUMMARY REPORT (SUKRP019).                                   * 00130030
001400*  VALID TIMEFRAMES ARE: W=WEEKLY                               * 00140030
001500*  IF THE DATES IN THE CONTROL CARD = DEFAULT (9999-09-09)      * 00150030
001600*  THE PROGRAM WILL CALCULATE THE BEGINNING AND ENDING DATES    * 00160030
001700***************************************************************** 00170030
001800*  CHANGED MM/DD/YY BY XXXXXXXXXXX                              * 00180030
001900*   WR# XXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX * 00190030
002000*                                                               * 00200030
002100***************************************************************** 00210030
002200***************************************************************** 00220030
002300 ENVIRONMENT DIVISION.                                            00230030
002400***************************************************************** 00240030
002500 INPUT-OUTPUT SECTION.                                            00250030
002600                                                                  00260030
002700 FILE-CONTROL.                                                    00270030
002800                                                                  00280030
002900     SELECT DATE-FILE      ASSIGN TO UT-S-OUT01.                  00290030
003000     SELECT EXTRACT-FILE   ASSIGN TO UT-S-OUT02.                  00300030
003100                                                                  00310030
003200***************************************************************** 00320030
003300 DATA DIVISION.                                                   00330030
003400***************************************************************** 00340030
003500 FILE SECTION.                                                    00350030
003600*                                                                 00360030
003700 FD  DATE-FILE                                                    00370030
003800     RECORDING MODE IS F                                          00380030
003900     LABEL RECORDS ARE STANDARD                                   00390030
004000     RECORD CONTAINS 80                                           00400030
004100     BLOCK CONTAINS 0 RECORDS                                     00410030
004200     DATA RECORD IS DATE-RECORD.                                  00420030
004300 01  DATE-RECORD                 PIC X(80).                       00430030
004400*                                                                 00440030
004500 FD  EXTRACT-FILE                                                 00450030
004600     RECORDING MODE IS F                                          00460030
004700     LABEL RECORDS ARE STANDARD                                   00470030
004800     RECORD CONTAINS 100                                          00480030
004900     BLOCK CONTAINS 0 RECORDS                                     00490030
005000     DATA RECORD IS EXTRACT-RECORD.                               00500030
005100 01  EXTRACT-RECORD              PIC X(100).                      00510030
005200*                                                                 00520030
005300***************************************************************** 00530030
005400 WORKING-STORAGE SECTION.                                         00540030
005500                                                                  00550030
005600 01  PS-PROGRAM-SWITCHES.                                         00560030
005700     05  PS-EOF-LOC-SW                PIC X(01)  VALUE 'N'.       00570030
005800         88  PS-EOF-LOC-CURSOR                   VALUE 'Y'.       00580030
005900         88  PS-NOT-EOF-LOC-CURSOR               VALUE 'N'.       00590030
006000     05  PS-NORMAL-RUN-SW             PIC X(01)  VALUE 'N'.       00600030
006100         88  PS-NORMAL-RUN                       VALUE 'Y'.       00610030
006200         88  PS-SPECIAL-RUN                      VALUE 'N'.       00620030
006300     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE 'N'.       00630030
006400         88  PS-EOF-EXTRACT-CSR                  VALUE 'Y'.       00640030
006500         88  PS-NOT-EOF-EXTRACT-CSR              VALUE 'N'.       00650030
006510     05  PS-LOC-SW                    PIC X(01)  VALUE ' '.       00651030
006520         88  PS-LOC-UNKNOWN                      VALUE ' '.       00652030
006521         88  PS-LOC-FOUND                        VALUE 'Y'.       00652130
006522         88  PS-LOC-NOT-FOUND                    VALUE 'N'.       00652230
006523*                                                                 00652330
006524 01  LT-LOC-TABLE.                                                00652430
006525     05  LT-LOC-ENTRIES OCCURS 200 TIMES.                         00652530
006526         10  LT-LOC-NBR               PIC 9(05).                  00652630
006527*                                                                 00652730
006528 01  PV-PROGRAM-VARIABLES.                                        00652830
006529     05 PV-LT-SUB                     PIC S9(03)    VALUE +0      00652930
006530                                                    COMP-3.       00653030
006540     05 PV-SQL-SUB                    PIC S9(03)    VALUE +0      00654030
006550                                                    COMP-3.       00655030
006560     05 PV-DATE-AREA.                                             00656030
006570        10 PV-DATE-AREA-MM            PIC  9(02)    VALUE ZEROS.  00657030
006580        10 FILLER                     PIC  X(01)    VALUE '/'.    00658030
006590        10 PV-DATE-AREA-DD            PIC  9(02)    VALUE ZEROS.  00659030
006600        10 FILLER                     PIC  X(01)    VALUE '/'.    00660030
006700        10 PV-DATE-AREA-YY            PIC  9(02)    VALUE ZEROS.  00670030
006800*                                                                 00680030
006900     05  PV-DISPLAY-LOC-NBR           PIC  ZZZZ9    VALUE ZEROS.  00690030
007000     05  PV-ORGN-OPER-UNT-ID          PIC  9(05).                 00700030
007100     05  PV-DEST-OPER-UNT-ID          PIC  9(05).                 00710030
007200*                                                                 00720030
007300     05  PV-RETRY-COUNT               PIC S9(04)  VALUE +0        00730030
007400                                                  COMP SYNC.      00740030
007500     05 PV-CURRENT-DB2-DATE-ONE       PIC  X(10).                 00750030
007600     05 PV-CURRENT-DB2-DATE           PIC  X(10).                 00760030
007700     05 PV-CURRENT-DB2-DATE-ONEYR     PIC  X(10)  VALUE SPACES.   00770030
007800     05 FILLER REDEFINES PV-CURRENT-DB2-DATE-ONEYR.               00780030
007900        10 PV-CDD-ONEYR-CCYY          PIC  9(04).                 00790030
008000        10 FILLER                     PIC  X(06).                 00800030
008100     05 PV-CURR-DATE.                                             00810030
008200         10 PV-CURRENT-DB2-CCYY.                                  00820030
008300            15 PV-CURRENT-DB2-CC       PIC  9(02)    VALUE 0.     00830030
008400            15 PV-CURRENT-DB2-YY       PIC  9(02)    VALUE 0.     00840030
008500         10 FILLER                     PIC  X(01)    VALUE '-'.   00850030
008600         10 PV-CURRENT-DB2-MM          PIC  9(02)    VALUE 0.     00860030
008700         10 FILLER                     PIC  X(01)    VALUE '-'.   00870030
008800         10 PV-CURRENT-DB2-DD          PIC  9(02)    VALUE 0.     00880030
008900     05 PV-CURRENT-DATE.                                          00890030
009000         10 PV-CURRENT-CCYY.                                      00900030
009100            15 PV-CURRENT-CC           PIC  9(02)    VALUE 0.     00910030
009200            15 PV-CURRENT-YY           PIC  9(02)    VALUE 0.     00920030
009300         10 PV-CURRENT-MM              PIC  9(02)    VALUE 0.     00930030
009400         10 PV-CURRENT-DD              PIC  9(02)    VALUE 0.     00940030
009500     05 PV-CURRENT-YYMMDD-DATE.                                   00950030
009600         10 PV-CURRENT-YYMMDD-YY       PIC  9(02)    VALUE 0.     00960030
009700         10 PV-CURRENT-YYMMDD-MM       PIC  9(02)    VALUE 0.     00970030
009800         10 PV-CURRENT-YYMMDD-DD       PIC  9(02)    VALUE 0.     00980030
009900      05 PV-BEG-DATE-CYMD.                                        00990030
010000         10 PV-BEG-YMD-CC              PIC  9(02)    VALUE ZEROS. 01000030
010100         10 PV-BEG-YMD-YY              PIC  9(02)    VALUE ZEROS. 01010030
010200         10 PV-BEG-YMD-MM              PIC  9(02)    VALUE ZEROS. 01020030
010300         10 PV-BEG-YMD-DD              PIC  9(02)    VALUE ZEROS. 01030030
010400      05 PV-END-DATE-CYMD.                                        01040030
010500         10 PV-END-YMD-CC              PIC  9(02)    VALUE ZEROS. 01050030
010600         10 PV-END-YMD-YY              PIC  9(02)    VALUE ZEROS. 01060030
010700         10 PV-END-YMD-MM              PIC  9(02)    VALUE ZEROS. 01070030
010800         10 PV-END-YMD-DD              PIC  9(02)    VALUE ZEROS. 01080030
010900      05 PV-BEG-DATE.                                             01090030
011000         10 PV-BEG-MM                  PIC  9(02)    VALUE ZEROS. 01100030
011100         10 FILLER                     PIC  X(01)    VALUE '/'.   01110030
011200         10 PV-BEG-DD                  PIC  9(02)    VALUE ZEROS. 01120030
011300         10 FILLER                     PIC  X(01)    VALUE '/'.   01130030
011400         10 PV-BEG-YY                  PIC  9(02)    VALUE ZEROS. 01140030
011500      05 PV-END-DATE.                                             01150030
011600         10 PV-END-MM                  PIC  9(02)    VALUE ZEROS. 01160030
011700         10 FILLER                     PIC  X(01)    VALUE '/'.   01170030
011800         10 PV-END-DD                  PIC  9(02)    VALUE ZEROS. 01180030
011900         10 FILLER                     PIC  X(01)    VALUE '/'.   01190030
012000         10 PV-END-YY                  PIC  9(02)    VALUE ZEROS. 01200030
012100      05 PV-START-EXTRACT              PIC X(26)     VALUE SPACE. 01210030
012200      05 FILLER  REDEFINES PV-START-EXTRACT.                      01220030
012300         10 PV-START-EXTRACT-YYYY      PIC 9999.                  01230030
012400         10 PV-START-EXTRACT-1ST       PIC X.                     01240030
012500         10 PV-START-EXTRACT-MM        PIC 99.                    01250030
012600         10 PV-START-EXTRACT-2ND       PIC X.                     01260030
012700         10 PV-START-EXTRACT-DD        PIC 99.                    01270030
012800         10 PV-START-EXTRACT-3RD       PIC X.                     01280030
012900         10 PV-START-TIMESTAMP         PIC X(15).                 01290030
013000      05 PV-END-EXTRACT                PIC X(26)     VALUE SPACE. 01300030
013100      05 FILLER  REDEFINES PV-END-EXTRACT.                        01310030
013200         10 PV-END-EXTRACT-YYYY        PIC 9999.                  01320030
013300         10 PV-END-EXTRACT-YYYY-RE REDEFINES PV-END-EXTRACT-YYYY. 01330030
013400            15 PV-END-EXTRACT-CC       PIC 99.                    01340030
013500            15 PV-END-EXTRACT-YY       PIC 99.                    01350030
013600         10 PV-END-EXTRACT-1ST         PIC X.                     01360030
013700         10 PV-END-EXTRACT-MM          PIC 99.                    01370030
013800         10 PV-END-EXTRACT-2ND         PIC X.                     01380030
013900         10 PV-END-EXTRACT-DD          PIC 99.                    01390030
014000         10 PV-END-EXTRACT-3RD         PIC X.                     01400030
014100         10 PV-END-TIMESTAMP           PIC X(15).                 01410030
014200     05  PV-SQLCODE                   PIC 9(9)  VALUE ZERO.       01420030
014300     05  PV-YEAR-FORMAT.                                          01430030
014400        10  PV-YEAR-FORMAT-CC         PIC 9(02) VALUE 0.          01440030
014500        10  PV-YEAR-FORMAT-YY         PIC 9(02) VALUE 0.          01450030
014600 01  PV-DATETIME-WORK.                                            01460030
014700     05  PV-DATETIME-CC           PIC 9(02).                      01470030
014800     05  PV-DATETIME-YY           PIC 9(02).                      01480030
014900     05  FILLER                   PIC X(01)  VALUE '-'.           01490030
015000     05  PV-DATETIME-MM           PIC 9(02).                      01500030
015100     05  FILLER                   PIC X(01)  VALUE '-'.           01510030
015200     05  PV-DATETIME-DD           PIC 9(02).                      01520030
015300     05  FILLER                   PIC X(01)  VALUE '-'.           01530030
015400     05  PV-DATETIME-HO           PIC 9(02).                      01540030
015500     05  FILLER                   PIC X(01)  VALUE '.'.           01550030
015600     05  PV-DATETIME-MI           PIC 9(02).                      01560030
015700     05  FILLER                   PIC X(01)  VALUE '.'.           01570030
015800     05  PV-DATETIME-SS           PIC 9(02).                      01580030
015900     05  FILLER                   PIC X(01)  VALUE '.'.           01590030
016000     05  PV-DATETIME-MSEC         PIC 9(06).                      01600030
016100                                                                  01610030
016200 01  PV-DATE-RECORD.                                              01620030
016300     05  PV-DATE-START-MM             PIC X(02) VALUE SPACE.      01630030
016400     05  FILLER                       PIC X(01) VALUE '/'.        01640030
016500     05  PV-DATE-START-DD             PIC X(02) VALUE SPACE.      01650030
016600     05  FILLER                       PIC X(01) VALUE '/'.        01660030
016700     05  PV-DATE-START-CCYY           PIC X(04) VALUE SPACE.      01670030
016800     05  FILLER                       PIC X(01) VALUE SPACE.      01680030
016900     05  PV-DATE-END-MM               PIC X(02) VALUE SPACE.      01690030
017000     05  FILLER                       PIC X(01) VALUE '/'.        01700030
017100     05  PV-DATE-END-DD               PIC X(02) VALUE SPACE.      01710030
017200     05  FILLER                       PIC X(01) VALUE '/'.        01720030
017300     05  PV-DATE-END-CCYY             PIC X(04) VALUE SPACE.      01730030
017400     05  FILLER                       PIC X(01) VALUE SPACE.      01740030
017500     05  PV-DATE-FISCAL-PERIOD        PIC 9(02) VALUE ZEROES.     01750030
017600     05  FILLER                       PIC X(01) VALUE SPACE.      01760030
017700     05  PV-DATE-FISCAL-QUARTER       PIC 9(01) VALUE ZERO.       01770030
017800     05  FILLER                       PIC X(01) VALUE SPACE.      01780030
017900     05  PV-REQUEST                   PIC X(07) VALUE SPACES.     01790030
018000     05  FILLER                       PIC X(46) VALUE SPACES.     01800030
018100                                                                  01810030
018200 01 PC-PROGRAM-CONSTANTS.                                         01820030
018300     05 PC-PROGRAM-NAME               PIC X(08)  VALUE 'SUKUT026'.01830030
018400     05 PC-ONE                        PIC 9(01) VALUE 1.          01840030
018500     05 PC-SEVEN                      PIC 9(02) VALUE 7.          01850030
018600     05 PC-TWENTY-EIGHT               PIC 9(02) VALUE 28.         01860030
018700     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         01870030
018800                                                 COMP SYNC.       01880030
018900     05  PC-DEFAULT-CC-DATE          PIC X(10) VALUE '9999-09-09'.01890030
019000     05  PC-SYSTEM-DATE              PIC  9(06)    VALUE ZERO.    01900030
019100                                                                  01910030
019200 01 CC-CONTROL-CARD-PARAMETERS.                                   01920030
019300    05 CC-BEG-DATE.                                               01930030
019400       10 CC-BEG-CC                   PIC 9(02) VALUE ZEROS.      01940030
019500       10 CC-BEG-YY                   PIC 9(02) VALUE ZEROS.      01950030
019600       10 FILLER                      PIC X(01) VALUE SPACE.      01960030
019700       10 CC-BEG-MM                   PIC 9(02) VALUE ZEROS.      01970030
019800       10 FILLER                      PIC X(01) VALUE SPACE.      01980030
019900       10 CC-BEG-DD                   PIC 9(02) VALUE ZEROS.      01990030
020000    05 FILLER                         PIC X(01) VALUE SPACE.      02000030
020100    05 CC-END-DATE.                                               02010030
020200       10 CC-END-CC                   PIC 9(02) VALUE ZEROS.      02020030
020300       10 CC-END-YY                   PIC 9(02) VALUE ZEROS.      02030030
020400       10 FILLER                      PIC X(01) VALUE SPACE.      02040030
020500       10 CC-END-MM                   PIC 9(02) VALUE ZEROS.      02050030
020600       10 FILLER                      PIC X(01) VALUE SPACE.      02060030
020700       10 CC-END-DD                   PIC 9(02) VALUE ZEROS.      02070030
020800    05 FILLER                         PIC X(01) VALUE SPACE.      02080030
020900    05 CC-MODE-IND                    PIC X(02) VALUE SPACE.      02090030
021000       88 CC-VALID-MODE-IND                     VALUE 'CC'.       02100030
021100    05 FILLER                         PIC X(56) VALUE SPACE.      02110030
021200                                                                  02120030
021300 01  PV-ABEND-FIELDS.                                             02130030
021400     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         02140030
021500                                                 COMP SYNC.       02150030
021600     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT026'.02160030
021700     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    02170030
021800     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    02180030
021900     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    02190030
022000     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    02200030
022100     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    02210030
022200     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    02220030
022300     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    02230030
022400     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    02240030
022500     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    02250030
022600     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    02260030
022700                                                                  02270030
022800 01  WS-WORKING-STORAGE-HOLD-FIELDS.                              02280030
022900     05  WS-FISCAL-PERIOD-NBR         PIC  9(02) VALUE ZEROES.    02290030
023000     05  WS-FISCAL-PERIOD-WEEK        PIC  9(02) VALUE ZEROES.    02300030
023100     05  WS-FISCAL-QTR-NBR            PIC  9(01) VALUE ZERO.      02310030
023200     05  WS-FISCAL-WEEK-NBR           PIC  9(02) VALUE ZEROES.    02320030
023300                                                                  02330030
023400     05  WS-RECORDS-READ              PIC  9(09) VALUE ZEROES.    02340030
023500     05  WS-RECORDS-WRITTEN           PIC  9(09) VALUE ZEROES.    02350030
023600                                                                  02360030
023700      05 WS-START-EXTRACT.                                        02370030
023800         10 WS-START-EXTRACT-YYYY      PIC 9999.                  02380030
023900         10 WS-START-EXTRACT-MM        PIC 99.                    02390030
024000         10 WS-START-EXTRACT-DD        PIC 99.                    02400030
024100                                                                  02410030
024200      05 WS-END-EXTRACT.                                          02420030
024300         10 WS-END-EXTRACT-YYYY        PIC 9999.                  02430030
024400         10 WS-END-EXTRACT-MM          PIC 99.                    02440030
024500         10 WS-END-EXTRACT-DD          PIC 99.                    02450030
024600                                                                  02460030
024700******************************************************************02470030
024800*  USED FOR DB2 ERROR MESSAGE BUILDING                            02480030
024900******************************************************************02490030
025000     COPY DPWS004.                                                02500030
025100                                                                  02510030
025200******************************************************************02520030
025300*   DB2 SQL COMMUNICATION AREA                                    02530030
025400******************************************************************02540030
025500     EXEC SQL                                                     02550030
025600          INCLUDE SQLCA                                           02560030
025700     END-EXEC.                                                    02570030
025800                                                                  02580030
025900******************************************************************02590030
026000*   DB2 DCLGEN FOR COMPANY CONTROL TABLE                          02600030
026100******************************************************************02610030
026200     EXEC SQL                                                     02620030
026300          INCLUDE TCOCNTL                                         02630030
026400     END-EXEC.                                                    02640030
026500                                                                  02650030
026600******************************************************************02660030
026700*   DB2 DCLGEN FOR SHIP UNIT TABLE                                02670030
026800******************************************************************02680030
026900     EXEC SQL                                                     02690030
027000          INCLUDE TSHPUNT                                         02700030
027100     END-EXEC.                                                    02710030
027200                                                                  02720030
027300******************************************************************02730030
027400*   DB2 DCLGEN FOR SHIP UNLOAD TABLE                              02740030
027500******************************************************************02750030
027600     EXEC SQL                                                     02760030
027700          INCLUDE TSHUNLO                                         02770030
027800     END-EXEC.                                                    02780030
027900                                                                  02790030
028000******************************************************************02800030
028100*  DCLGEN FOR THE LOGISTICS DOMAIN LOCATION MASTER TABLE          02810030
028200******************************************************************02820030
028300     EXEC SQL                                                     02830030
028400         INCLUDE XLT00010                                         02840030
028500     END-EXEC.                                                    02850030
028600                                                                  02860030
028700******************************************************************02870030
028800* LOCATION MASTER CURSOR                                         *02880030
028900******************************************************************02890030
029000     EXEC SQL                                                     02900030
029100       DECLARE LOC-CSR CURSOR FOR                                 02910030
029200       SELECT LOC_NBR                                             02920030
029300         FROM XLT_LOC                                             02930030
029400        WHERE LOC_TYP_CDE = 'DC'                                  02940030
029500           OR LOC_TYP_CDE = 'RV'                                  02950030
029600           OR LOC_TYP_CDE = 'CS'                                  02960030
029700     END-EXEC.                                                    02970030
029800                                                                  02980030
029900                                                                  02990030
030000******************************************************************03000030
030100* EXTRACT CURSOR                                                 *03010030
030200******************************************************************03020030
030300     EXEC SQL                                                     03030030
030400          DECLARE EXTRACT-CSR CURSOR FOR                          03040030
030500          SELECT A.SHIPT_UNT_ID,                                  03050030
030600                 A.OPER_UNT_ID,                                   03060030
030700                 A.FCLTY_ID,                                      03070030
030800                 A.SCN_LOC_ID,                                    03080030
030900                 A.CRE_USR_ID,                                    03090030
031000                 A.CRE_TMST,                                      03100030
031100                 A.TRIP_ID,                                       03110030
031200                 A.PRTR_TYP_CDE,                                  03120030
031300                 A.LBL_PRT_BTCH_ID,                               03130030
031400                 B.ORGN_OPER_UNT_ID,                              03140030
031500                 B.DEST_OPER_UNT_ID                               03150030
031600          FROM  TSHUNLO A,                                        03160030
031700                TSHPUNT B                                         03170030
031800          WHERE (DATE(A.CRE_TMST)  >=  :PV-START-EXTRACT AND      03180030
031900                 DATE(A.CRE_TMST)  <=  :PV-END-EXTRACT)           03190030
032000           AND  A.SCN_LOC_ID   =  'RECV'                          03200030
032100           AND  A.ACTV_CDE     = 'A'                              03210030
032200           AND  A.SHIPT_UNT_ID =  B.SHIPT_UNT_ID                  03220030
032300           AND  B.ACTV_IND     = 'A'                              03230030
032400     END-EXEC.                                                    03240030
032500                                                                  03250030
032600***********************************************************       03260030
032700*  COPYBOOK USED BY CALENDAR ROUTINE                      *       03270030
032800***********************************************************       03280030
032900     COPY DPWS500.                                                03290030
033000                                                                  03300030
033100***********************************************************       03310030
033200*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       03320030
033300***********************************************************       03330030
033400     COPY SURD007.                                                03340030
033500                                                                  03350030
033600 EJECT                                                            03360030
033700***********************************************************       03370030
033800 PROCEDURE DIVISION.                                              03380030
033900***********************************************************       03390030
034000     DISPLAY '***BEGINNING SUKUT026***'.                          03400030
034100*                                                                 03410030
034200     PERFORM 1000-INITIALIZATION.                                 03420030
034300*                                                                 03430030
034400     SET PS-NOT-EOF-EXTRACT-CSR TO TRUE.                          03440030
034500     PERFORM 1900-OPEN-EXTRACT-CURSOR.                            03450030
034600*                                                                 03460030
034700     PERFORM 2000-PROCESS-EXTRACTS                                03470030
034800         UNTIL PS-EOF-EXTRACT-CSR.                                03480030
034900*                                                                 03490030
035000     PERFORM 3000-CLOSE-EXTRACT-CSR.                              03500030
035100*                                                                 03510030
035200     CLOSE DATE-FILE                                              03520030
035300           EXTRACT-FILE.                                          03530030
035400*                                                                 03540030
035500     GOBACK.                                                      03550030
035600*                                                                 03560030
035700*                                                                 03570030
035800***********************************************************       03580030
035900 1000-INITIALIZATION.                                             03590030
036000***********************************************************       03600030
036100     MOVE '1000-INITIALIZATION     ' TO PV-ABEND-PARAGRAPH.       03610030
036200                                                                  03620030
036300     OPEN OUTPUT DATE-FILE                                        03630030
036400                 EXTRACT-FILE.                                    03640030
036500                                                                  03650030
036600     ACCEPT PC-SYSTEM-DATE FROM DATE.                             03660030
036700                                                                  03670030
036800     EXEC SQL                                                     03680030
036900         SELECT  CURRENT DATE                                     03690030
037000           INTO  :PV-CURRENT-DB2-DATE                             03700030
037100           FROM  TCOCNTL                                          03710030
037200          WHERE  OPER_UNT_ID = 90                                 03720030
037300     END-EXEC.                                                    03730030
037400                                                                  03740030
037500     EVALUATE TRUE                                                03750030
037600         WHEN SQLCODE = ZERO                                      03760030
037700             MOVE PV-CURRENT-DB2-DATE    TO PV-CURR-DATE          03770030
037800             MOVE PV-CURRENT-DB2-CC      TO PV-CURRENT-CC         03780030
037900             MOVE PV-CURRENT-DB2-YY      TO PV-CURRENT-YY         03790030
038000                                            PV-CURRENT-YYMMDD-YY  03800030
038100             MOVE PV-CURRENT-DB2-MM      TO PV-CURRENT-MM         03810030
038200                                            PV-CURRENT-YYMMDD-MM  03820030
038300             MOVE PV-CURRENT-DB2-DD      TO PV-CURRENT-DD         03830030
038400                                            PV-CURRENT-YYMMDD-DD  03840030
038500         WHEN OTHER                                               03850030
038600             MOVE '1100-INITIALIZATION'  TO                       03860030
038700                   PV-ABEND-PARAGRAPH                             03870030
038800             MOVE 'SET DATE   '  TO PV-DB2-OPERATION-MESSAGE-1    03880030
038900             MOVE 'NONE   '      TO PV-DB2-TABLE-NAME             03890030
039000             PERFORM Z999-SQL-ABEND                               03900030
039100      END-EVALUATE.                                               03910030
039200                                                                  03920030
039300     SET PS-NORMAL-RUN TO TRUE.                                   03930030
039400     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                03940030
039500     DISPLAY '**************************************'.            03950030
039600     DISPLAY '*        PROGRAM - SUKUT026          *'.            03960030
039700     DISPLAY '**************************************'.            03970030
039800     DISPLAY '                                      '.            03980030
039900     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              03990030
040000             CC-CONTROL-CARD-PARAMETERS.                          04000030
040100*                                                                 04010030
040200     IF CC-BEG-DATE NOT = '9999-09-09'                            04020030
040300         PERFORM 1100-CHECK-CC-PARAMETERS.                        04030030
040400*                                                                 04040030
040500     PERFORM 1200-SET-DATABASE-KEYS.                              04050030
040600*                                                                 04060030
040700*LOAD LOCATION NUMBERS INTO WORKING STORAGE TABLE.                04070030
040800     INITIALIZE LT-LOC-TABLE.                                     04080030
040900*                                                                 04090030
041000     SET PS-NOT-EOF-LOC-CURSOR TO TRUE.                           04100030
041100     PERFORM 1500-OPEN-LOC-CURSOR.                                04110030
041200*                                                                 04120030
041300     MOVE +1 TO PV-LT-SUB.                                        04130030
041400     PERFORM 1600-LOAD-LOC-TABLE                                  04140030
041500         UNTIL PS-EOF-LOC-CURSOR.                                 04150030
041600*                                                                 04160030
041700     PERFORM 1700-CLOSE-LOC-CURSOR.                               04170030
041800*                                                                 04180030
041900*                                                                 04190030
042000***************************************************************** 04200030
042100 1100-CHECK-CC-PARAMETERS.                                        04210030
042200***************************************************************** 04220030
042300     MOVE '1100-CHECK-CC-PARAMETERS' TO PV-ABEND-PARAGRAPH.       04230030
042400*                                                                 04240030
042500     IF CC-BEG-DATE IS  = PC-DEFAULT-CC-DATE                      04250030
042600       AND CC-END-DATE IS  = PC-DEFAULT-CC-DATE                   04260030
042700         SET PS-NORMAL-RUN    TO TRUE                             04270030
042800     ELSE                                                         04280030
042900         SET PS-SPECIAL-RUN   TO TRUE                             04290030
043000         MOVE CC-BEG-CC       TO PV-BEG-YMD-CC                    04300030
043100         MOVE CC-BEG-YY       TO PV-BEG-YY                        04310030
043200         MOVE CC-BEG-YY       TO PV-BEG-YMD-YY                    04320030
043300         MOVE CC-BEG-MM       TO PV-BEG-MM                        04330030
043400         MOVE CC-BEG-MM       TO PV-BEG-YMD-MM                    04340030
043500         MOVE CC-BEG-DD       TO PV-BEG-DD                        04350030
043600         MOVE CC-BEG-DD       TO PV-BEG-YMD-DD                    04360030
043700         MOVE CC-END-CC       TO PV-END-YMD-CC                    04370030
043800         MOVE CC-END-YY       TO PV-END-YY                        04380030
043900         MOVE CC-END-YY       TO PV-END-YMD-YY                    04390030
044000         MOVE CC-END-MM       TO PV-END-MM                        04400030
044100         MOVE CC-END-MM       TO PV-END-YMD-MM                    04410030
044200         MOVE CC-END-DD       TO PV-END-DD                        04420030
044300         MOVE CC-END-DD       TO PV-END-YMD-DD                    04430030
044400*                                                                 04440030
044500         IF PV-BEG-DATE-CYMD IS NOT < PV-END-DATE-CYMD            04450030
044600           AND PV-BEG-DATE-CYMD IS NOT = PV-END-DATE-CYMD         04460030
044700             DISPLAY '***************************'                04470030
044800             DISPLAY 'CONTROL PARAMETERS: '                       04480030
044900                      CC-CONTROL-CARD-PARAMETERS                  04490030
045000             DISPLAY                                              04500030
045100               'THE BEGINNING DATE MUST BE LESS THAN '            04510030
045200               'OR EQUAL TO THE ENDING DATE'                      04520030
045300             DISPLAY 'PV-BEG-DATE - ' PV-BEG-DATE                 04530030
045400             DISPLAY 'PV-END-DATE - ' PV-BEG-DATE                 04540030
045500             DISPLAY 'PV-BEG-DATE-CYMD - ' PV-BEG-DATE-CYMD       04550030
045600             DISPLAY 'PV-END-DATE-CYMD - ' PV-BEG-DATE-CYMD       04560030
045700             DISPLAY 'RUN ABORTED'                                04570030
045800             DISPLAY '***************************'                04580030
045900             MOVE 4003 TO PV-ABEND-CODE                           04590030
046000             DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE             04600030
046100             CALL 'ILBOABN0'  USING PV-ABEND-CODE                 04610030
046200         END-IF                                                   04620030
046300*                                                                 04630030
046400        INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            04640030
046500        SET DPG51-FISCAL-454-CALENDAR   TO TRUE                   04650030
046600        SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                   04660030
046700        SET DPG52-LK-DTE-GREG-FMT       TO TRUE                   04670030
046800        MOVE PV-BEG-DATE                TO DPG52-LK-DATE-INPUT    04680030
046900        PERFORM 9100-CALL-DATE-MODULE                             04690030
047000        IF DPG54-DATE-INVALID                                     04700030
047100           DISPLAY '***************************'                  04710030
047200           DISPLAY 'CONTROL PARAMETERS: '                         04720030
047300                    CC-CONTROL-CARD-PARAMETERS                    04730030
047400           DISPLAY 'BEGINNING DATE  '                             04740030
047500                   CC-BEG-DATE                                    04750030
047600                   ' IS INVALID.'                                 04760030
047700           DISPLAY 'RUN ABORTED'                                  04770030
047800           DISPLAY '***************************'                  04780030
047900           MOVE 4003  TO PV-ABEND-CODE                            04790030
048000           DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE               04800030
048100           CALL 'ILBOABN0'   USING PV-ABEND-CODE                  04810030
048200        END-IF                                                    04820030
048300        INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            04830030
048400        SET DPG51-FISCAL-454-CALENDAR   TO TRUE                   04840030
048500        SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                   04850030
048600        SET DPG52-LK-DTE-GREG-FMT       TO TRUE                   04860030
048700        MOVE PV-END-DATE                TO DPG52-LK-DATE-INPUT    04870030
048800        PERFORM 9100-CALL-DATE-MODULE                             04880030
048900        IF DPG54-DATE-INVALID                                     04890030
049000           DISPLAY '***************************'                  04900030
049100           DISPLAY 'CONTROL PARAMETERS: '                         04910030
049200                    CC-CONTROL-CARD-PARAMETERS                    04920030
049300           DISPLAY 'ENDING DATE '                                 04930030
049400                   CC-END-DATE                                    04940030
049500                   ' IS INVALID.'                                 04950030
049600           DISPLAY 'RUN ABORTED'                                  04960030
049700           DISPLAY '***************************'                  04970030
049800           MOVE 4003  TO PV-ABEND-CODE                            04980030
049900           DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE               04990030
050000           CALL 'ILBOABN0'   USING PV-ABEND-CODE                  05000030
050100        END-IF                                                    05010030
050200     END-IF.                                                      05020030
050300                                                                  05030030
050400***************************************************************** 05040030
050500 1200-SET-DATABASE-KEYS.                                          05050030
050600***************************************************************** 05060030
050700     MOVE '1200-SET-DATABASE-KEYS  ' TO PV-ABEND-PARAGRAPH.       05070030
050800*                                                                 05080030
050900     IF PS-NORMAL-RUN                                             05090030
051000         PERFORM 1210-DETERMINE-DATE-RANGE                        05100030
051100     ELSE                                                         05110030
051200         MOVE CC-BEG-DATE TO PV-START-EXTRACT                     05120030
051300         MOVE CC-END-DATE TO PV-END-EXTRACT                       05130030
051400     END-IF.                                                      05140030
051500*                                                                 05150030
051600     MOVE  PV-START-EXTRACT-YYYY    TO  WS-START-EXTRACT-YYYY.    05160030
051700     MOVE  PV-START-EXTRACT-MM      TO  WS-START-EXTRACT-MM.      05170030
051800     MOVE  PV-START-EXTRACT-DD      TO  WS-START-EXTRACT-DD.      05180030
051900     MOVE  PV-END-EXTRACT-YYYY      TO  WS-END-EXTRACT-YYYY.      05190030
052000     MOVE  PV-END-EXTRACT-MM        TO  WS-END-EXTRACT-MM.        05200030
052100     MOVE  PV-END-EXTRACT-DD        TO  WS-END-EXTRACT-DD.        05210030
052200*                                                                 05220030
052300     MOVE  PV-START-EXTRACT-YYYY    TO PV-DATE-START-CCYY.        05230030
052400     MOVE  PV-START-EXTRACT-MM      TO PV-DATE-START-MM.          05240030
052500     MOVE  PV-START-EXTRACT-DD      TO PV-DATE-START-DD.          05250030
052600     MOVE  PV-END-EXTRACT-YYYY      TO PV-DATE-END-CCYY.          05260030
052700     MOVE  PV-END-EXTRACT-MM        TO PV-DATE-END-MM.            05270030
052800     MOVE  PV-END-EXTRACT-DD        TO PV-DATE-END-DD.            05280030
052900*                                                                 05290030
053000     MOVE  DPG56-FISCAL-PERIOD-NBR  TO  WS-FISCAL-PERIOD-NBR.     05300030
053100     MOVE  DPG56-FISCAL-PERIOD-WEEK TO  WS-FISCAL-PERIOD-WEEK.    05310030
053200     MOVE  DPG56-FISCAL-QTR-NBR     TO  WS-FISCAL-QTR-NBR.        05320030
053300     MOVE  DPG56-FISCAL-WEEK-NBR    TO  WS-FISCAL-WEEK-NBR.       05330030
053400*                                                                 05340030
053500     MOVE  WS-FISCAL-PERIOD-NBR     TO PV-DATE-FISCAL-PERIOD.     05350030
053600     MOVE  WS-FISCAL-QTR-NBR        TO PV-DATE-FISCAL-QUARTER.    05360030
053700*                                                                 05370030
053800     IF PS-NORMAL-RUN                                             05380030
053900         MOVE 'NORMAL '             TO PV-REQUEST                 05390030
054000     ELSE                                                         05400030
054100         MOVE 'SPECIAL'             TO PV-REQUEST                 05410030
054200     END-IF.                                                      05420030
054300*                                                                 05430030
054400     DISPLAY 'DATE RANGE SET-UP FOR THIS RUN IS: '                05440030
054500             PV-DATE-RECORD.                                      05450030
054600*                                                                 05460030
054700     WRITE DATE-RECORD FROM PV-DATE-RECORD.                       05470030
054800*                                                                 05480030
054900*                                                                 05490030
055000***************************************************************** 05500030
055100 1210-DETERMINE-DATE-RANGE.                                       05510030
055200***************************************************************** 05520030
055300**** GET START/END DATES OF THE PREVIOUS WEEK.                    05530030
055400     MOVE '1210-DETERMINE-DATE-RANGE' TO PV-ABEND-PARAGRAPH.      05540030
055500*                                                                 05550030
055600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05560030
055700*                                                                 05570030
055800     MOVE PV-CURRENT-YY  TO  PV-DATE-AREA-YY.                     05580030
055900     MOVE PV-CURRENT-MM  TO  PV-DATE-AREA-MM.                     05590030
056000     MOVE PV-CURRENT-DD  TO  PV-DATE-AREA-DD.                     05600030
056100     MOVE PV-DATE-AREA   TO  DPG52-LK-DATE-INPUT.                 05610030
056200     MOVE PC-SEVEN       TO  DPG51-INCR-DECR-DAYS-9.              05620030
056300*                                                                 05630030
056400     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05640030
056500     SET DPG51-DECREMENT-DATE       TO TRUE.                      05650030
056600     SET DPG52-LK-DTE-GREG-FMT      TO TRUE.                      05660030
056700*                                                                 05670030
056800     PERFORM 9100-CALL-DATE-MODULE                                05680030
056900*                                                                 05690030
057000     IF DPG54-DATE-VALID                                          05700030
057100         MOVE DPG55-1ST-WKDY-DB2ISO-FMT  TO PV-START-EXTRACT      05710030
057200         MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO PV-END-EXTRACT        05720030
057300     ELSE                                                         05730030
057400         DISPLAY 'DPG55-1ST-WKDY-DB2ISO-FMT - '                   05740030
057500                  DPG55-1ST-WKDY-DB2ISO-FMT                       05750030
057600         DISPLAY 'DPG55-LAST-WKDY-DB2ISO-FMT - '                  05760030
057700                  DPG55-LAST-WKDY-DB2ISO-FMT                      05770030
057800     END-IF.                                                      05780030
057900*                                                                 05790030
058000*                                                                 05800030
058100***************************************************************** 05810030
058200 1500-OPEN-LOC-CURSOR.                                            05820030
058300***************************************************************** 05830030
058400     MOVE '1500-OPEN-LOC-CURSOR' TO PV-ABEND-PARAGRAPH.           05840030
058500*                                                                 05850030
058600     EXEC SQL                                                     05860030
058700         OPEN LOC-CSR                                             05870030
058800     END-EXEC                                                     05880030
058900*                                                                 05890030
059000     EVALUATE TRUE                                                05900030
059100         WHEN SQLCODE = ZERO                                      05910030
059200         WHEN SQLCODE = +100                                      05920030
059300             CONTINUE                                             05930030
059400         WHEN OTHER                                               05940030
059500             PERFORM Z999-SQL-ABEND                               05950030
059600       END-EVALUATE.                                              05960030
059700*                                                                 05970030
059800*                                                                 05980030
059900***************************************************************** 05990030
060000 1600-LOAD-LOC-TABLE.                                             06000030
060100***************************************************************** 06010030
060200*                                                                 06020030
060300     PERFORM 1610-FETCH-LOC-CURSOR.                               06030030
060400*                                                                 06040030
060500     IF PS-NOT-EOF-LOC-CURSOR                                     06050030
060600         MOVE XLT00010-LOC-NBR   TO LT-LOC-NBR (PV-LT-SUB)        06060030
060700                                    PV-DISPLAY-LOC-NBR            06070030
060800         DISPLAY '***  LOC NBR = ' PV-DISPLAY-LOC-NBR             06080030
060900         ADD +1                  TO PV-LT-SUB                     06090030
061000     END-IF.                                                      06100030
061100*                                                                 06110030
061200*                                                                 06120030
061300***************************************************************** 06130030
061400 1610-FETCH-LOC-CURSOR.                                           06140030
061500***************************************************************** 06150030
061600     MOVE '1610-FETCH-LOC-CSR' TO PV-ABEND-PARAGRAPH.             06160030
061700*                                                                 06170030
061800     PERFORM                                                      06180030
061900         WITH TEST AFTER                                          06190030
062000         VARYING PV-SQL-SUB                                       06200030
062100         FROM 1 BY 1                                              06210030
062200         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        06220030
062300            OR SQLCODE = ZERO                                     06230030
062400            OR SQLCODE = +100                                     06240030
062500*                                                                 06250030
062600         EXEC SQL                                                 06260030
062700             FETCH LOC-CSR                                        06270030
062800              INTO :XLT00010-LOC-NBR                              06280030
062900         END-EXEC                                                 06290030
063000*                                                                 06300030
063100         EVALUATE TRUE                                            06310030
063200             WHEN SQLCODE = ZERO                                  06320030
063300             WHEN SQLCODE = -904                                  06330030
063400             WHEN SQLCODE = -913                                  06340030
063500                 CONTINUE                                         06350030
063600             WHEN SQLCODE = +100                                  06360030
063700                 SET PS-EOF-LOC-CURSOR TO TRUE                    06370030
063800             WHEN SQLWARN0 NOT = SPACES                           06380030
063900             WHEN SQLCODE  NOT = ZERO                             06390030
064000                  PERFORM Z999-SQL-ABEND                          06400030
064100         END-EVALUATE                                             06410030
064200*                                                                 06420030
064300     END-PERFORM.                                                 06430030
064400*                                                                 06440030
064500     IF PV-SQL-SUB > PC-MAX-RETRIES                               06450030
064600         MOVE '1610-FETCH-LOC-CURSOR'                             06460030
064700                                 TO PV-ABEND-PARAGRAPH            06470030
064800         MOVE 'MAX RETRIES EXCEEDED'                              06480030
064900                                 TO PV-ABEND-OPERATION            06490030
065000         PERFORM Z999-SQL-ABEND                                   06500030
065100     END-IF.                                                      06510030
065200*                                                                 06520030
065300*                                                                 06530030
065400***************************************************************** 06540030
065500 1700-CLOSE-LOC-CURSOR.                                           06550030
065600***************************************************************** 06560030
065700*                                                                 06570030
065800     EXEC SQL                                                     06580030
065900         CLOSE LOC-CSR                                            06590030
066000     END-EXEC                                                     06600030
066100*                                                                 06610030
066200     EVALUATE TRUE                                                06620030
066300         WHEN SQLCODE = ZERO                                      06630030
066400             CONTINUE                                             06640030
066500         WHEN OTHER                                               06650030
066600             PERFORM Z999-SQL-ABEND                               06660030
066700       END-EVALUATE.                                              06670030
066800*                                                                 06680030
066900*                                                                 06690030
067000***************************************************************** 06700030
067100 1900-OPEN-EXTRACT-CURSOR.                                        06710030
067200***************************************************************** 06720030
067300     MOVE '1900-OPEN-EXTRACT-CURSOR' TO PV-ABEND-PARAGRAPH.       06730030
067400*                                                                 06740030
067500     DISPLAY '1900-OPEN-EXTRACT-CURSOR'.                          06750030
067600*                                                                 06760030
067700     EXEC SQL                                                     06770030
067800         OPEN EXTRACT-CSR                                         06780030
067900     END-EXEC.                                                    06790030
068000*                                                                 06800030
068100     EVALUATE TRUE                                                06810030
068200         WHEN SQLCODE = +0                                        06820030
068300         WHEN SQLCODE = -904                                      06830030
068400         WHEN SQLCODE = -913                                      06840030
068500             CONTINUE                                             06850030
068600         WHEN SQLWARN0 NOT = SPACE                                06860030
068700         WHEN SQLCODE  NOT = +0                                   06870030
068800             MOVE '1900-OPEN-EXTRACT-CURSOR'                      06880030
068900                                 TO PV-ABEND-PARAGRAPH            06890030
069000             MOVE 'EXTRACT'      TO PV-ABEND-STRUCTURE-1          06900030
069100             MOVE SPACES         TO PV-ABEND-STRUCTURE-2          06910030
069200             PERFORM Z999-SQL-ABEND                               06920030
069300     END-EVALUATE.                                                06930030
069400*                                                                 06940030
069500*                                                                 06950030
069600***************************************************************** 06960030
069700 2000-PROCESS-EXTRACTS.                                           06970030
069800***************************************************************** 06980030
069900     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       06990030
070000*                                                                 07000030
070100     PERFORM 2100-FETCH-EXTRACT-CSR.                              07010030
070200*                                                                 07020030
070300     IF PS-NOT-EOF-EXTRACT-CSR                                    07030030
070400         INITIALIZE SU007-EXTRACT-RECORD                          07040030
070500         PERFORM 2200-LOAD-EXTRACT-RECORD                         07050030
070600***      DISPLAY 'EXTRACT-REC = ' SU007-EXTRACT-RECORD            07060030
070700         WRITE EXTRACT-RECORD FROM SU007-EXTRACT-RECORD           07070030
070800     END-IF.                                                      07080030
070900*                                                                 07090030
071000*                                                                 07100030
071100***************************************************************** 07110030
071200 2100-FETCH-EXTRACT-CSR.                                          07120030
071300***************************************************************** 07130030
071400     MOVE '2100-FETCH-EXTRACT-CSR  ' TO PV-ABEND-PARAGRAPH.       07140030
071500*                                                                 07150030
071600     EXEC SQL                                                     07160030
071700          FETCH EXTRACT-CSR                                       07170030
071800           INTO  :SHUNLO-SHIPT-UNT-ID,                            07180030
071900                 :SHUNLO-OPER-UNT-ID,                             07190030
072000                 :SHUNLO-FCLTY-ID,                                07200030
072100                 :SHUNLO-SCN-LOC-ID,                              07210030
072200                 :SHUNLO-CRE-USR-ID,                              07220030
072300                 :SHUNLO-CRE-TMST,                                07230030
072400                 :SHUNLO-TRIP-ID,                                 07240030
072500                 :SHUNLO-PRTR-TYP-CDE,                            07250030
072600                 :SHUNLO-LBL-PRT-BTCH-ID,                         07260030
072700                 :SHPUNT-ORGN-OPER-UNT-ID,                        07270030
072800                 :SHPUNT-DEST-OPER-UNT-ID                         07280030
072900     END-EXEC.                                                    07290030
073000*                                                                 07300030
073100     EVALUATE TRUE                                                07310030
073200         WHEN SQLCODE = +0                                        07320030
073300              CONTINUE                                            07330030
073400         WHEN SQLCODE = +100                                      07340030
073500              SET PS-EOF-EXTRACT-CSR TO TRUE                      07350030
073600         WHEN SQLWARN0 NOT = SPACE                                07360030
073700         WHEN SQLCODE  NOT = +0                                   07370030
073800              MOVE '2100-FETCH-EXTRACT-CSR'                       07380030
073900                                   TO PV-ABEND-PARAGRAPH          07390030
074000              MOVE 'FETCH EXTRACT CURSOR'                         07400030
074100                                   TO PV-ABEND-OPERATION          07410030
074200              MOVE 'EXTRACT'       TO PV-ABEND-STRUCTURE-1        07420030
074300              MOVE SPACES          TO PV-ABEND-STRUCTURE-2        07430030
074400              PERFORM Z999-SQL-ABEND                              07440030
074500     END-EVALUATE.                                                07450030
074600*                                                                 07460030
074700*                                                                 07470030
074800***************************************************************** 07480030
074900 2200-LOAD-EXTRACT-RECORD.                                        07490030
075000***************************************************************** 07500030
075100     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       07510030
075200*                                                                 07520030
075300     MOVE SHUNLO-SHIPT-UNT-ID    TO SU007-SHIPT-UNT-ID.           07530030
075400     MOVE SHUNLO-OPER-UNT-ID     TO SU007-OPER-UNT-ID.            07540030
075500     MOVE SHUNLO-FCLTY-ID        TO SU007-FCLTY-ID.               07550030
075600     MOVE SHUNLO-SCN-LOC-ID      TO SU007-SCN-LOC-ID.             07560030
075700     MOVE SHUNLO-CRE-USR-ID      TO SU007-CRE-USR-ID.             07570030
075800     MOVE SHUNLO-CRE-TMST        TO SU007-CRE-TMST.               07580030
075900     MOVE SHUNLO-TRIP-ID         TO SU007-TRIP-ID.                07590030
076000     MOVE SHUNLO-PRTR-TYP-CDE    TO SU007-PRTR-TYP-CDE.           07600030
076100     MOVE SHUNLO-LBL-PRT-BTCH-ID TO SU007-LBL-PRT-BTCH-ID.        07610030
076200*                                                                 07620030
076300     PERFORM 2250-SET-CRTN-TYP-CDE.                               07630030
076400*                                                                 07640030
076500*                                                                 07650030
076600***************************************************************** 07660030
076700 2250-SET-CRTN-TYP-CDE.                                           07670030
076800***************************************************************** 07680030
076900*                                                                 07690030
077000     MOVE SHPUNT-ORGN-OPER-UNT-ID TO PV-ORGN-OPER-UNT-ID.         07700030
077100     MOVE SHPUNT-DEST-OPER-UNT-ID TO PV-DEST-OPER-UNT-ID.         07710030
077200                                                                  07720030
077300     SET PS-LOC-UNKNOWN TO TRUE.                                  07730030
077400     PERFORM 2260-SEARCH-LOC-TABLE                                07740030
077500       VARYING PV-LT-SUB FROM 1 BY 1                              07750030
077600         UNTIL PS-LOC-FOUND                                       07760030
077700            OR PS-LOC-NOT-FOUND.                                  07770030
077800*                                                                 07780030
077900     IF PS-LOC-FOUND                                              07790030
078000         MOVE 'B' TO SU007-CRTN-TYP-CDE                           07800030
078100     ELSE                                                         07810030
078200         MOVE 'P' TO SU007-CRTN-TYP-CDE.                          07820030
078300*                                                                 07830030
078400*                                                                 07840030
078500***************************************************************** 07850030
078600 2260-SEARCH-LOC-TABLE.                                           07860030
078700***************************************************************** 07870030
078800*                                                                 07880030
078900     IF  PV-DEST-OPER-UNT-ID = 0                                  07890030
079000         SET PS-LOC-FOUND TO TRUE                                 07900030
079100     ELSE                                                         07910030
079200         IF  PV-DEST-OPER-UNT-ID = LT-LOC-NBR (PV-LT-SUB)         07920030
079300             SET PS-LOC-FOUND TO TRUE                             07930030
079400         ELSE                                                     07940030
079500             IF  LT-LOC-NBR (PV-LT-SUB) = ZEROS                   07950030
079600                 SET PS-LOC-NOT-FOUND TO TRUE                     07960030
079700             ELSE                                                 07970030
079800                 IF  PV-LT-SUB > 200                              07980030
079900                     SET PS-LOC-NOT-FOUND TO TRUE                 07990030
080000                 END-IF                                           08000030
080100             END-IF                                               08010030
080200         END-IF                                                   08020030
080300     END-IF.                                                      08030030
080400*                                                                 08040030
080500*                                                                 08050030
080600***************************************************************** 08060030
080700 3000-CLOSE-EXTRACT-CSR.                                          08070030
080800***************************************************************** 08080030
080900     DISPLAY '3000-CLOSE-EXTRACT-CSR'.                            08090030
081000*                                                                 08100030
081100     EXEC SQL                                                     08110030
081200         CLOSE EXTRACT-CSR                                        08120030
081300     END-EXEC                                                     08130030
081400*                                                                 08140030
081500     EVALUATE TRUE                                                08150030
081600         WHEN SQLCODE = ZERO                                      08160030
081700             CONTINUE                                             08170030
081800         WHEN OTHER                                               08180030
081900             PERFORM Z999-SQL-ABEND                               08190030
082000       END-EVALUATE.                                              08200030
082100*                                                                 08210030
082200*                                                                 08220030
082300***************************************************************** 08230030
082400 9100-CALL-DATE-MODULE.                                           08240030
082500***************************************************************** 08250030
082600     MOVE '9100-CALL-DATE-MODULE   ' TO PV-ABEND-PARAGRAPH.       08260030
082700                                                                  08270030
082800     CALL DP500-KOHLS-CALENDAR-ROUTINE                            08280030
082900                           USING DPG51 DPG52 DPG53                08290030
083000                                 DPG54 DPG55 DPG56.               08300030
083100     EVALUATE TRUE                                                08310030
083200         WHEN DPG54-SEVERE-ERROR                                  08320030
083300              DISPLAY '** ABEND **'                               08330030
083400              DISPLAY '** PGM = RCKUT056'                         08340030
083500              DISPLAY PV-ABEND-PARAGRAPH                          08350030
083600              DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE. ' 08360030
083700              DISPLAY '** ERROR MESSAGE = '                       08370030
083800                      DPG54-ERROR-MESSAGE                         08380030
083900              DISPLAY '** DPG51 = ' DPG51                         08390030
084000              DISPLAY '** DPG52 = ' DPG52                         08400030
084100              DISPLAY '** DPG53 = ' DPG53                         08410030
084200              DISPLAY '** DPG54 = ' DPG54                         08420030
084300              MOVE +4003 TO PV-ABEND-CODE                         08430030
084400              CALL 'ILBOABN0' USING PV-ABEND-CODE                 08440030
084500         WHEN OTHER                                               08450030
084600              CONTINUE                                            08460030
084700     END-EVALUATE.                                                08470030
084800                                                                  08480030
084900*                                                                 08490030
085000***************************************************************** 08500030
085100 Z999-SQL-ABEND.                                                  08510030
085200***************************************************************** 08520030
085300                                                                  08530030
085400     MOVE SQLCODE TO PV-SQLCODE.                                  08540030
085500     DISPLAY '*** DB2 ERROR '.                                    08550030
085600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08560030
085700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08570030
085800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08580030
085900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08590030
086000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       08600030
086100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       08610030
086200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       08620030
086300     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             08630030
086400                                                                  08640030
086500     IF PV-ABEND-STRUCTURE-2 > SPACES                             08650030
086600         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          08660030
086700     END-IF.                                                      08670030
086800                                                                  08680030
086900                                                                  08690030
087000     COPY DPPD004.                                                08700030
087100                                                                  08710030
087200                                                                  08720030
087300     MOVE +4013                  TO PV-ABEND-CODE.                08730030
087400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08740030
