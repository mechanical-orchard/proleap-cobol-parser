000100******************************************************************00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300******************************************************************00030003
000400                                                                  00040003
000500 PROGRAM-ID.             PSKRP097.                                00050003
000600 AUTHOR.                 RICK TULLOCH.                            00060003
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070003
000800 DATE-WRITTEN            11-09-93.                                00080003
000900 DATE-COMPILED.                                                   00090003
001000                                                                  00100003
001100******************************************************************00110003
001200*       THIS PROGRAM WILL PROCESS UNAUDITED GIFT CERTIFICATE     *00120003
001300*  INFORMATION (SOLD AND REDEEMED), TO CREATE A GIFT CERTIFICATE *00130003
001400*  ACTIVITY SUMMARY BY STORE FOR A SET REPORTING PERIOD.         *00140003
001500*                                                                *00150003
001600*       A CONTROL CARD IS ACCEPTED THAT PROVIDES THE REPORTING   *00160003
001700*  PERIOD INDICATION ("D"AILY, "W"EEKLY, OR "M"ONTHLY).          *00170003
001800*                                                                *00180003
001900*       BASED ON THE CONTROL CARD REQUEST, AND THE TRANSACTION   *00190003
002000*  DATE ON THE FIRST GIFT CERTIFICATE FILE RECORD, THE REPORTING *00200003
002100*  PERIOD START AND END DATES ARE DETERMINED VIA A CALL TO THE   *00210003
002200*  CALENDAR ROUTINE.  THIS INFORMATION IS IN TURN USED TO BUILD  *00220003
002300*  A CORE TABLE OF STORES THAT WERE OPEN AT SOME POINT DURING    *00230003
002400*  THE REPORTING PERIOD.                                         *00240003
002500*                                                                *00250003
002600*       THE GIFT CERTIFICATE FILE IS MERGED WITH THE CORE STORE  *00260003
002700*  TABLE TO PRODUCE THE REPORT, ACCUMULATING COUNTS AND AMOUNTS  *00270003
002800*  OF GIFT CERTIFICATES SOLD AND REDEEMED AT EACH STORE.  TOTALS *00280003
002900*  ARE PROVIDED AT THE STORE AND COMPANY LEVELS.                 *00290003
003000*                                                                *00300003
003100*       THE GIFT CERTIFICATE FILE MUST BE SORTED BY ASCENDING    *00310003
003200*  STORE NUMBER.                                                 *00320003
003300******************************************************************00330003
003310*  10/98 AJR WR.10327  KOHL'S CARES FOR KIDS CARDS               *00340033
003311*       CHANGED THE REPORT TO BREAK OUT GIFT CARDS AND GIFT      *00350016
003312*       CERTIFICATES SOLD INTO SEPARATE TOTALS.  GIFT CARDS,     *00360016
003313*       CERTIFICATES AND KOHL'S CARES FOR KIDS CARDS REDEEMED    *00370016
003314*       ARE ALSO IN SEPARATE COLUMNS.                            *00380016
003315*       REMOVED THE TOTAL COUNT AND NET AMOUNT COLUMNS.          *00390016
003320******************************************************************00400016
003340*  CHANGED 01/13/99 BY DAVE MUSKAT - COMPUWARE                   *00410033
003341*   WR: 6041   CHANGES FOR Y2K:                                  *00420033
003342*    REPLACED NON-STANDARD CALL TO THE KOHLS CALENDAR ROUTINE    *00430033
003344*    WITH STANDARD CALL TO THE KOHLS CALENDAR ROUTINE.           *00440033
003350*----------------------------------------------------------------*00450034
003360*  CHANGED 01/03/2000 BY JEFF BOLWERK                            *00460036
003370*   IR: 336201                                                   *00470034
003371*   CHANGES:                                                     *00480034
003380*    REPLACED NON-STANDARD CALL TO THE KOHLS CALENDAR ROUTINE    *00490034
003390*    WITH STANDARD CALL TO THE KOHLS CALENDAR ROUTINE.           *00500034
003350*----------------------------------------------------------------*00510039
003360*  CHANGED 01/22/2002 BY MICHELE RINDFLEISCH                     *00520039
003370*   WR: 23176                                                     00530039
003371*   CHANGES:                                                     *00540039
003380*    MULTI-CHANNEL GIFT CARDS.                                   *00550039
003393******************************************************************00560037
003400                                                                  00570003
003500******************************************************************00580003
003600 ENVIRONMENT DIVISION.                                            00590003
003700******************************************************************00600003
003800                                                                  00610003
003900 CONFIGURATION SECTION.                                           00620003
004000                                                                  00630003
004100 SOURCE-COMPUTER.        IBM-3090.                                00640003
004200 OBJECT-COMPUTER.        IBM-3090.                                00650003
004300                                                                  00660003
004400 INPUT-OUTPUT SECTION.                                            00670003
004500                                                                  00680003
004600 FILE-CONTROL.                                                    00690003
004700                                                                  00700003
004800     SELECT GIFT-CERTIFICATE-FILE                                 00710003
004900         ASSIGN TO INP01.                                         00720003
005000                                                                  00730003
005100     SELECT GIFT-CERT-SUMMARY-REPORT                              00740003
005200         ASSIGN TO RPT01.                                         00750003
005210     SELECT GIFT-CERT-PAYMENT-REPORT                              00760019
005220         ASSIGN TO RPT02.                                         00770019
005300                                                                  00780003
005400******************************************************************00790003
005500 DATA DIVISION.                                                   00800003
005600******************************************************************00810003
005700                                                                  00820003
005800 FILE SECTION.                                                    00830003
005900                                                                  00840003
006000 FD  GIFT-CERTIFICATE-FILE                                        00850003
006100     RECORDING MODE IS F                                          00860003
006200     LABEL RECORDS ARE STANDARD                                   00870003
006300     BLOCK CONTAINS 0 RECORDS                                     00880003
006400     RECORD CONTAINS 50 CHARACTERS                                00890003
006500     DATA RECORD IS GC-GIFT-CERTIFICATE-RECORD.                   00900003
006600                                                                  00910003
006700 01  GC-GIFT-CERTIFICATE-RECORD  PIC X(50).                       00920003
006800                                                                  00930003
006900 FD  GIFT-CERT-SUMMARY-REPORT                                     00940003
007000     RECORDING MODE IS F                                          00950003
007100     LABEL RECORDS ARE STANDARD                                   00960003
007200     BLOCK CONTAINS 0 RECORDS                                     00970003
007300     RECORD CONTAINS 200 CHARACTERS                               00980009
007400     DATA RECORD IS GC-GIFT-CERT-SUMMARY-LINE.                    00990003
007500                                                                  01000003
007600 01  GC-GIFT-CERT-SUMMARY-LINE   PIC X(200).                      01010009
007601                                                                  01020017
007610 FD  GIFT-CERT-PAYMENT-REPORT                                     01030017
007620     RECORDING MODE IS F                                          01040017
007630     LABEL RECORDS ARE STANDARD                                   01050017
007640     BLOCK CONTAINS 0 RECORDS                                     01060017
007650     RECORD CONTAINS 200 CHARACTERS                               01070017
007660     DATA RECORD IS GC-GIFT-CERT-PAYMENT-LINE.                    01080017
007670                                                                  01090017
007680 01  GC-GIFT-CERT-PAYMENT-LINE   PIC X(200).                      01100017
007700                                                                  01110003
007800 WORKING-STORAGE SECTION.                                         01120003
007900                                                                  01130003
008000*                                                                 01140003
008100*  GIFT CERTIFICATE FILE RECORD LAYOUT                            01150003
008200     COPY PSRD003.                                                01160003
008300                                                                  01170003
008400*                                                                 01180003
008500*  WORKING STORAGE AREA FOR THE FORMAT SQLCA ROUTINE (DPPD004)    01190003
008600     COPY DPWS004.                                                01200003
008700                                                                  01210003
008800*                                                                 01220003
008900*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01230003
009000     COPY DPWS500.                                                01240003
009100                                                                  01250003
009200*                                                                 01260003
009300*  STANDARD REPORT HEADER FOR A 200 COLUMN REPORT                 01270006
009400     COPY DPWS200O.                                               01280006
009500                                                                  01290003
009600 01  ABEND-CODE                  PIC S9(4)    VALUE ZEROS         01300003
009700                                              COMP SYNC.          01310003
009800     88  AC-CONTROL-CARD-ERROR                VALUE +4003.        01320003
009900     88  AC-TABLE-OVERFLOW-ERROR              VALUE +4004.        01330003
010100     88  AC-DB2-ERROR                         VALUE +4013.        01340003
010200     88  AC-CALENDAR-ROUTINE-ERROR            VALUE +4019.        01350003
010300                                                                  01360003
011600 01  PS-PROGRAM-SWITCHES.                                         01370003
011700     05  PS-END-OF-GIFT-CERT-FILE-IND                             01380003
011800                                 PIC X(1)     VALUE 'N'.          01390003
011900         88  PS-END-OF-GIFT-CERT-FILE         VALUE 'Y'.          01400003
012000                                                                  01410003
012100 01  PC-PROGRAM-CONSTANTS.                                        01420003
012200     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'PSKRP097'.   01430003
012400     05  PC-PAGE-SIZE            PIC S9(4)    VALUE +62           01440003
012500                                              COMP SYNC.          01450003
012600     05  PC-PAGE-BREAK           PIC S9(4)    VALUE +63           01460003
012700                                              COMP SYNC.          01470003
012800     05  PC-HEADING-LINE-COUNT   PIC S9(4)    VALUE +6            01480009
012900                                              COMP SYNC.          01490003
012910     05  PC-PYMNT-HEADING-LINE-COUNT                              01500021
012911                                 PIC S9(4)    VALUE +6            01510021
012920                                              COMP SYNC.          01520021
013000     05  PC-MAXIMUM-STORE-COUNT  PIC S9(4)    VALUE +9999         01530041
013100                                              COMP SYNC.          01540003
013400     05  PC-DEPARTMENT-STORE-TYPE                                 01550003
013500                                 PIC X(2)     VALUE 'DS'.         01560003
013600     05  PC-STORE-TOTAL-LEVEL    PIC S9(4)    VALUE +1            01570003
013700                                              COMP SYNC.          01580003
013800     05  PC-COMPANY-TOTAL-LEVEL  PIC S9(4)    VALUE +2            01590003
013900                                              COMP SYNC.          01600003
014000     05  PC-DAILY-REPORT-NUMBER  PIC S9(4)    VALUE +1            01610003
014100                                              COMP SYNC.          01620003
014200     05  PC-WEEKLY-REPORT-NUMBER PIC S9(4)    VALUE +2            01630003
014300                                              COMP SYNC.          01640003
014301     05  PC-MONTHLY-REPORT-NUMBER                                 01650017
014302                                 PIC S9(4)    VALUE +3            01660017
014303                                              COMP SYNC.          01670017
014310     05  PC-PYMNT-DAILY-REPORT-NUMBER                             01680020
014311                                 PIC S9(4)    VALUE +4            01690017
014320                                              COMP SYNC.          01700017
014330     05  PC-PYMNT-WEEKLY-REPORT-NUMBER                            01710020
014331                                 PIC S9(4)    VALUE +5            01720017
014340                                              COMP SYNC.          01730017
014400     05  PC-PYMNT-MONTHLY-REPORT-NUMBER                           01740020
014500                                 PIC S9(4)    VALUE +6            01750017
014600                                              COMP SYNC.          01760003
015000     05  PC-SUCCESSFUL-SQLCODE   PIC S9(9)    VALUE ZEROS         01770003
015100                                              COMP SYNC.          01780003
015200     05  PC-END-OF-CURSOR-SQLCODE                                 01790003
015300                                 PIC S9(9)    VALUE +100          01800003
015400                                              COMP SYNC.          01810003
015500                                                                  01820003
015600 01  PV-PROGRAM-VARIABLES.                                        01830003
015700     05  PV-PAGE-COUNT           PIC S9(5)    VALUE ZEROS         01840003
015800                                              COMP-3.             01850003
015810     05  PV-PYMNT-PAGE-COUNT     PIC S9(5)    VALUE ZEROS         01860020
015820                                              COMP-3.             01870018
015900     05  PV-LINE-COUNT           PIC S9(4)    VALUE +63           01880003
016000                                              COMP SYNC.          01890003
016010     05  PV-PYMNT-LINE-COUNT     PIC S9(4)    VALUE +63           01900020
016020                                              COMP SYNC.          01910018
016100     05  PV-ADVANCE-COUNT        PIC S9(4)    VALUE +2            01920003
016200                                              COMP SYNC.          01930003
016300         88  PV-SINGLE-SPACE                  VALUE +1.           01940003
016400         88  PV-DOUBLE-SPACE                  VALUE +2.           01950003
016500         88  PV-TRIPLE-SPACE                  VALUE +3.           01960003
016600     05  PV-STORE-COUNT          PIC S9(4)    VALUE ZEROS         01970003
016700                                              COMP SYNC.          01980003
016800     05  PV-REPORT-NUMBER        PIC S9(4)    VALUE ZEROS         01990003
016900                                              COMP SYNC.          02000003
016910     05  PV-PYMNT-REPORT-NUMBER                                   02010020
016911                                 PIC S9(4)    VALUE ZEROS         02020017
016920                                              COMP SYNC.          02030017
017000     05  PV-STORE-NUMBER         PIC 9(4)     VALUE ZEROS.        02040003
017400     05  PV-NET-SOLD-CNT         PIC S9(7)    VALUE ZEROS         02050006
017500                                              COMP-3.             02060003
017502     05  PV-NET-SOLD-AMT         PIC S9(9)V99 VALUE ZEROS         02070006
017503                                              COMP-3.             02080006
017504     05  PV-NET-REDEEM-CNT       PIC S9(7)    VALUE ZEROS         02090006
017505                                              COMP-3.             02100006
017506     05  PV-NET-REDEEM-AMT       PIC S9(9)V99 VALUE ZEROS         02110006
017507                                              COMP-3.             02120006
017508     05  PV-PYMNT-NET-REDEEM-CNT                                  02130020
017509                                 PIC S9(7)    VALUE ZEROS         02140018
017510                                              COMP-3.             02150018
017511     05  PV-PYMNT-NET-REDEEM-AMT                                  02160020
017512                                 PIC S9(9)V99 VALUE ZEROS         02170018
017520                                              COMP-3.             02180018
017900     05  PV-CONVERTED-DATE-MDY   PIC 9(6)     VALUE ZEROS.        02190003
018000     05  FILLER                  REDEFINES                        02200003
018100                                     PV-CONVERTED-DATE-MDY.       02210003
018200         10  PV-CONVERTED-MONTH  PIC 9(2).                        02220003
018300         10  PV-CONVERTED-DAY    PIC 9(2).                        02230003
018400         10  PV-CONVERTED-YEAR   PIC 9(2).                        02240003
018500     05  PV-FISCAL-PERIOD-NBR    PIC 9(2)     VALUE ZEROS.        02250003
018600     05  PV-FISCAL-PERIOD-NAME   PIC X(9)     VALUE SPACES.       02260003
018700     05  PV-LAST-DB2-ACTION      PIC X(50)    VALUE SPACES.       02270003
018800         88  PV-OPEN-STORE-CURSOR             VALUE               02280003
018900             'OPEN THE STORE CURSOR                     '.        02290041
019000         88  PV-CLOSE-STORE-CURSOR            VALUE               02300003
019100             'CLOSE THE STORE CURSOR                    '.        02310041
019200         88  PV-FETCH-STORE-ROW               VALUE               02320003
019300             'FETCH A ROW FROM THE STORE CURSOR         '.        02330041
019400                                                                  02340003
019500 01  CC-CONTROL-CARD.                                             02350003
019600     05  CC-CONTROL-CARD-DISPLAY.                                 02360003
019700         10  CC-REPORTING-PERIOD-IND                              02370003
019800                                 PIC X(1)    VALUE SPACES.        02380003
019900             88  CC-VALID-REPORTING-PERIOD   VALUE 'D', 'W',      02390003
020000                                                   'M'.           02400003
020100             88  CC-DAILY-REPORTING-PERIOD   VALUE 'D'.           02410003
020200             88  CC-WEEKLY-REPORTING-PERIOD  VALUE 'W'.           02420003
020300             88  CC-MONTHLY-REPORTING-PERIOD VALUE 'M'.           02430003
020400     05  FILLER                  PIC X(79)    VALUE SPACE.        02440003
020500                                                                  02450003
020600 01  IR-ISO-REPORTING-PERIOD-DATES.                               02460003
020700     05  IR-ISO-RPT-PERIOD-START-DATE-X.                          02470003
020800         10  IR-ISO-RPT-PD-START-CENTURY                          02480003
020900                                 PIC 9(2)     VALUE ZERO.         02490003
021000         10  IR-ISO-RPT-PD-START-YEAR                             02500003
021100                                 PIC 9(2)     VALUE ZERO.         02510003
021200         10  FILLER              PIC X(1)     VALUE '-'.          02520003
021300         10  IR-ISO-RPT-PD-START-MONTH                            02530003
021400                                 PIC 9(2)     VALUE ZERO.         02540003
021500         10  FILLER              PIC X(1)     VALUE '-'.          02550003
021600         10  IR-ISO-RPT-PD-START-DAY                              02560003
021700                                 PIC 9(2)     VALUE ZERO.         02570003
021800     05  IR-ISO-RPT-PERIOD-START-DATE                             02580003
021900                                 REDEFINES                        02590003
022000                                   IR-ISO-RPT-PERIOD-START-DATE-X 02600003
022100                                 PIC X(10).                       02610003
022200     05  IR-ISO-RPT-PERIOD-END-DATE-X.                            02620003
022300         10  IR-ISO-RPT-PD-END-CENTURY                            02630003
022400                                 PIC 9(2)     VALUE ZERO.         02640003
022500         10  IR-ISO-RPT-PD-END-YEAR                               02650003
022600                                 PIC 9(2)     VALUE ZERO.         02660003
022700         10  FILLER              PIC X(1)     VALUE '-'.          02670003
022800         10  IR-ISO-RPT-PD-END-MONTH                              02680003
022900                                 PIC 9(2)     VALUE ZERO.         02690003
023000         10  FILLER              PIC X(1)     VALUE '-'.          02700003
023100         10  IR-ISO-RPT-PD-END-DAY                                02710003
023200                                 PIC 9(2)     VALUE ZERO.         02720003
023300     05  IR-ISO-RPT-PERIOD-END-DATE                               02730003
023400                                 REDEFINES                        02740003
023500                                   IR-ISO-RPT-PERIOD-END-DATE-X   02750003
023600                                 PIC X(10).                       02760003
023700                                                                  02770003
023800 01  CD-CURRENT-DATE.                                             02780003
023900     05  CD-CURRENT-YEAR         PIC 9(2)     VALUE ZERO.         02790003
024000     05  CD-CURRENT-MONTH        PIC 9(2)     VALUE ZERO.         02800003
024100     05  CD-CURRENT-DAY          PIC 9(2)     VALUE ZERO.         02810003
024200                                                                  02820003
024300 01  CT-CURRENT-TIME.                                             02830003
024400     05  CT-CURRENT-HOUR         PIC 9(2)     VALUE ZERO.         02840003
024500     05  CT-CURRENT-MINUTE       PIC 9(2)     VALUE ZERO.         02850003
024600     05  FILLER                  PIC 9(4)     VALUE ZERO.         02860003
024700                                                                  02870003
024800 01  CK-CURRENT-KEY-AREA.                                         02880003
024900     05  CK-STORE-NUMBER         PIC 9(4)     VALUE ZEROS.        02890003
025000     05  CK-STORE-NAME           PIC X(10)    VALUE SPACES.       02900006
025100         88  CK-UNKNOWN-STORE-NAME            VALUE 'UNKNOWN'.    02910003
025200     05  CK-FILE-STORE-NUMBER    PIC 9(4)     VALUE ZEROS.        02920041
025300     05  CK-TABLE-STORE-NUMBER   PIC 9(4)     VALUE ZEROS.        02930041
025400                                                                  02940003
025500 01  ST-STORE-TABLE.                                              02950003
025600     05  ST-STORE-ENTRY          OCCURS 9999 TIMES                02960041
025700                                 INDEXED BY ST-INDEX.             02970003
025800         10  ST-STORE-NUMBER     PIC 9(4).                        02980041
026600         10  ST-STORE-NAME       PIC X(10).                       02990006
026700                                                                  03000003
026800 01  TT-TOTALS-TABLE.                                             03010003
026900     05  TT-TOTALS-ENTRY         OCCURS 2 TIMES                   03020003
027000                                 INDEXED BY TT-INDEX.             03030003
027100         10  TT-GIFT-CERTIFICATE-SOLD-CNT                         03040003
027200                                 PIC S9(7)    COMP-3.             03050003
027300         10  TT-GIFT-CERTIFICATE-SOLD-AMT                         03060003
027400                                 PIC S9(9)V99 COMP-3.             03070006
027500         10  TT-GIFT-CARD-SOLD-CNT                                03080018
027510                                 PIC S9(7)    COMP-3.             03090018
027520         10  TT-GIFT-CARD-SOLD-AMT                                03100018
027530                                 PIC S9(9)V99 COMP-3.             03110018
027600         10  TT-GIFT-CERTIFICATE-REDEEM-CNT                       03120003
027700                                 PIC S9(7)    COMP-3.             03130003
027800         10  TT-GIFT-CERTIFICATE-REDEEM-AMT                       03140003
027900                                 PIC S9(9)V99 COMP-3.             03150006
028060         10  TT-GIFT-CARD-REDEEM-CNT                              03160006
028070                                 PIC S9(7)    COMP-3.             03170006
028080         10  TT-GIFT-CARD-REDEEM-AMT                              03180006
028090                                 PIC S9(9)V99 COMP-3.             03190006
028091         10  TT-KCK-CARD-REDEEM-CNT                               03200018
028092                                 PIC S9(7)    COMP-3.             03210018
028093         10  TT-KCK-CARD-REDEEM-AMT                               03220018
028094                                 PIC S9(9)V99 COMP-3.             03230018
028095         10  TT-PYMNT-GIFT-CERT-REDEEM-CNT                        03240020
028096                                 PIC S9(7)    COMP-3.             03250018
028097         10  TT-PYMNT-GIFT-CERT-REDEEM-AMT                        03260020
028098                                 PIC S9(9)V99 COMP-3.             03270018
028099         10  TT-PYMNT-GIFT-CARD-REDEEM-CNT                        03280020
028100                                 PIC S9(7)    COMP-3.             03290017
028101         10  TT-PYMNT-GIFT-CARD-REDEEM-AMT                        03300020
028102                                 PIC S9(9)V99 COMP-3.             03310017
028104         10  TT-PYMNT-KCK-CARD-REDEEM-CNT                         03320020
028105                                 PIC S9(7)    COMP-3.             03330017
028106         10  TT-PYMNT-KCK-CARD-REDEEM-AMT                         03340020
028107                                 PIC S9(9)V99 COMP-3.             03350017
028110                                                                  03360017
028200 01  HL2A-HEADING-LINE-2A.                                        03370003
028300     05  FILLER                  PIC X(82)    VALUE SPACES.       03380012
028400     05  FILLER                  PIC X(29)    VALUE               03390003
028500         'GIFT CERTIFICATE SUMMARY FOR '.                         03400003
028600     05  HL2A-POS-DATE           PIC 99/99/99 VALUE ZERO.         03410003
028700     05  FILLER                  PIC X(81)    VALUE SPACES.       03420012
028800                                                                  03430003
028900 01  HL2B-HEADING-LINE-2B.                                        03440003
029000     05  FILLER                  PIC X(76)    VALUE SPACES.       03450012
029100     05  FILLER                  PIC X(40)    VALUE               03460003
029200         'GIFT CERTIFICATE SUMMARY FOR WEEK ENDED '.              03470003
029300     05  HL2B-WEEK-ENDING-DATE   PIC 99/99/99 VALUE ZERO.         03480003
029400     05  FILLER                  PIC X(76)    VALUE SPACES.       03490012
029500                                                                  03500003
029600 01  HL2C-HEADING-LINE-2C.                                        03510003
029700     05  FILLER                  PIC X(75)    VALUE SPACES.       03520012
029800     05  FILLER                  PIC X(42)    VALUE               03530003
029900         'GIFT CERTIFICATE SUMMARY FOR THE MONTH OF '.            03540003
030000     05  HL2C-MONTH-NAME         PIC X(9)     VALUE SPACES.       03550003
030100     05  FILLER                  PIC X(74)    VALUE SPACES.       03560012
030200                                                                  03570003
030300 01  HL3-HEADING-LINE-3.                                          03580009
030400     05  FILLER                  PIC X(25)    VALUE SPACES.       03590015
030500     05  FILLER                  PIC X(27)    VALUE 'SOLD'.       03600015
030510     05  FILLER                  PIC X(51)    VALUE 'SOLD'.       03610016
030600     05  FILLER                  PIC X(26)    VALUE 'REDEEMED'.   03620010
030700     05  FILLER                  PIC X(26)    VALUE 'REDEEMED'.   03630010
030701     05  FILLER                  PIC X(26)    VALUE 'REDEEMED'.   03640014
030705                                                                  03650009
030706 01  HL4-HEADING-LINE-4.                                          03660009
030707     05  FILLER                  PIC X(01)    VALUE SPACES.       03670012
030708     05  FILLER                  PIC X(19)    VALUE 'STR'.        03680012
030709     05  FILLER                  PIC X(29)    VALUE               03690012
030710                                              'GIFT CERTIFICATES'.03700012
030711     05  FILLER                  PIC X(26)    VALUE 'GIFT CARDS'. 03710012
030712     05  FILLER                  PIC X(25)    VALUE 'TOTAL SOLD'. 03720016
030713     05  FILLER                  PIC X(29)    VALUE               03730012
030714                                              'GIFT CERTIFICATES'.03740012
030715     05  FILLER                  PIC X(26)    VALUE 'GIFT CARDS'. 03750012
030716     05  FILLER                  PIC X(23)    VALUE 'KCK CARDS'.  03760012
030717     05  FILLER                  PIC X(14)    VALUE               03770012
030720                                              'TOTAL REDEEMED'.   03780009
030760                                                                  03790009
030770 01  HL5-HEADING-LINE-5.                                          03800009
030771     05  FILLER                  PIC X(01)    VALUE SPACES.       03810012
030780     05  FILLER                  PIC X(5)     VALUE 'NBR'.        03820042
030790     05  FILLER                  PIC X(11)    VALUE 'STORE NAME'. 03830009
030800     05  FILLER                  PIC X(24)    VALUE ALL '-'.      03840042
030900     05  FILLER                  PIC X(01)    VALUE SPACES.       03850009
030910     05  FILLER                  PIC X(25)    VALUE ALL '-'.      03860013
030920     05  FILLER                  PIC X(01)    VALUE SPACES.       03870013
031000     05  FILLER                  PIC X(25)    VALUE ALL '-'.      03880009
031100     05  FILLER                  PIC X(03)    VALUE SPACES.       03890016
031110     05  FILLER                  PIC X(25)    VALUE ALL '-'.      03900013
031120     05  FILLER                  PIC X(01)    VALUE SPACES.       03910009
031121     05  FILLER                  PIC X(25)    VALUE ALL '-'.      03920013
031122     05  FILLER                  PIC X(01)    VALUE SPACES.       03930013
031123     05  FILLER                  PIC X(25)    VALUE ALL '-'.      03940013
031124     05  FILLER                  PIC X(01)    VALUE SPACES.       03950013
031130     05  FILLER                  PIC X(25)    VALUE ALL '-'.      03960009
031200                                                                  03970003
032400 01  DL-DETAIL-LINE.                                              03980003
032600     05  DL-DETAIL-ID            PIC X(16)    VALUE SPACES.       03990046
032700         88  DL-COMPANY-TOTAL-ID              VALUE               04000003
032800             ' COMPANY TOTAL  '.                                  04010047
032900     05  FILLER                  REDEFINES DL-DETAIL-ID.          04020003
033000         10  DL-STORE-NUMBER     PIC Z9(4).                       04030046
033100         10  FILLER              PIC X(1).                        04040006
033200         10  DL-STORE-NAME       PIC X(10).                       04050006
033300     05  FILLER                  PIC X(2)     VALUE SPACES.       04060046
033400     05  DL-GIFT-CERTIFICATE-SOLD-CNT                             04070003
033500                                 PIC ZZZ,ZZ9                      04080046
033600                                              VALUE ZEROS.        04090003
033700     05  FILLER                  PIC X(1)     VALUE SPACES.       04100013
033800     05  DL-GIFT-CERTIFICATE-SOLD-AMT                             04110003
033900                                 PIC ZZZ,ZZZ,ZZ9.99-              04120003
034000                                              VALUE ZEROS.        04130003
034010     05  FILLER                  PIC X(1)     VALUE SPACES.       04140006
034030     05  DL-GIFT-CARD-SOLD-CNT   PIC Z,ZZZ,ZZ9                    04150007
034040                                              VALUE ZEROS.        04160006
034050     05  FILLER                  PIC X(1)     VALUE SPACES.       04170006
034070     05  DL-GIFT-CARD-SOLD-AMT   PIC ZZZ,ZZZ,ZZ9.99-              04180007
034080                                              VALUE ZEROS.        04190006
034090     05  FILLER                  PIC X(1)     VALUE SPACES.       04200006
034091     05  DL-NET-CARD-SOLD-CNT    PIC Z,ZZZ,ZZ9                    04210007
034092                                              VALUE ZEROS.        04220006
034093     05  FILLER                  PIC X(1)     VALUE SPACES.       04230006
034094     05  DL-NET-CARD-SOLD-AMT    PIC ZZZ,ZZZ,ZZ9.99-              04240007
034095                                              VALUE ZEROS.        04250006
034100     05  FILLER                  PIC X(3)     VALUE SPACES.       04260048
034200     05  DL-GIFT-CERTIFICATE-REDEEM-CNT                           04270003
034300                                 PIC Z,ZZZ,ZZ9                    04280003
034400                                              VALUE ZEROS.        04290003
034500     05  FILLER                  PIC X(1)     VALUE SPACES.       04300006
034600     05  DL-GIFT-CERTIFICATE-REDEEM-AMT                           04310003
034700                                 PIC ZZZ,ZZZ,ZZ9.99-              04320003
034800                                              VALUE ZEROS.        04330003
034810     05  FILLER                  PIC X(1)     VALUE SPACES.       04340006
034820     05  DL-GIFT-CARD-REDEEM-CNT                                  04350007
034830                                 PIC Z,ZZZ,ZZ9                    04360006
034840                                              VALUE ZEROS.        04370006
034850     05  FILLER                  PIC X(1)     VALUE SPACES.       04380006
034870     05  DL-GIFT-CARD-REDEEM-AMT PIC ZZZ,ZZZ,ZZ9.99-              04390007
034880                                              VALUE ZEROS.        04400006
034890     05  FILLER                  PIC X(1)     VALUE SPACES.       04410006
034892     05  DL-KCK-CARD-REDEEM-CNT  PIC Z,ZZZ,ZZ9                    04420007
034893                                              VALUE ZEROS.        04430006
034894     05  FILLER                  PIC X(1)     VALUE SPACES.       04440006
034896     05  DL-KCK-CARD-REDEEM-AMT  PIC ZZZ,ZZZ,ZZ9.99-              04450007
034897                                              VALUE ZEROS.        04460006
034900     05  FILLER                  PIC X(1)     VALUE SPACES.       04470006
035000     05  DL-NET-CARD-REDEEM-CNT  PIC Z,ZZZ,ZZ9                    04480007
035200                                              VALUE ZEROS.        04490003
035300     05  FILLER                  PIC X(1)     VALUE SPACES.       04500006
035500     05  DL-NET-CARD-REDEEM-AMT  PIC ZZZ,ZZZ,ZZ9.99-              04510007
035600                                              VALUE ZEROS.        04520003
035800                                                                  04530003
035810 01  HL2A-PYMNT-HEADING-LINE-2A.                                  04540020
035820     05  FILLER                  PIC X(78)    VALUE SPACES.       04550017
035830     05  FILLER                  PIC X(37)    VALUE               04560017
035840         'GIFT CERTIFICATE PAYMENT SUMMARY FOR '.                 04570017
035850     05  HL2A-PYMNT-POS-DATE     PIC 99/99/99 VALUE ZERO.         04580020
035860     05  FILLER                  PIC X(77)    VALUE SPACES.       04590017
035870                                                                  04600017
035880 01  HL2B-PYMNT-HEADING-LINE-2B.                                  04610020
035890     05  FILLER                  PIC X(72)    VALUE SPACES.       04620017
035891     05  FILLER                  PIC X(48)    VALUE               04630017
035892         'GIFT CERTIFICATE PAYMENT SUMMARY FOR WEEK ENDED '.      04640017
035893     05  HL2B-PYMNT-WEEK-ENDING-DATE                              04650020
035894                                 PIC 99/99/99 VALUE ZERO.         04660017
035895     05  FILLER                  PIC X(72)    VALUE SPACES.       04670017
035896                                                                  04680017
035897 01  HL2C-PYMNT-HEADING-LINE-2C.                                  04690020
035898     05  FILLER                  PIC X(71)    VALUE SPACES.       04700017
035899     05  FILLER                  PIC X(50)    VALUE               04710017
035900         'GIFT CERTIFICATE PAYMENT SUMMARY FOR THE MONTH OF '.    04720017
035901     05  HL2C-PYMNT-MONTH-NAME PIC X(9)       VALUE SPACES.       04730020
035902     05  FILLER                  PIC X(70)    VALUE SPACES.       04740017
035903                                                                  04750017
035904 01  HL3-PYMNT-HEADING-LINE-3.                                    04760020
035905     05  FILLER                  PIC X(52)    VALUE SPACES.       04770024
035908     05  FILLER                  PIC X(41)    VALUE 'REDEEMED'.   04780030
035909     05  FILLER                  PIC X(42)    VALUE 'REDEEMED'.   04790032
035910     05  FILLER                  PIC X(08)    VALUE 'REDEEMED'.   04800022
035911                                                                  04810017
035912 01  HL4-PYMNT-HEADING-LINE-4.                                    04820020
035913     05  FILLER                  PIC X(14)    VALUE SPACES.       04830022
035914     05  FILLER                  PIC X(34)    VALUE 'STR'.        04840029
035919     05  FILLER                  PIC X(44)    VALUE               04850031
035920                                              'GIFT CERTIFICATES'.04860017
035921     05  FILLER                  PIC X(42)    VALUE 'GIFT CARDS'. 04870032
035922     05  FILLER                  PIC X(38)    VALUE 'KCK CARDS'.  04880032
035923     05  FILLER                  PIC X(14)    VALUE               04890017
035924                                              'TOTAL REDEEMED'.   04900017
035925                                                                  04910017
035926 01  HL5-PYMNT-HEADING-LINE-5.                                    04920020
035927     05  FILLER                  PIC X(14)    VALUE SPACES.       04930023
035928     05  FILLER                  PIC X(6)     VALUE 'NBR'.        04940022
035929     05  FILLER                  PIC X(23)    VALUE 'STORE NAME'. 04950027
035930     05  FILLER                  PIC X(27)    VALUE ALL '-'.      04960027
035931     05  FILLER                  PIC X(14)    VALUE SPACES.       04970028
035936     05  FILLER                  PIC X(27)    VALUE ALL '-'.      04980027
035937     05  FILLER                  PIC X(14)    VALUE SPACES.       04990028
035938     05  FILLER                  PIC X(27)    VALUE ALL '-'.      05000027
035939     05  FILLER                  PIC X(14)    VALUE SPACES.       05010028
035940     05  FILLER                  PIC X(27)    VALUE ALL '-'.      05020027
035943                                                                  05030017
035944 01  DL-PYMNT-DETAIL-LINE.                                        05040020
035945     05  FILLER                  PIC X(13)    VALUE SPACES.       05050022
035946     05  DL-PYMNT-DETAIL-ID      PIC X(17)    VALUE SPACES.       05060022
035947         88  DL-PYMNT-COMPANY-TOTAL-ID        VALUE               05070022
035948             ' COMPANY TOTAL '.                                   05080022
035949     05  FILLER                  REDEFINES DL-PYMNT-DETAIL-ID.    05090022
035950         10  DL-PYMNT-STORE-NUMBER                                05100022
035951                                 PIC Z9(4).                       05110041
035952         10  FILLER              PIC X(2).                        05120041
035953         10  DL-PYMNT-STORE-NAME                                  05130022
035954                                 PIC X(10).                       05140022
035955     05  FILLER                  PIC X(13)    VALUE SPACES.       05150022
035974     05  DL-PYMNT-GIFT-CERT-REDEEM-CNT                            05160020
035975                                 PIC Z,ZZZ,ZZ9                    05170017
035976                                              VALUE ZEROS.        05180017
035977     05  FILLER                  PIC X(04)    VALUE SPACES.       05190022
035978     05  DL-PYMNT-GIFT-CERT-REDEEM-AMT                            05200020
035979                                 PIC ZZZ,ZZZ,ZZ9.99-              05210017
035980                                              VALUE ZEROS.        05220017
035981     05  FILLER                  PIC X(13)    VALUE SPACES.       05230022
035982     05  DL-PYMNT-GIFT-CARD-REDEEM-CNT                            05240020
035983                                 PIC Z,ZZZ,ZZ9                    05250017
035984                                              VALUE ZEROS.        05260017
035985     05  FILLER                  PIC X(04)    VALUE SPACES.       05270022
035986     05  DL-PYMNT-GIFT-CARD-REDEEM-AMT                            05280020
035987                                 PIC ZZZ,ZZZ,ZZ9.99-              05290017
035988                                              VALUE ZEROS.        05300017
035989     05  FILLER                  PIC X(13)    VALUE SPACES.       05310022
035990     05  DL-PYMNT-KCK-CARD-REDEEM-CNT                             05320020
035991                                 PIC Z,ZZZ,ZZ9                    05330017
035992                                              VALUE ZEROS.        05340017
035993     05  FILLER                  PIC X(04)    VALUE SPACES.       05350022
035994     05  DL-PYMNT-KCK-CARD-REDEEM-AMT                             05360020
035995                                 PIC ZZZ,ZZZ,ZZ9.99-              05370017
035996                                              VALUE ZEROS.        05380017
035997     05  FILLER                  PIC X(13)    VALUE SPACES.       05390022
035998     05  DL-PYMNT-NET-CARD-REDEEM-CNT                             05400020
035999                                 PIC Z,ZZZ,ZZ9                    05410017
036000                                              VALUE ZEROS.        05420017
036001     05  FILLER                  PIC X(04)    VALUE SPACES.       05430022
036002     05  DL-PYMNT-NET-CARD-REDEEM-AMT                             05440020
036003                                 PIC ZZZ,ZZZ,ZZ9.99-              05450017
036004                                              VALUE ZEROS.        05460017
036005*                                                                 05470017
036010*  SQL AND COBOL DECLARATIONS FOR THE STORE TABLE (XST_LOC)       05480041
036100*                                                                 05490003
036200                                                                  05500003
036300     EXEC SQL                                                     05510003
036400         INCLUDE  XST00001                                        05520041
036500     END-EXEC.                                                    05530003
036600                                                                  05540003
036700*                                                                 05550003
036800*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                05560003
036900*                                                                 05570003
037000                                                                  05580003
037100     EXEC SQL                                                     05590003
037200         INCLUDE SQLCA                                            05600003
037300     END-EXEC.                                                    05610003
037400                                                                  05620003
037500*                                                                 05630003
037600*  CURSOR USED TO RETRIEVE ALL STORE ROWS FOR DEPARTMENT STORES   05640003
037700*  WITHIN THE KOHL'S OPERATING COMPANY THAT WERE ACTIVE DURING THE05650003
037800*  REPORTING PERIOD                                               05660003
037900*                                                                 05670003
038000                                                                  05680003
038100     EXEC SQL                                                     05690003
038200         DECLARE STORE_CURSOR CURSOR FOR                          05700003
038300             SELECT LOC_NBR                                       05710041
038400                   ,LOC_10_ABBR_NM                                05720041
038500               FROM XST_LOC                                       05730041
038600              WHERE LOC_TYP_CDE = :PC-DEPARTMENT-STORE-TYPE       05740041
039000                AND CLO_DTE    >= :IR-ISO-RPT-PERIOD-START-DATE   05750041
039200                AND OPN_DTE    <= :IR-ISO-RPT-PERIOD-END-DATE     05760041
039400           ORDER BY LOC_NBR                                       05770041
039500     END-EXEC.                                                    05780003
039600                                                                  05790003
039700******************************************************************05800003
039800 PROCEDURE DIVISION.                                              05810003
039900******************************************************************05820003
040000                                                                  05830003
040100 0000-MAINLINE.                                                   05840003
040200     PERFORM 1000-INITIALIZE.                                     05850003
040300                                                                  05860003
040400     PERFORM 2000-PROCESS-STORE                                   05870003
040500         UNTIL ((PS-END-OF-GIFT-CERT-FILE)                        05880003
040600                 OR  (ST-INDEX > PV-STORE-COUNT)).                05890052
040700                                                                  05900003
040800     SET TT-INDEX TO PC-COMPANY-TOTAL-LEVEL.                      05910003
040900     SET DL-COMPANY-TOTAL-ID                                      05920023
040910         DL-PYMNT-COMPANY-TOTAL-ID TO TRUE.                       05930023
041000     SET PV-TRIPLE-SPACE TO TRUE.                                 05940003
041100     PERFORM 6000-CONTROL-BREAK.                                  05950003
041200                                                                  05960003
041300     PERFORM 9000-EOJ-ROUTINE.                                    05970003
041400                                                                  05980003
041500     STOP RUN.                                                    05990003
041600                                                                  06000003
041700******************************************************************06010003
041800*  SET UP FOR PROGRAM PROCESSING BY ACCEPTING AND VALIDATING THE *06020003
041900*  CONTROL CARD, OPENING ALL FILES, FILLING IN                   *06030006
042000*  THE FIELDS OF THE STANDARD REPORT HEADER, READING THE FIRST   *06040003
042100*  GIFT CERTIFICATE RECORD, DETERMINING THE REPORTING PERIOD,    *06050003
042200*  FILLING THE FIELDS OF THE OTHER REPORT TITLE LINES, BUILDING  *06060003
042300*  THE CORE STORE TABLE, AND INITIALIZING REQUIRED VARIABLES.    *06070003
042400******************************************************************06080003
042500                                                                  06090003
042600 1000-INITIALIZE.                                                 06100003
042700     ACCEPT CC-CONTROL-CARD.                                      06110003
042800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CONTROL CARD = ('       06120003
042900               CC-CONTROL-CARD-DISPLAY  ')'.                      06130003
043000                                                                  06140003
043100     PERFORM 1100-VALIDATE-CONTROL-CARD.                          06150003
043200                                                                  06160003
043300     OPEN INPUT  GIFT-CERTIFICATE-FILE                            06170003
043400          OUTPUT GIFT-CERT-SUMMARY-REPORT                         06180017
043410                 GIFT-CERT-PAYMENT-REPORT.                        06190017
043500                                                                  06200003
043800     ACCEPT CD-CURRENT-DATE FROM DATE.                            06210003
043900     MOVE CD-CURRENT-YEAR         TO DP200O-RUN-YEAR.             06220006
044000     MOVE CD-CURRENT-MONTH        TO DP200O-RUN-MONTH.            06230006
044100     MOVE CD-CURRENT-DAY          TO DP200O-RUN-DAY.              06240006
044200     ACCEPT CT-CURRENT-TIME FROM TIME.                            06250003
044300     MOVE CT-CURRENT-HOUR         TO DP200O-RUN-HOUR.             06260006
044400     MOVE CT-CURRENT-MINUTE       TO DP200O-RUN-MINUTE.           06270006
044500     MOVE PC-CURRENT-PROGRAM-NAME TO DP200O-PROGRAM-NAME.         06280006
044600     EVALUATE TRUE                                                06290003
044700         WHEN CC-DAILY-REPORTING-PERIOD                           06300003
044800             MOVE PC-DAILY-REPORT-NUMBER TO                       06310003
044900                       PV-REPORT-NUMBER                           06320003
044910             MOVE PC-PYMNT-DAILY-REPORT-NUMBER TO                 06330020
044920                       PV-PYMNT-REPORT-NUMBER                     06340020
045000         WHEN CC-WEEKLY-REPORTING-PERIOD                          06350003
045100             MOVE PC-WEEKLY-REPORT-NUMBER TO                      06360003
045200                       PV-REPORT-NUMBER                           06370003
045210             MOVE PC-PYMNT-WEEKLY-REPORT-NUMBER TO                06380020
045220                       PV-PYMNT-REPORT-NUMBER                     06390020
045300         WHEN CC-MONTHLY-REPORTING-PERIOD                         06400003
045400             MOVE PC-MONTHLY-REPORT-NUMBER TO                     06410003
045500                       PV-REPORT-NUMBER                           06420003
045510             MOVE PC-PYMNT-MONTHLY-REPORT-NUMBER TO               06430020
045520                       PV-PYMNT-REPORT-NUMBER                     06440020
045600     END-EVALUATE.                                                06450003
045800                                                                  06460003
045900     PERFORM 7000-READ-GIFT-CERT-FILE.                            06470003
046000                                                                  06480003
046100     PERFORM 1300-DETERMINE-RPT-PERIOD.                           06490003
046200                                                                  06500003
046300     EVALUATE TRUE                                                06510003
046400         WHEN CC-DAILY-REPORTING-PERIOD                           06520003
046500             MOVE PS003-GIFT-DATE        TO HL2A-POS-DATE         06530003
046510                                            HL2A-PYMNT-POS-DATE   06540020
046600         WHEN CC-WEEKLY-REPORTING-PERIOD                          06550003
046700             MOVE IR-ISO-RPT-PD-END-YEAR TO                       06560003
046800                       PV-CONVERTED-YEAR                          06570003
046900             MOVE IR-ISO-RPT-PD-END-MONTH TO                      06580003
047000                       PV-CONVERTED-MONTH                         06590003
047100             MOVE IR-ISO-RPT-PD-END-DAY TO                        06600003
047200                       PV-CONVERTED-DAY                           06610003
047300             MOVE PV-CONVERTED-DATE-MDY TO                        06620003
047400                       HL2B-WEEK-ENDING-DATE                      06630003
047410                       HL2B-PYMNT-WEEK-ENDING-DATE                06640020
047500         WHEN CC-MONTHLY-REPORTING-PERIOD                         06650003
047600             MOVE PV-FISCAL-PERIOD-NAME TO                        06660003
047700                       HL2C-MONTH-NAME                            06670003
047710                       HL2C-PYMNT-MONTH-NAME                      06680020
047800     END-EVALUATE.                                                06690003
047900                                                                  06700003
048000     PERFORM 1400-LOAD-STORE-TABLE.                               06710003
048100                                                                  06720003
048200     INITIALIZE TT-TOTALS-TABLE.                                  06730003
048300                                                                  06740003
048400     SET ST-INDEX TO 1.                                           06750003
048500*1000-EXIT.                                                       06760003
048600                                                                  06770003
048700******************************************************************06780003
048800*  VALIDATE THE CONTROL CARD.  VERIFY THAT A VALID REPORTING     *06790003
048900*  PERIOD INDICATOR WAS SPECIFIED.  TERMINATE PROCESSING IF ANY  *06800003
049000*  CONTROL CARD ERRORS ARE DETECTED.                             *06810003
049100******************************************************************06820003
049200                                                                  06830003
049300 1100-VALIDATE-CONTROL-CARD.                                      06840003
049400     IF (NOT CC-VALID-REPORTING-PERIOD)                           06850003
049500         DISPLAY '** ABEND **'                                    06860003
049600         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - INVALID REPORTING ' 06870003
049700                   'PERIOD INDICATOR "'  CC-REPORTING-PERIOD-IND  06880003
049800                   '" FOUND ON CONTROL CARD'                      06890003
049900         SET AC-CONTROL-CARD-ERROR TO TRUE                        06900003
050000         CALL 'ILBOABN0' USING ABEND-CODE                         06910003
050100     END-IF.                                                      06920003
050200*1100-EXIT.                                                       06930003
050300                                                                  06940003
053300******************************************************************06950003
053400*  DETERMINE THE REPORTING PERIOD START AND END DATES, USING     *06960003
053500*  THE CALENDAR ROUTINE.  FOR MONTHLY REPORTS, OBTAIN THE FISCAL *06970003
053600*  PERIOD NAME.  DISPLAY THE REPORTING PERIOD IN THE SYSOUT.     *06980003
053700******************************************************************06990003
053800                                                                  07000003
053900 1300-DETERMINE-RPT-PERIOD.                                       07010003
054000     INITIALIZE DPG51                                             07020003
054100                DPG52                                             07030003
054200                DPG53                                             07040003
054300                DPG54                                             07050003
054400                DPG55                                             07060003
054500                DPG56.                                            07070003
054600                                                                  07080003
054800     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       07090003
054900     SET DPG52-LK-DTE-GREG TO TRUE.                               07100003
055000     MOVE PS003-GIFT-DATE  TO DPG52-GREG-DATE-N.                  07110003
055100                                                                  07120003
055200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51,               07130033
055300                                             DPG52,               07140033
055400                                             DPG53,               07150033
055500                                             DPG54,               07160033
055600                                             DPG55,               07170033
055700                                             DPG56.               07180033
055800                                                                  07190003
055900     IF ((DPG54-SEVERE-ERROR)                                     07200003
056000             OR (DPG54-WARNING-ERROR))                            07210003
056100         DISPLAY '** ABEND **'                                    07220003
056200         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CALENDAR ROUTINE '  07230003
056300                     'ERROR ON REPORTING PERIOD DATE LOOKUP'      07240003
056400         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CALENDAR ROUTINE '  07250003
056500                     'ERROR INDICATOR = '  DPG54-ERROR-IND        07260003
056600         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CALENDAR ROUTINE '  07270003
056700                     'ERROR MESSAGE = '  DPG54-ERROR-MESSAGE      07280003
056710         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CALENDAR ROUTINE '  07290005
056720                     'DPG51         = '  DPG51                    07300005
056730         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CALENDAR ROUTINE '  07310005
056740                     'DPG52         = '  DPG52                    07320005
056750         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CALENDAR ROUTINE '  07330005
056760                     'DPG53         = '  DPG53                    07340005
056770         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CALENDAR ROUTINE '  07350005
056780                     'DPG54         = '  DPG54                    07360005
056800         SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                    07370003
056900         CALL 'ILBOABN0' USING ABEND-CODE                         07380003
057000     END-IF.                                                      07390003
057100                                                                  07400003
057200     EVALUATE TRUE                                                07410003
057300         WHEN CC-DAILY-REPORTING-PERIOD                           07420003
057400             MOVE DPG55-DB2-ISO-DATE-FMT TO                       07430003
057500                       IR-ISO-RPT-PERIOD-START-DATE               07440003
057600                       IR-ISO-RPT-PERIOD-END-DATE                 07450003
057700         WHEN CC-WEEKLY-REPORTING-PERIOD                          07460003
057800             MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO                    07470003
057900                       IR-ISO-RPT-PERIOD-START-DATE               07480003
058000             MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO                   07490003
058100                       IR-ISO-RPT-PERIOD-END-DATE                 07500003
058200         WHEN CC-MONTHLY-REPORTING-PERIOD                         07510003
058300             MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO                   07520003
058400                       IR-ISO-RPT-PERIOD-START-DATE               07530003
058500             MOVE DPG56-LAST-FP-DB2-ISO-FMT TO                    07540003
058600                       IR-ISO-RPT-PERIOD-END-DATE                 07550003
058700             MOVE DPG56-FISCAL-PERIOD-NBR TO                      07560003
058800                       PV-FISCAL-PERIOD-NBR                       07570003
058900             MOVE DPG56-FISCAL-PERIOD-NAME TO                     07580004
059000                       PV-FISCAL-PERIOD-NAME                      07590004
059100     END-EVALUATE.                                                07600003
059200                                                                  07610003
059300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - REPORTING PERIOD START '07620003
059400               'DATE = '  IR-ISO-RPT-PERIOD-START-DATE            07630003
059500               '; REPORTING PERIOD END DATE = '                   07640003
059600               IR-ISO-RPT-PERIOD-END-DATE.                        07650003
059700*1300-EXIT.                                                       07660003
059800                                                                  07670003
059900******************************************************************07680003
060000*  LOAD THE CORE STORE TABLE.  OPEN THE STORE CURSOR, WHICH WILL *07690003
060100*  RETRIEVE THE REQUIRED ROWS FROM THE STORE TABLE IN ASCENDING  *07700003
060200*  STORE NUMBER SEQUENCE.  INITIALIZE THE CORE TABLE.  FETCH THE *07710003
060300*  FIRST STORE ROW.  LOAD THE CORE TABLE UNTIL THE END OF THE    *07720003
060400*  CURSOR IS REACHED, OR THE TABLE LIMIT HAS BEEN EXCEEDED.      *07730003
060500*  CLOSE THE CURSOR.                                             *07740003
060600******************************************************************07750003
060700                                                                  07760003
060800 1400-LOAD-STORE-TABLE.                                           07770003
060900     EXEC SQL                                                     07780003
061000         OPEN STORE_CURSOR                                        07790003
061100     END-EXEC.                                                    07800003
061200                                                                  07810003
061300     IF SQLCODE NOT = PC-SUCCESSFUL-SQLCODE                       07820003
061400         SET PV-OPEN-STORE-CURSOR TO TRUE                         07830003
061500         PERFORM 9900-DB2-ERROR                                   07840003
061600     END-IF.                                                      07850003
061700                                                                  07860003
061800     INITIALIZE ST-STORE-TABLE                                    07870003
061900         REPLACING ALPHANUMERIC DATA BY HIGH-VALUES.              07880003
062000                                                                  07890003
062100     PERFORM 7100-FETCH-STORE-ROW.                                07900003
062200                                                                  07910003
062300     PERFORM                                                      07920003
062400             VARYING ST-INDEX                                     07930003
062500             FROM 1 BY 1                                          07940003
062600             UNTIL ((ST-INDEX > PC-MAXIMUM-STORE-COUNT)           07950003
062700                     OR (SQLCODE = PC-END-OF-CURSOR-SQLCODE))     07960003
062900         MOVE XST00001-LOC-NBR   TO ST-STORE-NUMBER (ST-INDEX)    07970041
063100         MOVE XST00001-LOC-10-ABBR-NM TO                          07980041
063200                   ST-STORE-NAME (ST-INDEX)                       07990003
063300         ADD +1 TO PV-STORE-COUNT                                 08000003
063400         PERFORM 7100-FETCH-STORE-ROW                             08010003
063500     END-PERFORM.                                                 08020003
063600                                                                  08030003
063700     IF ST-INDEX > PC-MAXIMUM-STORE-COUNT                         08040003
063800         DISPLAY '** ABEND **'                                    08050003
063900         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - MAXIMUM NUMBER OF ' 08060003
064000                   'STORE TABLE ENTRIES EXCEEDED WHILE LOADING  ' 08070003
064100                   ' STORE TABLE'                                 08080003
064200         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - EXPAND THE TABLE '  08090003
064300                   'AND RERUN'                                    08100003
064400         SET AC-TABLE-OVERFLOW-ERROR TO TRUE                      08110003
064500         CALL 'ILBOABN0' USING ABEND-CODE                         08120003
064600     END-IF.                                                      08130003
064700                                                                  08140003
064800     EXEC SQL                                                     08150003
064900         CLOSE STORE_CURSOR                                       08160003
065000     END-EXEC.                                                    08170003
065100                                                                  08180003
065200                                                                  08190003
065300     IF SQLCODE NOT = PC-SUCCESSFUL-SQLCODE                       08200003
065400         SET PV-CLOSE-STORE-CURSOR TO TRUE                        08210003
065500         PERFORM 9900-DB2-ERROR                                   08220003
065600     END-IF.                                                      08230003
065700*1400-EXIT.                                                       08240003
065800                                                                  08250003
065900******************************************************************08260003
066000*  PROCESS A STORE.  MERGE THE CORE STORE TABLE WITH THE SORTED  *08270003
066100*  GIFT CERTIFICATE FILE.  IF THE TABLE STORE NUMBER IS LESS     *08280003
066200*  THAN THE FILE STORE NUMBER, IT IS A VALID STORE WITH NO GIFT  *08290003
066300*  CERTIFICATE ACTIVITY.                                         *08300003
066400******************************************************************08310003
066500                                                                  08320003
066600 2000-PROCESS-STORE.                                              08330003
066700     SET TT-INDEX TO PC-STORE-TOTAL-LEVEL.                        08340003
066800     INITIALIZE TT-TOTALS-ENTRY (TT-INDEX).                       08350003
066900                                                                  08360003
067000     IF (ST-INDEX NOT > PV-STORE-COUNT)                           08370003
067100         MOVE ST-STORE-NUMBER (ST-INDEX) TO                       08380003
067200                   CK-TABLE-STORE-NUMBER                          08390003
067500     END-IF.                                                      08400003
067600                                                                  08410003
067700     IF (NOT PS-END-OF-GIFT-CERT-FILE)                            08420003
067800         MOVE PS003-STORE-NBR TO PV-STORE-NUMBER                  08430003
067900         MOVE PV-STORE-NUMBER TO                                  08440041
068000                   CK-FILE-STORE-NUMBER                           08450003
068300     END-IF.                                                      08460053
                                                                        08470054
068500     EVALUATE TRUE                                                08480054
068600         WHEN CK-TABLE-STORE-NUMBER = CK-FILE-STORE-NUMBER        08490054
068700             MOVE PS003-STORE-NBR TO CK-STORE-NUMBER              08500054
068800             MOVE ST-STORE-NAME (ST-INDEX) TO CK-STORE-NAME       08510054
068900             PERFORM 3000-PROCESS-GIFT-CERT-RECORD                08520054
069000                 UNTIL ((PS-END-OF-GIFT-CERT-FILE)                08530003
069100                     OR (PS003-STORE-NBR NOT = CK-STORE-NUMBER))  08540003
069200             SET ST-INDEX UP BY 1                                 08550054
069300         WHEN CK-TABLE-STORE-NUMBER < CK-FILE-STORE-NUMBER        08560054
069400             MOVE ST-STORE-NUMBER (ST-INDEX) TO CK-STORE-NUMBER   08570054
069500             MOVE ST-STORE-NAME (ST-INDEX) TO CK-STORE-NAME       08580054
069600             SET ST-INDEX UP BY 1                                 08590054
069700         WHEN OTHER                                               08600054
069800             MOVE PS003-STORE-NBR TO CK-STORE-NUMBER              08610054
069900             SET CK-UNKNOWN-STORE-NAME TO TRUE                    08620054
070000             PERFORM 3000-PROCESS-GIFT-CERT-RECORD                08630054
070100                 UNTIL ((PS-END-OF-GIFT-CERT-FILE)                08640003
070200                     OR (PS003-STORE-NBR NOT = CK-STORE-NUMBER))  08650003
070300     END-EVALUATE.                                                08660054
                                                                        08670054
070500     SET TT-INDEX TO PC-STORE-TOTAL-LEVEL.                        08680055
070600     MOVE CK-STORE-NUMBER TO DL-STORE-NUMBER                      08690054
070610                             DL-PYMNT-STORE-NUMBER.               08700055
070700     MOVE CK-STORE-NAME TO DL-STORE-NAME                          08710056
070710                           DL-PYMNT-STORE-NAME.                   08720055
070800     PERFORM 6000-CONTROL-BREAK.                                  08730054
070900*2000-EXIT.                                                       08740003
071000                                                                  08750003
071100******************************************************************08760003
071200*  PROCESS A SORTED GIFT CERTIFICATE FILE RECORD, ACCUMULATING   *08770003
071300*  TOTAL COUNTS AND AMOUNTS OF GIFT CERTIFICATE SALES AND        *08780003
071400*  REDEMPTIONS.  A POSITIVE LINE ITEM SALE AMOUNT WILL INDICATE  *08790003
071500*  A GIFT CERTIFICATE SALE, AND A NEGATIVE LINE ITEM SALE AMOUNT *08800003
071600*  WILL INDICATE A GIFT CERTIFICATE REDEMPTION.                  *08810003
071700******************************************************************08820003
071800                                                                  08830003
071900 3000-PROCESS-GIFT-CERT-RECORD.                                   08840003
072000     IF PS003-AMOUNT >= ZERO                                      08850003
072100         IF PS003-GIFT-CERT-TYPE                                  08860006
072110             ADD +1 TO TT-GIFT-CERTIFICATE-SOLD-CNT (TT-INDEX)    08870006
072200             COMPUTE TT-GIFT-CERTIFICATE-SOLD-AMT (TT-INDEX) =    08880006
072300                   (TT-GIFT-CERTIFICATE-SOLD-AMT (TT-INDEX) +     08890003
072400                   PS003-AMOUNT)                                  08900003
072410         ELSE                                                     08910006
072412             ADD +1 TO TT-GIFT-CARD-SOLD-CNT (TT-INDEX)           08920006
072413             COMPUTE TT-GIFT-CARD-SOLD-AMT (TT-INDEX) =           08930006
072414                   (TT-GIFT-CARD-SOLD-AMT (TT-INDEX) +            08940006
072415                   PS003-AMOUNT)                                  08950006
072420         END-IF                                                   08960006
072500     ELSE                                                         08970003
072510         IF PS003-GIFT-CERT-TYPE                                  08980006
072600             ADD +1 TO TT-GIFT-CERTIFICATE-REDEEM-CNT (TT-INDEX)  08990006
072700             COMPUTE TT-GIFT-CERTIFICATE-REDEEM-AMT (TT-INDEX) =  09000006
072800                   (TT-GIFT-CERTIFICATE-REDEEM-AMT (TT-INDEX) -   09010003
072900                   PS003-AMOUNT)                                  09020003
GAYLEN             IF PS003-TRAN-TYPE-30                                09030038
072902               ADD +1 TO                                          09040017
072903                    TT-PYMNT-GIFT-CERT-REDEEM-CNT                 09050020
072904                                                    (TT-INDEX)    09060017
072905               COMPUTE                                            09070017
072906                    TT-PYMNT-GIFT-CERT-REDEEM-AMT                 09080020
072907                                                    (TT-INDEX) =  09090017
072908                   (TT-PYMNT-GIFT-CERT-REDEEM-AMT                 09100020
072909                                                    (TT-INDEX) -  09110017
072910                    PS003-AMOUNT)                                 09120017
072911             END-IF                                               09130017
072912         ELSE                                                     09140017
072913             IF PS003-GIFT-CARD-TYPE                              09150017
072914                 ADD +1 TO TT-GIFT-CARD-REDEEM-CNT (TT-INDEX)     09160017
072915                 COMPUTE TT-GIFT-CARD-REDEEM-AMT (TT-INDEX) =     09170017
072916                       (TT-GIFT-CARD-REDEEM-AMT (TT-INDEX) -      09180017
072917                       PS003-AMOUNT)                              09190017
GAYLEN                 IF PS003-TRAN-TYPE-30                            09200038
072919                     ADD +1 TO TT-PYMNT-GIFT-CARD-REDEEM-CNT      09210020
072921                                                    (TT-INDEX)    09220017
072923                     COMPUTE TT-PYMNT-GIFT-CARD-REDEEM-AMT        09230020
072924                                                    (TT-INDEX) =  09240017
072925                            (TT-PYMNT-GIFT-CARD-REDEEM-AMT        09250020
072926                                                    (TT-INDEX) -  09260017
072927                             PS003-AMOUNT)                        09270017
072928                 END-IF                                           09280017
072929             ELSE                                                 09290017
072930                 ADD +1 TO TT-KCK-CARD-REDEEM-CNT (TT-INDEX)      09300017
072931                 COMPUTE TT-KCK-CARD-REDEEM-AMT (TT-INDEX) =      09310017
072932                       (TT-KCK-CARD-REDEEM-AMT (TT-INDEX) -       09320017
072933                       PS003-AMOUNT)                              09330017
GAYLEN                 IF PS003-TRAN-TYPE-30                            09340038
072935                     ADD +1 TO TT-PYMNT-KCK-CARD-REDEEM-CNT       09350020
072936                                                    (TT-INDEX)    09360017
072937                     COMPUTE TT-PYMNT-KCK-CARD-REDEEM-AMT         09370020
072938                                                    (TT-INDEX) =  09380017
072939                            (TT-PYMNT-KCK-CARD-REDEEM-AMT         09390020
072940                                                    (TT-INDEX) -  09400017
072941                             PS003-AMOUNT)                        09410017
072942                 END-IF                                           09420017
072943             END-IF                                               09430017
072950         END-IF                                                   09440006
073000     END-IF.                                                      09450003
073100                                                                  09460003
073200     PERFORM 7000-READ-GIFT-CERT-FILE.                            09470003
073300*3000-EXIT.                                                       09480003
073400                                                                  09490003
073500******************************************************************09500003
073600*  HANDLE A CONTROL BREAK FOR THE REPORT.  COMPUTE THE REQUIRED  *09510003
073700*  TOTALS FOR THAT CONTROL BREAK LEVEL, AND BUILD/WRITE THE      *09520003
073800*  DETAIL LINE.  IF THE CONTROL BREAK IS NOT FOR THE COMPANY     *09530003
073900*  TOTAL LEVEL, ACCUMULATE THE TOTALS INTO THE NEXT HIGHER LEVEL *09540003
074000*  OF CONTROL BREAK TOTALS.                                      *09550003
074100******************************************************************09560003
074200                                                                  09570003
074300 6000-CONTROL-BREAK.                                              09580003
074400     MOVE TT-GIFT-CERTIFICATE-SOLD-CNT (TT-INDEX) TO              09590003
074500               DL-GIFT-CERTIFICATE-SOLD-CNT.                      09600003
074600     MOVE TT-GIFT-CERTIFICATE-SOLD-AMT (TT-INDEX) TO              09610003
074700               DL-GIFT-CERTIFICATE-SOLD-AMT.                      09620003
074710     MOVE TT-GIFT-CARD-SOLD-CNT (TT-INDEX) TO                     09630006
074720               DL-GIFT-CARD-SOLD-CNT.                             09640006
074730     MOVE TT-GIFT-CARD-SOLD-AMT (TT-INDEX) TO                     09650006
074740               DL-GIFT-CARD-SOLD-AMT.                             09660006
074750                                                                  09670018
074800     MOVE TT-GIFT-CERTIFICATE-REDEEM-CNT (TT-INDEX) TO            09680003
074900               DL-GIFT-CERTIFICATE-REDEEM-CNT.                    09690003
074901     MOVE TT-GIFT-CERTIFICATE-REDEEM-AMT (TT-INDEX) TO            09700018
074902               DL-GIFT-CERTIFICATE-REDEEM-AMT.                    09710018
075110     MOVE TT-GIFT-CARD-REDEEM-CNT (TT-INDEX) TO                   09720006
075120               DL-GIFT-CARD-REDEEM-CNT.                           09730006
075130     MOVE TT-GIFT-CARD-REDEEM-AMT (TT-INDEX) TO                   09740006
075140               DL-GIFT-CARD-REDEEM-AMT.                           09750006
075141     MOVE TT-KCK-CARD-REDEEM-CNT (TT-INDEX) TO                    09760018
075142               DL-KCK-CARD-REDEEM-CNT.                            09770018
075143     MOVE TT-KCK-CARD-REDEEM-AMT (TT-INDEX) TO                    09780018
075144               DL-KCK-CARD-REDEEM-AMT.                            09790018
075145                                                                  09800018
075210     COMPUTE PV-NET-SOLD-CNT =                                    09810006
075400              (TT-GIFT-CERTIFICATE-SOLD-CNT (TT-INDEX) +          09820007
075401               TT-GIFT-CARD-SOLD-CNT (TT-INDEX)).                 09830006
075402     MOVE PV-NET-SOLD-CNT   TO DL-NET-CARD-SOLD-CNT.              09840013
075404     COMPUTE PV-NET-SOLD-AMT =                                    09850006
075405              (TT-GIFT-CERTIFICATE-SOLD-AMT (TT-INDEX) +          09860007
075406               TT-GIFT-CARD-SOLD-AMT (TT-INDEX)).                 09870006
075408     MOVE PV-NET-SOLD-AMT   TO DL-NET-CARD-SOLD-AMT.              09880013
075420     COMPUTE PV-NET-REDEEM-CNT =                                  09890006
075430              (TT-GIFT-CERTIFICATE-REDEEM-CNT (TT-INDEX) +        09900007
075440               TT-GIFT-CARD-REDEEM-CNT (TT-INDEX) +               09910006
075450               TT-KCK-CARD-REDEEM-CNT (TT-INDEX)).                09920007
075600     MOVE PV-NET-REDEEM-CNT TO DL-NET-CARD-REDEEM-CNT.            09930013
075700     COMPUTE PV-NET-REDEEM-AMT =                                  09940006
075900              (TT-GIFT-CERTIFICATE-REDEEM-AMT (TT-INDEX) +        09950007
075910               TT-GIFT-CARD-REDEEM-AMT (TT-INDEX) +               09960006
075920               TT-KCK-CARD-REDEEM-AMT (TT-INDEX)).                09970008
076100     MOVE PV-NET-REDEEM-AMT TO DL-NET-CARD-REDEEM-AMT.            09980013
076200                                                                  09990003
076300     IF (PV-LINE-COUNT + PV-ADVANCE-COUNT) > PC-PAGE-SIZE         10000003
076400         PERFORM 8000-PRINT-TITLE-LINES                           10010003
076500     END-IF.                                                      10020003
076600                                                                  10030003
076700     WRITE GC-GIFT-CERT-SUMMARY-LINE                              10040003
076800         FROM DL-DETAIL-LINE                                      10050003
076900         AFTER ADVANCING PV-ADVANCE-COUNT LINES.                  10060003
077000                                                                  10070003
077100     ADD PV-ADVANCE-COUNT TO PV-LINE-COUNT.                       10080003
077200     SET PV-DOUBLE-SPACE TO TRUE.                                 10090003
077300                                                                  10100003
077310     MOVE TT-PYMNT-GIFT-CERT-REDEEM-CNT (TT-INDEX) TO             10110020
077320               DL-PYMNT-GIFT-CERT-REDEEM-CNT.                     10120020
077330     MOVE TT-PYMNT-GIFT-CERT-REDEEM-AMT (TT-INDEX) TO             10130020
077340               DL-PYMNT-GIFT-CERT-REDEEM-AMT.                     10140020
077350     MOVE TT-PYMNT-GIFT-CARD-REDEEM-CNT (TT-INDEX) TO             10150020
077360               DL-PYMNT-GIFT-CARD-REDEEM-CNT.                     10160020
077370     MOVE TT-PYMNT-GIFT-CARD-REDEEM-AMT (TT-INDEX) TO             10170020
077380               DL-PYMNT-GIFT-CARD-REDEEM-AMT.                     10180020
077390     MOVE TT-PYMNT-KCK-CARD-REDEEM-CNT (TT-INDEX) TO              10190020
077391               DL-PYMNT-KCK-CARD-REDEEM-CNT.                      10200020
077392     MOVE TT-PYMNT-KCK-CARD-REDEEM-AMT (TT-INDEX) TO              10210020
077393               DL-PYMNT-KCK-CARD-REDEEM-AMT.                      10220020
077394                                                                  10230018
077395     COMPUTE PV-PYMNT-NET-REDEEM-CNT =                            10240020
077396              (TT-PYMNT-GIFT-CERT-REDEEM-CNT (TT-INDEX)          +10250020
077397               TT-PYMNT-GIFT-CARD-REDEEM-CNT (TT-INDEX) +         10260020
077398               TT-PYMNT-KCK-CARD-REDEEM-CNT (TT-INDEX)).          10270020
077399     MOVE PV-PYMNT-NET-REDEEM-CNT TO                              10280020
077400               DL-PYMNT-NET-CARD-REDEEM-CNT.                      10290020
077401     COMPUTE PV-PYMNT-NET-REDEEM-AMT =                            10300020
077402              (TT-PYMNT-GIFT-CERT-REDEEM-AMT (TT-INDEX)          +10310020
077403               TT-PYMNT-GIFT-CARD-REDEEM-AMT (TT-INDEX) +         10320020
077404               TT-PYMNT-KCK-CARD-REDEEM-AMT (TT-INDEX)).          10330020
077405     MOVE PV-PYMNT-NET-REDEEM-AMT TO                              10340020
077406               DL-PYMNT-NET-CARD-REDEEM-AMT.                      10350020
077407                                                                  10360018
077408     IF (PV-PYMNT-LINE-COUNT + PV-ADVANCE-COUNT) > PC-PAGE-SIZE   10370020
077409         PERFORM 8100-PRINT-PAYMENT-TITLE-LINES                   10380020
077410     END-IF.                                                      10390018
077411                                                                  10400018
077412     WRITE GC-GIFT-CERT-PAYMENT-LINE                              10410018
077413         FROM DL-PYMNT-DETAIL-LINE                                10420020
077414         AFTER ADVANCING PV-ADVANCE-COUNT LINES.                  10430018
077415                                                                  10440018
077416     ADD PV-ADVANCE-COUNT TO PV-PYMNT-LINE-COUNT.                 10450020
077417     SET PV-DOUBLE-SPACE TO TRUE.                                 10460018
077418                                                                  10470018
077420     IF TT-INDEX NOT = PC-COMPANY-TOTAL-LEVEL                     10480003
077500         ADD TT-GIFT-CERTIFICATE-SOLD-CNT (TT-INDEX) TO           10490003
077600               TT-GIFT-CERTIFICATE-SOLD-CNT (TT-INDEX + 1)        10500003
077610         ADD TT-GIFT-CARD-SOLD-CNT (TT-INDEX) TO                  10510006
077620               TT-GIFT-CARD-SOLD-CNT (TT-INDEX + 1)               10520006
077700         ADD TT-GIFT-CERTIFICATE-SOLD-AMT (TT-INDEX) TO           10530003
077800               TT-GIFT-CERTIFICATE-SOLD-AMT (TT-INDEX + 1)        10540003
077810         ADD TT-GIFT-CARD-SOLD-AMT (TT-INDEX) TO                  10550006
077820               TT-GIFT-CARD-SOLD-AMT (TT-INDEX + 1)               10560006
077900         ADD TT-GIFT-CERTIFICATE-REDEEM-CNT (TT-INDEX) TO         10570003
078000               TT-GIFT-CERTIFICATE-REDEEM-CNT (TT-INDEX + 1)      10580003
078010         ADD TT-GIFT-CARD-REDEEM-CNT (TT-INDEX) TO                10590006
078020               TT-GIFT-CARD-REDEEM-CNT (TT-INDEX + 1)             10600006
078030         ADD TT-KCK-CARD-REDEEM-CNT (TT-INDEX) TO                 10610006
078040               TT-KCK-CARD-REDEEM-CNT (TT-INDEX + 1)              10620006
078100         ADD TT-GIFT-CERTIFICATE-REDEEM-AMT (TT-INDEX) TO         10630003
078200               TT-GIFT-CERTIFICATE-REDEEM-AMT (TT-INDEX + 1)      10640003
078210         ADD TT-GIFT-CARD-REDEEM-AMT (TT-INDEX) TO                10650006
078220               TT-GIFT-CARD-REDEEM-AMT (TT-INDEX + 1)             10660006
078230         ADD TT-KCK-CARD-REDEEM-AMT (TT-INDEX) TO                 10670006
078240               TT-KCK-CARD-REDEEM-AMT (TT-INDEX + 1)              10680006
078241                                                                  10690018
078250         ADD TT-PYMNT-GIFT-CERT-REDEEM-CNT (TT-INDEX) TO          10700020
078260             TT-PYMNT-GIFT-CERT-REDEEM-CNT (TT-INDEX +          1)10710020
078270         ADD TT-PYMNT-GIFT-CARD-REDEEM-CNT (TT-INDEX) TO          10720020
078280               TT-PYMNT-GIFT-CARD-REDEEM-CNT (TT-INDEX + 1)       10730020
078290         ADD TT-PYMNT-KCK-CARD-REDEEM-CNT (TT-INDEX) TO           10740020
078291               TT-PYMNT-KCK-CARD-REDEEM-CNT (TT-INDEX + 1)        10750020
078292         ADD TT-PYMNT-GIFT-CERT-REDEEM-AMT (TT-INDEX) TO          10760020
078293             TT-PYMNT-GIFT-CERT-REDEEM-AMT (TT-INDEX +          1)10770020
078294         ADD TT-PYMNT-GIFT-CARD-REDEEM-AMT (TT-INDEX) TO          10780020
078295               TT-PYMNT-GIFT-CARD-REDEEM-AMT (TT-INDEX + 1)       10790020
078296         ADD TT-PYMNT-KCK-CARD-REDEEM-AMT (TT-INDEX) TO           10800020
078297               TT-PYMNT-KCK-CARD-REDEEM-AMT (TT-INDEX + 1)        10810020
078300     END-IF.                                                      10820003
078400*6000-EXIT.                                                       10830003
078500                                                                  10840003
078600******************************************************************10850003
078700*  READ A GIFT CERTIFICATE FILE RECORD.                          *10860003
078800******************************************************************10870003
078900                                                                  10880003
079000 7000-READ-GIFT-CERT-FILE.                                        10890003
079100     READ GIFT-CERTIFICATE-FILE                                   10900003
079200         INTO PS003-GIFT-RECORD                                   10910003
079300         AT END                                                   10920003
079400             SET PS-END-OF-GIFT-CERT-FILE TO TRUE                 10930003
079500     END-READ.                                                    10940003
079600*7000-EXIT.                                                       10950003
079700                                                                  10960003
079800******************************************************************10970003
079900*  FETCH A ROW FROM THE STORE CURSOR.                            *10980003
080000******************************************************************10990003
080100                                                                  11000003
080200 7100-FETCH-STORE-ROW.                                            11010003
080300     EXEC SQL                                                     11020003
080400         FETCH STORE_CURSOR                                       11030003
080500             INTO :XST00001-LOC-NBR                               11040041
080600                 ,:XST00001-LOC-10-ABBR-NM                        11050041
080700     END-EXEC.                                                    11060003
080800                                                                  11070003
080900     IF ((SQLCODE NOT = PC-SUCCESSFUL-SQLCODE)                    11080003
081000             AND (SQLCODE NOT = PC-END-OF-CURSOR-SQLCODE))        11090003
081100         SET PV-FETCH-STORE-ROW TO TRUE                           11100003
081200         PERFORM 9900-DB2-ERROR                                   11110003
081300     END-IF.                                                      11120003
081400*7100-EXIT.                                                       11130003
081500                                                                  11140003
081600******************************************************************11150003
081700*  PRINT TITLE LINES ON THE REPORT AT EACH PAGE BREAK.  UPDATE   *11160003
081800*  THE PAGE NUMBER.                                              *11170003
081900******************************************************************11180003
082000                                                                  11190003
082100 8000-PRINT-TITLE-LINES.                                          11200003
082200     ADD +1 TO PV-PAGE-COUNT.                                     11210003
082210     MOVE PV-REPORT-NUMBER TO DP200O-REPORT-NUMBER.               11220018
082300     MOVE PV-PAGE-COUNT TO DP200O-PAGE-NUMBER.                    11230006
082400     WRITE GC-GIFT-CERT-SUMMARY-LINE                              11240003
082500         FROM DP200O-STANDRD-HEADER-200-COLS                      11250006
082600         AFTER ADVANCING PAGE.                                    11260003
082700                                                                  11270003
082800     EVALUATE TRUE                                                11280003
082900         WHEN CC-DAILY-REPORTING-PERIOD                           11290003
083000             WRITE GC-GIFT-CERT-SUMMARY-LINE                      11300003
083100                 FROM HL2A-HEADING-LINE-2A                        11310003
083200                 AFTER ADVANCING 1 LINE                           11320003
083300         WHEN CC-WEEKLY-REPORTING-PERIOD                          11330003
083400             WRITE GC-GIFT-CERT-SUMMARY-LINE                      11340003
083500                 FROM HL2B-HEADING-LINE-2B                        11350003
083600                 AFTER ADVANCING 1 LINE                           11360003
083700         WHEN CC-MONTHLY-REPORTING-PERIOD                         11370003
083800             WRITE GC-GIFT-CERT-SUMMARY-LINE                      11380003
083900                 FROM HL2C-HEADING-LINE-2C                        11390003
084000                 AFTER ADVANCING 1 LINE                           11400003
084100     END-EVALUATE.                                                11410003
084200                                                                  11420003
084300     WRITE GC-GIFT-CERT-SUMMARY-LINE                              11430003
084400         FROM HL3-HEADING-LINE-3                                  11440003
084500         AFTER ADVANCING 2 LINES.                                 11450003
084600     WRITE GC-GIFT-CERT-SUMMARY-LINE                              11460003
084700         FROM HL4-HEADING-LINE-4                                  11470003
084800         AFTER ADVANCING 1 LINE.                                  11480003
084810     WRITE GC-GIFT-CERT-SUMMARY-LINE                              11490009
084820         FROM HL5-HEADING-LINE-5                                  11500011
084830         AFTER ADVANCING 1 LINE.                                  11510009
084900                                                                  11520003
085000     MOVE PC-HEADING-LINE-COUNT TO PV-LINE-COUNT.                 11530003
085100     SET PV-DOUBLE-SPACE TO TRUE.                                 11540003
085200*8000-EXIT.                                                       11550003
085300                                                                  11560003
085310******************************************************************11570018
085320*  PRINT TITLE LINES ON THE PAYMENT REPORT AT EACH PAGE BREAK.   *11580018
085330*  UPDATE THE PAGE NUMBER.                                       *11590018
085340******************************************************************11600018
085350                                                                  11610018
085360 8100-PRINT-PAYMENT-TITLE-LINES.                                  11620018
085370     ADD +1 TO PV-PYMNT-PAGE-COUNT.                               11630020
085371     MOVE PV-PYMNT-REPORT-NUMBER TO DP200O-REPORT-NUMBER.         11640020
085380     MOVE PV-PYMNT-PAGE-COUNT TO DP200O-PAGE-NUMBER.              11650020
085390     WRITE GC-GIFT-CERT-PAYMENT-LINE                              11660018
085391         FROM DP200O-STANDRD-HEADER-200-COLS                      11670018
085392         AFTER ADVANCING PAGE.                                    11680018
085393                                                                  11690018
085394     EVALUATE TRUE                                                11700018
085395         WHEN CC-DAILY-REPORTING-PERIOD                           11710021
085396             WRITE GC-GIFT-CERT-PAYMENT-LINE                      11720018
085397                 FROM HL2A-PYMNT-HEADING-LINE-2A                  11730020
085398                 AFTER ADVANCING 1 LINE                           11740018
085399         WHEN CC-WEEKLY-REPORTING-PERIOD                          11750021
085400             WRITE GC-GIFT-CERT-PAYMENT-LINE                      11760018
085401                 FROM HL2B-PYMNT-HEADING-LINE-2B                  11770020
085402                 AFTER ADVANCING 1 LINE                           11780018
085403         WHEN CC-MONTHLY-REPORTING-PERIOD                         11790021
085404             WRITE GC-GIFT-CERT-PAYMENT-LINE                      11800018
085405                 FROM HL2C-PYMNT-HEADING-LINE-2C                  11810020
085406                 AFTER ADVANCING 1 LINE                           11820018
085407     END-EVALUATE.                                                11830018
085408                                                                  11840018
085409     WRITE GC-GIFT-CERT-PAYMENT-LINE                              11850018
085410         FROM HL3-PYMNT-HEADING-LINE-3                            11860020
085411         AFTER ADVANCING 2 LINES.                                 11870018
085412     WRITE GC-GIFT-CERT-PAYMENT-LINE                              11880018
085413         FROM HL4-PYMNT-HEADING-LINE-4                            11890020
085414         AFTER ADVANCING 1 LINE.                                  11900018
085415     WRITE GC-GIFT-CERT-PAYMENT-LINE                              11910018
085416         FROM HL5-PYMNT-HEADING-LINE-5                            11920020
085417         AFTER ADVANCING 1 LINE.                                  11930018
085418                                                                  11940018
085419     MOVE PC-PYMNT-HEADING-LINE-COUNT TO PV-PYMNT-LINE-COUNT.     11950020
085420     SET PV-DOUBLE-SPACE TO TRUE.                                 11960018
085421*8000-EXIT.                                                       11970018
085422                                                                  11980018
085430******************************************************************11990018
085500*  CLOSE ALL FILES.                                              *12000003
085600******************************************************************12010003
085700                                                                  12020003
085800 9000-EOJ-ROUTINE.                                                12030003
085900     CLOSE GIFT-CERTIFICATE-FILE                                  12040003
086000           GIFT-CERT-SUMMARY-REPORT                               12050017
086010           GIFT-CERT-PAYMENT-REPORT.                              12060017
086100*9000-EXIT.                                                       12070003
086200                                                                  12080003
086300******************************************************************12090003
086400*  FORMAT A DB2 ERROR MESSAGE, AND ABEND THE PROGRAM.            *12100003
086500******************************************************************12110003
086600                                                                  12120003
086700 9900-DB2-ERROR.                                                  12130003
086800     DISPLAY '** ABEND **'.                                       12140003
086900     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - SQL ERROR'.             12150003
087000     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - ATTEMPTING TO '         12160003
087100               PV-LAST-DB2-ACTION.                                12170003
087200                                                                  12180003
087300*                                                                 12190003
087400*  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     12200003
087500*  THE CALLED MODULE DSNTIAR.                                     12210003
087600*                                                                 12220003
087700                                                                  12230003
087800     COPY DPPD004.                                                12240003
087900                                                                  12250003
088000     SET AC-DB2-ERROR TO TRUE.                                    12260003
088100     CALL 'ILBOABN0' USING ABEND-CODE.                            12270003
088200*9900-EXIT.                                                       12280003
