000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    APKUT199.                                         00020001
000300 AUTHOR.        NANCY EILBES.                                     00030001
000400 INSTALLATION.  KOHLS.                                            00040001
000500 DATE-WRITTEN   OCTOBER 2004.                                     00050001
000600 DATE-COMPILED.                                                   00060001
000700******************************************************************00070001
000800*  MERGE BROADCAST/BRIDAL/NON-AGREEMENT DATA FOR REPORTING       *00080007
000810*                                                                *00081001
000820*  COBOL                                                         *00082001
000830*                                                                *00083001
000840*  THIS PROGRAM WILL READ A FILE OF BROADCAST OR BRIDAL DATA     *00084001
000850*  WHICH ALSO CONTAINS ACTIVITY RECORDS FOR EVERY VENDOR WHETHER *00085001
000860*  THEY PARTICIPATE IN ONE OF THESE PROGRAMS OR NOT.  BEFORE     *00086001
000870*  BEING REPORTED, THIS DATA NEEDS TO BE CONDENSED DOWN TO ONE   *00087001
000871*  RECORD PER VENDOR/DEPARTMENT. EACH VENDOR/DEPT WHERE AN       *00087101
000872*  AGREEMENT EXISTS WILL HAVE AT LEAST 2 RECORDS, ONE CONTAINING *00087201
000873*  THE ACTIVITY FOR THE REPORTING PERIOD IN TOTAL, AND ONE       *00087301
000874*  CONTAINING THE ACTIVITY FOR THE REPORTING PERIOD AS LONG AS   *00087401
000875*  THE AGREEMENT HAS BEEN IN EFFECT.  THE 'ACTIVITY' FIELDS ON   *00087501
000876*  THESE RECORDS MAY BE THE SAME, IF THE AGREEMENT HAS BEEN IN   *00087601
000877*  FOR THE ENTIRE REPORTING PERIOD.  IF THE AGREEMENT WAS ADDED  *00087701
000878*  SOME TIME DURING THE REPORTING PERIOD, THEN THE RECEIPT       *00087801
000879*  ACTIVITY MUST BE TAKEN FROM THE 'NON-AGREEMENT' RECORD, AND   *00087901
000880*  THE PROGRAM ACTIVITY FIELDS MUST BE TAKEN FROM THE 'AGREEMENT'*00088001
000881*  RECORD AND ONE NEW RECORD MUST BE PRODUCED MERGING THESE DATA *00088101
000882*  ELEMENTS.                                                     *00088201
000883*                                                                *00088301
000884*  IF AN AGREEMENT HAD ITS POSTING FREQUENCY CHANGED SOME TIME   *00088401
000885*  DURING THE REPORTING PERIOD, YET ANOTHER RECORD FOR THE       *00088501
000886*  VENDOR/DEPT WILL BE ON THE FILE, AND THE 'AGREEMENT' ACTIVITY *00088601
000887*  FIELDS BETWEEN THE MULTIPLE RECORDS MUST BE MERGED, ENSURING  *00088701
000888*  THAT THE FIELDS SHOWING THE TERMS OF THE AGREEMENT CARRIED TO *00088801
000889*  THE NEW RECORD ARE THOSE FOR THE AGREEMENT IN EFFECT AT THE   *00088901
000890*  LATEST POINT IN THE REPORTING PERIOD.                         *00089001
000891*----------------------------------------------------------------*00089101
000892* INPUT:                                                         *00089201
000900*  1. VENDOR ACTIVITY EXTRACT FILE            APRD081            *00090001
001020*                                                                *00102001
001030* OUTPUT:                                                        *00103001
001040*                                                                *00104001
001060*  1. MERGED ACTIVITY FILE                    APRD081            *00106007
001070*                                                                *00107001
001080*----------------------------------------------------------------*00108001
001090* CHANGE LOG:                                                    *00109001
001100*                                                                *00110001
001200* DATE  10/25/2004                                               *00120007
001300*   CHANGE MADE: INITIAL VERSION.                                *00130001
001400*   MADE BY: NANCY EILBES            WR/IR #: WR26677            *00140007
001410*                                                                *00141001
001420* DATE  10/29/2004                                               *00142009
001430*   CHANGE MADE: MODIFIED HANDLING OF MERGE SO THAT FIELDS ARE   *00143009
001431*   NOT CHANGED WHEN THE FISCAL MONTH NUMBER IS THE SAME.        *00143109
001440*   MADE BY: NANCY EILBES            WR/IR #: WR26677            *00144009
001450*                                                                *00145009
001473*                                                                *00147301
001474******************************************************************00147401
001475 ENVIRONMENT DIVISION.                                            00147501
001476 CONFIGURATION SECTION.                                           00147601
001477 SOURCE-COMPUTER.        IBM-3090.                                00147701
001478 OBJECT-COMPUTER.        IBM-3090.                                00147801
001479                                                                  00147901
001480 INPUT-OUTPUT SECTION.                                            00148001
001490 FILE-CONTROL.                                                    00149001
001500                                                                  00150001
001600     SELECT ACTIVITY-EXTRACT-FILE        ASSIGN TO INP01.         00160001
001700     SELECT MERGED-OUTPUT-FILE           ASSIGN TO OUT01.         00170001
001900                                                                  00190001
002000 DATA DIVISION.                                                   00200001
002100 FILE SECTION.                                                    00210001
002200                                                                  00220001
002300 FD  ACTIVITY-EXTRACT-FILE                                        00230001
002400     RECORDING MODE IS F                                          00240001
002500     LABEL RECORDS ARE STANDARD                                   00250001
002510     BLOCK CONTAINS 0 RECORDS.                                    00251001
002520 01  ACTIVITY-EXTRACT-RECORD         PIC  X(250).                 00252001
002530                                                                  00253001
002540 FD  MERGED-OUTPUT-FILE                                           00254001
002550     RECORDING MODE IS F                                          00255001
002560     LABEL RECORDS ARE STANDARD                                   00256001
002570     BLOCK CONTAINS 0 RECORDS                                     00257001
002580     DATA RECORD IS MERGED-OUT-REC.                               00258001
002590 01  MERGED-OUT-REC                  PIC  X(250).                 00259001
002600                                                                  00260001
003400 WORKING-STORAGE SECTION.                                         00340001
003500                                                                  00350001
003600 01  PC-PROGRAM-CONSTANTS.                                        00360001
003700     05  PC-PROGRAM-NAME     PIC X(8)  VALUE 'APKUT199'.          00370001
003800                                                                  00380001
003900 01  PS-PROGRAM-SWITCHES.                                         00390001
004000     05  PS-END-OF-EXTRACT-SW        PIC X     VALUE 'N'.         00400001
004100         88  PS-END-OF-EXTRACT                 VALUE 'Y'.         00410001
004200                                                                  00420001
005550 01  PV-PROGRAM-VARIABLES.                                        00555001
007800     05  PV-INPUT-EXTRACT-CNT        PIC 9(9)       VALUE ZERO.   00780001
007900     05  OUTPUT-COUNT                PIC 9(9)       VALUE ZERO.   00790001
008000                                                                  00800001
009400                                                                  00940001
009500*---------------------------------------------------------------* 00950001
009600*  RECORD LAYOUT FOR RECEIVER                                     00960001
009700*---------------------------------------------------------------* 00970001
009800     COPY APRD081.                                                00980001
009900                                                                  00990001
010000                                                                  01000001
010100*---------------------------------------------------------------* 01010001
010200*  RECORD LAYOUT FOR MERGED OUTPUT FILE                           01020001
010300*---------------------------------------------------------------* 01030001
010400     COPY APRD081 REPLACING 'AP081-' BY 'MERGE-'.                 01040001
010500                                                                  01050001
024108 PROCEDURE DIVISION.                                              02410801
024109                                                                  02410901
024110 A100-PROGRAM-MAINLINE.                                           02411001
024120                                                                  02412001
024130     PERFORM B100-INITIALIZE.                                     02413001
024140                                                                  02414001
024150     PERFORM B200-MERGE-RECORDS                                   02415001
024160         UNTIL PS-END-OF-EXTRACT.                                 02416001
024170                                                                  02417001
024180     PERFORM B300-EOJ-ROUTINE.                                    02418001
024190                                                                  02419001
024200     GOBACK.                                                      02420001
024300                                                                  02430001
024400                                                                  02440001
024500******************************************************************02450001
024600*  INITIALIZATIONS                                               *02460001
024700******************************************************************02470001
024800 B100-INITIALIZE.                                                 02480001
024900                                                                  02490001
025000     OPEN INPUT  ACTIVITY-EXTRACT-FILE                            02500001
025100          OUTPUT MERGED-OUTPUT-FILE.                              02510001
025300                                                                  02530001
027300                                                                  02730001
027400     PERFORM R100-READ-EXTRACT-FILE.                              02740001
027500     MOVE AP081-VNDAGR-EXTRACT TO MERGE-VNDAGR-EXTRACT.           02750001
027510     PERFORM R100-READ-EXTRACT-FILE.                              02751001
027600                                                                  02760001
027700******************************************************************02770001
027800*  CREATE REPORT DETAIL LINES FROM INPUT FILE.  FILE CAN CONTAIN  02780001
027900*  2 RECORDS FOR THE SAME VENDOR/DEPT; ONE WITH THE AGREEMENT INFO02790001
028000*  AND THE SECOND WITHOUT.  IN THIS CASE, ONLY THE FIRST RECORD   02800001
028100*  IS PROCESSED.  IF A SECOND RECORD IS FOUND FOR A VENDOR/DEPT,  02810001
028200*  IT IS BYPASSED (ANOTHER READ IS DONE WITHOUT CREATING A LINE). 02820001
028300******************************************************************02830001
028400 B200-MERGE-RECORDS.                                              02840001
028410                                                                  02841001
028420     IF  AP081-VENDOR-NBR = MERGE-VENDOR-NBR                      02842005
028490         IF  AP081-DEPT-NBR = MERGE-DEPT-NBR                      02849001
028500             PERFORM C100-MERGE-ACTIVITY-FIELDS                   02850001
028510         ELSE                                                     02851001
028520             PERFORM W100-WRITE-MERGED-RECORD                     02852001
028521             MOVE AP081-VNDAGR-EXTRACT TO MERGE-VNDAGR-EXTRACT    02852101
028600     ELSE                                                         02860001
028610         PERFORM W100-WRITE-MERGED-RECORD                         02861001
028620         MOVE AP081-VNDAGR-EXTRACT TO MERGE-VNDAGR-EXTRACT        02862001
029300     END-IF.                                                      02930001
029400                                                                  02940001
029500     PERFORM R100-READ-EXTRACT-FILE.                              02950001
029600                                                                  02960001
029700                                                                  02970001
029800******************************************************************02980001
029900*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *02990001
030000******************************************************************03000001
030100 B300-EOJ-ROUTINE.                                                03010001
030200                                                                  03020001
030300     PERFORM W100-WRITE-MERGED-RECORD.                            03030003
030400                                                                  03040003
030700     CLOSE ACTIVITY-EXTRACT-FILE                                  03070001
030800           MERGED-OUTPUT-FILE                                     03080001
031000                                                                  03100001
031100     DISPLAY 'RECORDS READ            = ' PV-INPUT-EXTRACT-CNT.   03110001
031200     DISPLAY 'RECORDS TO OUTPUT FILE  = ' OUTPUT-COUNT.           03120001
031300                                                                  03130001
031400******************************************************************03140001
031500*  DETERMINE WHICH FIELDS NEED TO BE UPDATED ON THE OUTPUT RECORD 03150002
031600******************************************************************03160001
031700 C100-MERGE-ACTIVITY-FIELDS.                                      03170001
031710                                                                  03171002
031800     IF  AP081-NO-AGREEMENT                                       03180001
031810         MOVE AP081-GROSS-PURCHS-AMT    TO MERGE-GROSS-PURCHS-AMT 03181001
031820         MOVE AP081-RETURNS-AMT         TO MERGE-RETURNS-AMT      03182001
031830         MOVE AP081-DISCOUNT-AMT        TO MERGE-DISCOUNT-AMT     03183001
031840         MOVE AP081-OTHER-ACTVTY-AMT    TO MERGE-OTHER-ACTVTY-AMT 03184001
031850         MOVE AP081-PRCH-NET-RTV-AMT    TO MERGE-PRCH-NET-RTV-AMT 03185001
031860         MOVE AP081-PRCH-NET-DSC-AMT    TO MERGE-PRCH-NET-DSC-AMT 03186001
031870         MOVE AP081-PRCH-NET-ALL-AMT    TO MERGE-PRCH-NET-ALL-AMT 03187001
031881     ELSE                                                         03188101
031882         IF  AP081-FSCL-MN-NBR = MERGE-FSCL-MN-NBR                03188208
031883             CONTINUE                                             03188308
031884         ELSE                                                     03188408
031885             MOVE AP081-AGR-DISC-PCT     TO MERGE-AGR-DISC-PCT    03188501
031886             MOVE AP081-AGR-RTV-IND      TO MERGE-AGR-RTV-IND     03188601
031887             MOVE AP081-AGR-DSC-IND      TO MERGE-AGR-DSC-IND     03188701
031888             MOVE AP081-AGR-PSTG-FRQ-CDE TO MERGE-AGR-PSTG-FRQ-CDE03188801
031889                                                                  03188902
031890             ADD AP081-EST-EARNED-AMT   TO MERGE-EST-EARNED-AMT   03189002
031891             ADD AP081-EARNED-ALLW-AMT  TO MERGE-EARNED-ALLW-AMT  03189102
031892             ADD AP081-RVRS-EARNED-AMT  TO MERGE-RVRS-EARNED-AMT  03189202
031893             ADD AP081-VND-DED-AMT      TO MERGE-VND-DED-AMT      03189302
031894             ADD AP081-VND-REPAY-AMT    TO MERGE-VND-REPAY-AMT    03189402
031895             ADD AP081-DEPT-EXP-CR-AMT  TO MERGE-DEPT-EXP-CR-AMT  03189502
031896         END-IF                                                   03189608
031897     END-IF.                                                      03189708
031898                                                                  03189808
032600                                                                  03260001
034800                                                                  03480001
034900*----------------------------------------------------------------*03490001
039996*   READ  INPUT EXTRACT FILE                                     *03999601
039997*----------------------------------------------------------------*03999701
039998 R100-READ-EXTRACT-FILE.                                          03999801
039999                                                                  03999901
040000     INITIALIZE AP081-VNDAGR-EXTRACT.                             04000001
040001                                                                  04000101
040002     READ ACTIVITY-EXTRACT-FILE INTO AP081-VNDAGR-EXTRACT         04000201
040003       AT END SET PS-END-OF-EXTRACT TO TRUE.                      04000301
040004                                                                  04000401
040005     IF PS-END-OF-EXTRACT                                         04000501
040006         CONTINUE                                                 04000601
040007     ELSE                                                         04000701
040008         ADD +1 TO PV-INPUT-EXTRACT-CNT                           04000801
040009     END-IF.                                                      04000901
040010                                                                  04001001
040011                                                                  04001101
043700*----------------------------------------------------------------*04370001
043800*    WRITE RECORDS TO MERGED FILE.                               *04380001
043900*----------------------------------------------------------------*04390001
044000 W100-WRITE-MERGED-RECORD.                                        04400005
044100                                                                  04410001
044200     WRITE MERGED-OUT-REC FROM MERGE-VNDAGR-EXTRACT.              04420006
044300     ADD 1 TO OUTPUT-COUNT.                                       04430001
