000100***************************************************************** 00010052
000200 IDENTIFICATION DIVISION.                                         00020052
000300***************************************************************** 00030052
000400 PROGRAM-ID.    XLKUT300.                                         00040052
000500 AUTHOR.        RANJITH KESAVAN.                                  00050052
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060052
000700 DATE-WRITTEN   JANUARY 2020.                                     00070052
000800 DATE-COMPILED.                                                   00080052
000900***************************************************************** 00090052
001000*  THIS BATCH PROGRAM ABENDS THE PROCESS IF THE PO HAS RECEIVER   00100052
001100*  WHILE PROCESSING THE ORD_SKU_DELETE MESSAGE                    00110052
001200***************************************************************** 00120052
001300 ENVIRONMENT DIVISION.                                            00130052
001400 INPUT-OUTPUT SECTION.                                            00140052
001500                                                                  00150052
001600 FILE-CONTROL.                                                    00160052
001700                                                                  00170052
001800     SELECT RMS-PO-FILE                                           00180052
001900         ASSIGN TO INP01.                                         00190052
002000                                                                  00200052
002300                                                                  00210052
002400***************************************************************** 00220052
002500 DATA DIVISION.                                                   00230052
002600***************************************************************** 00240052
002700 FILE SECTION.                                                    00250052
002800                                                                  00260052
002900 FD  RMS-PO-FILE                                                  00270052
003000     RECORDING MODE IS F                                          00280052
003100     BLOCK CONTAINS 0 RECORDS                                     00290052
003200     LABEL RECORDS ARE OMITTED.                                   00300052
003300                                                                  00310052
003400 01  EXTRACT-REC                      PIC X(0528).                00320052
003500                                                                  00330052
004200                                                                  00340052
004300***************************************************************** 00350052
004400 WORKING-STORAGE SECTION.                                         00360052
004500                                                                  00370052
004800 01  PS-PROGRAM-SWITCHES.                                         00380052
004900     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00390052
005000         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00400052
005100         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00410052
005200                                                                  00420052
005201 01  PS-PROGRAM-SWITCHES-ERROR.                                   00430052
005202     05  PS-RC-SW                     PIC X(01)  VALUE 'N'.       00440052
005203         88  PS-4008-YES                         VALUE 'Y'.       00450052
005204         88  PS-4008-NO                          VALUE 'N'.       00460052
005205                                                                  00470052
005300 01  PC-PROGRAM-CONSTANTS.                                        00480052
005400     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUT300'.00490052
005500                                                                  00500052
005600 01  PV-PROGRAM-VARIABLES.                                        00510052
005700     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00520052
005701     05  PV-ORD-SKU-DEL-RD            PIC  9(09) VALUE  0.        00530052
005702     05  PV-RECORDS-READ-Y            PIC  9(09) VALUE  0.        00540052
005703     05  PV-RECORDS-READ-N            PIC  9(09) VALUE  0.        00550052
019300     05  PV-PACKSLIP-CHECK-Y          PIC  9(09) VALUE  0.        00560052
019301     05  PV-PACKSLIP-CHECK-N          PIC  9(09) VALUE  0.        00570052
019302     05  PV-RECEIVER-ITEM-Y           PIC  9(09) VALUE  0.        00571062
019303     05  PV-RECEIVER-ITEM-N           PIC  9(09) VALUE  0.        00572062
019304     05  PV-TOT-CANNOT-PROCESS        PIC  9(09) VALUE  0.        00573063
019305     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00580052
019306     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00590052
019307     05  PV-PO-NBR                    PIC S9(9) COMP.             00600052
019308     05  PV-IND                       PIC  X(01).                 00610052
019309     05  PV-SKU-NBR                   PIC  X(08).                 00620052
019310     05  PV-PK-CDE                    PIC  X(03).                 00630052
019311     05  DCL-PO-NBR                   PIC  X(08).                 00640052
019312     05  DCL-PKGNG-CDE                PIC  X(01).                 00650052
019313                                                                  00660052
019314                                                                  00670052
019315                                                                  00680052
019316 01  PV-ABEND-FIELDS.                                             00690052
019317     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00700052
019318                                                 COMP SYNC.       00710052
019319     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 00720052
019320*                                                                 00730052
019321 01  PC-CONSTANTS.                                                00740052
019322     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUT300'.00750052
019323     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00760052
019324     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00770052
019325     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00780052
019326     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00790052
019327     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00800052
019328     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00810052
019329                                                                  00820052
019330                                                                  00830052
019331***********************************************************       00840052
019332*  COPYBOOK USED FOR THE  INPUT FILE              *               00850052
019333***********************************************************       00860052
019334     COPY XLRD011.                                                00870052
019335                                                                  00880052
019336***********************************************************       00890052
019337*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00900052
019338***********************************************************       00910052
019339     COPY DPWS004.                                                00920052
019340                                                                  00930052
019341***********************************************************       00940052
019342*  DB2 SQL COMMUNICATION AREA                             *       00950052
019343***********************************************************       00960052
019344     EXEC SQL                                                     00970052
019345          INCLUDE SQLCA                                           00980052
019346     END-EXEC.                                                    00990052
019347                                                                  01000052
019348                                                                  01010052
019349***********************************************************       01020052
019350*  TPURCHS TABLE                                       *          01030052
019351***********************************************************       01040052
019352     EXEC SQL                                                     01050052
019353          INCLUDE TPURCHS                                         01060052
019354     END-EXEC.                                                    01070052
019355                                                                  01080052
019356***********************************************************       01090052
019357*  TPURITM TABLE                                       *          01100052
019358***********************************************************       01110052
019359     EXEC SQL                                                     01120052
019360          INCLUDE TPURITM                                         01130052
019361     END-EXEC.                                                    01140052
019362                                                                  01150052
019363***********************************************************       01160052
019364*  TRECEIV TABLE                                       *          01170052
019365***********************************************************       01180052
019366     EXEC SQL                                                     01190052
019367          INCLUDE TRECEIV                                         01200052
019368     END-EXEC.                                                    01210052
019369                                                                  01220052
019370***************************************************************** 01230052
019371***********************************************************       01240052
019372*  TRECITM TABLE                                       *          01250052
019373***********************************************************       01260052
019374     EXEC SQL                                                     01270052
019375          INCLUDE TRECITM                                         01280052
019376     END-EXEC.                                                    01290052
019377***********************************************************       01300052
019371***********************************************************       01301069
019372*  TPOPRPK TABLE                                       *          01302069
019373***********************************************************       01303069
019374     EXEC SQL                                                     01304069
019375          INCLUDE TPOPRPK                                         01305069
019376     END-EXEC.                                                    01306069
019377***********************************************************       01307069
019371***********************************************************       01308069
019372*  TPKSLIP TABLE                                       *          01309069
019373***********************************************************       01309169
019374     EXEC SQL                                                     01309269
019375          INCLUDE TPKSLIP                                         01309369
019376     END-EXEC.                                                    01309469
019377***********************************************************       01309569
019371***********************************************************       01309669
019372*  TPKITEM TABLE                                       *          01309769
019373***********************************************************       01309869
019374     EXEC SQL                                                     01309969
019375          INCLUDE TPKITEM                                         01310069
019376     END-EXEC.                                                    01310169
019377***********************************************************       01310269
019378                                                                  01311069
019379                                                                  01320052
019380***************************************************************** 01330052
019381 PROCEDURE DIVISION.                                              01340052
019382***************************************************************** 01350052
019383     DISPLAY '**** BEGINNING XLKUT300 ****'.                      01360052
019384     DISPLAY ' '.                                                 01370052
019385                                                                  01380052
019386     OPEN INPUT  RMS-PO-FILE.                                     01390052
019387                                                                  01400052
019388     PERFORM 1000-READ-INPUT-FILE.                                01410052
019389                                                                  01420052
019390     PERFORM 2000-PROCESS-INPUT-FILE                              01430052
019391       UNTIL PS-EOF-INPUT-YES.                                    01440052
019392                                                                  01450052
019393     CLOSE RMS-PO-FILE.                                           01460052
019394                                                                  01461057
019395     COMPUTE PV-TOT-CANNOT-PROCESS = PV-RECEIVER-ITEM-Y +         01462063
019396              PV-RECEIVER-ITEM-N + PV-PACKSLIP-CHECK-Y +          01462163
019397              PV-PACKSLIP-CHECK-N                                 01462263
019398                                                                  01463063
019399     DISPLAY '**************************************************' 01470066
019400-            '****************************************'           01480066
019500     DISPLAY 'TOTAL NUMBER OF RECORDS READ                      ' 01490057
019501-            '           : ' PV-RECORDS-READ                      01491060
019502     DISPLAY 'TOTAL NUMBER OF ORD-SKU-DEL MESSAGES READ         ' 01500057
019503-            '           : ' PV-ORD-SKU-DEL-RD                    01500160
019504     DISPLAY ' '                                                  01500259
019505     DISPLAY 'NUMBER OF ORD_SKU_DELETE PACK LEVEL RECORDS READ  ' 01510058
019506-            '           : ' PV-RECORDS-READ-Y                    01510160
019507     DISPLAY 'NUMBER OF ORD_SKU_DELETE NON PACK LEVEL RECORDS RE' 01520058
019508-            'AD         : ' PV-RECORDS-READ-N                    01520160
019509     DISPLAY ' '                                                  01520259
019510     DISPLAY 'NUMBER OF ORD_SKU_DELETE PACK LEVEL RECEIVER ITEM ' 01530053
019511-            'FOUND      : ' PV-RECEIVER-ITEM-Y                   01530162
019512     DISPLAY 'NUMBER OF ORD_SKU_DELETE NON PACK LEVEL RECEIVER I' 01540058
019513-            'TEM FOUND  : ' PV-RECEIVER-ITEM-N                   01540162
019514     DISPLAY ' '                                                  01540262
019515     DISPLAY 'NUMBER OF ORD_SKU_DELETE PACK LEVEL PACKSLIP ITEM ' 01540362
019516-            'FOUND      : ' PV-PACKSLIP-CHECK-Y                  01540462
019517     DISPLAY 'NUMBER OF ORD_SKU_DELETE NON PACK LEVEL PACKSLIP I' 01540562
019518-            'TEM FOUND  : ' PV-PACKSLIP-CHECK-N                  01540662
019519     DISPLAY ' '                                                  01540765
019520     DISPLAY 'NUMBER OF ORD_SKU_DELETE MESSAGES THAT CANNOT BE P' 01540867
019521-            'ROCESSED   : ' PV-TOT-CANNOT-PROCESS                01540967
019522     DISPLAY '**************************************************' 01550066
019523-            '****************************************'           01560066
019524                                                                  01570052
019600     IF PS-RC-SW = 'Y'                                            01580052
019700        MOVE 4008 TO RETURN-CODE                                  01590052
019800     END-IF                                                       01600052
019801                                                                  01610052
019802     STOP RUN.                                                    01620052
019803                                                                  01630052
019804                                                                  01640052
019805***************************************************************** 01650052
019806*  READ A INPUT FILE                                            * 01660052
019807***************************************************************** 01670052
019808 1000-READ-INPUT-FILE.                                            01680052
019809                                                                  01690052
019810     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01700052
019811                                                                  01710052
019812                                                                  01720052
019813     READ RMS-PO-FILE                                             01730052
019814          INTO XL011-DATA                                         01740052
019815            AT END                                                01750052
019816               SET PS-EOF-INPUT-YES TO TRUE                       01760052
019817                                                                  01770052
019818            NOT AT END                                            01780052
019819               SET PS-EOF-INPUT-NO  TO TRUE                       01790052
019820               ADD +1 TO PV-RECORDS-READ                          01800052
019821     END-READ.                                                    01810052
019822                                                                  01820052
019823                                                                  01830052
019824***************************************************************** 01840052
019825*  2000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM. * 01850054
019826***************************************************************** 01860052
019827 2000-PROCESS-INPUT-FILE.                                         01870052
019828                                                                  01880052
019829     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01890052
019830                                                                  01900052
019831     IF  XL011-MSG-ID = 'ORD_SKU_DELETE'                          01910052
019832               ADD +1 TO PV-ORD-SKU-DEL-RD                        01920052
019833         MOVE XL011-ORDER-NBR       TO PV-PO-NBR                  01930052
019834         MOVE XL011-SD-COMP-SKU-NBR TO PV-SKU-NBR                 01940052
019835         MOVE XL011-SD-PK-SKU-IND   TO PV-IND                     01950052
019836     END-IF                                                       01960052
019837*                                                                 01970052
019838     IF  PV-IND = 'Y' AND XL011-MSG-ID = 'ORD_SKU_DELETE'         01980052
019839         PERFORM 2100-PK-SKU-IND-Y                                01990052
019840     END-IF                                                       02000052
019850*                                                                 02010052
019860     IF  PV-IND = 'N' AND XL011-MSG-ID = 'ORD_SKU_DELETE'         02020052
019861         PERFORM 2200-PK-SKU-IND-N                                02030052
019862     END-IF                                                       02040052
019863                                                                  02050052
019864     PERFORM 1000-READ-INPUT-FILE.                                02060052
019865*                                                                 02070052
019866 2100-PK-SKU-IND-Y.                                               02080052
019867               ADD +1 TO PV-RECORDS-READ-Y                        02090052
019868         MOVE '2100-PK-SKU-IND-Y'  TO PV-ABEND-PARAGRAPH.         02100052
019869                                                                  02110052
019870     EXEC SQL                                                     02120052
019880          SELECT A.PO_NBR                                         02130052
019890                  , A.PKGNG_CDE                                   02140052
019900          INTO :DCL-PO-NBR ,                                      02150052
020000               :DCL-PKGNG-CDE                                     02160052
020100                         FROM TPURCHS A                           02170053
020200                            , TPOPRPK B                           02180053
020300                            , TPURITM C                           02190053
020400                            , TRECEIV D                           02200053
020500                            , TRECITM E                           02210053
020600          WHERE A.PO_NBR = :PV-PO-NBR                             02220052
020700            AND A.VER_STATUS_CDE = 'A'                            02230052
020800            AND B.PO_NBR = A.PO_NBR                               02240052
020900            AND B.PK_SKU_NBR = :PV-SKU-NBR                        02250052
021000            AND C.PO_NBR = A.PO_NBR                               02260052
021100            AND C.PO_PREPK_ID = B.PO_PREPK_ID                     02270052
021200            AND D.ORD_NBR = :PV-PO-NBR                            02280052
021300              AND NOT D.STATUS_CDE = 'DE'                         02290052
021400              AND E.ORD_NBR = D.ORD_NBR                           02300052
021500              AND E.REC_SEQ_NBR = D.REC_SEQ_NBR                   02310052
021600              AND E.ORD_LNE_NBR = C.APP_PO_LNE_NBR                02320052
021601            FETCH FIRST 1 ROW ONLY                                02330052
021602     END-EXEC                                                     02340052
021603                                                                  02350052
021604     EVALUATE TRUE                                                02360052
021605         WHEN SQLCODE = ZEROS                                     02370052
021606                                                                  02380052
021607              PERFORM 3000-EXPAND-PK-CDE                          02390052
022300              DISPLAY "PACK LEVEL RECEIVER ITEM FOUND ORD_SKU_D"  02400068
022301-             "EL CANNOT BE PROCESSED   "                         02410068
022302              DISPLAY 'PO NUMBER       :' DCL-PO-NBR              02420052
022303              DISPLAY 'SKU NUMBER      :' PV-SKU-NBR              02430052
022304              DISPLAY 'PKGNG_CDE       :' PV-PK-CDE               02440052
025210               ADD +1 TO PV-RECEIVER-ITEM-Y                       02441062
025211              SET PS-4008-YES           TO TRUE                   02450052
025212         WHEN SQLCODE = +100                                      02470052
025213              PERFORM 2110-PACKSLIP-CHECK-Y                       02480052
025214         WHEN OTHER                                               02490052
025216             MOVE '2100-PK-SKU-IND-Y'                             02510052
025217                                   TO PV-ABEND-PARAGRAPH          02520052
022302              DISPLAY 'PO NUMBER          :' DCL-PO-NBR           02522068
022302              DISPLAY 'INPUT RECORDS READ :' PV-RECORDS-READ      02523068
025218           PERFORM Z999-SQL-ABEND                                 02530052
025219     END-EVALUATE.                                                02540052
025220                                                                  02550052
025221                                                                  02560052
025222  2200-PK-SKU-IND-N.                                              02570052
025223               ADD +1 TO PV-RECORDS-READ-N                        02580052
025224         MOVE '2200-PK-SKU-IND-N'  TO PV-ABEND-PARAGRAPH.         02590052
025225     EXEC SQL                                                     02600052
025226            SELECT A.PO_NBR                                       02610052
025227                    , A.PKGNG_CDE                                 02620052
025228           INTO :DCL-PO-NBR ,                                     02630052
025229                :DCL-PKGNG-CDE                                    02640052
025230                 FROM  TPURCHS A                                  02650053
025231                      ,TPURITM B                                  02660053
025232                      ,TRECEIV C                                  02670053
025233                      ,TRECITM D                                  02680053
025234                 WHERE A.PO_NBR = :PV-PO-NBR                      02690052
025235                   AND A.VER_STATUS_CDE = 'A'                     02700052
025236                   AND B.PO_NBR = A.PO_NBR                        02710052
025237                   AND B.RMS_PO_SKU_NBR = :PV-SKU-NBR             02720052
025238                   AND C.ORD_NBR = A.PO_NBR                       02730052
025239                   AND NOT C.STATUS_CDE = 'DE'                    02740052
025240                   AND D.ORD_NBR = C.ORD_NBR                      02750052
025241                     AND D.REC_SEQ_NBR = C.REC_SEQ_NBR            02760052
025242                     AND D.ORD_LNE_NBR = B.APP_PO_LNE_NBR         02770052
025243                   FETCH FIRST 1 ROW ONLY                         02780052
025244     END-EXEC                                                     02790052
025245                                                                  02800052
025246     EVALUATE TRUE                                                02810052
025247         WHEN SQLCODE = ZEROS                                     02820052
025248              PERFORM 3000-EXPAND-PK-CDE                          02830052
022300              DISPLAY "NON PACK LEVEL RECEIVER ITEM FOUND ORD_S"  02831068
022301-             "KU_DEL CANNOT BE PROCESSED   "                     02832068
025251              DISPLAY 'PO NUMBER       :' DCL-PO-NBR              02860052
025252              DISPLAY 'SKU NUMBER      :' PV-SKU-NBR              02870052
025253              DISPLAY 'PKGNG_CDE       :' PV-PK-CDE               02880052
025254               ADD +1 TO PV-RECEIVER-ITEM-N                       02881062
025255              SET PS-4008-YES           TO TRUE                   02890052
025256         WHEN SQLCODE = +100                                      02920052
025257             PERFORM 2210-PACKSLIP-CHECK-N                        02930052
025258         WHEN OTHER                                               02940052
025260             MOVE '2200-PK-SKU-IND-N'                             02960068
025261                                   TO PV-ABEND-PARAGRAPH          02970052
022302              DISPLAY 'PO NUMBER          :' DCL-PO-NBR           02971068
022302              DISPLAY 'INPUT RECORDS READ :' PV-RECORDS-READ      02972068
025262           PERFORM Z999-SQL-ABEND                                 02980052
025263     END-EVALUATE.                                                02990052
025264                                                                  03000052
025265 2110-PACKSLIP-CHECK-Y.                                           03010052
025266         MOVE '2110-PACKSLIP-CHECK-Y' TO PV-ABEND-PARAGRAPH.      03020052
025267                                                                  03050052
025268     EXEC SQL                                                     03060052
025269         SELECT A.PO_NBR                                          03070052
025270              , A.PKGNG_CDE                                       03080052
025271          INTO :DCL-PO-NBR ,                                      03090052
025272               :DCL-PKGNG-CDE                                     03100052
025273              FROM  TPURCHS A                                     03110053
025274                   ,TPOPRPK B                                     03120053
025275                   ,TPURITM C                                     03130053
025276                   ,TPKSLIP D                                     03140053
025277                   ,TPKITEM E                                     03150053
025278             WHERE A.PO_NBR = :PV-PO-NBR                          03160052
025279               AND A.VER_STATUS_CDE = 'A'                         03170052
025280               AND B.PO_NBR = :PV-PO-NBR                          03180052
025281               AND B.PK_SKU_NBR = :PV-SKU-NBR                     03190052
025282               AND C.PO_NBR = A.PO_NBR                            03200052
025283               AND C.PO_PREPK_ID = B.PO_PREPK_ID                  03210052
025284               AND D.PO_NBR = A.PO_NBR                            03220052
025285               AND D.VER_STAT_CDE = 'A'                           03230052
025286               AND E.PO_NBR = D.PO_NBR                            03240052
025287               AND E.SEQ_NBR = D.SEQ_NBR                          03250052
025288               AND E.PKSL_LNE_NBR = C.APP_PO_LNE_NBR              03260052
025289             FETCH FIRST 1 ROW ONLY                               03270052
025290     END-EXEC                                                     03280052
025291                                                                  03290052
025292     EVALUATE TRUE                                                03300052
025293         WHEN SQLCODE = ZEROS                                     03310052
025294              PERFORM 3000-EXPAND-PK-CDE                          03320052
025295              DISPLAY "PACK LEVEL PACKSLIP ITEM FOUND ORD_S"      03330068
025296-             "KU_DELETE CANNOT BE PROCESSED"                     03340068
025297              DISPLAY 'PO NUMBER       :' DCL-PO-NBR              03350052
025298              DISPLAY 'SKU NUMBER      :' PV-SKU-NBR              03360052
025299              DISPLAY 'PKGNG_CDE       :' PV-PK-CDE               03370052
025300               ADD +1 TO PV-PACKSLIP-CHECK-Y                      03380052
025301              SET PS-4008-YES           TO TRUE                   03390052
025302         WHEN SQLCODE = +100                                      03420052
025303              CONTINUE                                            03430054
025304         WHEN OTHER                                               03440052
025306             MOVE '2110-PACKSLIP-CHECK-Y'                         03460052
025307                                   TO PV-ABEND-PARAGRAPH          03470052
022302              DISPLAY 'PO NUMBER          :' DCL-PO-NBR           03471068
022302              DISPLAY 'INPUT RECORDS READ :' PV-RECORDS-READ      03472068
025308           PERFORM Z999-SQL-ABEND                                 03480052
025309     END-EVALUATE.                                                03490052
025310                                                                  03500052
025311 2210-PACKSLIP-CHECK-N.                                           03510052
025312         MOVE '2210-PACKSLIP-CHECK-N' TO PV-ABEND-PARAGRAPH.      03520052
025313     EXEC SQL                                                     03550052
025314        SELECT A.PO_NBR                                           03560052
025315             , A.PKGNG_CDE                                        03570052
025316          INTO :DCL-PO-NBR ,                                      03580052
025317               :DCL-PKGNG-CDE                                     03590052
025318         FROM  TPURCHS A                                          03600053
025319              ,TPURITM B                                          03610053
025320              ,TPKSLIP C                                          03620053
025321              ,TPKITEM D                                          03630053
025322         WHERE A.PO_NBR = :PV-PO-NBR                              03640052
025323           AND A.VER_STATUS_CDE = 'A'                             03650052
025400           AND B.PO_NBR = A.PO_NBR                                03660052
025500           AND B.RMS_PO_SKU_NBR = :PV-SKU-NBR                     03670052
025600           AND C.PO_NBR = A.PO_NBR                                03680052
025700             AND C.VER_STAT_CDE = 'A'                             03690052
025800             AND D.PO_NBR = C.PO_NBR                              03700052
025900             AND D.SEQ_NBR = C.SEQ_NBR                            03710052
026000             AND D.PKSL_LNE_NBR = B.APP_PO_LNE_NBR                03720052
026001           FETCH FIRST 1 ROW ONLY                                 03730052
026002     END-EXEC                                                     03740052
026003                                                                  03750052
026004     EVALUATE TRUE                                                03760052
026005         WHEN SQLCODE = ZEROS                                     03770052
026006              PERFORM 3000-EXPAND-PK-CDE                          03780052
025295              DISPLAY "NON PACK LEVEL PACKSLIP ITEM FOUND ORD_S"  03781068
025296-             "KU_DELETE CANNOT BE PROCESSED"                     03782068
026009              DISPLAY 'PO NUMBER       :' DCL-PO-NBR              03810052
026010              DISPLAY 'SKU NUMBER      :' PV-SKU-NBR              03820052
026011              DISPLAY 'PKGNG_CDE       :' PV-PK-CDE               03830052
026012               ADD +1 TO PV-PACKSLIP-CHECK-N                      03840052
026013              SET PS-4008-YES           TO TRUE                   03850052
026016         WHEN SQLCODE = +100                                      03880052
026017              CONTINUE                                            03890054
026018         WHEN OTHER                                               03900052
026020             MOVE '2210-PACKSLIP-CHECK-N'                         03920052
026021                                   TO PV-ABEND-PARAGRAPH          03930052
022302              DISPLAY 'PO NUMBER          :' DCL-PO-NBR           03931068
022302              DISPLAY 'INPUT RECORDS READ :' PV-RECORDS-READ      03932068
026022           PERFORM Z999-SQL-ABEND                                 03940052
026023     END-EVALUATE.                                                03950052
026024 3000-EXPAND-PK-CDE.                                              03960052
026025     EVALUATE TRUE                                                03970052
026026         WHEN DCL-PKGNG-CDE = 'B'                                 03980052
026027             MOVE 'BLK'     TO PV-PK-CDE                          03990052
026028         WHEN DCL-PKGNG-CDE = 'M'                                 04000052
026029             MOVE 'PPK'     TO PV-PK-CDE                          04010052
026030         WHEN DCL-PKGNG-CDE = ' '                                 04020052
026040             MOVE 'PBS'     TO PV-PK-CDE                          04030052
026050         WHEN DCL-PKGNG-CDE = 'C'                                 04040052
026060             MOVE 'BLK'     TO PV-PK-CDE                          04050052
026070         WHEN DCL-PKGNG-CDE = 'I'                                 04060052
026071             MOVE 'PPK'     TO PV-PK-CDE                          04070052
026072         WHEN OTHER                                               04080052
026073             MOVE 'OTH'     TO PV-PK-CDE                          04090052
026074     END-EVALUATE.                                                04100052
034900 Z999-SQL-ABEND.                                                  04110052
035000                                                                  04120052
035100     MOVE SQLCODE            TO PV-SQLCODE.                       04130052
035200     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  04140052
035300     DISPLAY '*** DB2 ERROR '.                                    04150052
035400     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  04160052
035500     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 04170052
035600     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               04180052
035700     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               04190052
035800     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       04200052
035900     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       04210052
036000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       04220052
036100     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   04230052
036200                                                                  04240052
036300     COPY DPPD004.                                                04250052
036400                                                                  04260052
036600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04270052
