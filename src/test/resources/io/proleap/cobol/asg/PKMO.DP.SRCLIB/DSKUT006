000100 IDENTIFICATION DIVISION.                                         00010021
000200 PROGRAM-ID.     DSKUT006.                                        00020021
000300 AUTHOR.         RICHARD MOORE.                                   00030021
000400*DATE-WRITTEN.   11/12/98.                                        00040021
000500*DATE-COMPILED.                                                   00050021
000600*************************************************************     00060021
000700*    DELETE GROUP 2 DATA                                    *     00070021
000800*************************************************************     00080021
004510*  CHANGES:                                                       00081024
004510*                                                                 00081124
004510*  08/10/2022  J KURK   - RECOMPILE FOR COPYBOOK DSPD002          00081224
004510*  04/10/2022  J KURK   - RECOMPILE FOR UPDATED COPYBOOKS         00081325
000800*************************************************************     00082024
000900                                                                  00090021
001000 ENVIRONMENT DIVISION.                                            00100021
001100                                                                  00110021
001200 INPUT-OUTPUT SECTION.                                            00120021
001300                                                                  00130021
001400 FILE-CONTROL.                                                    00140021
001500                                                                  00150021
001600     SELECT PO-NBR-FILE                                           00160021
001700         ASSIGN         TO UT-S-PO01.                             00170021
001800     SELECT TBLE-FILE                                             00180021
001900         ASSIGN         TO UT-S-TBL01.                            00190021
002000     SELECT CONTROL-FILE                                          00200021
002100         ASSIGN         TO UT-S-CTL01.                            00210021
002200                                                                  00220021
002300 DATA DIVISION.                                                   00230021
002400                                                                  00240021
002500 FILE SECTION.                                                    00250021
002600******************************************************************00260021
002700     COPY DSFD001.                                                00270021
002800******************************************************************00280021
002900                                                                  00290021
003000 WORKING-STORAGE SECTION.                                         00300021
003100 01  PV-OTHER-CRAPOLA.                                            00310021
003200     05  PV-TOTAL-COUNT               PIC S9(7) COMP-3            00320021
003300                                               VALUE ZERO.        00330021
003400     05  PV-WHEN-COMPILED.                                        00340021
003500         10  PV-COMPILE-DATE          PIC X(08).                  00350021
003600         10  PV-COMPILE-TIME          PIC X(08).                  00360021
003700     05  PV-DISP-SQLCODE              PIC -999.                   00370021
003800     05  PV-DISP-NBR                  PIC -Z(08)9.                00380021
003801                                                                  00380122
003810 01  PC-CONSTANTS.                                                00381022
003820     05  PC-90                       PIC S9(04)    COMP           00382022
003830                                                   VALUE 90.      00383022
003840     05  PC-A                        PIC  X(01)    VALUE 'A'.     00384022
003850     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     00385022
003860     05  PC-RCV                      PIC  X(03)    VALUE 'RCV'.   00386022
003870     05  PC-KHL                      PIC  X(03)    VALUE 'KHL'.   00387022
003880     05  PC-PRDCHK                   PIC  X(06)    VALUE 'PRDCHK'.00388022
003890     05  PC-PARM-TEXT                PIC  X(25)    VALUE          00389022
003891         'LOWER LEVEL ONLY         '.                             00389122
003892     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00389222
003893         'DSKUT006'.                                              00389322
003894                                                                  00389422
003895 01  WS-LOCAL-SERVER.                                             00389522
003896     05  WS-SUBSYS                   PIC X(04)  VALUE SPACES.     00389622
003897     05  FILLER                      PIC X(12)  VALUE SPACES.     00389722
003898*                                                                 00389822
003900/                                                                 00390021
004000     COPY DSWS008.                                                00400021
004100     COPY DSWS009.                                                00410021
004200     COPY DSWS010.                                                00420021
004300     COPY DSRD002.                                                00430021
004400     COPY DPWS004.                                                00440021
004500*                                                                 00450021
004600*  DCLGENS FOR PROD TO TEST UTILITIES                             00460021
004700     COPY DSWS011.                                                00470021
004800/                                                                 00480021
004900     EXEC SQL                                                     00490021
005000         DECLARE TLBPTDA-CSR CURSOR WITH HOLD FOR                 00500021
005100             SELECT TRIP_ID                                       00510021
005200             FROM TLBPTDA                                         00520021
005300           WHERE TRIP_ID = :HOLD-TRIP-ID                          00530021
005400             FOR UPDATE OF TRIP_ID                                00540021
005500     END-EXEC.                                                    00550021
005600/                                                                 00560021
005700 PROCEDURE DIVISION.                                              00570021
005800                                                                  00580021
005900 A100-MAINLINE.                                                   00590021
006000                                                                  00600021
006100     MOVE WHEN-COMPILED TO PV-WHEN-COMPILED                       00610021
006200     DISPLAY SPACES                                               00620021
006300     DISPLAY ' *** DSKUT006 VERSION 2 ***'                        00630021
006400     DISPLAY 'COMPILE DATE: ' PV-COMPILE-DATE                     00640021
006500             ' ' PV-COMPILE-TIME                                  00650021
006610                                                                  00661022
006620     PERFORM 1100-GET-DB2-INSTANCE.                               00662022
006630     PERFORM 1200-CHECK-IF-PRODUCTION.                            00663022
006700                                                                  00670021
006800     SET DS009-D-PGM TO TRUE.                                     00680021
006900     PERFORM DS002-INITIAL-PROCESSING.                            00690021
007000     PERFORM B100-PROCESSING                                      00700021
007100         UNTIL TABLE-EOF.                                         00710021
007200                                                                  00720021
007300     DISPLAY '  ****  DELETE TOTALS  ****'                        00730021
007400                                                                  00740021
007500     PERFORM VARYING CNTL-I FROM 1 BY 1 UNTIL                     00750021
007600           CNTL-I > CNTL-SUB-MAX OR CNTL-I > 200                  00760021
007700         IF CNTL-TABLE(CNTL-I) NOT = SPACES                       00770021
007800             IF DS009-GROUP-NBR(CNTL-I) = '2'                     00780021
007900                 MOVE DS009-READ-COUNT (CNTL-I) TO DS009-DISP-NBR 00790021
008000                 ADD DS009-READ-COUNT (CNTL-I)  TO PV-TOTAL-COUNT 00800021
008100                 DISPLAY 'TABLE = ' CNTL-TABLE(CNTL-I)            00810021
008200                            DS009-DISP-NBR                        00820021
008300             END-IF                                               00830021
008400         END-IF                                                   00840021
008500     END-PERFORM                                                  00850021
008600     MOVE PV-TOTAL-COUNT              TO DS009-DISP-NBR           00860021
008700     DISPLAY 'TOTAL DELETES  =          '  DS009-DISP-NBR         00870021
008800                                                                  00880021
008900     PERFORM DS002-END-OF-JOB.                                    00890021
009000                                                                  00900021
009100     GOBACK.                                                      00910021
009200/                                                                 00920021
009300                                                                  00930021
009400 B100-PROCESSING.                                                 00940021
009500*                                                                 00950021
009600***************************************************************** 00960021
009700*     FOR EACH TABLE, DELETE ANY EXISTING DATA AND THEN INSERT    00970021
009800*     THE DATA FROM THE FILE.                                     00980021
009900***************************************************************** 00990021
010000*                                                                 01000021
010100     READ TBLE-FILE                                               01010021
010200         AT END SET TABLE-EOF TO TRUE.                            01020021
010300                                                                  01030021
010400     IF NOT-TABLE-EOF                                             01040021
010500        MOVE TBLE-DATA-SIZE TO DS009-TBLE-DATA-SIZE               01050021
010600        MOVE TBLE-NAME  TO DS009-PROCESS-TABLE                    01060021
010700        MOVE TBLE-KEYS  TO DS009-PKYS                             01070021
010800        PERFORM DS002-DO-PROCESS                                  01080021
010900        IF DS009-DO-PROCESS                                       01090021
011000*       DISPLAY '**********************************'              01100021
011100*       DISPLAY DS009-PROCESS-TABLE                               01110021
011200        EVALUATE TRUE                                             01120021
011300         WHEN DS009-PROCESS-TABLE = 'TSHPTPO'                     01130021
011400             MOVE TBLE-DATA-ITEM TO WS-SHPTPO                     01140021
011500             MOVE WS-SHPTPO-PO-NBR TO HOLD-PO-NBR                 01150021
011600*            DISPLAY HOLD-PO-NBR                                  01160021
011700*            DISPLAY WS-SHPTPO                                    01170021
011800             PERFORM R100-DELETE                                  01180021
011900             PERFORM B101-ADD-TO-DELETE-COUNTS                    01190021
012000         WHEN DS009-PROCESS-TABLE = 'TPKSLIP'                     01200021
012100             MOVE TBLE-DATA-ITEM TO WS-PKSLIP                     01210021
012200             MOVE WS-PKSLIP-PO-NBR TO HOLD-PO-NBR                 01220021
012300*            DISPLAY HOLD-PO-NBR                                  01230021
012400*            DISPLAY WS-PKSLIP                                    01240021
012500             PERFORM R100-DELETE                                  01250021
012600             PERFORM B101-ADD-TO-DELETE-COUNTS                    01260021
012700         WHEN DS009-PROCESS-TABLE = 'TPKITEM'                     01270021
012800             MOVE TBLE-DATA-ITEM TO WS-PKITEM                     01280021
012900             MOVE WS-PKITEM-PO-NBR TO HOLD-PO-NBR                 01290021
013000*            DISPLAY HOLD-PO-NBR                                  01300021
013100*            DISPLAY WS-PKITEM                                    01310021
013200             PERFORM R100-DELETE                                  01320021
013300             PERFORM B101-ADD-TO-DELETE-COUNTS                    01330021
013400         WHEN DS009-PROCESS-TABLE = 'TRECEIV'                     01340021
013500             MOVE TBLE-DATA-ITEM TO WS-RECEIV                     01350021
013600             MOVE WS-RECEIV-ORD-NBR TO HOLD-PO-NBR                01360021
013700*            DISPLAY HOLD-PO-NBR                                  01370021
013800*            DISPLAY WS-RECEIV                                    01380021
013900             PERFORM R100-DELETE                                  01390021
014000             PERFORM B101-ADD-TO-DELETE-COUNTS                    01400021
014100         WHEN DS009-PROCESS-TABLE = 'TRECITM'                     01410021
014200             MOVE TBLE-DATA-ITEM TO WS-RECITM                     01420021
014300             MOVE WS-RECITM-ORD-NBR TO HOLD-PO-NBR                01430021
014400*            DISPLAY HOLD-PO-NBR                                  01440021
014500*            DISPLAY WS-RECITM                                    01450021
014600             PERFORM R100-DELETE                                  01460021
014700             PERFORM B101-ADD-TO-DELETE-COUNTS                    01470021
014800         WHEN DS009-PROCESS-TABLE = 'TRECDIS'                     01480021
014900             MOVE TBLE-DATA-ITEM TO WS-RECDIS                     01490021
015000             MOVE WS-RECDIS-ORD-NBR TO HOLD-PO-NBR                01500021
015100*            DISPLAY HOLD-PO-NBR                                  01510021
015200*            DISPLAY WS-RECDIS                                    01520021
015300             PERFORM R100-DELETE                                  01530021
015400             PERFORM B101-ADD-TO-DELETE-COUNTS                    01540021
015500         WHEN DS009-PROCESS-TABLE = 'TVHTRIP'                     01550021
015600             MOVE TBLE-DATA-ITEM TO WS-VHTRIP                     01560021
015700             MOVE WS-VHTRIP-TRIP-ID  TO HOLD-TRIP-ID              01570021
015800*            DISPLAY HOLD-TRIP-ID                                 01580021
015900*            DISPLAY WS-VHTRIP                                    01590021
016000             PERFORM R100-DELETE                                  01600021
016100             PERFORM B101-ADD-TO-DELETE-COUNTS                    01610021
016200         WHEN DS009-PROCESS-TABLE = 'TSHIPMT'                     01620021
016300             MOVE TBLE-DATA-ITEM TO WS-SHIPMT                     01630021
016400             MOVE WS-SHIPMT-SHIPT-ID TO HOLD-SHIPT-ID             01640021
016500*            DISPLAY HOLD-SHIPT-ID                                01650021
016600*            DISPLAY WS-SHIPMT                                    01660021
016700             PERFORM R100-DELETE                                  01670021
016800             PERFORM B101-ADD-TO-DELETE-COUNTS                    01680021
016900         WHEN DS009-PROCESS-TABLE = 'TSHIPST'                     01690021
017000             MOVE TBLE-DATA-ITEM TO WS-SHIPST                     01700021
017100             MOVE WS-SHIPST-SHIPT-ID TO HOLD-SHIPT-ID             01710021
017200*            DISPLAY HOLD-SHIPT-ID                                01720021
017300*            DISPLAY WS-SHIPST                                    01730021
017400             PERFORM R100-DELETE                                  01740021
017500             PERFORM B101-ADD-TO-DELETE-COUNTS                    01750021
017600         WHEN DS009-PROCESS-TABLE = 'TTRIPST'                     01760021
017700             MOVE TBLE-DATA-ITEM TO WS-TRIPST                     01770021
017800             MOVE WS-TRIPST-TRIP-ID  TO HOLD-TRIP-ID              01780021
017900*            DISPLAY HOLD-TRIP-ID                                 01790021
018000*            DISPLAY WS-TRIPST                                    01800021
018100             PERFORM R100-DELETE                                  01810021
018200             PERFORM B101-ADD-TO-DELETE-COUNTS                    01820021
018300         WHEN DS009-PROCESS-TABLE = 'TVEHICL'                     01830021
018400             MOVE TBLE-DATA-ITEM TO WS-VEHICL                     01840021
018500             MOVE WS-VEHICL-OWNER-SCAC-ID TO HOLD-SCAC-ID         01850021
018600             MOVE WS-VEHICL-VEH-NBR       TO HOLD-VEH-NBR         01860021
018700*            DISPLAY HOLD-VEH-NBR                                 01870021
018800*            DISPLAY HOLD-SCAC-ID                                 01880021
018900*            DISPLAY WS-VEHICL                                    01890021
019000             PERFORM R100-DELETE                                  01900021
019100             PERFORM B101-ADD-TO-DELETE-COUNTS                    01910021
019200         WHEN DS009-PROCESS-TABLE = 'TRECDVS'                     01920021
019300             MOVE TBLE-DATA-ITEM TO WS-RECDVS                     01930021
019400             MOVE WS-RECDVS-ORD-NBR       TO HOLD-PO-NBR          01940021
019500*            DISPLAY HOLD-PO-NBR                                  01950021
019600*            DISPLAY WS-RECDVS                                    01960021
019700             PERFORM R100-DELETE                                  01970021
019800             PERFORM B101-ADD-TO-DELETE-COUNTS                    01980021
019900         WHEN DS009-PROCESS-TABLE = 'TAUTRIP'                     01990021
020000             MOVE TBLE-DATA-ITEM TO WS-AUTRIP                     02000021
020100             MOVE WS-AUTRIP-TRIP-ID       TO HOLD-TRIP-ID         02010021
020200*            DISPLAY HOLD-TRIP-ID                                 02020021
020300*            DISPLAY WS-AUTRIP                                    02030021
020400             PERFORM R100-DELETE                                  02040021
020500             PERFORM B101-ADD-TO-DELETE-COUNTS                    02050021
020600         WHEN DS009-PROCESS-TABLE = 'TAUSHIP'                     02060021
020700             MOVE TBLE-DATA-ITEM          TO WS-AUSHIP            02070021
020800             MOVE WS-AUSHIP-SHIPT-ID      TO HOLD-SHIPT-ID        02080021
020900*            DISPLAY HOLD-SHIPT-ID                                02090021
021000*            DISPLAY WS-AUSHIP                                    02100021
021100             PERFORM R100-DELETE                                  02110021
021200             PERFORM B101-ADD-TO-DELETE-COUNTS                    02120021
021300         WHEN DS009-PROCESS-TABLE = 'TAUSHPO'                     02130021
021400             MOVE TBLE-DATA-ITEM          TO WS-AUSHPO            02140021
021500             MOVE WS-AUSHPO-PO-NBR        TO HOLD-PO-NBR          02150021
021600*            DISPLAY HOLD-PO-NBR                                  02160021
021700*            DISPLAY WS-AUSHPO                                    02170021
021800             PERFORM R100-DELETE                                  02180021
021900             PERFORM B101-ADD-TO-DELETE-COUNTS                    02190021
022000         WHEN DS009-PROCESS-TABLE = 'TAUVHCL'                     02200021
022100             MOVE TBLE-DATA-ITEM          TO WS-AUVHCL            02210021
022200             MOVE WS-AUVHCL-OWNER-SCAC-ID TO HOLD-OWNER-SCAC-ID   02220021
022300             MOVE WS-AUVHCL-VEH-NBR       TO HOLD-VEH-NBR         02230021
022400*            DISPLAY HOLD-OWNER-SCAC-ID                           02240021
022500*            DISPLAY HOLD-VEH-NBR                                 02250021
022600*            DISPLAY WS-AUVHCL                                    02260021
022700             PERFORM R100-DELETE                                  02270021
022800             PERFORM B101-ADD-TO-DELETE-COUNTS                    02280021
022900         WHEN DS009-PROCESS-TABLE = 'TDISTHD'                     02290021
023000             MOVE TBLE-DATA-ITEM          TO WS-DISTHD            02300021
023100             MOVE WS-DISTHD-ORD-NBR       TO HOLD-ORD-NBR         02310021
023200*            DISPLAY HOLD-ORD-NBR                                 02320021
023300*            DISPLAY WS-DISTHD                                    02330021
023400             PERFORM R100-DELETE                                  02340021
023500             PERFORM B101-ADD-TO-DELETE-COUNTS                    02350021
023600         WHEN DS009-PROCESS-TABLE = 'TDISTDT'                     02360021
023700             MOVE TBLE-DATA-ITEM          TO WS-DISTDT            02370021
023800             MOVE WS-DISTDT-ORD-NBR       TO HOLD-ORD-NBR         02380021
023900*            DISPLAY HOLD-ORD-NBR                                 02390021
024000*            DISPLAY WS-DISTDT                                    02400021
024100             PERFORM R100-DELETE                                  02410021
024200             PERFORM B101-ADD-TO-DELETE-COUNTS                    02420021
024300         WHEN DS009-PROCESS-TABLE = 'TWRKORD'                     02430021
024400             MOVE TBLE-DATA-ITEM          TO WS-WRKORD            02440021
024500             MOVE WS-WRKORD-ORD-NBR       TO HOLD-ORD-NBR         02450021
024600*            DISPLAY HOLD-ORD-NBR                                 02460021
024700*            DISPLAY WS-WRKORD                                    02470021
024800             PERFORM R100-DELETE                                  02480021
024900             PERFORM B101-ADD-TO-DELETE-COUNTS                    02490021
025000         WHEN DS009-PROCESS-TABLE = 'TWKORIN'                     02500021
025100             MOVE TBLE-DATA-ITEM          TO WS-WKORIN            02510021
025200             MOVE WS-WKORIN-ORD-NBR       TO HOLD-ORD-NBR         02520021
025300*            DISPLAY HOLD-ORD-NBR                                 02530021
025400*            DISPLAY WS-WKORIN                                    02540021
025500             PERFORM R100-DELETE                                  02550021
025600             PERFORM B101-ADD-TO-DELETE-COUNTS                    02560021
025700         WHEN DS009-PROCESS-TABLE = 'TSHPSUM'                     02570021
025800             MOVE TBLE-DATA-ITEM          TO WS-SHPSUM            02580021
025900             MOVE WS-SHPSUM-PO-NBR        TO HOLD-PO-NBR          02590021
026000*            DISPLAY HOLD-PO-NBR                                  02600021
026100*            DISPLAY WS-SHPSUM                                    02610021
026200             PERFORM R100-DELETE                                  02620021
026300             PERFORM B101-ADD-TO-DELETE-COUNTS                    02630021
026400         WHEN DS009-PROCESS-TABLE = 'TLBVRDA'                     02640021
026500             MOVE TBLE-DATA-ITEM          TO WS-LBVRDA            02650021
026600             MOVE WS-LBVRDA-PO-NBR        TO HOLD-PO-NBR          02660021
026700*            DISPLAY HOLD-PO-NBR                                  02670021
026800*            DISPLAY WS-LBVRDA                                    02680021
026900             PERFORM R100-DELETE                                  02690021
027000             PERFORM B101-ADD-TO-DELETE-COUNTS                    02700021
027100                                                                  02710021
027200         WHEN DS009-PROCESS-TABLE = 'TLBPTDA'                     02720021
027300             MOVE TBLE-DATA-ITEM         TO WS-LBPTDA             02730021
027400             MOVE WS-LBPTDA-TRIP-ID      TO HOLD-TRIP-ID          02740021
027500*            DISPLAY HOLD-TRIP-ID                                 02750021
027600*            DISPLAY WS-LBPTDA                                    02760021
027700                                                                  02770021
027800             SET MORE-LBPTDA-DATA         TO TRUE                 02780021
027900             PERFORM 7010-OPEN-TLBPTDA-CSR                        02790021
028000             PERFORM 7011-FETCH-TLBPTDA-CSR                       02800021
028100                                                                  02810021
028200             IF SQLCODE = ZERO AND                                02820021
028300                      LBPTDA-TRIP-ID = 224760256                  02830021
028400                 DISPLAY 'TRAP1'                                  02840021
028500             END-IF                                               02850021
028600             PERFORM UNTIL NO-MORE-LBPTDA-DATA                    02860021
028700                 PERFORM 7012-DELETE-TLBPTDA-CSR                  02870021
028800                 PERFORM B100A-CONTROL-COMMIT                     02880021
028900                 PERFORM B101-ADD-TO-DELETE-COUNTS                02890021
029000                 PERFORM 7011-FETCH-TLBPTDA-CSR                   02900021
029100             END-PERFORM                                          02910021
029200             PERFORM 7013-CLOSE-TLBPTDA-CSR                       02920021
029300                                                                  02930021
029400         END-EVALUATE                                             02940021
029500                                                                  02950021
029600*        DISPLAY 'DELETE RETURN SQLCODE:' SQLCODE                 02960021
029700*        DISPLAY 'NUMBER OF ROWS DELETED:' SQLERRD (3)            02970021
029800         PERFORM B100A-CONTROL-COMMIT                             02980021
029900         END-IF                                                   02990021
030000     END-IF.                                                      03000021
030100                                                                  03010021
030200 B100A-CONTROL-COMMIT.                                            03020021
030300     ADD SQLERRD(3) TO DS009-UPDATE-COUNT                         03030021
030400     IF DS009-UPDATE-COUNT > DS009-COMMIT-COUNT                   03040021
030500            EXEC SQL                                              03050021
030600                COMMIT                                            03060021
030700            END-EXEC                                              03070021
030800            IF SQLCODE NOT = ZERO                                 03080021
030900               PERFORM DS002-SQL-ABEND-COMMIT                     03090021
031000            END-IF                                                03100021
031100            MOVE +0  TO DS009-UPDATE-COUNT                        03110021
031200*           DISPLAY 'COMMIT TAKEN AFTER RECORD: '                 03120021
031300*                                     DS009-TUPDATE-COUNT         03130021
031400         ADD SQLERRD(3) TO DS009-UPDATE-COUNT                     03140021
031500         ADD SQLERRD(3) TO DS009-TUPDATE-COUNT                    03150021
031600     END-IF.                                                      03160021
031700                                                                  03170021
031800 B101-ADD-TO-DELETE-COUNTS.                                       03180021
031900     IF SQLCODE = ZERO OR +100                                    03190021
032000         IF NOT-TABLE-EOF AND DS009-DO-PROCESS                    03200021
032100             SET DS009-SRCH-IDX TO +1                             03210021
032200             SEARCH DS009-CNTL-RECORDS                            03220021
032300                 VARYING DS009-SRCH-IDX                           03230021
032400                 AT END                                           03240021
032500                    CONTINUE                                      03250021
032600                 WHEN CNTL-TABLE (DS009-SRCH-IDX) =               03260021
032700                           DS009-PROCESS-TABLE                    03270021
032800                     ADD SQLERRD(3)                               03280021
032900                        TO DS009-READ-COUNT (DS009-SRCH-IDX)      03290021
033000             END-SEARCH                                           03300021
033100         END-IF                                                   03310021
033200     END-IF.                                                      03320021
033300 EJECT                                                            03330021
033400*                                                                 03340021
033500***************************************************************** 03350021
033600*     DELETE RECORD                                               03360021
033700***************************************************************** 03370021
033800*                                                                 03380021
033900 R100-DELETE.                                                     03390021
034000     PERFORM WITH TEST AFTER                                      03400021
034100         VARYING DS009-RETRY-COUNTER FROM 1 BY 1                  03410021
034200         UNTIL   DS009-RETRY-COUNTER > 3 OR                       03420021
034300                 SQLCODE = ZERO OR +100                           03430021
034400         EVALUATE TRUE                                            03440021
034500           WHEN DS009-PROCESS-TABLE = 'TSHPTPO'                   03450021
034600             EXEC SQL                                             03460021
034700                 DELETE FROM TSHPTPO                              03470021
034800                 WHERE PO_NBR = :HOLD-PO-NBR                      03480021
034900             END-EXEC                                             03490021
035000           WHEN DS009-PROCESS-TABLE = 'TPKSLIP'                   03500021
035100             EXEC SQL                                             03510021
035200                DELETE FROM TPKSLIP                               03520021
035300                WHERE PO_NBR = :HOLD-PO-NBR                       03530021
035400             END-EXEC                                             03540021
035500           WHEN DS009-PROCESS-TABLE = 'TPKITEM'                   03550021
035600             EXEC SQL                                             03560021
035700                DELETE FROM TPKITEM                               03570021
035800                WHERE PO_NBR = :HOLD-PO-NBR                       03580021
035900             END-EXEC                                             03590021
036000           WHEN DS009-PROCESS-TABLE = 'TRECEIV'                   03600021
036100             EXEC SQL                                             03610021
036200                DELETE FROM TRECEIV                               03620021
036300                WHERE ORD_NBR = :HOLD-PO-NBR                      03630021
036400             END-EXEC                                             03640021
036500           WHEN DS009-PROCESS-TABLE = 'TRECITM'                   03650021
036600             EXEC SQL                                             03660021
036700                DELETE FROM TRECITM                               03670021
036800                WHERE ORD_NBR = :HOLD-PO-NBR                      03680021
036900             END-EXEC                                             03690021
037000           WHEN DS009-PROCESS-TABLE = 'TRECDIS'                   03700021
037100             EXEC SQL                                             03710021
037200                DELETE FROM TRECDIS                               03720021
037300                WHERE ORD_NBR = :HOLD-PO-NBR                      03730021
037400             END-EXEC                                             03740021
037500           WHEN DS009-PROCESS-TABLE = 'TSHIPMT'                   03750021
037600             EXEC SQL                                             03760021
037700                DELETE FROM TSHIPMT                               03770021
037800                WHERE SHIPT_ID = :HOLD-SHIPT-ID                   03780021
037900             END-EXEC                                             03790021
038000           WHEN DS009-PROCESS-TABLE = 'TSHIPST'                   03800021
038100             EXEC SQL                                             03810021
038200                DELETE FROM TSHIPST                               03820021
038300                WHERE SHIPT_ID = :HOLD-SHIPT-ID                   03830021
038400             END-EXEC                                             03840021
038500           WHEN DS009-PROCESS-TABLE = 'TTRIPST'                   03850021
038600             EXEC SQL                                             03860021
038700                DELETE FROM TTRIPST                               03870021
038800                WHERE TRIP_ID = :HOLD-TRIP-ID                     03880021
038900             END-EXEC                                             03890021
039000           WHEN DS009-PROCESS-TABLE = 'TVHTRIP'                   03900021
039100             EXEC SQL                                             03910021
039200                DELETE FROM TVHTRIP                               03920021
039300                WHERE TRIP_ID = :HOLD-TRIP-ID                     03930021
039400             END-EXEC                                             03940021
039500*            MOVE HOLD-TRIP-ID TO PV-DISP-NBR                     03950021
039600*            DISPLAY 'TRIP-ID= ' PV-DISP-NBR                      03960021
039700*            IF SQLCODE NOT = ZERO                                03970021
039800*                MOVE SQLCODE TO PV-DISP-SQLCODE                  03980021
039900*                DISPLAY 'TVHTRIP SQLCODE= ' PV-DISP-SQLCODE      03990021
040000*            END-IF                                               04000021
040100*            MOVE SQLERRD (3) TO PV-DISP-NBR                      04010021
040200*            DISPLAY 'ROWS DELETED= ' PV-DISP-NBR                 04020021
040300           WHEN DS009-PROCESS-TABLE = 'TVEHICL'                   04030021
040400             EXEC SQL                                             04040021
040500                DELETE FROM TVEHICL                               04050021
040600                WHERE VEH_NBR = :HOLD-VEH-NBR                     04060021
040700                AND   OWNER_SCAC_ID = :HOLD-SCAC-ID               04070021
040800             END-EXEC                                             04080021
040900           WHEN DS009-PROCESS-TABLE = 'TRECDVS'                   04090021
041000             EXEC SQL                                             04100021
041100                DELETE FROM TRECDVS                               04110021
041200                WHERE ORD_NBR = :HOLD-PO-NBR                      04120021
041300             END-EXEC                                             04130021
041400           WHEN DS009-PROCESS-TABLE = 'TAUTRIP'                   04140021
041500             EXEC SQL                                             04150021
041600                DELETE FROM TAUTRIP                               04160021
041700                WHERE TRIP_ID = :HOLD-TRIP-ID                     04170021
041800             END-EXEC                                             04180021
041900           WHEN DS009-PROCESS-TABLE = 'TAUSHIP'                   04190021
042000             EXEC SQL                                             04200021
042100                DELETE FROM TAUSHIP                               04210021
042200                WHERE SHIPT_ID     = :HOLD-SHIPT-ID               04220021
042300             END-EXEC                                             04230021
042400           WHEN DS009-PROCESS-TABLE = 'TAUSHPO'                   04240021
042500             EXEC SQL                                             04250021
042600                DELETE FROM TAUSHPO                               04260021
042700                WHERE PO_NBR       = :HOLD-PO-NBR                 04270021
042800             END-EXEC                                             04280021
042900           WHEN DS009-PROCESS-TABLE = 'TAUVHCL'                   04290021
043000             EXEC SQL                                             04300021
043100                DELETE FROM TAUVHCL                               04310021
043200                WHERE OWNER_SCAC_ID = :HOLD-OWNER-SCAC-ID         04320021
043300                AND   VEH_NBR       = :HOLD-VEH-NBR               04330021
043400             END-EXEC                                             04340021
043500           WHEN DS009-PROCESS-TABLE = 'TDISTHD'                   04350021
043600             EXEC SQL                                             04360021
043700                DELETE FROM TDISTHD                               04370021
043800                WHERE ORD_NBR      = :HOLD-ORD-NBR                04380021
043900             END-EXEC                                             04390021
044000           WHEN DS009-PROCESS-TABLE = 'TDISTDT'                   04400021
044100             EXEC SQL                                             04410021
044200                DELETE FROM TDISTDT                               04420021
044300                WHERE ORD_NBR      = :HOLD-ORD-NBR                04430021
044400             END-EXEC                                             04440021
044500           WHEN DS009-PROCESS-TABLE = 'TWRKORD'                   04450021
044600             EXEC SQL                                             04460021
044700                DELETE FROM TWRKORD                               04470021
044800                WHERE ORD_NBR      = :HOLD-ORD-NBR                04480021
044900             END-EXEC                                             04490021
045000           WHEN DS009-PROCESS-TABLE = 'TWKORIN'                   04500021
045100             EXEC SQL                                             04510021
045200                DELETE FROM TWKORIN                               04520021
045300                WHERE ORD_NBR      = :HOLD-ORD-NBR                04530021
045400             END-EXEC                                             04540021
045500           WHEN DS009-PROCESS-TABLE = 'TSHPSUM'                   04550021
045600             EXEC SQL                                             04560021
045700                DELETE FROM TSHPSUM                               04570021
045800                WHERE PO_NBR       = :HOLD-PO-NBR                 04580021
045900             END-EXEC                                             04590021
046000           WHEN DS009-PROCESS-TABLE = 'TLBVRDA'                   04600021
046100             PERFORM 7000-LOCK-TLBVRDA                            04610021
046200             EXEC SQL                                             04620021
046300                DELETE FROM TLBVRDA                               04630021
046400                WHERE PO_NBR       = :HOLD-PO-NBR                 04640021
046500             END-EXEC                                             04650021
046600           WHEN DS009-PROCESS-TABLE = 'TLBPTDA'                   04660021
046700             EXEC SQL                                             04670021
046800                DELETE FROM TLBPTDA                               04680021
046900                WHERE TRIP_ID      = :HOLD-TRIP-ID                04690021
047000             END-EXEC                                             04700021
047100         END-EVALUATE                                             04710021
047200     END-PERFORM.                                                 04720021
047300     PERFORM DS002-SQL-ABEND-DELETE.                              04730021
047400 EJECT                                                            04740021
047410                                                                  04741022
047420 1100-GET-DB2-INSTANCE.                                           04742022
047430                                                                  04743022
047440     MOVE '1100-GET-DB2-INSTANCE'                                 04744022
047450          TO DS009-PARAGRAPH.                                     04745022
047460     MOVE 'GET DB2 INSTANCE'                                      04746022
047470          TO DS009-OPERATION.                                     04747022
047480                                                                  04748022
047490     EXEC SQL                                                     04749022
047491         SELECT CURRENT SERVER INTO :WS-LOCAL-SERVER              04749122
047492             FROM SYSIBM.SYSDUMMY1 WITH UR                        04749222
047493     END-EXEC.                                                    04749322
047494                                                                  04749422
047495     EVALUATE TRUE                                                04749522
047496         WHEN SQLCODE = +0                                        04749622
047497             CONTINUE                                             04749722
047498         WHEN SQLWARN0 NOT = SPACES                               04749822
047499         WHEN SQLCODE < +0                                        04749922
047500         WHEN SQLCODE > +0                                        04750022
047501             PERFORM DS002-SQL-ERROR                              04750122
047502     END-EVALUATE.                                                04750222
047503*                                                                 04750322
047504 1200-CHECK-IF-PRODUCTION.                                        04750422
047505                                                                  04750522
047506     MOVE '1200-CHECK-IF-PRODUCTION'                              04750622
047507          TO DS009-PARAGRAPH.                                     04750722
047508     MOVE 'SELECT PRDCHK TKRPRPM '                                04750822
047509          TO DS009-OPERATION.                                     04750922
047510                                                                  04751022
047511     EXEC SQL                                                     04751122
047512       SELECT FUNC_TXT                                            04751222
047513         INTO :KRPRPM-FUNC-TXT                                    04751322
047514       FROM   TKRPRPM                                             04751422
047515       WHERE  SYS_PRC_FUNC_CDE  = :PC-PRDCHK                      04751523
047516         AND  INTFC_SYS_CDE     = :PC-KHL                         04751622
047517         AND  LOC_ID            = :PC-90                          04751722
047518         AND  FUNC_TXT          = :PC-PARM-TEXT                   04751822
047519     END-EXEC                                                     04751922
047520                                                                  04752022
047521     EVALUATE TRUE                                                04752122
047522         WHEN SQLCODE = +0                                        04752222
047523             CONTINUE                                             04752322
047524         WHEN SQLCODE = +100                                      04752422
047525             DISPLAY '*******************************************'04752522
047526             DISPLAY '** ABEND - DO NOT RUN THIS DSKUT006 PROGRAM'04752622
047527             DISPLAY '** ABEND - AGAINST PRODUCTION'              04752722
047528             DISPLAY '** ABEND - THIS SHOULD ONLY EVER BE'        04752822
047529             DISPLAY '** ABEND - RUN AGAINST TEST DATA'           04752922
047530             DISPLAY '*******************************************'04753022
047531             DISPLAY '** ABEND - THIS RUN IS GOING AGAINST'       04753122
047532             DISPLAY '** ABEND - DB2 INSTANCE:  '                 04753222
047533                     WS-LOCAL-SERVER                              04753322
047534             DISPLAY '*******************************************'04753422
047535             PERFORM DS002-SQL-ERROR                              04753522
047536                                                                  04753622
047537         WHEN SQLWARN0 NOT = SPACES                               04753722
047538         WHEN SQLCODE < +0                                        04753822
047539         WHEN SQLCODE > +0                                        04753922
047540             PERFORM DS002-SQL-ERROR                              04754022
047541     END-EVALUATE.                                                04754122
047542                                                                  04754222
047543 7000-LOCK-TLBVRDA.                                               04754321
047544                                                                  04754421
047545*                                                                 04754501
047546     MOVE '7000-LOCK-TLBVRDA'         TO DS009-PARAGRAPH.         04754601
047547     MOVE 'LOCK TABLE'                TO DS009-OPERATION.         04754701
047548                                                                  04754821
047549     EXEC SQL                                                     04754921
047550         LOCK TABLE                                               04755021
047551             TLBVRDA                                              04755121
047552         IN EXCLUSIVE MODE                                        04755221
047553     END-EXEC.                                                    04755321
047554                                                                  04755421
047555     IF SQLCODE = ZERO                                            04755521
047556         MOVE 'R100-DELETE'           TO DS009-PARAGRAPH          04755601
047557         MOVE 'DELETE'                TO DS009-OPERATION          04755701
047558     ELSE                                                         04755821
047559         PERFORM DS002-SQL-ERROR                                  04755901
047560     END-IF.                                                      04756021
047561/                                                                 04756121
047562 7010-OPEN-TLBPTDA-CSR.                                           04756221
047563     PERFORM WITH TEST AFTER                                      04756321
047564             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              04756421
047565             UNTIL   DS009-RETRY-COUNTER > 3 OR                   04756521
047566                     SQLCODE = ZERO                               04756621
047567                                                                  04756721
047570             EXEC SQL                                             04757021
047580                 OPEN TLBPTDA-CSR                                 04758021
047590             END-EXEC                                             04759021
047600                                                                  04760021
047700             EVALUATE TRUE                                        04770021
047800                 WHEN SQLCODE = ZERO                              04780021
047900                 WHEN SQLCODE = -904                              04790021
048000                 WHEN SQLCODE = -913                              04800021
048100                 WHEN SQLCODE = -911                              04810021
048200                      CONTINUE                                    04820021
048300             END-EVALUATE                                         04830021
048400     END-PERFORM.                                                 04840021
048500                                                                  04850021
048600     PERFORM DS002-SQL-ABEND-OPEN-CSR.                            04860021
048700                                                                  04870021
048800 7011-FETCH-TLBPTDA-CSR.                                          04880021
048900     PERFORM WITH TEST AFTER                                      04890021
049000             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              04900021
049100             UNTIL   DS009-RETRY-COUNTER > 3 OR                   04910021
049200                     SQLCODE = ZERO OR SQLCODE = +100             04920021
049300                                                                  04930021
049400        EXEC SQL                                                  04940021
049500            FETCH TLBPTDA-CSR                                     04950021
049600            INTO                                                  04960021
049700                 :LBPTDA-TRIP-ID                                  04970021
049800        END-EXEC                                                  04980021
049900                                                                  04990021
050000         EVALUATE TRUE                                            05000021
050100             WHEN SQLCODE = ZERO                                  05010021
050200                 CONTINUE                                         05020021
050300             WHEN SQLCODE = +100                                  05030021
050400                 SET NO-MORE-LBPTDA-DATA TO TRUE                  05040021
050500             WHEN SQLCODE = -904                                  05050021
050600             WHEN SQLCODE = -913                                  05060021
050700             WHEN SQLCODE = -911                                  05070021
050800                 CONTINUE                                         05080021
050900             END-EVALUATE                                         05090021
051000     END-PERFORM.                                                 05100021
051100                                                                  05110021
051200     PERFORM DS002-SQL-ABEND-FETCH.                               05120021
051300                                                                  05130021
051400 7012-DELETE-TLBPTDA-CSR.                                         05140021
051500     PERFORM WITH TEST AFTER                                      05150021
051600             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              05160021
051700             UNTIL   DS009-RETRY-COUNTER > 3 OR                   05170021
051800                     SQLCODE = ZERO OR SQLCODE = +100             05180021
051900                                                                  05190021
052000        EXEC SQL                                                  05200021
052100            DELETE FROM                                           05210021
052200                TLBPTDA                                           05220021
052300             WHERE CURRENT OF TLBPTDA-CSR                         05230021
052400        END-EXEC                                                  05240021
052500                                                                  05250021
052600             EVALUATE TRUE                                        05260021
052700                 WHEN SQLCODE = ZERO                              05270021
052800                 WHEN SQLCODE = -904                              05280021
052900                 WHEN SQLCODE = -913                              05290021
053000                 WHEN SQLCODE = -911                              05300021
053100                      CONTINUE                                    05310021
053200             END-EVALUATE                                         05320021
053300     END-PERFORM.                                                 05330021
053400                                                                  05340021
053500     PERFORM DS002-SQL-ABEND-DELETE.                              05350021
053600                                                                  05360021
053700 7013-CLOSE-TLBPTDA-CSR.                                          05370021
053800     PERFORM WITH TEST AFTER                                      05380021
053900             VARYING DS009-RETRY-COUNTER FROM 1 BY 1              05390021
054000             UNTIL   DS009-RETRY-COUNTER > 3 OR                   05400021
054100                     SQLCODE = ZERO                               05410021
054200                                                                  05420021
054300             EXEC SQL                                             05430021
054400                 CLOSE TLBPTDA-CSR                                05440021
054500             END-EXEC                                             05450021
054600                                                                  05460021
054700             EVALUATE TRUE                                        05470021
054800                 WHEN SQLCODE = ZERO                              05480021
054900                 WHEN SQLCODE = -904                              05490021
055000                 WHEN SQLCODE = -913                              05500021
055100                 WHEN SQLCODE = -911                              05510021
055200                      CONTINUE                                    05520021
055300             END-EVALUATE                                         05530021
055400     END-PERFORM.                                                 05540021
055500                                                                  05550021
055600     PERFORM DS002-SQL-ABEND-CLOSE-CSR.                           05560021
055700                                                                  05570021
055800/                                                                 05580021
055900***************************************************************** 05590021
056000*     PRODUCTION - TO - TEST STANDARD PARAGRAPHS                * 05600021
056100***************************************************************** 05610021
056200     COPY DSPD002.                                                05620021
