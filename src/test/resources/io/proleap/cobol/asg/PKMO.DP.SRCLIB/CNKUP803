000100******************************************************************00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000600******************************************************************00060004
000700 PROGRAM-ID.    CNKUP803.                                         00070099
000800 AUTHOR.        TKMA497.                                          00080007
000900 INSTALLATION.  KOHLS.                                            00090004
001000 DATE-WRITTEN   AUGUST, 2011.                                     00100099
001100 DATE-COMPILED.                                                   00110004
001200******************************************************************00120004
001210*  NEW DC - PRINTER INSERT                                        00121099
001220*           TPRTRCL - PRINTER CLUSTER                             00122099
001230*           TPRTRID - PRINTER ID                                  00123099
001240*           TPRTRTK - PRINTER STOCK                               00124099
001300*  THIS PROGRAM INSERTS TPRTRCL, TPRTRID, AND TPRTRTK DATA TO     00130099
001400*  THE DB2 TABLES.                                                00140099
006600******************************************************************00660004
007000 ENVIRONMENT DIVISION.                                            00700004
007100******************************************************************00710004
007200 CONFIGURATION SECTION.                                           00720004
007300*                                                                 00730004
007400 SOURCE-COMPUTER.        IBM-3090.                                00740004
007500 OBJECT-COMPUTER.        IBM-3090.                                00750004
007600*                                                                 00760004
007700 INPUT-OUTPUT SECTION.                                            00770004
007800*                                                                 00780004
007900 FILE-CONTROL.                                                    00790004
008600*                                                                 00860099
008610     SELECT CLUSTER-FILE-IN                                       00861099
008620         ASSIGN TO INP01.                                         00862099
008630*                                                                 00863099
008640     SELECT PRINTER-FILE-IN                                       00864099
008650         ASSIGN TO INP02.                                         00865099
008660*                                                                 00866099
008670     SELECT TRACK-NBR-FILE-IN                                     00867099
008680         ASSIGN TO INP03.                                         00868099
008700*                                                                 00870004
008800******************************************************************00880004
008900 DATA DIVISION.                                                   00890004
009000******************************************************************00900004
009100 FILE SECTION.                                                    00910004
009200*                                                                 00920004
010710*                                                                 01071099
010720 FD  CLUSTER-FILE-IN                                              01072099
010730     RECORDING MODE IS F                                          01073099
010740     BLOCK CONTAINS 0 RECORDS                                     01074099
010750     LABEL RECORDS ARE STANDARD.                                  01075099
010760*                                                                 01076099
010770 01 CLUSTER-RECORD-IN                 PIC  X(29).                 01077099
010780*                                                                 01078099
010790 FD  PRINTER-FILE-IN                                              01079099
010791     RECORDING MODE IS F                                          01079199
010792     BLOCK CONTAINS 0 RECORDS                                     01079299
010793     LABEL RECORDS ARE STANDARD.                                  01079399
010794*                                                                 01079499
010795 01 PRINTER-RECORD-IN                 PIC  X(55).                 01079599
010796*                                                                 01079699
010797 FD  TRACK-NBR-FILE-IN                                            01079799
010798     RECORDING MODE IS F                                          01079899
010799     BLOCK CONTAINS 0 RECORDS                                     01079999
010800     LABEL RECORDS ARE STANDARD.                                  01080099
010801*                                                                 01080199
010802 01 TRACK-NBR-RECORD-IN               PIC  X(23).                 01080299
010803*                                                                 01080399
010810*                                                                 01081004
010900 WORKING-STORAGE SECTION.                                         01090004
011000*                                                                 01100004
011010 01  WS-TPRTRID.                                                  01101099
011020     05  WS-PRTRID-DATA.                                          01102099
011030         10  WS-PRTRID-PRTR-ID            PIC   X(8).             01103099
011040         10  WS-PRTRID-PRTR-OPER-UNT-ID   PIC  S9(4) COMP.        01104099
011050         10  WS-PRTRID-PRTR-FCLTY-ID      PIC  S9(4) COMP.        01105099
011060         10  WS-PRTRID-PRTR-CLUSTR-NBR    PIC  S9(4) COMP.        01106099
011070         10  WS-PRTR-CLUSTR-NBR-NULL      PIC  S9(4) COMP.        01107099
011080         10  WS-PRTRID-PRTR-TYP-CDE       PIC   X(8).             01108099
011090         10  WS-PRTRID-PRTR-LOC-DESC      PIC   X(30).            01109099
011091         10  WS-PRTRID-PRTR-PHY-STAT-CDE  PIC   X(1).             01109199
011092                                                                  01109299
011100 01  PC-PROGRAM-CONSTANTS.                                        01110004
011200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)    VALUE            01120019
011300         'CNKUP803'.                                              01130099
014600*                                                                 01460004
014700 01  PS-PROGRAM-SWITCHES.                                         01470004
015201     05  PS-END-OF-CLUSTER-SW        PIC  X(01)    VALUE 'N'.     01520199
015210         88 PS-END-OF-CLUSTER-NO                   VALUE 'N'.     01521099
015220         88 PS-END-OF-CLUSTER-YES                  VALUE 'Y'.     01522099
015230     05  PS-END-OF-PRINTER-SW        PIC  X(01)    VALUE 'N'.     01523099
015240         88 PS-END-OF-PRINTER-NO                   VALUE 'N'.     01524099
015250         88 PS-END-OF-PRINTER-YES                  VALUE 'Y'.     01525099
015260     05  PS-END-OF-TRACK-NBR-SW      PIC  X(01)    VALUE 'N'.     01526099
015270         88 PS-END-OF-TRACK-NBR-NO                 VALUE 'N'.     01527099
015280         88 PS-END-OF-TRACK-NBR-YES                VALUE 'Y'.     01528099
015400*                                                                 01540004
015500 01  PV-PROGRAM-VARIABLES.                                        01550004
015600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01560004
015700                                                   COMP.          01570004
015800     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01580004
015820     05  PV-COMMIT-CNT               PIC S9(03)    COMP-3.        01582090
015830     05  PV-INSERT-CNT               PIC S9(03)    COMP-3         01583093
015840                                                   VALUE +1.      01584093
015900     05  PV-TPRTRCL-CNT              PIC S9(05)    VALUE ZERO     01590099
016000                                                   COMP-3.        01600004
016010     05  PV-TPRTRID-CNT              PIC S9(05)    VALUE ZERO     01601099
016020                                                   COMP-3.        01602099
016030     05  PV-TPRTRTK-CNT              PIC S9(05)    VALUE ZERO     01603099
016040                                                   COMP-3.        01604099
016100     05  PV-CLUSTER-IN-CNT           PIC S9(05)    VALUE ZERO     01610099
016200                                                   COMP-3.        01620004
016300     05  PV-PRINTER-IN-CNT           PIC S9(05)    VALUE ZERO     01630099
016400                                                   COMP-3.        01640099
016401     05  PV-TRACK-NBR-IN-CNT         PIC S9(05)    VALUE ZERO     01640199
016402                                                   COMP-3.        01640299
016410     05  PV-DISPLAY-CNT              PIC ZZZZ9.                   01641033
016420     05  PV-DISP-PRTR-CLUSTR-NBR     PIC  9(4).                   01642099
016430     05  PV-DISP-OPER-UNT-ID         PIC  9(4).                   01643099
016450     05  PV-DISP-PRTR-TRK-NBR        PIC  9(4).                   01645099
016500     05  PV-COMMIT-DISPLAY-1         PIC  X(10).                  01650099
016510     05  PV-COMMIT-DISPLAY-2         PIC  X(10).                  01651099
016520     05  PV-COMMIT-DISPLAY-3         PIC  X(10).                  01652099
016600     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01660099
020400*                                                                 02040004
021300******************************************************************02130004
021400*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02140004
021500******************************************************************02150004
021600     COPY DPWS004.                                                02160004
021800*                                                                 02180004
021900******************************************************************02190004
022000*  COMMUNICATIONS AREA FOR DB2                                    02200004
022100******************************************************************02210004
022200     EXEC SQL                                                     02220004
022300          INCLUDE SQLCA                                           02230004
022400     END-EXEC.                                                    02240004
022500*                                                                 02250004
022570*----------------------------------------------------------------*02257099
022580*    DB2 PRINTER CLUSTER TABLE                                    02258099
022590*----------------------------------------------------------------*02259099
022600     EXEC SQL                                                     02260099
022700          INCLUDE TPRTRCL                                         02270099
022800     END-EXEC.                                                    02280099
022900*                                                                 02290099
023000*----------------------------------------------------------------*02300099
023100*    DB2 PRINTER TABLE                                            02310099
023200*----------------------------------------------------------------*02320099
023300     EXEC SQL                                                     02330099
023400          INCLUDE TPRTRID                                         02340099
023500     END-EXEC.                                                    02350099
023600*                                                                 02360099
023700*----------------------------------------------------------------*02370099
023800*    DB2 PRINTER TRACK NUMBER TABLE                               02380099
023900*----------------------------------------------------------------*02390099
024000     EXEC SQL                                                     02400099
024100          INCLUDE TPRTRTK                                         02410099
024200     END-EXEC.                                                    02420099
024300*                                                                 02430099
024900*                                                                 02490004
024920*----------------------------------------------------------------*02492099
024930*    DB2 TABLE FOR PARAMETERS                                     02493099
024940*----------------------------------------------------------------*02494099
024950     EXEC SQL                                                     02495099
024960          INCLUDE TKRPRPM                                         02496099
024970     END-EXEC.                                                    02497099
024980*                                                                 02498099
046000*                                                                 04600004
046100******************************************************************04610004
046200 PROCEDURE DIVISION.                                              04620004
046300******************************************************************04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                   04660004
046700******************************************************************04670004
046800 0000-PROGRAM-MAINLINE.                                           04680004
046810     PERFORM 1000-INITIALIZE.                                     04681091
047000*                                                                 04700004
047010     PERFORM 5000-READ-CL-INPUT.                                  04701099
047020     IF PS-END-OF-CLUSTER-NO                                      04702099
047029         PERFORM 2000-PROCESS-TPRTRCL                             04702999
047030             UNTIL PS-END-OF-CLUSTER-YES                          04703099
047040         MOVE 'TPRTRCL'           TO PV-COMMIT-DISPLAY-1          04704099
047041         MOVE PRTRCL-PRTR-CLUSTR-NBR                              04704199
047042                                  TO PV-DISP-PRTR-CLUSTR-NBR      04704299
047043         MOVE PV-DISP-PRTR-CLUSTR-NBR                             04704399
047044                                  TO PV-COMMIT-DISPLAY-2          04704499
047045         MOVE PRTRCL-CLUSTR-OPER-UNT-ID                           04704599
047046                                  TO PV-DISP-OPER-UNT-ID          04704699
047047         MOVE PV-DISP-OPER-UNT-ID TO PV-COMMIT-DISPLAY-3          04704799
047050         PERFORM 8000-COMMIT                                      04705099
047481     END-IF                                                       04748199
047482                                                                  04748299
047490     MOVE +1    TO PV-INSERT-CNT                                  04749099
047491     PERFORM 5100-READ-ID-INPUT.                                  04749199
047492     IF PS-END-OF-PRINTER-NO                                      04749299
047493         PERFORM 2100-PROCESS-TPRTRID                             04749399
047494             UNTIL PS-END-OF-PRINTER-YES                          04749499
047495         MOVE 'TPRTRID'           TO PV-COMMIT-DISPLAY-1          04749599
047496         MOVE WS-PRTRID-PRTR-ID   TO PV-COMMIT-DISPLAY-2          04749699
047498         MOVE WS-PRTRID-PRTR-OPER-UNT-ID                          04749899
047499                                  TO PV-DISP-OPER-UNT-ID          04749999
047500         MOVE PV-DISP-OPER-UNT-ID TO PV-COMMIT-DISPLAY-3          04750099
047502         PERFORM 8000-COMMIT                                      04750299
047503     END-IF                                                       04750399
047504                                                                  04750499
047505     MOVE +1    TO PV-INSERT-CNT                                  04750599
047506     PERFORM 5200-READ-TK-INPUT.                                  04750699
047507     IF PS-END-OF-TRACK-NBR-NO                                    04750799
047508         PERFORM 2200-PROCESS-TPRTRTK                             04750899
047509             UNTIL PS-END-OF-TRACK-NBR-YES                        04750999
047510             MOVE 'TPRTRTK'           TO PV-COMMIT-DISPLAY-1      04751099
047511             MOVE PRTRTK-PRTR-ID      TO PV-COMMIT-DISPLAY-2      04751199
047512             MOVE PRTRTK-PRTR-OPER-UNT-ID                         04751299
047513                                      TO PV-DISP-OPER-UNT-ID      04751399
047514             MOVE PV-DISP-OPER-UNT-ID TO PV-COMMIT-DISPLAY-3      04751499
047516         PERFORM 8000-COMMIT                                      04751699
047517     END-IF                                                       04751799
047518*                                                                 04751804
047519     PERFORM 9000-DISPLAY-COUNTS                                  04751999
047520     CLOSE CLUSTER-FILE-IN                                        04752099
047521           PRINTER-FILE-IN                                        04752199
047522           TRACK-NBR-FILE-IN.                                     04752299
047530*                                                                 04753064
047600     STOP RUN.                                                    04760004
047700*                                                                 04770004
048400******************************************************************04840004
048800*                                                                 04880004
048801 1000-INITIALIZE.                                                 04880191
048802     DISPLAY '**'.                                                04880299
048803     DISPLAY '** PROGRAM: CNKUP803'.                              04880399
048804     DISPLAY '**'.                                                04880499
048810     OPEN INPUT CLUSTER-FILE-IN                                   04881099
048820                PRINTER-FILE-IN                                   04882099
048830                TRACK-NBR-FILE-IN.                                04883099
049100                                                                  04910094
049200     EXEC SQL                                                     04920091
049400          SELECT FUNC_QTY                                         04940092
049500            INTO :PV-COMMIT-CNT                                   04950092
049593            FROM TKRPRPM                                          04959399
049594           WHERE LOC_ID           = 90                            04959494
049595             AND INTFC_SYS_CDE    = 'KHL'                         04959594
049596             AND SYS_PRC_FUNC_CDE = 'DCCOMT'                      04959699
049597         WITH UR                                                  04959791
049598     END-EXEC                                                     04959891
049599     EVALUATE TRUE                                                04959995
049600         WHEN SQLCODE = ZERO                                      04960095
049601              CONTINUE                                            04960199
049602         WHEN OTHER                                               04960295
049603              DISPLAY 'SYS_PRC_FUNC_CDE = DCCOMT'                 04960399
049609              MOVE '1000-INITIALIZE'                              04960995
049610                                 TO PV-ABEND-PARAGRAPH            04961095
049611              MOVE 'SELECT'      TO PV-DB2-OPERATION-ATTEMPTED    04961195
049612              PERFORM 9200-SQL-ABEND                              04961295
049613     END-EVALUATE.                                                04961395
049614*                                                                 04961495
049620******************************************************************04962004
049700 2000-PROCESS-TPRTRCL.                                            04970099
058600*                                                                 05860004
059200     PERFORM 7000-INSERT-TPRTRCL                                  05920099
059800*                                                                 05980004
061910     PERFORM 5000-READ-CL-INPUT.                                  06191099
061911                                                                  06191199
061920 2100-PROCESS-TPRTRID.                                            06192099
061930*                                                                 06193099
061940     PERFORM 7100-INSERT-TPRTRID                                  06194099
061950*                                                                 06195099
061960     PERFORM 5100-READ-ID-INPUT.                                  06196099
061970                                                                  06197099
061980 2200-PROCESS-TPRTRTK.                                            06198099
061990*                                                                 06199099
061991     PERFORM 7200-INSERT-TPRTRTK                                  06199199
061992*                                                                 06199299
061993     PERFORM 5200-READ-TK-INPUT.                                  06199399
062000*                                                                 06200004
062001 5000-READ-CL-INPUT.                                              06200199
062010     READ CLUSTER-FILE-IN                                         06201099
062021          INTO DCLTPRTRCL                                         06202199
062030          AT END                                                  06203065
062040              SET PS-END-OF-CLUSTER-YES TO TRUE                   06204099
062050          NOT AT END                                              06205067
062060              ADD +1 TO PV-CLUSTER-IN-CNT.                        06206099
111900*                                                                 11190004
111910 5100-READ-ID-INPUT.                                              11191099
111920     READ PRINTER-FILE-IN                                         11192099
111930          INTO WS-TPRTRID                                         11193099
111940          AT END                                                  11194099
111950              SET PS-END-OF-PRINTER-YES TO TRUE                   11195099
111960          NOT AT END                                              11196099
111970              ADD +1 TO PV-PRINTER-IN-CNT.                        11197099
111971*                                                                 11197199
111972 5200-READ-TK-INPUT.                                              11197299
111973     READ TRACK-NBR-FILE-IN                                       11197399
111974          INTO DCLTPRTRTK                                         11197499
111976          AT END                                                  11197699
111977              SET PS-END-OF-TRACK-NBR-YES TO TRUE                 11197799
111978          NOT AT END                                              11197899
111979              ADD +1 TO PV-TRACK-NBR-IN-CNT.                      11197999
111980*                                                                 11198099
112000******************************************************************11200004
112100*  INSERT PRINTER CLUSTER                                         11210099
112200******************************************************************11220004
112300 7000-INSERT-TPRTRCL.                                             11230099
112301*                                                                 11230168
112302     EXEC SQL                                                     11230269
112310     INSERT INTO TPRTRCL                                          11231099
112311                (PRTR_CLUSTR_NBR                                  11231199
112312                ,CLUSTR_OPER_UNT_ID                               11231299
112313                ,CLUSTR_FCLTY_ID                                  11231399
112314                ,IP_ADDR                                          11231499
112315                ,CLUSTR_OS_RLSE_CDE                               11231599
112316                ,DAT_XFER_MODE_ID                                 11231699
112317                ,XMIT_INTFC_CDE)                                  11231799
112318        VALUES (:PRTRCL-PRTR-CLUSTR-NBR                           11231899
112319               ,:PRTRCL-CLUSTR-OPER-UNT-ID                        11231999
112320               ,:PRTRCL-CLUSTR-FCLTY-ID                           11232099
112330               ,:PRTRCL-IP-ADDR                                   11233099
112340               ,:PRTRCL-CLUSTR-OS-RLSE-CDE                        11234099
112350               ,:PRTRCL-DAT-XFER-MODE-ID                          11235099
112360               ,:PRTRCL-XMIT-INTFC-CDE)                           11236099
112680     END-EXEC.                                                    11268069
112700*                                                                 11270004
112800     EVALUATE TRUE                                                11280004
112900         WHEN SQLCODE = ZERO                                      11290004
112910              ADD +1 TO PV-TPRTRCL-CNT                            11291099
112911                        PV-INSERT-CNT                             11291197
112912              IF PV-INSERT-CNT > PV-COMMIT-CNT                    11291299
112913                   MOVE 'TPRTRCL' TO PV-COMMIT-DISPLAY-1          11291399
112914                   MOVE PRTRCL-PRTR-CLUSTR-NBR                    11291499
112915                                  TO PV-DISP-PRTR-CLUSTR-NBR      11291599
112916                   MOVE PV-DISP-PRTR-CLUSTR-NBR                   11291699
112917                                  TO PV-COMMIT-DISPLAY-2          11291799
112918                   MOVE PRTRCL-CLUSTR-OPER-UNT-ID                 11291899
112919                                  TO PV-DISP-OPER-UNT-ID          11291999
112920                   MOVE PV-DISP-OPER-UNT-ID                       11292099
112921                                  TO PV-COMMIT-DISPLAY-3          11292199
112922                   PERFORM 8000-COMMIT                            11292299
112930                   MOVE +1    TO PV-INSERT-CNT                    11293098
112933              END-IF                                              11293398
112934         WHEN SQLCODE = -803                                      11293498
112935              MOVE PRTRCL-PRTR-CLUSTR-NBR                         11293599
112936                                 TO PV-DISP-PRTR-CLUSTR-NBR       11293699
112937              MOVE PRTRCL-CLUSTR-OPER-UNT-ID                      11293799
112938                                 TO PV-DISP-OPER-UNT-ID           11293899
112942              DISPLAY '*** DUPLICATE INSERT FOR: '                11294299
112943              DISPLAY '   ' PV-DISP-PRTR-CLUSTR-NBR ' '           11294399
112944                            PV-DISP-OPER-UNT-ID                   11294499
113100         WHEN OTHER                                               11310004
113101              PERFORM 9000-DISPLAY-COUNTS                         11310199
113102              MOVE PRTRCL-PRTR-CLUSTR-NBR                         11310299
113103                                 TO PV-DISP-PRTR-CLUSTR-NBR       11310399
113104              MOVE PRTRCL-CLUSTR-OPER-UNT-ID                      11310499
113105                                 TO PV-DISP-OPER-UNT-ID           11310599
113109              DISPLAY '  ' PV-DISP-PRTR-CLUSTR-NBR ' '            11310999
113110                           PV-DISP-OPER-UNT-ID ' '                11311099
113200              MOVE '7000-INSERT-TPRTRCL'                          11320099
113300                                 TO PV-ABEND-PARAGRAPH            11330022
113400              MOVE 'INSERT'      TO PV-DB2-OPERATION-ATTEMPTED    11340068
113500              PERFORM 9200-SQL-ABEND                              11350004
113600     END-EVALUATE.                                                11360004
113700******************************************************************11370099
113800*  INSERT PRINTER                                                 11380099
113900******************************************************************11390099
114000 7100-INSERT-TPRTRID.                                             11400099
114100*                                                                 11410099
114200     EXEC SQL                                                     11420099
114300     INSERT INTO TPRTRID                                          11430099
114400                (PRTR_ID                                          11440099
114500                ,PRTR_OPER_UNT_ID                                 11450099
114600                ,PRTR_FCLTY_ID                                    11460099
114700                ,PRTR_CLUSTR_NBR                                  11470099
114800                ,PRTR_TYP_CDE                                     11480099
114900                ,PRTR_LOC_DESC                                    11490099
115000                ,PRTR_PHY_STAT_CDE)                               11500099
115100        VALUES (:WS-PRTRID-PRTR-ID                                11510099
115200               ,:WS-PRTRID-PRTR-OPER-UNT-ID                       11520099
115300               ,:WS-PRTRID-PRTR-FCLTY-ID                          11530099
115400               ,:WS-PRTRID-PRTR-CLUSTR-NBR                        11540099
115500                    :WS-PRTR-CLUSTR-NBR-NULL                      11550099
115600               ,:WS-PRTRID-PRTR-TYP-CDE                           11560099
115700               ,:WS-PRTRID-PRTR-LOC-DESC                          11570099
115800               ,:WS-PRTRID-PRTR-PHY-STAT-CDE)                     11580099
115810     END-EXEC.                                                    11581099
115900*                                                                 11590099
116000     EVALUATE TRUE                                                11600099
116100         WHEN SQLCODE = ZERO                                      11610099
116200              ADD +1 TO PV-TPRTRID-CNT                            11620099
116300                        PV-INSERT-CNT                             11630099
116400              IF PV-INSERT-CNT > PV-COMMIT-CNT                    11640099
116401                   MOVE 'TPRTRID' TO PV-COMMIT-DISPLAY-1          11640199
116402                   MOVE WS-PRTRID-PRTR-ID                         11640299
116403                                  TO PV-COMMIT-DISPLAY-2          11640399
116410                   MOVE WS-PRTRID-PRTR-OPER-UNT-ID                11641099
116420                                  TO PV-DISP-OPER-UNT-ID          11642099
116430                   MOVE PV-DISP-OPER-UNT-ID                       11643099
116440                                  TO PV-COMMIT-DISPLAY-3          11644099
116500                   PERFORM 8000-COMMIT                            11650099
116600                   MOVE +1    TO PV-INSERT-CNT                    11660099
116700              END-IF                                              11670099
116800         WHEN SQLCODE = -803                                      11680099
116900              MOVE WS-PRTRID-PRTR-OPER-UNT-ID                     11690099
117000                                 TO PV-DISP-OPER-UNT-ID           11700099
117300              DISPLAY '*** DUPLICATE INSERT FOR: '                11730099
117400              DISPLAY '   ' WS-PRTRID-PRTR-ID ' '                 11740099
117500                            PV-DISP-OPER-UNT-ID                   11750099
117600         WHEN OTHER                                               11760099
117700              PERFORM 9000-DISPLAY-COUNTS                         11770099
117710              MOVE WS-PRTRID-PRTR-OPER-UNT-ID                     11771099
117720                                 TO PV-DISP-OPER-UNT-ID           11772099
117730              DISPLAY '  ' WS-PRTRID-PRTR-ID ' '                  11773099
117740                           PV-DISP-OPER-UNT-ID                    11774099
118400              MOVE '7100-INSERT-TPRTRID'                          11840099
118500                                 TO PV-ABEND-PARAGRAPH            11850099
118600              MOVE 'INSERT'      TO PV-DB2-OPERATION-ATTEMPTED    11860099
118700              PERFORM 9200-SQL-ABEND                              11870099
118800     END-EVALUATE.                                                11880099
143400*                                                                 14340004
143410******************************************************************14341099
143420*  INSERT TRACK NBR                                               14342099
143430******************************************************************14343099
143440 7200-INSERT-TPRTRTK.                                             14344099
143450*                                                                 14345099
143460     EXEC SQL                                                     14346099
143470     INSERT INTO TPRTRTK                                          14347099
143480                (PRTR_ID                                          14348099
143490                ,PRTR_OPER_UNT_ID                                 14349099
143491                ,PRTR_FCLTY_ID                                    14349199
143492                ,PRTR_TRK_NBR                                     14349299
143493                ,STK_TYP_CDE                                      14349399
143494                ,PRTR_TRK_STAT_CDE)                               14349499
143495        VALUES (:PRTRTK-PRTR-ID                                   14349599
143496               ,:PRTRTK-PRTR-OPER-UNT-ID                          14349699
143497               ,:PRTRTK-PRTR-FCLTY-ID                             14349799
143498               ,:PRTRTK-PRTR-TRK-NBR                              14349899
143499               ,:PRTRTK-STK-TYP-CDE                               14349999
143500               ,:PRTRTK-PRTR-TRK-STAT-CDE)                        14350099
143501     END-EXEC.                                                    14350199
143502*                                                                 14350299
143503     EVALUATE TRUE                                                14350399
143504         WHEN SQLCODE = ZERO                                      14350499
143505              ADD +1 TO PV-TPRTRTK-CNT                            14350599
143506                        PV-INSERT-CNT                             14350699
143507              IF PV-INSERT-CNT > PV-COMMIT-CNT                    14350799
143508                   MOVE 'TPRTRTK'      TO PV-COMMIT-DISPLAY-1     14350899
143509                   MOVE PRTRTK-PRTR-ID TO PV-COMMIT-DISPLAY-2     14350999
143510                   MOVE PRTRTK-PRTR-OPER-UNT-ID                   14351099
143511                                       TO PV-DISP-OPER-UNT-ID     14351199
143512                   MOVE PV-DISP-OPER-UNT-ID                       14351299
143513                                       TO PV-COMMIT-DISPLAY-3     14351399
143514                   PERFORM 8000-COMMIT                            14351499
143515                   MOVE +1    TO PV-INSERT-CNT                    14351599
143516              END-IF                                              14351699
143517         WHEN SQLCODE = -803                                      14351799
143518              MOVE PRTRTK-PRTR-OPER-UNT-ID                        14351899
143519                                 TO PV-DISP-OPER-UNT-ID           14351999
143520              DISPLAY '*** DUPLICATE INSERT FOR: '                14352099
143521              DISPLAY '   ' PRTRTK-PRTR-ID ' '                    14352199
143522                            PV-DISP-OPER-UNT-ID                   14352299
143523         WHEN OTHER                                               14352399
143524              PERFORM 9000-DISPLAY-COUNTS                         14352499
143525              MOVE WS-PRTRID-PRTR-OPER-UNT-ID                     14352599
143526                                 TO PV-DISP-OPER-UNT-ID           14352699
143527              DISPLAY '  ' PRTRTK-PRTR-ID ' '                     14352799
143528                           PV-DISP-OPER-UNT-ID                    14352899
143529              MOVE '7200-INSERT-TPRTRTK'                          14352999
143530                                 TO PV-ABEND-PARAGRAPH            14353099
143531              MOVE 'INSERT'      TO PV-DB2-OPERATION-ATTEMPTED    14353199
143532              PERFORM 9200-SQL-ABEND                              14353299
143533     END-EVALUATE.                                                14353399
143534*                                                                 14353499
143535 8000-COMMIT.                                                     14353599
143536     EXEC SQL                                                     14353699
143537          COMMIT                                                  14353799
143538     END-EXEC                                                     14353899
143540     IF SQLCODE = ZERO                                            14354099
143553         DISPLAY '*** COMMIT TAKEN AT: '                          14355399
143554                  PV-COMMIT-DISPLAY-1 ' '                         14355499
143555                  PV-COMMIT-DISPLAY-2 ' '                         14355599
143556                  PV-COMMIT-DISPLAY-3                             14355699
143570     ELSE                                                         14357098
143571         PERFORM 9000-DISPLAY-COUNTS                              14357199
143572         DISPLAY  PV-COMMIT-DISPLAY-1 ' '                         14357299
143573                  PV-COMMIT-DISPLAY-2 ' '                         14357399
143574                  PV-COMMIT-DISPLAY-3                             14357499
144300         MOVE '8000-COMMIT' TO PV-ABEND-PARAGRAPH                 14430099
144500         MOVE 'COMMIT'      TO PV-DB2-OPERATION-ATTEMPTED         14450098
144600         PERFORM 9200-SQL-ABEND                                   14460098
144610     END-IF.                                                      14461099
144760******************************************************************14476004
144800 9000-DISPLAY-COUNTS.                                             14480033
145100                                                                  14510004
145200     DISPLAY '********************************************'.      14520099
145300     DISPLAY '**                                        **'.      14530099
145301     DISPLAY '** TPRTRCL - PRINT CLUSTER                **'.      14530199
145302     DISPLAY '**                                        **'.      14530299
145310     MOVE PV-CLUSTER-IN-CNT  TO PV-DISPLAY-CNT                    14531099
145400     DISPLAY 'TPRTRCL FILE COUNT---: ' PV-DISPLAY-CNT.            14540099
145500     MOVE PV-TPRTRCL-CNT     TO PV-DISPLAY-CNT                    14550099
145501     DISPLAY 'TPRTRCL INSERTED ----: ' PV-DISPLAY-CNT.            14550199
145502     DISPLAY '**                                        **'.      14550299
145503     DISPLAY '** TPRTRID - PRINTER ID                   **'.      14550399
145504     DISPLAY '**                                        **'.      14550499
145505     MOVE PV-PRINTER-IN-CNT  TO PV-DISPLAY-CNT                    14550599
145506     DISPLAY 'TPRTRID FILE COUNT---: ' PV-DISPLAY-CNT.            14550699
145507     MOVE PV-TPRTRID-CNT     TO PV-DISPLAY-CNT                    14550799
145508     DISPLAY 'TPRTRID INSERTED ----: ' PV-DISPLAY-CNT.            14550899
145509     DISPLAY '**                                        **'.      14550999
145510     DISPLAY '** TPRTRTK - PRINTER TK                   **'.      14551099
145511     DISPLAY '**                                        **'.      14551199
145512     MOVE PV-TRACK-NBR-IN-CNT  TO PV-DISPLAY-CNT                  14551299
145513     DISPLAY 'TPRTRTK FILE COUNT---: ' PV-DISPLAY-CNT.            14551399
145514     MOVE PV-TPRTRTK-CNT     TO PV-DISPLAY-CNT                    14551499
145515     DISPLAY 'TPRTRTK INSERTED ----: ' PV-DISPLAY-CNT.            14551599
145516     DISPLAY '**                                        **'.      14551699
145520     DISPLAY '********************************************'.      14552037
146700*                                                                 14670004
146800******************************************************************14680004
146900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    14690004
147000*  ERROR OR WARNING CODE OCCURS.                                  14700004
147100******************************************************************14710004
147200 9200-SQL-ABEND.                                                  14720004
147300     DISPLAY '9200-SQL-ABEND'.                                    14730004
147400     DISPLAY '** ABEND     **'.                                   14740004
147500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14750004
147600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             14760004
147700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     14770004
147800*                                                                 14780004
147900*                                                                 14790004
148000******************************************************************14800004
148100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    14810004
148200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         14820004
148300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     14830004
148400* FORMAT.                                                         14840004
148500******************************************************************14850004
148600     COPY DPPD004.                                                14860004
148700                                                                  14870004
148800     IF  SQLCODE NOT = -911                                       14880004
148900         EXEC SQL                                                 14890004
149000              COMMIT                                              14900004
149100         END-EXEC                                                 14910004
149200     END-IF.                                                      14920004
149300                                                                  14930004
149400     MOVE +4013                  TO PV-ABEND-CODE.                14940004
149500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         14950004
