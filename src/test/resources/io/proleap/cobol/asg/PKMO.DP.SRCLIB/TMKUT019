000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TMKUT019.                                         00020000
000300 AUTHOR.        JOE LAROSA.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10-01-99.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*  BATCH CENTRAL DC PREPACK 'PACK OTR CALCULATION MODULE'.        00080000
000810******************************************************************00081000
000820*  THIS WAS COPIED FROM DPKCS277 AND CONVERTED FOR USE IN BATCH.  00082000
000830*  IF EITHER THIS PROGRAM OR DPKCS277 CHANGE, THE OTHER SHOULD    00083000
000840*  BE CHECKED TO SEE IF THE SAME CHANGE SHOULD BE MADE            00084000
000850*                                                                 00085000
000860* DPKCS277 WAS A CLONE OF DPKCS276 WITH CHANGES TO MAKE IT        00086000
000870* WORK FOR PREPACK (CONVERTS UNITS INTO PACKS).                   00087000
000880*                                                                 00088000
000890******************************************************************00089000
000900******************************************************************00090000
001000* CHANGE HISTORY                                                 *00100000
001100*    CHANGES                                                     *00110000
001200*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)               *00120000
001300*     DATE:    10/15/2014                                        *00130000
001310*                                                                *00131000
001320*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO#  *00132000
001330*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/15/2014     *00133000
001340******************************************************************00134000
001350 ENVIRONMENT DIVISION.                                            00135000
001360 CONFIGURATION SECTION.                                           00136000
001370                                                                  00137000
001380 SOURCE-COMPUTER.        IBM-3090.                                00138000
001390 OBJECT-COMPUTER.        IBM-3090.                                00139000
001400                                                                  00140000
001500******************************************************************00150000
001600 DATA DIVISION.                                                   00160000
001700 WORKING-STORAGE SECTION.                                         00170000
001800                                                                  00180000
001900 01  COUNTERS-AND-STUFF.                                          00190000
002000     05  PV-APP-LINE-NBR         PIC S9(9) COMP VALUE ZERO.       00200000
002100     05  PV-PURITM-RATO-QTY      PIC S9(4) COMP VALUE ZERO.       00210000
002200     05  PV-RECITM-RATO-QTY      PIC S9(4) COMP VALUE ZERO.       00220000
002300     05  PV-ALLPLN-SPLIT-QTY-PK  PIC S9(4) COMP VALUE ZERO.       00230000
002400     05  PV-RECEIVED-QTY         PIC S9(9) COMP VALUE ZERO.       00240000
002500     05  PV-RECEIVED-DRV-QTY     PIC S9(9) COMP VALUE ZERO.       00250000
002600     05  PV-RECEIVED-QTY-PK      PIC S9(9) COMP VALUE ZERO.       00260000
002700     05  PV-SUM-QTY              PIC S9(9) COMP VALUE ZERO.       00270000
002800*PS 10/15/2014 CHANGE STARTS                                      00280000
002900     05  PV-DISP-PO-NBR          PIC 9(8).                        00290000
003000*PS 10/15/2014 CHANGE ENDS                                        00300000
003100     05  PV-DISP-REC-SEQ-NBR     PIC 9(4).                        00310000
003200     05  PV-DISP-PO-LNE-NBR      PIC 9(3).                        00320000
003300     05  PV-DISP-OPER-UNT-ID     PIC 9(4).                        00330000
003400     05  PV-DISP-FCLTY-ID        PIC 9(4).                        00340000
003410     05  PV-DISP-PREPK           PIC 9(4).                        00341007
003500     05  PV-DISP-STR-NBR         PIC 9(4).                        00350000
003510     05  PV-DISP-SQL             PIC -999.                        00351002
003520     05  PV-DISP-TBL-IDX         PIC 9999.                        00352003
003530     05  PV-DISP-TABLE-IDX       PIC S9(04) COMP.                 00353006
003540     05  PV-DISP-DISTRO          PIC  Z(09).                      00354006
003600     05  PV-RETURN-MSG           PIC X(40).                       00360004
003700     05  PV-SQLCODE              PIC S9(9) COMP-4.                00370000
003800     05  PV-DISPLAY-SQLCODE      PIC -Z(8)9.                      00380000
003900     05  PV-DISPLAY-QTY          PIC Z(4)9.                       00390000
004000     05  PV-MESSAGE-TEXT         PIC X(79).                       00400000
004100                                                                  00410000
004200 01  PROGRAM-SWITCHES.                                            00420000
004300     05  PS-ERRORS-SW                 PIC  X    VALUE 'N'.        00430000
004400         88  PS-ERRORS-NO                       VALUE 'N'.        00440000
004500         88  PS-ERRORS-YES                      VALUE 'Y'.        00450000
004600     05  PS-EOF-PLAN-CSR-SW           PIC  X    VALUE 'N'.        00460000
004700         88  PS-EOF-PLAN-CSR                    VALUE 'Y'.        00470000
004800     05  PS-EOF-BASE-CSR-SW           PIC  X    VALUE 'N'.        00480000
004900         88  PS-EOF-BASE-CSR                    VALUE 'Y'.        00490000
005000     05  PS-PRIOR-CURSOR-SW           PIC  X    VALUE 'N'.        00500000
005100         88  PS-PRIOR-CURSOR-START              VALUE 'N'.        00510000
005200         88  PS-PRIOR-CURSOR-EOF                VALUE 'Y'.        00520000
005300     05  PS-CURSOR-SW                 PIC  X    VALUE 'N'.        00530000
005400         88  PS-CURSOR-CLOSED                   VALUE 'N'.        00540000
005500         88  PS-CURSOR-OPEN                     VALUE 'Y'.        00550000
005600     05  PS-LINE-DISTRO-SW            PIC  X    VALUE 'Y'.        00560000
005700         88  PS-LINE-HAS-DISTRO-YES             VALUE 'Y'.        00570000
005800         88  PS-LINE-HAS-DISTRO-NO              VALUE 'N'.        00580000
005900     05  PS-PACK-DISTRO-SW            PIC  X    VALUE 'N'.        00590000
006000         88  PS-PACK-DISTRO-INVALID             VALUE 'Y'.        00600000
006100         88  PS-PACK-DISTRO-VALID               VALUE 'N'.        00610000
006200     05  PS-HAVE-DRV-QTY-SW           PIC  X    VALUE 'N'.        00620000
006300         88  PS-HAVE-DRV-QTY-YES                VALUE 'Y'.        00630000
006400         88  PS-HAVE-DRV-QTY-NO                 VALUE 'N'.        00640000
006500     05  PS-DRIVER-LINE-SW            PIC  X    VALUE 'N'.        00650000
006600         88  PS-NO-DRIVER-LINE                  VALUE 'N'.        00660000
006610         88  PS-DRIVER-LINE                     VALUE 'Y'.        00661000
006620                                                                  00662000
006630 01  PROGRAM-KEYS.                                                00663000
006640     05  DK-PO-NBR               PIC S9(9) COMP VALUE ZERO.       00664000
006650     05  DK-LINE-NBR             PIC S9(9) COMP VALUE ZERO.       00665000
006660     05  DK-DRIVER-LINE-NBR      PIC S9(9) COMP VALUE ZERO.       00666000
006670     05  DK-PO-PREPK-ID          PIC S9(4) COMP VALUE ZERO.       00667000
006680     05  DK-STAT-CDE-AP          PIC  X(02)  VALUE 'AP'.          00668000
006690     05  DK-STAT-CDE-AC          PIC  X(02)  VALUE 'AC'.          00669000
006700     05  DK-STAT-CDE-CM          PIC  X(02)  VALUE 'CM'.          00670000
006800     05  DK-STAT-CDE-RV          PIC  X(02)  VALUE 'RV'.          00680000
006900                                                                  00690000
007000 01  PROGRAM-LITERALS.                                            00700000
007100     05  PC-CURRENT-PROGRAM-NAME PIC X(8)  VALUE 'TMKUT019'.      00710000
007200     05  PC-A                    PIC X     VALUE 'A'.             00720000
007300     05  PC-Y                    PIC X     VALUE 'Y'.             00730000
007400     05  PC-AC                   PIC X(2)  VALUE 'AC'.            00740000
007500     05  PC-IP                   PIC X(2)  VALUE 'IP'.            00750000
007600     05  PC-CM                   PIC X(2)  VALUE 'CM'.            00760000
007700     05  PC-VE                   PIC X(2)  VALUE 'VE'.            00770000
007800     05  PC-SHORT-ONE            PIC S9(4) COMP VALUE +1.         00780000
007900     05  PC-MAX-OCCUR-LNE        PIC S9(3) VALUE +100             00790000
008000                                                COMP-3.           00800000
008100     05  PC-MAX-OCCUR-STR        PIC S9(3) VALUE +250             00810000
008200                                                COMP-3.           00820000
008300     05  PC-NULL-TMST            PIC X(26) VALUE                  00830000
008400                       '0001-01-01-00.00.00.000000'.              00840000
008500     05  PC-TSYMSG-00551         PIC  9(05)  VALUE 00551.         00850000
008600     05  PC-TSYMSG-01096         PIC  9(05)  VALUE 01096.         00860000
008700                                                                  00870000
008800/*****************************************************************00880000
008900     COPY DPWS277.                                                00890000
009000                                                                  00900000
009100* ERROR DATA PASSED BACK UPSTREAM.                                00910000
009200     COPY TMRD007.                                                00920000
009300                                                                  00930000
009400/*****************************************************************00940000
009500*    DB2 SQL COMMUNICATION AREA                                   00950000
009600******************************************************************00960000
009700     EXEC SQL                                                     00970000
009800          INCLUDE SQLCA                                           00980000
009900     END-EXEC.                                                    00990000
010000                                                                  01000000
010100******************************************************************01010000
010200*    DB2 DCLGEN FOR MERCHANDISE STORE ALLOCATION PLAN TABLE       01020000
010300******************************************************************01030000
010400     EXEC SQL                                                     01040000
010500          INCLUDE TALLPLN                                         01050000
010600     END-EXEC.                                                    01060000
010700                                                                  01070000
010800******************************************************************01080000
010900*    DB2 DCLGEN FOR MERCHANDISE STORE DISTRIBUTION PLAN TABLE     01090000
011000******************************************************************01100000
011100     EXEC SQL                                                     01110000
011200          INCLUDE TMESTDS                                         01120000
011300     END-EXEC.                                                    01130000
011400                                                                  01140000
011500******************************************************************01150000
011600*    DB2 DCLGEN FOR SPECIFIC PLAN                                 01160000
011700******************************************************************01170000
011800     EXEC SQL                                                     01180000
011900          INCLUDE TSPSTDS                                         01190000
012000     END-EXEC.                                                    01200000
012100                                                                  01210000
012200******************************************************************01220000
012300*    DB2 DCLGEN FOR PO PURCHASE ITEM TABLE (PO LINE ITEMS)        01230000
012400******************************************************************01240000
012500     EXEC SQL                                                     01250000
012600          INCLUDE TPURITM                                         01260000
012700     END-EXEC.                                                    01270000
012800                                                                  01280000
012900******************************************************************01290000
013000*    DB2 DCLGEN FOR RECEIVER TABLE                                01300000
013100******************************************************************01310000
013200     EXEC SQL                                                     01320000
013300          INCLUDE TRECEIV                                         01330000
013400     END-EXEC.                                                    01340000
013500                                                                  01350000
013600******************************************************************01360000
013700*    DB2 DCLGEN FOR RECEIVER ITEM                                 01370000
013800******************************************************************01380000
013900     EXEC SQL                                                     01390000
014000          INCLUDE TRECITM                                         01400000
014100     END-EXEC.                                                    01410000
014200                                                                  01420000
014300******************************************************************01430000
014400*    DB2 DCLGEN FOR RECEIVE DISTRIBUTION TABLE                    01440000
014500******************************************************************01450000
014600     EXEC SQL                                                     01460000
014700          INCLUDE TRECDIS                                         01470000
014800     END-EXEC.                                                    01480000
014900                                                                  01490000
015000******************************************************************01500000
015100*                   BASE NUMBER CURSORS                           01510000
015200*                 ************************                        01520000
015300*    THESE CURSORS ARE USED TO POPULATE                           01530000
015400*    DP277-STORE-NBR OR DP277-LNE-NBR                             01540000
015500*    AND DP277-STR-DISTRO-QTY FOR EACH STORE OR LINE.             01550000
015600*    SUBTRACTING ALL RECEIPTS FROM THIS WILL GIVE THE OTR.        01560000
015700******************************************************************01570000
015800                                                                  01580000
015900** THIS CURSOR IS THE BASIS FOR MASTER PLAN (STORE-LEVEL-OTR)     01590000
016000     EXEC SQL                                                     01600000
016100         DECLARE STORE-TABLE-CSR CURSOR FOR                       01610000
016200          SELECT STR_NBR                                          01620000
016300               , STR_DISTRO_QTY                                   01630000
016400               , ALLOC_SEQ_CDE                                    01640000
016500               , RNK_SEQ_NBR                                      01650000
016600               , STR_CNSTR_CDE                                    01660000
016700               , STR_CNSTR_QTY                                    01670000
016800            FROM TMESTDS                                          01680000
016900           WHERE PO_NBR     = :DP277-PO-NBR                       01690000
017000             AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                  01700000
017100             AND PLAN_NBR   = :ALLPLN-PLAN-NBR                    01710000
017200           ORDER BY STR_NBR                                       01720000
017300     END-EXEC.                                                    01730000
017400                                                                  01740000
017500** THIS CURSOR IS THE BASIS FOR SPECIFIC PLAN (STORE-LEVEL-OTR)   01750000
017600     EXEC SQL                                                     01760000
017700         DECLARE SPSTDS-CSR CURSOR FOR                            01770000
017800          SELECT STR_NBR                                          01780000
017900               , STR_DISTRO_QTY                                   01790000
017910            FROM TSPSTDS                                          01791000
017920           WHERE PO_NBR     = :DP277-PO-NBR                       01792000
017930             AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                  01793000
017940             AND PLAN_NBR   = :ALLPLN-PLAN-NBR                    01794000
017950           ORDER BY STR_NBR                                       01795000
017960     END-EXEC.                                                    01796000
017970                                                                  01797000
017980** THIS CURSOR IS THE BASIS FOR DP277-LINE-TABLE (LINE-LEVEL-OTR) 01798000
017990     EXEC SQL                                                     01799000
018000         DECLARE PLAN-CSR CURSOR FOR                              01800000
018100          SELECT A.PO_LNE_NBR                                     01810000
018200               , A.APP_PO_LNE_NBR                                 01820000
018300               , A.PREPK_RATO_QTY                                 01830000
018400            FROM TPURITM A                                        01840000
018500                ,TRECITM B                                        01850000
018600           WHERE  A.PO_NBR          = :DP277-PO-NBR               01860000
018700             AND  B.ORD_NBR         = A.PO_NBR                    01870000
018800             AND  B.ORD_LNE_NBR     = A.APP_PO_LNE_NBR            01880000
018900             AND  OPER_UNT_ID       = :DP277-OPER-UNT-ID          01890000
019000             AND  REC_SEQ_NBR       = :DP277-REC-SEQ-NBR          01900000
019100             AND  B.PREPK_ID        = :DK-PO-PREPK-ID             01910000
019200             AND  A.VER_STATUS_CDE  = :PC-A                       01920000
019300             AND  B.VER_STATUS_CDE  = :PC-A                       01930000
019400             AND  (A.STATUS_CDE     = :DK-STAT-CDE-AP             01940000
019500              OR   A.STATUS_CDE     = :DK-STAT-CDE-CM             01950000
019600              OR   A.STATUS_CDE     = :DK-STAT-CDE-RV             01960000
019700              OR   A.STATUS_CDE     = :DK-STAT-CDE-AC)            01970000
019800     END-EXEC.                                                    01980000
019900** THIS CURSOR IS THE BASIS FOR DP277-LINE-TABLE (LINE-LEVEL-OTR) 01990000
020000     EXEC SQL                                                     02000000
020100         DECLARE PLAN-LINE-CSR CURSOR FOR                         02010000
020200          SELECT A.PO_LNE_NBR                                     02020000
020300               , A.APP_PO_LNE_NBR                                 02030000
020400               , A.PREPK_RATO_QTY                                 02040000
020500            FROM TPURITM A                                        02050000
020600           WHERE  A.PO_NBR          = :DP277-PO-NBR               02060000
020610             AND  A.APP_PO_LNE_NBR  = :DP277-PO-LNE-NBR           02061000
020620             AND  A.VER_STATUS_CDE  = :PC-A                       02062000
020630             AND  (A.STATUS_CDE     = :DK-STAT-CDE-AP             02063000
020640              OR   A.STATUS_CDE     = :DK-STAT-CDE-CM             02064000
020650              OR   A.STATUS_CDE     = :DK-STAT-CDE-RV             02065000
020660              OR   A.STATUS_CDE     = :DK-STAT-CDE-AC)            02066000
020670     END-EXEC.                                                    02067000
020680                                                                  02068000
020690******************************************************************02069000
020700*                     RECEIPT CURSORS                             02070000
020800*                 ************************                        02080000
020900*    THESE CURSORS ARE USED TO RETRIEVE THE PRIOR RECEIPTS        02090000
021000*    TO BE SUBTRACTED FROM DP277-STORE-OTR-QTY.                   02100000
021100*                                                                 02110000
021200*    'RECEIVER-LEVEL' PRIOR RECEIPTS ARE DEFINED AS ANY 'VE'      02120000
021300*    RECEIPT OR 'IP'/'CM' RECEIPT CREATED PRIOR TO THE GIVEN      02130000
021400*    RECEIVER.                                                    02140000
021500*                                                                 02150000
021600*    'PO-LEVEL' PRIOR RECEIPTS INCLUDE ALL RECEIPTS INCLUDING     02160000
021700*    THE GIVEN RECEIVER.                                          02170000
021800*                                                                 02180000
021900******************************************************************02190000
022000                                                                  02200000
022100******************************************************************02210000
022200*    RECEIVER-LEVEL CURSOR                                        02220000
022300*    THIS IS A LIST OF RECEIVERS FOR A PO, LINE, AND DC THAT      02230000
022400*    ARE EITHER VERIFIED OR HAD BEEN CREATED PRIOR TO THE         02240000
022500*    CURRENT DATE AND TIME.  USED IN PARAGRAPH 1300-              02250000
022600******************************************************************02260000
022700     EXEC SQL                                                     02270000
022800         DECLARE REC-LVL-CSR CURSOR FOR                           02280000
022900          SELECT REC_SEQ_NBR                                      02290000
023000               , STATUS_CDE                                       02300000
023100            FROM TRECITM                                          02310000
023200           WHERE ORD_NBR         = :DP277-PO-NBR                  02320000
023300             AND ORD_LNE_NBR     = :DK-LINE-NBR                   02330000
023400             AND OPER_UNT_ID     = :DP277-OPER-UNT-ID             02340000
023500             AND REC_SEQ_NBR    ^= :DP277-REC-SEQ-NBR             02350000
023600             AND VER_STATUS_CDE  = :PC-A                          02360000
023700             AND (CRE_TMST       < :RECITM-CRE-TMST               02370000
023800              OR  CRE_TMST       = :RECITM-CRE-TMST               02380000
023900              OR  STATUS_CDE     = :PC-VE)                        02390000
024000           ORDER BY 1                                             02400000
024100     END-EXEC.                                                    02410000
024200                                                                  02420000
024300******************************************************************02430000
024400*    PO-LEVEL CURSOR                                              02440000
024500*    THIS IS A LIST OF RECEIVERS AND THEIR STATUSES FOR A         02450000
024600*    PO, LINE AND DC REGARDLESS OF CREATION TIME.                 02460000
024700******************************************************************02470000
024800     EXEC SQL                                                     02480000
024900         DECLARE PO-LVL-CSR CURSOR FOR                            02490000
025000          SELECT REC_SEQ_NBR                                      02500000
025100               , STATUS_CDE                                       02510000
025200            FROM TRECITM                                          02520000
025300           WHERE ORD_NBR         = :DP277-PO-NBR                  02530000
025400             AND ORD_LNE_NBR     = :DK-LINE-NBR                   02540000
025500             AND OPER_UNT_ID     = :DP277-OPER-UNT-ID             02550000
025600             AND VER_STATUS_CDE  = :PC-A                          02560000
025700             AND STATUS_CDE     IN (:PC-IP, :PC-CM, :PC-VE)       02570000
025800           ORDER BY 1                                             02580000
025900     END-EXEC.                                                    02590000
026000                                                                  02600000
026100/*****************************************************************02610000
026200 LINKAGE SECTION.                                                 02620000
026300                                                                  02630000
026400 01  LINK-COMMAREA                    PIC X(20498).               02640000
026500 01  LINK-TMRD007                     PIC X(800).                 02650000
026600                                                                  02660000
026700/*****************************************************************02670000
026800******************************************************************02680000
026900 PROCEDURE DIVISION USING LINK-COMMAREA                           02690000
027000                          LINK-TMRD007.                           02700000
027100                                                                  02710000
027200     PERFORM 0001-HOUSEKEEPING.                                   02720000
027300                                                                  02730000
027400     EVALUATE TRUE                                                02740000
027500       WHEN DP277-STORE-LEVEL-OTR                                 02750000
027600           PERFORM 1000-STORE-LEVEL-OTR                           02760000
027700                                                                  02770000
027800       WHEN DP277-LINE-LEVEL-OTR                                  02780000
027900           PERFORM 2000-LINE-LEVEL-OTR                            02790000
028000                                                                  02800000
028100       WHEN OTHER                                                 02810000
028200           STRING ' INVALID OTR TYPE (' DP277-OTR-TYPE ')'        02820000
028300                  DELIMITED BY SIZE INTO PV-RETURN-MSG            02830000
028400           MOVE 1 TO DP277-RETURN-CODE                            02840000
028500           DISPLAY ' TMKUT019 ERROR MESSAGE'                      02850000
028600           DISPLAY PV-RETURN-MSG                                  02860000
028700           STRING ' INVALID OTR TYPE (' DP277-OTR-TYPE ')'        02870000
028710                  DELIMITED BY SIZE INTO TM007-RETURN-MSG         02871000
028720           MOVE '01'   TO TM007-RETURN-CODE                       02872000
028730           MOVE ZERO   TO TM007-SQLCODE                           02873000
028740           MOVE SPACES TO TM007-SQLCA                             02874000
028750           MOVE '0000' TO TM007-RETURNED-PARA                     02875000
028760           PERFORM 9999-GOBACK                                    02876000
028770     END-EVALUATE.                                                02877000
028780                                                                  02878000
028790     PERFORM VARYING DP277-STR-IDX FROM 1 BY 1                    02879000
028800       UNTIL DP277-STORE-NBR(DP277-STR-IDX) = ZERO                02880000
028900        OR DP277-STR-IDX > PC-MAX-OCCUR-STR                       02890000
029000         MOVE DP277-STR-OTR-QTY(DP277-STR-IDX)                    02900000
029100              TO DP277-STR-DISTRO-OTR(DP277-STR-IDX)              02910000
029200         IF DP277-STR-OTR-QTY(DP277-STR-IDX) < ZERO               02920000
029300             MOVE ZERO TO DP277-STR-OTR-QTY(DP277-STR-IDX)        02930000
029400         END-IF                                                   02940000
029500     END-PERFORM.                                                 02950000
029600                                                                  02960000
029700     PERFORM VARYING DP277-LNE-IDX FROM 1 BY 1                    02970000
029800       UNTIL DP277-LNE-NBR(DP277-LNE-IDX) = ZERO                  02980000
029900        OR DP277-LNE-IDX > PC-MAX-OCCUR-LNE                       02990000
030000         MOVE DP277-LNE-OTR-QTY(DP277-LNE-IDX)                    03000000
030100                   TO DP277-LNE-DISTRO-OTR(DP277-LNE-IDX)         03010000
030200         IF DP277-LNE-OTR-QTY(DP277-LNE-IDX) < ZERO               03020000
030300             MOVE ZERO TO DP277-LNE-OTR-QTY(DP277-LNE-IDX)        03030000
030400         END-IF                                                   03040000
030500     END-PERFORM.                                                 03050000
030600                                                                  03060000
030700     PERFORM 9999-GOBACK.                                         03070000
030800                                                                  03080000
030900                                                                  03090000
031000******************************************************************03100000
031100******************************************************************03110000
031200 0001-HOUSEKEEPING.                                               03120000
031300                                                                  03130000
031400     MOVE LINK-COMMAREA TO DP277-COMMAREA.                        03140000
031500     MOVE LINK-TMRD007  TO TM007-COMMUNICATIONS-AREA.             03150000
031600     MOVE PC-CURRENT-PROGRAM-NAME                                 03160000
031700                        TO TM007-CALLED-MODULE                    03170000
031800                                                                  03180000
031900     INITIALIZE DP277-LINE-TABLE                                  03190000
032000                DP277-STORE-TABLE                                 03200000
032100                DP277-RETURN-DATA.                                03210000
032101                                                                  03210109
032120     MOVE 'N'  TO   PS-ERRORS-SW                                  03212010
032140                    PS-EOF-PLAN-CSR-SW                            03214009
032160                    PS-EOF-BASE-CSR-SW                            03216009
032180                    PS-PRIOR-CURSOR-SW                            03218009
032192                    PS-CURSOR-SW                                  03219209
032198                    PS-PACK-DISTRO-SW                             03219809
032201                    PS-HAVE-DRV-QTY-SW                            03220109
032204                    PS-DRIVER-LINE-SW.                            03220409
032205     MOVE 'Y'  TO   PS-LINE-DISTRO-SW.                            03220509
032210                                                                  03221000
032300******************************************************************03230000
032400******************************************************************03240000
032500 1000-STORE-LEVEL-OTR.                                            03250000
032600                                                                  03260000
032700     MOVE DP277-PO-NBR      TO DK-PO-NBR.                         03270000
032800     MOVE DP277-PO-LNE-NBR  TO DK-LINE-NBR.                       03280000
032900     MOVE DP277-PO-PREPK-ID TO DK-PO-PREPK-ID.                    03290000
033000                                                                  03300000
033100*GET PURITM LINE NUMBER.                                          03310000
033200     PERFORM 1120-GET-TPURITM-RECORD.                             03320000
033300                                                                  03330000
033400     MOVE PURITM-PO-LNE-NBR TO DK-LINE-NBR.                       03340000
033500                                                                  03350000
033600*GET APPROVED LINE NUMBER.                                        03360000
033700     PERFORM 1100-GET-APP-LINE-NBR.                               03370000
033800                                                                  03380000
033900*GET PLAN.                                                        03390000
034000     IF PS-ERRORS-NO                                              03400000
034100         PERFORM 1110-GET-TALLPLN                                 03410000
034200     ELSE                                                         03420000
034300         INITIALIZE DCLTALLPLN                                    03430000
034400                    PV-ALLPLN-SPLIT-QTY-PK                        03440000
034500     END-IF.                                                      03450000
034600                                                                  03460000
034700     MOVE ALLPLN-CURR-SPLIT-QTY       TO DP277-CURR-SPLIT-QTY     03470000
034800     MOVE PV-ALLPLN-SPLIT-QTY-PK      TO DP277-CURR-SPLIT-PK      03480000
034810*DP277-DISTRO-REQ-ID COMES FROM CHECKS OF TMESTDS.RNK_SEQ_NBR.    03481000
034811*IF ANY RNK_SEQ_NBR IN THE 1200-FILL-BASE-NUMBERS PROCESSING      03481100
034812*EQUALS ZERO, IT WILL OVERLAY THE DEFAULT OF 1.                   03481200
034813*RMS OBSOLETES TALLPLN.DISTRO_REQ_ID                              03481300
034814*    MOVE ALLPLN-DISTRO-REQ-ID        TO DP277-DISTRO-REQ-ID      03481400
034815     MOVE +1                          TO DP277-DISTRO-REQ-ID      03481500
034816     MOVE ALLPLN-ALLOC-OUTR-PK-QTY    TO DP277-ALLOC-OUTR-PK-QTY  03481600
034817     MOVE ALLPLN-PK-SIZE-RND-CDE      TO DP277-PK-SIZE-RND-CDE    03481700
034818                                                                  03481800
034819*MOVE ORIGINAL LINE NUMBER BACK INTO KEY.                         03481900
034820     MOVE DP277-PO-LNE-NBR  TO DK-LINE-NBR.                       03482000
034830*LOAD STORE TABLE.                                                03483000
034840     IF PS-ERRORS-NO                                              03484000
034850         PERFORM 1200-FILL-BASE-NUMBERS                           03485000
034860     END-IF.                                                      03486000
034870                                                                  03487000
034880*DETERMINE OTR.                                                   03488000
034890     IF PS-ERRORS-NO AND DP277-MASTER-PLAN                        03489000
034900       AND PS-LINE-HAS-DISTRO-YES                                 03490000
035000                                                                  03500000
035100         EVALUATE TRUE                                            03510000
035200           WHEN DP277-RECEIVER-OTR                                03520000
035300               PERFORM 1300-RCVR-OTR                              03530000
035400                                                                  03540000
035500           WHEN DP277-PO-OTR                                      03550000
035600               PERFORM 1400-PO-OTR                                03560000
035700                                                                  03570000
035800           WHEN OTHER                                             03580000
035900               STRING ' INVALID OTR SCOPE FLAG ('                 03590000
036000                      DP277-OTR-SCOPE ')' DELIMITED BY SIZE       03600000
036100                      INTO PV-RETURN-MSG                          03610000
036200               MOVE 2 TO DP277-RETURN-CODE                        03620000
036300               DISPLAY ' TMKUT019 ERROR MESSAGE'                  03630000
036400               DISPLAY PV-RETURN-MSG                              03640000
036500               MOVE '02'   TO TM007-RETURN-CODE                   03650000
036600               MOVE ZERO   TO TM007-SQLCODE                       03660000
036700               MOVE SPACES TO TM007-SQLCA                         03670000
036800               MOVE '1000' TO TM007-RETURNED-PARA                 03680000
036900               PERFORM 9999-GOBACK                                03690000
037000         END-EVALUATE                                             03700000
037100     END-IF.                                                      03710000
037200                                                                  03720000
037300******************************************************************03730000
037400*  THE APP LINE NUMBER MAY NOT BE THE SAME AS THE KEY LINE        03740000
037500*  NUMBER DUE TO PO LINES BEING DELETED.  THE RECEIVING SYSTEM    03750000
037600*  IS KEYED BY THE APPROVED LINE NUMBER.  THE PO SYSTEM IS KEYED  03760000
037700*  BY THE LINE NUMBER IN THE KEY.                                 03770000
037800******************************************************************03780000
037900 1100-GET-APP-LINE-NBR.                                           03790000
038000                                                                  03800000
038100     EXEC SQL                                                     03810000
038200         SELECT A.APP_PO_LNE_NBR                                  03820000
038300              , A.PREPK_RATO_QTY                                  03830000
038400           INTO :PV-APP-LINE-NBR                                  03840000
038500              , :PV-PURITM-RATO-QTY                               03850000
038600           FROM TPURITM A                                         03860000
038700          WHERE A.PO_NBR         = :DK-PO-NBR                     03870000
038800            AND A.PO_LNE_NBR     = :DK-LINE-NBR                   03880000
038900            AND A.PO_PREPK_ID    = :DK-PO-PREPK-ID                03890000
039000            AND A.VER_STATUS_CDE = :PC-A                          03900000
039100     END-EXEC.                                                    03910000
039200                                                                  03920000
039300     EVALUATE TRUE                                                03930000
039400       WHEN SQLCODE = ZERO                                        03940000
039500           CONTINUE                                               03950000
039600                                                                  03960000
039700       WHEN SQLCODE = -904                                        03970000
039800       WHEN SQLCODE = -911                                        03980000
039900       WHEN SQLCODE = -913                                        03990000
040000           MOVE 3  TO DP277-RETURN-CODE                           04000000
040100           MOVE '03'    TO TM007-RETURN-CODE                      04010000
040200           MOVE SQLCODE TO TM007-SQLCODE                          04020000
040300           MOVE SQLCA   TO TM007-SQLCA                            04030000
040400           MOVE '1100'  TO TM007-RETURNED-PARA                    04040000
040500           PERFORM 9900-SOFT-ABORT                                04050000
040600                                                                  04060000
040700       WHEN OTHER                                                 04070000
040800           MOVE 4  TO DP277-RETURN-CODE                           04080000
040900           MOVE '04'    TO TM007-RETURN-CODE                      04090000
041000           MOVE SQLCODE TO TM007-SQLCODE                          04100000
041100           MOVE SQLCA   TO TM007-SQLCA                            04110000
041200           MOVE '1100'  TO TM007-RETURNED-PARA                    04120000
041300           PERFORM 9800-PGM-ABEND                                 04130000
041400     END-EVALUATE.                                                04140000
041500                                                                  04150000
041600******************************************************************04160000
041700******************************************************************04170000
041800 1110-GET-TALLPLN.                                                04180000
041900                                                                  04190000
042000     INITIALIZE DCLTALLPLN                                        04200000
042100     EXEC SQL                                                     04210000
042200         SELECT PLAN_NBR                                          04220000
042300              , CURR_SPLIT_QTY                                    04230000
042400              , DISTRO_REQ_ID                                     04240000
042500              , ALLOC_OUTR_PK_QTY                                 04250000
042600              , PK_SIZE_RND_CDE                                   04260000
042700           INTO :ALLPLN-PLAN-NBR                                  04270000
042800              , :ALLPLN-CURR-SPLIT-QTY                            04280000
042900              , :ALLPLN-DISTRO-REQ-ID                             04290000
043000              , :ALLPLN-ALLOC-OUTR-PK-QTY                         04300000
043100              , :ALLPLN-PK-SIZE-RND-CDE                           04310000
043200           FROM TALLPLN                                           04320000
043300          WHERE PO_NBR     = :DK-PO-NBR                           04330000
043400            AND PO_LNE_NBR = :DK-LINE-NBR                         04340000
043500            AND DEST_NBR   = :DP277-OPER-UNT-ID                   04350000
043600     END-EXEC.                                                    04360000
043700                                                                  04370000
043800     EVALUATE TRUE                                                04380000
043900       WHEN SQLCODE = ZERO                                        04390000
044000           SET PS-LINE-HAS-DISTRO-YES TO TRUE                     04400000
044100*CALCULATE PACKS FROM UNITS.                                      04410000
044200           IF PV-PURITM-RATO-QTY > +0                             04420000
044300               SET  PS-PACK-DISTRO-VALID TO TRUE                  04430000
044400               DIVIDE ALLPLN-CURR-SPLIT-QTY                       04440000
044500                   BY PV-PURITM-RATO-QTY                          04450000
044600               GIVING PV-ALLPLN-SPLIT-QTY-PK                      04460000
044700           ELSE                                                   04470000
044800               MOVE 0 TO PV-ALLPLN-SPLIT-QTY-PK                   04480000
044900               SET  PS-PACK-DISTRO-INVALID TO TRUE                04490000
045000           END-IF                                                 04500000
045100                                                                  04510000
045200       WHEN SQLCODE = +100                                        04520000
045300           SET PS-LINE-HAS-DISTRO-NO TO TRUE                      04530000
045400           MOVE 5 TO DP277-RETURN-CODE                            04540000
045500           PERFORM 9000-NO-DISTRO-ERROR                           04550000
045600                                                                  04560000
045700       WHEN SQLCODE = -904                                        04570000
045800       WHEN SQLCODE = -911                                        04580000
045900       WHEN SQLCODE = -913                                        04590000
046000           MOVE 6 TO DP277-RETURN-CODE                            04600000
046100           MOVE '06'    TO TM007-RETURN-CODE                      04610000
046200           MOVE SQLCODE TO TM007-SQLCODE                          04620000
046210           MOVE SQLCA   TO TM007-SQLCA                            04621000
046220           MOVE '1110'  TO TM007-RETURNED-PARA                    04622000
046230           PERFORM 9900-SOFT-ABORT                                04623000
046240                                                                  04624000
046250       WHEN OTHER                                                 04625000
046260           MOVE 7 TO DP277-RETURN-CODE                            04626000
046270           MOVE '07'    TO TM007-RETURN-CODE                      04627000
046280           MOVE SQLCODE TO TM007-SQLCODE                          04628000
046290           MOVE SQLCA   TO TM007-SQLCA                            04629000
046300           MOVE '1110'  TO TM007-RETURNED-PARA                    04630000
046400           PERFORM 9800-PGM-ABEND                                 04640000
046500     END-EVALUATE.                                                04650000
046600                                                                  04660000
046700 1120-GET-TPURITM-RECORD.                                         04670000
046706                                                                  04670601
046707******************************************************************04670700
046708*    THIS PARAGRAPH RETRIEVES A RECORD FROM TABLE TPURITM.        04670800
046709******************************************************************04670900
046710                                                                  04671000
046711         EXEC SQL                                                 04671100
046712              SELECT PO_LNE_NBR                                   04671200
046713                INTO :PURITM-PO-LNE-NBR                           04671300
046714                FROM TPURITM                                      04671400
046715               WHERE PO_NBR         = :DK-PO-NBR                  04671500
046716                 AND APP_PO_LNE_NBR = :DK-LINE-NBR                04671600
046717                 AND VER_STATUS_CDE = :PC-A                       04671700
046718         END-EXEC                                                 04671800
046719                                                                  04671900
046720         EVALUATE TRUE                                            04672000
046721             WHEN SQLCODE = +0                                    04672100
046722                  CONTINUE                                        04672200
046723                                                                  04672300
046724             WHEN SQLCODE = -904                                  04672400
046725             WHEN SQLCODE = -911                                  04672500
046726             WHEN SQLCODE = -913                                  04672600
046727                 MOVE 6 TO DP277-RETURN-CODE                      04672700
046728                 MOVE '06'    TO TM007-RETURN-CODE                04672800
046729                 MOVE SQLCODE TO TM007-SQLCODE                    04672900
046730                 MOVE SQLCA   TO TM007-SQLCA                      04673000
046731                 MOVE '1120'  TO TM007-RETURNED-PARA              04673100
046732                 PERFORM 9900-SOFT-ABORT                          04673200
046733                                                                  04673300
046734             WHEN OTHER                                           04673400
046735                 MOVE 7 TO DP277-RETURN-CODE                      04673500
046736                 MOVE '07'    TO TM007-RETURN-CODE                04673600
046737                 MOVE SQLCODE TO TM007-SQLCODE                    04673700
046738                 MOVE SQLCA   TO TM007-SQLCA                      04673800
046739                 MOVE '1120'  TO TM007-RETURNED-PARA              04673900
046740                 PERFORM 9800-PGM-ABEND                           04674000
046741         END-EVALUATE.                                            04674100
046742                                                                  04674200
046743******************************************************************04674300
046744******************************************************************04674400
046745 1200-FILL-BASE-NUMBERS.                                          04674500
046752                                                                  04675200
046753     PERFORM 1210-OPEN-STORE-TABLE-CSR.                           04675300
046760                                                                  04676000
046770*GET FIRST STORE TABLE ENTRY.                                     04677000
046780     IF PS-ERRORS-NO                                              04678000
046790       AND PS-LINE-HAS-DISTRO-YES                                 04679000
046800         PERFORM 1220-FETCH-STORE-TABLE-CSR                       04680000
046900         IF PS-EOF-BASE-CSR                                       04690000
047000             SET PS-ERRORS-YES                                    04700000
047100                 PS-LINE-HAS-DISTRO-NO TO TRUE                    04710000
047200             MOVE 0 TO DP277-DISTRO-REQ-ID                        04720000
047300             MOVE 8 TO DP277-RETURN-CODE                          04730000
047400             PERFORM 9000-NO-DISTRO-ERROR                         04740000
047500         END-IF                                                   04750000
047600     END-IF.                                                      04760000
047700                                                                  04770000
047800*LOOP THRU ALL MESTDS & LOAD TO TABLE.                            04780000
047900     IF PS-ERRORS-NO                                              04790000
048000       AND PS-LINE-HAS-DISTRO-YES                                 04800000
048100         PERFORM 1230-LOAD-TO-STR-TABLE                           04810000
048200           VARYING DP277-STR-IDX FROM 1 BY 1                      04820000
048300             UNTIL PS-EOF-BASE-CSR OR PS-ERRORS-YES               04830000
048400                OR DP277-STR-IDX > PC-MAX-OCCUR-STR               04840000
048500     END-IF.                                                      04850000
048600                                                                  04860000
048700     IF PS-CURSOR-OPEN                                            04870000
048800         PERFORM 1240-CLOSE-STORE-TABLE-CSR                       04880000
048900     END-IF.                                                      04890000
049000                                                                  04900000
049100******************************************************************04910000
049200******************************************************************04920000
049300 1210-OPEN-STORE-TABLE-CSR.                                       04930000
049400                                                                  04940000
049500     EVALUATE TRUE                                                04950000
049600       WHEN DP277-SPECIFIC-PLAN                                   04960000
049700         EXEC SQL                                                 04970000
049800             OPEN SPSTDS-CSR                                      04980000
049900         END-EXEC                                                 04990000
050000                                                                  05000000
050100       WHEN DP277-MASTER-PLAN                                     05010000
050200         EXEC SQL                                                 05020000
050300             OPEN STORE-TABLE-CSR                                 05030000
050400         END-EXEC                                                 05040000
050500                                                                  05050000
050600       WHEN OTHER                                                 05060000
050700           MOVE 9  TO DP277-RETURN-CODE                           05070000
050800           PERFORM 9000-NO-DISTRO-ERROR                           05080000
050900     END-EVALUATE.                                                05090000
051000                                                                  05100000
051100     EVALUATE TRUE                                                05110000
051200       WHEN SQLCODE = ZERO                                        05120000
051300           SET PS-CURSOR-OPEN TO TRUE                             05130000
051400                                                                  05140000
051500       WHEN SQLCODE = -904                                        05150000
051600       WHEN SQLCODE = -911                                        05160000
051700       WHEN SQLCODE = -913                                        05170000
051800           SET PS-CURSOR-CLOSED TO TRUE                           05180000
051900           MOVE 10 TO DP277-RETURN-CODE                           05190000
052000           MOVE '10'    TO TM007-RETURN-CODE                      05200000
052100           MOVE SQLCODE TO TM007-SQLCODE                          05210000
052110           MOVE SQLCA   TO TM007-SQLCA                            05211000
052120           MOVE '1210'  TO TM007-RETURNED-PARA                    05212000
052130           PERFORM 9900-SOFT-ABORT                                05213000
052140                                                                  05214000
052150       WHEN OTHER                                                 05215000
052160           SET PS-CURSOR-CLOSED TO TRUE                           05216000
052170           SET PS-LINE-HAS-DISTRO-NO TO TRUE                      05217000
052180           MOVE 11 TO DP277-RETURN-CODE                           05218000
052190           PERFORM 9000-NO-DISTRO-ERROR                           05219000
052200                                                                  05220000
052300     END-EVALUATE.                                                05230000
052400                                                                  05240000
052500******************************************************************05250000
052600******************************************************************05260000
052700 1220-FETCH-STORE-TABLE-CSR.                                      05270000
052800                                                                  05280000
052900     EVALUATE TRUE                                                05290000
053000       WHEN DP277-SPECIFIC-PLAN                                   05300000
053100         EXEC SQL                                                 05310000
053200             FETCH SPSTDS-CSR                                     05320000
053300              INTO :MESTDS-STR-NBR                                05330000
053400                 , :MESTDS-STR-DISTRO-QTY                         05340000
053500         END-EXEC                                                 05350000
053600                                                                  05360000
053700       WHEN DP277-MASTER-PLAN                                     05370000
053800         EXEC SQL                                                 05380000
053900             FETCH STORE-TABLE-CSR                                05390000
054000              INTO :MESTDS-STR-NBR                                05400000
054100                 , :MESTDS-STR-DISTRO-QTY                         05410000
054200                 , :MESTDS-ALLOC-SEQ-CDE                          05420000
054300                 , :MESTDS-RNK-SEQ-NBR                            05430000
054400                 , :MESTDS-STR-CNSTR-CDE                          05440000
054500                 , :MESTDS-STR-CNSTR-QTY                          05450000
054600         END-EXEC                                                 05460000
054700                                                                  05470000
054800       WHEN OTHER                                                 05480000
054900           MOVE 12 TO DP277-RETURN-CODE                           05490000
055000           PERFORM 9000-NO-DISTRO-ERROR                           05500000
055100     END-EVALUATE.                                                05510000
055200                                                                  05520000
055300     EVALUATE TRUE                                                05530000
055400       WHEN SQLCODE = ZERO                                        05540000
055500           IF MESTDS-RNK-SEQ-NBR = ZERO                           05550000
055600               MOVE MESTDS-RNK-SEQ-NBR TO DP277-DISTRO-REQ-ID     05560000
055700           END-IF                                                 05570000
055800                                                                  05580000
055900       WHEN SQLCODE = +100                                        05590000
056000           SET PS-EOF-BASE-CSR TO TRUE                            05600000
056100                                                                  05610000
056200       WHEN OTHER                                                 05620000
056300           MOVE 13 TO DP277-RETURN-CODE                           05630000
056400           PERFORM 9000-NO-DISTRO-ERROR                           05640000
056500           MOVE ZERO TO DP277-DISTRO-REQ-ID                       05650000
056600                                                                  05660000
056700     END-EVALUATE.                                                05670000
056800                                                                  05680000
056900******************************************************************05690000
057000******************************************************************05700000
057100 1230-LOAD-TO-STR-TABLE.                                          05710000
057200                                                                  05720000
057300     MOVE MESTDS-STR-NBR TO DP277-STORE-NBR(DP277-STR-IDX).       05730000
057400     MOVE MESTDS-ALLOC-SEQ-CDE                                    05740000
057500                         TO DP277-ALLOC-SEQ-CDE(DP277-STR-IDX).   05750000
057600     MOVE MESTDS-RNK-SEQ-NBR                                      05760000
057700                         TO DP277-RNK-SEQ-NBR(DP277-STR-IDX).     05770000
057800     MOVE MESTDS-STR-CNSTR-CDE                                    05780000
057900                         TO DP277-STR-CNSTR-CDE(DP277-STR-IDX).   05790000
058000     MOVE MESTDS-STR-CNSTR-QTY                                    05800000
058100                         TO DP277-STR-CNSTR-QTY(DP277-STR-IDX).   05810000
058200                                                                  05820000
058300     MOVE MESTDS-STR-DISTRO-QTY                                   05830000
058400                         TO DP277-STR-DISTRO-QTY(DP277-STR-IDX)   05840000
058500                            DP277-STR-OTR-QTY (DP277-STR-IDX)     05850000
058600                            PV-DISPLAY-QTY.                       05860000
058700     MOVE PV-DISPLAY-QTY TO DP277-STR-DISTRO-QTY-X(DP277-STR-IDX) 05870000
058800                            DP277-STR-OTR-QTY-X(DP277-STR-IDX).   05880000
058900                                                                  05890000
059000*CALCULATE PACKS FROM UNITS.                                      05900000
059100     IF PV-PURITM-RATO-QTY > +0                                   05910000
059200         DIVIDE MESTDS-STR-DISTRO-QTY                             05920000
059300             BY PV-PURITM-RATO-QTY                                05930000
059400         GIVING DP277-STR-DISTRO-PK(DP277-STR-IDX)                05940000
059500         MOVE DP277-STR-DISTRO-PK(DP277-STR-IDX)                  05950000
059600              TO DP277-STR-OTR-PK(DP277-STR-IDX)                  05960000
059700     END-IF.                                                      05970000
059800                                                                  05980000
059900     PERFORM 1220-FETCH-STORE-TABLE-CSR.                          05990000
060000                                                                  06000000
060100******************************************************************06010000
060200******************************************************************06020000
060300 1240-CLOSE-STORE-TABLE-CSR.                                      06030000
060400                                                                  06040000
060500     EVALUATE TRUE                                                06050000
060600       WHEN DP277-SPECIFIC-PLAN                                   06060000
060700         EXEC SQL                                                 06070000
060800             CLOSE SPSTDS-CSR                                     06080000
060900         END-EXEC                                                 06090000
061000                                                                  06100000
061100       WHEN DP277-MASTER-PLAN                                     06110000
061200         EXEC SQL                                                 06120000
061300             CLOSE STORE-TABLE-CSR                                06130000
061400         END-EXEC                                                 06140000
061500                                                                  06150000
061600       WHEN OTHER                                                 06160000
061700           MOVE 14 TO DP277-RETURN-CODE                           06170000
061800           PERFORM 9000-NO-DISTRO-ERROR                           06180000
061900     END-EVALUATE.                                                06190000
062000                                                                  06200000
062100     EVALUATE TRUE                                                06210000
062200       WHEN SQLCODE = ZERO                                        06220000
062300           SET PS-CURSOR-CLOSED TO TRUE                           06230000
062400                                                                  06240000
062500       WHEN OTHER                                                 06250000
062600           MOVE 15 TO DP277-RETURN-CODE                           06260000
062700           PERFORM 9000-NO-DISTRO-ERROR                           06270000
062800     END-EVALUATE.                                                06280000
062900                                                                  06290000
063000******************************************************************06300000
063100* RECEIVER OTR AT THE STORE LEVEL                                 06310000
063200******************************************************************06320000
063300 1300-RCVR-OTR.                                                   06330000
063400                                                                  06340000
063500     MOVE PV-APP-LINE-NBR TO DK-LINE-NBR                          06350000
063600     PERFORM 7000-GET-RECITM-TMST.                                06360000
063700                                                                  06370000
063800     IF PS-ERRORS-NO                                              06380000
063900         PERFORM 7100-OPEN-RECITM-CURSOR                          06390000
064000     END-IF.                                                      06400000
064100                                                                  06410000
064200     IF PS-ERRORS-NO                                              06420000
064300         PERFORM 7110-FETCH-RECITM-CURSOR                         06430000
064400     END-IF.                                                      06440000
064500                                                                  06450000
064600     IF PS-PRIOR-CURSOR-EOF                                       06460000
064700         SET PS-ERRORS-YES TO TRUE                                06470000
064800     END-IF.                                                      06480000
064900                                                                  06490000
065000     IF PS-ERRORS-NO                                              06500000
065100         PERFORM 4000-PROCESS-RECITM-CURSOR                       06510000
065200           UNTIL PS-PRIOR-CURSOR-EOF                              06520000
065300              OR PS-ERRORS-YES                                    06530000
065400     END-IF.                                                      06540000
065500                                                                  06550000
065600     IF PS-CURSOR-OPEN                                            06560000
065700         PERFORM 7120-CLOSE-RECITM-CURSOR                         06570000
065800     END-IF.                                                      06580000
065900                                                                  06590000
066000******************************************************************06600000
066100* PO OTR AT THE STORE LEVEL                                       06610000
066200******************************************************************06620000
066300 1400-PO-OTR.                                                     06630000
066400                                                                  06640000
066500     IF PS-ERRORS-NO                                              06650000
066600         MOVE PV-APP-LINE-NBR TO DK-LINE-NBR                      06660000
066700         PERFORM 7200-OPEN-RECITM-CURSOR                          06670000
066800     END-IF.                                                      06680000
066900                                                                  06690000
067000     IF PS-ERRORS-NO                                              06700000
067100         PERFORM 7210-FETCH-RECITM-CURSOR                         06710000
067200     END-IF.                                                      06720000
067300                                                                  06730000
067400     IF PS-ERRORS-NO                                              06740000
067500         PERFORM 4000-PROCESS-RECITM-CURSOR                       06750000
067600           UNTIL PS-PRIOR-CURSOR-EOF                              06760000
067700              OR PS-ERRORS-YES                                    06770000
067800     END-IF.                                                      06780000
067900                                                                  06790000
068000     IF PS-CURSOR-OPEN                                            06800000
068100         PERFORM 7220-CLOSE-RECITM-CURSOR                         06810000
068200     END-IF.                                                      06820000
068300                                                                  06830000
068400******************************************************************06840000
068500******************************************************************06850000
068600 2000-LINE-LEVEL-OTR.                                             06860000
068700                                                                  06870000
068800     MOVE DP277-PO-PREPK-ID TO DK-PO-PREPK-ID.                    06880000
068900     IF PS-ERRORS-NO                                              06890000
069000         PERFORM 2100-FILL-BASE-NUMBERS                           06900000
069100     END-IF.                                                      06910000
069200                                                                  06920000
069300     IF PS-ERRORS-NO                                              06930000
069400         EVALUATE TRUE                                            06940000
069500           WHEN DP277-RECEIVER-OTR                                06950000
069600               PERFORM 2200-PROCESS-RCVR-OTR-RCPTS                06960000
069700                 VARYING DP277-LNE-IDX FROM 1 BY 1                06970000
069800                   UNTIL DP277-LNE-NBR(DP277-LNE-IDX) = ZERO      06980000
069900                      OR DP277-FATAL-ERROR                        06990000
070000                                                                  07000000
070100           WHEN DP277-PO-OTR                                      07010000
070200               PERFORM 2300-PROCESS-PO-OTR-RCPTS                  07020000
070300                 VARYING DP277-LNE-IDX FROM 1 BY 1                07030000
070400                   UNTIL DP277-LNE-NBR(DP277-LNE-IDX) = ZERO      07040000
070500                      OR DP277-FATAL-ERROR                        07050000
070600                                                                  07060000
070700           WHEN OTHER                                             07070000
070800               MOVE 'INVALID OTR SCOPE FLAG' TO PV-RETURN-MSG     07080000
070900                                                TM007-RETURN-MSG  07090000
071000               MOVE 16 TO DP277-RETURN-CODE                       07100000
071100               DISPLAY ' TMKUT019 ERROR MESSAGE'                  07110000
071200               DISPLAY PV-RETURN-MSG                              07120000
071210               MOVE '16'    TO TM007-RETURN-CODE                  07121000
071220               MOVE ZERO    TO TM007-SQLCODE                      07122000
071230               MOVE SPACES  TO TM007-SQLCA                        07123000
071240               MOVE '2000'  TO TM007-RETURNED-PARA                07124000
071250               PERFORM 9999-GOBACK                                07125000
071260         END-EVALUATE                                             07126000
071270     END-IF.                                                      07127000
071280                                                                  07128000
071290******************************************************************07129000
071300******************************************************************07130000
071400 2100-FILL-BASE-NUMBERS.                                          07140000
071500                                                                  07150000
071600     PERFORM 2110-OPEN-PLAN-CURSOR.                               07160000
071700                                                                  07170000
071800     IF PS-ERRORS-NO                                              07180000
071900         PERFORM 2120-FETCH-PLAN-CURSOR                           07190000
072000     END-IF.                                                      07200000
072100                                                                  07210000
072200     IF PS-EOF-PLAN-CSR                                           07220000
072300         SET PS-ERRORS-YES TO TRUE                                07230000
072400     END-IF.                                                      07240000
072500                                                                  07250000
072600     IF PS-ERRORS-NO                                              07260000
072700         PERFORM 2130-LOAD-PLANS                                  07270000
072800           VARYING DP277-LNE-IDX FROM 1 BY 1                      07280000
072900             UNTIL PS-EOF-PLAN-CSR                                07290000
073000                OR DP277-SOFT-ABORT                               07300000
073100                OR DP277-LNE-IDX > PC-MAX-OCCUR-LNE               07310000
073200     END-IF.                                                      07320000
073300                                                                  07330000
073400     IF PS-CURSOR-OPEN                                            07340000
073500         PERFORM 2140-CLOSE-PLAN-CURSOR                           07350000
073600     END-IF.                                                      07360000
073700                                                                  07370000
073800******************************************************************07380000
073900******************************************************************07390000
074000 2110-OPEN-PLAN-CURSOR.                                           07400000
074100                                                                  07410000
074200     EVALUATE TRUE                                                07420000
074300       WHEN DP277-PO-PREPK-ID = 0                                 07430000
074400        EXEC SQL                                                  07440000
074500           OPEN PLAN-LINE-CSR                                     07450000
074600        END-EXEC                                                  07460000
074700       WHEN OTHER                                                 07470000
074800        EXEC SQL                                                  07480000
074810           OPEN PLAN-CSR                                          07481000
074820        END-EXEC                                                  07482000
074830     END-EVALUATE.                                                07483000
074840                                                                  07484000
074850     EVALUATE TRUE                                                07485000
074860       WHEN SQLCODE = ZERO                                        07486000
074870           SET PS-CURSOR-OPEN TO TRUE                             07487000
074880                                                                  07488000
074890       WHEN SQLCODE = -904                                        07489000
074900       WHEN SQLCODE = -911                                        07490000
075000       WHEN SQLCODE = -913                                        07500000
075100           SET PS-CURSOR-CLOSED TO TRUE                           07510000
075200           MOVE 17 TO DP277-RETURN-CODE                           07520000
075300           MOVE '17'    TO TM007-RETURN-CODE                      07530000
075400           MOVE SQLCODE TO TM007-SQLCODE                          07540000
075500           MOVE SQLCA   TO TM007-SQLCA                            07550000
075600           MOVE '2110'  TO TM007-RETURNED-PARA                    07560000
075700           PERFORM 9900-SOFT-ABORT                                07570000
075800                                                                  07580000
075900       WHEN OTHER                                                 07590000
076000           SET PS-CURSOR-CLOSED TO TRUE                           07600000
076100           MOVE 18 TO DP277-RETURN-CODE                           07610000
076200           MOVE '18'    TO TM007-RETURN-CODE                      07620000
076300           MOVE SQLCODE TO TM007-SQLCODE                          07630000
076400           MOVE SQLCA   TO TM007-SQLCA                            07640000
076410           MOVE '2110'  TO TM007-RETURNED-PARA                    07641000
076420           PERFORM 9800-PGM-ABEND                                 07642000
076430     END-EVALUATE.                                                07643000
076440                                                                  07644000
076450******************************************************************07645000
076460******************************************************************07646000
076470 2120-FETCH-PLAN-CURSOR.                                          07647000
076480                                                                  07648000
076490     EVALUATE TRUE                                                07649000
076500       WHEN DP277-PO-PREPK-ID = 0                                 07650000
076600        EXEC SQL                                                  07660000
076700           FETCH PLAN-LINE-CSR                                    07670000
076800            INTO :PURITM-PO-LNE-NBR                               07680000
076900               , :PURITM-APP-PO-LNE-NBR                           07690000
077000               , :PURITM-PREPK-RATO-QTY                           07700000
077010        END-EXEC                                                  07701000
077020       WHEN OTHER                                                 07702000
077030        EXEC SQL                                                  07703000
077040           FETCH PLAN-CSR                                         07704000
077050            INTO :PURITM-PO-LNE-NBR                               07705000
077060               , :PURITM-APP-PO-LNE-NBR                           07706000
077070               , :PURITM-PREPK-RATO-QTY                           07707000
077080        END-EXEC                                                  07708000
077090     END-EVALUATE.                                                07709000
077100                                                                  07710000
077200     EVALUATE TRUE                                                07720000
077300       WHEN SQLCODE = ZERO                                        07730000
077400           CONTINUE                                               07740000
077500                                                                  07750000
077600       WHEN SQLCODE = +100                                        07760000
077700           SET PS-EOF-PLAN-CSR TO TRUE                            07770000
077800                                                                  07780000
077900       WHEN OTHER                                                 07790000
078000           MOVE 19 TO DP277-RETURN-CODE                           07800000
078100           MOVE '19'    TO TM007-RETURN-CODE                      07810000
078200           MOVE SQLCODE TO TM007-SQLCODE                          07820000
078300           MOVE SQLCA   TO TM007-SQLCA                            07830000
078400           MOVE '2120'  TO TM007-RETURNED-PARA                    07840000
078500           PERFORM 9800-PGM-ABEND                                 07850000
078600     END-EVALUATE.                                                07860000
078700                                                                  07870000
078800******************************************************************07880000
078900******************************************************************07890000
079000 2130-LOAD-PLANS.                                                 07900000
079100                                                                  07910000
079200     MOVE DP277-PO-NBR          TO DK-PO-NBR.                     07920000
079300     MOVE PURITM-PO-LNE-NBR     TO DK-LINE-NBR.                   07930000
079400     MOVE PURITM-PREPK-RATO-QTY TO PV-PURITM-RATO-QTY.            07940000
079500     MOVE PURITM-APP-PO-LNE-NBR TO DP277-LNE-NBR(DP277-LNE-IDX).  07950000
079600                                                                  07960000
079700     PERFORM 1110-GET-TALLPLN.                                    07970000
079800                                                                  07980000
079900     IF SQLCODE = ZERO                                            07990000
080000         PERFORM 2150-SUM-ALL-STORES                              08000000
080100                                                                  08010000
080200         EVALUATE TRUE                                            08020000
080300           WHEN SQLCODE = ZERO OR +100 OR -305                    08030000
080400               MOVE MESTDS-STR-DISTRO-QTY                         08040000
080500                       TO DP277-LNE-DISTRO-QTY(DP277-LNE-IDX)     08050000
080600                          DP277-LNE-OTR-QTY(DP277-LNE-IDX)        08060000
080700                          PV-DISPLAY-QTY                          08070000
080800               MOVE PV-DISPLAY-QTY                                08080000
080900                       TO DP277-LNE-DISTRO-QTY-X(DP277-LNE-IDX)   08090000
081000                          DP277-LNE-OTR-QTY-X(DP277-LNE-IDX)      08100000
081100*CALCULATE PACKS FROM UNITS.                                      08110000
081200               IF PV-PURITM-RATO-QTY > +0                         08120000
081300                   DIVIDE MESTDS-STR-DISTRO-QTY                   08130000
081400                       BY PV-PURITM-RATO-QTY                      08140000
081500                   GIVING DP277-LNE-DISTRO-PK(DP277-LNE-IDX)      08150000
081600                   MOVE DP277-LNE-DISTRO-PK(DP277-LNE-IDX)        08160000
081700                        TO DP277-LNE-OTR-PK(DP277-LNE-IDX)        08170000
081800               END-IF                                             08180000
081900                                                                  08190000
082000           WHEN PS-LINE-HAS-DISTRO-NO                             08200000
082100               MOVE ALL '*'                                       08210000
082200                        TO DP277-LNE-OTR-QTY-X(DP277-LNE-IDX)     08220000
082300               MOVE ZEROES                                        08230000
082400                        TO PV-DISPLAY-QTY                         08240000
082500                           DP277-LNE-OTR-QTY(DP277-LNE-IDX)       08250000
082600                           DP277-LNE-OTR-PK(DP277-LNE-IDX)        08260000
082700                           DP277-LNE-DISTRO-QTY(DP277-LNE-IDX)    08270000
082800                           DP277-LNE-DISTRO-PK(DP277-LNE-IDX)     08280000
082900               MOVE PV-DISPLAY-QTY                                08290000
083000                        TO DP277-LNE-DISTRO-QTY-X(DP277-LNE-IDX)  08300000
083100                                                                  08310000
083200           WHEN OTHER                                             08320000
083300               MOVE ZEROES                                        08330000
083400                        TO DP277-LNE-DISTRO-QTY(DP277-LNE-IDX)    08340000
083500                           DP277-LNE-DISTRO-PK(DP277-LNE-IDX)     08350000
083600                           DP277-LNE-OTR-QTY(DP277-LNE-IDX)       08360000
083700                           DP277-LNE-OTR-PK(DP277-LNE-IDX)        08370000
083800               MOVE SPACES                                        08380000
083900                        TO DP277-LNE-OTR-QTY-X(DP277-LNE-IDX)     08390000
084000                           DP277-LNE-DISTRO-QTY-X(DP277-LNE-IDX)  08400000
084100         END-EVALUATE                                             08410000
084200     END-IF.                                                      08420000
084300                                                                  08430000
084400     IF PS-ERRORS-NO                                              08440000
084500       AND NOT DP277-SOFT-ABORT                                   08450000
084600         PERFORM 2120-FETCH-PLAN-CURSOR                           08460000
084700     END-IF.                                                      08470000
084800                                                                  08480000
084900******************************************************************08490000
085000******************************************************************08500000
085100 2140-CLOSE-PLAN-CURSOR.                                          08510000
085200                                                                  08520000
085300     EVALUATE TRUE                                                08530000
085400       WHEN DP277-PO-PREPK-ID = 0                                 08540000
085410        EXEC SQL                                                  08541000
085420           CLOSE PLAN-LINE-CSR                                    08542000
085430        END-EXEC                                                  08543000
085440       WHEN OTHER                                                 08544000
085450        EXEC SQL                                                  08545000
085460           CLOSE PLAN-CSR                                         08546000
085470        END-EXEC                                                  08547000
085480     END-EVALUATE.                                                08548000
085490                                                                  08549000
085500     EVALUATE TRUE                                                08550000
085600       WHEN SQLCODE = ZERO                                        08560000
085700           SET PS-CURSOR-CLOSED TO TRUE                           08570000
085800                                                                  08580000
085900       WHEN OTHER                                                 08590000
086000           MOVE 20 TO DP277-RETURN-CODE                           08600000
086100           MOVE '20'    TO TM007-RETURN-CODE                      08610000
086200           MOVE SQLCODE TO TM007-SQLCODE                          08620000
086300           MOVE SQLCA   TO TM007-SQLCA                            08630000
086400           MOVE '2140'  TO TM007-RETURNED-PARA                    08640000
086500           PERFORM 9800-PGM-ABEND                                 08650000
086600     END-EVALUATE.                                                08660000
086700                                                                  08670000
086800******************************************************************08680000
086900******************************************************************08690000
087000 2150-SUM-ALL-STORES.                                             08700000
087100                                                                  08710000
087200     MOVE ZEROES TO MESTDS-STR-DISTRO-QTY.                        08720000
087300                                                                  08730000
087400     IF DP277-STR-NBR = ZERO                                      08740000
087500         EXEC SQL                                                 08750000
087600             SELECT SUM(A.STR_DISTRO_QTY)                         08760000
087700               INTO :MESTDS-STR-DISTRO-QTY                        08770000
087800               FROM TMESTDS A                                     08780000
087900              WHERE A.PO_NBR     = :DK-PO-NBR                     08790000
088000                AND A.PO_LNE_NBR = :DK-LINE-NBR                   08800000
088100                AND A.PLAN_NBR   = :ALLPLN-PLAN-NBR               08810000
088200         END-EXEC                                                 08820000
088300     ELSE                                                         08830000
088400         EXEC SQL                                                 08840000
088500             SELECT A.STR_DISTRO_QTY                              08850000
088600               INTO :MESTDS-STR-DISTRO-QTY                        08860000
088700               FROM TMESTDS A                                     08870000
088800              WHERE A.PO_NBR     = :DK-PO-NBR                     08880000
088900                AND A.PO_LNE_NBR = :DK-LINE-NBR                   08890000
089000                AND A.PLAN_NBR   = :ALLPLN-PLAN-NBR               08900000
089100                AND A.STR_NBR    = :DP277-STR-NBR                 08910000
089200         END-EXEC                                                 08920000
089300     END-IF.                                                      08930000
089400                                                                  08940000
089500     EVALUATE TRUE                                                08950000
089600       WHEN SQLCODE = ZERO                                        08960000
089700           IF DP277-STR-NBR = ZERO                                08970000
089800               IF MESTDS-STR-DISTRO-QTY                           08980000
089900                 NOT = ALLPLN-CURR-SPLIT-QTY                      08990000
090000                   MOVE ALLPLN-CURR-SPLIT-QTY                     09000000
090100                     TO MESTDS-STR-DISTRO-QTY                     09010000
090200               END-IF                                             09020000
090300           END-IF                                                 09030000
090400                                                                  09040000
090500       WHEN SQLCODE = +100 OR -305                                09050000
090600           IF DP277-STR-NBR = ZERO                                09060000
090700               MOVE ALLPLN-CURR-SPLIT-QTY                         09070000
090800                 TO MESTDS-STR-DISTRO-QTY                         09080000
090900           ELSE                                                   09090000
091000               MOVE 21 TO DP277-RETURN-CODE                       09100000
091100               SET PS-LINE-HAS-DISTRO-NO TO TRUE                  09110000
091200               PERFORM 9000-NO-DISTRO-ERROR                       09120000
091300           END-IF                                                 09130000
091400                                                                  09140000
091500       WHEN SQLCODE = -904                                        09150000
091600       WHEN SQLCODE = -911                                        09160000
091700       WHEN SQLCODE = -913                                        09170000
091800           MOVE 22 TO DP277-RETURN-CODE                           09180000
091900           MOVE '22'    TO TM007-RETURN-CODE                      09190000
091910           MOVE SQLCODE TO TM007-SQLCODE                          09191000
091920           MOVE SQLCA   TO TM007-SQLCA                            09192000
091930           MOVE '2150'  TO TM007-RETURNED-PARA                    09193000
091940           PERFORM 9900-SOFT-ABORT                                09194000
091950                                                                  09195000
091960       WHEN OTHER                                                 09196000
091970           MOVE 23 TO DP277-RETURN-CODE                           09197000
091980           SET PS-LINE-HAS-DISTRO-NO TO TRUE                      09198000
091990           PERFORM 9000-NO-DISTRO-ERROR                           09199000
092000     END-EVALUATE.                                                09200000
092100                                                                  09210000
092200******************************************************************09220000
092300* RECEIVER OTR AT THE LINE LEVEL                                  09230000
092400******************************************************************09240000
092500 2200-PROCESS-RCVR-OTR-RCPTS.                                     09250000
092600                                                                  09260000
092700*ALL '*' INDICATES A 'NO DISTRO' ERROR FOR THE LINE               09270000
092800     IF DP277-LNE-OTR-QTY-X(DP277-LNE-IDX) = ALL '*'              09280000
092900         SET PS-ERRORS-YES TO TRUE                                09290000
093000     ELSE                                                         09300000
093100         SET PS-ERRORS-NO                                         09310000
093200             PS-PRIOR-CURSOR-START TO TRUE                        09320000
093300         MOVE DP277-LNE-NBR(DP277-LNE-IDX) TO DK-LINE-NBR         09330000
093400         PERFORM 7000-GET-RECITM-TMST                             09340000
093500     END-IF                                                       09350000
093600                                                                  09360000
093700     IF PS-ERRORS-NO AND NOT DP277-FATAL-ERROR                    09370000
093800         PERFORM 7100-OPEN-RECITM-CURSOR                          09380000
093900     END-IF.                                                      09390000
094000                                                                  09400000
094100     IF PS-ERRORS-NO AND NOT DP277-FATAL-ERROR                    09410000
094200         PERFORM 7110-FETCH-RECITM-CURSOR                         09420000
094300     END-IF.                                                      09430000
094400                                                                  09440000
094500     IF PS-PRIOR-CURSOR-EOF                                       09450000
094600         SET PS-ERRORS-YES TO TRUE                                09460000
094700     END-IF.                                                      09470000
094800                                                                  09480000
094900     IF PS-ERRORS-NO                                              09490000
095000         SET PS-HAVE-DRV-QTY-NO TO TRUE                           09500000
095100         PERFORM 6000-PROCESS-RECITM-CURSOR                       09510000
095200           UNTIL PS-PRIOR-CURSOR-EOF                              09520000
095300              OR PS-ERRORS-YES                                    09530000
095400              OR DP277-FATAL-ERROR                                09540000
095500     END-IF.                                                      09550000
095600                                                                  09560000
095700     IF PS-CURSOR-OPEN                                            09570000
095800         PERFORM 7120-CLOSE-RECITM-CURSOR                         09580000
095900     END-IF.                                                      09590000
096000                                                                  09600000
096100******************************************************************09610000
096200* PO OTR AT THE LINE LEVEL                                        09620000
096300******************************************************************09630000
096400 2300-PROCESS-PO-OTR-RCPTS.                                       09640000
096500                                                                  09650000
096600*ALL '*' INDICATES A 'NO DISTRO' ERROR FOR THE LINE               09660000
096700     IF DP277-LNE-OTR-QTY-X(DP277-LNE-IDX) = ALL '*'              09670000
096800         SET PS-ERRORS-YES TO TRUE                                09680000
096900     ELSE                                                         09690000
097000         SET PS-ERRORS-NO TO TRUE                                 09700000
097100         MOVE DP277-LNE-NBR(DP277-LNE-IDX) TO DK-LINE-NBR         09710000
097200         PERFORM 7200-OPEN-RECITM-CURSOR                          09720000
097300     END-IF.                                                      09730000
097400                                                                  09740000
097500     IF PS-ERRORS-NO                                              09750000
097600         SET PS-PRIOR-CURSOR-START TO TRUE                        09760000
097700         PERFORM 7210-FETCH-RECITM-CURSOR                         09770000
097800     END-IF.                                                      09780000
097900                                                                  09790000
098000     IF PS-ERRORS-NO                                              09800000
098100         SET PS-HAVE-DRV-QTY-NO TO TRUE                           09810000
098200         PERFORM 6000-PROCESS-RECITM-CURSOR                       09820000
098300            UNTIL PS-PRIOR-CURSOR-EOF                             09830000
098400               OR PS-ERRORS-YES                                   09840000
098500               OR DP277-FATAL-ERROR                               09850000
098600     END-IF.                                                      09860000
098700                                                                  09870000
098800     IF PS-CURSOR-OPEN                                            09880000
098900         PERFORM 7220-CLOSE-RECITM-CURSOR                         09890000
099000     END-IF.                                                      09900000
099100                                                                  09910000
099200******************************************************************09920000
099300******************************************************************09930000
099400 4000-PROCESS-RECITM-CURSOR.                                      09940000
099500                                                                  09950011
099600     PERFORM 4100-APPLY-PRIOR-RECEIPTS                            09960000
099700       VARYING DP277-STR-IDX FROM 1 BY 1                          09970000
099800         UNTIL DP277-STORE-NBR(DP277-STR-IDX) = ZERO              09980000
099900            OR DP277-STR-IDX > PC-MAX-OCCUR-STR.                  09990000
100000                                                                  10000000
100100     IF PS-ERRORS-NO                                              10010000
100200         IF DP277-RECEIVER-OTR                                    10020000
100300             PERFORM 7110-FETCH-RECITM-CURSOR                     10030000
100400         ELSE                                                     10040000
100500             PERFORM 7210-FETCH-RECITM-CURSOR                     10050000
100600         END-IF                                                   10060000
100700     END-IF.                                                      10070000
100800                                                                  10080000
100900******************************************************************10090000
101000*    THIS PARAGRAPH RETRIEVES THE RECDIS RECORD FOR A GIVEN STORE.10100000
101100*    IT THEN ADDS INTO THE STORE ARRAY THE CORRECT STORE RECEIPTS 10110000
101200*    DEPENDING UPON THE STATUS CODE OF THE RECITM.                10120000
101300******************************************************************10130000
101400 4100-APPLY-PRIOR-RECEIPTS.                                       10140000
101500                                                                  10150000
101600     PERFORM 4110-APPLY-PRIOR-RECEIPTS.                           10160000
101700                                                                  10170000
101800*APPLY DRIVER LINE RECEIPTS (IF LINE CHANGED).                    10180000
101900     IF DK-LINE-NBR = DK-DRIVER-LINE-NBR                          10190000
102000       OR PS-NO-DRIVER-LINE                                       10200000
102100         MOVE PV-RECEIVED-QTY TO PV-RECEIVED-DRV-QTY              10210000
102200     ELSE                                                         10220000
102300         IF DK-DRIVER-LINE-NBR NOT = 0                            10230000
102400             PERFORM 4120-DETERMINE-DRVLNE-RECEIPTS               10240000
102500         END-IF                                                   10250000
102600     END-IF.                                                      10260000
102700                                                                  10270000
102800*CALCULATE PACK QUANTITY.                                         10280000
102900*NOTE:                                                            10290000
103000*ON A NON DRIVER LINE RECEIVER RATIO QUANTITY IS DEFAULTED TO     10300000
103100*THE PURITM RATIO                                                 10310000
103200     IF PV-RECITM-RATO-QTY > +0                                   10320000
103300       AND (DK-DRIVER-LINE-NBR NOT = 0                            10330000
103400        OR PS-NO-DRIVER-LINE)                                     10340000
103500         DIVIDE PV-RECEIVED-DRV-QTY                               10350000
103600           BY PV-RECITM-RATO-QTY                                  10360000
103700           GIVING PV-RECEIVED-QTY-PK                              10370000
103800         SUBTRACT PV-RECEIVED-QTY-PK                              10380000
103900             FROM DP277-STR-OTR-PK(DP277-STR-IDX)                 10390000
104000     ELSE                                                         10400000
104100         MOVE ZEROS TO PV-RECEIVED-QTY-PK                         10410000
104200     END-IF.                                                      10420000
104300                                                                  10430000
104400******************************************************************10440000
104500******************************************************************10450000
104600 4110-APPLY-PRIOR-RECEIPTS.                                       10460000
104700                                                                  10470000
104800     MOVE DP277-STORE-NBR(DP277-STR-IDX) TO RECDIS-STR-NBR.       10480000
104900                                                                  10490000
105000     IF RECITM-STATUS-CDE = PC-VE                                 10500000
105100         EXEC SQL                                                 10510000
105200             SELECT AP_VERIFY_ITM_QTY                             10520000
105300               INTO :PV-RECEIVED-QTY                              10530000
105400               FROM TRECDIS                                       10540000
105500              WHERE ORD_NBR        = :DP277-PO-NBR                10550000
105600                AND ORD_LNE_NBR    = :DK-LINE-NBR                 10560000
105700                AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR          10570000
105800                AND OPER_UNT_ID    = :DP277-OPER-UNT-ID           10580000
106000                AND STR_NBR        = :RECDIS-STR-NBR              10600000
106100                AND STR_FCLTY_ID   = :PC-SHORT-ONE                10610000
106200         END-EXEC                                                 10620000
106300     ELSE                                                         10630000
106400         EXEC SQL                                                 10640000
106500             SELECT EXPTED_ITM_QTY                                10650000
106600               INTO :PV-RECEIVED-QTY                              10660000
106700               FROM TRECDIS                                       10670000
106800              WHERE ORD_NBR        = :DP277-PO-NBR                10680000
106900                AND ORD_LNE_NBR    = :DK-LINE-NBR                 10690000
107000                AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR          10700000
107100                AND OPER_UNT_ID    = :DP277-OPER-UNT-ID           10710000
107300                AND STR_NBR        = :RECDIS-STR-NBR              10730000
107400                AND STR_FCLTY_ID   = :PC-SHORT-ONE                10740000
107500         END-EXEC                                                 10750000
107600     END-IF                                                       10760000
107700                                                                  10770000
107800     EVALUATE TRUE                                                10780000
107900       WHEN SQLCODE = ZERO                                        10790000
108000           SUBTRACT PV-RECEIVED-QTY                               10800000
108100               FROM DP277-STR-OTR-QTY(DP277-STR-IDX)              10810000
108200           IF DP277-STR-OTR-QTY(DP277-STR-IDX) > ZERO             10820000
108300               MOVE DP277-STR-OTR-QTY(DP277-STR-IDX)              10830000
108400                    TO PV-DISPLAY-QTY                             10840000
108500           ELSE                                                   10850000
108600               MOVE ZERO TO PV-DISPLAY-QTY                        10860000
108700           END-IF                                                 10870000
108800           MOVE PV-DISPLAY-QTY                                    10880000
108900                TO DP277-STR-OTR-QTY-X(DP277-STR-IDX)             10890000
109000                                                                  10900000
109100       WHEN SQLCODE = +100                                        10910000
109200           MOVE ZEROES TO PV-RECEIVED-QTY                         10920000
109300                                                                  10930000
109400       WHEN SQLCODE = -904                                        10940000
109500       WHEN SQLCODE = -911                                        10950000
109600       WHEN SQLCODE = -913                                        10960000
109700           MOVE 24 TO DP277-RETURN-CODE                           10970000
109800           MOVE '24'    TO TM007-RETURN-CODE                      10980000
109810           MOVE SQLCODE TO TM007-SQLCODE                          10981000
109820           MOVE SQLCA   TO TM007-SQLCA                            10982000
109830           MOVE '4110'  TO TM007-RETURNED-PARA                    10983000
109840           PERFORM 9900-SOFT-ABORT                                10984000
109850                                                                  10985000
109860       WHEN OTHER                                                 10986000
109870           MOVE 25 TO DP277-RETURN-CODE                           10987000
109880           MOVE '25'    TO TM007-RETURN-CODE                      10988000
109890           MOVE SQLCODE TO TM007-SQLCODE                          10989000
109900           MOVE SQLCA   TO TM007-SQLCA                            10990000
110000           MOVE '4110'  TO TM007-RETURNED-PARA                    11000000
110100           PERFORM 9800-PGM-ABEND                                 11010000
110200     END-EVALUATE.                                                11020000
110300                                                                  11030000
110400******************************************************************11040000
110500******************************************************************11050000
110600 4120-DETERMINE-DRVLNE-RECEIPTS.                                  11060000
110700                                                                  11070000
110800     MOVE DP277-STORE-NBR(DP277-STR-IDX) TO RECDIS-STR-NBR.       11080000
110900                                                                  11090000
111000     IF RECITM-STATUS-CDE = PC-VE                                 11100000
111100         EXEC SQL                                                 11110000
111200             SELECT AP_VERIFY_ITM_QTY                             11120000
111300               INTO :PV-RECEIVED-DRV-QTY                          11130000
111400               FROM TRECDIS                                       11140000
111500              WHERE ORD_NBR        = :DP277-PO-NBR                11150000
111600                AND ORD_LNE_NBR    = :DK-DRIVER-LINE-NBR          11160000
111700                AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR          11170000
111800                AND OPER_UNT_ID    = :DP277-OPER-UNT-ID           11180000
112000                AND STR_NBR        = :RECDIS-STR-NBR              11200000
112100                AND STR_FCLTY_ID   = :PC-SHORT-ONE                11210000
112200         END-EXEC                                                 11220000
112300     ELSE                                                         11230000
112400         EXEC SQL                                                 11240000
112500             SELECT EXPTED_ITM_QTY                                11250000
112600               INTO :PV-RECEIVED-DRV-QTY                          11260000
112700               FROM TRECDIS                                       11270000
112800              WHERE ORD_NBR        = :DP277-PO-NBR                11280000
112900                AND ORD_LNE_NBR    = :DK-DRIVER-LINE-NBR          11290000
113000                AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR          11300000
113100                AND OPER_UNT_ID    = :DP277-OPER-UNT-ID           11310000
113300                AND STR_NBR        = :RECDIS-STR-NBR              11330000
113400                AND STR_FCLTY_ID   = :PC-SHORT-ONE                11340000
113500         END-EXEC                                                 11350000
113600     END-IF                                                       11360000
113700                                                                  11370000
113800     EVALUATE TRUE                                                11380000
113900       WHEN SQLCODE = ZERO                                        11390000
114000           CONTINUE                                               11400000
114100       WHEN SQLCODE = +100                                        11410000
114200       WHEN SQLCODE = -305                                        11420000
114300           MOVE 0 TO PV-RECEIVED-DRV-QTY                          11430000
114400                                                                  11440000
114500       WHEN SQLCODE = -904                                        11450000
114600       WHEN SQLCODE = -911                                        11460000
114700       WHEN SQLCODE = -913                                        11470000
114800           MOVE 26 TO DP277-RETURN-CODE                           11480000
114900           MOVE '26'    TO TM007-RETURN-CODE                      11490000
115000           MOVE SQLCODE TO TM007-SQLCODE                          11500000
115010           MOVE SQLCA   TO TM007-SQLCA                            11501000
115020           MOVE '4120'  TO TM007-RETURNED-PARA                    11502000
115030           PERFORM 9900-SOFT-ABORT                                11503000
115040                                                                  11504000
115050       WHEN OTHER                                                 11505000
115060           MOVE 27 TO DP277-RETURN-CODE                           11506000
115070           MOVE '27'    TO TM007-RETURN-CODE                      11507000
115080           MOVE SQLCODE TO TM007-SQLCODE                          11508000
115090           MOVE SQLCA   TO TM007-SQLCA                            11509000
115100           MOVE '4120'  TO TM007-RETURNED-PARA                    11510000
115200           PERFORM 9800-PGM-ABEND                                 11520000
115300     END-EVALUATE.                                                11530000
115400                                                                  11540000
115500                                                                  11550000
115600******************************************************************11560000
115700******************************************************************11570000
115800 6000-PROCESS-RECITM-CURSOR.                                      11580000
115900                                                                  11590000
116000     PERFORM 6100-APPLY-PRIOR-RECEIPTS.                           11600000
116100                                                                  11610000
116200     SET PS-HAVE-DRV-QTY-NO TO TRUE.                              11620000
116300                                                                  11630000
116400     IF PS-ERRORS-NO                                              11640000
116500         IF DP277-RECEIVER-OTR                                    11650000
116600             PERFORM 7110-FETCH-RECITM-CURSOR                     11660000
116700         ELSE                                                     11670000
116800             PERFORM 7210-FETCH-RECITM-CURSOR                     11680000
116900     END-IF.                                                      11690000
117000                                                                  11700000
117100******************************************************************11710000
117200******************************************************************11720000
117300 6100-APPLY-PRIOR-RECEIPTS.                                       11730000
117400                                                                  11740000
117500     PERFORM 6110-APPLY-PRIOR-RECEIPTS.                           11750000
117600                                                                  11760000
117700*APPLY DRIVER LINE RECEIPTS (IF LINE CHANGED).                    11770000
117800     IF DK-LINE-NBR = DK-DRIVER-LINE-NBR                          11780000
117900        OR PS-NO-DRIVER-LINE                                      11790000
118000         MOVE PV-RECEIVED-QTY TO PV-RECEIVED-DRV-QTY              11800000
118100     ELSE                                                         11810000
118200         IF DK-DRIVER-LINE-NBR NOT = 0                            11820000
118300           AND PS-HAVE-DRV-QTY-NO                                 11830000
118400             PERFORM 6120-DETERMINE-DRVLNE-RECEIPTS               11840000
118500         END-IF                                                   11850000
118600     END-IF.                                                      11860000
118700                                                                  11870000
118800*CALCULATE PACK QUANTITY.                                         11880000
118900*NOTE:                                                            11890000
118910*ON A NON DRIVER LINE RECEIVER RATIO QUANTITY IS DEFAULTED TO     11891000
118920*THE PURITM RATIO                                                 11892000
118930     IF PV-RECITM-RATO-QTY > +0                                   11893000
118940       AND (DK-DRIVER-LINE-NBR NOT = 0                            11894000
118950         OR PS-NO-DRIVER-LINE)                                    11895000
118960         DIVIDE PV-RECEIVED-DRV-QTY                               11896000
118970           BY PV-RECITM-RATO-QTY                                  11897000
118980           GIVING PV-RECEIVED-QTY-PK                              11898000
118990         SUBTRACT PV-RECEIVED-QTY-PK                              11899000
119000             FROM DP277-LNE-OTR-PK(DP277-LNE-IDX)                 11900000
119100     ELSE                                                         11910000
119200         MOVE ZEROES TO PV-RECEIVED-QTY-PK                        11920000
119300     END-IF.                                                      11930000
119400                                                                  11940000
119500******************************************************************11950000
119600******************************************************************11960000
119700 6110-APPLY-PRIOR-RECEIPTS.                                       11970000
119800                                                                  11980000
119900     MOVE DP277-LNE-NBR(DP277-LNE-IDX) TO RECDIS-ORD-LNE-NBR.     11990000
120000                                                                  12000000
120100     EVALUATE RECITM-STATUS-CDE                                   12010000
120200       WHEN PC-VE                                                 12020000
120300           IF DP277-STR-NBR = ZERO                                12030000
120400               EXEC SQL                                           12040000
120500                   SELECT SUM(AP_VERIFY_ITM_QTY)                  12050000
120600                     INTO :PV-RECEIVED-QTY                        12060000
120700                     FROM TRECDIS                                 12070000
120800                    WHERE ORD_NBR        = :DP277-PO-NBR          12080000
120900                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    12090000
121000                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    12100000
121100                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     12110000
121300                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          12130000
121400               END-EXEC                                           12140000
121500           ELSE                                                   12150000
121600               EXEC SQL                                           12160000
121700                   SELECT AP_VERIFY_ITM_QTY                       12170000
121800                     INTO :PV-RECEIVED-QTY                        12180000
121900                     FROM TRECDIS                                 12190000
122000                    WHERE ORD_NBR        = :DP277-PO-NBR          12200000
122100                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    12210000
122200                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    12220000
122300                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     12230000
122400                      AND FCLTY_ID       = :DP277-FCLTY-ID        12240000
122500                      AND STR_NBR        = :DP277-STR-NBR         12250000
122600                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          12260000
122800               END-EXEC                                           12280000
122900           END-IF                                                 12290000
123000                                                                  12300000
123100       WHEN PC-IP                                                 12310000
123200       WHEN PC-CM                                                 12320000
123300           IF DP277-STR-NBR = ZERO                                12330000
123400               EXEC SQL                                           12340000
123500                   SELECT SUM(EXPTED_ITM_QTY)                     12350000
123600                     INTO :PV-RECEIVED-QTY                        12360000
123700                     FROM TRECDIS                                 12370000
123800                    WHERE ORD_NBR        = :DP277-PO-NBR          12380000
123900                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    12390000
124000                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    12400000
124100                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     12410000
124200                      AND FCLTY_ID       = :DP277-FCLTY-ID        12420000
124400                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          12440000
124500               END-EXEC                                           12450000
124600           ELSE                                                   12460000
124700               EXEC SQL                                           12470000
124800                   SELECT EXPTED_ITM_QTY                          12480000
124900                     INTO :PV-RECEIVED-QTY                        12490000
125000                     FROM TRECDIS                                 12500000
125100                    WHERE ORD_NBR        = :DP277-PO-NBR          12510000
125200                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    12520000
125300                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    12530000
125400                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     12540000
125500                      AND FCLTY_ID       = :DP277-FCLTY-ID        12550000
125600                      AND STR_NBR        = :DP277-STR-NBR         12560000
125800                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          12580000
125900               END-EXEC                                           12590000
126000           END-IF                                                 12600000
126100     END-EVALUATE.                                                12610000
126200                                                                  12620000
126300     EVALUATE TRUE                                                12630000
126400       WHEN SQLCODE = ZERO                                        12640000
126500           SUBTRACT PV-RECEIVED-QTY                               12650000
126600               FROM DP277-LNE-OTR-QTY(DP277-LNE-IDX)              12660000
126700           IF DP277-LNE-OTR-QTY(DP277-LNE-IDX) > ZERO             12670000
126800               MOVE DP277-LNE-OTR-QTY(DP277-LNE-IDX)              12680000
126900                    TO PV-DISPLAY-QTY                             12690000
127000           ELSE                                                   12700000
127100               MOVE ZERO TO PV-DISPLAY-QTY                        12710000
127200           END-IF                                                 12720000
127300           MOVE PV-DISPLAY-QTY                                    12730000
127400                TO DP277-LNE-OTR-QTY-X(DP277-LNE-IDX)             12740000
127500                                                                  12750000
127600       WHEN SQLCODE = +100                                        12760000
127700       WHEN SQLCODE = -305                                        12770000
127800           MOVE ZEROES TO PV-RECEIVED-QTY                         12780000
127900                                                                  12790000
128000       WHEN SQLCODE = -904                                        12800000
128100       WHEN SQLCODE = -911                                        12810000
128200       WHEN SQLCODE = -913                                        12820000
128300           MOVE 28 TO DP277-RETURN-CODE                           12830000
128400           MOVE '28'    TO TM007-RETURN-CODE                      12840000
128500           MOVE SQLCODE TO TM007-SQLCODE                          12850000
128600           MOVE SQLCA   TO TM007-SQLCA                            12860000
128700           MOVE '6110'  TO TM007-RETURNED-PARA                    12870000
128800           PERFORM 9900-SOFT-ABORT                                12880000
128900                                                                  12890000
129000       WHEN OTHER                                                 12900000
129100           MOVE 29 TO DP277-RETURN-CODE                           12910000
129200           MOVE '29'    TO TM007-RETURN-CODE                      12920000
129300           MOVE SQLCODE TO TM007-SQLCODE                          12930000
129400           MOVE SQLCA   TO TM007-SQLCA                            12940000
129410           MOVE '6110'  TO TM007-RETURNED-PARA                    12941000
129420           PERFORM 9800-PGM-ABEND                                 12942000
129430     END-EVALUATE.                                                12943000
129440                                                                  12944000
129450******************************************************************12945000
129460******************************************************************12946000
129470 6120-DETERMINE-DRVLNE-RECEIPTS.                                  12947000
129480                                                                  12948000
129490     MOVE DK-DRIVER-LINE-NBR TO RECDIS-ORD-LNE-NBR.               12949000
129500                                                                  12950000
129600     EVALUATE RECITM-STATUS-CDE                                   12960000
129700       WHEN PC-VE                                                 12970000
129800           IF DP277-STR-NBR = ZERO                                12980000
129900               EXEC SQL                                           12990000
130000                   SELECT SUM(AP_VERIFY_ITM_QTY)                  13000000
130100                     INTO :PV-RECEIVED-DRV-QTY                    13010000
130200                     FROM TRECDIS                                 13020000
130300                    WHERE ORD_NBR        = :DP277-PO-NBR          13030000
130400                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    13040000
130500                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    13050000
130600                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     13060000
130800                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          13080000
130900               END-EXEC                                           13090000
131000           ELSE                                                   13100000
131100               EXEC SQL                                           13110000
131200                   SELECT AP_VERIFY_ITM_QTY                       13120000
131300                     INTO :PV-RECEIVED-DRV-QTY                    13130000
131400                     FROM TRECDIS                                 13140000
131500                    WHERE ORD_NBR        = :DP277-PO-NBR          13150000
131600                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    13160000
131700                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    13170000
131800                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     13180000
131900                      AND FCLTY_ID       = :DP277-FCLTY-ID        13190000
132000                      AND STR_NBR        = :DP277-STR-NBR         13200000
132100                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          13210000
132300               END-EXEC                                           13230000
132400           END-IF                                                 13240000
132500                                                                  13250000
132600       WHEN PC-IP                                                 13260000
132700       WHEN PC-CM                                                 13270000
132800           IF DP277-STR-NBR = ZERO                                13280000
132900               EXEC SQL                                           13290000
133000                   SELECT SUM(EXPTED_ITM_QTY)                     13300000
133100                     INTO :PV-RECEIVED-DRV-QTY                    13310000
133200                     FROM TRECDIS                                 13320000
133300                    WHERE ORD_NBR        = :DP277-PO-NBR          13330000
133400                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    13340000
133500                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    13350000
133600                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     13360000
133700                      AND FCLTY_ID       = :DP277-FCLTY-ID        13370000
133900                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          13390000
134000               END-EXEC                                           13400000
134100           ELSE                                                   13410000
134200               EXEC SQL                                           13420000
134300                   SELECT EXPTED_ITM_QTY                          13430000
134400                     INTO :PV-RECEIVED-DRV-QTY                    13440000
134500                     FROM TRECDIS                                 13450000
134600                    WHERE ORD_NBR        = :DP277-PO-NBR          13460000
134700                      AND ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR    13470000
134800                      AND REC_SEQ_NBR    = :RECITM-REC-SEQ-NBR    13480000
134900                      AND OPER_UNT_ID    = :DP277-OPER-UNT-ID     13490000
135000                      AND FCLTY_ID       = :DP277-FCLTY-ID        13500000
135100                      AND STR_NBR        = :DP277-STR-NBR         13510000
135300                      AND STR_FCLTY_ID   = :PC-SHORT-ONE          13530000
135400               END-EXEC                                           13540000
135500           END-IF                                                 13550000
135600     END-EVALUATE.                                                13560000
135700                                                                  13570000
135800     EVALUATE TRUE                                                13580000
135900       WHEN SQLCODE = ZERO                                        13590000
136000           SET PS-HAVE-DRV-QTY-YES TO TRUE                        13600000
136100                                                                  13610000
136200       WHEN SQLCODE = +100                                        13620000
136300       WHEN SQLCODE = -305                                        13630000
136400           MOVE ZERO TO PV-RECEIVED-DRV-QTY                       13640000
136500                                                                  13650000
136600       WHEN SQLCODE = -904                                        13660000
136700       WHEN SQLCODE = -911                                        13670000
136800       WHEN SQLCODE = -913                                        13680000
136900           MOVE 30 TO DP277-RETURN-CODE                           13690000
137000           MOVE '30'    TO TM007-RETURN-CODE                      13700000
137100           MOVE SQLCODE TO TM007-SQLCODE                          13710000
137200           MOVE SQLCA   TO TM007-SQLCA                            13720000
137300           MOVE '6120'  TO TM007-RETURNED-PARA                    13730000
137400           PERFORM 9900-SOFT-ABORT                                13740000
137500                                                                  13750000
137600       WHEN OTHER                                                 13760000
137700           MOVE 31 TO DP277-RETURN-CODE                           13770000
137800           MOVE '31'    TO TM007-RETURN-CODE                      13780000
137900           MOVE SQLCODE TO TM007-SQLCODE                          13790000
138000           MOVE SQLCA   TO TM007-SQLCA                            13800000
138100           MOVE '6120'  TO TM007-RETURNED-PARA                    13810000
138110           PERFORM 9800-PGM-ABEND                                 13811000
138120     END-EVALUATE.                                                13812000
138130                                                                  13813000
138140******************************************************************13814000
138150*    THIS PARAGRAPH RETRIEVES THE EARLIEST TIMESTAMP FOR A PO     13815000
138160*    AND RECEIVER  WITHIN A DC.                                   13816000
138170******************************************************************13817000
138180 7000-GET-RECITM-TMST.                                            13818000
138190                                                                  13819000
138200     EXEC SQL                                                     13820000
138300         SELECT CRE_TMST                                          13830000
138400           INTO :RECITM-CRE-TMST                                  13840000
138500           FROM TRECITM                                           13850000
138600          WHERE ORD_NBR     = :DP277-PO-NBR                       13860000
138700            AND REC_SEQ_NBR = :DP277-REC-SEQ-NBR                  13870000
138800            AND ORD_LNE_NBR = :DK-LINE-NBR                        13880000
138900            AND OPER_UNT_ID = :DP277-OPER-UNT-ID                  13890000
139000     END-EXEC.                                                    13900000
139100                                                                  13910000
139200     EVALUATE TRUE                                                13920000
139300       WHEN SQLCODE = ZERO                                        13930000
139400           CONTINUE                                               13940000
139500                                                                  13950000
139600       WHEN SQLCODE = +100                                        13960000
139700           EXEC SQL                                               13970000
139800               SET :RECITM-CRE-TMST = CURRENT TIMESTAMP           13980000
139900           END-EXEC                                               13990000
140000                                                                  14000000
140100       WHEN SQLCODE = -904                                        14010000
140200       WHEN SQLCODE = -911                                        14020000
140300       WHEN SQLCODE = -913                                        14030000
140400           MOVE 32 TO DP277-RETURN-CODE                           14040000
140500           MOVE '32'    TO TM007-RETURN-CODE                      14050000
140600           MOVE SQLCODE TO TM007-SQLCODE                          14060000
140700           MOVE SQLCA   TO TM007-SQLCA                            14070000
140800           MOVE '7000'  TO TM007-RETURNED-PARA                    14080000
140900           PERFORM 9900-SOFT-ABORT                                14090000
141000                                                                  14100000
141100       WHEN OTHER                                                 14110000
141200           MOVE 33 TO DP277-RETURN-CODE                           14120000
141300           MOVE '33'    TO TM007-RETURN-CODE                      14130000
141400           MOVE SQLCODE TO TM007-SQLCODE                          14140000
141500           MOVE SQLCA   TO TM007-SQLCA                            14150000
141600           MOVE '7000'  TO TM007-RETURNED-PARA                    14160000
141700           PERFORM 9800-PGM-ABEND                                 14170000
141800     END-EVALUATE.                                                14180000
141900                                                                  14190000
142000******************************************************************14200000
142100******************************************************************14210000
142200 7100-OPEN-RECITM-CURSOR.                                         14220000
142300                                                                  14230000
142400     EXEC SQL                                                     14240000
142500         OPEN REC-LVL-CSR                                         14250000
142600     END-EXEC.                                                    14260000
142700                                                                  14270000
142800     EVALUATE TRUE                                                14280000
142900       WHEN SQLCODE = ZERO                                        14290000
143000           SET PS-CURSOR-OPEN TO TRUE                             14300000
143100                                                                  14310000
143200       WHEN SQLCODE = -904                                        14320000
143300       WHEN SQLCODE = -911                                        14330000
143400       WHEN SQLCODE = -913                                        14340000
143500           SET PS-CURSOR-CLOSED TO TRUE                           14350000
143600           MOVE 34 TO DP277-RETURN-CODE                           14360000
143700           MOVE '34'    TO TM007-RETURN-CODE                      14370000
143710           MOVE SQLCODE TO TM007-SQLCODE                          14371000
143720           MOVE SQLCA   TO TM007-SQLCA                            14372000
143730           MOVE '7100'  TO TM007-RETURNED-PARA                    14373000
143740           PERFORM 9900-SOFT-ABORT                                14374000
143750                                                                  14375000
143760       WHEN OTHER                                                 14376000
143770           SET PS-CURSOR-CLOSED TO TRUE                           14377000
143780           MOVE 35 TO DP277-RETURN-CODE                           14378000
143790           MOVE '35'    TO TM007-RETURN-CODE                      14379000
143800           MOVE SQLCODE TO TM007-SQLCODE                          14380000
143900           MOVE SQLCA   TO TM007-SQLCA                            14390000
144000           MOVE '7100'  TO TM007-RETURNED-PARA                    14400000
144100           PERFORM 9800-PGM-ABEND                                 14410000
144200     END-EVALUATE.                                                14420000
144300                                                                  14430000
144400******************************************************************14440000
144500******************************************************************14450000
144600 7110-FETCH-RECITM-CURSOR.                                        14460000
144700                                                                  14470000
144800     EXEC SQL                                                     14480000
144900         FETCH REC-LVL-CSR                                        14490000
145000          INTO :RECITM-REC-SEQ-NBR                                14500000
145100             , :RECITM-STATUS-CDE                                 14510000
145200     END-EXEC.                                                    14520000
145300                                                                  14530000
145400     EVALUATE TRUE                                                14540000
145500       WHEN SQLCODE = ZERO                                        14550000
145600           PERFORM 8000-FETCH-DRIVER-LINE                         14560000
145700           MOVE RECITM-PREPK-RATO-QTY TO PV-RECITM-RATO-QTY       14570000
145800           MOVE RECITM-ORD-LNE-NBR    TO DK-DRIVER-LINE-NBR       14580000
145900                                                                  14590000
146000       WHEN SQLCODE = +100                                        14600000
146100           SET PS-PRIOR-CURSOR-EOF TO TRUE                        14610000
146200                                                                  14620000
146300       WHEN OTHER                                                 14630000
146400           MOVE 36 TO DP277-RETURN-CODE                           14640000
146500           MOVE '36'    TO TM007-RETURN-CODE                      14650000
146600           MOVE SQLCODE TO TM007-SQLCODE                          14660000
146610           MOVE SQLCA   TO TM007-SQLCA                            14661000
146620           MOVE '7110'  TO TM007-RETURNED-PARA                    14662000
146630           PERFORM 9800-PGM-ABEND                                 14663000
146640     END-EVALUATE.                                                14664000
146650                                                                  14665000
146660******************************************************************14666000
146670******************************************************************14667000
146680 7120-CLOSE-RECITM-CURSOR.                                        14668000
146690                                                                  14669000
146700     EXEC SQL                                                     14670000
146800         CLOSE REC-LVL-CSR                                        14680000
146900     END-EXEC.                                                    14690000
147000                                                                  14700000
147100     EVALUATE TRUE                                                14710000
147200       WHEN SQLCODE = ZERO                                        14720000
147300           SET PS-CURSOR-CLOSED TO TRUE                           14730000
147400                                                                  14740000
147500       WHEN OTHER                                                 14750000
147600           MOVE 37 TO DP277-RETURN-CODE                           14760000
147700           MOVE '37'    TO TM007-RETURN-CODE                      14770000
147800           MOVE SQLCODE TO TM007-SQLCODE                          14780000
147900           MOVE SQLCA   TO TM007-SQLCA                            14790000
148000           MOVE '7120'  TO TM007-RETURNED-PARA                    14800000
148100           PERFORM 9800-PGM-ABEND                                 14810000
148200     END-EVALUATE.                                                14820000
148300                                                                  14830000
148400******************************************************************14840000
148500******************************************************************14850000
148600 7200-OPEN-RECITM-CURSOR.                                         14860000
148700                                                                  14870000
148800     EXEC SQL                                                     14880000
148900         OPEN PO-LVL-CSR                                          14890000
149000     END-EXEC.                                                    14900000
149100                                                                  14910000
149200     EVALUATE TRUE                                                14920000
149300       WHEN SQLCODE = ZERO                                        14930000
149400           SET PS-CURSOR-OPEN TO TRUE                             14940000
149500                                                                  14950000
149600       WHEN SQLCODE = -904                                        14960000
149700       WHEN SQLCODE = -911                                        14970000
149800       WHEN SQLCODE = -913                                        14980000
149900           SET PS-CURSOR-CLOSED TO TRUE                           14990000
150000           MOVE 38 TO DP277-RETURN-CODE                           15000000
150100           MOVE '38'    TO TM007-RETURN-CODE                      15010000
150200           MOVE SQLCODE TO TM007-SQLCODE                          15020000
150300           MOVE SQLCA   TO TM007-SQLCA                            15030000
150310           MOVE '7200'  TO TM007-RETURNED-PARA                    15031000
150320           PERFORM 9900-SOFT-ABORT                                15032000
150330                                                                  15033000
150340       WHEN OTHER                                                 15034000
150350           SET PS-CURSOR-CLOSED TO TRUE                           15035000
150360           MOVE 39 TO DP277-RETURN-CODE                           15036000
150370           MOVE '39'    TO TM007-RETURN-CODE                      15037000
150380           MOVE SQLCODE TO TM007-SQLCODE                          15038000
150390           MOVE SQLCA   TO TM007-SQLCA                            15039000
150400           MOVE '7200'  TO TM007-RETURNED-PARA                    15040000
150500           PERFORM 9800-PGM-ABEND                                 15050000
150600     END-EVALUATE.                                                15060000
150700                                                                  15070000
150800******************************************************************15080000
150900******************************************************************15090000
151000 7210-FETCH-RECITM-CURSOR.                                        15100000
151100                                                                  15110000
151200     EXEC SQL                                                     15120000
151300         FETCH PO-LVL-CSR                                         15130000
151400          INTO :RECITM-REC-SEQ-NBR                                15140000
151500             , :RECITM-STATUS-CDE                                 15150000
151600     END-EXEC.                                                    15160000
151700                                                                  15170000
151800     EVALUATE TRUE                                                15180000
151900       WHEN SQLCODE = ZERO                                        15190000
152000           PERFORM 8000-FETCH-DRIVER-LINE                         15200000
152100           MOVE RECITM-PREPK-RATO-QTY TO PV-RECITM-RATO-QTY       15210000
152200           MOVE RECITM-ORD-LNE-NBR    TO DK-DRIVER-LINE-NBR       15220000
152300                                                                  15230000
152400       WHEN SQLCODE = +100                                        15240000
152500           SET PS-PRIOR-CURSOR-EOF TO TRUE                        15250000
152600                                                                  15260000
152700       WHEN OTHER                                                 15270000
152800           MOVE 40 TO DP277-RETURN-CODE                           15280000
152900           MOVE '40'    TO TM007-RETURN-CODE                      15290000
153000           MOVE SQLCODE TO TM007-SQLCODE                          15300000
153100           MOVE SQLCA   TO TM007-SQLCA                            15310000
153200           MOVE '7210'  TO TM007-RETURNED-PARA                    15320000
153210           PERFORM 9800-PGM-ABEND                                 15321000
153220     END-EVALUATE.                                                15322000
153230                                                                  15323000
153240******************************************************************15324000
153250******************************************************************15325000
153260 7220-CLOSE-RECITM-CURSOR.                                        15326000
153270                                                                  15327000
153280     EXEC SQL                                                     15328000
153290         CLOSE PO-LVL-CSR                                         15329000
153300     END-EXEC.                                                    15330000
153400                                                                  15340000
153500     EVALUATE TRUE                                                15350000
153600       WHEN SQLCODE = ZERO                                        15360000
153700           SET PS-CURSOR-CLOSED TO TRUE                           15370000
153800                                                                  15380000
153900       WHEN OTHER                                                 15390000
154000           MOVE 41 TO DP277-RETURN-CODE                           15400000
154100           MOVE '41'    TO TM007-RETURN-CODE                      15410000
154200           MOVE SQLCODE TO TM007-SQLCODE                          15420000
154300           MOVE SQLCA   TO TM007-SQLCA                            15430000
154400           MOVE '7220'  TO TM007-RETURNED-PARA                    15440000
154500           PERFORM 9800-PGM-ABEND                                 15450000
154600     END-EVALUATE.                                                15460000
154700                                                                  15470000
154800******************************************************************15480000
154900******************************************************************15490000
155000 8000-FETCH-DRIVER-LINE.                                          15500000
155100                                                                  15510000
155200     EXEC SQL                                                     15520000
155300         SELECT DISTINCT                                          15530000
155400                PREPK_RATO_QTY                                    15540000
155500              , ORD_LNE_NBR                                       15550000
155600         INTO   :RECITM-PREPK-RATO-QTY                            15560000
155700              , :RECITM-ORD-LNE-NBR                               15570000
155800         FROM TRECITM                                             15580000
155900         WHERE ORD_NBR          = :DP277-PO-NBR                   15590000
156000         AND REC_SEQ_NBR        = :RECITM-REC-SEQ-NBR             15600000
156100         AND OPER_UNT_ID        = :DP277-OPER-UNT-ID              15610000
156200         AND PREPK_ID           = :DP277-PO-PREPK-ID              15620000
156300         AND PREPK_DRV_LNE_CDE  = 'A'                             15630000
156400     END-EXEC.                                                    15640000
156500                                                                  15650000
156600     EVALUATE TRUE                                                15660000
156700       WHEN SQLCODE = ZERO                                        15670000
156800           SET PS-DRIVER-LINE TO TRUE                             15680000
156900                                                                  15690000
157000       WHEN SQLCODE = +100                                        15700000
157100******************************************************************15710000
157200*NO DRIVER LINE CAN OCCUR IF THE RECEIVER IS A NON PREPACK       *15720000
157300*RECEIVER OR THE PREPACK LINE RECEIVER HAS BEEN DELETED.         *15730000
157400*THE RATIO QTY IS DEFAULTED TO THE PURITM RATIO.                 *15740000
157410******************************************************************15741000
157420           PERFORM 8010-FETCH-PURITM-RATIO                        15742000
157430           MOVE PURITM-PREPK-RATO-QTY  TO RECITM-PREPK-RATO-QTY   15743000
157440           MOVE ZEROES                 TO RECITM-ORD-LNE-NBR      15744000
157450           SET PS-NO-DRIVER-LINE TO TRUE                          15745000
157460                                                                  15746000
157470       WHEN SQLCODE = -904                                        15747000
157480       WHEN SQLCODE = -911                                        15748000
157490       WHEN SQLCODE = -913                                        15749000
157500           MOVE 42 TO DP277-RETURN-CODE                           15750000
157600           MOVE '42'    TO TM007-RETURN-CODE                      15760000
157700           MOVE SQLCODE TO TM007-SQLCODE                          15770000
157800           MOVE SQLCA   TO TM007-SQLCA                            15780000
157900           MOVE '8000'  TO TM007-RETURNED-PARA                    15790000
158000           PERFORM 9900-SOFT-ABORT                                15800000
158100                                                                  15810000
158200       WHEN OTHER                                                 15820000
158300           MOVE 43 TO DP277-RETURN-CODE                           15830000
158400           MOVE '43'    TO TM007-RETURN-CODE                      15840000
158500           MOVE SQLCODE TO TM007-SQLCODE                          15850000
158600           MOVE SQLCA   TO TM007-SQLCA                            15860000
158610           MOVE '8000'  TO TM007-RETURNED-PARA                    15861000
158620           PERFORM 9800-PGM-ABEND                                 15862000
158630     END-EVALUATE.                                                15863000
158640******************************************************************15864000
158650******************************************************************15865000
158660 8010-FETCH-PURITM-RATIO.                                         15866000
158670                                                                  15867000
158680     EXEC SQL                                                     15868000
158690         SELECT DISTINCT                                          15869000
158700                PREPK_RATO_QTY                                    15870000
158710         INTO   :PURITM-PREPK-RATO-QTY                            15871000
158720         FROM TPURITM                                             15872000
158730         WHERE PO_NBR           = :DP277-PO-NBR                   15873000
158740         AND   PO_LNE_NBR       = :DK-LINE-NBR                    15874000
158750         AND   VER_STATUS_CDE   = 'A'                             15875000
158760         AND   PO_PREPK_ID      = :DP277-PO-PREPK-ID              15876000
158770     END-EXEC.                                                    15877000
158780                                                                  15878000
158790     EVALUATE TRUE                                                15879000
158800       WHEN SQLCODE = ZERO                                        15880000
158801           CONTINUE                                               15880100
158802                                                                  15880200
158803       WHEN SQLCODE = +100                                        15880300
158804           MOVE 0                   TO PURITM-PREPK-RATO-QTY      15880400
158805                                                                  15880500
158806       WHEN SQLCODE = -904                                        15880600
158807       WHEN SQLCODE = -911                                        15880700
158808       WHEN SQLCODE = -913                                        15880800
158809           MOVE 42 TO DP277-RETURN-CODE                           15880900
158810           MOVE '42'    TO TM007-RETURN-CODE                      15881000
158820           MOVE SQLCODE TO TM007-SQLCODE                          15882000
158821           MOVE SQLCA   TO TM007-SQLCA                            15882100
158822           MOVE '8010'  TO TM007-RETURNED-PARA                    15882200
158823           PERFORM 9900-SOFT-ABORT                                15882300
158824                                                                  15882400
158825       WHEN OTHER                                                 15882500
158826           MOVE 43 TO DP277-RETURN-CODE                           15882600
158827           MOVE '43'    TO TM007-RETURN-CODE                      15882700
158828           MOVE SQLCODE TO TM007-SQLCODE                          15882800
158829           MOVE SQLCA   TO TM007-SQLCA                            15882900
158830           MOVE '8010'  TO TM007-RETURNED-PARA                    15883000
158831           PERFORM 9800-PGM-ABEND                                 15883100
158832     END-EVALUATE.                                                15883200
158833                                                                  15883300
158834******************************************************************15883400
158835******************************************************************15883500
158836 9000-NO-DISTRO-ERROR.                                            15883600
158842                                                                  15884200
158843     SET DP277-NO-DISTRO                                          15884300
158844         DP277-WARNING-ERROR TO TRUE.                             15884400
158845                                                                  15884500
158850     IF DP277-STORE-LEVEL-OTR                                     15885000
158860         PERFORM VARYING DP277-STR-IDX FROM 1 BY 1                15886000
158870           UNTIL DP277-STR-IDX > 250                              15887000
158880             MOVE ALL '*' TO DP277-STR-OTR-QTY-X(DP277-STR-IDX)   15888000
158890         END-PERFORM                                              15889000
158900     ELSE                                                         15890000
159000         MOVE ALL '*' TO DP277-LNE-OTR-QTY-X(DP277-LNE-IDX)       15900000
159100     END-IF.                                                      15910000
159200                                                                  15920000
159300******************************************************************15930000
159400*    WHEN A FATAL ERROR OCCURS PASS THE ERROR SWITCHES BACK TO    15940000
159500*    THE HOST PROGRAM AND WRITE TO THE CICS MESSAGE LOG.          15950000
159600******************************************************************15960000
159700 9800-PGM-ABEND.                                                  15970000
159800                                                                  15980000
159900     PERFORM VARYING DP277-LNE-ERR-IDX FROM 1 BY 1                15990000
160000       UNTIL DP277-LNE-ERR-IDX > 100                              16000000
160100         MOVE SPACES                                              16010000
160200                 TO DP277-LNE-OTR-QTY-X(DP277-LNE-ERR-IDX)        16020000
160300                    DP277-LNE-DISTRO-QTY-X(DP277-LNE-ERR-IDX)     16030000
160400         MOVE ZEROES                                              16040000
160500                 TO DP277-LNE-OTR-QTY(DP277-LNE-ERR-IDX)          16050000
160600                    DP277-LNE-DISTRO-QTY(DP277-LNE-ERR-IDX)       16060000
160700     END-PERFORM.                                                 16070000
160800                                                                  16080000
160900     PERFORM VARYING DP277-STR-ERR-IDX FROM 1 BY 1                16090000
161000       UNTIL DP277-STR-ERR-IDX > 250                              16100000
161100         MOVE SPACES                                              16110000
161200                 TO DP277-STR-OTR-QTY-X(DP277-STR-ERR-IDX)        16120000
161300                    DP277-STR-DISTRO-QTY-X(DP277-STR-ERR-IDX)     16130000
161400         MOVE ZEROES                                              16140000
161500                 TO DP277-STR-OTR-QTY(DP277-STR-ERR-IDX)          16150000
161600                    DP277-STR-DISTRO-QTY(DP277-STR-ERR-IDX)       16160000
161700     END-PERFORM.                                                 16170000
161800                                                                  16180000
161900     SET PS-ERRORS-YES TO TRUE.                                   16190000
162000                                                                  16200000
162100     SET DP277-FATAL-ERROR                                        16210000
162200         DP277-CROAK TO TRUE.                                     16220000
162300                                                                  16230000
162400     MOVE SQLCODE TO PV-SQLCODE.                                  16240000
162500     PERFORM 9950-FORMAT-ERROR-MSG.                               16250000
162600     PERFORM 9999-GOBACK.                                         16260000
162700                                                                  16270000
162800******************************************************************16280000
162900*    THE DB2 RESOURCE IS NOT AVAILABLE, PASS THE ERROR SWITCHES  *16290000
163000*    BACK TO THE HOST PROGRAM AND WRITE TO THE CICS MESSAGE LOG  *16300000
163100******************************************************************16310000
163200 9900-SOFT-ABORT.                                                 16320000
163300                                                                  16330000
163400     SET PS-ERRORS-YES                                            16340000
163500         DP277-FATAL-ERROR                                        16350000
163600         DP277-SOFT-ABORT TO TRUE.                                16360000
163700                                                                  16370000
163800     PERFORM 9950-FORMAT-ERROR-MSG.                               16380000
163900     PERFORM 9999-GOBACK.                                         16390000
164000                                                                  16400000
164100******************************************************************16410000
164200******************************************************************16420000
164300 9950-FORMAT-ERROR-MSG.                                           16430000
164400                                                                  16440000
164500     MOVE SQLCODE                TO PV-SQLCODE                    16450000
164600                                    PV-DISPLAY-SQLCODE.           16460000
164700                                                                  16470000
164800     MOVE DP277-PO-NBR           TO PV-DISP-PO-NBR                16480000
164900     IF DP277-PO-LNE-NBR = ZERO                                   16490000
165000         MOVE DK-LINE-NBR        TO PV-DISP-PO-LNE-NBR            16500000
165100     ELSE                                                         16510000
165200         MOVE DP277-PO-LNE-NBR   TO PV-DISP-PO-LNE-NBR            16520000
165300     END-IF                                                       16530000
165400     MOVE DP277-REC-SEQ-NBR      TO PV-DISP-REC-SEQ-NBR           16540000
165500     MOVE DP277-OPER-UNT-ID      TO PV-DISP-OPER-UNT-ID           16550000
165600     MOVE DP277-FCLTY-ID         TO PV-DISP-FCLTY-ID              16560000
165700     MOVE DP277-STR-NBR          TO PV-DISP-STR-NBR.              16570000
165800                                                                  16580000
165900     DISPLAY ' TMKUT019 ERROR MESSAGES  '                         16590000
166000     DISPLAY PV-RETURN-MSG                                        16600000
166100                                                                  16610000
166200     STRING  ' DP277-RC = ' DP277-RETURN-CODE                     16620000
166300             '; SQLCODE = ' PV-DISPLAY-SQLCODE                    16630000
166400                                  DELIMITED BY SIZE               16640000
166500                                 INTO PV-MESSAGE-TEXT             16650000
166600     DISPLAY PV-MESSAGE-TEXT.                                     16660000
166700                                                                  16670000
166800     MOVE '  PO    REC  LNE OPER FCLTY STR'                       16680000
166900                                   TO PV-MESSAGE-TEXT             16690000
167000     DISPLAY PV-MESSAGE-TEXT.                                     16700000
167100                                                                  16710000
167200     STRING                                                       16720000
167300         PV-DISP-PO-NBR '-'                                       16730000
167400         PV-DISP-REC-SEQ-NBR '-'                                  16740000
167500         PV-DISP-PO-LNE-NBR '-'                                   16750000
167600         PV-DISP-OPER-UNT-ID '-'                                  16760000
167700         PV-DISP-FCLTY-ID '-'                                     16770000
167800         PV-DISP-STR-NBR                                          16780000
167900         DELIMITED BY SIZE INTO PV-MESSAGE-TEXT.                  16790000
168000     DISPLAY PV-MESSAGE-TEXT.                                     16800000
168100                                                                  16810000
168200 9999-GOBACK.                                                     16820000
168300     MOVE DP277-COMMAREA            TO LINK-COMMAREA.             16830000
168400     MOVE TM007-COMMUNICATIONS-AREA TO LINK-TMRD007.              16840000
168500                                                                  16850000
168600     GOBACK.                                                      16860000
