000100*-----------------------*                                         00010018
000200 IDENTIFICATION DIVISION.                                         00020019
000210*-----------------------*                                         00021019
000220 PROGRAM-ID.    CNKCS233.                                         00022019
000230 AUTHOR.        BUDDY BARNES.                                     00023019
000240 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024019
000250 DATE-WRITTEN.  DEC 2011.                                         00025019
000260 DATE-COMPILED.                                                   00026019
000270*----------------------------------------------------------------*00027019
000280*    Y233 - DC-PROCESSING PARAMETERS AND FUNCTION CRIT SPEC      *00028019
000290*                                                                *00029019
000300*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00030019
000400*    SUBSEQUENT PROGRAMS.  FROM THIS SCREEN THE USER CAN PRESS:  *00040019
000500*    F13 TO ADD A CODE TO TKRPRCD                                *00050019
000600*    F15 TO UPDATE A CODE TO TKRPRCD                             *00060019
000700*    F17 TO ADD A PARM TO TKRPRPM                                *00070019
000710*    F18 TO UPDATE A PARM TO TKRPRPM                             *00071019
000720*    F23 TO DISPLAY A LIST OF CODES FROM TKRPRCD                 *00072019
000730*    F24 TO DISPLAY A LIST OF PARMS FROM TKRPRPM                 *00073019
000740*----------------------------------------------------------------*00074019
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00074143
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00074243
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00074343
263455*----------------------------------------------------------------*00074443
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00074544
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00074644
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00074744
CICS  *-----------------------------------------------------------------00074844
000750 ENVIRONMENT DIVISION.                                            00075019
000760 DATA DIVISION.                                                   00076019
000770                                                                  00077019
000780 WORKING-STORAGE SECTION.                                         00078019
000790                                                                  00079019
000800 01  DK-DB2-KEYS.                                                 00080019
000900     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00090019
001000     05  DK-PARM-NAME              PIC X(06)       VALUE SPACES.  00100019
001100                                                                  00110019
001200 01  PV-PROGRAM-VARIABLES.                                        00120019
001300     05  PV-CICS-RESPONSE          PIC S9(08)  VALUE ZEROES       00130019
001400                                   COMP SYNC.                     00140019
001500                                                                  00150019
001600     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     00160019
001700                                                    COMP SYNC.    00170019
001800                                                                  00180019
001900 01  PC-PROGRAM-CONSTANTS.                                        00190019
002000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'CNK233'.   00200019
002100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'CNKM233'.  00210019
002200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'CNKCS233'. 00220019
002300     05  PC-REPORT-PGM-1           PIC  X(08)  VALUE  'CNKCS233'. 00230019
002400     05  PC-01                     PIC  X(02)  VALUE  '01'.       00240019
002500     05  PC-DC                     PIC  X(02)  VALUE  'DC'.       00250019
002700     05  PC-B                      PIC  X(01)  VALUE  'B'.        00270019
002800     05  PC-D                      PIC  X(01)  VALUE  'D'.        00280019
002900     05  PC-N                      PIC  X(01)  VALUE  'N'.        00290019
003000     05  PC-U                      PIC  X(01)  VALUE  'U'.        00300019
003100     05  PC-V                      PIC  X(01)  VALUE  'V'.        00310019
003200     05  PC-Y                      PIC  X(01)  VALUE  'Y'.        00320019
003300     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00330019
003400                                               COMP-3.            00340019
003500*                                                                 00350019
003600 01  PS-PROGRAM-SWITCHES.                                         00360019
003700     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00370019
003800         88  PS-ERROR                          VALUE  'Y'.        00380019
003900         88  PS-NO-ERROR                       VALUE  'N'.        00390019
004000     05  PS-PARM-EXISTS-SW         PIC  X(01)  VALUE  'N'.        00400019
004100         88  PS-PARM-EXISTS                    VALUE  'Y'.        00410019
004200         88  PS-PARM-DOESNT-EXIST              VALUE  'N'.        00420019
004300                                                                  00430019
004400*----------------------------------------------------------------*00440019
004500*  SYSTEM MESSAGES                                               *00450019
004600*----------------------------------------------------------------*00460019
004700*   00005 - INVALID VALUE                                         00470019
004800*   00007 - REQUIRED ENTRY                                        00480019
004900*   00008 - MUST BE NUMERIC                                       00490019
005000*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00500019
005100*   02572 - INVALID VALUE - OPER UNIT ID MUST BE A DC LOCATION    00510019
005200*   03707 - ADD FUNCTION INVALID - FUNCTION CODE ALREADY DEFINED F00520019
005300*   03708 - UPDATE FUNCTION INVALID - FUNCTION CODE IS CURRENTLY N00530019
005400*   03709 - ADD FUNCTION INVALID - PARM CODE ALREADY DEFINED FOR D00540019
005500*   03710 - UPDATE FUNCTION INVALID - PARM CODE IS CURRENTLY NOT D00550019
005510*   03721 - ADD PARM INVALID - CODE IS NOT DEFINED               *00551037
005520*   03722 - UPD PARM INVALID - CODE IS NOT DEFINED               *00552037
005530*   03723 - UPD PARM INVALID - PARM NOT DEFINED FOR FACILITY     *00553042
005600*----------------------------------------------------------------*00560019
005700 01  PC-TSYMSG-NUMBERS.                                           00570019
005800     05  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.          00580019
005900     05  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.          00590019
006000     05  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.          00600019
006100     05  PC-TSYMSG-02571       PIC  9(05)  VALUE  02571.          00610019
006200     05  PC-TSYMSG-02572       PIC  9(05)  VALUE  02572.          00620019
006300     05  PC-TSYMSG-02573       PIC  9(05)  VALUE  02573.          00630019
006400     05  PC-TSYMSG-02574       PIC  9(05)  VALUE  02574.          00640019
006500     05  PC-TSYMSG-02575       PIC  9(05)  VALUE  02575.          00650019
006600     05  PC-TSYMSG-03707       PIC  9(05)  VALUE  03707.          00660019
006700     05  PC-TSYMSG-03708       PIC  9(05)  VALUE  03708.          00670019
006800     05  PC-TSYMSG-03709       PIC  9(05)  VALUE  03709.          00680019
006900     05  PC-TSYMSG-03710       PIC  9(05)  VALUE  03710.          00690019
006910     05  PC-TSYMSG-03721       PIC  9(05)  VALUE  03721.          00691037
006920     05  PC-TSYMSG-03722       PIC  9(05)  VALUE  03722.          00692037
006930     05  PC-TSYMSG-03723       PIC  9(05)  VALUE  03723.          00693042
007000*                                                                 00700019
007100 01  PM-PROGRAM-MESSAGES.                                         00710019
007200     05  PM-ABEND-INFO-A.                                         00720019
007300         10  FILLER                PIC X(15)   VALUE              00730019
007400                                   'DP020-SRC-AID: '.             00740019
007500         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00750019
007600         10  FILLER                PIC X(19)   VALUE              00760019
007700                                   '. DP020-FK-ACTION: '.         00770019
007800         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00780019
007900         10  FILLER                PIC X(22)   VALUE              00790019
008000                                   '. DP020-FK-DISPN-IND: '.      00800019
008100         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00810019
008200         10  FILLER                PIC X(01)   VALUE '.'.         00820019
008300         10  FILLER                PIC X(19)   VALUE SPACE.       00830019
008400                                                                  00840019
008500*----------------------------------------------------------------*00850019
008600*    MAP LAYOUT                                                  *00860019
008700*----------------------------------------------------------------*00870019
008800     COPY CNKM233.                                                00880019
008900                                                                  00890019
009000*----------------------------------------------------------------*00900019
009100*    ATTRIBUTE SETTINGS COPYBOOK.                                *00910019
009200*----------------------------------------------------------------*00920019
009300     COPY DPWS015.                                                00930019
009400                                                                  00940019
009500*----------------------------------------------------------------*00950019
009600*    FUNCTION KEYS COPYBOOK                                      *00960019
009700*----------------------------------------------------------------*00970019
009800     COPY DPWS016.                                                00980019
009900                                                                  00990019
010000******************************************************************01000019
010100** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01010019
010200** SUB-ROUTINE (DPKUT100).                                      **01020019
010300******************************************************************01030019
010400     COPY DPWS010I.                                               01040019
010500                                                                  01050019
010600******************************************************************01060019
010700** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01070019
010800** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01080019
010900******************************************************************01090019
011000     COPY DPWS030.                                                01100019
CICS       COPY DPWS930.                                                01101044
011100                                                                  01110019
011200***************************************************************** 01120019
011300*    STANDARD COMMAREA.                                           01130019
011400***************************************************************** 01140019
011500     COPY DPWS020.                                                01150019
011600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01160019
011700                                                                  01170019
011800***************************************************************** 01180019
011900*    INTER-APPLICATION COMMAREA.                                  01190019
012000***************************************************************** 01200019
012100         10  INTER-APPL-COMM-AREA PIC X(200).                     01210019
012200     COPY CNWS014.                                                01220019
012300                                                                  01230019
012400***************************************************************** 01240019
012500*    SPECIFIC COMMAREA FOR CNKCS233.                              01250019
012600***************************************************************** 01260019
012700         10  ASC-SPECIFIC-COMMAREA.                               01270022
012800             15  ASC-OPER-UNT-ID             PIC  X(04).          01280019
012900             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      01290019
013000                                             PIC  9(04).          01300019
013100             15  ASC-OPER-UNT-NAME           PIC  X(25).          01310019
013200             15  ASC-FUNCTION                PIC  X(02).          01320026
013210                 88  ASC-ADD-CODE                  VALUE 'AC'.    01321026
013220                 88  ASC-UPD-CODE                  VALUE 'UC'.    01322026
013230                 88  ASC-ADD-PARM                  VALUE 'AP'.    01323026
013240                 88  ASC-UPD-PARM                  VALUE 'UP'.    01324026
013300             15  ASC-PARM-NAME               PIC  X(06).          01330019
013400             15  ASC-PARM-DESC               PIC  X(40).          01340019
013500             15  ASC-PARM-TYPE               PIC  X(02).          01350019
013600             15  FILLER                      PIC  X(122).         01360019
013700                                                                  01370019
013800*----------------------------------------------------------------*01380019
013900*    ABEND PROCESSING COPYBOOK.                                  *01390019
014000*----------------------------------------------------------------*01400019
014100     COPY DPWS013.                                                01410019
014200                                                                  01420019
014300*----------------------------------------------------------------*01430019
014400*    RC - KOHLS TO RETEK PROCESSING PARAMETERS                    01440019
014500*----------------------------------------------------------------*01450019
014600     EXEC SQL                                                     01460019
014700          INCLUDE TKRPRPM                                         01470019
014800     END-EXEC.                                                    01480019
014900                                                                  01490019
015000*----------------------------------------------------------------*01500019
015100*    RC - KOHLS TO RETEK PROCESSING FUNCTION CODE                 01510019
015200*----------------------------------------------------------------*01520019
015300     EXEC SQL                                                     01530019
015400          INCLUDE TKRPRCD                                         01540019
015500     END-EXEC.                                                    01550019
015600                                                                  01560019
015700*----------------------------------------------------------------*01570019
015800*    COMMAREA USED TO CALL XLKUT071                               01580019
015900*----------------------------------------------------------------*01590019
016000     COPY XLWS071.                                                01600019
016100                                                                  01610019
016200*----------------------------------------------------------------*01620019
016300*  COMMUNICATION AREAS FOR DB2                                    01630019
016400*----------------------------------------------------------------*01640019
016500     EXEC SQL                                                     01650019
016600         INCLUDE SQLCA                                            01660019
016700     END-EXEC.                                                    01670019
016800                                                                  01680019
016900*----------------------------------------------------------------*01690019
017000 LINKAGE SECTION.                                                 01700019
017100                                                                  01710019
017200 01  DFHCOMMAREA.                                                 01720019
017300     05  FILLER                         OCCURS  1 TO 4072 TIMES   01730019
017400                                        DEPENDING ON EIBCALEN.    01740019
017500         10  FILLER                     PIC X.                    01750019
017600                                                                  01760019
017700                                                                  01770019
017800 PROCEDURE DIVISION.                                              01780019
017900***************************************************************** 01790019
018000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01800019
018100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01810019
018200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01820019
018300**                                                             ** 01830019
018400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01840019
018500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01850019
018600***************************************************************** 01860019
018700 0000-MAIN-MODULE.                                                01870019
018800     INITIALIZE DP030-CICS-API-FIELDS.                            01880019
018900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01890019
019000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01900019
019100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01910019
019200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01920019
019300     MOVE LENGTH OF CNK233I       TO DP030-MAP-LENGTH (1).        01930019
019400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01940019
019500     PERFORM 0001-CALL-CICS-ARCH-API.                             01950019
019600*                                                                 01960019
019700     PERFORM 1000-CONTROL-PROCESSING                              01970019
019800*                                                                 01980019
019900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01990019
020000     PERFORM 0001-CALL-CICS-ARCH-API.                             02000019
020100                                                                  02010019
020200*---------------------------------------------------------------- 02020019
020300 0001-CALL-CICS-ARCH-API.                                         02030019
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02040044
020500                                    DFHCOMMAREA                   02050044
020600                                    DP030-CICS-API-FIELDS         02060044
020700                                    DP020-STANDARD-COMMAREA       02070044
020800                                    CNK233I.                      02080044
020900*                                                                 02090019
021000     IF  DP030-RC-CALL-SUCCESSFUL                                 02100019
021100         CONTINUE                                                 02110019
021200     ELSE                                                         02120019
021300         SET DP013-NO-ROLLBACK                                    02130019
021400             DP013-XCTL-DISPLAY-RESTART                           02140019
021500             DP013-CICS-ABEND      TO TRUE                        02150019
021600         MOVE 'BEFORE 0000-MAIN-MODULE'                           02160019
021700                                   TO DP013-PARAGRAPH             02170019
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02171044
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02172044
022000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02200019
022100         PERFORM DP013-0000-PROCESS-ABEND                         02210019
022200     END-IF.                                                      02220019
022300                                                                  02230019
022400*----------------------------------------------------------------*02240019
022500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02250019
022600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02260019
022700*----------------------------------------------------------------*02270019
022800 1000-CONTROL-PROCESSING.                                         02280019
022900                                                                  02290019
023000     EVALUATE TRUE                                                02300019
023100         WHEN DP020-NEXT-ACT-INITIAL                              02310019
023200             INITIALIZE ASC-SPECIFIC-COMMAREA                     02320019
023300             MOVE DP020-LOCATION-NBR TO ASC-OPER-UNT-ID           02330019
023400             PERFORM 4000-BUILD-INITIAL-PANEL                     02340019
023500             PERFORM 3200-RESET-ATTRIBUTES                        02350019
023600                                                                  02360019
023700         WHEN DP020-NEXT-ACT-RETURN                               02370019
023800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02380019
023900             PERFORM 3200-RESET-ATTRIBUTES                        02390019
024000                                                                  02400019
024100         WHEN DP020-NEXT-ACT-READ-MAP                             02410019
024200             PERFORM 2000-FKEY-PROCESSING                         02420019
024300                                                                  02430019
024400         WHEN OTHER                                               02440019
024500             SET DP013-LOGIC-ABEND                                02450019
024600                 DP013-NO-ROLLBACK TO TRUE                        02460019
024700             MOVE 'CNKCS233 - 1000-CONTROL-PROCESSING'            02470019
024800                                   TO  DP013-PARAGRAPH            02480019
024900             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02490019
025000                                   TO  DP013-MESSAGE-TEXT(1)      02500019
025100             MOVE DP020-NEXT-APPL-ACTIVITY                        02510019
025200                                   TO DP013-MESSAGE-TEXT(2)       02520019
025300             PERFORM DP013-0000-PROCESS-ABEND                     02530019
025400     END-EVALUATE.                                                02540019
025500                                                                  02550019
025600*----------------------------------------------------------------*02560019
025700* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02570019
025800* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02580019
025900* EDITS.                                                         *02590019
026000*----------------------------------------------------------------*02600019
026100 2000-FKEY-PROCESSING.                                            02610019
026200                                                                  02620019
026300     EVALUATE TRUE                                                02630019
026400                                                                  02640019
026500         WHEN DP020-SRC-AID = DP016-CLEAR                         02650019
026600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02660019
026700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02670019
026800                                                                  02680019
026900*F5-REFRESH                                                       02690019
027000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02700019
027100             INITIALIZE ASC-SPECIFIC-COMMAREA                     02710019
027200             MOVE SPACES          TO AOPRUNTO                     02720019
027300                                     AOPRNMEO                     02730019
027400                                     APRMNMEO                     02740019
027500                                     APRMDSCO                     02750019
027600                                     APRMTYPO                     02760019
027700             MOVE DP020-LOCATION-NBR TO ASC-OPER-UNT-ID           02770019
027800             PERFORM 4000-BUILD-INITIAL-PANEL                     02780019
027900             PERFORM 3200-RESET-ATTRIBUTES                        02790019
028000                                                                  02800019
028100         WHEN OTHER                                               02810019
028200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02820019
028300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02830019
028400             IF  PS-NO-ERROR                                      02840019
028500                 SET DP030-CONTINUE-GO TO TRUE                    02850019
028600                 PERFORM 2100-CHECK-FUNCTION-KEY                  02860019
028700                 IF  PS-ERROR                                     02870019
028800                     SET DP030-OVERRIDE-GO TO TRUE                02880019
028900                 END-IF                                           02890019
029000             ELSE                                                 02900019
029100                 SET DP030-OVERRIDE-GO TO TRUE                    02910019
029200             END-IF                                               02920019
029300     END-EVALUATE.                                                02930019
029400                                                                  02940019
029500******************************************************************02950019
029600** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02960019
029700** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02970019
029800** FROM THE CICS ARCHITECTURE API.                              **02980019
029900******************************************************************02990019
030000 2100-CHECK-FUNCTION-KEY.                                         03000019
030100     EVALUATE TRUE                                                03010019
030200                                                                  03020019
030300         WHEN DP020-SRC-AID = DP016-ENTER                         03030019
030310               IF  ASC-PARM-NAME > SPACES                         03031039
030392                   MOVE SPACES  TO  ASC-FUNCTION                  03039239
030393                   PERFORM 3040-CHECK-4-ROW-ON-KRPRCD             03039339
030394                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03039439
030395               END-IF                                             03039539
030400                                                                  03040021
030900           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03090019
031000                                                                  03100019
031100*F13 ADDCODE  ----> GOES TO CNKCS234 TO PROCESS A CODE ADD        03110019
031200         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03120019
031300           IF  ASC-OPER-UNT-ID = SPACES                           03130019
031400               SET PS-ERROR                                       03140019
031500                   DP020-MSG-FATAL         TO TRUE                03150019
031600               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03160019
031700               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03170019
031800               MOVE DP015-RED              TO AOPRUNTC            03180019
031900               MOVE DP015-REVERSE          TO AOPRUNTH            03190019
032000               MOVE -1                     TO AOPRUNTL            03200019
032100               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03210019
032200               MOVE SPACES                 TO AOPRNMEO            03220019
032300           ELSE                                                   03230019
032400               PERFORM 3030-CHECK-4-ROW-ON-KRPRCD                 03240019
032500               SET  ASC-ADD-CODE  TO  TRUE                        03250026
032600               PERFORM 2110-PREPARE-INTER-APPL-COMM               03260019
032700           END-IF                                                 03270019
032800           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03280019
032900                                                                  03290019
033000*F15 UPDCODE  ----> GOES TO CNKCS234 TO PROCESS A CODE UPDATE     03300019
033100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03310019
033200           IF  ASC-OPER-UNT-ID = SPACES                           03320019
033300               SET PS-ERROR                                       03330019
033400                   DP020-MSG-FATAL         TO TRUE                03340019
033500               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03350019
033600               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03360019
033700               MOVE DP015-RED              TO AOPRUNTC            03370019
033800               MOVE DP015-REVERSE          TO AOPRUNTH            03380019
033900               MOVE -1                     TO AOPRUNTL            03390019
034000               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03400019
034100               MOVE SPACES                 TO AOPRNMEO            03410019
034200           ELSE                                                   03420019
034300               IF  ASC-PARM-NAME = SPACES                         03430019
034400                   SET PS-ERROR                                   03440019
034500                       DP020-MSG-FATAL         TO TRUE            03450019
034600                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03460019
034700                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03470019
034800                   MOVE DP015-RED              TO APRMNMEC        03480019
034900                   MOVE DP015-REVERSE          TO APRMNMEH        03490019
035000                   MOVE -1                     TO APRMNMEL        03500019
035100                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03510019
035200               ELSE                                               03520019
035300                   SET  ASC-UPD-CODE  TO  TRUE                    03530026
035400                   PERFORM 3040-CHECK-4-ROW-ON-KRPRCD             03540019
035500                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03550019
035600               END-IF                                             03560019
035700           END-IF                                                 03570019
035800           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03580019
035900                                                                  03590019
036000*F17 ADDPARM  ----> GOES TO CNKCS235 TO PROCESS A PARM ADD        03600019
036100         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              03610019
036200           IF  ASC-OPER-UNT-ID = SPACES                           03620019
036300               SET PS-ERROR                                       03630019
036400                   DP020-MSG-FATAL         TO TRUE                03640019
036500               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03650019
036600               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03660019
036700               MOVE DP015-RED              TO AOPRUNTC            03670019
036800               MOVE DP015-REVERSE          TO AOPRUNTH            03680019
036900               MOVE -1                     TO AOPRUNTL            03690019
037000               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03700019
037100               MOVE SPACES                 TO AOPRNMEO            03710019
037110           ELSE                                                   03711028
037120               IF  ASC-PARM-NAME = SPACES                         03712028
037130                   SET PS-ERROR                                   03713028
037140                       DP020-MSG-FATAL         TO TRUE            03714028
037150                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03715028
037160                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03716028
037170                   MOVE DP015-RED              TO APRMNMEC        03717028
037180                   MOVE DP015-REVERSE          TO APRMNMEH        03718028
037190                   MOVE -1                     TO APRMNMEL        03719028
037191                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03719128
037200               ELSE                                               03720028
037500                   SET  ASC-ADD-PARM  TO  TRUE                    03750033
037510                   PERFORM 3040-CHECK-4-ROW-ON-KRPRCD             03751035
037600                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03760033
037705               END-IF                                             03770528
037706           END-IF                                                 03770628
037707           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03770728
037708                                                                  03770828
037709*F18 UPDPARM  ----> GOES TO CNKCS235 TO PROCESS A PARM UPDATE     03770928
037710         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              03771028
037711           IF  ASC-OPER-UNT-ID = SPACES                           03771128
037720               SET PS-ERROR                                       03772003
037730                   DP020-MSG-FATAL         TO TRUE                03773003
037740               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03774003
037750               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03775003
037760               MOVE DP015-RED              TO AOPRUNTC            03776003
037770               MOVE DP015-REVERSE          TO AOPRUNTH            03777003
037780               MOVE -1                     TO AOPRUNTL            03778003
037790               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03779003
037800               MOVE SPACES                 TO AOPRNMEO            03780003
037810           ELSE                                                   03781003
037811               IF  ASC-PARM-NAME = SPACES                         03781128
037812                   SET PS-ERROR                                   03781228
037813                       DP020-MSG-FATAL         TO TRUE            03781328
037814                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03781428
037815                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03781528
037816                   MOVE DP015-RED              TO APRMNMEC        03781628
037817                   MOVE DP015-REVERSE          TO APRMNMEH        03781728
037818                   MOVE -1                     TO APRMNMEL        03781828
037819                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03781928
037820               ELSE                                               03782028
037830                   SET   ASC-UPD-PARM  TO  TRUE                   03783028
037831                   PERFORM 3045-CHECK-4-ROW-ON-KRPRPM             03783140
037840                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03784028
037850               END-IF                                             03785028
037851           END-IF                                                 03785128
037860           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03786003
037900                                                                  03790001
038000*F23 CODELIST ----> GOES TO CNKCS236 TO LIST CODES                03800003
038100         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              03810003
038200           IF  ASC-OPER-UNT-ID = SPACES                           03820003
038300               SET PS-ERROR                                       03830003
038310                   DP020-MSG-FATAL         TO TRUE                03831003
038320               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03832003
038330               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03833003
038340               MOVE DP015-RED              TO AOPRUNTC            03834003
038350               MOVE DP015-REVERSE          TO AOPRUNTH            03835003
038360               MOVE -1                     TO AOPRUNTL            03836003
038370               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03837003
038380               MOVE SPACES                 TO AOPRNMEO            03838003
038390           ELSE                                                   03839003
038391               PERFORM 2110-PREPARE-INTER-APPL-COMM               03839103
038392           END-IF                                                 03839203
038393           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03839303
038400                                                                  03840001
038500*F24 PARMLIST ----> GOES TO CNKCS237 TO LIST PARMS                03850003
038600         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              03860003
038700           IF  ASC-OPER-UNT-ID = SPACES                           03870001
038800               SET PS-ERROR                                       03880001
038900                   DP020-MSG-FATAL         TO TRUE                03890001
039000               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER    03900001
039100               MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA            03910001
039110               MOVE DP015-RED              TO AOPRUNTC            03911001
039120               MOVE DP015-REVERSE          TO AOPRUNTH            03912001
039130               MOVE -1                     TO AOPRUNTL            03913001
039140               SET DP030-SET-CURSOR-APPL-1 TO TRUE                03914001
039150               MOVE SPACES                 TO AOPRNMEO            03915001
039160           ELSE                                                   03916001
039161               IF  ASC-PARM-NAME = SPACES                         03916128
039162                   SET PS-ERROR                                   03916228
039163                       DP020-MSG-FATAL         TO TRUE            03916328
039164                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     03916428
039165                   MOVE DP015-UNP-ALP-BRT-OFF  TO APRMNMEA        03916528
039166                   MOVE DP015-RED              TO APRMNMEC        03916628
039167                   MOVE DP015-REVERSE          TO APRMNMEH        03916728
039168                   MOVE -1                     TO APRMNMEL        03916828
039169                   SET DP030-SET-CURSOR-APPL-1 TO TRUE            03916928
039170               ELSE                                               03917028
039171                   PERFORM 2110-PREPARE-INTER-APPL-COMM           03917128
039180               END-IF                                             03918028
039181           END-IF                                                 03918128
039190           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   03919001
039200                                                                  03920001
039580     END-EVALUATE.                                                03958001
039590                                                                  03959001
039600******************************************************************03960001
039700** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03970001
039800** INTER-APPLICATION COMMAREA.                                  **03980001
039900******************************************************************03990001
040000 2110-PREPARE-INTER-APPL-COMM.                                    04000001
040100                                                                  04010001
040200     INITIALIZE CN014-INTER-APPL-COMMAREA.                        04020003
040300                                                                  04030001
040400     MOVE ASC-FUNCTION             TO CN014-FUNCTION.             04040003
040800     MOVE ASC-OPER-UNT-ID          TO CN014-OPER-UNT-ID.          04080003
041000     MOVE ASC-OPER-UNT-NAME        TO CN014-OPER-UNT-NAME.        04100004
041100     MOVE ASC-PARM-NAME            TO CN014-PARM-NAME.            04110003
041200     MOVE ASC-PARM-DESC            TO CN014-PARM-DESC.            04120003
041210     MOVE ASC-PARM-TYPE            TO CN014-PARM-TYPE.            04121003
041260                                                                  04126001
041270*----------------------------------------------------------------*04127001
041280* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04128001
041290* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04129001
041300* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04130001
041400*----------------------------------------------------------------*04140001
041500 2200-MOVE-SCREEN-TO-COMMAREA.                                    04150001
041600*OPER UNT ID                                                      04160001
041700     IF  AOPRUNTL > ZERO                                          04170001
041800         MOVE AOPRUNTI      TO ASC-OPER-UNT-ID                    04180001
041900     ELSE                                                         04190001
042000         IF AOPRUNTF = DP015-ERASE-EOF                            04200001
042100            MOVE SPACES      TO ASC-OPER-UNT-ID                   04210001
042200         END-IF                                                   04220001
042300     END-IF.                                                      04230001
042400*                                                                 04240001
042500*PARM NAME                                                        04250004
042600     IF  APRMNMEL > ZERO                                          04260004
042700         MOVE APRMNMEI              TO ASC-PARM-NAME              04270004
042800     ELSE                                                         04280001
042900         IF APRMNMEF = DP015-ERASE-EOF                            04290005
043000            MOVE SPACES            TO ASC-PARM-NAME               04300004
043100         END-IF                                                   04310001
043200     END-IF.                                                      04320001
043300*                                                                 04330001
043400*PARM DESC                                                        04340004
043500     IF  APRMDSCL > ZERO                                          04350004
043600         MOVE APRMDSCI             TO ASC-PARM-DESC               04360004
043700     ELSE                                                         04370001
043800         IF APRMDSCF = DP015-ERASE-EOF                            04380004
043900            MOVE SPACES            TO ASC-PARM-DESC               04390004
044000         END-IF                                                   04400001
044100     END-IF.                                                      04410001
044200                                                                  04420001
044210*PARM TYPE                                                        04421004
044220     IF  APRMTYPL > ZERO                                          04422004
044230         MOVE APRMTYPI             TO ASC-PARM-TYPE               04423005
044240     ELSE                                                         04424004
044250         IF APRMTYPF = DP015-ERASE-EOF                            04425005
044260            MOVE SPACES            TO ASC-PARM-TYPE               04426005
044270         END-IF                                                   04427004
044280     END-IF.                                                      04428004
044290                                                                  04429004
044300******************************************************************04430001
044400* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *04440001
044500* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *04450001
044600* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE     *04460001
044700* DONE IN THE DESTINATION PROGRAM, NOT HERE.                     *04470001
044800******************************************************************04480001
044900 3000-EDIT-DATA-IN-COMMAREA.                                      04490001
045000     PERFORM 3200-RESET-ATTRIBUTES.                               04500001
045100                                                                  04510001
045200*EDIT OPER UNIT TO MAKE SURE NUMERIC                              04520001
045300     IF  ASC-OPER-UNT-ID NOT = SPACES                             04530001
045400         MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD         04540001
045500         MOVE LENGTH OF ASC-OPER-UNT-ID TO DP010I-MAXIMUM-DIGITS  04550001
045600         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       04560001
045700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  04570001
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04581043
263455              USING DP010I-NUMERIC-EDIT-AREA                      04582043
045900         IF  DP010I-ERROR-DETECTED                                04590001
046000             SET PS-ERROR                                         04600001
046100                 DP020-MSG-FATAL         TO TRUE                  04610001
046200             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      04620001
046300             MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA              04630001
046400             MOVE DP015-RED              TO AOPRUNTC              04640001
046500             MOVE DP015-REVERSE          TO AOPRUNTH              04650001
046600             MOVE -1                     TO AOPRUNTL              04660001
046700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04670001
046800             MOVE SPACES                 TO AOPRNMEO              04680001
046900         ELSE                                                     04690001
047000             MOVE DP010I-NUMERIC-FIELD TO ASC-OPER-UNT-ID-N       04700001
047100             MOVE ASC-OPER-UNT-ID      TO AOPRUNTO                04710001
047200*VALIDATE OPER UNIT                                               04720001
047300             PERFORM 3010-VALIDATE-OPER-UNT-ID                    04730001
047400             IF PS-ERROR                                          04740001
047500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04750001
047600             END-IF                                               04760001
047700         END-IF                                                   04770001
047800     END-IF.                                                      04780001
048400                                                                  04840001
048500                                                                  04850001
048600****************************************************************  04860001
048700*    VERIFY OPER UNIT ID.                                      *  04870001
048800*                                                              *  04880001
048900****************************************************************  04890001
049000                                                                  04900001
049100 3010-VALIDATE-OPER-UNT-ID.                                       04910001
049200                                                                  04920001
049300     INITIALIZE XL071-COMMAREA.                                   04930001
049400     MOVE ASC-OPER-UNT-ID TO XL071-LOCATION-NUMBER.               04940001
049500                                                                  04950001
049600     CALL XL071-LOCATION-MODULE USING                             04960001
049700                                DFHEIBLK                          04970001
049800                                XL071-COMMAREA                    04980001
049900                                XL071-COMMAREA-REC.               04990001
050000                                                                  05000001
050100     EVALUATE TRUE                                                05010001
050200         WHEN XL071-NO-ERRORS                                     05020001
050300         WHEN XL071-DC-ASGMT-NOT-FND                              05030013
050400              MOVE XL071-LOC-NM TO ASC-OPER-UNT-NAME              05040004
051800                                                                  05180001
051900         WHEN XL071-LOC-NOT-FOUND                                 05190001
052000              MOVE 'NAME NOT FOUND'   TO ASC-OPER-UNT-NAME        05200004
052100              SET PS-ERROR                                        05210001
052200                  DP020-MSG-FATAL         TO TRUE                 05220001
052300              MOVE PC-TSYMSG-02572        TO DP020-MSG-NUMBER     05230001
052400              MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA             05240001
052500              MOVE DP015-RED              TO AOPRUNTC             05250001
052600              MOVE DP015-REVERSE          TO AOPRUNTH             05260001
052700              MOVE -1                     TO AOPRUNTL             05270001
052800              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 05280001
052900              MOVE SPACES                 TO AOPRNMEO             05290001
053000                                                                  05300001
053100         WHEN OTHER                                               05310001
053200              MOVE '3010-VALIDATE-OPER-UNT-ID'                    05320001
053300                                  TO DP013-PARAGRAPH              05330001
053400              STRING 'SELECT STORE NUMBER - '                     05340001
053500                      XL071-LOCATION-NUMBER                       05350001
053600                     ' - BAD RETURN CODE FROM XLKUT071 - '        05360001
053700                      XL071-RETURN-CODE                           05370001
053800                      DELIMITED BY SIZE                           05380001
053900                      INTO DP013-MESSAGE-TEXT (1)                 05390001
054000              STRING 'SQLCODE - '                                 05400001
054100                      XL071-SQLCODE                               05410001
054200                     ' - '                                        05420001
054300                      XL071-DB2-TABLE                             05430001
054400                      DELIMITED BY SIZE                           05440001
054500                      INTO DP013-MESSAGE-TEXT (2)                 05450001
054600              MOVE XL071-SQLCA     TO DP013-SQLCA                 05460001
054700              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)    05470001
054800              MOVE XL071-SQLCODE TO SQLCODE                       05480001
054900              SET DP013-DB2-ABEND                                 05490001
055000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              05500001
055100              PERFORM DP013-0000-PROCESS-ABEND                    05510001
055200                                                                  05520001
055300     END-EVALUATE.                                                05530001
055400                                                                  05540001
055500                                                                  05550001
059700******************************************************************05970001
059800** CHECK FOR ROW ON KRPRCD - IF NO ROW  - GOTO CNKCS234           05980006
059900******************************************************************05990001
060000 3030-CHECK-4-ROW-ON-KRPRCD.                                      06000006
060200      MOVE ASC-PARM-NAME     TO DK-PARM-NAME.                     06020006
060300                                                                  06030001
060400        EXEC SQL                                                  06040001
060500          SELECT  A.SYS_PRC_FUNC_CDE                              06050006
060600                 ,A.SYS_PRC_FUNC_DESC                             06060006
060700                 ,A.PRC_FUNC_TYP_CDE                              06070006
060900            INTO :KRPRCD-SYS-PRC-FUNC-CDE                         06090006
061000                ,:KRPRCD-SYS-PRC-FUNC-DESC                        06100006
061100                ,:KRPRCD-PRC-FUNC-TYP-CDE                         06110006
061300            FROM  TKRPRCD A                                       06130006
061500           WHERE  A.SYS_PRC_FUNC_CDE = :DK-PARM-NAME              06150006
061900        END-EXEC                                                  06190001
062000                                                                  06200001
062100        EVALUATE TRUE                                             06210001
062200            WHEN SQLCODE = +0                                     06220001
062210                  MOVE KRPRCD-SYS-PRC-FUNC-DESC TO                06221020
062220                              ASC-PARM-DESC                       06222021
062230                  MOVE KRPRCD-PRC-FUNC-TYP-CDE  TO                06223020
062240                              ASC-PARM-TYPE                       06224020
062300                SET PS-ERROR                                      06230001
062400                    DP020-MSG-FATAL         TO TRUE               06240001
062500                MOVE PC-TSYMSG-03707        TO DP020-MSG-NUMBER   06250027
062600                MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA           06260001
062700                                               APRMNMEA           06270006
062800                MOVE DP015-RED              TO AOPRUNTC           06280001
062900                                               APRMNMEC           06290006
063000                MOVE DP015-REVERSE          TO AOPRUNTH           06300001
063100                                               APRMNMEH           06310006
063200                MOVE -1                     TO APRMNMEL           06320006
063300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               06330001
063400*--OPER UNT ID MUST EQUAL CURR OPER UNT ID INORDER TO ADD.        06340001
063500            WHEN SQLCODE = +100                                   06350001
063700                 SET  ASC-ADD-CODE   TO  TRUE                     06370031
065200            WHEN SQLWARN0 NOT = SPACES                            06520001
065300            WHEN SQLCODE < +0                                     06530001
065400            WHEN SQLCODE > +0                                     06540001
065500                MOVE '3030-CHECK-4-ROW-ON-KRPRCD'                 06550006
065600                                          TO DP013-PARAGRAPH      06560001
065700                MOVE 'PROBLEM WITH RETRIEVING ROW'                06570001
065800                                    TO DP013-MESSAGE-TEXT (1)     06580001
065900                MOVE SQLCA      TO DP013-SQLCA                    06590001
066000                MOVE 'TKRPRCD'  TO DP013-DB2-TABLE-NAME (1)       06600006
066100                SET DP013-DB2-ABEND                               06610001
066200                    DP013-XCTL-DISPLAY-RESTART TO TRUE            06620001
066300                PERFORM DP013-0000-PROCESS-ABEND                  06630001
066400        END-EVALUATE.                                             06640001
066500                                                                  06650001
073800                                                                  07380001
073900******************************************************************07390032
074000** CHECK FOR ROW ON KRPRCD - IF A ROW EXISTS  - GOTO CNKCS225     07400032
074100******************************************************************07410032
074200 3040-CHECK-4-ROW-ON-KRPRCD.                                      07420032
074300      MOVE ASC-OPER-UNT-ID   TO DK-OPER-UNT-ID.                   07430032
074400      MOVE ASC-PARM-NAME     TO DK-PARM-NAME.                     07440035
074500                                                                  07450035
074600        EXEC SQL                                                  07460035
074610          SELECT  A.SYS_PRC_FUNC_CDE                              07461035
074620                 ,A.SYS_PRC_FUNC_DESC                             07462035
074630                 ,A.PRC_FUNC_TYP_CDE                              07463035
074640            INTO :KRPRCD-SYS-PRC-FUNC-CDE                         07464035
074650                ,:KRPRCD-SYS-PRC-FUNC-DESC                        07465035
074660                ,:KRPRCD-PRC-FUNC-TYP-CDE                         07466035
074670            FROM  TKRPRCD A                                       07467035
074680           WHERE  A.SYS_PRC_FUNC_CDE = :DK-PARM-NAME              07468035
074690        END-EXEC                                                  07469035
074691                                                                  07469135
074692        EVALUATE TRUE                                             07469235
074693            WHEN SQLCODE = +0                                     07469335
074695                  MOVE KRPRCD-SYS-PRC-FUNC-DESC TO                07469535
074696                              ASC-PARM-DESC                       07469635
074697                  MOVE KRPRCD-PRC-FUNC-TYP-CDE  TO                07469735
074698                              ASC-PARM-TYPE                       07469835
074710                                                                  07471035
074711            WHEN SQLCODE = +100                                   07471135
074712                SET PS-ERROR                                      07471235
074713                    DP020-MSG-FATAL         TO TRUE               07471335
074714                EVALUATE TRUE                                     07471438
074715                    WHEN ASC-UPD-CODE                             07471538
074716                         MOVE PC-TSYMSG-03710                     07471638
074717                                            TO DP020-MSG-NUMBER   07471738
074719                    WHEN ASC-ADD-PARM                             07471938
074721                         MOVE PC-TSYMSG-03721                     07472138
074722                                            TO DP020-MSG-NUMBER   07472238
074723                    WHEN OTHER                                    07472338
074724                         MOVE PC-TSYMSG-03722                     07472438
074725                                            TO DP020-MSG-NUMBER   07472538
074726                END-EVALUATE                                      07472638
074727                MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA           07472738
074728                                               APRMNMEA           07472838
074729                MOVE DP015-RED              TO AOPRUNTC           07472938
074730                                               APRMNMEC           07473038
074731                MOVE DP015-REVERSE          TO AOPRUNTH           07473138
074732                                               APRMNMEH           07473238
074733                MOVE -1                     TO APRMNMEL           07473338
074734                SET DP030-SET-CURSOR-APPL-1 TO TRUE               07473438
074735            WHEN SQLWARN0 NOT = SPACES                            07473538
074736            WHEN SQLCODE < +0                                     07473638
074737            WHEN SQLCODE > +0                                     07473738
074738                MOVE '3040-CHECK-4-ROW-ON-KRPRCD'                 07473840
074739                                          TO DP013-PARAGRAPH      07473938
074740                MOVE 'PROBLEM WITH RETRIEVING ROW'                07474038
074741                                    TO DP013-MESSAGE-TEXT (1)     07474138
074742                MOVE SQLCA      TO DP013-SQLCA                    07474238
074743                MOVE 'TKRPRCD'  TO DP013-DB2-TABLE-NAME (1)       07474338
074744                SET DP013-DB2-ABEND                               07474438
074745                    DP013-XCTL-DISPLAY-RESTART TO TRUE            07474538
074746                PERFORM DP013-0000-PROCESS-ABEND                  07474638
074747        END-EVALUATE.                                             07474738
074748                                                                  07474838
074749                                                                  07474938
074750******************************************************************07475040
074751** CHECK FOR ROW ON KRPRPM - IF A ROW EXISTS  - GOTO CNKCS225-UPD 07475140
074752******************************************************************07475240
074753 3045-CHECK-4-ROW-ON-KRPRPM.                                      07475340
074754      MOVE ASC-OPER-UNT-ID   TO DK-OPER-UNT-ID.                   07475440
074755      MOVE ASC-PARM-NAME     TO DK-PARM-NAME.                     07475540
074756                                                                  07475640
074757        EXEC SQL                                                  07475740
074758          SELECT  A.LOC_ID                                        07475840
074759                 ,A.INTFC_SYS_CDE                                 07475940
074760                 ,A.SYS_PRC_FUNC_CDE                              07476040
074761                 ,A.FUNC_PRC_STAT_CDE                             07476140
074762                 ,A.FUNC_BEG_TMST                                 07476240
074763                 ,A.FUNC_END_TMST                                 07476340
074764                 ,A.FUNC_QTY                                      07476440
074765                 ,A.FUNC_PCT                                      07476540
074766                 ,A.FUNC_TXT                                      07476640
074771            INTO :KRPRPM-LOC-ID                                   07477140
074772                ,:KRPRPM-INTFC-SYS-CDE                            07477240
074773                ,:KRPRPM-SYS-PRC-FUNC-CDE                         07477340
074774                ,:KRPRPM-FUNC-PRC-STAT-CDE                        07477440
074775                ,:KRPRPM-FUNC-BEG-TMST                            07477540
074776                ,:KRPRPM-FUNC-END-TMST                            07477640
074777                ,:KRPRPM-FUNC-QTY                                 07477740
074778                ,:KRPRPM-FUNC-PCT                                 07477840
074779                ,:KRPRPM-FUNC-TXT                                 07477940
074784            FROM  TKRPRPM A                                       07478440
074785           WHERE  A.LOC_ID           = :DK-OPER-UNT-ID            07478540
074786             AND  A.SYS_PRC_FUNC_CDE = :DK-PARM-NAME              07478640
074787        END-EXEC                                                  07478740
074788                                                                  07478840
074789        EVALUATE TRUE                                             07478940
074790            WHEN SQLCODE = +0                                     07479040
074791                 CONTINUE                                         07479140
074796                                                                  07479640
074797            WHEN SQLCODE = +100                                   07479740
074798                SET PS-ERROR                                      07479840
074799                    DP020-MSG-FATAL         TO TRUE               07479940
074800                EVALUATE TRUE                                     07480040
074801                    WHEN ASC-UPD-CODE                             07480140
074802                         MOVE PC-TSYMSG-03710                     07480240
074803                                            TO DP020-MSG-NUMBER   07480340
074804                    WHEN ASC-ADD-PARM                             07480440
074805                         MOVE PC-TSYMSG-03721                     07480540
074806                                            TO DP020-MSG-NUMBER   07480640
074807                    WHEN OTHER                                    07480740
074808                         MOVE PC-TSYMSG-03723                     07480841
074809                                            TO DP020-MSG-NUMBER   07480940
074810                END-EVALUATE                                      07481040
074811                MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA           07481140
074812                                               APRMNMEA           07481240
074813                MOVE DP015-RED              TO AOPRUNTC           07481340
074814                                               APRMNMEC           07481440
074815                MOVE DP015-REVERSE          TO AOPRUNTH           07481540
074816                                               APRMNMEH           07481640
074817                MOVE -1                     TO APRMNMEL           07481740
074818                SET DP030-SET-CURSOR-APPL-1 TO TRUE               07481840
074819            WHEN SQLWARN0 NOT = SPACES                            07481940
074820            WHEN SQLCODE < +0                                     07482040
074821            WHEN SQLCODE > +0                                     07482140
074822                MOVE '3045-CHECK-4-ROW-ON-KRPRPM'                 07482240
074823                                          TO DP013-PARAGRAPH      07482340
074824                MOVE 'PROBLEM WITH RETRIEVING ROW'                07482440
074825                                    TO DP013-MESSAGE-TEXT (1)     07482540
074826                MOVE SQLCA      TO DP013-SQLCA                    07482640
074827                MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME (1)       07482740
074828                SET DP013-DB2-ABEND                               07482840
074829                    DP013-XCTL-DISPLAY-RESTART TO TRUE            07482940
074830                PERFORM DP013-0000-PROCESS-ABEND                  07483040
074831        END-EVALUATE.                                             07483140
074832                                                                  07483240
074840                                                                  07484040
074900                                                                  07490032
075116******************************************************************07511601
075117** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **07511701
075118** MAP.                                                         **07511801
075119******************************************************************07511901
075120 3200-RESET-ATTRIBUTES.                                           07512001
075130     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07513001
075140                                                                  07514001
075150     IF DP020-LOCATION-TYPE = 'DC'                                07515001
075160                                                                  07516001
075170         MOVE DP015-ASK-NOR-OFF    TO AOPRUNTA                    07517001
075171                                      AOPRNMEA                    07517104
075180         MOVE DP015-UNP-ALP-NOR-OFF TO APRMNMEA                   07518004
075200         MOVE DP015-BLUE           TO AOPRUNTC                    07520001
075201                                      APRMDSCC                    07520104
075202                                      APRMTYPC                    07520204
075203         MOVE DP015-GREEN          TO APRMNMEC                    07520304
075205         MOVE DP015-UNDERLINE      TO APRMNMEH                    07520504
075207         MOVE -1                   TO APRMNMEL                    07520704
075208     ELSE                                                         07520804
075209         MOVE DP015-UNP-ALP-NOR-OFF TO AOPRUNTA                   07520904
075210                                       APRMNMEA                   07521004
075211                                       APRMDSCA                   07521104
075212                                       APRMTYPC                   07521204
075213         MOVE DP015-GREEN          TO AOPRUNTC                    07521304
075214                                      APRMNMEC                    07521404
075215                                      APRMDSCC                    07521504
075216                                      APRMTYPC                    07521604
075217         MOVE DP015-UNDERLINE      TO AOPRUNTH                    07521704
075218                                      APRMNMEC                    07521804
075219                                      APRMDSCC                    07521904
075220                                      APRMTYPC                    07522004
075224         MOVE -1                   TO APRMNMEL                    07522404
075225     END-IF                                                       07522504
075226                                                                  07522604
075227     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07522704
075228*----------------------------------------------------------------*07522804
075230*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *07523001
075240*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *07524001
075250*  IT HERE.                                                      *07525001
075260*----------------------------------------------------------------*07526001
075270 4000-BUILD-INITIAL-PANEL.                                        07527001
075280                                                                  07528001
075290     PERFORM 3010-VALIDATE-OPER-UNT-ID.                           07529012
075400                                                                  07540001
075500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07550006
075600                                                                  07560001
075800     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   07580008
076000     MOVE ASC-OPER-UNT-NAME        TO AOPRNMEO.                   07600006
076200                                                                  07620001
076500                                                                  07650001
078645*----------------------------------------------------------------*07864501
078646*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *07864601
078647*----------------------------------------------------------------*07864701
078648 4400-MOVE-COMMAREA-TO-SCREEN.                                    07864801
078660     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   07866001
078670     MOVE ASC-OPER-UNT-NAME        TO AOPRNMEO.                   07867004
078680     MOVE ASC-PARM-NAME            TO APRMNMEO.                   07868003
078690     MOVE ASC-PARM-DESC            TO APRMDSCO.                   07869003
078700     MOVE ASC-PARM-TYPE            TO APRMTYPO.                   07870003
078800                                                                  07880001
078900*----------------------------------------------------------------*07890001
079000*    ABEND PROCESSOR MODULE                                      *07900001
079100*----------------------------------------------------------------*07910001
079200                                                                  07920001
079300     COPY DPPD013.                                                07930001
