000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TCKUT011.                                00050000
000600 AUTHOR.                 J MYERS.                                 00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            06/2002.                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  PURPOSE:                                                       00120000
001300*  CREATE A FLAT FILE OF CORRECTIONS AND LATES TO BE PROCESSED AS 00130000
001400*  PART OF THE EARLY SETTLEMENT TO FIFTH THIRD.                   00140000
W10849*  DATE: 05/18/2016                                               00150000
W10849*    CHANGE MADE:                                                 00160000
W10849*    MODIFIED EXTRACT-CURSOR TO NOT EXTRACT OUTLET TRANSACTION.   00170000
W10849*    '001' IS AN OUTLET TRANSACTION.                              00180000
W10849*    MADE BY: ACCENTURE                WR/IR #: CHG0139454        00190000
SHIP  ***************************************************************** 00200000
SHIP  *  CHANGE MADE: ADDED 3 NEW COLUMNS FROM TEPTRN TO THE CURSORS    00210000
SHIP  *               FOR SETTLE BY SHIP PROJECT.                       00220000
SHIP  *  DATE: 03/20/2019                                               00230000
SHIP  *  MADE BY: BARB SCHULTZ             WR/IR #: CHG0220426          00240000
001500***************************************************************** 00250000
SHIP2 ***************************************************************** 00260000
SHIP2 *  CHANGE MADE: DELETED OUT THE MC FIELDS TO NOW USE THE VISA     00270000
SHIP2 *               FIELDS. BOTH VISA AND MC ARE GOING TO BE USING    00280000
SHIP2 *               THE SAME MULT CLEAR FIELDS FROM THE DATABASE.     00290000
SHIP2 *  DATE: 01/21/2020                                               00300000
SHIP2 *  MADE BY: BARB SCHULTZ             WR/IR #: CHG0233046          00310000
001500***************************************************************** 00320000
052523*  CHANGE MADE: ADD CHANGES FOR NEW COBRAND TENDER TYPE           00330000
052523*               ADD CHANGES FOR NEW COBRAND PAYMENTS              00340000
052523*  DATE: 05/25/2023                                               00350000
052523*  MADE BY: DAN PAYNTER              WR/IR #: CHG0289014          00360000
052523***************************************************************** 00370000
062223*  CHANGE MADE: BLOCK TRAILING TRANSACTIONS FROM FLOWING          00371000
062223*               TO CAP ONE SETTLEMENT                             00372000
062223*  DATE: 06/22/2023                                               00373000
062223*  MADE BY: DAN PAYNTER              WR/IR #: CHG0290003          00374000
062223***************************************************************** 00375000
062623*  CHANGE MADE: UNBLOCK TRAILING TRANSACTIONS FROM FLOWING        00376000
062623*               TO CAP ONE SETTLEMENT                             00377000
062623*  DATE: 06/26/2023                                               00378000
062623*  MADE BY: DAN PAYNTER              WR/IR #: CHG0290079          00379001
062623***************************************************************** 00379100
001600 ENVIRONMENT DIVISION.                                            00380000
001700***************************************************************** 00390000
001800                                                                  00400000
001900 CONFIGURATION SECTION.                                           00410000
002000                                                                  00420000
002100 SOURCE-COMPUTER.        IBM-3090.                                00430000
002200                                                                  00440000
002300 OBJECT-COMPUTER.        IBM-3090.                                00450000
002400                                                                  00460000
002500 INPUT-OUTPUT SECTION.                                            00470000
002600                                                                  00480000
002700 FILE-CONTROL.                                                    00490000
002800                                                                  00500000
002900     SELECT DATE-CARD-FILE                                        00510000
003000         ASSIGN TO INP01.                                         00520000
003100                                                                  00530000
003200     SELECT COSA-EXTRACT-FILE                                     00540000
003300         ASSIGN TO OUT01.                                         00550000
003400                                                                  00560000
003500                                                                  00570000
003600******************************************************************00580000
003700 DATA DIVISION.                                                   00590000
003800******************************************************************00600000
003900                                                                  00610000
004000 FILE SECTION.                                                    00620000
004100                                                                  00630000
004200 FD  DATE-CARD-FILE                                               00640000
004300     RECORDING MODE IS F                                          00650000
004400     BLOCK CONTAINS 0 RECORDS                                     00660000
004500     LABEL RECORDS ARE STANDARD.                                  00670000
004600                                                                  00680000
004700 01  DATE-CARD-RECORD            PIC X(80).                       00690000
004800                                                                  00700000
004900 FD  COSA-EXTRACT-FILE                                            00710000
005000     RECORDING MODE IS F                                          00720000
005100     LABEL RECORDS ARE STANDARD                                   00730000
005200     BLOCK CONTAINS 0 RECORDS.                                    00740000
005400                                                                  00750000
C53632 01  COSA-EXTRACT-RECORD           PIC X(191).                    00760000
005600                                                                  00770000
005700                                                                  00780000
005800******************************************************************00790000
005900 WORKING-STORAGE SECTION.                                         00800000
006000******************************************************************00810000
006100 01  FILLER                            PIC X(50)  VALUE           00820000
006200     ' *** WORKING STORAGE STARTS HERE FOR TCKUT011 *** '.        00830000
006300                                                                  00840000
006400******************************************************************00850000
006500* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                   *00860000
006600******************************************************************00870000
006700 01  CC-CONTROL-CARD.                                             00880000
006800     05  CC-CONTROL-CARD-DISPLAY.                                 00890000
006900         10  CC-CONTROL-NAME     PIC X(14)    VALUE SPACE.        00900000
007000             88  CC-VALID-CONTROL-NAME        VALUE               00910000
007100                 'P.O.S. DATE = '.                                00920000
007200         10  CC-POS-DATE-MMDDYY  PIC 9(6)     VALUE ZERO.         00930000
007300     05  FILLER                  PIC X(60)    VALUE SPACE.        00940000
007400                                                                  00950000
007500******************************************************************00960000
007600*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)            *00970000
007700******************************************************************00980000
007800     COPY DPWS500.                                                00990000
007900                                                                  01000000
008000 01  AC-ABEND-CODE                      PIC S9(04) VALUE ZERO     01010000
008100                                                  COMP SYNC.      01020000
008200     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01030000
008300     88  AC-DB2-ERROR                             VALUE +4013.    01040000
008400     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01050000
008500                                                                  01060000
008600  01  PS-PROGRAM-SWITCHES.                                        01070000
008700     05  PS-END-OF-EXTRACT-SW          PIC X(01)  VALUE 'N'.      01080000
008800         88  PS-NOT-END-OF-EXTRACT                VALUE 'N'.      01090000
008900         88  PS-END-OF-EXTRACT                    VALUE 'Y'.      01100000
052523     05  PS-END-OF-PAYMENT-SW          PIC X(01)  VALUE 'N'.      01110000
052523         88  PS-NOT-END-OF-PAYMENT                VALUE 'N'.      01120000
052523         88  PS-END-OF-PAYMENT                    VALUE 'Y'.      01130000
008910     05  PS-END-OF-LATE-VOID-SW        PIC X(01)  VALUE 'N'.      01140000
008920         88  PS-NOT-END-OF-LATE-VOID              VALUE 'N'.      01150000
008930         88  PS-END-OF-LATE-VOID                  VALUE 'Y'.      01160000
009000     05  PS-END-OF-DATE-FILE-SW        PIC X(01)  VALUE 'N'.      01170000
009100         88  PS-END-OF-DATE-FILE                  VALUE 'Y'.      01180000
009200                                                                  01190000
009300 01  PC-CONSTANTS.                                                01200000
009400     05  PC-ROW-NOT-FOUND              PIC S9(04) VALUE +100      01210000
009500                                                  COMP SYNC.      01220000
009600     05  PC-CURRENT-PROGRAM-NAME       PIC  X(08) VALUE           01230000
009700                                                 'TCKUT011'.      01240000
009800 01  PV-PROGRAM-VARIABLES.                                        01250000
009900     05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACE.    01260000
010000     05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACE.    01270000
010100     05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACE.    01280000
010200     05  PV-DB2-OPERATION              PIC  X(30) VALUE SPACE.    01290000
010300     05  PV-POS-CCYY-MM-DD             PIC  X(10).                01300000
010310     05  PV-TNDR-AMT                   PIC S9(7)V99 VALUE ZERO.   01310000
010320     05  PV-TAX-AMT                    PIC S9(7)V99 VALUE ZERO.   01320000
010400                                                                  01330000
010410     05  PV-CRD-LVL-RSLT-CDE.                                     01340000
010420         10  PV-CRD-LVL-RSLT-CDE-1     PIC X(01)  VALUE SPACES.   01350000
010421         10  PV-CRD-LVL-RSLT-CDE-2     PIC X(01)  VALUE SPACES.   01360000
010422                                                                  01370000
SHIP   05  PV-VISA-MULT-CLR-SEQ-NBR      PIC 9(04)  VALUE ZEROES.       01380000
SHIP   05  PV-VISA-TOT-SHP-NBR           PIC 9(04)  VALUE ZEROES.       01390000
010422                                                                  01400000
010422                                                                  01410000
010422                                                                  01420000
010500***************************************************************** 01430000
010600*  COSA EXTRACT FLAT FILE LAYOUT                                  01440000
010700******************************************************************01450000
010800     COPY TCRD004.                                                01460000
010900                                                                  01470000
011000***************************************************************** 01480000
011100*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01490000
011200******************************************************************01500000
011300     COPY DPWS004.                                                01510000
011400                                                                  01520000
011500******************************************************************01530000
011600*  DB2 COMMUNICATION AREA.                                        01540000
011700******************************************************************01550000
011800     EXEC SQL                                                     01560000
011900          INCLUDE SQLCA                                           01570000
012000     END-EXEC.                                                    01580000
012100                                                                  01590000
012200******************************************************************01600000
012300*  DB2 TABLE DB2PDBA.TEPPART - PARTITION CONTROL TABLE            01610000
012400******************************************************************01620000
012500     EXEC SQL                                                     01630000
012600          INCLUDE TEPPART                                         01640000
012700     END-EXEC.                                                    01650000
012800                                                                  01660000
012900******************************************************************01670000
013000*  DB2 TABLE DB2PDBA.TEPDKEY         PROCESING DAY KEY TABLE      01680000
013100******************************************************************01690000
013200     EXEC SQL                                                     01700000
013300          INCLUDE TEPDKEY                                         01710000
013400     END-EXEC.                                                    01720000
013500                                                                  01730000
013600******************************************************************01740000
013700*  DB2 TABLE DB2PDBA.TEPCRD  - CREDIT CARD TABLE                  01750000
013800******************************************************************01760000
013900     EXEC SQL                                                     01770000
014000          INCLUDE TEPCRD                                          01780000
014100     END-EXEC.                                                    01790000
014200                                                                  01800000
052523******************************************************************01810000
052523*  DB2 TABLE DB2PDBA.TEPPAY  - PAYMENT CC  TABLE                  01820000
052523******************************************************************01830000
052523     EXEC SQL                                                     01840000
052523          INCLUDE TEPPAY                                          01850000
052523     END-EXEC.                                                    01860000
052523                                                                  01870000
014300******************************************************************01880000
014400*  DB2 TABLE DB2PDBA.EPT_CR_CRD_VRFN TABLE                        01890000
014500******************************************************************01900000
014600     EXEC SQL                                                     01910000
014700          INCLUDE EPT00056                                        01920000
014800     END-EXEC.                                                    01930000
014900                                                                  01940000
014910******************************************************************01950000
014920*  DB2 TABLE DB2PDBA.TEPTND - TENDER TABLE                        01960000
014930******************************************************************01970000
014940     EXEC SQL                                                     01980000
014950          INCLUDE TEPTND                                          01990000
014960     END-EXEC.                                                    02000000
014970                                                                  02010000
015000******************************************************************02020000
015100*  DB2 TABLE DB2PDBA.TEPTRN - TRANSACTION TABLE                   02030000
015200******************************************************************02040000
015300     EXEC SQL                                                     02050000
015400          INCLUDE TEPTRN                                          02060000
015500     END-EXEC.                                                    02070000
015600                                                                  02080000
016310******************************************************************02090000
016320*  DB2 TABLE DB2PDBA.TEPVDA - VOID TABLE                          02100000
016330******************************************************************02110000
016340     EXEC SQL                                                     02120000
016350          INCLUDE TEPVDA                                          02130000
016360     END-EXEC.                                                    02140000
016370                                                                  02150000
016400******************************************************************02160000
016500*  CREATE CURSOR FOR EXTRACT                                      02170000
016600******************************************************************02180000
016700     EXEC SQL                                                     02190000
016800         DECLARE EXTRACT-CURSOR  CURSOR                           02200000
016900         FOR SELECT PRT.PARTN_NBR                                 02210000
017000                  , TND.STR_NBR                                   02220000
017100                  , TND.RGST_ID                                   02230000
017200                  , TND.TRN_NBR                                   02240000
017300                  , TND.STRT_TM                                   02250000
017400                  , TND.SLS_CORR_SEQ_NBR                          02260000
017500                  , TRN.TRN_TYP_CDE                               02270000
017600                  , PRT.SLS_DTE                                   02280000
017700                  , TRN.TRN_DTE                                   02290000
017800                  , TND.TNDR_SEQ_NBR                              02300000
017900                  , TND.TNDR_TYP_CDE                              02310000
018000                  , TND.TNDR_ID                                   02320000
018100                  , TND.TNDR_AMT                                  02330000
018200                  , TND.TNDR_ID_SRC_CDE                           02340000
018300                  , CRD.AUTH_NBR                                  02350000
018400                  , CRD.AUTH_SRC_CDE                              02360000
018500                  , CRD.CPS_TRN_ID                                02370000
018600                  , CRD.MC_CMPLIN_CDE                             02380000
018700                  , CRD.VIP_SRC_CDE                               02390000
018800                  , CRD.VIP_RSPN_CDE                              02400000
018900                  , CRD.BNKNET_NBR                                02410000
SHIP                    , TRN.VISA_MULT_CLR_SEQ_NBR                     02420000
019110                  , COALESCE(EPT.AVS_RSPN_CDE,'  ')               02430000
019120                  , TRN.SLS_TX_AMT                                02440000
SHIP                    , TRN.VISA_TOT_SHP_NBR                          02450000
019200                  , COALESCE(CRD.CRD_LVL_RSLT_CDE,' ')            02460000
019210                  , COALESCE(EPT.CVV_RSPN_CDE, ' ')               02470000
019220                  , CRD.NETWK_REF_ID                              02480000
019230                  , COALESCE(CRD.TRSM_TMST,                       02490000
                                   '2008-01-01-01.00.00.000000')        02500000
019240                  , CRD.SYS_TRC_AUD_NBR                           02510000
019250                  , COALESCE(CRD.TRK_DAT_CND_CDE,'  ')            02520000
C53632                  , COALESCE(TRN.OMNI_CHNL_FFLMT_TYP_CDE,'   ')   02530000
052523                  , CRD.TRLING_TRN_IND                            02540000
019300                FROM TEPDKEY DKEY                                 02550000
019400                   , TEPPART PRT                                  02560000
019500                   , TEPTND  TND                                  02570000
019700                   , TEPTRN  TRN                                  02580000
019800                   , TEPCRD  CRD                                  02590000
019820                LEFT OUTER JOIN                                   02600000
019830                     EPT_CR_CRD_VRFN EPT                          02610000
019840                ON  CRD.PARTN_NBR  = EPT.PARTN_NBR                02620000
019850                   AND CRD.STR_NBR = EPT.STR_NBR                  02630000
019860                   AND CRD.RGST_ID = EPT.RGST_ID                  02640000
019870                   AND CRD.TRN_NBR = EPT.TRN_NBR                  02650000
019880                   AND CRD.STRT_TM = EPT.STRT_TM                  02660000
019890                   AND CRD.SLS_CORR_SEQ_NBR = EPT.SLS_CORR_SEQ_NBR02670000
019891                   AND CRD.TNDR_SEQ_NBR = EPT.TNDR_SEQ_NBR        02680000
019900                WHERE DKEY.PRCG_DTE        = :PV-POS-CCYY-MM-DD   02690000
020000                  AND PRT.SLS_DTE          = DKEY.SLS_DTE         02700000
020100                  AND TND.PARTN_NBR        = PRT.PARTN_NBR        02710000
020200                  AND TND.STR_NBR          = DKEY.STR_NBR         02720000
020300                  AND TND.RGST_ID          = DKEY.RGST_ID         02730000
020400                  AND TND.TRN_NBR          = DKEY.TRN_NBR         02740000
020500                  AND TND.STRT_TM          = DKEY.STRT_TM         02750000
020600                  AND TND.SLS_CORR_SEQ_NBR = DKEY.SLS_CORR_SEQ_NBR02760000
062623               AND (TND.TNDR_TYP_CDE IN ('05','06','07','08','24')02771000
062623                    OR (TND.TNDR_TYP_CDE = '04'                   02780000
062623                        AND CRD.TRLING_TRN_IND = 'Y'))            02790000
020800                  AND TND.TNDR_VOID_IND    = 'N'                  02800000
020900                  AND CRD.PARTN_NBR        = TND.PARTN_NBR        02810000
021000                  AND CRD.STR_NBR          = TND.STR_NBR          02820000
021100                  AND CRD.RGST_ID          = TND.RGST_ID          02830000
021200                  AND CRD.TRN_NBR          = TND.TRN_NBR          02840000
021300                  AND CRD.STRT_TM          = TND.STRT_TM          02850000
021400                  AND CRD.SLS_CORR_SEQ_NBR = TND.SLS_CORR_SEQ_NBR 02860000
021500                  AND CRD.TNDR_SEQ_NBR     = TND.TNDR_SEQ_NBR     02870000
021600                  AND TRN.PARTN_NBR        = TND.PARTN_NBR        02880000
021700                  AND TRN.STR_NBR          = TND.STR_NBR          02890000
021800                  AND TRN.RGST_ID          = TND.RGST_ID          02900000
021900                  AND TRN.TRN_NBR          = TND.TRN_NBR          02910000
022000                  AND TRN.STRT_TM          = TND.STRT_TM          02920000
022100                  AND TRN.SLS_CORR_SEQ_NBR = TND.SLS_CORR_SEQ_NBR 02930000
022300                  AND TRN.VOID_ABRT_CDE    = 'N'                  02940000
022400                  AND TND.TNDR_VOID_IND    = 'N'                  02950000
022500                  AND TRN.TRN_STAT_CDE                            02960000
022600                      IN ('V','L')                                02970000
W10849                  AND ((TRN.POS_TYP_CDE   <> '001')               02980000
W10849                   OR (TRN.POS_TYP_CDE IS NULL))                  02990000
         UNION ALL                                                      03000000
016900          SELECT PRT.PARTN_NBR                                    03010000
017000                  , TND.STR_NBR                                   03020000
017100                  , TND.RGST_ID                                   03030000
017200                  , TND.TRN_NBR                                   03040000
017300                  , TND.STRT_TM                                   03050000
017400                  , TND.SLS_CORR_SEQ_NBR                          03060000
017500                  , TRN.TRN_TYP_CDE                               03070000
017600                  , PRT.SLS_DTE                                   03080000
017700                  , TRN.TRN_DTE                                   03090000
017800                  , TND.TNDR_SEQ_NBR                              03100000
017900                  , TND.TNDR_TYP_CDE                              03110000
018000                  , TND.TNDR_ID                                   03120000
018100                  , TND.TNDR_AMT                                  03130000
018200                  , TND.TNDR_ID_SRC_CDE                           03140000
018300                  , CRD.AUTH_NBR                                  03150000
018400                  , CRD.AUTH_SRC_CDE                              03160000
018500                  , CRD.CPS_TRN_ID                                03170000
018600                  , CRD.MC_CMPLIN_CDE                             03180000
018700                  , CRD.VIP_SRC_CDE                               03190000
018800                  , CRD.VIP_RSPN_CDE                              03200000
018900                  , CRD.BNKNET_NBR                                03210000
SHIP                    , TRN.VISA_MULT_CLR_SEQ_NBR                     03220000
019110                  , COALESCE(EPT.AVS_RSPN_CDE,'  ')               03230000
019120                  , TRN.SLS_TX_AMT                                03240000
SHIP                    , TRN.VISA_TOT_SHP_NBR                          03250000
019200                  , COALESCE(CRD.CRD_LVL_RSLT_CDE,' ')            03260000
019210                  , COALESCE(EPT.CVV_RSPN_CDE, ' ')               03270000
019220                  , CRD.NETWK_REF_ID                              03280000
019230                  , COALESCE(CRD.TRSM_TMST,                       03290000
                                   '2008-01-01-01.00.00.000000')        03300000
019240                  , CRD.SYS_TRC_AUD_NBR                           03310000
019250                  , COALESCE(CRD.TRK_DAT_CND_CDE,'  ')            03320000
C53632                  , COALESCE(TRN.OMNI_CHNL_FFLMT_TYP_CDE,'   ')   03330000
052523                  , CRD.TRLING_TRN_IND                            03340000
019300                FROM TEPDKEY DKEY                                 03350000
019400                   , TEPPART PRT                                  03360000
019500                   , TEPTND  TND                                  03370000
019700                   , TEPTRN  TRN                                  03380000
019800                   , TEPCRD  CRD                                  03390000
019820                LEFT OUTER JOIN                                   03400000
019830                     EPT_CR_CRD_VRFN EPT                          03410000
019840                ON  CRD.PARTN_NBR  = EPT.PARTN_NBR                03420000
019850                   AND CRD.STR_NBR = EPT.STR_NBR                  03430000
019860                   AND CRD.RGST_ID = EPT.RGST_ID                  03440000
019870                   AND CRD.TRN_NBR = EPT.TRN_NBR                  03450000
019880                   AND CRD.STRT_TM = EPT.STRT_TM                  03460000
019890                   AND CRD.SLS_CORR_SEQ_NBR = EPT.SLS_CORR_SEQ_NBR03470000
019891                   AND CRD.TNDR_SEQ_NBR = EPT.TNDR_SEQ_NBR        03480000
019900                WHERE DKEY.PRCG_DTE        = :PV-POS-CCYY-MM-DD   03490000
020000                  AND PRT.SLS_DTE          = DKEY.SLS_DTE         03500000
020100                  AND TND.PARTN_NBR        = PRT.PARTN_NBR        03510000
020200                  AND TND.STR_NBR          = DKEY.STR_NBR         03520000
020300                  AND TND.RGST_ID          = DKEY.RGST_ID         03530000
020400                  AND TND.TRN_NBR          = DKEY.TRN_NBR         03540000
020500                  AND TND.STRT_TM          = DKEY.STRT_TM         03550000
020600                  AND TND.SLS_CORR_SEQ_NBR = DKEY.SLS_CORR_SEQ_NBR03560000
062623               AND (TND.TNDR_TYP_CDE IN ('05','06','07','08','24')03580000
062623                    OR (TND.TNDR_TYP_CDE = '04'                   03591000
062623                        AND CRD.TRLING_TRN_IND = 'Y'))            03592000
020800                  AND TND.TNDR_VOID_IND    = 'N'                  03600000
020900                  AND CRD.PARTN_NBR        = TND.PARTN_NBR        03610000
021000                  AND CRD.STR_NBR          = TND.STR_NBR          03620000
021100                  AND CRD.RGST_ID          = TND.RGST_ID          03630000
021200                  AND CRD.TRN_NBR          = TND.TRN_NBR          03640000
021300                  AND CRD.STRT_TM          = TND.STRT_TM          03650000
021400                  AND CRD.SLS_CORR_SEQ_NBR = TND.SLS_CORR_SEQ_NBR 03660000
021500                  AND CRD.TNDR_SEQ_NBR     = TND.TNDR_SEQ_NBR     03670000
021600                  AND TRN.PARTN_NBR        = TND.PARTN_NBR        03680000
021700                  AND TRN.STR_NBR          = TND.STR_NBR          03690000
021800                  AND TRN.RGST_ID          = TND.RGST_ID          03700000
021900                  AND TRN.TRN_NBR          = TND.TRN_NBR          03710000
022000                  AND TRN.STRT_TM          = TND.STRT_TM          03720000
022100                  AND TRN.SLS_CORR_SEQ_NBR = TND.SLS_CORR_SEQ_NBR 03730000
022300                  AND TRN.VOID_ABRT_CDE   = 'N'                   03740000
022400                  AND TND.TNDR_VOID_IND    = 'N'                  03750000
022500                  AND TRN.TRN_STAT_CDE     = 'R'                  03760000
W10849                  AND ((TRN.POS_TYP_CDE     <> '001')             03770000
W10849                   OR (TRN.POS_TYP_CDE IS NULL))                  03780000
                        AND NOT EXISTS                                  03790000
                        (SELECT 1 FROM TEPTRN T1                        03800000
                         WHERE  T1.PARTN_NBR        = TRN.PARTN_NBR     03810000
                         AND T1.SLS_DTE          = TRN.SLS_DTE          03820000
                         AND T1.PRCG_DTE          = TRN.PRCG_DTE        03830000
                         AND T1.STR_NBR          = TRN.STR_NBR          03840000
                         AND T1.RGST_ID          = TRN.RGST_ID          03850000
                         AND T1.TRN_NBR          = TRN.TRN_NBR          03860000
                         AND T1.STRT_TM          = TRN.STRT_TM          03870000
                         AND VOID_ABRT_CDE      = 'R'                   03880000
                         AND TRN_STAT_CDE      =  'V' )                 03890000
            WITH UR                                                     03900000
022700     END-EXEC.                                                    03910000
022800                                                                  03920000
052523******************************************************************03930000
052523*  CREATE CURSOR FOR COBRAND PAYMENTS EXTRACT                     03940000
052523******************************************************************03950000
052523     EXEC SQL                                                     03960000
052523         DECLARE PAYMENT-CURSOR  CURSOR                           03970000
052523                                                                  03980000
052523         FOR SELECT A.PARTN_NBR                                   03990000
052523             ,A.STR_NBR                                           04000000
052523             ,A.RGST_ID                                           04010000
052523             ,A.TRN_NBR                                           04020000
052523             ,A.STRT_TM                                           04030000
052523             ,A.SLS_CORR_SEQ_NBR                                  04040000
052523             ,A.TRN_TYP_CDE                                       04050000
052523             ,A.SLS_DTE                                           04060000
052523             ,A.TRN_DTE                                           04070000
052523             ,B.TNDR_SEQ_NBR                                      04080000
052523             ,B.TNDR_TYP_CDE                                      04090000
052523             ,P.KC_ACCT_NBR                                       04100000
052523             ,B.TNDR_AMT                                          04110000
052523             ,P.KC_ACCT_SRC_CDE                                   04120000
052523             ,P.AUTH_NBR                                          04130000
052523             ,P.AUTH_SRC_CDE                                      04140000
052523             ,0.00                                                04150000
052523             ,' '                                                 04160000
052523             ,' '                                                 04170000
052523             ,' '                                                 04180000
052523             ,' '                                                 04190000
052523             ,1                                                   04200000
052523             ,' '                                                 04210000
052523             ,A.SLS_TX_AMT                                        04220000
052523             ,A.VISA_TOT_SHP_NBR                                  04230000
052523             ,'  '                                                04240000
052523             ,' '                                                 04250000
052523             ,' '                                                 04260000
052523             ,'2008-01-01-01.00.00.000000'                        04270000
052523             ,0.00                                                04280000
052523             ,'  '                                                04290000
052523             ,'   '                                               04300000
052523             ,P.TRLING_TRN_IND                                    04310000
052523             ,P.COBRND_IND                                        04320000
052523             ,P.PAYT_AMT                                          04330000
052523          FROM TEPPART D                                          04340000
052523              ,TEPTRN A                                           04350000
052523              ,TEPTND B                                           04360000
052523              ,TEPPAY P                                           04370000
052523          WHERE D.SLS_DTE = :PV-POS-CCYY-MM-DD                    04380000
052523          AND D.DB_STRUC_CDE = 'O'                                04390000
052523          AND D.STR_GP_CDE       = 'A'                            04400000
052523          AND D.PARTN_NBR = A.PARTN_NBR                           04410000
052523          AND D.PARTN_NBR = B.PARTN_NBR                           04420000
052523          AND D.PARTN_NBR = P.PARTN_NBR                           04430000
052523          AND A.STR_NBR = B.STR_NBR                               04440000
052523          AND A.STR_NBR = P.STR_NBR                               04450000
052523          AND A.RGST_ID = B.RGST_ID                               04460000
052523          AND A.RGST_ID = P.RGST_ID                               04470000
052523          AND A.TRN_NBR = B.TRN_NBR                               04480000
052523          AND A.TRN_NBR = P.TRN_NBR                               04490000
052523          AND A.STRT_TM = B.STRT_TM                               04500000
052523          AND A.STRT_TM = P.STRT_TM                               04510000
052523          AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR             04520000
052523          AND A.SLS_CORR_SEQ_NBR = P.SLS_CORR_SEQ_NBR             04530000
052523          AND A.TRN_TYP_CDE      = '30'                           04540000
052523          AND A.VOID_ABRT_CDE    = 'N'                            04550000
052523          AND B.TNDR_VOID_IND    = 'N'                            04560000
052523          AND A.TRN_STAT_CDE IN ('V','L')                         04570000
052523          AND ((A.POS_TYP_CDE <> '001')                           04580000
052523           OR  (A.POS_TYP_CDE IS NULL))                           04590000
052523          AND P.STTLMNT_PRCD_CDE = 'U'                            04600000
062623          AND (P.COBRND_IND     = 'Y'                             04621000
062623               OR P.TRLING_TRN_IND = 'Y')                         04622000
052523   UNION ALL                                                      04630000
052523             SELECT A.PARTN_NBR                                   04640000
052523             ,A.STR_NBR                                           04650000
052523             ,A.RGST_ID                                           04660000
052523             ,A.TRN_NBR                                           04670000
052523             ,A.STRT_TM                                           04680000
052523             ,A.SLS_CORR_SEQ_NBR                                  04690000
052523             ,A.TRN_TYP_CDE                                       04700000
052523             ,A.SLS_DTE                                           04710000
052523             ,A.TRN_DTE                                           04720000
052523             ,B.TNDR_SEQ_NBR                                      04730000
052523             ,B.TNDR_TYP_CDE                                      04740000
052523             ,P.KC_ACCT_NBR                                       04750000
052523             ,B.TNDR_AMT                                          04760000
052523             ,P.KC_ACCT_SRC_CDE                                   04770000
052523             ,P.AUTH_NBR                                          04780000
052523             ,P.AUTH_SRC_CDE                                      04790000
052523             ,0.00                                                04800000
052523             ,' '                                                 04810000
052523             ,' '                                                 04820000
052523             ,' '                                                 04830000
052523             ,' '                                                 04840000
052523             ,1                                                   04850000
052523             ,' '                                                 04860000
052523             ,A.SLS_TX_AMT                                        04870000
052523             ,A.VISA_TOT_SHP_NBR                                  04880000
052523             ,'  '                                                04890000
052523             ,' '                                                 04900000
052523             ,' '                                                 04910000
052523             ,'2008-01-01-01.00.00.000000'                        04920000
052523             ,0.00                                                04930000
052523             ,'  '                                                04940000
052523             ,'   '                                               04950000
052523             ,P.TRLING_TRN_IND                                    04960000
052523             ,P.COBRND_IND                                        04970000
052523             ,P.PAYT_AMT                                          04980000
052523          FROM TEPPART D                                          04990000
052523              ,TEPTRN A                                           05000000
052523              ,TEPTND B                                           05010000
052523              ,TEPPAY P                                           05020000
052523          WHERE D.SLS_DTE = :PV-POS-CCYY-MM-DD                    05030000
052523          AND D.DB_STRUC_CDE = 'O'                                05040000
052523          AND D.STR_GP_CDE       = 'A'                            05050000
052523          AND D.PARTN_NBR = A.PARTN_NBR                           05060000
052523          AND D.PARTN_NBR = B.PARTN_NBR                           05070000
052523          AND D.PARTN_NBR = P.PARTN_NBR                           05080000
052523          AND A.STR_NBR = B.STR_NBR                               05090000
052523          AND A.STR_NBR = P.STR_NBR                               05100000
052523          AND A.RGST_ID = B.RGST_ID                               05110000
052523          AND A.RGST_ID = P.RGST_ID                               05120000
052523          AND A.TRN_NBR = B.TRN_NBR                               05130000
052523          AND A.TRN_NBR = P.TRN_NBR                               05140000
052523          AND A.STRT_TM = B.STRT_TM                               05150000
052523          AND A.STRT_TM = P.STRT_TM                               05160000
052523          AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR             05170000
052523          AND A.SLS_CORR_SEQ_NBR = P.SLS_CORR_SEQ_NBR             05180000
052523          AND A.TRN_TYP_CDE      = '30'                           05190000
052523          AND A.VOID_ABRT_CDE    = 'N'                            05200000
052523          AND B.TNDR_VOID_IND    = 'N'                            05210000
052523          AND A.TRN_STAT_CDE   = 'R'                              05220000
052523          AND ((A.POS_TYP_CDE <> '001')                           05230000
052523           OR  (A.POS_TYP_CDE IS NULL))                           05240000
052523          AND P.STTLMNT_PRCD_CDE = 'U'                            05250000
062623          AND (P.COBRND_IND     = 'Y'                             05271000
062623               OR P.TRLING_TRN_IND = 'Y')                         05272000
052523          AND NOT EXISTS                                          05280000
052523          (SELECT 1 FROM TEPTRN T1                                05290000
052523           WHERE  T1.PARTN_NBR     = A.PARTN_NBR                  05300000
052523           AND T1.SLS_DTE          = A.SLS_DTE                    05310000
052523           AND T1.PRCG_DTE         = A.PRCG_DTE                   05320000
052523           AND T1.STR_NBR          = A.STR_NBR                    05330000
052523           AND T1.RGST_ID          = A.RGST_ID                    05340000
052523           AND T1.TRN_NBR          = A.TRN_NBR                    05350000
052523           AND T1.STRT_TM          = A.STRT_TM                    05360000
052523           AND T1.TRN_TYP_CDE      = '30'                         05370000
052523           AND T1.VOID_ABRT_CDE    = 'R'                          05380000
052523           AND T1.TRN_STAT_CDE     = 'V' )                        05390000
052523      WITH UR                                                     05400000
052523     END-EXEC.                                                    05410000
022810******************************************************************05420000
022820*  THIS CURSOR CHECKS FOR LATE VOID TRANSACTIONS.                *05430000
022830******************************************************************05440000
022840     EXEC SQL                                                     05450000
022850         DECLARE LATE-VOID-CURSOR  CURSOR                         05460000
022860         FOR SELECT D.PARTN_NBR                                   05470000
022870                  , D.STR_NBR                                     05480000
022880                  , D.RGST_ID                                     05490000
022890                  , D.TRN_NBR                                     05500000
022891                  , D.STRT_TM                                     05510000
022892                  , D.SLS_CORR_SEQ_NBR                            05520000
022893                  , D.TRN_TYP_CDE                                 05530000
022894                  , B.SLS_DTE                                     05540000
022895                  , D.TRN_DTE                                     05550000
022896                  , D.SLS_TX_AMT                                  05560000
022898                  , E.TNDR_SEQ_NBR                                05570000
022899                  , E.TNDR_TYP_CDE                                05580000
022900                  , E.TNDR_ID                                     05590000
022901                  , E.TNDR_AMT                                    05600000
022902                  , E.TNDR_ID_SRC_CDE                             05610000
022903                  , F.AUTH_NBR                                    05620000
022904                  , F.AUTH_SRC_CDE                                05630000
022905                  , F.CPS_TRN_ID                                  05640000
022906                  , F.MC_CMPLIN_CDE                               05650000
022907                  , F.VIP_SRC_CDE                                 05660000
022908                  , F.VIP_RSPN_CDE                                05670000
022909                  , F.BNKNET_NBR                                  05680000
SHIP                    , D.VISA_MULT_CLR_SEQ_NBR                       05690000
022910                  , COALESCE(G.AVS_RSPN_CDE,'  ')                 05700000
022911                  , COALESCE(F.CRD_LVL_RSLT_CDE,' ')              05710000
SHIP                    , D.VISA_TOT_SHP_NBR                            05720000
022912                  , COALESCE(G.CVV_RSPN_CDE,' ')                  05730000
022913                  , F.NETWK_REF_ID                                05740000
022914                  , COALESCE(F.TRSM_TMST,                         05750000
                                   '2008-01-01-01.00.00.000000')        05760000
022915                  , F.SYS_TRC_AUD_NBR                             05770000
022916                  , COALESCE(F.TRK_DAT_CND_CDE,'  ')              05780000
C53632                  , COALESCE(D.OMNI_CHNL_FFLMT_TYP_CDE,'   ')     05790000
052523                  , F.TRLING_TRN_IND                              05800000
022917                FROM TEPDKEY A                                    05810000
022918                   , TEPPART B                                    05820000
022919                   , TEPVDA  C                                    05830000
022920                   , TEPTRN  D                                    05840000
022921                   , TEPTND  E                                    05850000
022922                   , TEPCRD  F                                    05860000
022923                LEFT OUTER JOIN                                   05870000
022924                       EPT_CR_CRD_VRFN G                          05880000
022925                ON  F.PARTN_NBR  = G.PARTN_NBR                    05890000
022926                   AND F.STR_NBR = G.STR_NBR                      05900000
022927                   AND F.RGST_ID = G.RGST_ID                      05910000
022928                   AND F.TRN_NBR = G.TRN_NBR                      05920000
022929                   AND F.STRT_TM = G.STRT_TM                      05930000
022930                   AND F.SLS_CORR_SEQ_NBR = G.SLS_CORR_SEQ_NBR    05940000
022931                   AND F.TNDR_SEQ_NBR = G.TNDR_SEQ_NBR            05950000
022932                WHERE A.PRCG_DTE        = :PV-POS-CCYY-MM-DD      05960000
022933                  AND B.SLS_DTE         = A.SLS_DTE               05970000
022934                  AND C.PARTN_NBR       = B.PARTN_NBR             05980000
022935                  AND C.STR_NBR         = A.STR_NBR               05990000
022936                  AND C.TRN_NBR         = A.TRN_NBR               06000000
022937                  AND C.STRT_TM         = A.STRT_TM               06010000
022938                  AND C.SLS_CORR_SEQ_NBR =                        06020000
022939                                          A.SLS_CORR_SEQ_NBR      06030000
022940                  AND D.PARTN_NBR        = C.PARTN_NBR            06040000
022941                  AND D.STR_NBR          = C.STR_NBR              06050000
022942                  AND D.RGST_ID          = C.RGST_ID              06060000
022943                  AND D.TRN_NBR          = C.VOID_TRN_NBR         06070000
022944                  AND D.TRN_STAT_CDE     = 'Z'                    06080000
022945                  AND D.VOID_ABRT_CDE   IN ('N', 'V')             06090000
022946                  AND E.PARTN_NBR        = D.PARTN_NBR            06100000
022947                  AND E.STR_NBR          = D.STR_NBR              06110000
022948                  AND E.RGST_ID          = D.RGST_ID              06120000
022949                  AND E.TRN_NBR          = D.TRN_NBR              06130000
022950                  AND E.STRT_TM          = D.STRT_TM              06140000
022951                  AND E.SLS_CORR_SEQ_NBR = D.SLS_CORR_SEQ_NBR     06150000
062623                 AND (E.TNDR_TYP_CDE IN ('05','06','07','08','24')06161000
062623                      OR (E.TNDR_TYP_CDE = '04'                   06170000
062623                          AND F.TRLING_TRN_IND = 'Y'))            06180000
022953                  AND E.TNDR_VOID_IND    = 'N'                    06190000
022954                  AND F.PARTN_NBR        = E.PARTN_NBR            06200000
022955                  AND F.STR_NBR          = E.STR_NBR              06210000
022956                  AND F.RGST_ID          = E.RGST_ID              06220000
022957                  AND F.TRN_NBR          = E.TRN_NBR              06230000
022958                  AND F.STRT_TM          = E.STRT_TM              06240000
022959                  AND F.SLS_CORR_SEQ_NBR = E.SLS_CORR_SEQ_NBR     06250000
022960                  AND F.TNDR_SEQ_NBR     = E.TNDR_SEQ_NBR         06260000
052523             UNION ALL                                            06270000
052523             SELECT A.PARTN_NBR                                   06280000
052523                   ,A.STR_NBR                                     06290000
052523                   ,A.RGST_ID                                     06300000
052523                   ,A.TRN_NBR                                     06310000
052523                   ,A.STRT_TM                                     06320000
052523                   ,A.SLS_CORR_SEQ_NBR                            06330000
052523                   ,A.TRN_TYP_CDE                                 06340000
052523                   ,A.SLS_DTE                                     06350000
052523                   ,A.TRN_DTE                                     06360000
052523                   ,A.SLS_TX_AMT                                  06370000
052523                   ,1                                             06380000
052523                   ,'00'                                          06390000
052523                   ,P.KC_ACCT_NBR                                 06400000
052523                   ,P.PAYT_AMT                                    06410000
052523                   ,P.KC_ACCT_SRC_CDE                             06420000
052523                   ,P.AUTH_NBR                                    06430000
052523                   ,P.AUTH_SRC_CDE                                06440000
052523                   ,0.00                                          06450000
052523                   ,' '                                           06460000
052523                   ,' '                                           06470000
052523                   ,' '                                           06480000
052523                   ,' '                                           06490000
052523                   ,1                                             06500000
052523                   ,' '                                           06510000
052523                   ,'  '                                          06520000
052523                   ,A.VISA_TOT_SHP_NBR                            06530000
052523                   ,' '                                           06540000
052523                   ,' '                                           06550000
052523                   ,'2008-01-01-01.00.00.000000'                  06560000
052523                   ,0.00                                          06570000
052523                   ,'  '                                          06580000
052523                   ,'   '                                         06590000
052523                   ,P.TRLING_TRN_IND                              06600000
052523             FROM   TEPDKEY K                                     06610000
052523                   ,TEPTRN A                                      06620000
052523                   ,TEPPAY P                                      06630000
052523                   ,TEPPART D                                     06640000
052523             WHERE                                                06650000
052523                   K.PRCG_DTE        = :PV-POS-CCYY-MM-DD         06660000
052523               AND D.SLS_DTE         = K.SLS_DTE                  06670000
052523               AND D.STR_GP_CDE      = 'A'                        06680000
052523               AND D.DB_STRUC_CDE    = 'O'                        06690000
052523               AND P.PARTN_NBR       = D.PARTN_NBR                06700000
052523               AND P.STR_NBR         = K.STR_NBR                  06710000
052523               AND P.RGST_ID         = K.RGST_ID                  06720000
052523               AND P.TRN_NBR         = K.TRN_NBR                  06730000
052523               AND P.STRT_TM         = K.STRT_TM                  06740000
052523               AND P.SLS_CORR_SEQ_NBR = K.SLS_CORR_SEQ_NBR        06750000
052523               AND A.PARTN_NBR       = P.PARTN_NBR                06760000
052523               AND A.STR_NBR         = P.STR_NBR                  06770000
052523               AND A.RGST_ID         = P.RGST_ID                  06780000
052523               AND A.TRN_NBR         = P.TRN_NBR                  06790000
052523               AND A.STRT_TM         = P.STRT_TM                  06800000
052523               AND A.SLS_CORR_SEQ_NBR = P.SLS_CORR_SEQ_NBR        06810000
052523               AND A.TRN_TYP_CDE     = '30'                       06820000
052523               AND A.VOID_ABRT_CDE   IN ('N', 'V')                06830000
052523               AND A.TRN_STAT_CDE    = 'Z'                        06840000
052523               AND P.STTLMNT_PRCD_CDE = 'U'                       06850000
062623               AND (P.COBRND_IND     = 'Y'                        06871000
062623                    OR P.TRLING_TRN_IND = 'Y')                    06872000
022961     END-EXEC.                                                    06880000
022962                                                                  06890000
022970 PROCEDURE DIVISION.                                              06900000
023000                                                                  06910000
023100 0000-MAINLINE-PARAGRAPH.                                         06920000
023200                                                                  06930000
023300     PERFORM 1000-INITIALIZE-PROGRAM.                             06940000
023500                                                                  06950000
052523***** GET LATE PAYMENTS AND SALES CORRECTION PAYMENTS.            06960000
052523                                                                  06970000
052523     PERFORM 3001-OPEN-PAYMENT-CURSOR.                            06980000
052523     PERFORM 3101-FETCH-PAYMENT-CURSOR.                           06990000
052523                                                                  07000000
052523     PERFORM 2001-PROCESS-PAYMENT                                 07010000
052523           UNTIL PS-END-OF-PAYMENT.                               07020000
052523                                                                  07030000
052523     PERFORM 3301-CLOSE-PAYMENT-CURSOR.                           07040000
052523                                                                  07050000
023510***** GET LATE TRANSACTIONS AND SALES CORRECTIONS.                07060000
023520                                                                  07070000
023530     PERFORM 3000-OPEN-EXTRACT-CURSOR.                            07080000
023600     PERFORM 3100-FETCH-EXTRACT-CURSOR.                           07090000
023700                                                                  07100000
023800     PERFORM 2000-PROCESS                                         07110000
023900           UNTIL PS-END-OF-EXTRACT.                               07120000
024000                                                                  07130000
024100     PERFORM 3300-CLOSE-EXTRACT-CURSOR.                           07140000
024200                                                                  07150000
024201***** GET LATE VOID TRANSACTIONS.                                 07160000
024202                                                                  07170000
024210     PERFORM 5000-OPEN-LATE-VOID-CSR.                             07180000
024220     PERFORM 5100-FETCH-LATE-VOID-CSR.                            07190000
024230                                                                  07200000
024240     PERFORM 6000-PROCESS-LATE-VOID                               07210000
024250         UNTIL PS-END-OF-LATE-VOID.                               07220000
024260                                                                  07230000
024270     PERFORM 5200-CLOSE-LATE-VOID-CSR.                            07240000
024280                                                                  07250000
024300     CLOSE DATE-CARD-FILE                                         07260000
024400           COSA-EXTRACT-FILE.                                     07270000
024500                                                                  07280000
024600     GOBACK.                                                      07290000
024700                                                                  07300000
024800******************************************************************07310000
024900* 1000-INITIALIZE-PROGRAM                                         07320000
025000*     OPEN FILES, PROCESS CONTROL CARD                            07330000
025100******************************************************************07340000
025200 1000-INITIALIZE-PROGRAM.                                         07350000
025300                                                                  07360000
025400     OPEN INPUT  DATE-CARD-FILE                                   07370000
025500          OUTPUT COSA-EXTRACT-FILE.                               07380000
025600                                                                  07390000
025700     PERFORM 1300-PROCESS-DATE-CARD.                              07400000
025800                                                                  07410000
025900     SET PS-NOT-END-OF-EXTRACT              TO TRUE.              07420000
052523     SET PS-NOT-END-OF-PAYMENT              TO TRUE.              07430000
026000                                                                  07440000
026100******************************************************************07450000
026200* 1300-PROCESS-DATE-CARD                                          07460000
026300******************************************************************07470000
026400 1300-PROCESS-DATE-CARD.                                          07480000
026500                                                                  07490000
026600     READ DATE-CARD-FILE INTO CC-CONTROL-CARD                     07500000
026700         AT END                                                   07510000
026800             SET PS-END-OF-DATE-FILE TO TRUE.                     07520000
026900                                                                  07530000
027000     IF PS-END-OF-DATE-FILE                                       07540000
027100         MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME      07550000
027200         MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     07560000
027300         SET AC-CONTROL-CARD-ERROR TO TRUE                        07570000
027400         PERFORM 9999-ABEND                                       07580000
027500     END-IF.                                                      07590000
027600                                                                  07600000
027700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07610000
027800                                                                  07620000
027900     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   07630000
028000     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   07640000
028100     SET  DPG52-LK-DTE-GREG            TO TRUE.                   07650000
028200     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    07660000
028300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07670000
028400                                             DPG54 DPG55 DPG56.   07680000
028500     EVALUATE TRUE                                                07690000
028600         WHEN DPG54-SEVERE-ERROR                                  07700000
028700         WHEN DPG54-DATE-INVALID                                  07710000
028800             MOVE '1300-PROCESS-DATE-CARD'                        07720000
028900                                           TO PV-PARAGRAPH-NAME   07730000
029000             MOVE 'ERROR CONVERTING INPUT CARD DATE'              07740000
029100                                           TO PV-OPERATION-MSG-1  07750000
029200             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                07760000
029300             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  07770000
029400             PERFORM 9999-ABEND                                   07780000
029500     END-EVALUATE.                                                07790000
029600                                                                  07800000
029700     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD.      07810000
029800                                                                  07820000
029900***************************************************************** 07830000
030000* 2000-PROCESS                                                    07840000
030100*      PROCESS THE CURSOR TO BUILD THE EXTRACT RECORD             07850000
030200***************************************************************** 07860000
030300  2000-PROCESS.                                                   07870000
030400                                                                  07880000
031100*    IF EPTND-TNDR-TYP-CDE = '08'                                 07890000
031200*         CONTINUE                                                07900000
031300*    ELSE                                                         07910000
031400        MOVE EPTND-TNDR-AMT   TO PV-TNDR-AMT.                     07920000
031500        MOVE EPTRN-SLS-TX-AMT TO PV-TAX-AMT.                      07930000
034300        PERFORM 4000-WRITE-EXTRACT-FILE.                          07940000
034400*    END-IF.                                                      07950000
034500                                                                  07960000
034600     PERFORM 3100-FETCH-EXTRACT-CURSOR.                           07970000
034700                                                                  07980000
052523***************************************************************** 07990000
052523* 2001-PROCESS-PAYMENT                                            08000000
052523*      PROCESS THE CURSOR TO BUILD THE PAYMENT EXTRACT RECORD     08010000
052523***************************************************************** 08020000
052523  2001-PROCESS-PAYMENT.                                           08030000
052523                                                                  08040000
052523     MOVE EPTND-TNDR-AMT   TO PV-TNDR-AMT.                        08050000
052523     MOVE EPTRN-SLS-TX-AMT TO PV-TAX-AMT.                         08060000
052523     PERFORM 4000-WRITE-EXTRACT-FILE.                             08070000
052523                                                                  08080000
052523     PERFORM 3101-FETCH-PAYMENT-CURSOR.                           08090000
052523                                                                  08100000
034800******************************************************************08110000
034900* 3000-OPEN-EXTRACT-CURSOR.                                       08120000
035000*     OPEN EXTRACT CURSOR                                         08130000
035100******************************************************************08140000
035200 3000-OPEN-EXTRACT-CURSOR.                                        08150000
035300                                                                  08160000
035400     EXEC SQL                                                     08170000
035500          OPEN EXTRACT-CURSOR                                     08180000
035600     END-EXEC.                                                    08190000
035700                                                                  08200000
035800     EVALUATE TRUE                                                08210000
035900         WHEN SQLCODE = ZERO                                      08220000
036000              CONTINUE                                            08230000
036100         WHEN SQLWARN0 NOT EQUAL SPACE                            08240000
036200         WHEN SQLCODE NOT EQUAL ZERO                              08250000
036300             MOVE '3000-OPEN-EXTRACT-CURSOR'                      08260000
036400                                            TO PV-PARAGRAPH-NAME  08270000
036500             MOVE 'ERROR ON OPEN OF EXTRACT-CURSOR'               08280000
036600                                            TO PV-DB2-OPERATION   08290000
036700             PERFORM 9100-SQL-ABEND                               08300000
036800     END-EVALUATE.                                                08310000
036900                                                                  08320000
052523******************************************************************08330000
052523* 3001-OPEN-PAYMENT-CURSOR.                                       08340000
052523*     OPEN PAYMENT CURSOR                                         08350000
052523******************************************************************08360000
052523 3001-OPEN-PAYMENT-CURSOR.                                        08370000
052523                                                                  08380000
052523     EXEC SQL                                                     08390000
052523          OPEN PAYMENT-CURSOR                                     08400000
052523     END-EXEC.                                                    08410000
052523                                                                  08420000
052523     EVALUATE TRUE                                                08430000
052523         WHEN SQLCODE = ZERO                                      08440000
052523              CONTINUE                                            08450000
052523         WHEN SQLWARN0 NOT EQUAL SPACE                            08460000
052523         WHEN SQLCODE NOT EQUAL ZERO                              08470000
052523             MOVE '3001-OPEN-PAYMENT-CURSOR'                      08480000
052523                                            TO PV-PARAGRAPH-NAME  08490000
052523             MOVE 'ERROR ON OPEN OF PAYMENT-CURSOR'               08500000
052523                                            TO PV-DB2-OPERATION   08510000
052523             PERFORM 9100-SQL-ABEND                               08520000
052523     END-EVALUATE.                                                08530000
052523                                                                  08540000
037000******************************************************************08550000
037100* 3100-FETCH-EXTRACT-CURSOR                                       08560000
037200******************************************************************08570000
037300 3100-FETCH-EXTRACT-CURSOR.                                       08580000
037400                                                                  08590000
037500     EXEC SQL                                                     08600000
037600          FETCH EXTRACT-CURSOR                                    08610000
037700           INTO :EPTND-PARTN-NBR                                  08620000
037800               ,:EPTND-STR-NBR                                    08630000
037900               ,:EPTND-RGST-ID                                    08640000
038000               ,:EPTND-TRN-NBR                                    08650000
038100               ,:EPTND-STRT-TM                                    08660000
038200               ,:EPTND-SLS-CORR-SEQ-NBR                           08670000
038300               ,:EPTRN-TRN-TYP-CDE                                08680000
038400               ,:EPPART-SLS-DTE                                   08690000
038500               ,:EPTRN-TRN-DTE                                    08700000
038600               ,:EPTND-TNDR-SEQ-NBR                               08710000
038700               ,:EPTND-TNDR-TYP-CDE                               08720000
038800               ,:EPTND-TNDR-ID                                    08730000
038900               ,:EPTND-TNDR-AMT                                   08740000
039000               ,:EPTND-TNDR-ID-SRC-CDE                            08750000
039100               ,:EPCRD-AUTH-NBR                                   08760000
039200               ,:EPCRD-AUTH-SRC-CDE                               08770000
039300               ,:EPCRD-CPS-TRN-ID                                 08780000
039400               ,:EPCRD-MC-CMPLIN-CDE                              08790000
039500               ,:EPCRD-VIP-SRC-CDE                                08800000
039600               ,:EPCRD-VIP-RSPN-CDE                               08810000
039700               ,:EPCRD-BNKNET-NBR                                 08820000
SHIP                 ,:EPTRN-VISA-MULT-CLR-SEQ-NBR                      08830000
040000               ,:EPT00056-AVS-RSPN-CDE                            08840000
040010               ,:EPTRN-SLS-TX-AMT                                 08850000
SHIP                 ,:EPTRN-VISA-TOT-SHP-NBR                           08860000
040020               ,:EPCRD-CRD-LVL-RSLT-CDE                           08870000
040030               ,:EPT00056-CVV-RSPN-CDE                            08880000
040040               ,:EPCRD-NETWK-REF-ID                               08890000
040050               ,:EPCRD-TRSM-TMST                                  08900000
040060               ,:EPCRD-SYS-TRC-AUD-NBR                            08910000
040070               ,:EPCRD-TRK-DAT-CND-CDE                            08920000
C53632               ,:EPTRN-OMNI-CHNL-FFLMT-TYP-CDE                    08930000
052523               ,:EPCRD-TRLING-TRN-IND                             08940000
040100     END-EXEC.                                                    08950000
040200                                                                  08960000
040300     EVALUATE TRUE                                                08970000
040400         WHEN SQLCODE = ZERO                                      08980000
040500              CONTINUE                                            08990000
040600                                                                  09000000
040610         WHEN SQLCODE = -305                                      09010000
040620              CONTINUE                                            09020000
040630                                                                  09030000
040700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09040000
040800             SET PS-END-OF-EXTRACT          TO TRUE               09050000
040900         WHEN SQLWARN0 NOT EQUAL SPACE                            09060000
041000         WHEN SQLCODE NOT EQUAL ZERO                              09070000
041100             MOVE '3100-FETCH-EXTRACT-CURSOR'                     09080000
041200                                            TO PV-PARAGRAPH-NAME  09090000
041300             MOVE 'ERROR ON FETCH OF EXTRACT-CURSOR'              09100000
041400                                            TO PV-DB2-OPERATION   09110000
041500             PERFORM 9100-SQL-ABEND                               09120000
041600     END-EVALUATE.                                                09130000
041700                                                                  09140000
052523******************************************************************09150000
052523* 3101-FETCH-PAYMENT-CURSOR                                       09160000
052523******************************************************************09170000
052523 3101-FETCH-PAYMENT-CURSOR.                                       09180000
052523                                                                  09190000
052523     EXEC SQL                                                     09200000
052523          FETCH PAYMENT-CURSOR                                    09210000
052523           INTO :EPTND-PARTN-NBR                                  09220000
052523               ,:EPTND-STR-NBR                                    09230000
052523               ,:EPTND-RGST-ID                                    09240000
052523               ,:EPTND-TRN-NBR                                    09250000
052523               ,:EPTND-STRT-TM                                    09260000
052523               ,:EPTND-SLS-CORR-SEQ-NBR                           09270000
052523               ,:EPTRN-TRN-TYP-CDE                                09280000
052523               ,:EPPART-SLS-DTE                                   09290000
052523               ,:EPTRN-TRN-DTE                                    09300000
052523               ,:EPTND-TNDR-SEQ-NBR                               09310000
052523               ,:EPTND-TNDR-TYP-CDE                               09320000
052523               ,:EPPAY-KC-ACCT-NBR                                09330000
052523               ,:EPTND-TNDR-AMT                                   09340000
052523               ,:EPPAY-KC-ACCT-SRC-CDE                            09350000
052523               ,:EPPAY-AUTH-NBR                                   09360000
052523               ,:EPPAY-AUTH-SRC-CDE                               09370000
052523               ,:EPCRD-CPS-TRN-ID                                 09380000
052523               ,:EPCRD-MC-CMPLIN-CDE                              09390000
052523               ,:EPCRD-VIP-SRC-CDE                                09400000
052523               ,:EPCRD-VIP-RSPN-CDE                               09410000
052523               ,:EPCRD-BNKNET-NBR                                 09420000
052523               ,:EPTRN-VISA-MULT-CLR-SEQ-NBR                      09430000
052523               ,:EPT00056-AVS-RSPN-CDE                            09440000
052523               ,:EPTRN-SLS-TX-AMT                                 09450000
052523               ,:EPTRN-VISA-TOT-SHP-NBR                           09460000
052523               ,:EPCRD-CRD-LVL-RSLT-CDE                           09470000
052523               ,:EPT00056-CVV-RSPN-CDE                            09480000
052523               ,:EPCRD-NETWK-REF-ID                               09490000
052523               ,:EPCRD-TRSM-TMST                                  09500000
052523               ,:EPCRD-SYS-TRC-AUD-NBR                            09510000
052523               ,:EPCRD-TRK-DAT-CND-CDE                            09520000
052523               ,:EPTRN-OMNI-CHNL-FFLMT-TYP-CDE                    09530000
052523               ,:EPPAY-TRLING-TRN-IND                             09540000
052523               ,:EPPAY-COBRND-IND                                 09550000
052523               ,:EPPAY-PAYT-AMT                                   09560000
052523     END-EXEC.                                                    09570000
052523                                                                  09580000
052523     EVALUATE TRUE                                                09590000
052523         WHEN SQLCODE = ZERO                                      09600000
052523              MOVE EPPAY-KC-ACCT-NBR TO EPTND-TNDR-ID             09610000
052523              MOVE EPPAY-KC-ACCT-SRC-CDE TO EPTND-TNDR-ID-SRC-CDE 09620000
052523              MOVE EPPAY-AUTH-NBR    TO EPCRD-AUTH-NBR            09630000
052523              MOVE EPPAY-AUTH-SRC-CDE TO EPCRD-AUTH-SRC-CDE       09640000
052523              MOVE EPPAY-TRLING-TRN-IND TO EPCRD-TRLING-TRN-IND   09650000
052523                                                                  09660000
052523         WHEN SQLCODE = -305                                      09670000
052523              CONTINUE                                            09680000
052523                                                                  09690000
052523         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09700000
052523             SET PS-END-OF-PAYMENT          TO TRUE               09710000
052523         WHEN SQLWARN0 NOT EQUAL SPACE                            09720000
052523         WHEN SQLCODE NOT EQUAL ZERO                              09730000
052523             MOVE '3101-FETCH-PAYMENT-CURSOR'                     09740000
052523                                            TO PV-PARAGRAPH-NAME  09750000
052523             MOVE 'ERROR ON FETCH OF PAYMENT-CURSOR'              09760000
052523                                            TO PV-DB2-OPERATION   09770000
052523             PERFORM 9100-SQL-ABEND                               09780000
052523     END-EVALUATE.                                                09790000
052523                                                                  09800000
041800***************************************************************** 09810000
041900* 3300-CLOSE-EXTRACT-CURSOR                                       09820000
042000*      CLOSE CURSOR                                               09830000
042100***************************************************************** 09840000
042200 3300-CLOSE-EXTRACT-CURSOR.                                       09850000
042300                                                                  09860000
042400     EXEC SQL                                                     09870000
042500          CLOSE EXTRACT-CURSOR                                    09880000
042600     END-EXEC.                                                    09890000
042700                                                                  09900000
042800     EVALUATE TRUE                                                09910000
042900         WHEN SQLCODE = ZERO                                      09920000
043000              CONTINUE                                            09930000
043100         WHEN SQLWARN0 NOT EQUAL SPACE                            09940000
043200         WHEN SQLCODE NOT EQUAL ZERO                              09950000
043300             MOVE '3300-CLOSE-EXTRACT-CURSOR'                     09960000
043400                                            TO PV-PARAGRAPH-NAME  09970000
043500             MOVE 'ERROR ON CLOSE OF EXTRACT-CURSOR'              09980000
043600                                            TO PV-DB2-OPERATION   09990000
043700             PERFORM 9100-SQL-ABEND                               10000000
043800     END-EVALUATE.                                                10010000
043900                                                                  10020000
052523***************************************************************** 10030000
052523* 3301-CLOSE-PAYMENT-CURSOR                                       10040000
052523*      CLOSE CURSOR                                               10050000
052523***************************************************************** 10060000
052523 3301-CLOSE-PAYMENT-CURSOR.                                       10070000
052523                                                                  10080000
052523     EXEC SQL                                                     10090000
052523          CLOSE PAYMENT-CURSOR                                    10100000
052523     END-EXEC.                                                    10110000
052523                                                                  10120000
052523     EVALUATE TRUE                                                10130000
052523         WHEN SQLCODE = ZERO                                      10140000
052523              CONTINUE                                            10150000
052523         WHEN SQLWARN0 NOT EQUAL SPACE                            10160000
052523         WHEN SQLCODE NOT EQUAL ZERO                              10170000
052523             MOVE '3301-CLOSE-PAYMENT-CURSOR'                     10180000
052523                                            TO PV-PARAGRAPH-NAME  10190000
052523             MOVE 'ERROR ON CLOSE OF PAYMENT-CURSOR'              10200000
052523                                            TO PV-DB2-OPERATION   10210000
052523             PERFORM 9100-SQL-ABEND                               10220000
052523     END-EVALUATE.                                                10230000
052523     MOVE 'N'                       TO EPPAY-COBRND-IND.          10240000
052523                                                                  10250000
044000******************************************************************10260000
044100* 4000-WRITE-EXTRACT-FILE                                         10270000
044110*     FORMAT THE OUTPUT RECORD AND WRITE IT OUT.                  10280000
044200*     WRITE THE EXTRACT FILE FROM COPYBOOK TCRD004                10290000
044300******************************************************************10300000
044400 4000-WRITE-EXTRACT-FILE.                                         10310000
044500                                                                  10320000
044501     INITIALIZE TC004-EXTRACT-RECORD.                             10330000
044502******************************************************************10340000
044503*  THIS COPYBOOK IS THE LAYOUT FOR THE EXTRACT FILE TO BE USED   *10350000
044504*  FOR THE LATE EXTRACT OF CREDIT TRANSACTIONS FOR SETTLEMENT    *10360000
044505*  WITH FIFTH THIRD BANK.                                        *10370000
044506******************************************************************10380000
044523     MOVE EPTND-PARTN-NBR        TO TC004-PARTN-NBR.              10390000
044530     MOVE EPTND-STR-NBR          TO TC004-STR-NBR.                10400000
044540     MOVE EPTND-RGST-ID          TO TC004-RGST-ID.                10410000
044550     MOVE EPTND-TRN-NBR          TO TC004-TRN-NBR.                10420000
044560     MOVE EPTND-STRT-TM          TO TC004-STRT-TM.                10430000
044570     MOVE EPTND-SLS-CORR-SEQ-NBR TO TC004-SLS-CORR-SEQ-NBR.       10440000
044580     MOVE EPTND-TNDR-SEQ-NBR     TO TC004-TNDR-SEQ-NBR.           10450000
044590     MOVE EPTND-TNDR-ID          TO TC004-TNDR-ID.                10460000
044594     MOVE PV-TNDR-AMT            TO TC004-TNDR-AMT.               10470000
044596     MOVE PV-TAX-AMT             TO TC004-SLS-TX-AMT.             10480000
052523     IF EPTND-TNDR-TYP-CDE = '04'                                 10490000
052523         MOVE '24'               TO EPTND-TNDR-TYP-CDE            10500000
052523     END-IF.                                                      10510000
044599     MOVE EPTND-TNDR-TYP-CDE     TO TC004-TNDR-TYP-CDE.           10520000
044600     MOVE EPTND-TNDR-ID-SRC-CDE  TO TC004-TNDR-ID-SRC-CDE.        10530000
044601     MOVE EPPART-SLS-DTE         TO TC004-SLS-DTE.                10540000
044602     MOVE EPTRN-TRN-DTE          TO TC004-TRN-DTE.                10550000
044603     MOVE EPCRD-AUTH-NBR         TO TC004-AUTH-NBR.               10560000
044604     MOVE EPCRD-AUTH-SRC-CDE     TO TC004-AUTH-SRC-CDE.           10570000
044605     MOVE EPCRD-CPS-TRN-ID       TO TC004-CPS-TRN-ID.             10580000
044606     MOVE EPCRD-MC-CMPLIN-CDE    TO TC004-MC-CMPLIN-CDE.          10590000
044607     MOVE EPCRD-VIP-SRC-CDE      TO TC004-VIP-SRC-CDE.            10600000
044608     MOVE EPCRD-VIP-RSPN-CDE     TO TC004-VIP-RSPN-CDE.           10610000
044609     MOVE EPCRD-BNKNET-NBR       TO TC004-BNKNET-NBR.             10620000
044610     MOVE EPT00056-AVS-RSPN-CDE  TO TC004-AVS-RSPN-CDE.           10630000
044611     MOVE EPTRN-TRN-TYP-CDE      TO TC004-TRN-TYP-CDE.            10640000
044612                                                                  10650000
044613     MOVE SPACES                 TO PV-CRD-LVL-RSLT-CDE.          10660000
044614     MOVE EPCRD-CRD-LVL-RSLT-CDE TO PV-CRD-LVL-RSLT-CDE.          10670000
044615     IF PV-CRD-LVL-RSLT-CDE-1 = SPACES AND                        10680000
044616        PV-CRD-LVL-RSLT-CDE-2 NOT = SPACES                        10690000
044617       MOVE PV-CRD-LVL-RSLT-CDE-2 TO PV-CRD-LVL-RSLT-CDE-1        10700000
044618       MOVE SPACES                TO PV-CRD-LVL-RSLT-CDE-2        10710000
044619       MOVE PV-CRD-LVL-RSLT-CDE  TO TC004-CRD-LVL-RSLT-CDE        10720000
044620     ELSE                                                         10730000
044621       MOVE PV-CRD-LVL-RSLT-CDE  TO TC004-CRD-LVL-RSLT-CDE        10740000
044622     END-IF.                                                      10750000
044623                                                                  10760000
044624     MOVE EPT00056-CVV-RSPN-CDE  TO TC004-CVV-RSPN-CDE.           10770000
044625     MOVE EPCRD-NETWK-REF-ID     TO TC004-NETWK-REF-ID.           10780000
044626     MOVE EPCRD-TRSM-TMST        TO TC004-TRSM-TMST.              10790000
044627     MOVE EPCRD-SYS-TRC-AUD-NBR  TO TC004-SYS-TRC-AUD-NBR.        10800000
044628     MOVE EPCRD-TRK-DAT-CND-CDE  TO TC004-TRK-DAT-CND-CDE.        10810000
C53632     MOVE EPTRN-OMNI-CHNL-FFLMT-TYP-CDE TO                        10820000
C53632                                  TC004-OMNI-CHNL-FFLMT-TYP-CDE.  10830000
SHIP       MOVE EPTRN-VISA-MULT-CLR-SEQ-NBR                             10840000
SHIP                                   TO PV-VISA-MULT-CLR-SEQ-NBR.     10850000
SHIP       MOVE PV-VISA-MULT-CLR-SEQ-NBR                                10860000
SHIP                                   TO TC004-VISA-MULT-CLR-SEQ-NBR.  10870000
SHIP       MOVE EPTRN-VISA-TOT-SHP-NBR TO PV-VISA-TOT-SHP-NBR.          10880000
SHIP       MOVE PV-VISA-TOT-SHP-NBR    TO TC004-VISA-TOT-SHP-NBR.       10890000
052523     MOVE EPCRD-TRLING-TRN-IND   TO TC004-TRLING-TRN-IND.         10900000
052523     MOVE EPPAY-COBRND-IND       TO TC004-COBRAND-PYMT-IND.       10910000
044630     WRITE COSA-EXTRACT-RECORD  FROM TC004-EXTRACT-RECORD.        10920000
044700                                                                  10930000
044710******************************************************************10940000
044720* 5000-OPEN-LATE-VOID-CSR.                                        10950000
044730*     OPEN LATE VOID CURSOR.                                      10960000
044740******************************************************************10970000
044750 5000-OPEN-LATE-VOID-CSR.                                         10980000
044760                                                                  10990000
044770     EXEC SQL                                                     11000000
044780          OPEN LATE-VOID-CURSOR                                   11010000
044790     END-EXEC.                                                    11020000
044791                                                                  11030000
044792     EVALUATE TRUE                                                11040000
044793         WHEN SQLCODE = ZERO                                      11050000
044794              CONTINUE                                            11060000
044795         WHEN SQLWARN0 NOT EQUAL SPACE                            11070000
044796         WHEN SQLCODE NOT EQUAL ZERO                              11080000
044797             MOVE '5000-OPEN-LATE-VOID-CSR'                       11090000
044798                                            TO PV-PARAGRAPH-NAME  11100000
044799             MOVE 'ERROR ON OPEN OF LATE-VOID-CURSOR'             11110000
044800                                            TO PV-DB2-OPERATION   11120000
044801             PERFORM 9100-SQL-ABEND                               11130000
044802     END-EVALUATE.                                                11140000
044803                                                                  11150000
044804******************************************************************11160000
044805* 5100-FETCH-LATE-VOID-CSR                                        11170000
044806******************************************************************11180000
044807 5100-FETCH-LATE-VOID-CSR.                                        11190000
044808                                                                  11200000
044809     EXEC SQL                                                     11210000
044810          FETCH LATE-VOID-CURSOR                                  11220000
044811           INTO :EPTND-PARTN-NBR                                  11230000
044812               ,:EPTND-STR-NBR                                    11240000
044813               ,:EPTND-RGST-ID                                    11250000
044814               ,:EPTND-TRN-NBR                                    11260000
044815               ,:EPTND-STRT-TM                                    11270000
044816               ,:EPTND-SLS-CORR-SEQ-NBR                           11280000
044817               ,:EPTRN-TRN-TYP-CDE                                11290000
044818               ,:EPPART-SLS-DTE                                   11300000
044819               ,:EPTRN-TRN-DTE                                    11310000
044820               ,:EPTRN-SLS-TX-AMT                                 11320000
044821               ,:EPTND-TNDR-SEQ-NBR                               11330000
044822               ,:EPTND-TNDR-TYP-CDE                               11340000
044823               ,:EPTND-TNDR-ID                                    11350000
044824               ,:EPTND-TNDR-AMT                                   11360000
044825               ,:EPTND-TNDR-ID-SRC-CDE                            11370000
044826               ,:EPCRD-AUTH-NBR                                   11380000
044827               ,:EPCRD-AUTH-SRC-CDE                               11390000
044828               ,:EPCRD-CPS-TRN-ID                                 11400000
044829               ,:EPCRD-MC-CMPLIN-CDE                              11410000
044830               ,:EPCRD-VIP-SRC-CDE                                11420000
044831               ,:EPCRD-VIP-RSPN-CDE                               11430000
044832               ,:EPCRD-BNKNET-NBR                                 11440000
SHIP                 ,:EPTRN-VISA-MULT-CLR-SEQ-NBR                      11450000
044833               ,:EPT00056-AVS-RSPN-CDE                            11460000
044836               ,:EPCRD-CRD-LVL-RSLT-CDE                           11470000
SHIP                 ,:EPTRN-VISA-TOT-SHP-NBR                           11480000
044837               ,:EPT00056-CVV-RSPN-CDE                            11490000
044838               ,:EPCRD-NETWK-REF-ID                               11500000
044839               ,:EPCRD-TRSM-TMST                                  11510000
044840               ,:EPCRD-SYS-TRC-AUD-NBR                            11520000
044841               ,:EPCRD-TRK-DAT-CND-CDE                            11530000
C53632               ,:EPTRN-OMNI-CHNL-FFLMT-TYP-CDE                    11540000
052523               ,:EPCRD-TRLING-TRN-IND                             11550000
044842     END-EXEC.                                                    11560000
044843                                                                  11570000
044844     EVALUATE TRUE                                                11580000
044845         WHEN SQLCODE = ZERO                                      11590000
044846*  MOVING 'V' HERE BECAUSE ABENDS AND TRANSACTIONS THAT COME      11600000
044847*  THROUGH DATA COLLECT IN THE WRONG ORDER WILL NOT HAVE THE      11610000
044848*  VOID ABORT CODE SET.                                           11620000
044849             MOVE 'V'             TO EPTRN-VOID-ABRT-CDE          11630000
044850                                                                  11640000
044851         WHEN SQLCODE = PC-ROW-NOT-FOUND                          11650000
044852             SET PS-END-OF-LATE-VOID        TO TRUE               11660000
044853         WHEN SQLWARN0 NOT EQUAL SPACE                            11670000
044854         WHEN SQLCODE NOT EQUAL ZERO                              11680000
044855             MOVE '5100-FETCH-LATE-VOID-CSR'                      11690000
044856                                            TO PV-PARAGRAPH-NAME  11700000
044857             MOVE 'ERROR ON FETCH OF LATE-VOID-CURSOR'            11710000
044858                                            TO PV-DB2-OPERATION   11720000
044859             PERFORM 9100-SQL-ABEND                               11730000
044860     END-EVALUATE.                                                11740000
044861                                                                  11750000
044862***************************************************************** 11760000
044863* 5200-CLOSE-LATE-VOID-CSR                                        11770000
044864*      CLOSE CURSOR                                               11780000
044865***************************************************************** 11790000
044866 5200-CLOSE-LATE-VOID-CSR.                                        11800000
044867                                                                  11810000
044868     EXEC SQL                                                     11820000
044869          CLOSE LATE-VOID-CURSOR                                  11830000
044870     END-EXEC.                                                    11840000
044871                                                                  11850000
044872     EVALUATE TRUE                                                11860000
044873         WHEN SQLCODE = ZERO                                      11870000
044874              CONTINUE                                            11880000
044875         WHEN SQLWARN0 NOT EQUAL SPACE                            11890000
044876         WHEN SQLCODE NOT EQUAL ZERO                              11900000
044877             MOVE '5200-CLOSE-LATE-VOID-CSR'                      11910000
044878                                            TO PV-PARAGRAPH-NAME  11920000
044879             MOVE 'ERROR ON CLOSE OF LATE-VOID-CURSOR'            11930000
044880                                            TO PV-DB2-OPERATION   11940000
044881             PERFORM 9100-SQL-ABEND                               11950000
044882     END-EVALUATE.                                                11960000
044883                                                                  11970000
044884***************************************************************** 11980000
044885* 6000-PROCESS-LATE-VOID                                          11990000
044886*      PROCESS THE CURSOR TO BUILD THE EXTRACT RECORD FOR A       12000000
044887*      LATE VOID TRANSACTION.   THE SIGN ON THE VOID TRANSACTION  12010000
044888*      IS MULTIPLIED BY -1 SO IT WILL OFFSET THE ORIGINAL         12020000
044889*      TRANSACTION.                                               12030000
044890***************************************************************** 12040000
044891  6000-PROCESS-LATE-VOID.                                         12050000
044892                                                                  12060000
044893*    IF EPTND-TNDR-TYP-CDE = '08'                                 12070000
044894*         CONTINUE                                                12080000
044895*    ELSE                                                         12090000
044896        COMPUTE PV-TNDR-AMT =                                     12100000
044897                EPTND-TNDR-AMT * -1                               12110000
044898        END-COMPUTE.                                              12120000
044899        COMPUTE PV-TAX-AMT  =                                     12130000
044900                EPTRN-SLS-TX-AMT * -1                             12140000
044901        END-COMPUTE.                                              12150000
044902        PERFORM 4000-WRITE-EXTRACT-FILE.                          12160000
044903*    END-IF.                                                      12170000
044904                                                                  12180000
044905     PERFORM 5100-FETCH-LATE-VOID-CSR.                            12190000
044906                                                                  12200000
044907******************************************************************12210000
044910* 9100-SQL-ABEND                                                  12220000
045000*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.12230000
045100******************************************************************12240000
045200 9100-SQL-ABEND.                                                  12250000
045300     DISPLAY '** ABEND     **'.                                   12260000
045400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        12270000
045500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              12280000
045600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               12290000
045700                                                                  12300000
045800******************************************************************12310000
045900* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     12320000
046000* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      12330000
046100******************************************************************12340000
046200     COPY DPPD004.                                                12350000
046300                                                                  12360000
046400     SET AC-DB2-ERROR TO TRUE.                                    12370000
046500     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12380000
046600                                                                  12390000
046700******************************************************************12400000
046800* 9999-ABEND                                                      12410000
046900*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  12420000
047000******************************************************************12430000
047100 9999-ABEND.                                                      12440000
047200                                                                  12450000
047300     DISPLAY '** ABEND           **'.                             12460000
047400     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  12470000
047500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        12480000
047600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       12490000
047700     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       12500000
047800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12510000
