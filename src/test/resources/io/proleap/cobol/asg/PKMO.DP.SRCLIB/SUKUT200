000100***************************************************************** 00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300 PROGRAM-ID.             SUKUT200.                                00030002
000400 AUTHOR.                 DENISE HAHN.                             00040002
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050002
000600 DATE-WRITTEN.           DECEMBER 2019.                           00060003
000700 DATE-COMPILED.                                                   00070002
000800***************************************************************** 00080002
000900*  THIS PROGRAM WILL EXTRACT A LIST OF OUTBOUND TRIPS TO BE     * 00090003
001000*  SUMMARIZED.                                                  * 00100003
001100*                                                               * 00110002
001200*  TRIPS BEING SELECTED WILL ONLY BE FOR DC SHIPPING TRAILERS.  * 00120003
001300*  THESE TRAILERS ARE FOR STORES. DOOR TYPE:  SH                * 00130003
001400*                                                               * 00140002
001500*  ANY TRIP FROM THE CURSOR THAT HAS NOT BEEN SUMMARIZED WILL   * 00150003
001600*  BE WRITTEN TO THE EXTRACT FILE.                              * 00160003
001700*                                                               * 00170002
001710*  ONLY TRIPS IN A DO (DC OPEN) OR DC (DC CLOSED) WILL BE       * 00171003
001720*  SELECTED                                                     * 00172003
001721*                                                               * 00172102
001722*  WST PARM - OTBDTRLRSM CONTAINS THE HOURS BACK TO CHECK       * 00172203
001723*           - EX:  DO = 1 HOUR BACK                             * 00172303
001724*                  SELECT THE DO ROW, CURRENT TMST BACK 1 HOUR  * 00172403
001725*                  ANY DO TRLR WHERE THE TRAILER SUMMARY IS     * 00172503
001726*                  BEFORE THE CALCULATED TMST WILL BE WRITTEN   * 00172603
001727*                  TO THE EXTRACT FILE.                         * 00172703
001728*                                                               * 00172802
001729*  EXTRACT FILE FORMAT:  SURD166                                * 00172903
001730*  FILE WILL BE USED IN:  SUKUT201 THAT CALLS SUKUT576 TO       * 00173003
001731*                         SUMMARIZE THE TRAILER                 * 00173103
001732***************************************************************** 00173203
001740 ENVIRONMENT DIVISION.                                            00174002
001750 CONFIGURATION SECTION.                                           00175002
001760                                                                  00176002
001770 SOURCE-COMPUTER.        IBM-3090.                                00177002
001780 OBJECT-COMPUTER.        IBM-3090.                                00178002
001790                                                                  00179002
001800***************************************************************** 00180002
001900 INPUT-OUTPUT SECTION.                                            00190002
002000                                                                  00200002
002100 FILE-CONTROL.                                                    00210002
002200                                                                  00220002
002600     SELECT OUTPUT-FILE                                           00260002
002700         ASSIGN TO OUT01.                                         00270002
002800                                                                  00280002
002900***************************************************************** 00290002
003000 DATA DIVISION.                                                   00300002
003100***************************************************************** 00310002
003200 FILE SECTION.                                                    00320002
003660                                                                  00366002
003670 FD  OUTPUT-FILE                                                  00367002
003680     RECORDING MODE IS F                                          00368002
003690     BLOCK CONTAINS 0  RECORDS.                                   00369002
003700                                                                  00370002
003800     COPY SURD166.                                                00380003
003900                                                                  00390002
004000***************************************************************** 00400002
004100 WORKING-STORAGE SECTION.                                         00410002
004200                                                                  00420002
004300 01  PROGRAM-SWITCHES.                                            00430002
004400     05  PS-EOF-SW                   PIC X(01) VALUE 'N'.         00440002
004500         88  PS-EOF-YES                        VALUE 'Y'.         00450002
004600         88  PS-EOF-NO                         VALUE 'N'.         00460002
004940                                                                  00494002
004950 01  PC-PROGRAM-CONSTANTS.                                        00495002
004960     05  PC-SUKUT200                 PIC X(08) VALUE              00496002
004970                                               'SUKUT200'.        00497002
004980     05  PC-DEFAULT-TMST             PIC X(26)  VALUE             00498002
004990                                    '9999-09-09-09.09.09.999999'. 00499002
004991     05  PC-DO-STATUS                PIC X(02)  VALUE 'DO'.       00499103
004992     05  PC-DC-STATUS                PIC X(02)  VALUE 'DC'.       00499203
004993     05  PC-SH-TRIP                  PIC X(02)  VALUE 'SH'.       00499303
005000                                                                  00500002
005100 01  PV-PROGRAM-VARIABLES.                                        00510003
005200     05  PV-CURRENT-TMST             PIC X(26)  VALUE             00520002
005300                                    '9999-09-09-09.09.09.999999'. 00530002
008200                                                                  00820002
008300     05  PV-SQLCODE                  PIC 9(09) VALUE ZERO.        00830002
008500                                                                  00850002
009430 01  PV-ABEND-FIELDS.                                             00943002
009440     05  PV-ABEND-CODE               PIC S9(4) VALUE +0           00944002
009450                                               COMP SYNC.         00945002
009460     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT200'.  00946002
009470     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      00947002
009480     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      00948002
009500     05  PV-MESSAGE-1                PIC X(79) VALUE SPACES.      00950003
009510     05  PV-MESSAGE-2                PIC X(79) VALUE SPACES.      00951003
009520     05  PV-MESSAGE-3                PIC X(79) VALUE SPACES.      00952003
009530     05  PV-MESSAGE-4                PIC X(79) VALUE SPACES.      00953003
009540     05  PV-MESSAGE-5                PIC X(79) VALUE SPACES.      00954003
009900     05  PV-DB2-TABLE-NAME-1         PIC X(20) VALUE SPACES.      00990009
010000     05  PV-DB2-TABLE-NAME-2         PIC X(20) VALUE SPACES.      01000009
010010     05  PV-DB2-TABLE-NAME-3         PIC X(20) VALUE SPACES.      01001009
010020     05  PV-DB2-TABLE-NAME-4         PIC X(20) VALUE SPACES.      01002009
010030     05  PV-DB2-TABLE-NAME-5         PIC X(20) VALUE SPACES.      01003009
010100                                                                  01010002
010200     05  PV-DISP-SQLCODE             PIC -9(03)  VALUE ZEROES.    01020003
010500     05  PV-DISP-TRLR-CNT            PIC ZZZ,ZZZ,ZZ9.             01050003
010501     05  PV-DISP-CRTN-CNT            PIC ZZZ,ZZZ,ZZ9.             01050103
010502     05  PV-DISP-UNIT-QTY            PIC ZZZ,ZZZ,ZZ9.             01050203
010510     05  PV-DISP-OPER                PIC  Z(04)  VALUE ZEROES.    01051003
010511     05  PV-DISP-DEST                PIC  Z(04)  VALUE ZEROES.    01051103
010520     05  PV-DISP-TRIP                PIC  Z(09)  VALUE ZEROES.    01052003
010530     05  PV-DISP-TRLR-SRL            PIC  Z(09)  VALUE ZEROES.    01053003
010531     05  PV-TRIP-COUNT               PIC  9(09)  VALUE ZEROES.    01053108
010532                                                                  01053207
010533     05  PV-LAST-SUM-TMST            PIC  X(26).                  01053307
010534     05  PV-LAST-SUM-CART-CNT        PIC S9(09)  COMP.            01053407
010535     05  PV-LAST-SUM-UNT-QTY         PIC S9(09)  COMP.            01053507
010536                                                                  01053607
010537     05  PV-NULL-IND-1                  PIC S9(04)  VALUE ZEROS   01053707
010538                                                    COMP SYNC.    01053807
010539     05  PV-NULL-IND-2                  PIC S9(04)  VALUE ZEROS   01053907
010540                                                    COMP SYNC.    01054007
010541     05  PV-NULL-IND-3                  PIC S9(04)  VALUE ZEROS   01054107
010550                                                    COMP SYNC.    01055003
010600                                                                  01060002
010700 01  DK-DB-KEYS.                                                  01070002
010900     05  DK-OPER                     PIC S9(04) COMP.             01090002
010910     05  DK-BACK-DO-TMST             PIC X(26)  VALUE             01091003
010920                                    '9999-09-09-09.09.09.999999'. 01092003
010930     05  DK-BACK-DC-TMST             PIC X(26)  VALUE             01093003
010940                                    '9999-09-09-09.09.09.999999'. 01094003
011100                                                                  01110002
011200                                                                  01120002
011300******************************************************************01130002
011400*  USED FOR DB2 ERROR MESSAGE BUILDING                            01140002
011500******************************************************************01150002
011600     COPY DPWS004.                                                01160002
011700                                                                  01170002
011800******************************************************************01180002
011900*   DB2 SQL COMMUNICATION AREA                                    01190002
012000******************************************************************01200002
012100     EXEC SQL                                                     01210002
012200          INCLUDE SQLCA                                           01220002
012300     END-EXEC.                                                    01230002
012400                                                                  01240002
012500                                                                  01250002
012600*---------------------------------------------------------------* 01260002
012700*  WST00008 - WST_INTGRTN_TYP                                     01270003
012800*---------------------------------------------------------------* 01280002
012900     EXEC SQL                                                     01290002
013000          INCLUDE WST00008                                        01300003
013100     END-EXEC.                                                    01310002
013200                                                                  01320002
013300*---------------------------------------------------------------* 01330002
013400*  WST00009 - WST_ATTR_DEFN                                       01340003
013500*---------------------------------------------------------------* 01350002
013600     EXEC SQL                                                     01360002
013700          INCLUDE WST00009                                        01370003
013800     END-EXEC.                                                    01380002
013900                                                                  01390002
014000*---------------------------------------------------------------* 01400002
014100*  WST00010 - WST_ATTR_ELEM                                       01410003
014200*---------------------------------------------------------------* 01420002
014300     EXEC SQL                                                     01430002
014400          INCLUDE WST00010                                        01440003
014500     END-EXEC.                                                    01450002
014600                                                                  01460002
014610*---------------------------------------------------------------* 01461003
014620*  TSUOBTR - OUTBOUND TRIP                                        01462003
014630*---------------------------------------------------------------* 01463003
014640     EXEC SQL                                                     01464003
014650          INCLUDE TSUOBTR                                         01465003
014660     END-EXEC.                                                    01466003
014670                                                                  01467003
014680*---------------------------------------------------------------* 01468003
014690*  TSUOBTS - OUTBOUND TRIP STATUS                                 01469003
014691*---------------------------------------------------------------* 01469103
014692     EXEC SQL                                                     01469203
014693          INCLUDE TSUOBTS                                         01469303
014694     END-EXEC.                                                    01469403
014695                                                                  01469503
014696*---------------------------------------------------------------* 01469603
014697*  SUT00007 - SUT_TRIP_SUM - OUTBOUND TRIP SUMMARY                01469703
014698*---------------------------------------------------------------* 01469803
014699     EXEC SQL                                                     01469903
014700          INCLUDE SUT00007                                        01470003
014701     END-EXEC.                                                    01470103
014702                                                                  01470203
014703*---------------------------------------------------------------* 01470303
014704* CURSOR WILL BRING BACK ANY OUTBOUND TRAILER DC OPENED STATUS    01470403
014705* HAS NOT BEEN SUMMARIZED IN THE LAST HOUR.                       01470503
014706*                                                                 01470603
014707* NEW PARM IN WST INTEGRATION TABLES TO SELECT THE                01470703
014708* TRIP STATUSES TO BE SELECTED ("DO"-DC OPEN) ("DC" - DC CLOSED)  01470803
014709* PARM WILL INCLUDE # HOURS TO LOOK BACK                          01470903
014710*                                                                 01471003
014711* FIRST PART OF THE SQL BRING BACK ANY DC TRAILERS THAT ARE IN    01471103
014712* DO (DC OPEN)  OR  DC (DC CLOSED) STATUS                         01471203
014721*---------------------------------------------------------------* 01472103
014722     EXEC SQL                                                     01472203
014723       DECLARE TRIP_EXTRACT_CSR CURSOR FOR                        01472303
014724        SELECT T1.OTBND_TRIP_ID                                   01472403
014725             , T1.ORGN_OPER_UNT_ID                                01472503
014726             , T1.DEST_OPER_UNT_ID                                01472603
014727             , T1.TRLR_SRL_NBR                                    01472703
014728             , T1.DOOR_TYP_CDE                                    01472803
014729             , T1.TRIP_STAT_CDE                                   01472903
014730             , T2.LAST_SUM_TMST                                   01473003
014731             , T2.LAST_SUM_CART_CNT                               01473103
014732             , T2.LAST_SUM_UNT_QTY                                01473203
014733          FROM                                                    01473303
014734        (SELECT A.OTBND_TRIP_ID                                   01473403
014735              , A.ORGN_OPER_UNT_ID                                01473503
014736              , A.DEST_OPER_UNT_ID                                01473603
014737              , A.TRLR_SRL_NBR                                    01473703
014738              , A.DOOR_TYP_CDE                                    01473803
014739              , B.TRIP_STAT_CDE                                   01473903
014740           FROM TSUOBTR A                                         01474003
014741              , TSUOBTS B                                         01474103
014742          WHERE A.OTBND_TRIP_ID          =  B.OTBND_TRIP_ID       01474203
014743            AND A.DOOR_TYP_CDE           = :PC-SH-TRIP            01474303
014744            AND A.OTBND_TRIP_ID          =  B.OTBND_TRIP_ID       01474403
014745            AND B.OTBND_STAT_TMST IN                              01474503
014746                (SELECT MAX(C.OTBND_STAT_TMST)                    01474603
014747                   FROM TSUOBTS C                                 01474703
014748                  WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID)      01474806
014750            AND ((B.TRIP_STAT_CDE        = :PC-DO-STATUS  AND     01475006
014751                  B.OTBND_STAT_TMST     <= :DK-BACK-DO-TMST)      01475106
014752                  OR                                              01475206
014753                 (B.TRIP_STAT_CDE        = :PC-DC-STATUS  AND     01475306
014754                  B.OTBND_STAT_TMST     <= :DK-BACK-DC-TMST)      01475406
014755                )                                                 01475506
014756        ) AS T1                                                   01475606
014757        LEFT OUTER JOIN                                           01475706
014758        (SELECT AA.OTBND_TRIP_ID                                  01475806
014759              , DD.CRE_TMST       AS LAST_SUM_TMST                01475906
014760              , DD.CART_QTY       AS LAST_SUM_CART_CNT            01476006
014761              , DD.UNT_QTY        AS LAST_SUM_UNT_QTY             01476106
014762           FROM TSUOBTR AA                                        01476206
014763              , TSUOBTS BB                                        01476306
014764              , SUT_TRIP_SUM DD                                   01476406
014765          WHERE AA.OTBND_TRIP_ID         =  BB.OTBND_TRIP_ID      01476506
014766            AND AA.DOOR_TYP_CDE          = :PC-SH-TRIP            01476606
014767            AND AA.OTBND_TRIP_ID         =  BB.OTBND_TRIP_ID      01476706
014768            AND BB.OTBND_STAT_TMST IN                             01476806
014769                (SELECT MAX(CC.OTBND_STAT_TMST)                   01476906
014770                   FROM TSUOBTS CC                                01477006
014771                  WHERE BB.OTBND_TRIP_ID =  CC.OTBND_TRIP_ID)     01477106
014772            AND ((BB.TRIP_STAT_CDE       = :PC-DO-STATUS  AND     01477206
014773                  BB.OTBND_STAT_TMST    <= :DK-BACK-DO-TMST)      01477306
014774                  OR                                              01477406
014775                 (BB.TRIP_STAT_CDE       = :PC-DC-STATUS  AND     01477506
014776                  BB.OTBND_STAT_TMST    <= :DK-BACK-DC-TMST)      01477606
014777                )                                                 01477706
014778            AND AA.OTBND_TRIP_ID         = DD.OTBND_TRIP_ID       01477806
014779            AND DD.CRE_TMST IN                                    01477906
014780                (SELECT MAX(EE.CRE_TMST)                          01478006
014781                   FROM SUT_TRIP_SUM EE                           01478106
014782                  WHERE DD.OTBND_TRIP_ID  =  EE.OTBND_TRIP_ID)    01478206
014783        ) AS T2                                                   01478306
014784          ON T1.OTBND_TRIP_ID  =  T2.OTBND_TRIP_ID                01478406
014785             ORDER BY T1.ORGN_OPER_UNT_ID                         01478506
014786                    , T1.DEST_OPER_UNT_ID                         01478606
014787                    , T1.OTBND_TRIP_ID                            01478706
014788       WITH UR                                                    01478806
014815     END-EXEC.                                                    01481503
014816                                                                  01481606
014817******************************************************************01481703
014820 PROCEDURE DIVISION.                                              01482003
014900     DISPLAY '**** START OF SUKUT200 ****'.                       01490002
015000                                                                  01500002
015100*OPEN FILES.                                                      01510002
015300     OPEN OUTPUT OUTPUT-FILE.                                     01530002
015400                                                                  01540002
015500     SET   PS-EOF-NO               TO  TRUE                       01550002
015600                                                                  01560002
015700     PERFORM 1000-INITIALIZATION.                                 01570002
015800                                                                  01580002
015900     PERFORM 2000-PROCESS-CSR                                     01590003
016000       UNTIL PS-EOF-YES.                                          01600002
016100                                                                  01610002
016110     PERFORM 7040-CLOSE-CSR.                                      01611011
016120                                                                  01612011
016200     MOVE PV-TRIP-COUNT  TO  PV-DISP-TRLR-CNT.                    01620003
016210     DISPLAY '*'.                                                 01621003
016220     DISPLAY '* TRLR COUNT: ' PV-DISP-TRLR-CNT.                   01622003
016230     DISPLAY '*'.                                                 01623003
016240     DISPLAY '***************************'.                       01624003
016250     DISPLAY ' '.                                                 01625003
016300                                                                  01630003
019400                                                                  01940002
019500*CLOSE FILES.                                                     01950002
019700     CLOSE OUTPUT-FILE.                                           01970003
019800                                                                  01980002
019900     GOBACK.                                                      01990002
020000                                                                  02000002
020100******************************************************************02010002
020200*  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               *02020002
020300******************************************************************02030002
020400 1000-INITIALIZATION.                                             02040002
020500     DISPLAY '1000-INITIALIZE '.                                  02050002
020600                                                                  02060002
020700     PERFORM 7000-SELECT-DO-TMST.                                 02070003
020701     DISPLAY 'DC OPEN TMST:  ' DK-BACK-DO-TMST.                   02070103
020702                                                                  02070203
020710     PERFORM 7010-SELECT-DC-TMST.                                 02071003
020711     DISPLAY 'DC CLOSE TMST: ' DK-BACK-DC-TMST.                   02071103
020720                                                                  02072003
020730     PERFORM 7020-OPEN-CSR.                                       02073003
020740     PERFORM 7030-FETCH-CSR.                                      02074003
020800                                                                  02080002
020900                                                                  02090002
021000******************************************************************02100002
021100**                                                                02110003
021200******************************************************************02120002
021300 2000-PROCESS-CSR.                                                02130003
021400                                                                  02140002
021500     MOVE SUOBTR-OTBND-TRIP-ID    TO SU166-OTBND-TRIP-ID.         02150010
021600     MOVE SUOBTR-ORGN-OPER-UNT-ID TO SU166-OPER-UNT-ID.           02160005
021700     MOVE SUOBTR-DEST-OPER-UNT-ID TO SU166-DEST-OPER-UNT-ID.      02170010
021800     MOVE SUOBTR-TRLR-SRL-NBR     TO SU166-TRLR-SRL-NBR.          02180010
021900     MOVE SUOBTR-DOOR-TYP-CDE     TO SU166-DOOR-TYPE.             02190010
022000     MOVE SUOBTS-TRIP-STAT-CDE    TO SU166-TRIP-ST.               02200010
022100     MOVE PV-LAST-SUM-TMST        TO SU166-LAST-SUM-TMST.         02210004
022200     MOVE PV-LAST-SUM-CART-CNT    TO SU166-LAST-SUM-CRTN-CNT.     02220004
022210     MOVE PV-LAST-SUM-UNT-QTY     TO SU166-LAST-SUM-UNT-QTY.      02221004
022220                                                                  02222003
022270     PERFORM 8000-WRITE-OUTPUT-RECORD.                            02227003
022290                                                                  02229002
022300     PERFORM 7030-FETCH-CSR.                                      02230003
022400                                                                  02240002
022500                                                                  02250002
028500******************************************************************02850002
028600* SELECT THE TMST FOR TRIPS IN DO STATUS                         *02860003
028700******************************************************************02870002
028710 7000-SELECT-DO-TMST.                                             02871003
028711                                                                  02871103
028712     EXEC SQL                                                     02871203
028713          SELECT  CURRENT TIMESTAMP - E.ATTR_ELEM_NBR HOUR        02871304
028725            INTO :DK-BACK-DO-TMST                                 02872503
028728            FROM  WST_INTGRTN_TYP  A                              02872803
028729               ,  WST_ATTR_DEFN    B                              02872903
028730               ,  WST_ATTR_ELEM    C                              02873003
028731               ,  WST_ATTR_ELEM    D                              02873103
028732               ,  WST_ATTR_ELEM    E                              02873203
028733             WHERE                                                02873303
028734                   A.INTGRTN_TYP_CDE    = 'OTBDTRLRSM'            02873403
028735               AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE      02873503
028736               AND B.ATTR_DEFN_SEQ_NBR  =  1                      02873603
028737               AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE      02873703
028738               AND C.ATTR_DEFN_SEQ_NBR  =  1                      02873803
028739               AND B.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE      02873903
028740               AND D.ATTR_DEFN_SEQ_NBR  =  2                      02874003
028741               AND B.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE      02874103
028742               AND E.ATTR_DEFN_SEQ_NBR  =  3                      02874203
028743               AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR    02874303
028744               AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR    02874403
028745               AND C.ATTR_ELEM_NBR      =  90                     02874503
028746               AND D.ATTR_ELEM_TXT      = :PC-DO-STATUS           02874604
028747              WITH UR                                             02874703
028753     END-EXEC.                                                    02875303
028754                                                                  02875403
028755     EVALUATE TRUE                                                02875503
028756         WHEN SQLCODE = ZERO                                      02875603
028757              CONTINUE                                            02875703
028758                                                                  02875803
028762         WHEN OTHER                                               02876203
028763             MOVE  SQLCODE         TO PV-DISP-SQLCODE             02876307
028764             MOVE  '7000-SELECT-DO-TMST '                         02876403
028765                                   TO PV-ABEND-PARAGRAPH          02876503
028766             MOVE 'DO PARM: OTBDTRLRSM'                           02876603
028767                                   TO PV-ABEND-OPERATION          02876703
028768             MOVE 'CHECKING OFFSET DAYS PARM '                    02876803
028769                                   TO PV-MESSAGE-1                02876903
028770             MOVE ' '              TO PV-MESSAGE-2                02877003
028771             MOVE ' '              TO PV-MESSAGE-3                02877103
028772             MOVE ' '              TO PV-MESSAGE-4                02877203
028773             MOVE ' '              TO PV-MESSAGE-5                02877303
028774             MOVE 'WST_INTGRTN_TYP' TO PV-DB2-TABLE-NAME-1        02877407
028775             MOVE 'WST_ATTR_DEFN'   TO PV-DB2-TABLE-NAME-2        02877507
028776             MOVE 'WST_ATTR_ELEM'   TO PV-DB2-TABLE-NAME-3        02877607
028777             MOVE ' '               TO PV-DB2-TABLE-NAME-4        02877707
028778             MOVE ' '               TO PV-DB2-TABLE-NAME-5        02877807
028779             PERFORM 9900-DB2-ABEND                               02877903
028780     END-EVALUATE.                                                02878003
028781                                                                  02878103
028784                                                                  02878403
028785******************************************************************02878503
028786* SELECT THE TMST FOR TRIPS IN DC STATUS                         *02878603
028788******************************************************************02878803
028789 7010-SELECT-DC-TMST.                                             02878903
028790                                                                  02879003
028791     EXEC SQL                                                     02879103
028792          SELECT  CURRENT TIMESTAMP - E.ATTR_ELEM_NBR HOUR        02879204
028793            INTO :DK-BACK-DC-TMST                                 02879303
028794            FROM  WST_INTGRTN_TYP  A                              02879403
028795               ,  WST_ATTR_DEFN    B                              02879503
028796               ,  WST_ATTR_ELEM    C                              02879603
028797               ,  WST_ATTR_ELEM    D                              02879703
028798               ,  WST_ATTR_ELEM    E                              02879803
028799             WHERE                                                02879903
028800                   A.INTGRTN_TYP_CDE    = 'OTBDTRLRSM'            02880003
028801               AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE      02880103
028802               AND B.ATTR_DEFN_SEQ_NBR  =  1                      02880203
028803               AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE      02880303
028804               AND C.ATTR_DEFN_SEQ_NBR  =  1                      02880403
028805               AND B.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE      02880503
028806               AND D.ATTR_DEFN_SEQ_NBR  =  2                      02880603
028807               AND B.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE      02880703
028808               AND E.ATTR_DEFN_SEQ_NBR  =  3                      02880803
028809               AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR    02880903
028810               AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR    02881003
028811               AND C.ATTR_ELEM_NBR      =  90                     02881103
028812               AND D.ATTR_ELEM_TXT      = :PC-DC-STATUS           02881204
028813              WITH UR                                             02881303
028814     END-EXEC.                                                    02881403
028815                                                                  02881503
028816     EVALUATE TRUE                                                02881603
028817         WHEN SQLCODE = ZERO                                      02881703
028818              CONTINUE                                            02881803
028819                                                                  02881903
028820         WHEN OTHER                                               02882003
028821             MOVE  SQLCODE         TO PV-DISP-SQLCODE             02882107
028822             MOVE  '7010-SELECT-DO-TMST '                         02882203
028823                                   TO PV-ABEND-PARAGRAPH          02882303
028824             MOVE 'DC PARM: OTBDTRLRSM'                           02882403
028825                                   TO PV-ABEND-OPERATION          02882503
028826             MOVE 'CHECKING OFFSET DAYS PARM '                    02882603
028827                                   TO PV-MESSAGE-1                02882703
028828             MOVE ' '              TO PV-MESSAGE-2                02882803
028829             MOVE ' '              TO PV-MESSAGE-3                02882903
028830             MOVE ' '              TO PV-MESSAGE-4                02883003
028831             MOVE ' '              TO PV-MESSAGE-5                02883103
028832             MOVE 'WST_INTGRTN_TYP' TO PV-DB2-TABLE-NAME-1        02883207
028833             MOVE 'WST_ATTR_DEFN'   TO PV-DB2-TABLE-NAME-2        02883307
028834             MOVE 'WST_ATTR_ELEM'   TO PV-DB2-TABLE-NAME-3        02883407
028835             MOVE ' '               TO PV-DB2-TABLE-NAME-4        02883507
028836             MOVE ' '               TO PV-DB2-TABLE-NAME-5        02883607
028837             PERFORM 9900-DB2-ABEND                               02883703
028838     END-EVALUATE.                                                02883803
028839                                                                  02883903
028840                                                                  02884003
028841******************************************************************02884103
028842* OPEN CURSOR: TRIP_EXTRACT_CSR                                  *02884203
028843******************************************************************02884303
028844 7020-OPEN-CSR.                                                   02884403
028845                                                                  02884503
028846     EXEC SQL                                                     02884603
028847          OPEN  TRIP_EXTRACT_CSR                                  02884703
028869     END-EXEC.                                                    02886903
028870                                                                  02887003
028871     EVALUATE TRUE                                                02887103
028872         WHEN SQLCODE = ZERO                                      02887203
028873              CONTINUE                                            02887303
028874                                                                  02887403
028875         WHEN OTHER                                               02887503
028876             MOVE  SQLCODE         TO PV-DISP-SQLCODE             02887607
028877             MOVE  '7020-OPEN-CSR'                                02887703
028878                                   TO PV-ABEND-PARAGRAPH          02887803
028879             MOVE 'OPEN CURSOR        '                           02887903
028880                                   TO PV-ABEND-OPERATION          02888003
028881             MOVE PC-SH-TRIP       TO PV-MESSAGE-1                02888109
028882             MOVE PC-DO-STATUS     TO PV-MESSAGE-2                02888209
028883             MOVE DK-BACK-DO-TMST  TO PV-MESSAGE-3                02888309
028884             MOVE PC-DC-STATUS     TO PV-MESSAGE-4                02888409
028885             MOVE DK-BACK-DC-TMST  TO PV-MESSAGE-5                02888509
028887             MOVE 'TSUOBTR'        TO PV-DB2-TABLE-NAME-1         02888703
028888             MOVE 'TSUOBTS'        TO PV-DB2-TABLE-NAME-2         02888803
028889             MOVE 'SUT_TRIP_SUM'   TO PV-DB2-TABLE-NAME-3         02888903
028890             MOVE ' '              TO PV-DB2-TABLE-NAME-4         02889003
028891             MOVE ' '              TO PV-DB2-TABLE-NAME-5         02889103
028892             PERFORM 9900-DB2-ABEND                               02889203
028893     END-EVALUATE.                                                02889303
028894                                                                  02889403
028895                                                                  02889503
028896******************************************************************02889603
028897* FETCH CURSOR - TRIP_EXTRACT_CSR                                *02889703
028898******************************************************************02889803
028900 7030-FETCH-CSR.                                                  02890003
029000                                                                  02900003
029100     EXEC SQL                                                     02910003
029200          FETCH  TRIP_EXTRACT_CSR                                 02920003
029210          INTO  :SUOBTR-OTBND-TRIP-ID                             02921004
029300             ,  :SUOBTR-ORGN-OPER-UNT-ID                          02930005
029301             ,  :SUOBTR-DEST-OPER-UNT-ID                          02930104
029302             ,  :SUOBTR-TRLR-SRL-NBR                              02930204
029303             ,  :SUOBTR-DOOR-TYP-CDE                              02930304
029304             ,  :SUOBTS-TRIP-STAT-CDE                             02930404
029305             ,  :PV-LAST-SUM-TMST     :PV-NULL-IND-1              02930504
029306             ,  :PV-LAST-SUM-CART-CNT :PV-NULL-IND-2              02930604
029307             ,  :PV-LAST-SUM-UNT-QTY  :PV-NULL-IND-3              02930704
029320     END-EXEC.                                                    02932003
029400                                                                  02940003
029500     EVALUATE TRUE                                                02950003
029600         WHEN SQLCODE = ZERO                                      02960003
029601         WHEN SQLCODE = -305                                      02960103
029610              ADD  1  TO  PV-TRIP-COUNT                           02961003
029611                                                                  02961103
029612              IF  PV-NULL-IND-1  =  -1                            02961203
029613                  MOVE SPACES    TO  PV-LAST-SUM-TMST             02961306
029614              END-IF                                              02961403
029620                                                                  02962003
029621              IF  PV-NULL-IND-2  =  -1                            02962112
029622                  MOVE ZEROES    TO  PV-LAST-SUM-CART-CNT         02962206
029623              END-IF                                              02962303
029624                                                                  02962403
029625              IF  PV-NULL-IND-3  =  -1                            02962512
029626                  MOVE ZEROES    TO  PV-LAST-SUM-UNT-QTY          02962606
029627              END-IF                                              02962703
029628                                                                  02962811
029629         WHEN SQLCODE = +100                                      02962911
029630              SET  PS-EOF-YES   TO TRUE                           02963011
029631                                                                  02963103
029632         WHEN OTHER                                               02963203
029640             MOVE  SQLCODE         TO PV-DISP-SQLCODE             02964007
029650             MOVE  '7030-FETCH-CSR'                               02965009
029660                                   TO PV-ABEND-PARAGRAPH          02966003
029670             MOVE 'CLOSE CURSOR        '                          02967003
029680                                   TO PV-ABEND-OPERATION          02968003
029681             MOVE PC-SH-TRIP       TO PV-MESSAGE-1                02968109
029682             MOVE PC-DO-STATUS     TO PV-MESSAGE-2                02968209
029690             MOVE DK-BACK-DO-TMST  TO PV-MESSAGE-3                02969009
029691             MOVE PC-DC-STATUS     TO PV-MESSAGE-4                02969109
029692             MOVE DK-BACK-DC-TMST  TO PV-MESSAGE-5                02969209
029695             MOVE 'TSUOBTR'        TO PV-DB2-TABLE-NAME-1         02969503
029696             MOVE 'TSUOBTS'        TO PV-DB2-TABLE-NAME-2         02969603
029697             MOVE 'SUT_TRIP_SUM'   TO PV-DB2-TABLE-NAME-3         02969703
029698             MOVE ' '              TO PV-DB2-TABLE-NAME-4         02969803
029699             MOVE ' '              TO PV-DB2-TABLE-NAME-5         02969903
029700             PERFORM 9900-DB2-ABEND                               02970003
029701     END-EVALUATE.                                                02970103
029710                                                                  02971002
029800                                                                  02980002
029810******************************************************************02981003
029820*                                                                *02982003
029830******************************************************************02983003
029840 7040-CLOSE-CSR.                                                  02984003
029841                                                                  02984103
029842     EXEC SQL                                                     02984203
029843          CLOSE  TRIP_EXTRACT_CSR                                 02984303
029844     END-EXEC.                                                    02984403
029845                                                                  02984503
029846     EVALUATE TRUE                                                02984603
029847         WHEN SQLCODE = ZERO                                      02984703
029848              CONTINUE                                            02984803
029849                                                                  02984903
029850         WHEN OTHER                                               02985003
029851             MOVE  SQLCODE         TO PV-DISP-SQLCODE             02985107
029852             MOVE  '7040-CLOSE-CSR'                               02985203
029853                                   TO PV-ABEND-PARAGRAPH          02985303
029854             MOVE 'CLOSE CURSOR        '                          02985403
029855                                   TO PV-ABEND-OPERATION          02985503
029856             MOVE PC-SH-TRIP       TO PV-MESSAGE-1                02985609
029857             MOVE PC-DO-STATUS     TO PV-MESSAGE-2                02985709
029858             MOVE DK-BACK-DO-TMST  TO PV-MESSAGE-3                02985809
029859             MOVE PC-DC-STATUS     TO PV-MESSAGE-4                02985909
029860             MOVE DK-BACK-DC-TMST  TO PV-MESSAGE-5                02986009
029866             MOVE 'TSUOBTR'        TO PV-DB2-TABLE-NAME-1         02986603
029867             MOVE 'TSUOBTS'        TO PV-DB2-TABLE-NAME-2         02986703
029868             MOVE 'SUT_TRIP_SUM'   TO PV-DB2-TABLE-NAME-3         02986803
029869             MOVE ' '              TO PV-DB2-TABLE-NAME-4         02986903
029870             MOVE ' '              TO PV-DB2-TABLE-NAME-5         02987003
029871             PERFORM 9900-DB2-ABEND                               02987103
029872     END-EVALUATE.                                                02987203
029873                                                                  02987303
029880                                                                  02988003
029900******************************************************************02990002
030000*                                                                *03000002
030100******************************************************************03010002
030200 8000-WRITE-OUTPUT-RECORD.                                        03020002
030300                                                                  03030002
033400     WRITE SU166-OTBND-TRLR-RECORD.                               03340003
034700                                                                  03470002
034800                                                                  03480002
034900******************************************************************03490002
035000*  ABEND ROUTINE                                                 *03500002
035100******************************************************************03510002
035200 9900-DB2-ABEND.                                                  03520002
035300                                                                  03530002
035400     MOVE SQLCODE TO PV-SQLCODE.                                  03540002
035500     DISPLAY '*** DB2 ERROR '.                                    03550002
035600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       03560002
035700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 03570002
035800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               03580002
035900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               03590002
036000     DISPLAY '*** MESSAGE   = ' PV-MESSAGE-1.                     03600003
036100     DISPLAY '***           = ' PV-MESSAGE-2.                     03610003
036110     DISPLAY '***           = ' PV-MESSAGE-3.                     03611003
036120     DISPLAY '***           = ' PV-MESSAGE-4.                     03612003
036130     DISPLAY '***           = ' PV-MESSAGE-5.                     03613003
036200     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME-1.              03620002
036300     DISPLAY '*** TABLE 2   = ' PV-DB2-TABLE-NAME-2.              03630002
036310     DISPLAY '*** TABLE 3   = ' PV-DB2-TABLE-NAME-3.              03631003
036320     DISPLAY '*** TABLE 4   = ' PV-DB2-TABLE-NAME-4.              03632003
036330     DISPLAY '*** TABLE 5   = ' PV-DB2-TABLE-NAME-5.              03633003
036400                                                                  03640002
036500     COPY DPPD004.                                                03650002
036600                                                                  03660002
036700     MOVE +4013 TO PV-ABEND-CODE.                                 03670002
036800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03680002
036900                                                                  03690002
038100******************************************************************03810002
038200*                 E N D   O F   P R O G R A M                    *03820002
038300******************************************************************03830002
