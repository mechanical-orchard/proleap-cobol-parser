000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.        TRKUP003.                                     00050001
000600 AUTHOR.            LARRY SCHLEICHER.                             00060001
000700 INSTALLATION.      KOHLS.                                        00070001
000800 DATE-WRITTEN       DECEMBER 1994.                                00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  THIS PROGRAM WILL DELETE INACTIVE TVHTRIPS (AND THE           *00120001
001300*  CORRESPONDING SHIPMENT ROWS) WHERE THE VEHICL NUMBER IS NULL  *00130001
001400*  AND THE LAST UPDATE DATE IS OLDER THAN THE NUMBER OF DAYS     *00140001
001500*  ON THE CONTROL CARD. ROWS ON THE TVEHICL TABLE WILL BE UPDATED*00150001
001600*  WITH A STATUS OF 'ET' IF THEY ARE OLDER THAN THE NUMBER OF    *00160001
001700*  DAYS ON THE CONTROL CARD AND HAVE NOT BEEN DEPARTED.          *00170001
001800******************************************************************00180001
001900                                                                  00190001
002000******************************************************************00200001
002100 ENVIRONMENT DIVISION.                                            00210001
002200******************************************************************00220001
002300                                                                  00230001
002400 CONFIGURATION SECTION.                                           00240001
002500                                                                  00250001
002600 SOURCE-COMPUTER.   IBM-3090.                                     00260001
002700 OBJECT-COMPUTER.   IBM-3090.                                     00270001
002800                                                                  00280001
002900 INPUT-OUTPUT SECTION.                                            00290001
003000                                                                  00300001
003100 FILE-CONTROL.                                                    00310001
003200                                                                  00320001
003300******************************************************************00330001
003400 DATA DIVISION.                                                   00340001
003500******************************************************************00350001
003600                                                                  00360001
003700******************************************************************00370001
003800 WORKING-STORAGE SECTION.                                         00380001
003900******************************************************************00390001
004000                                                                  00400001
004100 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00410001
004200                                                     COMP SYNC.   00420001
004300     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00430001
004400     88  ABEND-4002-READ-ERROR                       VALUE +4002. 00440001
004500     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00450001
004600     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00460001
004700     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00470001
004800     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00480001
004900     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00490001
005000     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 00500001
005100     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 00510001
005400     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00540001
005500                                                                  00550001
005600 01  DL1-DETAIL-LINE-1.                                           00560001
005700     05  FILLER                          PIC  X(05)  VALUE SPACE. 00570001
005800     05  FILLER                          PIC  X(24)  VALUE        00580001
005900         ' TOTAL TVHTRIPS READ:   '.                              00590001
006000     05  DL1-TOT-TVHTRIP-READ            PIC  ZZZ,ZZZ,ZZ9.        00600001
006100                                                                  00610001
006200 01  DL2-DETAIL-LINE-2.                                           00620001
006300     05  FILLER                          PIC  X(05)  VALUE SPACE. 00630001
006400     05  FILLER                          PIC  X(24)  VALUE        00640001
006500         ' TOTAL TVHTRIPS DELETED:'.                              00650001
006600     05  DL2-TOT-TVHTRIP-DEL             PIC  ZZZ,ZZZ,ZZ9.        00660001
006700                                                                  00670001
006800 01  DL3-DETAIL-LINE-3.                                           00680001
006900     05  FILLER                          PIC  X(05)  VALUE SPACE. 00690001
007000     05  FILLER                          PIC  X(24)  VALUE        00700001
007100         ' TOTAL TSHPTPOS READ:   '.                              00710001
007200     05  DL3-TOT-TSHPTPO-READ            PIC  ZZZ,ZZZ,ZZ9.        00720001
007300                                                                  00730001
007400 01  DL4-DETAIL-LINE-4.                                           00740001
007500     05  FILLER                          PIC  X(05)  VALUE SPACE. 00750001
007600     05  FILLER                          PIC  X(24)  VALUE        00760001
007700         ' TOTAL TSHPTPOS DELETED:'.                              00770001
007800     05  DL4-TOT-TSHPTPO-DEL             PIC  ZZZ,ZZZ,ZZ9.        00780001
007900                                                                  00790001
008000 01  DL5-DETAIL-LINE-5.                                           00800001
008100     05  FILLER                          PIC  X(05)  VALUE SPACE. 00810001
008200     05  FILLER                          PIC  X(24)  VALUE        00820001
008300         ' TOTAL TSHIPMTS READ:   '.                              00830001
008400     05  DL5-TOT-TSHIPMT-READ            PIC  ZZZ,ZZZ,ZZ9.        00840001
008500                                                                  00850001
008600 01  DL6-DETAIL-LINE-6.                                           00860001
008700     05  FILLER                          PIC  X(05)  VALUE SPACE. 00870001
008800     05  FILLER                          PIC  X(24)  VALUE        00880001
008900         ' TOTAL TSHIPMTS DELETED:'.                              00890001
009000     05  DL6-TOT-TSHIPMT-DEL             PIC  ZZZ,ZZZ,ZZ9.        00900001
009100                                                                  00910001
009200 01  DL7-DETAIL-LINE-7.                                           00920001
009300     05  FILLER                          PIC  X(05)  VALUE SPACE. 00930001
009400     05  FILLER                          PIC  X(24)  VALUE        00940001
009500         ' TOTAL TSHIPSTS READ:   '.                              00950001
009600     05  DL7-TOT-TSHIPST-READ            PIC  ZZZ,ZZZ,ZZ9.        00960001
009700                                                                  00970001
009800 01  DL8-DETAIL-LINE-8.                                           00980001
009900     05  FILLER                          PIC  X(05)  VALUE SPACE. 00990001
010000     05  FILLER                          PIC  X(24)  VALUE        01000001
010100         ' TOTAL TSHIPSTS DELETED:'.                              01010001
010200     05  DL8-TOT-TSHIPST-DEL             PIC  ZZZ,ZZZ,ZZ9.        01020001
010300                                                                  01030001
010400 01  DL9-DETAIL-LINE-9.                                           01040001
010500     05  FILLER                          PIC  X(05)  VALUE SPACE. 01050001
010600     05  FILLER                          PIC  X(24)  VALUE        01060001
010700         ' TOTAL TVEHICLS READ:   '.                              01070001
010800     05  DL9-TOT-TVEHICL-READ            PIC  ZZZ,ZZZ,ZZ9.        01080001
010900                                                                  01090001
011000 01  DL10-DETAIL-LINE-10.                                         01100001
011100     05  FILLER                          PIC  X(05)  VALUE SPACE. 01110001
011200     05  FILLER                          PIC  X(24)  VALUE        01120001
011300         ' TOTAL TVEHICLS UPDATED:'.                              01130001
011400     05  DL10-TOT-TVEHICL-UPD            PIC  ZZZ,ZZZ,ZZ9.        01140001
011500                                                                  01150001
011600 01  DL10-DETAIL-LINE-12.                                         01160001
011700     05  FILLER                          PIC  X(05)  VALUE SPACE. 01170001
011800     05  FILLER                          PIC  X(24)  VALUE        01180001
011900         ' TOTAL TAUVHCL INSERTED:'.                              01190001
012000     05  DL10-TOT-TAUVHCL-INSERT         PIC  ZZZ,ZZZ,ZZ9.        01200001
012100                                                                  01210001
012200 01  DL11-DETAIL-LINE-11.                                         01220001
012300     05  FILLER                          PIC  X(05)  VALUE SPACE. 01230001
012400     05  FILLER                          PIC  X(28)  VALUE        01240001
012500         ' TOTAL COMMITS TAKEN:       '.                          01250001
012600     05  DL11-TOT-COMMITS                PIC  ZZZ,ZZ9.            01260001
012700                                                                  01270001
012800 01  CC-CONTROL-CARD.                                             01280001
012900     05  CC-CONTROL-LITERAL              PIC  X(08).              01290001
013000         88  CC-TRKUP003                             VALUE        01300001
013100             'TRKUP003'.                                          01310001
013200     05  FILLER                          PIC  X(01)  VALUE SPACE. 01320001
013300     05  CC-COMMITS.                                              01330001
013400         10  CC-COMMIT-CNT               PIC  9(04)  VALUE ZERO.  01340001
013500     05  FILLER                          PIC  X(01)  VALUE SPACE. 01350001
013600     05  CC-DAYS-SAVE-SHIPMENT           PIC  9(03).              01360001
013700     05  FILLER                          PIC  X      VALUE SPACE. 01370001
013800     05  CC-CNTL-CALENDAR-TYPE           PIC  X(02)  VALUE ZEROS. 01380001
013900     05  FILLER                          PIC  X(01)  VALUE SPACE. 01390001
014000     05  CC-DAYS-SAVE-VHTRIPS            PIC  9(03).              01400001
014100     05  FILLER                          PIC  X(56)  VALUE SPACE. 01410001
014200                                                                  01420001
014300 01  PC-PROGRAM-CONSTANTS.                                        01430001
014400     05  PC-DPKUT500                     PIC X(08)   VALUE        01440001
014500                                                     'DPKUT500'.  01450001
014600     05  PC-TRKUP003                     PIC X(08)   VALUE        01460001
014700                                                     'TRKUP003'.  01470001
014800     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     01480001
014900                                                     COMP SYNC.   01490001
015000     05  PC-1                            PIC S9(01)  VALUE +1.    01500001
015100     05  PC-30                           PIC  9(03)  VALUE 30.    01510001
015200     05  PC-50                           PIC  X(02)  VALUE '50'.  01520001
015300     05  PC-A                            PIC  X(01)  VALUE 'A'.   01530001
015400     05  PC-I                            PIC  X(01)  VALUE 'I'.   01540001
015500     05  PC-DASH                         PIC  X(01)  VALUE '-'.   01550001
015600     05  PC-VE                           PIC  X(02)  VALUE 'VE'.  01560001
015700     05  PC-ET                           PIC  X(02)  VALUE 'ET'.  01570001
015800     05  PC-NEG-1                        PIC S9(03)  VALUE -1     01580001
015900                                                     COMP-3.      01590001
016000     05  PC-DEFAULT-DATE                 PIC  X(26)  VALUE        01600001
016100         '9999-09-09-00.00.00.000000'.                            01610001
016200     05  PC-INVALID-CNTL-CARD            PIC  X(50)  VALUE        01620001
016300         'INVALID CONTROL CARD-MUST START WITH "TRKUP003"   '.    01630001
016400     05  PC-INVALID-CC-COMMIT-CNT        PIC  X(50)  VALUE        01640001
016500         'INVALID CONTROL CARD - COMMIT COUNT NOT NUMERIC   '.    01650001
016600     05  PC-INVALID-LAST-DELETE-DATE     PIC  X(50)  VALUE        01660001
016700         'INVALID CONTROL CARD - INVALID LAST DELETE DATE   '.    01670001
016800     05  PC-INVALID-SAVE-VHTRIP-DATE     PIC  X(50)  VALUE        01680001
016900         'INVALID CONTROL CARD - INVALID SAVE VHTRIP DATE   '.    01690001
017000                                                                  01700001
017100 01  PS-PROGRAM-SWITCHES.                                         01710001
017200     05  PS-END-OF-TVHTRIP-IND           PIC  X(01)  VALUE 'N'.   01720001
017300         88  PS-END-OF-TVHTRIP-CSR                   VALUE 'Y'.   01730001
017400         88  PS-NOT-END-OF-TVHTRIP-CSR               VALUE 'N'.   01740001
017500     05  PS-END-OF-TSHPTPO-IND           PIC  X(01)  VALUE 'N'.   01750001
017600         88  PS-END-OF-TSHPTPO-CSR                   VALUE 'Y'.   01760001
017700         88  PS-NOT-END-OF-TSHPTPO-CSR               VALUE 'N'.   01770001
017800     05  PS-END-OF-TSHIPMT-IND           PIC  X(01)  VALUE 'N'.   01780001
017900         88  PS-END-OF-TSHIPMT-CSR                   VALUE 'Y'.   01790001
018000         88  PS-NOT-END-OF-TSHIPMT-CSR               VALUE 'N'.   01800001
018100     05  PS-END-OF-TSHIPST-IND           PIC  X(01)  VALUE 'N'.   01810001
018200         88  PS-END-OF-TSHIPST-CSR                   VALUE 'Y'.   01820001
018300         88  PS-NOT-END-OF-TSHIPST-CSR               VALUE 'N'.   01830001
018400     05  PS-END-OF-TVEHICL-IND           PIC  X(01)  VALUE 'N'.   01840001
018500         88  PS-END-OF-TVEHICL-CSR                   VALUE 'Y'.   01850001
018600         88  PS-NOT-END-OF-TVEHICL-CSR               VALUE 'N'.   01860001
018700     05  INSERT-TO-AUDIT-SW              PIC  X(01)  VALUE 'N'.   01870001
018800         88  INSERT-TO-AUDIT                         VALUE 'Y'.   01880001
018900         88  NO-INSERT                               VALUE 'N'.   01890001
019000     05  OK-TO-DELETE-SW                 PIC X(01)   VALUE 'N'.   01900001
019100         88  OK-TO-DELETE                            VALUE 'Y'.   01910001
019200         88  NOT-OK-TO-DELETE                        VALUE 'N'.   01920001
019300     05  PS-SHIPMT-DELETED-SW            PIC X(01)   VALUE 'Y'.   01930001
019400         88  PS-SHIPMT-DELETED                       VALUE 'Y'.   01940001
019500         88  PS-SHIPMT-NOT-DELETED                   VALUE 'N'.   01950001
019600                                                                  01960001
019700 01  PV-PROGRAM-VARIABLES.                                        01970001
019800     05  PV-TVHTRIP-READ                 PIC S9(09)  VALUE +0     01980001
019900                                                     COMP-3.      01990001
020000     05  PV-TSHPTPO-READ                 PIC S9(09)  VALUE +0     02000001
020100                                                     COMP-3.      02010001
020200     05  PV-TSHIPMT-READ                 PIC S9(09)  VALUE +0     02020001
020300                                                     COMP-3.      02030001
020400     05  PV-TSHIPST-READ                 PIC S9(09)  VALUE +0     02040001
020500                                                     COMP-3.      02050001
020600     05  PV-TVEHICL-READ                 PIC S9(09)  VALUE +0     02060001
020700                                                     COMP-3.      02070001
020800     05  PV-TAUVHCL-INSERTED             PIC S9(09)  VALUE +0     02080001
020900                                                     COMP-3.      02090001
021000     05  PV-TVHTRIP-DELETED              PIC S9(09)  VALUE +0     02100001
021100                                                     COMP-3.      02110001
021200     05  PV-TSHPTPO-DELETED              PIC S9(09)  VALUE +0     02120001
021300                                                     COMP-3.      02130001
021400     05  PV-TSHIPMT-DELETED              PIC S9(09)  VALUE +0     02140001
021500                                                     COMP-3.      02150001
021600     05  PV-TSHIPST-DELETED              PIC S9(09)  VALUE +0     02160001
021700                                                     COMP-3.      02170001
021800     05  PV-TVEHICL-UPDATED              PIC S9(09)  VALUE +0     02180001
021900                                                     COMP-3.      02190001
022000     05  PV-COMMITS-TAKEN                PIC S9(09)  VALUE +0     02200001
022100                                                     COMP-3.      02210001
022200     05  PV-DB2-COMMIT-CNT               PIC S9(07)  VALUE +0     02220001
022300                                                     COMP-3.      02230001
022400     05  PV-RETRY-CNT                    PIC S9(01)  VALUE +0.    02240001
022500     05  PV-PREV-ORD-NBR                 PIC S9(09)  VALUE +0     02250001
022600                                                     COMP.        02260001
022700     05  PV-PREV-REC-SEQ-NBR             PIC S9(09)  VALUE +0     02270001
022800                                                     COMP.        02280001
022900     05  PV-VEHICL-CURR-TRIP-ID-NULL     PIC S9(04)  VALUE +0     02290001
023000                                                     COMP SYNC.   02300001
023100     05  PV-AUVHCL-CURR-TRIP-ID-NULL     PIC S9(04)  VALUE +0     02310001
023200                                                     COMP SYNC.   02320001
023300     05  PV-VEHICL-CURR-TRIP-ID          PIC S9(09)  COMP SYNC.   02330001
023400     05  PV-DECR-DAYS                    PIC  9(03).              02340001
023500     05  PV-DELETE-BEFORE-DTE            PIC  X(10).              02350001
023600     05  PV-DELETE-BEFORE-DTE-REDEF.                              02360001
023700         10  PV-DELETE-BEFORE-DTE-CCYY   PIC  9(04).              02370001
023800         10  PV-DASH-1                   PIC  X(01)  VALUE '-'.   02380001
023900         10  PV-DELETE-BEFORE-DTE-MM     PIC  9(02).              02390001
024000         10  PV-DASH-2                   PIC  X(01)  VALUE '-'.   02400001
024100         10  PV-DELETE-BEFORE-DTE-DD     PIC  9(02).              02410001
024200                                                                  02420001
024300     05  PV-CPU-DATE.                                             02430001
024400         10  PV-CPU-DATE-YY               PIC 9(2)   VALUE ZEROS. 02440001
024500         10  PV-CPU-DATE-MM               PIC 9(2)   VALUE ZEROS. 02450001
024600         10  PV-CPU-DATE-DD               PIC 9(2)   VALUE ZEROS. 02460001
024700                                                                  02470001
024800     05  PV-CURR-RUN-DATE.                                        02480001
024900         10  PV-CURR-DATE-CC              PIC 9(2)   VALUE ZEROS. 02490001
025000         10  PV-CURR-DATE-YY              PIC 9(2)   VALUE ZEROS. 02500001
025100         10  PV-CURR-DATE-MM              PIC 9(2)   VALUE ZEROS. 02510001
025200         10  PV-CURR-DATE-DD              PIC 9(2)   VALUE ZEROS. 02520001
025300                                                                  02530001
025400                                                                  02540001
025500*                                                                 02550001
025600*  WORK AREA PASSED IN CALL TO DPKUT500                           02560001
025700*                                                                 02570001
025800     COPY DPWS500.                                                02580001
025900                                                                  02590001
026000*                                                                 02600001
026100*  DCLGEN FOR THE DB2 TRIP TABLE.                                 02610001
026200*                                                                 02620001
026300     EXEC SQL                                                     02630001
026400         INCLUDE TVHTRIP                                          02640001
026500     END-EXEC.                                                    02650001
026600                                                                  02660001
026700*                                                                 02670001
026800*  DCLGEN FOR THE DB2 SHIPMENT TABLE.                             02680001
026900*                                                                 02690001
027000     EXEC SQL                                                     02700001
027100         INCLUDE TSHIPMT                                          02710001
027200     END-EXEC.                                                    02720001
027300                                                                  02730001
027400*                                                                 02740001
027500*  DCLGEN FOR THE DB2 SHIP TO PO TABLE                            02750001
027600*                                                                 02760001
027700     EXEC SQL                                                     02770001
027800         INCLUDE TSHPTPO                                          02780001
027900     END-EXEC.                                                    02790001
028000                                                                  02800001
028100*                                                                 02810001
028200*  DCLGEN FOR THE DB2 SHIPMENT STATUS TABLE.                      02820001
028300*                                                                 02830001
028400     EXEC SQL                                                     02840001
028500         INCLUDE TSHIPST                                          02850001
028600     END-EXEC.                                                    02860001
028700                                                                  02870001
028800*                                                                 02880001
028900*  DCLGEN FOR THE DB2 SHIPMENT STATUS TYPE TABLE.                 02890001
029000*                                                                 02900001
029100     EXEC SQL                                                     02910001
029200         INCLUDE TSHSTYP                                          02920001
029300     END-EXEC.                                                    02930001
029400                                                                  02940001
029500*                                                                 02950001
029600*  DCLGEN FOR THE DB2 VEHICLE TABLE.                              02960001
029700*                                                                 02970001
029800     EXEC SQL                                                     02980001
029900         INCLUDE TVEHICL                                          02990001
030000     END-EXEC.                                                    03000001
030100                                                                  03010001
030200*                                                                 03020001
030300*  DCLGEN FOR THE DB2 TR VEHICLE AUDIT TABLE.                     03030001
030400*                                                                 03040001
030500     EXEC SQL                                                     03050001
030600         INCLUDE TAUVHCL                                          03060001
030700     END-EXEC.                                                    03070001
030800                                                                  03080001
030900*                                                                 03090001
031000*  CURSOR USED TO SELECT ALL TRIPS WITH A NULL VEHICL NUMBER AND  03100001
031100*  A LAST UPDATE DATE LESS THAN THE CONTROL CARD DATE.            03110001
031200*                                                                 03120001
031300                                                                  03130001
031400     EXEC SQL                                                     03140001
031500         DECLARE TVHTRIP-CSR CURSOR                               03150001
031600                 WITH HOLD FOR                                    03160001
031700          SELECT A.TRIP_ID                                        03170001
031800            FROM TVHTRIP A                                        03180001
031900           WHERE A.LAST_UPD_DTE   < :PV-DELETE-BEFORE-DTE         03190001
032000             AND (A.EST_AR_TMST   < (CURRENT TIMESTAMP + 10 DAYS) 03200001
032100             OR   A.EST_AR_TMST   IS NULL)                        03210001
032200             AND A.VEH_NBR        IS NULL                         03220001
032300     END-EXEC.                                                    03230001
032400                                                                  03240001
032500                                                                  03250001
032600     EXEC SQL                                                     03260001
032700         DECLARE TSHPTPO-CSR CURSOR                               03270001
032800                 WITH HOLD FOR                                    03280001
032900          SELECT A.SHIPT_ID                                       03290001
033000               , A.PO_NBR                                         03300001
033100               , A.REC_SEQ_NBR                                    03310001
033200            FROM TSHPTPO A                                        03320001
033300           WHERE A.SHIPT_ID       = :SHIPMT-SHIPT-ID              03330001
033400     END-EXEC.                                                    03340001
033500                                                                  03350001
033600                                                                  03360001
033700     EXEC SQL                                                     03370001
033800         DECLARE TSHIPST-CSR CURSOR                               03380001
033900                 WITH HOLD FOR                                    03390001
034000          SELECT A.SHIPT_ID                                       03400001
034100               , A.SHIPT_STATUS_CDE                               03410001
034200               , A.STATUS_DTE                                     03420001
034300               , A.STATUS_TME                                     03430001
034400               , A.STATUS_UID                                     03440001
034500               , A.DELAY_RSN_CDE                                  03450001
034600            FROM TSHIPST A                                        03460001
034700           WHERE A.SHIPT_ID       = :SHIPMT-SHIPT-ID              03470001
034800     END-EXEC.                                                    03480001
034900                                                                  03490001
035000     EXEC SQL                                                     03500001
035100         DECLARE TSHIPMT-CSR CURSOR                               03510001
035200                 WITH HOLD FOR                                    03520001
035300          SELECT A.SHIPT_ID                                       03530001
035400            FROM TSHIPMT A                                        03540001
035500           WHERE  TRIP_ID        = :VHTRIP-TRIP-ID                03550001
035600     END-EXEC.                                                    03560001
035700                                                                  03570001
035800     EXEC SQL                                                     03580001
035900         DECLARE TVEHICL-CSR CURSOR                               03590001
036000                 WITH HOLD FOR                                    03600001
036100          SELECT A.OWNER_SCAC_ID                                  03610001
036200               , A.VEH_NBR                                        03620001
036300               , A.CURR_TRIP_ID                                   03630001
036400            FROM TVEHICL A                                        03640001
036500                ,TSHSTYP B                                        03650001
036600           WHERE A.LAST_UPD_DTE    <  :PV-DELETE-BEFORE-DTE       03660001
036700             AND A.CURR_STATUS_CDE ^= :PC-ET                      03670001
036800             AND A.CURR_STATUS_CDE = B.SHIPT_STATUS_CDE           03680001
036900             AND B.PRTY_CDE > :PC-50                              03690001
037000     END-EXEC.                                                    03700001
037100                                                                  03710001
037200*                                                                 03720001
037300*  COMMUNICATION AREAS FOR DB2                                    03730001
037400*                                                                 03740001
037500     EXEC SQL                                                     03750001
037600         INCLUDE SQLCA                                            03760001
037700     END-EXEC.                                                    03770001
037800                                                                  03780001
037900*                                                                 03790001
038000*  DB2 COMMUNICATION AREA 2                                       03800001
038100*                                                                 03810001
038200     COPY SQLCA2.                                                 03820001
038300                                                                  03830001
038400 PROCEDURE DIVISION.                                              03840001
038500                                                                  03850001
038600******************************************************************03860001
038700*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03870001
038800******************************************************************03880001
038900                                                                  03890001
039000 0000-PROGRAM-MAINLINE.                                           03900001
039100                                                                  03910001
039200     PERFORM 1000-INITIALIZE.                                     03920001
039300                                                                  03930001
039400     PERFORM 2000-PROCESS-RECS-TO-DELETE                          03940001
039500         UNTIL PS-END-OF-TVHTRIP-CSR.                             03950001
039600                                                                  03960001
039700     PERFORM 4200-CLOSE-TVHTRIP-CSR.                              03970001
039800                                                                  03980001
039900     MOVE CC-DAYS-SAVE-VHTRIPS  TO PV-DECR-DAYS.                  03990001
040000     PERFORM 1150-DATE-CALCULATIONS.                              04000001
040100                                                                  04010001
040200     PERFORM 7300-OPEN-TVEHICL-CSR.                               04020001
040300     PERFORM 7400-FETCH-TVEHICL-CSR.                              04030001
040400                                                                  04040001
040500     PERFORM 2200-PROCESS-RECS-TO-UPDATE                          04050001
040600         UNTIL PS-END-OF-TVEHICL-CSR.                             04060001
040700                                                                  04070001
040800     PERFORM 7500-CLOSE-TVEHICL-CSR.                              04080001
040810     PERFORM 8000-COMMIT.                                         13100001
040900     PERFORM 9500-EOJ-ROUTINE.                                    04090001
041000                                                                  04100001
041100     STOP RUN.                                                    04110001
041200                                                                  04120001
041300******************************************************************04130001
041400*  1000-INITIALIZE - ACCEPTS THE CONTROL CARD AND VALIDATES THE   04140001
041500*  FORMAT.  OPENS THE DRIVING CURSOR AND PERFORMS THE FIRST FETCH.04150001
041600******************************************************************04160001
041700                                                                  04170001
041800 1000-INITIALIZE.                                                 04180001
041900                                                                  04190001
042000     ACCEPT PV-CPU-DATE FROM DATE.                                04200001
042100                                                                  04210001
042200     MOVE PV-CPU-DATE-MM         TO PV-CURR-DATE-MM.              04220001
042300     MOVE PV-CPU-DATE-DD         TO PV-CURR-DATE-DD.              04230001
042400     MOVE PV-CPU-DATE-YY         TO PV-CURR-DATE-YY.              04240001
042500                                                                  04250001
042600     IF PV-CPU-DATE-YY > 85                                       04260001
042700         MOVE 19                 TO PV-CURR-DATE-CC               04270001
042800     ELSE                                                         04280001
042900         MOVE 20                 TO PV-CURR-DATE-CC               04290001
043000     END-IF.                                                      04300001
043100     ACCEPT CC-CONTROL-CARD.                                      04310001
043200                                                                  04320001
043300     DISPLAY 'TRKUP003 CONTROL CARD - ' CC-CONTROL-CARD.          04330001
043400                                                                  04340001
043500     IF NOT CC-TRKUP003                                           04350001
043600         DISPLAY PC-INVALID-CNTL-CARD                             04360001
043700         MOVE +4003              TO ABEND-CODE                    04370001
043800         CALL 'ILBOABN0' USING ABEND-CODE                         04380001
043900     END-IF.                                                      04390001
044000                                                                  04400001
044100     IF CC-COMMIT-CNT NUMERIC                                     04410001
044200         CONTINUE                                                 04420001
044300     ELSE                                                         04430001
044400         DISPLAY PC-INVALID-CC-COMMIT-CNT                         04440001
044500         MOVE +4003              TO ABEND-CODE                    04450001
044600         CALL 'ILBOABN0' USING ABEND-CODE                         04460001
044700     END-IF.                                                      04470001
044800                                                                  04480001
044900     IF CC-DAYS-SAVE-SHIPMENT NUMERIC                             04490001
045000         CONTINUE                                                 04500001
045100     ELSE                                                         04510001
045200         DISPLAY PC-INVALID-LAST-DELETE-DATE                      04520001
045300         MOVE +4003              TO ABEND-CODE                    04530001
045400         CALL 'ILBOABN0' USING ABEND-CODE                         04540001
045500     END-IF.                                                      04550001
045600                                                                  04560001
045700     IF CC-DAYS-SAVE-VHTRIPS NUMERIC                              04570001
045800         CONTINUE                                                 04580001
045900     ELSE                                                         04590001
046000         DISPLAY PC-INVALID-SAVE-VHTRIP-DATE                      04600001
046100         MOVE +4003              TO ABEND-CODE                    04610001
046200         CALL 'ILBOABN0' USING ABEND-CODE                         04620001
046300     END-IF.                                                      04630001
046400                                                                  04640001
046500     MOVE CC-DAYS-SAVE-SHIPMENT TO PV-DECR-DAYS.                  04650001
046600     PERFORM 1150-DATE-CALCULATIONS.                              04660001
046700                                                                  04670001
046800     PERFORM 4000-OPEN-TVHTRIP-CSR.                               04680001
046900     PERFORM 4100-FETCH-TVHTRIP-CSR.                              04690001
047000                                                                  04700001
047100                                                                  04710001
047200******************************************************************04720001
047300* CALCULATE THE DELETE CUTTOFF DATE BASED ON CONTROL CARD ENTRY: *04730001
047400* "CC-DAYS-SAVE-SHIPMENT".                                       *04740001
047500*                                                                *04750001
047600* (CURRENT-DATE - CC-DAYS-SAVE-SHIPMENT) = SHIP-DELETE-DATE      *04760001
047700*                                                                *04770001
047800*  ALL SHIPMENTS THAT HAVE BEEN COMPLETED PRIOR TO               *04780001
047900*  "PV-DELETE-BEFORE-DATE" WILL BE DELETED.                      *04790001
048000******************************************************************04800001
048100 1150-DATE-CALCULATIONS.                                          04810001
048200     INITIALIZE DPG51                                             04820001
048300                DPG52.                                            04830001
048400     MOVE PV-CPU-DATE           TO DPG51-SYSTEM-DATE.             04840001
048500     MOVE CC-CNTL-CALENDAR-TYPE TO DPG51-CALENDAR-TYPE.           04850001
048600     SET  DPG51-DECREMENT-DATE  TO TRUE.                          04860001
048700     MOVE PV-DECR-DAYS          TO DPG51-INCR-DECR-DAYS-9.        04870001
048800     SET  DPG52-LK-DTE-ISO      TO TRUE.                          04880001
048900     MOVE PV-CURR-RUN-DATE      TO DPG52-DB2-ISO-DATE.            04890001
049000                                                                  04900001
049100     CALL PC-DPKUT500 USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.  04910001
049200                                                                  04920001
049300     IF (DPG54-DATE-INVALID                                       04930001
049400     OR  DPG54-SEVERE-ERROR)                                      04940001
049500         DISPLAY '*** ABEND *** IN TRKUP003'                      04950001
049600         DISPLAY 'ERROR IN CALL TO DPKUT500'                      04960001
049700         DISPLAY DPG54-ERROR-MESSAGE                              04970001
049800         DISPLAY '**** PARA= 1150-DATE-CALCULATIONS  '            04980001
049900         DISPLAY ' '                                              04990001
050000         DISPLAY 'DPG51=>'  DPG51                                 05000001
050100         DISPLAY 'DPG52=>'  DPG52                                 05010001
050200         DISPLAY 'DPG53=>'  DPG53                                 05020001
050300         DISPLAY 'DPG54=>'  DPG54                                 05030001
050400         DISPLAY 'DPG55=>'  DPG55                                 05040001
050500         DISPLAY 'DPG56=>'  DPG56                                 05050001
050600         MOVE +4019 TO ABEND-CODE                                 05060001
050700         CALL 'ILBOABN0' USING ABEND-CODE                         05070001
050800     ELSE                                                         05080001
050900         MOVE DPG55-DB2-ISO-DATE-YR TO PV-DELETE-BEFORE-DTE-CCYY  05090001
051000         MOVE DPG55-DB2-ISO-DATE-MO TO PV-DELETE-BEFORE-DTE-MM    05100001
051100         MOVE DPG55-DB2-ISO-DATE-DY TO PV-DELETE-BEFORE-DTE-DD    05110001
051200         MOVE PV-DELETE-BEFORE-DTE-REDEF TO PV-DELETE-BEFORE-DTE  05120001
051300     END-IF.                                                      05130001
051400                                                                  05140001
051500     DISPLAY '                   '.                               05150001
051600     DISPLAY 'CURR RUN DATE ====>' PV-CURR-RUN-DATE.              05160001
051700     DISPLAY 'DELETE BEFORE DATE==>' PV-DELETE-BEFORE-DTE.        05170001
051800                                                                  05180001
051900******************************************************************05190001
052000* 2000-PROCESS-RECS-TO-DELETE - USE THE INFORMATION RETRIEVED     05200001
052100* FROM THE DRIVING CURSOR TO DELETE THE INACTIVE VHTRIP ROWS.     05210001
052200******************************************************************05220001
052300                                                                  05230001
052400 2000-PROCESS-RECS-TO-DELETE.                                     05240001
052500                                                                  05250001
052600     SET PS-NOT-END-OF-TSHIPMT-CSR                                05260001
052700         PS-SHIPMT-DELETED     TO TRUE.                           05270001
052800     PERFORM 3700-OPEN-TSHIPMT-CSR.                               05280001
052900     PERFORM 3800-FETCH-TSHIPMT-CSR.                              05290001
053000     PERFORM UNTIL PS-END-OF-TSHIPMT-CSR                          05300001
053100         SET PS-NOT-END-OF-TSHPTPO-CSR TO TRUE                    05310001
053200         PERFORM 5000-OPEN-TSHPTPO-CSR                            05320001
053300         SET OK-TO-DELETE TO TRUE                                 05330001
053400         PERFORM 5100-FETCH-TSHPTPO-CSR                           05340001
053500         PERFORM 2100-CHECK-TSHPTPO                               05350001
053600             UNTIL PS-END-OF-TSHPTPO-CSR OR                       05360001
053700                   NOT-OK-TO-DELETE                               05370001
053800         PERFORM 5200-CLOSE-TSHPTPO-CSR                           05380001
053900         IF OK-TO-DELETE                                          05390001
054000            SET NOT-OK-TO-DELETE TO TRUE                          05400001
054100            SET PS-NOT-END-OF-TSHPTPO-CSR TO TRUE                 05410001
054200            PERFORM 2400-DELETE-TSHPTPO                           05420001
054300            PERFORM 3950-DELETE-TSHIPMT                           05430001
054400         ELSE                                                     05440001
054500             SET PS-SHIPMT-NOT-DELETED     TO TRUE                05450001
054600         END-IF                                                   05460001
054700         PERFORM 3800-FETCH-TSHIPMT-CSR                           05470001
054800     END-PERFORM.                                                 05480001
054900     IF PS-SHIPMT-NOT-DELETED                                     05490001
055000         CONTINUE                                                 05500001
055100     ELSE                                                         05510001
055200        PERFORM 2300-DELETE-TVHTRIP                               05520001
055300     END-IF.                                                      05530001
055400                                                                  05540001
055500     PERFORM 3900-CLOSE-TSHIPMT-CSR.                              05550001
055600                                                                  05560001
055700     IF PV-DB2-COMMIT-CNT > CC-COMMIT-CNT                         05570001
055800         PERFORM 8000-COMMIT                                      05580001
055900     END-IF.                                                      05590001
056000                                                                  05600001
056100     PERFORM 4100-FETCH-TVHTRIP-CSR.                              05610001
056200                                                                  05620001
056300******************************************************************05630001
056400* 2100-CHECK-TSHPTPO THIS PARAGRAPH WILL CHECK THE RECORD SEQUENCE05640001
056500* NUMBER, IF ITS SOMETHING OTHER THAN ZERO THAN NO ROWS SHOULD BE 05650001
056600* DELETED.                                                        05660001
056700******************************************************************05670001
056800 2100-CHECK-TSHPTPO.                                              05680001
056900                                                                  05690001
057000     IF SHPTPO-REC-SEQ-NBR NOT EQUAL ZERO                         05700001
057100        SET NOT-OK-TO-DELETE TO TRUE                              05710001
057200     END-IF.                                                      05720001
057300                                                                  05730001
057400     PERFORM 5100-FETCH-TSHPTPO-CSR.                              05740001
057500                                                                  05750001
057600******************************************************************05760001
057700* 2200-PROCESS-RECS-TO-UPDATE - USE THE INFORMATION RETRIEVED     05770001
057800* FROM THE DRIVING CURSOR TO UPDATE THE TVEHICL RECORDS.          05780001
057900******************************************************************05790001
058000                                                                  05800001
058100 2200-PROCESS-RECS-TO-UPDATE.                                     05810001
058200                                                                  05820001
058300     PERFORM 7600-UPDATE-TVEHICL.                                 05830001
058400     IF PV-DB2-COMMIT-CNT > CC-COMMIT-CNT                         05840001
058500         PERFORM 8000-COMMIT                                      05850001
058600     END-IF.                                                      05860001
058700                                                                  05870001
058800     PERFORM 7400-FETCH-TVEHICL-CSR.                              05880001
058900                                                                  05890001
059000******************************************************************05900001
059100* 2300-DELETE-TVHTRIP - PERFORM A DELETE ON THE INACTIVE TVHTRIP  05910001
059200* ROWS BASED ON THE KEY RETURNED FROM THE DRIVING CURSOR.         05920001
059300******************************************************************05930001
059400                                                                  05940001
059500 2300-DELETE-TVHTRIP.                                             05950001
059600                                                                  05960001
059700     PERFORM                                                      05970001
059800         WITH TEST AFTER                                          05980001
059900         VARYING PV-RETRY-CNT                                     05990001
060000         FROM 1 BY 1                                              06000001
060100         UNTIL (PV-RETRY-CNT > PC-MAX-RETRIES                     06010001
060200                OR SQLCODE = 0)                                   06020001
060300                                                                  06030001
060400         EXEC SQL                                                 06040001
060500             DELETE FROM TVHTRIP                                  06050001
060600              WHERE TRIP_ID        = :VHTRIP-TRIP-ID              06060001
060700         END-EXEC                                                 06070001
060800                                                                  06080001
060900         EVALUATE TRUE                                            06090001
061000             WHEN SQLCODE = 0                                     06100001
061100                 ADD SQLERRD(3)  TO PV-DB2-COMMIT-CNT             06110001
061200                                    PV-TVHTRIP-DELETED            06120001
061300             WHEN SQLCODE = +100                                  06130001
061400                 DISPLAY '** ABEND - TRKUP003 **'                 06140001
061500                 DISPLAY '** 2300-DELETE-TVHTRIP'                 06150001
061600                 DISPLAY '** DELETE ERROR ON TVHTRIP'             06160001
061700                 DISPLAY '** TRIP-ID = ' VHTRIP-TRIP-ID           06170001
061800                 PERFORM 9000-SQL-ERROR                           06180001
061900             WHEN SQLCODE = -904                                  06190001
062000             WHEN SQLCODE = -911                                  06200001
062100                 CONTINUE                                         06210001
062200             WHEN SQLCODE < 0                                     06220001
062300                 DISPLAY '** ABEND - TRKUP003 **'                 06230001
062400                 DISPLAY '** 2300-DELETE-TVHTRIP'                 06240001
062500                 DISPLAY '** DELETE ERROR ON TVHTRIP'             06250001
062600                 DISPLAY '** TRIP-ID = ' VHTRIP-TRIP-ID           06260001
062700                 PERFORM 9000-SQL-ERROR                           06270001
062800             WHEN SQLCODE > 0                                     06280001
062900             WHEN SQLWARN0 = 'W'                                  06290001
063000                 DISPLAY '** ABEND - TRKUP003 **'                 06300001
063100                 DISPLAY '** 2300-DELETE-TVHTRIP'                 06310001
063200                 DISPLAY '** DELETE WARNING ON TVHTRIP'           06320001
063300                 DISPLAY '** TRIP-ID = ' VHTRIP-TRIP-ID           06330001
063400                 PERFORM 9200-SQL-WARNING                         06340001
063500         END-EVALUATE                                             06350001
063600     END-PERFORM.                                                 06360001
063700                                                                  06370001
063800     IF PV-RETRY-CNT > PC-MAX-RETRIES                             06380001
063900         DISPLAY '** ABEND - TRKUP003 **'                         06390001
064000         DISPLAY '** 2300-DELETE-TVHTRIP'                         06400001
064100         DISPLAY '** DELETE ERROR ON TVHTRIP'                     06410001
064200         DISPLAY '** MAX RETRIES EXCEEDED'                        06420001
064300         DISPLAY '** TRIP-ID = ' VHTRIP-TRIP-ID                   06430001
064400         PERFORM 9000-SQL-ERROR                                   06440001
064500     END-IF.                                                      06450001
064600******************************************************************06460001
064700* 2400-DELETE-TSHPTPO - PERFORM A DELETE ON THE TSHPTPO RECORDS   06470001
064800* FOR A TRIP.                                                     06480001
064900******************************************************************06490001
065000                                                                  06500001
065100 2400-DELETE-TSHPTPO.                                             06510001
065200                                                                  06520001
065300     PERFORM                                                      06530001
065400         WITH TEST AFTER                                          06540001
065500         VARYING PV-RETRY-CNT                                     06550001
065600         FROM 1 BY 1                                              06560001
065700         UNTIL (PV-RETRY-CNT > PC-MAX-RETRIES                     06570001
065800                OR SQLCODE = +100                                 06580001
065810                OR SQLCODE = 0)                                   06590001
065900                                                                  06600001
066000         EXEC SQL                                                 06610001
066100             DELETE FROM TSHPTPO                                  06620001
066200              WHERE SHIPT_ID        = :SHIPMT-SHIPT-ID            06630001
066300         END-EXEC                                                 06640001
066400                                                                  06650001
066500         EVALUATE TRUE                                            06660001
066600             WHEN SQLCODE = 0                                     06670001
066700                 ADD SQLERRD(3)  TO PV-DB2-COMMIT-CNT             06680001
066800                                    PV-TSHPTPO-DELETED            06690001
066900             WHEN SQLCODE = +100                                  06700001
067000             WHEN SQLCODE = -904                                  06710001
067100             WHEN SQLCODE = -911                                  06720001
067200                 CONTINUE                                         06730001
067300             WHEN SQLCODE < 0                                     06740001
067400                 DISPLAY '** ABEND - TRKUP003 **'                 06750001
067500                 DISPLAY '** 2400-DELETE-TSHPTPO'                 06760001
067600                 DISPLAY '** DELETE ERROR ON TSHPTPO'             06770001
064300                 DISPLAY '** TRIP-ID = ' VHTRIP-TRIP-ID           06430001
067700                 DISPLAY '** SHIPT-ID = ' SHIPMT-SHIPT-ID         06780001
067800                 PERFORM 9000-SQL-ERROR                           06790001
067900             WHEN SQLCODE > 0                                     06800001
068000             WHEN SQLWARN0 = 'W'                                  06810001
068100                 DISPLAY '** ABEND - TRKUP003 **'                 06820001
068200                 DISPLAY '** 2400-DELETE-TSHPTPO'                 06830001
068300                 DISPLAY '** DELETE WARNING ON TSHPTPO'           06840001
064300                 DISPLAY '** TRIP-ID = ' VHTRIP-TRIP-ID           06430001
068400                 DISPLAY '** SHIPT-ID = ' SHIPMT-SHIPT-ID         06850001
068500                 PERFORM 9200-SQL-WARNING                         06860001
068600         END-EVALUATE                                             06870001
068700     END-PERFORM.                                                 06880001
068800                                                                  06890001
068900     IF PV-RETRY-CNT > PC-MAX-RETRIES                             06900001
069000         DISPLAY '** ABEND - TRKUP003 **'                         06910001
069100         DISPLAY '** 2400-DELETE-TSHPTPO'                         06920001
069200         DISPLAY '** DELETE ERROR ON TSHPTPO'                     06930001
069300         DISPLAY '** MAX RETRIES EXCEEDED'                        06940001
064300         DISPLAY '** TRIP-ID = ' VHTRIP-TRIP-ID                   06430001
069400         DISPLAY '** SHIPT-ID = ' SHIPMT-SHIPT-ID                 06950001
069500         PERFORM 9000-SQL-ERROR                                   06960001
069600     END-IF.                                                      06970001
069700                                                                  06980001
069800 3700-OPEN-TSHIPMT-CSR.                                           06990001
069900                                                                  07000001
070000     EXEC SQL                                                     07010001
070100         OPEN TSHIPMT-CSR                                         07020001
070200     END-EXEC.                                                    07030001
070300                                                                  07040001
070400     EVALUATE TRUE                                                07050001
070500         WHEN SQLCODE < ZERO                                      07060001
070501             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07070001
070502             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07071006
070503             DISPLAY '** SHIPMT TRIP ID = ' SHIPMT-TRIP-ID        07072006
070600             DISPLAY '** ABEND - TRKUP003 **'                     07080001
070700             DISPLAY '** 3700-OPEN-TSHIPMT-CSR'                   07090001
070800             DISPLAY '** OPEN ERROR ON TSHIPMT'                   07100001
070900             PERFORM 9000-SQL-ERROR                               07110001
071000         WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))         07120001
071100         WHEN SQLWARN0 NOT = SPACES                               07130001
071200             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07131006
071300             DISPLAY '** SHIPMT TRIP ID = ' SHIPMT-TRIP-ID        07132006
071301             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07140001
071302             DISPLAY '** ABEND - TRKUP003 **'                     07150001
071303             DISPLAY '** 3700-OPEN-TSHIPMT-CSR'                   07160001
071400             DISPLAY '** OPEN WARNING ON TSHIPMT'                 07170001
071500             PERFORM 9200-SQL-WARNING                             07180001
               WHEN OTHER                                                       
                   CONTINUE                                                     
071800     END-EVALUATE.                                                07260001
071900                                                                  07270001
072000******************************************************************07280001
072100* 3800-FETCH-TSHIPMT-CSR.                                        *07290001
072200* FETCH THE TSHIPMT RECORDS WITH A TRIP-ID WHICH MATCHES THE     *07300001
072300* TRIP-ID OF THE TVHTRIP CURSOR.                                 *07310001
072400******************************************************************07320001
072500                                                                  07330001
072600 3800-FETCH-TSHIPMT-CSR.                                          07340001
072700                                                                  07350001
072800     EXEC SQL                                                     07360001
072900         FETCH TSHIPMT-CSR                                        07370001
073000          INTO :SHIPMT-SHIPT-ID                                   07380001
073100     END-EXEC.                                                    07390001
073200                                                                  07400001
073300     EVALUATE TRUE                                                07410001
073400         WHEN SQLCODE = 0                                         07420001
073500             ADD +1 TO PV-TSHIPMT-READ                            07430001
073600         WHEN SQLCODE = +100                                      07440001
073700             SET PS-END-OF-TSHIPMT-CSR                            07450001
073800                                 TO TRUE                          07460001
073900         WHEN SQLCODE < ZERO                                      07470001
074000             DISPLAY '*************************'                  07480001
074001             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07490001
074002             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07491006
074003             DISPLAY '** SHIPMT TRIP ID = ' SHIPMT-TRIP-ID        07492006
074004             DISPLAY '** ABEND - TRKUP003 **'                     07500001
074100             DISPLAY '** 3800-FETCH-TSHIPMT-CSR'                  07510001
074200             DISPLAY '** FETCH ERROR ON TSHIPMT'                  07520001
074300             PERFORM 9000-SQL-ERROR                               07530001
074400         WHEN SQLCODE > ZERO                                      07540001
074500         WHEN SQLWARN0 NOT = SPACES                               07550001
074600             DISPLAY '*************************'                  07560001
074601             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07570001
074602             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07580005
074603             DISPLAY '** SHIPMT TRIP ID = ' SHIPMT-TRIP-ID        07590006
074604             DISPLAY '** ABEND - TRKUP003 **'                     07600001
074700             DISPLAY '** 3800-FETCH-TSHIPMT-CSR'                  07610001
074800             DISPLAY '** FETCH WARNING ON TSHIPMT'                07620001
074900             PERFORM 9200-SQL-WARNING                             07630001
077704     END-EVALUATE.                                                07640001
077705                                                                  07650001
077706******************************************************************07660001
077707* 3900-CLOSE-TSHIPMT-CSR - CLOSES THE CURSOR                     *07670001
077708******************************************************************07680001
077709                                                                  07690001
077710 3900-CLOSE-TSHIPMT-CSR.                                          07700001
077711                                                                  07710001
077712     EXEC SQL                                                     07720001
077713         CLOSE TSHIPMT-CSR                                        07730001
077714     END-EXEC.                                                    07740001
077715                                                                  07750001
077716     EVALUATE TRUE                                                07760001
077717         WHEN SQLCODE < ZERO                                      07770001
077718             DISPLAY '*************************'                  07780001
077719             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07780106
077720             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07781006
077721             DISPLAY '** SHIPMT TRIP ID = ' SHIPMT-TRIP-ID        07782006
077722             DISPLAY '** ABEND - TRKUP003 **'                     07800001
077723             DISPLAY '** 3900-CLOSE-TSHIPMT-CSR'                  07810001
077724             DISPLAY '** CLOSE ERROR ON TSHIPMT'                  07820001
077725             PERFORM 9000-SQL-ERROR                               07830001
077726         WHEN SQLCODE > ZERO                                      07840001
077727         WHEN SQLWARN0 NOT = SPACES                               07850001
077728             DISPLAY '*************************'                  07860001
077729             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07870001
077730             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07871006
077731             DISPLAY '** SHIPMT TRIP ID = ' SHIPMT-TRIP-ID        07872006
077732             DISPLAY '** ABEND - TRKUP003 **'                     07880001
077733             DISPLAY '** 3900-CLOSE-TSHIPMT-CSR'                  07890001
077734             DISPLAY '** CLOSE ERROR ON TSHIPMT'                  07900001
077735             PERFORM 9200-SQL-WARNING                             07910001
               WHEN OTHER                                                       
                   CONTINUE                                                     
077752     END-EVALUATE.                                                08000001
077753                                                                  08010001
077800                                                                  08020001
077900******************************************************************08030001
078000* 3950-DELETE-TSHIPMT   - DELETE THE RECORD PROCESSED.           *08040001
078100******************************************************************08050001
078200                                                                  08060001
078300 3950-DELETE-TSHIPMT.                                             08070001
078400                                                                  08080001
078500     EXEC SQL                                                     08090001
078600       DELETE                                                     08100001
078700       FROM     TSHIPMT                                           08110001
078800       WHERE    TRIP_ID    = :VHTRIP-TRIP-ID                      08120001
078900         AND    SHIPT_ID   = :SHIPMT-SHIPT-ID                     08130001
079000     END-EXEC.                                                    08140001
079100                                                                  08150001
079200     EVALUATE TRUE                                                08160001
079300         WHEN SQLCODE < ZERO                                      08170001
079400         WHEN SQLCODE = +100                                      08180001
079401            DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID                07570001
079410            DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID              07580005
079500            DISPLAY '** ABEND - TRKUP003 **'                      08190001
079600            DISPLAY '** 3950-DELETE-TSHIPMT **'                   08200001
079700            DISPLAY '** DELETE ERROR ON TSHIPMT ** '              08210001
079800            PERFORM 9000-SQL-ERROR                                08220001
079900         WHEN SQLCODE > ZERO                                      08230001
080000         WHEN SQLWARN0 NOT = SPACES                               08240001
080010            DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID                07570001
080020            DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID              07580005
080100            DISPLAY '** ABEND - TRKUP003 **'                      08250001
080200            DISPLAY '** 3950-DELETE-TSHIPMT ** '                  08260001
080300            DISPLAY '** DELETE WARNING ON THSIPMT **'             08270001
080400            PERFORM 9000-SQL-ERROR                                08280001
080500         WHEN OTHER                                               08290001
080600            ADD +1  TO PV-TSHIPMT-DELETED                         08300001
080700                       PV-DB2-COMMIT-CNT                          08310001
080800     END-EVALUATE.                                                08320001
080900******************************************************************08330001
081000* 4000-OPEN-TVHTRIP-CSR - OPEN THE CURSOR USED TO SELECT ALL     *08340001
081100* TRIPS THAT HAVE N NULL VEHICLE NUMBER AND ARE OLDER THAN THE   *08350001
081200* CONTROL CARD DATE.                                             *08360001
081300******************************************************************08370001
081400                                                                  08380001
081500 4000-OPEN-TVHTRIP-CSR.                                           08390001
081600                                                                  08400001
081700     EXEC SQL                                                     08410001
081800         OPEN TVHTRIP-CSR                                         08420001
081900     END-EXEC.                                                    08430001
082000                                                                  08440001
082100     EVALUATE TRUE                                                08450001
082200         WHEN SQLCODE < ZERO                                      08460001
080010             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07570001
032200             DISPLAY '** VEHICL NUMBER ' VHTRIP-VEH-NBR           03220001
082310             DISPLAY '** ABEND - TRKUP003 **'                     08470001
082400             DISPLAY '** 4000-OPEN-TVHTRIP-CSR'                   08480001
082500             DISPLAY '** OPEN ERROR ON TVHTRIP'                   08490001
082600             PERFORM 9000-SQL-ERROR                               08500001
082700         WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))         08510001
082800         WHEN SQLWARN0 NOT = SPACES                               08520001
080010             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07570001
032200             DISPLAY '** VEHICL NUMBER ' VHTRIP-VEH-NBR           03220001
082900             DISPLAY '** ABEND - TRKUP003 **'                     08530001
083000             DISPLAY '** 4000-OPEN-TVHTRIP-CSR'                   08540001
083100             DISPLAY '** OPEN WARNING ON TVHTRIP'                 08550001
083200             PERFORM 9200-SQL-WARNING                             08560001
083300         WHEN OTHER                                               08570001
083400             CONTINUE                                             08580001
083500     END-EVALUATE.                                                08590001
083600                                                                  08600001
083700******************************************************************08610001
083800* 4100-FETCH-TVHTRIP-CSR.                                        *08620001
083900*  FETCH A TRIPS WITH NULL VEHICL NUMBER OLDER THAN THE CONTROL  *08630001
084000*  DATE.                                                         *08640001
084100******************************************************************08650001
084200                                                                  08660001
084300 4100-FETCH-TVHTRIP-CSR.                                          08670001
084400                                                                  08680001
084500     INITIALIZE DCLTVHTRIP.                                       08690001
084600                                                                  08700001
084700     EXEC SQL                                                     08710001
084800         FETCH TVHTRIP-CSR                                        08720001
084900          INTO :VHTRIP-TRIP-ID                                    08730001
085000     END-EXEC.                                                    08740001
085100                                                                  08750001
085200     EVALUATE TRUE                                                08760001
085300         WHEN SQLCODE = 0                                         08770001
085400             ADD PC-1            TO PV-TVHTRIP-READ               08780001
085500         WHEN SQLCODE = +100                                      08790001
085600             SET PS-END-OF-TVHTRIP-CSR                            08800001
085700                                 TO TRUE                          08810001
085800         WHEN SQLCODE < ZERO                                      08820001
085900             DISPLAY '** ABEND - TRKUP003 **'                     08830001
086000             DISPLAY '** 4100-FETCH-TVHTRIP-CSR'                  08840001
086100             DISPLAY '** FETCH ERROR ON TVHTRIP CURSOR'           08850001
080010             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07570001
032200             DISPLAY '** VEHICL NUMBER ' VHTRIP-VEH-NBR           03220001
086200             PERFORM 9000-SQL-ERROR                               08860001
086300         WHEN SQLCODE > ZERO                                      08870001
086400         WHEN SQLWARN0 NOT = SPACES                               08880001
086500             DISPLAY '** ABEND - TRKUP003 **'                     08890001
086600             DISPLAY '** 4100-FETCH-TVHTRIP-CSR'                  08900001
086700             DISPLAY '** FETCH WARNING ON TVHTRIP/TSHIPMTP JOIN'  08910001
080010             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07570001
032200             DISPLAY '** VEHICL NUMBER ' VHTRIP-VEH-NBR           03220001
086800             PERFORM 9200-SQL-WARNING                             08920001
086900     END-EVALUATE.                                                08930001
087000                                                                  08940001
087100******************************************************************08950001
087200* 4200-CLOSE-TVHTRIP-CSR - CLOSES THE CURSOR                     *08960001
087300******************************************************************08970001
087400                                                                  08980001
087500 4200-CLOSE-TVHTRIP-CSR.                                          08990001
087600                                                                  09000001
087700     EXEC SQL                                                     09010001
087800         CLOSE TVHTRIP-CSR                                        09020001
087900     END-EXEC.                                                    09030001
088000                                                                  09040001
088100     EVALUATE TRUE                                                09050001
088200         WHEN SQLCODE < ZERO                                      09060001
088210             DISPLAY '** DELETE BEFORE DATE - '                   08470001
088220                      PV-DELETE-BEFORE-DTE                        08470001
088300             DISPLAY '** ABEND - TRKUP003 **'                     09070001
088400             DISPLAY '** 4200-CLOSE-TVHTRIP-CSR'                  09080001
088500             DISPLAY '** CLOSE ERROR ON TVHTRIP/TSHIPMT JOIN'     09090001
080010             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07570001
032200             DISPLAY '** VEHICL NUMBER ' VHTRIP-VEH-NBR           03220001
088600             PERFORM 9000-SQL-ERROR                               09100001
088700         WHEN SQLCODE > ZERO                                      09110001
088800         WHEN SQLWARN0 NOT = SPACES                               09120001
088810             DISPLAY '** DELETE BEFORE DATE - '                   08470001
088820                      PV-DELETE-BEFORE-DTE                        08470001
088900             DISPLAY '** ABEND - TRKUP003 **'                     09130001
089000             DISPLAY '** 4200-CLOSE-TVHTRIP-CSR'                  09140001
089100             DISPLAY '** CLOSE ERROR ON TVHTRIP/TSHIPMT JOIN'     09150001
080010             DISPLAY '** TRIP ID = ' VHTRIP-TRIP-ID               07570001
032200             DISPLAY '** VEHICL NUMBER ' VHTRIP-VEH-NBR           03220001
089200             PERFORM 9200-SQL-WARNING                             09160001
089300         WHEN OTHER                                               09170001
089400             CONTINUE                                             09180001
089500     END-EVALUATE.                                                09190001
089600                                                                  09200001
089700******************************************************************09210001
089800* 5000-OPEN-TTRIPSP-CSR - OPEN THE CURSOR USED TO SELECT ALL     *09220001
089900* TRIP STATUS RECORDS FOR A TRIP.                                 09230001
090000******************************************************************09240001
090100                                                                  09250001
090200 5000-OPEN-TSHPTPO-CSR.                                           09260001
090300                                                                  09270001
090400     EXEC SQL                                                     09280001
090500         OPEN TSHPTPO-CSR                                         09290001
090600     END-EXEC.                                                    09300001
090700                                                                  09310001
090800     EVALUATE TRUE                                                09320001
090900         WHEN SQLCODE < ZERO                                      09330001
091000             DISPLAY '** SHIPMT-SHIPT-ID - ' SHIPMT-SHIPT-ID            01
091001             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
091010             DISPLAY '** ABEND - TRKUP003 **'                     09340001
091100             DISPLAY '** 5000-OPEN-TSHPTPO-CSR'                   09350001
091200             DISPLAY '** OPEN ERROR ON TSHPTPO'                   09360001
091300             PERFORM 9000-SQL-ERROR                               09370001
091400         WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))         09380001
091500         WHEN SQLWARN0 NOT = SPACES                               09390001
091510             DISPLAY '** SHIPMT-SHIPT-ID - ' SHIPMT-SHIPT-ID            01
091520             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
091600             DISPLAY '** ABEND - TRKUP003 **'                     09400001
091700             DISPLAY '** 5000-OPEN-TSHPTPO-CSR'                   09410001
091800             DISPLAY '** OPEN WARNING ON TSHPTPO'                 09420001
091900             PERFORM 9200-SQL-WARNING                             09430001
092000         WHEN OTHER                                               09440001
092100             CONTINUE                                             09450001
092200     END-EVALUATE.                                                09460001
092300                                                                  09470001
092400******************************************************************09480001
092500* 5100-FETCH-TSHPTPO-CSR.                                        *09490001
092600*  FETCH A TRIPS WITH NULL VEHICL NUMBER OLDER THAN THE CONTROL  *09500001
092700*  DATE.                                                         *09510001
092800******************************************************************09520001
092900                                                                  09530001
093000 5100-FETCH-TSHPTPO-CSR.                                          09540001
093100                                                                  09550001
093200     INITIALIZE DCLTSHPTPO.                                       09560001
093300                                                                  09570001
093400     EXEC SQL                                                     09580001
093500         FETCH TSHPTPO-CSR                                        09590001
093600          INTO :SHPTPO-SHIPT-ID                                   09600001
093700             , :SHPTPO-PO-NBR                                     09610001
093800             , :SHPTPO-REC-SEQ-NBR                                09620001
093900     END-EXEC.                                                    09630001
094000                                                                  09640001
094100     EVALUATE TRUE                                                09650001
094200         WHEN SQLCODE = 0                                         09660001
094300             ADD PC-1            TO PV-TSHPTPO-READ               09670001
094400         WHEN SQLCODE = +100                                      09680001
094500             SET PS-END-OF-TSHPTPO-CSR                            09690001
094600                                 TO TRUE                          09700001
094700         WHEN SQLCODE < ZERO                                      09710001
094710             DISPLAY '** SHIPMT-SHIPT-ID - ' SHIPMT-SHIPT-ID            01
094720             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
094800             DISPLAY '** ABEND - TRKUP003 **'                     09720001
094900             DISPLAY '** 5100-FETCH-TSHPTPO-CSR'                  09730001
095000             DISPLAY '** FETCH ERROR ON TSHPTPO'                  09740001
095100             PERFORM 9000-SQL-ERROR                               09750001
095200         WHEN SQLCODE > ZERO                                      09760001
095300         WHEN SQLWARN0 NOT = SPACES                               09770001
095310             DISPLAY '** SHIPMT-SHIPT-ID - ' SHIPMT-SHIPT-ID            01
095320             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
095400             DISPLAY '** ABEND - TRKUP003 **'                     09780001
095500             DISPLAY '** 5100-FETCH-TSHPTPO-CSR'                  09790001
095600             DISPLAY '** FETCH WARNING ON TSHPTPO'                09800001
095700             PERFORM 9200-SQL-WARNING                             09810001
095800     END-EVALUATE.                                                09820001
095900                                                                  09830001
096000******************************************************************09840001
096100* 5200-CLOSE-TSHPTPO-CSR - CLOSES THE CURSOR                     *09850001
096200******************************************************************09860001
096300                                                                  09870001
096400 5200-CLOSE-TSHPTPO-CSR.                                          09880001
096500                                                                  09890001
096600     EXEC SQL                                                     09900001
096700         CLOSE TSHPTPO-CSR                                        09910001
096800     END-EXEC.                                                    09920001
096900                                                                  09930001
097000     EVALUATE TRUE                                                09940001
097100         WHEN SQLCODE < ZERO                                      09950001
097110             DISPLAY '** SHIPMT-SHIPT-ID - ' SHIPMT-SHIPT-ID            01
097120             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
097200             DISPLAY '** ABEND - TRKUP003 **'                     09960001
097300             DISPLAY '** 5200-CLOSE-TSHPTPO-CSR'                  09970001
097400             DISPLAY '** CLOSE ERROR ON TSHPTPO'                  09980001
097500             PERFORM 9000-SQL-ERROR                               09990001
097600         WHEN SQLCODE > ZERO                                      10000001
097700         WHEN SQLWARN0 NOT = SPACES                               10010001
097710             DISPLAY '** SHIPMT-SHIPT-ID - ' SHIPMT-SHIPT-ID            01
097720             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
097800             DISPLAY '** ABEND - TRKUP003 **'                     10020001
097900             DISPLAY '** 5200-CLOSE-TSHPTPO-CSR'                  10030001
098000             DISPLAY '** CLOSE ERROR ON TSHPTPO'                  10040001
098100             PERFORM 9200-SQL-WARNING                             10050001
098200         WHEN OTHER                                               10060001
098300             CONTINUE                                             10070001
098400     END-EVALUATE.                                                10080001
098500                                                                  10090001
098600******************************************************************10100001
098700* 7300-OPEN-TVEHICL-CSR - OPEN THE CURSOR USED TO SELECT ALL     *10110001
098800* VEHICLES NOT DEPARTED.                                         *10120001
098900******************************************************************10130001
099000                                                                  10140001
099100 7300-OPEN-TVEHICL-CSR.                                           10150001
099200                                                                  10160001
099300     EXEC SQL                                                     10170001
099400         OPEN TVEHICL-CSR                                         10180001
099500     END-EXEC.                                                    10190001
099600                                                                  10200001
099700     EVALUATE TRUE                                                10210001
099800         WHEN SQLCODE < ZERO                                      10220001
099801             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
099810             DISPLAY '** VEHICLE OWNER SCAC - '                         01
099811                                           VEHICL-OWNER-SCAC-ID         01
099820             DISPLAY '** VEHICLE NUMBER - ' VEHICL-VEH-NBR              01
099900             DISPLAY '** ABEND - TRKUP003 **'                     10230001
100000             DISPLAY '** 7300-OPEN-TVEHICL-CSR'                   10240001
100100             DISPLAY '** OPEN ERROR ON TVEHICL'                   10250001
100200             PERFORM 9000-SQL-ERROR                               10260001
100300         WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))         10270001
100400         WHEN SQLWARN0 NOT = SPACES                               10280001
100410             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
100420             DISPLAY '** VEHICLE OWNER SCAC - '                         01
100430                                           VEHICL-OWNER-SCAC-ID         01
100440             DISPLAY '** VEHICLE NUMBER - ' VEHICL-VEH-NBR              01
100500             DISPLAY '** ABEND - TRKUP003 **'                     10290001
100600             DISPLAY '** 7300-OPEN-TVEHICL-CSR'                   10300001
100700             DISPLAY '** OPEN WARNING ON TVEHICL'                 10310001
100800             PERFORM 9200-SQL-WARNING                             10320001
100900         WHEN OTHER                                               10330001
101000             CONTINUE                                             10340001
101100     END-EVALUATE.                                                10350001
101200                                                                  10360001
101300******************************************************************10370001
101400* 7400-FETCH-TVEHICL-CSR.                                        *10380001
101500*  FETCH A VEHICLES THAT WERE NOT DEPARTED.                      *10390001
101600******************************************************************10400001
101700                                                                  10410001
101800 7400-FETCH-TVEHICL-CSR.                                          10420001
101900                                                                  10430001
102000     INITIALIZE DCLTVEHICL.                                       10440001
102100                                                                  10450001
102200     EXEC SQL                                                     10460001
102300         FETCH TVEHICL-CSR                                        10470001
102400          INTO :VEHICL-OWNER-SCAC-ID                              10480001
102500              ,:VEHICL-VEH-NBR                                    10490001
102600              ,:VEHICL-CURR-TRIP-ID                               10500001
102700                          :PV-VEHICL-CURR-TRIP-ID-NULL            10510001
102800     END-EXEC.                                                    10520001
102900                                                                  10530001
103000     EVALUATE TRUE                                                10540001
103100         WHEN SQLCODE = 0                                         10550001
103200             ADD PC-1            TO PV-TVEHICL-READ               10560001
103300             IF PV-VEHICL-CURR-TRIP-ID-NULL = PC-NEG-1            10570001
103400                  MOVE ZEROES TO VEHICL-CURR-TRIP-ID              10580001
103500             END-IF                                               10590001
103600         WHEN SQLCODE = +100                                      10600001
103700             SET PS-END-OF-TVEHICL-CSR                            10610001
103800                                 TO TRUE                          10620001
103900         WHEN SQLCODE < ZERO                                      10630001
103910             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
103920             DISPLAY '** VEHICLE OWNER SCAC - '                         01
103930                                           VEHICL-OWNER-SCAC-ID         01
103940             DISPLAY '** VEHICLE NUMBER - ' VEHICL-VEH-NBR              01
104000             DISPLAY '** ABEND - TRKUP003 **'                     10640001
104100             DISPLAY '** 7400-FETCH-TVEHICL-CSR'                  10650001
104200             DISPLAY '** FETCH ERROR ON TVEHICL'                  10660001
104300             PERFORM 9000-SQL-ERROR                               10670001
104400         WHEN SQLCODE > ZERO                                      10680001
104500         WHEN SQLWARN0 NOT = SPACES                               10690001
104510             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
104520             DISPLAY '** VEHICLE OWNER SCAC - '                         01
104530                                           VEHICL-OWNER-SCAC-ID         01
104540             DISPLAY '** VEHICLE NUMBER - ' VEHICL-VEH-NBR              01
104600             DISPLAY '** ABEND - TRKUP003 **'                     10700001
104700             DISPLAY '** 7400-FETCH-TVEHICL-CSR'                  10710001
104800             DISPLAY '** FETCH WARNING ON TVEHICL'                10720001
104900             PERFORM 9200-SQL-WARNING                             10730001
105000     END-EVALUATE.                                                10740001
105100                                                                  10750001
105200******************************************************************10760001
105300* 7500-CLOSE-TVEHICL-CSR - CLOSES THE CURSOR                     *10770001
105400******************************************************************10780001
105500                                                                  10790001
105600 7500-CLOSE-TVEHICL-CSR.                                          10800001
105700                                                                  10810001
105800     EXEC SQL                                                     10820001
105900         CLOSE TVEHICL-CSR                                        10830001
106000     END-EXEC.                                                    10840001
106100                                                                  10850001
106200     EVALUATE TRUE                                                10860001
106300         WHEN SQLCODE < ZERO                                      10870001
106310             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
106320             DISPLAY '** VEHICLE OWNER SCAC - '                         01
106330                                           VEHICL-OWNER-SCAC-ID         01
106340             DISPLAY '** VEHICLE NUMBER - ' VEHICL-VEH-NBR              01
106400             DISPLAY '** ABEND - TRKUP003 **'                     10880001
106500             DISPLAY '** 7500-CLOSE-TVEHICL-CSR'                  10890001
106600             DISPLAY '** CLOSE ERROR ON TVEHICL'                  10900001
106700             PERFORM 9000-SQL-ERROR                               10910001
106800         WHEN SQLCODE > ZERO                                      10920001
106900         WHEN SQLWARN0 NOT = SPACES                               10930001
106910             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
106920             DISPLAY '** VEHICLE OWNER SCAC - '                         01
106930                                           VEHICL-OWNER-SCAC-ID         01
106940             DISPLAY '** VEHICLE NUMBER - ' VEHICL-VEH-NBR              01
107000             DISPLAY '** ABEND - TRKUP003 **'                     10940001
107100             DISPLAY '** 7500-CLOSE-TVEHICL-CSR'                  10950001
107200             DISPLAY '** CLOSE ERROR ON TVEHICL'                  10960001
107300             PERFORM 9200-SQL-WARNING                             10970001
107400         WHEN OTHER                                               10980001
107500             CONTINUE                                             10990001
107600     END-EVALUATE.                                                11000001
107700                                                                  11010001
107800******************************************************************11020001
107900* 7600-UPDATE-TVEHICL - RETRIEVE THE TSHIPMT RECORDS WITH A      *11030001
108000* TRIP-ID WHICH MATCHES THE TRIP-ID OF THE TVHTRIP CURSOR.       *11040001
108100******************************************************************11050001
108200                                                                  11060001
108300 7600-UPDATE-TVEHICL.                                             11070001
108400     MOVE ZEROES TO PV-VEHICL-CURR-TRIP-ID.                       11080001
108500     MOVE PC-NEG-1 TO PV-VEHICL-CURR-TRIP-ID-NULL.                11090001
108600                                                                  11100001
108700     EXEC SQL                                                     11110001
108800       UPDATE  TVEHICL                                            11120001
108900          SET  LAST_UPD_DTE      = CURRENT DATE                   11130001
109000              ,LAST_UPD_TME      = CURRENT TIME                   11140001
109100              ,LAST_UPD_UID      = :PC-TRKUP003                   11150001
109200              ,CURR_STATUS_CDE   = :PC-ET                         11160001
109300              ,CURR_STATUS_DTE   = CURRENT DATE                   11170001
109400              ,CURR_STATUS_TME   = CURRENT TIME                   11180001
109500              ,CURR_TRIP_ID      = :PV-VEHICL-CURR-TRIP-ID        11190001
109600                                      :PV-VEHICL-CURR-TRIP-ID-NULL11200001
109700        WHERE  OWNER_SCAC_ID     = :VEHICL-OWNER-SCAC-ID          11210001
109800          AND  VEH_NBR           = :VEHICL-VEH-NBR                11220001
109900     END-EXEC.                                                    11230001
110000                                                                  11240001
110100     EVALUATE TRUE                                                11250001
110200         WHEN SQLCODE < ZERO                                      11260001
110300             DISPLAY '** ABEND - TRKUP003 **'                     11270001
110400             DISPLAY '** 7600-UPDATE-TVEHICL'                     11280001
110500             DISPLAY '** UPDATE ERROR ON TVEHICL'                 11290001
110600             DISPLAY '** OWNER SCAC ID  - ' VEHICL-OWNER-SCAC-ID  11300001
110700             DISPLAY '** VEH NBR IS       - ' VEHICL-VEH-NBR      11310001
110710             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
110800             PERFORM 9000-SQL-ERROR                               11320001
110900         WHEN SQLCODE > ZERO                                      11330001
111000         WHEN SQLWARN0 NOT = SPACES                               11340001
111100             DISPLAY '** ABEND - TRKUP003 **'                     11350001
111200             DISPLAY '** 7600-UPDATE-TVEHICL'                     11360001
111300             DISPLAY '** UPDATE WARNING ON TVEHICL'               11370001
111310             DISPLAY '** OWNER SCAC ID  - ' VEHICL-OWNER-SCAC-ID  11300001
111320             DISPLAY '** VEH NBR IS       - ' VEHICL-VEH-NBR      11310001
111330             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
111400             PERFORM 9200-SQL-WARNING                             11380001
111500         WHEN OTHER                                               11390001
111600             ADD PC-1 TO PV-TVEHICL-UPDATED                       11400001
111700             PERFORM 7650-INSERT-TAUVHCL                          11410001
111800     END-EVALUATE.                                                11420001
111900                                                                  11430001
112000******************************************************************11440001
112100* 7650-INSERT-TAUVHCL INSERTS THE UPDATED TVEHICL ROW TO THE AUDIT11450001
112200*      TABLE.                                                     11460001
112300******************************************************************11470001
112400                                                                  11480001
112500 7650-INSERT-TAUVHCL.                                             11490001
112600                                                                  11500001
112700     EXEC SQL                                                     11510001
112800        SELECT   OWNER_SCAC_ID                                    11520001
112900               , VEH_NBR                                          11530001
113000               , CRT_SRC_CDE                                      11540001
113100               , LAST_UPD_DTE                                     11550001
113200               , LAST_UPD_TME                                     11560001
113300               , LAST_UPD_UID                                     11570001
113400               , USAGE_CDE                                        11580001
113500               , VEH_TYP_CDE                                      11590001
113600               , CURR_STATUS_CDE                                  11600001
113700               , CURR_STATUS_DTE                                  11610001
113800               , CURR_STATUS_TME                                  11620001
113900               , CURR_OPER_UNT_ID                                 11630001
114000               , CURR_FCLTY_ID                                    11640001
114100               , CURR_FAC_AREA_ID                                 11650001
114200               , CURR_LOC_DTE                                     11660001
114300               , CURR_LOC_TME                                     11670001
114400               , CURR_TRIP_ID                                     11680001
114500               , VEH_SIZE_CDE                                     11690001
114600          INTO   :AUVHCL-OWNER-SCAC-ID                            11700001
114700               , :AUVHCL-VEH-NBR                                  11710001
114800               , :AUVHCL-CRT-SRC-CDE                              11720001
114900               , :AUVHCL-LAST-UPD-DTE                             11730001
115000               , :AUVHCL-LAST-UPD-TME                             11740001
115100               , :AUVHCL-LAST-UPD-UID                             11750001
115200               , :AUVHCL-USAGE-CDE                                11760001
115300               , :AUVHCL-VEH-TYP-CDE                              11770001
115400               , :AUVHCL-CURR-STATUS-CDE                          11780001
115500               , :AUVHCL-CURR-STATUS-DTE                          11790001
115600               , :AUVHCL-CURR-STATUS-TME                          11800001
115700               , :AUVHCL-CURR-OPER-UNT-ID                         11810001
115800               , :AUVHCL-CURR-FCLTY-ID                            11820001
115900               , :AUVHCL-CURR-FAC-AREA-ID                         11830001
116000               , :AUVHCL-CURR-LOC-DTE                             11840001
116100               , :AUVHCL-CURR-LOC-TME                             11850001
116200               , :AUVHCL-CURR-TRIP-ID                             11860001
116300                             :PV-AUVHCL-CURR-TRIP-ID-NULL         11870001
116400               , :AUVHCL-VEH-SIZE-CDE                             11880001
116500        FROM   TVEHICL                                            11890001
116600        WHERE  OWNER_SCAC_ID     = :VEHICL-OWNER-SCAC-ID          11900001
116700          AND  VEH_NBR           = :VEHICL-VEH-NBR                11910001
116800     END-EXEC.                                                    11920001
116900                                                                  11930001
117000     EVALUATE TRUE                                                11940001
117100         WHEN SQLCODE < ZERO                                      11950001
117200             DISPLAY '** ABEND - TRKUP003 **'                     11960001
117300             DISPLAY '** 7650-SELECT-TVEHICL'                     11970001
117400             DISPLAY '** SELECT ERROR ON TVEHICL'                 11980001
117500             DISPLAY '** OWNER SCAC ID  - '                       11990001
117501             VEHICL-OWNER-SCAC-ID                                 12000001
117700             DISPLAY '** VEH NBR  - ' VEHICL-VEH-NBR              12010001
117710             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
117800             PERFORM 9000-SQL-ERROR                               12020001
117900         WHEN SQLCODE > ZERO                                      12030001
118000         WHEN SQLWARN0 NOT = SPACES                               12040001
118100             DISPLAY '** ABEND - TRKUP003 **'                     12050001
118200             DISPLAY '** 7650-SELECT-TVEHICL'                     12060001
118300             DISPLAY '** SELECT WARNING ON TVEHICL'               12070001
118310             DISPLAY '** SELECT ERROR ON TVEHICL'                 11980001
118320             DISPLAY '** OWNER SCAC ID IS - '                     11990001
118330             VEHICL-OWNER-SCAC-ID                                 12000001
118340             DISPLAY '** VEH NBR IS - ' VEHICL-VEH-NBR            12010001
118350             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
118400             PERFORM 9200-SQL-WARNING                             12080001
118500         WHEN OTHER                                               12090001
118600             SET INSERT-TO-AUDIT TO TRUE                          12100001
118700             IF PV-AUVHCL-CURR-TRIP-ID-NULL = PC-NEG-1            12110001
118800                MOVE ZEROS    TO  AUVHCL-CURR-TRIP-ID             12120001
118900             END-IF                                               12130001
119000     END-EVALUATE.                                                12140001
119100                                                                  12150001
119200     IF INSERT-TO-AUDIT                                           12160001
119300        SET NO-INSERT TO TRUE                                     12170001
119400        EXEC SQL                                                  12180001
119500           INSERT INTO TAUVHCL                                    12190001
119600               ( OWNER_SCAC_ID                                    12200001
119700               , VEH_NBR                                          12210001
119800               , CRT_SRC_CDE                                      12220001
119900               , LAST_UPD_DTE                                     12230001
120000               , LAST_UPD_TME                                     12240001
120100               , LAST_UPD_UID                                     12250001
120200               , USAGE_CDE                                        12260001
120300               , VEH_TYP_CDE                                      12270001
120400               , CURR_STATUS_CDE                                  12280001
120500               , CURR_STATUS_DTE                                  12290001
120600               , CURR_STATUS_TME                                  12300001
120700               , CURR_OPER_UNT_ID                                 12310001
120800               , CURR_FCLTY_ID                                    12320001
120900               , CURR_FAC_AREA_ID                                 12330001
121000               , CURR_LOC_DTE                                     12340001
121100               , CURR_LOC_TME                                     12350001
121200               , CURR_TRIP_ID                                     12360001
121300               , VEH_SIZE_CDE)                                    12370001
121400           VALUES                                                 12380001
121500                (:AUVHCL-OWNER-SCAC-ID                            12390001
121600               , :AUVHCL-VEH-NBR                                  12400001
121700               , :AUVHCL-CRT-SRC-CDE                              12410001
121800               , :AUVHCL-LAST-UPD-DTE                             12420001
121900               , :AUVHCL-LAST-UPD-TME                             12430001
122000               , :AUVHCL-LAST-UPD-UID                             12440001
122100               , :AUVHCL-USAGE-CDE                                12450001
122200               , :AUVHCL-VEH-TYP-CDE                              12460001
122300               , :AUVHCL-CURR-STATUS-CDE                          12470001
122400               , :AUVHCL-CURR-STATUS-DTE                          12480001
122500               , :AUVHCL-CURR-STATUS-TME                          12490001
122600               , :AUVHCL-CURR-OPER-UNT-ID                         12500001
122700               , :AUVHCL-CURR-FCLTY-ID                            12510001
122800               , :AUVHCL-CURR-FAC-AREA-ID                         12520001
122900               , :AUVHCL-CURR-LOC-DTE                             12530001
123000               , :AUVHCL-CURR-LOC-TME                             12540001
123100               , :AUVHCL-CURR-TRIP-ID                             12550001
123200                        :PV-AUVHCL-CURR-TRIP-ID-NULL              12560001
123300               , :AUVHCL-VEH-SIZE-CDE)                            12570001
123400        END-EXEC                                                  12580001
123500        EVALUATE TRUE                                             12590001
123600            WHEN SQLCODE < ZERO                                   12600001
123700                DISPLAY '** ABEND - TRKUP003 **'                  12610001
123800                DISPLAY '** 7650-INSERT-TAUVHCL'                  12620001
123900                DISPLAY '** INSERT ERROR ON TAUVHCL'              12630001
123910                DISPLAY '** OWNER SCAC ID IS - '                  11990001
123920                VEHICL-OWNER-SCAC-ID                              12000001
123930                DISPLAY '** VEH NBR IS - ' VEHICL-VEH-NBR         12010001
123940                DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID           01
124000                PERFORM 9000-SQL-ERROR                            12640001
124100            WHEN SQLCODE > ZERO                                   12650001
124200            WHEN SQLWARN0 NOT = SPACES                            12660001
124300                DISPLAY '** ABEND - TRKUP003 **'                  12670001
124400                DISPLAY '** 7650-INSERT-TAUVHCL'                  12680001
124500                DISPLAY '** INSERT WARNING ON TAUVHCL'            12690001
124510                DISPLAY '** OWNER SCAC ID IS - '                  11990001
124520                VEHICL-OWNER-SCAC-ID                              12000001
124530                DISPLAY '** VEH NBR IS - ' VEHICL-VEH-NBR         12010001
124540                DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID           01
124600                PERFORM 9200-SQL-WARNING                          12700001
124700            WHEN OTHER                                            12710001
124800                ADD PC-1 TO PV-TAUVHCL-INSERTED                   12720001
124900        END-EVALUATE                                              12730001
125000     ELSE                                                         12740001
125100        CONTINUE                                                  12750001
125200     END-IF.                                                      12760001
125300                                                                  12770001
125400******************************************************************12780001
125500* 8000-COMMIT - PERFORMS A COMMIT ON ALL ROWS DELETED SO FAR      12790001
125600******************************************************************12800001
125700                                                                  12810001
125800 8000-COMMIT.                                                     12820001
125900                                                                  12830001
126000     EXEC SQL                                                     12840001
126100         COMMIT                                                   12850001
126200     END-EXEC.                                                    12860001
126300                                                                  12870001
126400     EVALUATE TRUE                                                12880001
126500         WHEN SQLCODE = 0                                         12890001
126600             ADD PC-1            TO PV-COMMITS-TAKEN              12900001
070502             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07071006
127010             DISPLAY '** OWNER SCAC ID IS - '                     11990001
127020             VEHICL-OWNER-SCAC-ID                                 12000001
127030             DISPLAY '** VEH NBR IS - ' VEHICL-VEH-NBR            12010001
127040             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
126700         WHEN SQLCODE < 0                                         12910001
126800             DISPLAY '** ABEND - TRKUP003 **'                     12920001
126900             DISPLAY '** 8000-COMMIT'                             12930001
127000             DISPLAY '** COMMIT ERROR '                           12940001
070502             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07071006
127010             DISPLAY '** OWNER SCAC ID IS - '                     11990001
127020             VEHICL-OWNER-SCAC-ID                                 12000001
127030             DISPLAY '** VEH NBR IS - ' VEHICL-VEH-NBR            12010001
127040             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
127100             PERFORM 9000-SQL-ERROR                               12950001
127200         WHEN SQLCODE > 0                                         12960001
127300         WHEN SQLWARN0 = 'W'                                      12970001
127400             DISPLAY '** ABEND - TRKUP003 **'                     12980001
127500             DISPLAY '** 8000-COMMIT'                             12990001
127600             DISPLAY '** COMMIT WARNING'                          13000001
070502             DISPLAY '** SHIPT ID = ' SHIPMT-SHIPT-ID             07071006
127610             DISPLAY '** OWNER SCAC ID IS - '                     11990001
127620             VEHICL-OWNER-SCAC-ID                                 12000001
127630             DISPLAY '** VEH NBR IS - ' VEHICL-VEH-NBR            12010001
127640             DISPLAY '** VHTRIP-TRIP-ID - ' VHTRIP-TRIP-ID              01
127700             PERFORM 9200-SQL-WARNING                             13010001
127800     END-EVALUATE.                                                13020001
127900                                                                  13030001
128000     MOVE ZERO                   TO PV-DB2-COMMIT-CNT.            13040001
131400******************************************************************13380001
131500* 9000-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      13390001
131600* EVENT THAT AN SQL ERROR CODE OCCURS.                            13400001
131700******************************************************************13410001
131800 9000-SQL-ERROR.                                                  13420001
131900                                                                  13430001
132000     MOVE SQLCODE                TO SQLCODE2.                     13440001
132100     MOVE SQLERRD(3)             TO SQLERRD3.                     13450001
132200                                                                  13460001
132300     DISPLAY '** ABEND **         ** = SQLERROR'.                 13470001
132400     DISPLAY '** PROGRAM          ** = TRKUP003'.                 13480001
132500     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                13490001
132600     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                13500001
132700     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 13510001
132800     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                13520001
132900                                                                  13530001
133000     EXEC SQL                                                     13540001
133100         ROLLBACK                                                 13550001
133200     END-EXEC.                                                    13560001
133300                                                                  13570001
133310     PERFORM 9500-EOJ-ROUTINE.                                    04090001
133320                                                                  13570001
133400     MOVE +4013                  TO ABEND-CODE.                   13580001
133500     CALL 'ILBOABN0' USING ABEND-CODE.                            13590001
133600                                                                  13600001
133700******************************************************************13610001
133800* 9200-SQL-WARNING - PERFORMS THE ABEND FOR THE PROGRAM IN THE    13620001
133900* EVENT THAT AN SQL WARNING CODE OCCURS.                          13630001
134000******************************************************************13640001
134100 9200-SQL-WARNING.                                                13650001
134200                                                                  13660001
134300     DISPLAY '9200-SQL-WARNING'.                                  13670001
134400     MOVE SQLCODE                TO SQLCODE2.                     13680001
134500     MOVE SQLERRD(3)             TO SQLERRD3.                     13690001
134600     DISPLAY '** ABEND **       ** = SQLWARNING'.                 13700001
134700     DISPLAY '** PROGRAM        ** = TRKUP003'.                   13710001
134800     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  13720001
134900     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  13730001
135000     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  13740001
135100     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  13750001
135200     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  13760001
135300     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  13770001
135400     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  13780001
135500     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  13790001
135600     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  13800001
135700     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  13810001
135800                                                                  13820001
135900     EXEC SQL                                                     13830001
136000         ROLLBACK                                                 13840001
136100     END-EXEC.                                                    13850001
136101                                                                  13570001
136110     PERFORM 9500-EOJ-ROUTINE.                                    04090001
136200                                                                  13860001
136300     MOVE +4013                  TO ABEND-CODE.                   13870001
136400     CALL 'ILBOABN0' USING ABEND-CODE.                            13880001
136410                                                                          
136500******************************************************************13050001
136600* 9500-EOJ-ROUTINE - CLOSES CURSOR AND WRITES JOB STATISTICS.     13060001
136700******************************************************************13070001
136800 9500-EOJ-ROUTINE.                                                13080001
136900                                                                  13090001
137000     MOVE PV-TVHTRIP-READ        TO DL1-TOT-TVHTRIP-READ.         13120001
137100     MOVE PV-TVHTRIP-DELETED     TO DL2-TOT-TVHTRIP-DEL.          13130001
137200     MOVE PV-TSHPTPO-READ        TO DL3-TOT-TSHPTPO-READ.         13140001
137300     MOVE PV-TSHPTPO-DELETED     TO DL4-TOT-TSHPTPO-DEL.          13150001
137400     MOVE PV-TSHIPMT-READ        TO DL5-TOT-TSHIPMT-READ.         13160001
137500     MOVE PV-TSHIPMT-DELETED     TO DL6-TOT-TSHIPMT-DEL.          13170001
137600     MOVE PV-TSHIPST-READ        TO DL7-TOT-TSHIPST-READ.         13180001
137700     MOVE PV-TSHIPST-DELETED     TO DL8-TOT-TSHIPST-DEL.          13190001
137800     MOVE PV-TVEHICL-READ        TO DL9-TOT-TVEHICL-READ.         13200001
137900     MOVE PV-TVEHICL-UPDATED     TO DL10-TOT-TVEHICL-UPD.         13210001
138000     MOVE PV-COMMITS-TAKEN       TO DL11-TOT-COMMITS.             13220001
138100     MOVE PV-TAUVHCL-INSERTED    TO DL10-TOT-TAUVHCL-INSERT.      13230001
138200                                                                  13240001
138300     DISPLAY DL1-DETAIL-LINE-1.                                   13250001
138400     DISPLAY DL2-DETAIL-LINE-2.                                   13260001
138500     DISPLAY DL3-DETAIL-LINE-3.                                   13270001
138600     DISPLAY DL4-DETAIL-LINE-4.                                   13280001
138700     DISPLAY DL5-DETAIL-LINE-5.                                   13290001
138800     DISPLAY DL6-DETAIL-LINE-6.                                   13300001
138900     DISPLAY DL7-DETAIL-LINE-7.                                   13310001
139000     DISPLAY DL8-DETAIL-LINE-8.                                   13320001
139100     DISPLAY DL9-DETAIL-LINE-9.                                   13330001
139200     DISPLAY DL10-DETAIL-LINE-10.                                 13340001
139300     DISPLAY DL10-DETAIL-LINE-12.                                 13350001
139400     DISPLAY DL11-DETAIL-LINE-11.                                 13360001
139500                                                                  13370001
