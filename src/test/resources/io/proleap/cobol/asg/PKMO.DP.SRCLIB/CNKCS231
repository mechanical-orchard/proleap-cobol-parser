000300*-----------------------*                                         00030001
000400 IDENTIFICATION DIVISION.                                         00040001
000500*-----------------------*                                         00050001
000600 PROGRAM-ID.    CNKCS231.                                         00060002
000700 AUTHOR.        PATRICK BURKE.                                    00070002
000800 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080001
000900 DATE-WRITTEN.  MARCH, 2001                                       00090002
001000 DATE-COMPILED.                                                   00100001
001100                                                                  00110001
001200***************************************************************** 00120006
001300*  Y231 - TRAILER MANIFESTING -DOOR TO STORE ASGN - STORE ORDER   00130039
001400***************************************************************** 00140006
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00141052
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142052
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00143052
263455*----------------------------------------------------------------*00144052
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00145053
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00146053
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00147053
CICS  *-----------------------------------------------------------------00148053
001500 ENVIRONMENT DIVISION.                                            00150001
001600 DATA DIVISION.                                                   00160001
001700                                                                  00170001
001800 WORKING-STORAGE SECTION.                                         00180001
001900                                                                  00190001
002000 01  DK-DB2-KEYS.                                                 00200001
002100     05  DK-TYPE-CODE              PIC  X(02) VALUE SPACES.       00210001
002200     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00220001
002300     05  DK-DOOR-ID                PIC  X(04) VALUE SPACES.       00230029
002400     05  DK-START-DTE.                                            00240001
002500         10  DK-MM                 PIC  X(02).                    00250001
002600         10  FILLER                PIC  X(01) VALUE '/'.          00260001
002700         10  DK-DD                 PIC  X(02).                    00270001
002800         10  FILLER                PIC  X(01) VALUE '/'.          00280001
002900         10  DK-CC                 PIC  X(04).                    00290001
003000     05  DK-START-TME.                                            00300001
003100         10  DK-HR                 PIC  X(02).                    00310001
003200         10  FILLER                PIC  X(01) VALUE ':'.          00320001
003300         10  DK-MN                 PIC  X(02).                    00330001
003400     05  DK-END-DTE.                                              00340001
003500         10  DK-END-MM              PIC  X(02).                   00350001
003600         10  FILLER                 PIC  X(01) VALUE '/'.         00360001
003700         10  DK-END-DD              PIC  X(02).                   00370001
003800         10  FILLER                 PIC  X(01) VALUE '/'.         00380001
003900         10  DK-END-CC              PIC  X(04).                   00390001
004000     05  DK-END-TME.                                              00400001
004100         10  DK-END-HR              PIC  X(02).                   00410001
004200         10  FILLER                 PIC  X(01) VALUE ':'.         00420001
004300         10  DK-END-MN              PIC  X(02).                   00430001
004400                                                                  00440001
004500 01  PC-PROGRAM-CONSTANTS.                                        00450001
004600     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK231  '.  00460005
004700     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM231 '.  00470005
004800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS231'.  00480005
004900     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00490001
005000     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00500001
005100     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00510001
005200     05  PC-DETAIL-SCREEN          PIC  X(01)  VALUE '2'.         00520001
005300     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00530034
005400                                               COMP SYNC.         00540001
005500     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00550001
005600                                               COMP SYNC.         00560001
005700     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00570001
005800                                               COMP-3.            00580001
005900     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00590001
006000                                               COMP SYNC.         00600001
006100     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00610001
006200                                               COMP-3.            00620001
006300     05  PC-D                      PIC  X(01)  VALUE 'D'.         00630047
006310     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00631047
006400     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00640001
006500     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00650001
006600     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00660001
006700     05  PC-01                     PIC  X(02)  VALUE '01'.        00670001
006800     05  PC-ACTIVE                 PIC  X(06)  VALUE 'ACTIVE'.    00680001
006900     05  PC-INACTV                 PIC  X(06)  VALUE 'INACTV'.    00690001
007000     05  PC-DEFAULT-TIMESTAMP      PIC  X(26)  VALUE              00700001
007100                                 '9999-09-09-09.09.09.999999'.    00710001
007200                                                                  00720001
007300*----------------------------------------------------------------*00730001
007400*  SYSTEM MESSAGES                                               *00740001
007500*----------------------------------------------------------------*00750001
007600*   00005 = INVALID VALUE                                        *00760001
007700*   00008 = MUST BE NUMERIC                                      *00770001
007800*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00780001
007900*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00790001
008000*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00800001
008100*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00810001
008200*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00820001
008300*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00830001
008400*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00840001
008500*   00069 - TOP OF LIST                                          *00850001
008600*   00070 - BOTTOM OF LIST                                       *00860001
008700*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00870001
008800*   00279 - MORE ITEMS TO DISPLAY                                *00880001
008900*----------------------------------------------------------------*00890001
009000     05  PC-TSYMSG-NUMBERS.                                       00900001
009100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00910001
009200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00920001
009300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00930001
009400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00940001
009500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00950001
009600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00960001
009700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00970001
009800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00980001
009900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00990001
010000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01000001
010100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01010001
010200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01020001
010300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01030001
010400                                                                  01040001
010500 01  PS-PROGRAM-SWITCHES.                                         01050001
010600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01060001
010700         88  PS-NO-ERROR                            VALUE 'Y'.    01070001
010800         88  PS-ERROR                               VALUE 'N'.    01080001
010900     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01090001
011000         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01100001
011100         88  PS-BLOCK-ERROR                         VALUE 'N'.    01110001
011200     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   01120001
011300         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   01130001
011400         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   01140001
011500     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    01150001
011600         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    01160001
011700         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    01170001
011800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01180001
011900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01190001
012000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01200001
012100     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    01210001
012200         88  PS-LIST-END                            VALUE 'Y'.    01220001
012300         88  PS-NO-LIST-END                         VALUE 'N'.    01230001
012400*                                                                 01240001
012500 01  PV-PROGRAM-VARIABLES.                                        01250001
012600     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01260001
012700                                        COMP SYNC.                01270001
012800     05  PV-SUB                         PIC S9(04)  VALUE +0      01280001
012900                                                    COMP SYNC.    01290001
013000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01300001
013100                                                    COMP SYNC.    01310001
013200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01320001
013300                                                    COMP-3.       01330001
013400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01340001
013500                                                    COMP-3.       01350001
013600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01360001
013700                                                    COMP-3.       01370001
013800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01380001
013900                                                    COMP-3.       01390001
014000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01400001
014100                                                    COMP-3.       01410001
014200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01420001
014300                                                    COMP-3.       01430001
014400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01440001
014500                                                    COMP-3.       01450001
014600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01460001
014700                                                    COMP SYNC.    01470001
014800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01480001
014900                                                    COMP SYNC.    01490001
015000     05  PV-ITEM                        PIC S9(04)  VALUE +0      01500001
015100                                                    COMP SYNC.    01510001
015200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01520001
015300                                                    COMP SYNC.    01530001
015400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01540001
015500                                                    COMP SYNC.    01550001
015600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01560001
015700                                                    COMP SYNC.    01570001
015800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01580001
015900                                                    COMP SYNC.    01590001
016000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01600001
016100                                                    COMP SYNC.    01610001
016200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01620001
016300                                                    COMP SYNC.    01630001
016400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01640001
016500                                                    COMP SYNC.    01650001
016600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01660001
016700                                                    COMP SYNC.    01670001
016800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01680001
016900                                                    COMP SYNC.    01690001
017000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01700001
017100                                                    COMP SYNC.    01710001
017200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01720001
017300                                                    COMP SYNC.    01730001
017400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01740001
017500                                                    COMP SYNC.    01750001
017600     05  PV-SOFT-ABORT-MSG.                                       01760001
017700         10  FILLER            PIC X(12) VALUE ' CNKCS231 - '.    01770005
017800         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01780001
017900         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01790001
018000         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01800001
018100         10  PV-SOFT-PARAGRAPH PIC X(30).                         01810001
018200     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01820001
018300                                                     COMP SYNC.   01830001
018400     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01840001
018500     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01850001
018600     05  PV-CICS-MSG-HOLD.                                        01860001
018700         10  FILLER                      PIC  X(01)  VALUE SPACE. 01870001
018800         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 01880001
018900     05  PV-CICS-MSG-HOLD2.                                       01890001
019000         10  FILLER                      PIC  X(01)  VALUE SPACE. 01900001
019100         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 01910001
019200                                                                  01920001
019300     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01930001
019400                                                     COMP SYNC.   01940001
019500     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01950001
019600     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01960001
019700*    05  PV-SCROLL-AREA                  OCCURS 12 TIMES.         01970043
019800******************************************************************01980001
019900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01990001
020000**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **02000001
020100**  APPLICATION-SPECIFIC COMMAREA.                              **02010001
020200******************************************************************02020001
020300 01  LQW-LIST-QUEUE-WORK-AREA.                                    02030001
020400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02040001
020500     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           02050032
020600                                        INDEXED BY LQW-IDX.       02060001
020700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02070001
020800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02080001
020900         10  LQW-SELECTED-SW            PIC  X(01).               02090001
021000             88  LQW-SELECT                         VALUE 'S'.    02100001
021100             88  LQW-DESELECT                       VALUE ' '.    02110001
021200         10  LQW-ACTION                 PIC  X(03).               02120001
021300             88  LQW-DEL                            VALUE 'DEL'.  02130001
021400             88  LQW-INQ                            VALUE 'INQ'.  02140001
021500             88  LQW-UPD                            VALUE 'UPD'.  02150001
021600             88  LQW-ERR                            VALUE 'ERR'.  02160001
021710         10  LQW-STATUS              PIC  X(06).                  02171044
021720         10  LQW-STORE-NBR           PIC  X(04).                  02172044
021730         10  LQW-STORE-NAME          PIC  X(25).                  02173044
021740         10  LQW-START-DATE          PIC  X(10).                  02174044
021750         10  LQW-USERID              PIC  X(08).                  02175044
021760         10  LQW-DOOR-ID             PIC  X(04).                  02176044
021770         10  LQW-DOOR-ID-X REDEFINES LQW-DOOR-ID.                 02177044
021780             15  LQW-DOOR-ID-N       PIC  Z(04).                  02178044
021790         10  LQW-TYPE-CODE-DESC      PIC  X(07).                  02179044
021791         10  LQW-LOC-DESC            PIC  X(30).                  02179144
022400                                                                  02240001
022500*---------------------------------------------------------------* 02250001
022600* SELECTION QUEUE LAYOUT                                        * 02260001
022700*---------------------------------------------------------------* 02270001
022800     COPY CNWS013.                                                02280001
022900*                                                                 02290011
023000*---------------------------------------------------------------* 02300001
023100*    MAP LAYOUT                                                 * 02310001
023200*---------------------------------------------------------------* 02320001
023300     COPY CNKM231.                                                02330010
023400*                                                                 02340001
023500 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK231O.       02350010
023600     05  FILLER                         PIC X(081).               02360044
023700     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02370041
025600         10  MR-STORE-NBRL             PIC S9(04) COMP.           02560001
025700         10  MR-STORE-NBRA             PIC  X(01).                02570001
025800         10  MR-STORE-NBRC             PIC  X(01).                02580001
025900         10  MR-STORE-NBRH             PIC  X(01).                02590001
026000         10  MR-STORE-NBR              PIC  X(04).                02600026
026100                                                                  02610001
026200         10  MR-STORE-NAMEL            PIC S9(04) COMP.           02620001
026300         10  MR-STORE-NAMEA            PIC  X(01).                02630001
026400         10  MR-STORE-NAMEC            PIC  X(01).                02640001
026500         10  MR-STORE-NAMEH            PIC  X(01).                02650001
026600         10  MR-STORE-NAME             PIC  X(10).                02660001
026700                                                                  02670001
026701         10  MR-DOOR-NBRL              PIC S9(04) COMP.           02670110
026702         10  MR-DOOR-NBRA              PIC  X(01).                02670210
026703         10  MR-DOOR-NBRC              PIC  X(01).                02670310
026704         10  MR-DOOR-NBRH              PIC  X(01).                02670410
026705         10  MR-DOOR-NBR               PIC  X(04).                02670526
026706                                                                  02670610
026707         10  MR-DOOR-TYPEL             PIC S9(04) COMP.           02670717
026708         10  MR-DOOR-TYPEA             PIC  X(01).                02670817
026709         10  MR-DOOR-TYPEC             PIC  X(01).                02670917
026710         10  MR-DOOR-TYPEH             PIC  X(01).                02671017
026720         10  MR-DOOR-TYPE              PIC  X(07).                02672026
026730                                                                  02673010
026740         10  MR-LOCATIONL              PIC S9(04) COMP.           02674010
026750         10  MR-LOCATIONA              PIC  X(01).                02675010
026760         10  MR-LOCATIONC              PIC  X(01).                02676010
026770         10  MR-LOCATIONH              PIC  X(01).                02677010
026780         10  MR-LOCATION               PIC  X(30).                02678024
026790                                                                  02679010
026800         10  MR-START-DATEL            PIC S9(04) COMP.           02680001
026900         10  MR-START-DATEA            PIC  X(01).                02690001
027000         10  MR-START-DATEC            PIC  X(01).                02700001
027100         10  MR-START-DATEH            PIC  X(01).                02710001
027200         10  MR-START-DATE             PIC  X(10).                02720001
027300                                                                  02730001
029200         10  MR-USERIDL                PIC S9(04) COMP.           02920001
029300         10  MR-USERIDA                PIC  X(01).                02930001
029400         10  MR-USERIDC                PIC  X(01).                02940001
029500         10  MR-USERIDH                PIC  X(01).                02950001
029600         10  MR-USERID                 PIC  X(08).                02960001
029700                                                                  02970001
029900                                                                  02990001
030000*---------------------------------------------------------------* 03000001
030100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03010001
030200*---------------------------------------------------------------* 03020001
030300     COPY DPWS015.                                                03030037
030400                                                                  03040001
030500*---------------------------------------------------------------* 03050001
030600*    FUNCTION KEYS COPYBOOK.                                    * 03060001
030700*---------------------------------------------------------------* 03070001
030800     COPY DPWS016.                                                03080037
030900                                                                  03090001
031000*---------------------------------------------------------------* 03100001
031100*    NUMERIC EDIT LAYOUT.                                       * 03110001
031200*---------------------------------------------------------------* 03120001
031300     COPY DPWS010I.                                               03130037
031400                                                                  03140001
031500*---------------------------------------------------------------* 03150001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03160053
031700*---------------------------------------------------------------* 03170001
031800     COPY DPWS030.                                                03180037
CICS       COPY DPWS930.                                                03181053
031900                                                                  03190001
032000*---------------------------------------------------------------* 03200001
032100*    STANDARD COMMAREA.                                         * 03210001
032200*---------------------------------------------------------------* 03220001
032300     COPY DPWS020.                                                03230036
032400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03240031
032500                                                                  03250001
032600*---------------------------------------------------------------* 03260001
032700* INTER-APPLICATION COMMAREA.                                   * 03270001
032800*   CNWS011 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03280001
032900*             SPEC SCREEN.                                      * 03290001
033000*   CNWS012 - IS THE INPUT LAYOUT WHEN COMING FROM THE OTHER    * 03300001
033100*             SCREENS.                                          * 03310001
033200*---------------------------------------------------------------* 03320001
033300         10  INTER-APPL-COMM-AREA       PIC X(200).               03330001
033400     COPY CNWS011.                                                03340035
033500     COPY CNWS012.                                                03350035
033600                                                                  03360001
033700*---------------------------------------------------------------* 03370001
033800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA                    * 03380008
033900*---------------------------------------------------------------* 03390001
034000         10  ASC-SPECIFIC-COMMAREA.                               03400001
034100             15  ASC-ACTION                   PIC  X(03).         03410001
034200             15  ASC-FUNCTION                 PIC  X(01).         03420001
034300             15  ASC-CURR-OPER-UNT-ID         PIC  9(04).         03430001
034400             15  ASC-CURR-FCLTY-ID            PIC  9(04).         03440001
034500             15  ASC-OPER-UNT-ID              PIC  9(04).         03450001
034600             15  ASC-FCLTY-ID                 PIC  9(04).         03460001
034700             15  ASC-FCLTY-NAME               PIC  X(25).         03470001
034800             15  ASC-DATE-N                   PIC  9(10).         03480029
034801             15  ASC-DATE.                                        03480129
034810                 20  ASC-CCYY                 PIC  X(04).         03481027
034820                 20  FILLER                   PIC  X(01).         03482027
034900                 20  ASC-MM                   PIC  X(02).         03490027
035000                 20  FILLER                   PIC  X(01).         03500027
035100                 20  ASC-DD                   PIC  X(02).         03510027
038300             15  ASC-BLK-SUB                PIC S9(04) COMP SYNC. 03830001
038400             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03840001
038500                                                         SYNC.    03850001
038600             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03860001
038700             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03870001
038800             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03880001
038900             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03890001
039000             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03900001
039100             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03910001
039200                                                         SYNC.    03920001
039300             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03930001
039400             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03940001
039500             15  ASC-XCNTL-TO-RESEND-SW       PIC  X(01).         03950001
039600                 88  ASC-XCNTL-TO-RESEND           VALUE 'Y'.     03960001
039700                 88  ASC-XCNTL-TO-RESEND-NO        VALUE 'N'.     03970001
039800             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03980001
039900                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03990001
040000                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04000001
040100             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         04010001
040200                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04020001
040300                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04030001
040400             15  ASC-LIST-QUEUE-NAME.                             04040001
040500                 20  ASC-LIST-TERM-ID         PIC  X(04).         04050001
040600                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04060001
040700                 20  ASC-LIST-SEQ             PIC  9(01).         04070001
040800                                                                  04080001
040900             15  ASC-START-ITEM-REQUEST.                          04090001
041000                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         04100001
041100                                                                  04110001
041200             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04120001
041300             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04130001
041400             15  ASC-CURSOR-SW                PIC  X(02).         04140001
041500                 88  ASC-NO-CURSOR                   VALUE 'Z '.  04150001
041600                 88  ASC-STORE-CSR                   VALUE 'A '.  04160008
041700*                                                                 04170001
041800             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04180001
041900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04190001
042000             15  ASC-SEL-QUEUE-NAME.                              04200001
042100                 20  ASC-SEL-TERM-ID          PIC  X(04).         04210001
042200                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  04220001
042300                 20  ASC-SEL-SEQ              PIC  9(01).         04230001
042400             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04240001
042500                                                                  04250001
042600*-----------------------------------------------------------------04260001
042700             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04270001
042800                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04280001
042900                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04290001
043000                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04300001
043100                                                                  04310001
043200                 20  ASC-ITEM-ARRAY.                              04320001
043300                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        04330032
043400                         30  ASC-LIST-ITEM-NUMBER                 04340001
043500                                                     PIC S9(09)   04350001
043600                                                     COMP-3.      04360001
043700                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04370001
043800                             88  ASC-VALID-SELECT    VALUE ' '    04380001
043900                                                           'S'    04390001
044000                                                           'B'    04400001
044100                                                           'E'.   04410001
044200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04420001
044300                             88  ASC-TEMP-SELECT     VALUE 'S'.   04430001
044400                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04440001
044500                             88  ASC-TEMP-END        VALUE 'E'.   04450001
044600                         30  ASC-SELECTED-SW         PIC  X(01).  04460001
044700                             88  ASC-NO-SELECT       VALUE ' '.   04470001
044800                             88  ASC-SELECT          VALUE 'S'.   04480001
044900                             88  ASC-BEGIN           VALUE 'B'.   04490001
045000                             88  ASC-END             VALUE 'E'.   04500001
045100                         30  ASC-STATUS              PIC  X(06).  04510038
045110                         30  ASC-STORE-NBR           PIC  Z(04).  04511046
045120                         30  ASC-STORE-NAME          PIC  X(25).  04512034
045200                         30  ASC-START-DATE          PIC  X(10).  04520038
045800                         30  ASC-USERID              PIC  X(08).  04580020
045810                         30  ASC-DOOR-ID             PIC  X(04).  04581022
045820                         30  ASC-DOOR-ID-X REDEFINES ASC-DOOR-ID. 04582022
045830                             35  ASC-DOOR-ID-N       PIC  Z(04).  04583022
045840                         30  ASC-TYPE-CODE-DESC      PIC  X(07).  04584024
045850                         30  ASC-LOC-DESC            PIC  X(30).  04585022
045900                                                                  04590001
046000*---------------------------------------------------------------* 04600001
046100*    ABEND PROCESSING COPYBOOK.                                 * 04610001
046200*---------------------------------------------------------------* 04620001
046300     COPY DPWS013.                                                04630001
046400                                                                  04640001
046500*---------------------------------------------------------------* 04650001
046600*    TCNDRTY -  DOOR TYPE TABLE                                   04660001
046700*---------------------------------------------------------------* 04670001
046800     EXEC SQL                                                     04680001
046900          INCLUDE TCNDRTY                                         04690001
047000     END-EXEC.                                                    04700001
047100                                                                  04710001
047200*---------------------------------------------------------------* 04720001
047300*    TCNDCDR -  DC DOORS TABLE                                    04730001
047400*---------------------------------------------------------------* 04740001
047500     EXEC SQL                                                     04750001
047600          INCLUDE TCNDCDR                                         04760001
047700     END-EXEC.                                                    04770001
047800                                                                  04780001
047900*---------------------------------------------------------------* 04790001
048000*    TCNDRST -  DOOR TO STORE TABLE                               04800001
048100*---------------------------------------------------------------* 04810001
048200     EXEC SQL                                                     04820001
048300          INCLUDE TCNDRST                                         04830001
048400     END-EXEC.                                                    04840001
048500                                                                  04850001
048600*---------------------------------------------------------------* 04860001
048700*    XLT_LOC - XLT00010 - LOCATION TABLE                          04870048
048800*---------------------------------------------------------------* 04880001
048900     EXEC SQL                                                     04890001
049000          INCLUDE XLT00010                                        04900050
049100     END-EXEC.                                                    04910001
049200                                                                  04920001
049300*---------------------------------------------------------------* 04930001
049400*    STORE CURSOR                                                 04940004
049500*---------------------------------------------------------------* 04950001
049600     EXEC SQL                                                     04960001
049700        DECLARE STORE-CSR CURSOR FOR                              04970004
049800           SELECT A.STR_NBR                                       04980001
049900                 ,A.DOOR_ID                                       04990004
050000                 ,DATE(A.STRT_TMST)                               05000005
050100                 ,A.CRE_USR_ID                                    05010001
050200                 ,B.LOC_10_ABBR_NM                                05020051
050210                 ,C.DOOR_LOC_DESC                                 05021004
050220                 ,D.DOOR_TYP_CDE_DESC                             05022004
050300           FROM  TCNDRST A                                        05030004
050400                ,XLT_LOC B                                        05040048
050410                ,TCNDCDR C                                        05041004
050420                ,TCNDRTY D                                        05042004
050500          WHERE  A.OPER_UNT_ID = :DK-OPER-UNT-ID                  05050004
050510            AND  A.END_TMST    =  '9999-09-09-09.09.09.999999'    05051024
050520            AND  A.OPER_UNT_ID = C.OPER_UNT_ID                    05052004
050600            AND  A.DOOR_ID     = C.DOOR_ID                        05060004
050700            AND  A.STR_NBR     = B.LOC_NBR                        05070048
050710            AND  C.DOOR_TYP_CDE = D.DOOR_TYP_CDE                  05071044
050720            AND  D.DIVERT_TYP_CDE = :PC-D                         05072047
050800        ORDER BY 1,2                                              05080005
050900                                                                  05090005
051000     END-EXEC.                                                    05100004
051100                                                                  05110004
051200*---------------------------------------------------------------* 05120004
051300*    DB2 AREA FOR COMMUNICATIONS                                * 05130004
051400*---------------------------------------------------------------* 05140004
051500     EXEC SQL                                                     05150004
051600          INCLUDE SQLCA                                           05160004
051700     END-EXEC.                                                    05170004
051800                                                                  05180004
051900***************************************************************** 05190004
052000 LINKAGE SECTION.                                                 05200004
052100                                                                  05210004
052200 01  DFHCOMMAREA.                                                 05220004
052300     05  FILLER                         OCCURS  1 TO 4072 TIMES   05230004
052400                                        DEPENDING ON EIBCALEN.    05240004
052500         10  FILLER                     PIC X.                    05250004
052600                                                                  05260004
052700                                                                  05270004
052800 PROCEDURE DIVISION.                                              05280004
052900******************************************************************05290004
053000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05300004
053100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05310004
053200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05320004
053300******************************************************************05330004
053400 0000-MAIN-MODULE.                                                05340004
053500     INITIALIZE DP030-CICS-API-FIELDS.                            05350004
053600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05360004
053700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05370004
053800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05380004
053900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05390004
054000     MOVE LENGTH OF CNK231I        TO DP030-MAP-LENGTH (1).       05400005
054100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05410004
054200     PERFORM 0001-CALL-CICS-ARCH-API.                             05420004
054300*                                                                 05430004
054400     PERFORM 1000-CONTROL-PROCESSING                              05440004
054500*                                                                 05450004
054600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05460004
054700     PERFORM 0001-CALL-CICS-ARCH-API.                             05470004
054800                                                                  05480004
054900******************************************************************05490004
055000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05500004
055100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05510004
055200******************************************************************05520004
055300 0001-CALL-CICS-ARCH-API.                                         05530004
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05540053
055500                                    DFHCOMMAREA                   05550053
055600                                    DP030-CICS-API-FIELDS         05560053
055700                                    DP020-STANDARD-COMMAREA       05570053
055800                                    CNK231I.                      05580053
055900*                                                                 05590004
056000     IF  DP030-RC-CALL-SUCCESSFUL                                 05600004
056100         CONTINUE                                                 05610004
056200     ELSE                                                         05620004
056300         SET DP013-NO-ROLLBACK                                    05630004
056400             DP013-XCTL-DISPLAY-RESTART                           05640004
056500             DP013-CICS-ABEND      TO TRUE                        05650004
056600         MOVE '0001-CALL-CICS-ARCH-API'                           05660004
056700                                   TO DP013-PARAGRAPH             05670004
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05671053
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05672053
057000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05700004
057100         PERFORM DP013-0000-PROCESS-ABEND                         05710004
057200     END-IF.                                                      05720004
057300                                                                  05730004
057400*----------------------------------------------------------------*05740004
057500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05750004
057600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05760004
057700*                                                                *05770004
057800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05780004
057900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05790004
058000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05800004
058100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05810004
058200*----------------------------------------------------------------*05820004
058300 1000-CONTROL-PROCESSING.                                         05830004
058400     EVALUATE TRUE                                                05840004
058500         WHEN DP020-NEXT-ACT-INITIAL                              05850004
058600             INITIALIZE ASC-SPECIFIC-COMMAREA                     05860004
058700             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 05870004
058800                                 ASC-SEL-TERM-ID                  05880004
058900             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   05890004
059000                                           ASC-SEL-TASK-NUMBER    05900004
059100             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               05910004
059200             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                05920004
059300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05930004
059500             PERFORM 4000-BUILD-INITIAL-PANEL                     05950004
059600                                                                  05960004
059700         WHEN DP020-NEXT-ACT-READ-MAP                             05970004
059800             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05980004
059900             PERFORM 2000-PROCESS-PANEL                           05990004
060000                                                                  06000004
060100         WHEN DP020-NEXT-ACT-RETURN                               06010004
060200             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06020004
060300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06030004
060400                                                                  06040004
060500         IF  ASC-XCNTL-TO-RESEND                                  06050004
060600             PERFORM 2050-DELETE-LIST-QUEUE                       06060004
060700             PERFORM 4000-BUILD-INITIAL-PANEL                     06070004
060800             PERFORM 3200-RESET-ATTRIBUTES                        06080004
060900             SET ASC-XCNTL-TO-RESEND-NO  TO TRUE                  06090004
061000         END-IF                                                   06100004
061100                                                                  06110004
061200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06120004
061300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06130004
061400                                                                  06140004
061500         WHEN OTHER                                               06150004
061600             SET DP013-LOGIC-ABEND TO TRUE                        06160004
061700             SET DP013-NO-ROLLBACK TO TRUE                        06170004
061800             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    06180004
061900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06190004
062000                                   TO DP013-MESSAGE-TEXT(1)       06200004
062100             PERFORM DP013-0000-PROCESS-ABEND                     06210004
062200     END-EVALUATE.                                                06220004
062300                                                                  06230004
062400*----------------------------------------------------------------*06240004
062500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06250004
062600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06260004
062700*----------------------------------------------------------------*06270004
062800 1100-PROCESS-INTER-APPL-COMM.                                    06280004
062900                                                                  06290004
063000     SET PS-COMMAREA-VALID         TO TRUE.                       06300004
063100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06310004
063200                                                                  06320004
063300     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          06330004
063400         MOVE CN011-CURR-OPER-UNT-ID   TO ASC-CURR-OPER-UNT-ID    06340004
063500         MOVE CN011-CURR-FCLTY-ID      TO ASC-CURR-FCLTY-ID       06350004
063600         MOVE CN011-OPER-UNT-ID        TO ASC-OPER-UNT-ID         06360004
063700         MOVE CN011-FCLTY-ID           TO ASC-FCLTY-ID            06370004
063800         MOVE CN011-FCLTY-NME          TO ASC-FCLTY-NAME          06380004
064300         MOVE PC-INQ                   TO ASC-ACTION              06430004
064400     ELSE                                                         06440004
064500         SET ASC-USE-SELECTION-QUEUE TO TRUE                      06450004
064600         MOVE CN012-NUMBER-OF-SELECTED-ITEMS TO                   06460004
064700                                      ASC-NUMBER-OF-SELECTED-ITEMS06470004
064800         MOVE CN012-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  06480004
064900         MOVE CN012-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME      06490004
065000         MOVE CN012-CURR-OPER-UNT-ID   TO ASC-CURR-OPER-UNT-ID    06500004
065100         MOVE CN012-CURR-FCLTY-ID      TO ASC-CURR-FCLTY-ID       06510004
065200         MOVE CN012-OPER-UNT-ID        TO ASC-OPER-UNT-ID         06520004
065300         MOVE CN012-FCLTY-ID           TO ASC-FCLTY-ID            06530004
065400         MOVE CN012-FUNCTION           TO ASC-FUNCTION            06540004
065500         PERFORM 1120-PREPARE-LIST-ENTRY                          06550004
065600     END-IF.                                                      06560004
065700                                                                  06570004
065800*-----------------------------------------------------------------06580004
065900*  PREPARE LIST ENTRY                                             06590004
066000*-----------------------------------------------------------------06600004
066100 1120-PREPARE-LIST-ENTRY.                                         06610004
066200                                                                  06620004
066300     MOVE CN013-MAX-ITEMS          TO ASC-SEL-SUB.                06630004
066400     MOVE ZERO                     TO ASC-SEL-ITEM.               06640004
066500     PERFORM 1130-GET-NEXT-RECORD.                                06650004
066600                                                                  06660004
066700*-----------------------------------------------------------------06670004
066800*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*06680004
066900*-----------------------------------------------------------------06690004
067000 1130-GET-NEXT-RECORD.                                            06700004
067100     ADD +1                       TO ASC-SEL-SUB.                 06710004
067200                                                                  06720004
067300     IF  ASC-SEL-SUB > CN013-MAX-ITEMS                            06730004
067400         ADD +1                   TO ASC-SEL-ITEM                 06740004
067500         MOVE +1                  TO ASC-SEL-SUB                  06750004
067600     END-IF.                                                      06760004
067700                                                                  06770004
067800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06780004
067900         PERFORM 9100-READ-SEL-QUEUE                              06790004
068000         IF  CN013-ITEM (ASC-SEL-SUB) > ZERO                      06800004
068100             MOVE CN013-ACTION-SW (ASC-SEL-SUB)  TO ASC-ACTION    06810004
069100             SET CN013-INQ (ASC-SEL-SUB) TO TRUE                  06910004
069200             PERFORM 9200-REWRITE-SEL-QUEUE                       06920004
069300         ELSE                                                     06930004
069400             SUBTRACT +1 FROM ASC-SEL-SUB                         06940004
069500             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06950004
069600             SET DP020-MSG-INFORMATIONAL                          06960004
069700                 PS-LIST-END             TO TRUE                  06970004
069800         END-IF                                                   06980004
069900     ELSE                                                         06990004
070000         SUBTRACT +1 FROM ASC-SEL-ITEM                            07000004
070100         MOVE CN013-MAX-ITEMS     TO ASC-SEL-SUB                  07010004
070200         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07020004
070300         SET DP020-MSG-INFORMATIONAL                              07030004
070400             PS-LIST-END             TO TRUE                      07040004
070500     END-IF.                                                      07050004
070600                                                                  07060004
070700*----------------------------------------------------------------*07070004
070800*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07080004
070900*    PROCESSED.                                                  *07090004
071000*----------------------------------------------------------------*07100004
071100 1140-GET-PREV-RECORD.                                            07110004
071200     SUBTRACT +1 FROM ASC-SEL-SUB.                                07120004
071300                                                                  07130004
071400     IF  ASC-SEL-SUB < +1                                         07140004
071500         SUBTRACT +1 FROM ASC-SEL-ITEM                            07150004
071600         MOVE CN013-MAX-ITEMS     TO ASC-SEL-SUB                  07160004
071700     END-IF.                                                      07170004
071800                                                                  07180004
071900     IF  ASC-SEL-ITEM > ZERO                                      07190004
072000         PERFORM 9100-READ-SEL-QUEUE                              07200004
072100         MOVE CN013-ACTION-SW (ASC-SEL-SUB)  TO ASC-ACTION        07210004
072800         SET CN013-INQ (ASC-SEL-SUB) TO TRUE                      07280004
072900         PERFORM 9200-REWRITE-SEL-QUEUE                           07290004
073000     ELSE                                                         07300004
073100         MOVE +1                  TO ASC-SEL-ITEM                 07310004
073200                                     ASC-SEL-SUB                  07320004
073300         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             07330004
073400         SET DP020-MSG-INFORMATIONAL                              07340004
073500             PS-LIST-END             TO TRUE                      07350004
073600     END-IF.                                                      07360004
073700                                                                  07370004
073800*----------------------------------------------------------------*07380004
073900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07390004
074000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07400004
074100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07410004
074200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07420004
074300* FUNCTION KEYS CAN GET THIS FAR.                                *07430004
074400*----------------------------------------------------------------*07440004
074500 2000-PROCESS-PANEL.                                              07450004
074600     EVALUATE TRUE                                                07460004
074700         WHEN DP020-SRC-AID = DP016-CLEAR                         07470004
074800             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                07480004
074900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07490004
075000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07500004
075100                                                                  07510004
075200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07520004
075300             PERFORM 2050-DELETE-LIST-QUEUE                       07530004
075400             PERFORM 4000-BUILD-INITIAL-PANEL                     07540004
075500                                                                  07550004
075600*F20-NEXT SEL                                                     07560004
075700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07570004
075800             IF  ASC-USE-SELECTION-QUEUE                          07580004
075900                 PERFORM 1130-GET-NEXT-RECORD                     07590004
076000                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07600004
076100                 IF PS-LIST-END                                   07610004
076200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07620004
076300                     SET PS-NO-LIST-END TO TRUE                   07630004
076400                 ELSE                                             07640004
076500                     PERFORM 2050-DELETE-LIST-QUEUE               07650004
076600                     PERFORM 4000-BUILD-INITIAL-PANEL             07660004
076700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07670004
076800                     PERFORM 3200-RESET-ATTRIBUTES                07680004
076900                 END-IF                                           07690004
077000             ELSE                                                 07700004
077100*                --- BOTTOM OF LIST ---                           07710004
077200                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07720004
077300                 SET DP020-MSG-INFORMATIONAL TO TRUE              07730004
077400             END-IF                                               07740004
077500                                                                  07750004
077600*F19-PREV SEL                                                     07760004
077700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07770004
077800             IF  ASC-USE-SELECTION-QUEUE                          07780004
077900                 PERFORM 1140-GET-PREV-RECORD                     07790004
078000                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07800004
078100                 IF PS-LIST-END                                   07810004
078200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07820004
078300                     SET PS-NO-LIST-END TO TRUE                   07830004
078400                 ELSE                                             07840004
078500                     PERFORM 2050-DELETE-LIST-QUEUE               07850004
078600                     PERFORM 4000-BUILD-INITIAL-PANEL             07860004
078700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07870004
078800                     PERFORM 3200-RESET-ATTRIBUTES                07880004
078900                 END-IF                                           07890004
079000             ELSE                                                 07900004
079100                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         07910004
079200                 SET DP020-MSG-INFORMATIONAL TO TRUE              07920004
079300             END-IF                                               07930004
079400                                                                  07940004
079500         WHEN OTHER                                               07950004
079600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07960004
079700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07970004
079800             IF  PS-NO-ERROR                                      07980004
079900                 SET DP030-CONTINUE-GO TO TRUE                    07990004
080000                 PERFORM 2100-CHECK-FUNCTION-KEY                  08000004
080100             ELSE                                                 08010004
080200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08020004
080300                 SET DP030-OVERRIDE-GO TO TRUE                    08030004
080400             END-IF                                               08040004
080500     END-EVALUATE.                                                08050004
080600                                                                  08060004
080700*----------------------------------------------------------------*08070004
080800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08080004
080900*----------------------------------------------------------------*08090004
081000 2050-DELETE-LIST-QUEUE.                                          08100004
081100                                                                  08110004
081200     EXEC CICS                                                    08120004
081300         DELETEQ TS                                               08130004
081400             QUEUE (ASC-LIST-QUEUE-NAME)                          08140004
081500             RESP  (PV-CICS-RESP)                                 08150004
081600     END-EXEC.                                                    08160004
081700                                                                  08170004
081800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08180004
081900        (PV-CICS-RESP = DFHRESP(QIDERR))                          08190004
082000         CONTINUE                                                 08200004
082100     ELSE                                                         08210004
082200         SET DP013-CICS-ABEND      TO TRUE                        08220004
082300         SET DP013-NO-ROLLBACK     TO TRUE                        08230004
082400                                                                  08240004
082500         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         08250004
082600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08260004
082700                                   TO DP013-MESSAGE-TEXT (1)      08270004
082800         PERFORM DP013-0000-PROCESS-ABEND                         08280004
082900     END-IF.                                                      08290004
083000                                                                  08300004
083100     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       08310004
083200                                                                  08320004
083300*----------------------------------------------------------------*08330004
083400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08340004
083500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08350004
083600* CICS ARCHITECTURE API.                                         *08360004
083700*----------------------------------------------------------------*08370004
083800 2100-CHECK-FUNCTION-KEY.                                         08380004
083900                                                                  08390004
084000     EVALUATE TRUE                                                08400004
084100                                                                  08410004
084200* F6 - FIRST PAGE                                                 08420004
084300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08430004
084400             MOVE +1               TO PV-TOP-ITEM                 08440004
084500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08450004
084600                                                                  08460004
084700* F7 - PREVIOUS PAGE                                              08470004
084800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08480004
084900             PERFORM 2110-BROWSE-BACKWARD                         08490004
085000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08500004
085100                                                                  08510004
085200* F8 - NEXT PAGE                                                  08520004
085300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08530004
085400             PERFORM 2120-BROWSE-FORWARD                          08540004
085500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08550004
085600                                                                  08560004
085700* ENTER KEY                                                       08570004
085800         WHEN DP020-SRC-AID = DP016-ENTER                         08580004
085900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08590004
086000             IF  PS-ERROR                                         08600004
086100                 CONTINUE                                         08610004
086200             ELSE                                                 08620004
086300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08630004
086400             END-IF                                               08640004
086500                                                                  08650004
086600         WHEN OTHER                                               08660004
086700             SET DP013-NO-ROLLBACK                                08670004
086800                 DP013-XCTL-DISPLAY-RESTART                       08680004
086900                 DP013-CICS-ABEND  TO TRUE                        08690004
087000             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    08700004
087100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08710004
087200                                   TO DP013-MESSAGE-TEXT (1)      08720004
087300             PERFORM DP013-0000-PROCESS-ABEND                     08730004
087400     END-EVALUATE.                                                08740004
087500                                                                  08750004
087600*----------------------------------------------------------------*08760004
087700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08770004
087800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08780004
087900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08790004
088000*    MESSAGE.                                                    *08800004
088100*----------------------------------------------------------------*08810004
088200 2110-BROWSE-BACKWARD.                                            08820004
088300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08830004
088400         GIVING PV-TOP-ITEM.                                      08840004
088500*                                                                 08850004
088600     IF  ((PV-TOP-ITEM < +1)                                      08860004
088700       OR (PV-TOP-ITEM = +1))                                     08870004
088800         MOVE +1                   TO PV-TOP-ITEM                 08880004
088900*        -- TOP OF LIST --                                        08890004
089000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08900004
089100         SET DP020-MSG-INFORMATIONAL TO TRUE                      08910004
089200     END-IF.                                                      08920004
089300                                                                  08930004
089400*----------------------------------------------------------------*08940004
089500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08950004
089600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08960004
089700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08970004
089800*----------------------------------------------------------------*08980004
089900 2120-BROWSE-FORWARD.                                             08990004
090000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09000004
090100         GIVING PV-TOP-ITEM.                                      09010004
090200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09020004
090300         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             09030004
090400*        -- BOTTOM OF LIST --                                     09040004
090500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09050004
090600         SET DP020-MSG-INFORMATIONAL TO TRUE                      09060004
090700     ELSE                                                         09070004
090800         COMPUTE PV-BOTTOM-ITEM =                                 09080004
090900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09090004
091000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09100004
091100*            -- BOTTOM OF LIST --                                 09110004
091200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09120004
091300             SET DP020-MSG-INFORMATIONAL TO TRUE                  09130004
091400         END-IF                                                   09140004
091500     END-IF.                                                      09150004
091600                                                                  09160004
091700*----------------------------------------------------------------*09170004
091800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09180004
091900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09190004
092000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09200004
092100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09210004
092200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09220004
092300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09230004
092400*----------------------------------------------------------------*09240004
092500 2130-CHECK-FOR-JUMP-BROWSE.                                      09250004
092600     SET PS-NO-ERROR               TO TRUE.                       09260004
092700     IF (ASC-START-ITEM-REQUEST = SPACE)                          09270004
092800         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             09280004
092900     ELSE                                                         09290004
093000         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     09300004
093100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09310004
093200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09320004
093300         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09330004
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09341052
263455              USING DP010I-NUMERIC-EDIT-AREA                      09342052
093500                                                                  09350004
093600         IF  NOT DP010I-ERROR-DETECTED                            09360004
093700             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N09370004
093800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09380004
093900                 IF  ASC-START-ITEM-REQUEST-N >                   09390004
094000                                          ASC-NUMBER-OF-ITEMS-READ09400004
094100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09410004
094200                     COMPUTE PV-TOP-ITEM =                        09420004
094300                             ASC-NUMBER-OF-ITEMS-READ             09430004
094400                             - PC-ITEMS-PER-PANEL + 1             09440004
094500                     IF  PV-TOP-ITEM < +1                         09450004
094600                         MOVE +1   TO PV-TOP-ITEM                 09460004
094700                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 09470004
094800                         SET DP020-MSG-INFORMATIONAL TO TRUE      09480004
094900                     END-IF                                       09490004
095000                 ELSE                                             09500004
095100                     MOVE ASC-START-ITEM-REQUEST-N                09510004
095200                                   TO PV-TOP-ITEM                 09520004
095300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09530004
095400                     COMPUTE PV-BOTTOM-ITEM =                     09540004
095500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09550004
095600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09560004
095700*                        -- BOTTOM OF LIST --                     09570004
095800                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 09580004
095900                         SET DP020-MSG-INFORMATIONAL TO TRUE      09590004
096000                     END-IF                                       09600004
096100                 END-IF                                           09610004
096200             ELSE                                                 09620004
096300*                --- VALUE OUT OF RANGE ----                      09630004
096400                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         09640004
096500                 MOVE -1              TO ASTRTITL                 09650004
096600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09660004
096700                 MOVE DP015-REVERSE   TO ASTRTITH                 09670004
096800                 MOVE DP015-RED       TO ASTRTITC                 09680004
096900                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           09690004
097000                 SET DP020-MSG-FATAL  TO TRUE                     09700004
097100                 SET PS-ERROR         TO TRUE                     09710004
097200             END-IF                                               09720004
097300         ELSE                                                     09730004
097400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09740004
097500             MOVE -1               TO ASTRTITL                    09750004
097600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09760004
097700             MOVE DP015-REVERSE    TO ASTRTITH                    09770004
097800             MOVE DP015-RED        TO ASTRTITC                    09780004
097900             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               09790004
098000             SET DP020-MSG-FATAL   TO TRUE                        09800004
098100             SET PS-ERROR          TO TRUE                        09810004
098200         END-IF                                                   09820004
098300     END-IF.                                                      09830004
098400                                                                  09840004
098500******************************************************************09850004
098600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09860004
098700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09870004
098800******************************************************************09880004
098900 2200-MOVE-SCREEN-TO-COMMAREA.                                    09890004
099000                                                                  09900004
099100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09910004
099200     MOVE +1                       TO PV-SUB.                     09920004
099300*                                                                 09930004
099400     PERFORM 3100-SET-SUBSCRIPTS.                                 09940004
099500                                                                  09950004
099600     IF  ASTRTITL > ZERO                                          09960004
099700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09970004
099800     ELSE                                                         09980004
099900         IF  ASTRTITF = DP015-ERASE-EOF                           09990004
100000             INITIALIZE ASC-START-ITEM-REQUEST                    10000004
100100         END-IF                                                   10010004
100200     END-IF.                                                      10020004
100300                                                                  10030004
100400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10040004
100500         VARYING PV-SUB FROM 1 BY 1                               10050004
100600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10060004
100700                                                                  10070004
100800******************************************************************10080004
100900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10090004
101000******************************************************************10100004
101100 2210-MOVE-LINES-TO-COMMAREA.                                     10110004
101200*    IF  MR-SELECTL (PV-SUB) > ZERO                               10120044
101300*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10130044
101400*        MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        10140044
101500*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      10150044
101600*    ELSE                                                         10160044
101700*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10170044
101800*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10180044
101900*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10190044
102000*                                     (ASC-BLK-SUB, ASC-ITEM-SUB) 10200044
102100*        END-IF                                                   10210044
102200*    END-IF.                                                      10220044
102300*                                                                 10230044
102400*    MOVE CN013-ACTION-SW (PV-SUB)    TO ASC-ACTION.              10240042
103100                                                                  10310004
103200     ADD +1                        TO ASC-ITEM-SUB.               10320042
103300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10330042
103400         ADD +1                    TO ASC-BLK-SUB                 10340042
103500         MOVE +1                   TO ASC-ITEM-SUB                10350042
103600     END-IF.                                                      10360042
103700*                                                                 10370004
103800******************************************************************10380004
103900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10390004
104000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10400004
104100******************************************************************10410004
104200 3000-EDIT-DATA-IN-COMMAREA.                                      10420004
104300     SET PS-NO-ERROR               TO TRUE.                       10430004
104400     PERFORM 3200-RESET-ATTRIBUTES.                               10440004
104500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10450004
104600                                                                  10460004
104700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10470004
104800* EDITTING IS DONE FROM THE BOTTOM UP.                            10480004
104900**                                                                10490004
105000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10500004
105100         ASC-ITEMS-DISPLAYED - 1.                                 10510004
105200     PERFORM 3100-SET-SUBSCRIPTS.                                 10520004
105300                                                                  10530004
105400      IF  PS-NO-ERROR                                             10540004
105500          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       10550004
105600      END-IF.                                                     10560004
105700                                                                  10570004
105800     IF  PS-NO-ERROR                                              10580004
105900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10590004
106000     END-IF.                                                      10600004
106100                                                                  10610004
106200     IF  ((PS-NO-ERROR)                                           10620004
106300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10630004
106400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10640004
106500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10650004
106600     END-IF.                                                      10660004
106700                                                                  10670004
106800*----------------------------------------------------------------*10680004
106900* 3005-EDIT-COMMAREA-BLOCKS                                      *10690004
107000*----------------------------------------------------------------*10700004
107100 3005-EDIT-COMMAREA-BLOCKS.                                       10710004
107200     MOVE +1                       TO PV-BLOCK-NUMBER.            10720004
107300     MOVE +1                       TO ASC-BLK-SUB.                10730004
107400     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               10740004
107500                                                                  10750004
107600     COMPUTE PV-BLOCK-NUMBER  =                                   10760004
107700             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            10770004
107800             PC-ITEMS-PER-PANEL.                                  10780004
107900                                                                  10790004
108000     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          10800004
108100                                                                  10810004
108200     PERFORM                                                      10820004
108300        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         10830004
108400           OR PS-ERROR                                            10840004
108500           OR PS-BLOCK-ERROR                                      10850004
108600                                                                  10860004
108700              COMPUTE PV-ITEMS-HOLD  =                            10870004
108800                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       10880004
108900                      PC-ITEMS-PER-PANEL - 1                      10890004
109000                                                                  10900004
109100               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     10910004
109200                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             10920004
109300                       FROM  PV-ITEMS-HOLD                        10930004
109400                     GIVING  PV-ITEMS-DIFF                        10940004
109500                   SUBTRACT  PV-ITEMS-DIFF                        10950004
109600                       FROM  PC-ITEMS-PER-PANEL                   10960004
109700                     GIVING  PV-ITEMS-HOLD                        10970004
109800                       MOVE  PV-ITEMS-HOLD TO PV-SUB              10980004
109900                                              ASC-ITEM-SUB        10990004
110000                                              ASC-ITEMS-DISPLAYED 11000004
110100                                                                  11010004
110200               ELSE                                               11020004
110300                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            11030004
110400                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      11040004
110500               END-IF                                             11050004
110600                                                                  11060004
110700               MOVE +1               TO ASC-BLK-SUB               11070004
110800                                                                  11080004
110900               PERFORM 5105-REWRITE-ASC-LISTQ                     11090004
111000                                                                  11100004
111100               MOVE +1                TO ASC-BLK-SUB              11110004
111200                                                                  11120004
111300               IF  PS-BLOCK-ERROR                                 11130004
111400                   SET  PS-ERROR     TO TRUE                      11140004
111500                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      11150004
111600                                     TO PV-TOP-ITEM               11160004
111700               ELSE                                               11170004
111800                   ADD  +1           TO PV-BLOCK-NUMBER           11180004
111900                   IF  PV-BLOCK-NUMBER >                          11190004
112000                       ASC-HIGHEST-BLOCK-WRITTEN                  11200004
112100                       MOVE +2       TO ASC-BLK-SUB               11210004
112200                       PERFORM 4410-READ-TEMP-STORAGE             11220004
112300                       MOVE +1       TO ASC-BLK-SUB               11230004
112400                   ELSE                                           11240004
112500                       PERFORM 4410-READ-TEMP-STORAGE             11250004
112600                       ADD  +1        TO PV-BLOCK-NUMBER          11260004
112700                       MOVE +2        TO ASC-BLK-SUB              11270004
112800                       PERFORM 4410-READ-TEMP-STORAGE             11280004
112900                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          11290004
113000                       MOVE +1        TO ASC-BLK-SUB              11300004
113100               END-IF                                             11310004
113200           END-IF                                                 11320004
113300     END-PERFORM.                                                 11330004
113400                                                                  11340004
113500     IF  PV-ORIGINAL-BLOCK  = +1    OR                            11350004
113600         PS-ERROR                   OR                            11360004
113700         PS-BLOCK-ERROR                                           11370004
113800             CONTINUE                                             11380004
113900     ELSE                                                         11390004
114000         MOVE +1                 TO PV-BLOCK-NUMBER               11400004
114100         MOVE +1                 TO ASC-BLK-SUB                   11410004
114200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  11420004
114300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           11430004
114400         PERFORM 4410-READ-TEMP-STORAGE                           11440004
114500                                                                  11450004
114600         PERFORM                                                  11460004
114700            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             11470004
114800               OR PS-ERROR                                        11480004
114900               OR PS-BLOCK-ERROR                                  11490004
115000                                                                  11500004
115100                  COMPUTE PV-ITEMS-HOLD  =                        11510004
115200                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   11520004
115300                          PC-ITEMS-PER-PANEL - 1                  11530004
115400                                                                  11540004
115500                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    11550004
115600                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          11560004
115700                          FROM  PV-ITEMS-HOLD                     11570004
115800                        GIVING  PV-ITEMS-DIFF                     11580004
115900                      SUBTRACT  PV-ITEMS-DIFF                     11590004
116000                          FROM  PC-ITEMS-PER-PANEL                11600004
116100                        GIVING  PV-ITEMS-HOLD                     11610004
116200                          MOVE  PV-ITEMS-HOLD TO PV-SUB           11620004
116300                                                 ASC-ITEM-SUB     11630004
116400                                              ASC-ITEMS-DISPLAYED 11640004
116500                  ELSE                                            11650004
116600                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         11660004
116700                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   11670004
116800                  END-IF                                          11680004
116900                                                                  11690004
117000                  MOVE +1               TO ASC-BLK-SUB            11700004
117100                                                                  11710004
117200                  PERFORM 5105-REWRITE-ASC-LISTQ                  11720004
117300                                                                  11730004
117400                  MOVE +1                TO ASC-BLK-SUB           11740004
117500                                                                  11750004
117600                  IF  PS-BLOCK-ERROR                              11760004
117700                      SET  PS-ERROR     TO TRUE                   11770004
117800                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   11780004
117900                                        TO PV-TOP-ITEM            11790004
118000                  ELSE                                            11800004
118100                      ADD  +1            TO PV-BLOCK-NUMBER       11810004
118200                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     11820004
118300                          MOVE +2        TO ASC-BLK-SUB           11830004
118400                          PERFORM 4410-READ-TEMP-STORAGE          11840004
118500                          MOVE +1        TO ASC-BLK-SUB           11850004
118600                      ELSE                                        11860004
118700                          PERFORM 4410-READ-TEMP-STORAGE          11870004
118800                          ADD  +1        TO PV-BLOCK-NUMBER       11880004
118900                          MOVE +2        TO ASC-BLK-SUB           11890004
119000                          PERFORM 4410-READ-TEMP-STORAGE          11900004
119100                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       11910004
119200                          MOVE +1        TO ASC-BLK-SUB           11920004
119300                      END-IF                                      11930004
119400                  END-IF                                          11940004
119500     END-PERFORM.                                                 11950004
119600                                                                  11960004
122900*----------------------------------------------------------------*12290004
123000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12300004
123100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12310004
123200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12320004
123300*                                                                *12330004
123400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12340004
123500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12350004
123600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12360004
123700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12370004
123800*----------------------------------------------------------------*12380004
123900 3100-SET-SUBSCRIPTS.                                             12390004
124000     COMPUTE ASC-ITEM-SUB =                                       12400004
124100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12410004
124200                                                                  12420004
124300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12430004
124400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12440004
124500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12450004
124600     ELSE                                                         12460004
124700         MOVE +1                     TO ASC-BLK-SUB               12470004
124800     END-IF.                                                      12480004
124900                                                                  12490004
125000******************************************************************12500004
125100** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12510004
125200******************************************************************12520004
125300 3200-RESET-ATTRIBUTES.                                           12530004
125400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12540004
125500     MOVE DP015-GREEN              TO ASTRTITC.                   12550004
125600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12560004
125700                                                                  12570004
125800     PERFORM                                                      12580004
125900         VARYING PV-SUB                                           12590004
126000         FROM 1 BY 1                                              12600004
126100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12610004
126300         MOVE DP015-PRO-NOR-OFF    TO MR-STORE-NBRA (PV-SUB)      12630012
126400                                      MR-STORE-NAMEA (PV-SUB)     12640004
126410                                      MR-DOOR-NBRA   (PV-SUB)     12641012
126420                                      MR-DOOR-TYPEA   (PV-SUB)    12642012
126430                                      MR-LOCATIONA   (PV-SUB)     12643012
126500                                      MR-START-DATEA (PV-SUB)     12650004
126900                                      MR-USERIDA     (PV-SUB)     12690004
127100         MOVE DP015-BLUE           TO MR-STORE-NBRC  (PV-SUB)     12710012
127200                                      MR-STORE-NAMEC (PV-SUB)     12720004
127210                                      MR-DOOR-NBRC   (PV-SUB)     12721012
127220                                      MR-DOOR-TYPEC   (PV-SUB)    12722012
127300                                      MR-LOCATIONC   (PV-SUB)     12730012
127400                                      MR-START-DATEC (PV-SUB)     12740012
127700                                      MR-USERIDC     (PV-SUB)     12770004
127800     END-PERFORM.                                                 12780004
127900                                                                  12790004
128000******************************************************************12800004
128100** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12810004
128200** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12820004
128300** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12830004
128400** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12840004
128500******************************************************************12850004
128600 3300-EDIT-SELECTIONS.                                            12860004
128700     EVALUATE TRUE                                                12870004
128800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12880004
128900             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12890004
129000                 CONTINUE                                         12900004
129100         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12910004
129200             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12920004
129300                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12930004
129400                 MOVE ASC-TEMP-SELECTED-SW                        12940004
129500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12950004
129600                                TO ASC-SELECTED-SW                12960004
129700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12970004
129800             END-IF                                               12980004
129900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12990004
130000                 = SPACE                                          13000004
130100             EVALUATE TRUE                                        13010004
130200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13020004
130300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13030004
130400                     MOVE SPACE TO ASC-SELECTED-SW                13040004
130500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13050004
130600                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13060004
130700                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13070004
130800                     MOVE SPACE TO ASC-SELECTED-SW                13080004
130900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13090004
131000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13100004
131100                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13110004
131200                     MOVE SPACE TO ASC-SELECTED-SW                13120004
131300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13130004
131400             END-EVALUATE                                         13140004
131500         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13150004
131600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13160004
131700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13170004
131800             END-IF                                               13180004
131900             PERFORM 3310-EDIT-RANGE                              13190004
132000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13200004
132100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13210004
132200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13220004
132300             END-IF                                               13230004
132400             PERFORM 3310-EDIT-RANGE                              13240004
132500         WHEN OTHER                                               13250004
132600             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13260004
132700             SET DP020-MSG-FATAL    TO TRUE                       13270004
132800             MOVE -1                TO ASTRTITL                   13280004
132900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13290004
133000*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13300004
133100*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13310004
133200             SET PS-ERROR TO TRUE                                 13320004
133300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13330004
133400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13340004
133500                 MOVE SPACE         TO ASC-SELECTED-SW            13350004
133600                                        (ASC-BLK-SUB ASC-ITEM-SUB)13360004
133700             END-IF                                               13370004
133800     END-EVALUATE.                                                13380004
133900                                                                  13390004
134000     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13400004
134100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13410004
134200     IF  ASC-ITEM-SUB < 1                                         13420004
134300         SUBTRACT +1 FROM ASC-BLK-SUB                             13430004
134400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13440004
134500     END-IF.                                                      13450004
134600                                                                  13460004
134700******************************************************************13470004
134800** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13480004
134900** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13490004
135000** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13500004
135100** THE ENDING.                                                  **13510004
135200******************************************************************13520004
135300 3310-EDIT-RANGE.                                                 13530004
135400     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13540004
135500         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13550004
135600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13560004
135700                                   TO ASC-SELECTED-SW             13570004
135800                                        (ASC-BLK-SUB ASC-ITEM-SUB)13580004
135900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13590004
136000         ELSE                                                     13600004
136100             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13610004
136200                 CONTINUE                                         13620004
136300             ELSE                                                 13630004
136400*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13640004
136500                 MOVE PC-TSYMSG-00054                             13650004
136600                                   TO DP020-MSG-NUMBER            13660004
136700                 SET DP020-MSG-FATAL                              13670004
136800                                   TO TRUE                        13680004
136900*                MOVE -1           TO MR-SELECTL (PV-SUB)         13690044
137000                 MOVE -1           TO ASTRTITL                    13700004
137100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              13710004
137200*                MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13720044
137300*                MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      13730044
137400                 SET PS-ERROR      TO TRUE                        13740004
137500             END-IF                                               13750004
137600         END-IF                                                   13760004
137700     ELSE                                                         13770004
137800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13780004
137900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13790004
138000                                   TO ASC-SELECTED-SW             13800004
138100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13810004
138200             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13820004
138300         ELSE                                                     13830004
138400             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13840004
138500                 CONTINUE                                         13850004
138600             ELSE                                                 13860004
138700*                -- ONLY ONE END-OF-RANGE ALLOWED --              13870004
138800                 MOVE PC-TSYMSG-00055                             13880004
138900                                   TO DP020-MSG-NUMBER            13890004
139000                 SET DP020-MSG-FATAL                              13900004
139100                                   TO TRUE                        13910004
139200*                MOVE -1           TO MR-SELECTL (PV-SUB)         13920004
139300                 MOVE -1           TO ASTRTITL                    13930004
139400                 SET DP030-SET-CURSOR-APPL-1                      13940004
139500                                   TO TRUE                        13950004
139600                 SET PS-ERROR      TO TRUE                        13960004
139700             END-IF                                               13970004
139800         END-IF                                                   13980004
139900     END-IF.                                                      13990004
140000*                                                                 14000004
140100******************************************************************14010004
140200** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14020004
140300** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14030004
140400******************************************************************14040004
140500 3400-CHECK-RANGE-SEQUENCE.                                       14050004
140600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14060004
140700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14070004
140800       AND  ASC-START-OF-SELECTED-RANGE >                         14080004
140900                                         ASC-END-OF-SELECTED-RANGE14090004
141000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14100004
141100         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14110004
141200         SET DP020-MSG-FATAL TO TRUE                              14120004
141300         SET PS-ERROR TO TRUE                                     14130004
141400     END-IF.                                                      14140004
141500                                                                  14150004
141600******************************************************************14160004
141700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14170004
141800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14180004
141900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14190004
142000******************************************************************14200004
142100 3410-POSITION-AT-ERROR.                                          14210004
142200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14220004
142300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14230004
142400                    - PV-TOP-ITEM + 1.                            14240004
142500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14250004
142600         CONTINUE                                                 14260004
142700*    ELSE                                                         14270044
142800*        MOVE -1                   TO MR-SELECTL (PV-SUB)         14280044
142900*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14290044
143000*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14300044
143100     END-IF.                                                      14310004
143200                                                                  14320004
143300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14330004
143400                    - PV-TOP-ITEM + 1.                            14340004
143500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14350004
143600         CONTINUE                                                 14360004
143700*    ELSE                                                         14370044
143800*        MOVE -1                   TO MR-SELECTL (PV-SUB)         14380044
143900*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14390044
144000*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14400044
144100     END-IF.                                                      14410004
144200                                                                  14420004
144300*----------------------------------------------------------------*14430004
144400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14440004
144500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14450004
144600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14460004
144700*----------------------------------------------------------------*14470004
144800 3500-MARK-RANGE-AS-SELECTED.                                     14480004
144900     MOVE +1                       TO  ASC-BLK-SUB.               14490004
145000     PERFORM 3510-MARK-SELECTED-INDS                              14500004
145100         VARYING ASC-ITEM-SUB                                     14510004
145200         FROM 1 BY 1                                              14520004
145300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14530004
145400                                                                  14540004
145500     ADD +1                        TO ASC-BLK-SUB.                14550004
145600     PERFORM 3510-MARK-SELECTED-INDS                              14560004
145700         VARYING ASC-ITEM-SUB                                     14570004
145800         FROM 1 BY 1                                              14580004
145900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14590004
146000                                                                  14600004
146100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14610004
146200                                   TO  PV-LIST-ITEM-NUMBER.       14620004
146300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14630004
146400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14640004
146500               PC-ITEMS-PER-PANEL).                               14650004
146600                                                                  14660004
146700     MOVE ASC-START-OF-SELECTED-RANGE                             14670004
146800                                   TO PV-START-OF-SELECTED-RANGE. 14680004
146900     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14690004
147000         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14700004
147100               PC-ITEMS-PER-PANEL).                               14710004
147200                                                                  14720004
147300     MOVE ASC-END-OF-SELECTED-RANGE                               14730004
147400                                   TO  PV-END-OF-SELECTED-RANGE.  14740004
147500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14750004
147600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14760004
147700               PC-ITEMS-PER-PANEL).                               14770004
147800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14780004
147900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14790004
148000                                                                  14800004
148100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14810004
148200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14820004
148300         MOVE +1                   TO ASC-BLK-SUB                 14830004
148400         PERFORM 5100-WRITE-TEMP-STORAGE                          14840004
148500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14850004
148600             PV-FIRST-BLOCK-IN-ARRAY - 1                          14860004
148700                                                                  14870004
148800         PERFORM                                                  14880004
148900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14890004
149000                   PV-PREV-BLOCK-IN-ARRAY                         14900004
149100             MOVE PV-FIRST-BLOCK-IN-RANGE                         14910004
149200                                   TO PV-BLOCK-NUMBER             14920004
149300             PERFORM 4410-READ-TEMP-STORAGE                       14930004
149400             PERFORM 3510-MARK-SELECTED-INDS                      14940004
149500                 VARYING ASC-ITEM-SUB                             14950004
149600                 FROM 1 BY 1                                      14960004
149700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14970004
149800             PERFORM 5100-WRITE-TEMP-STORAGE                      14980004
149900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14990004
150000         END-PERFORM                                              15000004
150100                                                                  15010004
150200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15020004
150300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15030004
150400         PERFORM                                                  15040004
150500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15050004
150600                   PV-LAST-BLOCK-IN-RANGE                         15060004
150700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15070004
150800                                   TO PV-BLOCK-NUMBER             15080004
150900             PERFORM 4410-READ-TEMP-STORAGE                       15090004
151000             PERFORM 3510-MARK-SELECTED-INDS                      15100004
151100                 VARYING ASC-ITEM-SUB                             15110004
151200                 FROM 1 BY 1                                      15120004
151300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15130004
151400             PERFORM 5100-WRITE-TEMP-STORAGE                      15140004
151500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15150004
151600         END-PERFORM                                              15160004
151700                                                                  15170004
151800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15180004
151900                                   TO PV-BLOCK-NUMBER             15190004
152000         PERFORM 4410-READ-TEMP-STORAGE                           15200004
152100     END-IF.                                                      15210004
152200                                                                  15220004
152300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15230004
152400                                      ASC-END-OF-SELECTED-RANGE.  15240004
152500                                                                  15250004
152600*----------------------------------------------------------------*15260004
152700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15270004
152800*----------------------------------------------------------------*15280004
152900 3510-MARK-SELECTED-INDS.                                         15290004
153000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15300004
153100                                ASC-ITEM-SUB) >                   15310004
153200         ASC-START-OF-SELECTED-RANGE)                             15320004
153300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15330004
153400                                ASC-ITEM-SUB) =                   15340004
153500         ASC-START-OF-SELECTED-RANGE)                             15350004
153600                                                                  15360004
153700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15370004
153800                                    ASC-ITEM-SUB) <               15380004
153900             ASC-END-OF-SELECTED-RANGE)                           15390004
154000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15400004
154100                                    ASC-ITEM-SUB) =               15410004
154200             ASC-END-OF-SELECTED-RANGE)                           15420004
154300                                                                  15430004
154400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15440004
154500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15450004
154600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15460004
154700                               TO TRUE                            15470004
154800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15480004
154900                               TO TRUE                            15490004
155000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15500004
155100             END-IF                                               15510004
155200         END-IF                                                   15520004
155300     END-IF.                                                      15530004
155400                                                                  15540004
155500*----------------------------------------------------------------*15550004
155600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15560004
155700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15570004
155800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15580004
155900*    DISPLAY THE PANEL TO USER.                                  *15590004
156000*----------------------------------------------------------------*15600004
156100 4000-BUILD-INITIAL-PANEL.                                        15610004
156200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15620004
156300                                 ASC-BLOCK-ENTRIES (2).           15630004
156400     MOVE +1                   TO ASC-BLK-SUB.                    15640004
156500     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           15650004
156600                                                                  15660004
156700     MOVE +0                 TO ASC-ITEM-SUB                      15670004
156800                                ASC-NUMBER-OF-ITEMS-READ          15680004
156900                                ASC-NUMBER-OF-SELECTED-ITEMS      15690004
157000                                ASC-HIGHEST-BLOCK-WRITTEN         15700004
157100                                ASC-START-OF-SELECTED-RANGE       15710004
157200                                ASC-END-OF-SELECTED-RANGE         15720004
157300                                ASC-ITEM-AT-TOP-OF-PANEL.         15730004
157400                                                                  15740004
157500     PERFORM 4010-OPEN-CURSOR.                                    15750004
157600     PERFORM 4300-READ-ITEMS-FROM-DB.                             15760004
157700     PERFORM 4020-CLOSE-CURSOR.                                   15770004
157800                                                                  15780004
157900     MOVE +1                   TO  PV-TOP-ITEM.                   15790004
158000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15800004
158100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15810004
158200         SET DP020-MSG-FATAL   TO  TRUE                           15820004
158300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15830004
158400     ELSE                                                         15840004
158500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15850004
158600     END-IF.                                                      15860004
158700                                                                  15870004
158800*----------------------------------------------------------------*15880004
158900* OPEN THE CURSOR.                                               *15890004
159300*----------------------------------------------------------------*15930004
159400 4010-OPEN-CURSOR.                                                15940004
159500     MOVE ASC-OPER-UNT-ID  TO DK-OPER-UNT-ID.                     15950004
159700     PERFORM                                                      15970004
159800         WITH TEST AFTER                                          15980004
159900         VARYING PV-RETRY-COUNTER                                 15990004
160000         FROM 1 BY 1                                              16000004
160100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16010004
160200                   OR (SQLCODE = ZERO))                           16020004
160300                                                                  16030004
160400              EXEC SQL                                            16040004
160500                  OPEN STORE-CSR                                  16050005
160600              END-EXEC                                            16060004
160700                                                                  16070004
160800         EVALUATE TRUE                                            16080004
160900             WHEN SQLCODE = ZERO                                  16090004
161000             WHEN SQLCODE = -904                                  16100004
161100             WHEN SQLCODE = -913                                  16110004
161200                 CONTINUE                                         16120004
161300             WHEN SQLWARN0 NOT = SPACES                           16130004
161400             WHEN SQLCODE < ZERO                                  16140004
161500             WHEN SQLCODE > ZERO                                  16150004
161600                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       16160004
161700                 MOVE 'UNABLE TO OPEN A CURSOR -'                 16170004
161800                                   TO DP013-MESSAGE-TEXT (1)      16180004
161900                 MOVE SQLCA        TO DP013-SQLCA                 16190004
162000                 MOVE 'TCNDRST '   TO DP013-DB2-TABLE-NAME (1)    16200004
162100                 SET DP013-DB2-ABEND                              16210004
162200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16220004
162300                 PERFORM DP013-0000-PROCESS-ABEND                 16230004
162400         END-EVALUATE                                             16240004
162500     END-PERFORM.                                                 16250004
162600*                                                                 16260004
162700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16270004
162800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16280004
162900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   16290004
163000                                   TO DP013-MESSAGE-TEXT (1)      16300004
163100         MOVE SQLCA                TO DP013-SQLCA                 16310004
163200         MOVE 'TCNDRST '           TO DP013-DB2-TABLE-NAME (1)    16320004
163300         SET DP013-DB2-ABEND                                      16330004
163400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16340004
163500         PERFORM DP013-0000-PROCESS-ABEND                         16350004
163600     END-IF.                                                      16360004
163700                                                                  16370004
163800*----------------------------------------------------------------*16380004
163900* CLOSE THE CURSOR                                               *16390004
164000*----------------------------------------------------------------*16400004
164100 4020-CLOSE-CURSOR.                                               16410004
164200          EXEC SQL                                                16420004
164300               CLOSE STORE-CSR                                    16430005
164400          END-EXEC                                                16440004
164500                                                                  16450004
164600     EVALUATE TRUE                                                16460004
164700         WHEN SQLCODE = ZERO                                      16470004
164800             CONTINUE                                             16480004
164900         WHEN SQLWARN0 NOT = SPACES                               16490004
165000         WHEN SQLCODE < ZERO                                      16500004
165100         WHEN SQLCODE > ZERO                                      16510004
165200             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          16520004
165300             MOVE 'UNABLE TO CLOSE CURSOR '                       16530004
165400                               TO DP013-MESSAGE-TEXT (1)          16540004
165500             MOVE SQLCA        TO DP013-SQLCA                     16550004
165600             MOVE 'TCNDRST '   TO DP013-DB2-TABLE-NAME (1)        16560004
165700             SET DP013-DB2-ABEND                                  16570004
165800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16580004
165900             PERFORM DP013-0000-PROCESS-ABEND                     16590004
166000     END-EVALUATE.                                                16600004
166100                                                                  16610004
166200*----------------------------------------------------------------*16620004
166300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16630004
166400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16640004
166500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16650004
166600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16660004
166700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16670004
166800*                                                                *16680004
166900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16690004
167000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16700004
167100*    UPON INITIALIZATION.                                        *16710004
167200*----------------------------------------------------------------*16720004
167300 4300-READ-ITEMS-FROM-DB.                                         16730004
167400     PERFORM                                                      16740004
167500         VARYING PV-READ-COUNT                                    16750004
167600         FROM 1 BY 1                                              16760004
167700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16770004
167800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16780004
167900                                                                  16790004
168000         PERFORM 4310-FETCH                                       16800004
168100                                                                  16810004
168200         IF  ASC-ITEMS-LEFT-ON-DB                                 16820004
168300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16830004
168400                 ADD +1            TO ASC-ITEM-SUB                16840004
168500             ELSE                                                 16850004
168600                 ADD +1            TO ASC-BLK-SUB                 16860004
168700                 MOVE +1           TO ASC-ITEM-SUB                16870004
168800                                                                  16880004
168900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16890004
169000                     MOVE +1       TO ASC-BLK-SUB                 16900004
169100                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           16910004
169200                     PERFORM 5100-WRITE-TEMP-STORAGE              16920004
169300                     MOVE ASC-BLOCK-ENTRIES                       16930004
169400                               (PC-MAX-BLOCKS-IN-ARRAY)           16940004
169500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16950004
169600                     ADD +1        TO ASC-BLK-SUB                 16960004
169700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16970004
169800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16980004
169900                                   TO TRUE                        16990004
170000                 END-IF                                           17000004
170100             END-IF                                               17010004
170200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17020004
170300             MOVE ASC-NUMBER-OF-ITEMS-READ                        17030004
170400                                   TO ASC-LIST-ITEM-NUMBER        17040004
170500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17050004
170600             MOVE SPACES           TO  ASC-ACTION                 17060004
170700             MOVE CNDRST-STR-NBR   TO  ASC-STORE-NBR              17070004
170800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17080021
170900             MOVE CNDRST-STRT-TMST TO  ASC-DATE                   17090030
171000*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 17100030
171010             MOVE ASC-MM           TO  DK-MM                      17101029
171100             MOVE ASC-DD           TO  DK-DD                      17110024
171200             MOVE ASC-CCYY         TO  DK-CC                      17120024
171500             MOVE DK-START-DTE     TO  ASC-START-DATE             17150004
171600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17160021
172000             IF CNDRST-END-TMST = PC-DEFAULT-TIMESTAMP            17200004
172100                 MOVE PC-ACTIVE    TO  ASC-STATUS                 17210004
172200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17220004
172300             ELSE                                                 17230004
172400                 MOVE PC-INACTV    TO  ASC-STATUS                 17240004
172500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17250004
172600             END-IF                                               17260004
173600             MOVE CNDRST-CRE-USR-ID TO ASC-USERID                 17360004
173700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17370021
173910             MOVE XLT00010-LOC-10-ABBR-NM TO ASC-STORE-NAME       17391049
173920                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17392021
173930             MOVE CNDCDR-DOOR-LOC-DESC  TO ASC-LOC-DESC           17393010
173940                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17394024
173941             MOVE CNDRTY-DOOR-TYP-CDE-DESC TO ASC-TYPE-CODE-DESC  17394145
173942                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17394245
173950             MOVE CNDRST-DOOR-ID        TO ASC-DOOR-ID            17395030
173960                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17396030
174000         END-IF                                                   17400004
174100     END-PERFORM.                                                 17410004
174200                                                                  17420004
174300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17430004
174400         MOVE +1               TO ASC-BLK-SUB                     17440004
174500         PERFORM 5100-WRITE-TEMP-STORAGE                          17450004
174600         ADD +1                TO ASC-BLK-SUB                     17460004
174700         PERFORM 5100-WRITE-TEMP-STORAGE                          17470004
174800                                                                  17480004
174900         MOVE 1                TO ASC-BLK-SUB                     17490004
175000                                  PV-BLOCK-NUMBER                 17500004
175100         PERFORM 4410-READ-TEMP-STORAGE                           17510004
175200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17520004
175300             MOVE 2            TO ASC-BLK-SUB                     17530004
175400                                  PV-BLOCK-NUMBER                 17540004
175500             PERFORM 4410-READ-TEMP-STORAGE                       17550004
175600         END-IF                                                   17560004
175700     END-IF.                                                      17570004
175800                                                                  17580004
175900*----------------------------------------------------------------*17590004
176000*    FETCH THE CURSOR                                             17600004
176100*----------------------------------------------------------------*17610004
176200 4310-FETCH.                                                      17620004
176300       EXEC SQL                                                   17630004
176400            FETCH STORE-CSR                                       17640005
176500            INTO  :CNDRST-STR-NBR                                 17650004
176600                , :CNDRST-DOOR-ID                                 17660030
176610                , :CNDRST-STRT-TMST                               17661030
176800                , :CNDRST-CRE-USR-ID                              17680004
176900                , :XLT00010-LOC-10-ABBR-NM                        17690049
176910                , :CNDCDR-DOOR-LOC-DESC                           17691010
176920                , :CNDRTY-DOOR-TYP-CDE-DESC                       17692010
177000      END-EXEC                                                    17700004
177100                                                                  17710004
177200                                                                  17720004
177300     EVALUATE TRUE                                                17730004
177400         WHEN SQLCODE = ZERO                                      17740004
177500         WHEN SQLCODE = +100                                      17750004
177600              CONTINUE                                            17760004
177700         WHEN SQLWARN0 NOT = SPACE                                17770004
177800         WHEN SQLCODE NOT = ZERO                                  17780004
177900              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         17790004
178000              MOVE 'COULD NOT FETCH CURSOR'                       17800004
178100                               TO DP013-MESSAGE-TEXT (1)          17810004
178200              MOVE SQLCA       TO DP013-SQLCA                     17820004
178300              SET DP013-DB2-ABEND TO TRUE                         17830004
178400              PERFORM DP013-0000-PROCESS-ABEND                    17840004
178500     END-EVALUATE.                                                17850004
178600                                                                  17860004
178700     IF  SQLCODE EQUAL +100                                       17870004
178800         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      17880004
178900     END-IF.                                                      17890004
179000                                                                  17900004
179100*----------------------------------------------------------------*17910004
179200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17920004
179300*----------------------------------------------------------------*17930004
179400 4400-MOVE-COMMAREA-TO-SCREEN.                                    17940004
179500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17950004
179600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17960004
179700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17970004
179800             MOVE +1    TO ASC-BLK-SUB                            17980004
179900             PERFORM 5100-WRITE-TEMP-STORAGE                      17990004
180000             ADD +1     TO ASC-BLK-SUB                            18000004
180100             PERFORM 5100-WRITE-TEMP-STORAGE                      18010004
180200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18020004
180300                 GIVING PV-BLOCK-NUMBER                           18030004
180400                 REMAINDER PV-REMAINDER                           18040004
180500             IF  PV-REMAINDER > ZERO                              18050004
180600                 ADD +1 TO PV-BLOCK-NUMBER                        18060004
180700             END-IF                                               18070004
180800             MOVE +1    TO ASC-BLK-SUB                            18080004
180900             PERFORM 4410-READ-TEMP-STORAGE                       18090004
181000             ADD +1     TO ASC-BLK-SUB                            18100004
181100                           PV-BLOCK-NUMBER                        18110004
181200             PERFORM 4410-READ-TEMP-STORAGE                       18120004
181300     END-IF.                                                      18130004
181400     MOVE +1            TO ASC-BLK-SUB.                           18140004
181500     COMPUTE ASC-ITEM-SUB =                                       18150004
181600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18160004
181700         + PC-ITEMS-PER-PANEL).                                   18170004
181800*                                                                 18180004
181900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18190004
182000         ADD +1         TO ASC-BLK-SUB                            18200004
182100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18210004
182200     END-IF.                                                      18220004
182300*                                                                 18230004
182400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18240004
182500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18250004
182600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18260004
182700     PERFORM 4420-FORMAT-LIST-LINES                               18270004
182800         VARYING PV-SUB                                           18280004
182900         FROM PC-ITEMS-PER-PANEL BY -1                            18290004
183000         UNTIL PV-SUB < +1.                                       18300004
183100*                                                                 18310004
183200     COMPUTE ASC-ITEMS-DISPLAYED =                                18320004
183300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18330004
183400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18340004
183500                                      ASTRTITO.                   18350004
183600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18360004
183700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18370004
184000     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   18400004
184100     MOVE ASC-FCLTY-NAME           TO AOPRNMEO.                   18410004
184800                                                                  18480004
184900     IF  DP020-MSG-NUMBER-X = SPACE                               18490004
185000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18500004
185100*            --- MORE ITEMS TO DISPLAY ----                       18510004
185200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18520004
185300             SET DP020-MSG-INFORMATIONAL TO TRUE                  18530004
185400         END-IF                                                   18540004
185500     END-IF.                                                      18550004
185600                                                                  18560004
185700*----------------------------------------------------------------*18570004
185800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18580004
185900*----------------------------------------------------------------*18590004
186000 4410-READ-TEMP-STORAGE.                                          18600004
186100     EXEC CICS                                                    18610004
186200         READQ TS                                                 18620004
186300             QUEUE (ASC-LIST-QUEUE-NAME)                          18630004
186400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18640004
186500             ITEM  (PV-BLOCK-NUMBER)                              18650004
186600             RESP  (PV-CICS-RESP)                                 18660004
186700     END-EXEC.                                                    18670004
186800                                                                  18680004
186900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18690004
187000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18700004
187100         CONTINUE                                                 18710004
187200     ELSE                                                         18720004
187300         SET DP013-CICS-ABEND     TO TRUE                         18730004
187400         SET DP013-NO-ROLLBACK    TO TRUE                         18740004
187500         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         18750004
187600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18760004
187700                                  TO DP013-MESSAGE-TEXT(1)        18770004
187800         PERFORM DP013-0000-PROCESS-ABEND                         18780004
187900     END-IF.                                                      18790004
188000                                                                  18800004
188100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18810004
188200*                                                                 18820004
188300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18830004
188400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18840004
188500     END-IF.                                                      18850004
188600                                                                  18860004
188700*----------------------------------------------------------------*18870004
188800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18880004
188900*----------------------------------------------------------------*18890004
189000 4420-FORMAT-LIST-LINES.                                          18900004
189100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18910004
189200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18920004
189300*        MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           18930044
189400*        MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           18940044
189500*        MOVE SPACE              TO MR-SELECTI (PV-SUB)           18950044
189600*                                   MR-ACTION  (PV-SUB)           18960044
189900         MOVE SPACE TO              MR-STORE-NAME  (PV-SUB)       18990014
190000                                    MR-DOOR-NBR    (PV-SUB)       19000041
190100                                    MR-LOCATION    (PV-SUB)       19010041
190300                                    MR-START-DATE  (PV-SUB)       19030014
190310                                    MR-USERID      (PV-SUB)       19031014
190320                                    MR-DOOR-TYPE   (PV-SUB)       19032041
190400         MOVE ZEROES            TO  MR-STORE-NBR   (PV-SUB)       19040041
190410         MOVE DP015-ASK-DRK-OFF  TO MR-STORE-NBRA  (PV-SUB)       19041045
190500     ELSE                                                         19050004
190600*        IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19060044
190700*                                                  > SPACE        19070044
190800*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19080044
190900*                                TO MR-SELECTI (PV-SUB)           19090044
191000*        ELSE                                                     19100044
191100*            MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19110044
191200*                                TO MR-SELECTI (PV-SUB)           19120044
191300*        END-IF                                                   19130044
191400                                                                  19140004
191500         IF  DP030-SET-CURSOR-TRAILER                             19150042
191600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19160042
191700                 > SPACE)                                         19170042
191800               OR (PV-SUB = 1))                                   19180042
191900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19190042
192000*               MOVE -1          TO MR-SELECTL (PV-SUB)           19200044
192100             END-IF                                               19210042
192200         END-IF                                                   19220042
192300                                                                  19230004
192600         MOVE ASC-STORE-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)           19260004
192700                                         TO MR-STORE-NBR (PV-SUB) 19270004
192800         MOVE ASC-STORE-NAME (ASC-BLK-SUB ASC-ITEM-SUB)           19280004
192900                                        TO MR-STORE-NAME (PV-SUB) 19290004
193200         MOVE ASC-DOOR-ID-N (ASC-BLK-SUB ASC-ITEM-SUB)            19320030
193300                                        TO MR-DOOR-NBR (PV-SUB)   19330014
193400         MOVE ASC-TYPE-CODE-DESC (ASC-BLK-SUB ASC-ITEM-SUB)       19340014
193500                                         TO MR-DOOR-TYPE (PV-SUB) 19350023
193600         MOVE ASC-LOC-DESC (ASC-BLK-SUB ASC-ITEM-SUB)             19360014
193700                                        TO MR-LOCATION (PV-SUB)   19370014
193710         MOVE ASC-START-DATE (ASC-BLK-SUB ASC-ITEM-SUB)           19371014
193720                                        TO MR-START-DATE (PV-SUB) 19372014
193800         MOVE ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB)               19380004
193900                                            TO MR-USERID (PV-SUB) 19390004
194000     END-IF.                                                      19400004
194100     SUBTRACT +1 FROM ASC-ITEM-SUB                                19410004
194200     IF  ASC-ITEM-SUB < + 1                                       19420004
194300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19430004
194400         MOVE +1                 TO ASC-BLK-SUB                   19440004
194500     END-IF.                                                      19450004
194600                                                                  19460004
194700******************************************************************19470004
194800** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **19480004
194900** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **19490004
195000** ISSUE A WARNING.                                             **19500004
195100******************************************************************19510004
195200 4430-CHECK-FOR-BEGIN-AND-END.                                    19520004
195300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19530004
195400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19540004
195500*            -- NO END-OF-RANGE SPECFIED ---                      19550004
195600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19560004
195700             SET DP020-MSG-WARNING TO TRUE                        19570004
195800*            PERFORM 4431-POSITION-AT-WARNING                     19580004
195900         END-IF                                                   19590004
196000     ELSE                                                         19600004
196100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19610004
196200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19620004
196300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19630004
196400             SET DP020-MSG-WARNING TO TRUE                        19640004
196500*            PERFORM 4431-POSITION-AT-WARNING                     19650004
196600         END-IF                                                   19660004
196700     END-IF.                                                      19670004
196800                                                                  19680004
196900******************************************************************19690004
197000** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **19700004
197100** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **19710004
197200** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **19720004
197300** POSITION THE CURSOR THERE.                                   **19730004
197400******************************************************************19740004
197500 4431-POSITION-AT-WARNING.                                        19750004
197600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19760004
197700                    - PV-TOP-ITEM + 1.                            19770004
197800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19780004
197900         CONTINUE                                                 19790004
198000*    ELSE                                                         19800004
198100*        SET DP030-SET-CURSOR-APPL-1                              19810004
198200*                                  TO TRUE                        19820004
198300*        MOVE -1                   TO MR-SELECTL (PV-SUB)         19830004
198400*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19840004
198500*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19850004
198600     END-IF.                                                      19860004
198700                                                                  19870004
198800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19880004
198900                    - PV-TOP-ITEM + 1.                            19890004
199000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19900004
199100         CONTINUE                                                 19910004
199200*    ELSE                                                         19920004
199300*        SET DP030-SET-CURSOR-APPL-1  TO TRUE                     19930004
199400*        MOVE -1                   TO MR-SELECTL (PV-SUB)         19940004
199500*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19950004
199600*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19960004
199700     END-IF.                                                      19970004
199800                                                                  19980004
199900*----------------------------------------------------------------*19990004
200000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20000004
200100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20010004
200200* FOR THE SELECTED ITEMS QUEUE.                                  *20020004
200300*                                                                *20030004
200400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20040004
200500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20050004
200600* THE ARRAY IS FULL.                                             *20060004
200700*----------------------------------------------------------------*20070004
200800 5000-PREPARE-SEL-QUEUE.                                          20080004
200900     MOVE +1                   TO  ASC-BLK-SUB.                   20090004
201000     PERFORM 5100-WRITE-TEMP-STORAGE.                             20100004
201100     ADD +1                    TO  ASC-BLK-SUB.                   20110004
201200     PERFORM 5100-WRITE-TEMP-STORAGE.                             20120004
201300                                                                  20130004
201400     MOVE ASC-SEL-QUEUE-NAME   TO  CN012-SEL-QUEUE-NAME.          20140004
201500     PERFORM 6010-DELETE-SEL-QUEUE.                               20150004
201600                                                                  20160004
201700     SET ASC-UPDATE-TSQ        TO  TRUE.                          20170004
201800                                                                  20180004
201900     SET CN013-IDX             TO  1.                             20190004
202000     MOVE ZERO                 TO CN012-NUMBER-OF-TS-ITEMS.       20200004
202100     INITIALIZE CN013-SELECTED-ITEM-ARRAY.                        20210004
202200                                                                  20220004
202300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20230004
202400             VARYING PV-ITEM                                      20240004
202500             FROM 1 BY 1                                          20250004
202600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20260004
202700                                                                  20270004
202800     IF  CN013-IDX > 1                                            20280004
202900         PERFORM 5205-WRITE-SEL-QUEUE                             20290004
203000         ADD +1                TO CN012-NUMBER-OF-TS-ITEMS        20300004
203100     END-IF.                                                      20310004
203200                                                                  20320004
203300*----------------------------------------------------------------*20330004
203400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20340004
203500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20350004
203600*----------------------------------------------------------------*20360004
203700 5100-WRITE-TEMP-STORAGE.                                         20370004
203800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20380004
203900                                   TO PV-LIST-ITEM-NUMBER.        20390004
204000     COMPUTE PV-BLOCK-NUMBER =                                    20400004
204100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20410004
204200                                                                  20420004
204300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20430004
204400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20440004
204500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20450004
204600             PERFORM 5105-REWRITE-ASC-LISTQ                       20460004
204700         END-IF                                                   20470004
204800     ELSE                                                         20480004
204900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20490004
205000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20500004
205100         PERFORM 5110-WRITE-ASC-LISTQ                             20510004
205200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20520004
205300     END-IF.                                                      20530004
205400                                                                  20540004
205500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20550004
205600                                                                  20560004
205700******************************************************************20570004
205800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **20580004
205900** SPECIFIC COMMAREA.                                           **20590004
206000******************************************************************20600004
206100 5105-REWRITE-ASC-LISTQ.                                          20610004
206200     EXEC CICS                                                    20620004
206300         WRITEQ TS                                                20630004
206400             QUEUE (ASC-LIST-QUEUE-NAME)                          20640004
206500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20650004
206600             ITEM  (PV-BLOCK-NUMBER)                              20660004
206700             REWRITE                                              20670004
206800             RESP  (PV-CICS-RESP)                                 20680004
206900     END-EXEC.                                                    20690004
207000                                                                  20700004
207100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20710004
207200         CONTINUE                                                 20720004
207300     ELSE                                                         20730004
207400         SET DP013-CICS-ABEND            TO TRUE                  20740004
207500         SET DP013-NO-ROLLBACK           TO TRUE                  20750004
207600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20760004
207700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20770004
207800                                         TO DP013-MESSAGE-TEXT(1) 20780004
207900         PERFORM DP013-0000-PROCESS-ABEND                         20790004
208000     END-IF.                                                      20800004
208100                                                                  20810004
208200******************************************************************20820004
208300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20830004
208400** SPECIFIC COMMAREA.                                           **20840004
208500******************************************************************20850004
208600 5110-WRITE-ASC-LISTQ.                                            20860004
208700     EXEC CICS                                                    20870004
208800         WRITEQ TS                                                20880004
208900             QUEUE (ASC-LIST-QUEUE-NAME)                          20890004
209000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20900004
209100             ITEM  (PV-BLOCK-NUMBER)                              20910004
209200             RESP  (PV-CICS-RESP)                                 20920004
209300     END-EXEC.                                                    20930004
209400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20940004
209500         SET DP013-CICS-ABEND      TO TRUE                        20950004
209600         SET DP013-NO-ROLLBACK     TO TRUE                        20960004
209700         MOVE '5110-WRITE-ASC-LISTQ'                              20970004
209800                                   TO DP013-PARAGRAPH             20980004
209900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20990004
210000                                   TO DP013-MESSAGE-TEXT(1)       21000004
210100         PERFORM DP013-0000-PROCESS-ABEND                         21010004
210200     END-IF.                                                      21020004
210300                                                                  21030004
210400*----------------------------------------------------------------*21040004
210500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21050004
210600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21060004
210700*----------------------------------------------------------------*21070004
210800 5200-FILL-SEL-QUEUE-RECORD.                                      21080004
210900     PERFORM 6112-READ-LIST-QUEUE.                                21090004
211000                                                                  21100004
211100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21110004
211200         PERFORM VARYING LQW-IDX                                  21120004
211300         FROM 1 BY 1                                              21130004
211400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21140004
211500           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               21150004
211600                                                                  21160004
211700           IF LQW-SELECT (LQW-IDX)                                21170044
211800                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX) TO            21180044
211900                                            CN013-ITEM (CN013-IDX)21190044
212000                 MOVE SPACE        TO CN013-ACTION-SW (CN013-IDX) 21200044
212100*                MOVE LQW-DOOR-ID (LQW-IDX)                       21210044
212200*                                    TO CN013-DOOR-ID (CN013-IDX) 21220044
212300*                MOVE LQW-TYPE-CODE (LQW-IDX)                     21230044
212400*                                  TO CN013-TYPE-CODE (CN013-IDX) 21240044
212500*                MOVE LQW-LOC-DESC (LQW-IDX)                      21250044
212600*                                   TO CN013-LOC-DESC (CN013-IDX) 21260044
212700*                MOVE LQW-LANE-ASGNMT (LQW-IDX)                   21270044
212800*                                TO CN013-LANE-ASGNMT (CN013-IDX) 21280044
212900*                MOVE LQW-LBL-SEQ (LQW-IDX)                       21290044
213000*                               TO CN013-LBL-SEQ-NBR (CN013-IDX)  21300044
213100*                MOVE LQW-STOR-ASGNMT (LQW-IDX)                   21310044
213200*                               TO CN013-STORE-ASGNMT (CN013-IDX) 21320044
213300                                                                  21330004
213400                 SET CN013-IDX UP BY 1                            21340004
213500                 IF  CN013-IDX > CN013-MAX-ITEMS                  21350004
213600                     PERFORM 5205-WRITE-SEL-QUEUE                 21360004
213700                     ADD +1        TO CN012-NUMBER-OF-TS-ITEMS    21370004
213800                     INITIALIZE CN013-SELECTED-ITEM-ARRAY         21380004
213900                     SET CN013-IDX TO  1                          21390004
214000                 END-IF                                           21400004
214100           END-IF                                                 21410004
214200         END-PERFORM                                              21420004
214300     END-IF.                                                      21430004
214400                                                                  21440004
214500*----------------------------------------------------------------*21450004
214600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21460004
214700*----------------------------------------------------------------*21470004
214800 5205-WRITE-SEL-QUEUE.                                            21480004
214900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN013-SELECTED-ITEMS.   21490004
215000                                                                  21500004
215100     EXEC CICS                                                    21510004
215200          WRITEQ TS                                               21520004
215300              QUEUE (ASC-SEL-QUEUE-NAME)                          21530004
215400              FROM  (CN013-SELECT-RECORD)                         21540004
215500              ITEM  (PV-SEL-QUEUE-ITEM)                           21550004
215600              RESP  (PV-CICS-RESP)                                21560004
215700     END-EXEC.                                                    21570004
215800                                                                  21580004
215900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21590004
216000         CONTINUE                                                 21600004
216100     ELSE                                                         21610004
216200         SET DP013-CICS-ABEND      TO TRUE                        21620004
216300         SET DP013-NO-ROLLBACK     TO TRUE                        21630004
216400         MOVE '5205-WRITE-SEL-QUEUE'                              21640004
216500                                   TO DP013-PARAGRAPH             21650004
216600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21660004
216700                                   TO DP013-MESSAGE-TEXT(1)       21670004
216800         PERFORM DP013-0000-PROCESS-ABEND                         21680004
216900     END-IF.                                                      21690004
217000                                                                  21700004
217100******************************************************************21710004
217200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **21720004
217300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **21730004
217400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **21740004
217500** THE USER.                                                    **21750004
217600******************************************************************21760004
217700 6000-REFRESH-PANEL-FROM-TEMP.                                    21770004
217800     IF  ASC-UPDATE-TSQ                                           21780004
217900         SET ASC-NO-TSQ-UPDATE TO TRUE                            21790004
218000         MOVE ZERO                 TO PV-SAVE-ITEM                21800004
218100                                      PV-SEL-QUEUE-ITEM           21810004
218200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21820004
218300                                   TO PV-HOLD-SELECTED-ITEMS      21830004
218400         MOVE +1                   TO PV-ITEMS-PROCESSED          21840004
218500         PERFORM 6100-UPDATE-TSQ                                  21850004
218600             UNTIL PV-ITEMS-PROCESSED >                           21860004
218700                                     PV-HOLD-SELECTED-ITEMS       21870004
218800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21880004
218900                    ASC-BLOCK-ENTRIES (2)                         21890004
219000     END-IF.                                                      21900004
219100                                                                  21910004
219200*----------------------------------------------------------------*21920004
219300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21930004
219400*----------------------------------------------------------------*21940004
219500 6010-DELETE-SEL-QUEUE.                                           21950004
219600                                                                  21960004
219700     EXEC CICS                                                    21970004
219800         DELETEQ TS                                               21980004
219900             QUEUE (ASC-SEL-QUEUE-NAME)                           21990004
220000             RESP  (PV-CICS-RESP)                                 22000004
220100     END-EXEC.                                                    22010004
220200*                                                                 22020004
220300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22030004
220400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22040004
220500         CONTINUE                                                 22050004
220600     ELSE                                                         22060004
220700         SET DP013-CICS-ABEND TO TRUE                             22070004
220800         SET DP013-NO-ROLLBACK TO TRUE                            22080004
220900         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          22090004
221000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22100004
221100                                        TO DP013-MESSAGE-TEXT (1) 22110004
221200         PERFORM DP013-0000-PROCESS-ABEND                         22120004
221300     END-IF.                                                      22130004
221400                                                                  22140004
221500*----------------------------------------------------------------*22150004
221600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22160004
221700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22170004
221800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22180004
221900*    THE TEMP QUEUE.                                             *22190004
222000*----------------------------------------------------------------*22200004
222100 6100-UPDATE-TSQ.                                                 22210004
222200     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              22220004
222300     PERFORM 6105-READ-SEL-QUEUE.                                 22230004
222400     PERFORM                                                      22240004
222500         VARYING CN013-IDX FROM 1 BY 1                            22250004
222600         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     22260004
222700         OR (CN013-IDX GREATER THAN CN013-MAX-ITEMS))             22270004
222800         IF  CN013-ACTION-SW (CN013-IDX) > SPACE                  22280004
222900             PERFORM 6110-PROCESS-ITEMS                           22290004
223000         END-IF                                                   22300004
223100         ADD +1                TO PV-ITEMS-PROCESSED              22310004
223200     END-PERFORM.                                                 22320004
223300     PERFORM 6111-WRITE-LIST-QUEUE.                               22330004
223400                                                                  22340004
223500*----------------------------------------------------------------*22350004
223600*    READ THE LIST QUEUE RECORD.                                 *22360004
223700*----------------------------------------------------------------*22370004
223800 6105-READ-SEL-QUEUE.                                             22380004
223900                                                                  22390004
224000     EXEC CICS                                                    22400004
224100          READQ TS                                                22410004
224200              QUEUE (ASC-SEL-QUEUE-NAME)                          22420004
224300              INTO  (CN013-SELECT-RECORD)                         22430004
224400              ITEM  (PV-SEL-QUEUE-ITEM)                           22440004
224500              RESP  (PV-CICS-RESP)                                22450004
224600     END-EXEC.                                                    22460004
224700*                                                                 22470004
224800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22480004
224900         CONTINUE                                                 22490004
225000     ELSE                                                         22500004
225100         SET DP013-CICS-ABEND      TO  TRUE                       22510004
225200         SET DP013-NO-ROLLBACK     TO  TRUE                       22520004
225300         MOVE '6105-READ-SEL-QUEUE'                               22530004
225400                                   TO  DP013-PARAGRAPH            22540004
225500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22550004
225600                                   TO  DP013-MESSAGE-TEXT(1)      22560004
225700         PERFORM DP013-0000-PROCESS-ABEND                         22570004
225800     END-IF.                                                      22580004
225900                                                                  22590004
226000*----------------------------------------------------------------*22600004
226100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22610004
226200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22620004
226300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22630004
226400*----------------------------------------------------------------*22640004
226500 6110-PROCESS-ITEMS.                                              22650004
226600                                                                  22660004
226700     COMPUTE PV-ITEM = 1 + ((CN013-ITEM (CN013-IDX) - 1)          22670004
226800                     / PC-ITEMS-PER-PANEL).                       22680004
226900                                                                  22690004
227000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22700004
227100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22710004
227200             PERFORM 6111-WRITE-LIST-QUEUE                        22720004
227300         END-IF                                                   22730004
227400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    22740004
227500                                                                  22750004
227600         PERFORM 6112-READ-LIST-QUEUE                             22760004
227700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               22770004
227800             CONTINUE                                             22780004
227900         END-IF                                                   22790004
228000     END-IF.                                                      22800004
228100                                                                  22810004
228200     COMPUTE PV-SUB = (CN013-ITEM (CN013-IDX)                     22820004
228300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              22830004
228400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         22840004
228500     MOVE LQW-SELECTED-SW (PV-SUB)                                22850004
228600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  22860004
228700     EVALUATE TRUE                                                22870004
228800         WHEN CN013-INQ (CN013-IDX)                               22880004
228900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             22890004
229000                                                                  22900004
229100         WHEN CN013-UPD (CN013-IDX)                               22910004
229200              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             22920004
229300                                                                  22930004
229400         WHEN CN013-DEL (CN013-IDX)                               22940004
229500              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             22950004
229600                                                                  22960004
229700         WHEN CN013-ERR (CN013-IDX)                               22970004
229800              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             22980004
229900                                                                  22990004
230000     END-EVALUATE.                                                23000004
230100                                                                  23010004
230200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23020004
230300                                                                  23030004
230400*----------------------------------------------------------------*23040004
230500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23050004
230600*----------------------------------------------------------------*23060004
230700 6111-WRITE-LIST-QUEUE.                                           23070004
230800     EXEC CICS                                                    23080004
230900         WRITEQ TS                                                23090004
231000             QUEUE (ASC-LIST-QUEUE-NAME)                          23100004
231100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23110004
231200             ITEM  (PV-SAVE-ITEM)                                 23120004
231300             REWRITE                                              23130004
231400             RESP  (PV-CICS-RESP)                                 23140004
231500     END-EXEC.                                                    23150004
231600*                                                                 23160004
231700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23170004
231800         CONTINUE                                                 23180004
231900     ELSE                                                         23190004
232000         SET DP013-CICS-ABEND  TO  TRUE                           23200004
232100         SET DP013-NO-ROLLBACK TO  TRUE                           23210004
232200         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         23220004
232300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23230004
232400                               TO  DP013-MESSAGE-TEXT(1)          23240004
232500         PERFORM DP013-0000-PROCESS-ABEND                         23250004
232600     END-IF.                                                      23260004
232700                                                                  23270004
232800*----------------------------------------------------------------*23280004
232900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23290004
233000*----------------------------------------------------------------*23300004
233100 6112-READ-LIST-QUEUE.                                            23310004
233200     EXEC CICS                                                    23320004
233300         READQ TS                                                 23330004
233400             QUEUE (ASC-LIST-QUEUE-NAME)                          23340004
233500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23350004
233600             ITEM  (PV-ITEM)                                      23360004
233700             RESP  (PV-CICS-RESP)                                 23370004
233800     END-EXEC.                                                    23380004
233900*                                                                 23390004
234000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23400004
234100         CONTINUE                                                 23410004
234200     ELSE                                                         23420004
234300         SET DP013-CICS-ABEND        TO TRUE                      23430004
234400         SET DP013-NO-ROLLBACK       TO TRUE                      23440004
234500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23450004
234600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23460004
234700                                     TO DP013-MESSAGE-TEXT(1)     23470004
234800         PERFORM DP013-0000-PROCESS-ABEND                         23480004
234900     END-IF.                                                      23490004
235000                                                                  23500004
235100*----------------------------------------------------------------*23510004
235200* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23520004
235300*----------------------------------------------------------------*23530004
235400 9100-READ-SEL-QUEUE.                                             23540004
235500     EXEC CICS                                                    23550004
235600         READQ TS                                                 23560004
235700             QUEUE (ASC-SEL-QUEUE-NAME)                           23570004
235800             INTO  (CN013-SELECT-RECORD)                          23580004
235900             ITEM  (ASC-SEL-ITEM)                                 23590004
236000             RESP  (PV-CICS-RESPONSE)                             23600004
236100     END-EXEC.                                                    23610004
236200                                                                  23620004
236300     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       23630004
236400         CONTINUE                                                 23640004
236500     ELSE                                                         23650004
236600         SET DP013-LOGIC-ABEND                                    23660004
236700             DP013-NO-ROLLBACK     TO TRUE                        23670004
236800         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            23680004
236900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   23690004
237000                                   TO DP013-MESSAGE-TEXT (1)      23700004
237100         PERFORM DP013-0000-PROCESS-ABEND                         23710004
237200     END-IF.                                                      23720004
237300                                                                  23730004
237400*----------------------------------------------------------------*23740004
237500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23750004
237600*----------------------------------------------------------------*23760004
237700 9200-REWRITE-SEL-QUEUE.                                          23770004
237800     EXEC CICS                                                    23780004
237900          WRITEQ TS                                               23790004
238000              QUEUE  (ASC-SEL-QUEUE-NAME)                         23800004
238100              FROM   (CN013-SELECT-RECORD)                        23810004
238200              ITEM   (ASC-SEL-ITEM)                               23820004
238300              RESP   (PV-CICS-RESPONSE)                           23830004
238400              REWRITE                                             23840004
238500     END-EXEC.                                                    23850004
238600                                                                  23860004
238700     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   23870004
238800         SET DP013-CICS-ABEND                                     23880004
238900             DP013-NO-ROLLBACK     TO TRUE                        23890004
239000         MOVE '9200-REWRITE-SEL-QUEUE'  TO DP013-PARAGRAPH        23900004
239100         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   23910004
239200                                   TO DP013-MESSAGE-TEXT (1)      23920004
239300         PERFORM DP013-0000-PROCESS-ABEND                         23930004
239400     END-IF.                                                      23940004
239500                                                                  23950004
239600*----------------------------------------------------------------*23960004
239700*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *23970004
239800*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *23980004
239900*----------------------------------------------------------------*23990004
240000 9900-SOFT-ABORT.                                                 24000004
240100     EXEC CICS SYNCPOINT                                          24010004
240200          ROLLBACK                                                24020004
240300     END-EXEC.                                                    24030004
240400                                                                  24040004
240500     SET  PS-ERROR                                                24050004
240600          PS-SOFT-ABORT-ERROR                                     24060004
240700          DP020-MSG-FATAL       TO  TRUE.                         24070004
240800                                                                  24080004
240900*----------------------------------------------------------------*24090004
241000*    ABEND PROCESSOR MODULE                                      *24100004
241100*----------------------------------------------------------------*24110004
241200     COPY DPPD013.                                                24120004
