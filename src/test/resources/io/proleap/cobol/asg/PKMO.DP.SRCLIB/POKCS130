000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    POKCS130.                                         00040000
000500 AUTHOR.        GEORGE HERIDES.                                   00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  04-06-06.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    W130 - PO LINE - DC SUMMARY 3                              * 00110000
001200*                                                               * 00120000
001300*    DISPLAYS A SUMMARY OF PO LINES AND THEIR ASSOCIATED        * 00130000
001400*    ORDER AND RECEIPT QUANTITIES BY DC.                        * 00140000
001500*                                                               * 00150000
001501* WR-8608 OPENED 4 NEW FACILITIES - REQUIRED AN ADDITIONAL      * 00150101
001502*         SCREEN TO DISPLAY ALL OF THE FACILITIES               * 00150201
001503*                                                               * 00150301
001504* ADDING THIS SCREEN WILL ALLOW FOR EXPANSION FOR 7 ADDITIONAL  * 00150401
001505* FACILITIES TO BE OPENED                                       * 00150501
001506*                                                               * 00150601
001510*    POKCS063 - PO LINE-DC SUMMARY   - DISPLAYS UP TO 9 DC/EFC  * 00151001
001511*               PANEL 1 - DC   85  - MENOMONEE FALLS WI DC      * 00151101
001512*                         EFC2 806 - SAN BERNARDINO CA  EFC     * 00151201
001513*                         DC   810 - FINDLAY OH         DC      * 00151301
001514*               PANEL 2 - EFC3 816 - EDGEWOOD MD        EFC     * 00151401
001515*                         WR   821 - WAREHOUSE REPLEN CA  WR    * 00151501
001516*                         EFC4 826 - DESOTO TX          EFC     * 00151601
001517*               PANEL 3 - DC   830 - WINCHESTER VA      DC      * 00151701
001518*                         DC   840 - BLUE SPRINGS MO    DC      * 00151801
001519*                         WR   851 - WAREHOUSE REPLEN NY  WR    * 00151901
001520*                                                               * 00152001
001521*    POKCS129 - PO LINE-DC SUMMARY 2 - DISPLAYS UP TO 9 DC/EFC  * 00152101
001522*               PANEL 1 - DC   855 - SAN BERNARDINO CA  DC      * 00152201
001523*                  (NEW)  3PL  858 - CHAMBERSBURG PA    3PL-EFC * 00152301
001524*                         DC   860 - CORSICANA TX       DC      * 00152401
001525*               PANEL 2 - DC   865 - MAMAKATING NY      DC      * 00152501
001526*                  (NEW)  3PL  868 - MCDONOUGH GA       3PL-EFC * 00152601
001527*                         EFC1 870 - MONROE OH          EFC     * 00152701
001528*               PANEL 3 - DC   875 - MACON GA           DC      * 00152801
001529*                  (NEW)  3PL  878 - EDWARDSVILLE MO    3PL-EFC * 00152901
001530*                         DC   885 - PATTERSON CA       DC      * 00153001
001531*                                                               * 00153101
001532*    POKCS130 - PO LINE-DC SUMMARY 3 - DISPLAYS UP TO 9 DC/EFC  * 00153201
001540*               PANEL 1 - 3PL  888 - DALLAS TX          3PL-EFC * 00154001
001550*                         DC   890 - OTTAWA IL          DC      * 00155001
001560*                         FUTURE FACILITY                       * 00156001
001570*               PANEL 2 - FUTURE FACILITY                       * 00157001
001571*                         FUTURE FACILITY                       * 00157101
001581*                         FUTURE FACILITY                       * 00158101
001582*               PANEL 3 - FUTURE FACILITY                       * 00158201
001583*                         FUTURE FACILITY                       * 00158301
001584*                         FUTURE FACILITY                       * 00158401
001600*---------------------------------------------------------------* 00160000
001604***************************************************************** 00160401
C98147* DATE  21/11/2014                                              * 00160502
C98147*       CHANGE MADE: PO EXTENDED DIGIT CHANGES.                 * 00160602
C98147*       EXTENDED PO# FROM 7 TO 8 IN MAP POKCS130.               * 00160702
C98147*      MADE BY: COGNIZANT              WR/IR: CHG0098147        * 00160802
C98147***************************************************************** 00160902
076319* DATE  10/27/2021                                                00161004
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00161104
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00161204
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00161304
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00161405
076312*                                                               * 00161504
076318*---------------------------------------------------------------* 00161604
CICS  *  CHANGED 11/17/2022    BY BARB SCHULTZ    WR: CHG0278485        00161707
CICS  *                                                               * 00161806
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00161906
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00162006
076318*---------------------------------------------------------------* 00162306
001605                                                                  00162406
001606 EJECT                                                            00162506
001607 ENVIRONMENT DIVISION.                                            00162606
001608                                                                  00162706
001609 DATA DIVISION.                                                   00162806
001610                                                                  00162906
001620 WORKING-STORAGE SECTION.                                         00163006
001621                                                                  00163106
001622 01  DK-DB2-KEYS.                                                 00163206
001623     15  DK-PO-NUMBER                   PIC S9(09)  VALUE ZERO    00163306
001624                                                    COMP.         00163406
001625     05  DK-PO-LNE-NBR                  PIC S9(9)   COMP VALUE +0.00163506
001626                                                                  00163606
001627     05  DK-LAST-DC                     PIC S9(4)   COMP VALUE +0.00163706
001628                                                                  00163806
001629 01  PC-PROGRAM-CONSTANTS.                                        00163906
001630     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00164006
001640                                                    'PO130A  '.   00164106
001650     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00165001
001660                                                    'POKM130 '.   00166001
001670     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00167001
001680                                                    'POKCS130'.   00168001
001690     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00169001
001700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00170001
001800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00180001
001900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +07     00190001
002000                                                    COMP SYNC.    00200001
002100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00210001
002200                                                    COMP SYNC.    00220001
002300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00230001
002400                                                    +1000000      00240001
002500                                                    COMP-3.       00250001
002600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00260001
002700                                                    COMP SYNC.    00270001
002800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00280001
002900                                                    COMP-3.       00290001
003000     05  PC-PCT                         PIC  X(01)  VALUE '%'.    00300001
003100     05  PC-DCX                         PIC S9(04)  COMP.         00310001
003200     05  PC-HEADA                       PIC X(17) VALUE           00320001
003300        '   QTY   QTY  PCT'.                                      00330001
003400                                                                  00340001
003500                                                                  00350001
003600     05  PC-DC1-HEAD                    PIC X(59).                00360001
003700     05  FILLER REDEFINES PC-DC1-HEAD.                            00370001
003800         10  PC-DC1-HEADA               PIC X(17).                00380001
003900         10  FILLER                     PIC X(02).                00390001
004000         10  PC-DC1-HEADB               PIC X(5).                 00400001
004100         10  FILLER                     PIC X(02).                00410001
004200         10  PC-DC1-HEADC               PIC X(5).                 00420001
004300         10  FILLER                     PIC X(02).                00430001
004400         10  PC-DC1-HEADD               PIC X(5).                 00440001
004500         10  FILLER                     PIC X(02).                00450001
004600         10  PC-DC1-HEADE               PIC X(5).                 00460001
004700         10  FILLER                     PIC X(02).                00470001
004800         10  PC-DC1-HEADF               PIC X(5).                 00480001
004900         10  FILLER                     PIC X(02).                00490001
005000         10  PC-DC1-HEADG               PIC X(5).                 00500001
005100                                                                  00510001
005110     05  PC-HEADB                       PIC X(17) VALUE           00511001
005120        '   ORD   REC  REC'.                                      00512001
005121     05  PC-HEAD-DC1                    PIC X(14) VALUE           00512101
005122        '    ORD   RECV'.                                         00512201
005123     05  PC-HEAD-DC2                    PIC X(14) VALUE           00512301
005124        '    ORD   RECV'.                                         00512401
005125     05  PC-HEAD-DC3                    PIC X(14) VALUE           00512501
005126        '    ORD   RECV'.                                         00512601
005127                                                                  00512701
005128     05  PC-DC1-HEAD2                   PIC X(59).                00512801
005129     05  FILLER REDEFINES PC-DC1-HEAD2.                           00512901
005130         10  PC-HEAD-NAMEB                  PIC X(17).            00513001
005140         10  PC-HEAD-DC10                   PIC X(14).            00514001
005141         10  PC-HEAD-DC20                   PIC X(14).            00514101
005142         10  PC-HEAD-DC30                   PIC X(14).            00514201
005143                                                                  00514301
005144     05  PC-QTY-HEAD                   PIC X(50)   VALUE          00514401
005145       '                                  QTY    QTY   PCT'.      00514501
005146     05  PC-QTY-HEAD2                  PIC X(50)   VALUE          00514601
005147       '     DESCRIPTION           STS    ORD    REC   REC'.      00514701
005148*                                                                 00514801
005149     05  PC-TSYMSG-NUMBERS.                                       00514901
005150         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00515001
005151         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00515101
005152         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00515201
005153         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00515301
005154         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00515401
005155         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00515501
005156         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00515601
005157         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00515701
005158         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00515801
005159         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00515901
005160         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00516001
005170         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00517001
005180         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00518001
005190         10  PC-TSYMSG-00994            PIC  9(05)  VALUE 00994.  00519001
005200         10  PC-TSYMSG-00227            PIC  9(05)  VALUE 00227.  00520001
005300         10  PC-TSYMSG-00228            PIC  9(05)  VALUE 00228.  00530001
005400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00540001
005500         10  PC-TSYMSG-03487            PIC  9(05)  VALUE 03487.  00550001
005600*                                                                 00560001
005700 01  PS-PROGRAM-SWITCHES.                                         00570001
005800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00580001
005900         88  PS-NO-ERROR                            VALUE 'Y'.    00590001
006000         88  PS-ERROR                               VALUE 'N'.    00600001
006100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00610001
006200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00620001
006300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00630001
006400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00640001
006500         88  PS-DONE                                VALUE 'Y'.    00650001
006600         88  PS-NOT-DONE                            VALUE 'N'.    00660001
006700     05  PS-END-OF-DC-SW                PIC  X(01)  VALUE 'N'.    00670001
006800         88  PS-END-OF-DC                           VALUE 'Y'.    00680001
006900         88  PS-NOT-END-OF-DC                       VALUE 'N'.    00690001
007000     05  PS-TABLE-OVERFLOW-SW           PIC  X(01)  VALUE 'N'.    00700001
007100         88  PS-TABLE-OVERFLOW                      VALUE 'Y'.    00710001
007200         88  PS-NOT-TABLE-OVERFLOW                  VALUE 'N'.    00720001
007300*                                                                 00730001
007400 01  PV-PROGRAM-VARIABLES.                                        00740001
007500                                                                  00750001
007600     05  PV-DC-COUNT                    PIC S9(09)  VALUE +0      00760001
007700                                                    COMP-3.       00770001
007800     05  PV-DC-REC-DATE                 PIC X(10).                00780001
007900     05  PV-ALLOC-DATE                  PIC X(10).                00790001
007910                                                                  00791001
007920    05  PV-NORMAL-TOTALS.                                         00792001
007930        10  FILLER                         PIC X(31).             00793001
007940        10  PV-TOT-ORD                     PIC ZZZZZ9.            00794001
007950        10  FILLER                         PIC X(01).             00795001
007960        10  PV-TOT-REC                     PIC ZZZZZ9.            00796001
007970        10  FILLER                         PIC X(03).             00797001
007980        10  PV-TOTRECPCT-X.                                       00798001
007990           15 PV-TREC-PCT                  PIC  ZZ9.              00799001
008000           15 PV-TREC-PCT-SIGN             PIC  X(01).            00800001
008001        10  FILLER                         PIC X(08).             00800101
008002                                                                  00800201
008003    05  PV-DC-TOTALS.                                             00800301
008004        10  PV-TOT-ORD2                    PIC ZZZZZ9.            00800401
008005        10  PV-TOT-REC2                    PIC ZZZZZ9.            00800501
008006        10  FILLER                         PIC X(02).             00800601
008007        10  PV-TOTRECPCT2-X.                                      00800701
008008           15 PV-TREC-PCT2                 PIC  ZZ9.              00800801
008009           15 PV-TREC-PCT-SIGN2            PIC  X(01).            00800901
008010        10  PV-TOT-DC1-ORD                 PIC ZZZZZZ.            00801001
008011        10  FILLER                         PIC X(01).             00801101
008012        10  PV-TOT-DC1-REC                 PIC ZZZZZZ.            00801201
008013        10  FILLER                         PIC X(01).             00801301
008014        10  PV-TOT-DC2-ORD                 PIC ZZZZZZ.            00801401
008015        10  FILLER                         PIC X(01).             00801501
008016        10  PV-TOT-DC2-REC                 PIC ZZZZZZ.            00801601
008017        10  FILLER                         PIC X(01).             00801701
008018        10  PV-TOT-DC3-ORD                 PIC ZZZZZZ.            00801801
008019        10  FILLER                         PIC X(01).             00801901
008020        10  PV-TOT-DC3-REC                 PIC ZZZZZZ.            00802001
008021                                                                  00802101
008022    05  PV-NORMAL-LINE.                                           00802201
008023     10  FILLER                         PIC  X(02).               00802301
008024     10  PV-DESC                        PIC  X(22).               00802401
008025     10  FILLER                         PIC  X(03).               00802501
008026                                                                  00802601
008027     10  PV-STATUS                      PIC  X(02).               00802701
008028     10  FILLER                         PIC  X(02).               00802801
008029                                                                  00802901
008030     10  PV-QTY-X.                                                00803001
008031         20 PV-QTY                      PIC  ZZZZZZ.              00803101
008032     10  FILLER                         PIC  X(01).               00803201
008033                                                                  00803301
008034     10  PV-REC-QTY-X.                                            00803401
008035         20 PV-REC-QTY                  PIC  ZZZZZZ.              00803501
008036     10  FILLER                         PIC  X(03).               00803601
008037                                                                  00803701
008038     10  PV-RECPCT-X.                                             00803801
008039         20 PV-REC-PCT                  PIC  ZZZ.                 00803901
008040         20 PV-REC-PCT-SIGN             PIC  X(01).               00804001
008041                                                                  00804101
008042 05  PV-DC1-LINE.                                                 00804201
008043     10  PV-QTY-DC-X.                                             00804301
008044         15 PV-QTY-DC                   PIC  ZZZZZZ.              00804401
008045                                                                  00804501
008046     10  PV-REC-QTY-DC-X.                                         00804601
008047         15 PV-REC-QTY-DC               PIC  ZZZZZZ.              00804701
008048     10  FILLER                         PIC  X(02).               00804801
008049                                                                  00804901
008050     10  PV-RECPCT-DC-X.                                          00805001
008051         15 PV-REC-PCT-DC               PIC  ZZZ.                 00805101
008052         15 PV-REC-PCT-SIGN-DC          PIC  X(01).               00805201
008053                                                                  00805301
008054     10  PV-DC1-X.                                                00805401
008055         15 PV-DC1                      PIC ZZZZZZ.               00805501
008056     10  FILLER                         PIC  X(01).               00805601
008057     10  PV-REC-DC1-X.                                            00805701
008058         15  PV-REC-DC1                 PIC ZZZZZZ.               00805801
008059     10  FILLER                         PIC  X(01).               00805901
008060     10  PV-DC2-X.                                                00806001
008061         15  PV-DC2                     PIC ZZZZZZ.               00806101
008062     10  FILLER                         PIC  X(01).               00806201
008063     10  PV-REC-DC2-X.                                            00806301
008064         15  PV-REC-DC2                 PIC ZZZZZZ.               00806401
008065     10  FILLER                         PIC  X(01).               00806501
008066     10  PV-DC3-X.                                                00806601
008067         15  PV-DC3                     PIC ZZZZZZ.               00806701
008068     10  FILLER                         PIC  X(01).               00806801
008069     10  PV-REC-DC3-X.                                            00806901
008070         15  PV-REC-DC3                 PIC ZZZZZZ.               00807001
008071     10  PV-STATUS-DC                    PIC  X(02).              00807101
008072                                                                  00807201
008073                                                                  00807301
008074     05  PV-HIT-SW                      PIC X(01)   VALUE 'N'.    00807401
008075     05  PV-SUB                         PIC S9(04)  VALUE +0      00807501
008076                                                    COMP SYNC.    00807601
008077     05  PV-DETERMINE-CNT               PIC S9(04)  VALUE +0      00807701
008078                                                    COMP SYNC.    00807801
008079     05  PV-DETERMINE-CNT1              PIC S9(04)  VALUE +0      00807901
008080                                                    COMP SYNC.    00808001
008081     05  PV-DETERMINE-CNTA              PIC S9(04)  VALUE +0      00808101
008082                                                    COMP SYNC.    00808201
008083     05  PV-DETERMINE-CNTB              PIC S9(04)  VALUE +0      00808301
008084                                                    COMP SYNC.    00808401
008085     05  PV-TEST-CNT                    PIC S9(04)  VALUE +0      00808501
008086                                                    COMP SYNC.    00808601
008087     05  PV-DETERMINE-ITEM              PIC S9(04)  VALUE +0      00808701
008088                                                    COMP SYNC.    00808801
008089     05  PV-DETERMINE-ITEM1             PIC S9(04)  VALUE +0      00808901
008090                                                    COMP SYNC.    00809001
008091     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00809101
008092                                                    COMP SYNC.    00809201
008093     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00809301
008094                                                    COMP-3.       00809401
008095     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00809501
008096                                                    COMP-3.       00809601
008097     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00809701
008098                                                    COMP-3.       00809801
008099     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00809901
008100                                                    COMP-3.       00810001
008200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00820001
008300                                                    COMP-3.       00830001
008400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00840001
008500                                                    COMP-3.       00850001
008600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00860001
008700                                                    COMP-3.       00870001
008800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00880001
008900                                                    COMP SYNC.    00890001
009000     05  PV-BLOCK-NUMBER-1              PIC S9(04)  VALUE +0      00900001
009100                                                    COMP SYNC.    00910001
009200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00920001
009300                                                    COMP SYNC.    00930001
009400     05  PV-ITEM                        PIC S9(04)  VALUE +0      00940001
009500                                                    COMP SYNC.    00950001
009600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00960001
009700                                                    COMP SYNC.    00970001
009800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00980001
009900                                                    COMP SYNC.    00990001
010000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01000001
010100                                                    COMP SYNC.    01010001
010200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01020001
010300                                                    COMP SYNC.    01030001
010400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01040001
010500                                                    COMP SYNC.    01050001
010600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01060001
010700                                                    COMP SYNC.    01070001
010800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01080001
010900                                                    COMP SYNC.    01090001
011000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01100001
011100                                                    COMP SYNC.    01110001
011200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01120001
011300                                                    COMP SYNC.    01130001
011400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01140001
011500                                                    COMP SYNC.    01150001
011600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01160001
011700                                                    COMP SYNC.    01170001
011800     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01180001
011900                                                    COMP-3.       01190001
012000     05  PV-DC-SPLIT-QTY                PIC S9(09)  VALUE +0      01200001
012100                                                    COMP.         01210001
012200     05  PV-DC-REC-QTY                  PIC S9(09)  VALUE +0      01220001
012300                                                    COMP.         01230001
012400     05  PV-DC-ORD-QTY                  PIC S9(09)  VALUE +0      01240001
012500                                                    COMP.         01250001
012600     05  PV-TOT-REC-QTY                 PIC S9(09)  VALUE +0      01260001
012700                                                    COMP.         01270001
012800     05  PV-QTY-NULL                    PIC S9(04)  VALUE +0      01280001
012900                                                    COMP.         01290001
013000     05  PV-TOT-REC-PCT                 PIC  S9(03)V99            01300001
013100                                                   COMP-3.        01310001
013200     05  PV-END-QTY-ORD                 PIC 9(06)  VALUE ZERO.    01320001
013300     05  PV-END-QTY-REC                 PIC 9(06)  VALUE ZERO.    01330001
013400     05  PV-NULL-INDICATORS.                                      01340001
013500         10 PV-MAJ-CL-NBR-IND           PIC S9(04) VALUE +0       01350001
013600                                                   COMP.          01360001
013700         10 PV-SUB-CL-NBR-IND           PIC S9(04) VALUE +0       01370001
013800                                                   COMP.          01380001
013900         10 PV-SKU-NBR-IND              PIC S9(04) VALUE +0       01390001
014000                                                   COMP.          01400001
014100         10 PV-SKU-DESC-IND             PIC S9(04) VALUE +0       01410001
014110                                                   COMP.          01411001
014120     05  PV-TEMP-SKU.                                             01412001
014130         10 PV-TEMP-SKU-DEPT            PIC 9(03)  VALUE 0.       01413001
014140         10 PV-TEMP-SKU-CLASS           PIC 9(02)  VALUE 0.       01414001
014150         10 PV-TEMP-SKU-SEQ             PIC 9(03)  VALUE 0.       01415001
014160     05  PV-SKU-NBR REDEFINES PV-TEMP-SKU                         01416001
014170                                        PIC 9(08).                01417001
014180     05  PV-MAJ-CL.                                               01418001
014190         10 PV-MAJ-CL-1                 PIC 9      VALUE 0.       01419001
014191         10 FILLER                      PIC 9      VALUE 0.       01419101
014192     05  PV-MAJ-CLASS REDEFINES PV-MAJ-CL                         01419201
014193                                        PIC 9(02).                01419301
014194******************************************************************01419401
014195**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01419501
014196**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01419601
014197**  APPLICATION-SPECIFIC COMMAREA.                              **01419701
014198******************************************************************01419801
014199 01  LQW-LIST-QUEUE-WORK-AREA.                                    01419901
014200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01420001
014300     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01430001
014400                                        INDEXED BY LQW-IDX.       01440001
014500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01450001
014600         10  LQW-LINE                   PIC  9(03).               01460001
014700         10  LQW-MCL                    PIC  9(02).               01470001
014800         10  LQW-SCL                    PIC  9(02).               01480001
014900         10  LQW-SKU                    PIC  9(08).               01490001
015000         10  LQW-DESC                   PIC  X(20).               01500001
015100         10  LQW-QTY                    PIC  9(06).               01510001
015200         10  LQW-STATUS                 PIC  X(02).               01520001
015300         10  LQW-REC-QTY                PIC  9(06).               01530001
015400         10  LQW-REC-PCT                PIC  S9(3)V99 COMP-3.     01540001
015500         10  LQW-DC                     PIC  9(06).               01550001
015600         10  LQW-REC-DC                 PIC  9(06).               01560001
015700                                                                  01570001
015800     EJECT                                                        01580001
015900                                                                  01590001
016000*---------------------------------------------------------------* 01600001
016100*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 01610001
016200*---------------------------------------------------------------* 01620001
016300                                                                  01630001
016310     COPY DPWS057.                                                01631001
016320                                                                  01632001
016330     EJECT                                                        01633001
016340*---------------------------------------------------------------* 01634001
016350*    MAP LAYOUT                                                 * 01635001
016360*---------------------------------------------------------------* 01636001
016370                                                                  01637001
016380     COPY POKM130.                                                01638001
016390*                                                                 01639001
016400 01  MR-OCCURS-LAYOUT                   REDEFINES  PO130AO.       01640001
016500     05  FILLER                         PIC X(104).               01650002
016600                                                                  01660001
016700     05  MR-HEAD1L             PIC S9(04) COMP.                   01670001
016800     05  MR-HEAD1A             PIC  X(01).                        01680001
016900     05  MR-HEAD1C             PIC  X(01).                        01690001
017000     05  MR-HEAD1H             PIC  X(01).                        01700001
017100     05  MR-HEAD1              PIC  X(59).                        01710001
017200                                                                  01720001
017300     05  MR-HEAD2L             PIC S9(04) COMP.                   01730001
017301     05  MR-HEAD2A             PIC  X(01).                        01730101
017302     05  MR-HEAD2C             PIC  X(01).                        01730201
017303     05  MR-HEAD2H             PIC  X(01).                        01730301
017304     05  MR-HEAD2              PIC  X(59).                        01730401
017305                                                                  01730501
017306     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          01730601
017307                                                                  01730701
017308         10  MR-LINEL                   PIC S9(04) COMP.          01730801
017309         10  MR-LINEA                   PIC  X(01).               01730901
017310         10  MR-LINEC                   PIC  X(01).               01731001
017311         10  MR-LINEH                   PIC  X(01).               01731101
017312         10  MR-LINE-X.                                           01731201
017313             15 MR-LINE                 PIC ZZZ.                  01731301
017314                                                                  01731401
017315         10  MR-MCLL                    PIC S9(04) COMP.          01731501
017316         10  MR-MCLA                    PIC  X(01).               01731601
017317         10  MR-MCLC                    PIC  X(01).               01731701
017318         10  MR-MCLH                    PIC  X(01).               01731801
017319         10  MR-MCL                     PIC  X(02).               01731901
017320                                                                  01732001
017330         10  MR-SCLL                    PIC S9(04) COMP.          01733001
017340         10  MR-SCLA                    PIC  X(01).               01734001
017350         10  MR-SCLC                    PIC  X(01).               01735001
017360         10  MR-SCLH                    PIC  X(01).               01736001
017370         10  MR-SCL                     PIC  X(02).               01737001
017380*                                                                 01738001
017390         10  MR-SKU-NBRL                PIC S9(04) COMP.          01739001
017400         10  MR-SKU-NBRA                PIC  X(01).               01740001
017500         10  MR-SKU-NBRC                PIC  X(01).               01750001
017600         10  MR-SKU-NBRH                PIC  X(01).               01760001
017700         10  MR-SKU-NBR                 PIC  X(08).               01770001
017800                                                                  01780001
017900         10  MR-LINE-AREAL              PIC S9(04) COMP.          01790001
018000         10  MR-LINE-AREAA              PIC  X(01).               01800001
018100         10  MR-LINE-AREAC              PIC  X(01).               01810001
018200         10  MR-LINE-AREAH              PIC  X(01).               01820001
018300         10  MR-LINE-AREA               PIC  X(59).               01830001
018400                                                                  01840001
018500     05  MR-TOTAL-LINEL             PIC S9(04) COMP.              01850001
018600     05  MR-TOTAL-LINEA             PIC  X(01).                   01860001
018700     05  MR-TOTAL-LINEC             PIC  X(01).                   01870001
018800     05  MR-TOTAL-LINEH             PIC  X(01).                   01880001
018900     05  MR-TOTAL-LINE              PIC  X(59).                   01890001
019000                                                                  01900001
019100     EJECT                                                        01910001
019200*---------------------------------------------------------------* 01920001
019300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01930001
019400*---------------------------------------------------------------* 01940001
019500                                                                  01950001
019600     COPY DPWS015.                                                01960001
019700                                                                  01970001
019800*---------------------------------------------------------------* 01980001
019900*    FUNCTION KEYS COPYBOOK.                                    * 01990001
020000*---------------------------------------------------------------* 02000001
020100                                                                  02010001
020200     COPY DPWS016.                                                02020001
020300                                                                  02030001
020400*---------------------------------------------------------------* 02040001
020500*    NUMERIC EDIT LAYOUT.                                       * 02050001
020600*---------------------------------------------------------------* 02060001
020700                                                                  02070001
020800     COPY DPWS010I.                                               02080001
020900 EJECT                                                            02090001
021000*---------------------------------------------------------------* 02100001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02110006
021200*---------------------------------------------------------------* 02120001
021300                                                                  02130001
021400     COPY DPWS030.                                                02140001
CICS       COPY DPWS930.                                                02141006
021500 EJECT                                                            02150001
021600*---------------------------------------------------------------* 02160001
021700*    STANDARD COMMAREA.                                         * 02170001
021800*---------------------------------------------------------------* 02180001
021900                                                                  02190001
022000     COPY DPWS020.                                                02200001
022100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02210001
022200                                                                  02220001
022300*---------------------------------------------------------------* 02230001
022400* INTER-APPLICATION COMMAREA.                                   * 02240001
022500*---------------------------------------------------------------* 02250001
022600                                                                  02260001
022700         10  INTER-APPL-COMM-AREA       PIC X(200).               02270001
022800     COPY POWS011.                                                02280001
022900*---------------------------------------------------------------* 02290001
023000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02300001
023100*---------------------------------------------------------------* 02310001
023200         10  ASC-SPECIFIC-COMMAREA.                               02320001
023300             15  ASC-LIST-KEYS.                                   02330001
023400                 20  ASC-KEY-PO-NUMBER               PIC S9(09)   02340001
023500                                                     COMP.        02350001
023600                 20  ASC-KEY-DEPT                    PIC X(03).   02360001
023700                 20  ASC-KEY-VENDOR                  PIC X(30).   02370001
023800                 20  ASC-TOT-ORD                     PIC S9(09)   02380001
023900                                                         COMP-3.  02390001
024000                 20  ASC-TOT-REC                     PIC S9(09)   02400001
024100                                                         COMP-3.  02410001
024200                 20  ASC-TOT-PCT                     PIC X(4).    02420001
024300                 20  FILLER REDEFINES ASC-TOT-PCT.                02430001
024400                     25  ASC-TOT-PCT-N               PIC  9(03).  02440001
024500                     25  ASC-TOT-PCT-SIGN            PIC  X(01).  02450001
024600                                                                  02460001
024700             15  ASC-DC-ORD OCCURS 10 TIMES.                      02470001
024800                 20  ASC-TOT-DC-ORD          PIC S9(09) COMP-3.   02480001
024900             15  ASC-DC-REC OCCURS 10 TIMES.                      02490001
025000                 20  ASC-TOT-DC-REC          PIC S9(09) COMP-3.   02500001
025100                                                                  02510001
025200* IF NUMBER OF DC'S INCREASES JUST CHANGE CODE THAT RUNS WHEN     02520001
025300*   PF24 IS HIT.                                                  02530001
025400            15  ASC-DC-TABLE OCCURS 10 TIMES.                     02540001
025500                20 ASC-DC-NBR                    PIC S9(4)        02550001
025600                                                 COMP SYNC.       02560001
025700                20 ASC-DC-NAME                   PIC X(5).        02570001
025800                                                                  02580001
025900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02590001
026000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02600001
026100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02610001
026200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02620001
026300                                                                  02630001
026400                 20  ASC-ITEM-ARRAY.                              02640001
026500                     25  ASC-ITEM-ENTRIES OCCURS 07 TIMES.        02650001
026600                         30  ASC-LIST-ITEM-NUMBER                 02660001
026700                                          PIC S9(09) COMP-3.      02670001
026800                         30  ASC-LINE                PIC  9(03).  02680001
026900                         30  ASC-MCL                 PIC  9(02).  02690001
027000                         30  ASC-SCL                 PIC  9(02).  02700001
027100                         30  ASC-SKU                 PIC  9(08).  02710001
027200                         30  ASC-DESC                PIC  X(20).  02720001
027300                         30  ASC-QTY                 PIC  9(06).  02730001
027400                         30  ASC-STATUS              PIC  X(02).  02740001
027500                         30  ASC-REC-QTY             PIC  9(06).  02750001
027600                         30  ASC-REC-PCT             PIC S9(03)V9902760001
027700                                                         COMP-3.  02770001
027800                     30 ASC-DC-ARRAY.                             02780001
027900                         35  ASC-DC-QTY OCCURS 10 TIMES.          02790001
028000                           40  ASC-DC                  PIC  9(06).02800001
028100                           40  ASC-REC-DC              PIC  9(06).02810001
028200                                                                  02820001
028300             15  ASC-BLK-SUB                         PIC S9(04)   02830001
028400                                                          COMP    02840001
028500                                                          SYNC.   02850001
028600             15  ASC-ITEM-SUB                        PIC S9(04)   02860001
028700                                                          COMP    02870001
028800                                                          SYNC.   02880001
028900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02890001
029000                                                          COMP-3. 02900001
029100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02910001
029200                                                          COMP-3. 02920001
029300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02930001
029400                                                          COMP    02940001
029500                                                          SYNC.   02950001
029600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02960001
029700                                                          COMP-3. 02970001
029800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02980001
029900                                                          COMP-3. 02990001
030000             15  ASC-DC-END-SW                       PIC  X(01).  03000001
030100                 88  ASC-DC-END                      VALUE 'Y'.   03010001
030200                 88  ASC-NOT-DC-END                  VALUE 'N'.   03020001
030300             15  ASC-DISPLAY-SW                      PIC X(01).   03030001
030400                 88  ASC-DISPLAY-QTY                 VALUE 'Q'.   03040001
030500                 88  ASC-DISPLAY-DC                  VALUE 'F'.   03050001
030600             15  ASC-NEXT-DC-SW                      PIC X(01).   03060001
030700                 88  ASC-MORE-DC                     VALUE 'Q'.   03070001
030800                 88  ASC-NO-MORE-DC                  VALUE 'F'.   03080001
030900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03090001
031000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03100001
031100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03110001
031200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03120001
031300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03130001
031400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03140001
031500             15  ASC-LIST-QUEUE-NAME.                             03150001
031600                 20  ASC-LIST-TERM-ID                PIC  X(04).  03160001
031700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03170001
031800                                                          COMP-3. 03180001
031900                 20  ASC-LIST-SEQ                    PIC  9(01).  03190001
032000             15  ASC-SEL-QUEUE-NAME.                              03200001
032100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03210001
032200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03220001
032300                                                          COMP-3. 03230001
032400                 20  ASC-SEL-SEQ                     PIC  9(01).  03240001
032500                 20  ASC-DC-COUNTER        PIC S9(09) COMP.       03250001
032600                 20  ASC-DC-COUNTER-DC     PIC S9(04) COMP.       03260001
032700                                                                  03270001
032800             15  ASC-START-ITEM-REQUEST.                          03280001
032900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03290001
033000         10  FILLER                                  PIC  X(96).  03300001
033100                                                                  03310001
033200     EJECT                                                        03320001
033300*---------------------------------------------------------------* 03330001
033400*    ABEND PROCESSING COPYBOOK.                                 * 03340001
033500*---------------------------------------------------------------* 03350001
033600                                                                  03360001
033700     COPY DPWS013.                                                03370001
033800                                                                  03380001
033900 EJECT                                                            03390001
034000*---------------------------------------------------------------* 03400001
034100*    DB2 AREA FOR TPURCHS                                       * 03410001
034200*---------------------------------------------------------------* 03420001
034300     EXEC SQL                                                     03430001
034400          INCLUDE TPURCHS                                         03440001
034500     END-EXEC.                                                    03450001
034600*---------------------------------------------------------------* 03460001
034700*    DB2 AREA FOR TPURITM                                       * 03470001
034800*---------------------------------------------------------------* 03480001
034900     EXEC SQL                                                     03490001
035000          INCLUDE TPURITM                                         03500001
035100     END-EXEC.                                                    03510001
035200*---------------------------------------------------------------* 03520001
035300*    DB2 AREA FOR TALLPLN                                       * 03530001
035400*---------------------------------------------------------------* 03540001
035500     EXEC SQL                                                     03550001
035600          INCLUDE TALLPLN                                         03560001
035700     END-EXEC.                                                    03570001
035800*---------------------------------------------------------------* 03580001
035900*    DB2 AREA FOR TENTNME                                       * 03590001
036000*---------------------------------------------------------------* 03600001
036100     EXEC SQL                                                     03610001
036200          INCLUDE TENTNME                                         03620001
036300     END-EXEC.                                                    03630001
036400*---------------------------------------------------------------* 03640001
036500*    DB2 AREA FOR TRECITM                                       * 03650001
036600*---------------------------------------------------------------* 03660001
036700     EXEC SQL                                                     03670001
036800          INCLUDE TRECITM                                         03680001
036900     END-EXEC.                                                    03690001
037000*---------------------------------------------------------------* 03700001
037100*    DB2 AREA FOR TRECDIS                                       * 03710001
037200*---------------------------------------------------------------* 03720001
037300     EXEC SQL                                                     03730001
037400          INCLUDE TRECDIS                                         03740001
037500     END-EXEC.                                                    03750001
037600*---------------------------------------------------------------* 03760001
037700*    DB2 AREA FOR LOCATION                                      * 03770001
037800*---------------------------------------------------------------* 03780001
037900     EXEC SQL                                                     03790001
038000          INCLUDE XMT00001                                        03800001
038100     END-EXEC.                                                    03810001
038200                                                                  03820001
038300*---------------------------------------------------------------* 03830001
038400*    DB2 AREA FOR DC LOCATION ASSIGNMENT                        * 03840001
038500*---------------------------------------------------------------* 03850001
038600     EXEC SQL                                                     03860001
038700          INCLUDE XMT00002                                        03870001
038800     END-EXEC.                                                    03880001
038900*---------------------------------------------------------------* 03890001
039000*    DB2 AREA FOR TPLNSHP                                       * 03900001
039100*---------------------------------------------------------------* 03910001
039200     EXEC SQL                                                     03920001
039300          INCLUDE TPLNSHP                                         03930001
039400     END-EXEC.                                                    03940001
039500*---------------------------------------------------------------* 03950001
039600*    DB2 AREA FOR XLT_SKU TABLE                                   03960001
039700*---------------------------------------------------------------* 03970001
039800                                                                  03980001
039900     EXEC SQL                                                     03990001
040000         INCLUDE XLT00003                                         04000001
040100     END-EXEC.                                                    04010001
040200*---------------------------------------------------------------* 04020001
040300*    DB2 AREA FOR XLT_VND_STYL TABLE                              04030001
040400*---------------------------------------------------------------* 04040001
040500                                                                  04050001
040510     EXEC SQL                                                     04051001
040520         INCLUDE XLT00004                                         04052001
040530     END-EXEC.                                                    04053001
040540*---------------------------------------------------------------* 04054001
040550*    DB2 AREA FOR TUPCPLS                                         04055001
040560*---------------------------------------------------------------* 04056001
040570                                                                  04057001
040580     EXEC SQL                                                     04058001
040590         INCLUDE TUPCPLS                                          04059001
040591     END-EXEC.                                                    04059101
040592*---------------------------------------------------------------* 04059201
040593*    DB2 AREA FOR TWEBITM                                         04059301
040594*---------------------------------------------------------------* 04059401
040595                                                                  04059501
040596     EXEC SQL                                                     04059601
040597         INCLUDE TWEBITM                                          04059701
040598     END-EXEC.                                                    04059801
040599*---------------------------------------------------------------* 04059901
040600*    DB2 AREA FOR COMMUNICATIONS                                * 04060001
040601*---------------------------------------------------------------* 04060101
040602     EXEC SQL                                                     04060201
040603          INCLUDE SQLCA                                           04060301
040604     END-EXEC.                                                    04060401
040605*---------------------------------------------------------------* 04060501
040606*    TPURITM CURSOR                                             * 04060601
040607*---------------------------------------------------------------* 04060701
040608                                                                  04060801
040609     EXEC SQL                                                     04060901
040610          DECLARE LINE-CSR1  CURSOR                               04061001
040620          FOR SELECT                                              04062001
040630                A.PO_NBR,                                         04063001
040640                A.TOT_UNT_QTY,                                    04064001
040650                A.STATUS_CDE,                                     04065001
040660                B.STATUS_CDE,                                     04066001
040670                B.APP_PO_LNE_NBR,                                 04067001
040680                B.PO_LNE_NBR,                                     04068001
040690                D.MAJ_CL_NBR,                                     04069001
040700                D.SUB_CL_NBR,                                     04070001
040800                C.SKU_NBR,                                        04080001
040900                C.SKU_DESC,                                       04090001
041000                B.CL_NBR,                                         04100001
041100                B.SKU_SEQ_NBR,                                    04110001
041200                B.SKU_DESC,                                       04120001
041300                B.UNT_QTY                                         04130001
041400          FROM                                                    04140001
041500                TPURCHS A,                                        04150001
041600                TPURITM B                                         04160001
041700          LEFT OUTER JOIN                                         04170001
041800                XLT_SKU C                                         04180001
041900          ON    B.ITM_NBR = C.ITM_NBR                             04190001
042000          LEFT OUTER JOIN                                         04200001
042100                XLT_VND_STYL D                                    04210001
042200          ON    C.STYL_ID = D.STYL_ID                             04220001
042300          WHERE                                                   04230001
042400                 A.PO_NBR         = :PURCHS-PO-NBR                04240001
042500            AND  A.VER_STATUS_CDE = 'A'                           04250001
042600            AND  A.PO_NBR         = B.PO_NBR                      04260001
042700            AND  B.VER_STATUS_CDE = A.VER_STATUS_CDE              04270001
042800          ORDER BY                                                04280001
042900                5, 6                                              04290001
043000     END-EXEC.                                                    04300001
043100                                                                  04310001
043200*---------------------------------------------------------------* 04320001
043300*    DC CURSOR                                                  * 04330001
043400*---------------------------------------------------------------* 04340001
043500     EXEC SQL                                                     04350001
043600          DECLARE DC-CSR CURSOR FOR                               04360001
043700          SELECT XL.LOC_NBR,                                      04370001
043800                 XL.LOC_5_ABBR_NM                                 04380001
043900            FROM XMT_LOC XL                                       04390001
044000           WHERE LOC_TYP_CDE = 'DC'                               04400001
044100             AND CLO_DTE > CURRENT DATE                           04410001
044200             AND XL.LOC_NBR > :DK-LAST-DC                         04420001
044300             AND XL.LOC_NBR =                                     04430001
044400                (SELECT DC_NBR                                    04440001
044500                   FROM XMT_DC_LOC_ASGMT DLA1                     04450001
044600                  WHERE DLA1.LOC_NBR = XL.LOC_NBR                 04460001
044700                    AND DLA1.PO_STRT_DTE =                        04470001
044800                       (SELECT MAX(PO_STRT_DTE)                   04480001
044900                          FROM XMT_DC_LOC_ASGMT DLA2              04490001
045000                         WHERE DLA2.PO_STRT_DTE <= :PV-DC-REC-DATE04500001
045100                           AND DLA1.LOC_NBR = DLA2.LOC_NBR))      04510001
045200                  ORDER BY XL.LOC_NBR                             04520001
045300     END-EXEC.                                                    04530001
045400                                                                  04540001
045500 EJECT                                                            04550001
045600 LINKAGE SECTION.                                                 04560001
045610                                                                  04561001
045620 01  DFHCOMMAREA.                                                 04562001
045630     05  FILLER                         OCCURS  1 TO 4072 TIMES   04563001
045640                                        DEPENDING ON EIBCALEN.    04564001
045641         10  FILLER                     PIC X.                    04564101
045642                                                                  04564201
045643 EJECT                                                            04564301
045644 PROCEDURE DIVISION.                                              04564401
045645******************************************************************04564501
045646**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04564601
045647**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04564701
045648**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04564801
045649******************************************************************04564901
045650 0000-MAIN-MODULE.                                                04565001
045660     INITIALIZE DP030-CICS-API-FIELDS.                            04566001
045670     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04567001
045680     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04568001
045690     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04569001
045700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04570001
045800     MOVE LENGTH OF PO130AI        TO DP030-MAP-LENGTH (1).       04580001
045900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04590001
046000     PERFORM 0001-CALL-CICS-ARCH-API.                             04600001
046100     MOVE 'POKCS130' TO PO011-LAST-PROGRAM.                       04610001
046200*                                                                 04620001
046300     PERFORM 1000-CONTROL-PROCESSING                              04630001
046400*                                                                 04640001
046500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04650001
046600     PERFORM 0001-CALL-CICS-ARCH-API.                             04660001
046700                                                                  04670001
046800******************************************************************04680001
046900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04690001
047000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04700001
047100******************************************************************04710001
047200 0001-CALL-CICS-ARCH-API.                                         04720001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04730006
047400                                    DFHCOMMAREA                   04740006
047500                                    DP030-CICS-API-FIELDS         04750006
047600                                    DP020-STANDARD-COMMAREA       04760006
047700                                    PO130AI.                      04770006
047800*                                                                 04780001
047900     IF  DP030-RC-CALL-SUCCESSFUL                                 04790001
048000         CONTINUE                                                 04800001
048100     ELSE                                                         04810001
048200         SET DP013-NO-ROLLBACK                                    04820001
048300             DP013-XCTL-DISPLAY-RESTART                           04830001
048400             DP013-CICS-ABEND      TO TRUE                        04840001
048500         MOVE '0001-CALL-CICS-ARCH-API'                           04850001
048600                                   TO DP013-PARAGRAPH             04860001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04870006
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04880006
048900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04890001
049000         PERFORM DP013-0000-PROCESS-ABEND                         04900001
049100     END-IF.                                                      04910001
049200*----------------------------------------------------------------*04920001
049300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04930001
049400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04940001
049500*                                                                *04950001
049600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04960001
049700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04970001
049800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04980001
049900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04990001
050000*----------------------------------------------------------------*05000001
050100                                                                  05010001
050200 1000-CONTROL-PROCESSING.                                         05020001
050300                                                                  05030001
050400     EVALUATE TRUE                                                05040001
050500         WHEN DP020-NEXT-ACT-INITIAL                              05050001
050600             INITIALIZE ASC-SPECIFIC-COMMAREA                     05060001
050700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05070001
050800                                      ASC-SEL-TERM-ID             05080001
050900             MOVE DP020-SRC-TASK-NUMBER                           05090001
051000                                   TO ASC-LIST-TASK-NUMBER        05100001
051100                                      ASC-SEL-TASK-NUMBER         05110001
051200             MOVE PC-LIST-QUEUE-SEQ                               05120001
051300                                   TO ASC-LIST-SEQ                05130001
051400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05140001
051500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05150001
051600***-----$TEMPLATE NOTE$-------------------------------------------05160001
051700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05170001
051800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05180001
051900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05190001
052000***---------------------------------------------------------------05200001
052100             IF  PS-COMMAREA-NOT-VALID                            05210001
052200***              MOVE PC-TSYMSG-99901                             05220001
052300***                                TO DP020-MSG-NUMBER            05230001
052400***              SET DP020-MSG-FATAL                              05240001
052500***                                TO TRUE                        05250001
052600                 SET DP020-NEXT-ACT-APPL-ERROR                    05260001
052700                                   TO TRUE                        05270001
052800             ELSE                                                 05280001
052900                 PERFORM 1200-LOAD-DC-TABLE                       05290001
053000                 PERFORM 4000-BUILD-INITIAL-PANEL                 05300001
053100                 PERFORM 3200-RESET-ATTRIBUTES                    05310001
053200                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             05320001
053300                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               05330001
053400             END-IF                                               05340001
053500                                                                  05350001
053600         WHEN DP020-NEXT-ACT-RETURN                               05360001
053610             MOVE ZEROS TO PO011-LAST-PO-LNE-NBR                  05361001
053620             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05362001
053630                                   TO PV-TOP-ITEM                 05363001
053640             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05364001
053650             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05365001
053660             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05366001
053670                                                                  05367001
053680         WHEN DP020-NEXT-ACT-READ-MAP                             05368001
053690             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05369001
053700                                   TO PV-TOP-ITEM                 05370001
053800             PERFORM 2000-PROCESS-PANEL                           05380001
053900                                                                  05390001
054000         WHEN OTHER                                               05400001
054100             SET DP013-LOGIC-ABEND TO TRUE                        05410001
054200             SET DP013-NO-ROLLBACK TO TRUE                        05420001
054300             MOVE '1000-CONTROL-PROCESSING'                       05430001
054400                                   TO DP013-PARAGRAPH             05440001
054500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05450001
054600                                   TO DP013-MESSAGE-TEXT(1)       05460001
054700             PERFORM DP013-0000-PROCESS-ABEND                     05470001
054800     END-EVALUATE.                                                05480001
054900                                                                  05490001
055000 EJECT                                                            05500001
055100*----------------------------------------------------------------*05510001
055200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05520001
055300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05530001
055400*----------------------------------------------------------------*05540001
055500                                                                  05550001
055600 1100-PROCESS-INTER-APPL-COMM.                                    05560001
055700                                                                  05570001
055800     SET PS-COMMAREA-VALID         TO TRUE.                       05580001
055900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05590001
056000     MOVE PO011-PO-NBR             TO ASC-KEY-PO-NUMBER           05600001
056100                                      DK-PO-NUMBER.               05610001
056200     IF PO011-PO-NBR = 0                                          05620001
056300         SET PS-COMMAREA-NOT-VALID TO TRUE                        05630001
056400     END-IF.                                                      05640001
056500 EJECT                                                            05650001
056600                                                                  05660001
056700*----------------------------------------------------------------*05670001
056800* LOADS A DC TABLE WITH ALL OF THE VALID DC NAMES.               *05680001
056900*----------------------------------------------------------------*05690001
057000 1200-LOAD-DC-TABLE.                                              05700001
057100                                                                  05710001
057200     SET PS-NOT-END-OF-DC TO TRUE.                                05720001
057300     SET PS-NOT-TABLE-OVERFLOW TO TRUE.                           05730001
057400                                                                  05740001
057500     PERFORM 1210-GET-DONT-SHIP-BEF-DTE.                          05750001
057600                                                                  05760001
057700     IF PLNSHP-DONT-SHIP-BEF-DTE > PV-ALLOC-DATE                  05770001
057800         MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-DC-REC-DATE          05780001
057900     ELSE                                                         05790001
058000         MOVE PV-ALLOC-DATE TO PV-DC-REC-DATE                     05800001
058100     END-IF.                                                      05810001
058110                                                                  05811001
058111     MOVE PO011-LAST-DC-LOC-NBR TO DK-LAST-DC.                    05811101
058112                                                                  05811201
058113     MOVE ZEROS TO ASC-DC-COUNTER-DC.                             05811301
058114                                                                  05811401
058115     PERFORM 4010-OPEN-DC-CSR.                                    05811501
058116     PERFORM 4015-PROCESS-DC-CSR.                                 05811601
058117     PERFORM 4020-CLOSE-DC-CSR.                                   05811701
058118                                                                  05811801
058119*    IF PS-TABLE-OVERFLOW                                         05811901
058120*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    05812001
058121*        SET DP020-MSG-FATAL TO TRUE                              05812101
058122*        MOVE PC-TSYMSG-00994 TO DP020-MSG-NUMBER                 05812201
058123*    END-IF.                                                      05812301
058124                                                                  05812401
058125*    IF PV-DC-COUNT = ZEROS                                       05812501
058126     IF ASC-DC-COUNTER-DC = ZEROS                                 05812601
058127         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    05812701
058128         SET DP020-MSG-WARNING TO TRUE                            05812801
058129         MOVE PC-TSYMSG-03487 TO DP020-MSG-NUMBER                 05812901
058130     END-IF.                                                      05813000
058140 EJECT                                                            05814001
058150*----------------------------------------------------------------*05815000
058151* RETRIEVE DO NOT SHIP BEFORE DATE TO USE IN VALIDATING A DC     *05815100
058152*----------------------------------------------------------------*05815200
058153 1210-GET-DONT-SHIP-BEF-DTE.                                      05815300
058154                                                                  05815400
058155     PERFORM                                                      05815500
058156         WITH TEST AFTER                                          05815600
058157         VARYING PV-RETRY-COUNTER                                 05815700
058158         FROM 1 BY 1                                              05815800
058159         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05815900
058160             OR (SQLCODE = ZERO))                                 05816000
058161                                                                  05816100
058162             EXEC SQL                                             05816200
058163                 SELECT DONT_SHIP_BEF_DTE,                        05816300
058164                        CURRENT DATE                              05816400
058165                 INTO :PLNSHP-DONT-SHIP-BEF-DTE,                  05816500
058166                      :PV-ALLOC-DATE                              05816600
058167                 FROM TPLNSHP                                     05816700
058168                 WHERE PO_NBR = :ASC-KEY-PO-NUMBER                05816800
058169                   AND VER_STATUS_CDE = 'A'                       05816900
058170             END-EXEC                                             05817000
058171                                                                  05817100
058172         EVALUATE TRUE                                            05817200
058173             WHEN SQLCODE = ZERO                                  05817300
058174             WHEN SQLCODE = -904                                  05817400
058175             WHEN SQLCODE = -913                                  05817500
058176                 CONTINUE                                         05817600
058177             WHEN SQLWARN0 NOT = SPACES                           05817700
058178             WHEN SQLCODE < ZERO                                  05817800
058179             WHEN SQLCODE > ZERO                                  05817900
058180                 MOVE '1210-GET-DONT-SHIP-BEF-DTE'                05818000
058181                                   TO DP013-PARAGRAPH             05818100
058182                 MOVE 'SQL ERROR SELECTING PO'                    05818200
058183                                   TO DP013-MESSAGE-TEXT (1)      05818300
058184                 MOVE SQLCA        TO DP013-SQLCA                 05818400
058185                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    05818500
058186                 SET DP013-DB2-ABEND                              05818600
058187                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05818700
058188                 PERFORM DP013-0000-PROCESS-ABEND                 05818800
058189         END-EVALUATE                                             05818900
058190     END-PERFORM.                                                 05819000
058191*                                                                 05819100
058192     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05819200
058193         MOVE '1210-GET-DONT-SHIP-BEF-DTE'                        05819300
058194                                   TO DP013-PARAGRAPH             05819400
058195         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  05819500
058196                                   TO DP013-MESSAGE-TEXT (1)      05819600
058197         MOVE SQLCA                TO DP013-SQLCA                 05819700
058198         MOVE 'TPLNSHP '           TO DP013-DB2-TABLE-NAME (1)    05819800
058199         SET DP013-DB2-ABEND                                      05819900
058200             DP013-XCTL-DISPLAY-RESTART                           05820000
058201                                   TO TRUE                        05820100
058202         PERFORM DP013-0000-PROCESS-ABEND                         05820200
058203     END-IF.                                                      05820300
058204                                                                  05820400
058205 EJECT                                                            05820500
058206*----------------------------------------------------------------*05820600
058207* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05820700
058208* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05820800
058209* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05820900
058210* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05821000
058211* FUNCTION KEYS CAN GET THIS FAR.                                *05821100
058212*----------------------------------------------------------------*05821200
058213                                                                  05821300
058214 2000-PROCESS-PANEL.                                              05821400
058215     EVALUATE TRUE                                                05821500
058216         WHEN DP020-SRC-AID = DP016-CLEAR                         05821600
058217             SET ASC-DISPLAY-QTY TO TRUE                          05821700
058218             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05821800
058219             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05821900
058220             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05822000
058230             PERFORM 3200-RESET-ATTRIBUTES                        05823000
058240                                                                  05824000
058250         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05825000
058260             SET ASC-DISPLAY-QTY TO TRUE                          05826000
058270             MOVE ASC-KEY-PO-NUMBER                               05827000
058280                                   TO DK-PO-NUMBER                05828000
058290             PERFORM 2050-DELETE-LIST-QUEUE                       05829000
058300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05830000
058400             PERFORM 4000-BUILD-INITIAL-PANEL                     05840000
058500             PERFORM 3200-RESET-ATTRIBUTES                        05850000
058600                                                                  05860000
058700         WHEN OTHER                                               05870000
058800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05880000
058900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05890000
059000             IF  PS-NO-ERROR                                      05900000
059100                 SET DP030-CONTINUE-GO                            05910000
059200                                 TO TRUE                          05920000
059300                 PERFORM 2100-CHECK-FUNCTION-KEY                  05930000
059400             ELSE                                                 05940000
059500                 SET DP030-OVERRIDE-GO                            05950000
059600                                 TO TRUE                          05960000
059700             END-IF                                               05970000
059800     END-EVALUATE.                                                05980000
059900 EJECT                                                            05990000
060000*----------------------------------------------------------------*06000000
060100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06010000
060200*----------------------------------------------------------------*06020000
060300 2050-DELETE-LIST-QUEUE.                                          06030000
060400                                                                  06040000
060500     EXEC CICS                                                    06050000
060600         DELETEQ TS                                               06060000
060700             QUEUE (ASC-LIST-QUEUE-NAME)                          06070000
060800             RESP  (PV-CICS-RESP)                                 06080000
060900     END-EXEC.                                                    06090000
061000                                                                  06100000
061100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06110000
061200        (PV-CICS-RESP = DFHRESP(QIDERR))                          06120000
061300         CONTINUE                                                 06130000
061400     ELSE                                                         06140000
061500         SET DP013-CICS-ABEND      TO TRUE                        06150000
061600         SET DP013-NO-ROLLBACK     TO TRUE                        06160000
061700                                                                  06170000
061800         MOVE '2050-DELETE-LIST-QUEUE'                            06180000
061900                                   TO DP013-PARAGRAPH             06190000
062000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06200000
062100                                   TO DP013-MESSAGE-TEXT (1)      06210000
062200         PERFORM DP013-0000-PROCESS-ABEND                         06220000
062300     END-IF.                                                      06230000
062400                                                                  06240000
062500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06250000
062600 EJECT                                                            06260000
062700*----------------------------------------------------------------*06270000
062800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06280000
062900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06290000
063000* CICS ARCHITECTURE API.                                         *06300000
063100*----------------------------------------------------------------*06310000
063200 2100-CHECK-FUNCTION-KEY.                                         06320000
063300     EVALUATE TRUE                                                06330000
063400                                                                  06340000
063500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06350000
063600             MOVE +1               TO PV-TOP-ITEM                 06360000
063700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06370000
063800             PERFORM 3200-RESET-ATTRIBUTES                        06380000
063900                                                                  06390000
064000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06400000
064100             PERFORM 2110-BROWSE-BACKWARD                         06410000
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06420000
064300             PERFORM 3200-RESET-ATTRIBUTES                        06430000
064400                                                                  06440000
064500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06450000
064600             PERFORM 2120-BROWSE-FORWARD                          06460000
064700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06470000
064800             PERFORM 3200-RESET-ATTRIBUTES                        06480000
064900                                                                  06490000
065000         WHEN DP020-SRC-AID = DP016-ENTER                         06500000
065100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06510000
065200             IF  PS-ERROR                                         06520000
065300                 CONTINUE                                         06530000
065400             ELSE                                                 06540000
065500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06550000
065600                 PERFORM 3200-RESET-ATTRIBUTES                    06560000
065700             END-IF                                               06570000
065800* PF23 WAS HIT (SCROLL LEFT)                                      06580000
065900         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               06590000
066000           SUBTRACT +3 FROM ASC-DC-COUNTER                        06600000
066100           IF ASC-DC-COUNTER < 1                                  06610000
066200               MOVE PC-TSYMSG-00227 TO DP020-MSG-NUMBER           06620000
066300               SET DP020-MSG-INFORMATIONAL TO TRUE                06630000
066400               SET ASC-DISPLAY-QTY TO TRUE                        06640000
066500             IF ASC-DC-COUNTER < -2                               06650000
066600               ADD +3 TO ASC-DC-COUNTER                           06660000
066700             END-IF                                               06670000
066800           END-IF                                                 06680000
066900           MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM           06690000
066910           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   06691000
066911           PERFORM 3200-RESET-ATTRIBUTES                          06691100
066912                                                                  06691200
066913* PF24 WAS HIT (SCROLL RIGHT)                                     06691300
066914* IF TENTH DC IS ADDED JUST INCREASE 7 TO 10 IN THIS PARAGRAPH    06691400
066915         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               06691500
066916         IF ASC-MORE-DC                                           06691600
066917           ADD +3 TO ASC-DC-COUNTER                               06691700
066918                                                                  06691800
066919           IF ASC-DC-COUNTER > 7                                  06691900
066920              SUBTRACT +3 FROM ASC-DC-COUNTER                     06692000
066930           END-IF                                                 06693000
066940                                                                  06694000
066950           IF ASC-DC-COUNTER = 7  AND ASC-DC-COUNTER-DC < 7       06695000
066951              SUBTRACT +3 FROM ASC-DC-COUNTER                     06695100
066952              MOVE PC-TSYMSG-00228 TO DP020-MSG-NUMBER            06695200
066953              SET DP020-MSG-INFORMATIONAL TO TRUE                 06695300
066954            ELSE                                                  06695400
066955              IF ASC-DC-COUNTER = 7                               06695500
066956                MOVE PC-TSYMSG-00228 TO DP020-MSG-NUMBER          06695600
066957                SET DP020-MSG-INFORMATIONAL TO TRUE               06695700
066958              END-IF                                              06695800
066959           END-IF                                                 06695900
066960                                                                  06696000
066961           SET ASC-DISPLAY-DC TO TRUE                             06696100
066962         ELSE                                                     06696200
066963              MOVE PC-TSYMSG-00228 TO DP020-MSG-NUMBER            06696300
066964              SET DP020-MSG-INFORMATIONAL TO TRUE                 06696400
066965         END-IF                                                   06696500
066966           MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM           06696600
066967           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   06696700
066968           PERFORM 3200-RESET-ATTRIBUTES                          06696800
066969                                                                  06696900
066970         WHEN OTHER                                               06697000
066971             SET DP013-NO-ROLLBACK                                06697100
066972                 DP013-XCTL-DISPLAY-RESTART                       06697200
066973                 DP013-CICS-ABEND  TO TRUE                        06697300
066974             MOVE '2100-CHECK-FUNCTION-KEY'                       06697400
066975                                   TO DP013-PARAGRAPH             06697500
066976             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06697600
066977                                   TO DP013-MESSAGE-TEXT (1)      06697700
066978             PERFORM DP013-0000-PROCESS-ABEND                     06697800
066979     END-EVALUATE.                                                06697900
066980*                                                                 06698000
066990*----------------------------------------------------------------*06699000
067000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06700000
067100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06710000
067200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06720000
067300*    MESSAGE.                                                    *06730000
067400*----------------------------------------------------------------*06740000
067500                                                                  06750000
067600 2110-BROWSE-BACKWARD.                                            06760000
067700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06770000
067800         GIVING PV-TOP-ITEM.                                      06780000
067900*                                                                 06790000
068000     IF  ((PV-TOP-ITEM < +1)                                      06800000
068100       OR (PV-TOP-ITEM = +1))                                     06810000
068200         MOVE +1                   TO PV-TOP-ITEM                 06820000
068300*        -- TOP OF LIST --                                        06830000
068400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06840000
068500         SET DP020-MSG-INFORMATIONAL TO TRUE                      06850000
068600     END-IF.                                                      06860000
068700                                                                  06870000
068800 EJECT                                                            06880000
068900*----------------------------------------------------------------*06890000
069000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06900000
069100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06910000
069200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06920000
069300*----------------------------------------------------------------*06930000
069400                                                                  06940000
069500 2120-BROWSE-FORWARD.                                             06950000
069600                                                                  06960000
069700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06970000
069800         GIVING PV-TOP-ITEM.                                      06980000
069900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06990000
070000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07000000
070100                                   TO PV-TOP-ITEM                 07010000
070200*        -- BOTTOM OF LIST --                                     07020000
070300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07030000
070400         SET DP020-MSG-INFORMATIONAL                              07040000
070500                                   TO TRUE                        07050000
070600     ELSE                                                         07060000
070700         COMPUTE PV-BOTTOM-ITEM =                                 07070000
070800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07080000
070900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07090000
071000*            -- BOTTOM OF LIST --                                 07100000
071100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07110000
071200             SET DP020-MSG-INFORMATIONAL                          07120000
071300                                   TO TRUE                        07130000
071400         END-IF                                                   07140000
071500     END-IF.                                                      07150000
071600 EJECT                                                            07160000
071700*----------------------------------------------------------------*07170000
071800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07180000
071900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07190000
072000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07200000
072100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07210000
072200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07220000
072300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07230000
072400*----------------------------------------------------------------*07240000
072500                                                                  07250000
072600 2130-CHECK-FOR-JUMP-BROWSE.                                      07260000
072700     SET PS-NO-ERROR               TO TRUE.                       07270000
072800     IF (ASC-START-ITEM-REQUEST = SPACE)                          07280000
072900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07290000
073000                                   TO PV-TOP-ITEM                 07300000
073100     ELSE                                                         07310000
073200         MOVE ASC-START-ITEM-REQUEST                              07320000
073300                                   TO DP010I-UNEDITED-FIELD       07330000
073400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07340000
073500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07350000
073600         SET DP010I-NEGATIVE-NOT-ALLOWED                          07360000
073700                                   TO TRUE                        07370000
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07381003
264230                         USING DP010I-NUMERIC-EDIT-AREA           07382003
073900                                                                  07390000
074000         IF  NOT DP010I-ERROR-DETECTED                            07400000
074100             MOVE DP010I-NUMERIC-FIELD                            07410000
074200                                   TO  ASC-START-ITEM-REQUEST-N   07420000
074300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07430000
074400                 IF  ASC-START-ITEM-REQUEST-N >                   07440000
074500                                          ASC-NUMBER-OF-ITEMS-READ07450000
074600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07460000
074700                     COMPUTE PV-TOP-ITEM =                        07470000
074800                             ASC-NUMBER-OF-ITEMS-READ             07480000
074900                             - PC-ITEMS-PER-PANEL + 1             07490000
075000                     IF  PV-TOP-ITEM < +1                         07500000
075100                         MOVE +1   TO PV-TOP-ITEM                 07510000
075200                         MOVE PC-TSYMSG-00070                     07520000
075300                                   TO DP020-MSG-NUMBER            07530000
075400                         SET DP020-MSG-INFORMATIONAL              07540000
075500                                   TO TRUE                        07550000
075600                     END-IF                                       07560000
075700                 ELSE                                             07570000
075800                     MOVE ASC-START-ITEM-REQUEST-N                07580000
075900                                   TO PV-TOP-ITEM                 07590000
076000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07600000
076100                     COMPUTE PV-BOTTOM-ITEM =                     07610000
076200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07620000
076300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07630000
076400*                        -- BOTTOM OF LIST --                     07640000
076500                         MOVE PC-TSYMSG-00070                     07650000
076600                                   TO DP020-MSG-NUMBER            07660000
076700                         SET DP020-MSG-INFORMATIONAL              07670000
076800                                   TO TRUE                        07680000
076900                     END-IF                                       07690000
077000                 END-IF                                           07700000
077100             ELSE                                                 07710000
077200*                --- VALUE OUT OF RANGE ----                      07720000
077300                 MOVE PC-TSYMSG-00101                             07730000
077400                                   TO DP020-MSG-NUMBER            07740000
077500                 MOVE -1           TO ASTRTITL                    07750000
077600                 SET DP030-SET-CURSOR-APPL-1                      07760000
077700                                   TO TRUE                        07770000
077800                 MOVE DP015-REVERSE                               07780000
077900                                   TO ASTRTITH                    07790000
078000                 MOVE DP015-RED    TO ASTRTITC                    07800000
078100                 MOVE DP015-UNP-NUM-BRT-MDT                       07810000
078200                                   TO ASTRTITA                    07820000
078300                 SET DP020-MSG-FATAL                              07830000
078400                                   TO TRUE                        07840000
078500                 SET PS-ERROR      TO TRUE                        07850000
078600             END-IF                                               07860000
078700                                                                  07870000
078800         ELSE                                                     07880000
078900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07890000
079000             MOVE -1               TO ASTRTITL                    07900000
079100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07910000
079200             MOVE DP015-REVERSE    TO ASTRTITH                    07920000
079300             MOVE DP015-RED        TO ASTRTITC                    07930000
079400             MOVE DP015-UNP-NUM-BRT-MDT                           07940000
079500                                   TO ASTRTITA                    07950000
079600             SET DP020-MSG-FATAL   TO TRUE                        07960000
079700             SET PS-ERROR          TO TRUE                        07970000
079800         END-IF                                                   07980000
079900     END-IF.                                                      07990000
080000 EJECT                                                            08000000
080100******************************************************************08010000
080200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **08020000
080300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **08030000
080400******************************************************************08040000
080500 2200-MOVE-SCREEN-TO-COMMAREA.                                    08050000
080600                                                                  08060000
080700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08070000
080800     MOVE +1                       TO PV-SUB.                     08080000
080900*                                                                 08090000
081000     PERFORM 3100-SET-SUBSCRIPTS.                                 08100000
081100     IF  ASTRTITL > ZERO                                          08110000
081200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          08120000
081300     ELSE                                                         08130000
081400         IF  ASTRTITF = DP015-ERASE-EOF                           08140000
081500             INITIALIZE ASC-START-ITEM-REQUEST                    08150000
081600         END-IF                                                   08160000
081700     END-IF.                                                      08170000
081800*    PERFORM 2210-MOVE-LINES-TO-COMMAREA                          08180000
081900*        VARYING PV-SUB                                           08190000
082000*        FROM 1 BY 1                                              08200000
082100*        UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      08210000
082200*                                                                 08220000
082300*2210-MOVE-LINES-TO-COMMAREA.                                     08230000
082400*    IF  MR-SELECTL (PV-SUB) > ZERO                               08240000
082500*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             08250000
082600*        MOVE MR-SELECTI (PV-SUB)                                 08260000
082700*                                  TO ASC-TEMP-SELECTED-SW        08270000
082800*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      08280000
082900*    ELSE                                                         08290000
083000*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                08300000
083100*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     08310000
083200*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        08320000
083300*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      08330000
083400*        END-IF                                                   08340000
083500*    END-IF.                                                      08350000
083600*    ADD +1                        TO ASC-ITEM-SUB.               08360000
083700*    IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        08370000
083800*        ADD +1                    TO ASC-BLK-SUB                 08380000
083900*        MOVE +1                   TO ASC-ITEM-SUB                08390000
084000*    END-IF.                                                      08400000
084100*                                                                 08410000
084200*----------------------------------------------------------------*08420000
084300*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *08430000
084400*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *08440000
084500*----------------------------------------------------------------*08450000
084600 3000-EDIT-DATA-IN-COMMAREA.                                      08460000
084700                                                                  08470000
084800     SET PS-NO-ERROR               TO TRUE.                       08480000
084900                                                                  08490000
085000     PERFORM 3200-RESET-ATTRIBUTES.                               08500000
085100                                                                  08510000
085200     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     08520000
085300**                                                                08530000
085400* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              08540000
085401* EDITTING IS DONE FROM THE BOTTOM UP.                            08540100
085402**                                                                08540200
085403     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       08540300
085404         ASC-ITEMS-DISPLAYED - 1.                                 08540400
085405                                                                  08540500
085406     PERFORM 3100-SET-SUBSCRIPTS.                                 08540600
085407                                                                  08540700
085408                                                                  08540800
085409 3100-SET-SUBSCRIPTS.                                             08540900
085410                                                                  08541000
085411     COMPUTE ASC-ITEM-SUB =                                       08541100
085412                (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER (1 1)) + 1.08541200
085413                                                                  08541300
085414     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         08541400
085415         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            08541500
085416         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               08541600
085417     ELSE                                                         08541700
085418         MOVE +1 TO ASC-BLK-SUB.                                  08541800
085419                                                                  08541900
085420*----------------------------------------------------------------*08542000
085430*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *08543000
085440*----------------------------------------------------------------*08544000
085450                                                                  08545000
085460 3200-RESET-ATTRIBUTES.                                           08546000
085470                                                                  08547000
085480     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08548000
085490     MOVE DP015-GREEN              TO ASTRTITC.                   08549000
085500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08550000
085600     MOVE -1                       TO ASTRTITL.                   08560000
085700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       08570000
085800                                                                  08580000
085900*----------------------------------------------------------------*08590000
086000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08600000
086100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08610000
086200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08620000
086300*    DISPLAY THE PANEL TO USER.                                  *08630000
086400*----------------------------------------------------------------*08640000
086410                                                                  08641000
086420 4000-BUILD-INITIAL-PANEL.                                        08642000
086430                                                                  08643000
086440     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            08644000
086450                                 ASC-BLOCK-ENTRIES (2).           08645000
086460     MOVE +1                 TO ASC-BLK-SUB.                      08646000
086470* THIS IS TO ENSURE THAT WE START WITH DC-COUNTER = 1 WHEN        08647000
086480* DISPLAYING DC SCREENS.                                          08648000
086490     MOVE -2 TO ASC-DC-COUNTER.                                   08649000
086500     SET ASC-ITEMS-LEFT-ON-DB                                     08650000
086600                             TO TRUE.                             08660000
086700*    SET ASC-DISPLAY-QTY TO TRUE.                                 08670000
086800                                                                  08680000
086900     MOVE +0                 TO ASC-ITEM-SUB                      08690000
087000                                ASC-NUMBER-OF-ITEMS-READ          08700000
087100                                ASC-HIGHEST-BLOCK-WRITTEN         08710000
087200                                ASC-ITEM-AT-TOP-OF-PANEL.         08720000
087300                                                                  08730000
087400     PERFORM 4005-GET-HEADER-FIELDS.                              08740000
087500                                                                  08750000
087600     PERFORM 4010-OPEN-CURSOR.                                    08760000
087700                                                                  08770000
087800     PERFORM 4300-READ-ITEMS-FROM-DB.                             08780000
087900                                                                  08790000
088000     PERFORM 4020-CLOSE-CURSOR.                                   08800000
088100                                                                  08810000
088200     PERFORM 4050-GET-PO-TOTALS.                                  08820000
088300                                                                  08830000
088400     MOVE +1                   TO  PV-TOP-ITEM.                   08840000
088500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          08850000
088600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    08860000
088700         SET DP020-MSG-FATAL   TO  TRUE                           08870000
088800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               08880000
088900     ELSE                                                         08890000
089000         SET DP030-SET-CURSOR-APPL-1                              08900000
089100                               TO TRUE                            08910000
089200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08920000
089300     END-IF.                                                      08930000
089400 EJECT                                                            08940000
089500*----------------------------------------------------------------*08950000
089600* OPEN THE DC CURSOR                                             *08960000
089700*----------------------------------------------------------------*08970000
089800 4010-OPEN-DC-CSR.                                                08980000
089900                                                                  08990000
090000     PERFORM                                                      09000000
090100         WITH TEST AFTER                                          09010000
090200         VARYING PV-RETRY-COUNTER                                 09020000
090300         FROM 1 BY 1                                              09030000
090400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09040000
090500                   OR (SQLCODE = ZERO))                           09050000
090600                                                                  09060000
090700                 EXEC SQL                                         09070000
090800                      OPEN DC-CSR                                 09080000
090900                 END-EXEC                                         09090000
091000                                                                  09100000
091100         EVALUATE TRUE                                            09110000
091110             WHEN SQLCODE = ZERO                                  09111000
091111             WHEN SQLCODE = -904                                  09111100
091112             WHEN SQLCODE = -913                                  09111200
091113                 CONTINUE                                         09111300
091114             WHEN SQLWARN0 NOT = SPACES                           09111400
091115             WHEN SQLCODE < ZERO                                  09111500
091116             WHEN SQLCODE > ZERO                                  09111600
091117                 MOVE '4010-OPEN-DC-CURSOR'                       09111700
091118                                   TO DP013-PARAGRAPH             09111800
091119                 MOVE 'OPEN DC CURSOR - '                         09111900
091120                                   TO DP013-MESSAGE-TEXT (1)      09112000
091121                 MOVE SQLCA        TO DP013-SQLCA                 09112100
091122                 MOVE 'XMT_LOC '   TO DP013-DB2-TABLE-NAME (1)    09112200
091123                 SET DP013-DB2-ABEND                              09112300
091124                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09112400
091125                 PERFORM DP013-0000-PROCESS-ABEND                 09112500
091126         END-EVALUATE                                             09112600
091127     END-PERFORM.                                                 09112700
091128                                                                  09112800
091129     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09112900
091130         MOVE '4010-OPEN-DC-CSR'   TO DP013-PARAGRAPH             09113000
091131         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09113100
091132                                   TO DP013-MESSAGE-TEXT (1)      09113200
091133         MOVE SQLCA                TO DP013-SQLCA                 09113300
091134         MOVE 'XMT_LOC '           TO DP013-DB2-TABLE-NAME (1)    09113400
091135         SET DP013-DB2-ABEND                                      09113500
091136             DP013-XCTL-DISPLAY-RESTART                           09113600
091137                                   TO TRUE                        09113700
091138         PERFORM DP013-0000-PROCESS-ABEND                         09113800
091139     END-IF.                                                      09113900
091140                                                                  09114000
091141                                                                  09114100
091142*----------------------------------------------------------------*09114200
091143* PROCESS THE DC CURSOR                                          *09114300
091144*----------------------------------------------------------------*09114400
091145                                                                  09114500
091146 4015-PROCESS-DC-CSR.                                             09114600
091147                                                                  09114700
091148     PERFORM VARYING PV-DC-COUNT                                  09114800
091149        FROM 1 BY 1                                               09114900
091150       UNTIL PS-END-OF-DC OR PS-TABLE-OVERFLOW                    09115000
091151                                                                  09115100
091152           PERFORM 4016-FETCH-DC-CSR                              09115200
091153           IF PS-END-OF-DC                                        09115300
091154               CONTINUE                                           09115400
091155           ELSE                                                   09115500
091156* IF WE HAVE MORE THAN 10 DIST CENTERS, BUMP THE NUMBER UP FROM   09115600
091157* 10 TO THE NUMBER OF OCCURS IN THE ASC-DC-TABLE.                 09115700
091158               IF PV-DC-COUNT > 10                                09115800
091159                   SET PS-TABLE-OVERFLOW TO TRUE                  09115900
091160               ELSE                                               09116000
091161                   ADD +1 TO ASC-DC-COUNTER-DC                    09116100
091162                   MOVE XMT00001-LOC-NBR                          09116200
091163                     TO ASC-DC-NBR (PV-DC-COUNT)                  09116300
091164                   MOVE XMT00001-LOC-5-ABBR-NM                    09116400
091165                     TO ASC-DC-NAME (PV-DC-COUNT)                 09116500
091166               END-IF                                             09116600
091167           END-IF                                                 09116700
091168     END-PERFORM.                                                 09116800
091169           IF ASC-DC-COUNTER-DC > 3                               09116900
091170            SET ASC-MORE-DC TO TRUE                               09117000
091171           ELSE                                                   09117100
091172            SET ASC-NO-MORE-DC TO TRUE                            09117200
091173           END-IF.                                                09117300
091174                                                                  09117400
091175*----------------------------------------------------------------*09117500
091176*    FETCH THE DC CURSOR                                         *09117600
091177*----------------------------------------------------------------*09117700
091178                                                                  09117800
091179 4016-FETCH-DC-CSR.                                               09117900
091180                                                                  09118000
091181     EXEC SQL                                                     09118100
091182          FETCH DC-CSR                                            09118200
091183          INTO  :XMT00001-LOC-NBR,                                09118300
091184                :XMT00001-LOC-5-ABBR-NM                           09118400
091185     END-EXEC.                                                    09118500
091186                                                                  09118600
091187     EVALUATE TRUE                                                09118700
091188         WHEN SQLCODE = ZERO                                      09118800
091189              CONTINUE                                            09118900
091190         WHEN SQLCODE = +100                                      09119000
091191              SET PS-END-OF-DC TO TRUE                            09119100
091192         WHEN SQLWARN0 NOT = SPACE                                09119200
091193         WHEN SQLCODE NOT = ZERO                                  09119300
091194              MOVE '4016-FETCH-DC-CSR'                            09119400
091195                                   TO DP013-PARAGRAPH             09119500
091196              MOVE 'FETCH DC CURSOR'                              09119600
091197                                   TO DP013-MESSAGE-TEXT (1)      09119700
091198              MOVE SQLCA           TO DP013-SQLCA                 09119800
091199              SET DP013-DB2-ABEND                                 09119900
091200                                   TO TRUE                        09120000
091201              PERFORM DP013-0000-PROCESS-ABEND                    09120100
091202     END-EVALUATE.                                                09120200
091203                                                                  09120300
091204*----------------------------------------------------------------*09120400
091205* CLOSE THE DC CURSOR                                            *09120500
091206*----------------------------------------------------------------*09120600
091207 4020-CLOSE-DC-CSR.                                               09120700
091208                                                                  09120800
091209     EXEC SQL                                                     09120900
091210         CLOSE DC-CSR                                             09121000
091211     END-EXEC.                                                    09121100
091212                                                                  09121200
091213     EVALUATE TRUE                                                09121300
091214         WHEN SQLCODE = ZERO                                      09121400
091215             CONTINUE                                             09121500
091216         WHEN SQLWARN0 NOT = SPACES                               09121600
091217         WHEN SQLCODE < ZERO                                      09121700
091218         WHEN SQLCODE > ZERO                                      09121800
091219             MOVE '4020-CLOSE-DC-CSR'                             09121900
091220                                   TO DP013-PARAGRAPH             09122000
091221             MOVE 'CLOSE DC CURSOR '                              09122100
091222                                   TO DP013-MESSAGE-TEXT (1)      09122200
091223             MOVE SQLCA            TO DP013-SQLCA                 09122300
091224             MOVE 'XMT_LOC '       TO DP013-DB2-TABLE-NAME (1)    09122400
091225             SET DP013-DB2-ABEND                                  09122500
091226                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09122600
091227             PERFORM DP013-0000-PROCESS-ABEND                     09122700
091228     END-EVALUATE.                                                09122800
091229                                                                  09122900
091230*----------------------------------------------------------------*09123000
091231* FORMAT THE HEADER FIELDS ON THE SCREEN.                        *09123100
091232*----------------------------------------------------------------*09123200
091233 4005-GET-HEADER-FIELDS.                                          09123300
091234     PERFORM                                                      09123400
091235         WITH TEST AFTER                                          09123500
091236         VARYING PV-RETRY-COUNTER                                 09123600
091237         FROM 1 BY 1                                              09123700
091238         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09123800
091239                   OR (SQLCODE = ZERO))                           09123900
091240         EXEC SQL                                                 09124000
091250             SELECT A.DEPT_NBR,                                   09125000
091260                    B.ENT_NAME_DESC                               09126000
091270               INTO :PURCHS-DEPT-NBR,                             09127000
091280                    :ENTNME-ENT-NAME-DESC                         09128000
091290               FROM TPURCHS A,                                    09129000
091300                    TENTNME B                                     09130000
091400              WHERE                                               09140000
091500                    A.PO_NBR = :DK-PO-NUMBER                      09150000
091600                AND A.VER_STATUS_CDE = 'A'                        09160000
091700                AND (A.ENT_ID = B.ENT_ID                          09170000
091800                AND  B.TYPE_CDE = '01')                           09180000
091900         END-EXEC                                                 09190000
092000                                                                  09200000
092100         EVALUATE TRUE                                            09210000
092200             WHEN SQLCODE = ZERO                                  09220000
092300                 MOVE PURCHS-DEPT-NBR      TO ASC-KEY-DEPT        09230000
092400                 MOVE ENTNME-ENT-NAME-DESC TO ASC-KEY-VENDOR      09240000
092500             WHEN SQLCODE = -904                                  09250000
092600             WHEN SQLCODE = -913                                  09260000
092700                 CONTINUE                                         09270000
092800             WHEN SQLWARN0 NOT = SPACES                           09280000
092900             WHEN SQLCODE < ZERO                                  09290000
093000             WHEN SQLCODE > ZERO                                  09300000
093100                 MOVE '4005-GET-HEADER'                           09310000
093200                                   TO DP013-PARAGRAPH             09320000
093300                 MOVE 'RETRIEVING HDR FIELDS'                     09330000
093400                                   TO DP013-MESSAGE-TEXT (1)      09340000
093500                 MOVE SQLCA        TO DP013-SQLCA                 09350000
093600                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    09360000
093700                 SET DP013-DB2-ABEND                              09370000
093800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09380000
093900                 PERFORM DP013-0000-PROCESS-ABEND                 09390000
094000         END-EVALUATE                                             09400000
094100     END-PERFORM.                                                 09410000
094200*                                                                 09420000
094300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09430000
094400         MOVE '4005-GET-HEADER-FIELDS' TO DP013-PARAGRAPH         09440000
094500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09450000
094600                                   TO DP013-MESSAGE-TEXT (1)      09460000
094700         MOVE SQLCA                TO DP013-SQLCA                 09470000
094800         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    09480000
094900         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (2)    09490000
095000         SET DP013-DB2-ABEND                                      09500000
095100             DP013-XCTL-DISPLAY-RESTART                           09510000
095200                                   TO TRUE                        09520000
095300         PERFORM DP013-0000-PROCESS-ABEND                         09530000
095400     END-IF.                                                      09540000
095500                                                                  09550000
095600*----------------------------------------------------------------*09560000
095700* OPEN THE TMESSAGE CURSOR.                                      *09570000
095800*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *09580000
095900*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *09590000
096000*   USER.                                                        *09600000
096100*----------------------------------------------------------------*09610000
096200                                                                  09620000
096300 4010-OPEN-CURSOR.                                                09630000
096310     MOVE DK-PO-NUMBER  TO  PURCHS-PO-NBR                         09631000
096320     PERFORM                                                      09632000
096330         WITH TEST AFTER                                          09633000
096340         VARYING PV-RETRY-COUNTER                                 09634000
096350         FROM 1 BY 1                                              09635000
096360         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09636000
096370                   OR (SQLCODE = ZERO))                           09637000
096380                 MOVE 'CURSOR:  LINE-CURSOR1'                     09638000
096390                                   TO DP013-MESSAGE-TEXT (2)      09639000
096400         EXEC SQL                                                 09640000
096500              OPEN LINE-CSR1                                      09650000
096600         END-EXEC                                                 09660000
096700                                                                  09670000
096800         EVALUATE TRUE                                            09680000
096900             WHEN SQLCODE = ZERO                                  09690000
097000             WHEN SQLCODE = -904                                  09700000
097100             WHEN SQLCODE = -913                                  09710000
097200                 CONTINUE                                         09720000
097300             WHEN SQLWARN0 NOT = SPACES                           09730000
097400             WHEN SQLCODE < ZERO                                  09740000
097500             WHEN SQLCODE > ZERO                                  09750000
097600                 MOVE '4010-OPEN-CURSOR'                          09760000
097700                                   TO DP013-PARAGRAPH             09770000
097800                 MOVE 'OPEN LINE CURSOR - '                       09780000
097900                                   TO DP013-MESSAGE-TEXT (1)      09790000
098000                 MOVE SQLCA        TO DP013-SQLCA                 09800000
098100                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)    09810000
098200                 SET DP013-DB2-ABEND                              09820000
098300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09830000
098400                 PERFORM DP013-0000-PROCESS-ABEND                 09840000
098500         END-EVALUATE                                             09850000
098600     END-PERFORM.                                                 09860000
098700*                                                                 09870000
098800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09880000
098900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             09890000
099000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09900000
099100                                   TO DP013-MESSAGE-TEXT (1)      09910000
099200         MOVE SQLCA                TO DP013-SQLCA                 09920000
099300         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    09930000
099400         SET DP013-DB2-ABEND                                      09940000
099500             DP013-XCTL-DISPLAY-RESTART                           09950000
099600                                   TO TRUE                        09960000
099700         PERFORM DP013-0000-PROCESS-ABEND                         09970000
099800     END-IF.                                                      09980000
099900                                                                  09990000
100000 EJECT                                                            10000000
100100*----------------------------------------------------------------*10010000
100200* CLOSE THE LINE CURSOR.                                         *10020000
100300*----------------------------------------------------------------*10030000
100400 4020-CLOSE-CURSOR.                                               10040000
100500     EXEC SQL                                                     10050000
100600          CLOSE LINE-CSR1                                         10060000
100700     END-EXEC                                                     10070000
100800                                                                  10080000
100900*                                                                 10090000
101000     EVALUATE TRUE                                                10100000
101100         WHEN SQLCODE = ZERO                                      10110000
101200             CONTINUE                                             10120000
101300         WHEN SQLWARN0 NOT = SPACES                               10130000
101400         WHEN SQLCODE < ZERO                                      10140000
101500         WHEN SQLCODE > ZERO                                      10150000
101600             MOVE '4020-CLOSE-CURSOR'                             10160000
101700                               TO DP013-PARAGRAPH                 10170000
101800             MOVE 'CLOSE LINE CURSOR '                            10180000
101900                               TO DP013-MESSAGE-TEXT (1)          10190000
102000             MOVE SQLCA        TO DP013-SQLCA                     10200000
102100             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)        10210000
102200             SET DP013-DB2-ABEND                                  10220000
102300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10230000
102400             PERFORM DP013-0000-PROCESS-ABEND                     10240000
102500     END-EVALUATE.                                                10250000
102600                                                                  10260000
102700*----------------------------------------------------------------*10270000
102800* GET THE PO TOTALS.                                             *10280000
102900*----------------------------------------------------------------*10290000
103000 4050-GET-PO-TOTALS.                                              10300000
103100                                                                  10310000
103200     MOVE PURCHS-TOT-UNT-QTY     TO ASC-TOT-ORD.                  10320000
103300     MOVE PV-END-QTY-REC         TO ASC-TOT-REC.                  10330000
103400                                                                  10340000
103500     IF ASC-TOT-REC = 0 OR ASC-TOT-ORD = 0                        10350000
103600         MOVE ZEROES TO ASC-TOT-PCT-N                             10360000
103700         MOVE SPACES TO ASC-TOT-PCT-SIGN                          10370000
103800     ELSE                                                         10380000
103900         COMPUTE PV-TOT-REC-PCT                                   10390000
104000         ROUNDED =                                                10400000
104100                 (ASC-TOT-REC / ASC-TOT-ORD)                      10410000
104200         COMPUTE PV-TOT-REC-PCT =                                 10420000
104300                 PV-TOT-REC-PCT * 100                             10430000
104400         MOVE PC-PCT         TO ASC-TOT-PCT-SIGN                  10440000
104500         IF PV-TOT-REC-PCT = ZERO AND ASC-TOT-REC > ZERO          10450000
104600             MOVE 1 TO ASC-TOT-PCT-N                              10460000
104700         ELSE                                                     10470000
104800             MOVE PV-TOT-REC-PCT TO ASC-TOT-PCT-N                 10480000
104900         END-IF                                                   10490000
105000     END-IF.                                                      10500000
105100                                                                  10510000
105200     SET ASC-NOT-DC-END TO TRUE.                                  10520000
105300     PERFORM VARYING PV-DC-COUNT                                  10530000
105400       FROM 1 BY 1                                                10540000
105500        UNTIL ASC-DC-END                                          10550000
105600                                                                  10560000
105700     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       10570000
105800     PERFORM 4060-GET-PO-DC-ORD                                   10580000
105801     MOVE PV-DC-ORD-QTY        TO ASC-TOT-DC-ORD(PV-DC-COUNT)     10580100
105802                                                                  10580200
105803     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       10580300
105804     PERFORM 4065-GET-PO-DC-REC                                   10580400
105805     MOVE PV-DC-REC-QTY        TO ASC-TOT-DC-REC(PV-DC-COUNT)     10580500
105806                                                                  10580600
105807     IF ASC-DC-NBR(PV-DC-COUNT) = 0                               10580700
105808        SET ASC-DC-END TO TRUE                                    10580800
105809     END-IF                                                       10580900
105810                                                                  10581000
105820     IF PV-DC-COUNT > 9                                           10582000
105830        SET ASC-DC-END TO TRUE                                    10583000
105840     END-IF                                                       10584000
105850     END-PERFORM.                                                 10585000
105860                                                                  10586000
105870*----------------------------------------------------------------*10587000
105880* RETRIEVE THE ORDER QUANTITY FOR A DC.                          *10588000
105890*----------------------------------------------------------------*10589000
105900 4060-GET-PO-DC-ORD.                                              10590000
106000                                                                  10600000
106100     MOVE +0                       TO PV-DC-ORD-QTY.              10610000
106101                                                                  10610100
106102     PERFORM                                                      10610200
106103         WITH TEST AFTER                                          10610300
106104         VARYING PV-RETRY-COUNTER                                 10610400
106105         FROM 1 BY 1                                              10610500
106106         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10610600
106107                   OR (SQLCODE = ZERO)                            10610700
106108                   OR (SQLCODE = 100))                            10610800
106109         EXEC SQL                                                 10610900
106110             SELECT SUM(CURR_SPLIT_QTY)                           10611000
106120               INTO :PV-DC-ORD-QTY:PV-QTY-NULL                    10612000
106130               FROM TPURITM A,                                    10613000
106140                    TALLPLN B                                     10614000
106150              WHERE                                               10615000
106160                    A.PO_NBR         = :DK-PO-NUMBER              10616000
106170                AND A.VER_STATUS_CDE = 'A'                        10617000
106180                AND A.STATUS_CDE NOT IN ('CA')                    10618000
106190                AND A.PO_NBR         = B.PO_NBR                   10619000
106200                AND A.PO_LNE_NBR     = B.PO_LNE_NBR               10620000
106300                AND B.DEST_NBR       = :PC-DCX                    10630000
106400         END-EXEC                                                 10640000
106500                                                                  10650000
106600         EVALUATE TRUE                                            10660000
106700             WHEN SQLCODE = ZERO                                  10670000
106800                 CONTINUE                                         10680000
106900             WHEN SQLCODE = +100                                  10690000
107000                 CONTINUE                                         10700000
107100             WHEN SQLCODE = -904                                  10710000
107200             WHEN SQLCODE = -913                                  10720000
107300                 CONTINUE                                         10730000
107400             WHEN SQLWARN0 NOT = SPACES                           10740000
107500             WHEN SQLCODE < ZERO                                  10750000
107600             WHEN SQLCODE > ZERO                                  10760000
107700                 MOVE '4060-GET-PO-DC-ORD'                        10770000
107800                                   TO DP013-PARAGRAPH             10780000
107900                 MOVE 'RETRIEVING DC ORDER QTY'                   10790000
108000                                   TO DP013-MESSAGE-TEXT (1)      10800000
108100                 MOVE SQLCA        TO DP013-SQLCA                 10810000
108200                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)    10820000
108300                 MOVE 'TALLPLN '   TO DP013-DB2-TABLE-NAME (2)    10830000
108400                 SET DP013-DB2-ABEND                              10840000
108500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10850000
108600                 PERFORM DP013-0000-PROCESS-ABEND                 10860000
108700         END-EVALUATE                                             10870000
108800     END-PERFORM.                                                 10880000
108900*                                                                 10890000
109000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10900000
109100         MOVE '4060-GET-PO-DC-ORD' TO DP013-PARAGRAPH             10910000
109200         MOVE 'MAXIMUM RETRIES EXCEEDED'                          10920000
109300                                   TO DP013-MESSAGE-TEXT (1)      10930000
109400         MOVE SQLCA                TO DP013-SQLCA                 10940000
109500         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    10950000
109600         MOVE 'TALLPLN '           TO DP013-DB2-TABLE-NAME (2)    10960000
109700         SET DP013-DB2-ABEND                                      10970000
109800             DP013-XCTL-DISPLAY-RESTART                           10980000
109900                                   TO TRUE                        10990000
110000         PERFORM DP013-0000-PROCESS-ABEND                         11000000
110100     END-IF.                                                      11010000
110200                                                                  11020000
110300                                                                  11030000
110400 EJECT                                                            11040000
110500*----------------------------------------------------------------*11050000
110600* RETRIEVE THE RECEIVED QUANTITY FOR A DC.                       *11060000
110700*----------------------------------------------------------------*11070000
110800 4065-GET-PO-DC-REC.                                              11080000
110900                                                                  11090000
111000     MOVE +0                       TO PV-DC-REC-QTY.              11100000
111100                                                                  11110000
111200     PERFORM                                                      11120000
111300         WITH TEST AFTER                                          11130000
111400         VARYING PV-RETRY-COUNTER                                 11140000
111500         FROM 1 BY 1                                              11150000
111600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11160000
111700                   OR (SQLCODE = ZERO)                            11170000
111800                   OR (SQLCODE = 100))                            11180000
111900         EXEC SQL                                                 11190000
112000             SELECT SUM(AP_VERIFY_ITM_QTY)                        11200000
112100               INTO :PV-DC-REC-QTY:PV-QTY-NULL                    11210000
112200               FROM TRECITM A,                                    11220000
112300                    TRECDIS B                                     11230000
112400              WHERE                                               11240000
112500                    A.ORD_NBR        = :DK-PO-NUMBER              11250000
112600                AND A.VER_STATUS_CDE = 'A'                        11260000
112700                AND A.OPER_UNT_ID    = :PC-DCX                    11270000
112800                AND A.STATUS_CDE     = 'VE'                       11280000
112900                AND A.ORD_NBR        = B.ORD_NBR                  11290000
113000                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              11300000
113100                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              11310000
113200                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              11320000
113300                AND A.FCLTY_ID       = B.FCLTY_ID                 11330000
113400                AND B.VER_STATUS_CDE = 'A'                        11340000
113500         END-EXEC                                                 11350000
113600                                                                  11360000
113700         EVALUATE TRUE                                            11370000
113800             WHEN SQLCODE = ZERO                                  11380000
113900                 CONTINUE                                         11390000
114000             WHEN SQLCODE = +100                                  11400000
114100                 CONTINUE                                         11410000
114200             WHEN SQLCODE = -904                                  11420000
114300             WHEN SQLCODE = -913                                  11430000
114400                 CONTINUE                                         11440000
114500             WHEN SQLWARN0 NOT = SPACES                           11450000
114600             WHEN SQLCODE < ZERO                                  11460000
114700             WHEN SQLCODE > ZERO                                  11470000
114800                 MOVE '4065-GET-PO-DC-REC'                        11480000
114900                                   TO DP013-PARAGRAPH             11490000
115000                 MOVE 'RETRIEVING RECEIVED QTY'                   11500000
115100                                   TO DP013-MESSAGE-TEXT (1)      11510000
115200                 MOVE SQLCA        TO DP013-SQLCA                 11520000
115300                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    11530000
115400                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    11540000
115500                 SET DP013-DB2-ABEND                              11550000
115600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11560000
115700                 PERFORM DP013-0000-PROCESS-ABEND                 11570000
115800         END-EVALUATE                                             11580000
115900     END-PERFORM.                                                 11590000
116000*                                                                 11600000
116100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11610000
116200         MOVE '4065-GET-PO-DC-REC'  TO DP013-PARAGRAPH            11620000
116300         MOVE 'MAXIMUM RETRIES EXCEEDED'                          11630000
116400                                   TO DP013-MESSAGE-TEXT (1)      11640000
116500         MOVE SQLCA                TO DP013-SQLCA                 11650000
116600         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    11660000
116700         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    11670000
116800         SET DP013-DB2-ABEND                                      11680000
116900             DP013-XCTL-DISPLAY-RESTART                           11690000
117000                                   TO TRUE                        11700000
117100         PERFORM DP013-0000-PROCESS-ABEND                         11710000
117200     END-IF.                                                      11720000
117300*----------------------------------------------------------------*11730000
117400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *11740000
117500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *11750000
117600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *11760000
117700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *11770000
117800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *11780000
117900*                                                                *11790000
118000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *11800000
118100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *11810000
118200*    UPON INITIALIZATION.                                        *11820000
118300*----------------------------------------------------------------*11830000
118400                                                                  11840000
118500 4300-READ-ITEMS-FROM-DB.                                         11850000
118600                                                                  11860000
118700     PERFORM                                                      11870000
118800         VARYING PV-READ-COUNT                                    11880000
118900         FROM 1 BY 1                                              11890000
119000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    11900000
119100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         11910000
119200                                                                  11920000
119300         PERFORM 4310-FETCH                                       11930000
119400                                                                  11940000
119500         IF  ASC-ITEMS-LEFT-ON-DB                                 11950000
119600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                11960000
119700                 ADD +1            TO ASC-ITEM-SUB                11970000
119800             ELSE                                                 11980000
119900                 ADD +1            TO ASC-BLK-SUB                 11990000
120000                 MOVE +1           TO ASC-ITEM-SUB                12000000
120100                                                                  12010000
120200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         12020000
120300                     MOVE +1       TO ASC-BLK-SUB                 12030000
120400                     SET ASC-BLOCK-MODIFIED (1)                   12040000
120500                                   TO TRUE                        12050000
120600                     PERFORM 5100-WRITE-TEMP-STORAGE              12060000
120700                     MOVE ASC-BLOCK-ENTRIES                       12070000
120800                               (PC-MAX-BLOCKS-IN-ARRAY)           12080000
120900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 12090000
121000                     ADD +1        TO ASC-BLK-SUB                 12100000
121100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   12110000
121200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      12120000
121300                                   TO TRUE                        12130000
121400                 END-IF                                           12140000
121500             END-IF                                               12150000
121600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    12160000
121700             MOVE ASC-NUMBER-OF-ITEMS-READ TO                     12170000
121800                   ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)12180000
121900             IF PURCHS-STATUS-CDE = 'FE' OR 'WK' OR 'PA' OR 'RJ'  12190000
122000                 MOVE PURITM-PO-LNE-NBR                           12200000
122100                                   TO ASC-LINE                    12210000
122200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12220000
122300             ELSE                                                 12230000
122400                 MOVE PURITM-APP-PO-LNE-NBR                       12240000
122500                                   TO ASC-LINE                    12250000
122600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12260000
122700             END-IF                                               12270000
122800             IF PV-SKU-NBR-IND = +0                               12280000
122900               MOVE XLT00004-MAJ-CL-NBR TO ASC-MCL                12290000
123000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12300000
123100               MOVE XLT00004-SUB-CL-NBR TO ASC-SCL                12310000
123200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12320000
123300               MOVE XLT00003-SKU-NBR    TO ASC-SKU                12330000
123400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12340000
123500               MOVE XLT00003-SKU-DESC   TO ASC-DESC               12350000
123600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12360000
123700             ELSE                                                 12370000
123800               MOVE ASC-KEY-DEPT        TO PV-TEMP-SKU-DEPT       12380000
123900               MOVE PURITM-CL-NBR       TO ASC-SCL                12390000
124000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12400000
124100                                           PV-TEMP-SKU-CLASS      12410000
124200               MOVE PURITM-SKU-SEQ-NBR  TO PV-TEMP-SKU-SEQ        12420000
124300               MOVE PURITM-CL-NBR (1:1) TO PV-MAJ-CL-1            12430000
124400               MOVE PV-MAJ-CLASS        TO ASC-MCL                12440000
124410                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12441000
124420               MOVE PV-SKU-NBR          TO ASC-SKU                12442000
124430                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12443000
124440               MOVE PURITM-SKU-DESC     TO ASC-DESC               12444000
124450                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12445000
124460             END-IF                                               12446000
124470             MOVE PURITM-UNT-QTY                                  12447000
124480                               TO ASC-QTY                         12448000
124490                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12449000
124500     SET ASC-NOT-DC-END TO TRUE                                   12450000
124600     PERFORM VARYING PV-DC-COUNT                                  12460000
124700       FROM 1 BY 1                                                12470000
124800        UNTIL ASC-DC-END                                          12480000
124900                                                                  12490000
125000     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       12500000
125100     PERFORM 4320-GET-DC-SPLIT                                    12510000
125200     MOVE PV-DC-SPLIT-QTY TO                                      12520000
125300                  ASC-DC(ASC-BLK-SUB ASC-ITEM-SUB PV-DC-COUNT)    12530000
125400                                                                  12540000
125500     MOVE ASC-DC-NBR(PV-DC-COUNT) TO PC-DCX                       12550000
125600     PERFORM 4330-GET-DC-REC                                      12560000
125700     MOVE PV-DC-REC-QTY TO                                        12570000
125800                  ASC-REC-DC(ASC-BLK-SUB ASC-ITEM-SUB PV-DC-COUNT)12580000
125900     IF ASC-DC-NBR(PV-DC-COUNT) = 0                               12590000
126000* NO MORE DCS, GET OUT OF LOOP.                                   12600000
126100        SET ASC-DC-END TO TRUE                                    12610000
126200     END-IF                                                       12620000
126300                                                                  12630000
126400     IF PV-DC-COUNT >  9                                          12640000
126500        SET ASC-DC-END TO TRUE                                    12650000
126600     END-IF                                                       12660000
126700     END-PERFORM                                                  12670000
126800                                                                  12680000
126900             MOVE PURITM-STATUS-CDE      TO                       12690000
127000                      ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)       12700000
127100             PERFORM 4360-GET-TOT-REC                             12710000
127200             MOVE PV-TOT-REC-QTY                                  12720000
127300                               TO ASC-REC-QTY                     12730000
127400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 12740000
127500             ADD PV-TOT-REC-QTY TO PV-END-QTY-REC                 12750000
127600                    GIVING PV-END-QTY-REC                         12760000
127700         IF ASC-QTY (ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS            12770000
127800           MOVE ZEROS TO ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)   12780000
127900         ELSE                                                     12790000
128000           COMPUTE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)         12800000
128100                    ROUNDED =                                     12810000
128200               (ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB) /          12820000
128300               ASC-QTY    (ASC-BLK-SUB ASC-ITEM-SUB))             12830000
128400           COMPUTE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) =       12840000
128500               ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) * 100       12850000
128600            IF ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) = 0         12860000
128700           AND ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB) > 0         12870000
128800              MOVE 1 TO ASC-REC-PCT                               12880000
128900                           (ASC-BLK-SUB ASC-ITEM-SUB)             12890000
129000            END-IF                                                12900000
129100         END-IF                                                   12910000
129200      END-IF                                                      12920000
129300     END-PERFORM.                                                 12930000
129400                                                                  12940000
129500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          12950000
129600         MOVE +1               TO ASC-BLK-SUB                     12960000
129700         PERFORM 5100-WRITE-TEMP-STORAGE                          12970000
129800         ADD +1                TO ASC-BLK-SUB                     12980000
129900         PERFORM 5100-WRITE-TEMP-STORAGE                          12990000
130000                                                                  13000000
130100         MOVE 1                TO ASC-BLK-SUB                     13010000
130200                                  PV-BLOCK-NUMBER                 13020000
130300         PERFORM 4410-READ-TEMP-STORAGE                           13030000
130400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             13040000
130500             MOVE 2            TO ASC-BLK-SUB                     13050000
130600                                  PV-BLOCK-NUMBER                 13060000
130700             PERFORM 4410-READ-TEMP-STORAGE                       13070000
130800         END-IF                                                   13080000
130900     END-IF.                                                      13090000
131000 EJECT                                                            13100000
131100*----------------------------------------------------------------*13110000
131200*    FETCH THE MESSAGE CURSOR.                                   *13120000
131300*----------------------------------------------------------------*13130000
131400                                                                  13140000
131500 4310-FETCH.                                                      13150000
131600                                                                  13160000
131700     EXEC SQL                                                     13170000
131800          FETCH LINE-CSR1                                         13180000
131900                INTO  :PURCHS-PO-NBR                              13190000
132000                    , :PURCHS-TOT-UNT-QTY                         13200000
132100                    , :PURCHS-STATUS-CDE                          13210000
132200                    , :PURITM-STATUS-CDE                          13220000
132300                    , :PURITM-APP-PO-LNE-NBR                      13230000
132400                    , :PURITM-PO-LNE-NBR                          13240000
132500                    , :XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND      13250000
132600                    , :XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND      13260000
132700                    , :XLT00003-SKU-NBR:PV-SKU-NBR-IND            13270000
132800                    , :XLT00003-SKU-DESC:PV-SKU-DESC-IND          13280000
132900                    , :PURITM-CL-NBR                              13290000
133000                    , :PURITM-SKU-SEQ-NBR                         13300000
133100                    , :PURITM-SKU-DESC                            13310000
133200                    , :PURITM-UNT-QTY                             13320000
133300     END-EXEC.                                                    13330000
133400                                                                  13340000
133500     EVALUATE TRUE                                                13350000
133600         WHEN SQLCODE = ZERO                                      13360000
133700         WHEN SQLCODE = +100                                      13370000
133800              CONTINUE                                            13380000
133900         WHEN SQLWARN0 NOT = SPACE                                13390000
134000         WHEN SQLCODE NOT = ZERO                                  13400000
134100              MOVE '4310-FETCH-CURSOR'                            13410000
134200                               TO DP013-PARAGRAPH                 13420000
134300              MOVE 'FETCH LINE CURSOR'                            13430000
134400                               TO DP013-MESSAGE-TEXT (1)          13440000
134500              MOVE SQLCA       TO DP013-SQLCA                     13450000
134600              SET DP013-DB2-ABEND                                 13460000
134700                               TO TRUE                            13470000
134800              PERFORM DP013-0000-PROCESS-ABEND                    13480000
134900     END-EVALUATE.                                                13490000
135000                                                                  13500000
135100     IF  SQLCODE EQUAL +100                                       13510000
135200         SET ASC-NO-ITEMS-LEFT-ON-DB                              13520000
135300                                   TO TRUE                        13530000
135400     END-IF.                                                      13540000
135500                                                                  13550000
135600 EJECT                                                            13560000
135700*----------------------------------------------------------------*13570000
135800* RETRIEVE THE ORDER QUANTITY FOR A DC. (LINE)                   *13580000
135900*----------------------------------------------------------------*13590000
136000 4320-GET-DC-SPLIT.                                               13600000
136100                                                                  13610000
136200     PERFORM                                                      13620000
136300         WITH TEST AFTER                                          13630000
136400         VARYING PV-RETRY-COUNTER                                 13640000
136500         FROM 1 BY 1                                              13650000
136600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13660000
136700                   OR (SQLCODE = ZERO)                            13670000
136800                   OR (SQLCODE = 100))                            13680000
136900         EXEC SQL                                                 13690000
137000             SELECT CURR_SPLIT_QTY                                13700000
137100               INTO :PV-DC-SPLIT-QTY                              13710000
137200               FROM TALLPLN                                       13720000
137300              WHERE                                               13730000
137400                    PO_NBR     = :DK-PO-NUMBER                    13740000
137500                AND PO_LNE_NBR = :PURITM-PO-LNE-NBR               13750000
137600                AND DEST_NBR   = :PC-DCX                          13760000
137700         END-EXEC                                                 13770000
137800                                                                  13780000
137900         EVALUATE TRUE                                            13790000
138000             WHEN SQLCODE = ZERO                                  13800000
138100                 CONTINUE                                         13810000
138200             WHEN SQLCODE = +100                                  13820000
138300                 MOVE +0         TO PV-DC-SPLIT-QTY               13830000
138400             WHEN SQLCODE = -904                                  13840000
138500             WHEN SQLCODE = -913                                  13850000
138600                 CONTINUE                                         13860000
138700             WHEN SQLWARN0 NOT = SPACES                           13870000
138800             WHEN SQLCODE < ZERO                                  13880000
138900             WHEN SQLCODE > ZERO                                  13890000
139000                 MOVE '4320-GET-DC-SPLIT'                         13900000
139100                                   TO DP013-PARAGRAPH             13910000
139200                 MOVE 'RETRIEVING TALLPLN'                        13920000
139300                                   TO DP013-MESSAGE-TEXT (1)      13930000
139400                 MOVE SQLCA        TO DP013-SQLCA                 13940000
139500                 MOVE 'TALLPLN '   TO DP013-DB2-TABLE-NAME (1)    13950000
139600                 SET DP013-DB2-ABEND                              13960000
139700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13970000
139800                 PERFORM DP013-0000-PROCESS-ABEND                 13980000
139900         END-EVALUATE                                             13990000
140000     END-PERFORM.                                                 14000000
140100*                                                                 14010000
140200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14020000
140300         MOVE '4320-GET-DC-SPLIT' TO DP013-PARAGRAPH              14030000
140400         MOVE 'MAXIMUM RETRIES EXCEEDED'                          14040000
140500                                   TO DP013-MESSAGE-TEXT (1)      14050000
140600         MOVE SQLCA                TO DP013-SQLCA                 14060000
140700         MOVE 'TALLPLN '           TO DP013-DB2-TABLE-NAME (1)    14070000
140800         SET DP013-DB2-ABEND                                      14080000
140900             DP013-XCTL-DISPLAY-RESTART                           14090000
141000                                   TO TRUE                        14100000
141100         PERFORM DP013-0000-PROCESS-ABEND                         14110000
141200     END-IF.                                                      14120000
141300*----------------------------------------------------------------*14130000
141400* RETRIEVE THE RECEIVED QUANTITY FOR A DC.(LINE)                 *14140000
141500*----------------------------------------------------------------*14150000
141600 4330-GET-DC-REC.                                                 14160000
141700                                                                  14170000
141800     MOVE +0                       TO PV-DC-REC-QTY.              14180000
141900                                                                  14190000
142000     PERFORM                                                      14200000
142100         WITH TEST AFTER                                          14210000
142200         VARYING PV-RETRY-COUNTER                                 14220000
142300         FROM 1 BY 1                                              14230000
142400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14240000
142500                   OR (SQLCODE = ZERO)                            14250000
142600                   OR (SQLCODE = 100))                            14260000
142700         EXEC SQL                                                 14270000
142800             SELECT SUM(AP_VERIFY_ITM_QTY)                        14280000
142900               INTO :PV-DC-REC-QTY:PV-QTY-NULL                    14290000
143000               FROM TRECITM A,                                    14300000
143100                    TRECDIS B                                     14310000
143200              WHERE                                               14320000
143300                    A.ORD_NBR        = :DK-PO-NUMBER              14330000
143400                AND A.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR     14340000
143500                AND A.VER_STATUS_CDE = 'A'                        14350000
143600                AND A.OPER_UNT_ID    = :PC-DCX                    14360000
143700                AND A.STATUS_CDE     = 'VE'                       14370000
143800                AND A.ORD_NBR        = B.ORD_NBR                  14380000
143900                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              14390000
144000                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              14400000
144100                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              14410000
144200                AND A.FCLTY_ID       = B.FCLTY_ID                 14420000
144300                AND B.VER_STATUS_CDE = 'A'                        14430000
144400         END-EXEC                                                 14440000
144500                                                                  14450000
144600         EVALUATE TRUE                                            14460000
144700             WHEN SQLCODE = ZERO                                  14470000
144800                 CONTINUE                                         14480000
144900             WHEN SQLCODE = +100                                  14490000
145000                 CONTINUE                                         14500000
145100             WHEN SQLCODE = -904                                  14510000
145200             WHEN SQLCODE = -913                                  14520000
145300                 CONTINUE                                         14530000
145400             WHEN SQLWARN0 NOT = SPACES                           14540000
145500             WHEN SQLCODE < ZERO                                  14550000
145600             WHEN SQLCODE > ZERO                                  14560000
145700                 MOVE '4330-GET-DC-REC'                           14570000
145800                                   TO DP013-PARAGRAPH             14580000
145900                 MOVE 'RETRIEVING RECEIVED QTY'                   14590000
146000                                   TO DP013-MESSAGE-TEXT (1)      14600000
146100                 MOVE SQLCA        TO DP013-SQLCA                 14610000
146200                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    14620000
146300                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    14630000
146400                 SET DP013-DB2-ABEND                              14640000
146500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14650000
146600                 PERFORM DP013-0000-PROCESS-ABEND                 14660000
146700         END-EVALUATE                                             14670000
146800     END-PERFORM.                                                 14680000
146900*                                                                 14690000
147000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14700000
147100         MOVE '4330-GET-DC-REC' TO DP013-PARAGRAPH                14710000
147200         MOVE 'MAXIMUM RETRIES EXCEEDED'                          14720000
147300                                   TO DP013-MESSAGE-TEXT (1)      14730000
147400         MOVE SQLCA                TO DP013-SQLCA                 14740000
147500         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    14750000
147600         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    14760000
147700         SET DP013-DB2-ABEND                                      14770000
147800             DP013-XCTL-DISPLAY-RESTART                           14780000
147900                                   TO TRUE                        14790000
148000         PERFORM DP013-0000-PROCESS-ABEND                         14800000
148100     END-IF.                                                      14810000
148200*----------------------------------------------------------------*14820000
148300* RETRIEVE THE TOTAL RECEIVED QUANTITY. (LINE)                   *14830000
148400*----------------------------------------------------------------*14840000
148500 4360-GET-TOT-REC.                                                14850000
148600                                                                  14860000
148700     MOVE +0                     TO PV-TOT-REC-QTY.               14870000
148800                                                                  14880000
148900     PERFORM                                                      14890000
149000         WITH TEST AFTER                                          14900000
149100         VARYING PV-RETRY-COUNTER                                 14910000
149200         FROM 1 BY 1                                              14920000
149300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14930000
149400                   OR (SQLCODE = ZERO)                            14940000
149500                   OR (SQLCODE = 100))                            14950000
149600         EXEC SQL                                                 14960000
149700             SELECT SUM(AP_VERIFY_ITM_QTY)                        14970000
149800               INTO :PV-TOT-REC-QTY:PV-QTY-NULL                   14980000
149900               FROM TRECITM A,                                    14990000
150000                    TRECDIS B                                     15000000
150100              WHERE                                               15010000
150200                    A.ORD_NBR        = :DK-PO-NUMBER              15020000
150300                AND A.ORD_LNE_NBR    = :PURITM-APP-PO-LNE-NBR     15030000
150400                AND A.VER_STATUS_CDE = 'A'                        15040000
150500                AND A.STATUS_CDE     = 'VE'                       15050000
150600                AND A.ORD_NBR        = B.ORD_NBR                  15060000
150700                AND A.ORD_LNE_NBR    = B.ORD_LNE_NBR              15070000
150800                AND A.REC_SEQ_NBR    = B.REC_SEQ_NBR              15080000
150900                AND A.OPER_UNT_ID    = B.OPER_UNT_ID              15090000
151000                AND A.FCLTY_ID       = B.FCLTY_ID                 15100000
151100                AND B.VER_STATUS_CDE = 'A'                        15110000
151200         END-EXEC                                                 15120000
151300                                                                  15130000
151400         EVALUATE TRUE                                            15140000
151500             WHEN SQLCODE = ZERO                                  15150000
151600                 CONTINUE                                         15160000
151700             WHEN SQLCODE = +100                                  15170000
151800                 MOVE +0         TO PV-TOT-REC-QTY                15180000
151900             WHEN SQLCODE = -904                                  15190000
152000             WHEN SQLCODE = -913                                  15200000
152100                 CONTINUE                                         15210000
152200             WHEN SQLWARN0 NOT = SPACES                           15220000
152300             WHEN SQLCODE < ZERO                                  15230000
152400             WHEN SQLCODE > ZERO                                  15240000
152500                 MOVE '4360-GET-TOT-REC'                          15250000
152600                                   TO DP013-PARAGRAPH             15260000
152700                 MOVE 'RETRIEVING RECEIVED QTY'                   15270000
152800                                   TO DP013-MESSAGE-TEXT (1)      15280000
152900                 MOVE SQLCA        TO DP013-SQLCA                 15290000
153000                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)    15300000
153100                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (2)    15310000
153200                 SET DP013-DB2-ABEND                              15320000
153300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15330000
153400                 PERFORM DP013-0000-PROCESS-ABEND                 15340000
153500         END-EVALUATE                                             15350000
153600     END-PERFORM.                                                 15360000
153700*                                                                 15370000
153800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15380000
153900         MOVE '4360-GET-TOT-REC'   TO DP013-PARAGRAPH             15390000
154000         MOVE 'MAXIMUM RETRIES EXCEEDED'                          15400000
154100                                   TO DP013-MESSAGE-TEXT (1)      15410000
154200         MOVE SQLCA                TO DP013-SQLCA                 15420000
154300         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (1)    15430000
154400         MOVE 'TRECDIS '           TO DP013-DB2-TABLE-NAME (2)    15440000
154500         SET DP013-DB2-ABEND                                      15450000
154600             DP013-XCTL-DISPLAY-RESTART                           15460000
154700                                   TO TRUE                        15470000
154800         PERFORM DP013-0000-PROCESS-ABEND                         15480000
154900     END-IF.                                                      15490000
155000*----------------------------------------------------------------*15500000
155100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *15510000
155200*----------------------------------------------------------------*15520000
155300                                                                  15530000
155400 4400-MOVE-COMMAREA-TO-SCREEN.                                    15540000
155500                                                                  15550000
155600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15560000
155700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15570000
155800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15580000
155900             MOVE +1    TO ASC-BLK-SUB                            15590000
156000             PERFORM 5100-WRITE-TEMP-STORAGE                      15600000
156100             ADD +1     TO ASC-BLK-SUB                            15610000
156200             PERFORM 5100-WRITE-TEMP-STORAGE                      15620000
156300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15630000
156400                 GIVING PV-BLOCK-NUMBER                           15640000
156500                 REMAINDER PV-REMAINDER                           15650000
156600             IF  PV-REMAINDER > ZERO                              15660000
156700                 ADD +1 TO PV-BLOCK-NUMBER                        15670000
156800             END-IF                                               15680000
156900             MOVE +1    TO ASC-BLK-SUB                            15690000
157000             PERFORM 4410-READ-TEMP-STORAGE                       15700000
157100             ADD +1     TO ASC-BLK-SUB                            15710000
157200                           PV-BLOCK-NUMBER                        15720000
157300             PERFORM 4410-READ-TEMP-STORAGE                       15730000
157400     END-IF.                                                      15740000
157500     MOVE +1            TO ASC-BLK-SUB.                           15750000
157600     COMPUTE ASC-ITEM-SUB =                                       15760000
157700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15770000
157800         + PC-ITEMS-PER-PANEL).                                   15780000
157900*                                                                 15790000
158000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15800000
158100         ADD +1         TO ASC-BLK-SUB                            15810000
158200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15820000
158300     END-IF.                                                      15830000
158400*                                                                 15840000
158500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15850000
158600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15860000
158700     MOVE SPACE TO PV-NORMAL-LINE PV-DC1-LINE PV-NORMAL-TOTALS    15870000
158800                                              PV-DC-TOTALS.       15880000
158810     IF PO011-LAST-PO-LNE-NBR = ZEROS                             15881000
158820         CONTINUE                                                 15882000
158830     ELSE                                                         15883000
158831         MOVE PO011-PO-LNE-NBR TO PV-TOP-ITEM                     15883100
158832         MOVE ZEROS TO ASC-ITEM-AT-BOT-OF-PANEL                   15883200
158833     END-IF.                                                      15883300
158834                                                                  15883400
158835     PERFORM 4420-FORMAT-LIST-LINES                               15883500
158836         VARYING PV-SUB                                           15883600
158837         FROM PC-ITEMS-PER-PANEL BY -1                            15883700
158838         UNTIL PV-SUB < +1.                                       15883800
158839*                                                                 15883900
158840     COMPUTE ASC-ITEMS-DISPLAYED =                                15884000
158850         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15885000
158860     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    15886000
158870                                      ASTRTITO.                   15887000
158880     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    15888000
158890     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    15889000
158900*                                                                 15890000
159000*    IF ASC-DISPLAY-QTY                                           15900000
159100*         MOVE PC-QTY-HEAD       TO MR-HEAD1                      15910000
159200*         MOVE PC-QTY-HEAD2      TO MR-HEAD2                      15920000
159300*         MOVE ASC-TOT-ORD       TO PV-TOT-ORD                    15930000
159400*         MOVE ASC-TOT-REC       TO PV-TOT-REC                    15940000
159500*         MOVE ASC-TOT-PCT-N     TO PV-TREC-PCT                   15950000
159600*         MOVE ASC-TOT-PCT-SIGN  TO PV-TREC-PCT-SIGN              15960000
159700*         MOVE PV-NORMAL-TOTALS  TO MR-TOTAL-LINE                 15970000
159800*     ELSE                                                        15980000
159900*      IF ASC-DISPLAY-DC                                          15990000
160000         IF ASC-DC-COUNTER < +1                                   16000000
160100             MOVE +1 TO ASC-DC-COUNTER                            16010000
160200         END-IF                                                   16020000
160300         MOVE ASC-TOT-ORD       TO PV-TOT-ORD2                    16030000
160400         MOVE ASC-TOT-REC       TO PV-TOT-REC2                    16040000
160500         MOVE ASC-TOT-PCT-N     TO PV-TREC-PCT2                   16050000
160600         MOVE ASC-TOT-PCT-SIGN   TO PV-TREC-PCT-SIGN2             16060000
160700         MOVE ASC-TOT-DC-ORD(ASC-DC-COUNTER) TO PV-TOT-DC1-ORD    16070000
160800         MOVE ASC-TOT-DC-REC(ASC-DC-COUNTER) TO PV-TOT-DC1-REC    16080000
160900         MOVE ASC-TOT-DC-ORD(ASC-DC-COUNTER + 1) TO PV-TOT-DC2-ORD16090000
161000         MOVE ASC-TOT-DC-REC(ASC-DC-COUNTER + 1) TO PV-TOT-DC2-REC16100000
161100         MOVE ASC-TOT-DC-ORD(ASC-DC-COUNTER + 2) TO PV-TOT-DC3-ORD16110000
161200         MOVE ASC-TOT-DC-REC(ASC-DC-COUNTER + 2) TO PV-TOT-DC3-REC16120000
161300         MOVE PV-DC-TOTALS TO MR-TOTAL-LINE                       16130000
161400         MOVE PC-HEADA          TO PC-DC1-HEADA                   16140000
161500         MOVE ASC-DC-NAME(ASC-DC-COUNTER) TO PC-DC1-HEADB         16150000
161600         MOVE ASC-DC-NAME(ASC-DC-COUNTER) TO PC-DC1-HEADC         16160000
161700         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 1) TO PC-DC1-HEADD     16170000
161800         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 1) TO PC-DC1-HEADE     16180000
161900         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 2) TO PC-DC1-HEADF     16190000
162000         MOVE ASC-DC-NAME(ASC-DC-COUNTER + 2) TO PC-DC1-HEADG     16200000
162100         MOVE PC-DC1-HEAD       TO MR-HEAD1                       16210000
162200         MOVE PC-HEADB          TO PC-HEAD-NAMEB                  16220000
162300          IF ASC-DC-NAME(ASC-DC-COUNTER) = SPACES                 16230000
162400            MOVE SPACES TO PC-HEAD-DC10                           16240000
162500          ELSE                                                    16250000
162600            MOVE PC-HEAD-DC1 TO PC-HEAD-DC10                      16260000
162700          END-IF                                                  16270000
162800          IF ASC-DC-NAME(ASC-DC-COUNTER + 1) = SPACES             16280000
162900            MOVE SPACES TO PC-HEAD-DC20                           16290000
163000          ELSE                                                    16300000
163100            MOVE PC-HEAD-DC2 TO PC-HEAD-DC20                      16310000
163200          END-IF                                                  16320000
163300          IF ASC-DC-NAME(ASC-DC-COUNTER + 2) = SPACES             16330000
163400            MOVE SPACES TO PC-HEAD-DC30                           16340000
163500          ELSE                                                    16350000
163600            MOVE PC-HEAD-DC3 TO PC-HEAD-DC30                      16360000
163700          END-IF                                                  16370000
163800          MOVE PC-DC1-HEAD2      TO MR-HEAD2                      16380000
163900*      END-IF.                                                    16390000
164000                                                                  16400000
164100     IF  DP020-MSG-NUMBER-X = SPACE                               16410000
164200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  16420000
164300*            --- MORE ITEMS TO DISPLAY ----                       16430000
164400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            16440000
164500             SET DP020-MSG-INFORMATIONAL TO TRUE                  16450000
164600         END-IF                                                   16460000
164700     END-IF.                                                      16470000
164800                                                                  16480000
164900     MOVE ASC-KEY-PO-NUMBER        TO APONUMO.                    16490000
165000     MOVE ASC-KEY-DEPT             TO ADEPTO.                     16500000
165100     MOVE ASC-KEY-VENDOR           TO AVENDNMO.                   16510000
165200                                                                  16520000
165300*----------------------------------------------------------------*16530000
165400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *16540000
165500*----------------------------------------------------------------*16550000
165600                                                                  16560000
165700 4410-READ-TEMP-STORAGE.                                          16570000
165800                                                                  16580000
165900     EXEC CICS                                                    16590000
166000         READQ TS                                                 16600000
166100             QUEUE (ASC-LIST-QUEUE-NAME)                          16610000
166200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16620000
166300             ITEM  (PV-BLOCK-NUMBER)                              16630000
166400             RESP  (PV-CICS-RESP)                                 16640000
166500     END-EXEC.                                                    16650000
166600                                                                  16660000
166700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       16670000
166800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     16680000
166900         CONTINUE                                                 16690000
167000     ELSE                                                         16700000
167100         SET DP013-CICS-ABEND     TO TRUE                         16710000
167200         SET DP013-NO-ROLLBACK    TO TRUE                         16720000
167300         MOVE '4410-READ-TEMP-STORAGE'                            16730000
167400                                  TO DP013-PARAGRAPH              16740000
167500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16750000
167600                                  TO DP013-MESSAGE-TEXT(1)        16760000
167700         PERFORM DP013-0000-PROCESS-ABEND                         16770000
167800     END-IF.                                                      16780000
167900                                                                  16790000
168000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16800000
168100*                                                                 16810000
168200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16820000
168300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16830000
168400     END-IF.                                                      16840000
168500 EJECT                                                            16850000
168600*----------------------------------------------------------------*16860000
168700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *16870000
168800*----------------------------------------------------------------*16880000
168900                                                                  16890000
169000 4420-FORMAT-LIST-LINES.                                          16900000
169100                                                                  16910000
169200         IF  PO011-LAST-PO-LNE-NBR = ZEROS                        16920000
169300             CONTINUE                                             16930000
169400         ELSE                                                     16940000
169500             IF PO011-BLOCK-NUMBER    = 1                         16950000
169600                CONTINUE                                          16960000
169700             ELSE                                                 16970000
169800                 MOVE ZEROS TO PV-DETERMINE-CNT                   16980000
169900                 MOVE ZEROS TO PV-TEST-CNT                        16990000
169901                 MOVE ZEROS TO PV-BLOCK-NUMBER                    16990100
169902                 PERFORM 4421-GET-TEMP-STORAGE                    16990200
169903                 UNTIL PV-TEST-CNT > +999                         16990300
169904                     IF PO011-BLK-SUB = +2                        16990400
169905                         DIVIDE PV-BLOCK-NUMBER BY 2              16990500
169906                         GIVING PV-BLOCK-NUMBER-1                 16990600
169907                         REMAINDER PV-REMAINDER                   16990700
169908                         IF  PV-REMAINDER > ZERO                  16990800
169909                             ADD 1 TO PV-BLOCK-NUMBER             16990900
169910                             MOVE +2 TO ASC-BLK-SUB               16991000
169920                             PERFORM 4410-READ-TEMP-STORAGE       16992000
169930                         ELSE                                     16993000
169940                             IF PV-DETERMINE-CNT = +1             16994000
169950                                 MOVE ASC-BLOCK-ENTRIES (1)       16995000
169951                                   TO ASC-BLOCK-ENTRIES (2)       16995100
169952                                 SUBTRACT 1 FROM PV-BLOCK-NUMBER  16995200
169953                                 MOVE +1 TO ASC-BLK-SUB           16995300
169954                                 PERFORM 4410-READ-TEMP-STORAGE   16995400
169955                             ELSE                                 16995500
169956                                 ADD 1 TO PV-BLOCK-NUMBER         16995600
169957                                 MOVE +2 TO ASC-BLK-SUB           16995700
169958                                 PERFORM 4410-READ-TEMP-STORAGE   16995800
169959                             END-IF                               16995900
169960                         END-IF                                   16996000
169961                     ELSE                                         16996100
169962                         IF PV-BLOCK-NUMBER = PO011-BLOCK-NUMBER  16996200
169963                             CONTINUE                             16996300
169964                         ELSE                                     16996400
169965                             ADD 1 TO PV-BLOCK-NUMBER             16996500
169966                             MOVE +2 TO ASC-BLK-SUB               16996600
169967                             PERFORM 4410-READ-TEMP-STORAGE       16996700
169968                         END-IF                                   16996800
169969                     END-IF                                       16996900
169970             END-IF                                               16997000
169971         END-IF                                                   16997100
169972                                                                  16997200
169973     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16997300
169974         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16997400
169975         MOVE SPACE              TO MR-LINE-X (PV-SUB)            16997500
169976                                    MR-MCL    (PV-SUB)            16997600
169977                                    MR-SCL    (PV-SUB)            16997700
169978                                    MR-SKU-NBR (PV-SUB)           16997800
169979                                    MR-LINE-AREA (PV-SUB)         16997900
169980                                    MR-TOTAL-LINE                 16998000
169990     ELSE                                                         16999000
170000*                                                                 17000000
170100         IF  DP030-SET-CURSOR-TRAILER                             17010000
170200             IF (PV-SUB = 1)                                      17020000
170300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               17030000
170400             END-IF                                               17040000
170500         END-IF                                                   17050000
170600*                                                                 17060000
170700                                                                  17070000
170800         IF  PO011-LAST-PO-LNE-NBR = ZEROS                        17080000
170900             CONTINUE                                             17090000
171000         ELSE                                                     17100000
171100                 MOVE ZEROS TO PV-DETERMINE-CNTA                  17110000
171200                 MOVE ZEROS TO PV-DETERMINE-CNTB                  17120000
171300                 MOVE 'N' TO PV-HIT-SW                            17130000
171400                 PERFORM WITH TEST AFTER                          17140000
171410                 VARYING PV-TEST-CNT FROM 1 BY 1                  17141000
171420                 UNTIL PV-TEST-CNT > 6                            17142000
171430                 IF ASC-LINE (1 PV-TEST-CNT) = PO011-PO-LNE-NBR   17143000
171431                      MOVE 'Y' TO PV-HIT-SW                       17143100
171432                 END-IF                                           17143200
171433                 IF PV-HIT-SW = 'Y'                               17143300
171434                 AND ASC-LINE (1 PV-TEST-CNT) > +0                17143400
171435                     ADD 1 TO PV-DETERMINE-CNTA                   17143500
171436                      MOVE ASC-LINE (1 PV-TEST-CNT)               17143600
171437                        TO PV-DETERMINE-CNTB                      17143700
171438                 END-IF                                           17143800
171439                 END-PERFORM                                      17143900
171440                 IF PV-DETERMINE-CNTA > 6                         17144000
171441                     CONTINUE                                     17144100
171442                 ELSE                                             17144200
171443                 PERFORM WITH TEST AFTER                          17144300
171444                 VARYING PV-TEST-CNT FROM 1 BY 1                  17144400
171445                 UNTIL PV-TEST-CNT > 6                            17144500
171446                    OR PV-DETERMINE-CNTA = 7                      17144600
171447                 IF ASC-LINE (2, PV-TEST-CNT) = PO011-PO-LNE-NBR  17144700
171448                 AND PV-HIT-SW = 'N'                              17144800
171449                      MOVE 'Y' TO PV-HIT-SW                       17144900
171450                      MOVE PO011-PO-LNE-NBR TO PV-DETERMINE-CNTB  17145000
171451                      ADD 1 TO PV-DETERMINE-CNTA                  17145100
171452                 END-IF                                           17145200
171453                 IF PV-HIT-SW = 'Y'                               17145300
171454                 AND ASC-LINE (2 PV-TEST-CNT) > +0                17145400
171455                 AND ASC-LINE (2 PV-TEST-CNT) > PV-DETERMINE-CNTB 17145500
171456                     ADD 1 TO PV-DETERMINE-CNTA                   17145600
171457                 END-IF                                           17145700
171458                 END-PERFORM                                      17145800
171459                 END-IF                                           17145900
171460         END-IF                                                   17146000
171461                                                                  17146100
171462         IF  PO011-LAST-PO-LNE-NBR = ZEROS                        17146200
171463             CONTINUE                                             17146300
171464         ELSE                                                     17146400
171465             MOVE PO011-BLK-SUB TO ASC-BLK-SUB                    17146500
171466             MOVE PO011-ITEM-SUB TO ASC-ITEM-SUB                  17146600
171467             IF PO011-BLK-SUB > +1                                17146700
171468                 MOVE ZEROS TO PV-DETERMINE-CNT1                  17146800
171469                 PERFORM WITH TEST AFTER                          17146900
171470                 VARYING PV-TEST-CNT FROM 1 BY 1                  17147000
171471                 UNTIL PV-TEST-CNT > 7                            17147100
171472                 IF ASC-LINE (PO011-BLK-SUB PV-TEST-CNT)          17147200
171473                     = ZEROS                                      17147300
171474                     ADD 1 TO PV-DETERMINE-CNT1                   17147400
171475                 END-IF                                           17147500
171476                 END-PERFORM                                      17147600
171477                 IF PV-DETERMINE-CNT1 = ZEROS                     17147700
171478                     CONTINUE                                     17147800
171479                 ELSE                                             17147900
171480                     IF PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN17148000
171481                         COMPUTE PV-DETERMINE-ITEM1 =             17148100
171482                                 PV-DETERMINE-ITEM -              17148200
171483                                 PV-DETERMINE-CNT                 17148300
171484                         END-COMPUTE                              17148400
171485                         IF PV-DETERMINE-ITEM1 = ZEROS            17148500
171486                            MOVE 6 TO PV-SUB                      17148600
171487                         END-IF                                   17148700
171488                         IF PV-DETERMINE-ITEM1 = +1               17148800
171489                            MOVE 5 TO PV-SUB                      17148900
171490                         END-IF                                   17149000
171491                         IF PV-DETERMINE-ITEM1 = +2               17149100
171492                            MOVE 4 TO PV-SUB                      17149200
171493                         END-IF                                   17149300
171494                         IF PV-DETERMINE-ITEM1 = +3               17149400
171495                            MOVE 3 TO PV-SUB                      17149500
171496                         END-IF                                   17149600
171497                         IF PV-DETERMINE-ITEM1 = +4               17149700
171498                            MOVE 2 TO PV-SUB                      17149800
171499                         END-IF                                   17149900
171500                         IF PV-DETERMINE-ITEM1 = +5               17150000
171501                            MOVE 1 TO PV-SUB                      17150100
171502                         END-IF                                   17150200
171503                     ELSE                                         17150300
171504                         IF PV-BLOCK-NUMBER >                     17150400
171505                            PV-HIGHEST-BLOCK-WRITTEN              17150500
171506                         MOVE PV-DETERMINE-CNT TO PV-SUB          17150600
171507                         ELSE                                     17150700
171508*                        SUBTRACT PV-DETERMINE-CNT FROM PV-SUB    17150800
171509                         IF PV-DETERMINE-CNT = ZEROS              17150900
171510                            MOVE 6 TO PV-SUB                      17151000
171511                         END-IF                                   17151100
171512                         IF PV-DETERMINE-CNT = +1                 17151200
171513                            MOVE 5 TO PV-SUB                      17151300
171514                         END-IF                                   17151400
171515                         IF PV-DETERMINE-CNT = +2                 17151500
171516                            MOVE 4 TO PV-SUB                      17151600
171517                         END-IF                                   17151700
171518                         IF PV-DETERMINE-CNT = +3                 17151800
171519                            MOVE 3 TO PV-SUB                      17151900
171520                         END-IF                                   17152000
171521                         IF PV-DETERMINE-CNT = +4                 17152100
171522                            MOVE 2 TO PV-SUB                      17152200
171523                         END-IF                                   17152300
171524                         IF PV-DETERMINE-CNT = +5                 17152400
171525                            MOVE 1 TO PV-SUB                      17152500
171526                         END-IF                                   17152600
171527                         END-IF                                   17152700
171528                     END-IF                                       17152800
171529                 END-IF                                           17152900
171530             ELSE                                                 17153000
171531                 IF PO011-BLOCK-NUMBER = PV-BLOCK-NUMBER          17153100
171532                     MOVE ZEROS TO PV-DETERMINE-CNT               17153200
171533                     PERFORM WITH TEST AFTER                      17153300
171534                     VARYING PV-TEST-CNT FROM 7 BY -1             17153400
171535                     UNTIL PV-TEST-CNT < +1                       17153500
171536                     IF ASC-LINE (PO011-BLK-SUB PV-TEST-CNT)      17153600
171537                         = PO011-PO-LNE-NBR                       17153700
171538                         MOVE +0 TO PV-TEST-CNT                   17153800
171539                         ADD 1 TO PV-DETERMINE-CNT                17153900
171540                     ELSE                                         17154000
171541                         ADD 1 TO PV-DETERMINE-CNT                17154100
171542                     END-IF                                       17154200
171543                     END-PERFORM                                  17154300
171544                     IF PV-DETERMINE-CNT = ZEROS                  17154400
171545                         CONTINUE                                 17154500
171546                     ELSE                                         17154600
171547                         MOVE PV-DETERMINE-CNT TO PV-SUB          17154700
171548                         MOVE +7 TO PV-DETERMINE-ITEM             17154800
171549                     END-IF                                       17154900
171550                 ELSE                                             17155000
171551                     CONTINUE                                     17155100
171552                 END-IF                                           17155200
171553             END-IF                                               17155300
171554             IF PV-DETERMINE-ITEM > ZEROS                         17155400
171555                 MOVE PV-DETERMINE-ITEM TO ASC-ITEM-SUB           17155500
171556             END-IF                                               17155600
171557             MOVE ZEROS TO PO011-LAST-PO-LNE-NBR                  17155700
171558             MOVE PV-DETERMINE-CNTA TO PV-SUB                     17155800
171559         END-IF                                                   17155900
171560                                                                  17156000
171561         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17156100
171562             IF ASC-LINE(ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS        17156200
171563*                CONTINUE                                         17156300
171564*                IF ASC-BLK-SUB = 2                               17156400
171565                     ADD 1 TO PV-SUB                              17156500
171566*                END-IF                                           17156600
171567             ELSE                                                 17156700
171568                 MOVE ASC-LINE   (ASC-BLK-SUB ASC-ITEM-SUB)       17156800
171569                                     TO MR-LINE (PV-SUB)          17156900
171570                                        DK-PO-LNE-NBR             17157000
171580                 MOVE ASC-MCL    (ASC-BLK-SUB ASC-ITEM-SUB)       17158000
171590                                     TO MR-MCL (PV-SUB)           17159000
171600                 MOVE ASC-SCL    (ASC-BLK-SUB ASC-ITEM-SUB)       17160000
171700                                     TO MR-SCL (PV-SUB)           17170000
171800                 MOVE ASC-SKU    (ASC-BLK-SUB ASC-ITEM-SUB)       17180000
171900                                     TO MR-SKU-NBR (PV-SUB)       17190000
172000                 IF ASC-ITEM-AT-BOT-OF-PANEL = ZEROS              17200000
172100                     MOVE ASC-LINE (ASC-BLK-SUB ASC-ITEM-SUB)     17210000
172200                       TO ASC-ITEM-AT-BOT-OF-PANEL                17220000
172300                 END-IF                                           17230000
172400             END-IF                                               17240000
172500*        END-IF                                                   17250000
172600         PERFORM 4450-CHECK-TWEBITM                               17260000
172700                                                                  17270000
172800         IF PV-DB2-COUNT > 0                                      17280000
172810            MOVE DP015-RED  TO MR-MCLC (PV-SUB)                   17281000
172820                               MR-SCLC (PV-SUB)                   17282000
172830                               MR-SKU-NBRC (PV-SUB)               17283000
172840         ELSE                                                     17284000
172850            MOVE DP015-BLUE TO MR-MCLC  (PV-SUB)                  17285000
172860                               MR-SCLC  (PV-SUB)                  17286000
172870                               MR-SKU-NBRC (PV-SUB)               17287000
172880         END-IF                                                   17288000
172890         END-IF                                                   17289000
172891         IF ASC-LINE(ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS            17289100
172892             CONTINUE                                             17289200
172893         ELSE                                                     17289300
172894             PERFORM 4428-MOVE-DC1                                17289400
172895         END-IF.                                                  17289500
172896*        IF ASC-DISPLAY-QTY                                       17289600
172897*           PERFORM 4425-MOVE-QTY                                 17289700
172898*        ELSE                                                     17289800
172899*        IF ASC-DISPLAY-DC                                        17289900
172900*           PERFORM 4428-MOVE-DC1                                 17290000
173000*        END-IF.                                                  17300000
173100                                                                  17310000
173200     SUBTRACT +1 FROM ASC-ITEM-SUB                                17320000
173300     IF  ASC-ITEM-SUB < + 1                                       17330000
173400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17340000
173500         MOVE +1                 TO ASC-BLK-SUB                   17350000
173600     END-IF.                                                      17360000
173700                                                                  17370000
173800 4421-GET-TEMP-STORAGE.                                           17380000
173900                                                                  17390000
174000     ADD +1 TO PV-TEST-CNT.                                       17400000
174100                                                                  17410000
174110     MOVE +1               TO ASC-BLK-SUB                         17411000
174120     ADD +1                TO PV-BLOCK-NUMBER                     17412000
174130     PERFORM 4410-READ-TEMP-STORAGE                               17413000
174140     IF ASC-LINE (1 1) = PO011-PO-LNE-NBR                         17414000
174150                         MOVE 1000 TO PV-TEST-CNT                 17415000
174160                         MOVE +1 TO PV-DETERMINE-CNT              17416000
174170                         MOVE +0 TO PV-DETERMINE-ITEM             17417000
174180                     END-IF                                       17418000
174190                     IF ASC-LINE (1 2) = PO011-PO-LNE-NBR         17419000
174191                         MOVE 1000 TO PV-TEST-CNT                 17419100
174192                         MOVE +2 TO PV-DETERMINE-CNT              17419200
174193                         MOVE +1 TO PV-DETERMINE-ITEM             17419300
174194                     END-IF                                       17419400
174195                     IF ASC-LINE (1 3) = PO011-PO-LNE-NBR         17419500
174196                         MOVE 1000 TO PV-TEST-CNT                 17419600
174197                         MOVE +2 TO PV-DETERMINE-CNT              17419700
174198                         MOVE +2 TO PV-DETERMINE-ITEM             17419800
174199                     END-IF                                       17419900
174200                     IF ASC-LINE (1 4) = PO011-PO-LNE-NBR         17420000
174201                         MOVE 1000 TO PV-TEST-CNT                 17420100
174202                         MOVE +2 TO PV-DETERMINE-CNT              17420200
174203                         MOVE +3 TO PV-DETERMINE-ITEM             17420300
174204                     END-IF                                       17420400
174205                     IF ASC-LINE (1 5) = PO011-PO-LNE-NBR         17420500
174206                         MOVE 1000 TO PV-TEST-CNT                 17420600
174207                         MOVE +2 TO PV-DETERMINE-CNT              17420700
174208                         MOVE +4 TO PV-DETERMINE-ITEM             17420800
174209                     END-IF                                       17420900
174210                     IF ASC-LINE (1 6) = PO011-PO-LNE-NBR         17421000
174211                         MOVE 1000 TO PV-TEST-CNT                 17421100
174212                         MOVE +2 TO PV-DETERMINE-CNT              17421200
174213                         MOVE +5 TO PV-DETERMINE-ITEM             17421300
174214                     END-IF                                       17421400
174215                     IF ASC-LINE (1 7) = PO011-PO-LNE-NBR         17421500
174216                         MOVE 1000 TO PV-TEST-CNT                 17421600
174217                         MOVE +2 TO PV-DETERMINE-CNT              17421700
174218                         MOVE +6 TO PV-DETERMINE-ITEM             17421800
174219                     END-IF.                                      17421900
174220                                                                  17422000
174230 4425-MOVE-QTY.                                                   17423000
174240      MOVE ASC-DESC   (ASC-BLK-SUB ASC-ITEM-SUB)                  17424000
174250                                 TO PV-DESC.                      17425000
174260      MOVE ASC-QTY    (ASC-BLK-SUB ASC-ITEM-SUB)                  17426000
174270                                 TO PV-QTY.                       17427000
174280      MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)                  17428000
174290                                 TO PV-STATUS.                    17429000
174300      MOVE ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB)                 17430000
174400                                 TO PV-REC-QTY.                   17440000
174500      MOVE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)                 17450000
174600                                 TO PV-REC-PCT.                   17460000
174700      IF ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) = 0               17470000
174800            MOVE SPACES TO PV-REC-PCT-SIGN                        17480000
174900         ELSE                                                     17490000
175000            MOVE PC-PCT TO PV-REC-PCT-SIGN                        17500000
175100      END-IF.                                                     17510000
175200      MOVE PV-NORMAL-LINE TO MR-LINE-AREA(PV-SUB).                17520000
175300                                                                  17530000
175400 4428-MOVE-DC1.                                                   17540000
175500      MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)                  17550000
175600                                 TO PV-STATUS-DC.                 17560000
175700      MOVE ASC-QTY (ASC-BLK-SUB ASC-ITEM-SUB)                     17570000
175800                                 TO PV-QTY-DC.                    17580000
175900      MOVE ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB)                 17590000
176000                                 TO PV-REC-QTY-DC.                17600000
176100      MOVE ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)                 17610000
176200                                 TO PV-REC-PCT-DC.                17620000
176300      IF ASC-REC-PCT (ASC-BLK-SUB ASC-ITEM-SUB) = 0               17630000
176400            MOVE SPACES TO PV-REC-PCT-SIGN-DC                     17640000
176500         ELSE                                                     17650000
176600            MOVE PC-PCT TO PV-REC-PCT-SIGN-DC                     17660000
176700      END-IF.                                                     17670000
176800     IF ASC-DC-COUNTER < +1                                       17680000
176900         MOVE +1 TO ASC-DC-COUNTER                                17690000
177000     END-IF                                                       17700000
177100*    IF ASC-DC-COUNTER < +1                                       17710000
177200*        CONTINUE                                                 17720000
177300*    ELSE                                                         17730000
177400     MOVE ASC-DC    (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER)     17740000
177500                                 TO PV-DC1                        17750000
177600     MOVE ASC-REC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER)    17760000
177700                                 TO PV-REC-DC1                    17770000
177800     MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 1)    17780000
177900                                 TO PV-DC2                        17790000
178000     MOVE ASC-REC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 1)17800000
178100                                 TO PV-REC-DC2                    17810000
178200     MOVE ASC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 2)    17820000
178300                                 TO PV-DC3                        17830000
178400     MOVE ASC-REC-DC (ASC-BLK-SUB ASC-ITEM-SUB ASC-DC-COUNTER + 2)17840000
178500                                 TO PV-REC-DC3                    17850000
178510*    END-IF                                                       17851000
178520     MOVE PV-DC1-LINE TO MR-LINE-AREA(PV-SUB).                    17852000
178530                                                                  17853000
178540*----------------------------------------------------------------*17854000
178550* DETERMINE IF LINE ITEM IS ON TWEBITM TABLE                     *17855000
178560* NOTE : TWEBITM AND TUPCPLS TABLES ARE NOT REPLACED BY LOGISTICS*17856000
178570*        DOMAIN TABLES BECAUSE OF PERFORMANCE ISSUES.            *17857000
178580*----------------------------------------------------------------*17858000
178590 4450-CHECK-TWEBITM.                                              17859000
178600     INITIALIZE PURCHS-PO-NBR                                     17860000
178700                PURITM-PO-LNE-NBR.                                17870000
178710     MOVE ASC-KEY-PO-NUMBER TO PURCHS-PO-NBR.                     17871000
178720     MOVE DK-PO-LNE-NBR     TO PURITM-PO-LNE-NBR.                 17872000
178721     PERFORM                                                      17872100
178722         WITH TEST AFTER                                          17872200
178723         VARYING PV-RETRY-COUNTER                                 17872300
178724         FROM 1 BY 1                                              17872400
178725         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17872500
178726             OR (SQLCODE = +0) OR (SQLCODE = +100))               17872600
178727         EXEC SQL                                                 17872700
178728              SELECT COUNT(*)                                     17872800
178729               INTO :PV-DB2-COUNT                                 17872900
178730               FROM TWEBITM A                                     17873000
178740                   ,TUPCPLS C                                     17874000
178750                   ,TPURITM E                                     17875000
178760                   ,TPURCHS F                                     17876000
178770             WHERE F.PO_NBR = :PURCHS-PO-NBR                      17877000
178780               AND F.PO_NBR = E.PO_NBR                            17878000
178790               AND F.VER_STATUS_CDE = 'A'                         17879000
178800               AND E.VER_STATUS_CDE = 'A'                         17880000
178810               AND E.PO_LNE_NBR = :PURITM-PO-LNE-NBR              17881000
178820               AND E.ITM_NBR = C.ITM_NBR                          17882000
178821               AND C.OPERCO_NBR = '03'                            17882100
178822               AND C.STR_NBR = 0                                  17882200
178823               AND ((C.EFF_BEG_TMST <= CURRENT TIMESTAMP AND      17882300
178824                     C.EFF_END_TMST IS NULL) OR                   17882400
178825                    (C.EFF_BEG_TMST <= CURRENT TIMESTAMP AND      17882500
178826                     C.EFF_END_TMST > CURRENT TIMESTAMP))         17882600
178827               AND   C.UPC_ID = A.INTR_UPC_ID                     17882700
178828               AND  (A.EFF_BEG_TMST <= CURRENT TIMESTAMP          17882800
178829                       AND A.EFF_END_TMST IS NULL)                17882900
178830         END-EXEC                                                 17883000
178831         EVALUATE TRUE                                            17883100
178832             WHEN SQLCODE = +0                                    17883200
178833             WHEN SQLCODE = +100                                  17883300
178834             WHEN SQLCODE = -904                                  17883400
178835             WHEN SQLCODE = -913                                  17883500
178836                  CONTINUE                                        17883600
178837             WHEN SQLWARN0 NOT = SPACES                           17883700
178838             WHEN SQLCODE < +0                                    17883800
178839             WHEN SQLCODE > +0                                    17883900
178840                  MOVE '4450-CHECK-TWEBITM'                       17884000
178841                                  TO DP013-PARAGRAPH              17884100
178842                  MOVE 'UNSUCCESSFUL SELECT COUNT(*)'             17884200
178843                                  TO DP013-MESSAGE-TEXT (1)       17884300
178844                  MOVE SQLCA      TO DP013-SQLCA                  17884400
178845                  MOVE 'TWEBITM ' TO DP013-DB2-TABLE-NAME (1)     17884500
178846                  MOVE 'TUPCPLS ' TO DP013-DB2-TABLE-NAME (2)     17884600
178847                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (3)     17884700
178848                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (4)     17884800
178849                  SET DP013-DB2-ABEND                             17884900
178850                  DP013-XCTL-DISPLAY-RESTART                      17885000
178851                                  TO TRUE                         17885100
178852                  PERFORM DP013-0000-PROCESS-ABEND                17885200
178853         END-EVALUATE                                             17885300
178854     END-PERFORM.                                                 17885400
178855                                                                  17885500
178856     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17885600
178857         MOVE '4450-CHECK-TWEBITM' TO DP013-PARAGRAPH             17885700
178858         MOVE 'MAX RETRIES EXCEEDED FOR SELECT OF TWEBITM'        17885800
178859                                   TO DP013-MESSAGE-TEXT (1)      17885900
178860         MOVE SQLCA               TO DP013-SQLCA                  17886000
178861         MOVE 'TWEBITM '       TO DP013-DB2-TABLE-NAME (1)        17886100
178862         MOVE 'TUPCPLS '       TO DP013-DB2-TABLE-NAME (2)        17886200
178863         MOVE 'TPURITM '       TO DP013-DB2-TABLE-NAME (3)        17886300
178864         MOVE 'TPURCHS '       TO DP013-DB2-TABLE-NAME (4)        17886400
178865         SET DP013-DB2-ABEND                                      17886500
178866             DP013-XCTL-DISPLAY-RESTART                           17886600
178867                                  TO TRUE                         17886700
178868         PERFORM DP013-0000-PROCESS-ABEND                         17886800
178869     END-IF.                                                      17886900
178870                                                                  17887000
178871                                                                  17887100
178872 5100-WRITE-TEMP-STORAGE.                                         17887200
178873                                                                  17887300
178874     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1) TO                 17887400
178875                                              PV-LIST-ITEM-NUMBER.17887500
178876     COMPUTE PV-BLOCK-NUMBER = 1 +                                17887600
178877                 ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).17887700
178878                                                                  17887800
178879     IF PV-BLOCK-NUMBER NOT > ASC-HIGHEST-BLOCK-WRITTEN           17887900
178880        IF ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                       17888000
178881                                                                  17888100
178882            PERFORM 5105-REWRITE-ASC-LISTQ                        17888200
178883                                                                  17888300
178884        END-IF                                                    17888400
178885     ELSE                                                         17888500
178886         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       17888600
178887                                     ASC-HIGHEST-BLOCK-WRITTEN + 117888700
178888         PERFORM 5110-WRITE-ASC-LISTQ                             17888800
178889                                                                  17888900
178890         ADD +1 TO ASC-HIGHEST-BLOCK-WRITTEN                      17889000
178900     END-IF.                                                      17890000
179000                                                                  17900000
179100     SET ASC-BLOCK-NOT-MODIFIED (ASC-BLK-SUB) TO TRUE.            17910000
179200                                                                  17920000
179300 5105-REWRITE-ASC-LISTQ.                                          17930000
179400                                                                  17940000
179500     EXEC CICS WRITEQ TS QUEUE   (ASC-LIST-QUEUE-NAME)            17950000
179600                         FROM    (ASC-BLOCK-ENTRIES(ASC-BLK-SUB)) 17960000
179700                         ITEM    (PV-BLOCK-NUMBER)                17970000
179800                         REWRITE                                  17980000
179900                         RESP    (PV-CICS-RESP)                   17990000
180000                         END-EXEC.                                18000000
180100                                                                  18010000
180200     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       18020000
180300         SET DP013-CICS-ABEND                                     18030000
180400             DP013-NO-ROLLBACK TO TRUE                            18040000
180500         MOVE '5105-REWRITE-ASC-LISTQ' TO DP013-PARAGRAPH         18050000
180600         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE REWRITE'18060000
180700                                         TO DP013-MESSAGE-TEXT (1)18070000
180800         PERFORM DP013-0000-PROCESS-ABEND.                        18080000
180900                                                                  18090000
181000 5110-WRITE-ASC-LISTQ.                                            18100000
181100                                                                  18110000
181200     EXEC CICS WRITEQ TS QUEUE (ASC-LIST-QUEUE-NAME)              18120000
181300                         FROM  (ASC-BLOCK-ENTRIES (ASC-BLK-SUB))  18130000
181400                         ITEM  (PV-BLOCK-NUMBER)                  18140000
181500                         RESP  (PV-CICS-RESP)                     18150000
181600                         END-EXEC.                                18160000
181700                                                                  18170000
181800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18180000
181900         SET DP013-CICS-ABEND                                     18190000
182000             DP013-NO-ROLLBACK TO TRUE                            18200000
182100         MOVE '5110-WRITE-ASC-LISTQ' TO DP013-PARAGRAPH           18210000
182200         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE WRITE'  18220000
182300                                         TO DP013-MESSAGE-TEXT (1)18230000
182400         PERFORM DP013-0000-PROCESS-ABEND.                        18240000
182500                                                                  18250000
182600 EJECT                                                            18260000
182700*----------------------------------------------------------------*18270000
182800*    ABEND PROCESSOR MODULE                                      *18280000
182900*----------------------------------------------------------------*18290000
183000                                                                  18300000
183100     COPY DPPD013.                                                18310000
