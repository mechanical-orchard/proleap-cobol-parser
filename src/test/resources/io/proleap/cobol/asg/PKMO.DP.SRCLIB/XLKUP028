000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    XLKUP028.                                         00040000
000500 AUTHOR.        PAUL JORGENSEN.                                   00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   MAY 2003.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS BATCH DB2 PROGRAM LOADS XLT_PK_UPC                        00100000
001000*  FROM UPCEAN EXTRACT FILE                                       00110000
001400***************************************************************** 00120000
001500 ENVIRONMENT DIVISION.                                            00130000
001600 INPUT-OUTPUT SECTION.                                            00140000
001700                                                                  00150000
001800 FILE-CONTROL.                                                    00160000
001900                                                                  00170000
002000     SELECT XLT-PK-UPC-IN                                         00180000
002010         ASSIGN TO INP01.                                         00190000
002100                                                                  00200000
002200***************************************************************** 00210000
002300 DATA DIVISION.                                                   00220000
002400***************************************************************** 00230000
002500 FILE SECTION.                                                    00240000
002600                                                                  00250000
002700 FD  XLT-PK-UPC-IN                                                00260000
002800     RECORDING MODE IS F                                          00270000
002810     BLOCK CONTAINS 0 RECORDS                                     00280000
002900     LABEL RECORDS ARE STANDARD.                                  00290000
003000                                                                  00300000
003300 01  XLT-PK-UPC-IN-RECORD             PIC X(70).                  00310000
003700                                                                  00320000
003800                                                                  00330000
003900***************************************************************** 00340000
004000 WORKING-STORAGE SECTION.                                         00350000
004100                                                                  00360000
       01  PA-DB2-COMMIT-COUNT              PIC S9(09) VALUE +0         00370000
                                                          COMP-3.       00380000
004200 01  PS-PROGRAM-SWITCHES.                                         00390000
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00400000
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00410000
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00420000
004600                                                                  00430000
004700 01  PC-PROGRAM-CONSTANTS.                                        00440000
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUP028'.00450000
005000                                                                  00460000
005100 01  PV-PROGRAM-VARIABLES.                                        00470000
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00480000
006000     05  PV-RECORDS-INSERTED          PIC  9(09) VALUE  0.        00490000
006000     05  PV-RECORDS-SKIP              PIC  9(09) VALUE  0.        00500000
006400     05  PV-DISP-UPC-ID               PIC  9(09) VALUE  0.        00510000
           05  PV-DISP-UPC-NBR              PIC  9(15) VALUE  0.        00520000
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00530000
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00540000
006900                                                                  00550000
007000                                                                  00560000
007100 01  PV-ABEND-FIELDS.                                             00570000
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00580000
007300                                                 COMP SYNC.       00590000
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUP028'.00600000
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00610000
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00620000
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00630000
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00640000
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00650000
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00660000
008200                                                                  00670000
008300                                                                  00680000
008400***********************************************************       00690000
008500*  COPYBOOK USED FOR THE UPCEAN INPUT FILE              *         00700000
008600***********************************************************       00710000
008700     COPY IMRD076.                                                00720000
008800                                                                  00730000
008900***********************************************************       00740000
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00750000
009100***********************************************************       00760000
009200     COPY DPWS004.                                                00770000
009300                                                                  00780000
009400***********************************************************       00790000
009500*  DB2 SQL COMMUNICATION AREA                             *       00800000
009600***********************************************************       00810000
009700     EXEC SQL                                                     00820000
009800          INCLUDE SQLCA                                           00830000
009900     END-EXEC.                                                    00840000
010000                                                                  00850000
010100***********************************************************       00860000
010200*  XLT_PK_UPC TABLE                                       *       00870000
010300***********************************************************       00880000
010400     EXEC SQL                                                     00890000
010500          INCLUDE XLT00009                                        00900000
010600     END-EXEC.                                                    00910000
010700                                                                  00920000
010800***************************************************************** 00930000
010900 PROCEDURE DIVISION.                                              00940000
011000***************************************************************** 00950000
011100     DISPLAY '**** BEGINNING XLKUP028 ****'.                      00960000
011200     DISPLAY ' '.                                                 00970000
011300                                                                  00980000
011400     OPEN INPUT  XLT-PK-UPC-IN.                                   00990000
011500                                                                  01000000
011600     PERFORM 1000-READ-INPUT-FILE.                                01010000
011700                                                                  01020000
012100     PERFORM 2000-PROCESS-INPUT-FILE                              01030000
012200       UNTIL PS-EOF-INPUT-YES.                                    01040000
012300                                                                  01050000
012400     CLOSE XLT-PK-UPC-IN.                                         01060000
012500                                                                  01070000
012510     PERFORM 3000-TABLE-COMMIT.                                   01080000
012520                                                                  01090000
012600     DISPLAY '  INPUT UPC RECS READ      = ' PV-RECORDS-READ.     01100000
012700     DISPLAY '  XLT_PK_UPC ROWS INSERTED = ' PV-RECORDS-INSERTED. 01110000
012700     DISPLAY '  XLT_PK_UPC ROWS SKIPED   = ' PV-RECORDS-SKIP.     01120000
012800     DISPLAY ' '.                                                 01130000
012900     DISPLAY '****  END OF  XLKUP028  ****'.                      01140000
013000                                                                  01150000
013100     STOP RUN.                                                    01160000
013200                                                                  01170000
013300                                                                  01180000
013400***************************************************************** 01190000
013500*  READ A PACKHEAD EXTRACT RECORD THAT WILL BE USED TO INSERT    *01200000
013510*  A ROW OF DATA INTO THE XLT_PK TABLE.                        *  01210000
013600***************************************************************** 01220000
013700 1000-READ-INPUT-FILE.                                            01230000
013800                                                                  01240000
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01250000
014000                                                                  01260000
           INITIALIZE PA-DB2-COMMIT-COUNT.                              01270000
014020                                                                  01280000
014100     READ XLT-PK-UPC-IN                                           01290000
014200          INTO IM076-PACK-UPC-DATA                                01300000
014300            AT END                                                01310000
014400               SET PS-EOF-INPUT-YES TO TRUE                       01320000
014500                                                                  01330000
014600            NOT AT END                                            01340000
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01350000
014800               ADD +1 TO PV-RECORDS-READ                          01360000
014900     END-READ.                                                    01370000
015000                                                                  01380000
015100                                                                  01390000
015200***************************************************************** 01400000
015300*  LOAD THE INFORMATION FROM THE UPCEAN EXTRACT FILE INTO THE *   01410000
015310*  HOST VARIABLES AND PERFORM A PARAGRAPH TO INSERT THE NEW ROW * 01420000
015320*  INTO THE XLT_PK_UPC TABLE.                                   * 01430000
015400***************************************************************** 01440000
015500 2000-PROCESS-INPUT-FILE.                                         01450000
015600                                                                  01460000
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01470000
015800                                                                  01480000
016361     MOVE IM076-UPC-PK-SKU-NBR       TO XLT00009-PK-SKU-NBR       01490000
016362     MOVE IM076-UPC-UPC-NBR          TO XLT00009-UPC-NBR          01500000
016363     MOVE IM076-UPC-EDI-ORD-IND      TO XLT00009-EDI-ORD-IND      01510000
016380                                                                  01520000
016400     PERFORM 2100-INSERT-XLT-PK-UPC.                              01530000
017700                                                                  01540000
017800     PERFORM 1000-READ-INPUT-FILE.                                01550000
018500                                                                  01560000
018600                                                                  01570000
021600***************************************************************** 01580000
021700*  INSERT A ROW TO THE XLT_PK_UPC TABLE                        *  01590000
021800***************************************************************** 01600000
021900 2100-INSERT-XLT-PK-UPC.                                          01610000
022000                                                                  01620000
022100     EXEC SQL                                                     01630000
022200          INSERT                                                  01640000
022300          INTO  XLT_PK_UPC                                        01650000
023093              ( PK_SKU_NBR                                        01660000
023094               ,UPC_NBR                                           01670000
023095               ,EDI_ORD_IND                                       01680044
                     ,LAST_UPD_TMST)                                    01681044
023200          VALUES                                                  01690000
023993             (  :XLT00009-PK-SKU-NBR                              01700000
023994               ,:XLT00009-UPC-NBR                                 01710000
023995               ,:XLT00009-EDI-ORD-IND                             01720044
                     ,CURRENT TIMESTAMP)                                01721044
024010     END-EXEC.                                                    01730000
024100                                                                  01740000
024200     EVALUATE TRUE                                                01750000
024300         WHEN SQLCODE = ZERO                                      01760000
024400              ADD +1                 TO PV-RECORDS-INSERTED       01770000
                    ADD +1                 TO PA-DB2-COMMIT-COUNT       01780000
                    IF PA-DB2-COMMIT-COUNT > 4500                       01790000
                        PERFORM 3000-TABLE-COMMIT                       01800000
                        MOVE 0 TO PA-DB2-COMMIT-COUNT                   01810000
                    END-IF                                              01820000
               WHEN SQLCODE = -803                                      01830000
                    CONTINUE                                            01840000
               WHEN SQLCODE = -530                                      01850000
024400              ADD +1                 TO PV-RECORDS-SKIP           01860000
024500         WHEN SQLCODE NOT = +0                                    01870000
024600              MOVE '2100-INSERT-XLT-PK-UPC'                       01880000
024700                                     TO PV-ABEND-PARAGRAPH        01890000
024800              MOVE 'INSERT XLT_PK_UPC'                            01900000
024810                                     TO PV-ABEND-OPERATION        01910000
025500              STRING 'SKU NBR: '          DELIMITED BY SIZE       01920000
025600                     IM076-UPC-PK-SKU-NBR DELIMITED BY SIZE       01930000
026700                                   INTO PV-DB2-OPERATION-MESSAGE-101940000
026800                                                                  01950000
026900              MOVE 'XLT_PK_UPC'      TO PV-ABEND-TABLE            01960000
027000              PERFORM Z999-SQL-ABEND                              01970000
027100     END-EVALUATE.                                                01980000
027200                                                                  01990000
027300                                                                  02000000
027400***************************************************************** 02010000
027500* COMMIT THE PENDING TABLE CHANGES.                             * 02020000
027600***************************************************************** 02030000
027700 3000-TABLE-COMMIT.                                               02040000
027800                                                                  02050000
027900     EXEC SQL                                                     02060000
028000          COMMIT                                                  02070000
028100     END-EXEC.                                                    02080000
028200                                                                  02090000
028300                                                                  02100000
028400***************************************************************** 02110000
028500*  DISPLAY DB2 ERROR INFORMATION, ROLLBACK ANY PENDING CHANGES, * 02120000
028510*  AND ABEND THE PROGRAM.                                       * 02130000
028600***************************************************************** 02140000
028700 Z999-SQL-ABEND.                                                  02150000
028800                                                                  02160000
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02170000
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02180000
029100     DISPLAY '*** DB2 ERROR '.                                    02190000
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02200000
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02210000
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02220000
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02230000
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02240000
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02250000
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02260000
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   02270000
030000                                                                  02280000
030100     COPY DPPD004.                                                02290000
030200                                                                  02300000
030300     MOVE +4013         TO PV-ABEND-CODE.                         02310000
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02320000
