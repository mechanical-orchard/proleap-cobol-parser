000100 IDENTIFICATION DIVISION.                                         00010000
000110******************************************************************00011000
000120 PROGRAM-ID.    PXKUT023.                                         00012000
000130 AUTHOR.        JOYCE KNOKE.                                      00013000
000140 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00014000
000150 DATE-WRITTEN.  NOVEMBER 2006.                                    00015000
000160 DATE-COMPILED.                                                   00016000
000170******************************************************************00017000
000180* THIS PROGRAM WILL CREATE AN OUTPUT FILE OF NEXT MOS EVENT       00018000
000190* EFFECTIVE DATE AND ALL THE EVENT ID'S ASSOCIATED TO THAT DATE.  00019000
000200* THIS FILE IS THEN INPUT TO PXKUT024.                            00020000
000300*                                                                 00030000
000400* ORACLE TABLE:                                                   00040000
000500* PET_CLR_MKDN_EVNT.                                              00050000
      ******************** HISTORY OF CHANGES **************************00051099
      * CHG ID/                                                        *00052099
      * WR/PROJ          DATE        DESCRIPTION OF CHANGES            *00053099
      * ---------------  ----------  --------------------------------  *00054099
      *  CHG0215757      01/21/2018  MODIFIED THE PROGRAM TO           *00060099
      *                              EXTERNALIZE ORACLE LOGON          *00070099
      *                              CHANGES TAGGED TO CHG757          *00080099
002400******************************************************************00240000
002500 ENVIRONMENT DIVISION.                                            00250000
002600******************************************************************00260000
002601                                                                  00260100
002602 CONFIGURATION SECTION.                                           00260200
002603                                                                  00260300
002604 INPUT-OUTPUT SECTION.                                            00260400
002605                                                                  00260500
002606 FILE-CONTROL.                                                    00260600
002607                                                                  00260700
002608     SELECT DATE-ADVANCE-FILE                                     00260800
002609         ASSIGN TO INP01.                                         00260900
002610                                                                  00261000
CHG757     SELECT ORACLE-LOGON-FILE                                     00262099
CHG757         ASSIGN TO ORALOGON.                                      00263099
002640                                                                  00264000
006926     SELECT DATE-CONTROL-CARD                                     00264199
006926         ASSIGN TO INP03.                                         00264299
006926                                                                  00264399
002650     SELECT OUT-EVENT-FILE                                        00265000
002660         ASSIGN TO OUT01.                                         00266000
002661                                                                  00266100
002662******************************************************************00266200
002663 DATA DIVISION.                                                   00266300
002664******************************************************************00266400
002665 FILE SECTION.                                                    00266500
002666                                                                  00266600
002667 FD  DATE-ADVANCE-FILE                                            00266700
002668     RECORDING MODE F                                             00266800
002669     LABEL RECORDS ARE STANDARD                                   00266900
002670     BLOCK CONTAINS 0 RECORDS.                                    00267000
002680 01  DATE-ADVANCE-RECORD              PIC  X(80).                 00268000
002690                                                                  00269000
CHG757 FD  ORACLE-LOGON-FILE                                            00270099
CHG757     RECORDING MODE IS F                                          00280099
CHG757     LABEL RECORDS ARE STANDARD                                   00290099
CHG757     BLOCK CONTAINS 0 RECORDS                                     00300099
CHG757     RECORD CONTAINS 80 CHARACTERS                                00310099
CHG757     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00311099
CHG757 01  OL-ORACLE-LOGON-RECORD           PIC X(80).                  00312099
003200                                                                  00320000
006926 FD   DATE-CONTROL-CARD                                           00321099
006926      RECORDING MODE IS F                                         00322099
006926      BLOCK CONTAINS 0 RECORDS                                    00323099
006926      LABEL RECORDS ARE OMITTED.                                  00324099
006926 01   DATE-CONTROL-RECORD             PIC X(80).                  00325099
006926                                                                  00326099
003300 FD  OUT-EVENT-FILE                                               00330000
003400     RECORDING MODE F                                             00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700 01  OUT-EVENT-RECORD                 PIC  X(16).                 00370000
003800                                                                  00380000
003900****************************************************************  00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100****************************************************************  00410000
004200**CONTROL CARD LAYOUTS                                            00420000
004300****************************************************************  00430000
004400 01  CC-DATE-ADVANCE-CARD.                                        00440000
004800     05  FILLER                       PIC  X(01) VALUE SPACE.     00441099
004801     05  CC-NBR-OF-DAYS               PIC  9(03).                 00450099
004802     05  CC-NBR-OF-DAYS-R   REDEFINES   CC-NBR-OF-DAYS            00460099
004803                                      PIC  X(03).                 00470099
004804     05  FILLER                       PIC  X(76) VALUE SPACE.     00480099
004900                                                                  00490000
005000******************************************************************00500000
005400*      ORACLE CONNECTION VARIABLES                                00540099
005500******************************************************************00550000
CHG757 01  CC-ORACLE-CONNECTION.                                        00560099
CHG757     05  CC-ORACLE-USERID             PIC X(40).                  00570099
CHG757         88 CC-AUTO-LOGON                            VALUE '/'.   00580099
CHG757     05  CC-ORACLE-PASSWORD           PIC X(40).                  00590099
006926***************************************************************** 00650199
006926*DATE CONTROL CARD LAYOUT                                         00650299
006926***************************************************************** 00651099
006926 01 CC-CONTROL-DATE.                                              00652099
006926    05 CC-DATE.                                                   00652199
006926       10  CC-CONTROL-YY              PIC  9(04) VALUE ZEROS.     00653099
006926       10  FILLER                     PIC  X(01) VALUE SPACE.     00653199
006926       10  CC-CONTROL-MM              PIC  9(02) VALUE ZEROS.     00654099
006926       10  FILLER                     PIC  X(01) VALUE SPACE.     00654199
006926       10  CC-CONTROL-DD              PIC  9(02) VALUE ZEROS.     00655099
006926       10  FILLER                     PIC  X(70) VALUE SPACES.    00656099
006600****************************************************************  00660099
006700**DATE FIELDS                                                     00670000
006800****************************************************************  00680000
006900 01  DF-ACCEPT-DATE.                                              00690000
007000     05  DF-ACCEPT-YY                 PIC  9(02) VALUE ZEROS.     00700000
007100     05  DF-ACCEPT-MM                 PIC  9(02) VALUE ZEROS.     00710000
007200     05  DF-ACCEPT-DD                 PIC  9(02) VALUE ZEROS.     00720000
007300                                                                  00730000
007400 01  DF-START-DATE.                                               00740000
006926     05  DF-START-YY                  PIC  9(04) VALUE ZEROS.     00760099
007700     05  FILLER                       PIC  X(01) VALUE '-'.       00770000
007800     05  DF-START-MM                  PIC  9(02) VALUE ZEROS.     00780000
007900     05  FILLER                       PIC  X(01) VALUE '-'.       00790000
008000     05  DF-START-DD                  PIC  9(02) VALUE ZEROS.     00800000
008100                                                                  00810000
008200 01  DF-END-DATE.                                                 00820000
008300     05  FILLER                       PIC  9(02) VALUE 20.        00830000
008400     05  DF-END-YY                    PIC  9(02) VALUE ZEROS.     00840000
008500     05  FILLER                       PIC  X(01) VALUE '-'.       00850000
008600     05  DF-END-MM                    PIC  9(02) VALUE ZEROS.     00860000
008700     05  FILLER                       PIC  X(01) VALUE '-'.       00870000
008800     05  DF-END-DD                    PIC  9(02) VALUE ZEROS.     00880000
008900                                                                  00890000
009000 01  DF-FETCH-START-DATE              PIC  X(10).                 00900000
009100 01  DF-FETCH-END-DATE                PIC  X(10).                 00910000
009200                                                                  00920000
009300 01  DF-WORK-DATE                     PIC  X(19).                 00930000
009400 01  DF-WORK-DATE-R   REDEFINES   DF-WORK-DATE.                   00940000
009500     05  DF-DATE-1-10                 PIC  X(10).                 00950000
009600     05  FILLER                       PIC  X(09).                 00960000
009601                                                                  00960100
009602****************************************************************  00960200
009603**PROGRAM ACCUMULATORS                                            00960300
009604****************************************************************  00960400
009605 01  PA-PROGRAM-ACCUMULATORS.                                     00960500
009606     05  PA-TOT-CLR-MKDN-READS        PIC 9(09) VALUE ZEROS.      00960600
009607     05  PA-TOT-OUTPUT-WRITTEN        PIC 9(09) VALUE ZEROS.      00960700
009608                                                                  00960800
009609****************************************************************  00960900
009610**PROGRAM VARIABLES.                                              00961000
009611****************************************************************  00961100
009612 01  PV-PROGRAM-VARIABLES.                                        00961200
009613     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00961300
009614     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     00961400
009615     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     00961500
009616     05  PV-OPERATION-MSG             PIC  X(30) VALUE SPACE.     00961600
CHG757     05  PV-ORACLE-USERID-LEN         PIC  S9(4) VALUE ZEROS      00961799
CHG757                                                 COMP SYNC.       00961899
CHG757     05  PV-ORACLE-PASSWORD-LEN       PIC  S9(4) VALUE ZEROS      00961999
CHG757                                                 COMP SYNC.       00962099
009617                                                                  00962100
009618****************************************************************  00962200
009619**PROGRAM SWITCHES.                                               00962300
009620****************************************************************  00962400
009621 01  PS-PROGRAM-SWITCHES.                                         00962500
009622     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       00962600
009623         88 PS-END-OF-FILE-N                     VALUE 'N'.       00962700
009624         88 PS-END-OF-FILE-Y                     VALUE 'Y'.       00962800
009625     05  PS-END-OF-CSR-SW             PIC  X(01) VALUE 'N'.       00962900
009626         88 PS-END-OF-CSR-N                      VALUE 'N'.       00963000
009627         88 PS-END-OF-CSR-Y                      VALUE 'Y'.       00963100
006926     05  PS-END-OF-DATE-CONTROL-SW    PIC  X(01) VALUE 'N'.       00963499
006926         88  PS-END-OF-DATE-CONTROL              VALUE 'Y'.       00963599
CHG757     05  PS-END-OF-LOGON-FILE-SW      PIC  X(01) VALUE 'N'.       00963699
CHG757         88 PS-END-OF-LOGON-FILE                 VALUE 'Y'.       00963799
CHG757     05  PS-ORA-SRC-CTL-DONE-SW       PIC  X(01) VALUE 'N'.       00963899
CHG757         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       00963999
009630                                                                  00964000
009631****************************************************************  00964100
009632**PROGRAM CONSTANTS.                                              00964200
009633****************************************************************  00964300
009634 01  PC-PROGRAM-CONSTANTS.                                        00964400
009635     05  PC-PROGRAM-NAME         PIC  X(08) VALUE 'PXKUT023'.     00964500
CHG757     05  PC-AUTO-LOGON                PIC X(1)      VALUE '/'.    00964699
009636                                                                  00964700
009637****************************************************************  00964800
009638**ABEND INFORMATION                                               00964900
009639****************************************************************  00965000
009640 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       00965100
009650                                                 COMP SYNC.       00965200
009660     88  AC-DB2-ERROR                            VALUE +4013.     00966000
009670     88  AC-NO-CONTROL-CARD                      VALUE +4002.     00967000
009680     88  AC-CONTROL-CARD-ERROR                   VALUE +4003.     00968000
009681     88  AC-ORACLE-BAD-LOGON-4004                VALUE +4004.     00968100
009682                                                                  00968200
009683************************************************************      00968300
009684* MOS EVENT EXTRACT                                               00968400
009685************************************************************      00968500
009686     COPY PXRD029.                                                00968600
009687                                                                  00968700
010600***************************************************************** 01060000
010900*  ABEND ROUTINE INFORMATION                                      01090000
010910***************************************************************** 01091000
011000     COPY DPWS900.                                                01100000
011001                                                                  01100100
011002***************************************************************** 01100200
011100*  ABEND ROUTINE INFORMATION                                      01110000
011110***************************************************************** 01111000
011200     COPY DPWS004.                                                01120000
011201                                                                  01120100
011202******************************************************************01120200
011203*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01120300
011204******************************************************************01120400
011205     COPY DPWS500.                                                01120500
011206                                                                  01120600
011207****************************************************************  01120700
011208**ORACLE DECLARE SECTION                                          01120800
011209****************************************************************  01120900
011210     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01121000
011220 01  USERNAME                         PIC X(10)  VARYING.         01122000
011230 01  PASSWD                           PIC X(10)  VARYING.         01123000
011231 01  PV-ORACLE-ID                     PIC X(01)  VALUE '/'.       01123100
011232                                                                  01123200
012200****************************************************************  01220000
012300**ORACLE TABLE INCLUSIONS                                         01230000
012400****************************************************************  01240000
012500***TABLE PET_CLR_MKDN_EVNT                                        01250000
012600     EXEC SQL                                                     01260000
012700          INCLUDE PET00001                                        01270000
012800     END-EXEC.                                                    01280000
012900                                                                  01290000
014500     EXEC SQL END DECLARE SECTION END-EXEC.                       01450000
014600     EXEC SQL INCLUDE SQLCACOB END-EXEC.                          01460000
014700                                                                  01470000
014710****************************************************************  01471000
014800 PROCEDURE DIVISION.                                              01480000
014900******************************************************************01490000
015000 0000-MAINLINE.                                                   01500000
015200     PERFORM 1000-HOUSEKEEPING.                                   01520000
015210                                                                  01521000
015300     PERFORM 2000-DECLARE-CURSOR.                                 01530000
015301                                                                  01530100
015302     PERFORM 2200-OPEN-CURSOR.                                    01530200
015303                                                                  01530300
015304     PERFORM 4000-FETCH-CURSOR.                                   01530400
015305                                                                  01530500
015306     PERFORM 2400-PROCESS-CURSOR                                  01530600
015400             UNTIL PS-END-OF-CSR-Y.                               01540000
015401                                                                  01540100
015402     PERFORM 2600-CLOSE-CURSOR.                                   01540200
015403                                                                  01540300
015500     PERFORM 9000-END-OF-JOB.                                     01550000
015510                                                                  01551000
015600     STOP RUN.                                                    01560000
015700                                                                  01570000
015900****************************************************************  01590000
016000*     OPEN FILES, READ IN AND VALIDATE CONTROL DATE.              01600000
016100****************************************************************  01610000
016200 1000-HOUSEKEEPING.                                               01620000
016800     OPEN INPUT  ORACLE-LOGON-FILE                                01680099
CHG757                                                                  01690099
CHG757     DISPLAY 'ORACLE FILE READ'.                                  01700099
CHG757     PERFORM 8000-READ-ORACLE-LOGON.                              01710099
CHG757                                                                  01720099
CHG757     DISPLAY 'ORACLE FILE CLOSE'.                                 01730099
CHG757     CLOSE ORACLE-LOGON-FILE.                                     01740099
CHG757                                                                  01750099
CHG757     IF ((PS-END-OF-LOGON-FILE)                                   01760099
CHG757              OR (CC-ORACLE-CONNECTION = SPACES))                 01761099
CHG757           DISPLAY '** ABEND **'                                  01762099
CHG757           DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '01763099
CHG757               'NOT PROVIDED'                                     01764099
CHG757           SET PS-ORA-SRC-EMPTY TO TRUE                           01765099
CHG757           CALL 'ILBOABN0' USING AC-ABEND-CODE                    01766099
CHG757     END-IF.                                                      01767099
CHG757                                                                  01768099
CHG757         IF CC-AUTO-LOGON                                         01769099
CHG757             DISPLAY PC-PROGRAM-NAME  ' - AUTO LOGON TO ORACLE'   01769199
CHG757             EXEC SQL                                             01769299
CHG757               CONNECT  :PC-AUTO-LOGON                            01769399
CHG757             END-EXEC                                             01769499
CHG757     ELSE                                                         01769599
CHG757         INITIALIZE PV-ORACLE-USERID-LEN                          01769699
CHG757                    PV-ORACLE-PASSWORD-LEN                        01769799
CHG757           INSPECT    CC-ORACLE-USERID                            01769899
CHG757             TALLYING   PV-ORACLE-USERID-LEN                      01769999
CHG757             FOR CHARACTERS BEFORE INITIAL SPACE                  01770099
CHG757           INSPECT    CC-ORACLE-PASSWORD                          01771099
CHG757             TALLYING   PV-ORACLE-PASSWORD-LEN                    01772099
CHG757             FOR CHARACTERS BEFORE INITIAL SPACE                  01773099
CHG757         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO        01774099
CHG757                    USERNAME-ARR                                  01775099
CHG757         MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                01776099
CHG757         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    01777099
CHG757                      PASSWD-ARR                                  01778099
CHG757         MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                01779099
CHG757           DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER ' 01779199
CHG757                      USERNAME-ARR                                01779299
CHG757            EXEC SQL                                              01779399
CHG757                 CONNECT :USERNAME IDENTIFIED BY :PASSWD          01779499
CHG757            END-EXEC                                              01779599
CHG757         INITIALIZE CC-ORACLE-PASSWORD                            01779699
CHG757                    PASSWD                                        01779799
CHG757     END-IF.                                                      01779899
CHG757                                                                  01780099
263500         IF SQLCODE NOT = 0                                       01780199
263600            DISPLAY '** CONNECTING TO ORACLE BY USERID **'        01780299
263700            DISPLAY 'TRIED TO CONNECT TO ORACLE UNDER: '          01780399
263800                                  PASSWD                          01780499
263900            SET AC-ORACLE-BAD-LOGON-4004 TO TRUE                  01780599
264100               PERFORM 9999-SQL-ABEND                             01780799
264200         END-IF.                                                  01780899
264300                                                                  01780999
CHG757     OPEN   INPUT  DATE-ADVANCE-FILE                              01781099
CHG757                   DATE-CONTROL-CARD                              01781199
CHG757     OPEN   OUTPUT OUT-EVENT-FILE.                                01782099
CHG757                                                                  01790099
261000     PERFORM 1200-READ-INPUT-FILE.                                26100000
264801                                                                  26480100
006926     READ DATE-CONTROL-CARD INTO CC-CONTROL-DATE                  26480299
006926         AT END                                                   26480399
006926             SET PS-END-OF-DATE-CONTROL TO TRUE.                  26480499
006926                                                                  26480699
006926     IF PS-END-OF-DATE-CONTROL                                    26480799
006926             MOVE '**  DATE CONTROL CARD MISSING  **'             26480899
006926                                 TO PV-OPERATION-MSG              26480999
006926             SET AC-NO-CONTROL-CARD TO TRUE                       26481099
006926             PERFORM 9800-ABEND                                   26481199
006926     END-IF.                                                      26481299
006926     DISPLAY PC-PROGRAM-NAME ' DATE CONTROL CARD:  '              26481399
006926             CC-CONTROL-DATE.                                     26481499
006926                                                                  26481599
006926*    ACCEPT DF-ACCEPT-DATE FROM DATE.                             26481699
006926     MOVE CC-DATE TO DF-START-DATE                                26481799
261006     PERFORM 9999-DATE-ROUTINE-INCR-DAYS.                         26481899
261007                                                                  26481999
261100     DISPLAY '      '.                                            26482099
261101     DISPLAY '********************************************'.      26482199
261102     DISPLAY '***   ' PC-PROGRAM-NAME '   ***'.                   26482299
261103     DISPLAY '****  START DATE   =  ' DF-START-DATE.              26482399
261104     DISPLAY '****  END DATE     =  ' DF-END-DATE.                26482499
261105     DISPLAY '****  ADVANCE DAYS =  ' CC-NBR-OF-DAYS.             26482599
261106     DISPLAY '********************************************'.      26482699
261107                                                                  26482799
264802****************************************************************  26482800
264803*     READ AND PROCESS INPUT FILE.                                26482900
264804****************************************************************  26483000
264805 1200-READ-INPUT-FILE.                                            26483100
264806     READ DATE-ADVANCE-FILE INTO CC-DATE-ADVANCE-CARD             26483200
264807        AT END                                                    26483300
264808           SET PS-END-OF-FILE-Y      TO TRUE                      26483400
264809     END-READ.                                                    26483500
264811     IF PS-END-OF-FILE-Y                                          26483600
264812        MOVE '1200-READ-INPUT-FILE'  TO PV-PARAGRAPH-NAME         26483700
264813        MOVE 'NO DATE ADVANCE RECORD' TO PV-OPERATION-MSG-1       26483800
264814        SET AC-CONTROL-CARD-ERROR     TO TRUE                     26483900
264815        PERFORM 9800-ABEND                                        26484000
264816     END-IF.                                                      26484100
264817                                                                  26484200
264818     IF CC-NBR-OF-DAYS-R NOT NUMERIC                              26484300
264819        MOVE '1200-READ-INPUT-FILE'  TO PV-PARAGRAPH-NAME         26484400
264820        MOVE 'INVALID ADVANCE RECORD' TO PV-OPERATION-MSG-1       26484500
264830        SET AC-CONTROL-CARD-ERROR     TO TRUE                     26484600
264831        DISPLAY '** CC-NBR-OF-DAYS = ' CC-NBR-OF-DAYS-R           26484700
264832        PERFORM 9800-ABEND                                        26484800
264833     END-IF.                                                      26484900
264834                                                                  26485000
264835****************************************************************  26485100
264836*     DECLARE CURSOR. THE CURSOR EXCLUDES MARK1 SINCE NO QUERY    26485200
264837*     WILL BE RUN FOR IT. IT INCLUDES MARK2/FINAL ONLY IF ITS     26485300
264838*     CLR_LAST_EF_DTE FALLS BETWEEN THE FIRST DAY OF THE          26485400
264839*     CALCULATED WEEK (PV-1STDAY-ADVANCE-TO-WK) AND THE LAST DAY  26485500
264840*     OF THE CALCULATED DATE (PV-LSTDAY-ADVANCE-TO-DATE).         26485600
264841****************************************************************  26485700
264842 2000-DECLARE-CURSOR.                                             26485800
264843     MOVE DF-START-DATE TO DF-FETCH-START-DATE.                   26485900
264845     MOVE DF-END-DATE TO DF-FETCH-END-DATE.                       26486000
264846     EXEC SQL                                                     26486100
264847        DECLARE MARKDOWN CURSOR FOR                               26486200
264848         SELECT CLR_EVNT_ID,                                      26486300
264849                CLR_FRST_EFF_DTE                                  26486400
264850           FROM PET_CLR_MKDN_EVNT                                 26486500
264860          WHERE ACTV_IND         = 'Y'                            26486600
264870            AND CLR_MKDN_CDE     = 'O'                            26487000
264871            AND CLR_FRST_EFF_DTE =                                26488099
264874                 TO_DATE(:DF-FETCH-END-DATE, 'YYYY-MM-DD')        26500099
265001          ORDER BY                                                26500100
265002                CLR_EVNT_ID,                                      26500200
265003                CLR_MKDN_CDE                                      26500300
265004     END-EXEC.                                                    26500400
265005                                                                  26500500
265006     EVALUATE TRUE                                                26500600
265007        WHEN SQLCODE NOT EQUAL ZERO                               26500700
265008           MOVE '2000-DECLARE-CURSOR' TO PV-PARAGRAPH-NAME        26500800
265009           MOVE 'CURSOR DECLARE ERROR' TO PV-OPERATION-MSG        26500900
265010           PERFORM 9999-SQL-ABEND                                 26501000
265011     END-EVALUATE.                                                26501100
265012                                                                  26501200
265013****************************************************************  26501300
265014*     OPEN CURSOR.                                                26501400
265015****************************************************************  26501500
265016 2200-OPEN-CURSOR.                                                26501600
265017     EXEC SQL                                                     26501700
265018        OPEN MARKDOWN                                             26501800
265019     END-EXEC.                                                    26501900
265020                                                                  26502000
265021     EVALUATE TRUE                                                26502100
265022        WHEN SQLCODE NOT EQUAL ZERO                               26502200
265023           MOVE '2200-OPEN-CURSOR'    TO PV-PARAGRAPH-NAME        26502300
265024           MOVE 'CURSOR OPEN ERROR'   TO PV-OPERATION-MSG         26502400
265025           PERFORM 9999-SQL-ABEND                                 26502500
265026     END-EVALUATE.                                                26502600
265027                                                                  26502700
265028****************************************************************  26502800
265029**    PROCESS CURSOR                                              26502900
265030****************************************************************  26503000
265040 2400-PROCESS-CURSOR.                                             26504000
265050     MOVE CLR-EVNT-ID      TO PX029-EVENT-ID.                     26505000
265060     MOVE CLR-FRST-EFF-DTE TO DF-WORK-DATE.                       26506000
265061     MOVE DF-DATE-1-10     TO PX029-MOS-EFF-DATE.                 26506100
265062     WRITE OUT-EVENT-RECORD FROM PX029-MOS-EVENT-EXTRACT.         26506200
265063     ADD 1 TO PA-TOT-OUTPUT-WRITTEN.                              26506300
265064     PERFORM 4000-FETCH-CURSOR.                                   26506400
265065                                                                  26506500
265066****************************************************************  26506600
265067**    CLOSE MARKDOWN CURSOR.                                      26506700
265068****************************************************************  26506800
265069 2600-CLOSE-CURSOR.                                               26506900
265070     EXEC SQL                                                     26507000
265071        CLOSE MARKDOWN                                            26507100
265072     END-EXEC.                                                    26507200
265073                                                                  26507300
265074     EVALUATE TRUE                                                26507400
265075        WHEN SQLCODE EQUAL ZERO                                   26507500
265076           CONTINUE                                               26507600
265077        WHEN OTHER                                                26507700
265078           MOVE '2600-CLOSE-CURSOR'   TO PV-PARAGRAPH-NAME        26507800
265079           MOVE 'CURSOR CLOSE ERROR'  TO PV-OPERATION-MSG         26507900
265080           PERFORM 9999-SQL-ABEND                                 26508000
265081     END-EVALUATE.                                                26508100
265082                                                                  26508200
265083****************************************************************  26508300
265084**    FETCH CURSOR                                                26508400
265085****************************************************************  26508500
265086 4000-FETCH-CURSOR.                                               26508600
265087     EXEC SQL                                                     26508700
265088        FETCH MARKDOWN                                            26508800
265089         INTO :CLR-EVNT-ID                                        26508900
265090             ,:CLR-FRST-EFF-DTE                                   26509000
265091     END-EXEC.                                                    26509100
265092                                                                  26509200
265093     EVALUATE TRUE                                                26509300
265094        WHEN SQLCODE EQUAL ZERO                                   26509400
265095            ADD 1 TO PA-TOT-CLR-MKDN-READS                        26509500
265096        WHEN SQLCODE = +1403                                      26509600
265097           SET PS-END-OF-CSR-Y        TO TRUE                     26509700
265098        WHEN OTHER                                                26509800
265099           MOVE '4000-FETCH-CURSOR'   TO PV-PARAGRAPH-NAME        26509900
265100           MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG         26510000
265101           PERFORM 9999-SQL-ABEND                                 26510100
265102     END-EVALUATE.                                                26510200
265103                                                                  26510300
CHG757****************************************************************  26510499
CHG757* LOGON TO ORACLE                                                 26510599
CHG757****************************************************************  26510699
CHG757 8000-READ-ORACLE-LOGON.                                          26510799
CHG757                                                                  26510899
CHG757     READ ORACLE-LOGON-FILE                                       26510999
CHG757         INTO CC-ORACLE-CONNECTION                                26511099
CHG757         AT END                                                   26511199
CHG757             SET PS-END-OF-LOGON-FILE TO TRUE                     26511299
CHG757     END-READ.                                                    26511399
CHG757                                                                  26511499
265104****************************************************************  26511500
265105*     CLOSE FILES.                                                26511600
265106****************************************************************  26511700
265107 9000-END-OF-JOB.                                                 26511800
265108     CLOSE DATE-ADVANCE-FILE                                      26511900
006926           DATE-CONTROL-CARD                                      26512199
265110           OUT-EVENT-FILE.                                        26512200
265120                                                                  26512300
265130     DISPLAY ' '.                                                 26513000
265140     DISPLAY '*********************************************'.     26514000
265150     DISPLAY '    PXKUT023 SUMMARY STATISTICS              '      26515000
265160     DISPLAY '*********************************************'.     26516000
265170     DISPLAY 'CLR MKDN RECS READ........: ' PA-TOT-CLR-MKDN-READS 26517000
265180     DISPLAY 'OUTPUT RECS WRITTEN.......: ' PA-TOT-OUTPUT-WRITTEN 26518000
265181     DISPLAY '*********************************************'.     26518100
265182                                                                  26518200
265183****************************************************************  26518300
265184*     NON-DATABASE ABEND.                                         26518400
265185****************************************************************  26518500
265186 9800-ABEND.                                                      26518600
266400     DISPLAY '** ABEND     **'.                                   26640000
266500     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                26650000
266600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              26660000
266700     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               26670000
267300                                                                  26730000
267400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         26740000
267500                                                                  26750000
267600******************************************************************26760000
267700*    KOHLS DATE ROUTINE                                           26770000
267800******************************************************************26780000
267900 9999-DATE-ROUTINE-INCR-DAYS.                                     26790000
268000     MOVE '9999-DATE-ROUTINE-INCR-DAYS' TO PV-PARAGRAPH-NAME.     26800000
268100                                                                  26810000
268200     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              26820000
268300                                                                  26830000
268400     SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                     26840000
268500     SET DPG51-INCREMENT-DATE        TO TRUE.                     26850000
268600     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     26860000
268700     MOVE CC-NBR-OF-DAYS             TO DPG51-INCR-DECR-DAYS-9.   26870000
268800     MOVE DF-START-DATE              TO DPG52-LK-DATE-INPUT.      26880000
268900                                                                  26890000
269000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                26900000
269100                                             DPG52                26910000
269200                                             DPG53                26920000
269300                                             DPG54                26930000
269400                                             DPG55                26940000
269500                                             DPG56.               26950000
269600     EVALUATE TRUE                                                26960000
269700        WHEN DPG54-NO-ERROR                                       26970000
269800             MOVE DPG55-DB2-ISO-DATE-FMT                          26980000
269900               TO DF-END-DATE                                     26990000
270000        WHEN OTHER                                                27000000
270100             DISPLAY 'ERROR ROUTINE ABEND'                        27010000
270200     END-EVALUATE.                                                27020000
270201                                                                  27020100
270202******************************************************************27020200
270203*     SQL ABEND PARAGRAPH.                                        27020300
270204******************************************************************27020400
270205 9999-SQL-ABEND.                                                  27020500
270206     DISPLAY '** ABEND     **'.                                   27020600
270207     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                27020700
270208     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              27020800
270209     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               27020900
270210                                                                  27021000
270211******************************************************************27021100
270212* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     27021200
270213* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      27021300
270214******************************************************************27021400
270215     COPY DPPD004.                                                27021500
270216     SET AC-DB2-ERROR TO TRUE.                                    27021600
270217     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         27021700
