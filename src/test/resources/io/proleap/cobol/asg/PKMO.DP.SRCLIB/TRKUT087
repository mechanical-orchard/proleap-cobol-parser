000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              TRKUT087.                               00020001
000300 AUTHOR.                  DENISE HAHN.                            00030001
000400 DATE-WRITTEN.            APRIL 2013.                             00040001
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM RETRIEVES ALL ROWS ON DISTRIBUTION HEADER TABLE   *00080001
000900* THAT IS SUSPENDED DUE TO "NO PRO" IF THE RECEIVER IS ATTACHED  *00090001
000910* TO AN UNLOADED TRAILER, THE SHIPMENT WILL BE WRITTEN TO AN     *00091001
000911* OUTPUT FILE.  THE FILE WILL BE USED BY TRKUP087 TO UPDATE THE  *00091101
000912* PRO NUMBER TO ALLOW THE RECEIVER TO VERIFY.                    *00091201
000920******************************************************************00092000
000930 ENVIRONMENT DIVISION.                                            00093000
000940 CONFIGURATION SECTION.                                           00094000
000950                                                                  00095000
000960 INPUT-OUTPUT SECTION.                                            00096000
000970 FILE-CONTROL.                                                    00097000
000980                                                                  00098000
000990     SELECT OUTPUT-FILE                                           00099000
001000        ASSIGN TO OUT01.                                          00100000
001100                                                                  00110000
001200 DATA DIVISION.                                                   00120000
001300 FILE SECTION.                                                    00130000
001400                                                                  00140000
001500 FD  OUTPUT-FILE                                                  00150000
001600     RECORDING MODE IS F                                          00160000
001700     LABEL RECORDS ARE STANDARD                                   00170000
001800     RECORD CONTAINS 200 CHARACTERS                               00180000
001900     DATA RECORD IS OUTPUT-RECORD.                                00190000
002000                                                                  00200000
002100 01  OUTPUT-RECORD               PIC X(200).                      00210000
002200                                                                  00220000
002300                                                                  00230000
002400 WORKING-STORAGE SECTION.                                         00240000
002500                                                                  00250000
002900 01  PROGRAM-SWITCHES.                                            00290000
003000     05  PA-END-OF-NOPRO-SW          PIC X(01)   VALUE 'N'.       00300004
003100         88  PS-END-OF-NOPRO                     VALUE 'Y'.       00310004
003110         88  PS-NOT-END-OF-NOPRO                 VALUE 'N'.       00311004
003200     05  PS-ERROR-SW                 PIC  X(01)  VALUE 'N'.       00320000
003300         88  PS-ERROR                            VALUE 'Y'.       00330010
003400         88  PS-ERROR-NO                         VALUE 'N'.       00340000
003500                                                                  00350000
003600 01  PROGRAM-VARIABLES.                                           00360000
003700                                                                  00370000
005300     05  PV-PARAGRAPH                PIC X(30).                   00530004
005400     05  PV-DB2-FUNCTION             PIC X(30).                   00540004
005410                                                                  00541004
005501     05  PV-INPUT-COUNT              PIC  9(09) VALUE ZEROES.     00550104
005502     05  PV-OUTPUT-COUNT             PIC  9(09) VALUE ZEROES.     00550204
005503                                                                  00550304
005510     05  PV-DISP-SHIPT-ID            PIC  Z(09) VALUE ZEROES.     00551004
005520     05  PV-DISP-TRIP-ID             PIC  Z(09) VALUE ZEROES.     00552004
005540     05  PV-DISP-ORD-NBR             PIC  Z(09) VALUE ZEROES.     00554004
005550     05  PV-DISP-RCVR-SEQ-NBR        PIC  9(04) VALUE ZEROES.     00555004
005560     05  PV-DISP-OPER-UNT-ID         PIC  9(04) VALUE ZEROES.     00556004
005570     05  PV-DISP-COUNT               PIC  ZZZ,ZZZ,ZZ9.            00557004
005571                                                                  00557111
005580 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00558011
005590     88 ABEND-4013                         VALUE +4013.           00559011
005700                                                                  00570004
006000***************************************************************** 00600000
006100*    OUTPUT FILE LAYOUT.                                        * 00610000
006200***************************************************************** 00620000
006300     COPY TRRD068.                                                00630004
006400                                                                  00640000
007000***************************************************************** 00700000
007100*    SQL ABEND ROUTINE WORKING STORAGE                          * 00710000
007200***************************************************************** 00720000
007300     COPY DPWS004.                                                00730000
007400                                                                  00740000
007500     EXEC SQL                                                     00750000
007600        INCLUDE TDISTHD                                           00760004
007700     END-EXEC.                                                    00770000
007800                                                                  00780000
007900     EXEC SQL                                                     00790000
008000        INCLUDE TSHPTPO                                           00800004
008100     END-EXEC.                                                    00810000
008200                                                                  00820000
008300     EXEC SQL                                                     00830000
008400        INCLUDE TSHIPMT                                           00840004
008500     END-EXEC.                                                    00850000
008510                                                                  00851004
008600     EXEC SQL                                                     00860000
008700        INCLUDE TTRIPST                                           00870004
008800     END-EXEC.                                                    00880000
008810                                                                  00881004
008900     EXEC SQL                                                     00890000
009000        INCLUDE TRECEIV                                           00900004
009100     END-EXEC.                                                    00910000
009500                                                                  00950000
009600     EXEC SQL                                                     00960000
009700        INCLUDE SQLCA                                             00970000
009800     END-EXEC.                                                    00980000
009900                                                                  00990000
010000     EXEC SQL                                                     01000000
010100        DECLARE NOPRO_CURSOR CURSOR FOR                           01010004
010200         SELECT DISTINCT                                          01020002
010300                B.SHIPT_ID                                        01030002
010400              , C.TRIP_ID                                         01040002
010500              , C.PRO_NBR                                         01050002
010600              , A.ORD_NBR                                         01060002
010700              , A.RCVR_SEQ_NBR                                    01070002
010800              , A.OPER_UNT_ID                                     01080002
010900              , A.PRCG_STAT_CDE                                   01090002
011000              , D.TRIP_STATUS_CDE                                 01100002
011100              , D.STATUS_DTE                                      01110002
011200              , D.STATUS_TME                                      01120002
011300          FROM TDISTHD A                                          01130002
011400             , TSHPTPO B                                          01140002
011500             , TSHIPMT C                                          01150002
011600             , TTRIPST D                                          01160002
011700             , TRECEIV H                                          01170002
011800         WHERE A.PRCG_STAT_CDE  = 'F'                             01180002
011900           AND A.ORD_NBR        =  B.PO_NBR                       01190002
012000           AND A.RCVR_SEQ_NBR   =  B.REC_SEQ_NBR                  01200002
012100           AND B.SHIPT_ID       =  C.SHIPT_ID                     01210002
012110           AND C.PRO_NBR        =  ' '                            01211013
012200           AND C.TRIP_ID        =  D.TRIP_ID                      01220002
012300           AND D.STATUS_DTE IN                                    01230002
012400               (SELECT MAX(E.STATUS_DTE)                          01240002
012500                  FROM TTRIPST E                                  01250004
012600                 WHERE D.TRIP_ID  =  E.TRIP_ID)                   01260002
012700           AND D.STATUS_TME  IN                                   01270002
012800               (SELECT MAX(F.STATUS_TME)                          01280002
012900                  FROM TTRIPST F                                  01290004
013000                 WHERE D.TRIP_ID  =  F.TRIP_ID                    01300002
013100                   AND F.STATUS_DTE  IN                           01310002
013200                      (SELECT MAX(G.STATUS_DTE)                   01320002
013210                         FROM TTRIPST G                           01321004
013220                        WHERE F.TRIP_ID  =  G.TRIP_ID)            01322002
013230                )                                                 01323002
013240            AND D.TRIP_STATUS_CDE IN ('UN','DP','ET')             01324014
013250            AND A.ORD_NBR          = H.ORD_NBR                    01325002
013260            AND A.RCVR_SEQ_NBR     = H.REC_SEQ_NBR                01326002
013270            AND H.VER_STATUS_CDE = 'A'                            01327002
013280         ORDER BY B.SHIPT_ID                                      01328002
013290                , C.TRIP_ID                                       01329002
013291                , C.PRO_NBR                                       01329102
013292                , A.ORD_NBR                                       01329202
013293                , A.RCVR_SEQ_NBR                                  01329302
013294                , A.OPER_UNT_ID                                   01329402
013295         WITH UR                                                  01329502
013300     END-EXEC.                                                    01330000
013400                                                                  01340000
013500***********************************************************       01350000
013600 PROCEDURE DIVISION.                                              01360000
013700***********************************************************       01370000
013800     OPEN OUTPUT OUTPUT-FILE.                                     01380000
013900                                                                  01390000
013901     SET  PS-NOT-END-OF-NOPRO                                     01390104
013902          PS-ERROR-NO          TO  TRUE.                          01390204
013910                                                                  01391004
014000     PERFORM 7000-OPEN-CURSOR.                                    01400004
014100                                                                  01410004
014200     PERFORM 7010-FETCH-CURSOR.                                   01420004
014300                                                                  01430004
014310     PERFORM 2000-PROCESS-NO-PRO-CSR                              01431004
014320       UNTIL PS-END-OF-NOPRO                                      01432004
014330          OR PS-ERROR.                                            01433004
014340                                                                  01434004
014400     PERFORM 7030-CLOSE-CURSOR.                                   01440004
014500                                                                  01450000
014700                                                                  01470000
014800     DISPLAY '************************************************'   01480000
014900     DISPLAY '** TRKUT087 - SUSPENDED NOPRO EXTRACT          *'   01490006
015100     DISPLAY '************************************************'   01510000
015110     DISPLAY '*                                              *'   01511004
015111     MOVE PV-INPUT-COUNT    TO  PV-DISP-COUNT.                    01511104
015120     DISPLAY '* INPUT COUNT:  ' PV-DISP-COUNT.                    01512004
015130     DISPLAY '*                                              *'   01513004
015140     MOVE PV-OUTPUT-COUNT   TO  PV-DISP-COUNT                     01514004
015150     DISPLAY '* OUTPUT COUNT: ' PV-DISP-COUNT.                    01515004
015160     DISPLAY '*                                              *'   01516004
015170     DISPLAY '************************************************'   01517004
015200                                                                  01520000
015300     CLOSE OUTPUT-FILE.                                           01530000
015400                                                                  01540000
015500     STOP RUN.                                                    01550000
015600                                                                  01560000
018300                                                                  01830004
018400 2000-PROCESS-NO-PRO-CSR.                                         01840004
018500                                                                  01850000
018510     MOVE SHPTPO-SHIPT-ID        TO  TR068-SHIPT-ID.              01851009
018520     MOVE SHIPMT-TRIP-ID         TO  TR068-TRIP-ID.               01852009
018530     MOVE SHIPMT-PRO-NBR         TO  TR068-PRO-NBR.               01853009
018540     MOVE DISTHD-ORD-NBR         TO  TR068-ORD-NBR.               01854009
018550     MOVE DISTHD-RCVR-SEQ-NBR    TO  TR068-RCVR-SEQ-NBR.          01855009
018560     MOVE DISTHD-OPER-UNT-ID     TO  TR068-OPER-UNT-ID.           01856009
018570     MOVE DISTHD-PRCG-STAT-CDE   TO  TR068-PRCG-STAT-CDE.         01857009
018580     MOVE TRIPST-TRIP-STATUS-CDE TO  TR068-TRIP-STATUS-CDE.       01858009
018590     MOVE TRIPST-STATUS-DTE      TO  TR068-STATUS-DTE.            01859009
018591     MOVE TRIPST-STATUS-TME      TO  TR068-STATUS-TME.            01859109
018592                                                                  01859204
018600     PERFORM 3000-WRITE-EXTRACT.                                  01860004
018700                                                                  01870004
018800     PERFORM 7010-FETCH-CURSOR.                                   01880004
018900                                                                  01890004
021000                                                                  02100000
021100 3000-WRITE-EXTRACT.                                              02110012
021200                                                                  02120004
023800     ADD +1                    TO PV-OUTPUT-COUNT                 02380004
024400                                                                  02440000
024500     WRITE OUTPUT-RECORD                                          02450004
024600      FROM TR068-DATA-RECORD.                                     02460004
024800                                                                  02480000
024810                                                                  02481004
024820 7000-OPEN-CURSOR.                                                02482004
024821     EXEC SQL                                                     02482104
024822         OPEN NOPRO_CURSOR                                        02482204
024823     END-EXEC.                                                    02482304
024824                                                                  02482404
024825     EVALUATE TRUE                                                02482504
024826         WHEN SQLCODE = +0                                        02482604
024827             CONTINUE                                             02482704
024828         WHEN OTHER                                               02482804
024829             MOVE '7000-OPEN-CURSOR'                              02482904
024830                                    TO PV-PARAGRAPH               02483004
024831             MOVE 'OPEN CURSOR     '                              02483104
024832                                    TO PV-DB2-FUNCTION            02483204
024833             PERFORM 9900-DB2-ABEND                               02483304
024834     END-EVALUATE.                                                02483404
024835                                                                  02483504
024836                                                                  02483604
024840 7010-FETCH-CURSOR.                                               02484004
024841                                                                  02484104
024842     EXEC SQL                                                     02484204
024843         FETCH NOPRO_CURSOR                                       02484304
024849         INTO  :SHPTPO-SHIPT-ID                                   02484907
024850              ,:SHIPMT-TRIP-ID                                    02485007
024851              ,:SHIPMT-PRO-NBR                                    02485107
024852              ,:DISTHD-ORD-NBR                                    02485207
024853              ,:DISTHD-RCVR-SEQ-NBR                               02485307
024854              ,:DISTHD-OPER-UNT-ID                                02485407
024855              ,:DISTHD-PRCG-STAT-CDE                              02485507
024856              ,:TRIPST-TRIP-STATUS-CDE                            02485607
024857              ,:TRIPST-STATUS-DTE                                 02485707
024858              ,:TRIPST-STATUS-TME                                 02485807
024863     END-EXEC.                                                    02486304
024864                                                                  02486404
024865     EVALUATE TRUE                                                02486504
024866         WHEN SQLCODE = +0                                        02486604
024867             ADD +1 TO PV-INPUT-COUNT                             02486704
024868         WHEN SQLCODE = +100                                      02486804
024869             SET PS-END-OF-NOPRO TO TRUE                          02486908
024870         WHEN OTHER                                               02487004
024871             MOVE '7010-FETCH-CURSOR'                             02487104
024872                                    TO PV-PARAGRAPH               02487204
024873             MOVE 'FETCH CURSOR    '                              02487304
024874                                    TO PV-DB2-FUNCTION            02487404
024875             PERFORM 9900-DB2-ABEND                               02487504
024876     END-EVALUATE.                                                02487604
024877                                                                  02487704
024880                                                                  02488004
024900 7030-CLOSE-CURSOR.                                               02490004
025000                                                                  02500004
025100     EXEC SQL                                                     02510004
025200         CLOSE NOPRO_CURSOR                                       02520004
025300     END-EXEC.                                                    02530004
025400                                                                  02540004
025500     EVALUATE TRUE                                                02550004
025600         WHEN SQLCODE = +0                                        02560004
025700             CONTINUE                                             02570004
025800         WHEN OTHER                                               02580004
025900             MOVE '7030-CLOSE-CURSOR '                            02590004
026000                                    TO PV-PARAGRAPH               02600004
026010             MOVE 'CLOSE CURSOR    '                              02601004
026020                                    TO PV-DB2-FUNCTION            02602004
026100             PERFORM 9900-DB2-ABEND                               02610004
026200     END-EVALUATE.                                                02620004
026300                                                                  02630004
028300                                                                  02830000
028301******************************************************************02830104
028302 9900-DB2-ABEND.                                                  02830204
028303                                                                  02830304
028304     DISPLAY '** ABEND **'.                                       02830404
028305     DISPLAY '** PROGRAM   ** = TRKUT087'                         02830504
028306     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   02830604
028307     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                02830704
028308                                                                  02830804
028309* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     02830904
028310     COPY DPPD004.                                                02831004
028311                                                                  02831104
028312     EXEC SQL                                                     02831204
028313         ROLLBACK                                                 02831304
028314     END-EXEC.                                                    02831404
028315                                                                  02831504
028316     SET ABEND-4013           TO TRUE.                            02831612
028317     CALL 'ILBOABN0' USING ABEND-CODE.                            02831704
028318                                                                  02831804
028320                                                                  02832004
