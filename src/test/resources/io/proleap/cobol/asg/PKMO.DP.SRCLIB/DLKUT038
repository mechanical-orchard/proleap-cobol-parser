000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    DLKUT038.                                         00050000
000600 AUTHOR.        GERMAN BANDA.                                     00060000
000700 DATE-WRITTEN.  JUNE 2015.                                        00070000
000800******************************************************************00080000
000900*PROGRAM CREATED FROM DLKUT003 TO EXTRACT EAI EXPORT TABLE DATA   00090000
001000*NEW VERSION OF PROGRAM NEEDED AS DATA IS CONVERSION FROM DLX     00100000
001100*TO LM LABOR REQUIRES NEW EXTRACT. PROGRAM IS EXECUTED IN MULTIPLE00110000
001200*JOBS, HOWEVER RDC'S WILL BE ROLLED OUT OVER A PERIOD OF TIME     00120000
001300******************************************************************00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600                                                                  00160000
001700 FILE-CONTROL.                                                    00170000
001800     SELECT SELECT-TMST-EXTRACT-FILE ASSIGN TO INP01.             00180000
001900     SELECT EXPORT-EXTRACT-FILE      ASSIGN TO OUT01.             00190000
002000     SELECT EXPORT-KEY-FILE          ASSIGN TO OUT02.             00200000
002100     SELECT EXPORT-CLOCK-IN-FILE     ASSIGN TO OUT03.             00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400 FILE SECTION.                                                    00240000
002500                                                                  00250000
002600 FD  SELECT-TMST-EXTRACT-FILE                                     00260000
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     BLOCK CONTAINS 0 RECORDS.                                    00290000
003000                                                                  00300000
003100 01  SELECT-TMST-EXTRACT-RECORD       PIC X(52).                  00310000
003200                                                                  00320000
003300 FD  EXPORT-EXTRACT-FILE                                          00330000
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700                                                                  00370000
003800 01  EXPORT-EXTRACT-RECORD            PIC X(900).                 00380000
003900                                                                  00390000
004000 FD  EXPORT-KEY-FILE                                              00400000
004100     RECORDING MODE IS F                                          00410000
004200     LABEL RECORDS ARE STANDARD                                   00420000
004300     BLOCK CONTAINS 0 RECORDS.                                    00430000
004400                                                                  00440000
004500 01  EXPORT-KEY-RECORD                PIC X(050).                 00450000
004600                                                                  00460000
004700 FD  EXPORT-CLOCK-IN-FILE                                         00470000
004800     RECORDING MODE IS F                                          00480000
004900     LABEL RECORDS ARE STANDARD                                   00490000
005000     BLOCK CONTAINS 0 RECORDS.                                    00500000
005100                                                                  00510000
005200 01  EXPORT-CLOCK-IN-RECORD           PIC X(100).                 00520000
005300                                                                  00530000
005400 WORKING-STORAGE SECTION.                                         00540000
005500                                                                  00550000
005600 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO.    00560000
005700                                                                  00570000
005800 01  PS-PROGRAM-SWITCHES.                                         00580000
005900     05  PS-END-CSR-SW                PIC X(1)   VALUE 'N'.       00590000
006000         88  PS-END-CSR                          VALUE 'Y'.       00600000
006100     05  PS-EXPORT-DETAIL-SW          PIC X(1)   VALUE 'N'.       00610000
006200         88  PS-EXPORT-DETAIL-FOUND              VALUE 'Y'.       00620000
006300         88  PS-EXPORT-DETAIL-NOT-FOUND          VALUE 'N'.       00630000
006400     05  PS-EOF-SEL-TMST-FILE-SW      PIC X(1)   VALUE 'N'.       00640000
006500         88  PS-EOF-SEL-TMST-FILE                VALUE 'Y'.       00650000
006600         88  PS-NOT-EOF-SEL-TMST-FILE            VALUE 'N'.       00660000
006700     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.       00670000
006800         88  PS-END-OF-CURSOR                    VALUE 'Y'.       00680000
006900         88  PS-NOT-END-OF-CURSOR                VALUE 'N'.       00690000
007000                                                                  00700000
007100 01  CC-CONTROL-CARD-PARAMETERS.                                  00710000
007200      05 CC-DC-NBR                      PIC 9(04).                00720000
007300      05 FILLER                         PIC X(76) VALUE SPACE.    00730000
007400                                                                  00740000
007500 01  PV-PROGRAM-VARIABLES.                                        00750000
007600     05  PV-RETRY-COUNT               PIC S9(04)  VALUE ZERO      00760000
007700                                                  COMP SYNC.      00770000
007800     05  PV-TEAM-ASSIGN-COUNT         PIC S9(04)  VALUE ZERO      00780000
007900                                                  COMP SYNC.      00790000
008000     05  PV-TIMESTAMP                 PIC X(26)   VALUE SPACES.   00800000
008100     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00810000
008200     05  PV-ERROR-MESSAGE-1           PIC X(60)   VALUE SPACES.   00820000
008300     05  PV-ERROR-MESSAGE-2           PIC X(60)   VALUE SPACES.   00830000
008400     05  PV-SQLCODE                   PIC 9(9)    VALUE ZERO.     00840000
008500     05  PV-APP-ID                    PIC X(02)   VALUE SPACES.   00850000
008600         88  PV-PC-APP-ID                         VALUE 'PC'.     00860000
008700         88  PV-SU-APP-ID                         VALUE 'SU'.     00870000
008800     05  PV-AUDIT-DATE                PIC X(10)   VALUE SPACES.   00880000
008900     05  PV-OUTPUT-DC                 PIC 9(04)   VALUE ZERO.     00890000
009000     05  PV-FUNC-QTY                  PIC S9(09) COMP.            00900000
009100     05  PV-DISPLAY-SEQ-NBR           PIC 9(04) VALUE ZEROS.      00910000
009200     05  PV-DISPLAY-NUMBER            PIC 9999999999.             00920000
009300     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00930000
009400     05  PV-DISPLAY-OPER-UNT-ID       PIC 9(04) VALUE ZEROS.      00940000
009500     05  PV-EVENT-FETCH-COUNT         PIC S9(9)   COMP-3          00950000
009600                                                  VALUE ZEROS.    00960000
009700     05  PV-SU-EVENT-FETCH-COUNT      PIC S9(9)   COMP-3          00970000
009800                                                  VALUE ZEROS.    00980000
009900     05  PV-PC-EVENT-FETCH-COUNT      PIC S9(9)   COMP-3          00990000
010000                                                  VALUE ZEROS.    01000000
010100     05  PV-EVENT-DTL-SELECT-COUNT    PIC S9(9)   COMP-3          01010000
010200                                                  VALUE ZEROS.    01020000
010300     05  PV-SU-EVENT-DTL-SELECT-COUNT PIC S9(9)   COMP-3          01030000
010400                                                  VALUE ZEROS.    01040000
010500     05  PV-PC-EVENT-DTL-SELECT-COUNT PIC S9(9)   COMP-3          01050000
010600                                                  VALUE ZEROS.    01060000
010700     05  PV-EXTRACT-WRITE-COUNT       PIC S9(9)   COMP-3          01070000
010800                                                  VALUE ZEROS.    01080000
010900     05  PV-KEY-WRITE-COUNT           PIC S9(9)   COMP-3          01090000
011000                                                  VALUE ZEROS.    01100000
011100     05  PV-NULL-REF-ID-IND           PIC S9(4)   VALUE ZERO      01110000
011200                                                  COMP SYNC.      01120000
011300     05  PV-NULL-EK1NBR-IND           PIC S9(4)   VALUE ZERO      01130000
011400                                                  COMP SYNC.      01140000
011500     05  PV-NULL-EK2NBR-IND           PIC S9(4)   VALUE ZERO      01150000
011600                                                  COMP SYNC.      01160000
011700     05  PV-NULL-EK3NBR-IND           PIC S9(4)   VALUE ZERO      01170000
011800                                                  COMP SYNC.      01180000
011900     05  PV-NULL-EK4NBR-IND           PIC S9(4)   VALUE ZERO      01190000
012000                                                  COMP SYNC.      01200000
012100     05  PV-NULL-EK5NBR-IND           PIC S9(4)   VALUE ZERO      01210000
012200                                                  COMP SYNC.      01220000
012300     05  PV-NULL-EK1TXT-IND           PIC S9(4)   VALUE ZERO      01230000
012400                                                  COMP SYNC.      01240000
012500     05  PV-NULL-EK2TXT-IND           PIC S9(4)   VALUE ZERO      01250000
012600                                                  COMP SYNC.      01260000
012700     05  PV-NULL-EK3TXT-IND           PIC S9(4)   VALUE ZERO      01270000
012800                                                  COMP SYNC.      01280000
012900     05  PV-NULL-EK4TXT-IND           PIC S9(4)   VALUE ZERO      01290000
013000                                                  COMP SYNC.      01300000
013100     05  PV-NULL-EK5TXT-IND           PIC S9(4)   VALUE ZERO      01310000
013200                                                  COMP SYNC.      01320000
013300     05  PV-NULL-EK1TMST-IND          PIC S9(4)   VALUE ZERO      01330000
013400                                                  COMP SYNC.      01340000
013500     05  PV-NULL-EK2TMST-IND          PIC S9(4)   VALUE ZERO      01350000
013600                                                  COMP SYNC.      01360000
013700     05  PV-NULL-EK3TMST-IND          PIC S9(4)   VALUE ZERO      01370000
013800                                                  COMP SYNC.      01380000
013900     05  PV-NULL-EK4TMST-IND          PIC S9(4)   VALUE ZERO      01390000
014000                                                  COMP SYNC.      01400000
014100     05  PV-NULL-EK5TMST-IND          PIC S9(4)   VALUE ZERO      01410000
014200                                                  COMP SYNC.      01420000
014210     05  PV-WORK-TMST                 PIC X(26).                  01421010
014220                                                                  01422010
014300     05  PV-INPUT-TMST.                                           01430000
014400         10 PV-INPUT-TMST-DATE.                                   01440000
014500             15 PV-INPUT-TMST-YR      PIC 9(04).                  01450000
014600             15 FILLER                PIC X.                      01460000
014700             15 PV-INPUT-TMST-MO      PIC 9(02).                  01470000
014800             15 FILLER                PIC X.                      01480000
014900             15 PV-INPUT-TMST-DA      PIC 9(02).                  01490000
015000         10 FILLER                    PIC X.                      01500000
015100         10 PV-INPUT-TMST-TIME.                                   01510000
015200             15 PV-INPUT-TMST-HR      PIC 9(02).                  01520000
015300             15 FILLER                PIC X.                      01530000
015400             15 PV-INPUT-TMST-MN      PIC 9(02).                  01540000
015500             15 FILLER                PIC X.                      01550000
015600             15 PV-INPUT-TMST-SS      PIC 9(02).                  01560000
015700         10 FILLER                PIC X.                          01570000
015800         10 FILLER                PIC X(06).                      01580000
015900                                                                  01590000
016010     05  PV-KEY-ASSGNMT-DATA.                                     01601005
016100         10  PV-KEY-ASSGNMT-DTL.                                  01610000
016200             15  PV-KEY-ASGMT-STRT-DTE.                           01620000
016300                 20  PV-KEY-ASGMT-STRT-YYYY       PIC  9(04).     01630000
016400                 20  PV-KEY-ASGMT-STRT-SLASH1     PIC  X(01).     01640000
016500                 20  PV-KEY-ASGMT-STRT-MM         PIC  9(02).     01650000
016600                 20  PV-KEY-ASGMT-STRT-SLASH2     PIC  X(01).     01660000
016700                 20  PV-KEY-ASGMT-STRT-DD         PIC  9(02).     01670000
016800             15  PV-KEY-ASGMT-NBR-TXT             PIC  X(10).     01680000
016900             15  PV-KEY-ASGMT-NBR-SEQ-NBR         PIC  9(09).     01690000
017000             15  PV-KEY-ASGMT-SEQ-DTL-NBR         PIC  9(09).     01700000
017100         10  PV-KEY-FILLER1                       PIC  X(962).    01710000
017200                                                                  01720000
017300     05  PV-SAVE-DC                   PIC 9(04) VALUE ZEROS.      01730000
017400     05  PV-RETRY-COUNTER             PIC S9(04) VALUE 0 COMP.    01740000
017500 01  PC-PROGRAM-CONSTANTS.                                        01750000
017600     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'DLKUT038'.01760000
017700     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         01770000
017800                                                 COMP SYNC.       01780000
017900     05  PC-N                         PIC X(01) VALUE 'N'.        01790000
018000 01  PV-ABEND-FIELDS.                                             01800000
018100     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'DLKUT038'.01810000
018200     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01820000
018300     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01830000
018400     05  PV-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    01840000
018500     05  PV-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    01850000
018600     05  PV-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    01860000
018700     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01870000
018800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01880000
018900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01890000
019000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01900000
019100     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01910000
019200                                                                  01920000
019300 01  DK-DB-KEYS.                                                  01930000
019400     05 DK-ASGMT-STRT-DTE             PIC X(10).                  01940000
019500     05 DK-ASGMT-NBR-TXT              PIC X(10).                  01950000
019600     05 DK-ASGMT-NBR-SEQ-NBR          PIC S9(09) COMP.            01960000
019700     05 DK-OPER-UNT-ID                PIC S9(04) COMP.            01970000
019800 01  DN-NULL-INDICATORS.                                          01980000
019900     05  DN-KOHLS-USR-ID-NULL-IND     PIC S9(04) VALUE ZERO       01990000
020000                                                     COMP SYNC.   02000000
020100     05  DN-TMP-USR-ID-NULL-IND       PIC S9(04) VALUE ZERO       02010000
020200                                                     COMP SYNC.   02020000
020300                                                                  02030000
020400/                                                                 02040000
020500*    EXPORT EXTRACT FILE LAYOUT                                   02050000
020600     COPY DLRD003.                                                02060000
020700                                                                  02070000
020800*    EXPORT KEY FILE LAYOUT                                       02080000
020900     COPY DLRD004.                                                02090000
021000                                                                  02100000
021100*    SELECT TIMESTAMP EXTRACT FILE LAYOUT                         02110000
021200     COPY DLRD012.                                                02120000
021300*    SELECT TIMESTAMP EXTRACT FILE LAYOUT                         02130000
021400     COPY DLRD017.                                                02140000
021500/                                                                 02150000
021600*    DCLGEN FOR SU APPLICATION ID BUSINESS EVENT CONTROL TABLE    02160000
021700     EXEC SQL                                                     02170000
021800         INCLUDE SUT00035                                         02180000
021900     END-EXEC                                                     02190000
022000                                                                  02200000
022100*    DCLGEN FOR SU APPLICATION ID BUSINESS EVENT EXPORT TABLE     02210000
022200     EXEC SQL                                                     02220000
022300         INCLUDE SUT00037                                         02230000
022400     END-EXEC                                                     02240000
022500                                                                  02250000
022600*    DCLGEN FOR SU APPLICATION ID BUSINESS EVENT EXPORT           02260000
022700*    DETAIL TABLE                                                 02270000
022800     EXEC SQL                                                     02280000
022900         INCLUDE SUT00038                                         02290000
023000     END-EXEC                                                     02300000
023100                                                                  02310000
023200*    DCLGEN FOR PC APPLICATION ID BUSINESS EVENT CONTROL TABLE    02320000
023300     EXEC SQL                                                     02330000
023400         INCLUDE PCT00009                                         02340000
023500     END-EXEC                                                     02350000
023600                                                                  02360000
023700*    DCLGEN FOR PC APPLICATION ID BUSINESS EVENT EXPORT TABLE     02370000
023800     EXEC SQL                                                     02380000
023900         INCLUDE PCT00011                                         02390000
024000     END-EXEC                                                     02400000
024100                                                                  02410000
024200*    DCLGEN FOR PC APPLICATION ID BUSINESS EVENT EXPORT           02420000
024300*    DETAIL TABLE                                                 02430000
024400     EXEC SQL                                                     02440000
024500         INCLUDE PCT00012                                         02450000
024600     END-EXEC                                                     02460000
024700                                                                  02470000
024800*    DCLGEN FOR DATE ATTRIBUTE TABLE                              02480000
024900     EXEC SQL                                                     02490000
025000         INCLUDE TDTATTR                                          02500000
025100     END-EXEC                                                     02510000
025200*    DCLGEN FOR DLT_TEM_ASGMT ATTRIBUTE TABLE                     02520000
025300     EXEC SQL                                                     02530000
025400         INCLUDE DLT00003                                         02540000
025500     END-EXEC                                                     02550000
025600******************************************************************02560000
025700*    TKRPRPM TABLE                                                02570000
025800******************************************************************02580000
025900     EXEC SQL                                                     02590000
026000          INCLUDE TKRPRPM                                         02600000
026100     END-EXEC.                                                    02610000
026200*                                                                 02620000
026300/                                                                 02630000
026400     EXEC SQL                                                     02640000
026500         DECLARE EXPORT-CSR CURSOR FOR                            02650000
026600             SELECT                                               02660000
026700                   'SU' AS APP_ID                                 02670000
026800              , A.EVNT_EXPRT_ID                                   02680000
026900              , A.EVNT_OBJ_TXT                                    02690000
027000              , A.EVNT_OBJ_ACTN_TXT                               02700000
027100              , A.CRE_TMST                                        02710000
027200              , A.CRE_BY_USR_ID                                   02720000
027300              , A.CRE_BY_PGM_NM                                   02730000
027400              , A.REF_ID                                          02740000
027500              , A.EVNT_KY_1_NBR                                   02750000
027600              , A.EVNT_KY_2_NBR                                   02760000
027700              , A.EVNT_KY_3_NBR                                   02770000
027800              , A.EVNT_KY_4_NBR                                   02780000
027900              , A.EVNT_KY_5_NBR                                   02790000
028000              , A.EVNT_KY_1_TXT                                   02800000
028100              , A.EVNT_KY_2_TXT                                   02810000
028200              , A.EVNT_KY_3_TXT                                   02820000
028300              , A.EVNT_KY_4_TXT                                   02830000
028400              , A.EVNT_KY_5_TXT                                   02840000
028500              , A.EVNT_KY_1_TMST                                  02850000
028600              , A.EVNT_KY_2_TMST                                  02860000
028700              , A.EVNT_KY_3_TMST                                  02870000
028800              , A.EVNT_KY_4_TMST                                  02880000
028900              , A.EVNT_KY_5_TMST                                  02890000
029000              , A.EXPRT_STAT_CDE                                  02900000
029100              , A.LAST_UPD_TMST                                   02910000
029200              , A.EVNT_PRTY_NBR                                   02920000
029300             FROM                                                 02930000
029400                   SUT_BUS_EVNT_EXPRT A                           02940000
029500              ,    SUT_BUS_EVNT_CNTL  B                           02950000
029600             WHERE A.EVNT_OBJ_TXT      = B.EVNT_OBJ_TXT           02960000
029700               AND A.EVNT_OBJ_ACTN_TXT = B.EVNT_OBJ_ACTN_TXT      02970000
029800               AND A.EXPRT_STAT_CDE    = 'C'                      02980000
029900               AND A.CRE_TMST         <= :PV-TIMESTAMP            02990000
030000               AND B.PGM_CDE_NM      = 'DLKUT003'                 03000000
030100             UNION                                                03010000
030200             SELECT                                               03020000
030300                   'PC' AS APP_ID                                 03030000
030400              , B.EVNT_EXPRT_ID                                   03040000
030500              , B.EVNT_OBJ_TXT                                    03050000
030600              , B.EVNT_OBJ_ACTN_TXT                               03060000
030700              , B.CRE_TMST                                        03070000
030800              , B.CRE_BY_USR_ID                                   03080000
030900              , B.CRE_BY_PGM_NM                                   03090000
031000              , B.REF_ID                                          03100000
031100              , B.EVNT_KY_1_NBR                                   03110000
031200              , B.EVNT_KY_2_NBR                                   03120000
031300              , B.EVNT_KY_3_NBR                                   03130000
031400              , B.EVNT_KY_4_NBR                                   03140000
031500              , B.EVNT_KY_5_NBR                                   03150000
031600              , B.EVNT_KY_1_TXT                                   03160000
031700              , B.EVNT_KY_2_TXT                                   03170000
031800              , B.EVNT_KY_3_TXT                                   03180000
031900              , B.EVNT_KY_4_TXT                                   03190000
032000              , B.EVNT_KY_5_TXT                                   03200000
032100              , B.EVNT_KY_1_TMST                                  03210000
032200              , B.EVNT_KY_2_TMST                                  03220000
032300              , B.EVNT_KY_3_TMST                                  03230000
032400              , B.EVNT_KY_4_TMST                                  03240000
032500              , B.EVNT_KY_5_TMST                                  03250000
032600              , B.EXPRT_STAT_CDE                                  03260000
032700              , B.LAST_UPD_TMST                                   03270000
032800              , B.EVNT_PRTY_NBR                                   03280000
032900             FROM                                                 03290000
033000                   PCT_BUS_EVNT_EXPRT B                           03300000
033100              ,    PCT_BUS_EVNT_CNTL  C                           03310000
033200             WHERE B.EVNT_OBJ_TXT      = C.EVNT_OBJ_TXT           03320000
033300               AND B.EVNT_OBJ_ACTN_TXT = C.EVNT_OBJ_ACTN_TXT      03330000
033400               AND B.EXPRT_STAT_CDE    = 'C'                      03340000
033500               AND B.CRE_TMST         <= :PV-TIMESTAMP            03350000
033600               AND C.PGM_CDE_NM        = 'DLKUT003'               03360000
033700         ORDER BY 5                                               03370000
033800          WITH UR                                                 03380000
033900     END-EXEC                                                     03390000
034000/                                                                 03400000
034100******************************************************************03410000
034200*    CURSOR TO GET ASSOCIATES ON A TEAM ASSIGNMENT                03420000
034300******************************************************************03430000
034400                                                                  03440000
034500     EXEC SQL                                                     03450000
034600        DECLARE ASSOCIATE-CURSOR CURSOR FOR                       03460000
034700         SELECT                                                   03470000
034800                TEM.ASGMT_STRT_DTE                                03480000
034900               ,TEM.ASGMT_NBR_TXT                                 03490000
035000               ,TEM.KOHLS_USR_ID                                  03500000
035100               ,TEM.TMP_USR_ID                                    03510000
035200               ,TEM.JN_TMST + :PV-FUNC-QTY HOURS                  03520000
035300               ,TEM.CRE_BY_USR_ID                                 03530000
035400                                                                  03540000
035500          FROM  DLT_TEM_ASGMT   TEM                               03550000
035600                                                                  03560000
035700         WHERE  TEM.ASGMT_STRT_DTE    = :DK-ASGMT-STRT-DTE        03570000
035800           AND  TEM.ASGMT_NBR_TXT     = :DK-ASGMT-NBR-TXT         03580000
035900           AND  TEM.ASGMT_NBR_SEQ_NBR =                           03590000
036000                              :DK-ASGMT-NBR-SEQ-NBR               03600000
036100           AND  TEM.LVE_RSN_CDE      <> :PC-N                     03610000
036200     END-EXEC.                                                    03620000
036300                                                                  03630000
036400*  USED FOR DB2 ERROR MESSAGE BUILDING                            03640000
036500     COPY DPWS004.                                                03650000
036600                                                                  03660000
036700******************************************************************03670000
036800*  COPYBOOK SUWS050 (SU- BUSINESS EVENT EXPORT DETAIL)            03680000
036900******************************************************************03690000
037000     COPY SUWS050.                                                03700000
037100*                                                                 03710000
037200******************************************************************03720000
037300*  COPYBOOK PSWS242 (PC - BUSINESS EVENT EXPORT DETAIL)           03730000
037400******************************************************************03740000
037500     COPY PCWS242.                                                03750000
037600*                                                                 03760000
037700*   DB2 SQL COMMUNICATION AREA                                    03770000
037800     EXEC SQL                                                     03780000
037900          INCLUDE SQLCA                                           03790000
038000     END-EXEC.                                                    03800000
038100/                                                                 03810000
038200 PROCEDURE DIVISION.                                              03820000
038300                                                                  03830000
038400     PERFORM 1000-INIT.                                           03840000
038500                                                                  03850000
038600     PERFORM 2000-PROCESS UNTIL PS-END-CSR.                       03860000
038700                                                                  03870000
038800     PERFORM 9000-TERMINATE.                                      03880000
038900                                                                  03890000
039000     GOBACK.                                                      03900000
039100                                                                  03910000
039200 1000-INIT.                                                       03920000
039300                                                                  03930000
039400     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                03940000
039500     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              03950000
039600             CC-CONTROL-CARD-PARAMETERS.                          03960000
039700     IF CC-DC-NBR NOT NUMERIC                                     03970000
039800         MOVE 0                     TO CC-DC-NBR                  03980000
039900     END-IF.                                                      03990000
040000                                                                  04000000
040100     OPEN INPUT  SELECT-TMST-EXTRACT-FILE.                        04010000
040200     OPEN OUTPUT EXPORT-EXTRACT-FILE.                             04020000
040300     OPEN OUTPUT EXPORT-KEY-FILE.                                 04030000
040400     OPEN OUTPUT EXPORT-CLOCK-IN-FILE.                            04040000
040500*GB 05/25/15                                                      04050000
040600     MOVE CC-DC-NBR  TO DK-OPER-UNT-ID                            04060000
040700     PERFORM 6000-GET-TKRPRPM-TIME-ZONE.                          04070000
040800                                                                  04080000
040900     SET PS-NOT-EOF-SEL-TMST-FILE   TO TRUE.                      04090000
041000                                                                  04100000
041100     PERFORM 7200-READ-TMST-EXTRACT-FILE.                         04110000
041200                                                                  04120000
041300     IF  PS-NOT-EOF-SEL-TMST-FILE                                 04130000
041400         MOVE DL012-CONTROL-TMST    TO PV-TIMESTAMP               04140000
041500         DISPLAY ' '                                              04150000
041600         DISPLAY 'CONTROL TIMESTAMP FOR THIS RUN IS: '            04160000
041700                 PV-TIMESTAMP                                     04170000
041800     ELSE                                                         04180000
041900         MOVE '1000-INIT'           TO PV-PARAGRAPH-NAME          04190000
042000         MOVE 'CONTROL TIMESTAMP FILE IS EMPTY'                   04200000
042100                                    TO PV-ERROR-MESSAGE-1         04210000
042200         PERFORM 9950-NON-SQL-ABEND                               04220000
042300     END-IF.                                                      04230000
042400                                                                  04240000
042500     PERFORM 7000-OPEN-EXPORT-CSR.                                04250000
042600     PERFORM 7010-FETCH-EXPORT-CSR.                               04260000
042700                                                                  04270000
042800 2000-PROCESS.                                                    04280000
042900                                                                  04290000
043000     PERFORM 3000-BUILD-EXTRACT.                                  04300000
043100                                                                  04310000
043200     IF DL003-EVNT-OBJ-ACTN-TXT = 'INDIRECT LABOR' OR             04320000
043300        DL003-EVNT-OBJ-ACTN-TXT = 'ASSOCIATE ADD'                 04330000
043400         MOVE DL003-EVNT-KY-1-NBR   TO PV-OUTPUT-DC               04340000
043500     ELSE                                                         04350000
043600     IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT CLOSE' OR           04360002
043610        DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'           04361002
043700         MOVE DL003-EVNT-KY-2-NBR   TO PV-OUTPUT-DC               04370000
043800     ELSE                                                         04380000
043900         MOVE DL003-DTL-TXT-AREA(11:4) TO PV-OUTPUT-DC            04390000
044000     END-IF.                                                      04400000
044100                                                                  04410000
044200     IF CC-DC-NBR = PV-OUTPUT-DC                                  04420000
044300         PERFORM 8100-WRITE-EXTRACT-REC                           04430000
044400         PERFORM 8200-WRITE-KEY-REC                               04440000
044410         PERFORM 3100-BUILD-CLOCK-IN                              04441001
044500     END-IF.                                                      04450000
044600                                                                  04460000
044700     INITIALIZE PV-NULL-REF-ID-IND                                04470000
044800                PV-NULL-EK1NBR-IND                                04480000
044900                PV-NULL-EK2NBR-IND                                04490000
045000                PV-NULL-EK3NBR-IND                                04500000
045100                PV-NULL-EK4NBR-IND                                04510000
045200                PV-NULL-EK5NBR-IND                                04520000
045300                PV-NULL-EK1TXT-IND                                04530000
045400                PV-NULL-EK2TXT-IND                                04540000
045500                PV-NULL-EK3TXT-IND                                04550000
045600                PV-NULL-EK4TXT-IND                                04560000
045700                PV-NULL-EK5TXT-IND                                04570000
045800                PV-NULL-EK1TMST-IND                               04580000
045900                PV-NULL-EK2TMST-IND                               04590000
046000                PV-NULL-EK3TMST-IND                               04600000
046100                PV-NULL-EK4TMST-IND                               04610000
046200                PV-NULL-EK5TMST-IND.                              04620000
046300                                                                  04630000
046400     PERFORM 7010-FETCH-EXPORT-CSR.                               04640000
046500/                                                                 04650000
046600 3000-BUILD-EXTRACT.                                              04660000
046700                                                                  04670000
046800     SET PS-EXPORT-DETAIL-NOT-FOUND TO TRUE.                      04680000
046900     IF  PV-SU-APP-ID                                             04690000
047000         ADD +1 TO PV-SU-EVENT-FETCH-COUNT                        04700000
047100         PERFORM 7150-SELECT-SU-EXPORT-DTL                        04710000
047200     ELSE                                                         04720000
047300         IF  PV-PC-APP-ID                                         04730000
047400             ADD +1 TO PV-PC-EVENT-FETCH-COUNT                    04740000
047500             PERFORM 7160-SELECT-PC-EXPORT-DTL                    04750000
047600         ELSE                                                     04760000
047700             MOVE '3000-BUILD-EXTRACT'                            04770000
047800                                       TO PV-ABEND-PARAGRAPH      04780000
047900             MOVE 'INVALID APP ID'     TO PV-ABEND-OPERATION      04790000
048000             MOVE 'NOT PC APP ID     ' TO PV-ABEND-STRUCTURE-1    04800000
048100             MOVE 'NOT SU APP ID     ' TO PV-ABEND-STRUCTURE-2    04810000
048200             PERFORM 9900-DB2-ABEND                               04820000
048300         END-IF                                                   04830000
048400     END-IF.                                                      04840000
048500                                                                  04850000
048600     INITIALIZE DL003-EXPORT-RECORD-LAYOUT.                       04860000
048700     INITIALIZE DL004-EAI-KEY-RECORD-LAYOUT.                      04870000
048800     INITIALIZE DL017-ASSOC-STRT-REC-LAYOUT.                      04880000
048900                                                                  04890000
049000     MOVE PV-APP-ID                   TO DL003-APP-ID-EXPORT-CDE  04900000
049100                                         DL004-APP-ID-EXPORT-CDE. 04910000
049200     MOVE PV-TIMESTAMP                TO DL004-EXTRACT-TIMESTAMP. 04920000
049300                                                                  04930000
049400     MOVE SUT00037-EVNT-EXPRT-ID      TO DL004-EVNT-EXPRT-ID.     04940000
049500     MOVE SUT00037-EVNT-OBJ-TXT       TO DL003-EVNT-OBJ-TXT.      04950000
049600     MOVE SUT00037-EVNT-OBJ-ACTN-TXT  TO DL003-EVNT-OBJ-ACTN-TXT. 04960000
049700     MOVE SUT00037-CRE-BY-USR-ID      TO DL003-CRE-BY-USR-ID.     04970000
049800     MOVE SUT00037-CRE-BY-PGM-NM      TO DL003-CRE-PGM-NM.        04980000
049900**** GB 05/07/15                                                  04990000
050000     MOVE SUT00037-CRE-TMST           TO DL003-EVENT-DB-CRE-TMST. 05000000
050100     IF  PV-NULL-REF-ID-IND = -1                                  05010000
050200         MOVE SPACES                  TO DL003-REF-ID             05020000
050300     ELSE                                                         05030000
050400         MOVE SUT00037-REF-ID         TO DL003-REF-ID             05040000
050500     END-IF.                                                      05050000
050600                                                                  05060000
050700     IF  PV-NULL-EK1NBR-IND = -1                                  05070000
050800         MOVE ZEROS                   TO DL003-EVNT-KY-1-NBR      05080000
050900     ELSE                                                         05090000
051000         MOVE SUT00037-EVNT-KY-1-NBR  TO DL003-EVNT-KY-1-NBR      05100000
051100     END-IF.                                                      05110000
051200                                                                  05120000
051300     IF  PV-NULL-EK2NBR-IND = -1                                  05130000
051400         MOVE ZEROS                   TO DL003-EVNT-KY-2-NBR      05140000
051500     ELSE                                                         05150000
051600         MOVE SUT00037-EVNT-KY-2-NBR  TO DL003-EVNT-KY-2-NBR      05160000
051700     END-IF.                                                      05170000
051800                                                                  05180000
051900     IF  PV-NULL-EK3NBR-IND = -1                                  05190000
052000         MOVE ZEROS                   TO DL003-EVNT-KY-3-NBR      05200000
052100     ELSE                                                         05210000
052200         MOVE SUT00037-EVNT-KY-3-NBR  TO DL003-EVNT-KY-3-NBR      05220000
052300     END-IF.                                                      05230000
052400                                                                  05240000
052500     IF  PV-NULL-EK4NBR-IND = -1                                  05250000
052600         MOVE ZEROS                   TO DL003-EVNT-KY-4-NBR      05260000
052700     ELSE                                                         05270000
052800         MOVE SUT00037-EVNT-KY-4-NBR  TO DL003-EVNT-KY-4-NBR      05280000
052900     END-IF.                                                      05290000
053000                                                                  05300000
053100     IF  PV-NULL-EK5NBR-IND = -1                                  05310000
053200         MOVE ZEROS                   TO DL003-EVNT-KY-5-NBR      05320000
053300     ELSE                                                         05330000
053400         MOVE SUT00037-EVNT-KY-5-NBR  TO DL003-EVNT-KY-5-NBR      05340000
053500     END-IF.                                                      05350000
053600                                                                  05360000
053700     IF  PV-NULL-EK1TXT-IND = -1                                  05370000
053800         MOVE SPACES                  TO DL003-EVNT-KY-1-TXT      05380000
053900     ELSE                                                         05390000
054000         MOVE SUT00037-EVNT-KY-1-TXT  TO DL003-EVNT-KY-1-TXT      05400000
054100     END-IF.                                                      05410000
054200                                                                  05420000
054300     IF  PV-NULL-EK2TXT-IND = -1                                  05430000
054400         MOVE SPACES                  TO DL003-EVNT-KY-2-TXT      05440000
054500     ELSE                                                         05450000
054600         MOVE SUT00037-EVNT-KY-2-TXT  TO DL003-EVNT-KY-2-TXT      05460000
054700     END-IF.                                                      05470000
054800                                                                  05480000
054900     IF  PV-NULL-EK3TXT-IND = -1                                  05490000
055000         MOVE SPACES                  TO DL003-EVNT-KY-3-TXT      05500000
055100     ELSE                                                         05510000
055200         MOVE SUT00037-EVNT-KY-3-TXT  TO DL003-EVNT-KY-3-TXT      05520000
055300     END-IF.                                                      05530000
055400                                                                  05540000
055500     IF  PV-NULL-EK4TXT-IND = -1                                  05550000
055600         MOVE SPACES                  TO DL003-EVNT-KY-4-TXT      05560000
055700     ELSE                                                         05570000
055800         MOVE SUT00037-EVNT-KY-4-TXT  TO DL003-EVNT-KY-4-TXT      05580000
055900     END-IF.                                                      05590000
056000                                                                  05600000
056100     IF  PV-NULL-EK5TXT-IND = -1                                  05610000
056200         MOVE SPACES                  TO DL003-EVNT-KY-5-TXT      05620000
056300     ELSE                                                         05630000
056400         MOVE SUT00037-EVNT-KY-5-TXT  TO DL003-EVNT-KY-5-TXT      05640000
056500     END-IF.                                                      05650000
056600                                                                  05660000
056700     IF  PV-NULL-EK1TMST-IND = -1                                 05670000
056800         MOVE SPACES                  TO DL003-EVNT-KY-1-TMST     05680000
056900     ELSE                                                         05690000
057000         MOVE SUT00037-EVNT-KY-1-TMST TO DL003-EVNT-KY-1-TMST     05700000
057100     END-IF.                                                      05710000
057200                                                                  05720000
057300     IF  PV-NULL-EK2TMST-IND = -1                                 05730000
057400         MOVE SPACES                  TO DL003-EVNT-KY-2-TMST     05740000
057500     ELSE                                                         05750000
057600         MOVE SUT00037-EVNT-KY-2-TMST TO DL003-EVNT-KY-2-TMST     05760000
057700     END-IF.                                                      05770000
057800                                                                  05780000
057900     IF  PV-NULL-EK3TMST-IND = -1                                 05790000
058000         MOVE SPACES                  TO DL003-EVNT-KY-3-TMST     05800000
058100     ELSE                                                         05810000
058200         MOVE SUT00037-EVNT-KY-3-TMST TO DL003-EVNT-KY-3-TMST     05820000
058300     END-IF.                                                      05830000
058400                                                                  05840000
058500     IF  PV-NULL-EK4TMST-IND = -1                                 05850000
058600         MOVE SPACES                  TO DL003-EVNT-KY-4-TMST     05860000
058700     ELSE                                                         05870000
058800         MOVE SUT00037-EVNT-KY-4-TMST TO DL003-EVNT-KY-4-TMST     05880000
058900     END-IF.                                                      05890000
059000                                                                  05900000
059100     IF  PV-NULL-EK5TMST-IND = -1                                 05910000
059200         MOVE SPACES                  TO DL003-EVNT-KY-5-TMST     05920000
059300     ELSE                                                         05930000
059400         MOVE SUT00037-EVNT-KY-5-TMST TO DL003-EVNT-KY-5-TMST     05940000
059500     END-IF.                                                      05950000
059600                                                                  05960000
059700     MOVE SPACES                  TO DL003-DTL-TXT-AREA.          05970000
059800     IF  PS-EXPORT-DETAIL-NOT-FOUND                               05980000
059900         MOVE SPACES                  TO DL003-DTL-TXT-AREA       05990000
060000     ELSE                                                         06000000
060100         IF  PV-SU-APP-ID                                         06010000
060200             MOVE SUT00038-DTL-TXT-TEXT   TO DL003-DTL-TXT-AREA   06020000
060300         ELSE                                                     06030000
060400             IF  PV-PC-APP-ID                                     06040000
060500                 MOVE PCT00012-DTL-TXT-TEXT   TO                  06050000
060600                      DL003-DTL-TXT-AREA                          06060000
060700             ELSE                                                 06070000
060800                CONTINUE                                          06080000
060900             END-IF                                               06090000
061000         END-IF                                                   06100000
061100     END-IF.                                                      06110000
061200                                                                  06120000
061800 3100-BUILD-CLOCK-IN.                                             06180000
061900     INITIALIZE PV-KEY-ASSGNMT-DTL.                               06190000
062000     MOVE DL003-DTL-TXT-AREA      TO PV-KEY-ASSGNMT-DTL.          06200000
062100                                                                  06210000
062200     IF PS-EXPORT-DETAIL-FOUND                                    06220000
062300       MOVE PV-KEY-ASGMT-NBR-SEQ-NBR  TO DK-ASGMT-NBR-SEQ-NBR     06230000
062400       MOVE CC-DC-NBR                 TO PV-SAVE-DC               06240000
062500       MOVE PV-KEY-ASGMT-NBR-TXT      TO DK-ASGMT-NBR-TXT         06250000
062600       MOVE PV-KEY-ASGMT-STRT-DTE     TO DK-ASGMT-STRT-DTE        06260000
062700       IF DK-ASGMT-STRT-DTE > SPACE                               06270000
062800          PERFORM 3200-PROCESS-TEAM-ASSIGN                        06280000
062900       END-IF                                                     06290000
063000     ELSE                                                         06300000
063100       IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT CLOSE'            06310000
063200         MOVE DL003-EVNT-KY-1-NBR       TO DK-ASGMT-NBR-SEQ-NBR   06320000
063300         MOVE DL003-EVNT-KY-2-NBR       TO PV-SAVE-DC             06330000
063400         MOVE DL003-EVNT-KY-1-TXT       TO DK-ASGMT-NBR-TXT       06340000
063500         MOVE DL003-EVNT-KY-1-TMST      TO PV-INPUT-TMST          06350000
063600         MOVE PV-INPUT-TMST-DATE        TO DK-ASGMT-STRT-DTE      06360000
063700         PERFORM 3200-PROCESS-TEAM-ASSIGN                         06370000
063800       ELSE                                                       06380000
063900         IF DL003-EVNT-OBJ-ACTN-TXT = 'INDIRECT LABOR'            06390000
064000          MOVE DL003-EVNT-KY-1-NBR    TO DL017-DC-NUMBER          06400000
064200          MOVE DL003-CRE-BY-USR-ID    TO DL017-CRE-BY-USR-ID      06420005
064210** GB 8/4/15                                                      06421005
064300          PERFORM 6100-SET-ADJUSTED-TIME-ZONE                     06430005
064301          MOVE PV-WORK-TMST           TO DL017-EVENT-DB-CRE-TMST  06430105
064302** GB 8/4/15                                                      06430205
064304          PERFORM 8300-WRITE-CLOCK-IN-REC                         06430405
064310         ELSE                                                     06431003
064320           IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'     06432003
064330            MOVE DL003-EVNT-KY-2-NBR  TO DL017-DC-NUMBER          06433006
064350            MOVE DL003-EVNT-KY-2-TXT  TO DL017-CRE-BY-USR-ID      06435003
064351** GB 8/4/15                                                      06435105
064352            PERFORM 6100-SET-ADJUSTED-TIME-ZONE                   06435205
064353            MOVE PV-WORK-TMST         TO DL017-EVENT-DB-CRE-TMST  06435305
064354** GB 8/4/15                                                      06435405
064360            PERFORM 8300-WRITE-CLOCK-IN-REC                       06436003
064400           END-IF                                                 06440003
064410        END-IF                                                    06441003
064500       END-IF                                                     06450000
064600     END-IF.                                                      06460000
064700                                                                  06470000
064800                                                                  06480000
064900 3200-PROCESS-TEAM-ASSIGN.                                        06490000
065000                                                                  06500000
065100     SET PS-NOT-END-OF-CURSOR TO TRUE.                            06510000
065200     MOVE +0 TO PV-TEAM-ASSIGN-COUNT                              06520000
065300     PERFORM 5000-OPEN-ASSOCIATE-CURSOR.                          06530000
065400     PERFORM UNTIL (PS-END-OF-CURSOR)                             06540000
065500        PERFORM 5100-FETCH-ASSOCIATE                              06550000
065600     END-PERFORM.                                                 06560000
065700                                                                  06570000
065800     PERFORM 5200-CLOSE-ASSOCIATE-CURSOR.                         06580000
065900                                                                  06590000
066000****************************************************************  06600000
066100*                                                              *  06610000
066200*                                                              *  06620000
066300****************************************************************  06630000
066400 5000-OPEN-ASSOCIATE-CURSOR.                                      06640000
066500     MOVE '5000-OPEN-ASSOCIATE-CURSOR'   TO PV-ABEND-PARAGRAPH.   06650000
066600                                                                  06660000
066700     PERFORM                                                      06670000
066800         WITH TEST AFTER                                          06680000
066900             VARYING PV-RETRY-COUNTER                             06690000
067000             FROM 1 BY 1                                          06700000
067100             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              06710000
067200                OR SQLCODE = ZERO                                 06720000
067300                                                                  06730000
067400         EXEC SQL                                                 06740000
067500              OPEN  ASSOCIATE-CURSOR                              06750000
067600         END-EXEC                                                 06760000
067700                                                                  06770000
067800         EVALUATE TRUE                                            06780000
067900             WHEN SQLCODE = ZERO                                  06790000
068000             WHEN SQLCODE = +100                                  06800000
068100             WHEN SQLCODE = -904                                  06810000
068200             WHEN SQLCODE = -913                                  06820000
068300             WHEN SQLCODE = -911                                  06830000
068400                  CONTINUE                                        06840000
068500                                                                  06850000
068600             WHEN SQLWARN0 NOT = SPACES                           06860000
068700             WHEN SQLCODE NOT = ZERO                              06870000
068800                  MOVE +4             TO PV-RETRY-COUNTER         06880000
068900         END-EVALUATE                                             06890000
069000     END-PERFORM.                                                 06900000
069100                                                                  06910000
069200     IF SQLCODE = ZERO                                            06920000
069300        CONTINUE                                                  06930000
069400     ELSE                                                         06940000
069500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06950000
069600         MOVE SQLCODE               TO PV-SQLCODE                 06960000
069700         MOVE 'CURSOR OPEN ERROR'   TO PV-DB2-OPERATION-MESSAGE-1 06970000
069800         MOVE 'DLT_TEM_ASGMT'      TO PV-ABEND-STRUCTURE-1        06980000
069900         PERFORM 9900-DB2-ABEND                                   06990000
070000     END-IF.                                                      07000000
070100                                                                  07010000
070200****************************************************************  07020000
070300*                                                              *  07030000
070400*                                                              *  07040000
070500****************************************************************  07050000
070600 5100-FETCH-ASSOCIATE.                                            07060000
070700     MOVE '5100-FETCH-ASSOCIATE'          TO PV-ABEND-PARAGRAPH.  07070000
070800                                                                  07080000
070900     PERFORM                                                      07090000
071000         WITH TEST AFTER                                          07100000
071100         VARYING PV-RETRY-COUNTER                                 07110000
071200         FROM 1 BY 1                                              07120000
071300         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  07130000
071400            OR SQLCODE = ZERO                                     07140000
071500            OR SQLCODE = +100                                     07150000
071600                                                                  07160000
071700         EXEC SQL                                                 07170000
071800             FETCH  ASSOCIATE-CURSOR                              07180000
071900                                                                  07190000
072000              INTO  :DLT00003-ASGMT-STRT-DTE                      07200000
072100                   ,:DLT00003-ASGMT-NBR-TXT                       07210000
072200                   ,:DLT00003-KOHLS-USR-ID                        07220000
072300                              :DN-KOHLS-USR-ID-NULL-IND           07230000
072400                   ,:DLT00003-TMP-USR-ID                          07240000
072500                              :DN-TMP-USR-ID-NULL-IND             07250000
072600                   ,:DLT00003-JN-TMST                             07260000
072700                   ,:DLT00003-CRE-BY-USR-ID                       07270000
072800                                                                  07280000
072900         END-EXEC                                                 07290000
073000                                                                  07300000
073100         EVALUATE TRUE                                            07310000
073200             WHEN SQLCODE = ZERO                                  07320000
073300             WHEN SQLCODE = -904                                  07330000
073400             WHEN SQLCODE = -911                                  07340000
073500             WHEN SQLCODE = -913                                  07350000
073600                  CONTINUE                                        07360000
073700             WHEN SQLCODE = +100                                  07370000
073800                  SET PS-END-OF-CURSOR TO TRUE                    07380000
073900                                                                  07390000
074000             WHEN SQLWARN0 NOT = SPACES                           07400000
074100             WHEN SQLCODE NOT = ZERO                              07410000
074200                  MOVE +4             TO PV-RETRY-COUNTER         07420000
074300         END-EVALUATE                                             07430000
074400     END-PERFORM.                                                 07440000
074500                                                                  07450000
074600     IF SQLCODE = ZERO                                            07460000
074700         ADD +1 TO PV-TEAM-ASSIGN-COUNT                           07470000
074800         INITIALIZE DL017-ASSOC-STRT-REC-LAYOUT                   07480000
074900         MOVE PV-SAVE-DC            TO DL017-DC-NUMBER            07490000
075000         MOVE DLT00003-JN-TMST      TO DL017-EVENT-DB-CRE-TMST    07500000
075100         IF DN-KOHLS-USR-ID-NULL-IND < +0                         07510000
075200             MOVE DLT00003-TMP-USR-ID                             07520000
075300                                    TO DL017-CRE-BY-USR-ID        07530000
075400         ELSE                                                     07540000
075500             MOVE DLT00003-KOHLS-USR-ID                           07550000
075600                                    TO DL017-CRE-BY-USR-ID        07560000
075700         END-IF                                                   07570000
075800         PERFORM 8300-WRITE-CLOCK-IN-REC                          07580000
075900     ELSE                                                         07590000
076000     IF SQLCODE = +100                                            07600000
076100        CONTINUE                                                  07610000
076200     ELSE                                                         07620000
076300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07630000
076400         MOVE SQLCODE               TO PV-SQLCODE                 07640000
076500         MOVE 'FETCH TEAM ASGMT'    TO PV-DB2-OPERATION-MESSAGE-1 07650000
076600         MOVE DK-ASGMT-NBR-SEQ-NBR  TO PV-DISPLAY-SEQ-NBR         07660000
076700         STRING 'ASSIGNMENT INFO * '    DELIMITED BY SIZE         07670000
076800                'START DATE = '         DELIMITED BY SIZE         07680000
076900                 DK-ASGMT-STRT-DTE      DELIMITED BY SIZE         07690000
077000                ' ASSIGNMENT NUM = '    DELIMITED BY SIZE         07700000
077100                 DK-ASGMT-NBR-TXT       DELIMITED BY SIZE         07710000
077200                ' SEQ NUM = '           DELIMITED BY SIZE         07720000
077300                 PV-DISPLAY-NUMBER      DELIMITED BY SIZE         07730000
077400                                   INTO PV-DB2-OPERATION-MESSAGE-207740000
077500         MOVE 'DLT_TEM_ASGMT'       TO PV-ABEND-STRUCTURE-1       07750000
077600         PERFORM 9900-DB2-ABEND                                   07760000
077700     END-IF.                                                      07770000
077800                                                                  07780000
077900****************************************************************  07790000
078000*                                                              *  07800000
078100*                                                              *  07810000
078200****************************************************************  07820000
078300 5200-CLOSE-ASSOCIATE-CURSOR.                                     07830000
078400     MOVE '5200-CLOSE-ASSOCIATE-CURSOR'   TO PV-ABEND-PARAGRAPH.  07840000
078500                                                                  07850000
078600     PERFORM                                                      07860000
078700         WITH TEST AFTER                                          07870000
078800         VARYING PV-RETRY-COUNTER                                 07880000
078900         FROM 1 BY 1                                              07890000
079000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  07900000
079100            OR SQLCODE = ZERO                                     07910000
079200                                                                  07920000
079300         EXEC SQL                                                 07930000
079400              CLOSE ASSOCIATE-CURSOR                              07940000
079500         END-EXEC                                                 07950000
079600                                                                  07960000
079700         EVALUATE TRUE                                            07970000
079800             WHEN SQLCODE = ZERO                                  07980000
079900             WHEN SQLCODE = -904                                  07990000
080000             WHEN SQLCODE = -913                                  08000000
080100             WHEN SQLCODE = -911                                  08010000
080200                  CONTINUE                                        08020000
080300                                                                  08030000
080400             WHEN SQLCODE = +100                                  08040000
080500             WHEN SQLWARN0 NOT = SPACES                           08050000
080600             WHEN SQLCODE NOT = ZERO                              08060000
080700                  MOVE +4             TO PV-RETRY-COUNTER         08070000
080800         END-EVALUATE                                             08080000
080900     END-PERFORM.                                                 08090000
081000                                                                  08100000
081100     IF SQLCODE = ZERO                                            08110000
081200        CONTINUE                                                  08120000
081300     ELSE                                                         08130000
081400        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      08140000
081500         MOVE SQLCODE               TO PV-SQLCODE                 08150000
081600         MOVE 'CURSOR CLOSE ERROR'  TO PV-DB2-OPERATION-MESSAGE-1 08160000
081700         MOVE 'DLT_TEM_ASGMT'      TO PV-ABEND-STRUCTURE-1        08170000
081800         PERFORM 9900-DB2-ABEND                                   08180000
081900        END-IF                                                    08190000
082000     END-IF.                                                      08200000
082100*----------------------------------------------------------------*08210000
082200*    RETRIEVE THE TIMEZN SYS-PRC-FUNC-CDE TO DETERMINE THE NUMBER 08220000
082300*    OF HOURS TO ADD OR SUBTRACT FROM THE CURRENT TIME INORDER    08230000
082400*    TO BE IN THE CORRECT TIMEZONE.                               08240000
082500*----------------------------------------------------------------*08250000
082600*                                                                 08260000
082700 6000-GET-TKRPRPM-TIME-ZONE.                                      08270000
082800                                                                  08280000
082900       EXEC SQL                                                   08290000
083000           SELECT FUNC_QTY                                        08300000
083100             INTO   :PV-FUNC-QTY                                  08310000
083200             FROM   TKRPRPM                                       08320000
083300            WHERE LOC_ID           = :DK-OPER-UNT-ID              08330000
083400              AND INTFC_SYS_CDE    = 'KHL'                        08340000
083500              AND SYS_PRC_FUNC_CDE = 'TIMEZN'                     08350000
083600              AND FUNC_PRC_STAT_CDE = 'AC'                        08360000
083700       END-EXEC                                                   08370000
083800                                                                  08380000
083900       EVALUATE TRUE                                              08390000
084000           WHEN SQLCODE = +0                                      08400000
084100           WHEN SQLCODE = -904                                    08410000
084200           WHEN SQLCODE = -913                                    08420000
084300           WHEN SQLCODE = -911                                    08430000
084400               CONTINUE                                           08440000
084500           WHEN OTHER                                             08450000
084600               MOVE 0 TO PV-FUNC-QTY                              08460000
084700               DISPLAY '6000-GET-TKRPRPM ERROR'                   08470000
084800               MOVE DK-OPER-UNT-ID TO  PV-DISPLAY-OPER-UNT-ID     08480000
084900               DISPLAY ' OPER UNIT   - '                          08490000
085000                       PV-DISPLAY-OPER-UNT-ID                     08500000
085100       END-EVALUATE.                                              08510000
085200                                                                  08520000
085300                                                                  08530000
085310 6100-SET-ADJUSTED-TIME-ZONE.                                     08531005
085311     IF DL003-EVNT-OBJ-ACTN-TXT = 'ASSIGNMENT USER ADD'           08531107
085320      EXEC SQL                                                    08532011
085330         SET :PV-WORK-TMST                                        08533011
085340        = (TIMESTAMP(:DL003-EVNT-KY-2-TMST) + :PV-FUNC-QTY HOURS) 08534011
085350      END-EXEC                                                    08535011
085351     ELSE                                                         08535107
085360      EXEC SQL                                                    08536011
085370         SET :PV-WORK-TMST                                        08537011
085380        = (TIMESTAMP(:DL003-EVNT-KY-1-TMST) + :PV-FUNC-QTY HOURS) 08538011
085390      END-EXEC                                                    08539011
085391     END-IF.                                                      08539107
085400/                                                                 08540000
085500 7000-OPEN-EXPORT-CSR.                                            08550000
085600     PERFORM                                                      08560000
085700         WITH TEST AFTER                                          08570000
085800         VARYING PV-RETRY-COUNT                                   08580000
085900         FROM 1 BY 1                                              08590000
086000         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 08600000
086100            OR  (SQLCODE = +100)                                  08610000
086200            OR  (SQLCODE = +0))                                   08620000
086300     EXEC SQL                                                     08630000
086400         OPEN EXPORT-CSR                                          08640000
086500     END-EXEC                                                     08650000
086600                                                                  08660000
086700     EVALUATE TRUE                                                08670000
086800         WHEN SQLCODE = ZERO                                      08680000
086900         WHEN SQLCODE = -904                                      08690000
087000         WHEN SQLCODE = -913                                      08700000
087100         WHEN SQLCODE = -911                                      08710000
087200             CONTINUE                                             08720000
087300         WHEN SQLWARN0 NOT = SPACE                                08730000
087400         WHEN SQLCODE  NOT = ZERO                                 08740000
087500             MOVE '7000-OPEN-EXPORT-CSR'                          08750000
087600                                       TO PV-ABEND-PARAGRAPH      08760000
087700             MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION      08770000
087800             MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1    08780000
087900             MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2    08790000
088000             PERFORM 9900-DB2-ABEND                               08800000
088100     END-EVALUATE                                                 08810000
088200     END-PERFORM.                                                 08820000
088300     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      08830000
088400          SQLCODE NOT = ZERO                                      08840000
088500          DISPLAY '**************************************'        08850000
088600          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        08860000
088700          DISPLAY 'OPEN EXTRACT CURSOR    '                       08870000
088800          DISPLAY '**************************************'        08880000
088900          MOVE '7000-OPEN-EXPORT-CSR'                             08890000
089000                                    TO PV-ABEND-PARAGRAPH         08900000
089100          MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION         08910000
089200          MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       08920000
089300          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2       08930000
089400          MOVE 'OPEN CURSOR ERROR'  TO PV-DB2-OPERATION-MESSAGE-1 08940000
089500          PERFORM 9900-DB2-ABEND                                  08950000
089600      END-IF.                                                     08960000
089700                                                                  08970000
089800 7010-FETCH-EXPORT-CSR.                                           08980000
089900      PERFORM                                                     08990000
090000          WITH TEST AFTER                                         09000000
090100          VARYING PV-RETRY-COUNT                                  09010000
090200          FROM 1 BY 1                                             09020000
090300          UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                09030000
090400             OR  (SQLCODE = +100)                                 09040000
090500             OR  (SQLCODE = +0))                                  09050000
090600       EXEC SQL                                                   09060000
090700           FETCH EXPORT-CSR                                       09070000
090800           INTO                                                   09080000
090900               :PV-APP-ID                                         09090000
091000           ,   :SUT00037-EVNT-EXPRT-ID                            09100000
091100           ,   :SUT00037-EVNT-OBJ-TXT                             09110000
091200           ,   :SUT00037-EVNT-OBJ-ACTN-TXT                        09120000
091300           ,   :SUT00037-CRE-TMST                                 09130000
091400           ,   :SUT00037-CRE-BY-USR-ID                            09140000
091500           ,   :SUT00037-CRE-BY-PGM-NM                            09150000
091600           ,   :SUT00037-REF-ID         :PV-NULL-REF-ID-IND       09160000
091700           ,   :SUT00037-EVNT-KY-1-NBR  :PV-NULL-EK1NBR-IND       09170000
091800           ,   :SUT00037-EVNT-KY-2-NBR  :PV-NULL-EK2NBR-IND       09180000
091900           ,   :SUT00037-EVNT-KY-3-NBR  :PV-NULL-EK3NBR-IND       09190000
092000           ,   :SUT00037-EVNT-KY-4-NBR  :PV-NULL-EK4NBR-IND       09200000
092100           ,   :SUT00037-EVNT-KY-5-NBR  :PV-NULL-EK5NBR-IND       09210000
092200           ,   :SUT00037-EVNT-KY-1-TXT  :PV-NULL-EK1TXT-IND       09220000
092300           ,   :SUT00037-EVNT-KY-2-TXT  :PV-NULL-EK2TXT-IND       09230000
092400           ,   :SUT00037-EVNT-KY-3-TXT  :PV-NULL-EK3TXT-IND       09240000
092500           ,   :SUT00037-EVNT-KY-4-TXT  :PV-NULL-EK4TXT-IND       09250000
092600           ,   :SUT00037-EVNT-KY-5-TXT  :PV-NULL-EK5TXT-IND       09260000
092700           ,   :SUT00037-EVNT-KY-1-TMST :PV-NULL-EK1TMST-IND      09270000
092800           ,   :SUT00037-EVNT-KY-2-TMST :PV-NULL-EK2TMST-IND      09280000
092900           ,   :SUT00037-EVNT-KY-3-TMST :PV-NULL-EK3TMST-IND      09290000
093000           ,   :SUT00037-EVNT-KY-4-TMST :PV-NULL-EK4TMST-IND      09300000
093100           ,   :SUT00037-EVNT-KY-5-TMST :PV-NULL-EK5TMST-IND      09310000
093200           ,   :SUT00037-EXPRT-STAT-CDE                           09320000
093300           ,   :SUT00037-LAST-UPD-TMST                            09330000
093400           ,   :SUT00037-EVNT-PRTY-NBR                            09340000
093500       END-EXEC                                                   09350000
093600                                                                  09360000
093700       EVALUATE TRUE                                              09370000
093800           WHEN SQLCODE = ZERO                                    09380000
093900               ADD 1                    TO PV-EVENT-FETCH-COUNT   09390000
094000           WHEN SQLCODE = +100                                    09400000
094100               SET PS-END-CSR           TO TRUE                   09410000
094200           WHEN SQLCODE = -904                                    09420000
094300           WHEN SQLCODE = -913                                    09430000
094400           WHEN SQLCODE = -911                                    09440000
094500                CONTINUE                                          09450000
094600           WHEN SQLWARN0 NOT = SPACE                              09460000
094700           WHEN SQLCODE  NOT = ZERO                               09470000
094800               MOVE '7010-FETCH-EXPORT-CSR'                       09480000
094900                                         TO PV-ABEND-PARAGRAPH    09490000
095000               MOVE 'FETCH CURSOR'       TO PV-ABEND-OPERATION    09500000
095100               MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1  09510000
095200               MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2  09520000
095300               PERFORM 9900-DB2-ABEND                             09530000
095400       END-EVALUATE                                               09540000
095500       END-PERFORM.                                               09550000
095600     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      09560000
095700          SQLCODE NOT = ZERO                                      09570000
095800          DISPLAY '**************************************'        09580000
095900          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        09590000
096000          DISPLAY 'OPEN EXTRACT CURSOR    '                       09600000
096100          DISPLAY '**************************************'        09610000
096200          MOVE '7000-OPEN-EXPORT-CSR'                             09620000
096300                                    TO PV-ABEND-PARAGRAPH         09630000
096400          MOVE 'OPEN CURSOR'        TO PV-ABEND-OPERATION         09640000
096500          MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       09650000
096600          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2       09660000
096700          MOVE 'FETCH CURSOR ERROR' TO PV-DB2-OPERATION-MESSAGE-1 09670000
096800          PERFORM 9900-DB2-ABEND                                  09680000
096900      END-IF.                                                     09690000
097000                                                                  09700000
097100 7020-CLOSE-EXPORT-CSR.                                           09710000
097200     PERFORM                                                      09720000
097300         WITH TEST AFTER                                          09730000
097400         VARYING PV-RETRY-COUNT                                   09740000
097500         FROM 1 BY 1                                              09750000
097600         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 09760000
097700            OR  (SQLCODE = +100)                                  09770000
097800            OR  (SQLCODE = +0))                                   09780000
097900     EXEC SQL                                                     09790000
098000         CLOSE EXPORT-CSR                                         09800000
098100     END-EXEC                                                     09810000
098200                                                                  09820000
098300     EVALUATE TRUE                                                09830000
098400         WHEN SQLCODE = ZERO                                      09840000
098500         WHEN SQLCODE = -904                                      09850000
098600         WHEN SQLCODE = -913                                      09860000
098700         WHEN SQLCODE = -911                                      09870000
098800             CONTINUE                                             09880000
098900         WHEN SQLWARN0 NOT = SPACE                                09890000
099000         WHEN SQLCODE  NOT = ZERO                                 09900000
099100             MOVE '7020-CLOSE-EXPORT-CSR'                         09910000
099200                                       TO PV-ABEND-PARAGRAPH      09920000
099300             MOVE 'CLOSE CURSOR'       TO PV-ABEND-OPERATION      09930000
099400             MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1    09940000
099500             MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2    09950000
099600             PERFORM 9900-DB2-ABEND                               09960000
099700     END-EVALUATE                                                 09970000
099800     END-PERFORM.                                                 09980000
099900     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      09990000
100000          SQLCODE NOT = ZERO                                      10000000
100100          DISPLAY '**************************************'        10010000
100200          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        10020000
100300          DISPLAY 'OPEN EXTRACT CURSOR    '                       10030000
100400          DISPLAY '**************************************'        10040000
100500          MOVE '7020-CLOSE-EXPORT-CSR'                            10050000
100600                                    TO PV-ABEND-PARAGRAPH         10060000
100700          MOVE 'CLOSE CURSOR'       TO PV-ABEND-OPERATION         10070000
100800          MOVE 'SUT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-1       10080000
100900          MOVE 'PCT_BUS_EVNT_EXPRT' TO PV-ABEND-STRUCTURE-2       10090000
101000          MOVE 'CLOSE CURSOR ERROR' TO PV-DB2-OPERATION-MESSAGE-1 10100000
101100          PERFORM 9900-DB2-ABEND                                  10110000
101200      END-IF.                                                     10120000
101300                                                                  10130000
101400 7150-SELECT-SU-EXPORT-DTL.                                       10140000
101500     PERFORM                                                      10150000
101600         WITH TEST AFTER                                          10160000
101700         VARYING PV-RETRY-COUNT                                   10170000
101800         FROM 1 BY 1                                              10180000
101900         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 10190000
102000            OR  (SQLCODE = +100)                                  10200000
102100            OR  (SQLCODE = +0))                                   10210000
102200     EXEC SQL                                                     10220000
102300         SELECT  DTL_TXT                                          10230000
102400           INTO  :SUT00038-DTL-TXT                                10240000
102500           FROM  SUT_BUS_EVNT_DTL                                 10250000
102600          WHERE  EVNT_EXPRT_ID    = :SUT00037-EVNT-EXPRT-ID       10260000
102700          WITH UR                                                 10270000
102800     END-EXEC                                                     10280000
102900                                                                  10290000
103000     EVALUATE TRUE                                                10300000
103100         WHEN SQLCODE = ZERO                                      10310000
103200             SET PS-EXPORT-DETAIL-FOUND TO TRUE                   10320000
103300             ADD +1 TO PV-EVENT-DTL-SELECT-COUNT                  10330000
103400             ADD +1 TO PV-SU-EVENT-DTL-SELECT-COUNT               10340000
103500         WHEN SQLCODE = +100                                      10350000
103600             SET PS-EXPORT-DETAIL-NOT-FOUND TO TRUE               10360000
103700         WHEN SQLCODE = -904                                      10370000
103800         WHEN SQLCODE = -913                                      10380000
103900         WHEN SQLCODE = -911                                      10390000
104000             CONTINUE                                             10400000
104100         WHEN SQLWARN0 NOT = SPACE                                10410000
104200         WHEN SQLCODE  NOT = ZERO                                 10420000
104300             MOVE '7150-SELECT-SU-EXPORT-DTL'                     10430000
104400                                       TO PV-ABEND-PARAGRAPH      10440000
104500             MOVE 'SELECT'             TO PV-ABEND-OPERATION      10450000
104600             MOVE 'SUT_BUS_EVNT_DTL' TO PV-ABEND-STRUCTURE-1      10460000
104700             MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER     10470000
104800             STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER 10480000
104900                 DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2      10490000
105000             PERFORM 9900-DB2-ABEND                               10500000
105100     END-EVALUATE                                                 10510000
105200     END-PERFORM.                                                 10520000
105300     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      10530000
105400          SQLCODE NOT = ZERO                                      10540000
105500          DISPLAY '**************************************'        10550000
105600          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        10560000
105700          DISPLAY 'OPEN EXTRACT CURSOR    '                       10570000
105800          DISPLAY '**************************************'        10580000
105900          MOVE '7150-SELECT-SU-EXPORT-DTL'                        10590000
106000                                    TO PV-ABEND-PARAGRAPH         10600000
106100          MOVE 'SELECT'             TO PV-ABEND-OPERATION         10610000
106200          MOVE 'SUT_BUS_EVNT_DTL'   TO PV-ABEND-STRUCTURE-1       10620000
106300          MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER        10630000
106400          STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER    10640000
106500          DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2             10650000
106600          PERFORM 9900-DB2-ABEND                                  10660000
106700      END-IF.                                                     10670000
106800                                                                  10680000
106900 7160-SELECT-PC-EXPORT-DTL.                                       10690000
107000                                                                  10700000
107100     PERFORM                                                      10710000
107200         WITH TEST AFTER                                          10720000
107300         VARYING PV-RETRY-COUNT                                   10730000
107400         FROM 1 BY 1                                              10740000
107500         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 10750000
107600            OR  (SQLCODE = +100)                                  10760000
107700            OR  (SQLCODE = +0))                                   10770000
107800     EXEC SQL                                                     10780000
107900         SELECT  DTL_TXT                                          10790000
108000           INTO  :PCT00012-DTL-TXT                                10800000
108100           FROM  PCT_BUS_EVNT_DTL                                 10810000
108200***       WHERE  EVNT_EXPRT_ID    = :PCT00011-EVNT-EXPRT-ID       10820000
108300          WHERE  EVNT_EXPRT_ID    = :SUT00037-EVNT-EXPRT-ID       10830000
108400          WITH UR                                                 10840000
108500     END-EXEC                                                     10850000
108600                                                                  10860000
108700     EVALUATE TRUE                                                10870000
108800         WHEN SQLCODE = ZERO                                      10880000
108900             SET PS-EXPORT-DETAIL-FOUND TO TRUE                   10890000
109000             ADD +1 TO PV-EVENT-DTL-SELECT-COUNT                  10900000
109100             ADD +1 TO PV-PC-EVENT-DTL-SELECT-COUNT               10910000
109200         WHEN SQLCODE = +100                                      10920000
109300             SET PS-EXPORT-DETAIL-NOT-FOUND TO TRUE               10930000
109400         WHEN SQLCODE = -904                                      10940000
109500         WHEN SQLCODE = -913                                      10950000
109600         WHEN SQLCODE = -911                                      10960000
109700             CONTINUE                                             10970000
109800         WHEN SQLWARN0 NOT = SPACE                                10980000
109900         WHEN SQLCODE  NOT = ZERO                                 10990000
110000             MOVE '7160-SELECT-PC-EXPORT-DTL'                     11000000
110100                                       TO PV-ABEND-PARAGRAPH      11010000
110200             MOVE 'SELECT'             TO PV-ABEND-OPERATION      11020000
110300             MOVE 'PCT_BUS_EVNT_DTL' TO PV-ABEND-STRUCTURE-1      11030000
110400             MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER     11040000
110500             STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER 11050000
110600                 DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2      11060000
110700             PERFORM 9900-DB2-ABEND                               11070000
110800     END-EVALUATE                                                 11080000
110900     END-PERFORM.                                                 11090000
111000     IF  PV-RETRY-COUNT > PC-MAX-RETRIES AND                      11100000
111100          SQLCODE NOT = ZERO                                      11110000
111200          DISPLAY '**************************************'        11120000
111300          DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '        11130000
111400          DISPLAY 'OPEN EXTRACT CURSOR    '                       11140000
111500          DISPLAY '**************************************'        11150000
111600          MOVE '7160-SELECT-PC-EXPORT-DTL'                        11160000
111700                                    TO PV-ABEND-PARAGRAPH         11170000
111800          MOVE 'SELECT'             TO PV-ABEND-OPERATION         11180000
111900          MOVE 'PCT_BUS_EVNT_DTL'   TO PV-ABEND-STRUCTURE-1       11190000
112000          MOVE SUT00037-EVNT-EXPRT-ID TO PV-DISPLAY-NUMBER        11200000
112100          STRING 'SUT00037-EVNT-EXPRT-ID= '  PV-DISPLAY-NUMBER    11210000
112200          DELIMITED BY SIZE INTO PV-ABEND-STRUCTURE-2             11220000
112300          PERFORM 9900-DB2-ABEND                                  11230000
112400      END-IF.                                                     11240000
112500                                                                  11250000
112600 7200-READ-TMST-EXTRACT-FILE.                                     11260000
112700                                                                  11270000
112800     READ SELECT-TMST-EXTRACT-FILE                                11280000
112900       INTO DL012-CONTROL-RECORD                                  11290000
113000           AT END                                                 11300000
113100               SET PS-EOF-SEL-TMST-FILE TO TRUE.                  11310000
113200                                                                  11320000
113300                                                                  11330000
113400 8100-WRITE-EXTRACT-REC.                                          11340000
113500                                                                  11350000
113600     ADD 1 TO PV-EXTRACT-WRITE-COUNT.                             11360000
113700     WRITE EXPORT-EXTRACT-RECORD FROM                             11370000
113800           DL003-EXPORT-RECORD-LAYOUT.                            11380000
113900                                                                  11390000
114000 8200-WRITE-KEY-REC.                                              11400000
114100                                                                  11410000
114200     ADD 1 TO PV-KEY-WRITE-COUNT.                                 11420000
114300     WRITE EXPORT-KEY-RECORD FROM                                 11430000
114400           DL004-EAI-KEY-RECORD-LAYOUT.                           11440000
114500 8300-WRITE-CLOCK-IN-REC.                                         11450000
114600                                                                  11460000
114700     ADD 1 TO PV-KEY-WRITE-COUNT.                                 11470000
114800     WRITE EXPORT-CLOCK-IN-RECORD FROM                            11480000
114900           DL017-ASSOC-STRT-REC-LAYOUT.                           11490000
115000/                                                                 11500000
115100 9000-TERMINATE.                                                  11510000
115200                                                                  11520000
115300     PERFORM 7020-CLOSE-EXPORT-CSR.                               11530000
115400                                                                  11540000
115500     CLOSE SELECT-TMST-EXTRACT-FILE                               11550000
115600           EXPORT-EXTRACT-FILE                                    11560000
115700           EXPORT-KEY-FILE                                        11570000
115800           EXPORT-CLOCK-IN-FILE.                                  11580000
115900                                                                  11590000
116000**** IF  PV-EVENT-FETCH-COUNT = 0                                 11600000
116100     IF  PV-EXTRACT-WRITE-COUNT = 0                               11610000
116200         MOVE 1 TO RETURN-CODE                                    11620000
116300     END-IF.                                                      11630000
116400                                                                  11640000
116500     DISPLAY '************************'.                          11650000
116600     DISPLAY '******* DLKUT038 *******'.                          11660000
116700     DISPLAY '************************'.                          11670000
116800     DISPLAY SPACES                                               11680000
116900                                                                  11690000
117000     MOVE PV-EVENT-FETCH-COUNT        TO PV-DISPLAY-COUNT.        11700000
117100     DISPLAY 'TOTAL BUS EVENTS FETCHED      = ' PV-DISPLAY-COUNT. 11710000
117200                                                                  11720000
117300     MOVE PV-SU-EVENT-FETCH-COUNT     TO PV-DISPLAY-COUNT.        11730000
117400     DISPLAY 'TOTAL SU BUS EVENTS FETCHED   = ' PV-DISPLAY-COUNT. 11740000
117500                                                                  11750000
117600     MOVE PV-PC-EVENT-FETCH-COUNT     TO PV-DISPLAY-COUNT.        11760000
117700     DISPLAY 'TOTAL PC BUS EVENTS FETCHED   = ' PV-DISPLAY-COUNT. 11770000
117800                                                                  11780000
117900     MOVE PV-EVENT-DTL-SELECT-COUNT   TO PV-DISPLAY-COUNT.        11790000
118000     DISPLAY 'TOTAL EVENT DTLS SELECTED     = ' PV-DISPLAY-COUNT. 11800000
118100                                                                  11810000
118200     MOVE PV-SU-EVENT-DTL-SELECT-COUNT TO PV-DISPLAY-COUNT.       11820000
118300     DISPLAY 'TOTAL SU EVENT DTLS SELECTED  = ' PV-DISPLAY-COUNT. 11830000
118400                                                                  11840000
118500     MOVE PV-PC-EVENT-DTL-SELECT-COUNT TO PV-DISPLAY-COUNT.       11850000
118600     DISPLAY 'TOTAL PC EVENT DTLS SELECTED  = ' PV-DISPLAY-COUNT. 11860000
118700                                                                  11870000
118800     MOVE PV-EXTRACT-WRITE-COUNT       TO PV-DISPLAY-COUNT.       11880000
118900     DISPLAY 'TOTAL EXTRACT RECORDS WRITTEN = ' PV-DISPLAY-COUNT. 11890000
119000                                                                  11900000
119100     MOVE PV-KEY-WRITE-COUNT           TO PV-DISPLAY-COUNT.       11910000
119200     DISPLAY 'TOTAL KEY RECORDS WRITTEN     = ' PV-DISPLAY-COUNT. 11920000
119300                                                                  11930000
119400     DISPLAY SPACES                                               11940000
119500     DISPLAY '************************'.                          11950000
119600                                                                  11960000
119700                                                                  11970000
119800 9900-DB2-ABEND.                                                  11980000
119900                                                                  11990000
120000     MOVE SQLCODE TO PV-SQLCODE.                                  12000000
120100     DISPLAY '*** DB2 ERROR '.                                    12010000
120200     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       12020000
120300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 12030000
120400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               12040000
120500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               12050000
120600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       12060000
120700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       12070000
120800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       12080000
120900     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             12090000
121000                                                                  12100000
121100     IF PV-ABEND-STRUCTURE-2 > SPACES                             12110000
121200         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          12120000
121300     END-IF.                                                      12130000
121400                                                                  12140000
121500                                                                  12150000
121600     COPY DPPD004.                                                12160000
121700                                                                  12170000
121800     MOVE +4013                  TO PV-ABEND-CODE.                12180000
121900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12190000
122000                                                                  12200000
122100 9950-NON-SQL-ABEND.                                              12210000
122200******************************************************************12220000
122300*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       12230000
122400******************************************************************12240000
122500     DISPLAY '***************************'.                       12250000
122600     DISPLAY '**       ABEND           **'.                       12260000
122700     DISPLAY '**  IN PROGRAM DLKUT038  **'.                       12270000
122800     DISPLAY '***************************'.                       12280000
122900     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        12290000
123000     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       12300000
123100     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       12310000
123200*                                                                 12320000
123300     MOVE +4014                  TO PV-ABEND-CODE.                12330000
123400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12340000
123500                                                                  12350000
