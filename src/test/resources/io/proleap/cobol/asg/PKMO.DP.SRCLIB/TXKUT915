000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.               TXKUT915.                              00020001
000300 AUTHOR.                   JIM LEIKNESS.                          00030000
000400 INSTALLATION.             KOHLS DEPARTMENT STORES.               00040000
000500 DATE-WRITTEN.             MARCH 2003.                            00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070009
000800*----------------------------------------------------------------*00080000
000900*  PROGRAM NARRATIVE:                                            *00090000
000910*    THIS PROGRAM CREATES A FULL REFRESH FILE FOR ALL STORES     *00091027
000920*    THAT HAVE REQUESTED A FULL REFRESH.  A FULL REFRESH         *00092027
000930*    CONTAINS THE ITEM TAXABILITY INDICATORS FOR ALL ITEMS.      *00093027
001000*                                                                *00100001
001200*  CHANGES: NAME              -  DATE                            *00120000
001300*       DESCRIPTION                                              *00130000
001400*----------------------------------------------------------------*00140000
001500                                                                  00150010
001600 ENVIRONMENT DIVISION.                                            00160000
001700                                                                  00170000
001800 CONFIGURATION SECTION.                                           00180000
001900                                                                  00190000
002000 SOURCE-COMPUTER.    IBM-3090.                                    00200000
002100 OBJECT-COMPUTER.    IBM-3090.                                    00210000
002200                                                                  00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400                                                                  00240000
002500 FILE-CONTROL.                                                    00250000
002600                                                                  00260000
002700     SELECT EP112-CONTROL-FILE         ASSIGN TO INP01.           00270034
002710     SELECT EP45-CONTROL-FILE          ASSIGN TO INP02.           00271030
002720     SELECT ITEM-TAX-FILE              ASSIGN TO INP03.           00272030
002800     SELECT TAX-OUTPUT-FILE            ASSIGN TO OUT01.           00280000
002900                                                                  00290000
003000 DATA DIVISION.                                                   00300000
003100                                                                  00310000
003200 FILE SECTION.                                                    00320000
003300                                                                  00330000
003400 FD  EP112-CONTROL-FILE                                           00340034
003500     RECORDING MODE IS F                                          00350000
003600     BLOCK CONTAINS 0                                             00360000
003700     LABEL RECORDS ARE STANDARD.                                  00370000
003800 01  EP112-CONTROL-RECORD           PIC X(80).                    00380038
003900                                                                  00390000
003901 FD  EP45-CONTROL-FILE                                            00390130
003902     RECORDING MODE IS F                                          00390230
003903     BLOCK CONTAINS 0                                             00390330
003904     LABEL RECORDS ARE STANDARD.                                  00390430
003905 01  EP45-CONTROL-RECORD            PIC X(80).                    00390538
003906                                                                  00390630
003910 FD  ITEM-TAX-FILE                                                00391030
003920     RECORDING MODE IS F                                          00392030
003930     BLOCK CONTAINS 0                                             00393030
003940     LABEL RECORDS ARE STANDARD.                                  00394030
003950 01  ITEM-TAX-RECORD                PIC X(60).                    00395053
003960                                                                  00396030
004000 FD  TAX-OUTPUT-FILE                                              00400000
004100     RECORDING MODE IS F                                          00410000
004200     BLOCK CONTAINS 0                                             00420000
004300     LABEL RECORDS ARE STANDARD.                                  00430000
004400 01  TAX-OUTPUT-RECORD                PIC X(20).                  00440055
004600                                                                  00460000
004700 WORKING-STORAGE SECTION.                                         00470000
004800                                                                  00480000
004900 01  PC-PROGRAM-CONSTANTS.                                        00490000
005000     05  PC-PROGRAM-NAME              PIC X(08)    VALUE          00500000
005100         'TXKUT915'.                                              00510001
005200     05  PC-ABEND-MSSG                PIC X(12)    VALUE          00520000
005300         '** ABEND ** '.                                          00530000
005400     05  PC-DB-ERROR-PREFIX           PIC X(09)    VALUE          00540000
005500         'DB2 ERROR'.                                             00550000
005600     05  PC-DB-ATTEMPTING-MSSG        PIC X(14)    VALUE          00560000
005700         'ATTEMPTING TO '.                                        00570000
005800     05  PC-INTERNAL-TBL-MAX          PIC S9(04) COMP             00580000
005900                                                   VALUE +1000.   00590041
006000                                                                  00600000
006100 01  PS-PROCESS-SWITCHES.                                         00610000
006200     05  PS-STORE-CURSOR-SW           PIC X(01)    VALUE 'N'.     00620046
006300         88  PS-NOT-END-OF-STORE-CURSOR            VALUE 'N'.     00630046
006400         88  PS-END-OF-STORE-CURSOR                VALUE 'Y'.     00640046
006410     05  PS-EPCC112-DETAIL-SW         PIC X(01)    VALUE 'N'.     00641030
006420         88  PS-NOT-END-OF-EPCC112                 VALUE 'N'.     00642030
006430         88  PS-END-OF-EPCC112                     VALUE 'Y'.     00643030
006440     05  PS-EPCC045-DETAIL-SW         PIC X(01)    VALUE 'N'.     00644030
006450         88  PS-NOT-END-OF-EPCC045                 VALUE 'N'.     00645030
006460         88  PS-END-OF-EPCC045                     VALUE 'Y'.     00646030
006600     05  PS-TX911-FILE-SW             PIC X(01)    VALUE 'N'.     00660001
006700         88  PS-NOT-END-OF-TX911-FILE              VALUE 'N'.     00670001
006800         88  PS-END-OF-TX911-FILE                  VALUE 'Y'.     00680001
006900                                                                  00690000
007000 01  PV-PROGRAM-VARIABLES.                                        00700000
007200     05  PV-PARAGRAPH-NAME            PIC X(50)    VALUE SPACES.  00720000
007300     05  PV-DB2-ERROR-MSSG            PIC X(50)    VALUE SPACES.  00730000
007400     05  PV-VALID-DATE                PIC X(10)    VALUE SPACES.  00740030
007401     05  PV-TODAY-DATE                PIC X(10)    VALUE SPACES.  00740147
007410     05  PV-NEW-DATE                  PIC X(10)    VALUE SPACES.  00741030
007420     05  PV-TMRW-DATE                 PIC X(10)    VALUE SPACES.  00742030
007500     05  PV-STR-COUNTER               PIC S9(04) COMP             00750003
007600                                                   VALUE ZEROS.   00760000
007700     05  PV-RECS-READ                 PIC S9(09) COMP             00770029
007800                                                   VALUE ZEROS.   00780000
007900     05  PV-RECS-WRITTEN              PIC S9(09) COMP             00790029
008000                                                   VALUE ZEROS.   00800000
008100                                                                  00810000
008200 01  ABEND-CODE                       PIC S9(04) COMP             00820010
008300                                                   VALUE ZEROS.   00830000
008400     88  ABEND-4003-INVALID-CC-DATE                VALUE +4003.   00840000
008500     88  ABEND-4004-TBL-OVERFLOW-ERROR             VALUE +4004.   00850046
008600     88  ABEND-4013-DB2-ERROR                      VALUE +4013.   00860000
008610                                                                  00861014
008700 01 ST-TABLE.                                                     00870011
008800    05  ST-LOC-TBL OCCURS 1000 TIMES INDEXED BY X1.               00880046
008900       10 T-ST-CDE                    PIC  X(02)  VALUE SPACES.   00890014
009000       10 T-LOC-NBR                   PIC  S9(04) COMP.           00900022
009200                                                                  00920010
009300*----------------------------------------------------------------*00930000
009400*    COPYBOOK FOR DPKUT500                                        00940003
009500*----------------------------------------------------------------*00950000
009600     COPY DPWS500.                                                00960000
009700                                                                  00970010
009800*----------------------------------------------------------------*00980000
009900*    COPYBOOK FOR OUTPUT RECORD LAYOUT                            00990003
010000*----------------------------------------------------------------*01000000
010100     COPY TXRD915.                                                01010001
010200                                                                  01020010
010300*----------------------------------------------------------------*01030001
010400*    COPYBOOK FOR ITEM TAXABILITY FILE                            01040003
010500*----------------------------------------------------------------*01050001
010600     COPY TXRD911.                                                01060001
010700                                                                  01070010
010800*----------------------------------------------------------------*01080000
010900*    COPYBOOK FOR CONTROL CARD EPCC140                            01090034
011000*----------------------------------------------------------------*01100000
011100     COPY EPWS140.                                                01110034
011200                                                                  01120010
011210*----------------------------------------------------------------*01121034
011220*    COPYBOOK FOR CONTROL CARD EPCC112                            01122034
011230*----------------------------------------------------------------*01123034
011240     COPY EPWS112.                                                01124034
011250                                                                  01125034
011260*----------------------------------------------------------------*01126034
011270*    COPYBOOK FOR CONTROL CARD EPCC045                            01127034
011280*----------------------------------------------------------------*01128034
011290     COPY EPRD045.                                                01129034
011291                                                                  01129134
011300*----------------------------------------------------------------*01130000
011400*    STANDARD DB2 ERROR HANDLING AREA                             01140003
011500*----------------------------------------------------------------*01150000
011600     COPY DPWS004.                                                01160000
011700                                                                  01170010
011800*----------------------------------------------------------------*01180000
011900*    DCLGEN FOR THE LOCATION TABLE (XST_LOC)                      01190003
012000*----------------------------------------------------------------*01200000
012100     EXEC SQL                                                     01210000
012200         INCLUDE XST00001                                         01220000
012300     END-EXEC.                                                    01230000
012400                                                                  01240010
012410*----------------------------------------------------------------*01241032
012420*    DCLGEN FOR THE LOCATION ATTRIBUTE TABLE (XST_LOC_ATTR)       01242032
012430*----------------------------------------------------------------*01243032
012440     EXEC SQL                                                     01244032
012450         INCLUDE XST00025                                         01245032
012460     END-EXEC.                                                    01246032
012470                                                                  01247032
012500*----------------------------------------------------------------*01250000
012600*    DCLGEN FOR THE EPT_STR_FIL_RFRSH TABLE                       01260003
012700*----------------------------------------------------------------*01270000
012800     EXEC SQL                                                     01280000
012900         INCLUDE EPT00010                                         01290001
013000     END-EXEC.                                                    01300000
013100                                                                  01310010
013200*----------------------------------------------------------------*01320000
013300*    STANDARD DB2 COMMUNICATIONS AREA                             01330003
013400*----------------------------------------------------------------*01340000
013500     EXEC SQL                                                     01350000
013600         INCLUDE SQLCA                                            01360000
013700     END-EXEC.                                                    01370000
013800                                                                  01380001
013900*----------------------------------------------------------------*01390000
014000*    CURSOR DECLARE - STORE REFRESH CURSOR                        01400003
014010*                                                                 01401056
014020*  NOTE: DURING THE PILOT NEW STORES WILL NOT BE ON THE PLU TAX   01402056
014030*        SYSTEM.  WHEN THE PILOT IS COMPLETE WE WILL LOOK FOR POS 01403056
014040*        CAPABILITY LEVELS 5 OR > 11.                             01404056
014100*----------------------------------------------------------------*01410000
014300     EXEC SQL                                                     01430000
014400         DECLARE STR-RFRSH-CSR CURSOR FOR                         01440001
014500                                                                  01450000
014600         SELECT  EPT.STR_NBR                                      01460001
014700                ,XST.ST_CDE                                       01470001
014800         FROM EPT_STR_FIL_RFRSH  EPT                              01480056
014900             ,XST_LOC            XST                              01490056
014910             ,XST_LOC_ATTR       ATT                              01491056
015000        WHERE EPT.STR_NBR = XST.LOC_NBR                           01500030
015001          AND XST.LOC_NBR = ATT.LOC_NBR                           01500133
015010          AND EPT.RFRSH_TYP_CDE = 'PL'                            01501037
015100          AND (EPT.RFRSH_DTE IS NULL                              01510030
015101           OR EPT.RFRSH_DTE = :PV-TODAY-DATE)                     01510147
015102          AND (ATT.POS_CAP_LVL_ID = 5                             01510259
015103           OR ATT.POS_CAP_LVL_ID > 11)                            01510359
015105          AND ((XST.OPN_DTE  >  :PV-TMRW-DATE                     01510556
015106          AND (XST.OPN_DTE  <=  :PV-NEW-DATE                      01510656
015107          AND XST.CLO_DTE   >=  :PV-NEW-DATE))                    01510756
015108           OR (XST.OPN_DTE  <=  :PV-TMRW-DATE                     01510856
015109          AND XST.CLO_DTE   >=  :PV-TMRW-DATE))                   01510956
015200      ORDER BY XST.ST_CDE, EPT.STR_NBR                            01520001
015300     END-EXEC.                                                    01530000
015400                                                                  01540000
015500******************************************************************01550003
015600 PROCEDURE DIVISION.                                              01560000
015700******************************************************************01570003
015800                                                                  01580000
015900     PERFORM 1000-INITIALIZE.                                     01590000
016000                                                                  01600001
016100     PERFORM 3000-LOAD-TBL.                                       01610042
016400                                                                  01640003
016410     IF PV-STR-COUNTER = 0                                        01641027
016420         DISPLAY ' NO STORES RECEIVING FULL FILES '               01642027
016430     ELSE                                                         01643027
016500         PERFORM 7000-READ-ITEM-TAX-FILE                          01650028
016600                                                                  01660001
016700         PERFORM 2000-PROCESS                                     01670027
016800             UNTIL PS-END-OF-TX911-FILE                           01680028
016810     END-IF.                                                      01681027
017100                                                                  01710000
017200     DISPLAY 'TOTAL RECORDS READ = ' PV-RECS-READ                 01720003
017300     DISPLAY 'NUMBER OF STORES RECEIVING FULL FILES = '           01730003
017400              PV-STR-COUNTER                                      01740003
017500     DISPLAY 'TOTAL RECORDS WRITTEN = ' PV-RECS-WRITTEN           01750003
017600                                                                  01760003
017700     CLOSE EP112-CONTROL-FILE                                     01770034
017800           EP45-CONTROL-FILE                                      01780034
017801           ITEM-TAX-FILE                                          01780134
017802           TAX-OUTPUT-FILE.                                       01780234
017900                                                                  01790000
018000     GOBACK.                                                      01800000
018100                                                                  01810000
018200******************************************************************01820003
018300*   1000-INITIALIZE -   OPENS FILES, ACCEPTS CONTROL CARD         01830008
018400******************************************************************01840003
018500 1000-INITIALIZE.                                                 01850000
018600                                                                  01860000
018610     DISPLAY 'PROGRAM : ' PC-PROGRAM-NAME                         01861047
018620                                                                  01862047
018700     OPEN INPUT EP112-CONTROL-FILE                                01870034
018710                EP45-CONTROL-FILE                                 01871034
018720                ITEM-TAX-FILE                                     01872034
018800          OUTPUT TAX-OUTPUT-FILE.                                 01880000
018900                                                                  01890000
019000     SET X1 TO +1                                                 01900012
019100                                                                  01910006
019110                                                                  01911047
019200*------  ACCEPTS PROCESS DATE FROM CONTROL CARD EPCC140  --------*01920030
019300*--------------  DATE FORMAT IS CCYY-MM-DD  ---------------------*01930003
019310                                                                  01931047
019400     ACCEPT CC-EPCC140-CONTROL-CARD.                              01940030
019401                                                                  01940147
019402     DISPLAY 'EPCC140 DATE: ' CC-EPCC140-TODAY-DATE.              01940246
019410     MOVE CC-EPCC140-TODAY-DATE TO PV-VALID-DATE.                 01941030
019500     PERFORM  1100-VALIDATE-DATE.                                 01950030
019501                                                                  01950130
019503     MOVE CC-EPCC140-TODAY-DATE TO PV-TODAY-DATE.                 01950347
019504                                                                  01950430
019505                                                                  01950547
019506*---- CONTROL CARD CONTAINING TOMORROW'S DATE (EPCC112) ---------*01950636
019507*--------------  DATE FORMAT IS CCYY-MM-DD  ---------------------*01950736
019508                                                                  01950847
019510     READ EP112-CONTROL-FILE INTO CC-EPCC112-CONTROL-CARD         01951034
019520       AT END SET PS-END-OF-EPCC112 TO TRUE.                      01952030
019521                                                                  01952147
019522     DISPLAY 'EPCC112 DATE: ' CC-EPCC112-TOMORROW-DATE            01952246
019530     MOVE CC-EPCC112-TOMORROW-DATE TO PV-VALID-DATE               01953030
019531     PERFORM  1100-VALIDATE-DATE                                  01953130
019532                                                                  01953230
019534     MOVE  CC-EPCC112-TOMORROW-DATE TO PV-TMRW-DATE               01953430
019535                                                                  01953530
019536                                                                  01953647
019537*----CONTROL CARD EPCC045 - CONTAINS NUMBER OF DAYS BEFORE-------*01953736
019538*--------- OPENING THAT FILES ARE SENT TO THE STORE -------------*01953836
019540                                                                  01954047
019541     READ EP45-CONTROL-FILE INTO EP045-ADVDAYS-TO-SND-RECORD      01954130
019550       AT END SET PS-END-OF-EPCC045 TO TRUE.                      01955030
019560                                                                  01956047
019600     DISPLAY 'EP045-DAYS-TILL-STORE-OPN: '                        01960046
019610              EP045-DAYS-TILL-STORE-OPN                           01961046
019620                                                                  01962046
019700     PERFORM 1200-CALC-NEW-OPEN-DTE.                              01970030
019710     DISPLAY 'NEW OPEN DATE : ' PV-NEW-DATE.                      01971035
019800                                                                  01980000
019900******************************************************************01990003
020000* 1100-VALIDATE-DATE CHECKS CONTROL CARD EPCC140 FOR VALID DATE   02000030
020100******************************************************************02010003
020200 1100-VALIDATE-DATE.                                              02020000
020300                                                                  02030000
020410     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         02041030
020500     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     02050000
020600     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     02060000
020700                                                                  02070000
020900     MOVE PV-VALID-DATE  TO DPG52-LK-DATE-INPUT                   02090030
020910                                                                  02091030
021000     CALL DP500-KOHLS-CALENDAR-ROUTINE                            02100000
021100          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02110000
021200                                                                  02120000
021300     EVALUATE TRUE                                                02130000
021400         WHEN DPG54-NO-ERROR                                      02140000
021510             CONTINUE                                             02151030
021600         WHEN OTHER                                               02160000
021700             DISPLAY '** ABEND **'                                02170000
021800             DISPLAY PC-PROGRAM-NAME          ' - INVALID'        02180000
021900                       'PROCESS DATE PROVIDED'                    02190000
022000             DISPLAY '1100-VALIDATE-DATE '                        02200000
022100                                                                  02210000
022200             MOVE +4003 TO ABEND-CODE                             02220000
022300             CALL 'ILBOABN0' USING ABEND-CODE                     02230000
022400     END-EVALUATE.                                                02240000
022401                                                                  02240130
022410     INITIALIZE PV-VALID-DATE.                                    02241030
022500                                                                  02250000
022510******************************************************************02251030
022520* 1200-CALC-NEW-OPEN-DTE                                          02252030
022530******************************************************************02253030
022540 1200-CALC-NEW-OPEN-DTE.                                          02254030
022550                                                                  02255030
022560     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         02256030
022570     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     02257030
022580     SET DPG51-INCREMENT-DATE    TO TRUE.                         02258030
022590     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    02259030
022591                                                                  02259130
022592     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     02259230
022594     MOVE CC-EPCC140-TODAY-DATE TO DPG52-LK-DATE-INPUT.           02259430
022595     CALL DP500-KOHLS-CALENDAR-ROUTINE                            02259530
022596          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02259630
022597                                                                  02259730
022598     EVALUATE TRUE                                                02259830
022599         WHEN DPG54-NO-ERROR                                      02259930
022600             CONTINUE                                             02260030
022601         WHEN OTHER                                               02260130
022602             DISPLAY DPG54-ERROR-MESSAGE                          02260230
022603             DISPLAY '** ABEND **'                                02260330
022604             DISPLAY PC-PROGRAM-NAME          ' - INVALID'        02260430
022605                       ' NEW OPEN DATE PROVIDED'                  02260530
022606             DISPLAY '1200-CALC-NEW-OPEN-DTE'                     02260630
022607             MOVE +4003 TO ABEND-CODE                             02260730
022608             CALL 'ILBOABN0' USING ABEND-CODE                     02260830
022609     END-EVALUATE.                                                02260930
022610                                                                  02261030
022611     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DATE.                  02261131
022620******************************************************************02262003
022700* 2000-PROCESS  - THIS PARAGRAPH MATCHES THE STATE CODE FROM THE  02270047
022800*    INPUT RECORD TO THE STATE ON THE INTERNAL TABLE AND WRITES   02280047
022810*    AN OUTPUT RECORD FOR EACH LOCATION IN THAT STATE.            02281047
022850*                                                                 02285047
022900******************************************************************02290003
023000 2000-PROCESS.                                                    02300000
023100                                                                  02310000
023200     SET X1 TO +1                                                 02320008
023300     SEARCH ST-LOC-TBL                                            02330046
023400        WHEN T-ST-CDE (X1) = TX911-STATE-CODE                     02340021
023500           PERFORM UNTIL T-ST-CDE (X1) NOT = TX911-STATE-CODE     02350021
023600              MOVE T-LOC-NBR (X1)    TO  TX915-LOC-NBR            02360044
023700              MOVE TX911-INTR-UPC-ID TO  TX915-INTR-UPC-ID        02370018
023800              MOVE TX911-SKU-NBR     TO  TX915-SKU-NBR            02380018
023900              MOVE TX911-TX-PARM-CDE TO  TX915-TX-PARM-CDE        02390018
024000              SET TX915-NEW-OR-FULL  TO  TRUE                     02400018
024100              PERFORM 8000-WRITE-ITEM-TAX-FILE                    02410010
024200              SET X1 UP BY +1                                     02420010
024300           END-PERFORM                                            02430010
024400     END-SEARCH.                                                  02440046
024500     PERFORM 7000-READ-ITEM-TAX-FILE.                             02450005
024600                                                                  02460003
024700******************************************************************02470003
024800* 3000-LOAD-TBL -  THIS PARAGRAPH LOADS THE INTERNAL TABLE OF     02480047
024810*   LOCATIONS AND THEIR RESPECTIVE STATES THAT REQUEST A FULL     02481047
024820*   REFRESH.                                                      02482047
024850*                                                                 02485047
024900******************************************************************02490003
024901 3000-LOAD-TBL.                                                   02490142
024902                                                                  02490242
024903     PERFORM 4000-OPEN-STR-RFRSH-CSR.                             02490342
024904                                                                  02490442
024905     PERFORM 5000-FETCH-STR-RFRSH-CSR.                            02490542
024906                                                                  02490642
024907     PERFORM UNTIL PS-END-OF-STORE-CURSOR                         02490746
024908        MOVE EPT00010-STR-NBR  TO  T-LOC-NBR(X1)                  02490847
024909        MOVE XST00001-ST-CDE   TO  T-ST-CDE(X1)                   02490947
024910        ADD      +1            TO PV-STR-COUNTER                  02491047
024911        SET X1 UP BY +1                                           02491142
024912        IF X1 > PC-INTERNAL-TBL-MAX                               02491242
024913             DISPLAY '*** ABEND ***'                              02491342
024914             DISPLAY PC-PROGRAM-NAME                              02491442
024915             '   INTERNAL TABLE OVERFLOW'                         02491542
024916             DISPLAY '3000-LOAD-INTRNL-TBL'                       02491646
024917             MOVE +4004 TO ABEND-CODE                             02491746
024918             CALL 'ILBOABN0' USING ABEND-CODE                     02491842
024919        END-IF                                                    02491942
024920        PERFORM 5000-FETCH-STR-RFRSH-CSR                          02492042
024921     END-PERFORM.                                                 02492142
024922                                                                  02492242
024923     PERFORM 6000-CLOSE-STR-RFRSH-CSR.                            02492348
024924                                                                  02492442
024925******************************************************************02492542
024926* 4000-OPEN-STR-RFRSH-CSR                                         02492642
024930******************************************************************02493042
025000 4000-OPEN-STR-RFRSH-CSR.                                         02500001
025100                                                                  02510003
025200     EXEC SQL                                                     02520000
025300         OPEN STR-RFRSH-CSR                                       02530001
025400     END-EXEC.                                                    02540000
025500                                                                  02550000
025600     EVALUATE TRUE                                                02560000
025700       WHEN SQLCODE NOT = 0                                       02570000
025800       WHEN SQLWARN0    = 'W'                                     02580000
025900         MOVE '4000-OPEN-STR-RFRSH-CSR'                           02590001
026000                           TO PV-PARAGRAPH-NAME                   02600000
026100         MOVE 'OPEN STORE REFRESH CURSOR ERROR.'                  02610001
026200                           TO PV-DB2-ERROR-MSSG                   02620000
026300         PERFORM 9000-DB2-ERROR                                   02630000
026400     END-EVALUATE.                                                02640000
026500                                                                  02650000
029000******************************************************************02900003
029100* 5000-FETCH-STR-RFRSH-CSR                                        02910001
029200******************************************************************02920003
029300 5000-FETCH-STR-RFRSH-CSR.                                        02930001
029400                                                                  02940001
029500     EXEC SQL                                                     02950001
029600         FETCH STR-RFRSH-CSR                                      02960001
029700           INTO :EPT00010-STR-NBR                                 02970001
029800              , :XST00001-ST-CDE                                  02980001
029900     END-EXEC.                                                    02990001
030000                                                                  03000001
030100     EVALUATE TRUE                                                03010001
030200         WHEN SQLCODE = +0                                        03020001
030310             CONTINUE                                             03031042
030400         WHEN SQLCODE = +100                                      03040001
030500             SET PS-END-OF-STORE-CURSOR TO TRUE                   03050046
030600         WHEN OTHER                                               03060001
030700             MOVE '5000-FETCH-STR-RFRSH-CSR'                      03070001
030800                               TO PV-PARAGRAPH-NAME               03080001
030900             MOVE 'FETCH FROM STORE REFRESH CSR ERROR.'           03090001
031000                               TO PV-DB2-ERROR-MSSG               03100001
031100             PERFORM 9000-DB2-ERROR                               03110001
031200     END-EVALUATE.                                                03120001
031300                                                                  03130001
031400******************************************************************03140003
031500*  6000-CLOSE STORE REFRESH CURSOR                                03150001
031600******************************************************************03160003
031700 6000-CLOSE-STR-RFRSH-CSR.                                        03170001
031800                                                                  03180010
031900     EXEC SQL                                                     03190001
032000       CLOSE STR-RFRSH-CSR                                        03200001
032100     END-EXEC.                                                    03210001
032200                                                                  03220001
032300     EVALUATE TRUE                                                03230001
032400       WHEN SQLCODE NOT = 0                                       03240001
032500       WHEN SQLWARN0    = 'W'                                     03250001
032600           MOVE '6000-CLOSE-STR-RFRSH-CSR'                        03260001
032700                             TO PV-PARAGRAPH-NAME                 03270001
032800           MOVE 'CLOSE FAILED FOR STORE REFRESH CURSOR'           03280001
032900                             TO PV-DB2-ERROR-MSSG                 03290001
033000           PERFORM 9000-DB2-ERROR                                 03300001
033100     END-EVALUATE.                                                03310001
033200                                                                  03320001
033300******************************************************************03330003
033400*  7000-READ-ITEM-TAX-FILE                                        03340001
033500******************************************************************03350003
033600 7000-READ-ITEM-TAX-FILE.                                         03360001
033700                                                                  03370001
033800     READ ITEM-TAX-FILE INTO TX911-TAX-ITEM-RECORD                03380001
033900       AT END SET PS-END-OF-TX911-FILE TO TRUE                    03390051
034000       NOT AT END ADD +1 TO PV-RECS-READ.                         03400050
034200                                                                  03420001
034300******************************************************************03430003
034400* 8000-WRITE-ITEM-TAX-FILE                                        03440003
034500******************************************************************03450003
034600 8000-WRITE-ITEM-TAX-FILE.                                        03460003
034700                                                                  03470000
034800     WRITE TAX-OUTPUT-RECORD FROM TX915-TAX-ITEM-RECORD.          03480001
034900                                                                  03490000
035000     ADD +1 TO PV-RECS-WRITTEN                                    03500000
035100                                                                  03510000
035200     INITIALIZE TX915-TAX-ITEM-RECORD.                            03520001
035300                                                                  03530000
035400******************************************************************03540003
035500* 9000-DB2 ERROR                                                  03550000
035600******************************************************************03560003
035700 9000-DB2-ERROR.                                                  03570000
035800                                                                  03580000
035900     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NAME.                      03590000
035910     DISPLAY PV-PARAGRAPH-NAME.                                   03591047
036000     DISPLAY PC-DB-ERROR-PREFIX                                   03600000
036100     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             03610000
036200     COPY DPPD004.                                                03620000
036300     SET ABEND-4013-DB2-ERROR TO TRUE.                            03630000
036400     CALL 'ILBOABN0' USING ABEND-CODE.                            03640000
036500     EJECT                                                        03650000
