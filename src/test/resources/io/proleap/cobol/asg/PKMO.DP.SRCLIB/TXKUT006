000100 IDENTIFICATION DIVISION.                                         00010099
000200*                                                                 00020099
000300 PROGRAM-ID.    TXKUT006.                                         00030099
000400*                                                                 00040099
000500 AUTHOR.        R. DEBARTOLO.                                     00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  04/2001.                                          00070099
000800 DATE-COMPILED.                                                   00080099
000900******************************************************************00090099
001000*                                                                *00100099
001100*  THIS PROGRAM GETS THE STATE CODE FROM THE TABLE TADZIP FOR    *00110099
001200*  E-COMMERCE EMPLOYEE DISCOUNT TAX ADJUSTMENT TRANSACTIONS.     *00120099
001300*  AN EXCEPTION REPORT IS WRITTEN OUT FOR ANY INVALID ZIP CODES  *00130099
001400*  OR ANY ZIP CODES WHICH MAY EXIST IN MORE THAN ONE STATE.      *00140099
001500*                                                                *00150099
001600******************************************************************00160099
C70860* DATE  12/24/2013                                              * 00170099
C70860*     CHANGE MADE: MODIFIED THE PROGRAM FOR NEW BUSINESS RULE   * 00180099
C70860*     CHANGE - ROUTING SFS TRANSACTIONS TO STORE 873            * 00190099
C70860*     MADE BY: COGNIZANT               WR/IR #: CHG0070860      * 00200099
C76279******************************************************************00210099
C76279* DATE  02/24/2013                                               *00220099
C76279*     CHANGE MADE: MODIFIED THE PROGRAM DUE TO COPYBOOK TXRD006  *00230099
C76279*     CHANGE. CHANGED THE TRANSACTION INDICATOR VARIABLE FOR     *00240099
C76279*     SFS. BOPUS COMPANION PROJECT.                              *00250099
C76279*     INITIALIZED NUMBER OF LINES PRINTED ON A PAGE IN HEADER    *00260099
C76279*     PARA TO FIX THE PAGE BREAKUP ISSUE.                        *00270099
C76279*     MADE BY: COGNIZANT               WR/IR #: CHG0076279       *00280099
C76279******************************************************************00281099
C76279* DATE  10/23/2018                                               *00282099
C76279*     CHANGE MADE: MODIFIED THE PROGRAM TO EXTERNALIZE           *00283099
      *     ORACLE LOGON.                                              *00284099
C76279*     CHANGES ARE TAGGED WITH CHG2105.                           *00287099
C76279*     MADE BY: COGNIZANT               WR/IR #: CHG0211205       *00288099
001700*----------------------------------------------------------------*00290099
001800*  REVISIONS:                                                    *00300099
001900*  DATE:                                                         *00310099
002000*  DESC:                                                         *00320099
002100*                                                                *00330099
002200*----------------------------------------------------------------*00340099
002300******************************************************************00350099
002400 ENVIRONMENT DIVISION.                                            00360099
002500*                                                                 00370099
002600*                                                                 00380099
002700 CONFIGURATION SECTION.                                           00390099
002800 SOURCE-COMPUTER. IBM-3090.                                       00400099
002900 OBJECT-COMPUTER. IBM-3090.                                       00410099
003000*                                                                 00420099
003100*                                                                 00430099
003200 INPUT-OUTPUT SECTION.                                            00440099
003300 FILE-CONTROL.                                                    00450099
003400                                                                  00460099
003500                                                                  00470099
003600     SELECT TAX-IN-FILE                                           00480099
003700         ASSIGN                       TO INP01.                   00490099
003800                                                                  00500099
003900     SELECT TAX-OUT-FILE                                          00510099
004000         ASSIGN                       TO OUT01.                   00520099
004100                                                                  00530099
004200     SELECT TAX-ERROR-FILE                                        00540099
004300         ASSIGN                       TO OUT02.                   00550099
004400                                                                  00560099
004500     SELECT TAX-ERROR-REPORT                                      00570099
004600         ASSIGN                       TO RPT01.                   00580099
004700                                                                  00590099
CHG205     SELECT ORACLE-LOGON-FILE                                     00600099
CHG205         ASSIGN                       TO ORALOGON.                00610099
004700                                                                  00620099
004800 EJECT                                                            00630099
004900*                                                                 00640099
005000***************                                                   00650099
005100 DATA DIVISION.                                                   00660099
005200***************                                                   00670099
005300*                                                                 00680099
005400 FILE SECTION.                                                    00690099
005500*                                                                 00700099
005600 FD  TAX-IN-FILE                                                  00710099
005700     RECORDING MODE IS F                                          00720099
005800     LABEL RECORDS ARE STANDARD                                   00730099
005900     BLOCK CONTAINS 0 RECORDS                                     00740099
006000     RECORD CONTAINS 200 CHARACTERS                               00750099
006100     DATA RECORD IS TX-TAX-IN-FILE.                               00760099
006200                                                                  00770099
006300 01  TX-TAX-IN-FILE             PIC X(200).                       00780099
006400                                                                  00790099
006500*                                                                 00800099
006600 FD  TAX-OUT-FILE                                                 00810099
006700     RECORDING MODE IS F                                          00820099
006800     LABEL RECORDS ARE STANDARD                                   00830099
006900     BLOCK CONTAINS 0 RECORDS                                     00840099
007000     RECORD CONTAINS 200 CHARACTERS                               00850099
007100     DATA RECORD IS TX-TAX-OUT-FILE.                              00860099
007200                                                                  00870099
007300 01  TX-TAX-OUT-FILE             PIC X(200).                      00880099
007400                                                                  00890099
007500*                                                                 00900099
007600 FD  TAX-ERROR-FILE                                               00910099
007700     RECORDING MODE IS F                                          00920099
007800     LABEL RECORDS ARE STANDARD                                   00930099
007900     BLOCK CONTAINS 0 RECORDS                                     00940099
008000     RECORD CONTAINS 200 CHARACTERS                               00950099
008100     DATA RECORD IS TX-TAX-ERROR-FILE.                            00960099
008200                                                                  00970099
008300 01  TX-TAX-ERROR-FILE           PIC X(200).                      00980099
008400                                                                  00990099
008500*                                                                 01000099
008600 FD  TAX-ERROR-REPORT                                             01010099
008700     RECORDING MODE IS F                                          01020099
008800     LABEL RECORDS ARE STANDARD                                   01030099
008900     BLOCK CONTAINS 0 RECORDS                                     01040099
009000     RECORD CONTAINS 200 CHARACTERS                               01050099
009100     DATA RECORD IS TX-TAX-ERROR-REPORT.                          01060099
009200                                                                  01070099
009300 01  TX-TAX-ERROR-REPORT         PIC X(200).                      01080099
009400                                                                  01090099
009400*                                                                 01100099
CHG205 FD  ORACLE-LOGON-FILE                                            01110099
CHG205     RECORDING MODE IS F                                          01120099
CHG205     LABEL RECORDS ARE STANDARD                                   01130099
CHG205     BLOCK CONTAINS 0 RECORDS                                     01140099
CHG205     RECORD CONTAINS 80 CHARACTERS                                01150099
CHG205     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      01160099
CHG205                                                                  01170099
CHG205 01  OL-ORACLE-LOGON-RECORD      PIC X(80).                       01180099
                                                                        01190099
009500*                                                                 01200099
009600     EJECT                                                        01210099
009700*                                                                 01220099
009800 WORKING-STORAGE SECTION.                                         01230099
009900*                                                                 01240099
010000***************************************************************** 01250099
010100*  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 01260099
010200***************************************************************** 01270099
010300     COPY DPWS132O.                                               01280099
010400*                                                                 01290099
010500****************************************************************  01300099
010600* RECORD LAYOUT FOR TAX ADJUSTMENT RECORD                         01310099
010700****************************************************************  01320099
010800     COPY TXRD006.                                                01330099
010900*                                                                 01340099
011000 01  TAX-ERROR-RECORD.                                            01350099
011100     05  TX-ERROR-STR-NBR                   PIC   9(04).          01360099
011200     05  TX-ERROR-ZIP-CDE                   PIC   X(05).          01370099
011300     05  TX-ERROR-PROCESS-DTE               PIC   X(10).          01380099
011400     05  TX-ERROR-RGST-ID                   PIC  S9(4)  COMP.     01390099
011500     05  TX-ERROR-TRN-NBR                   PIC  S9(4)  COMP.     01400099
011600     05  TX-ERROR-START-TIME                PIC   X(08).          01410099
011700     05  TX-ERROR-SLS-CORR-SEQ-NBR          PIC  S9(04) COMP.     01420099
011800     05  FILLER                             PIC   X(36).          01430099
011900                                                                  01440099
012000 01  WS-ERROR-FIELDS.                                             01450099
012100     05 WS-MSG-TEXT                  PIC X(512).                  01460099
012200     05 WS-MAX-SIZE                  PIC S9(09) COMP              01470099
012300                                                 VALUE +512.      01480099
012400     05 WS-MSG-LENGTH                PIC S9(09) COMP.             01490099
012500     05 WS-ABEND-CODE                PIC S9(04) COMP SYNC         01500099
012600                                                VALUE ZEROS.      01510099
012700                                                                  01520099
012800 01 PV-PROGRAM-VARIABLES.                                         01530099
012900                                                                  01540099
CHG205    05  PV-ORACLE-USERID-LEN   PIC S9(04) VALUE ZEROS             01550099
CHG205                                          COMP SYNC.              01560099
CHG205    05  PV-ORACLE-PASSWORD-LEN PIC S9(04) VALUE ZEROS             01570099
CHG205                                          COMP SYNC.              01580099
013000    05  PV-PRINT-RECORD        PIC X(200) VALUE SPACE.            01590099
013100    05  PVP-ABEND-PARAGRAPH    PIC X(40)  VALUE SPACES.           01600099
013200    05  PVP-ABEND-CODE         PIC S9(04) COMP SYNC VALUE +0000.  01610099
C70860    05  PV-STR-NBR-SFS-ECOMM   PIC 9(04) VALUE 0873.              01620099
013300    05  PV-PAGE-CNT            PIC 9(03)  VALUE ZEROES.           01630099
013400    05  PV-LINES               PIC S9(4)  COMP.                   01640099
013500    05  PV-LINE-SPACING        PIC 9(03)  VALUE ZEROES.           01650099
013600    05  PV-READ-CNT            PIC 9(07)  COMP-3 VALUE ZEROES.    01660099
013710    05  PV-OUT-CNT             PIC 9(07)  COMP-3 VALUE ZEROES.    01670099
013711    05  PV-ERROR-CNT           PIC 9(07)  COMP-3 VALUE ZEROES.    01680099
013712    05  PV-DISPLAY-CNT         PIC Z,ZZZ,ZZ9.                     01690099
013900    05  PV-SAVE-ZIP-CDE        PIC X(05)  VALUE SPACES.           01700099
014000    05  PV-CURR-DATE-CCYYMMDD.                                    01710099
014100        10  PV-CURR-DATE-CCYY       PIC  9(04).                   01720099
014200        10  PV-CURR-DATE-MM         PIC  9(02).                   01730099
014300        10  PV-CURR-DATE-DD         PIC  9(02).                   01740099
014400    05  PV-CURR-TIME.                                             01750099
014500        10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.     01760099
014600        10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.     01770099
014700        10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.     01780099
014800    05  PV-HEADER-DATE.                                           01790099
014900        10  PV-HEADER-MM            PIC XX.                       01800099
015000        10  PV-HEADER-SLASH-1       PIC X.                        01810099
015100        10  PV-HEADER-DD            PIC XX.                       01820099
015200        10  PV-HEADER-SLASH-2       PIC X.                        01830099
015300        10  PV-HEADER-CCYY          PIC X(04).                    01840099
015400                                                                  01850099
015500 01 PS-PROGRAM-SWITCHES.                                          01860099
                                                                        01870099
CHG205     05  PS-END-OF-LOGON-FILE-SW    PIC X(1)   VALUE 'N'.         01880099
CHG205         88  PS-END-OF-LOGON-FILE              VALUE 'Y'.         01890099
CHG205     05  PS-ORA-SRC-CTL-DONE-SW     PIC X(1)   VALUE 'N'.         01900099
CHG205         88  PS-ORA-SRC-EMPTY                  VALUE 'Y'.         01910099
015700     05  PS-END-OF-TAX-FILE-SW    PIC X(1)     VALUE 'N'.         01920099
015800         88  PS-END-OF-TAX-FILE                VALUE 'Y'.         01930099
015900         88  PS-NOT-END-OF-TAX-FILE            VALUE 'N'.         01940099
015910     05  PS-ZIP-CODE-ERROR-SW    PIC X(1)      VALUE 'N'.         01950099
015920         88  PS-ZIP-CODE-ERROR                 VALUE 'Y'.         01960099
015930         88  PS-ZIP-CODE-ERROR-NO              VALUE 'N'.         01970099
016000                                                                  01980099
CHG205 01  CC-ORACLE-CONNECTION.                                        01990099
CHG205     05  CC-ORACLE-USERID           PIC X(40).                    02000099
CHG205         88 CC-AUTO-LOGON                       VALUE '/'.        02010099
CHG205     05  CC-ORACLE-PASSWORD         PIC X(40).                    02020099
016000                                                                  02030099
016100 01  PC-PROGRAM-CONSTANTS.                                        02040099
CHG205     05  PC-AUTO-LOGON              PIC  X(01) VALUE '/'.         02050099
016200     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)     VALUE         02060099
016300                                                   'TXKUT006'.    02070099
016400     05  PC-LINE-LIMIT               PIC S9(04)  VALUE +60.       02080099
016500     05  PC-MAX-LINES                PIC S9(03)  VALUE +78        02090099
016600                                                 COMP-3.          02100099
016700                                                                  02110099
016800 01  RH-HEADER1.                                                  02120099
016900     05  FILLER                    PIC X(43)  VALUE SPACES.       02130099
017000     05  FILLER                    PIC X(46)  VALUE               02140099
017100        'INVALID ZIP CODES PASSED FROM ECOMMERCE STORE.'.         02150099
017200     05  FILLER                    PIC X(43)  VALUE SPACES.       02160099
017300                                                                  02170099
017400 01  RH-HEADER2.                                                  02180099
017500     05  FILLER                  PIC X(05)  VALUE SPACES.         02190099
017600     05  FILLER                  PIC X(11)  VALUE 'STORE'.        02200099
017700     05  FILLER                  PIC X(45)  VALUE 'BLUE MARTINI'. 02210099
017800     05  FILLER                  PIC X(10)  VALUE 'TRANS'.        02220099
017900     05  FILLER                  PIC X(12)  VALUE 'PROCESS'.      02230099
018000     05  FILLER                  PIC X(13)  VALUE 'REGISTER'.     02240099
018100     05  FILLER                  PIC X(10)  VALUE 'START'.        02250099
018200     05  FILLER                  PIC X(19)  VALUE 'S/S CORR'.     02260099
018300     05  FILLER                  PIC X(04)  VALUE 'ZIP'.          02270099
018400     05  FILLER                  PIC X(03)  VALUE SPACES.         02280099
018500                                                                  02290099
018600 01  RH-HEADER3.                                                  02300099
018700     05  FILLER                  PIC X(05)  VALUE SPACES.         02310099
018800     05  FILLER                  PIC X(11)  VALUE 'NUMBER'.       02320099
018900     05  FILLER                  PIC X(45)  VALUE 'ORDER NUMBER'. 02330099
019000     05  FILLER                  PIC X(10)  VALUE 'NUMBER'.       02340099
019100     05  FILLER                  PIC X(12)  VALUE 'DATE'.         02350099
019200     05  FILLER                  PIC X(13)  VALUE 'ID NUMBER'.    02360099
019300     05  FILLER                  PIC X(10)  VALUE 'TIME'.         02370099
019400     05  FILLER                  PIC X(19)  VALUE 'SEQ NUMBER'.   02380099
019500     05  FILLER                  PIC X(04)  VALUE 'CODE'.         02390099
019600     05  FILLER                  PIC X(03)  VALUE SPACES.         02400099
019700                                                                  02410099
019800 01  RD1-DETAIL-LINE.                                             02420099
019900     05  FILLER                  PIC X(05)    VALUE SPACES.       02430099
020000     05  RD1-STORE-NBR           PIC 9(04)    VALUE ZERO.         02440099
020100     05  FILLER                  PIC X(07)    VALUE SPACES.       02450099
020200     05  RD1-ECOMMERCE-ORD-NBR   PIC X(40)    VALUE SPACES.       02460099
020300     05  FILLER                  PIC X(05)    VALUE SPACES.       02470099
020400     05  RD1-TRANSACTION-NBR     PIC X(04)    VALUE SPACES.       02480099
020500     05  FILLER                  PIC X(06)    VALUE SPACES.       02490099
020600     05  RD1-PROCESS-DATE        PIC X(10)    VALUE SPACES.       02500099
020700     05  FILLER                  PIC X(02)    VALUE SPACES.       02510099
020800     05  RD1-RGST-ID             PIC 9(04)    VALUE ZERO.         02520099
020900     05  FILLER                  PIC X(09)    VALUE SPACES.       02530099
021000     05  RD1-START-TIME          PIC X(08)    VALUE SPACES.       02540099
021100     05  FILLER                  PIC X(06)    VALUE SPACES.       02550099
021200     05  RD1-SLS-CORR-SEQ-NBR    PIC 9(04)    VALUE ZERO.         02560099
021300     05  FILLER                  PIC X(09)    VALUE SPACES.       02570099
021400     05  RD1-ZIP-CODE            PIC X(09)    VALUE SPACES.       02580099
021500                                                                  02590099
021600 EJECT                                                            02600099
021700*---------------------------------------------------------------* 02610099
021800*    ORACLE DECLARE SECTION                                       02620099
021900*---------------------------------------------------------------* 02630099
022000     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02640099
022100                                                                  02650099
022200 01  USERNAME                        PIC X(10)      VARYING.      02660099
022300 01  PASSWD                          PIC X(10)      VARYING.      02670099
022400 01  PC-ENT01-TYPE-CDE               PIC X(02)      VALUE '01'.   02680099
022500 01  PV-ORACLE-ID                    PIC X(01)      VALUE '/'.    02690099
022600 01  WS-HOST-VARIABLES.                                           02700099
022700     05  WS-STATE-CODE               PIC   X(02).                 02710099
022800     05  WS-ZIP-CODE                 PIC   X(05).                 02720099
022900                                                                  02730099
023000     EXEC SQL END DECLARE SECTION END-EXEC.                       02740099
023100                                                                  02750099
023200     EXEC SQL INCLUDE SQLCACOB      END-EXEC.                     02760099
023300                                                                  02770099
023400*                                                                 02780099
023500*                                                                 02790099
023600 EJECT                                                            02800099
023700*                                                                 02810099
023800****************************************************************  02820099
023900 PROCEDURE DIVISION.                                              02830099
024000****************************************************************  02840099
024100                                                                  02850099
024200****************************************************************  02860099
024300* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  02870099
024400* PROGRAM.                                                     *  02880099
024500****************************************************************  02890099
024600                                                                  02900099
024700 0000-PROGRAM-MAINLINE.                                           02910099
024800                                                                  02920099
024900     PERFORM 1000-INITIALIZATION.                                 02930099
025000                                                                  02940099
025001     PERFORM 2000-PROCESS-TAX-FILE                                02950099
025010        UNTIL PS-END-OF-TAX-FILE.                                 02960099
025020                                                                  02970099
025030     PERFORM 3000-END-ROUTINE.                                    02980099
025040                                                                  02990099
025100     GOBACK.                                                      03000099
025200                                                                  03010099
025300     EJECT                                                        03020099
025400*                                                                 03030099
025500****************************************************************  03040099
025600* 1000-INITIALIZATION OPENS ALL FILES, CONNECTS TO ORACLE      *  03050099
025700*      FORMATS THE PERIOD BEGIN AND END DATES                  *  03060099
025800*      OPENS THE CURSOR AND PERFORMS FIRST CURSOR FETCH        *  03070099
025900****************************************************************  03080099
026000 1000-INITIALIZATION.                                             03090099
026100                                                                  03100099
026200     PERFORM 8000-ORACLE-SETUP.                                   03110099
026300                                                                  03120099
026400     OPEN   INPUT  TAX-IN-FILE.                                   03130099
026500     OPEN   OUTPUT TAX-OUT-FILE.                                  03140099
026600     OPEN   OUTPUT TAX-ERROR-FILE.                                03150099
026700     OPEN   OUTPUT TAX-ERROR-REPORT.                              03160099
026800                                                                  03170099
026900     PERFORM 9000-FORMAT-HEADINGS.                                03180099
027000     PERFORM 9100-HEADER-ROUTINE-1.                               03190099
027100                                                                  03200099
027200     PERFORM 2200-READ-TAX-FILE.                                  03210099
027400                                                                  03220099
027500****************************************************************  03230099
027600* 2000-PROCESS-TAX-FILE                                        *  03240099
027700****************************************************************  03250099
027800 2000-PROCESS-TAX-FILE.                                           03260099
028000                                                                  03270099
028100     IF TX006-ZIP-CDE NOT = PV-SAVE-ZIP-CDE                       03280099
028110         SET PS-ZIP-CODE-ERROR-NO TO TRUE                         03290099
028200         IF TX006-ST-CDE = SPACES                                 03300099
028300             PERFORM 2100-READ-TADZIP-CURSOR                      03310099
028310         ELSE                                                     03320099
028320             MOVE TX006-ST-CDE TO WS-STATE-CODE                   03330099
028400         END-IF                                                   03340099
028500         MOVE TX006-ZIP-CDE TO PV-SAVE-ZIP-CDE                    03350099
028700     END-IF.                                                      03360099
C76279      IF  TX006-TRAN-IND-SFS                                      03370099
C70860             MOVE PV-STR-NBR-SFS-ECOMM TO TX006-STR-NBR           03380099
            END-IF.                                                     03390099
029200                                                                  03400099
029201     IF TX006-ZIP-CDE = SPACES                                    03410099
029202        SET PS-ZIP-CODE-ERROR    TO TRUE                          03420099
029203     END-IF.                                                      03430099
029204                                                                  03440099
029205     IF PS-ZIP-CODE-ERROR-NO                                      03450099
029206         MOVE WS-STATE-CODE TO TX006-ST-CDE                       03460099
029207         PERFORM 5000-WRITE-RECORD                                03470099
029208     ELSE                                                         03480099
029210         PERFORM 6000-PROCESS-ERROR                               03490099
029220     END-IF.                                                      03500099
029230                                                                  03510099
029700     PERFORM 2200-READ-TAX-FILE.                                  03520099
029800                                                                  03530099
029900******************************************************************03540099
030000* 2100-READ THE TADZIP CURSOR...                                  03550099
030100******************************************************************03560099
030200 2100-READ-TADZIP-CURSOR.                                         03570099
031800                                                                  03580099
031900     MOVE '2100-READ-TADZIP-CURSOR' TO PVP-ABEND-PARAGRAPH.       03590099
032000     MOVE TX006-ZIP-CDE TO WS-ZIP-CODE                            03600099
032100                                                                  03610099
032200     EXEC SQL                                                     03620099
032300       SELECT                                                     03630099
032400         TADZIP.ST_CDE                                            03640099
032500       INTO                                                       03650099
032600         :WS-STATE-CODE                                           03660099
032700       FROM                                                       03670099
032800        TADZIP                                                    03680099
032900       WHERE                                                      03690099
033000         TADZIP.ZIP_CDE = :WS-ZIP-CODE                            03700099
033100     END-EXEC.                                                    03710099
033200                                                                  03720099
033300     EVALUATE TRUE                                                03730099
033400         WHEN SQLCODE = ZERO                                      03740099
033600             CONTINUE                                             03750099
033800         WHEN SQLCODE = -1405                                     03760099
033900         WHEN SQLCODE = +1403                                     03770099
034000         WHEN SQLCODE = -1403                                     03780099
034100             DISPLAY 'ZIP CODE NOT FOUND: ' WS-ZIP-CODE           03790099
034110             SET PS-ZIP-CODE-ERROR TO TRUE                        03800099
034300         WHEN OTHER                                               03810099
034400             PERFORM Z999-SQL-ERROR                               03820099
034500     END-EVALUATE.                                                03830099
034501                                                                  03840099
034502******************************************************************03850099
034503* 2200-READ-TAX-FILE                                              03860099
034504******************************************************************03870099
034510 2200-READ-TAX-FILE.                                              03880099
034511                                                                  03890099
034520     MOVE SPACES TO TX006-TAX-AUDIT-RECORD                        03900099
034530                                                                  03910099
034540     READ TAX-IN-FILE                                             03920099
034550         INTO TX006-TAX-AUDIT-RECORD                              03930099
034560         AT END                                                   03940099
034570             SET PS-END-OF-TAX-FILE TO TRUE                       03950099
034580     END-READ.                                                    03960099
034590                                                                  03970099
034591     IF NOT PS-END-OF-TAX-FILE                                    03980099
034592         ADD  1    TO  PV-READ-CNT                                03990099
CHG859     END-IF.                                                      04000099
034600***************************************************************** 04010099
034700* 3000-END-ROUTINE                                              * 04020099
034800* CLOSE FILES                                                   * 04030099
034900***************************************************************** 04040099
035000                                                                  04050099
035100 3000-END-ROUTINE.                                                04060099
035200                                                                  04070099
035300     CLOSE TAX-IN-FILE.                                           04080099
035400     CLOSE TAX-OUT-FILE.                                          04090099
035500     CLOSE TAX-ERROR-FILE.                                        04100099
035600     CLOSE TAX-ERROR-REPORT.                                      04110099
035700                                                                  04120099
035710     MOVE PV-READ-CNT TO PV-DISPLAY-CNT.                          04130099
035800     DISPLAY 'RECORDS READ:          ' PV-DISPLAY-CNT.            04140099
035810     MOVE PV-OUT-CNT TO PV-DISPLAY-CNT.                           04150099
035900     DISPLAY 'RECORDS WRITTEN:       ' PV-DISPLAY-CNT.            04160099
035901     MOVE PV-ERROR-CNT TO PV-DISPLAY-CNT.                         04170099
035902     DISPLAY 'ERROR RECORDS WRITTEN: ' PV-DISPLAY-CNT.            04180099
036000                                                                  04190099
036200****************************************************************  04200099
036300* 5000-WRITE-RECORD                                               04210099
036400****************************************************************  04220099
036500 5000-WRITE-RECORD.                                               04230099
036600                                                                  04240099
036700     WRITE TX-TAX-OUT-FILE FROM TX006-TAX-AUDIT-RECORD            04250099
036800     ADD  1    TO  PV-OUT-CNT.                                    04260099
036900                                                                  04270099
037000****************************************************************  04280099
037100* 6000-PROCESS-ERROR                                              04290099
037200****************************************************************  04300099
037300 6000-PROCESS-ERROR.                                              04310099
037400                                                                  04320099
037500     WRITE TX-TAX-ERROR-FILE FROM TX006-TAX-AUDIT-RECORD.         04330099
037600     PERFORM 7000-WRITE-ERROR-REPORT.                             04340099
037700     ADD  1    TO  PV-ERROR-CNT.                                  04350099
037800                                                                  04360099
037900****************************************************************  04370099
038000* 7000-WRITE-ERROR-REPORT                                         04380099
038100****************************************************************  04390099
038200 7000-WRITE-ERROR-REPORT.                                         04400099
038300                                                                  04410099
038400     IF  PV-LINES       GREATER PC-MAX-LINES                      04420099
038500         PERFORM 9100-HEADER-ROUTINE-1                            04430099
038600     END-IF.                                                      04440099
038700                                                                  04450099
038800     MOVE TX006-ZIP-CDE                TO RD1-ZIP-CODE.           04460099
038900     MOVE TX006-STR-NBR                TO RD1-STORE-NBR.          04470099
039000     MOVE TX006-ECOMMERCE-ORDER-NUMBER TO RD1-ECOMMERCE-ORD-NBR.  04480099
039100     MOVE TX006-TRN-NBR                TO RD1-TRANSACTION-NBR.    04490099
039200     MOVE TX006-PROCESS-DTE            TO RD1-PROCESS-DATE.       04500099
039300     MOVE TX006-RGST-ID                TO RD1-RGST-ID.            04510099
039400     MOVE TX006-START-TIME             TO RD1-START-TIME.         04520099
039500     MOVE TX006-SLS-CORR-SEQ-NBR       TO RD1-SLS-CORR-SEQ-NBR.   04530099
039600                                                                  04540099
039700     WRITE TX-TAX-ERROR-REPORT FROM RD1-DETAIL-LINE               04550099
039800         AFTER ADVANCING 2 LINES.                                 04560099
039900     ADD  2                        TO  PV-LINES.                  04570099
040000                                                                  04580099
040100****************************************************************  04590099
040200* LOGON TO ORACLE                                                 04600099
040300****************************************************************  04610099
040400 8000-ORACLE-SETUP.                                               04620099
                                                                        04630099
CHG205     OPEN INPUT ORACLE-LOGON-FILE.                                04640099
CHG205                                                                  04650099
CHG205     PERFORM 8000-READ-ORACLE-LOGON.                              04660099
CHG205                                                                  04670099
CHG205     CLOSE ORACLE-LOGON-FILE.                                     04680099
CHG205                                                                  04690099
CHG205     IF ((PS-END-OF-LOGON-FILE)                                   04700099
CHG205             OR (CC-ORACLE-CONNECTION = SPACES))                  04710099
CHG205         DISPLAY '** ABEND **'                                    04720099
CHG205         DISPLAY PC-CURRENT-PROGRAM-NAME                          04730099
CHG205                   ' - ORACLE LOGON CONTROL CARD '                04740099
CHG205                   'NOT PROVIDED'                                 04750099
CHG205         SET PS-ORA-SRC-EMPTY TO TRUE                             04760099
CHG205         CALL 'ILBOABN0' USING WS-ABEND-CODE                      04770099
CHG205     END-IF.                                                      04780099
CHG205                                                                  04790099
CHG205     IF CC-AUTO-LOGON                                             04800099
CHG205         DISPLAY PC-CURRENT-PROGRAM-NAME                          04810099
CHG205                   ' - AUTO LOGON TO ORACLE'                      04820099
CHG205         EXEC SQL                                                 04830099
CHG205              CONNECT :USERNAME                                   04840099
CHG205         END-EXEC                                                 04850099
CHG205     ELSE                                                         04860099
CHG205         INITIALIZE PV-ORACLE-USERID-LEN                          04870099
CHG205                    PV-ORACLE-PASSWORD-LEN                        04880099
CHG205         INSPECT CC-ORACLE-USERID                                 04890099
CHG205             TALLYING PV-ORACLE-USERID-LEN                        04900099
CHG205          FOR CHARACTERS BEFORE INITIAL SPACE                     04910099
CHG205      INSPECT CC-ORACLE-PASSWORD                                  04920099
CHG205          TALLYING PV-ORACLE-PASSWORD-LEN                         04930099
CHG205          FOR CHARACTERS BEFORE INITIAL SPACE                     04940099
CHG205      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           04950099
CHG205                USERNAME-ARR                                      04960099
CHG205      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   04970099
CHG205      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       04980099
CHG205                PASSWD-ARR                                        04990099
CHG205      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   05000099
CHG205      DISPLAY PC-CURRENT-PROGRAM-NAME                             05010099
CHG205               ' - LOGON TO ORACLE AS USER '                      05020099
CHG205               USERNAME-ARR                                       05030099
CHG205      EXEC SQL                                                    05040099
CHG205        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   05050099
CHG205      END-EXEC                                                    05060099
CHG205      INITIALIZE CC-ORACLE-PASSWORD                               05070099
CHG205                 PASSWD                                           05080099
CHG205      END-IF.                                                     05090099
CHG205                                                                  05100099
CHG205     IF (SQLCODE NOT = 0)                                         05110099
CHG205         DISPLAY  PVP-ABEND-PARAGRAPH                             05120099
CHG205         DISPLAY PC-CURRENT-PROGRAM-NAME                          05130099
CHG205                  ' - ERROR LOGGING ON TO ORACLE'                 05140099
CHG205         PERFORM Z999-SQL-ERROR                                   05150099
CHG205     END-IF.                                                      05160099
                                                                        05170099
                                                                        05180099
      ***************************************************************** 05190099
      *  B120-READ-ORACLE-LOGON.                                      * 05200099
      * ==> PROCESSES:                                                * 05210099
      *   - READ ORCALE CONTROL CARD                                  * 05220099
      * ==> PERFORMED FROM:  B110-ORACLE-SETUP                        * 05230099
      ***************************************************************** 05240099
       8000-READ-ORACLE-LOGON.                                          05250099
                                                                        05260099
CHG205     READ ORACLE-LOGON-FILE                                       05270099
CHG205         INTO CC-ORACLE-CONNECTION                                05280099
CHG205         AT END                                                   05290099
CHG205             SET PS-END-OF-LOGON-FILE TO TRUE                     05300099
CHG205     END-READ.                                                    05310099
                                                                        05320099
041999****************************************************************  05330099
042100*Z999-SQL-ERROR.                                                 *05340099
042200******************************************************************05350099
042300 Z999-SQL-ERROR.                                                  05360099
042400                                                                  05370099
042500     DISPLAY '** ABEND **       ** = SQLERROR'.                   05380099
042600     DISPLAY '** PROGRAM        ** = TXKUT006'.                   05390099
042700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05400099
042800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05410099
042900     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                05420099
043000                                                                  05430099
043100                                                                  05440099
043200     MOVE SPACES TO WS-MSG-TEXT.                                  05450099
043300                                                                  05460099
043400     CALL 'SQLGLM' USING WS-MSG-TEXT,                             05470099
043500                         WS-MAX-SIZE,                             05480099
043600                         WS-MSG-LENGTH.                           05490099
043700     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               05500099
043800                                                                  05510099
043900     MOVE +4013 TO WS-ABEND-CODE.                                 05520099
044000     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         05530099
044100                                                                  05540099
044200******************************************************************05550099
044300* 9000-FORMAT-HEADINGS                                            05560099
044400*     GET CURRENT DATE AND TIME FROM SYSTEM.                      05570099
044500*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          05580099
044600******************************************************************05590099
044700 9000-FORMAT-HEADINGS.                                            05600099
044800                                                                  05610099
044900     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   05620099
045000     ACCEPT PV-CURR-TIME FROM TIME.                               05630099
045100                                                                  05640099
045200     MOVE PV-CURR-DATE-MM             TO DP132O-RUN-MONTH.        05650099
045300     MOVE PV-CURR-DATE-DD             TO DP132O-RUN-DAY.          05660099
045400     MOVE PV-CURR-DATE-CCYY           TO DP132O-RUN-YEAR.         05670099
045500                                                                  05680099
045600     MOVE PV-CURR-TIME-HH             TO DP132O-RUN-HOUR.         05690099
045700     MOVE PV-CURR-TIME-MM             TO DP132O-RUN-MINUTE.       05700099
045800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.     05710099
045900     MOVE '1'                         TO DP132O-REPORT-NUMBER.    05720099
046000                                                                  05730099
046100******************************************************************05740099
046200* 9100-HEADER-ROUTINE-1                                           05750099
046300*     PRINT THE HEADINGS FOR THE SUMMARY REPORT.                  05760099
046400******************************************************************05770099
046500                                                                  05780099
046600 9100-HEADER-ROUTINE-1.                                           05790099
046700                                                                  05800099
046800     ADD +1                      TO PV-PAGE-CNT.                  05810099
046900     MOVE PV-PAGE-CNT            TO DP132O-PAGE-NUMBER.           05820099
047000     MOVE DP132O-STANDRD-HEADER-132-COLS                          05830099
047100                                 TO PV-PRINT-RECORD.              05840099
047200     PERFORM 9500-WRITE-RPT-TOP-OF-PAGE.                          05850099
047300                                                                  05860099
047400     ADD +1                      TO PV-LINE-SPACING.              05870099
047500     WRITE TX-TAX-ERROR-REPORT     FROM RH-HEADER1                05880099
047600        AFTER ADVANCING 1 LINES.                                  05890099
047700     ADD +1                      TO PV-LINE-SPACING.              05900099
047800     WRITE TX-TAX-ERROR-REPORT     FROM RH-HEADER2                05910099
047900        AFTER ADVANCING 1 LINES.                                  05920099
048000                                                                  05930099
048100     ADD +1                      TO PV-LINE-SPACING.              05940099
048200     WRITE TX-TAX-ERROR-REPORT     FROM RH-HEADER3                05950099
048300        AFTER ADVANCING 1 LINES.                                  05960099
C76279                                                                  05970099
C76279     MOVE 7                      TO PV-LINES.                     05980099
048400                                                                  05990099
048500 EJECT                                                            06000099
048600******************************************************************06010099
048700* 9500-WRITE-RPT-TOP-OF-PAGE                                      06020099
048800*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   06030099
048900******************************************************************06040099
049000 9500-WRITE-RPT-TOP-OF-PAGE.                                      06050099
049100                                                                  06060099
049200     WRITE TX-TAX-ERROR-REPORT                                    06070099
049300       FROM PV-PRINT-RECORD                                       06080099
049400         AFTER ADVANCING PAGE                                     06090099
049500     MOVE +1 TO PV-LINE-SPACING.                                  06100099
049600 EJECT                                                            06110099
049700*                                                                 06120099
049800******************************************************************06130099
049900***                    END  OF  PROGRAM                        ***06140099
050000******************************************************************06150099
