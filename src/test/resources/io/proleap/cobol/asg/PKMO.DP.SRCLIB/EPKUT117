000100 IDENTIFICATION DIVISION.                                         00010004
000200 PROGRAM-ID.      EPKUT117.                                       00020004
000300 AUTHOR.          BOB KOLESAR (SAFENET CONSULTING).               00030004
000400 DATE-WRITTEN.    MARCH, 2003.                                    00040004
000500                                                                  00050004
000600*-----------------------------------------------------------      00060004
000700*            ADHOC STORE CORRECTION IDENTIFIER                    00070004
000800*-----------------------------------------------------------      00080004
000900*-----------------------------------------------------------      00090004
001000* HISTORY LOG:                                                    00100004
001100*-----------------------------------------------------------      00110004
001200* DATE: 03/08/2004                                                00120026
001300* WR/IR#: IR#638509                                               00130026
001400* PROGRAMMER: SCOTT BARTELT                                       00140026
001500* DESCRIPTION: THE PROMO SYSTEM DOES NOT VALIDATE OPEN/CLOSE      00150026
001501*              DATES OF A STORE WHEN ADHOC PROMOTIONS ARE         00150126
001502*              SET UP, OR WHEN NEW STORES ARE ENTERED IN THE      00150226
001503*              RMS SYSTEM.  THIS CAUSES THE FILE DISTRIBUTION     00150326
001504*              PROCESS A PROBLEM BECAUSE WHEN THIS PROGRAM        00150426
001505*              IDENTIFIES A CHANGE IN THE ADHOC STORE TABLE       00150526
001506*              SUCH AS A NEW STORE IT CREATES PROMO/PMAP          00150626
001507*              RECORDS FOR THIS STORE.  THESE THEN GET SENT       00150726
001508*              TO THE MID TIER, BUT THE STORES ARE NOT IN THE     00150826
001509*              STORE GROUP LIST BECAUSE THEY ARE NOT CURRENTLY    00150926
001510*              OPEN.                                              00151026
001511*                                                                 00151126
001512* DATE:                                                           00151226
001513* WR/IR#:                                                         00151326
001514* PROGRAMMER:                                                     00151426
001515* DESCRIPTION:                                                    00151526
001520*-----------------------------------------------------------      00152026
001600                                                                  00160004
001700*----------------------------------------------------------       00170004
001800 ENVIRONMENT DIVISION.                                            00180004
001900*----------------------------------------------------------       00190004
002000 CONFIGURATION SECTION.                                           00200004
002100 SOURCE-COMPUTER.        IBM-3090.                                00210004
002200 OBJECT-COMPUTER.        IBM-3090.                                00220004
002210                                                                  00221004
002220 INPUT-OUTPUT SECTION.                                            00222004
002230                                                                  00223004
002240 FILE-CONTROL.                                                    00224004
002250                                                                  00225004
002251     SELECT CONTROL-CARD-PGM-LAST-RUN-DTE                         00225104
002252       ASSIGN TO INP01.                                           00225204
002253     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00225304
002254       ASSIGN TO INP02.                                           00225404
002255     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00225504
002256       ASSIGN TO INP03.                                           00225604
002257     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00225704
002258       ASSIGN TO INP04.                                           00225804
002259     SELECT CONTROL-CARD-FUT-STR-OPN-DAY                          00225926
002260       ASSIGN TO INP05.                                           00226026
002261     SELECT PROMO-NIGHT-FILE                                      00226104
002262       ASSIGN TO OUT01.                                           00226204
002263     SELECT PROMO-EMERGENCY-FILE                                  00226304
002264       ASSIGN TO OUT02.                                           00226404
002265                                                                  00226504
002266 DATA DIVISION.                                                   00226604
002267 FILE SECTION.                                                    00226704
002268                                                                  00226804
002269 FD  CONTROL-CARD-PGM-LAST-RUN-DTE                                00226904
002270     RECORDING MODE F                                             00227004
002271     BLOCK CONTAINS 0 RECORDS                                     00227104
002272     LABEL RECORDS ARE OMITTED                                    00227204
002273     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00227304
002274 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00227404
002275                                                                  00227504
002276 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00227604
002277     RECORDING MODE F                                             00227704
002278     BLOCK CONTAINS 0 RECORDS                                     00227804
002279     LABEL RECORDS ARE OMITTED                                    00227904
002280     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00228004
002281 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00228104
002282                                                                  00228204
002290 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00229004
002300     RECORDING MODE F                                             00230004
002400     BLOCK CONTAINS 0 RECORDS                                     00240004
002500     LABEL RECORDS ARE OMITTED                                    00250004
002600     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                00260004
002700 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   00270004
002800                                                                  00280004
002900 FD  CONTROL-CARD-CRIT-EFF-DTE                                    00290004
003000     RECORDING MODE F                                             00300004
003010     BLOCK CONTAINS 0 RECORDS                                     00301004
003020     LABEL RECORDS ARE OMITTED                                    00302004
003030     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  00303004
003040 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   00304004
003050                                                                  00305004
003051 FD  CONTROL-CARD-FUT-STR-OPN-DAY                                 00305126
003052     RECORDING MODE F                                             00305226
003053     BLOCK CONTAINS 0 RECORDS                                     00305326
003054     LABEL RECORDS ARE OMITTED                                    00305426
003055     DATA RECORD IS CNTRL-CARD-FUT-STR-OPN-DAY-REC.               00305526
003056 01  CNTRL-CARD-FUT-STR-OPN-DAY-REC                PIC  X(080).   00305626
003057                                                                  00305726
003060 FD  PROMO-NIGHT-FILE                                             00306004
003070     RECORDING MODE F                                             00307004
003080     BLOCK CONTAINS 0 RECORDS                                     00308004
003090     LABEL RECORDS ARE OMITTED                                    00309004
003100     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        00310004
003101 01  PROMO-NIGHT-RECORD                            PIC  X(200).   00310104
003102                                                                  00310204
003103 FD  PROMO-EMERGENCY-FILE                                         00310304
003104     RECORDING MODE F                                             00310404
003105     BLOCK CONTAINS 0 RECORDS                                     00310504
003106     LABEL RECORDS ARE OMITTED                                    00310604
003107     DATA RECORD IS PROMO-EMERG-ID-RECORD.                        00310725
003108 01  PROMO-EMERGENCY-RECORD                        PIC  X(200).   00310826
003109                                                                  00310926
003110 WORKING-STORAGE SECTION.                                         00311026
003120*-----------------------------------------------------------      00312026
003130* PS - PROGRAM SWITCHES                                           00313026
003140*-----------------------------------------------------------      00314026
003150 01  PS-PROGRAM-SWITCHES.                                         00315026
003160     05  PS-STORE-OVRRDE-CSR-EOF-SW                PIC  X(001).   00316026
003170       88  PS-STORE-OVRRDE-CSR-EOF                   VALUE 'Y'.   00317026
003180       88  PS-STORE-OVRRDE-CSR-NOT-EOF               VALUE 'N'.   00318026
003190     05  PS-ADHOC-STORE-CSR-EOF-SW                 PIC  X(001).   00319026
003200       88  PS-ADHOC-STORE-CSR-EOF                    VALUE 'Y'.   00320026
003300       88  PS-ADHOC-STORE-CSR-NOT-EOF                VALUE 'N'.   00330026
003400     05  PS-REC-FOUND-SW                           PIC  X(001).   00340026
003500       88  PS-REC-FOUND                              VALUE 'Y'.   00350026
003600       88  PS-NO-REC-FOUND                           VALUE 'N'.   00360026
003700     05  PS-WRITE-PROMO-SW                         PIC  X(001).   00370026
003800       88  PS-WRITE-PROMO                            VALUE 'Y'.   00380026
003900       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   00390026
004000     05  PS-FILE-STATUS                            PIC  X(002).   00400026
004100       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  00410026
004200       88  PS-END-OF-FILE                            VALUE '10'.  00420026
004300       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  00430026
004400     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   00440026
004500       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   00450026
004600       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   00460026
004700                                                                  00470026
004800*-----------------------------------------------------------      00480026
004900* PROGRAM CONSTANTS                                               00490026
005000*-----------------------------------------------------------      00500026
005100 01  PC-PROGRAM-CONSTANTS.                                        00510026
005200     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    00520026
005300       VALUE 'EPKUT117'.                                          00530026
005400     05  PC-PRICG-BUS-EVENT                        PIC  X(003)    00540026
005500       VALUE '090'.                                               00550026
005510     05  PC-ADHOC-STR-BUS-EVENT                    PIC  X(003)    00551026
005520       VALUE '050'.                                               00552026
005530     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    00553026
005540       VALUE 'R'.                                                 00554026
005550     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    00555026
005560       VALUE 'A'.                                                 00556026
005570     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    00557026
005580       VALUE '99999'.                                             00558026
005590     05  PC-ADHOC-STR-SPEC-CDE                     PIC  X(004)    00559026
005600       VALUE '5000'.                                              00560026
005700     05  PC-FILE-ACT-TYPE                          PIC  X(003)    00570026
005800       VALUE 'CHG'.                                               00580026
005900     05  PC-APPLY-NIGHTLY                          PIC  X(001)    00590026
006000       VALUE 'N'.                                                 00600026
006010     05  PC-APPLY-CORRECTION                       PIC  X(001)    00601026
006020       VALUE 'C'.                                                 00602026
006030     05  PC-PROMO-STAT-CDE                         PIC  X(001).   00603026
006040       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   00604026
006050       88  PC-DELETE-STATUS                          VALUE 'D'.   00605026
006060       88  PC-CANCEL-STATUS                          VALUE 'C'.   00606026
006070     05  PC-ADD-STAT-CDE                           PIC  X(001)    00607026
006080       VALUE 'A'.                                                 00608026
006090     05  PC-DELETE-STAT-CDE                        PIC  X(001)    00609026
006091       VALUE 'D'.                                                 00609126
006092     05  PC-MDSE-INCL-BOTH-IND                     PIC  X(001)    00609226
006093       VALUE 'B'.                                                 00609326
006094     05  PC-MDSE-INCL-IND                          PIC  X(001)    00609426
006095       VALUE 'I'.                                                 00609526
006096                                                                  00609626
006097*-----------------------------------------------------------      00609726
006098* PV- PROGRAM VARIABLES                                           00609826
006099*-----------------------------------------------------------      00609926
006100 01  PV-PROGRAM-VARAIBLES.                                        00610026
006101     05  PV-SQL-SUB                                PIC S9(004)    00610126
006102                                                     VALUE +0     00610226
006103                                                     COMP.        00610326
006104     05  PV-CURRENT-SYSTEM-TMST                    PIC  X(026)    00610426
006105                                                     VALUE SPACES.00610526
006106     05  PV-ACTL-STRT-TMST.                                       00610626
006107       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    00610726
006108                                                     VALUE SPACES.00610826
006109       10  FILLER                                  PIC  X(016)    00610926
006110                                                     VALUE SPACES.00611026
006120     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    00612026
006130                                                     VALUE SPACES.00613026
006140     05  PV-EFF-STRT-TMST                          PIC  X(026)    00614026
006150                                                     VALUE SPACES.00615026
006160     05  PV-EFF-END-TMST                           PIC  X(026)    00616026
006170                                                     VALUE SPACES.00617026
006180     05  PV-EFF-END-NULL                           PIC S9(004)    00618026
006190                                                     VALUE ZEROS  00619026
006200                                                     COMP.        00620026
006300     05  PV-ABEND-CODE                             PIC  9999      00630026
006400                                                     VALUE ZEROS  00640026
006500                                                     COMP.        00650026
006600     05  PV-FUL-FILE-STR                           PIC  9(005)    00660026
006700                                                     VALUE ZEROS. 00670026
006800     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    00680026
007400                                                     VALUE SPACES.00740004
007500     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    00750004
007600                                                     VALUE SPACES.00760004
007610     05  EP045-CC-ADV-STR-OPN-DATE                 PIC  X(010)    00761027
007620                                                     VALUE SPACES.00762027
007700                                                                  00770004
007800*----------------------------------------------------------       00780004
007900* EPRD045 CONTROL CARD LAYOUT.                                    00790027
008000*----------------------------------------------------------       00800004
008100     COPY EPRD045.                                                00810027
008200                                                                  00820004
008210*----------------------------------------------------------       00821027
008220* FULL FILE EXTRACT OUTPUT FILE.                                  00822027
008230*----------------------------------------------------------       00823027
008240     COPY EPRD072.                                                00824027
008250                                                                  00825027
008300*----------------------------------------------------------       00830004
008400* EPCC111 CONTROL CARD LAYOUT                                     00840004
008500*----------------------------------------------------------       00850004
008600     COPY EPRD111.                                                00860004
008700                                                                  00870004
008800*----------------------------------------------------------       00880004
008900* EPCC113 CONTROL CARD LAYOUT                                     00890004
009000*----------------------------------------------------------       00900004
009100     COPY EPRD113.                                                00910004
009200                                                                  00920004
009300*----------------------------------------------------------       00930004
009400* EPCC123 CONTROL CARD LAYOUT                                     00940005
009500*----------------------------------------------------------       00950004
009600     COPY EPRD123.                                                00960005
009700                                                                  00970004
009800*----------------------------------------------------------       00980004
009900* EPCC128 CONTROL CARD LAYOUT                                     00990004
010000*----------------------------------------------------------       01000004
010100     COPY EPRD128.                                                01010004
010200                                                                  01020004
010300*----------------------------------------------------------       01030004
010400* DATE ROUTINE COPY MEMBERS                                       01040004
010500*----------------------------------------------------------       01050004
010600     COPY DPWS500.                                                01060004
010700                                                                  01070004
010800*-----------------------------------------------------------      01080004
010810* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01081004
010820*-----------------------------------------------------------      01082004
010830     COPY DPWS004.                                                01083004
010840                                                                  01084004
010850*-----------------------------------------------------------      01085004
010860* DB2 ABEND COPYBOOK                                              01086004
010870*-----------------------------------------------------------      01087004
010880     COPY DPWS900.                                                01088004
010890                                                                  01089004
010900*-----------------------------------------------------------      01090004
011000* DB2 MESSAGE AREA                                                01100004
011100*-----------------------------------------------------------      01110004
011200     COPY SQLCA2.                                                 01120004
011300                                                                  01130004
011400*-----------------------------------------------------------      01140004
011500* PROGRAM COUNTERS                                                01150004
011600*-----------------------------------------------------------      01160004
011700 01  PC-PROGRAM-COUNTERS.                                         01170004
011800     05  PC-CNT-READ-RECS                          PIC  9(009)    01180004
011900                                                     VALUE 0.     01190004
012000     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    01200004
012100                                                     VALUE 0.     01210004
012200     05  PC-CNT-EMERG-RECS                         PIC  9(009)    01220004
012300                                                     VALUE 0.     01230004
012400     05  PC-CNT-PROMO-RECS                         PIC  9(009)    01240004
012500                                                     VALUE 0.     01250004
012600     05  PC-CNT-OVRRDE-RECS                        PIC  9(009)    01260008
012700                                                     VALUE 0.     01270004
012800     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    01280004
012900                                                     VALUE 0.     01290004
013000     05  PC-CNT-DEVT-RECS                          PIC  9(009)    01300004
013100                                                     VALUE 0.     01310004
013200     05  PC-CNT-PMAP-RECS                          PIC  9(009)    01320004
013210                                                     VALUE 0.     01321004
013220     05  PC-CNT-ERROR-RECS                         PIC  9(009)    01322004
013230                                                     VALUE 0.     01323004
013240     05  PC-CNT-ALL-RECS                           PIC  9(009)    01324004
013250                                                     VALUE 0.     01325004
013260     05  PC-CNT-SPACES                             PIC  9(009)    01326004
013270                                                     VALUE 0.     01327004
013280     05  PC-CNT-POS                                PIC  9(009)    01328004
013290                                                     VALUE 0.     01329004
013300     05  PC-MAX-RETRIES                            PIC S9(004)    01330004
013301                                                     VALUE +5     01330104
013302                                                     COMP.        01330204
013303                                                                  01330304
013304*-----------------------------------------------------------      01330404
013305* ERROR HANDLING                                                  01330504
013306*-----------------------------------------------------------      01330604
013307 01  PV-MISC-ABEND-FIELDS.                                        01330704
013308     05  PV-PARAGRAPH-NAME                         PIC  X(030)    01330804
013309                                                     VALUE SPACE. 01330904
013310     05  PV-OPERATION-MSG-1                        PIC  X(040)    01331004
013320                                                     VALUE SPACE. 01332004
013330     05  PV-OPERATION-MSG-2                        PIC  X(040)    01333004
013340                                                     VALUE SPACE. 01334004
013350     05  PV-DB2-OPERATION                          PIC  X(030)    01335004
013360                                                     VALUE SPACE. 01336004
013370 01  ABEND-CODE                                    PIC S9(004)    01337004
013380                                                     VALUE ZEROS  01338004
013390                                                     COMP         01339004
013400                                                     SYNC.        01340004
013500   88  ABEND-4003-CTRL-CARD-ERROR                    VALUE +4003. 01350004
013600   88  ABEND-4013-DB2-ERROR                          VALUE +4013. 01360004
013700   88  ABEND-4019-CAL-SUB-ERROR                      VALUE +4019. 01370004
013800   88  ABEND-4020-MQ-ERROR                           VALUE +4020. 01380004
013900   88  ABEND-4444-FORCED-ABEND                       VALUE +4444. 01390004
014000   88  ABEND-4008                                    VALUE +4008. 01400004
014100                                                                  01410004
014200                                                                  01420004
014300*-----------------------------------------------------------      01430004
014400* DB2 COMMUNICATIONS AREA                                         01440004
014500*-----------------------------------------------------------      01450004
014600     EXEC SQL                                                     01460004
014700       INCLUDE SQLCA                                              01470004
014800     END-EXEC.                                                    01480004
014900                                                                  01490004
014911*-----------------------------------------------------------      01491127
014920* DB2 TABLE XST00001(XST_LOC) - LOCATION TABLE                    01492027
014921*-----------------------------------------------------------      01492127
014940     EXEC SQL                                                     01494027
014950       INCLUDE XST00001                                           01495027
014960     END-EXEC.                                                    01496027
014970                                                                  01497027
015000*-----------------------------------------------------------      01500004
015100* DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP              01510005
015110*                                        MEMBERSHIP TABLE         01511005
015200*-----------------------------------------------------------      01520004
015300     EXEC SQL                                                     01530004
015400       INCLUDE XST00023                                           01540005
015500     END-EXEC.                                                    01550004
015600                                                                  01560004
015700*-----------------------------------------------------------      01570004
015800* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       01580004
015900*-----------------------------------------------------------      01590004
016000     EXEC SQL                                                     01600004
016100       INCLUDE XST00028                                           01610004
016200     END-EXEC.                                                    01620004
016300                                                                  01630004
016400*-----------------------------------------------------------      01640004
016500* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       01650004
016600*                                               TABLE             01660004
016700*-----------------------------------------------------------      01670004
016800     EXEC SQL                                                     01680004
016900       INCLUDE XST00029                                           01690004
017000     END-EXEC.                                                    01700004
017100                                                                  01710004
017200*-----------------------------------------------------------      01720004
017300* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           01730004
017400*-----------------------------------------------------------      01740004
017500     EXEC SQL                                                     01750004
017600       INCLUDE XST00031                                           01760004
017700     END-EXEC.                                                    01770004
017800                                                                  01780004
017810*-----------------------------------------------------------      01781005
017820* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) ADHOC RELATION           01782005
017830*-----------------------------------------------------------      01783005
017840     EXEC SQL                                                     01784005
017850       INCLUDE XST00033                                           01785005
017860     END-EXEC.                                                    01786005
017870                                                                  01787005
021600*-----------------------------------------------------------      02160004
021700* ADHOC STORE CHANGE CURSOR.                                      02170008
021710*-----------------------------------------------------------      02171004
021720     EXEC SQL                                                     02172004
021730       DECLARE ADHOC-STORE CURSOR FOR                             02173006
021740         SELECT ADHCS.STAT_CDE                                    02174006
021750               ,ADHCS.LAST_UPD_TMST                               02175006
021760               ,ADHCS.SOR_LAST_UPD_TMST                           02176006
021770               ,ADHOC.PROMO_INTFC_ID                              02177004
021780               ,ADHOC.MDSE_LNE_ID                                 02178004
021790               ,ADHOC.ADHC_STR_GP_ID                              02179004
021800               ,ADHOC.STR_SELN_HIER_CDE                           02180004
021801               ,ADHOC.ACTL_STRT_TMST                              02180104
021802               ,ADHOC.ACTL_END_TMST                               02180204
021803               ,STRMB.STR_GP_ID                                   02180308
021804               ,MDSSEL.PRICG_TYP_CDE                              02180404
021805         FROM XST_PROMO_ADHC_STR ADHCS                            02180506
021806             ,XST_PROMO_ADHC_RLT ADHOC                            02180606
021807             ,XST_MDSE_LNE_SELN  MDSSEL                           02180706
021808             ,XST_STR_GP_MBSHP   STRMB                            02180806
021809             ,XST_LOC            LOC                              02180927
021810         WHERE ADHOC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       02181006
021811           AND ADHOC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          02181106
021812           AND ADHOC.ADHC_STR_GP_ID = ADHCS.ADHC_STR_GP_ID        02181206
021813           AND STRMB.STR_NBR        = ADHCS.STR_NBR               02181306
021814           AND STRMB.STR_GP_TYP_CDE = 5000                        02181406
021815           AND STRMB.STR_NBR        = LOC.LOC_NBR                 02181527
021816           AND ADHOC.STAT_CDE IN ('S')                            02181606
021817           AND MDSSEL.STAT_CDE IN ('S')                           02181706
021830           AND (ADHCS.LAST_UPD_TMST                               02183006
021840               BETWEEN :EP123-CC-ADHOC-CUTOFF-TMST                02184006
021850                   AND :PV-CURRENT-SYSTEM-TMST)                   02185006
021851           AND (LOC.OPN_DTE  <= :EP045-CC-ADV-STR-OPN-DATE)       02185127
021853           AND ((LOC.CLO_DTE >= :EP111-CC-CRNT-DTE)               02185327
021854                 OR (LOC.CLO_DTE IS NULL))                        02185428
021855           AND ((DATE(ADHOC.ACTL_STRT_TMST)                       02185527
021856               BETWEEN DATE(ADHCS.EFF_STRT_TMST)                  02185627
021857                   AND DATE(ADHCS.EFF_END_TMST))                  02185727
021858           OR  (DATE(ADHOC.ACTL_STRT_TMST) >=                     02185827
021859               DATE(ADHCS.EFF_STRT_TMST)                          02185927
021860           AND DATE(ADHCS.EFF_END_TMST)IS NULL))                  02186027
021861           AND ((:EP111-CC-CRNT-DTE                               02186106
021870               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 02187006
021871                   AND DATE(ADHOC.ACTL_END_TMST))                 02187106
021872           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        02187206
021873               BETWEEN :EP111-CC-DATE-PLUS1                       02187306
021874                   AND :EP113-CC-CRNT-DTE-MINUS1))                02187406
021875         ORDER BY ADHOC.PROMO_INTFC_ID, ADHOC.MDSE_LNE_ID,        02187510
021876                  ADHOC.ADHC_STR_GP_ID                            02187606
021877         FOR FETCH ONLY                                           02187706
021878         WITH UR                                                  02187806
021879     END-EXEC.                                                    02187904
021880                                                                  02188004
021881*-----------------------------------------------------------      02188107
021882* STORE OVERRIDE CURSOR. (RMS STORES)                             02188207
021883*-----------------------------------------------------------      02188307
021884     EXEC SQL                                                     02188407
021885       DECLARE STORE-OVRRDE CURSOR FOR                            02188507
021886         SELECT STRGP.PROMO_INTFC_ID                              02188607
021887               ,STRGP.MDSE_LNE_ID                                 02188707
021888               ,STRGP.STR_GP_TYP_CDE                              02188807
021889               ,STRGP.STR_GP_ID                                   02188907
021890               ,STRGP.STR_SELN_HIER_CDE                           02189007
021891               ,STRGP.STAT_CDE                                    02189107
021892               ,STRGP.ACTL_STRT_TMST                              02189207
021893               ,STRGP.ACTL_END_TMST                               02189307
021894               ,STRGP.LAST_UPD_TMST                               02189407
021895               ,STRGP.SOR_LAST_UPD_TMST                           02189507
021896               ,MDSSEL.PRICG_TYP_CDE                              02189607
021897         FROM XST_PROMO_STR_GP   STRGP                            02189707
021898             ,XST_MDSE_LNE_SELN  MDSSEL                           02189807
021899         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       02189907
021900           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          02190007
021901           AND STRGP.PROMO_INTFC_ID  = :XST00031-PROMO-INTFC-ID   02190113
021902           AND STRGP.MDSE_LNE_ID     = :XST00031-MDSE-LNE-ID      02190213
021903           AND STRGP.STR_GP_TYP_CDE  = 5000                       02190322
021904           AND STRGP.STR_GP_ID = :XST00023-STR-GP-ID              02190423
021905           AND (STRGP.STR_SELN_HIER_CDE                           02190512
021906                                   > :XST00031-STR-SELN-HIER-CDE) 02190612
021907           AND STRGP.STAT_CDE IN ('S')                            02190714
021908           AND MDSSEL.STAT_CDE IN ('S')                           02190821
021909           AND STRGP.PRNT_GP_TYP_CDE = ('A')                      02190912
021910           AND STRGP.PRNT_ADHC_GP_ID = :XST00031-ADHC-STR-GP-ID   02191012
021911           AND ((:EP111-CC-CRNT-DTE                               02191112
021912               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 02191212
021913                   AND DATE(STRGP.ACTL_END_TMST))                 02191312
021914           OR  (DATE(STRGP.ACTL_STRT_TMST)                        02191412
021915               BETWEEN :EP111-CC-DATE-PLUS1                       02191512
021916                   AND :EP113-CC-CRNT-DTE-MINUS1))                02191612
021917         FOR FETCH ONLY                                           02191712
021918         WITH UR                                                  02191812
021919     END-EXEC.                                                    02191912
021920                                                                  02192012
021921 LINKAGE SECTION.                                                 02192112
021922                                                                  02192212
021923*----------------------------------------------------------       02192312
021924 PROCEDURE DIVISION.                                              02192412
021925*----------------------------------------------------------       02192512
021926 0000-MAINLINE.                                                   02192612
021927                                                                  02192712
021928     PERFORM 1000-INITIALIZATION.                                 02192812
021929                                                                  02192912
021930     PERFORM 2000-PROCESS-ADHOC-STORES.                           02193012
021931                                                                  02193112
021932     PERFORM 9999-WRAPUP.                                         02193212
021933                                                                  02193312
021934     GOBACK.                                                      02193412
021935                                                                  02193512
021936*0000-EXIT.                                                       02193612
021940 EJECT.                                                           02194004
021950                                                                  02195004
021960*----------------------------------------------------------       02196004
021970* 1000-INITIALIZATION.                                            02197004
021980*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02198004
021981*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      02198104
021982*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             02198204
021983*     INTERFACE ID FILE.                                          02198304
021984*----------------------------------------------------------       02198404
021985 1000-INITIALIZATION.                                             02198504
021986                                                                  02198604
021987     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      02198704
021988                 CONTROL-CARD-FUTRE-CORR-DTE                      02198804
021989                 CONTROL-CARD-PGM-LAST-RUN-DTE                    02198904
021990                 CONTROL-CARD-CRIT-EFF-DTE                        02199026
021991                 CONTROL-CARD-FUT-STR-OPN-DAY.                    02199126
021992     OPEN OUTPUT PROMO-NIGHT-FILE                                 02199204
021993                 PROMO-EMERGENCY-FILE.                            02199304
021994                                                                  02199404
021995     INITIALIZE EP072-PROMO-INTFC-RECORD.                         02199504
021996                                                                  02199604
021997     PERFORM 1010-GET-CURRENT-SYSTEM-TMST.                        02199704
021998     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         02199804
021999     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       02199904
022000     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       02200004
022010     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         02201004
022020     PERFORM 1060-READ-FUT-STR-OPN-DAY-CARD.                      02202027
022100     PERFORM 6100-DATE-ROUTINE.                                   02210004
022200                                                                  02220004
022300*1000-EXIT.                                                       02230004
022400 EJECT.                                                           02240004
022500                                                                  02250004
022600*----------------------------------------------------------       02260004
022700* 1010-GET-CURRENT-SYSTEM-TMST.                                   02270004
022800*     RETREIVE THE CURRENT SYSTEM TIMESTAMP. THIS WILL BE         02280004
022900*     USED WITHIN THE QUERIES TO IDENTIFY WHICH PROMO CHANGES     02290004
023000*     NEED TO BE INCLUDED. TMST ALSO WILL BE USED TO UPDATE       02300004
023100*     EPCC123 ON PROGRAM EXIT.                                    02310005
023200*----------------------------------------------------------       02320004
023300 1010-GET-CURRENT-SYSTEM-TMST.                                    02330004
023400                                                                  02340004
023500     EXEC SQL                                                     02350004
023600       SET :PV-CURRENT-SYSTEM-TMST = CURRENT TIMESTAMP            02360004
023700     END-EXEC.                                                    02370004
023800                                                                  02380004
023900     IF SQLCODE NOT EQUAL ZERO                                    02390004
024000       MOVE 'GET CURRENT TIMESTAMP' TO PV-DB2-OPERATION           02400004
024100       MOVE '1010-GET-CURRENT-SYSTEM-TMST'                        02410004
024200                                     TO PV-PARAGRAPH-NAME         02420004
024300       PERFORM 9900-SQL-ABEND-ROUTINE                             02430004
024400     END-IF.                                                      02440004
024500                                                                  02450011
024600*1010-EXIT.                                                       02460004
024700 EJECT.                                                           02470004
024800                                                                  02480004
024900*----------------------------------------------------------       02490004
025000* 1020-READ-PGM-LAST-RUN-CARD.                                    02500004
025100*     READ CONTROL CARD EPCC123. THIS CONTROL CARD CONTAINS       02510005
025200*     THE TIMESTAMP FROM THE LAST RUN OF EPKUT117                 02520004
025300*----------------------------------------------------------       02530004
025400 1020-READ-PGM-LAST-RUN-CARD.                                     02540004
025500                                                                  02550004
025600     READ CONTROL-CARD-PGM-LAST-RUN-DTE                           02560004
025700                                    INTO EP123-CC-CONTROL-CARD    02570004
025800       AT END                                                     02580004
025900          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02590004
026000                                                                  02600004
026100     IF PS-END-OF-CNTL-CRD-FILE                                   02610004
026200       DISPLAY ' '                                                02620004
026300       DISPLAY '** ABEND     **'                                  02630004
026400       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02640004
026500       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   02650004
026600       DISPLAY '** CONTROL FILE IS EMPTY  '                       02660004
026700       DISPLAY ' '                                                02670004
026800       MOVE +4002 TO ABEND-CODE                                   02680004
026900       CALL 'ILBOABN0' USING ABEND-CODE                           02690004
027000     ELSE                                                         02700004
027100       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             02710004
027200       DISPLAY '** EPCC123     **  =' EP123-CC-ADHOC-CUTOFF-TMST  02720005
027300       DISPLAY ' '                                                02730004
027400     END-IF.                                                      02740004
027500                                                                  02750004
027600*1020-EXIT.                                                       02760004
027700 EJECT.                                                           02770004
027800                                                                  02780004
027900*----------------------------------------------------------       02790004
028000* 1030-READ-CURR-PRICG-DTE-CARD.                                  02800004
028100*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       02810004
028200*     THE CURRENT PRICING DATE.                                   02820004
028300*----------------------------------------------------------       02830004
028310 1030-READ-CURR-PRICG-DTE-CARD.                                   02831004
028320                                                                  02832004
028330     READ CONTROL-CARD-CURR-PRICG-DTE                             02833004
028340                               INTO EP111-CC-CONTROL-CARD         02834004
028350       AT END                                                     02835004
028351          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02835104
028352                                                                  02835204
028353     IF PS-END-OF-CNTL-CRD-FILE                                   02835304
028354       DISPLAY ' '                                                02835404
028355       DISPLAY '** ABEND     **'                                  02835504
028356       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02835604
028357       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 02835704
028358       DISPLAY '** CONTROL FILE IS EMPTY  '                       02835804
028359       DISPLAY ' '                                                02835904
028360       MOVE +4002 TO ABEND-CODE                                   02836004
028361       CALL 'ILBOABN0' USING ABEND-CODE                           02836104
028362     ELSE                                                         02836204
028363       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         02836304
028364       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        02836404
028365       DISPLAY ' '                                                02836504
028366     END-IF.                                                      02836604
028367                                                                  02836704
028368*1030-EXIT.                                                       02836804
028369 EJECT.                                                           02836904
028370                                                                  02837004
028371*----------------------------------------------------------       02837104
028372* 1040-READ-FUTRE-CORR-DTE-CARD.                                  02837204
028373*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       02837304
028374*     THE NEXT FUTURE CORRECTIONS DATE                            02837404
028375*----------------------------------------------------------       02837504
028376 1040-READ-FUTRE-CORR-DTE-CARD.                                   02837604
028377                                                                  02837704
028378     READ CONTROL-CARD-FUTRE-CORR-DTE                             02837804
028379                               INTO EP113-CC-CONTROL-CARD         02837904
028380       AT END                                                     02838004
028381          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02838104
028382                                                                  02838204
028383     IF PS-END-OF-CNTL-CRD-FILE                                   02838304
028384       DISPLAY ' '                                                02838404
028385       DISPLAY '** ABEND     **'                                  02838504
028386       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02838604
028387       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 02838704
028388       DISPLAY '** CONTROL FILE IS EMPTY  '                       02838804
028389       DISPLAY ' '                                                02838904
028390       MOVE +4002 TO ABEND-CODE                                   02839004
028391       CALL 'ILBOABN0' USING ABEND-CODE                           02839104
028392     ELSE                                                         02839204
028393       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       02839304
028394       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        02839404
028395       DISPLAY ' '                                                02839504
028396     END-IF.                                                      02839604
028397                                                                  02839704
028398*1040-EXIT.                                                       02839804
028399 EJECT.                                                           02839904
028400                                                                  02840004
028401*----------------------------------------------------------       02840104
028402* 1050-READ-CRIT-EFF-DTE-CARD.                                    02840204
028403*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       02840304
028404*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    02840404
028405*     ARE EMERGENCY OR NIGHTLY.                                   02840504
028406*----------------------------------------------------------       02840604
028407 1050-READ-CRIT-EFF-DTE-CARD.                                     02840704
028408                                                                  02840804
028409     READ CONTROL-CARD-CRIT-EFF-DTE                               02840904
028410                               INTO EP128-CC-CONTROL-CARD         02841004
028411       AT END                                                     02841104
028412          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02841204
028413                                                                  02841304
028414     IF PS-END-OF-CNTL-CRD-FILE                                   02841404
028415       DISPLAY ' '                                                02841504
028416       DISPLAY '** ABEND     **'                                  02841604
028417       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02841704
028418       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   02841804
028419       DISPLAY '** CONTROL FILE IS EMPTY  '                       02841904
028420       DISPLAY ' '                                                02842004
028421       MOVE +4002 TO ABEND-CODE                                   02842104
028422       CALL 'ILBOABN0' USING ABEND-CODE                           02842204
028423     ELSE                                                         02842304
028424       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      02842404
028425       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    02842504
028426       DISPLAY ' '                                                02842604
028427     END-IF.                                                      02842704
028428                                                                  02842804
028429*1050-EXIT.                                                       02842904
028430 EJECT.                                                           02843004
028432                                                                  02843227
028433*----------------------------------------------------------       02843327
028435* 1060-READ-FUT-STR-OPN-DAY-CARD.                                 02843527
028436*     READ CONTROL CARD EPCC045. THIS CONTROL CARD CONTAINS       02843627
028437*     THE NUMBER OF DAYS IN THE FUTURE FOR WHICH STORES           02843727
028438*     WILL BE SENT FILES.                                         02843827
028439*----------------------------------------------------------       02843927
028440 1060-READ-FUT-STR-OPN-DAY-CARD.                                  02844027
028441                                                                  02844127
028442     READ CONTROL-CARD-FUT-STR-OPN-DAY                            02844227
028444                               INTO EP045-ADVDAYS-TO-SND-RECORD   02844427
028445       AT END                                                     02844527
028446          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02844627
028447                                                                  02844727
028448     IF PS-END-OF-CNTL-CRD-FILE                                   02844827
028449       DISPLAY ' '                                                02844927
028450       DISPLAY '** ABEND     **'                                  02845027
028451       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02845127
028452       DISPLAY '** PARAGRAPH **  = 1060-READ-FUT-STR-OPN-DAY-CARD'02845227
028453       DISPLAY '** CONTROL FILE IS EMPTY  '                       02845327
028454       DISPLAY ' '                                                02845427
028455       MOVE +4002 TO ABEND-CODE                                   02845527
028456       CALL 'ILBOABN0' USING ABEND-CODE                           02845627
028457     ELSE                                                         02845727
028458       DISPLAY '** ADVANCE STORE OPEN DAYS CONTROL CARD  **'      02845827
028459       DISPLAY '** EPCC045       **  = '                          02845927
028460         EP045-DAYS-TILL-STORE-OPN                                02846029
028461       DISPLAY ' '                                                02846127
028462     END-IF.                                                      02846227
028463                                                                  02846327
028464*1060-EXIT.                                                       02846427
028465 EJECT.                                                           02846527
028466                                                                  02846627
028467*----------------------------------------------------------       02846727
028468* 2000-PROCESS-ADHOC-STORES.                                      02846827
028469*     MAIN PROCESSING AREA - EXECUTES A QUERY TO IDENTIFY ANY     02846927
028470*     CHANGES THAT WERE MADE TO THE ADHOC STORE TABLE. WHEN A     02847027
028471*     RECORD IS FOUND, A SECOND QUERY IS EXECUTED TO FIND ANY     02847127
028472*     STORE OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES        02847227
028473*     EXIST, AN OUTPUT FILE IS PRODUCED FROM THE SECOND QUERY,    02847327
028474*     ELSE AN OUTPUT FILE IS PRODUCED FROM THE FIRST QUERY.       02847427
028475*----------------------------------------------------------       02847527
028476 2000-PROCESS-ADHOC-STORES.                                       02847627
028477                                                                  02847727
028478     PERFORM 2010-OPEN-ADHOC-STORE-CSR.                           02847827
028479     PERFORM 2020-FETCH-ADHOC-STORE-CSR                           02847927
028480       UNTIL PS-ADHOC-STORE-CSR-EOF.                              02848027
028481     PERFORM 2030-CLOSE-ADHOC-STORE-CSR.                          02848127
028482                                                                  02848227
028483*2000-EXIT.                                                       02848327
028484 EJECT.                                                           02848427
028485                                                                  02848527
028486*----------------------------------------------------------       02848627
028487* 2010-OPEN-ADHOC-STORE-CSR.                                      02848727
028488*     OPEN THE CURSOR TO BE USED IN FINDING CHANGED OR            02848827
028489*     UPDATED ADHOC STORES.                                       02848927
028490*----------------------------------------------------------       02849027
028491 2010-OPEN-ADHOC-STORE-CSR.                                       02849127
028492                                                                  02849227
028493     PERFORM                                                      02849327
028494         WITH TEST AFTER                                          02849427
028495         VARYING PV-SQL-SUB                                       02849527
028496         FROM 1 BY 1                                              02849627
028500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 02850004
028600                OR  SQLCODE = 0)                                  02860007
028700                                                                  02870004
028800         EXEC SQL                                                 02880004
028900           OPEN ADHOC-STORE                                       02890007
029000         END-EXEC                                                 02900004
029100                                                                  02910004
029200         EVALUATE TRUE                                            02920004
029300           WHEN SQLCODE = -904                                    02930004
029400           WHEN SQLCODE = -911                                    02940004
029500           WHEN SQLCODE = -913                                    02950004
029600             CONTINUE                                             02960004
029700           WHEN SQLCODE = 0                                       02970004
029800             SET PS-ADHOC-STORE-CSR-NOT-EOF TO TRUE               02980007
029900           WHEN SQLWARN0 NOT EQUAL SPACE                          02990004
030000           WHEN SQLCODE NOT EQUAL ZERO                            03000004
030100             MOVE '2010-OPEN-ADHOC-STORE-CSR'                     03010011
030200                                   TO PV-PARAGRAPH-NAME           03020004
030300             MOVE 'ERROR ON OPEN OF ADHOC STORE CURSOR'           03030007
030400                                   TO PV-DB2-OPERATION            03040004
030500             PERFORM 9900-SQL-ABEND-ROUTINE                       03050004
030600         END-EVALUATE                                             03060004
030700     END-PERFORM.                                                 03070004
030800                                                                  03080004
030900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03090004
031000       MOVE '2010-OPEN-ADHOC-STORE-CSR'                           03100011
031100                             TO  PV-PARAGRAPH-NAME                03110004
031200       MOVE 'OPEN RETRIES EXCEEDED'                               03120004
031300                              TO  PV-DB2-OPERATION                03130004
031400       PERFORM 9900-SQL-ABEND-ROUTINE                             03140004
031500     END-IF.                                                      03150004
031600                                                                  03160004
031700*2010-EXIT.                                                       03170007
031800 EJECT.                                                           03180004
031900                                                                  03190004
032000*----------------------------------------------------------       03200004
032100* 2020-FETCH-ADHOC-STORE-CSR.                                     03210007
032200*     FETCH THE DATA FROM THE ADHOC STORE CURSOR. IF A            03220007
032210*     RECORD IS FOUND USING THIS CURSOR, A SECOND QUERY IS        03221007
032220*     PERFORMED THAT WILL CHECK THE XST_PROMO_STR_GP TABLE        03222007
032230*     FOR OVERRIDES.                                              03223007
032300*----------------------------------------------------------       03230004
032400 2020-FETCH-ADHOC-STORE-CSR.                                      03240007
032500                                                                  03250004
032600     PERFORM                                                      03260004
032700         WITH TEST AFTER                                          03270004
032800         VARYING PV-SQL-SUB                                       03280004
032900         FROM 1 BY 1                                              03290004
033000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03300004
033100                   OR  SQLCODE = 0                                03310004
033200                   OR  SQLCODE = +100)                            03320004
033300                                                                  03330004
033400         EXEC SQL                                                 03340004
033500           FETCH ADHOC-STORE                                      03350009
033510            INTO :XST00033-STAT-CDE                               03351007
033520                ,:XST00033-LAST-UPD-TMST                          03352007
033530                ,:XST00033-SOR-LAST-UPD-TMST                      03353007
033540                ,:XST00031-PROMO-INTFC-ID                         03354007
033550                ,:XST00031-MDSE-LNE-ID                            03355007
033560                ,:XST00031-ADHC-STR-GP-ID                         03356007
033570                ,:XST00031-STR-SELN-HIER-CDE                      03357007
033580                ,:XST00031-ACTL-STRT-TMST                         03358007
033590                ,:XST00031-ACTL-END-TMST                          03359007
033591                ,:XST00023-STR-GP-ID                              03359108
033592                ,:XST00028-PRICG-TYP-CDE                          03359207
034700         END-EXEC                                                 03470004
034800                                                                  03480004
034900         EVALUATE TRUE                                            03490004
035000           WHEN SQLCODE = -904                                    03500004
035100           WHEN SQLCODE = -911                                    03510004
035200           WHEN SQLCODE = -913                                    03520004
035300             CONTINUE                                             03530004
035400           WHEN SQLCODE = ZERO                                    03540004
035600             PERFORM 2100-FIND-STORE-OVERRIDES                    03560018
035700           WHEN SQLCODE = +100                                    03570004
035800             SET PS-ADHOC-STORE-CSR-EOF TO TRUE                   03580007
035900           WHEN SQLWARN0 NOT EQUAL SPACE                          03590004
036000           WHEN SQLCODE NOT EQUAL ZERO                            03600004
036100             MOVE '2020-FETCH-ADHOC-STORE-CSR'                    03610007
036200                                    TO PV-PARAGRAPH-NAME          03620004
036300             MOVE 'ERROR ON FETCHING ADHOC STORE CURSOR'          03630007
036400                                    TO PV-DB2-OPERATION           03640004
036500             PERFORM 9900-SQL-ABEND-ROUTINE                       03650004
036600         END-EVALUATE                                             03660004
036700     END-PERFORM.                                                 03670004
036800                                                                  03680004
036900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03690004
037000       MOVE '2020-FETCH-ADHOC-STORE-CSR'                          03700007
037100                               TO  PV-PARAGRAPH-NAME              03710004
037200       MOVE 'FETCH RETRIES EXCEEDED'                              03720004
037300                               TO  PV-DB2-OPERATION               03730004
037400       PERFORM 9900-SQL-ABEND-ROUTINE                             03740004
037500     END-IF.                                                      03750004
037600                                                                  03760004
037700*2020-EXIT.                                                       03770007
037800 EJECT.                                                           03780004
037900                                                                  03790004
038000*-----------------------------------------------------------      03800004
038100* 2030-CLOSE-ADHOC-STORE-CSR.                                     03810007
038200*-----------------------------------------------------------      03820004
038300 2030-CLOSE-ADHOC-STORE-CSR.                                      03830007
038400                                                                  03840004
038500     PERFORM                                                      03850004
038600         WITH TEST AFTER                                          03860004
038700         VARYING PV-SQL-SUB                                       03870004
038800         FROM 1 BY 1                                              03880004
038900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03890004
039000                   OR  SQLCODE = 0)                               03900004
039100                                                                  03910004
039200         EXEC SQL                                                 03920004
039300           CLOSE ADHOC-STORE                                      03930007
039400         END-EXEC                                                 03940004
039500                                                                  03950004
039600         EVALUATE TRUE                                            03960004
039700           WHEN SQLCODE = -904                                    03970004
039800           WHEN SQLCODE = -911                                    03980004
039900           WHEN SQLCODE = -913                                    03990004
040000           WHEN SQLCODE = 0                                       04000004
040100             CONTINUE                                             04010004
040200           WHEN SQLWARN0 NOT EQUAL SPACE                          04020004
040300           WHEN SQLCODE NOT EQUAL ZERO                            04030004
040400             MOVE '2030-CLOSE-ADHOC-STORE-CSR'                    04040007
040500                                       TO PV-PARAGRAPH-NAME       04050004
040600             MOVE 'ERROR ON CLOSE OF ADHOC STORE CURSOR'          04060007
040700                                       TO PV-DB2-OPERATION        04070004
040800             PERFORM 9900-SQL-ABEND-ROUTINE                       04080004
040900         END-EVALUATE                                             04090004
041000     END-PERFORM.                                                 04100004
041100                                                                  04110004
041200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04120004
041300       MOVE '2030-CLOSE-ADHOC-STORE-CSR'                          04130007
041400                               TO  PV-PARAGRAPH-NAME              04140004
041500       MOVE 'CLOSE RETRIES EXCEEDED'                              04150004
041600                               TO  PV-DB2-OPERATION               04160004
041700       PERFORM 9900-SQL-ABEND-ROUTINE                             04170004
041800     END-IF.                                                      04180004
041900                                                                  04190004
042000*2030-EXIT.                                                       04200007
042100 EJECT.                                                           04210004
042200                                                                  04220004
042300*----------------------------------------------------------       04230004
042400* 2100-FIND-STORE-OVERRIDES.                                      04240011
042500*     ONCE AN ADHOC STORE IS FOUND USING THE ADHOC CURSOR,        04250007
042600*     A SECOND CURSOR IS EXECUTED TO SEE IF ANY STORE OVERRIDES   04260007
042610*     EXIST FOR THAT STORE. IF AN OVERRIDE IS FOUND A PROMO       04261007
042620*     RECORD IS WRITTEN FROM THE OVERRIDE CURSOR, IF NOT          04262007
042630*     FOUND A PROMO RECORD IS WRIITEN FROM THE ADHOC CURSOR.      04263007
042700*----------------------------------------------------------       04270004
042800 2100-FIND-STORE-OVERRIDES.                                       04280018
042900                                                                  04290004
043000     PERFORM 2110-OPEN-STORE-OVRRDE-CSR.                          04300018
043100     PERFORM 2120-FETCH-STORE-OVRRDE-CSR                          04310018
043200       UNTIL PS-STORE-OVRRDE-CSR-EOF.                             04320018
043300     PERFORM 2130-CLOSE-STORE-OVRRDE-CSR.                         04330018
043400                                                                  04340004
043500*2100-EXIT.                                                       04350007
043600 EJECT.                                                           04360004
043700                                                                  04370004
043800*----------------------------------------------------------       04380004
043900* 2110-OPEN-STORE-OVRRDE-CSR.                                     04390007
044000*     OPEN THE STORE OVERRIDE CURSOR.                             04400007
044100*----------------------------------------------------------       04410004
044200 2110-OPEN-STORE-OVRRDE-CSR.                                      04420007
044300                                                                  04430004
044400     PERFORM                                                      04440004
044500         WITH TEST AFTER                                          04450004
044600         VARYING PV-SQL-SUB                                       04460004
044700         FROM 1 BY 1                                              04470004
044800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04480004
044900                   OR  SQLCODE = 0)                               04490004
045000                                                                  04500004
045100         EXEC SQL                                                 04510004
045200           OPEN STORE-OVRRDE                                      04520007
045300         END-EXEC                                                 04530004
045400                                                                  04540004
045500         EVALUATE TRUE                                            04550004
045600           WHEN SQLCODE = -904                                    04560004
045700           WHEN SQLCODE = -911                                    04570004
045800           WHEN SQLCODE = -913                                    04580004
045900             CONTINUE                                             04590004
046000           WHEN SQLCODE = 0                                       04600004
046100             SET PS-STORE-OVRRDE-CSR-NOT-EOF TO TRUE              04610007
046200           WHEN SQLWARN0 NOT EQUAL SPACE                          04620004
046300           WHEN SQLCODE NOT EQUAL ZERO                            04630004
046400             MOVE '2110-OPEN-STORE-OVRRDE-CSR'                    04640007
046500                                     TO PV-PARAGRAPH-NAME         04650004
046600             MOVE 'ERROR ON OPEN OF STORE OVRRDE CURSOR'          04660007
046700                                     TO PV-DB2-OPERATION          04670004
046800             PERFORM 9900-SQL-ABEND-ROUTINE                       04680004
046900         END-EVALUATE                                             04690004
047000     END-PERFORM.                                                 04700004
047100                                                                  04710004
047200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04720004
047300       MOVE '2110-OPEN-STORE-OVRRDE-CSR'                          04730007
047400                             TO  PV-PARAGRAPH-NAME                04740004
047500       MOVE 'OPEN RETRIES EXCEEDED'                               04750004
047600                              TO  PV-DB2-OPERATION                04760004
047700       PERFORM 9900-SQL-ABEND-ROUTINE                             04770004
047800     END-IF.                                                      04780004
047900                                                                  04790004
048000*2110-EXIT.                                                       04800007
048100 EJECT.                                                           04810004
048200                                                                  04820004
048300*----------------------------------------------------------       04830004
048400* 2120-FETCH-STORE-OVRRDE-CSR.                                    04840007
048500*     FETCH THE DATA FOR THE STORE OVERRIDE CURSOR. IF A          04850007
048510*     RECORD IS FOUND WITH THIS CURSOR, A PROMO RECORD IS         04851007
048520*     WRITTEN FOR THE OVERRIDE STORE. IF AN OVERRIDE IS NOT       04852007
048530*     FOUND, A PROMO RECORD IS WRITTEN FOR THE ADHOC STORE.       04853007
048600*----------------------------------------------------------       04860004
048700 2120-FETCH-STORE-OVRRDE-CSR.                                     04870007
048800                                                                  04880004
048900     PERFORM                                                      04890004
049000         WITH TEST AFTER                                          04900004
049100         VARYING PV-SQL-SUB                                       04910004
049200         FROM 1 BY 1                                              04920004
049300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04930004
049400                   OR  SQLCODE = 0                                04940004
049500                   OR  SQLCODE = +100)                            04950004
049600                                                                  04960004
049700         EXEC SQL                                                 04970004
049800           FETCH STORE-OVRRDE                                     04980007
050840            INTO  :XST00029-PROMO-INTFC-ID                        05084007
050850                 ,:XST00029-MDSE-LNE-ID                           05085007
050860                 ,:XST00029-STR-GP-TYP-CDE                        05086007
050870                 ,:XST00029-STR-GP-ID                             05087007
050880                 ,:XST00029-STR-SELN-HIER-CDE                     05088007
050881                 ,:XST00029-STAT-CDE                              05088107
050882                 ,:XST00029-ACTL-STRT-TMST                        05088207
050883                 ,:XST00029-ACTL-END-TMST                         05088307
050884                 ,:XST00029-LAST-UPD-TMST                         05088407
050885                 ,:XST00029-SOR-LAST-UPD-TMST                     05088507
050892                 ,:XST00028-PRICG-TYP-CDE                         05089207
050900         END-EXEC                                                 05090004
051000                                                                  05100004
051100         EVALUATE TRUE                                            05110004
051110           WHEN SQLCODE = -904                                    05111004
051120           WHEN SQLCODE = -911                                    05112004
051130           WHEN SQLCODE = -913                                    05113004
051140             CONTINUE                                             05114004
051150           WHEN SQLCODE = ZERO                                    05115004
051160             PERFORM 3100-FORMAT-OVRRDE-OUTPUT                    05116007
051170             ADD 1 TO PC-CNT-OVRRDE-RECS                          05117007
051171             SET PS-STORE-OVRRDE-CSR-EOF TO TRUE                  05117115
051180           WHEN SQLCODE = +100                                    05118004
051191             PERFORM 3000-FORMAT-ADHOC-OUTPUT                     05119107
051192             ADD 1 TO PC-CNT-ADHOC-RECS                           05119207
051193             SET PS-STORE-OVRRDE-CSR-EOF TO TRUE                  05119308
051200           WHEN SQLWARN0 NOT EQUAL SPACE                          05120004
051300           WHEN SQLCODE NOT EQUAL ZERO                            05130004
051400             MOVE '2120-FETCH-STORE-OVRRDE-CSR'                   05140007
051500                                    TO PV-PARAGRAPH-NAME          05150004
051600             MOVE 'ERROR ON FETCHING STORE OVRRDE CURSOR'         05160007
051700                                    TO PV-DB2-OPERATION           05170004
051800             DISPLAY 'SQLCODE= ' SQLCODE                          05180004
051810             PERFORM 9900-SQL-ABEND-ROUTINE                       05181004
051820         END-EVALUATE                                             05182004
051830     END-PERFORM.                                                 05183004
051840                                                                  05184004
051850     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05185004
051860       MOVE '2120-FETCH-STORE-OVRRDE-CSR'                         05186007
051870                              TO  PV-PARAGRAPH-NAME               05187004
051880       MOVE 'FETCH RETRIES EXCEEDED'                              05188004
051881                              TO  PV-DB2-OPERATION                05188104
051882       PERFORM 9900-SQL-ABEND-ROUTINE                             05188204
051883     END-IF.                                                      05188304
051884                                                                  05188404
051885*2120-EXIT.                                                       05188507
051886 EJECT.                                                           05188604
051887                                                                  05188704
051888*-----------------------------------------------------------      05188804
051889* 2130-CLOSE-STORE-OVRRDE-CSR.                                    05188907
051890*     CLOSE THE STORE OVERRIDE CURSOR.                            05189007
051891*-----------------------------------------------------------      05189104
051892 2130-CLOSE-STORE-OVRRDE-CSR.                                     05189207
051893                                                                  05189304
051894     PERFORM                                                      05189404
051895         WITH TEST AFTER                                          05189504
051896         VARYING PV-SQL-SUB                                       05189604
051897         FROM 1 BY 1                                              05189704
051898         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05189804
051899                   OR  SQLCODE = 0)                               05189904
051900                                                                  05190004
051901         EXEC SQL                                                 05190104
051902           CLOSE STORE-OVRRDE                                     05190207
051903         END-EXEC                                                 05190304
051904                                                                  05190404
051905         EVALUATE TRUE                                            05190504
051906           WHEN SQLCODE = -904                                    05190604
051907           WHEN SQLCODE = -911                                    05190704
051908           WHEN SQLCODE = -913                                    05190804
051909           WHEN SQLCODE = 0                                       05190904
051910             CONTINUE                                             05191004
051911           WHEN SQLWARN0 NOT EQUAL SPACE                          05191104
051912           WHEN SQLCODE NOT EQUAL ZERO                            05191204
051913             MOVE '2130-CLOSE-STORE-OVRRDE-CSR'                   05191307
051914                                     TO PV-PARAGRAPH-NAME         05191404
051915             MOVE 'ERROR ON CLOSE OF STORE OVRRDE CURSOR'         05191507
051916                                     TO PV-DB2-OPERATION          05191604
051917             PERFORM 9900-SQL-ABEND-ROUTINE                       05191704
051918         END-EVALUATE                                             05191804
051919     END-PERFORM.                                                 05191904
051920                                                                  05192004
051921     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05192104
051922       MOVE '2130-CLOSE-STORE-OVRRDE-CSR'                         05192217
051923                               TO  PV-PARAGRAPH-NAME              05192304
051924       MOVE 'CLOSE RETRIES EXCEEDED'                              05192404
051925                               TO  PV-DB2-OPERATION               05192504
051926       PERFORM 9900-SQL-ABEND-ROUTINE                             05192604
051927     END-IF.                                                      05192704
051928                                                                  05192804
051929*2130-EXIT.                                                       05192907
051930 EJECT.                                                           05193004
051931                                                                  05193104
052167*-----------------------------------------------------------      05216704
052168* 3000-FORMAT-ADHOC-OUTPUT.                                       05216807
052169*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC CURSOR.      05216907
052170*-----------------------------------------------------------      05217004
052171 3000-FORMAT-ADHOC-OUTPUT.                                        05217107
052172                                                                  05217204
052173     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05217304
052174     MOVE PC-ADHOC-STR-BUS-EVENT                                  05217407
052175                             TO EP072-BUSINESS-EVENT-ID.          05217504
052176     MOVE PC-ADHOC-PRC-SETUP-IND                                  05217604
052177                             TO EP072-PRC-SETUP-IND.              05217704
052178     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05217804
052179                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05217904
052180     MOVE XST00031-ADHC-STR-GP-ID                                 05218004
052181                             TO EP072-SETUP-STR-GRP-ID.           05218104
052182     MOVE XST00031-STR-SELN-HIER-CDE                              05218204
052183                             TO EP072-STR-SELN-HIER-CDE.          05218304
052184     MOVE PC-ADHOC-STR-SPEC-CDE                                   05218408
052185                             TO EP072-DIST-STR-GRP-TYP-CDE.       05218504
052186     MOVE XST00023-STR-GP-ID                                      05218608
052187                             TO EP072-DIST-STR-GRP-ID.            05218704
052188     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05218804
052189                                                                  05218904
052190     MOVE XST00031-ACTL-STRT-TMST                                 05219004
052200                             TO PV-ACTL-STRT-TMST.                05220004
052210                                                                  05221004
052220     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05222004
052230       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05223004
052240         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05224004
052250     ELSE                                                         05225004
052260       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05226004
052270         MOVE PC-APPLY-CORRECTION                                 05227004
052280                                  TO EP072-APPLY-IND              05228004
052281       END-IF                                                     05228104
052282     END-IF.                                                      05228204
052283                                                                  05228304
052284     MOVE XST00033-STAT-CDE  TO PC-PROMO-STAT-CDE                 05228408
052285                                                                  05228504
052286     IF PC-SCHEDULED-STATUS                                       05228604
052287       MOVE PC-ADD-STAT-CDE                                       05228704
052288                             TO EP072-RECORD-ACTION               05228804
052289     ELSE                                                         05228904
052290       IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                    05229004
052300         MOVE PC-DELETE-STAT-CDE                                  05230004
052301                             TO EP072-RECORD-ACTION               05230104
052302       END-IF                                                     05230204
052303     END-IF.                                                      05230304
052304                                                                  05230404
052305     MOVE XST00031-PROMO-INTFC-ID                                 05230504
052306                             TO EP072-PROMO-INTFC-ID.             05230604
052307     MOVE XST00031-MDSE-LNE-ID                                    05230704
052308                             TO EP072-MERCH-LNE-ID.               05230804
052309     MOVE XST00028-PRICG-TYP-CDE                                  05230904
052310                             TO EP072-PRICG-TYP-CDE.              05231004
052311     MOVE PC-MDSE-INCL-BOTH-IND                                   05231108
052312                             TO EP072-MDSE-INC-EXC-IND.           05231204
052313     MOVE XST00031-ACTL-STRT-TMST                                 05231304
052314                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05231404
052315     MOVE XST00031-ACTL-END-TMST                                  05231504
052316                             TO EP072-STR-GRP-PROMO-END-TMST.     05231604
052317     MOVE XST00033-SOR-LAST-UPD-TMST                              05231708
052318                             TO EP072-SOR-LAST-UPD-TMST.          05231804
052319                                                                  05231904
052320     IF EP072-APPLY-NIGHTLY                                       05232004
052321       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05232104
052322     ELSE                                                         05232204
052323       PERFORM 4100-WRITE-EMERG-APPLY-RECORD                      05232304
052324       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 05232404
052325       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05232504
052326     END-IF.                                                      05232604
052327                                                                  05232704
052328*3000-EXIT.                                                       05232807
052329 EJECT.                                                           05232904
052330                                                                  05233004
052331*-----------------------------------------------------------      05233107
052332* 3100-FORMAT-OVRRDE-OUTPUT.                                      05233207
052333*     POPULATE COPYBOOK EPRD072.                                  05233307
052334*-----------------------------------------------------------      05233407
052335 3100-FORMAT-OVRRDE-OUTPUT.                                       05233507
052336                                                                  05233607
052337     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05233707
052338     MOVE PC-PRICG-BUS-EVENT                                      05233807
052339                             TO EP072-BUSINESS-EVENT-ID.          05233907
052340     MOVE PC-RMS-PRC-SETUP-IND                                    05234007
052341                             TO EP072-PRC-SETUP-IND.              05234107
052342     MOVE XST00029-STR-GP-TYP-CDE                                 05234207
052343                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05234307
052344     MOVE XST00029-STR-GP-ID                                      05234407
052345                             TO EP072-SETUP-STR-GRP-ID.           05234507
052346     MOVE XST00029-STR-SELN-HIER-CDE                              05234607
052347                             TO EP072-STR-SELN-HIER-CDE.          05234707
052348     MOVE XST00029-STR-GP-TYP-CDE                                 05234807
052349                             TO EP072-DIST-STR-GRP-TYP-CDE.       05234907
052350     MOVE XST00023-STR-GP-ID                                      05235020
052351                             TO EP072-DIST-STR-GRP-ID.            05235107
052352     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05235207
052353                                                                  05235307
052354     MOVE XST00029-ACTL-STRT-TMST                                 05235407
052355                             TO PV-ACTL-STRT-TMST.                05235507
052356                                                                  05235607
052357     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05235707
052358       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05235807
052359         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05235907
052360     ELSE                                                         05236007
052361       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05236107
052362         MOVE PC-APPLY-CORRECTION                                 05236207
052363                                  TO EP072-APPLY-IND              05236307
052364       END-IF                                                     05236407
052365     END-IF.                                                      05236507
052366                                                                  05236607
052367     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              05236725
052379     MOVE XST00029-PROMO-INTFC-ID                                 05237907
052380                             TO EP072-PROMO-INTFC-ID.             05238007
052381     MOVE XST00029-MDSE-LNE-ID                                    05238107
052382                             TO EP072-MERCH-LNE-ID.               05238207
052383     MOVE XST00028-PRICG-TYP-CDE                                  05238307
052384                             TO EP072-PRICG-TYP-CDE.              05238407
052385     MOVE PC-MDSE-INCL-IND                                        05238507
052386                             TO EP072-MDSE-INC-EXC-IND.           05238607
052387     MOVE XST00029-ACTL-STRT-TMST                                 05238707
052388                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05238807
052389     MOVE XST00029-ACTL-END-TMST                                  05238907
052390                             TO EP072-STR-GRP-PROMO-END-TMST.     05239007
052391     MOVE XST00029-SOR-LAST-UPD-TMST                              05239108
052392                             TO EP072-SOR-LAST-UPD-TMST.          05239207
052393                                                                  05239307
052394     IF EP072-APPLY-NIGHTLY                                       05239407
052395       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05239507
052396     ELSE                                                         05239607
052397       PERFORM 4100-WRITE-EMERG-APPLY-RECORD                      05239707
052398       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 05239807
052399       PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                      05239907
052400     END-IF.                                                      05240007
052401                                                                  05240107
052402*3100-EXIT.                                                       05240207
052403 EJECT.                                                           05240307
052405*----------------------------------------------------------       05240504
052406* 4000-WRITE-NIGHT-APPLY-RECORD.                                  05240604
052407*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05240704
052408*----------------------------------------------------------       05240804
052409 4000-WRITE-NIGHT-APPLY-RECORD.                                   05240904
052410                                                                  05241004
052411     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      05241104
052412                                                                  05241204
052413     ADD 1           TO PC-CNT-NIGHT-RECS                         05241304
052414                        PC-CNT-ALL-RECS.                          05241404
052415                                                                  05241504
052416*4000-EXIT.                                                       05241604
052417 EJECT.                                                           05241704
052418                                                                  05241804
052419*----------------------------------------------------------       05241904
052420* 4100-WRITE-EMERG-APPLY-RECORD.                                  05242004
052500*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05250004
052600*----------------------------------------------------------       05260004
052700 4100-WRITE-EMERG-APPLY-RECORD.                                   05270004
052710                                                                  05271004
052720     WRITE PROMO-EMERGENCY-RECORD FROM EP072-PROMO-INTFC-RECORD.  05272004
052730                                                                  05273004
052740     ADD 1           TO PC-CNT-EMERG-RECS                         05274004
052750                        PC-CNT-ALL-RECS.                          05275004
052760*                                                                 05276004
052770*4100-EXIT.                                                       05277004
052780 EJECT.                                                           05278004
052790                                                                  05279004
052800*----------------------------------------------------------       05280004
052801* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      05280104
052802* CCYYMMDD FORMAT.                                                05280204
052803*----------------------------------------------------------       05280304
052804 6100-DATE-ROUTINE.                                               05280404
052805                                                                  05280504
052806     INITIALIZE DPG51 DPG52 DPG53                                 05280604
052807                DPG54 DPG55 DPG56.                                05280704
052808                                                                  05280804
052809     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05280904
052810     SET DPG51-INCREMENT-DATE       TO TRUE.                      05281004
052820     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05282004
052830     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05283004
052840     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05284004
052850                                                                  05285004
052860     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05286004
052870                                             DPG54 DPG55 DPG56.   05287004
052880                                                                  05288004
052890     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05289004
052900       DISPLAY '** ABEND **'                                      05290004
053000       DISPLAY '** PROGRAM = EPKUT117'                            05300004
053100       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05310004
053200       DISPLAY DPG54-ERROR-MESSAGE                                05320004
053210       MOVE 4019 TO PV-ABEND-CODE                                 05321004
053220       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05322004
053230     END-IF.                                                      05323004
053240                                                                  05324004
053241     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      05324104
053242                                                                  05324204
053243     INITIALIZE DPG51 DPG52 DPG53                                 05324304
053244                DPG54 DPG55 DPG56.                                05324404
053245                                                                  05324504
053246     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05324604
053247     SET DPG51-DECREMENT-DATE       TO TRUE.                      05324704
053248     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05324804
053249     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05324904
053250     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05325004
053251                                                                  05325104
053252     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05325204
053253                                             DPG54 DPG55 DPG56.   05325304
053254                                                                  05325404
053255     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05325504
053256       DISPLAY '** ABEND **'                                      05325604
053257       DISPLAY '** PROGRAM = EPKUT117'                            05325704
053258       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05325804
053259       DISPLAY DPG54-ERROR-MESSAGE                                05325904
053260       MOVE 4019 TO PV-ABEND-CODE                                 05326004
053261       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05326104
053262     END-IF.                                                      05326204
053263                                                                  05326304
053264     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  05326404
053265                                                                  05326504
053266     INITIALIZE DPG51 DPG52 DPG53                                 05326627
053267                DPG54 DPG55 DPG56.                                05326727
053268                                                                  05326827
053269     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05326927
053270     SET DPG51-INCREMENT-DATE       TO TRUE.                      05327027
053271     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05327127
053272     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    05327227
053274     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05327427
053275                                                                  05327527
053276     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05327627
053277                                             DPG54 DPG55 DPG56.   05327727
053278                                                                  05327827
053279     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05327927
053280       DISPLAY '** ABEND **'                                      05328027
053281       DISPLAY '** PROGRAM = EPKUT117'                            05328127
053282       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05328227
053283       DISPLAY DPG54-ERROR-MESSAGE                                05328327
053284       MOVE 4019 TO PV-ABEND-CODE                                 05328427
053285       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05328527
053286     END-IF.                                                      05328627
053287                                                                  05328727
053288     MOVE DPG55-DB2-ISO-DATE-FMT TO EP045-CC-ADV-STR-OPN-DATE.    05328827
053290                                                                  05329027
053291*6100-EXIT.                                                       05329104
053292 EJECT.                                                           05329204
053293                                                                  05329304
053294*----------------------------------------------------------       05329404
053295* 9900-SQL-ABEND-ROUTINE.                                         05329504
053296*     SQL ABEND ROUTINE.                                          05329604
053297*----------------------------------------------------------       05329704
053298 9900-SQL-ABEND-ROUTINE.                                          05329804
053299                                                                  05329904
053300     DISPLAY '** ABEND     **'.                                   05330004
053301     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05330104
053302     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05330204
053303     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               05330304
053304                                                                  05330404
053305     COPY DPPD004.                                                05330504
053306     SET ABEND-4013-DB2-ERROR TO TRUE.                            05330604
053310     CALL 'ILBOABN0' USING ABEND-CODE.                            05331004
053400                                                                  05340004
053500*9900-EXIT.                                                       05350004
053600 EJECT.                                                           05360004
053700                                                                  05370004
053800*----------------------------------------------------------       05380004
053900* 9999-WRAPUP.                                                    05390004
054000*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      05400004
054100*     ANY DATA FROM THE PROGRAM.                                  05410004
054200*----------------------------------------------------------       05420004
054300 9999-WRAPUP.                                                     05430004
054400                                                                  05440004
054500     CLOSE CONTROL-CARD-PGM-LAST-RUN-DTE.                         05450004
054600     OPEN OUTPUT CONTROL-CARD-PGM-LAST-RUN-DTE.                   05460004
054700                                                                  05470004
054800     MOVE PV-CURRENT-SYSTEM-TMST TO EP123-CC-ADHOC-CUTOFF-TMST    05480005
054900     WRITE CNTRL-CARD-PGM-LAST-RUN-REC                            05490004
055000                                   FROM EP123-CC-CONTROL-CARD.    05500005
055100                                                                  05510004
055200     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            05520004
055300           CONTROL-CARD-FUTRE-CORR-DTE                            05530004
055400           CONTROL-CARD-PGM-LAST-RUN-DTE                          05540004
055500           CONTROL-CARD-CRIT-EFF-DTE                              05550004
055510           CONTROL-CARD-FUT-STR-OPN-DAY                           05551026
055600           PROMO-NIGHT-FILE                                       05560004
055700           PROMO-EMERGENCY-FILE.                                  05570004
055800                                                                  05580004
055900     DISPLAY ' '.                                                 05590004
056000     DISPLAY '*********************************************'.     05600004
056100     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            05610004
056200     DISPLAY '*********************************************'.     05620004
056300     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN: ' PC-CNT-NIGHT-RECS.  05630004
056400     DISPLAY 'NUMBER OF EMERG. RECS WRITTEN: ' PC-CNT-EMERG-RECS. 05640004
056500     DISPLAY 'NUMBER OF RECS FROM OVRD QUERY:' PC-CNT-OVRRDE-RECS.05650008
056600     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.05660004
056700*    DISPLAY 'NUMBER OF RECS FROM DEVT QUERY: ' PC-CNT-DEVT-RECS. 05670004
056800     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                05680004
056900     DISPLAY '*********************************************'.     05690004
057000                                                                  05700004
057100*9999-EXIT.                                                       05710004
057200 EJECT.                                                           05720004
057300                                                                  05730004
