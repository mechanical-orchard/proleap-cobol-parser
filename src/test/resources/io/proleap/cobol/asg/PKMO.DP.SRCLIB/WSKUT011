000120 IDENTIFICATION DIVISION.                                         00012003
000140 PROGRAM-ID.      WSKUT011.                                       00014013
000150 AUTHOR.          TKMA479.                                        00015013
000160 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00016013
000170 DATE-WRITTEN.    03-30-2007.                                     00017013
000180                                                                  00018003
000190***************************************************************** 00019003
000191*           COPY ERROR QUEUE TO FILE                              00019124
000192***************************************************************** 00019203
000193*                         PIXLGCYERR                              00019324
000194*                       PROGRAM  LOGIC                            00019424
000195*                       --------------                            00019524
000196*  MAIN                                                           00019624
000197*  ----                                                           00019724
000198*                                                                 00019824
000199*   OPEN THE MESSAGE OUTPUT SEQUENTIAL FILE.                      00019924
000200*                                                                 00020024
000201*   CONNECT TO THE QUEUE MANAGER.                                 00020124
000202*   IF CONNECTION FAILED THEN                                     00020224
000203*            CALL 9000-DISPLAY-ERROR-MESSAGE AND EXIT             00020324
000204*                                                                 00020424
000205*   OPEN THE SPECIFIED MESSAGE QUEUE (MQOPEN).                    00020524
000206*   IF OPEN FAILED THEN                                           00020624
000207*            DISCONNECT FROM QUEUE MANAGER                        00020724
000208*            CALL 9000-DISPLAY-ERROR-MESSAGE AND EXIT             00020824
000209*   ENDIF.                                                        00020924
000210*                                                                 00021024
000211*   SET THE GET MESSAGE OPTIONS.                                  00021124
000212*            GET MESSAGES FROM QUEUE (MQGET)                      00021224
000213*            IF GET FAILED                                        00021324
000214*                     CALL 9000-DISPLAY-ERROR-MESSAGE             00021424
000215*            ENDIF                                                00021524
000216*                                                                 00021624
000217*   WRITE MESSAGE TO OUTPUT SEQUENTIAL FILE                       00021724
000218*                                                                 00021824
000219*   CLOSE THE MESSAGE QUEUE.                                      00021924
000220*   IF CLOSE FAILED THEN                                          00022024
000221*            CALL 9000-DISPLAY-ERROR-MESSAGE.                     00022124
000222*                                                                 00022224
000223*   DISCONNECT FROM THE QUEUE MANAGER.                            00022324
000224*   IF DISCONNECT FAILED THEN                                     00022424
000225*            CALL 9000-DISPLAY-ERROR-MESSAGE.                     00022524
000226*                                                                 00022624
000227*   CLOSE THE MESSAGE OUTPUT FILE.                                00022724
000228*                                                                 00022824
000229*   EXIT PROGRAM.                                                 00022924
000230*                                                                 00023024
000231***************************************************************** 00023103
000233 ENVIRONMENT DIVISION.                                            00023303
000235                                                                  00023503
000236 CONFIGURATION SECTION.                                           00023603
000237                                                                  00023703
000238 SOURCE-COMPUTER.       IBM-3090.                                 00023803
000239 OBJECT-COMPUTER.       IBM-3090.                                 00023903
000240                                                                  00024003
000241 INPUT-OUTPUT SECTION.                                            00024103
000242                                                                  00024203
000243 FILE-CONTROL.                                                    00024303
000248     SELECT ERR-EXTRACT                                           00024803
000249            ASSIGN TO OUT01.                                      00024903
000250                                                                  00025003
000252 DATA DIVISION.                                                   00025203
000254 FILE SECTION.                                                    00025403
000255                                                                  00025512
000268 FD  ERR-EXTRACT                                                  00026803
000269     RECORDING MODE F                                             00026903
000270     BLOCK CONTAINS 0 RECORDS                                     00027003
000271     LABEL RECORDS ARE OMITTED.                                   00027103
000272 01  ERR-EXTRACT-RECORD               PIC X(226).                 00027212
000273                                                                  00027303
000275 WORKING-STORAGE SECTION.                                         00027503
000277                                                                  00027725
000284******************************************************************00028417
000285*  COMMUNICATIONS AREA FOR DB2                                    00028517
000286******************************************************************00028617
000287     EXEC SQL                                                     00028717
000288          INCLUDE SQLCA                                           00028817
000289     END-EXEC.                                                    00028917
000290                                                                  00029017
000291     COPY SQLCA2.                                                 00029117
000292                                                                  00029203
000293******************************************************************00029319
000294*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                     00029419
000295******************************************************************00029519
000296     COPY DPWS004.                                                00029619
000297******************************************************************00029711
000298*  DB2 VIEW DECLARATION -                                         00029811
000299*      (WSV_CNSMR_QUE)  MQ INFO                                   00029911
000300******************************************************************00030011
000301     EXEC SQL                                                     00030111
000302          INCLUDE WSV00006                                        00030211
000303     END-EXEC.                                                    00030311
000304                                                                  00030420
000305     COPY WSRD020.                                                00030520
000306     COPY WSRD014.                                                00030620
000307                                                                  00030711
000308 01  WS-VARIABLES.                                                00030816
000309     05  PV-RETRY-COUNTER           PIC S9(04) VALUE +0 COMP SYNC.00030916
000310     05  PC-MAX-RETRIES             PIC S9(03) VALUE +5 COMP-3.   00031016
000311     05  PC-CURRENT-PROGRAM-NAME    PIC X(08)  VALUE 'WSKUT011'.  00031123
000312     05  PV-ERROR-MESSAGE           PIC X(48) VALUE SPACES.       00031216
000313     05  PV-Q-MGR-NULL              PIC S9(04) VALUE 0 COMP.      00031316
000314     05  PV-Q-NAME-NULL             PIC S9(04) VALUE 0 COMP.      00031416
000315                                                                  00031516
000316 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00031616
000317                                                   COMP SYNC.     00031716
000318                                                                  00031811
000319 01  WS-MQCONN               PIC X(8)  VALUE 'CSQBCONN'.          00031911
000320 01  WS-MQOPEN               PIC X(8)  VALUE 'CSQBOPEN'.          00032011
000321 01  WS-MQGET                PIC X(8)  VALUE 'CSQBGET'.           00032111
000322 01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQBCLOS'.          00032211
000323 01  WS-MQDISC               PIC X(8)  VALUE 'CSQBDISC'.          00032311
000324 01  WS-MQCMIT               PIC X(8)  VALUE 'CSQBCOMM'.          00032411
000325 01  WS-MQBACK               PIC X(8)  VALUE 'CSQBBACK'.          00032511
000326                                                                  00032624
000327*    GENERAL WORK FIELDS                                          00032724
000328                                                                  00032824
000329 01  NUMRECS                 PIC 9(9)  VALUE ZEROS.               00032911
000330 01  NUMGETS                 PIC S9(9) BINARY VALUE 0.            00033011
000331 01  NUMPUTS                 PIC 9(9)  VALUE ZEROS.               00033111
000332 01  NUMCMTS                 PIC 9(9)  VALUE ZEROS.               00033211
000333 01  ERROR-MESSAGE           PIC X(48) VALUE SPACES.              00033311
000334 01  PV-PARAGRAPH            PIC X(48) VALUE SPACES.              00033411
000335                                                                  00033524
000336*   PARAMETER VARIABLES                                           00033624
000337                                                                  00033724
000338 01  QM-NAME               PIC X(48).                             00033811
000339 01  QNAME                 PIC X(48).                             00033911
000340 01  PADCHAR               PIC X(1) VALUE '*'.                    00034011
000341 01  MSGBUFFER             pic X(500) VALUE SPACES.               00034111
000342 01  NUMMSGS               PIC S9(9) BINARY VALUE 1.              00034211
000343 01  MSGLENGTH             PIC S9(9) BINARY.                      00034311
000344 01  DATA-LENGTH           PIC S9(9) BINARY.                      00034411
000345 01  MQCHECK               PIC X(8) VALUE 'MQR2C'.                00034511
000346 01  MQ-REASON-TEXT        PIC X(30) VALUE SPACES.                00034611
000347 01  HOLD-REASON           PIC S9(9) BINARY.                      00034711
000348 01  HOLD-COMPLETION-CODE  PIC S9(9) BINARY.                      00034811
000349                                                                  00034924
000350*    API FIELDS                                                   00035024
000351                                                                  00035124
000352 01  HCONN                   PIC S9(9) BINARY VALUE 0.            00035211
000353 01  GQ-HANDLE               PIC S9(9) BINARY VALUE 0.            00035311
000354 01  OPEN-OPTIONS            PIC S9(9) BINARY.                    00035411
000355 01  COMPLETION-CODE         PIC S9(9) BINARY.                    00035511
000356 01  REASON                  PIC S9(9) BINARY.                    00035611
000357 01  CON-REASON              PIC S9(9) BINARY.                    00035711
000358                                                                  00035811
000359 01  PV-ABEND-VARIABLES.                                          00035911
000360     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.00036011
000361     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00036111
000362     88  ABEND-4002-READ-ERROR                       VALUE +4002. 00036211
000363     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00036311
000364     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00036411
000365     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00036511
000366     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00036611
000367     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00036711
000368     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 00036811
000369     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 00036911
000370     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00037011
000371     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 00037111
000372     88  ABEND-4020-MQ-ERROR                         VALUE +4020. 00037211
000373     88  ABEND-4444-FORCED-ABEND                     VALUE +4444. 00037311
000374                                                                  00037411
000375                                                                  00037511
000376 01  PE-MQ-ABEND-VARIABLES.                                       00037613
000377     10  PE-MQ-QMANAGER           PIC X(05) VALUE SPACES.         00037711
000378     10  PE-MQ-QNAME              PIC X(30) VALUE SPACES.         00037811
000379     10  PE-MQ-COMPLETION-CODE    PIC 9(04) VALUE ZEROS.          00037911
000380     10  PE-MQ-REASON-CODE        PIC 9(04) VALUE ZEROS.          00038011
000381                                                                  00038111
000382                                                                  00038224
000383*   API CONTROL BLOCKS                                            00038324
000384                                                                  00038424
000385 01  MQM-OBJECT-DESCRIPTOR.                                       00038511
000386     COPY CMQODV.                                                 00038611
000387 01  MQM-MESSAGE-DESCRIPTOR.                                      00038711
000388     COPY CMQMDV.                                                 00038811
000389 01  MQM-GET-MESSAGE-OPTIONS.                                     00038911
000390     COPY CMQGMOV.                                                00039011
000391                                                                  00039124
000392*    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   00039224
000393*    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          00039324
000394                                                                  00039424
000395 01  MQM-CONSTANTS.                                               00039511
000396     COPY CMQV.                                                   00039611
000397                                                                  00039724
000398*---------------------------------------------------------------- 00039824
000399*    CONTROL CARD                                                 00039911
000400*---------------------------------------------------------------- 00040024
000401 01  CC-CONTROL-CARD-1.                                           00040111
000402     05  CC-QMGR-NAME              PIC X(48).                     00040211
000403     05  FILLER                    PIC X(32).                     00040311
000404                                                                  00040411
000405 01  CC-CONTROL-CARD-2.                                           00040511
000406     05  CC-QNAME-PIXLGCYERR       PIC X(48).                     00040614
000407     05  FILLER                    PIC X(32).                     00040711
000408                                                                  00040811
000409*---------------------------------------------------------------- 00040924
000410*    PROGRAM CONSTANTS                                            00041011
000411*---------------------------------------------------------------- 00041124
000413     05  PC-FIFTY-STARS            PIC X(50) VALUE ALL '*'.       00041311
000414                                                                  00041411
000415*----------------------------------------------------------------*00041511
000416*    PROGRAM SWITCHES                                             00041611
000417*----------------------------------------------------------------*00041711
000418 01  PS-PROGRAM-SWITCHES.                                         00041811
000419     05  PS-CONTROL-CARD-1-SW      PIC X(01) VALUE 'N'.           00041911
000420         88  PS-CONTROL-CARD-1-END           VALUE 'Y'.           00042011
000421         88  PS-CONTROL-CARD-1-START         VALUE 'N'.           00042111
000422     05  PS-CONTROL-CARD-2-SW      PIC X(01) VALUE 'N'.           00042211
000423         88  PS-CONTROL-CARD-2-END           VALUE 'Y'.           00042311
000424         88  PS-CONTROL-CARD-2-START         VALUE 'N'.           00042411
000425                                                                  00042511
000426* ------------------------------------------------------------- * 00042611
000427 PROCEDURE DIVISION.                                              00042711
000428* ------------------------------------------------------------- * 00042811
000429 0000-MAIN.                                                       00042921
000430                                                                  00043011
000465* -------------------------------------------------------------   00046521
000466*  OPEN OUTPUT MESSAGE SEQUENTIAL FILE                            00046621
000467* -------------------------------------------------------------   00046721
000468                                                                  00046811
000469     OPEN OUTPUT ERR-EXTRACT.                                     00046911
000470                                                                  00047021
000471     INITIALIZE ERR-EXTRACT-RECORD.                               00047111
000472                                                                  00047221
000473     PERFORM 7000-GET-MQ-INFO.                                    00047321
000474                                                                  00047411
000475* -------------------------------------------------------------   00047521
000476*  CONNECT TO THE QUEUE MANAGER                                   00047621
000477* -------------------------------------------------------------   00047721
000478     MOVE CC-QMGR-NAME TO QM-NAME.                                00047811
000479     CALL WS-MQCONN USING QM-NAME                                 00047911
000480                         HCONN                                    00048011
000481                         COMPLETION-CODE                          00048111
000482                         REASON.                                  00048211
000483                                                                  00048321
000484* -------------------------------------------------------------   00048421
000485*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              00048521
000486*    AND EXIT                                                     00048621
000487* -------------------------------------------------------------   00048721
000488                                                                  00048821
000489     MOVE REASON TO CON-REASON.                                   00048911
000490     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00049011
000491        MOVE 'MQCONN'   TO ERROR-MESSAGE                          00049111
000492        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        00049211
000493        GO TO 4000-END-PROGRAM                                    00049311
000494     END-IF.                                                      00049411
000495     DISPLAY 'MQCONN SUCCESSFUL TO ', QM-NAME.                    00049511
000496* -------------------------------------------------------------   00049621
000497*    OPEN THE QUEUE FOR INPUT                                     00049721
000498* -------------------------------------------------------------   00049821
000499                                                                  00049921
000500     COMPUTE OPEN-OPTIONS = MQOO-INPUT-SHARED +                   00050011
000501                            MQOO-FAIL-IF-QUIESCING.               00050111
000502     MOVE CC-QNAME-PIXLGCYERR   TO MQOD-OBJECTNAME.               00050215
000503     MOVE QM-NAME TO MQOD-OBJECTQMGRNAME.                         00050311
000504                                                                  00050421
000505     CALL WS-MQOPEN USING HCONN                                   00050511
000506                         MQM-OBJECT-DESCRIPTOR                    00050611
000507                         OPEN-OPTIONS                             00050711
000508                         GQ-HANDLE                                00050811
000509                         COMPLETION-CODE                          00050911
000510                         REASON.                                  00051011
000512* -------------------------------------------------------------   00051221
000513*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    00051321
000514*    AND EXIT.                                                    00051421
000515* -------------------------------------------------------------   00051521
000517     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00051711
000518        MOVE 'MQOPEN'   TO ERROR-MESSAGE                          00051811
000519        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        00051911
000520        GO TO 3000-DISCONNECT-QMGR                                00052011
000521     END-IF.                                                      00052111
000522     DISPLAY 'MQOPEN SUCCESSFUL'.                                 00052211
000523                                                                  00052321
000524     PERFORM 2000-MQGET-MSG.                                      00052426
000525                                                                  00052521
000526* -------------------------------------------------------------   00052621
000527*    CLOSE THE QUEUE                                              00052721
000528* -------------------------------------------------------------   00052821
000529                                                                  00052921
000530     CALL WS-MQCLOSE USING HCONN                                  00053011
000531                          GQ-HANDLE                               00053111
000532                          MQCO-NONE                               00053211
000533                          COMPLETION-CODE                         00053311
000534                          REASON.                                 00053411
000535     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00053511
000536        MOVE 'MQCLOSE'  TO ERROR-MESSAGE                          00053611
000537        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        00053711
000538     ELSE                                                         00053811
000539        DISPLAY 'MQCLOSE SUCCESSFUL'                              00053911
000540     END-IF.                                                      00054011
000541                                                                  00054121
000542     PERFORM 3000-DISCONNECT-QMGR.                                00054211
000543     GO TO 4000-END-PROGRAM.                                      00054311
000544                                                                  00054421
000545* -------------------------------------------------------------   00054521
000546* GET MESSAGES FROM THE QUEUE                                     00054622
000547* -------------------------------------------------------------   00054721
000548 2000-MQGET-MSG.                                                  00054822
000549                                                                  00054911
000550     PERFORM                                                      00055011
000551       UNTIL (COMPLETION-CODE IS EQUAL TO MQCC-FAILED)            00055111
000552         MOVE MQMI-NONE TO MQMD-MSGID                             00055211
000553         MOVE MQCI-NONE TO MQMD-CORRELID                          00055311
000554         MOVE 226 TO MSGLENGTH                                    00055415
000555         COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +               00055511
000556                                  MQGMO-WAIT                      00055611
000557                                                                  00055711
000558         CALL WS-MQGET USING HCONN                                00055811
000559                            GQ-HANDLE                             00055911
000560                            MQM-MESSAGE-DESCRIPTOR                00056011
000561                            MQM-GET-MESSAGE-OPTIONS               00056111
000562                            MSGLENGTH                             00056211
000563                            MSGBUFFER                             00056311
000564                            DATA-LENGTH                           00056411
000565                            COMPLETION-CODE                       00056511
000566                            REASON                                00056611
000567                                                                  00056711
000568*        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 00056824
000569*        AND BREAK OUT OF LOOP                                    00056924
000570                                                                  00057011
000571         IF (COMPLETION-CODE NOT = MQCC-OK) THEN                  00057111
000572            MOVE 'MQGET'     TO ERROR-MESSAGE                     00057211
000573            PERFORM 9000-DISPLAY-ERROR-MESSAGE                    00057311
000574         ELSE                                                     00057411
000575            ADD 1 TO NUMRECS                                      00057511
000576                IF NUMRECS > 1000                                 00057611
000577                    PERFORM 3600-MQ-COMMIT                        00057711
000578                    MOVE ZERO TO NUMRECS                          00057811
000579                END-IF                                            00057911
000580            ADD 1 TO NUMGETS                                      00058011
000581            PERFORM 8000-WRITE-EXTRACT-RECORD                     00058111
000582         END-IF                                                   00058211
000583     END-PERFORM.                                                 00058311
000586                                                                  00058621
000587* ------------------------------------------------------------- * 00058711
000588* CLOSE AND DISCONNECT FROM THE MQ QUEUE MANAGER                  00058811
000589* ------------------------------------------------------------- * 00058911
000590 3000-DISCONNECT-QMGR.                                            00059011
000591                                                                  00059124
000592*    DISCONNECT FROM THE QUEUE MANAGER                            00059224
000593                                                                  00059324
000594     IF CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED         00059411
000595        CALL WS-MQDISC USING HCONN                                00059511
000596                            COMPLETION-CODE                       00059611
000597                            REASON                                00059711
000598        IF (COMPLETION-CODE NOT = MQCC-OK) THEN                   00059811
000599           MOVE 'MQDISC'   TO ERROR-MESSAGE                       00059911
000600           PERFORM 9000-DISPLAY-ERROR-MESSAGE                     00060011
000601        ELSE                                                      00060111
000602           DISPLAY 'MQDISC SUCCESSFUL'                            00060211
000603        END-IF                                                    00060311
000604     END-IF.                                                      00060411
000605                                                                  00060511
000606*    CLOSE THE MESSAGE EXTRACT OUTPUT FILE.                       00060624
000607                                                                  00060711
000608     CLOSE ERR-EXTRACT.                                           00060811
000609                                                                  00060924
000611******************************************************************00061111
000612*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        00061211
000613******************************************************************00061311
000614 3600-MQ-COMMIT.                                                  00061411
000615                                                                  00061511
000616     CALL WS-MQCMIT USING HCONN                                   00061611
000617                          COMPLETION-CODE                         00061711
000618                          REASON.                                 00061811
000619                                                                  00061911
000620     IF (COMPLETION-CODE NOT = MQCC-OK)                           00062011
000621         CALL MQCHECK USING REASON                                00062111
000622                               MQ-REASON-TEXT                     00062211
000623        MOVE '3600-COMMIT-MQ'   TO PV-PARAGRAPH                   00062311
000624        MOVE 'MQCMIT ERROR'     TO ERROR-MESSAGE                  00062411
000625        MOVE COMPLETION-CODE    TO HOLD-COMPLETION-CODE           00062511
000626        MOVE REASON             TO HOLD-REASON                    00062611
000627        PERFORM 3700-BACK-OUT-MQ                                  00062711
000628        MOVE HOLD-COMPLETION-CODE TO COMPLETION-CODE              00062811
000629                                        PE-MQ-COMPLETION-CODE     00062911
000630        MOVE HOLD-REASON          TO REASON                       00063011
000631                                        PE-MQ-REASON-CODE         00063111
000632        PERFORM 9200-MQ-ABEND                                     00063211
000633     ELSE                                                         00063311
000634        ADD +1 TO NUMCMTS                                         00063411
000635     END-IF.                                                      00063511
000636                                                                  00063611
000637******************************************************************00063711
000638* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       00063811
000639******************************************************************00063911
000640 3700-BACK-OUT-MQ.                                                00064011
000641                                                                  00064111
000642     CALL WS-MQBACK USING HCONN                                   00064211
000643                          COMPLETION-CODE                         00064311
000644                          REASON.                                 00064411
000645                                                                  00064511
000646     IF (COMPLETION-CODE NOT = MQCC-OK) THEN                      00064611
000647         CALL MQCHECK USING REASON                                00064711
000648                            MQ-REASON-TEXT                        00064811
000649        MOVE '3700-BACK-OUT-MQ'  TO PV-PARAGRAPH                  00064911
000650        MOVE 'MQBACK ERROR'      TO ERROR-MESSAGE                 00065011
000651        PERFORM 9200-MQ-ABEND                                     00065111
000652     END-IF.                                                      00065211
000653******************************************************************00065311
000654                                                                  00065411
000655* ------------------------------------------------------------- * 00065511
000656* END THE PROGRAM                                                 00065611
000657* ------------------------------------------------------------- * 00065711
000658 4000-END-PROGRAM.                                                00065811
000659                                                                  00065924
000660*    DISPLAY THE NUMBER OF MESSAGES SUCCESSFULLY PUT              00066024
000661*    TO THE QUEUE                                                 00066124
000662                                                                  00066224
000663     DISPLAY NUMGETS, ' MESSAGES READ FROM QUEUE'.                00066311
000664     DISPLAY NUMPUTS, ' ERR MSGS PUT TO DISK    '.                00066411
000665     DISPLAY NUMCMTS, ' NO. OF COMMITS TAKEN    '.                00066511
000666                                                                  00066624
000667     IF NUMPUTS > 0                                               00066711
000668        MOVE 4095 TO RETURN-CODE                                  00066811
000669     END-IF.                                                      00066911
000670                                                                  00067011
000671     STOP RUN.                                                    00067111
000672                                                                  00067224
000673******************************************************************00067311
000674* GETS MQ INFO FROM WSV_CNSMR_QUE                                 00067411
000675******************************************************************00067511
000676 7000-GET-MQ-INFO.                                                00067611
000677                                                                  00067711
000678     PERFORM WITH TEST AFTER                                      00067811
000679             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 00067911
000680             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         00068011
000681                     SQLCODE = ZERO                               00068111
000682                                                                  00068211
000683       EXEC SQL                                                   00068311
000684        SELECT QUE_MGR,                                           00068411
000685               QUE_NM                                             00068511
000686         INTO :WSV00006-QUE-MGR:PV-Q-MGR-NULL                     00068611
000687             ,:WSV00006-QUE-NM:PV-Q-NAME-NULL                     00068711
000688         FROM WSV_CNSMR_QUE                                       00068811
000689        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      00068911
000690          AND INTGRTN_TYP_CDE = 'PIXLGCYERR'                      00069011
000691       END-EXEC                                                   00069111
000692                                                                  00069211
000693       EVALUATE TRUE                                              00069311
000694           WHEN SQLCODE = 0                                       00069411
000695              IF PV-Q-MGR-NULL = -1                               00069511
000696                 DISPLAY PC-CURRENT-PROGRAM-NAME                  00069611
000697                    ' - Q MGR MISSING FROM PIXLEGACYQ/PIXLGCYERR' 00069711
000698                 MOVE 'Q MGR MISSING FROM PIXLEGACYQ/PIXLGCYERR'  00069811
000699                    TO PV-ERROR-MESSAGE                           00069911
000700                 PERFORM 9200-MQ-ABEND                            00070011
000701              ELSE                                                00070111
000702                 IF PV-Q-MGR-NULL = 0                             00070211
000703                    INITIALIZE CC-CONTROL-CARD-1                  00070311
000704                    MOVE WSV00006-QUE-MGR-TEXT TO                 00070411
000705                       CC-CONTROL-CARD-1                          00070511
000706                    DISPLAY PC-CURRENT-PROGRAM-NAME               00070611
000707                       'MQ INFO: '                                00070711
000708                        CC-CONTROL-CARD-1                         00070811
000709                 END-IF                                           00070911
000710              END-IF                                              00071011
000711              IF PV-Q-NAME-NULL = -1                              00071111
000712                 DISPLAY PC-CURRENT-PROGRAM-NAME                  00071211
000713                    ' - Q NME MISSING FROM PIXLEGACYQ/PIXLGCYERR' 00071312
000714                 MOVE 'Q NME MISSING FROM PIXLEGACYQ/PIXLGCYERR'  00071412
000715                    TO PV-ERROR-MESSAGE                           00071511
000716                 PERFORM 9200-MQ-ABEND                            00071611
000717              ELSE                                                00071711
000718                 IF PV-Q-NAME-NULL = 0                            00071811
000719                    INITIALIZE CC-CONTROL-CARD-2                  00071911
000720                    MOVE WSV00006-QUE-NM-TEXT TO                  00072011
000721                       CC-CONTROL-CARD-2                          00072111
000722                    DISPLAY PC-CURRENT-PROGRAM-NAME               00072211
000723                       'MQ INFO: '                                00072311
000724                        CC-CONTROL-CARD-2                         00072411
000725                 END-IF                                           00072511
000726              END-IF                                              00072611
000727                                                                  00072711
000728           WHEN OTHER                                             00072811
000729             MOVE SQLCODE TO SQLCODE2                             00072911
000730             DISPLAY '******************************************' 00073011
000731             DISPLAY '* ABEND                                   ' 00073111
000732             DISPLAY '* PROGRAM = WSKUT011                      ' 00073223
000733             DISPLAY '* PARAGRAPH = 7000-GET-MQ-INFO'             00073319
000734             DISPLAY '* GETTING RESTART WORKING STORAGE INFO    ' 00073411
000735             DISPLAY '** SQLCODE   = ' SQLCODE2                   00073511
000736             DISPLAY '******************************************' 00073611
000737             PERFORM 9100-SQL-ABEND                               00073711
000738       END-EVALUATE                                               00073811
000739     END-PERFORM.                                                 00073911
000740                                                                  00074011
000741     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    00074111
000742         SQLCODE NOT = ZERO                                       00074211
000743         MOVE SQLCODE TO SQLCODE2                                 00074311
000744         DISPLAY '****************************************'       00074411
000745         DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO **'       00074511
000746         DISPLAY '** SELECT WSV_PRVDR_QUE               **'       00074611
000747         DISPLAY '** PARAGRAPH = 7000-GET-MQ-INFO'                00074719
000748         DISPLAY '** SQLCODE   = ' SQLCODE2                       00074811
000749         DISPLAY '****************************************'       00074911
000750         PERFORM 9100-SQL-ABEND                                   00075011
000751     END-IF.                                                      00075111
000752* ------------------------------------------------------------- * 00075211
000753* WRITE THE ERROR MESSAGE QUEUE TO A SEQUENTIAL FILE.             00075311
000754* ------------------------------------------------------------- * 00075411
000755 8000-WRITE-EXTRACT-RECORD.                                       00075511
000756* ------------------------------------------------------------- * 00075611
000757*                                                                 00075711
000758     INITIALIZE ERR-EXTRACT-RECORD.                               00075811
000759     MOVE MSGBUFFER TO WS020-RECEIPT-PIX-ERROR-REC.               00075915
000760     WRITE ERR-EXTRACT-RECORD FROM WS020-RECEIPT-PIX-ERROR-REC.   00076015
000761     ADD +1 TO NUMPUTS.                                           00076111
000763* ------------------------------------------------------------- * 00076311
000764* DISPLAY THE VALUES OF A FAILED MQ API COMMAND                   00076411
000765* ------------------------------------------------------------- * 00076511
000766 9000-DISPLAY-ERROR-MESSAGE.                                      00076611
000769     DISPLAY '************************************************'.  00076911
000770     DISPLAY '* ', ERROR-MESSAGE.                                 00077011
000771     DISPLAY '* COMPLETION CODE : ', COMPLETION-CODE.             00077111
000772     DISPLAY '* REASON CODE     : ', REASON.                      00077211
000773     DISPLAY '************************************************'.  00077311
000774*                                                                 00077427
000777******************************************************************00077718
000778* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      00077818
000779* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 00077918
000780******************************************************************00078018
000781 9100-SQL-ABEND.                                                  00078118
000782                                                                  00078218
000783* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    00078318
000784* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         00078418
000785* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     00078518
000786* FORMAT                                                          00078618
000787     COPY DPPD004.                                                00078718
000788                                                                  00078818
000789     MOVE +4013 TO ABEND-CODE.                                    00078918
000790     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         00079018
000791                                                                  00079111
000792****************************************************************  00079211
000793** PERFORM MQ-SERIES ABEND PROCESSING                             00079311
000794****************************************************************  00079411
000795 9200-MQ-ABEND.                                                   00079511
000796                                                                  00079611
000797     DISPLAY '**** ABEND *************************************'.  00079711
000798     DISPLAY '** MQSERIES ERROR **'.                              00079811
000799     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          00079924
000800     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    00080011
000801     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     00080111
000802     DISPLAY '** MESSAGE:    ', ERROR-MESSAGE.                    00080211
000803     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            00080311
000804     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                00080411
000805     DISPLAY '** RSN TEXT:   ', MQ-REASON-TEXT.                   00080511
000806                                                                  00080611
000807     MOVE +4013 TO PV-ABEND-CODE.                                 00080711
000808     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         00080811
000809                                                                  00080911
000810******************************************************************00081011
000811*                       END OF PROGRAM                            00081124
000900******************************************************************00090003
