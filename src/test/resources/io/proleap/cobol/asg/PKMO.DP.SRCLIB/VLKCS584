000100*-----------------------*                                         06/13/94
000200 IDENTIFICATION DIVISION.                                         VLKCS584
000300*-----------------------*                                            LV013
000400 PROGRAM-ID.    VLKCS584.                                         VLKCS584
000500 AUTHOR.        MARY SARDINA.                                           03
000600 DATE-WRITTEN.  07/96.                                            VLKCS584
000700*---------------------------------------------------------------* VLKCS584
000800*    V584 - VENDOR/DEPARTMENT LIST PROGRAM                      * VLKCS584
000900*                                                               * VLKCS584
001000*    THIS PROGRAM GENERATES A LIST OF TICKET PLACEMENT CODES    * VLKCS584
001100*    AND THEIR DESCRIPTIONS.                                    * VLKCS584
001200*                                                               * VLKCS584
001300*---------------------------------------------------------------* VLKCS584
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
001400 ENVIRONMENT DIVISION.                                            VLKCS584
001500 DATA DIVISION.                                                   VLKCS584
001600                                                                  VLKCS584
001700 WORKING-STORAGE SECTION.                                         VLKCS584
001800                                                                  VLKCS584
001900 01  DK-DB2-KEY.                                                  VLKCS584
002000     05  DK-STATUS-CODE                 PIC  X(01)  VALUE SPACES. VLKCS584
002100     05  DK-VEND-NAME                   PIC  X(30)  VALUE SPACE.  VLKCS584
002200     05  DK-VEND-NAME-BYTE              REDEFINES DK-VEND-NAME    VLKCS584
002300                                        OCCURS 30 TIMES           VLKCS584
002400                                        PIC  X(01).               VLKCS584
002500     05  DK-PRIM-NAME                   PIC  X(30).               VLKCS584
002600                                                                  VLKCS584
002700 01  PC-PROGRAM-CONSTANTS.                                        VLKCS584
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         VLKCS584
002900                                                    'VL584A  '.   VLKCS584
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         VLKCS584
003100                                                    'VLKM584 '.   VLKCS584
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         VLKCS584
003300                                                    'VLKCS584'.   VLKCS584
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      VLKCS584
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      VLKCS584
003600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    VLKCS584
003700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     VLKCS584
003800                                                    COMP SYNC.    VLKCS584
003900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      VLKCS584
004000                                                    COMP SYNC.    VLKCS584
004100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         VLKCS584
004200                                                    +1000000      VLKCS584
004300                                                    COMP-3.       VLKCS584
004400     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      VLKCS584
004500                                                    COMP SYNC.    VLKCS584
004600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       VLKCS584
004700                                                    COMP-3.       VLKCS584
004800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  VLKCS584
004900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  VLKCS584
005000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  VLKCS584
005100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  VLKCS584
005200     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    VLKCS584
005300     05  PC-TYPE-CODES.                                           VLKCS584
005400         10  PC-PRIMARY                 PIC  X(02)  VALUE '01'.   VLKCS584
005500         10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   VLKCS584
005600         10  PC-LABEL                   PIC  X(02)  VALUE '03'.   VLKCS584
005700         10  PC-SHORTNAME               PIC  X(02)  VALUE '04'.   VLKCS584
005800                                                                  VLKCS584
005900     05  PC-TSYMSG-NUMBERS.                                       VLKCS584
006000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  VLKCS584
006100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  VLKCS584
006200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  VLKCS584
006300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  VLKCS584
006400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  VLKCS584
006500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  VLKCS584
006600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  VLKCS584
006700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  VLKCS584
006800         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  VLKCS584
006810         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  VLKCS584
006900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  VLKCS584
007000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  VLKCS584
007100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  VLKCS584
007200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  VLKCS584
007300         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  VLKCS584
007400                                                                  VLKCS584
007500 01  PS-PROGRAM-SWITCHES.                                         VLKCS584
007600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    VLKCS584
007700         88  PS-NO-ERROR                            VALUE 'Y'.    VLKCS584
007800         88  PS-ERROR                               VALUE 'N'.    VLKCS584
007900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    VLKCS584
008000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    VLKCS584
008100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    VLKCS584
008200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    VLKCS584
008300         88  PS-DONE                                VALUE 'Y'.    VLKCS584
008400         88  PS-NOT-DONE                            VALUE 'N'.    VLKCS584
008500                                                                  VLKCS584
008600 01  PL-PROGRAM-LITERALS.                                         VLKCS584
008700     05  PL-PRIMARY                     PIC  X(10)  VALUE         VLKCS584
008800                                                    'PRIMARY   '. VLKCS584
008900     05  PL-ALIAS                       PIC  X(10)  VALUE         VLKCS584
009000                                                    'ALIAS     '. VLKCS584
009100     05  PL-LABEL                       PIC  X(10)  VALUE         VLKCS584
009200                                                    'LABEL     '. VLKCS584
009300     05  PL-SHORTNAME                   PIC  X(10)  VALUE         VLKCS584
009400                                                    'SHORT NAME'. VLKCS584
009500                                                                  VLKCS584
009600 01  PV-PROGRAM-VARIABLES.                                        VLKCS584
009700     05  PV-SUB                         PIC S9(04)  VALUE +0      VLKCS584
009800                                                    COMP SYNC.    VLKCS584
009900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      VLKCS584
010000                                                    COMP SYNC.    VLKCS584
010100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      VLKCS584
010200                                                    COMP-3.       VLKCS584
010300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      VLKCS584
010400                                                    COMP-3.       VLKCS584
010500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      VLKCS584
010600                                                    COMP-3.       VLKCS584
010700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      VLKCS584
010800                                                    COMP-3.       VLKCS584
010900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      VLKCS584
011000                                                    COMP-3.       VLKCS584
011100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      VLKCS584
011200                                                    COMP-3.       VLKCS584
011300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      VLKCS584
011400                                                    COMP-3.       VLKCS584
011500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      VLKCS584
011600                                                    COMP SYNC.    VLKCS584
011700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      VLKCS584
011800                                                    COMP SYNC.    VLKCS584
011900     05  PV-ITEM                        PIC S9(04)  VALUE +0      VLKCS584
012000                                                    COMP SYNC.    VLKCS584
012100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      VLKCS584
012200                                                    COMP SYNC.    VLKCS584
012300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      VLKCS584
012400                                                    COMP SYNC.    VLKCS584
012500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      VLKCS584
012600                                                    COMP SYNC.    VLKCS584
012700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      VLKCS584
012800                                                    COMP SYNC.    VLKCS584
012900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      VLKCS584
013000                                                    COMP SYNC.    VLKCS584
013100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VLKCS584
013200                                                    COMP SYNC.    VLKCS584
013300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      VLKCS584
013400                                                    COMP SYNC.    VLKCS584
013500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      VLKCS584
013600                                                    COMP SYNC.    VLKCS584
013700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      VLKCS584
013800                                                    COMP SYNC.    VLKCS584
013900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      VLKCS584
014000                                                    COMP SYNC.    VLKCS584
014100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      VLKCS584
014200                                                    COMP SYNC.    VLKCS584
014300     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      VLKCS584
014400                                                    COMP SYNC.    VLKCS584
014500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      VLKCS584
014600                                                    COMP SYNC.    VLKCS584
014700******************************************************************VLKCS584
014800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **VLKCS584
014900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **VLKCS584
015000**  APPLICATION-SPECIFIC COMMAREA.                              **VLKCS584
015100******************************************************************VLKCS584
015200 01  LQW-LIST-QUEUE-WORK-AREA.                                    VLKCS584
015300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  VLKCS584
015400     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           VLKCS584
015500                                        INDEXED BY LQW-IDX.       VLKCS584
015600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       VLKCS584
015700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               VLKCS584
015800         10  LQW-SELECTED-SW            PIC  X(01).               VLKCS584
015900             88  LQW-SELECT                         VALUE 'S'.    VLKCS584
016000             88  LQW-DESELECT                       VALUE ' '.    VLKCS584
016100         10  LQW-ACTION                 PIC  X(03).               VLKCS584
016200         10  LQW-CODE-TYPE              PIC  X(04).                  CL**2
016300         10  LQW-CODE-DESC              PIC  X(50).                  CL**2
016700                                                                  VLKCS584
016800*---------------------------------------------------------------* VLKCS584
016900*  RECORD LAYOUT FOR THE PRETICKET SELECTION TEMP STORAGE QUEUE.* VLKCS584
017000*---------------------------------------------------------------* VLKCS584
017100     COPY VLWS006.                                                   CL*13
017200                                                                  VLKCS584
017300*---------------------------------------------------------------* VLKCS584
017400*    MAP LAYOUT                                                 * VLKCS584
017500*---------------------------------------------------------------* VLKCS584
017600     COPY VLKM584.                                                VLKCS584
017700                                                                  VLKCS584
017800 01  MR-OCCURS-LAYOUT                   REDEFINES  VL584AO.       VLKCS584
017900     05  FILLER                         PIC X(12).                VLKCS584
018000     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          VLKCS584
018100         10  MR-SELECTL                 PIC S9(04) COMP.          VLKCS584
018200         10  MR-SELECTA                 PIC  X(01).               VLKCS584
018300         10  MR-SELECTC                 PIC  X(01).               VLKCS584
018400         10  MR-SELECTH                 PIC  X(01).               VLKCS584
018500         10  MR-SELECTI                 PIC  X(01).               VLKCS584
018600                                                                  VLKCS584
018700         10  MR-ACTIONL                 PIC S9(04) COMP.          VLKCS584
018800         10  MR-ACTIONA                 PIC  X(01).               VLKCS584
018900         10  MR-ACTIONC                 PIC  X(01).               VLKCS584
019000         10  MR-ACTIONH                 PIC  X(01).               VLKCS584
019100         10  MR-ACTION                  PIC  X(03).               VLKCS584
019200                                                                  VLKCS584
019300         10  MR-CODE-TYPEL              PIC S9(04) COMP.             CL**2
019400         10  MR-CODE-TYPEA              PIC  X(01).                  CL**2
019500         10  MR-CODE-TYPEC              PIC  X(01).                  CL**2
019600         10  MR-CODE-TYPEH              PIC  X(01).                  CL**2
019700         10  MR-CODE-TYPE               PIC  X(04).                  CL**2
019800                                                                     CL**2
019900         10  MR-CODE-DESCL              PIC S9(04) COMP.          VLKCS584
020000         10  MR-CODE-DESCA              PIC  X(01).               VLKCS584
020100         10  MR-CODE-DESCC              PIC  X(01).               VLKCS584
020200         10  MR-CODE-DESCH              PIC  X(01).               VLKCS584
020300         10  MR-CODE-DESC               PIC  X(50).                  CL**2
020400                                                                  VLKCS584
021600                                                                  VLKCS584
021700*---------------------------------------------------------------* VLKCS584
021800*    ATTRIBUTE SETTINGS COPYBOOK.                               * VLKCS584
021900*---------------------------------------------------------------* VLKCS584
022000     COPY DPWS015.                                                VLKCS584
022100                                                                  VLKCS584
022200*---------------------------------------------------------------* VLKCS584
022300*    FUNCTION KEYS COPYBOOK.                                    * VLKCS584
022400*---------------------------------------------------------------* VLKCS584
022500     COPY DPWS016.                                                VLKCS584
022600                                                                  VLKCS584
022700*---------------------------------------------------------------* VLKCS584
022800*    NUMERIC EDIT LAYOUT.                                       * VLKCS584
022900*---------------------------------------------------------------* VLKCS584
023000     COPY DPWS010I.                                               VLKCS584
023100                                                                  VLKCS584
023200*---------------------------------------------------------------* VLKCS584
023300*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * VLKCS584
023400*---------------------------------------------------------------* VLKCS584
023500     COPY DPWS030.                                                VLKCS584
CICS       COPY DPWS930.                                                VLKCS584
023600                                                                  VLKCS584
023700*---------------------------------------------------------------* VLKCS584
023800*    STANDARD COMMAREA.                                         * VLKCS584
023900*---------------------------------------------------------------* VLKCS584
024000     COPY DPWS020.                                                VLKCS584
024100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                VLKCS584
024200*---------------------------------------------------------------* VLKCS584
024300* INTER-APPLICATION COMMAREA.                                   * VLKCS584
024400*   VLWS005 - INPUT FROM PO PRETICKET REQUEST                   * VLKCS584
024500**  VNWS002 - OUTPUT TO LOCAL-GO-FUNCTION                               84
024600*---------------------------------------------------------------* VLKCS584
024700         10  INTER-APPL-COMM-AREA       PIC X(200).               VLKCS584
024800     COPY VLWS005.                                                   CL*13
024900**   COPY VNWS002.                                                VLKCS584
025000*---------------------------------------------------------------* VLKCS584
025100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * VLKCS584
025200*---------------------------------------------------------------* VLKCS584
025300         10  ASC-SPECIFIC-COMMAREA.                               VLKCS584
025400             15  ASC-LIST-KEYS.                                   VLKCS584
025500                 20  ASC-KEY-VEND-NAME               PIC  X(30).  VLKCS584
025600                 20  ASC-KEY-VEND-TYPE               PIC  X(01).     CL**3
025800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                VLKCS584
025900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  VLKCS584
026000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   VLKCS584
026100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   VLKCS584
026200                                                                  VLKCS584
026300                 20  ASC-ITEM-ARRAY.                              VLKCS584
026400                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        VLKCS584
026500                         30  ASC-LIST-ITEM-NUMBER                 VLKCS584
026600                                                     PIC S9(09)   VLKCS584
026700                                                     COMP-3.      VLKCS584
026800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  VLKCS584
026900                             88  ASC-VALID-SELECT    VALUE ' '    VLKCS584
027000                                                           'S'    VLKCS584
027100                                                           'B'    VLKCS584
027200                                                           'E'.   VLKCS584
027300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   VLKCS584
027400                             88  ASC-TEMP-SELECT     VALUE 'S'.   VLKCS584
027500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   VLKCS584
027600                             88  ASC-TEMP-END        VALUE 'E'.   VLKCS584
027700                         30  ASC-SELECTED-SW         PIC  X(01).  VLKCS584
027800                             88  ASC-NO-SELECT       VALUE ' '.   VLKCS584
027900                             88  ASC-SELECT          VALUE 'S'.   VLKCS584
028000                             88  ASC-BEGIN           VALUE 'B'.   VLKCS584
028100                             88  ASC-END             VALUE 'E'.   VLKCS584
028200                         30  ASC-ACTION              PIC  X(03).  VLKCS584
028300                         30  ASC-CODE-TYPE           PIC  X(04).     CL**2
028400                         30  ASC-CODE-DESC           PIC  X(50).     CL**2
028900                                                                        84
029000             15  ASC-BLK-SUB                         PIC S9(04)   VLKCS584
029100                                                          COMP    VLKCS584
029200                                                          SYNC.   VLKCS584
029300             15  ASC-ITEM-SUB                        PIC S9(04)   VLKCS584
029400                                                          COMP    VLKCS584
029500                                                          SYNC.   VLKCS584
029600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   VLKCS584
029700                                                          COMP-3. VLKCS584
029800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   VLKCS584
029900                                                          COMP-3. VLKCS584
030000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   VLKCS584
030100                                                          COMP-3. VLKCS584
030200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   VLKCS584
030300                                                          COMP-3. VLKCS584
030400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   VLKCS584
030500                                                          COMP-3. VLKCS584
030600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   VLKCS584
030700                                                          COMP    VLKCS584
030800                                                          SYNC.   VLKCS584
030900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   VLKCS584
031000                                                          COMP-3. VLKCS584
031100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   VLKCS584
031200                                                          COMP-3. VLKCS584
031300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  VLKCS584
031400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   VLKCS584
031500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   VLKCS584
031600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  VLKCS584
031700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   VLKCS584
031800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   VLKCS584
031900             15  ASC-LIST-QUEUE-NAME.                             VLKCS584
032000                 20  ASC-LIST-TERM-ID                PIC  X(04).  VLKCS584
032100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   VLKCS584
032200                                                          COMP-3. VLKCS584
032300                 20  ASC-LIST-SEQ                    PIC  9(01).  VLKCS584
032400             15  ASC-SEL-QUEUE-NAME.                              VLKCS584
032500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  VLKCS584
032600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   VLKCS584
032700                                                          COMP-3. VLKCS584
032800                 20  ASC-SEL-SEQ                     PIC  9(01).  VLKCS584
032900                                                                  VLKCS584
033000             15  ASC-START-ITEM-REQUEST.                          VLKCS584
033100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  VLKCS584
033210             15  ASC-HOLD-INTER-APPL                 PIC X(200).          
033300                                                                  VLKCS584
033400*---------------------------------------------------------------* VLKCS584
033500*    ABEND PROCESSING COPYBOOK.                                 * VLKCS584
033600*---------------------------------------------------------------* VLKCS584
033700     COPY DPWS013.                                                VLKCS584
033800                                                                  VLKCS584
033801 EJECT                                                                    
033802*---------------------------------------------------------------*         
033803*    DB2 AREA FOR THE PRETICKET PLACEMENT DESCRIPTION TABLE     *         
033804*---------------------------------------------------------------*         
033805     EXEC SQL                                                             
033810          INCLUDE TPLDESC                                                 
033900     END-EXEC.                                                            
035200                                                                  VLKCS584
035300*---------------------------------------------------------------* VLKCS584
035400*    DB2 AREA FOR COMMUNICATIONS                                * VLKCS584
035500*---------------------------------------------------------------* VLKCS584
035600     EXEC SQL                                                     VLKCS584
035700          INCLUDE SQLCA                                           VLKCS584
035800     END-EXEC.                                                    VLKCS584
035900                                                                  VLKCS584
036000*---------------------------------------------------------------* VLKCS584
036100*    VENDOR CURSOR WHEN VENDOR NAME IS ENTERED                  * VLKCS584
036200*---------------------------------------------------------------* VLKCS584
036300     EXEC SQL                                                     VLKCS584
036400          DECLARE TICKET-CSR CURSOR FOR                           VLKCS584
036500           SELECT TKT_PLCMNT_CDE                                     CL**2
036600                 ,TKT_PLCMNT_DESC                                    CL**2
037100             FROM TPLDESC                                               *2
037600         ORDER BY TKT_PLCMNT_CDE                                        *2
037800     END-EXEC.                                                    VLKCS584
037900                                                                  VLKCS584
038000 LINKAGE SECTION.                                                 VLKCS584
038100                                                                  VLKCS584
038200 01  DFHCOMMAREA.                                                 VLKCS584
038300     05  FILLER                         OCCURS  1 TO 4072 TIMES   VLKCS584
038400                                        DEPENDING ON EIBCALEN.    VLKCS584
038500         10  FILLER                     PIC X.                    VLKCS584
038600                                                                  VLKCS584
038700 PROCEDURE DIVISION.                                              VLKCS584
038800                                                                     CL**6
038900     INITIALIZE DP030-CICS-API-FIELDS.                            VLKCS584
039000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       VLKCS584
039100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          VLKCS584
039200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         VLKCS584
039300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       VLKCS584
039400     MOVE LENGTH OF VL584AI        TO DP030-MAP-LENGTH (1).       VLKCS584
039500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     VLKCS584
039600                                                                     CL**6
039700     PERFORM 0001-CALL-CICS-ARCH-API.                             VLKCS584
039800                                                                  VLKCS584
039900     PERFORM 1000-CONTROL-PROCESSING                              VLKCS584
040000                                                                  VLKCS584
040100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     VLKCS584
040200                                                                     CL**6
040300     PERFORM 0001-CALL-CICS-ARCH-API.                             VLKCS584
040400                                                                  VLKCS584
040500******************************************************************VLKCS584
040600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **VLKCS584
040700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **VLKCS584
040800******************************************************************VLKCS584
040900 0001-CALL-CICS-ARCH-API.                                         VLKCS584
041000                                                                  VLKCS584
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
041200                                    DFHCOMMAREA                           
041300                                    DP030-CICS-API-FIELDS                 
041400                                    DP020-STANDARD-COMMAREA               
041500                                    VL584AI.                              
041600                                                                  VLKCS584
041700     IF DP030-RC-CALL-SUCCESSFUL                                     CL**6
041800         CONTINUE                                                 VLKCS584
041900     ELSE                                                         VLKCS584
042000         SET DP013-NO-ROLLBACK                                    VLKCS584
042100             DP013-XCTL-DISPLAY-RESTART                           VLKCS584
042200             DP013-CICS-ABEND      TO TRUE                        VLKCS584
042300         MOVE '0001-CALL-CICS-ARCH-API'                           VLKCS584
042400                                   TO DP013-PARAGRAPH             VLKCS584
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
042700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      VLKCS584
042800         PERFORM DP013-0000-PROCESS-ABEND.                        VLKCS584
042900                                                                  VLKCS584
043000*----------------------------------------------------------------*VLKCS584
043100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *VLKCS584
043200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *VLKCS584
043300*----------------------------------------------------------------*VLKCS584
043400 1000-CONTROL-PROCESSING.                                         VLKCS584
043500                                                                  VLKCS584
043600     EVALUATE TRUE                                                VLKCS584
043700         WHEN DP020-NEXT-ACT-INITIAL                              VLKCS584
043800             INITIALIZE ASC-SPECIFIC-COMMAREA                     VLKCS584
043900             MOVE EIBTRMID              TO ASC-LIST-TERM-ID          CL**6
044000                                           ASC-SEL-TERM-ID           CL**6
044100             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER      CL**6
044200                                           ASC-SEL-TASK-NUMBER       CL**6
044300             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ              CL**6
044400             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ               CL**6
044500                                                                     CL**6
044600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 VLKCS584
044700                                                                     CL**6
044800             PERFORM 4000-BUILD-INITIAL-PANEL                     VLKCS584
044900                                                                  VLKCS584
045000         WHEN DP020-NEXT-ACT-READ-MAP                             VLKCS584
045100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM            CL**6
045200                                                                     CL**6
045300             PERFORM 2000-PROCESS-PANEL                           VLKCS584
045400                                                                  VLKCS584
045501         WHEN DP020-NEXT-ACT-RETURN                                       
045502            IF (VL005-DEL OR                                              
045503                 VL005-ADD)                                               
045505                MOVE ASC-ITEM-AT-TOP-OF-PANEL                       RCK000
045506                                     TO PV-TOP-ITEM                 RCK000
045507                MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL            
045508                PERFORM 2050-DELETE-LIST-QUEUE                      RCK000
045509                PERFORM 4000-BUILD-INITIAL-PANEL                    RCK000
045510            ELSE                                                          
045511                MOVE VL005-NUMBER-OF-TS-ITEMS                             
045512                                   TO PV-HOLD-SELECTED-ITEMS      RCK00050
045513                MOVE ASC-HOLD-INTER-APPL                                  
045514                                 TO INTER-APPL-COMM-AREA                  
045515                PERFORM 2050-DELETE-LIST-QUEUE                      RCK000
045516                PERFORM 4000-BUILD-INITIAL-PANEL                    RCK000
045517                PERFORM 3200-RESET-ATTRIBUTES                       RCK000
045518                MOVE ASC-ITEM-AT-TOP-OF-PANEL                       RCK000
045519                                     TO PV-TOP-ITEM                 RCK000
045520                MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL            
045521                PERFORM 6000-REFRESH-PANEL-FROM-TEMP                RCK000
045522                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                RCK000
045524          END-IF                                                          
045526*             PERFORM 3200-RESET-ATTRIBUTES                       RCK00050
045527*             PERFORM 2050-DELETE-LIST-QUEUE                      RCK00050
045528*             THIS PROGRAM REQUIRES THAT ANY ADDED OR CHANGED             
045529*             INFORMATION BE DISPLAYED UPON RETURN TO THIS                
045530*             PROGRAM.  THEREFORE THE LIST QUEUE IS REBUILT.              
045531                                                                          
045532*             PERFORM 2050-DELETE-LIST-QUEUE                              
045533*             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                      84
045540*             PERFORM 4000-BUILD-INITIAL-PANEL                            
045600*            MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM            CL**6
045700*            MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                   CL**6
045800                                                                     CL**6
045900*            PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 VLKCS584
046000                                                                     CL**6
046100*            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS584
046200                                                                     CL**6
046300*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                   VLKCS584
046400                                                                  VLKCS584
046500         WHEN OTHER                                               VLKCS584
046600             SET DP013-LOGIC-ABEND                                   CL**6
046700                 DP013-NO-ROLLBACK TO TRUE                           CL**6
046800             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH       CL**6
046900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    VLKCS584
047000                                          TO DP013-MESSAGE-TEXT(1)   CL**6
047100             PERFORM DP013-0000-PROCESS-ABEND                     VLKCS584
047200     END-EVALUATE.                                                VLKCS584
047300                                                                  VLKCS584
047400*----------------------------------------------------------------*VLKCS584
047500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *VLKCS584
047600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *VLKCS584
047700*----------------------------------------------------------------*VLKCS584
047800 1100-PROCESS-INTER-APPL-COMM.                                    VLKCS584
047900                                                                  VLKCS584
048000     SET PS-COMMAREA-VALID TO TRUE.                                  CL**3
048100     MOVE SPACE TO ASC-START-ITEM-REQUEST.                           CL**3
048200                                                                     CL**3
048300     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT              CL**3
048310         CONTINUE                                                         
048400*        MOVE VN001-VENDOR-NAME         TO ASC-KEY-VEND-NAME         CL**3
048500*        MOVE VN001-VENDOR-TYPE         TO ASC-KEY-VEND-TYPE         CL**3
048600*        MOVE VN001-STATUS-CODE         TO ASC-KEY-STATUS-CODE       CL**3
048700*        MOVE VN001-INTER-APPL-COMMAREA TO ASC-HOLD-INTER-APPL    VLKCS584
048800     ELSE                                                         VLKCS584
048810         CONTINUE                                                         
048900*        IF DP020-NAV-KEY-DATA > SPACES                              CL**3
049000*            MOVE DP020-NAV-KEY-DATA TO ASC-KEY-VEND-NAME            CL**3
049100*        END-IF                                                      CL**3
049200*        MOVE 'A' TO ASC-KEY-STATUS-CODE                             CL**3
049300     END-IF.                                                         CL**3
049400                                                                  VLKCS584
049500*----------------------------------------------------------------*VLKCS584
049600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *VLKCS584
049700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *VLKCS584
049800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *VLKCS584
049900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *VLKCS584
050000* FUNCTION KEYS CAN GET THIS FAR.                                *VLKCS584
050100*----------------------------------------------------------------*VLKCS584
050200 2000-PROCESS-PANEL.                                              VLKCS584
050300                                                                  VLKCS584
050400     EVALUATE TRUE                                                VLKCS584
050500         WHEN DP020-SRC-AID = DP016-CLEAR                         VLKCS584
050600              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                  CL**6
050700                                                                     CL**6
050800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
050900                                                                     CL**6
051000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
051100                                                                  VLKCS584
051200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    VLKCS584
051300              PERFORM 2050-DELETE-LIST-QUEUE                         CL**6
051400                                                                     CL**6
051500              PERFORM 4000-BUILD-INITIAL-PANEL                       CL**6
051600                                                                  VLKCS584
051700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    VLKCS584
051800              PERFORM 2140-DESELECT-ALL-ITEMS                        CL**6
051900                                                                     CL**6
052000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
052100                                                                  VLKCS584
052200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  VLKCS584
052300              PERFORM 2150-SELECT-ALL-ITEMS                          CL**6
052400                                                                     CL**6
052500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**6
052600                                                                  VLKCS584
052700         WHEN OTHER                                               VLKCS584
052800              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                   CL**6
052900                                                                     CL**6
053000              PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**6
053100                                                                     CL**6
053200              IF PS-NO-ERROR                                         CL**6
053300                  SET DP030-CONTINUE-GO TO TRUE                      CL**6
053400                                                                     CL**6
053500                  PERFORM 2100-CHECK-FUNCTION-KEY                    CL**6
053600              ELSE                                                   CL**6
053700                  SET DP030-OVERRIDE-GO TO TRUE                      CL**6
053800              END-IF                                                 CL**6
053900     END-EVALUATE.                                                VLKCS584
054000                                                                  VLKCS584
054100*----------------------------------------------------------------*VLKCS584
054200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *VLKCS584
054300*----------------------------------------------------------------*VLKCS584
054400 2050-DELETE-LIST-QUEUE.                                          VLKCS584
054500                                                                  VLKCS584
054600     EXEC CICS                                                    VLKCS584
054700         DELETEQ TS                                               VLKCS584
054800             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS584
054900             RESP  (PV-CICS-RESP)                                 VLKCS584
055000     END-EXEC.                                                    VLKCS584
055100                                                                  VLKCS584
055200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       VLKCS584
055300        (PV-CICS-RESP = DFHRESP(QIDERR))                          VLKCS584
055400         CONTINUE                                                 VLKCS584
055500     ELSE                                                         VLKCS584
055600         SET DP013-CICS-ABEND                                        CL**6
055700             DP013-NO-ROLLBACK TO TRUE                               CL**6
055800                                                                  VLKCS584
055900         MOVE '2050-DELETE-LIST-QUEUE'                            VLKCS584
056000                                   TO DP013-PARAGRAPH             VLKCS584
056100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    VLKCS584
056200                                   TO DP013-MESSAGE-TEXT (1)      VLKCS584
056300         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
056400     END-IF.                                                      VLKCS584
056500                                                                  VLKCS584
056600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  VLKCS584
056700                                                                  VLKCS584
056800*----------------------------------------------------------------*VLKCS584
056900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*VLKCS584
057000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *VLKCS584
057100* CICS ARCHITECTURE API.                                         *VLKCS584
057200*----------------------------------------------------------------*VLKCS584
057300 2100-CHECK-FUNCTION-KEY.                                         VLKCS584
057400                                                                  VLKCS584
057500     EVALUATE TRUE                                                VLKCS584
057510* REQUEST ADD KEY WAS PRESSED                                             
057520         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                       
057521              MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS                   
057522*             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
057523                  INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
057524                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS                     *6
057525                                TO VL005-NUMBER-OF-SELECTED-ITEMS VLKCS584
057526                  PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
057527                  SET VL005-ADD TO TRUE                                   
057528* REQUEST INCLUDE KEY WAS PRESSED                                         
057529*        WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)                       
057530*             MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS                   
057531*             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
057532*                 INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
057533*                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                     *6
057534*                               TO VL005-NUMBER-OF-SELECTED-ITEMS VLKCS584
057535*                 PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
057540* REQUEST UPDATE KEY WAS PRESSED                                          
057550* REQUEST DELETE KEY WAS PRESSED                                          
057600         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)                     84
057610         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)                     84
057700              IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 CL**6
057800                  INITIALIZE VL005-INTER-APPL-COMMAREA               CL**6
057900                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS                  CL**6
058000                                TO VL005-NUMBER-OF-SELECTED-ITEMS VLKCS584
058100                  PERFORM 5000-PREPARE-SEL-QUEUE                     CL**6
058200              ELSE                                                   CL**6
058300                  SET DP030-OVERRIDE-GO                              CL**6
058400                      DP020-MSG-WARNING TO TRUE                      CL**6
058500                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER          CL**6
058600             END-IF                                               VLKCS584
058700                                                                  VLKCS584
058800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  VLKCS584
058900             MOVE +1               TO PV-TOP-ITEM                 VLKCS584
059000                                                                     CL**6
059100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS584
059200                                                                     CL**6
059300             PERFORM 3200-RESET-ATTRIBUTES                        VLKCS584
059400                                                                  VLKCS584
059500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   VLKCS584
059600             PERFORM 2110-BROWSE-BACKWARD                         VLKCS584
059700                                                                     CL**6
059800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS584
059900                                                                     CL**6
060000             PERFORM 3200-RESET-ATTRIBUTES                        VLKCS584
060100                                                                  VLKCS584
060200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   VLKCS584
060300             PERFORM 2120-BROWSE-FORWARD                          VLKCS584
060400                                                                     CL**6
060500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 VLKCS584
060600                                                                     CL**6
060700             PERFORM 3200-RESET-ATTRIBUTES                        VLKCS584
060800                                                                  POKCS015
060900         WHEN DP020-FK-DISPN-RETURN(DP020-SRC-AID)                POKCS015
061400             IF  ASC-NUMBER-OF-SELECTED-ITEMS = +1                POKCS015
061800                 PERFORM 5000-PREPARE-SEL-QUEUE                   POKCS015
061900             ELSE                                                 POKCS015
062000                 SET DP030-OVERRIDE-GO                            POKCS015
062100                                   TO TRUE                        POKCS015
062200                 MOVE PC-TSYMSG-00047                             POKCS015
062300                                   TO DP020-MSG-NUMBER            POKCS015
062400                 SET DP020-MSG-FATAL                              POKCS015
062500                                   TO TRUE                        POKCS015
062600             END-IF                                               POKCS015
062601                                                                  POKCS015
062602                                                                  VLKCS584
062603         WHEN DP020-SRC-AID = DP016-ENTER                         VLKCS584
062604*            PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   VLKCS584
062605                                                                     CL**6
062606             IF PS-ERROR                                             CL**6
062607                 CONTINUE                                         VLKCS584
062608             ELSE                                                 VLKCS584
062609                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             VLKCS584
062610             END-IF                                               VLKCS584
062611                                                                  VLKCS584
062612         WHEN OTHER                                               VLKCS584
062613             SET DP013-NO-ROLLBACK                                VLKCS584
062614                 DP013-XCTL-DISPLAY-RESTART                       VLKCS584
062615                 DP013-CICS-ABEND  TO TRUE                        VLKCS584
062616             MOVE '2100-CHECK-FUNCTION-KEY'                       VLKCS584
062617                                   TO DP013-PARAGRAPH             VLKCS584
062618             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      VLKCS584
062619                                   TO DP013-MESSAGE-TEXT (1)      VLKCS584
062620             PERFORM DP013-0000-PROCESS-ABEND                     VLKCS584
062700     END-EVALUATE.                                                VLKCS584
062800                                                                  VLKCS584
062900*----------------------------------------------------------------*VLKCS584
063000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *VLKCS584
063100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *VLKCS584
063200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *VLKCS584
063300*    MESSAGE.                                                    *VLKCS584
063400*----------------------------------------------------------------*VLKCS584
063500 2110-BROWSE-BACKWARD.                                            VLKCS584
063600                                                                  VLKCS584
063700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    VLKCS584
063800         GIVING PV-TOP-ITEM.                                      VLKCS584
063900                                                                  VLKCS584
064000     IF  ((PV-TOP-ITEM < +1)                                      VLKCS584
064100       OR (PV-TOP-ITEM = +1))                                     VLKCS584
064200         MOVE +1                   TO PV-TOP-ITEM                 VLKCS584
064300*        -- TOP OF LIST --                                        VLKCS584
064400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            VLKCS584
064500         SET DP020-MSG-INFORMATIONAL TO TRUE                      VLKCS584
064600     END-IF.                                                      VLKCS584
064700                                                                  VLKCS584
064800*----------------------------------------------------------------*VLKCS584
064900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *VLKCS584
065000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *VLKCS584
065100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *VLKCS584
065200*----------------------------------------------------------------*VLKCS584
065300 2120-BROWSE-FORWARD.                                             VLKCS584
065400                                                                  VLKCS584
065500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              VLKCS584
065600         GIVING PV-TOP-ITEM.                                      VLKCS584
065700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   VLKCS584
065800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VLKCS584
065900                                   TO PV-TOP-ITEM                 VLKCS584
066000*        -- BOTTOM OF LIST --                                     VLKCS584
066100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            VLKCS584
066200         SET DP020-MSG-INFORMATIONAL                              VLKCS584
066300                                   TO TRUE                        VLKCS584
066400     ELSE                                                         VLKCS584
066500         COMPUTE PV-BOTTOM-ITEM =                                 VLKCS584
066600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 VLKCS584
066700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            VLKCS584
066800*            -- BOTTOM OF LIST --                                 VLKCS584
066900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            VLKCS584
067000             SET DP020-MSG-INFORMATIONAL                          VLKCS584
067100                                   TO TRUE                        VLKCS584
067200         END-IF                                                   VLKCS584
067300     END-IF.                                                      VLKCS584
067400                                                                  VLKCS584
067500*----------------------------------------------------------------*VLKCS584
067600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *VLKCS584
067700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *VLKCS584
067800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *VLKCS584
067900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *VLKCS584
068000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *VLKCS584
068100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *VLKCS584
068200*----------------------------------------------------------------*VLKCS584
068300 2130-CHECK-FOR-JUMP-BROWSE.                                      VLKCS584
068400                                                                  VLKCS584
068500     SET PS-NO-ERROR               TO TRUE.                       VLKCS584
068600     IF (ASC-START-ITEM-REQUEST = SPACE)                          VLKCS584
068700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            VLKCS584
068800                                   TO PV-TOP-ITEM                 VLKCS584
068900     ELSE                                                         VLKCS584
069000         MOVE ASC-START-ITEM-REQUEST                              VLKCS584
069100                                   TO DP010I-UNEDITED-FIELD       VLKCS584
069200         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       VLKCS584
069300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     VLKCS584
069400         SET DP010I-NEGATIVE-NOT-ALLOWED                          VLKCS584
069500                                   TO TRUE                        VLKCS584
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
069700                                                                  VLKCS584
069800         IF  NOT DP010I-ERROR-DETECTED                            VLKCS584
069900             MOVE DP010I-NUMERIC-FIELD                            VLKCS584
070000                                   TO  ASC-START-ITEM-REQUEST-N   VLKCS584
070100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  VLKCS584
070200                 IF  ASC-START-ITEM-REQUEST-N >                   VLKCS584
070300                                          ASC-NUMBER-OF-ITEMS-READVLKCS584
070400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         VLKCS584
070500                     COMPUTE PV-TOP-ITEM =                        VLKCS584
070600                             ASC-NUMBER-OF-ITEMS-READ             VLKCS584
070700                             - PC-ITEMS-PER-PANEL + 1             VLKCS584
070800                     IF  PV-TOP-ITEM < +1                         VLKCS584
070900                         MOVE +1   TO PV-TOP-ITEM                 VLKCS584
071000                         MOVE PC-TSYMSG-00070                     VLKCS584
071100                                   TO DP020-MSG-NUMBER            VLKCS584
071200                         SET DP020-MSG-INFORMATIONAL              VLKCS584
071300                                   TO TRUE                        VLKCS584
071400                     END-IF                                       VLKCS584
071500                 ELSE                                             VLKCS584
071600                     MOVE ASC-START-ITEM-REQUEST-N                VLKCS584
071700                                   TO PV-TOP-ITEM                 VLKCS584
071800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      VLKCS584
071900                     COMPUTE PV-BOTTOM-ITEM =                     VLKCS584
072000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     VLKCS584
072100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READVLKCS584
072200*                        -- BOTTOM OF LIST --                     VLKCS584
072300                         MOVE PC-TSYMSG-00070                     VLKCS584
072400                                   TO DP020-MSG-NUMBER            VLKCS584
072500                         SET DP020-MSG-INFORMATIONAL              VLKCS584
072600                                   TO TRUE                        VLKCS584
072700                     END-IF                                       VLKCS584
072800                 END-IF                                           VLKCS584
072900             ELSE                                                 VLKCS584
072910                CONTINUE                                                  
073000*                --- VALUE OUT OF RANGE ----                      VLKCS584
073100*                MOVE PC-TSYMSG-00101                             VLKCS584
073200*                                  TO DP020-MSG-NUMBER            VLKCS584
073300*                MOVE -1           TO ASTRTITL                    VLKCS584
073400*                SET DP030-SET-CURSOR-APPL-1                      VLKCS584
073500*                                  TO TRUE                        VLKCS584
073600*                MOVE DP015-REVERSE                               VLKCS584
073700*                                  TO ASTRTITH                    VLKCS584
073800*                MOVE DP015-RED    TO ASTRTITC                    VLKCS584
073900*                MOVE DP015-UNP-NUM-BRT-MDT                       VLKCS584
074000*                                  TO ASTRTITA                    VLKCS584
074100*                SET DP020-MSG-FATAL                              VLKCS584
074200*                                  TO TRUE                        VLKCS584
074300*                SET PS-ERROR      TO TRUE                        VLKCS584
074400             END-IF                                               VLKCS584
074500                                                                  VLKCS584
074600         ELSE                                                     VLKCS584
074610             CONTINUE                                                     
074700*            MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            VLKCS584
074800*            MOVE -1               TO ASTRTITL                    VLKCS584
074900*            SET DP030-SET-CURSOR-APPL-1 TO TRUE                  VLKCS584
075000*            MOVE DP015-REVERSE    TO ASTRTITH                    VLKCS584
075100*            MOVE DP015-RED        TO ASTRTITC                    VLKCS584
075200*            MOVE DP015-UNP-NUM-BRT-MDT                           VLKCS584
075300*                                  TO ASTRTITA                    VLKCS584
075400*            SET DP020-MSG-FATAL   TO TRUE                        VLKCS584
075500*            SET PS-ERROR          TO TRUE                        VLKCS584
075600         END-IF                                                   VLKCS584
075700     END-IF.                                                      VLKCS584
075800                                                                  VLKCS584
075900*----------------------------------------------------------------*VLKCS584
076000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *VLKCS584
076100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *VLKCS584
076200*----------------------------------------------------------------*VLKCS584
076300 2140-DESELECT-ALL-ITEMS.                                         VLKCS584
076400                                                                  VLKCS584
076500     MOVE +1                       TO ASC-BLK-SUB.                VLKCS584
076600                                                                  VLKCS584
076700     PERFORM 2141-CLEAR-SELECTED-INDS                             VLKCS584
076800         VARYING ASC-ITEM-SUB                                     VLKCS584
076900         FROM 1 BY 1                                              VLKCS584
077000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS584
077100                                                                  VLKCS584
077200     ADD +1                        TO ASC-BLK-SUB.                VLKCS584
077300                                                                  VLKCS584
077400     PERFORM 2141-CLEAR-SELECTED-INDS                             VLKCS584
077500         VARYING ASC-ITEM-SUB                                     VLKCS584
077600         FROM 1 BY 1                                              VLKCS584
077700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS584
077800                                                                  VLKCS584
077900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS584
078000                                   TO PV-LIST-ITEM-NUMBER.        VLKCS584
078100                                                                  VLKCS584
078200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS584
078300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS584
078400                                                                  VLKCS584
078500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VLKCS584
078600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      VLKCS584
078700         MOVE +1                   TO ASC-BLK-SUB                 VLKCS584
078800                                                                  VLKCS584
078900         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS584
079000                                                                  VLKCS584
079100         MOVE +1                   TO PV-BLOCK-NUMBER             VLKCS584
079200                                                                  VLKCS584
079300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS584
079400             PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS584
079500                                                                  VLKCS584
079600         PERFORM                                                  VLKCS584
079700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VLKCS584
079800                                                                  VLKCS584
079900             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
080000                                                                  VLKCS584
080100             PERFORM 2141-CLEAR-SELECTED-INDS                     VLKCS584
080200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 VLKCS584
080300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS584
080400                                                                  VLKCS584
080500             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
080600                                                                  VLKCS584
080700             ADD +1                TO PV-BLOCK-NUMBER             VLKCS584
080800                                                                  VLKCS584
080900         END-PERFORM                                              VLKCS584
081000                                                                  VLKCS584
081100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS584
081200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS584
081300                                                                  VLKCS584
081400         PERFORM                                                  VLKCS584
081500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS584
081600                   ASC-HIGHEST-BLOCK-WRITTEN                      VLKCS584
081700                                                                  VLKCS584
081800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS584
081900                                   TO PV-BLOCK-NUMBER             VLKCS584
082000                                                                  VLKCS584
082100             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
082200                                                                  VLKCS584
082300             PERFORM 2141-CLEAR-SELECTED-INDS                     VLKCS584
082400                 VARYING ASC-ITEM-SUB                             VLKCS584
082500                 FROM 1 BY 1                                      VLKCS584
082600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS584
082700                                                                  VLKCS584
082800             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
082900                                                                  VLKCS584
083000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS584
083100                                                                  VLKCS584
083200         END-PERFORM                                              VLKCS584
083300                                                                  VLKCS584
083400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS584
083500                                   TO PV-BLOCK-NUMBER             VLKCS584
083600                                                                  VLKCS584
083700         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS584
083800     END-IF.                                                      VLKCS584
083900                                                                  VLKCS584
084000                                                                  VLKCS584
084100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. VLKCS584
084200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.VLKCS584
084300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  VLKCS584
084400                                                                  VLKCS584
084500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VLKCS584
084600                                                                  VLKCS584
084700*----------------------------------------------------------------*VLKCS584
084800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *VLKCS584
084900*----------------------------------------------------------------*VLKCS584
085000 2141-CLEAR-SELECTED-INDS.                                        VLKCS584
085100                                                                  VLKCS584
085200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS584
085300             NOT EQUAL ZERO                                       VLKCS584
085400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS584
085500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS584
085600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    VLKCS584
085700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VLKCS584
085800                                   TO TRUE                        VLKCS584
085900         END-IF                                                   VLKCS584
086000     END-IF.                                                      VLKCS584
086100                                                                  VLKCS584
086200*----------------------------------------------------------------*VLKCS584
086300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *VLKCS584
086400*  FOR ALL ITEMS.                                                *VLKCS584
086500*----------------------------------------------------------------*VLKCS584
086600 2150-SELECT-ALL-ITEMS.                                           VLKCS584
086700                                                                  VLKCS584
086800     MOVE +1                       TO ASC-BLK-SUB.                VLKCS584
086900                                                                  VLKCS584
087000     PERFORM 2151-SET-SELECTED-INDS                               VLKCS584
087100         VARYING ASC-ITEM-SUB                                     VLKCS584
087200         FROM 1 BY 1                                              VLKCS584
087300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS584
087400                                                                  VLKCS584
087500     ADD +1                        TO ASC-BLK-SUB.                VLKCS584
087600                                                                  VLKCS584
087700     PERFORM 2151-SET-SELECTED-INDS                               VLKCS584
087800         VARYING ASC-ITEM-SUB                                     VLKCS584
087900         FROM 1 BY 1                                              VLKCS584
088000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS584
088100                                                                  VLKCS584
088200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS584
088300                                   TO PV-LIST-ITEM-NUMBER.        VLKCS584
088400                                                                  VLKCS584
088500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS584
088600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS584
088700                                                                  VLKCS584
088800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     VLKCS584
088900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    VLKCS584
089000         MOVE +1                   TO ASC-BLK-SUB                 VLKCS584
089100                                                                  VLKCS584
089200         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS584
089300                                                                  VLKCS584
089400         MOVE +1                   TO PV-BLOCK-NUMBER             VLKCS584
089500                                                                  VLKCS584
089600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS584
089700             PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS584
089800                                                                  VLKCS584
089900         PERFORM                                                  VLKCS584
090000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       VLKCS584
090100                                                                  VLKCS584
090200             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
090300                                                                  VLKCS584
090400             PERFORM 2151-SET-SELECTED-INDS                       VLKCS584
090500                 VARYING ASC-ITEM-SUB                             VLKCS584
090600                 FROM 1 BY 1                                      VLKCS584
090700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS584
090800                                                                  VLKCS584
090900             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
091000                                                                  VLKCS584
091100             ADD +1                TO PV-BLOCK-NUMBER             VLKCS584
091200                                                                  VLKCS584
091300         END-PERFORM                                              VLKCS584
091400                                                                  VLKCS584
091500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS584
091600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS584
091700                                                                  VLKCS584
091800         PERFORM                                                  VLKCS584
091900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS584
092000                   ASC-HIGHEST-BLOCK-WRITTEN                      VLKCS584
092100                                                                  VLKCS584
092200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS584
092300                                   TO PV-BLOCK-NUMBER             VLKCS584
092400                                                                  VLKCS584
092500             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
092600                                                                  VLKCS584
092700             PERFORM 2151-SET-SELECTED-INDS                       VLKCS584
092800                 VARYING ASC-ITEM-SUB                             VLKCS584
092900                 FROM 1 BY 1                                      VLKCS584
093000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS584
093100                                                                  VLKCS584
093200             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
093300                                                                  VLKCS584
093400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS584
093500                                                                  VLKCS584
093600         END-PERFORM                                              VLKCS584
093700                                                                  VLKCS584
093800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS584
093900                                   TO PV-BLOCK-NUMBER             VLKCS584
094000                                                                  VLKCS584
094100         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS584
094200     END-IF.                                                      VLKCS584
094300                                                                  VLKCS584
094400                                                                  VLKCS584
094500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             VLKCS584
094600                       ASC-NUMBER-OF-SELECTED-ITEMS.              VLKCS584
094700                                                                  VLKCS584
094800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        VLKCS584
094900                                                                  VLKCS584
095000*----------------------------------------------------------------*VLKCS584
095100*    MARK EACH ITEM AS BEING SELECTED.                           *VLKCS584
095200*----------------------------------------------------------------*VLKCS584
095300 2151-SET-SELECTED-INDS.                                          VLKCS584
095400                                                                  VLKCS584
095500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS584
095600             NOT EQUAL ZERO                                       VLKCS584
095700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS584
095800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS584
095900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS584
096000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  VLKCS584
096100                               TO  TRUE                           VLKCS584
096200         END-IF                                                   VLKCS584
096300     END-IF.                                                      VLKCS584
096400                                                                  VLKCS584
096500******************************************************************VLKCS584
096600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **VLKCS584
096700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **VLKCS584
096800******************************************************************VLKCS584
096900 2200-MOVE-SCREEN-TO-COMMAREA.                                    VLKCS584
097000                                                                  VLKCS584
097100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             VLKCS584
097200     MOVE +1                       TO PV-SUB.                     VLKCS584
097300                                                                  VLKCS584
097400     PERFORM 3100-SET-SUBSCRIPTS.                                 VLKCS584
097500*    IF  ASTRTITL > ZERO                                          VLKCS584
097600*        MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          VLKCS584
097700*    ELSE                                                         VLKCS584
097800*        IF  ASTRTITF = DP015-ERASE-EOF                           VLKCS584
097900*            INITIALIZE ASC-START-ITEM-REQUEST                    VLKCS584
098000*        END-IF                                                   VLKCS584
098100*    END-IF.                                                      VLKCS584
098200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          VLKCS584
098300         VARYING PV-SUB                                           VLKCS584
098400         FROM 1 BY 1                                              VLKCS584
098500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      VLKCS584
098600                                                                  VLKCS584
098700******************************************************************VLKCS584
098800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**VLKCS584
098900******************************************************************VLKCS584
099000 2210-MOVE-LINES-TO-COMMAREA.                                     VLKCS584
099100                                                                  VLKCS584
099200     IF  MR-SELECTL (PV-SUB) > ZERO                               VLKCS584
099300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             VLKCS584
099400         MOVE MR-SELECTI (PV-SUB)                                 VLKCS584
099500                                   TO ASC-TEMP-SELECTED-SW        VLKCS584
099600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS584
099700     ELSE                                                         VLKCS584
099800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                VLKCS584
099900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     VLKCS584
100000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        VLKCS584
100100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS584
100200         END-IF                                                   VLKCS584
100300     END-IF.                                                      VLKCS584
100400     ADD +1                        TO ASC-ITEM-SUB.               VLKCS584
100500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VLKCS584
100600         ADD +1                    TO ASC-BLK-SUB                 VLKCS584
100700         MOVE +1                   TO ASC-ITEM-SUB                VLKCS584
100800     END-IF.                                                      VLKCS584
100900                                                                  VLKCS584
101000******************************************************************VLKCS584
101100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **VLKCS584
101200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **VLKCS584
101300******************************************************************VLKCS584
101400 3000-EDIT-DATA-IN-COMMAREA.                                      VLKCS584
101500                                                                  VLKCS584
101600     SET PS-NO-ERROR               TO TRUE.                       VLKCS584
101700     PERFORM 3200-RESET-ATTRIBUTES.                               VLKCS584
101800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     VLKCS584
101900**                                                                VLKCS584
102000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              VLKCS584
102100* EDITTING IS DONE FROM THE BOTTOM UP.                            VLKCS584
102200**                                                                VLKCS584
102300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       VLKCS584
102400         ASC-ITEMS-DISPLAYED - 1.                                 VLKCS584
102500     PERFORM 3100-SET-SUBSCRIPTS.                                 VLKCS584
102600     PERFORM 3300-EDIT-SELECTIONS                                 VLKCS584
102700         VARYING PV-SUB                                           VLKCS584
102800         FROM PV-SUB BY -1                                        VLKCS584
102900         UNTIL PV-SUB < +1                                        VLKCS584
103000                                                                  VLKCS584
103100     IF  PS-NO-ERROR                                              VLKCS584
103200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        VLKCS584
103300     END-IF.                                                      VLKCS584
103400                                                                  VLKCS584
103500     IF  ((PS-NO-ERROR)                                           VLKCS584
103600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   VLKCS584
103700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    VLKCS584
103800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  VLKCS584
103900     END-IF.                                                      VLKCS584
104000                                                                  VLKCS584
104100*----------------------------------------------------------------*VLKCS584
104200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *VLKCS584
104300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*VLKCS584
104400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *VLKCS584
104500*                                                                *VLKCS584
104600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *VLKCS584
104700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *VLKCS584
104800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *VLKCS584
104900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *VLKCS584
105000*----------------------------------------------------------------*VLKCS584
105100 3100-SET-SUBSCRIPTS.                                             VLKCS584
105200                                                                  VLKCS584
105300     COMPUTE ASC-ITEM-SUB =                                       VLKCS584
105400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        VLKCS584
105500                                                                  VLKCS584
105600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         VLKCS584
105700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VLKCS584
105800                                                                  VLKCS584
105900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               VLKCS584
106000     ELSE                                                         VLKCS584
106100         MOVE +1                     TO ASC-BLK-SUB               VLKCS584
106200     END-IF.                                                      VLKCS584
106300                                                                  VLKCS584
106400******************************************************************VLKCS584
106500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **VLKCS584
106600******************************************************************VLKCS584
106700 3200-RESET-ATTRIBUTES.                                           VLKCS584
106800                                                                  VLKCS584
106900*    MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      VLKCS584
107000*    MOVE DP015-GREEN           TO ASTRTITC.                      VLKCS584
107100*    MOVE DP015-UNDERLINE       TO ASTRTITH.                      VLKCS584
107200                                                                  VLKCS584
107300     IF DP020-NEXT-ACT-RETURN OR                                  VLKCS584
107400        DP020-NEXT-ACT-READ-MAP                                   VLKCS584
107500         PERFORM VARYING PV-SUB  FROM 1 BY 1                      VLKCS584
107600                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             VLKCS584
107700                  MOVE DP015-UNP-ALP-NOR-OFF                      VLKCS584
107800                                       TO MR-SELECTA (PV-SUB)     VLKCS584
107900                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     VLKCS584
108000                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     VLKCS584
108100         END-PERFORM                                              VLKCS584
108200     ELSE                                                         VLKCS584
108300         PERFORM VARYING PV-SUB  FROM 1 BY 1                      VLKCS584
108400                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              VLKCS584
108500                  MOVE DP015-UNP-ALP-NOR-OFF                      VLKCS584
108600                                       TO MR-SELECTA (PV-SUB)     VLKCS584
108700                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     VLKCS584
108800                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     VLKCS584
108900         END-PERFORM.                                             VLKCS584
109000                                                                  VLKCS584
109100******************************************************************VLKCS584
109200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **VLKCS584
109300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **VLKCS584
109400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **VLKCS584
109500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **VLKCS584
109600******************************************************************VLKCS584
109700 3300-EDIT-SELECTIONS.                                            VLKCS584
109800                                                                  VLKCS584
109900     EVALUATE TRUE                                                VLKCS584
110000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VLKCS584
110100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS584
110200                 CONTINUE                                         VLKCS584
110300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         VLKCS584
110400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS584
110500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   VLKCS584
110600                 MOVE ASC-TEMP-SELECTED-SW                        VLKCS584
110700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS584
110800                                TO ASC-SELECTED-SW                VLKCS584
110900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS584
111000             END-IF                                               VLKCS584
111100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     VLKCS584
111200                 = SPACE                                          VLKCS584
111300             EVALUATE TRUE                                        VLKCS584
111400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       VLKCS584
111500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSVLKCS584
111600                     MOVE SPACE TO ASC-SELECTED-SW                VLKCS584
111700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS584
111800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        VLKCS584
111900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    VLKCS584
112000                     MOVE SPACE TO ASC-SELECTED-SW                VLKCS584
112100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS584
112200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS584
112300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      VLKCS584
112400                     MOVE SPACE TO ASC-SELECTED-SW                VLKCS584
112500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS584
112600             END-EVALUATE                                         VLKCS584
112700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           VLKCS584
112800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS584
112900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS584
113000             END-IF                                               VLKCS584
113100             PERFORM 3310-EDIT-RANGE                              VLKCS584
113200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             VLKCS584
113300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS584
113400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS584
113500             END-IF                                               VLKCS584
113600             PERFORM 3310-EDIT-RANGE                              VLKCS584
113700         WHEN OTHER                                               VLKCS584
113800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           VLKCS584
113900             SET DP020-MSG-FATAL    TO TRUE                       VLKCS584
114000             MOVE -1                TO MR-SELECTL (PV-SUB)        VLKCS584
114100             SET DP030-SET-CURSOR-APPL-1                          VLKCS584
114200                                    TO TRUE                       VLKCS584
114300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        VLKCS584
114400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        VLKCS584
114500             SET PS-ERROR TO TRUE                                 VLKCS584
114600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            VLKCS584
114700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     VLKCS584
114800                 MOVE SPACE         TO ASC-SELECTED-SW            VLKCS584
114900                                        (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS584
115000             END-IF                                               VLKCS584
115100     END-EVALUATE.                                                VLKCS584
115200                                                                  VLKCS584
115300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 VLKCS584
115400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               VLKCS584
115500     IF  ASC-ITEM-SUB < 1                                         VLKCS584
115600         SUBTRACT +1 FROM ASC-BLK-SUB                             VLKCS584
115700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                VLKCS584
115800     END-IF.                                                      VLKCS584
115900                                                                  VLKCS584
116000******************************************************************VLKCS584
116100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **VLKCS584
116200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **VLKCS584
116300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**VLKCS584
116400** THE ENDING.                                                  **VLKCS584
116500******************************************************************VLKCS584
116600 3310-EDIT-RANGE.                                                 VLKCS584
116700                                                                  VLKCS584
116800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                VLKCS584
116900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   VLKCS584
117000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS584
117100                                   TO ASC-SELECTED-SW             VLKCS584
117200                                        (ASC-BLK-SUB ASC-ITEM-SUB)VLKCS584
117300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE VLKCS584
117400         ELSE                                                     VLKCS584
117500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     VLKCS584
117600                 CONTINUE                                         VLKCS584
117700             ELSE                                                 VLKCS584
117800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        VLKCS584
117900                 MOVE PC-TSYMSG-00054                             VLKCS584
118000                                   TO DP020-MSG-NUMBER            VLKCS584
118100                 SET DP020-MSG-FATAL                              VLKCS584
118200                                   TO TRUE                        VLKCS584
118300                 MOVE -1           TO MR-SELECTL (PV-SUB)         VLKCS584
118400                 SET DP030-SET-CURSOR-APPL-1                      VLKCS584
118500                                   TO TRUE                        VLKCS584
118600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         VLKCS584
118700                 MOVE DP015-UNDERLINE                             VLKCS584
118800                                   TO MR-SELECTH (PV-SUB)         VLKCS584
118900                 SET PS-ERROR      TO TRUE                        VLKCS584
119000             END-IF                                               VLKCS584
119100         END-IF                                                   VLKCS584
119200     ELSE                                                         VLKCS584
119300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VLKCS584
119400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS584
119500                                   TO ASC-SELECTED-SW             VLKCS584
119600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   VLKCS584
119700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   VLKCS584
119800         ELSE                                                     VLKCS584
119900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       VLKCS584
120000                 CONTINUE                                         VLKCS584
120100             ELSE                                                 VLKCS584
120200*                -- ONLY ONE END-OF-RANGE ALLOWED --              VLKCS584
120300                 MOVE PC-TSYMSG-00055                             VLKCS584
120400                                   TO DP020-MSG-NUMBER            VLKCS584
120500                 SET DP020-MSG-FATAL                              VLKCS584
120600                                   TO TRUE                        VLKCS584
120700                 MOVE -1           TO MR-SELECTL (PV-SUB)         VLKCS584
120800                 SET DP030-SET-CURSOR-APPL-1                      VLKCS584
120900                                   TO TRUE                        VLKCS584
121000                 SET PS-ERROR      TO TRUE                        VLKCS584
121100             END-IF                                               VLKCS584
121200         END-IF                                                   VLKCS584
121300     END-IF.                                                      VLKCS584
121400                                                                  VLKCS584
121500******************************************************************VLKCS584
121600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **VLKCS584
121700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **VLKCS584
121800******************************************************************VLKCS584
121900 3400-CHECK-RANGE-SEQUENCE.                                       VLKCS584
122000                                                                  VLKCS584
122100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VLKCS584
122200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      VLKCS584
122300       AND  ASC-START-OF-SELECTED-RANGE >                         VLKCS584
122400                                         ASC-END-OF-SELECTED-RANGEVLKCS584
122500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                VLKCS584
122600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 VLKCS584
122700         SET DP020-MSG-FATAL TO TRUE                              VLKCS584
122800         SET PS-ERROR TO TRUE                                     VLKCS584
122900         PERFORM 3410-POSITION-AT-ERROR                           VLKCS584
123000     END-IF.                                                      VLKCS584
123100                                                                  VLKCS584
123200******************************************************************VLKCS584
123300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **VLKCS584
123400** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **VLKCS584
123500** SHOULD BE POSITIONED ON A RANGE ERROR.                       **VLKCS584
123600******************************************************************VLKCS584
123700 3410-POSITION-AT-ERROR.                                          VLKCS584
123800                                                                  VLKCS584
123900     SET DP030-SET-CURSOR-APPL-1                                  VLKCS584
124000                                   TO TRUE.                       VLKCS584
124100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VLKCS584
124200                    - PV-TOP-ITEM + 1.                            VLKCS584
124300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS584
124400         CONTINUE                                                 VLKCS584
124500     ELSE                                                         VLKCS584
124600         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS584
124700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS584
124800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VLKCS584
124900     END-IF.                                                      VLKCS584
125000                                                                  VLKCS584
125100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VLKCS584
125200                    - PV-TOP-ITEM + 1.                            VLKCS584
125300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS584
125400         CONTINUE                                                 VLKCS584
125500     ELSE                                                         VLKCS584
125600         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS584
125700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS584
125800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         VLKCS584
125900     END-IF.                                                      VLKCS584
126000                                                                  VLKCS584
126100*----------------------------------------------------------------*VLKCS584
126200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *VLKCS584
126300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *VLKCS584
126400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *VLKCS584
126500*----------------------------------------------------------------*VLKCS584
126600 3500-MARK-RANGE-AS-SELECTED.                                     VLKCS584
126700                                                                  VLKCS584
126800     MOVE +1                       TO  ASC-BLK-SUB.               VLKCS584
126900     PERFORM 3510-MARK-SELECTED-INDS                              VLKCS584
127000         VARYING ASC-ITEM-SUB                                     VLKCS584
127100         FROM 1 BY 1                                              VLKCS584
127200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS584
127300                                                                  VLKCS584
127400     ADD +1                        TO ASC-BLK-SUB.                VLKCS584
127500     PERFORM 3510-MARK-SELECTED-INDS                              VLKCS584
127600         VARYING ASC-ITEM-SUB                                     VLKCS584
127700         FROM 1 BY 1                                              VLKCS584
127800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 VLKCS584
127900                                                                  VLKCS584
128000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               VLKCS584
128100                                   TO  PV-LIST-ITEM-NUMBER.       VLKCS584
128200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            VLKCS584
128300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         VLKCS584
128400               PC-ITEMS-PER-PANEL).                               VLKCS584
128500                                                                  VLKCS584
128600     MOVE ASC-START-OF-SELECTED-RANGE                             VLKCS584
128700                                   TO PV-START-OF-SELECTED-RANGE. VLKCS584
128800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            VLKCS584
128900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  VLKCS584
129000               PC-ITEMS-PER-PANEL).                               VLKCS584
129100                                                                  VLKCS584
129200     MOVE ASC-END-OF-SELECTED-RANGE                               VLKCS584
129300                                   TO  PV-END-OF-SELECTED-RANGE.  VLKCS584
129400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             VLKCS584
129500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    VLKCS584
129600               PC-ITEMS-PER-PANEL).                               VLKCS584
129700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             VLKCS584
129800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             VLKCS584
129900                                                                  VLKCS584
130000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    VLKCS584
130100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        VLKCS584
130200         MOVE +1                   TO ASC-BLK-SUB                 VLKCS584
130300         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS584
130400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         VLKCS584
130500             PV-FIRST-BLOCK-IN-ARRAY - 1                          VLKCS584
130600                                                                  VLKCS584
130700         PERFORM                                                  VLKCS584
130800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      VLKCS584
130900                   PV-PREV-BLOCK-IN-ARRAY                         VLKCS584
131000             MOVE PV-FIRST-BLOCK-IN-RANGE                         VLKCS584
131100                                   TO PV-BLOCK-NUMBER             VLKCS584
131200             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
131300             PERFORM 3510-MARK-SELECTED-INDS                      VLKCS584
131400                 VARYING ASC-ITEM-SUB                             VLKCS584
131500                 FROM 1 BY 1                                      VLKCS584
131600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS584
131700             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
131800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     VLKCS584
131900         END-PERFORM                                              VLKCS584
132000                                                                  VLKCS584
132100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         VLKCS584
132200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     VLKCS584
132300         PERFORM                                                  VLKCS584
132400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       VLKCS584
132500                   PV-LAST-BLOCK-IN-RANGE                         VLKCS584
132600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          VLKCS584
132700                                   TO PV-BLOCK-NUMBER             VLKCS584
132800             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
132900             PERFORM 3510-MARK-SELECTED-INDS                      VLKCS584
133000                 VARYING ASC-ITEM-SUB                             VLKCS584
133100                 FROM 1 BY 1                                      VLKCS584
133200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          VLKCS584
133300             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
133400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      VLKCS584
133500         END-PERFORM                                              VLKCS584
133600                                                                  VLKCS584
133700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             VLKCS584
133800                                   TO PV-BLOCK-NUMBER             VLKCS584
133900         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS584
134000     END-IF.                                                      VLKCS584
134100                                                                  VLKCS584
134200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE VLKCS584
134300                                      ASC-END-OF-SELECTED-RANGE.  VLKCS584
134400                                                                  VLKCS584
134500*----------------------------------------------------------------*VLKCS584
134600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *VLKCS584
134700*----------------------------------------------------------------*VLKCS584
134800 3510-MARK-SELECTED-INDS.                                         VLKCS584
134900                                                                  VLKCS584
135000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VLKCS584
135100                                ASC-ITEM-SUB) >                   VLKCS584
135200         ASC-START-OF-SELECTED-RANGE)                             VLKCS584
135300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         VLKCS584
135400                                ASC-ITEM-SUB) =                   VLKCS584
135500         ASC-START-OF-SELECTED-RANGE)                             VLKCS584
135600                                                                  VLKCS584
135700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VLKCS584
135800                                    ASC-ITEM-SUB) <               VLKCS584
135900             ASC-END-OF-SELECTED-RANGE)                           VLKCS584
136000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     VLKCS584
136100                                    ASC-ITEM-SUB) =               VLKCS584
136200             ASC-END-OF-SELECTED-RANGE)                           VLKCS584
136300                                                                  VLKCS584
136400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          VLKCS584
136500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   VLKCS584
136600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   VLKCS584
136700                               TO TRUE                            VLKCS584
136800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              VLKCS584
136900                               TO TRUE                            VLKCS584
137000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    VLKCS584
137100             END-IF                                               VLKCS584
137200         END-IF                                                   VLKCS584
137300     END-IF.                                                      VLKCS584
137400                                                                  VLKCS584
137500*----------------------------------------------------------------*VLKCS584
137600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *VLKCS584
137700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *VLKCS584
137800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *VLKCS584
137900*    DISPLAY THE PANEL TO USER.                                  *VLKCS584
138000*----------------------------------------------------------------*VLKCS584
138100 4000-BUILD-INITIAL-PANEL.                                        VLKCS584
138200                                                                  VLKCS584
138300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            VLKCS584
138400                                 ASC-BLOCK-ENTRIES (2).           VLKCS584
138500     MOVE +1                 TO ASC-BLK-SUB.                      VLKCS584
138600     SET ASC-ITEMS-LEFT-ON-DB                                     VLKCS584
138700                             TO TRUE.                             VLKCS584
138800                                                                  VLKCS584
138900     MOVE +0                 TO ASC-ITEM-SUB                      VLKCS584
139000                                ASC-NUMBER-OF-ITEMS-READ          VLKCS584
139100*                               ASC-NUMBER-OF-SELECTED-ITEMS      VLKCS584
139200                                ASC-HIGHEST-BLOCK-WRITTEN         VLKCS584
139300                                ASC-START-OF-SELECTED-RANGE       VLKCS584
139400                                ASC-END-OF-SELECTED-RANGE         VLKCS584
139500                                ASC-ITEM-AT-TOP-OF-PANEL.         VLKCS584
139600                                                                  VLKCS584
139700*    PERFORM 4050-PREPARE-CURSOR-KEY                              VLKCS584
139800                                                                  VLKCS584
139900     PERFORM 4010-OPEN-CURSOR.                                    VLKCS584
140000                                                                  VLKCS584
140100     PERFORM 4200-READ-ITEMS-FROM-DB.                             VLKCS584
140200                                                                  VLKCS584
140300     PERFORM 4020-CLOSE-CURSOR.                                   VLKCS584
140400                                                                  VLKCS584
140500     MOVE +1                   TO  PV-TOP-ITEM.                   VLKCS584
140600*    IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          VLKCS584
140700*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    VLKCS584
140800*        SET DP020-MSG-FATAL   TO  TRUE                           VLKCS584
140900*        MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               VLKCS584
141000*    ELSE                                                         VLKCS584
141100         MOVE -1               TO MR-SELECTL (1).                 VLKCS584
141200         SET DP030-SET-CURSOR-APPL-1                              VLKCS584
141300                               TO TRUE.                           VLKCS584
141400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    VLKCS584
141500*    END-IF.                                                      VLKCS584
141600                                                                  VLKCS584
141700*----------------------------------------------------------------*VLKCS584
141800* PREPARE THE DB KEY BY REPLACING * WITH %                       *VLKCS584
141900*----------------------------------------------------------------*VLKCS584
142000*4050-PREPARE-CURSOR-KEY.                                         VLKCS584
142100*                                                                 VLKCS584
142200*    MOVE ASC-KEY-VEND-NAME    TO DK-VEND-NAME.                   VLKCS584
142300*    MOVE ASC-KEY-STATUS-CODE  TO DK-STATUS-CODE.                 VLKCS584
142400*    IF DK-VEND-NAME > SPACES                                     VLKCS584
142500*        IF DK-VEND-NAME-BYTE (1) = '*'                           VLKCS584
142600*            MOVE PC-PERCENT   TO DK-VEND-NAME-BYTE (1)           VLKCS584
142700*            INSPECT DK-VEND-NAME                                 VLKCS584
142800*                REPLACING FIRST '*' BY PC-PERCENT                VLKCS584
142900*        END-IF                                                   VLKCS584
143000*        SET PS-NOT-DONE TO TRUE                                  VLKCS584
143100*        PERFORM VARYING PV-SUB                                   VLKCS584
143200*            FROM LENGTH OF DK-VEND-NAME BY -1                    VLKCS584
143300*            UNTIL PV-SUB = 1                                     VLKCS584
143400*               OR PS-DONE                                        VLKCS584
143500*                IF DK-VEND-NAME-BYTE (PV-SUB) = '*'              VLKCS584
143600*                    MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)VLKCS584
143700*                    SET PS-DONE TO TRUE                          VLKCS584
143800*                END-IF                                           VLKCS584
143900**               IF DK-VEND-NAME-BYTE (PV-SUB) > SPACES           VLKCS584
144000*                    SET PS-DONE TO TRUE                          VLKCS584
144100*                ELSE                                             VLKCS584
144200*                    MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)VLKCS584
144300*                END-IF                                           VLKCS584
144400*        END-PERFORM                                              VLKCS584
144500*    ELSE                                                         VLKCS584
144600*        MOVE ALL '%' TO DK-VEND-NAME.                            VLKCS584
144700                                                                  VLKCS584
144800*----------------------------------------------------------------*VLKCS584
144900* OPEN  THE VENDOR   CURSOR.                                     *VLKCS584
145000*----------------------------------------------------------------*VLKCS584
145100 4010-OPEN-CURSOR.                                                VLKCS584
145200                                                                  VLKCS584
145300     PERFORM                                                      VLKCS584
145400         WITH TEST AFTER                                          VLKCS584
145500         VARYING PV-RETRY-COUNTER                                 VLKCS584
145600         FROM 1 BY 1                                              VLKCS584
145700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VLKCS584
145800                   OR (SQLCODE = ZERO))                           VLKCS584
145900             MOVE 'CURSOR:  TICKET-CSR'                           VLKCS584
146000                               TO DP013-MESSAGE-TEXT (2)          VLKCS584
146100             EXEC SQL                                             VLKCS584
146200                  OPEN TICKET-CSR                                 VLKCS584
146300             END-EXEC                                             VLKCS584
146400                                                                  VLKCS584
146500         EVALUATE TRUE                                            VLKCS584
146600             WHEN SQLCODE = ZERO                                  VLKCS584
146700             WHEN SQLCODE = -904                                  VLKCS584
146800             WHEN SQLCODE = -913                                  VLKCS584
146900                 CONTINUE                                         VLKCS584
147000             WHEN SQLWARN0 NOT = SPACES                           VLKCS584
147100             WHEN SQLCODE < ZERO                                  VLKCS584
147200             WHEN SQLCODE > ZERO                                  VLKCS584
147300                 MOVE '4010-OPEN-CURSOR'                          VLKCS584
147400                                   TO DP013-PARAGRAPH             VLKCS584
147500                 MOVE 'OPEN VENDOR CURSOR - '                     VLKCS584
147600                                   TO DP013-MESSAGE-TEXT (1)      VLKCS584
147700                 MOVE SQLCA        TO DP013-SQLCA                 VLKCS584
147800                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    VLKCS584
147900                 SET DP013-DB2-ABEND                              VLKCS584
148000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           VLKCS584
148100                 PERFORM DP013-0000-PROCESS-ABEND                 VLKCS584
148200         END-EVALUATE                                             VLKCS584
148300     END-PERFORM.                                                 VLKCS584
148400                                                                  VLKCS584
148500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        VLKCS584
148600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             VLKCS584
148700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   VLKCS584
148800                                   TO DP013-MESSAGE-TEXT (1)      VLKCS584
148900         MOVE SQLCA                TO DP013-SQLCA                 VLKCS584
149000         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    VLKCS584
149100         SET DP013-DB2-ABEND                                      VLKCS584
149200             DP013-XCTL-DISPLAY-RESTART                           VLKCS584
149300                                   TO TRUE                        VLKCS584
149400         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
149500     END-IF.                                                      VLKCS584
149600                                                                  VLKCS584
149700*----------------------------------------------------------------*VLKCS584
149800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *VLKCS584
149900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *VLKCS584
150000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *VLKCS584
150100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *VLKCS584
150200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *VLKCS584
150300*----------------------------------------------------------------*VLKCS584
150400 4200-READ-ITEMS-FROM-DB.                                         VLKCS584
150500                                                                  VLKCS584
150600     PERFORM VARYING PV-READ-COUNT  FROM 1 BY 1                      CL**3
150700             UNTIL   PV-READ-COUNT > PC-MAX-ITEMS OR                 CL**3
150800                     ASC-NO-ITEMS-LEFT-ON-DB                         CL**3
150900                                                                  VLKCS584
151000             PERFORM 4210-FETCH                                      CL**3
151100                                                                  VLKCS584
151200             IF ASC-ITEMS-LEFT-ON-DB                                 CL**3
151300                IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                 CL**3
151400                    CONTINUE                                         CL*10
151500                ELSE                                                 CL**3
151600                    ADD  +1 TO ASC-BLK-SUB                           CL**3
151700                    MOVE +0 TO ASC-ITEM-SUB                          CL**9
151800                    IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY          CL**3
151900                        MOVE +1 TO ASC-BLK-SUB                       CL**3
152000                        SET ASC-BLOCK-MODIFIED (1) TO TRUE           CL**3
152100                                                                     CL**3
152200                        PERFORM 5100-WRITE-TEMP-STORAGE              CL**3
152300                                                                     CL**3
152400                        MOVE ASC-BLOCK-ENTRIES                       CL**3
152500                                          (PC-MAX-BLOCKS-IN-ARRAY)   CL**3
152600                                TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
152700                        ADD +1 TO ASC-BLK-SUB                        CL**3
152800                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CL**3
152900                        SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB)   CL**3
153000                                                           TO TRUE   CL**3
153100                    END-IF                                           CL**3
153200                END-IF                                               CL**3
153300                PERFORM 4220-MOVE-DB-ITEMS THRU 4220-EXIT               10
153400             END-IF                                                  CL**3
153500     END-PERFORM.                                                 VLKCS584
153600                                                                  VLKCS584
153700     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                              CL**3
153800         MOVE +1 TO ASC-BLK-SUB                                      CL**3
153900                                                                     CL**3
154000         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS584
154100                                                                     CL**3
154200         ADD  +1 TO ASC-BLK-SUB                                      CL**3
154300                                                                     CL**8
154400         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS584
154500                                                                  VLKCS584
154600         MOVE 1  TO ASC-BLK-SUB                                      CL**3
154700                    PV-BLOCK-NUMBER                                  CL**3
154800                                                                     CL**3
154900         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS584
155000                                                                     CL**3
155100         IF ASC-HIGHEST-BLOCK-WRITTEN > 1                            CL**3
155200             MOVE 2 TO ASC-BLK-SUB                                   CL**3
155300                       PV-BLOCK-NUMBER                               CL**3
155400                                                                     CL**3
155500             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
155600         END-IF                                                   VLKCS584
155700     END-IF.                                                      VLKCS584
155800                                                                  VLKCS584
155900 4210-FETCH.                                                      VLKCS584
156000                                                                  VLKCS584
156100     EXEC SQL                                                     VLKCS584
156200          FETCH TICKET-CSR                                        VLKCS584
156300          INTO  :PLDESC-TKT-PLCMNT-CDE                               CL**3
156400               ,:PLDESC-TKT-PLCMNT-DESC                                 *3
156900     END-EXEC                                                     VLKCS584
157000                                                                  VLKCS584
157100     EVALUATE TRUE                                                VLKCS584
157200         WHEN SQLCODE = ZERO                                      VLKCS584
157300         WHEN SQLCODE = +100                                      VLKCS584
157400              CONTINUE                                            VLKCS584
157500         WHEN SQLWARN0 NOT = SPACE                                VLKCS584
157600         WHEN SQLCODE NOT = ZERO                                  VLKCS584
157700              MOVE '4310-FETCH-CURSOR'                            VLKCS584
157800                               TO DP013-PARAGRAPH                 VLKCS584
157900              MOVE 'FETCH VENDOR CURSOR'                          VLKCS584
158000                               TO DP013-MESSAGE-TEXT (1)          VLKCS584
158100              MOVE SQLCA       TO DP013-SQLCA                     VLKCS584
158200              SET DP013-DB2-ABEND                                 VLKCS584
158300                               TO TRUE                            VLKCS584
158400              PERFORM DP013-0000-PROCESS-ABEND                    VLKCS584
158500     END-EVALUATE.                                                VLKCS584
158600                                                                  VLKCS584
158700     IF  SQLCODE EQUAL +100                                       VLKCS584
158800         SET ASC-NO-ITEMS-LEFT-ON-DB                              VLKCS584
158900                                   TO TRUE                        VLKCS584
159000     END-IF.                                                      VLKCS584
159100                                                                  VLKCS584
159200 4220-MOVE-DB-ITEMS.                                                    10
162100                                                                     CL**3
162200     ADD +1 TO ASC-ITEM-SUB                                          CL**7
162300               ASC-NUMBER-OF-ITEMS-READ.                             CL**7
162400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL**3
162500                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
162810     MOVE PLDESC-TKT-PLCMNT-CDE  TO  ASC-CODE-TYPE                      *3
162900                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
163020     MOVE PLDESC-TKT-PLCMNT-DESC TO ASC-CODE-DESC                       *2
163100                                       (ASC-BLK-SUB ASC-ITEM-SUB).   CL**3
163800 4220-EXIT.                                                          CL**3
163900     EXIT.                                                           CL**3
167400                                                                  VLKCS584
167500*----------------------------------------------------------------*VLKCS584
167600* CLOSE THE VENDOR   CURSOR.                                     *VLKCS584
167700*----------------------------------------------------------------*VLKCS584
167800 4020-CLOSE-CURSOR.                                               VLKCS584
167900                                                                  VLKCS584
168000     EXEC SQL                                                     VLKCS584
168100         CLOSE TICKET-CSR                                         VLKCS584
168200     END-EXEC                                                     VLKCS584
168300                                                                  VLKCS584
168400     EVALUATE TRUE                                                VLKCS584
168500         WHEN SQLCODE = ZERO                                      VLKCS584
168600             CONTINUE                                             VLKCS584
168700         WHEN SQLWARN0 NOT = SPACES                               VLKCS584
168800         WHEN SQLCODE < ZERO                                      VLKCS584
168900         WHEN SQLCODE > ZERO                                      VLKCS584
169000             MOVE '4020-CLOSE-CURSOR'                             VLKCS584
169100                               TO DP013-PARAGRAPH                 VLKCS584
169200             MOVE 'CLOSE VENDOR CURSOR '                          VLKCS584
169300                               TO DP013-MESSAGE-TEXT (1)          VLKCS584
169400             MOVE SQLCA        TO DP013-SQLCA                     VLKCS584
169500             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        VLKCS584
169600             SET DP013-DB2-ABEND                                  VLKCS584
169700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               VLKCS584
169800             PERFORM DP013-0000-PROCESS-ABEND                     VLKCS584
169900     END-EVALUATE.                                                VLKCS584
170000                                                                  VLKCS584
170100*----------------------------------------------------------------*VLKCS584
170200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *VLKCS584
170300*----------------------------------------------------------------*VLKCS584
170400 4400-MOVE-COMMAREA-TO-SCREEN.                                    VLKCS584
170500                                                                  VLKCS584
170600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             VLKCS584
170700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          VLKCS584
170800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          VLKCS584
170900             MOVE +1    TO ASC-BLK-SUB                            VLKCS584
171000             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
171100             ADD +1     TO ASC-BLK-SUB                            VLKCS584
171200             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS584
171300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             VLKCS584
171400                 GIVING PV-BLOCK-NUMBER                           VLKCS584
171500                 REMAINDER PV-REMAINDER                           VLKCS584
171600             IF  PV-REMAINDER > ZERO                              VLKCS584
171700                 ADD +1 TO PV-BLOCK-NUMBER                        VLKCS584
171800             END-IF                                               VLKCS584
171900             MOVE +1    TO ASC-BLK-SUB                            VLKCS584
172000             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
172100             ADD +1     TO ASC-BLK-SUB                            VLKCS584
172200                           PV-BLOCK-NUMBER                        VLKCS584
172300             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS584
172400     END-IF.                                                      VLKCS584
172500     MOVE +1            TO ASC-BLK-SUB.                           VLKCS584
172600     COMPUTE ASC-ITEM-SUB =                                       VLKCS584
172700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              VLKCS584
172800         + PC-ITEMS-PER-PANEL).                                   VLKCS584
172900                                                                  VLKCS584
173000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VLKCS584
173100         ADD +1         TO ASC-BLK-SUB                            VLKCS584
173200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VLKCS584
173300     END-IF.                                                      VLKCS584
173400                                                                  VLKCS584
173500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           VLKCS584
173600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                VLKCS584
173700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        VLKCS584
173800     PERFORM 4420-FORMAT-LIST-LINES                               VLKCS584
173900         VARYING PV-SUB                                           VLKCS584
174000         FROM PC-ITEMS-PER-PANEL BY -1                            VLKCS584
174100         UNTIL PV-SUB < +1.                                       VLKCS584
174200                                                                  VLKCS584
174300     COMPUTE ASC-ITEMS-DISPLAYED =                                VLKCS584
174400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          VLKCS584
174500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   VLKCS584
174600*                                     ASTRTITO.                   VLKCS584
174700*    MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    VLKCS584
174800*    MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    VLKCS584
174900*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VLKCS584
175000*                                  TO ASELITO.                    VLKCS584
175100                                                                  VLKCS584
175200     IF  DP020-MSG-NUMBER-X = SPACE                               VLKCS584
175300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  VLKCS584
175400*            --- MORE ITEMS TO DISPLAY ----                       VLKCS584
175500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            VLKCS584
175600             SET DP020-MSG-INFORMATIONAL TO TRUE                  VLKCS584
175700         END-IF                                                   VLKCS584
175800     END-IF.                                                      VLKCS584
175900                                                                  VLKCS584
176000*----------------------------------------------------------------*VLKCS584
176100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *VLKCS584
176200*----------------------------------------------------------------*VLKCS584
176300 4410-READ-TEMP-STORAGE.                                          VLKCS584
176400                                                                  VLKCS584
176500     EXEC CICS                                                    VLKCS584
176600         READQ TS                                                 VLKCS584
176700             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS584
176800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS584
176900             ITEM  (PV-BLOCK-NUMBER)                              VLKCS584
177000             RESP  (PV-CICS-RESP)                                 VLKCS584
177100     END-EXEC.                                                    VLKCS584
177200                                                                  VLKCS584
177300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       VLKCS584
177400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     VLKCS584
177500         CONTINUE                                                 VLKCS584
177600     ELSE                                                         VLKCS584
177700         SET DP013-CICS-ABEND     TO TRUE                         VLKCS584
177800         SET DP013-NO-ROLLBACK    TO TRUE                         VLKCS584
177900         MOVE '4410-READ-TEMP-STORAGE'                            VLKCS584
178000                                  TO DP013-PARAGRAPH              VLKCS584
178100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      VLKCS584
178200                                  TO DP013-MESSAGE-TEXT(1)        VLKCS584
178300         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
178400     END-IF.                                                      VLKCS584
178500                                                                  VLKCS584
178600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VLKCS584
178700                                                                  VLKCS584
178800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         VLKCS584
178900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               VLKCS584
179000     END-IF.                                                      VLKCS584
179100                                                                  VLKCS584
179200*----------------------------------------------------------------*VLKCS584
179300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *VLKCS584
179400*----------------------------------------------------------------*VLKCS584
179500 4420-FORMAT-LIST-LINES.                                          VLKCS584
179600                                                                  VLKCS584
179700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ          CL**6
179800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                VLKCS584
179900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA   (PV-SUB)            CL**6
180000         MOVE SPACES             TO MR-SELECTI   (PV-SUB)            CL**6
180100                                    MR-ACTION    (PV-SUB)            CL**6
180200                                    MR-CODE-TYPE (PV-SUB)            CL**6
180300                                    MR-CODE-DESC (PV-SUB)         VLKCS584
180600     ELSE                                                         VLKCS584
180700         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          CL**6
180800                                                           > SPACE   CL**6
180900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS584
181000                                           TO MR-SELECTI (PV-SUB)    CL**6
181100         ELSE                                                     VLKCS584
181200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      VLKCS584
181300                                           TO MR-SELECTI (PV-SUB)    CL**6
181400         END-IF                                                   VLKCS584
181500                                                                  VLKCS584
181600         IF DP030-SET-CURSOR-TRAILER                                 CL**6
181700             IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CL**6
181800                                                           > SPACE   CL**6
181900                OR PV-SUB = 1                                        CL**6
182000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE                 CL**6
182100                 MOVE -1 TO MR-SELECTL (PV-SUB)                      CL**6
182200             END-IF                                               VLKCS584
182300         END-IF                                                   VLKCS584
182400                                                                  VLKCS584
182500         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL               CL**6
182800             IF ASC-CODE-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) =              *5
182801                 VL005-TKT-PLCMNT-CDE                                     
182802                     MOVE 'ADD' TO MR-ACTION (PV-SUB)                     
182803             ELSE                                                         
182804                 MOVE ASC-ACTION    (ASC-BLK-SUB ASC-ITEM-SUB)          *6
182805                                             TO MR-ACTION (PV-SUB)   CL**6
182806             END-IF                                                       
182810             MOVE ASC-CODE-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)           CL**5
182900                                          TO MR-CODE-TYPE (PV-SUB)   CL**6
183000             MOVE ASC-CODE-DESC (ASC-BLK-SUB ASC-ITEM-SUB)           CL**5
183100                                          TO MR-CODE-DESC (PV-SUB)   CL**6
184400                                                                        84
184500     END-IF.                                                      VLKCS584
184600                                                                     CL**6
184700     SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL**6
184800                                                                     CL**6
184900     IF ASC-ITEM-SUB < + 1                                           CL**6
185000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  VLKCS584
185100         MOVE +1                 TO ASC-BLK-SUB                   VLKCS584
185200     END-IF.                                                      VLKCS584
185300                                                                  VLKCS584
185400******************************************************************VLKCS584
185500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **VLKCS584
185600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **VLKCS584
185700** ISSUE A WARNING.                                             **VLKCS584
185800******************************************************************VLKCS584
185900 4430-CHECK-FOR-BEGIN-AND-END.                                    VLKCS584
186000                                                                  VLKCS584
186100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       VLKCS584
186200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     VLKCS584
186300*            -- NO END-OF-RANGE SPECFIED ---                      VLKCS584
186400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            VLKCS584
186500             SET DP020-MSG-WARNING TO TRUE                        VLKCS584
186600             PERFORM 4431-POSITION-AT-WARNING                     VLKCS584
186700         END-IF                                                   VLKCS584
186800     ELSE                                                         VLKCS584
186900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     VLKCS584
187000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                VLKCS584
187100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            VLKCS584
187200             SET DP020-MSG-WARNING TO TRUE                        VLKCS584
187300             PERFORM 4431-POSITION-AT-WARNING                     VLKCS584
187400         END-IF                                                   VLKCS584
187500     END-IF.                                                      VLKCS584
187600                                                                  VLKCS584
187700******************************************************************VLKCS584
187800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **VLKCS584
187900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **VLKCS584
188000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **VLKCS584
188100** POSITION THE CURSOR THERE.                                   **VLKCS584
188200******************************************************************VLKCS584
188300 4431-POSITION-AT-WARNING.                                        VLKCS584
188400                                                                  VLKCS584
188500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 VLKCS584
188600                    - PV-TOP-ITEM + 1.                            VLKCS584
188700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS584
188800         CONTINUE                                                 VLKCS584
188900     ELSE                                                         VLKCS584
189000         SET DP030-SET-CURSOR-APPL-1                              VLKCS584
189100                                   TO TRUE                        VLKCS584
189200         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS584
189300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS584
189400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VLKCS584
189500     END-IF.                                                      VLKCS584
189600                                                                  VLKCS584
189700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   VLKCS584
189800                    - PV-TOP-ITEM + 1.                            VLKCS584
189900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      VLKCS584
190000         CONTINUE                                                 VLKCS584
190100     ELSE                                                         VLKCS584
190200         SET DP030-SET-CURSOR-APPL-1                              VLKCS584
190300                                   TO TRUE                        VLKCS584
190400         MOVE -1                   TO MR-SELECTL (PV-SUB)         VLKCS584
190500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         VLKCS584
190600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         VLKCS584
190700     END-IF.                                                      VLKCS584
190800                                                                  VLKCS584
190900*----------------------------------------------------------------*VLKCS584
191000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *VLKCS584
191100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *VLKCS584
191200* FOR THE SELECTED ITEMS QUEUE.                                  *VLKCS584
191300*                                                                *VLKCS584
191400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *VLKCS584
191500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *VLKCS584
191600* THE ARRAY IS FULL.                                             *VLKCS584
191700*----------------------------------------------------------------*VLKCS584
191800 5000-PREPARE-SEL-QUEUE.                                          VLKCS584
191900                                                                  VLKCS584
192000     MOVE +1                   TO  ASC-BLK-SUB.                   VLKCS584
192100     PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS584
192200     ADD +1                    TO  ASC-BLK-SUB.                   VLKCS584
192300     PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS584
192400                                                                  VLKCS584
192500     MOVE ASC-SEL-QUEUE-NAME   TO  VL005-SEL-QUEUE-NAME.          VLKCS584
192600     PERFORM 6010-DELETE-SEL-QUEUE.                               VLKCS584
192700                                                                  VLKCS584
192800     SET ASC-UPDATE-TSQ        TO  TRUE.                          VLKCS584
192900                                                                  VLKCS584
193000     SET VL006-IDX             TO  1.                             VLKCS584
193100     MOVE ZERO                 TO VL005-NUMBER-OF-TS-ITEMS.       VLKCS584
193200     INITIALIZE VL006-SELECTED-ITEM-ARRAY.                        VLKCS584
193300                                                                  VLKCS584
193400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           VLKCS584
193500             VARYING PV-ITEM                                      VLKCS584
193600             FROM 1 BY 1                                          VLKCS584
193700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     VLKCS584
193800                                                                  VLKCS584
193900     IF  VL006-IDX > 1                                            VLKCS584
194000         PERFORM 5205-WRITE-SEL-QUEUE                             VLKCS584
194100         ADD +1                TO VL005-NUMBER-OF-TS-ITEMS        VLKCS584
194200     END-IF.                                                      VLKCS584
194300                                                                  VLKCS584
194400*----------------------------------------------------------------*VLKCS584
194500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *VLKCS584
194600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *VLKCS584
194700*----------------------------------------------------------------*VLKCS584
194800 5100-WRITE-TEMP-STORAGE.                                         VLKCS584
194900                                                                  VLKCS584
195000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     VLKCS584
195100                                   TO PV-LIST-ITEM-NUMBER.        VLKCS584
195200     COMPUTE PV-BLOCK-NUMBER =                                    VLKCS584
195300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS584
195400                                                                  VLKCS584
195500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS584
195600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS584
195700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      VLKCS584
195800             PERFORM 5105-REWRITE-ASC-LISTQ                       VLKCS584
195900         END-IF                                                   VLKCS584
196000     ELSE                                                         VLKCS584
196100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       VLKCS584
196200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            VLKCS584
196300         PERFORM 5110-WRITE-ASC-LISTQ                             VLKCS584
196400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   VLKCS584
196500     END-IF.                                                      VLKCS584
196600                                                                  VLKCS584
196700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VLKCS584
196800******************************************************************VLKCS584
196900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **VLKCS584
197000** SPECIFIC COMMAREA.                                           **VLKCS584
197100******************************************************************VLKCS584
197200 5105-REWRITE-ASC-LISTQ.                                          VLKCS584
197300                                                                  VLKCS584
197400     EXEC CICS                                                    VLKCS584
197500         WRITEQ TS                                                VLKCS584
197600             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS584
197700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS584
197800             ITEM  (PV-BLOCK-NUMBER)                              VLKCS584
197900             REWRITE                                              VLKCS584
198000             RESP  (PV-CICS-RESP)                                 VLKCS584
198100     END-EXEC.                                                    VLKCS584
198200                                                                  VLKCS584
198300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           VLKCS584
198400         CONTINUE                                                 VLKCS584
198500     ELSE                                                         VLKCS584
198600         SET DP013-CICS-ABEND            TO TRUE                  VLKCS584
198700         SET DP013-NO-ROLLBACK           TO TRUE                  VLKCS584
198800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       VLKCS584
198900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     VLKCS584
199000                                         TO DP013-MESSAGE-TEXT(1) VLKCS584
199100         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
199200     END-IF.                                                      VLKCS584
199300                                                                  VLKCS584
199400******************************************************************VLKCS584
199500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **VLKCS584
199600** SPECIFIC COMMAREA.                                           **VLKCS584
199700******************************************************************VLKCS584
199800 5110-WRITE-ASC-LISTQ.                                            VLKCS584
199900                                                                  VLKCS584
200000     EXEC CICS                                                    VLKCS584
200100         WRITEQ TS                                                VLKCS584
200200             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS584
200300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS584
200400             ITEM  (PV-BLOCK-NUMBER)                              VLKCS584
200500             RESP  (PV-CICS-RESP)                                 VLKCS584
200600     END-EXEC.                                                    VLKCS584
200700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      VLKCS584
200800         SET DP013-CICS-ABEND      TO TRUE                        VLKCS584
200900         SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS584
201000         MOVE '5110-WRITE-ASC-LISTQ'                              VLKCS584
201100                                   TO DP013-PARAGRAPH             VLKCS584
201200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           VLKCS584
201300                                   TO DP013-MESSAGE-TEXT(1)       VLKCS584
201400         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
201500     END-IF.                                                      VLKCS584
201600                                                                  VLKCS584
201700*----------------------------------------------------------------*VLKCS584
201800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *VLKCS584
201900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *VLKCS584
202000*----------------------------------------------------------------*VLKCS584
202100 5200-FILL-SEL-QUEUE-RECORD.                                      VLKCS584
202200                                                                  VLKCS584
202300     PERFORM 6112-READ-LIST-QUEUE.                                VLKCS584
202400                                                                  VLKCS584
202500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       VLKCS584
202600         PERFORM                                                  VLKCS584
202700         VARYING LQW-IDX                                          VLKCS584
202800         FROM 1 BY 1                                              VLKCS584
202900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            VLKCS584
203000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          VLKCS584
203100                                                                  VLKCS584
203200             IF  LQW-SELECT (LQW-IDX)                             VLKCS584
203300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              VLKCS584
203400                                   TO VL006-ITEM (VL006-IDX)      VLKCS584
203500*                MOVE SPACES       TO VN003-DEPARTMENT (VN003-IDX)VLKCS584
203600                 MOVE LQW-CODE-TYPE (LQW-IDX)                           84
203700                           TO VL006-TKT-PLCMNT-CDE (VL006-IDX)          84
203710                              VL005-TKT-PLCMNT-CDE                      84
203800                 MOVE SPACE        TO VL006-ACTION-SW (VL006-IDX) VLKCS584
203900                 SET VL006-IDX UP BY 1                            VLKCS584
204000                 IF  VL006-IDX > VL006-MAX-ITEMS                  VLKCS584
204100                     PERFORM 5205-WRITE-SEL-QUEUE                 VLKCS584
204200                     ADD +1        TO VL005-NUMBER-OF-TS-ITEMS    VLKCS584
204300                     INITIALIZE VL006-SELECTED-ITEM-ARRAY         VLKCS584
204400                     SET VL006-IDX TO  1                          VLKCS584
204500                 END-IF                                           VLKCS584
204600             END-IF                                               VLKCS584
204700         END-PERFORM                                              VLKCS584
204800     END-IF.                                                      VLKCS584
204900                                                                  VLKCS584
205000*----------------------------------------------------------------*VLKCS584
205100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *VLKCS584
205200*----------------------------------------------------------------*VLKCS584
205300 5205-WRITE-SEL-QUEUE.                                            VLKCS584
205400                                                                  VLKCS584
205500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VLKCS584
205600                                   TO VL006-SELECTED-ITEMS.       VLKCS584
205700                                                                  VLKCS584
205800     EXEC CICS                                                    VLKCS584
205900          WRITEQ TS                                               VLKCS584
206000              QUEUE (ASC-SEL-QUEUE-NAME)                          VLKCS584
206100              FROM  (VL006-LINE-SEL-REC)                                84
206200              ITEM  (PV-SEL-QUEUE-ITEM)                           VLKCS584
206300              RESP  (PV-CICS-RESP)                                VLKCS584
206400     END-EXEC.                                                    VLKCS584
206500                                                                  VLKCS584
206600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS584
206700         CONTINUE                                                 VLKCS584
206800     ELSE                                                         VLKCS584
206900         SET DP013-CICS-ABEND      TO TRUE                        VLKCS584
207000         SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS584
207100         MOVE '5205-WRITE-SEL-QUEUE'                              VLKCS584
207200                                   TO DP013-PARAGRAPH             VLKCS584
207300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          VLKCS584
207400                                   TO DP013-MESSAGE-TEXT(1)       VLKCS584
207500         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
207600     END-IF.                                                      VLKCS584
207700                                                                  VLKCS584
207800******************************************************************VLKCS584
207900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **VLKCS584
208000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **VLKCS584
208100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **VLKCS584
208200** THE USER.                                                    **VLKCS584
208300******************************************************************VLKCS584
208400 6000-REFRESH-PANEL-FROM-TEMP.                                    VLKCS584
208500                                                                  VLKCS584
208600     IF  ASC-UPDATE-TSQ                                           VLKCS584
208700         SET ASC-NO-TSQ-UPDATE TO TRUE                            VLKCS584
208800         MOVE ZERO                 TO PV-SAVE-ITEM                VLKCS584
208900                                      PV-SEL-QUEUE-ITEM           VLKCS584
209000*        MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        VLKCS584
209100*                                  TO PV-HOLD-SELECTED-ITEMS      VLKCS584
209200         PERFORM 6100-UPDATE-TSQ                                  VLKCS584
209300             UNTIL PV-ITEMS-PROCESSED >                           VLKCS584
209400                                     ASC-NUMBER-OF-SELECTED-ITEMS VLKCS584
209500         PERFORM 6010-DELETE-SEL-QUEUE                            VLKCS584
209600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         VLKCS584
209700                    ASC-BLOCK-ENTRIES (2)                         VLKCS584
209701******ADDED                                                               
209702         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 RCK00050
209703                GIVING PV-BLOCK-NUMBER                            RCK00050
209704                REMAINDER PV-REMAINDER                            RCK00050
209705         IF  PV-REMAINDER > ZERO                                  RCK00050
209706             ADD +1     TO PV-BLOCK-NUMBER                        RCK00050
209707         END-IF                                                   RCK00050
209708         MOVE +1        TO ASC-BLK-SUB                            RCK00050
209709         PERFORM 4410-READ-TEMP-STORAGE                           RCK00050
209710         ADD +1         TO ASC-BLK-SUB                            RCK00050
209711                           PV-BLOCK-NUMBER                        RCK00050
209712         PERFORM 4410-READ-TEMP-STORAGE                           RCK00050
209713                                                                  RCK00050
209720     END-IF.                                                      RCK00050
209800                                                                        84
209810******ADDED                                                               
209900                                                                  VLKCS584
210000*----------------------------------------------------------------*VLKCS584
210100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *VLKCS584
210200*----------------------------------------------------------------*VLKCS584
210300 6010-DELETE-SEL-QUEUE.                                           VLKCS584
210400                                                                  VLKCS584
210500     EXEC CICS                                                    VLKCS584
210600         DELETEQ TS                                               VLKCS584
210700             QUEUE (ASC-SEL-QUEUE-NAME)                           VLKCS584
210800             RESP  (PV-CICS-RESP)                                 VLKCS584
210900     END-EXEC.                                                    VLKCS584
211000                                                                  VLKCS584
211100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      VLKCS584
211200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         VLKCS584
211300         CONTINUE                                                 VLKCS584
211400     ELSE                                                         VLKCS584
211500         SET DP013-CICS-ABEND TO TRUE                             VLKCS584
211600         SET DP013-NO-ROLLBACK TO TRUE                            VLKCS584
211700         MOVE '6010-DELETE-SEL-QUEUE'                             VLKCS584
211800                        TO DP013-PARAGRAPH                        VLKCS584
211900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         VLKCS584
212000                        TO DP013-MESSAGE-TEXT (1)                 VLKCS584
212100         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
212200     END-IF.                                                      VLKCS584
212300                                                                  VLKCS584
212400*----------------------------------------------------------------*VLKCS584
212500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *VLKCS584
212600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *VLKCS584
212700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *VLKCS584
212800*    THE TEMP QUEUE.                                             *VLKCS584
212900*----------------------------------------------------------------*VLKCS584
213000 6100-UPDATE-TSQ.                                                 VLKCS584
213100                                                                  VLKCS584
213200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             VLKCS584
213300     PERFORM 6105-READ-SEL-QUEUE.                                 VLKCS584
213400     PERFORM                                                      VLKCS584
213500         VARYING VL006-IDX                                        VLKCS584
213600         FROM 1 BY 1                                              VLKCS584
213700         UNTIL ((PV-ITEMS-PROCESSED >                             VLKCS584
213800                              PV-HOLD-SELECTED-ITEMS)             VLKCS584
213900         OR (VL006-IDX GREATER THAN VL006-MAX-ITEMS))             VLKCS584
214000         IF  VL006-ACTION-SW (VL006-IDX) > SPACE                  VLKCS584
214100             PERFORM 6110-PROCESS-ITEMS                           VLKCS584
214200         END-IF                                                   VLKCS584
214300         ADD +1                TO PV-ITEMS-PROCESSED              VLKCS584
214400     END-PERFORM.                                                 VLKCS584
214500                                                                  VLKCS584
214600     PERFORM 6111-WRITE-LIST-QUEUE.                               VLKCS584
214700                                                                  VLKCS584
214800*----------------------------------------------------------------*VLKCS584
214900*    READ THE LIST QUEUE RECORD.                                 *VLKCS584
215000*----------------------------------------------------------------*VLKCS584
215100 6105-READ-SEL-QUEUE.                                             VLKCS584
215200                                                                  VLKCS584
215300     EXEC CICS                                                    VLKCS584
215400          READQ TS                                                VLKCS584
215500              QUEUE (ASC-SEL-QUEUE-NAME)                          VLKCS584
215600              INTO  (VL006-LINE-SEL-REC)                                84
215700              ITEM  (PV-SEL-QUEUE-ITEM)                           VLKCS584
215800              RESP  (PV-CICS-RESP)                                VLKCS584
215900     END-EXEC.                                                    VLKCS584
216000                                                                  VLKCS584
216100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS584
216200         CONTINUE                                                 VLKCS584
216300     ELSE                                                         VLKCS584
216400         SET DP013-CICS-ABEND      TO  TRUE                       VLKCS584
216500         SET DP013-NO-ROLLBACK     TO  TRUE                       VLKCS584
216600         MOVE '6105-READ-SEL-QUEUE'                               VLKCS584
216700                                   TO  DP013-PARAGRAPH            VLKCS584
216800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           VLKCS584
216900                                   TO  DP013-MESSAGE-TEXT(1)      VLKCS584
217000         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
217100     END-IF.                                                      VLKCS584
217200                                                                  VLKCS584
217300*----------------------------------------------------------------*VLKCS584
217400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*VLKCS584
217500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*VLKCS584
217600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *VLKCS584
217700*----------------------------------------------------------------*VLKCS584
217800 6110-PROCESS-ITEMS.                                              VLKCS584
217900                                                                  VLKCS584
218000     COMPUTE PV-ITEM = 1 + ((VL006-ITEM (VL006-IDX) - 1)          VLKCS584
218100                     / PC-ITEMS-PER-PANEL).                       VLKCS584
218200                                                                  VLKCS584
218300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           VLKCS584
218400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          VLKCS584
218500             PERFORM 6111-WRITE-LIST-QUEUE                        VLKCS584
218600         END-IF                                                   VLKCS584
218700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    VLKCS584
218800                                                                  VLKCS584
218900         PERFORM 6112-READ-LIST-QUEUE                             VLKCS584
219000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               VLKCS584
219100             CONTINUE                                             VLKCS584
219200         END-IF                                                   VLKCS584
219300     END-IF.                                                      VLKCS584
219400                                                                  VLKCS584
219500     COMPUTE PV-SUB = (VL006-ITEM (VL006-IDX)                     VLKCS584
219600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              VLKCS584
219700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         VLKCS584
219800     MOVE LQW-SELECTED-SW (PV-SUB)                                VLKCS584
219900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  VLKCS584
220000     EVALUATE TRUE                                                VLKCS584
220100         WHEN VL006-INQ (VL006-IDX)                               VLKCS584
220200              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             VLKCS584
220300                                                                  VLKCS584
220400         WHEN VL006-UPD (VL006-IDX)                               VLKCS584
220500              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             VLKCS584
220600                                                                  VLKCS584
220700         WHEN VL006-DEL (VL006-IDX)                               VLKCS584
220800              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             VLKCS584
220900                                                                  VLKCS584
221000         WHEN VL006-ERR (VL006-IDX)                               VLKCS584
221100              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             VLKCS584
221200     END-EVALUATE.                                                VLKCS584
221300                                                                  VLKCS584
221400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                VLKCS584
221500                                                                  VLKCS584
221600*----------------------------------------------------------------*VLKCS584
221700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *VLKCS584
221800*----------------------------------------------------------------*VLKCS584
221900 6111-WRITE-LIST-QUEUE.                                           VLKCS584
222000                                                                  VLKCS584
222100     EXEC CICS                                                    VLKCS584
222200         WRITEQ TS                                                VLKCS584
222300             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS584
222400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     VLKCS584
222500             ITEM  (PV-SAVE-ITEM)                                 VLKCS584
222600             REWRITE                                              VLKCS584
222700             RESP  (PV-CICS-RESP)                                 VLKCS584
222800     END-EXEC.                                                    VLKCS584
222900                                                                  VLKCS584
223000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS584
223100         CONTINUE                                                 VLKCS584
223200     ELSE                                                         VLKCS584
223300         SET DP013-CICS-ABEND  TO  TRUE                           VLKCS584
223400         SET DP013-NO-ROLLBACK TO  TRUE                           VLKCS584
223500         MOVE '6111-WRITE-LIST-QUEUE'                             VLKCS584
223600                               TO  DP013-PARAGRAPH                VLKCS584
223700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  VLKCS584
223800                               TO  DP013-MESSAGE-TEXT(1)          VLKCS584
223900         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
224000     END-IF.                                                      VLKCS584
224100                                                                  VLKCS584
224200*----------------------------------------------------------------*VLKCS584
224300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*VLKCS584
224400*----------------------------------------------------------------*VLKCS584
224500 6112-READ-LIST-QUEUE.                                            VLKCS584
224600                                                                  VLKCS584
224700     EXEC CICS                                                    VLKCS584
224800         READQ TS                                                 VLKCS584
224900             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS584
225000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     VLKCS584
225100             ITEM  (PV-ITEM)                                      VLKCS584
225200             RESP  (PV-CICS-RESP)                                 VLKCS584
225300     END-EXEC.                                                    VLKCS584
225400                                                                  VLKCS584
225500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS584
225600         CONTINUE                                                 VLKCS584
225700     ELSE                                                         VLKCS584
225800         SET DP013-CICS-ABEND        TO TRUE                      VLKCS584
225900         SET DP013-NO-ROLLBACK       TO TRUE                      VLKCS584
226000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           VLKCS584
226100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    VLKCS584
226200                                     TO DP013-MESSAGE-TEXT(1)     VLKCS584
226300         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS584
226400     END-IF.                                                      VLKCS584
226500                                                                  VLKCS584
226600*----------------------------------------------------------------*VLKCS584
226700*    ABEND PROCESSOR MODULE                                      *VLKCS584
226800*----------------------------------------------------------------*VLKCS584
226900     COPY DPPD013.                                                VLKCS584
