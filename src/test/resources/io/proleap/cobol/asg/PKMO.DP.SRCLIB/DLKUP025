000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    DLKUP025.                                         00020000
000300 AUTHOR.        JEAN KURKOWSKI.                                   00030000
000400                                                                  00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  JULY 2007.                                        00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 CONFIGURATION SECTION.                                           00100000
001100 SOURCE-COMPUTER. IBM-3090.                                       00110000
001200 OBJECT-COMPUTER. IBM-3090.                                       00120000
001300                                                                  00130000
001400****************************************************************  00140000
001500*                                                              *  00150000
001600*    THIS IS A COPY OF DLKUP002 FOR BATCH USE.  ANY CHANGES    *  00160000
001700*    NEED TO BE MADE IN BOTH PLACES.                           *  00170000
001800*                                                              *  00180000
001900*    USED TO ADD AN ASSOCIATE (DLT00003) TO AN ASSIGNMENT      *  00190000
002000*    (DLT00004) OR END AN ASSOCIATE ON AN ASSIGNMENT. IF THE   *  00200000
002100*    ASSOCIATE IS THE LAST ASSOCIATE ON THE ASSIGNMENT, THE    *  00210000
002200*    ASSIGNMENT WILL ALSO BE CLOSED.                           *  00220000
002300*        THE ASSIGNMENT MUST BE ACTIVE TO ALLOW THESE CHANGES  *  00230000
002400*    (ASGMT_STP_RSN_CDE = 'N').                                *  00240000
002500*                                                              *  00250000
002600*    ONLY USED BY BATCH PROGRAMS.                              *  00260000
002700*                                                              *  00270000
002800*  COPYBOOKS:                                                  *  00280000
002900*     DLWS021 - USED WHEN CALLING THIS PROGRAM                 *  00290000
003000*     DLWS020 - USED WHEN CALLING DLKUP024                     *  00300000
003100*     DLWS011 - USED TO CONSISTENTLY FORMAT KEY FIELDS         *  00310000
003200*     DLWS023 - USED WHEN CALLING DLKUT027                     *  00320000
003300*     XLWS091 - USED WHEN CALLING XLKUP046 WHICH WRITES        *  00330000
003400*               INFORMATION TO THE EAI EXPORT TABLES.          *  00340000
003500*     XLWS067 - USED WHEN CALLING XLKUT067 WHICH IS USED TO    *  00350000
003600*               ACCESS INFORMATION FOR A REQUESTED USER.       *  00360000
003700*                                                              *  00370000
003800*  DB2 ACCESS:                                                 *  00380000
003900*     DLT_DOOR_GP_TMPL (DLT00000) (DOOR GROUP TEMPLATE)        *  00390000
004000*                SELECTS                                       *  00400000
004100*                                                              *  00410000
004200*     DLT_DOOR_GP (DLT00001) (DOOR GROUP)                      *  00420000
004300*                SELECTS                                       *  00430000
004400*                                                              *  00440000
004500*     DLT_TEM_ASGMT (DLT00003) (ASSIGNMENT USER ASSOCIATION)   *  00450000
004600*                SELECTS                                       *  00460000
004700*                UPDATES                                       *  00470013
004800*                INSERTS                                       *  00480000
004900*                                                              *  00490000
005000*     DLT_ASGMT (DLT00004) (ASSIGNMENT)                        *  00500000
005100*                SELECTS                                       *  00510000
005200*                                                              *  00520000
005300****************************************************************  00530000
005400                                                                  00540000
005500 DATA DIVISION.                                                   00550000
005600 WORKING-STORAGE SECTION.                                         00560000
005700                                                                  00570000
005800 01  PV-CHARACTER-FIELDS.                                         00580000
005900     05  PV-DISP-SQLCODE          PIC -999.                       00590000
005910     05  PV-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.        00591000
005920     05  PV-KEY-START-DATE        PIC X(10)  VALUE SPACES.        00592000
005930     05  PV-KEY-NBR-TXT           PIC X(10)  VALUE SPACES.        00593000
005940     05  PV-TIMESTAMP             PIC X(26)  VALUE SPACES.        00594000
005950     05  PV-CLOSE-TIMESTAMP.                                      00595000
005960         10  PV-CLOSE-DTE                                         00596000
005970                                  PIC X(10)  VALUE SPACES.        00597000
005980         10  FILLER               PIC X(16)  VALUE                00598000
005990             '-01.01.01.000001'.                                  00599000
006000                                                                  00600000
006100 01  PV-COMP-FIELDS.                                              00610000
006200     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.        00620000
006210     05  PV-DISP-RETRY-COUNTER    PIC  ZZZ9.                      00621006
006300     05  PV-KEY-NBR-SEQ-NBR       PIC S9(09) VALUE 0 COMP.        00630000
006400     05  PV-DISP-KEY-NBR          PIC  9(09)- VALUE ZERO.         00640000
006500     05  PV-ASSOCIATE-COUNT       PIC S9(09) VALUE 0 COMP.        00650000
006600     05  PV-NULL                  PIC S9(04) VALUE -1 COMP.       00660000
006700     05  PV-SD-WRK-AREA-DOOR-GROUP PIC S9(09) VALUE 0 COMP.       00670000
006800     05  PV-DOOR-COUNT            PIC S9(09) VALUE 0 COMP.        00680000
006900     05  PV-DIVERT-COUNT          PIC S9(09) VALUE 0 COMP.        00690000
007000                                                                  00700000
007100 01  PS-SWITCHES.                                                 00710000
007200     05  PS-ASSIGNMENT-SW             PIC X(01)  VALUE ' '.       00720000
007300         88  PS-ASSIGNMENT-FOUND                 VALUE 'Y'.       00730000
007400         88  PS-ASSIGNMENT-NOT-FOUND             VALUE 'N'.       00740000
007500     05  PS-UPDATE-ASGMT-ERROR-SW     PIC X(01)  VALUE ' '.       00750000
007600         88  PS-UPDATE-ASGMT-ERROR-Y             VALUE 'Y'.       00760000
007700         88  PS-UPDATE-ASGMT-ERROR-N             VALUE 'N'.       00770000
007800                                                                  00780000
007900 01  PC-CONSTANTS.                                                00790000
008000     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00800000
008100     05  PC-A                     PIC X      VALUE 'A'.           00810000
008200     05  PC-N                     PIC X      VALUE 'N'.           00820000
008300     05  PC-DLKUT024              PIC X(08)  VALUE 'DLKUT024'.    00830000
008400     05  PC-DLKUP025              PIC X(08)  VALUE 'DLKUP025'.    00840000
008500     05  PC-DC-LABOR              PIC X(40)  VALUE                00850000
008600         'DC LABOR                                '.              00860000
008700     05  PC-ASSIGNMENT-CLOSE      PIC X(40)  VALUE                00870000
008800         'ASSIGNMENT CLOSE                        '.              00880000
008900                                                                  00890000
009000****************************************************************  00900000
009100*    DLT00003 - DLT_TEM_ASGMT                                  *  00910000
009200*    DLT00004 - DLT_ASGMT                                      *  00920000
009300*                                                              *  00930000
009400****************************************************************  00940000
009500                                                                  00950000
009600     EXEC SQL                                                     00960000
009700         INCLUDE DLT00000                                         00970000
009800     END-EXEC.                                                    00980000
009900                                                                  00990000
010000     EXEC SQL                                                     01000000
010100         INCLUDE DLT00001                                         01010000
010200     END-EXEC.                                                    01020000
010300                                                                  01030000
010400     EXEC SQL                                                     01040000
010500         INCLUDE DLT00003                                         01050000
010600     END-EXEC.                                                    01060000
010700                                                                  01070000
010800     EXEC SQL                                                     01080000
010900         INCLUDE DLT00004                                         01090000
011000     END-EXEC.                                                    01100000
011100                                                                  01110000
011200     EXEC SQL                                                     01120000
011300         INCLUDE DLT00009                                         01130000
011400     END-EXEC.                                                    01140000
011500                                                                  01150000
011600     EXEC SQL                                                     01160000
011700         INCLUDE TSUCRDV                                          01170000
011800     END-EXEC.                                                    01180000
011900                                                                  01190000
012000     EXEC SQL                                                     01200000
012100          INCLUDE SQLCA                                           01210000
012200     END-EXEC.                                                    01220000
012300                                                                  01230000
012400****************************************************************  01240000
012500*   XLWS067 - COPYBOOK FOR XLKUT067 - ACCESS USER INFORMATION  *  01250000
012600*   XLWS072 - COPYBOOK FOR XLKUT107 - INSERTS BUSINESS EVENTS  *  01260000
012700*   DLWS011 - USED TO CONSISTENTLY FORMAT KEY FIELDS.          *  01270000
012800*   DLWS023 - COPYBOOK FOR DLKUT027 - FORMAT DOOR SUMMARY      *  01280000
012900*             BUSINESS EVENTS.                                 *  01290000
013000*                                                              *  01300000
013100****************************************************************  01310000
013200                                                                  01320000
013300     COPY XLWS067.                                                01330000
013400                                                                  01340000
013500     COPY XLWS091.                                                01350000
013600                                                                  01360000
013700     COPY DLWS020.                                                01370000
013800                                                                  01380000
013900     COPY DLWS011.                                                01390000
014000                                                                  01400000
014100     COPY DLWS023.                                                01410000
014200                                                                  01420000
014300                                                                  01430000
014400 LINKAGE SECTION.                                                 01440000
014500     COPY DLWS021.                                                01450000
014600                                                                  01460000
014700 PROCEDURE DIVISION USING DL021-ASGMT-COMMAREA.                   01470000
014800                                                                  01480000
014810*** DMH 12/01/15 BEGIN                                            01481013
014900***  INITIALIZE  PS-SWITCHES                                      01490005
015000***              PV-CHARACTER-FIELDS                              01500005
015100***              PV-COMP-FIELDS.                                  01510005
015200                                                                  01520000
015210     MOVE  SPACES  TO  PS-ASSIGNMENT-SW                           01521005
015220                       PS-UPDATE-ASGMT-ERROR-SW.                  01522005
015230                                                                  01523005
015232     MOVE  ZEROES  TO  PV-DISP-SQLCODE.                           01523205
015233                                                                  01523305
015234     MOVE  SPACES  TO  PV-CURRENT-TIMESTAMP                       01523405
015235                       PV-KEY-START-DATE                          01523505
015236                       PV-KEY-NBR-TXT                             01523605
015237                       PV-TIMESTAMP.                              01523705
015238     MOVE '          -01.01.01.000001'  TO  PV-CLOSE-TIMESTAMP.   01523808
015242                                                                  01524205
015250*** DMH 12/01/15 END                                              01525013
015260                                                                  01526005
015300     SET DL021-SUCCESSFUL  TO TRUE.                               01530000
015400                                                                  01540000
015500     EVALUATE TRUE                                                01550000
015600         WHEN DL021-BY-ASGMT-NBR                                  01560000
015700              PERFORM 1000-FIND-SEQUENCE-NBR                      01570000
015800                                                                  01580000
015900         WHEN OTHER                                               01590000
016000              SET DL021-INVALID-ACCESS TO TRUE                    01600000
016100                                                                  01610000
016200     END-EVALUATE.                                                01620000
016300                                                                  01630000
016400     GOBACK.                                                      01640000
016500                                                                  01650000
016600                                                                  01660000
016700****************************************************************  01670000
016800*    VALIDATE THAT ALL INPUT FIELDS ARE PRESENT.               *  01680000
016900*        STOP PROCESSING AND RETURN IF THERE ARE ANY ERRORS.   *  01690000
017000*                                                              *  01700000
017100****************************************************************  01710000
017200                                                                  01720000
017300 1000-FIND-SEQUENCE-NBR.                                          01730000
017400                                                                  01740000
017500     EVALUATE TRUE                                                01750000
017600         WHEN DL021-KEY-START-DTE = SPACES                        01760000
017700              SET DL021-MISSING-KEY-FIELDS TO TRUE                01770000
017800                                                                  01780000
017900         WHEN DL021-NO-KEY-NBR-TXT                                01790000
018000              SET DL021-MISSING-KEY-FIELDS TO TRUE                01800000
018100                                                                  01810000
018200         WHEN DL021-NO-KEY-NBR-SEQ-NBR                            01820000
018300              SET DL021-MISSING-KEY-FIELDS TO TRUE                01830000
018400                                                                  01840000
018500         WHEN DL021-NO-KEY-USER-ID                                01850000
018600              SET DL021-MISSING-KEY-FIELDS TO TRUE                01860000
018700                                                                  01870000
018800         WHEN OTHER                                               01880000
018900              PERFORM 1200-PROCESS-SPECIFIC-EDITS                 01890000
019000                                                                  01900000
019100              IF DL021-SUCCESSFUL                                 01910000
019200                 PERFORM 2000-PROCESS-ASSIGNMENTS                 01920000
019300              END-IF                                              01930000
019400                                                                  01940000
019500     END-EVALUATE.                                                01950000
019600                                                                  01960000
019700     IF DL021-SUCCESSFUL                                          01970000
019800        IF DL021-COMMIT-UPDATE                                    01980000
019900           PERFORM 8000-COMMIT                                    01990000
020000        END-IF                                                    02000000
020100     END-IF.                                                      02010000
020200                                                                  02020000
020300****************************************************************  02030000
020400*    VALIDATES THAT INPUT FIELDS ARE VALID AND IF REQUIRED     *  02040000
020500*        ARE PRESENT.                                          *  02050000
020600*                                                              *  02060000
020700****************************************************************  02070000
020800                                                                  02080000
020900 1200-PROCESS-SPECIFIC-EDITS.                                     02090000
021000                                                                  02100000
021100     EVALUATE TRUE                                                02110000
021200         WHEN DL021-ADD-TO-ASGMT                                  02120000
021300              IF DL021-NO-KEY-ADD-BY-USR                          02130000
021400                 SET DL021-MISSING-KEY-FIELDS TO TRUE             02140000
021500              END-IF                                              02150000
021600                                                                  02160000
021700         WHEN DL021-END-FROM-ASGMT                                02170000
021800              IF DL021-NO-KEY-TEM-SEQ-NBR                         02180000
021900                 SET DL021-MISSING-KEY-FIELDS TO TRUE             02190000
022000              END-IF                                              02200000
022100                                                                  02210000
022200              IF DL021-NO-KEY-LVE-BY-PGM                          02220000
022300                 SET DL021-MISSING-KEY-FIELDS TO TRUE             02230000
022400              END-IF                                              02240000
022500                                                                  02250000
022600              IF DL021-NO-KEY-LVE-RSN                             02260000
022700                 SET DL021-MISSING-KEY-FIELDS TO TRUE             02270000
022800              END-IF                                              02280000
022900                                                                  02290000
023000              IF DL021-VALID-LVE-RSN-CDE                          02300000
023100                 CONTINUE                                         02310000
023200              ELSE                                                02320000
023300                 SET DL021-INVALID-LVE-RSN-CDE TO TRUE            02330000
023400              END-IF                                              02340000
023500                                                                  02350000
023600         WHEN OTHER                                               02360000
023700              SET DL021-PROCESS-CODE-INVALID TO TRUE              02370000
023800                                                                  02380000
023900     END-EVALUATE.                                                02390000
024000                                                                  02400000
024100     IF DL021-COMMIT-UPDATE OR                                    02410000
024200        DL021-DO-NOT-COMMIT-UPDATE                                02420000
024300        CONTINUE                                                  02430000
024400     ELSE                                                         02440000
024500        SET DL021-COMMIT-CODE-INVALID TO TRUE                     02450000
024600     END-IF.                                                      02460000
024700                                                                  02470000
024800     IF DL021-NO-KEY-USR-TYPE                                     02480000
024900        PERFORM 1400-CALL-XLKUT067                                02490000
025000     ELSE                                                         02500000
025100        IF DL021-KEY-USR-IS-KOHLS OR                              02510000
025200           DL021-KEY-USR-IS-TEMP                                  02520000
025300           CONTINUE                                               02530000
025400        ELSE                                                      02540000
025500           SET DL021-MISSING-KEY-FIELDS TO TRUE                   02550000
025600        END-IF                                                    02560000
025700     END-IF.                                                      02570000
025800                                                                  02580000
025900****************************************************************  02590000
026000*    FORMAT COMMAREA TO CALL XLKUT067 TO ACCESS INFORMATION    *  02600000
026100*    ABOUT A SPECIFIC USERID.                                  *  02610000
026200*                                                              *  02620000
026300****************************************************************  02630000
026400                                                                  02640000
026500 1400-CALL-XLKUT067.                                              02650000
026600                                                                  02660000
026700     INITIALIZE XL067-USER-COMMAREA.                              02670000
026800     SET XL067-BY-USER-ID TO TRUE.                                02680000
026900     SET XL067-SELECT-BOTH-USERS TO TRUE.                         02690000
027000                                                                  02700000
027100     MOVE DL021-KEY-USER-ID TO XL067-KEY-USER-ID.                 02710000
027200                                                                  02720000
027300     CALL XL067-USER-PGM USING XL067-USER-COMMAREA.               02730000
027400                                                                  02740000
027500     IF XL067-SUCCESSFUL                                          02750000
027600        MOVE XL067-USER-FOUND-CODE TO DL021-KEY-USR-TYPE-CDE      02760000
027700     ELSE                                                         02770000
027800        SET DL021-CALLED-MODULE-FAILURE TO TRUE                   02780000
027900        MOVE XL067-CALL-MOD-FAIL-NM TO                            02790000
028000                            DL021-CALL-MOD-FAIL-NM                02800000
028100        MOVE XL067-CALL-MOD-FAIL-ERR-CDE TO                       02810000
028200                            DL021-CALL-MOD-FAIL-ERR-CDE           02820000
028300     END-IF.                                                      02830000
028400                                                                  02840000
028500****************************************************************  02850000
028600*    TWO PROCESSES CAN HAPPEN HERE - ADD OR END                *  02860000
028700*                                                              *  02870000
028800****************************************************************  02880000
028900                                                                  02890000
029000 2000-PROCESS-ASSIGNMENTS.                                        02900000
029100                                                                  02910000
029200     MOVE DL021-KEY-START-DTE   TO PV-KEY-START-DATE.             02920000
029300     MOVE DL021-KEY-NBR-TXT     TO PV-KEY-NBR-TXT.                02930000
029400     MOVE DL021-KEY-NBR-SEQ-NBR TO PV-KEY-NBR-SEQ-NBR.            02940000
029500                                                                  02950000
029600     PERFORM 8400-GET-TIMESTAMP.                                  02960000
029700                                                                  02970000
029800     PERFORM 3000-SELECT-ASSIGNMENT.                              02980000
029900                                                                  02990000
030000     EVALUATE TRUE                                                03000000
030100        WHEN DL021-SQL-ERROR                                      03010000
030200             MOVE SQLCA TO DL021-SQLCA                            03020000
030300                                                                  03030000
030400        WHEN PS-ASSIGNMENT-NOT-FOUND                              03040000
030500             SET DL021-ASGMT-NOT-ACTIVE TO TRUE                   03050000
030510             DISPLAY ' DLKUP025:  ASSIGNMENT NOT FOUND'           03051000
030520             DISPLAY ' DLKUP025:  PV-KEY-START-DATE:'             03052000
030530                       PV-KEY-START-DATE                          03053000
030540             DISPLAY ' DLKUP025:  PV-KEY-NBR-TXT:'                03054000
030550                       PV-KEY-NBR-TXT                             03055000
030551             MOVE  PV-KEY-NBR-SEQ-NBR TO PV-DISP-KEY-NBR          03055100
030552             DISPLAY ' DLKUP025:  PV-KEY-NBR-SEQ-NBR:'            03055200
030553                       PV-DISP-KEY-NBR                            03055300
030554             DISPLAY ' DLKUP025:  DL021-ACCESS-METHOD:'           03055400
030555                       DL021-ACCESS-METHOD                        03055500
030556             DISPLAY ' DLKUP025:  DL021-PROCESS-CDE:'             03055600
030557                       DL021-PROCESS-CDE                          03055700
030558             DISPLAY ' DLKUP025:  DL021-COMMIT-CDE:'              03055800
030559                       DL021-COMMIT-CDE                           03055900
030560             DISPLAY ' DLKUP025:  DL021-KEY-LVE-RSN-CDE:'         03056000
030570                       DL021-KEY-LVE-RSN-CDE                      03057000
030580             DISPLAY ' DLKUP025:  DL021-RETURN-CODE:'             03058000
030590                       DL021-RETURN-CODE                          03059000
030600             DISPLAY ' DLKUP025:  DL021-KEY-USER-ID:'             03060000
030601                       DL021-KEY-USER-ID                          03060100
030602             DISPLAY ' DLKUP025:  DL021-KEY-ADD-BY-USER-ID:'      03060200
030603                       DL021-KEY-ADD-BY-USER-ID                   03060300
030604                                                                  03060400
030605        WHEN PS-ASSIGNMENT-FOUND                                  03060500
030606             PERFORM 2400-PROCESS-UPDATES                         03060600
030607                                                                  03060700
030608        WHEN OTHER                                                03060800
030609             CONTINUE                                             03060900
030610                                                                  03061000
030620     END-EVALUATE.                                                03062000
030630                                                                  03063000
030640****************************************************************  03064000
030650*                                                              *  03065000
030660*                                                              *  03066000
030670****************************************************************  03067000
030680                                                                  03068000
030690 2400-PROCESS-UPDATES.                                            03069000
030700                                                                  03070000
030800     EVALUATE TRUE                                                03080000
030900         WHEN DL021-ADD-TO-ASGMT                                  03090000
031000              PERFORM 5400-INSERT-ASSOCIATE                       03100000
031100              PERFORM 5500-INSERT-RDPR-USR                        03110000
031200              IF DL021-SUCCESSFUL                                 03120000
031300                 SET DL021-ASSOC-FOUND TO TRUE                    03130000
031400                 MOVE PV-CURRENT-TIMESTAMP TO                     03140000
031500                                 DL021-ASSOC-TMST                 03150000
031600              END-IF                                              03160000
031700                                                                  03170000
031800         WHEN DL021-END-FROM-ASGMT                                03180000
031900              PERFORM 4000-COUNT-ASSOCIATES                       03190000
032000                                                                  03200000
032100****************************************************************  03210000
032200**         ONLY PUT OUT AN ASSIGNMENT CLOSE BUSINESS EVENT     *  03220000
032300**         IF THERE HAS BEEN ACTIVITY AGAINST THIS ASSIGNMENT. *  03230000
032400**           (DLT00004-LAST-USD-SEQ-NBR > 0)                   *  03240000
032500**      OR THE ASSIGNMENT HAS DIVERTED CARTONS                 *  03250000
032600**           (PV-DIVERT-COUNT > 0).                            *  03260000
032700**                                                             *  03270000
032800****************************************************************  03280000
032900                                                                  03290000
033000              IF DLT00004-LAST-USD-SEQ-NBR = 0                    03300000
033100                 IF DLT00004-WK-TYP-DESC = 'SHIP'                 03310000
033200                    PERFORM 4400-COUNT-DIVERTS                    03320000
033300                    IF PV-DIVERT-COUNT    > 0  AND                03330000
033400                       PV-ASSOCIATE-COUNT = 0                     03340000
033500                       PERFORM 6000-FORMAT-XLWS072-CLOSE          03350000
033600                    END-IF                                        03360000
033700                 END-IF                                           03370000
033800              ELSE                                                03380000
033900                 IF PV-ASSOCIATE-COUNT = 0                        03390000
034000                    PERFORM 6000-FORMAT-XLWS072-CLOSE             03400000
034100                 END-IF                                           03410000
034200              END-IF                                              03420000
034300                                                                  03430000
034400              IF PV-ASSOCIATE-COUNT = 0                           03440000
034500                 PERFORM 5200-UPDATE-ASSOCIATE                    03450000
034600                 IF DL021-SUCCESSFUL                              03460000
034700                    SET DL021-ASSOC-FOUND TO TRUE                 03470000
034800                    MOVE PV-CURRENT-TIMESTAMP TO                  03480000
034900                                    DL021-ASSOC-TMST              03490000
035000                    PERFORM 5000-UPDATE-ASSIGNMENT                03500000
035100                    IF DL021-SUCCESSFUL                           03510000
035200                       SET DL021-ASSOC-FOUND TO TRUE              03520000
035300                       MOVE PV-CURRENT-TIMESTAMP TO               03530000
035400                            DL021-ASSOC-TMST                      03540000
035500                    END-IF                                        03550000
035600                 END-IF                                           03560000
035700              ELSE                                                03570000
035800                 PERFORM 5200-UPDATE-ASSOCIATE                    03580000
035900                 IF DL021-SUCCESSFUL                              03590000
036000                    SET DL021-ASSOC-FOUND TO TRUE                 03600000
036100                    MOVE PV-CURRENT-TIMESTAMP TO                  03610000
036200                                    DL021-ASSOC-TMST              03620000
036300                 END-IF                                           03630000
036400              END-IF                                              03640000
036500                                                                  03650000
036600     END-EVALUATE.                                                03660000
036700                                                                  03670000
036800                                                                  03680000
036900****************************************************************  03690000
037000*    CHECK THAT THE ASSIGNMENT IS ACTIVE (ASGMT_STP_RSN_CDE =  *  03700000
037100*    "N".                                                      *  03710000
037200*                                                              *  03720000
037300****************************************************************  03730000
037400                                                                  03740000
037500 3000-SELECT-ASSIGNMENT.                                          03750000
037600                                                                  03760000
037700     PERFORM                                                      03770000
037800         WITH TEST AFTER                                          03780000
037900         VARYING PV-RETRY-COUNTER                                 03790000
038000         FROM 1 BY 1                                              03800000
038100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  03810000
038200            OR SQLCODE = ZERO                                     03820000
038300            OR SQLCODE = +100                                     03830000
038400                                                                  03840000
038500         EXEC SQL                                                 03850000
038600             SELECT                                               03860000
038700                    ASGMT_STRT_DTE                                03870000
038800                   ,ASGMT_STRT_TM                                 03880000
038900                   ,WK_TYP_DESC                                   03890000
039000                   ,WK_AREA_DESC                                  03900000
039100                   ,DC_NBR                                        03910000
039200                   ,ASGMT_STP_RSN_CDE                             03920000
039300                   ,LAST_USD_SEQ_NBR                              03930000
039400              INTO                                                03940000
039500                    :DLT00004-ASGMT-STRT-DTE                      03950000
039600                   ,:DLT00004-ASGMT-STRT-TM                       03960000
039700                   ,:DLT00004-WK-TYP-DESC                         03970000
039800                   ,:DLT00004-WK-AREA-DESC                        03980000
039900                   ,:DLT00004-DC-NBR                              03990000
040000                   ,:DLT00004-ASGMT-STP-RSN-CDE                   04000000
040100                   ,:DLT00004-LAST-USD-SEQ-NBR                    04010000
040200              FROM  DLT_ASGMT                                     04020000
040300             WHERE  ASGMT_STRT_DTE    = :PV-KEY-START-DATE        04030000
040400               AND  ASGMT_NBR_SEQ_NBR = :PV-KEY-NBR-SEQ-NBR       04040000
040500               AND  ASGMT_NBR_TXT     = :PV-KEY-NBR-TXT           04050000
040600               AND  ASGMT_STP_RSN_CDE = :PC-N                     04060000
040700         END-EXEC                                                 04070000
040800                                                                  04080000
040900         EVALUATE TRUE                                            04090000
041000             WHEN SQLCODE = ZERO                                  04100000
041100                  SET PS-ASSIGNMENT-FOUND TO TRUE                 04110000
041200                                                                  04120000
041300             WHEN SQLCODE = +100                                  04130000
041400                  SET PS-ASSIGNMENT-NOT-FOUND TO TRUE             04140000
041410*** DMH DISPLAY BEGIN 12/01/15                                    04141013
041420                  MOVE SQLCODE TO PV-DISP-SQLCODE                 04142013
041440                  DISPLAY 'DLKUP025-'                             04144013
041450                          '3000-SELECT-ASSIGNMENT'                04145013
041460                  DISPLAY 'KOHLS ASSOCIATE'                       04146013
041470                  DISPLAY 'SQLCODE:    '   PV-DISP-SQLCODE        04147013
041480                  DISPLAY 'START DATE: '   PV-KEY-START-DATE      04148013
041490                  DISPLAY 'KEY-NBR-TXT:'   PV-KEY-NBR-TXT         04149013
041491                  DISPLAY 'KEY-NBR-SEQ:'   PV-KEY-NBR-SEQ-NBR     04149113
041495                  DISPLAY 'PC-N:       '   PC-N                   04149513
041496*** DMH DISPLAY END 12/01/15                                      04149613
041500                                                                  04150000
041600             WHEN SQLCODE = -904                                  04160000
041700             WHEN SQLCODE = -913                                  04170000
041800             WHEN SQLCODE = -911                                  04180000
041810*** DMH DISPLAY BEGIN 12/01/15                                    04181013
041820                  MOVE SQLCODE TO PV-DISP-SQLCODE                 04182013
041840                  DISPLAY 'DLKUP025-'                             04184013
041850                          '3000-SELECT-ASSIGNMENT'                04185013
041860                  DISPLAY 'KOHLS ASSOCIATE'                       04186013
041870                  DISPLAY 'SQLCODE:    '   PV-DISP-SQLCODE        04187013
041880                  DISPLAY 'START DATE: '   PV-KEY-START-DATE      04188013
041890                  DISPLAY 'KEY-NBR-TXT:'   PV-KEY-NBR-TXT         04189013
041891                  DISPLAY 'KEY-NBR-SEQ:'   PV-KEY-NBR-SEQ-NBR     04189113
041892                  DISPLAY 'PC-N:       '   PC-N                   04189213
041893*** DMH DISPLAY END 12/01/15                                      04189313
041900                  CONTINUE                                        04190000
042000                                                                  04200000
042100             WHEN SQLWARN0 NOT = SPACES                           04210000
042200             WHEN SQLCODE NOT = ZERO                              04220000
042300                  MOVE +4             TO PV-RETRY-COUNTER         04230000
042400         END-EVALUATE                                             04240000
042500     END-PERFORM.                                                 04250000
042600                                                                  04260000
042700     IF SQLCODE = ZERO OR                                         04270000
042800        SQLCODE = +100                                            04280000
042900        CONTINUE                                                  04290000
043000     ELSE                                                         04300000
043100        SET DL021-SQL-ERROR TO TRUE                               04310000
043200        MOVE SQLCODE        TO DL021-ASGMT-SQLCODE                04320000
043300        MOVE '3000-'        TO DL021-SQL-ERROR-PARA               04330000
043400        MOVE SQLCA          TO DL021-SQLCA                        04340000
043500***                                                               04350000
043600*** DMH ADDED DISPLAYS - 8/21/2007                                04360000
043700***                                                               04370000
043800           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      04380000
043810           DISPLAY ' '                                            04381013
043900           DISPLAY ' DLKUP025-3000 -'                             04390000
044000                   ' SQLCODE = ' PV-DISP-SQLCODE                  04400000
044100           DISPLAY ' START-DATE: ' PV-KEY-START-DATE              04410000
044200                   ' NBR-TXT: '    PV-KEY-NBR-TXT                 04420000
044300                   ' NBR-SEQ: '    PV-KEY-NBR-SEQ-NBR             04430000
044310*** DMH DISPLAY BEGIN 12/01/15                                    04431013
044320           MOVE SQLCODE TO PV-DISP-SQLCODE                        04432013
044330           DISPLAY ' '                                            04433013
044340           DISPLAY 'DLKUP025-'                                    04434013
044350                   '3000-SELECT-ASSIGNMENT'                       04435013
044360           DISPLAY 'KOHLS ASSOCIATE'                              04436013
044370           DISPLAY 'SQLCODE:    '   PV-DISP-SQLCODE               04437013
044380           DISPLAY 'START DATE: '   PV-KEY-START-DATE             04438013
044390           DISPLAY 'KEY-NBR-TXT:'   PV-KEY-NBR-TXT                04439013
044391           DISPLAY 'KEY-NBR-SEQ:'   PV-KEY-NBR-SEQ-NBR            04439113
044392           DISPLAY 'PC-N:       '   PC-N                          04439213
044393*** DMH DISPLAY END 12/01/15                                      04439313
044400***                                                               04440000
044500     END-IF.                                                      04450000
044600                                                                  04460000
044700****************************************************************  04470000
044800*    COUNTS THE NUMBER OF ACTIVE ASSOCIATES ATTACHED TO THE    *  04480000
044900*    ASSIGNMENT BESIDES THE USER ID THAT WE ARE GOING TO END.  *  04490000
045000*                                                              *  04500000
045100****************************************************************  04510000
045200                                                                  04520000
045300 4000-COUNT-ASSOCIATES.                                           04530000
045400                                                                  04540000
045500     MOVE 0 TO PV-ASSOCIATE-COUNT.                                04550000
045600                                                                  04560000
045700     PERFORM                                                      04570000
045800         WITH TEST AFTER                                          04580000
045900         VARYING PV-RETRY-COUNTER                                 04590000
046000         FROM 1 BY 1                                              04600000
046100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  04610000
046200            OR SQLCODE = ZERO                                     04620000
046300            OR SQLCODE = +100                                     04630000
046400                                                                  04640000
046500         IF DL021-KEY-USR-IS-KOHLS                                04650000
046600            EXEC SQL                                              04660000
046700                                                                  04670000
046800               SELECT   COUNT (*)                                 04680000
046900                                                                  04690000
047000                 INTO  :PV-ASSOCIATE-COUNT                        04700000
047100                                                                  04710000
047200                 FROM  DLT_TEM_ASGMT                              04720000
047300                                                                  04730000
047400                WHERE (ASGMT_STRT_DTE    = :PV-KEY-START-DATE     04740000
047500                  AND  ASGMT_NBR_TXT     = :PV-KEY-NBR-TXT        04750000
047600                  AND  ASGMT_NBR_SEQ_NBR = :PV-KEY-NBR-SEQ-NBR    04760000
047700                  AND  NOT KOHLS_USR_ID  = :DL021-KEY-USER-ID     04770000
047800                  AND  LVE_RSN_CDE       = :PC-N)                 04780000
047900                   OR (ASGMT_STRT_DTE    = :PV-KEY-START-DATE     04790000
048000                  AND  ASGMT_NBR_TXT     = :PV-KEY-NBR-TXT        04800000
048100                  AND  ASGMT_NBR_SEQ_NBR = :PV-KEY-NBR-SEQ-NBR    04810000
048200                  AND  KOHLS_USR_ID IS NULL                       04820000
048300                  AND  LVE_RSN_CDE       = :PC-N)                 04830000
048400            END-EXEC                                              04840000
048500         ELSE                                                     04850000
048600            EXEC SQL                                              04860000
048700                                                                  04870000
048800               SELECT   COUNT (*)                                 04880000
048900                                                                  04890000
049000                 INTO  :PV-ASSOCIATE-COUNT                        04900000
049100                                                                  04910000
049200                 FROM  DLT_TEM_ASGMT                              04920000
049300                                                                  04930000
049400                WHERE (ASGMT_STRT_DTE    = :PV-KEY-START-DATE     04940000
049500                  AND  ASGMT_NBR_TXT     = :PV-KEY-NBR-TXT        04950000
049600                  AND  ASGMT_NBR_SEQ_NBR = :PV-KEY-NBR-SEQ-NBR    04960000
049700                  AND  NOT TMP_USR_ID    = :DL021-KEY-USER-ID     04970000
049800                  AND  LVE_RSN_CDE       = :PC-N)                 04980000
049900                   OR (ASGMT_STRT_DTE    = :PV-KEY-START-DATE     04990000
050000                  AND  ASGMT_NBR_TXT     = :PV-KEY-NBR-TXT        05000000
050100                  AND  ASGMT_NBR_SEQ_NBR = :PV-KEY-NBR-SEQ-NBR    05010000
050200                  AND  TMP_USR_ID IS NULL                         05020000
050300                  AND  LVE_RSN_CDE       = :PC-N)                 05030000
050400            END-EXEC                                              05040000
050500         END-IF                                                   05050000
050600                                                                  05060000
050700         EVALUATE TRUE                                            05070000
050800             WHEN SQLCODE = ZERO                                  05080000
050900                  CONTINUE                                        05090000
051000                                                                  05100000
051100             WHEN SQLCODE = +100                                  05110000
051110*** DMH DISPLAY BEGIN 12/01/15                                    05111013
051120                  MOVE SQLCODE TO PV-DISP-SQLCODE                 05112013
051130                  DISPLAY ' '                                     05113013
051140                  DISPLAY 'DLKUP025-'                             05114013
051150                          '4000-COUNT-ASSOCIATES'                 05115013
051170                  DISPLAY 'SQLCODE:    '   PV-DISP-SQLCODE        05117013
051180                  DISPLAY 'START DATE: '   PV-KEY-START-DATE      05118013
051190                  DISPLAY 'KEY-NBR-TXT:'   PV-KEY-NBR-TXT         05119013
051191                  DISPLAY 'KEY-NBR-SEQ:'   PV-KEY-NBR-SEQ-NBR     05119113
051192                  DISPLAY 'USERID:     '   DL021-KEY-USER-ID      05119213
051193                  DISPLAY 'PC-N:       '   PC-N                   05119313
051194*** DMH DISPLAY END 12/01/15                                      05119413
051200                  CONTINUE                                        05120000
051300                                                                  05130000
051400             WHEN SQLCODE = -904                                  05140000
051500             WHEN SQLCODE = -913                                  05150000
051600             WHEN SQLCODE = -911                                  05160000
051700                                                                  05170000
051800             WHEN SQLWARN0 NOT = SPACES                           05180000
051900             WHEN SQLCODE NOT = ZERO                              05190000
052000                  MOVE +4             TO PV-RETRY-COUNTER         05200000
052100         END-EVALUATE                                             05210000
052200     END-PERFORM.                                                 05220000
052300                                                                  05230000
052400     IF SQLCODE = ZERO OR                                         05240000
052500        SQLCODE = +100                                            05250000
052600        CONTINUE                                                  05260000
052700     ELSE                                                         05270000
052800        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      05280000
052900           SET DL021-SQL-ERROR TO TRUE                            05290000
053000           MOVE SQLCODE        TO DL021-ASGMT-SQLCODE             05300000
053100           MOVE '4000-'        TO DL021-SQL-ERROR-PARA            05310000
053200           MOVE SQLCA          TO DL021-SQLCA                     05320000
053300***                                                               05330000
053400*** DMH ADDED DISPLAYS - 8/21/2007                                05340000
053500***                                                               05350000
053600           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      05360000
053610           DISPLAY ' DLKUP025-4000 -'                             05361000
053620                   ' SQLCODE = ' PV-DISP-SQLCODE                  05362000
053630           DISPLAY ' START-DATE: ' PV-KEY-START-DATE              05363000
053640                   ' NBR-TXT: '    PV-KEY-NBR-TXT                 05364000
053650                   ' NBR-SEQ: '    PV-KEY-NBR-SEQ-NBR             05365000
053660           DISPLAY ' USER-ID: '    DL021-KEY-USER-ID              05366000
053670                   ' LVL-RSN-CDE: ' PC-N                          05367000
053671*** DMH DISPLAY BEGIN 12/01/15                                    05367113
053672           MOVE SQLCODE TO PV-DISP-SQLCODE                        05367213
053673           DISPLAY ' '                                            05367313
053674           DISPLAY 'DLKUP025-'                                    05367413
053675                   '4000-COUNT-ASSOCIATES'                        05367513
053676           DISPLAY 'SQLCODE:    '   PV-DISP-SQLCODE               05367613
053677           DISPLAY 'START DATE: '   PV-KEY-START-DATE             05367713
053678           DISPLAY 'KEY-NBR-TXT:'   PV-KEY-NBR-TXT                05367813
053679           DISPLAY 'KEY-NBR-SEQ:'   PV-KEY-NBR-SEQ-NBR            05367913
053680           DISPLAY 'USERID:     '   DL021-KEY-USER-ID             05368013
053681           DISPLAY 'PC-N:       '   PC-N                          05368113
053682*** DMH DISPLAY END 12/01/15                                      05368213
053683***                                                               05368300
053690        END-IF                                                    05369000
053700     END-IF.                                                      05370000
053800                                                                  05380000
053900****************************************************************  05390000
054000*    COUNTS THE NUMBER OF DIVERTED CARTONS.                    *  05400000
054100*                                                              *  05410000
054200*    SHOULD ONLY BE DONE FOR SHIPPING EVENTS.                  *  05420000
054300****************************************************************  05430000
054400                                                                  05440000
054500 4400-COUNT-DIVERTS.                                              05450000
054600                                                                  05460000
054700     STRING DLT00004-ASGMT-STRT-DTE                               05470000
054800            '-'                                                   05480000
054900            DLT00004-ASGMT-STRT-TM                                05490000
055000            '.000000'                                             05500000
055100            DELIMITED BY SIZE                                     05510000
055200            INTO PV-TIMESTAMP.                                    05520000
055300     MOVE DLT00004-WK-AREA-DESC  TO DL011-SHIP-DOORGRP-WRK-AREA.  05530000
055400     MOVE DL011-SD-WRK-AREA-DOOR-GROUP TO                         05540000
055500                                 PV-SD-WRK-AREA-DOOR-GROUP.       05550000
055600                                                                  05560000
055700     MOVE 0 TO PV-DIVERT-COUNT.                                   05570000
055800                                                                  05580000
055900     EXEC SQL                                                     05590000
056000                                                                  05600000
056100        SELECT   COUNT (*)                                        05610000
056200                                                                  05620000
056300          INTO  :PV-DIVERT-COUNT                                  05630000
056400                                                                  05640000
056500          FROM  DLT_DOOR_GP  GP                                   05650000
056600               ,TSUCRDV      DRVT                                 05660000
056700                                                                  05670000
056800         WHERE  GP.DOOR_GP_NBR    = :PV-SD-WRK-AREA-DOOR-GROUP    05680000
056900           AND  DRVT.ACTV_CDE     = :PC-A                         05690000
057000           AND  DRVT.OPER_UNT_ID  = :DLT00004-DC-NBR              05700000
057100           AND  DRVT.DIVERT_TMST  > :PV-TIMESTAMP                 05710000
057200                                                                  05720000
057300     END-EXEC.                                                    05730000
057400                                                                  05740000
057500     EVALUATE TRUE                                                05750000
057600         WHEN SQLCODE = ZERO                                      05760000
057700              CONTINUE                                            05770000
057800                                                                  05780000
057900         WHEN SQLCODE = +100                                      05790000
058000              CONTINUE                                            05800000
058100***                                                               05810000
058110*** DMH ADDED DISPLAYS - 8/21/2007                                05811000
058120***                                                               05812000
058130           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      05813000
058140           DISPLAY ' DLKUP025-4400 -'                             05814000
058150                   ' SQLCODE = ' PV-DISP-SQLCODE                  05815000
058160           DISPLAY ' DOOR-GP-NBR: ' PV-SD-WRK-AREA-DOOR-GROUP     05816000
058170                   ' ACTV-CDE: '    PC-A                          05817000
058180                   ' DIVERT-TMST: ' PV-TIMESTAMP                  05818000
058190***                                                               05819000
058200                                                                  05820000
058300         WHEN OTHER                                               05830000
058400              SET DL021-SQL-ERROR TO TRUE                         05840000
058500              MOVE SQLCODE        TO DL021-ASGMT-SQLCODE          05850000
058600              MOVE '4000-'        TO DL021-SQL-ERROR-PARA         05860000
058700              MOVE SQLCA          TO DL021-SQLCA                  05870000
058800              MOVE +4             TO PV-RETRY-COUNTER             05880000
058810***                                                               05881000
058820*** DMH ADDED DISPLAYS - 8/21/2007                                05882000
058830***                                                               05883000
058840           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      05884000
058850           DISPLAY ' DLKUP025-4400 -'                             05885000
058860                   ' SQLCODE = ' PV-DISP-SQLCODE                  05886000
058870           DISPLAY ' DOOR-GP-NBR: ' PV-SD-WRK-AREA-DOOR-GROUP     05887000
058880                   ' ACTV-CDE: '    PC-A                          05888000
058890                   ' DIVERT-TMST: ' PV-TIMESTAMP                  05889000
058891***                                                               05889100
058892                                                                  05889200
058893     END-EVALUATE.                                                05889300
058894                                                                  05889400
058895****************************************************************  05889500
058896*    IF THE ASSOCIATE WE ARE GOING TO END IS THE ONLY ACTIVE   *  05889600
058897*    ASSOCIATE FOR THE ASSIGNMENT, THE ASSIGNMENT ALSO NEEDS   *  05889700
058898*    TO BE ENDED.                                              *  05889800
058899*                                                              *  05889900
058900****************************************************************  05890000
059000                                                                  05900000
059100 5000-UPDATE-ASSIGNMENT.                                          05910000
059200                                                                  05920000
059300     PERFORM                                                      05930000
059400         WITH TEST AFTER                                          05940000
059500         VARYING PV-RETRY-COUNTER                                 05950000
059600         FROM 1 BY 1                                              05960000
059700         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  05970000
059800            OR SQLCODE = ZERO                                     05980000
059900                                                                  05990000
060000         EXEC SQL                                                 06000000
060100             UPDATE DLT_ASGMT                                     06010000
060200                SET ASGMT_STP_TMST    = :PV-CURRENT-TIMESTAMP     06020000
060300                   ,ASGMT_STP_RSN_CDE = :DL021-KEY-LVE-RSN-CDE    06030000
060400                   ,STP_BY_PGM_NM     = :DL021-KEY-LVE-PGM-NM     06040000
060500                                                                  06050000
060600             WHERE  ASGMT_STRT_DTE    = :PV-KEY-START-DATE        06060000
060700               AND  ASGMT_NBR_TXT     = :DL021-KEY-NBR-TXT        06070000
060800               AND  ASGMT_NBR_SEQ_NBR = :DL021-KEY-NBR-SEQ-NBR    06080000
060900               AND  ASGMT_STP_RSN_CDE = :PC-N                     06090000
061000         END-EXEC                                                 06100000
061100                                                                  06110000
061200         EVALUATE TRUE                                            06120000
061300             WHEN SQLCODE = ZERO                                  06130000
061400             WHEN SQLCODE = -904                                  06140000
061500             WHEN SQLCODE = -913                                  06150000
061600             WHEN SQLCODE = -911                                  06160000
061700                  CONTINUE                                        06170000
061800             WHEN SQLWARN0 NOT = SPACES                           06180000
061900             WHEN SQLCODE NOT = ZERO                              06190000
062000                  MOVE +4             TO PV-RETRY-COUNTER         06200000
062100         END-EVALUATE                                             06210000
062200     END-PERFORM.                                                 06220000
062300                                                                  06230000
062400     IF SQLCODE = 0                                               06240000
062500        CONTINUE                                                  06250000
062600     ELSE                                                         06260000
062700        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      06270000
062800           SET DL021-SQL-ERROR      TO TRUE                       06280000
062900           MOVE '5000-'        TO DL021-SQL-ERROR-PARA            06290000
063000           MOVE SQLCODE        TO DL021-ASGMT-SQLCODE             06300000
063100           MOVE SQLCA          TO DL021-SQLCA                     06310000
063200***                                                               06320000
063300*** DMH ADDED DISPLAYS - 8/21/2007                                06330000
063400***                                                               06340000
063500           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      06350000
063600           DISPLAY ' DLKUP025-5000 -'                             06360000
063700                   ' SQLCODE = ' PV-DISP-SQLCODE                  06370000
063800           DISPLAY ' CURRENT TMST: ' PV-CURRENT-TIMESTAMP         06380000
063900                   ' KEY-LVE-RSN: '  DL021-KEY-LVE-RSN-CDE        06390000
063910                   ' KEY-LVE-PGM: '  DL021-KEY-LVE-PGM-NM         06391000
063920           DISPLAY ' KEY-START-DATE: ' PV-KEY-START-DATE          06392000
063930                   ' KEY-NBR-TXT: '    DL021-KEY-NBR-TXT          06393000
063940                   ' KEY-NBR-SEQ: '    DL021-KEY-NBR-SEQ-NBR      06394000
063950                   ' STP-RSN-CDE: '    PC-N                       06395000
063951*** DMH DISPLAY BEGIN 12/01/15                                    06395113
063952           MOVE SQLCODE TO PV-DISP-SQLCODE                        06395213
063953           DISPLAY ' '                                            06395313
063954           DISPLAY 'DLKUP025-'                                    06395413
063955                   '5000-UPDATE-ASSIGNMENT'                       06395513
063956           DISPLAY 'SQLCODE:    '   PV-DISP-SQLCODE               06395613
063957           DISPLAY 'START DATE: '   PV-KEY-START-DATE             06395713
063958           DISPLAY 'KEY-NBR-TXT:'   DL021-KEY-NBR-TXT             06395813
063959           DISPLAY 'KEY-NBR-SEQ:'   DL021-KEY-NBR-SEQ-NBR         06395913
063961           DISPLAY 'PC-N:       '   PC-N                          06396113
063962*** DMH DISPLAY END 12/01/15                                      06396213
063963***                                                               06396300
063970        END-IF                                                    06397000
063980     END-IF.                                                      06398000
063990                                                                  06399000
064000****************************************************************  06400000
064100*    END THE ASSOCIATE ATTACHED TO THE ASSIGNMENT.             *  06410000
064200*                                                              *  06420000
064300****************************************************************  06430000
064400                                                                  06440000
064500 5200-UPDATE-ASSOCIATE.                                           06450000
064600                                                                  06460000
064700     SET PS-UPDATE-ASGMT-ERROR-N  TO  TRUE.                       06470000
064800                                                                  06480000
064810     PERFORM 5205-UPDATE-ASSOCIATE-KOHLS.                         06481000
064811                                                                  06481100
064812* DMH 2/27/13 - BEGIN                                             06481205
064813     IF  SQLCODE = -904  OR                                       06481305
064814         SQLCODE = -913  OR                                       06481405
064815         SQLCODE = -911                                           06481505
064816         CONTINUE                                                 06481605
064817     ELSE                                                         06481705
064818* DMH 2/27/13 - END                                               06481805
064819     IF  PS-UPDATE-ASGMT-ERROR-Y                                  06481900
064820         PERFORM 5210-UPDATE-ASSOCIATE-TEMP                       06482000
064821     END-IF                                                       06482105
064822     END-IF.                                                      06482205
064823                                                                  06482305
064824     IF  PS-UPDATE-ASGMT-ERROR-Y                                  06482405
064825           SET DL021-SQL-ERROR      TO TRUE                       06482505
064826           MOVE '5200-'        TO DL021-SQL-ERROR-PARA            06482605
064827           MOVE SQLCODE        TO DL021-ASGMT-SQLCODE             06482705
064828           MOVE SQLCA          TO DL021-SQLCA                     06482805
064830***                                                               06483000
064840           MOVE  SQLCODE  TO  PV-DISP-SQLCODE                     06484000
064850           DISPLAY ' DLKUP025-5200 -'                             06485000
064860                   ' SQLCODE = ' PV-DISP-SQLCODE                  06486000
064861           DISPLAY ' CURRENT TMST: ' PV-CURRENT-TIMESTAMP         06486100
064862                   ' KEY-LVE-RSN: '  DL021-KEY-LVE-RSN-CDE        06486200
064863                   ' KEY-LVE-PGM: '  DL021-KEY-LVE-PGM-NM         06486300
064864           DISPLAY ' KEY-START-DATE: ' PV-KEY-START-DATE          06486400
064865                   ' KEY-NBR-TXT: '    DL021-KEY-NBR-TXT          06486500
064866                   ' KEY-NBR-SEQ: '    DL021-KEY-NBR-SEQ-NBR      06486600
064867           DISPLAY ' URS-TYP-CDE:  '   DL021-KEY-USR-TYPE-CDE     06486700
064868                   ' KEY-TEM-ASSOC: '                             06486800
064869                                     DL021-KEY-TEM-ASGMT-SEQ-NBR  06486900
064870                   ' KEY-USER-ID: '     DL021-KEY-USER-ID         06487000
064871                   ' LVE-RSN-CDE: '     PC-N                      06487100
064872***                                                               06487200
064873     END-IF.                                                      06487300
064874                                                                  06487400
064875 5205-UPDATE-ASSOCIATE-KOHLS.                                     06487500
064876                                                                  06487600
064877     PERFORM                                                      06487700
064878         WITH TEST AFTER                                          06487800
064879         VARYING PV-RETRY-COUNTER                                 06487900
064880         FROM 1 BY 1                                              06488000
064890         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  06489000
064900            OR SQLCODE = ZERO                                     06490000
065000                                                                  06500000
065100            EXEC SQL                                              06510000
065200                UPDATE DLT_TEM_ASGMT                              06520000
065300                   SET LVE_TMST      = :PV-CURRENT-TIMESTAMP      06530000
065400                      ,LVE_RSN_CDE   = :DL021-KEY-LVE-RSN-CDE     06540000
065500                      ,LVE_BY_PGM_NM = :DL021-KEY-LVE-PGM-NM      06550000
065600                                                                  06560000
065700                WHERE  ASGMT_STRT_DTE    = :PV-KEY-START-DATE     06570000
065800                  AND  ASGMT_NBR_TXT     = :DL021-KEY-NBR-TXT     06580000
065900                  AND  ASGMT_NBR_SEQ_NBR = :DL021-KEY-NBR-SEQ-NBR 06590000
066000                  AND  TEM_ASGMT_SEQ_NBR =                        06600013
066100                                    :DL021-KEY-TEM-ASGMT-SEQ-NBR  06610013
066200                  AND  KOHLS_USR_ID      = :DL021-KEY-USER-ID     06620000
066300                  AND  LVE_RSN_CDE       = :PC-N                  06630000
066400            END-EXEC                                              06640000
066500                                                                  06650000
066600         EVALUATE TRUE                                            06660000
066700             WHEN SQLCODE = ZERO                                  06670000
066710                  CONTINUE                                        06671013
066720                                                                  06672013
066800             WHEN SQLCODE = -904                                  06680000
066900             WHEN SQLCODE = -913                                  06690000
067000             WHEN SQLCODE = -911                                  06700000
067010*** DMH DISPLAY BEGIN 12/01/15                                    06701013
067020                 MOVE SQLCODE TO PV-DISP-SQLCODE                  06702013
067040                 DISPLAY 'DLKUP025-'                              06704013
067050                         '5205-UPDATE-ASSOCIATE-KOHLS'            06705013
067060                 DISPLAY 'KOHLS ASSOCIATE'                        06706013
067070                 DISPLAY 'SQLCODE:      '   PV-DISP-SQLCODE       06707013
067080                 DISPLAY 'START DATE:   '   PV-KEY-START-DATE     06708013
067090                 DISPLAY 'KEY-NBR-TXT:  '   DL021-KEY-NBR-TXT     06709013
067091                 DISPLAY 'KEY-NBR-SEQ:  '   DL021-KEY-NBR-SEQ-NBR 06709113
067092                 DISPLAY 'TEM-ASGMT-SEQ:'                         06709213
067093                                     DL021-KEY-TEM-ASGMT-SEQ-NBR  06709313
067094                 DISPLAY 'KEY-USER-ID:  '   DL021-KEY-USER-ID     06709413
067095                 DISPLAY 'PC-N:         '   PC-N                  06709513
067097*** DMH DISPLAY END 12/01/15                                      06709713
067100                  CONTINUE                                        06710000
067200             WHEN SQLWARN0 NOT = SPACES                           06720000
067300             WHEN SQLCODE NOT = ZERO                              06730000
067400                  MOVE +4             TO PV-RETRY-COUNTER         06740000
067401                                                                  06740100
067410*** DMH DISPLAY BEGIN 12/01/15                                    06741013
067411                 MOVE SQLCODE TO PV-DISP-SQLCODE                  06741103
067420                 DISPLAY ' '                                      06742001
067421                 DISPLAY 'DLKUP025-'                              06742105
067422                         '5205-UPDATE-ASSOCIATE-KOHLS'            06742205
067423                 DISPLAY 'KOHLS ASSOCIATE'                        06742305
067424                 DISPLAY 'SQLCODE:      '   PV-DISP-SQLCODE       06742405
067425                 DISPLAY 'START DATE:   '   PV-KEY-START-DATE     06742505
067430                 DISPLAY 'KEY-NBR-TXT:  '   DL021-KEY-NBR-TXT     06743000
067440                 DISPLAY 'KEY-NBR-SEQ:  '   DL021-KEY-NBR-SEQ-NBR 06744000
067450                 DISPLAY 'TEM-ASGMT-SEQ:'                         06745000
067460                                     DL021-KEY-TEM-ASGMT-SEQ-NBR  06746004
067470                 DISPLAY 'KEY-USER-ID:  '   DL021-KEY-USER-ID     06747001
067480                 DISPLAY 'PC-N:         '   PC-N                  06748001
067481                 DISPLAY '              '                         06748107
067490*** DMH DISPLAY END 12/01/15                                      06749013
067491                                                                  06749100
067500         END-EVALUATE                                             06750000
067600     END-PERFORM.                                                 06760000
067700                                                                  06770000
067800     IF SQLCODE = 0                                               06780000
067900        CONTINUE                                                  06790000
068000     ELSE                                                         06800000
068001*** DMH 12/01/15                                                  06800113
068002     IF  SQLCODE = -904  OR                                       06800205
068004         SQLCODE = -913  OR                                       06800405
068005         SQLCODE = -911                                           06800505
068006                 SET  PS-UPDATE-ASGMT-ERROR-Y  TO  TRUE           06800605
068007                 MOVE PV-RETRY-COUNTER TO PV-DISP-RETRY-COUNTER   06800706
068008                 MOVE SQLCODE TO PV-DISP-SQLCODE                  06800806
068009                 DISPLAY ' '                                      06800906
068010                 DISPLAY 'DLKUP025-'                              06801006
068011                         '5205-UPDATE-ASSOCIATE-KOHLS'            06801106
068012                 DISPLAY 'KOHLS ASSOCIATE'                        06801206
068013                 DISPLAY 'SQLCODE:      '   PV-DISP-SQLCODE       06801306
068014                 DISPLAY 'RETRY-COUNTER:'   PV-DISP-RETRY-COUNTER 06801406
068015                 DISPLAY 'START DATE:   '   PV-KEY-START-DATE     06801506
068016                 DISPLAY 'KEY-NBR-TXT:  '   DL021-KEY-NBR-TXT     06801606
068017                 DISPLAY 'KEY-NBR-SEQ:  '   DL021-KEY-NBR-SEQ-NBR 06801706
068018                 DISPLAY 'TEM-ASGMT-SEQ:'                         06801806
068019                                     DL021-KEY-TEM-ASGMT-SEQ-NBR  06801906
068020                 DISPLAY 'KEY-USER-ID:  '   DL021-KEY-USER-ID     06802006
068021                 DISPLAY 'PC-N:         '   PC-N                  06802106
068022                 DISPLAY '              '                         06802207
068023*** DMH                                                           06802307
068030     ELSE                                                         06803005
068100        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     06810000
068200            SET  PS-UPDATE-ASGMT-ERROR-Y  TO  TRUE                06820000
068300     END-IF                                                       06830005
068310     END-IF.                                                      06831005
068400                                                                  06840000
068500                                                                  06850000
068600 5210-UPDATE-ASSOCIATE-TEMP.                                      06860000
068700                                                                  06870000
068800     SET PS-UPDATE-ASGMT-ERROR-N  TO  TRUE.                       06880000
068900                                                                  06890000
069000     PERFORM                                                      06900000
069100         WITH TEST AFTER                                          06910000
069200         VARYING PV-RETRY-COUNTER                                 06920000
069300         FROM 1 BY 1                                              06930000
069400         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  06940000
069500            OR SQLCODE = ZERO                                     06950000
069600                                                                  06960000
069700            EXEC SQL                                              06970000
069800                UPDATE DLT_TEM_ASGMT                              06980000
069900                   SET LVE_TMST      = :PV-CURRENT-TIMESTAMP      06990000
070000                      ,LVE_RSN_CDE   = :DL021-KEY-LVE-RSN-CDE     07000000
070100                      ,LVE_BY_PGM_NM = :DL021-KEY-LVE-PGM-NM      07010000
070200                                                                  07020000
070300                WHERE  ASGMT_STRT_DTE    = :PV-KEY-START-DATE     07030000
070400                  AND  ASGMT_NBR_TXT     = :DL021-KEY-NBR-TXT     07040000
070500                  AND  ASGMT_NBR_SEQ_NBR = :DL021-KEY-NBR-SEQ-NBR 07050000
070600                  AND  TEM_ASGMT_SEQ_NBR =                        07060013
070700                                    :DL021-KEY-TEM-ASGMT-SEQ-NBR  07070013
070800                  AND  TMP_USR_ID        = :DL021-KEY-USER-ID     07080000
070900                  AND  LVE_RSN_CDE       = :PC-N                  07090000
071000            END-EXEC                                              07100000
071100                                                                  07110000
071110         EVALUATE TRUE                                            07111000
071120             WHEN SQLCODE = ZERO                                  07112000
071121                  CONTINUE                                        07112113
071130             WHEN SQLCODE = -904                                  07113000
071140             WHEN SQLCODE = -913                                  07114000
071150             WHEN SQLCODE = -911                                  07115000
071151*** DMH DISPLAY BEGIN 12/01/15                                    07115113
071152                 MOVE SQLCODE TO PV-DISP-SQLCODE                  07115213
071154                 DISPLAY 'DLKUP025-'                              07115413
071155                         '5210-UPDATE-ASSOCIATE-TEMP'             07115513
071156                 DISPLAY 'TEMP ASSOCIATE'                         07115613
071157                 DISPLAY 'SQLCODE:      '   PV-DISP-SQLCODE       07115713
071158                 DISPLAY 'START DATE:   '   PV-KEY-START-DATE     07115813
071159                 DISPLAY 'KEY-NBR-TXT:  '   DL021-KEY-NBR-TXT     07115913
071160                 DISPLAY 'KEY-NBR-SEQ:  '   DL021-KEY-NBR-SEQ-NBR 07116013
071161                 DISPLAY 'TEM-ASGMT-SEQ:'                         07116113
071162                                     DL021-KEY-TEM-ASGMT-SEQ-NBR  07116213
071163                 DISPLAY 'KEY-USER-ID:  '   DL021-KEY-USER-ID     07116313
071164                 DISPLAY 'PC-N:         '   PC-N                  07116413
071166*** DMH DISPLAY END 12/01/15                                      07116613
071167                  CONTINUE                                        07116700
071168             WHEN SQLWARN0 NOT = SPACES                           07116800
071169             WHEN SQLCODE NOT = ZERO                              07116900
071170                  MOVE +4             TO PV-RETRY-COUNTER         07117000
071171*** DMH DISPLAY BEGIN 12/01/15                                    07117113
071172                 MOVE SQLCODE TO PV-DISP-SQLCODE                  07117203
071173                 DISPLAY ' '                                      07117301
071174                 DISPLAY 'DLKUP025-'                              07117405
071175                         '5210-UPDATE-ASSOCIATE-TEMP'             07117505
071176                 DISPLAY 'TEMP ASSOCIATE'                         07117601
071177                 DISPLAY 'SQLCODE:      '   PV-DISP-SQLCODE       07117702
071178                 DISPLAY 'START DATE:   '   PV-KEY-START-DATE     07117801
071179                 DISPLAY 'KEY-NBR-TXT:  '   DL021-KEY-NBR-TXT     07117901
071180                 DISPLAY 'KEY-NBR-SEQ:  '   DL021-KEY-NBR-SEQ-NBR 07118001
071181                 DISPLAY 'TEM-ASGMT-SEQ:'                         07118101
071182                                     DL021-KEY-TEM-ASGMT-SEQ-NBR  07118204
071183                 DISPLAY 'KEY-USER-ID:  '   DL021-KEY-USER-ID     07118301
071184                 DISPLAY 'PC-N:         '   PC-N                  07118401
071185                 DISPLAY '              '                         07118507
071186*** DMH DISPLAY END 12/01/15                                      07118613
071187         END-EVALUATE                                             07118701
071188     END-PERFORM.                                                 07118801
071189                                                                  07118901
071190     IF SQLCODE = 0                                               07119001
071191        CONTINUE                                                  07119101
071192     ELSE                                                         07119205
071193*** DMH 12/01/15                                                  07119313
071194     IF  SQLCODE = -904  OR                                       07119405
071195         SQLCODE = -913  OR                                       07119505
071196         SQLCODE = -911                                           07119605
071197                 SET  PS-UPDATE-ASGMT-ERROR-Y  TO  TRUE           07119705
071198                 MOVE PV-RETRY-COUNTER TO PV-DISP-RETRY-COUNTER   07119806
071199                 MOVE SQLCODE TO PV-DISP-SQLCODE                  07119905
071200                 DISPLAY ' '                                      07120005
071201                 DISPLAY 'DLKUP025-'                              07120105
071202                         '5210-UPDATE-ASSOCIATE-TEMP'             07120205
071203                 DISPLAY 'TEMP ASSOCIATE'                         07120305
071204                 DISPLAY 'SQLCODE:      '   PV-DISP-SQLCODE       07120405
071205                 DISPLAY 'RETRY-COUNTER:'   PV-DISP-RETRY-COUNTER 07120506
071206                 DISPLAY 'START DATE:   '   PV-KEY-START-DATE     07120605
071207                 DISPLAY 'KEY-NBR-TXT:  '   DL021-KEY-NBR-TXT     07120705
071208                 DISPLAY 'KEY-NBR-SEQ:  '   DL021-KEY-NBR-SEQ-NBR 07120805
071209                 DISPLAY 'TEM-ASGMT-SEQ:'                         07120905
071210                                     DL021-KEY-TEM-ASGMT-SEQ-NBR  07121005
071211                 DISPLAY 'KEY-USER-ID:  '   DL021-KEY-USER-ID     07121105
071212                 DISPLAY 'PC-N:         '   PC-N                  07121205
071213                 DISPLAY '              '                         07121307
071214*** DMH                                                           07121405
071215     ELSE                                                         07121501
071216        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      07121601
071217           SET PS-UPDATE-ASGMT-ERROR-Y  TO  TRUE                  07121701
071218        END-IF                                                    07121801
071219     END-IF.                                                      07121901
071220                                                                  07122001
071221                                                                  07122101
071222****************************************************************  07122201
071223*                                                              *  07122301
071224*                                                              *  07122401
071225*                                                              *  07122501
071226****************************************************************  07122601
071227                                                                  07122700
071230 5400-INSERT-ASSOCIATE.                                           07123000
071300                                                                  07130000
071400     MOVE DL021-KEY-START-DTE TO PV-KEY-START-DATE.               07140000
071500                                                                  07150000
071600     PERFORM                                                      07160000
071700         WITH TEST AFTER                                          07170000
071800         VARYING PV-RETRY-COUNTER                                 07180000
071900         FROM 1 BY 1                                              07190000
072000         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  07200000
072100            OR SQLCODE = ZERO                                     07210000
072200            OR SQLCODE = -530                                     07220000
072300                                                                  07230000
072400***      IF DL021-KEY-USR-IS-KOHLS                                07240000
072500            EXEC SQL                                              07250000
072600                INSERT INTO DLT_TEM_ASGMT                         07260000
072700                      (ASGMT_STRT_DTE                             07270000
072800                      ,ASGMT_NBR_TXT                              07280000
072900                      ,ASGMT_NBR_SEQ_NBR                          07290000
073000                      ,KOHLS_USR_ID                               07300000
073100                      ,TMP_USR_ID                                 07310000
073200                      ,JN_TMST                                    07320000
073300                      ,CRE_BY_USR_ID                              07330000
073400                      ,LVE_TMST                                   07340000
073500                      ,LVE_RSN_CDE                                07350000
073600                      ,LVE_BY_PGM_NM)                             07360000
073700                                                                  07370000
073800               VALUES (:PV-KEY-START-DATE                         07380000
073900                      ,:DL021-KEY-NBR-TXT                         07390000
074000                      ,:DL021-KEY-NBR-SEQ-NBR                     07400000
074100                      ,:DL021-KEY-USER-ID                         07410000
074200                      ,DEFAULT                                    07420000
074300                      ,:PV-CURRENT-TIMESTAMP                      07430000
074400                      ,:DL021-KEY-ADD-BY-USER-ID                  07440000
074500                      ,NULL                                       07450000
074600                      ,:PC-N                                      07460000
074700                      ,DEFAULT)                                   07470000
074800            END-EXEC                                              07480000
074900                                                                  07490000
075000            IF  SQLCODE = -530                                    07500000
075100                                                                  07510000
075200            EXEC SQL                                              07520000
075300                INSERT INTO DLT_TEM_ASGMT                         07530000
075400                      (ASGMT_STRT_DTE                             07540000
075500                      ,ASGMT_NBR_TXT                              07550000
075600                      ,ASGMT_NBR_SEQ_NBR                          07560000
075700                      ,KOHLS_USR_ID                               07570000
075800                      ,TMP_USR_ID                                 07580000
075900                      ,JN_TMST                                    07590000
076000                      ,CRE_BY_USR_ID                              07600000
076100                      ,LVE_TMST                                   07610000
076200                      ,LVE_RSN_CDE                                07620000
076300                      ,LVE_BY_PGM_NM)                             07630000
076400                                                                  07640000
076500               VALUES (:PV-KEY-START-DATE                         07650000
076600                      ,:DL021-KEY-NBR-TXT                         07660000
076700                      ,:DL021-KEY-NBR-SEQ-NBR                     07670000
076800                      ,DEFAULT                                    07680000
076900                      ,:DL021-KEY-USER-ID                         07690000
077000                      ,:PV-CURRENT-TIMESTAMP                      07700000
077100                      ,:DL021-KEY-ADD-BY-USER-ID                  07710000
077200                      ,NULL                                       07720000
077300                      ,:PC-N                                      07730000
077400                      ,DEFAULT)                                   07740000
077500            END-EXEC                                              07750000
077600            END-IF                                                07760000
077700                                                                  07770000
077800         EVALUATE TRUE                                            07780000
077900             WHEN SQLCODE = ZERO                                  07790000
078000             WHEN SQLCODE = -530                                  07800000
078100             WHEN SQLCODE = -904                                  07810000
078200             WHEN SQLCODE = -913                                  07820000
078300             WHEN SQLCODE = -911                                  07830000
078400                 CONTINUE                                         07840000
078500             WHEN SQLWARN0 NOT = SPACES                           07850000
078600             WHEN SQLCODE NOT = ZERO                              07860000
078700                  MOVE +4             TO PV-RETRY-COUNTER         07870000
078800         END-EVALUATE                                             07880000
078900     END-PERFORM.                                                 07890000
079000                                                                  07900000
079100     IF SQLCODE = 0  OR                                           07910000
079200        SQLCODE = -530                                            07920000
079300        CONTINUE                                                  07930000
079400     ELSE                                                         07940000
079500        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      07950000
079600           SET DL021-SQL-ERROR      TO TRUE                       07960000
079700           MOVE SQLCODE        TO DL021-ASGMT-SQLCODE             07970000
079800           MOVE '5400-'        TO DL021-SQL-ERROR-PARA            07980000
079900           MOVE SQLCA          TO DL021-SQLCA                     07990000
080000***                                                               08000000
080010*** DMH ADDED DISPLAYS - 8/21/2007                                08001000
080020***                                                               08002000
080030           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      08003000
080040           DISPLAY ' DLKUP025-5400-INSERT-ASSOCIATE '             08004013
080050                   ' SQLCODE = ' PV-DISP-SQLCODE                  08005000
080060           DISPLAY ' START-DATE: ' PV-KEY-START-DATE              08006000
080070                   ' NBR-TXT: '    DL021-KEY-NBR-TXT              08007000
080080                   ' NBR-SEQ: '    DL021-KEY-NBR-SEQ-NBR          08008000
080090           DISPLAY ' USER-ID: '    DL021-KEY-USER-ID              08009000
080091                   ' TMST: '       PV-CURRENT-TIMESTAMP           08009100
080092                   ' ADD-BY-USR: ' DL021-KEY-ADD-BY-USER-ID       08009200
080093           DISPLAY ' LVE-TMST: '   DLT00003-LVE-TMST              08009300
080094                   ' PC-N: '       PC-N                           08009400
080095***                                                               08009500
080096        END-IF                                                    08009600
080097     END-IF.                                                      08009700
080098                                                                  08009800
080099 5500-INSERT-RDPR-USR.                                            08009900
080100                                                                  08010000
080200     PERFORM                                                      08020000
080300         WITH TEST AFTER                                          08030000
080400         VARYING PV-RETRY-COUNTER                                 08040000
080500         FROM 1 BY 1                                              08050000
080600         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  08060000
080700            OR SQLCODE = ZERO OR SQLCODE = -803                   08070000
080800                                                                  08080000
080900***      IF DL021-KEY-USR-IS-KOHLS                                08090000
081000            EXEC SQL                                              08100000
081100               INSERT INTO DLT_RDPR_USR_LSTG                      08110000
081200                  (USR_ID                                         08120000
081300                  ,LOC_NBR                                        08130000
081400                  ,TMP_USR_ID                                     08140000
081500                  ,CRE_TMST)                                      08150000
081600                                                                  08160000
081700               VALUES (:DL021-KEY-USER-ID                         08170000
081800                      ,:DLT00004-DC-NBR                           08180000
081900                      ,NULL                                       08190000
082000                      ,:PV-CURRENT-TIMESTAMP)                     08200000
082100            END-EXEC                                              08210000
082200                                                                  08220000
082300            IF SQLCODE = -530                                     08230000
082400            EXEC SQL                                              08240000
082500               INSERT INTO DLT_RDPR_USR_LSTG                      08250000
082600                  (USR_ID                                         08260000
082700                  ,LOC_NBR                                        08270000
082800                  ,TMP_USR_ID                                     08280000
082900                  ,CRE_TMST)                                      08290000
083000                                                                  08300000
083100               VALUES (NULL                                       08310000
083200                      ,:DLT00004-DC-NBR                           08320000
083300                      ,:DL021-KEY-USER-ID                         08330000
083400                      ,:PV-CURRENT-TIMESTAMP)                     08340000
083500            END-EXEC                                              08350000
083600            END-IF                                                08360000
083700                                                                  08370000
083800         EVALUATE TRUE                                            08380000
083900             WHEN SQLCODE = ZERO                                  08390000
084000             WHEN SQLCODE = -530                                  08400000
084100             WHEN SQLCODE = -803                                  08410000
084200             WHEN SQLCODE = -904                                  08420000
084300             WHEN SQLCODE = -913                                  08430000
084400             WHEN SQLCODE = -911                                  08440000
084500                 CONTINUE                                         08450000
084600             WHEN SQLWARN0 NOT = SPACES                           08460000
084700             WHEN SQLCODE NOT = ZERO                              08470000
084800                  MOVE +4             TO PV-RETRY-COUNTER         08480000
084900         END-EVALUATE                                             08490000
085000     END-PERFORM.                                                 08500000
085100                                                                  08510000
085200     IF SQLCODE = 0 OR -803 OR -530                               08520000
085300        CONTINUE                                                  08530000
085400     ELSE                                                         08540000
085500        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                      08550000
085600           SET DL021-SQL-ERROR      TO TRUE                       08560000
085700           MOVE SQLCODE        TO DL021-ASGMT-SQLCODE             08570000
085800           MOVE '5500-'        TO DL021-SQL-ERROR-PARA            08580000
085900           MOVE SQLCA          TO DL021-SQLCA                     08590000
086000***                                                               08600000
086100*** DMH ADDED DISPLAYS - 8/21/2007                                08610000
086110***                                                               08611000
086120           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      08612000
086130           DISPLAY ' DLKUP025-5500-INSERT-RDPR-USR '              08613013
086140                   ' SQLCODE = ' PV-DISP-SQLCODE                  08614000
086150           DISPLAY ' USER-ID: '  DL021-KEY-USER-ID                08615000
086160                   ' DC-NBR: '   DLT00004-DC-NBR                  08616000
086170                   ' TMST: '     PV-CURRENT-TIMESTAMP             08617000
086180***                                                               08618000
086190        END-IF                                                    08619000
086200     END-IF.                                                      08620000
086300                                                                  08630000
086400****************************************************************  08640000
086500*    IF CLOSING AN ASSIGNMENT AND THE DL021-LOG-TO-EAI-EXPORT  *  08650000
086600*    SWITCH IS ON, WE CALL XLKUT107 TO WRITE THE APPROPRIATE   *  08660000
086700*    INFORMATION TO EITHER THE PCT00011 OR SUT00037 TABLES.    *  08670000
086800*                                                              *  08680000
086900*    THE DOOR SUMMARY BUSINESS EVENTS NEED TO BE DONE BEFORE   *  08690000
087000*    THE ASSIGNMENT CLOSE BUSINESS EVENT.                      *  08700000
087100****************************************************************  08710000
087200                                                                  08720000
087300 6000-FORMAT-XLWS072-CLOSE.                                       08730000
087400                                                                  08740000
087500     EVALUATE TRUE                                                08750000
087600         WHEN DLT00004-WK-TYP-DESC = 'SHIP'                       08760000
087700              PERFORM 6800-FORMAT-DLKUT027-INPUT                  08770000
087800                                                                  08780000
087900         WHEN OTHER                                               08790000
088000              CONTINUE                                            08800000
088100                                                                  08810000
088200     END-EVALUATE.                                                08820000
088300                                                                  08830000
088400     INITIALIZE XL091-EAI-EXPORT-COMMAREA.                        08840000
088500                                                                  08850000
088600     EVALUATE TRUE                                                08860000
088700         WHEN DLT00004-WK-TYP-DESC = 'P2L'                        08870000
088800         WHEN DLT00004-WK-TYP-DESC = 'RLABL'                      08880000
088900         WHEN DLT00004-WK-TYP-DESC = 'MASTCON'                    08890000
089000              SET XL091-PC-APP-ID TO TRUE                         08900000
089100                                                                  08910000
089200         WHEN OTHER                                               08920000
089300              SET XL091-SU-APP-ID TO TRUE                         08930000
089400                                                                  08940000
089500     END-EVALUATE.                                                08950000
089600                                                                  08960000
089700     MOVE PC-DC-LABOR         TO XL091-EVNT-OBJ-TXT.              08970000
089800     MOVE PC-ASSIGNMENT-CLOSE TO XL091-EVNT-OBJ-ACTN-TXT.         08980000
089900     MOVE DL021-ORIG-CALLING-PGM-NM TO XL091-CRE-BY-USR-ID.       08990000
090000     MOVE PC-DLKUP025               TO XL091-CRE-PGM-NM.          09000000
090100                                                                  09010000
090200     SET XL091-DO-NOT-COMMIT-UPDATE TO TRUE.                      09020000
090300     SET XL091-COPYBOOK-NOT-USED    TO TRUE.                      09030000
090400                                                                  09040000
090500     MOVE DL021-KEY-NBR-SEQ-NBR TO XL091-EVNT-KY-1-NBR.           09050000
090600     MOVE DL021-KEY-NBR-TXT     TO XL091-EVNT-KY-1-TXT.           09060000
090700     MOVE DL021-KEY-START-DTE   TO PV-CLOSE-DTE.                  09070000
090800     MOVE PV-CLOSE-TIMESTAMP    TO XL091-EVNT-KY-1-TMST.          09080000
090900***  MOVE PV-CURRENT-TIMESTAMP  TO XL091-EVNT-KY-1-TMST.          09090000
091000     MOVE DLT00004-DC-NBR       TO XL091-EVNT-KY-2-NBR.           09100000
091100                                                                  09110000
091200     PERFORM 6400-CALL-XLKUT107.                                  09120000
091300                                                                  09130000
091400                                                                  09140000
091500****************************************************************  09150000
091600*    IF CLOSING AN ASSIGNMENT AND THE DL021-LOG-TO-EAI-EXPORT  *  09160000
091700*    SWITCH IS ON, WE CALL XLKUT107 TO WRITE THE APPROPRIATE   *  09170000
091800*    INFORMATION TO EITHER THE PCT00011 OR SUT00037 TABLES.    *  09180000
091900*                                                              *  09190000
092000****************************************************************  09200000
092100                                                                  09210000
092200 6400-CALL-XLKUT107.                                              09220000
092300                                                                  09230000
092400     CALL XL091-USER-PGM USING XL091-EAI-EXPORT-COMMAREA.         09240000
092500                                                                  09250000
092600     IF XL091-SUCCESSFUL                                          09260000
092700        CONTINUE                                                  09270000
092800     ELSE                                                         09280000
092900        SET DL021-CALLED-MODULE-FAILURE TO TRUE                   09290000
093000        MOVE XL091-USER-PGM        TO DL021-CALL-MOD-FAIL-NM      09300000
093100        MOVE XL091-RETURN-CODE     TO DL021-CALL-MOD-FAIL-ERR-CDE 09310000
093200        MOVE XL091-RETURN-SQLCODES TO DL021-RETURN-SQLCODES       09320000
093300     END-IF.                                                      09330000
093400                                                                  09340000
093500******************************************************************09350000
093600*    THIS WILL ONLY BE USED WHEN CLOSING A SHIPPING ASSIGNMENT.  *09360000
093700*        IT CALLS DLKUT027 TO GENERATE A "SHIPPING DOOR SUMMARY" *09370000
093800*        BUSINESS EVENT FOR EVERY DOOR WITHIN THE DOOR GROUP     *09380000
093900*        TEMPLATE ID.                                            *09390000
094000*    THIS IS ONLY DONE IF THIS WAS THE LAST ASSOCIATE ON THE     *09400000
094100*        ASSIGNMENT.                                             *09410000
094200******************************************************************09420000
094300                                                                  09430000
094400 6800-FORMAT-DLKUT027-INPUT.                                      09440000
094500                                                                  09450000
094600     INITIALIZE DL023-ASGMT-COMMAREA.                             09460000
094700     SET  DL023-BY-DOOR-GROUP-ID TO TRUE.                         09470000
094800                                                                  09480000
094900     MOVE DL021-KEY-START-DTE    TO DL023-ASGMT-START-DTE.        09490000
095000     MOVE DL021-KEY-NBR-TXT      TO DL023-ASGMT-NBR-TXT.          09500000
095100     MOVE DL021-KEY-NBR-SEQ-NBR  TO DL023-ASGMT-NBR-SEQ-NBR.      09510000
095200                                                                  09520000
095300     MOVE DLT00004-WK-AREA-DESC  TO DL011-SHIP-DOORGRP-WRK-AREA.  09530000
095400     MOVE DL011-SD-WRK-AREA-DOOR-GROUP TO DL023-DOOR-GP-NBR.      09540000
095500     MOVE DLT00004-DC-NBR        TO DL023-DC-NBR.                 09550000
095600                                                                  09560000
095700**   TRIP IS NOW DETERMINED IN DLKUT027                           09570000
095800                                                                  09580000
095900     STRING DLT00004-ASGMT-STRT-DTE                               09590000
096000            '-'                                                   09600000
096100            DLT00004-ASGMT-STRT-TM                                09610000
096200            '.000000'                                             09620000
096300            DELIMITED BY SIZE                                     09630000
096400            INTO DL023-ASGMT-STRT-TMST.                           09640000
096500                                                                  09650000
096600     MOVE PV-CURRENT-TIMESTAMP TO DL023-ASGMT-STOP-TMST.          09660000
096700                                                                  09670000
096800     PERFORM 8000-COUNT-DOORS.                                    09680000
096900                                                                  09690000
097000     IF DL021-SUCCESSFUL                                          09700000
097100        PERFORM 8400-CALL-DLKUT024                                09710000
097200     END-IF.                                                      09720000
097300                                                                  09730000
097400     MOVE DL020-SEQ-START-NBR  TO DL023-BEGIN-DETAIL-SEQ-NBR.     09740000
097500     MOVE PV-DOOR-COUNT        TO DL023-NBR-DOORS.                09750000
097600     MOVE DL021-KEY-ADD-BY-USER-ID TO DL023-USR-ID.               09760000
097700                                                                  09770000
097800     IF DL021-SUCCESSFUL                                          09780000
097900        PERFORM 6900-CALL-DLKUT027                                09790000
098000     END-IF.                                                      09800000
098100                                                                  09810000
098200******************************************************************09820000
098300*    THIS WILL ONLY BE USED WHEN CLOSING A SHIPPING ASSIGNMENT.  *09830000
098400*        IT CALLS DLKUT027 TO GENERATE A "SHIPPING DOOR SUMMARY" *09840000
098500*        BUSINESS EVENT FOR EVERY DOOR WITHIN THE DOOR GROUP     *09850000
098600*        TEMPLATE ID.                                            *09860000
098700******************************************************************09870000
098800                                                                  09880000
098900 6900-CALL-DLKUT027.                                              09890000
099000                                                                  09900000
099100     CALL DL023-USER-PGM USING DL023-ASGMT-COMMAREA.              09910000
099200                                                                  09920000
099300     IF DL023-SUCCESSFUL                                          09930000
099400        CONTINUE                                                  09940000
099500     ELSE                                                         09950000
099600        SET  DL021-CALLED-MODULE-FAILURE TO TRUE                  09960000
099700        MOVE DL023-USER-PGM        TO DL021-CALL-MOD-FAIL-NM      09970000
099800        MOVE DL023-RETURN-CODE     TO DL021-CALL-MOD-FAIL-ERR-CDE 09980000
099900        MOVE DL023-RETURN-SQLCODES TO DL021-RETURN-SQLCODES       09990000
100000     END-IF.                                                      10000000
100100                                                                  10010000
100200****************************************************************  10020000
100300*                                                              *  10030000
100400*                                                              *  10040000
100500****************************************************************  10050000
100600                                                                  10060000
100700 8000-COUNT-DOORS.                                                10070000
100800                                                                  10080000
100900     MOVE 0 TO PV-DOOR-COUNT.                                     10090000
101000                                                                  10100000
101100     EXEC SQL                                                     10110000
101200           SELECT COUNT(*)                                        10120000
101300                                                                  10130000
101400             INTO :PV-DOOR-COUNT                                  10140000
101500                                                                  10150000
101600             FROM DLT_DOOR_GP       GP                            10160000
101700                 ,DLT_DOOR_GP_TMPL  TMPL                          10170000
101800            WHERE GP.DOOR_GP_NBR     = :DL023-DOOR-GP-NBR         10180000
101900              AND TMPL.DC_NBR        = :DL023-DC-NBR              10190000
102000              AND TMPL.ACTV_IND      = 'Y'                        10200000
102100              AND GP.DOOR_GP_TMPL_ID = TMPL.DOOR_GP_TMPL_ID       10210000
102200                                                                  10220000
102300     END-EXEC.                                                    10230000
102400                                                                  10240000
102500     EVALUATE TRUE                                                10250000
102600         WHEN SQLCODE = ZERO                                      10260000
102700              CONTINUE                                            10270000
102800                                                                  10280000
102900         WHEN SQLCODE = +100                                      10290000
103000              CONTINUE                                            10300000
103100                                                                  10310000
103200         WHEN SQLCODE = -904                                      10320000
103300         WHEN SQLCODE = -913                                      10330000
103400         WHEN SQLCODE = -911                                      10340000
103500                                                                  10350000
103600         WHEN SQLWARN0 NOT = SPACES                               10360000
103700         WHEN SQLCODE NOT = ZERO                                  10370000
103800              SET DL021-SQL-ERROR TO TRUE                         10380000
103900              MOVE SQLCODE        TO DL021-ASGMT-SQLCODE          10390000
104000              MOVE '8000-'        TO DL021-SQL-ERROR-PARA         10400000
104100              MOVE SQLCA          TO DL021-SQLCA                  10410000
104110***                                                               10411000
104120*** DMH ADDED DISPLAYS - 8/21/2007                                10412000
104130***                                                               10413000
104140           MOVE SQLCODE  TO  PV-DISP-SQLCODE                      10414000
104150           DISPLAY ' DLKUP025-8000 -'                             10415000
104160                   ' SQLCODE = ' PV-DISP-SQLCODE                  10416000
104170                   ' DOOR-GP: '  DL023-DOOR-GP-NBR                10417000
104180                   ' DOOR-NBR: ' DL023-DC-NBR                     10418000
104190***                                                               10419000
104200     END-EVALUATE.                                                10420000
104300                                                                  10430000
104400******************************************************************10440000
104500*    RESERVE THE SAME NUMBER OF SEQUENCE NUMBERS THAT THERE ARE  *10450000
104600*       NUMBER OF DOORS (PV-DOOR-COUNT).                         *10460000
104700*                                                                *10470000
104800******************************************************************10480000
104900                                                                  10490000
105000 8400-CALL-DLKUT024.                                              10500000
105100                                                                  10510000
105200     INITIALIZE DL020-ASGMT-COMMAREA.                             10520000
105300                                                                  10530000
105400     SET DL020-BY-ASGMT-KEY         TO TRUE.                      10540000
105500     SET DL020-COMMIT-UPDATE        TO TRUE.                      10550000
105600     SET DL020-FIND-NEXT-ASGMT      TO TRUE.                      10560000
105700                                                                  10570000
105800     MOVE DL023-ASGMT-START-DTE TO DL020-KEY-START-DTE.           10580000
105900     MOVE DL023-ASGMT-NBR-TXT   TO DL020-KEY-NBR-TXT.             10590000
106000     MOVE DL023-ASGMT-NBR-SEQ-NBR TO DL020-KEY-NBR-SEQ-NBR.       10600000
106100                                                                  10610000
106200     MOVE PV-DOOR-COUNT TO DL020-NBR-OF-NBRS-NEED-QTY.            10620000
106300     MOVE PC-DLKUT024   TO DL020-ORIG-CALLING-PGM-NM.             10630000
106400                                                                  10640000
106500     CALL DL020-USER-PGM USING DL020-ASGMT-COMMAREA.              10650000
106600                                                                  10660000
106700     EVALUATE TRUE                                                10670000
106800        WHEN DL020-SUCCESSFUL                                     10680000
106900*            **************************************************** 10690000
107000*            *  ASSIGNMENT SENT IN HAS BEEN CLOSED, DLKUT024    * 10700000
107100*            *  HAS SENT BACK CURRENT OPEN ASSIGNMENT.          * 10710000
107200*            *                                                  * 10720000
107300*            **************************************************** 10730000
107400             IF DL020-ASGMT-NEXT-USED                             10740000
107500                MOVE DL020-NXT-START-DTE TO DL023-ASGMT-START-DTE 10750000
107600                MOVE DL020-NXT-NBR-TXT   TO DL023-ASGMT-NBR-TXT   10760000
107700                MOVE DL020-NXT-NBR-SEQ-NBR TO                     10770000
107800                                   DL023-ASGMT-NBR-SEQ-NBR        10780000
107900*            ELSE                                                 10790000
108000*               MOVE DL020-SEQ-START-NBR TO                       10800000
108100*                                  DL023-ASGMT-NBR-SEQ-NBR        10810000
108200             END-IF                                               10820000
108300                                                                  10830000
108400        WHEN DL020-CALLED-MODULE-FAILURE                          10840000
108500             SET  DL021-CALLED-MODULE-FAILURE TO TRUE             10850000
108600             MOVE DL020-CALL-MOD-FAIL-NM TO                       10860000
108700                                 DL021-CALL-MOD-FAIL-NM           10870000
108800             MOVE DL020-CALL-MOD-FAIL-ERR-CDE TO                  10880000
108900                                 DL021-CALL-MOD-FAIL-ERR-CDE      10890000
109000                                                                  10900000
109100        WHEN OTHER                                                10910000
109200             SET  DL021-CALLED-MODULE-FAILURE TO TRUE             10920000
109300             MOVE DL020-RETURN-CODE TO                            10930000
109400                               DL021-CALL-MOD-FAIL-ERR-CDE        10940000
109500             MOVE DL020-USER-PGM    TO                            10950000
109600                               DL021-CALL-MOD-FAIL-NM             10960000
109700             MOVE DL020-RETURN-SQLCODES TO                        10970000
109800                               DL021-RETURN-SQLCODES              10980000
109900             MOVE DL020-SQL-ERROR-PARA TO                         10990000
110000                               DL021-SQL-ERROR-PARA               11000000
110100             MOVE DL020-SQLCA TO DL021-SQLCA                      11010000
110200                                                                  11020000
110300     END-EVALUATE.                                                11030000
110400                                                                  11040000
110500                                                                  11050000
110600******************************************************************11060000
110700*                                                                *11070000
110800******************************************************************11080000
110900                                                                  11090000
111000 8000-COMMIT.                                                     11100000
111100                                                                  11110000
111200     EXEC SQL                                                     11120000
111300          COMMIT                                                  11130000
111400     END-EXEC.                                                    11140000
111500                                                                  11150000
111600     EVALUATE TRUE                                                11160000
111700         WHEN SQLCODE = ZERO                                      11170000
111800         WHEN SQLCODE = +100                                      11180000
111900             CONTINUE                                             11190000
112000         WHEN OTHER                                               11200000
112100              DISPLAY 'DLKUP025 - ERROR ON COMMIT'                11210000
112200     END-EVALUATE.                                                11220000
112300                                                                  11230000
112400                                                                  11240000
112500****************************************************************  11250000
112600*    RETRIEVE THE CURRENT TIMESTAMP TO USE WHEN UPDATING ROWS. *  11260000
112700*                                                              *  11270000
112800****************************************************************  11280000
112900                                                                  11290000
113000 8400-GET-TIMESTAMP.                                              11300000
113100                                                                  11310000
113200     EXEC SQL                                                     11320000
113300                                                                  11330000
113400         SET :PV-CURRENT-TIMESTAMP  = CURRENT TIMESTAMP           11340000
113500                                                                  11350000
113600     END-EXEC.                                                    11360000
113700                                                                  11370000
113800     EVALUATE TRUE                                                11380000
113900         WHEN SQLCODE = ZERO                                      11390000
114000              CONTINUE                                            11400000
114100                                                                  11410000
114200         WHEN OTHER                                               11420000
114300              SET DL021-SQL-ERROR      TO TRUE                    11430000
114400              MOVE '8400-'        TO DL021-SQL-ERROR-PARA         11440000
114500              MOVE SQLCODE        TO DL021-ASGMT-SQLCODE          11450000
114600                                                                  11460000
114700      END-EVALUATE.                                               11470000
114800                                                                  11480000
114900                                                                  11490000
