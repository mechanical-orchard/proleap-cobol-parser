000200*                                                                 00010014
000900*---------------------------------------------------------------* 00020014
000100 IDENTIFICATION DIVISION.                                         00030002
000900*---------------------------------------------------------------* 00040014
000200*                                                                 00050002
000300 PROGRAM-ID.    VLKUT006.                                         00060030
000400 AUTHOR.        COGNIZANT.                                        00070025
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080002
000600 DATE-WRITTEN.  08/08/2014.                                       00090035
000700 DATE-COMPILED.                                                   00100002
000800*                                                                 00110002
000900*---------------------------------------------------------------* 00120002
001000*  THIS PROGRAM FETCHES THE PO_NBR,RLSE_DTE FROM THE TPURCHS      00130035
001100*  TABLE FOR THE PREVIOUS RELEASE DATE AND WRITES IT INTO THE     00140035
001200*  OUTPUT FILE.                                                   00150035
001200*---------------------------------------------------------------* 00160035
001200* CHANGE DESCRIPTION                                              00170035
001200*---------------------------------------------------------------* 00181035
001200* DATE  08/08/2014                                                00190035
001200*  CHANGE MADE: INITIAL VERSION.                                  00190135
001200* MADE BY: VENKATSUBBU T (COGNIZANT)    TKID: TKMAGJ8             00190235
001200* CR NO : CHG0089449                                              00191037
001200*---------------------------------------------------------------* 00221039
001200* DATE  08/18/2014                                                00222039
001200*  CHANGE MADE: FIXED THE PO_NBR TRUNCATE ISSUE.                  00223039
001200* MADE BY: VENKATSUBBU T (COGNIZANT)    TKID: TKMAGJ8             00224039
001200* CR NO : CHG0089921                                              00225040
001300*---------------------------------------------------------------* 00226039
001500*                                                                 00230002
001600 ENVIRONMENT DIVISION.                                            00240002
001700 INPUT-OUTPUT SECTION.                                            00250002
001800*                                                                 00260002
001900 FILE-CONTROL.                                                    00270002
002000*                                                                 00280002
002200     SELECT OUTPUT-PO-EDI-PREV-FILE   ASSIGN TO OUT01.            00300025
002300*                                                                 00310002
002400 DATA DIVISION.                                                   00320002
002500*                                                                 00330002
002600 FILE SECTION.                                                    00340002
002700*                                                                 00350002
003500 FD  OUTPUT-PO-EDI-PREV-FILE                                      00430025
003600     RECORDING MODE IS F                                          00440002
003700     LABEL RECORDS ARE STANDARD                                   00450002
003800     BLOCK CONTAINS 0 RECORDS.                                    00460010
003900                                                                  00470002
004000 01  OUTPUT-PO-EDI-PREV-RECORD        PIC X(29).                  00480033
004100*                                                                 00490002
007900*----------------------------------------------------------------*00500013
007900*----------------------------------------------------------------*00510013
008000*       W O R K I N G - S T O R A G E  S E C T I O N.            *00520013
008100*----------------------------------------------------------------*00530013
008100*----------------------------------------------------------------*00540013
004300*                                                                 00550013
004200 WORKING-STORAGE SECTION.                                         00560013
004300 01 CC-CONTROL-CARD.                                              00561032
004300    05  CC-SCHEDULE-DATE.                                         00562032
004300        10  CC-CCYY                   PIC X(04).                  00563032
004300        10  CC-MM                     PIC X(02).                  00564032
004300        10  CC-DD                     PIC X(02).                  00565032
004300*                                                                 00566032
004400 01 WS-PROGRAM-VARS.                                              00570002
004500    05 WS-RECS-WRITE-COUNT            PIC 9(09) VALUE ZEROES.     00580025
004500    05 WS-DATE                        PIC X(10) VALUE SPACES.     00581025
004500    05 WS-DATE-8                      PIC X(08) VALUE SPACES.     00582032
004500    05 WS-CC-DATE                     PIC X(10) VALUE SPACES.     00583032
004500    05 WS-PO-NBR-8                    PIC 9(08) VALUE ZEROES.     00584038
005600*                                                                 00590025
005600 01 PS-PROGRAM-SWITCHES.                                          00600031
005600    05 PS-CURSOR-HAS-DATA-SW          PIC X(01) VALUE 'N'.        00601031
005600       88  PS-CURSOR-HAS-DATA                   VALUE 'Y'.        00602031
005600       88  PS-CURSOR-HAS-NO-DATA                VALUE 'N'.        00603031
005600    05 PS-TABLE-LOOP-DONE-SW          PIC X(01) VALUE 'N'.        00603131
005600       88  PS-TABLE-LOOP-DONE                   VALUE 'Y'.        00603231
005600       88  PS-TABLE-LOOP-NOT-DONE               VALUE 'N'.        00603331
005600                                                                  00604031
005600                                                                  00605031
005600*                                                                 00610031
004900 01  WS-ABEND-FIELDS.                                             00650008
005000     05  WS-ABEND-CODE                PIC S9(04)  VALUE ZERO      00660008
005100                                                   COMP SYNC.     00670008
005200     05  WS-ABEND-PROGRAM             PIC X(08)  VALUE 'VLKUT006'.00680025
005300     05  WS-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00690008
005400     05  WS-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00700008
005500     05  WS-SQLCODE                   PIC 9(09)  VALUE ZERO.      00710008
005600*                                                                 00720005
013410*----------------------------------------------------------------*00730025
013420*  OUTPUT LAYOUT FOR PO EDI FILE                                 *00740025
013430*----------------------------------------------------------------*00750025
013500 01  WS-PO-EDI-OUTPUT.                                            00760025
013510     05  WS-ACD-IND                   PIC X(01)  VALUE SPACES.    00770033
013510     05  WS-PO-NBR                    PIC X(20)  VALUE SPACES.    00770133
013530     05  WS-RLSE-DTE                  PIC X(08)  VALUE SPACES.    00772025
007900*                                                                 00781025
007900*----------------------------------------------------------------*00790013
008000*            C O P Y B O O K  S E C T I O N .                    *00800013
008100*----------------------------------------------------------------*00810002
007800*                                                                 00830013
009100*----------------------------------------------------------------*00960012
010700*  DB2 FORMATTED MESSAGE AREA                                     00970012
009100*----------------------------------------------------------------*00980012
010800*                                                                 00990012
010900     COPY DPWS004.                                                01000012
011900*                                                                 01010012
009100*----------------------------------------------------------------*01020002
009200*    DB2 SQL COMMUNICATION AREA                                   01030002
009300*----------------------------------------------------------------*01040002
009400     EXEC SQL                                                     01050002
009500          INCLUDE SQLCA                                           01060002
009600     END-EXEC.                                                    01070002
009800*----------------------------------------------------------------*01090002
009900*    DB2 DCLGEN FOR PO PLANNED SHIPMENT TABLE                     01100002
010000*----------------------------------------------------------------*01110002
010100     EXEC SQL                                                     01120002
010200          INCLUDE TPURCHS                                         01130025
010300     END-EXEC.                                                    01140002
007900*----------------------------------------------------------------*01170013
007900     EXEC SQL                                                     01173031
007900         DECLARE TPURCHS-CURSOR CURSOR FOR                        01174031
007900             SELECT PO_NBR,RLSE_DTE                               01175031
007900               FROM TPURCHS                                       01178131
007900              WHERE VER_STATUS_CDE = 'A'                          01178231
007900                AND RLSE_DTE = :WS-CC-DATE                        01178532
007900               WITH UR                                            01178631
007900     END-EXEC.                                                    01178731
007900*----------------------------------------------------------------*01180013
008000*       P R O C E D U R E   D I V I S I O N .                    *01190013
008100*----------------------------------------------------------------*01200013
008100*----------------------------------------------------------------*01210013
004300*                                                                 01220013
010500 PROCEDURE DIVISION.                                              01230002
010600*                                                                 01240002
010600     DISPLAY '**** BEGINNING VLKUT006 ****'.                      01250025
010600     DISPLAY ' '.                                                 01260025
011000 0000-MAIN-PARA.                                                  01320025
011100     PERFORM 1000-INITIALIZATION.                                 01330025
011100     PERFORM 9000-EOJ.                                            01332025
011100*                                                                 01333025
011100     STOP RUN.                                                    01334025
011100*                                                                 01335025
013100*----------------------------------------------------------------*01540002
013200* INITIALIZE PARA.                                               *01550025
013300*----------------------------------------------------------------*01560002
013400 1000-INITIALIZATION.                                             01570025
013500*                                                                 01580025
013600     MOVE '1000-INITIALIZATION ' TO WS-ABEND-PARAGRAPH.           01590025
013700*                                                                 01600025
013800     INITIALIZE WS-PROGRAM-VARS                                   01610025
013900                WS-PO-EDI-OUTPUT.                                 01620025
013900*                                                                 01621025
014000     OPEN OUTPUT OUTPUT-PO-EDI-PREV-FILE                          01630031
014700                                                                  01700032
014700     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01700132
014700                                                                  01700232
014700     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD               01700332
014700                                                                  01700432
014700     STRING CC-CCYY DELIMITED BY SIZE                             01700532
014700            '-'     DELIMITED BY SIZE                             01700632
014700            CC-MM   DELIMITED BY SIZE                             01700732
014700            '-'     DELIMITED BY SIZE                             01700832
014700            CC-DD   DELIMITED BY SIZE                             01700932
014700     INTO   WS-CC-DATE                                            01701032
014700                                                                  01701132
014700     DISPLAY 'CC-DATE  ====>  ' WS-CC-DATE                        01701232
014700                                                                  01701332
014700     PERFORM 1100-OPEN-CURSOR.                                    01701432
014700     IF PS-CURSOR-HAS-DATA                                        01701532
014700      PERFORM 1200-FETCH-CURSOR                                   01701632
014700        UNTIL PS-TABLE-LOOP-DONE.                                 01701732
014700     PERFORM 1300-CLOSE-CURSOR.                                   01701832
014700*                                                                 01702031
014800*----------------------------------------------------------------*01710002
014900* 1100-OPEN-CURSOR.                                              *01720031
015000*----------------------------------------------------------------*01730002
014700 1100-OPEN-CURSOR.                                                01731031
014700*                                                                 01732031
014700     EXEC SQL                                                     01733031
014700          OPEN TPURCHS-CURSOR                                     01734031
014700     END-EXEC.                                                    01735031
014700                                                                  01736031
014700     EVALUATE TRUE                                                01737031
014700         WHEN SQLCODE EQUAL ZERO                                  01738031
014700            SET PS-CURSOR-HAS-DATA TO TRUE                        01739031
014700         WHEN SQLCODE = +100                                      01739131
014700            SET PS-CURSOR-HAS-NO-DATA TO TRUE                     01739231
014700         WHEN OTHER                                               01739331
014700            MOVE '1100-OPEN-CURSOR'  TO WS-ABEND-PARAGRAPH        01739431
014700            MOVE 'OPEN TPURCHS-CURSOR' TO WS-ABEND-OPERATION      01739531
014700            PERFORM 9900-DB2-ABEND                                01739631
014700     END-EVALUATE.                                                01739731
014700*                                                                 01739831
014800*----------------------------------------------------------------*01739931
014900* 1200-FETCH-CURSOR.                                             *01740031
015000*----------------------------------------------------------------*01740131
014700 1200-FETCH-CURSOR.                                               01740231
014700*                                                                 01740331
014700     EXEC SQL                                                     01740431
014700         FETCH TPURCHS-CURSOR                                     01740531
014700          INTO                                                    01740631
014700             :PURCHS-PO-NBR                                       01740731
014700            ,:PURCHS-RLSE-DTE                                     01740831
014700     END-EXEC.                                                    01741031
014700                                                                  01741131
014700     EVALUATE TRUE                                                01741231
014700         WHEN SQLCODE = +0                                        01741331
014700            PERFORM 2100-WRITE-EDI-FILE                           01741431
014700         WHEN SQLCODE = +100                                      01741531
014700            SET PS-TABLE-LOOP-DONE TO TRUE                        01741631
014700         WHEN OTHER                                               01741731
014700            MOVE '1200-FETCH-CURSOR'  TO WS-ABEND-PARAGRAPH       01741831
014700            MOVE 'FETCH TPURCHS-CURSOR' TO WS-ABEND-OPERATION     01741931
014700            PERFORM 9900-DB2-ABEND                                01742031
014700     END-EVALUATE.                                                01742131
014700*                                                                 01742231
014800*----------------------------------------------------------------*01742331
014900* 1300-CLOSE-CURSOR.                                             *01742431
015000*----------------------------------------------------------------*01742531
014700 1300-CLOSE-CURSOR.                                               01742631
014700*                                                                 01742731
014700     EXEC SQL                                                     01742831
014700          CLOSE TPURCHS-CURSOR                                    01742931
014700     END-EXEC.                                                    01743031
014700                                                                  01743131
014700     EVALUATE TRUE                                                01743231
014700         WHEN SQLCODE EQUAL ZERO                                  01743331
014700            CONTINUE                                              01743431
014700         WHEN OTHER                                               01743731
014700            MOVE '1300-CLOSE-CURSOR'  TO WS-ABEND-PARAGRAPH       01743831
014700            MOVE 'CLOSE TPURCHS-CURSOR' TO WS-ABEND-OPERATION     01743931
014700            PERFORM 9900-DB2-ABEND                                01744031
014700     END-EVALUATE.                                                01744131
014700*                                                                 01744231
018000*----------------------------------------------------------------*02020002
018100*  WRITE PO_NBR AND RLSE_DATE TO OUTPUT FILE                      02030035
018200*----------------------------------------------------------------*02050002
018400 2100-WRITE-EDI-FILE.                                             02070028
018500*                                                                 02080008
018500         MOVE 'A'                   TO WS-ACD-IND                 02090033
018500         MOVE PURCHS-PO-NBR         TO WS-PO-NBR-8                02091034
018500         MOVE WS-PO-NBR-8           TO WS-PO-NBR                  02092034
019000         MOVE PURCHS-RLSE-DTE       TO WS-DATE                    02280025
020200          MOVE WS-DATE(1:4)         TO WS-DATE-8(1:4)             02340025
020200          MOVE WS-DATE(6:2)         TO WS-DATE-8(5:2)             02350025
020200          MOVE WS-DATE(9:2)         TO WS-DATE-8(7:2)             02360025
020200          MOVE WS-DATE-8            TO WS-RLSE-DTE                02370025
020200*                                                                 02380025
025000     WRITE OUTPUT-PO-EDI-PREV-RECORD FROM WS-PO-EDI-OUTPUT        02850025
024900     ADD   1                        TO WS-RECS-WRITE-COUNT.       02851025
024800*                                                                 02860013
039700*---------------------------------------------------------------* 02861025
039800*  END OF JOB OPERATIONS                                        * 02862025
039900*---------------------------------------------------------------* 02863025
040000 9000-EOJ.                                                        02864025
040100*                                                                 02865025
040200     MOVE '9000-EOJ ' TO WS-ABEND-PARAGRAPH.                      02866025
040300*                                                                 02867025
040400     CLOSE OUTPUT-PO-EDI-PREV-FILE.                               02868025
041114*                                                                 02869325
041200      DISPLAY 'EDI REC WRITE COUNT    : ' WS-RECS-WRITE-COUNT.    02869431
041700*                                                                 02869825
025100*----------------------------------------------------------------*02870004
025200*  DB2 ABEND ROUTINE                                             *02880004
025300*----------------------------------------------------------------*02890004
025400 9900-DB2-ABEND.                                                  02900004
025500*                                                                 02910004
025600     MOVE SQLCODE                   TO WS-SQLCODE.                02920008
025700     DISPLAY '*** DB2 ERROR '.                                    02930004
025800     DISPLAY '*** SQLCODE   = '     WS-SQLCODE.                   02940008
025900     DISPLAY '*** PROGRAM   = '     WS-ABEND-PROGRAM.             02950008
026000     DISPLAY '*** PARAGRAPH = '     WS-ABEND-PARAGRAPH.           02960008
026100     DISPLAY '*** OPERATION = '     WS-ABEND-OPERATION.           02970008
026400*                                                                 02980004
177800     COPY DPPD004.                                                02990013
026400*                                                                 03000013
026700     MOVE +4013                     TO WS-ABEND-CODE.             03010008
026800     CALL 'ILBOABN0'                USING WS-ABEND-CODE.          03020008
026900*                                                                 03030004
027000*----------------------------------------------------------------*03040008
027100*----------------------------------------------------------------*03050008
027200*            *    E N D  O F  V L K U T 0 0 6    *               *03060036
027300*----------------------------------------------------------------*03070008
027400*----------------------------------------------------------------*03080008
