000100*----------------------------------------------------------------*00010027
000200 IDENTIFICATION DIVISION.                                         00020011
000300*----------------------------------------------------------------*00030027
000400*                                                                 00040011
000500 PROGRAM-ID.             SUKRP060.                                00050011
000600 AUTHOR.                 SAURABH DUDDALWAR.                       00060011
000700 INSTALLATION.           KOHLS.                                   00070011
000800 DATE-WRITTEN.           SEPTEMBER, 2009.                         00080027
000900 DATE-COMPILED.          SEPTEMBER, 2009.                         00090027
001000*                                                                 00100011
001100*----------------------------------------------------------------*00110027
001200*  THIS PROGRAM WILL GENERATE A REPORT WHEN EARLIER REPORT       *00120027
001300*  GENERATING PROGRAM FAILS BECAUSE OF DATA CONTENTION ERROR.    *00130027
001400*  THIS PROGRAM INFORM THE USER TO RESUBMIT THE REQUEST FOR      *00140027
001500*  GENERATION.                                                   *00150027
001600*                                                                *00160027
001700*  THIS PROGRAM WILL ALSO COMPLETE THE JOB WITH THE RETURN-CODE  *00170027
001800*  ZERO UPON ITS SUCCESSFUL COMPLETION AND THUS AVOIDING THE JOB *00180027
001900*  COMPLETING WITH S04C ERROR.                                   *00190027
002000*                                                                *00200027
002100*  PLEASE NOTE THIS PROGRAM WILL ONLY EXECUTE IF THERE IS ANY    *00210027
002200*  DATA CONTENTION ISSUE FACED BY THE UPSTREAM PROGRAM IN THE    *00220027
002300*  JOB.                                                          *00230027
002400*                                                                *00240027
002500*----------------------------------------------------------------*00250027
002600*                                                                 00260011
002700*----------------------------------------------------------------*00270027
002800 ENVIRONMENT DIVISION.                                            00280011
002900*----------------------------------------------------------------*00290027
003000*                                                                 00300011
003100 CONFIGURATION SECTION.                                           00310011
003200*                                                                 00320011
003300 SOURCE-COMPUTER.        IBM-3090.                                00330011
003400 OBJECT-COMPUTER.        IBM-3090.                                00340011
003500*                                                                 00350011
003600 INPUT-OUTPUT SECTION.                                            00360011
003700*                                                                 00370011
003800 FILE-CONTROL.                                                    00380011
003900*                                                                 00390011
004000     SELECT IN-AUDIT-SUM-EXTRACT-FILE                             00400011
004100     ASSIGN TO INP01                                              00410011
004200     FILE STATUS IS WS-INFILE-STATUS.                             00420011
004300*                                                                 00430011
004400     SELECT OUT-DATA-CONT-ERROR-REPORT                            00440013
004500     ASSIGN TO OUT01                                              00450011
004600     FILE STATUS IS WS-OUTFILE-STATUS.                            00460011
004700*                                                                 00470011
004800*----------------------------------------------------------------*00480027
004900 DATA DIVISION.                                                   00490011
005000*----------------------------------------------------------------*00500027
005100*                                                                 00510011
005200 FILE SECTION.                                                    00520011
005300*                                                                 00530011
005400 FD  IN-AUDIT-SUM-EXTRACT-FILE                                    00540011
005500     RECORDING MODE IS F                                          00550011
005600     LABEL RECORDS ARE STANDARD                                   00560011
005700     BLOCK CONTAINS 0 RECORDS.                                    00570011
005800*                                                                 00580011
005900 01  IN-AUDIT-SUM-EXTRACT-RECORD         PIC  X(80).              00590035
006000*                                                                 00600011
006100 FD  OUT-DATA-CONT-ERROR-REPORT                                   00610013
006200     RECORDING MODE IS F                                          00620011
006300     LABEL RECORDS ARE STANDARD                                   00630011
006400     BLOCK CONTAINS 0 RECORDS.                                    00640011
006500*                                                                 00650011
006600 01  OUT-DATA-CONT-ERROR-RECORD          PIC  X(132).             00660021
006700*                                                                 00670011
006800*----------------------------------------------------------------*00680011
006900 WORKING-STORAGE SECTION.                                         00690011
007000*----------------------------------------------------------------*00700011
007100*                                                                 00710011
007200* COPYBOOK USED IN THE PROGRAMS.                                  00720011
007300*                                                                 00730011
007400*---------------------------------------------------------------* 00740011
007500*  RECORD LAYOUT FOR THE AUDIT SUMMARY EXTRACT FILE             * 00750011
007600*---------------------------------------------------------------* 00760011
007700     COPY SURD005.                                                00770011
007800*                                                                 00780011
007900*---------------------------------------------------------------* 00790011
008000*  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT.              * 00800011
008100*---------------------------------------------------------------* 00810011
008200     COPY DPWS132O.                                               00820011
008300*                                                                 00830011
008400***************************************************************** 00840011
008500*                                                                 00850027
008600 01  OUT-REPORT-LINE1.                                            00860011
008700     05  FILLER                       PIC  X(02)  VALUE SPACE.    00870027
008800*                                                                 00880027
008900     05  FILLER                       PIC  X(25)  VALUE           00890027
009000         'AUDIT CONTROL NUMBER    :'.                             00900026
009100     05  FILLER                       PIC  X(05)  VALUE SPACE.    00910027
009200     05  OUT-AUDIT-CONTROL-NUMBER     PIC  Z(8)9  VALUE SPACE.    00920029
009300     05  FILLER                       PIC  X(91)  VALUE SPACE.    00930029
009400*                                                                 00940027
009500 01  OUT-REPORT-LINE2.                                            00950011
009600     05  FILLER                       PIC  X(02)  VALUE SPACE.    00960027
009700*                                                                 00970027
009800     05  FILLER                       PIC  X(25)  VALUE           00980027
009900         'TYPE OF REPORT REQUESTED:'.                             00990011
010000     05  FILLER                       PIC  X(05)  VALUE SPACE.    01000027
010100     05  OUT-REPORT-NAME              PIC  X(60)  VALUE SPACE.    01010030
010200     05  FILLER                       PIC  X(40)  VALUE SPACE.    01020030
010300*                                                                 01030027
010400 01  OUT-REPORT-LINE3.                                            01040021
010500     05  FILLER                       PIC  X(22)  VALUE SPACE.    01050027
010600     05  FILLER                       PIC  X(55)  VALUE           01060027
010700     'UNEXPECTED PROCESSING ISSUES PREVENTED THIS REPORT FROM'.   01070020
010800     05  FILLER                       PIC  X(54) VALUE            01080027
010900     ' BEING PRINTED - PLEASE SUBMIT YOUR REQUEST AGAIN.'.        01090021
011000*                                                                 01100027
011100 01  END-OF-REPORT-LINE.                                          01110015
011200     05  FILLER                       PIC  X(48)  VALUE SPACE.    01120027
011300     05  FILLER                       PIC  X(25)  VALUE           01130027
011400         '***** END OF REPORT *****'.                             01140015
011500     05  FILLER                       PIC  X(59)  VALUE SPACE.    01150027
011600*                                                                 01160011
011700 01  WS-FLAGS.                                                    01170011
011800     05  WS-OUTFILE-STATUS            PIC X(02) VALUE SPACES.     01180011
011900         88 OUTFILE-OK                          VALUE '00'.       01190011
012000     05  WS-INFILE-STATUS             PIC X(02) VALUE SPACES.     01200011
012100         88 INFILE-OK                           VALUE '00'.       01210011
012200*                                                                 01220011
012300 01  WS-CONSTANT.                                                 01230011
012400     05  WS-ONE                       PIC 9(01) VALUE 1.          01240011
012500     05  WS-PROGRAM-NAME              PIC X(08) VALUE 'SUKRP060'. 01250023
012600     05  WS-REPORT-NAME               PIC X(08) VALUE 'SUKRP060'. 01260034
012700*                                                                 01270036
012800 01  WS-VARS.                                                     01280037
012900     05  WS-AUDIT-CONTROL-NUMBER      PIC 9(09) VALUE ZEROES.     01290032
013000     05  INPUT-AUDIT-DETAIL-RECORD.                               01300028
013100         10 WS-AUDIT-NUMBER           PIC 9(09).                  01310035
013200         10 FILLER                    PIC X(71) VALUE SPACES.     01320035
013300     05  WS-INPUT-REPORT              PIC X(60) VALUE SPACES.     01330030
013400     05  WS-DATE                      PIC 9(06) VALUE ZEROES.     01340011
013500     05  FILLER                       REDEFINES WS-DATE.          01350011
013600         10 WS-YEAR                   PIC 9(02).                  01360013
013700         10 WS-MONTH                  PIC 9(02).                  01370013
013800         10 WS-DAY                    PIC 9(02).                  01380013
013900*                                                                 01390011
014000     05  WS-TIME                      PIC 9(08) VALUE ZEROES.     01400018
014100     05  FILLER                       REDEFINES WS-TIME.          01410011
014200         10 WS-HOUR                   PIC 9(02).                  01420013
014300         10 WS-MINUTE                 PIC 9(02).                  01430013
014400         10 FILLER                    PIC 9(04).                  01440013
014500*                                                                 01450011
014600*----------------------------------------------------------------*01460027
014700 PROCEDURE DIVISION.                                              01470027
014800*----------------------------------------------------------------*01480027
014900*                                                                 01490011
015000*----------------------------------------------------------------*01500011
015100*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *01510027
015200*----------------------------------------------------------------*01520011
015300*                                                                 01530011
015400 0000-PROGRAM-MAINLINE.                                           01540011
015500*                                                                 01550011
015600     PERFORM 1000-INITIALIZE.                                     01560011
015700*                                                                 01570011
015800     PERFORM 2000-OPEN-FILES.                                     01580037
015900*                                                                 01590011
016000     PERFORM 3000-READ-EXTRACT-FILE.                              01600027
016100*                                                                 01610021
016200     PERFORM 4000-WRITE-CONTENTION-REPORT.                        01620037
016300*                                                                 01630011
016400     PERFORM 8000-CLOSE-FILES.                                    01640037
016500*                                                                 01650011
016600     MOVE +0                            TO RETURN-CODE.           01660038
016610     STOP RUN.                                                    01661038
016700*                                                                 01670011
016800*----------------------------------------------------------------*01680011
016900*  1000-INITIALIZE.                                              *01690011
017000*       - ACCEPTS THE REPORT TYPE FROM THE JOB SYSIN PARAMETER.  *01700027
017100*       - INITIALIZE THE VARIABLES AND FLAGS USED IN THE PROGRAM.*01710027
017200*----------------------------------------------------------------*01720011
017300*                                                                 01730011
017400 1000-INITIALIZE.                                                 01740011
017500*                                                                 01750011
017600     INITIALIZE WS-FLAGS,                                         01760013
017700                WS-VARS.                                          01770013
017800*                                                                 01780011
017900     ACCEPT WS-INPUT-REPORT          FROM SYSIN.                  01790027
018000*                                                                 01800011
018100*----------------------------------------------------------------*01810011
018200* 2000-OPEN-FILES.                                               *01820011
018300* OPENING THE FILES USED IN THE PROGRAM.                         *01830011
018400*----------------------------------------------------------------*01840011
018500*                                                                 01850011
018600 2000-OPEN-FILES.                                                 01860011
018700                                                                  01870011
018800     OPEN OUTPUT OUT-DATA-CONT-ERROR-REPORT.                      01880027
018900*                                                                 01890011
019000     OPEN INPUT   IN-AUDIT-SUM-EXTRACT-FILE.                      01900027
019100*                                                                 01910011
019200*----------------------------------------------------------------*01920011
019300* 3000-READ-EXTRACT-FILE.                                        *01930027
019400*      READS THE NEXT RECORD FROM THE AUDIT SUMMARY EXTRACT FILE *01940027
019500*      AUDIT CONTROL NUMBER IS READ FROM THE INPUT FILE.         *01950027
019600*----------------------------------------------------------------*01960027
019700*                                                                 01970027
019800 3000-READ-EXTRACT-FILE.                                          01980027
019900*                                                                 01990027
020000     INITIALIZE INPUT-AUDIT-DETAIL-RECORD.                        02000028
020100*                                                                 02010027
020200     READ IN-AUDIT-SUM-EXTRACT-FILE                               02020027
020300     INTO INPUT-AUDIT-DETAIL-RECORD                               02030028
020400     END-READ.                                                    02040027
020500*                                                                 02050027
020600*----------------------------------------------------------------*02060027
020700*  4000-WRITE-CONTENTION-REPORT.                                 *02070027
020800*       - WRITES THE CONTENTION REPORT WITH FOLLOWING DETAILS.   *02080027
020900*       - AUDIT CONTROL NUMBER.                                  *02090027
021000*       - TYPE OF REPORT REQUESTED.                              *02100027
021100*----------------------------------------------------------------*02110027
021200*                                                                 02120027
021300 4000-WRITE-CONTENTION-REPORT.                                    02130027
021400*                                                                 02140027
021500     INITIALIZE DP132O-STANDRD-HEADER-132-COLS,                   02150027
021600                WS-DATE.                                          02160027
021700*                                                                 02170027
021800     ACCEPT WS-DATE                  FROM DATE.                   02180027
021900     MOVE WS-YEAR                    TO DP132O-RUN-YEAR.          02190027
022000     MOVE WS-MONTH                   TO DP132O-RUN-MONTH.         02200027
022100     MOVE WS-DAY                     TO DP132O-RUN-DAY.           02210027
022200*                                                                 02220027
022300     ACCEPT WS-TIME                  FROM TIME.                   02230027
022400     MOVE WS-HOUR                    TO DP132O-RUN-HOUR.          02240027
022500     MOVE WS-MINUTE                  TO DP132O-RUN-MINUTE.        02250027
022600     MOVE WS-REPORT-NAME             TO DP132O-PROGRAM-NAME.      02260027
022700*                                                                 02270027
022800     MOVE WS-ONE                     TO DP132O-REPORT-NUMBER.     02280027
022900     MOVE WS-ONE                     TO DP132O-PAGE-NUMBER.       02290027
023000*                                                                 02300027
023100     WRITE OUT-DATA-CONT-ERROR-RECORD                             02310027
023200      FROM DP132O-STANDRD-HEADER-132-COLS.                        02320027
023300*                                                                 02330027
023400     MOVE WS-AUDIT-NUMBER            TO OUT-AUDIT-CONTROL-NUMBER. 02340035
023500*                                                                 02350027
023600     WRITE OUT-DATA-CONT-ERROR-RECORD                             02360027
023700      FROM OUT-REPORT-LINE1          AFTER 3.                     02370027
023800*                                                                 02380027
023900     MOVE WS-INPUT-REPORT            TO OUT-REPORT-NAME.          02390027
024000     WRITE OUT-DATA-CONT-ERROR-RECORD                             02400027
024100      FROM OUT-REPORT-LINE2.                                      02410027
024200*                                                                 02420027
024300     WRITE OUT-DATA-CONT-ERROR-RECORD                             02430027
024400      FROM OUT-REPORT-LINE3          AFTER 5.                     02440027
024500*                                                                 02450027
024600     WRITE OUT-DATA-CONT-ERROR-RECORD                             02460027
024700      FROM END-OF-REPORT-LINE        AFTER 5.                     02470027
024800*                                                                 02480027
024900*----------------------------------------------------------------*02490027
025000* 8000-CLOSE-FILES.                                              *02500027
025100* CLOSING ALL THE FILES USED IN THE PROGRAM.                     *02510027
025200*----------------------------------------------------------------*02520027
025300*                                                                 02530027
025400  8000-CLOSE-FILES.                                               02540027
025500*                                                                 02550027
025600     CLOSE OUT-DATA-CONT-ERROR-REPORT.                            02560027
025700*                                                                 02570027
025800     CLOSE IN-AUDIT-SUM-EXTRACT-FILE.                             02580027
025900*                                                                 02590027
026900*                                                                 02690027
027000*----------------------------------------------------------------*02700027
027100*----------------------------------------------------------------*02710027
027200*               S U K R P 0 6 0  E N D S  H E R E .              *02720027
027300*----------------------------------------------------------------*02730027
027400*----------------------------------------------------------------*02740027
027500*                                                                 02750027
