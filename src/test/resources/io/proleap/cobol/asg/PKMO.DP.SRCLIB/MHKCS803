      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.                MHKCS803.                             00050000
       AUTHOR.                    MARIA KLAMIK.                         00060000
       INSTALLATION.              KOHLS DEPARTMENT STORES.              00070000
       DATE-WRITTEN.              08-10-2004.                           00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      *               CICS PROGRAM - MHKCS803 - F803                   *00120000
      *                                                                *00130000
      *           MERCHANDISE INQUIRY - SKU/STORE INQUIRY              *00140000
      *                                                                *00150000
      *  THIS PROGRAM ALLOWS THE USERS TO ENTER SKU AND STORE TO       *00160000
      *  RETRIEVE DETAIL INFORMATION.                                  *00170000
      *                                                                *00180000
      *           SKU              - A VALID 8 DIGIT SKU NUMBER        *00190000
      *           STORE            - A VALID STORE NUMBER              *00200000
      *                                                                *00210000
      *  IF A VALID REQUEST HAS BEEN MADE, THE FOLLOWING APPLIES WHEN  *00220000
      *  DETERMINING THE SUBSEQUENT SCREEN TO DISPLAY:                 *00230000
      *                                                                *00240000
      *  IF ANY SYSTEM ERRORS ARE DETECTED, THAT THE PROGRAM CAN       *00250000
      *  NOT RESOLVE, THE PROGRAM WILL BE TERMINATED, AN ERROR         *00260000
      *  MESSAGE WILL BE DISPLAYED ON THE SCREEN, AND PROGRAM CONTROL  *00270000
      *  WILL BE RETURNED TO NATIVE CICS.                              *00280000
      *                                                                *00290000
      *  WHEN NAVIGATING TO THE REGIONAL CLEARANCE PRICE (RCP) SCREEN, *00300000
      *  THE PROGRAM WILL VALIATE THAT THE SKU IS AN RCP SKU AND THE   *00310000
      *  STORE IS ZERO (CORPORATE).                                    *00320000
      *                                                                *00330000
      ******************************************************************00340000
      *  MAINTENANCE                                                   *00350000
      ******************************************************************00360000
      *  CHANGED 08/10/2004 REVISED BY MARIA KLAMIK -                  *00370000
      *    INITIAL INSTALLATION OF SKU/STORE DETAIL SCREEN.            *00380000
      *                                            (WR# 26354)         *00390000
      ******************************************************************00400000
      *  CHANGED 09/03/2004 REVISED BY MARIA KLAMIK -                  *00401000
      *    INITIAL INSTALLATION-RCP FIX FOR RED TICKET STATUS '30'     *00402000
      *    STORES THAT DO NOT HAVE A ROW ON TUPCPLS.                   *00402100
      *    STAUS MUST REMAIN '30' NOT CHANGED TO '20'.                 *00402200
      *                                            (P000688661)        *00403000
      ******************************************************************00404000
      *  CHANGED 09/07/2004 REVISED BY MARIA KLAMIK -                  *00406000
      *    INITIAL INSTALLATION-STATUS AND PRICE CHANGE DATES -        *00407000
      *    ZERO OUT DATES WHEN THEY BOTH MATCH THE SETUP DATE.         *00408000
      *    THEY ARE DEFAULT DATES AND NO CHANGES HAVE OCCURRED.        *00409000
      *                                            (P000689564)        *00409100
      ******************************************************************00409200
KP1005*  CHANGED 10/27/2005 REVISED BY KRISTIN PETERSON -              *00409308
KP1005*    CHANGES REQUIRED FOR MARKDOWN OPTIMIZATION.  (WR# 29725)    *00409409
KP1005******************************************************************00409802
W30677*  CHANGED 05/23/2006 REVISED BY JILL LIN -                      *00410027
W30677*    CHANGES REQUIRED FOR ADDING STORE EXPECTED QTY AND BRAND    *00410127
W30677*    AND BRAND NAME.                              (WR# 30677)    *00410228
      ******************************************************************00410330
      *  CHANGED 04/11/2006 REVISED BY D. THEEL -                      *00410530
      *    ADD RECLASS FROM DEPT AND SCL IF SKU WAS RECLASSED.         *00410630
      *                                                  WR# 28985     *00410730
      ******************************************************************00410830
262978* CHANGED 10/21/2021    BY JIM HUNTER      WR: CHG0262978         00410940
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00411040
262978* MAKING THE CALL DYNAMIC VS STATIC.                              00411140
262978******************************************************************00411240
CICS  * CHANGED 10/28/2022    BY JIM HUNTER      WR: CHG0277420         00411341
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00411441
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00411541
CICS  ******************************************************************00411641
       ENVIRONMENT DIVISION.                                            00412010
      ******************************************************************00420000
                                                                        00430000
      ******************************************************************00440000
       DATA DIVISION.                                                   00450000
      ******************************************************************00460000
                                                                        00470000
                                                                        00480000
       WORKING-STORAGE SECTION.                                         00490000
      *                                                                 00500000
       01  PC-PROGRAM-CONSTANTS.                                        00510000
           05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'MH803A  '.  00520000
           05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'MHKM803 '.  00530000
           05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'MHKCS803'.  00540000
           05  PC-TSYMSG-NUMBERS.                                       00550000
               10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00560000
               10  PC-TSYMSG-00113      PIC  9(05)  VALUE  00113.       00590000
               10  PC-TSYMSG-00332      PIC  9(05)  VALUE  00332.       00600000
               10  PC-TSYMSG-00419      PIC  9(05)  VALUE  00419.       00610000
               10  PC-TSYMSG-00438      PIC  9(05)  VALUE  00438.       00620000
               10  PC-TSYMSG-02134      PIC  9(05)  VALUE  02134.       00630000
               10  PC-TSYMSG-02136      PIC  9(05)  VALUE  02136.       00631000
               10  PC-TSYMSG-02294      PIC  9(05)  VALUE  02294.       00632000
               10  PC-TSYMSG-02616      PIC  9(05)  VALUE  02616.       00650000
               10  PC-TSYMSG-03328      PIC  9(05)  VALUE  03328.       00661000
           05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00670000
                                                    COMP.               00680000
           05  PC-CORP-LOCATION         PIC X(05)   VALUE '00000'.      00690000
           05  PC-CORP-DESC             PIC X(10)                       00700000
                                         VALUE 'ALL STORES'.            00710000
           05  PC-INQ                   PIC X(03)   VALUE 'INQ'.        00720000
           05  PC-ZERO-DTE              PIC X(10)   VALUE '00/00/0000'. 00721000
      *                                                                 00730000
       01  PV-PROGRAM-VARIABLES.                                        00740000
           05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00750000
                                                    COMP SYNC.          00760000
           05  PV-CICS-RESPONSE         PIC S9(9)   VALUE ZERO          00761000
                                                     COMP SYNC.         00762000
           05  PV-SKU-NBR               PIC S9(08)V COMP-3 VALUE +0.    00770000
           05  PV-LOC-NBR               PIC S9(4) COMP.                 00780000
           05  PV-ITEM-NBR              PIC S9(15)  COMP-3.             00790000
           05  PV-DATE-YMD              PIC 9(6)     VALUE ZERO.        00800000
           05  FILLER                   REDEFINES PV-DATE-YMD.          00810000
               10  PV-DATE-YY           PIC 9(2).                       00820000
               10  PV-DATE-MM           PIC 9(2).                       00830000
               10  PV-DATE-DD           PIC 9(2).                       00840000
           05  PV-DATE-FMT.                                             00850000
               10  PV-DATE-MM-FMT       PIC X(2).                       00850100
               10  FILLER               PIC X(1)  VALUE '/'.            00852000
               10  PV-DATE-DD-FMT       PIC X(2).                       00853000
               10  FILLER               PIC X(1)  VALUE '/'.            00854000
               10  PV-DATE-CC-FMT       PIC X(2).                       00860000
               10  PV-DATE-YY-FMT       PIC X(2).                       00870000
           05  PV-DATE-FMT-DB2.                                         00880000
               10  PV-DATE-CC-FMT-DB2   PIC X(2).                       00881000
               10  PV-DATE-YY-FMT-DB2   PIC X(2).                       00882000
               10  FILLER               PIC X(1)  VALUE '-'.            00883000
               10  PV-DATE-MM-FMT-DB2   PIC X(2).                       00890000
               10  FILLER               PIC X(1)  VALUE '-'.            00900000
               10  PV-DATE-DD-FMT-DB2   PIC X(2).                       00910000
           05  PV-DATE-COMPARE.                                         00911000
               10  PV-DATE-CC-C         PIC 9(02).                      00912000
               10  PV-DATE-YY-C         PIC 9(02).                      00913000
               10  PV-DATE-MM-C         PIC 9(02).                      00915000
               10  PV-DATE-DD-C         PIC 9(02).                      00917000
           05  PV-DEPT-NBR              PIC 9(04).                      00922000
           05  PV-DEPT-NBR-CHAR-3.                                      00930000
               10 FILLER                PIC X(01).                      00940000
               10 PV-DEPT-NBR-3         PIC X(03).                      00950000
           05  PV-MCL-NBR               PIC 9(04).                      00960000
           05  PV-MCL-NBR-CHAR-2.                                       00970000
               10 FILLER                PIC X(02).                      00980000
               10 PV-MCL-NBR-2          PIC X(02).                      00990000
           05  PV-SCL-NBR               PIC 9(04).                      01000000
           05  PV-SCL-NBR-CHAR-2.                                       01010000
               10 FILLER                PIC 9(02).                      01020000
               10 PV-SCL-NBR-2          PIC 9(02).                      01030000
           05  PV-SCL-NBR-CHAR.                                         01040000
               10 FILLER                PIC X(01) VALUE '0'.            01050000
               10 PV-SCL-NBR-CHAR-X2    PIC X(02).                      01060000
           05  PV-SCL-CHAR-3            PIC X(03).                      01070000
           05  PV-GP-QTY-RTL.                                           01071000
               10  PV-GP-QTY            PIC ZZ9      VALUE ZERO.        01072000
               10  PV-GP-SLASH          PIC X        VALUE '/'.         01073000
               10  PV-GP-RTL-AMT        PIC ZZZZZ.99 VALUE ZERO.        01074000
           05  PV-PRC-CHG-DATE          PIC 9(08).                      01075000
           05  PV-STAT-CHG-DATE         PIC 9(08).                      01076000
           05  PV-NULL-IND              PIC S9(04)  COMP.               01077000
           05  PV-ONHAND-FMT            PIC ZZZZZZ9- VALUE ZERO.        01078000
           05  PV-STROH-FMT             PIC ZZZZZZ9- VALUE ZERO.        01079000
W30677     05  PV-INTQTY-FMT            PIC ZZZZZZ9- VALUE ZERO.        01079127
           05  PV-ONORDR-FMT            PIC ZZZZZZ9- VALUE ZERO.        01079210
W30677     05  PV-STREPT-FMT            PIC ZZZZZZ9- VALUE ZERO.        01079327
           05  PV-CURRTL-FMT            PIC ZZZZ9.99 VALUE ZERO.        01079510
           05  PV-CURRTL-FMT-MIXED      PIC X(08)                       01079610
                                                VALUE '   MIXED'.       01079710
           05  PV-ORGRTL-FMT            PIC ZZZZ9.99 VALUE ZERO.        01079810
           05  PV-CURCST-FMT            PIC ZZZ9.999 VALUE ZERO.        01079910
           05  PV-FIRCST-FMT            PIC ZZZ9.999 VALUE ZERO.        01080010
           05  PV-INPQTY-FMT            PIC ZZZZ9     VALUE ZERO.       01080110
           05  PV-OTPQTY-FMT            PIC ZZZZ9     VALUE ZERO.       01080210
           05  PV-RECLASS-DEPT          PIC 9(03)     VALUE ZERO.       01080337
           05  PV-RECLASS-SCL           PIC 9(02)     VALUE ZERO.       01080437
KP1005**** NOT NULL INDICATORS                                          01081003
KP1005     05  PV-UPCPLS-ORIG-CLR-DTE-NN                                01081101
KP1005                                  PIC S9(04)   COMP   VALUE +0.   01082001
KP1005     05  PV-UPCPLS-MKDN-CDE-NN    PIC S9(04)   COMP   VALUE +0.   01083003
      *                                                                 01090000
       01  PS-PROGRAM-SWITCHES.                                         01100000
           05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        01110000
               88  PS-ERROR                          VALUE  'Y'.        01120000
               88  PS-NO-ERROR                       VALUE  'N'.        01130000
                                                                        01140000
       01  PM-PROGRAM-MESSAGES.                                         01180000
           05  PM-ABEND-INFO-A.                                         01190000
               10  FILLER                PIC X(15)   VALUE              01200000
                                         'DP020-SRC-AID: '.             01210000
               10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01220000
               10  FILLER                PIC X(19)   VALUE              01230000
                                         '. DP020-FK-ACTION: '.         01240000
               10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01250000
               10  FILLER                PIC X(22)   VALUE              01260000
                                         '. DP020-FK-DISPN-IND: '.      01270000
               10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01280000
               10  FILLER                PIC X(01)   VALUE '.'.         01290000
               10  FILLER                PIC X(19)   VALUE SPACE.       01300000
                                                                        01310000
      ******************************************************************01320000
      *    MAP LAYOUT                                                  *01330000
      ******************************************************************01340000
           COPY MHKM803.                                                01350000
                                                                        01360000
      ******************************************************************01411001
      *    ATTRIBUTE SETTINGS COPYBOOK.                                *01412001
      ******************************************************************01413001
           COPY DPWS015.                                                01414001
                                                                        01415001
      ******************************************************************01420000
      *    FUNCTION KEYS COPYBOOK                                      *01430000
      ******************************************************************01440000
           COPY DPWS016.                                                01450000
                                                                        01460000
      ******************************************************************01470000
      ** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01480000
      ** SUB-ROUTINE (DPKUT100).                                      **01490000
      ******************************************************************01500000
           COPY DPWS010I.                                               01510000
                                                                        01520000
      ******************************************************************01530000
      ** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01540000
      ** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01550000
      ******************************************************************01560000
           COPY DPWS030.                                                01570041
CICS       COPY DPWS930.                                                01571041
                                                                        01580000
      ***************************************************************** 01590000
      *    STANDARD COMMAREA.                                           01600000
      ***************************************************************** 01610000
           COPY DPWS020.                                                01620000
                                                                        01630000
      ***************************************************************** 01640000
      *    INTER-APPLICATION COMMAREA.                                  01650000
      ***************************************************************** 01660000
           COPY MHWS000.                                                01670000
                                                                        01680000
      ***************************************************************** 01690000
      *    SPECIFIC COMMMAREA FOR MHKCS803.  LENGTH (1250)              01700000
      ***************************************************************** 01710000
               10  ASC-SPECIFIC-COMMAREA.                               01720000
                   15  ASC-DEPT-NUMBER-X           PIC  X(03).          01730000
                   15  ASC-DEPT-DESC               PIC  X(25).          01740000
                   15  ASC-MCL-NUMBER-X            PIC  X(02).          01750000
                   15  ASC-SCL-NUMBER-X            PIC  X(02).          01760000
                   15  ASC-SKU-NUMBER-X            PIC  X(08).          01770000
                   15  ASC-SKU-NUMBER REDEFINES                         01780000
                       ASC-SKU-NUMBER-X            PIC  9(08).          01790000
                   15  ASC-STORE-NUMBER-X          PIC  X(05).          01800000
                   15  ASC-STORE-NUMBER REDEFINES                       01810000
                       ASC-STORE-NUMBER-X          PIC  9(05).          01820000
                   15  ASC-STORE-DESC              PIC  X(10).          01830000
                   15  ASC-SKU-DESC                PIC  X(25).          01840000
                   15  ASC-SIZE-DESC               PIC  X(10).          01850000
                   15  ASC-SIZE-CDE                PIC  X(05).          01860000
                   15  ASC-RECLASS-DEPT            PIC  X(03).          01861037
                   15  ASC-RECLASS-SCL             PIC  X(02).          01862037
                   15  ASC-COLOR-DESC              PIC  X(10).          01870000
                   15  ASC-COLOR-CDE               PIC  X(03).          01880000
                   15  ASC-OH-QTY                  PIC  S9(8).          01890000
                   15  ASC-STORE-OH-QTY            PIC  S9(8).          01900000
                   15  ASC-OO-QTY                  PIC  S9(8).          01910000
W30677             15  ASC-STORE-EXPECTED-QTY      PIC  S9(8).          01911027
                   15  ASC-INTRAN-QTY              PIC  S9(8).          01920000
                   15  ASC-STATUS                  PIC  X(02).          01930000
                   15  ASC-STATUS-DESC             PIC  X(06).          01940000
W30677             15  ASC-BRAND-NAME              PIC  X(20).          01950027
                   15  ASC-VENDOR-NAME             PIC  X(30).          01951016
                   15  ASC-TICKET-COLOR            PIC  X(06).          01960000
                   15  ASC-VENDOR-STYLE            PIC  X(20).          01970000
                   15  ASC-STAT-CHGD-DTE           PIC  X(10).          01980000
                   15  ASC-VENDOR-NBR              PIC  X(09).          01990000
                   15  ASC-CURR-RTL                PIC  9(5)V9(02).     02000000
                   15  ASC-SET-UP-DTE              PIC  X(10).          02010000
                   15  ASC-GROUP-CDE               PIC  X(03).          02020000
                   15  ASC-GROUP-RTL               PIC  X(12).          02030000
                   15  ASC-PRC-CHGD-DTE            PIC  X(10).          02040000
                   15  ASC-STICKER-NBR             PIC  X(03).          02050000
                   15  ASC-ORIG-RTL                PIC  9(5)V9(02).     02060000
                   15  ASC-CURR-COST               PIC  9(4)V9(03).     02070000
                   15  ASC-FIRST-COST              PIC  9(4)V9(03).     02080000
                   15  ASC-FIRST-SALE-DTE          PIC  X(10).          02090000
                   15  ASC-FIRST-RCPT-DTE          PIC  X(10).          02100000
                   15  ASC-LAST-SALE-DTE           PIC  X(10).          02110000
                   15  ASC-LAST-RCPT-DTE           PIC  X(10).          02120000
                   15  ASC-INNER-PK-QTY            PIC  9(05).          02130000
                   15  ASC-OUTER-PK-QTY            PIC  9(05).          02140000
                   15  ASC-ITEM-NBR                PIC S9(15) COMP-3.   02150000
                   15  ASC-SKU-RCP-SW              PIC X(01).           02151000
                       88 ASC-SKU-RCP              VALUE 'Y'.           02152000
                       88 ASC-SKU-NON-RCP          VALUE 'N'.           02152100
                   15  ASC-SKU-STORE-SW            PIC X(01).           02152200
                       88 ASC-SKU-STORE-VALID      VALUE 'Y'.           02152300
                       88 ASC-SKU-STORE-INVALID    VALUE 'N'.           02152400
                   15  ASC-SIZE-DESC-SW            PIC X(01).           02152500
                       88 ASC-SIZE-DESC-VALID      VALUE 'Y'.           02152600
                       88 ASC-SIZE-DESC-INVALID    VALUE 'N'.           02152700
W30677             15  ASC-BRAND-NAME-SW           PIC X(01).           02152827
W30677                 88 ASC-BRAND-NAME-VALID     VALUE 'Y'.           02152927
W30677                 88 ASC-BRAND-NAME-INVALID   VALUE 'N'.           02153027
                   15  ASC-VENDOR-INFO-SW          PIC X(01).           02153113
                       88 ASC-VENDOR-INFO-VALID    VALUE 'Y'.           02153213
                       88 ASC-VENDOR-INFO-INVALID  VALUE 'N'.           02153313
                   15  ASC-ON-ORDER-SW             PIC X(01).           02153413
                       88 ASC-ON-ORDER-VALID       VALUE 'Y'.           02153513
                       88 ASC-ON-ORDER-INVALID     VALUE 'N'.           02153613
                   15  ASC-STORE-OH-SW             PIC X(01).           02154000
                       88 ASC-STORE-OH-VALID       VALUE 'Y'.           02155000
                       88 ASC-STORE-OH-INVALID     VALUE 'N'.           02156000
               10  ASC-MH001-AREA                  PIC  X(840).         02160000
W30677         10  FILLER                          PIC  X(023).         02170032
           EJECT                                                        02180000
      ******************************************************************02190000
      *    ABEND PROCESSING COPYBOOK.                                  *02200000
      ******************************************************************02210000
           COPY DPWS013.                                                02220000
                                                                        02230000
      ******************************************************************02231000
      *    TEMP STORAGE FOR MH LIST PROGRAMS.                          *02232000
      ******************************************************************02233000
           COPY MHWS001.                                                02234000
                                                                        02235000
      ******************************************************************02236000
      *    INTRANSIT COPYBOOK.                                         *02237000
      ******************************************************************02238000
           COPY XLWS074.                                                02239000
                                                                        02239100
      ******************************************************************02240000
      *    TSK IS THE DCLGEN MEMBER FOR THE SKU TABLE                  *02250000
      ******************************************************************02260000
           EXEC SQL                                                     02270000
               INCLUDE TSK                                              02280000
           END-EXEC.                                                    02290000
                                                                        02300000
      ******************************************************************02310000
      *    TSKXREF IS THE DCLGEN MEMBER FOR THE SKU CROSS-REFERENCE    *02320000
      *    TABLE                                                       *02330000
      ******************************************************************02340000
           EXEC SQL                                                     02350000
               INCLUDE TSKXREF                                          02360000
           END-EXEC.                                                    02370000
                                                                        02380000
      ******************************************************************02390000
      *    TSKST IS THE DCLGEN MEMBER FOR THE SKU/STORE ON-HAND        *02400000
      *    TABLE.                                                      *02410000
      ******************************************************************02420000
           EXEC SQL                                                     02430000
               INCLUDE TSKST                                            02440000
           END-EXEC.                                                    02450000
                                                                        02460000
      ******************************************************************02470000
      *    TSKSTOO IS THE DCLGEN MEMBER FOR THE SKU/STORE ON-ORDER     *02480000
      *    TABLE.                                                      *02490000
      ******************************************************************02500000
           EXEC SQL                                                     02510000
               INCLUDE TSKSTOO                                          02520000
           END-EXEC.                                                    02530000
                                                                        02540000
      ******************************************************************02550000
      *    TUPCPLS IS THE DCLGEN MEMBER FOR THE TUPCPLS TABLE          *02560000
      ******************************************************************02570000
           EXEC SQL                                                     02580000
               INCLUDE TUPCPLS                                          02590000
           END-EXEC.                                                    02600000
                                                                        02610000
      ******************************************************************02620000
      *    TSIZE IS THE DCLGEN MEMBER FOR THE TSIZE TABLE              *02630000
      ******************************************************************02640000
           EXEC SQL                                                     02650000
               INCLUDE TSIZE                                            02660000
           END-EXEC.                                                    02670000
                                                                        02680000
W30677******************************************************************02681027
W30677*    TUPC IS THE DCLGEN MEMBER FOR THE TUPC TABLE                *02682027
W30677******************************************************************02683027
W30677     EXEC SQL                                                     02684027
W30677         INCLUDE TUPC                                             02685027
W30677     END-EXEC.                                                    02686027
W30677                                                                  02687027
W30677******************************************************************02688027
W30677*    TMDARVS IS THE DCLGEN MEMBER FOR THE TMDARVS TABLE          *02689027
W30677******************************************************************02689127
W30677     EXEC SQL                                                     02689227
W30677         INCLUDE TMDARVS                                          02689327
W30677     END-EXEC.                                                    02689427
W30677                                                                  02689527
W30677******************************************************************02689627
W30677*    TVSCHVL IS THE DCLGEN MEMBER FOR THE TVSCHVL TABLE          *02689727
W30677******************************************************************02689827
W30677     EXEC SQL                                                     02689927
W30677         INCLUDE TVSCHVL                                          02690027
W30677     END-EXEC.                                                    02690127
W30677                                                                  02690227
      ******************************************************************02690330
      *    IMT00015 IS THE DCLGEN FOR THE IMT_RECLS TABLE              *02690430
      ******************************************************************02690530
           EXEC SQL                                                     02690630
               INCLUDE IMT00015                                         02690730
           END-EXEC.                                                    02690830
                                                                        02690930
      ******************************************************************02691012
      *    XMT00000 IS THE DCLGEN MEMBER FOR THE XMT_VND TABLE         *02700000
      ******************************************************************02710000
           EXEC SQL                                                     02720000
               INCLUDE XMT00000                                         02730000
           END-EXEC.                                                    02740000
                                                                        02750000
      ******************************************************************02760000
      *    THIS IS THE DCLGEN MEMBER FOR THE XMT_LOC TABLE             *02770000
      ******************************************************************02780000
           EXEC SQL                                                     02790000
               INCLUDE XMT00001                                         02800000
           END-EXEC.                                                    02810000
                                                                        02820000
      ******************************************************************02830000
      *    SQLCA IS THE DB2 COMMUNICATIONS AREA                        *02840000
      ******************************************************************02850000
           EXEC SQL                                                     02860000
               INCLUDE SQLCA                                            02870000
           END-EXEC.                                                    02880000
                                                                        02890000
       EJECT                                                            02900000
      ******************************************************************02910000
       LINKAGE SECTION.                                                 02920000
      ******************************************************************02930000
                                                                        02940000
       01  DFHCOMMAREA.                                                 02950000
           05  FILLER                         OCCURS  1 TO 4072 TIMES   02960000
                                              DEPENDING ON EIBCALEN.    02970000
               10  FILLER                     PIC X.                    02980000
                                                                        02990000
      ***************************************************************** 03000000
       PROCEDURE DIVISION.                                              03010000
      ***************************************************************** 03020000
      ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03030000
      ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03040000
      ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03050000
      **                                                             ** 03060000
      ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03070000
      ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03080000
      ***************************************************************** 03090000
       0000-MAIN-MODULE.                                                03100000
           INITIALIZE DP030-CICS-API-FIELDS.                            03110000
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03120000
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03130000
           MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03140000
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03150000
           MOVE LENGTH OF MH803AI        TO DP030-MAP-LENGTH (1).       03160000
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03170000
           PERFORM 0001-CALL-CICS-ARCH-API.                             03180000
      *                                                                 03190000
           PERFORM 1000-CONTROL-PROCESSING                              03200000
      *                                                                 03210000
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03220000
           PERFORM 0001-CALL-CICS-ARCH-API.                             03230000
                                                                        03240000
       0001-CALL-CICS-ARCH-API.                                         03250000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03260041
                                          DFHCOMMAREA                   03270041
                                          DP030-CICS-API-FIELDS         03280041
                                          DP020-STANDARD-COMMAREA       03290041
                                          MH803AI.                      03300041
      *                                                                 03310000
           IF  DP030-RC-CALL-SUCCESSFUL                                 03320000
               CONTINUE                                                 03330000
           ELSE                                                         03340000
               SET DP013-NO-ROLLBACK                                    03350000
                   DP013-XCTL-DISPLAY-RESTART                           03360000
                   DP013-CICS-ABEND      TO TRUE                        03370000
               MOVE 'BEFORE 0000-MAIN-MODULE'                           03380000
                                         TO DP013-PARAGRAPH             03390000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03391041
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03392041
               MOVE DP030-RETURN-CODE                                   03420000
                                         TO DP013-MESSAGE-TEXT (3)      03430000
               PERFORM DP013-0000-PROCESS-ABEND                         03440000
           END-IF.                                                      03450000
       EJECT                                                            03460000
      ***************************************************************** 03470000
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03480000
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03490000
      ***************************************************************** 03500000
       1000-CONTROL-PROCESSING.                                         03510000
                                                                        03520000
           SET PS-NO-ERROR                 TO TRUE.                     03530000
                                                                        03540000
      *-->     DEALING W/ A SELECTED ITEM FROM A LIST SCREEN.           03550000
           IF DP020-INT-APPL-FORMAT-IND = '1'                           03560000
      *-->     THE 9000- ROUTINE LOADS SKU AND STORE INFO               03570000
      *-->     FOUND ON THE TEMP STORAGE RECORD.                        03580000
               EVALUATE TRUE                                            03590000
                   WHEN DP020-NEXT-ACT-INITIAL                          03600000
                   WHEN DP020-NEXT-ACT-RETURN                           03610000
                       PERFORM 9000-READ-TS-QUEUE                       03620000
      *-->         FOR NEXT-ACT-READ-MAP'S, TEMP STORAGE NEED ONLY      03630000
      *-->         BE ACCESSED WHEN MH000-MH001-IDX EXCEEDS MAX-ITEMS.  03640000
      *-->         OTHERWISE,THE SKU/STORE KEY IS KEPT IN ASC-MH001-AREA03650000
                   WHEN (DP020-NEXT-ACT-READ-MAP AND                    03660000
                         DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID))         03670000
                       ADD +1 TO MH000-MH001-IDX                        03680000
                       IF MH000-MH001-IDX > MH001-MAX-ITEMS             03690000
                           ADD  +1 TO MH000-TS-ITEM-NUMBER              03700000
                           MOVE +1 TO MH000-MH001-IDX                   03710000
                           PERFORM 9000-READ-TS-QUEUE                   03720000
                       END-IF                                           03730000
               END-EVALUATE                                             03740000
                                                                        03750000
               MOVE ASC-MH001-AREA  TO MH001-TS-SEL-REC                 03760000
                                                                        03770000
               IF MH001-SKU-NMBR(MH000-MH001-IDX) =                     03780000
                   (SPACES OR LOW-VALUES)                               03790000
      *-->         NO MORE DATA                                         03800000
                   MOVE PC-TSYMSG-00113  TO  DP020-MSG-NUMBER           03810000
                   SET DP020-MSG-WARNING TO  TRUE                       03820000
                   SET PS-ERROR          TO  TRUE                       03830000
                   SET DP030-SET-CURSOR-TRAILER TO TRUE                 03840000
                   IF  SKUL > ZERO OR STOREL > ZERO                     03842000
                      PERFORM 3515-FORMAT-SKU-ERROR                     03843000
                      MOVE PC-TSYMSG-03328  TO  DP020-MSG-NUMBER        03843300
                   END-IF                                               03844000
               ELSE                                                     03850000
                   IF DP020-NEXT-ACT-INITIAL                            03860000
                     OR (DP020-NEXT-ACT-READ-MAP AND                    03870000
                         DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID))         03880000
                     OR DP020-NEXT-ACT-RETURN                           03890000
      *-->     DEALING W/ A SELECTED ITEM FROM A LIST SCREEN THE FIRST  03900000
      *-->     TIME INTO THIS PROGRAM, OR WHEN SELECTING THE NEXT SKU,  03910000
      *-->     OR WHEN RETURNING FROM ANOTHER PROGRAM                   03920000
                       MOVE MH001-SKU-NMBR (MH000-MH001-IDX)            03930000
                                           TO MH000-SKU-NUMBER-X        03940000
                       MOVE MH001-STORE-NMBR (MH000-MH001-IDX)          03950000
                                           TO MH000-STORE-NUMBER-X      03960000
                   END-IF                                               03970000
      *-->         SIGNIFY THAT THIS SELECTED ITEM HAS BEEN VIEWED .    03980000
                   MOVE PC-INQ TO MH001-ACTION-SW (MH000-MH001-IDX)     03990000
                   PERFORM 9100-REWRITE-TS-QUEUE                        04000000
      *-->         ... AND UPDATE COMMAREA WITH THE CHANGE              04010000
                   MOVE MH001-TS-SEL-REC TO ASC-MH001-AREA              04020000
               END-IF                                                   04030000
           END-IF.                                                      04040000
                                                                        04050000
           IF PS-NO-ERROR                                               04060000
               EVALUATE TRUE                                            04070000
                   WHEN DP020-NEXT-ACT-INITIAL                          04080000
                       INITIALIZE ASC-SPECIFIC-COMMAREA                 04090000
                       SET ASC-SKU-NON-RCP         TO TRUE              04093000
                       SET ASC-SKU-STORE-INVALID   TO TRUE              04094000
                       SET ASC-SIZE-DESC-INVALID   TO TRUE              04096000
W30677                 SET ASC-BRAND-NAME-INVALID  TO TRUE              04099027
                       SET ASC-VENDOR-INFO-INVALID TO TRUE              04099116
                       SET ASC-ON-ORDER-INVALID    TO TRUE              04099300
                       SET ASC-STORE-OH-INVALID    TO TRUE              04099600
                       PERFORM 3200-RESET-ATTRIBUTES                    04100000
                       PERFORM 4000-BUILD-INITIAL-PANEL                 04110000
                       PERFORM 3000-EDIT-DATA-IN-COMMAREA               04120000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04130000
                                                                        04140000
                   WHEN DP020-NEXT-ACT-READ-MAP                         04150000
                       PERFORM 2000-FKEY-PROCESSING                     04160000
                                                                        04170000
                   WHEN DP020-NEXT-ACT-RETURN                           04180000
                       PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             04181000
                       PERFORM 3200-RESET-ATTRIBUTES                    04190000
                       SET ASC-SKU-NON-RCP         TO TRUE              04191000
                       SET ASC-SKU-STORE-INVALID   TO TRUE              04192000
                       SET ASC-SIZE-DESC-INVALID   TO TRUE              04193000
W30677                 SET ASC-BRAND-NAME-INVALID  TO TRUE              04194027
                       SET ASC-VENDOR-INFO-INVALID TO TRUE              04194116
                       SET ASC-ON-ORDER-INVALID    TO TRUE              04195000
                       SET ASC-STORE-OH-INVALID    TO TRUE              04196000
                       PERFORM 3000-EDIT-DATA-IN-COMMAREA               04200000
                       PERFORM 2110-PREPARE-INTER-APPL-COMM             04201000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04210000
                                                                        04220000
                   WHEN OTHER                                           04230000
                      SET DP013-LOGIC-ABEND                             04240000
                          DP013-NO-ROLLBACK TO TRUE                     04250000
                      MOVE '1000-CONTROL-PROCESSING'                    04260000
                                            TO  DP013-PARAGRAPH         04270000
                      MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'04280000
                                            TO  DP013-MESSAGE-TEXT(1)   04290000
                      MOVE DP020-NEXT-APPL-ACTIVITY                     04300000
                                            TO DP013-MESSAGE-TEXT(2)    04310000
                      PERFORM DP013-0000-PROCESS-ABEND                  04320000
               END-EVALUATE                                             04330000
           END-IF.                                                      04331000
                                                                        04340000
      ***************************************************************** 04350000
      * FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*04360000
      * SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*04370000
      * EDITS.                                                         *04380000
      ***************************************************************** 04390000
       2000-FKEY-PROCESSING.                                            04400000
                                                                        04410000
           EVALUATE TRUE                                                04420000
                                                                        04430000
               WHEN DP020-SRC-AID = DP016-CLEAR                         04440000
                   PERFORM 3200-RESET-ATTRIBUTES                        04450000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04460000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04470000
                                                                        04480000
      * USER SELECTED FKEY FOR NEXT SKU -                               04490000
      * THIS IS THE NEXT SKU IN THE LIST (LOCAL PF)                     04500000
               WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               04510000
      *-->  'NEXT SKU' PF KEY IS ONLY VALID WHEN COMING FROM            04520000
      *-->  A SELECTED LIST.                                            04521000
                   IF DP020-INT-APPL-FORMAT-IND = '1'                   04529500
                      INITIALIZE ASC-SPECIFIC-COMMAREA                  04530000
                      SET ASC-SKU-NON-RCP         TO TRUE               04531000
                      SET ASC-SKU-STORE-INVALID   TO TRUE               04531100
                      SET ASC-SIZE-DESC-INVALID   TO TRUE               04532000
W30677                SET ASC-BRAND-NAME-INVALID  TO TRUE               04533027
                      SET ASC-VENDOR-INFO-INVALID TO TRUE               04533116
                      SET ASC-ON-ORDER-INVALID    TO TRUE               04534000
                      SET ASC-STORE-OH-INVALID    TO TRUE               04535000
                      PERFORM 3200-RESET-ATTRIBUTES                     04540000
                      PERFORM 4000-BUILD-INITIAL-PANEL                  04550000
                      PERFORM 3000-EDIT-DATA-IN-COMMAREA                04560000
                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              04570000
                   ELSE                                                 04571000
                      SET PS-ERROR          TO  TRUE                    04571100
                      MOVE PC-TSYMSG-00438  TO  DP020-MSG-NUMBER        04572000
                      SET DP020-MSG-WARNING TO  TRUE                    04573000
                      SET DP030-SET-CURSOR-TRAILER TO TRUE              04575000
                   END-IF                                               04576000
                                                                        04580000
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04581000
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     04582000
                   SET ASC-SKU-NON-RCP         TO TRUE                  04583000
                   SET ASC-SKU-STORE-INVALID   TO TRUE                  04583100
                   SET ASC-SIZE-DESC-INVALID   TO TRUE                  04584000
W30677             SET ASC-BRAND-NAME-INVALID  TO TRUE                  04585027
                   SET ASC-VENDOR-INFO-INVALID TO TRUE                  04585116
                   SET ASC-ON-ORDER-INVALID    TO TRUE                  04586000
                   SET ASC-STORE-OH-INVALID    TO TRUE                  04587000
                   PERFORM 3200-RESET-ATTRIBUTES                        04588000
                   PERFORM 4000-BUILD-INITIAL-PANEL                     04589000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04589100
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04589300
                                                                        04589400
               WHEN OTHER                                               04590000
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04600000
                   PERFORM 3200-RESET-ATTRIBUTES                        04610000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04620000
                   PERFORM 2110-PREPARE-INTER-APPL-COMM                 04621000
                   IF  PS-NO-ERROR                                      04630000
                       SET DP030-CONTINUE-GO TO TRUE                    04640000
                       PERFORM 2100-CHECK-FUNCTION-KEY                  04650000
                   ELSE                                                 04660000
                       SET DP030-OVERRIDE-GO TO TRUE                    04670000
                   END-IF                                               04680000
           END-EVALUATE.                                                04690000
                                                                        04700000
      ******************************************************************04710000
      ** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **04720000
      ** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **04730000
      ** FROM THE CICS ARCHITECTURE API.                              **04740000
      ******************************************************************04750000
       2100-CHECK-FUNCTION-KEY.                                         04760000
                                                                        04770000
           EVALUATE TRUE                                                04780000
                                                                        04810000
               WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               04811000
                   PERFORM 2110-PREPARE-INTER-APPL-COMM                 04811100
                                                                        04812000
               WHEN DP020-SRC-AID = DP016-ENTER                         04820000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04830000
                                                                        04840000
               WHEN OTHER                                               04850000
                   SET DP013-NO-ROLLBACK                                04860000
                       DP013-XCTL-DISPLAY-RESTART                       04870000
                       DP013-CICS-ABEND  TO TRUE                        04880000
                   MOVE '2100-CHECK-FUNCTION-KEY'                       04890000
                                         TO DP013-PARAGRAPH             04900000
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04910000
                                         TO DP013-MESSAGE-TEXT (1)      04920000
                   MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 04930000
                                         TO DP013-MESSAGE-TEXT (2)      04940000
                   MOVE DP020-SRC-AID    TO PM-A-SRC-AID                04950000
                   MOVE DP020-FK-ACTION (DP020-SRC-AID)                 04960000
                                         TO PM-A-FK-ACTION              04970000
                   MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              04980000
                                         TO PM-A-FK-DISPN               04990000
                   MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      05000000
                   MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        05010000
                                         TO DP013-MESSAGE-TEXT (4)      05020000
                   PERFORM DP013-0000-PROCESS-ABEND                     05030000
           END-EVALUATE.                                                05040000
                                                                        05050000
      ******************************************************************05060000
      ** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **05070000
      ** INTER-APPLICATION COMMAREA - MHWS000                         **05080000
      ******************************************************************05090000
       2110-PREPARE-INTER-APPL-COMM.                                    05100000
                                                                        05110000
           INITIALIZE MH000-INTER-APPL-COMMAREA.                        05120000
                                                                        05130000
           MOVE ASC-DEPT-NUMBER-X        TO MH000-DEPT-NUMBER-X.        05140000
           MOVE ASC-DEPT-DESC            TO MH000-DEPT-NAME.            05150000
           MOVE ASC-MCL-NUMBER-X         TO MH000-MCL-NUMBER-X.         05160000
           MOVE ASC-SCL-NUMBER-X         TO MH000-SCL-NUMBER-X.         05170000
           MOVE ASC-SKU-NUMBER-X         TO MH000-SKU-NUMBER-X.         05180000
           MOVE ASC-SKU-DESC             TO MH000-SKU-DESCRIPTION.      05190000
           MOVE ASC-STORE-NUMBER-X       TO MH000-STORE-NUMBER-X.       05200000
           MOVE ASC-STORE-DESC           TO MH000-STORE-SHORT-NAME.     05210000
           MOVE ASC-ITEM-NBR             TO MH000-ITEM-NUMBER.          05220000
                                                                        05230000
       EJECT                                                            05240000
      ******************************************************************05250000
      * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*05260000
      * THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *05270000
      * APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *05280000
      ******************************************************************05290000
       2200-MOVE-SCREEN-TO-COMMAREA.                                    05300000
                                                                        05310000
           IF  SKUL > ZERO                                              05320000
               MOVE SKUI                 TO ASC-SKU-NUMBER-X            05330000
           ELSE                                                         05340000
               IF  SKUF = DP015-ERASE-EOF                               05350000
                   MOVE SPACE            TO ASC-SKU-NUMBER-X            05360000
                                            ASC-SKU-DESC                05370000
               END-IF                                                   05380000
           END-IF.                                                      05390000
                                                                        05400000
           IF  STOREL > ZERO                                            05410000
               MOVE STOREI               TO ASC-STORE-NUMBER-X          05420000
           ELSE                                                         05430000
               IF  STOREF = DP015-ERASE-EOF                             05440000
                   MOVE SPACE            TO ASC-STORE-NUMBER-X          05450000
                                            ASC-STORE-DESC              05460000
               END-IF                                                   05470000
           END-IF.                                                      05480000
                                                                        05490000
      ******************************************************************05500000
      * EDIT THE DETAIL SCREEN.                                        *05510000
      ******************************************************************05520000
       3000-EDIT-DATA-IN-COMMAREA.                                      05530000
                                                                        05540031
      *- MUST ENTER SKU NUMBER.                                         05550000
           IF ASC-SKU-NUMBER-X > SPACES                                 05560000
              CONTINUE                                                  05570000
           ELSE                                                         05580000
              PERFORM 3515-FORMAT-SKU-ERROR                             05581000
              SET PS-ERROR                                              05590000
                  DP020-MSG-FATAL   TO TRUE                             05600000
              MOVE PC-TSYMSG-02616  TO DP020-MSG-NUMBER                 05610000
              MOVE DP015-UNP-ALP-BRT-OFF                                05620000
                                    TO SKUA                             05630000
              MOVE DP015-RED        TO SKUC                             05640000
              MOVE DP015-REVERSE    TO SKUH                             05650000
              MOVE -1               TO SKUL                             05660000
              SET DP030-SET-CURSOR-APPL-1 TO TRUE                       05670000
           END-IF.                                                      05680000
                                                                        05690000
      *- NUMERIC EDIT CHECK ALL CRITERIA FIELDS.                        05700000
           IF PS-ERROR                                                  05710000
              CONTINUE                                                  05720000
           ELSE                                                         05730000
              PERFORM 3300-VALIDATE-NUMERIC                             05740000
           END-IF.                                                      05750000
                                                                        05760000
      *- VALIDATE SKU NUMBER                                            05770000
           IF PS-ERROR                                                  05780000
              CONTINUE                                                  05790000
           ELSE                                                         05800000
              IF ASC-SKU-NUMBER-X > SPACES                              05810000
                 PERFORM 3500-VALIDATE-SKU-NBR                          05820000
                 IF SQLCODE = ZERO                                      05830000
                    PERFORM 3510-FORMAT-SKU-DETAIL                      05840000
                 ELSE                                                   05850000
                    PERFORM 3515-FORMAT-SKU-ERROR                       05860000
                    SET PS-ERROR                                        05870000
                        DP020-MSG-FATAL   TO TRUE                       05880000
                    MOVE PC-TSYMSG-00419  TO DP020-MSG-NUMBER           05890000
                    MOVE DP015-UNP-ALP-BRT-OFF                          05900000
                                          TO SKUA                       05910000
                    MOVE DP015-RED        TO SKUC                       05920000
                    MOVE DP015-REVERSE    TO SKUH                       05930000
                    MOVE -1               TO SKUL                       05940000
                    SET DP030-SET-CURSOR-APPL-1 TO TRUE                 05950000
                 END-IF                                                 05960000
           END-IF.                                                      05970000
                                                                        05980000
      *- VALIDATE LOCATION NUMBER                                       05990000
      *- PLEASE NOTE:  WHEN LOCATION NUMBER IS SPACES, THE DEFAULT      06000000
      *-   LOCATION NUMBER WILL BE THE CORPORATE LOCATION - STORE 0.    06010000
           IF PS-ERROR                                                  06020000
              CONTINUE                                                  06030000
           ELSE                                                         06040000
              IF ASC-STORE-NUMBER-X > SPACES                            06050000
                AND ASC-STORE-NUMBER > ZERO                             06060000
                 PERFORM 3700-VALIDATE-STORE-NBR                        06070000
                 IF SQLCODE = ZERO                                      06080000
                    MOVE XMT00001-LOC-10-ABBR-NM TO ASC-STORE-DESC      06090000
                 ELSE                                                   06100000
                    MOVE SPACES TO ASC-STORE-DESC                       06110000
                    SET PS-ERROR                                        06120000
                        DP020-MSG-FATAL   TO TRUE                       06130000
                    MOVE PC-TSYMSG-02294  TO DP020-MSG-NUMBER           06140000
                    MOVE DP015-UNP-ALP-BRT-OFF                          06150000
                                          TO STOREA                     06160000
                    MOVE DP015-RED        TO STOREC                     06170000
                    MOVE DP015-REVERSE    TO STOREH                     06180000
                    MOVE -1               TO STOREL                     06190000
                    SET DP030-SET-CURSOR-APPL-1 TO TRUE                 06200000
              ELSE                                                      06210000
                 MOVE PC-CORP-LOCATION TO ASC-STORE-NUMBER-X            06220000
                 MOVE PC-CORP-DESC     TO ASC-STORE-DESC                06230000
           END-IF.                                                      06240000
                                                                        06250000
      *- VALIDATE THAT THE SKU TO STORE                                 06260000
      *- COMBINATION EXISTS.  (I.E. A ROW EXISTS ON SKU/STORE TABLE)    06270000
      *- IF TABLE IS UNAVAILABLE - SET SWITCH IN COMMAREA.  THE         06271000
      *- FIELDS RETRIEVED WILL BE SET TO ALL STARS.                     06272000
           IF PS-ERROR                                                  06280000
              CONTINUE                                                  06290000
           ELSE                                                         06300000
              IF ASC-SKU-NUMBER-X  > SPACES                             06310000
                 PERFORM 3800-VALIDATE-SKU-STORE                        06320000
                 EVALUATE SQLCODE                                       06321000
                    WHEN ZERO                                           06330000
                       SET ASC-SKU-STORE-VALID TO TRUE                  06331000
                       PERFORM 3810-FORMAT-TSKST-DATES                  06340000
                       MOVE TSKST-ONHAND-QTY TO ASC-OH-QTY              06350000
                    WHEN +100                                           06351000
                       SET ASC-SKU-STORE-VALID TO TRUE                  06352000
                       SET PS-ERROR                                     06370000
                           DP020-MSG-FATAL   TO TRUE                    06380000
                       MOVE PC-TSYMSG-00332  TO DP020-MSG-NUMBER        06390000
                       MOVE DP015-UNP-ALP-BRT-OFF                       06400000
                                             TO SKUA                    06410000
                                                STOREA                  06420000
                       MOVE DP015-RED        TO SKUC                    06430000
                                                STOREC                  06440000
                       MOVE DP015-REVERSE    TO SKUH                    06450000
                                                STOREH                  06460000
                       MOVE -1               TO SKUL                    06470000
                       SET DP030-SET-CURSOR-APPL-1 TO TRUE              06480000
                    WHEN OTHER                                          06481000
                       SET ASC-SKU-STORE-INVALID TO TRUE                06482000
              END-IF                                                    06490000
           END-IF.                                                      06500000
                                                                        06510000
           IF PS-ERROR                                                  06520000
              CONTINUE                                                  06530000
           ELSE                                                         06540000
              PERFORM 3900-GET-SKU-DETAIL                               06550000
           END-IF.                                                      06560000
                                                                        06570000
      **  MUST HAVE AN RCP SKU AND STORE ZERO TO NAVIGATE TO            06580000
      **  REGIONAL CLEARANCE PRICE SCREEN.                              06590000
           IF PS-ERROR                                                  06600000
              CONTINUE                                                  06610000
           ELSE                                                         06620000
              IF DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)                  06630000
                  IF ASC-SKU-RCP                                        06640000
                     IF ASC-STORE-NUMBER-X = PC-CORP-LOCATION           06650000
                        CONTINUE                                        06660000
                     ELSE                                               06670000
                        SET PS-ERROR                                    06680000
                            DP020-MSG-FATAL   TO TRUE                   06690000
                        MOVE PC-TSYMSG-02136  TO DP020-MSG-NUMBER       06700000
                        MOVE DP015-UNP-ALP-BRT-OFF                      06710000
                                              TO STOREA                 06720000
                        MOVE DP015-RED        TO STOREC                 06730000
                        MOVE DP015-REVERSE    TO STOREH                 06740000
                        MOVE -1               TO STOREL                 06750000
                        SET DP030-SET-CURSOR-APPL-1 TO TRUE             06760000
                     END-IF                                             06770000
                  ELSE                                                  06780000
                     SET PS-ERROR                                       06790000
                         DP020-MSG-FATAL   TO TRUE                      06800000
                     MOVE PC-TSYMSG-02134  TO DP020-MSG-NUMBER          06810000
                     MOVE DP015-UNP-ALP-BRT-OFF                         06820000
                                           TO SKUA                      06830000
                     MOVE DP015-RED        TO SKUC                      06840000
                     MOVE DP015-REVERSE    TO SKUH                      06850000
                     MOVE -1               TO SKUL                      06860000
                     SET DP030-SET-CURSOR-APPL-1 TO TRUE                06870000
                  END-IF                                                06880000
              END-IF                                                    06890000
           END-IF.                                                      06900000
                                                                        06910000
           IF  PS-NO-ERROR                                              06920000
               MOVE -1                   TO SKUL                        06930000
               SET DP030-SET-CURSOR-APPL-1                              06940000
                                         TO TRUE                        06950000
           END-IF.                                                      06960000
                                                                        06970000
      ******************************************************************06980000
      ** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **06990000
      ** MAP.                                                         **07000000
      ******************************************************************07010000
       3200-RESET-ATTRIBUTES.                                           07020000
                                                                        07030031
      ** ENTERABLE FIELDS (SKU AND STORE NUMBER).                       07040000
           MOVE DP015-UNP-ALP-NOR-OFF    TO SKUA                        07050000
                                            STOREA.                     07060000
           MOVE DP015-GREEN              TO SKUC                        07070000
                                            STOREC.                     07080000
           MOVE DP015-UNDERLINE          TO SKUH                        07090000
                                            STOREH.                     07100000
                                                                        07110000
      ** NON-ENTERABLE FIELDS.                                          07120000
           MOVE DP015-HL-OFF               TO DEPTH                     07130000
                                              MCLH                      07140000
                                              SCLH                      07150000
                                              STDESCH                   07160000
                                              SKUDSCH                   07170000
                                              SIZEH                     07180000
                                              SIZECDH                   07190000
                                              RCLDPLH                   07191036
                                              RCLSCLH                   07192035
                                              COLORH                    07200000
                                              COLRCDH                   07210000
                                              ONHANDH                   07220000
                                              STROHH                    07230000
W30677                                        INTQTYH                   07231027
                                              ONORDRH                   07240000
W30677                                        STREPTH                   07241027
                                              STATUSH                   07260000
                                              STADSCH                   07270000
W30677                                        BNDNMEH                   07280027
                                              VNDNMEH                   07281012
                                              TKTCLRH                   07290000
                                              VNDSTYH                   07300000
                                              STCHDTH                   07310000
                                              VNDNBRH                   07320000
                                              CURRTLH                   07330000
                                              SETDTEH                   07340000
                                              GRPCDEH                   07350000
                                              GRPRTLH                   07360000
                                              PRCDTEH                   07370000
                                              STKNBRH                   07380000
                                              ORGRTLH                   07390000
                                              CURCSTH                   07400000
                                              FIRCSTH                   07410000
                                              FIRSALH                   07420000
                                              FIRRCTH                   07430000
                                              LSTSALH                   07440000
                                              LSTRCTH                   07450000
                                              INPQTYH                   07460000
                                              OTPQTYH.                  07470000
           MOVE DP015-BLUE                 TO DEPTC                     07480000
                                              MCLC                      07490000
                                              SCLC                      07500000
                                              STDESCC                   07510000
                                              SKUDSCC                   07520000
                                              SIZEC                     07530000
                                              SIZECDC                   07540000
                                              RCLDPLC                   07541036
                                              RCLSCLC                   07542035
                                              COLORC                    07550000
                                              COLRCDC                   07560000
                                              ONHANDC                   07570000
                                              STROHC                    07580000
W30677                                        INTQTYC                   07581027
                                              ONORDRC                   07590000
W30677                                        STREPTC                   07591027
                                              STATUSC                   07610000
                                              STADSCC                   07620000
W30677                                        BNDNMEC                   07630027
                                              VNDNMEC                   07631012
                                              TKTCLRC                   07640000
                                              VNDSTYC                   07650000
                                              STCHDTC                   07660000
                                              VNDNBRC                   07670000
                                              CURRTLC                   07680000
                                              SETDTEC                   07690000
                                              GRPCDEC                   07700000
                                              GRPRTLC                   07710000
                                              PRCDTEC                   07720000
                                              STKNBRC                   07730000
                                              ORGRTLC                   07740000
                                              CURCSTC                   07750000
                                              FIRCSTC                   07760000
                                              FIRSALC                   07770000
                                              FIRRCTC                   07780000
                                              LSTSALC                   07790000
                                              LSTRCTC                   07800000
                                              INPQTYC                   07810000
                                              OTPQTYC.                  07820000
           MOVE DP015-ASK-NOR-OFF          TO DEPTA                     07830000
                                              MCLA                      07840000
                                              SCLA                      07850000
                                              STDESCA                   07860000
                                              SKUDSCA                   07870000
                                              SIZEA                     07880000
                                              SIZECDA                   07890000
                                              RCLDPLA                   07891036
                                              RCLSCLA                   07892035
                                              COLORA                    07900000
                                              COLRCDA                   07910000
                                              ONHANDA                   07920000
                                              STROHA                    07930000
W30677                                        INTQTYA                   07931027
                                              ONORDRA                   07940000
W30677                                        STREPTA                   07941027
                                              STATUSA                   07960000
                                              STADSCA                   07970000
W30677                                        BNDNMEA                   07980027
                                              VNDNMEA                   07981012
                                              TKTCLRA                   07990000
                                              VNDSTYA                   08000000
                                              STCHDTA                   08010000
                                              VNDNBRA                   08020000
                                              CURRTLA                   08030000
                                              SETDTEA                   08040000
                                              GRPCDEA                   08050000
                                              GRPRTLA                   08060000
                                              PRCDTEA                   08070000
                                              STKNBRA                   08080000
                                              ORGRTLA                   08090000
                                              CURCSTA                   08100000
                                              FIRCSTA                   08110000
                                              FIRSALA                   08120000
                                              FIRRCTA                   08130000
                                              LSTSALA                   08140000
                                              LSTRCTA                   08150000
                                              INPQTYA                   08160000
                                              OTPQTYA.                  08170000
                                                                        08180000
      ******************************************************************08190000
      ** VALIDATE IF THE ENTERED FIELDS ARE NUMERIC.                  **08200000
      ******************************************************************08210000
       3300-VALIDATE-NUMERIC.                                           08220000
                                                                        08230000
           IF  ASC-SKU-NUMBER-X > SPACE                                 08240000
               MOVE ASC-SKU-NUMBER-X        TO DP010I-UNEDITED-FIELD    08250000
               MOVE LENGTH OF ASC-SKU-NUMBER-X TO DP010I-MAXIMUM-DIGITS 08260000
               MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS  08270000
               SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08280000
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08291040
262978              USING DP010I-NUMERIC-EDIT-AREA                      08292040
               IF  DP010I-ERROR-DETECTED                                08300000
                   SET PS-ERROR                                         08310000
                       DP020-MSG-FATAL   TO TRUE                        08320000
                   MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08330000
                   MOVE DP015-UNP-ALP-BRT-OFF                           08340000
                                         TO SKUA                        08350000
                   MOVE DP015-RED        TO SKUC                        08360000
                   MOVE DP015-REVERSE    TO SKUH                        08370000
                   MOVE -1               TO SKUL                        08380000
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08390000
                   MOVE SPACES           TO ASC-SKU-DESC                08400000
                                            SKUDSCO                     08410000
               ELSE                                                     08420000
                   MOVE DP010I-NUMERIC-FIELD TO ASC-SKU-NUMBER          08430000
               END-IF                                                   08440000
           END-IF.                                                      08450000
                                                                        08460000
           IF  ASC-STORE-NUMBER-X > SPACE                               08470000
               MOVE ASC-STORE-NUMBER-X      TO DP010I-UNEDITED-FIELD    08480000
               MOVE LENGTH OF ASC-STORE-NUMBER-X                        08490000
                                               TO DP010I-MAXIMUM-DIGITS 08500000
               MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS  08510000
               SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08520000
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08531040
262978              USING DP010I-NUMERIC-EDIT-AREA                      08532040
               IF  DP010I-ERROR-DETECTED                                08540000
                   SET PS-ERROR                                         08550000
                       DP020-MSG-FATAL   TO TRUE                        08560000
                   MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08570000
                   MOVE DP015-UNP-ALP-BRT-OFF                           08580000
                                         TO STOREA                      08590000
                   MOVE DP015-RED        TO STOREC                      08600000
                   MOVE DP015-REVERSE    TO STOREH                      08610000
                   MOVE -1               TO STOREL                      08620000
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08630000
                   MOVE SPACES           TO ASC-STORE-DESC              08640000
                                            STDESCO                     08650000
               ELSE                                                     08660000
                   MOVE DP010I-NUMERIC-FIELD TO ASC-STORE-NUMBER        08670000
               END-IF                                                   08680000
           END-IF.                                                      08690000
                                                                        08700000
      ******************************************************************08710000
      ** VALIDATE SKU NUMBER.                                         **08720000
      ******************************************************************08730000
       3500-VALIDATE-SKU-NBR.                                           08740000
                                                                        08750031
           MOVE ASC-SKU-NUMBER TO PV-SKU-NBR.                           08760000
                                                                        08770000
           PERFORM                                                      08780000
               WITH TEST AFTER                                          08790000
               VARYING PV-RETRY-COUNTER                                 08800000
               FROM 1 BY 1                                              08810000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08820000
                         OR (SQLCODE = ZERO)                            08830000
                         OR (SQLCODE = +100))                           08840000
               EXEC SQL                                                 08850000
                 SELECT X.DEPT                                          08860000
                       ,X.CLASS                                         08870000
                       ,X.SUBCLASS                                      08880000
                       ,X.SKU_STAT_CDE                                  08881000
                       ,X.ITM_NBR                                       08890000
                   INTO :SKXREF-DEPT                                    08900000
                       ,:SKXREF-CLASS                                   08910000
                       ,:SKXREF-SUBCLASS                                08920000
                       ,:SKXREF-SKU-STAT-CDE                            08921000
                       ,:SKXREF-ITM-NBR                                 08930000
                   FROM TSKXREF X                                       08940000
                  WHERE X.SKU = :PV-SKU-NBR                             08950000
                    AND X.SKU_STAT_CDE ^= '00'                          08960000
               END-EXEC                                                 08970000
                                                                        08980000
               EVALUATE TRUE                                            08990000
                   WHEN SQLCODE = ZERO                                  09000000
                   WHEN SQLCODE = +100                                  09010000
                   WHEN SQLCODE = -904                                  09020000
                   WHEN SQLCODE = -913                                  09030000
                       CONTINUE                                         09040000
                   WHEN SQLWARN0 NOT = SPACES                           09050000
                   WHEN SQLCODE < ZERO                                  09060000
                   WHEN SQLCODE > ZERO                                  09070000
                       MOVE '3500-VALIDATE-SKU-NBR'                     09080000
                                         TO DP013-PARAGRAPH             09090000
                       MOVE 'VALIDATE SKU NUMBER'                       09100000
                                         TO DP013-MESSAGE-TEXT (1)      09110000
                       MOVE SQLCA        TO DP013-SQLCA                 09120000
                       MOVE 'TSKXREF'    TO DP013-DB2-TABLE-NAME (1)    09130000
                       SET DP013-DB2-ABEND                              09140000
                           DP013-XCTL-DISPLAY-RESTART                   09150000
                                         TO TRUE                        09160000
                       PERFORM DP013-0000-PROCESS-ABEND                 09170000
               END-EVALUATE                                             09180000
           END-PERFORM.                                                 09190000
                                                                        09200000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09210000
               MOVE '3500-VALIDATE-SKU-NBR'                             09220000
                                         TO DP013-PARAGRAPH             09230000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     09240000
                                         TO DP013-MESSAGE-TEXT (1)      09250000
               MOVE 'VALIDATE SKU NUMBER'                               09260000
                                         TO DP013-MESSAGE-TEXT (2)      09270000
               MOVE SQLCA                TO DP013-SQLCA                 09280000
               MOVE 'TSKXREF'            TO DP013-DB2-TABLE-NAME (1)    09290000
               SET DP013-DB2-ABEND                                      09300000
                   DP013-XCTL-DISPLAY-RESTART                           09310000
                                         TO TRUE                        09320000
               PERFORM DP013-0000-PROCESS-ABEND                         09330000
           END-IF.                                                      09340000
                                                                        09350000
      ******************************************************************09360000
      ** VALID SKU - FORMAT DETAIL DATA FOR COMMAREA AND SCREEN.      **09370000
      ******************************************************************09380000
       3510-FORMAT-SKU-DETAIL.                                          09390000
                                                                        09400000
           MOVE SKXREF-DEPT      TO PV-DEPT-NBR.                        09410000
           MOVE PV-DEPT-NBR      TO PV-DEPT-NBR-CHAR-3.                 09420000
           MOVE PV-DEPT-NBR-3    TO ASC-DEPT-NUMBER-X.                  09430000
                                                                        09440000
           MOVE SKXREF-CLASS     TO PV-MCL-NBR.                         09450000
           MOVE PV-MCL-NBR       TO PV-MCL-NBR-CHAR-2.                  09460000
           MOVE PV-MCL-NBR-2     TO ASC-MCL-NUMBER-X.                   09470000
                                                                        09480000
           MOVE SKXREF-SUBCLASS  TO PV-SCL-NBR.                         09490000
           MOVE PV-SCL-NBR       TO PV-SCL-NBR-CHAR-2.                  09500000
           MOVE PV-SCL-NBR-2     TO ASC-SCL-NUMBER-X.                   09510000
                                                                        09520000
           MOVE SKXREF-SKU-STAT-CDE TO ASC-STATUS.                      09530000
                                                                        09530100
           MOVE SKXREF-ITM-NBR   TO ASC-ITEM-NBR.                       09531000
                                                                        09540000
      ******************************************************************09550000
      ** INVALID SKU - MOVE SPACES TO COMMAREA AND SCREEN.            **09560000
      ******************************************************************09570000
       3515-FORMAT-SKU-ERROR.                                           09580000
                                                                        09590000
           INITIALIZE ASC-SPECIFIC-COMMAREA.                            09600000
           SET ASC-SKU-STORE-INVALID   TO TRUE.                         09601000
           SET ASC-SIZE-DESC-INVALID   TO TRUE.                         09602000
W30677     SET ASC-BRAND-NAME-INVALID  TO TRUE.                         09603027
           SET ASC-VENDOR-INFO-INVALID TO TRUE.                         09603116
           SET ASC-ON-ORDER-INVALID    TO TRUE.                         09604000
           SET ASC-STORE-OH-INVALID    TO TRUE.                         09605000
                                                                        09610000
           MOVE SPACES           TO DEPTO                               09620000
                                    MCLO                                09630000
                                    SCLO                                09640000
                                    STOREO                              09650000
                                    STDESCO                             09660000
                                    SKUDSCO                             09670000
                                    SIZEO                               09680000
                                    SIZECDO                             09690000
                                    RCLDPLO                             09691036
                                    RCLSCLO                             09692035
                                    COLORO                              09700000
                                    COLRCDO                             09710000
                                    STATUSO                             09760000
                                    STADSCO                             09770000
W30677                              BNDNMEO                             09780027
                                    VNDNMEO                             09781012
                                    TKTCLRO                             09790000
                                    VNDSTYO                             09800000
                                    VNDNBRO                             09820000
                                    GRPCDEO                             09850000
                                    GRPRTLO                             09860000
                                    STKNBRO                             09880000
                                    STCHDTO                             09890000
                                    SETDTEO                             09900000
                                    PRCDTEO                             09910000
                                    FIRSALO                             09920000
                                    FIRRCTO                             09930000
                                    LSTSALO                             09940000
                                    LSTRCTO                             09950000
                                    ONHANDO                             09971000
                                    STROHO                              09972000
W30677                              INTQTYO                             09972127
                                    ONORDRO                             09973000
W30677                              STREPTO                             09973127
                                    CURRTLO                             09975000
                                    ORGRTLO                             09976000
                                    CURCSTO                             09977000
                                    FIRCSTO                             09978000
                                    INPQTYO                             09979000
                                    OTPQTYO.                            09979100
                                                                        09980000
      ******************************************************************10024715
      ** VALIDATE STORE NUMBER.                                       **10024815
      ******************************************************************10024915
       3700-VALIDATE-STORE-NBR.                                         10025012
                                                                        10030000
           MOVE ASC-STORE-NUMBER TO PV-LOC-NBR.                         10040000
                                                                        10050000
           PERFORM                                                      10060000
               WITH TEST AFTER                                          10070000
               VARYING PV-RETRY-COUNTER                                 10080000
               FROM 1 BY 1                                              10090000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10100000
                         OR (SQLCODE = ZERO)                            10110000
                         OR (SQLCODE = +100))                           10120000
               EXEC SQL                                                 10130000
                   SELECT LOC_10_ABBR_NM                                10140000
                       INTO :XMT00001-LOC-10-ABBR-NM                    10150000
                       FROM XMT_LOC                                     10160000
                       WHERE LOC_NBR = :PV-LOC-NBR                      10170000
                       AND ((FINCL_CLO_DTE >= CURRENT DATE)             10180000
                        OR  (FINCL_CLO_DTE IS NULL))                    10190000
               END-EXEC                                                 10200000
                                                                        10210000
               EVALUATE TRUE                                            10220000
                   WHEN SQLCODE = ZERO                                  10230000
                   WHEN SQLCODE = +100                                  10240000
                   WHEN SQLCODE = -904                                  10250000
                   WHEN SQLCODE = -913                                  10260000
                       CONTINUE                                         10270000
                   WHEN SQLWARN0 NOT = SPACES                           10280000
                   WHEN SQLCODE < ZERO                                  10290000
                   WHEN SQLCODE > ZERO                                  10300000
                       MOVE '3700-VALIDATE-STORE-NBR'                   10310000
                                         TO DP013-PARAGRAPH             10320000
                       MOVE 'VALIDATE STORE NBR'                        10330000
                                         TO DP013-MESSAGE-TEXT (1)      10340000
                       MOVE SQLCA        TO DP013-SQLCA                 10350000
                       MOVE 'XMT_LOC'    TO DP013-DB2-TABLE-NAME (1)    10360000
                       SET DP013-DB2-ABEND                              10370000
                           DP013-XCTL-DISPLAY-RESTART                   10380000
                                         TO TRUE                        10390000
                       PERFORM DP013-0000-PROCESS-ABEND                 10400000
               END-EVALUATE                                             10410000
           END-PERFORM.                                                 10420000
                                                                        10430000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10440000
               MOVE '3700-VALIDATE-STORE-NBR'                           10450000
                                         TO DP013-PARAGRAPH             10460000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     10470000
                                         TO DP013-MESSAGE-TEXT (1)      10480000
               MOVE 'VALIDATE STORE NBR'                                10490000
                                         TO DP013-MESSAGE-TEXT (2)      10500000
               MOVE SQLCA                TO DP013-SQLCA                 10510000
               MOVE 'XMT_LOC'            TO DP013-DB2-TABLE-NAME (1)    10520000
               SET DP013-DB2-ABEND                                      10530000
                   DP013-XCTL-DISPLAY-RESTART                           10540000
                                         TO TRUE                        10550000
               PERFORM DP013-0000-PROCESS-ABEND                         10560000
           END-IF.                                                      10570000
                                                                        10580000
      ******************************************************************10590000
      ** VALIDATE SKU/STORE EXISTANCE.                                **10600000
      ******************************************************************10610000
       3800-VALIDATE-SKU-STORE.                                         10620000
                                                                        10630000
           MOVE ASC-STORE-NUMBER TO PV-LOC-NBR.                         10640000
           MOVE ASC-ITEM-NBR     TO PV-ITEM-NBR.                        10650000
                                                                        10660000
           PERFORM                                                      10670000
               WITH TEST AFTER                                          10680000
               VARYING PV-RETRY-COUNTER                                 10690000
               FROM 1 BY 1                                              10700000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10710000
                         OR (SQLCODE = ZERO)                            10720000
                         OR (SQLCODE = +100))                           10730000
               EXEC SQL                                                 10740000
                   SELECT LAST_SALE_DATE                                10750000
                         ,LAST_RCVD_DATE                                10760000
                         ,ONHAND_QTY                                    10770000
                         ,FIRST_RCVD_DATE                               10780000
                         ,FIRST_SALE_DATE                               10790000
                   INTO  :TSKST-LAST-SALE-DATE                          10800000
                        ,:TSKST-LAST-RCVD-DATE                          10810000
                        ,:TSKST-ONHAND-QTY                              10820000
                        ,:TSKST-FIRST-RCVD-DATE                         10830000
                        ,:TSKST-FIRST-SALE-DATE                         10840000
                   FROM   TSKST                                         10850000
                   WHERE  ITEM_NMBR   = :PV-ITEM-NBR                    10860000
                     AND  LOC_NBR     = :PV-LOC-NBR                     10870000
               END-EXEC                                                 10880000
           END-PERFORM.                                                 11100000
                                                                        11110000
      ******************************************************************11270000
      ** VALID SKU/STORE COMBINATION                                  **11280000
      ******************************************************************11290000
       3810-FORMAT-TSKST-DATES.                                         11300000
                                                                        11310000
      *- FIRST RECEIPT DATE                                             11320000
           INITIALIZE   PV-DATE-YMD                                     11330000
                        PV-DATE-FMT.                                    11340000
                                                                        11350000
           MOVE TSKST-FIRST-RCVD-DATE  TO PV-DATE-YMD.                  11360000
                                                                        11370000
           IF PV-DATE-YY > 80                                           11380000
               MOVE 19             TO PV-DATE-CC-FMT                    11390000
           ELSE                                                         11400000
               IF PV-DATE-YY = ZERO                                     11401000
                  MOVE 00          TO PV-DATE-CC-FMT                    11402000
                ELSE                                                    11403000
                  MOVE 20          TO PV-DATE-CC-FMT                    11410000
                END-IF                                                  11411000
           END-IF.                                                      11420000
                                                                        11437000
           MOVE PV-DATE-YY         TO PV-DATE-YY-FMT.                   11440000
           MOVE PV-DATE-MM         TO PV-DATE-MM-FMT.                   11450000
           MOVE PV-DATE-DD         TO PV-DATE-DD-FMT.                   11460000
                                                                        11470000
           MOVE PV-DATE-FMT        TO ASC-FIRST-RCPT-DTE.               11480000
                                                                        11490000
      *- FIRST SALE DATE                                                11500000
           INITIALIZE   PV-DATE-YMD                                     11510000
                        PV-DATE-FMT.                                    11520000
                                                                        11530000
           MOVE TSKST-FIRST-SALE-DATE  TO PV-DATE-YMD.                  11540000
                                                                        11550000
           IF PV-DATE-YY > 80                                           11560000
               MOVE 19             TO PV-DATE-CC-FMT                    11570000
           ELSE                                                         11580000
               IF PV-DATE-YY = ZERO                                     11581000
                  MOVE 00          TO PV-DATE-CC-FMT                    11582000
                ELSE                                                    11583000
                  MOVE 20          TO PV-DATE-CC-FMT                    11584000
                END-IF                                                  11585000
           END-IF.                                                      11600000
                                                                        11610000
           MOVE PV-DATE-YY         TO PV-DATE-YY-FMT.                   11620000
           MOVE PV-DATE-MM         TO PV-DATE-MM-FMT.                   11630000
           MOVE PV-DATE-DD         TO PV-DATE-DD-FMT.                   11640000
                                                                        11650000
           MOVE PV-DATE-FMT        TO ASC-FIRST-SALE-DTE.               11660000
                                                                        11670000
      *- LAST RECEIPT DATE                                              11680000
           INITIALIZE   PV-DATE-YMD                                     11690000
                        PV-DATE-FMT.                                    11700000
                                                                        11710000
           MOVE TSKST-LAST-RCVD-DATE   TO PV-DATE-YMD.                  11720000
                                                                        11730000
           IF PV-DATE-YY > 80                                           11740000
               MOVE 19             TO PV-DATE-CC-FMT                    11750000
           ELSE                                                         11760000
               IF PV-DATE-YY = ZERO                                     11761000
                  MOVE 00          TO PV-DATE-CC-FMT                    11762000
                ELSE                                                    11763000
                  MOVE 20          TO PV-DATE-CC-FMT                    11764000
                END-IF                                                  11765000
           END-IF.                                                      11780000
                                                                        11790000
           MOVE PV-DATE-YY         TO PV-DATE-YY-FMT.                   11800000
           MOVE PV-DATE-MM         TO PV-DATE-MM-FMT.                   11810000
           MOVE PV-DATE-DD         TO PV-DATE-DD-FMT.                   11820000
                                                                        11830000
           MOVE PV-DATE-FMT        TO ASC-LAST-RCPT-DTE.                11840000
                                                                        11850000
      *- LAST SALE DATE                                                 11860000
           INITIALIZE   PV-DATE-YMD                                     11870000
                        PV-DATE-FMT.                                    11880000
                                                                        11890000
           MOVE TSKST-LAST-SALE-DATE   TO PV-DATE-YMD.                  11900000
                                                                        11910000
           IF PV-DATE-YY > 80                                           11920000
               MOVE 19             TO PV-DATE-CC-FMT                    11930000
           ELSE                                                         11940000
               IF PV-DATE-YY = ZERO                                     11941000
                  MOVE 00          TO PV-DATE-CC-FMT                    11942000
                ELSE                                                    11943000
                  MOVE 20          TO PV-DATE-CC-FMT                    11944000
                END-IF                                                  11945000
           END-IF.                                                      11960000
                                                                        11970000
           MOVE PV-DATE-YY         TO PV-DATE-YY-FMT.                   11980000
           MOVE PV-DATE-MM         TO PV-DATE-MM-FMT.                   11990000
           MOVE PV-DATE-DD         TO PV-DATE-DD-FMT.                   12000000
                                                                        12010000
           MOVE PV-DATE-FMT        TO ASC-LAST-SALE-DTE.                12020000
                                                                        12030000
      ******************************************************************12040000
      ** VALID SKU - GET DETAIL FOR THE COMMAREA AND SCREEN.          **12050000
      ******************************************************************12060000
       3900-GET-SKU-DETAIL.                                             12070000
           PERFORM 3950-GET-TSK-VALUES.                                 12090000
                                                                        12100000
           IF SQLCODE = ZERO                                            12110000
              MOVE TSK-SKU-DESC           TO ASC-SKU-DESC               12120000
              MOVE TSK-GROUP-CODE         TO ASC-GROUP-CDE              12160000
              MOVE TSK-STICKER-NBR        TO ASC-STICKER-NBR            12170000
              MOVE TSK-LONG-VENDOR-STYLE  TO ASC-VENDOR-STYLE           12180000
              MOVE TSK-VNDR-INNR-PACK-QTY TO ASC-INNER-PK-QTY           12190000
              MOVE TSK-VEND-OUTR-PACK-QTY TO ASC-OUTER-PK-QTY           12200000
              MOVE TSK-LONG-COLOR-DESC    TO ASC-COLOR-DESC             12210000
              MOVE TSK-COLOR-CDE          TO ASC-COLOR-CDE              12220000
              MOVE TSK-SIZE-CDE           TO ASC-SIZE-CDE               12230000
              MOVE TSK-UNIT-COST-AMT      TO ASC-CURR-COST              12240000
              MOVE TSK-UNT-COST-1ST-AMT   TO ASC-FIRST-COST             12250000
      **  FORMAT SETUP DATE                                             12270000
              INITIALIZE   PV-DATE-YMD                                  12280000
                           PV-DATE-FMT                                  12281000
              MOVE TSK-SETUP-DATE         TO PV-DATE-YMD                12282000
              PERFORM 3970-FORMAT-CHGD-DATES                            12283000
              MOVE PV-DATE-FMT            TO ASC-SET-UP-DTE             12284000
                                                                        12286000
              MOVE TSK-ORIG-UNIT-RTL-AMT  TO ASC-ORIG-RTL               12290000
              IF TSK-REGN-PRIC-IND = 'Y'                                12291000
                 SET ASC-SKU-RCP TO TRUE                                12292000
              ELSE                                                      12293000
                 SET ASC-SKU-NON-RCP TO TRUE                            12294000
              END-IF                                                    12295000
              PERFORM 3960-GET-RCP-DETAIL                               12300000
              PERFORM 3968-SET-STAT-TKTCLR                              12300100
              PERFORM 3975-GET-SIZE-DESC                                12301000
W30677        PERFORM 3978-GET-BRAND-NAME                               12301127
              PERFORM 3980-GET-VENDOR-INFO                              12302000
              PERFORM 3985-GET-ON-ORDER                                 12303000
              PERFORM 3990-GET-INTRAN-STR-OH                            12304000
              PERFORM 3955-CK-FOR-RECLASS                               12304132
              IF SQLCODE = ZERO                                         12304235
                  MOVE IMT00015-OLD-DEPT-NBR TO PV-RECLASS-DEPT         12304337
                  MOVE PV-RECLASS-DEPT       TO ASC-RECLASS-DEPT        12304437
                  MOVE IMT00015-OLD-SUB-CL-NBR TO PV-RECLASS-SCL        12304537
                  MOVE PV-RECLASS-SCL        TO ASC-RECLASS-SCL         12304639
              ELSE                                                      12304735
                  MOVE SPACES TO ASC-RECLASS-DEPT                       12304837
                  MOVE SPACES TO ASC-RECLASS-SCL                        12304937
              END-IF                                                    12305035
           ELSE                                                         12310000
              MOVE SPACES                 TO ASC-DEPT-NUMBER-X          12320000
                                             ASC-MCL-NUMBER-X           12320100
                                             ASC-SCL-NUMBER-X           12320200
                                             ASC-SKU-NUMBER-X           12320300
                                             ASC-STORE-DESC             12320400
                                             ASC-SKU-DESC               12320500
                                             ASC-SIZE-DESC              12320700
                                             ASC-SIZE-CDE               12320800
                                             ASC-RECLASS-DEPT           12320937
                                             ASC-RECLASS-SCL            12321037
                                             ASC-COLOR-DESC             12321100
                                             ASC-COLOR-CDE              12321200
                                             ASC-STATUS                 12321300
                                             ASC-STATUS-DESC            12321400
W30677                                       ASC-BRAND-NAME             12321527
                                             ASC-VENDOR-NAME            12321616
                                             ASC-TICKET-COLOR           12321716
                                             ASC-VENDOR-STYLE           12321816
                                             ASC-STAT-CHGD-DTE          12321916
                                             ASC-VENDOR-NBR             12322016
                                             ASC-SET-UP-DTE             12322116
                                             ASC-GROUP-CDE              12322216
                                             ASC-GROUP-RTL              12322316
                                             ASC-PRC-CHGD-DTE           12322416
                                             ASC-STICKER-NBR            12322516
                                             ASC-FIRST-SALE-DTE         12322616
                                             ASC-FIRST-RCPT-DTE         12322716
                                             ASC-LAST-SALE-DTE          12322816
                                             ASC-LAST-RCPT-DTE          12322916
              MOVE ZEROS                  TO ASC-OH-QTY                 12329537
                                             ASC-STORE-OH-QTY           12329600
                                             ASC-OO-QTY                 12329700
                                             ASC-INTRAN-QTY             12329800
                                             ASC-CURR-RTL               12329900
                                             ASC-ORIG-RTL               12330000
                                             ASC-CURR-COST              12330100
                                             ASC-FIRST-COST             12330200
                                             ASC-INNER-PK-QTY           12331000
                                             ASC-OUTER-PK-QTY           12332000
           END-IF.                                                      12332400
                                                                        12332500
      ******************************************************************12402000
      ** GET THE SKU VALUES FROM TSK                                  **12403000
      ******************************************************************12404000
       3950-GET-TSK-VALUES.                                             12405000
                                                                        12406000
           PERFORM                                                      12410000
               WITH TEST AFTER                                          12420000
               VARYING PV-RETRY-COUNTER                                 12430000
               FROM 1 BY 1                                              12440000
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12450000
                         OR (SQLCODE = ZERO)                            12460000
                         OR (SQLCODE = +100))                           12470000
               EXEC SQL                                                 12480000
                   SELECT SKU_DESC                                      12490000
                         ,STAT_CHNGD_DATE                               12510000
                         ,PRICE_CHNG_DATE                               12520000
                         ,GROUP_CODE                                    12530000
                         ,STICKER_NBR                                   12540000
                         ,LONG_VENDOR_STYLE                             12550000
                         ,VNDR_INNR_PACK_QTY                            12560000
                         ,VEND_OUTR_PACK_QTY                            12570000
                         ,LONG_COLOR_DESC                               12580000
                         ,COLOR_CDE                                     12590000
                         ,SIZE_CDE                                      12600000
                         ,UNIT_COST_AMT                                 12610000
                         ,UNT_COST_1ST_AMT                              12620000
                         ,SETUP_DATE                                    12630000
                         ,CUR_UNIT_RTL_AMT                              12640000
                         ,GP_QTY                                        12650000
                         ,GP_RTL_AMT                                    12651000
                         ,ORIG_UNIT_RTL_AMT                             12660000
                         ,ENT_ID                                        12661000
                         ,REGN_PRIC_IND                                 12670000
                       INTO :TSK-SKU-DESC                               12680000
                           ,:TSK-STAT-CHNGD-DATE                        12700000
                           ,:TSK-PRICE-CHNG-DATE                        12710000
                           ,:TSK-GROUP-CODE                             12720000
                           ,:TSK-STICKER-NBR                            12730000
                           ,:TSK-LONG-VENDOR-STYLE                      12740000
                           ,:TSK-VNDR-INNR-PACK-QTY                     12750000
                           ,:TSK-VEND-OUTR-PACK-QTY                     12760000
                           ,:TSK-LONG-COLOR-DESC                        12770000
                           ,:TSK-COLOR-CDE                              12780000
                           ,:TSK-SIZE-CDE                               12790000
                           ,:TSK-UNIT-COST-AMT                          12800000
                           ,:TSK-UNT-COST-1ST-AMT                       12810000
                           ,:TSK-SETUP-DATE                             12820000
                           ,:TSK-CUR-UNIT-RTL-AMT                       12830000
                           ,:TSK-GP-QTY                                 12840000
                           ,:TSK-GP-RTL-AMT                             12841000
                           ,:TSK-ORIG-UNIT-RTL-AMT                      12850000
                           ,:TSK-ENT-ID                                 12851000
                           ,:TSK-REGN-PRIC-IND                          12860000
                       FROM TSK                                         12870000
                       WHERE ITEM_NMBR = :SKXREF-ITM-NBR                12880000
               END-EXEC                                                 12890000
                                                                        12900000
               EVALUATE TRUE                                            12910000
                   WHEN SQLCODE = ZERO                                  12920000
                   WHEN SQLCODE = +100                                  12930000
                   WHEN SQLCODE = -904                                  12940000
                   WHEN SQLCODE = -913                                  12950000
                       CONTINUE                                         12960000
                   WHEN SQLWARN0 NOT = SPACES                           12970000
                   WHEN SQLCODE < ZERO                                  12980000
                   WHEN SQLCODE > ZERO                                  12990000
                       MOVE '3950-GET-TSK-DESC'                         13000000
                                         TO DP013-PARAGRAPH             13010000
                       MOVE 'GET TSK VALUES     '                       13020000
                                         TO DP013-MESSAGE-TEXT (1)      13030000
                       MOVE SQLCA        TO DP013-SQLCA                 13040000
                       MOVE 'TSK    '    TO DP013-DB2-TABLE-NAME (1)    13050000
                       SET DP013-DB2-ABEND                              13060000
                           DP013-XCTL-DISPLAY-RESTART                   13070000
                                         TO TRUE                        13080000
                       PERFORM DP013-0000-PROCESS-ABEND                 13090000
               END-EVALUATE                                             13100000
           END-PERFORM.                                                 13110000
                                                                        13120000
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13130000
               MOVE '3950-GET-TSK-DESC'                                 13140000
                                         TO DP013-PARAGRAPH             13150000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13160000
                                         TO DP013-MESSAGE-TEXT (1)      13170000
               MOVE 'GET TSK VALUES     '                               13180000
                                         TO DP013-MESSAGE-TEXT (2)      13190000
               MOVE SQLCA                TO DP013-SQLCA                 13200000
               MOVE 'TSK    '            TO DP013-DB2-TABLE-NAME (1)    13210000
               SET DP013-DB2-ABEND                                      13220000
                   DP013-XCTL-DISPLAY-RESTART                           13230000
                                         TO TRUE                        13240000
               PERFORM DP013-0000-PROCESS-ABEND                         13250000
           END-IF.                                                      13260000
                                                                        13260131
      ******************************************************************13260231
      ** HAS THE SKU BEEN RECLASSED?  IF SO, GET THE MOST RECENT DEPT  *13260331
      ** AND SUBCLASS IT WAS RECLASSED FROM.                           *13260431
      ******************************************************************13260531
       3955-CK-FOR-RECLASS.                                             13260631
           MOVE ASC-SKU-NUMBER TO PV-SKU-NBR.                           13260732
           PERFORM                                                      13260831
               WITH TEST AFTER                                          13260931
               VARYING PV-RETRY-COUNTER                                 13261031
               FROM 1 BY 1                                              13261131
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13261231
                         OR (SQLCODE = ZERO)                            13261331
                         OR (SQLCODE = +100))                           13261431
               EXEC SQL                                                 13261531
                   SELECT OLD_DEPT_NBR                                  13261631
                         ,OLD_SUB_CL_NBR                                13261731
                       INTO :IMT00015-OLD-DEPT-NBR                      13263631
                           ,:IMT00015-OLD-SUB-CL-NBR                    13263731
                       FROM IMT_RECLS                                   13265631
                       WHERE SKU_NBR = :PV-SKU-NBR                      13265832
                   ORDER BY RECLS_TMST DESC                             13265931
                   FETCH FIRST ROW ONLY                                 13266031
               END-EXEC                                                 13266131
                                                                        13266231
               EVALUATE TRUE                                            13266331
                   WHEN SQLCODE = ZERO                                  13266431
                   WHEN SQLCODE = +100                                  13266631
                   WHEN SQLCODE = -904                                  13266731
                   WHEN SQLCODE = -913                                  13266831
                       CONTINUE                                         13266931
                   WHEN SQLWARN0 NOT = SPACES                           13267031
                   WHEN SQLCODE < ZERO                                  13267131
                   WHEN SQLCODE > ZERO                                  13267231
                       MOVE '3955-CK-FOR-RECLASS'                       13267332
                                         TO DP013-PARAGRAPH             13267431
                       MOVE 'CK FOR RECLASS     '                       13267532
                                         TO DP013-MESSAGE-TEXT (1)      13267631
                       MOVE SQLCA        TO DP013-SQLCA                 13267731
                       MOVE 'IMT_RECLS'  TO DP013-DB2-TABLE-NAME (1)    13267832
                       SET DP013-DB2-ABEND                              13267931
                           DP013-XCTL-DISPLAY-RESTART                   13268031
                                         TO TRUE                        13268131
                       PERFORM DP013-0000-PROCESS-ABEND                 13268231
               END-EVALUATE                                             13268331
           END-PERFORM.                                                 13268431
                                                                        13268531
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13268631
               MOVE '3955-CK-FOR-RECLASS'                               13268732
                                         TO DP013-PARAGRAPH             13268931
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13269031
                                         TO DP013-MESSAGE-TEXT (1)      13269131
               MOVE 'CK FOR RECLASS     '                               13269232
                                         TO DP013-MESSAGE-TEXT (2)      13269431
               MOVE SQLCA                TO DP013-SQLCA                 13269531
               MOVE 'IMT_RECLS'          TO DP013-DB2-TABLE-NAME (1)    13269632
               SET DP013-DB2-ABEND                                      13269731
                   DP013-XCTL-DISPLAY-RESTART                           13269831
                                         TO TRUE                        13269931
               PERFORM DP013-0000-PROCESS-ABEND                         13270031
           END-IF.                                                      13270131
                                                                        13270200
      ******************************************************************13270300
      ** GET ADDITIONAL DETAIL FOR COMMAREA AND SCREEN.               **13270400
      ** WHEN THE SKU IS RCP, CALL TUPCPLS FOR THE SPECIFIC STORE     **13270500
      ** TO RETRIEVE THE CORRECT CURRENT RETAIL, STATUS CODE,         **13270600
      ** STATUS CHANGE AND PRICE CHANGE DATES.                        **13270700
      ******************************************************************13270800
       3960-GET-RCP-DETAIL.                                             13270900
                                                                        13271000
           IF ASC-SKU-RCP                                               13271100
              PERFORM 3965-GET-TUPCPLS-DETAIL                           13271200
              IF SQLCODE = ZERO                                         13271300
                 IF UPCPLS-UPC-STAT-CDE = '30'                          13271400
                    MOVE 1                    TO PV-GP-QTY              13271500
                    MOVE SPACES               TO ASC-GROUP-RTL          13271600
                 END-IF                                                 13271700
                 MOVE UPCPLS-UPC-STAT-CDE     TO ASC-STATUS             13271800
                 MOVE UPCPLS-UNT-RTL-AMT      TO ASC-CURR-RTL           13271900
      **  FORMAT STATUS CHANGE DATE FROM TUPCPLS                        13272000
                 INITIALIZE   PV-DATE-FMT                               13272100
                              PV-DATE-FMT-DB2                           13272200
KP1005           IF UPCPLS-UPC-STAT-CDE = '30'                          13272302
KP1005              MOVE UPCPLS-ORIG-CLR-DTE     TO PV-DATE-FMT-DB2     13272402
KP1005           ELSE                                                   13272502
KP1005              MOVE UPCPLS-UPC-STAT-CHG-DTE TO PV-DATE-FMT-DB2     13272602
KP1005           END-IF                                                 13272702
                 PERFORM 3972-FORMAT-DB2-DATES                          13272800
                 MOVE PV-DATE-FMT              TO ASC-STAT-CHGD-DTE     13272900
                 MOVE PV-DATE-COMPARE          TO PV-STAT-CHG-DATE      13273000
      **  FORMAT PRICE CHANGE DATE FROM TUPCPLS                         13273100
                 INITIALIZE   PV-DATE-FMT                               13273200
                              PV-DATE-FMT-DB2                           13273300
                 MOVE UPCPLS-UNT-RTL-CHG-DTE   TO PV-DATE-FMT-DB2       13273400
                 PERFORM 3972-FORMAT-DB2-DATES                          13273500
                 MOVE PV-DATE-FMT              TO ASC-PRC-CHGD-DTE      13273600
                 MOVE PV-DATE-COMPARE          TO PV-PRC-CHG-DATE       13273700
MK    **  IF STATUS CHANGE AND PRICE CHANGE DATE EQUAL                  13273800
MK    **  SET UP DATE - ZERO OUT THE STATUS AND PRICE CHANGE DATES      13273900
MK               IF (ASC-PRC-CHGD-DTE = ASC-SET-UP-DTE)                 13274000
MK                AND (ASC-STAT-CHGD-DTE = ASC-SET-UP-DTE)              13274100
MK                    MOVE PC-ZERO-DTE      TO ASC-PRC-CHGD-DTE         13274200
MK                                             ASC-STAT-CHGD-DTE        13274300
MK               END-IF                                                 13274400
              ELSE                                                      13274500
                 IF ASC-STORE-NUMBER-X = PC-CORP-LOCATION               13274600
                    CONTINUE                                            13274700
                 ELSE                                                   13274800
MK                  IF SKXREF-SKU-STAT-CDE = '30'                       13274900
MK                     MOVE '30'            TO ASC-STATUS               13275000
MK                  ELSE                                                13275100
MK                     MOVE '20'            TO ASC-STATUS               13275200
MK                  END-IF                                              13275300
                 END-IF                                                 13275400
                 MOVE TSK-CUR-UNIT-RTL-AMT     TO ASC-CURR-RTL          13275500
      **  FORMAT STATUS CHANGE DATE FROM TSK                            13275600
                 INITIALIZE   PV-DATE-YMD                               13275700
                              PV-DATE-FMT                               13275800
                 MOVE TSK-STAT-CHNGD-DATE      TO PV-DATE-YMD           13275900
                 PERFORM 3970-FORMAT-CHGD-DATES                         13276000
                 MOVE PV-DATE-FMT              TO ASC-STAT-CHGD-DTE     13276100
                 MOVE PV-DATE-COMPARE          TO PV-STAT-CHG-DATE      13276200
                                                                        13276300
      **  FORMAT PRICE CHANGE DATE FROM TSK                             13276400
                 INITIALIZE   PV-DATE-YMD                               13276500
                              PV-DATE-FMT                               13276600
                 MOVE TSK-PRICE-CHNG-DATE      TO PV-DATE-YMD           13276700
                 PERFORM 3970-FORMAT-CHGD-DATES                         13276800
                 MOVE PV-DATE-FMT              TO ASC-PRC-CHGD-DTE      13276900
                 MOVE PV-DATE-COMPARE          TO PV-PRC-CHG-DATE       13277000
MK    **  IF STATUS CHANGE AND PRICE CHANGE DATE EQUAL                  13277100
MK    **  SET UP DATE - ZERO OUT THE STATUS AND PRICE CHANGE DATES      13277200
MK               IF (ASC-PRC-CHGD-DTE = ASC-SET-UP-DTE)                 13277300
MK                AND (ASC-STAT-CHGD-DTE = ASC-SET-UP-DTE)              13277400
MK                    MOVE PC-ZERO-DTE      TO ASC-PRC-CHGD-DTE         13277500
MK                                             ASC-STAT-CHGD-DTE        13277600
MK               END-IF                                                 13277700
                                                                        13277800
                 IF TSK-GP-QTY > 1                                      13277900
                    MOVE TSK-GP-QTY           TO PV-GP-QTY              13278000
                    MOVE TSK-GP-RTL-AMT       TO PV-GP-RTL-AMT          13278100
                    MOVE PV-GP-QTY-RTL        TO ASC-GROUP-RTL          13278200
                 ELSE                                                   13278300
                    MOVE SPACES               TO ASC-GROUP-RTL          13278400
                 END-IF                                                 13278500
           ELSE                                                         13278600
      ** (SKU STATUS RETRIEVED FROM TSKXREF WHEN NOT RCP)               13278700
              MOVE TSK-CUR-UNIT-RTL-AMT   TO ASC-CURR-RTL               13278800
      **  FORMAT STATUS CHANGE DATE FROM TSK                            13278900
              INITIALIZE   PV-DATE-YMD                                  13279000
                           PV-DATE-FMT                                  13279100
              MOVE TSK-STAT-CHNGD-DATE     TO PV-DATE-YMD               13279200
              PERFORM 3970-FORMAT-CHGD-DATES                            13279300
              MOVE PV-DATE-FMT             TO ASC-STAT-CHGD-DTE         13279400
              MOVE PV-DATE-COMPARE         TO PV-STAT-CHG-DATE          13279500
                                                                        13279600
      **  FORMAT PRICE CHANGE DATE FROM TSK                             13279700
              INITIALIZE   PV-DATE-YMD                                  13279800
                           PV-DATE-FMT                                  13279900
              MOVE TSK-PRICE-CHNG-DATE     TO PV-DATE-YMD               13280000
              PERFORM 3970-FORMAT-CHGD-DATES                            13280100
              MOVE PV-DATE-FMT             TO ASC-PRC-CHGD-DTE          13280200
              MOVE PV-DATE-COMPARE         TO PV-PRC-CHG-DATE           13280300
MK    **  IF STATUS CHANGE AND PRICE CHANGE DATE EQUAL                  13280400
MK    **  SET UP DATE - ZERO OUT THE STATUS AND PRICE CHANGE DATES      13280500
MK            IF (ASC-PRC-CHGD-DTE = ASC-SET-UP-DTE)                    13280600
MK             AND (ASC-STAT-CHGD-DTE = ASC-SET-UP-DTE)                 13280700
MK                 MOVE PC-ZERO-DTE        TO ASC-PRC-CHGD-DTE          13280800
MK                                            ASC-STAT-CHGD-DTE         13280900
MK            END-IF                                                    13281000
                                                                        13281100
              IF TSK-GP-QTY > 1                                         13281200
                 MOVE TSK-GP-QTY           TO PV-GP-QTY                 13281300
                 MOVE TSK-GP-RTL-AMT       TO PV-GP-RTL-AMT             13281400
                 MOVE PV-GP-QTY-RTL        TO ASC-GROUP-RTL             13281500
              ELSE                                                      13281600
                 MOVE SPACES               TO ASC-GROUP-RTL             13281700
              END-IF                                                    13281800
           END-IF.                                                      13281900
                                                                        13282000
      ******************************************************************13282100
      ** GET STATUS AND CURRENT RETAIL FOR REGIONAL CLEARANCE PRICED  **13282200
      ** SKU.                                                         **13282300
      ******************************************************************13282400
       3965-GET-TUPCPLS-DETAIL.                                         13282500
                                                                        13282600
           MOVE ASC-STORE-NUMBER TO PV-LOC-NBR.                         13282700
                                                                        13282800
           PERFORM                                                      13282900
               WITH TEST AFTER                                          13283000
               VARYING PV-RETRY-COUNTER                                 13283100
               FROM 1 BY 1                                              13283200
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13283300
                         OR (SQLCODE = ZERO)                            13283400
                         OR (SQLCODE = +100))                           13283500
               EXEC SQL                                                 13283600
                    SELECT  UPC_STAT_CDE                                13283700
                           ,UNT_RTL_AMT                                 13283800
                           ,UPC_STAT_CHG_DTE                            13283902
                           ,UNT_RTL_CHG_DTE                             13284000
                           ,ORIG_CLR_DTE                                13284100
                           ,MKDN_CDE                                    13284203
                      INTO :UPCPLS-UPC-STAT-CDE                         13284303
                          ,:UPCPLS-UNT-RTL-AMT                          13284403
                          ,:UPCPLS-UPC-STAT-CHG-DTE                     13284503
                          ,:UPCPLS-UNT-RTL-CHG-DTE                      13284603
                          ,:UPCPLS-ORIG-CLR-DTE                         13284703
                           :PV-UPCPLS-ORIG-CLR-DTE-NN                   13284803
                          ,:UPCPLS-MKDN-CDE                             13284904
                           :PV-UPCPLS-MKDN-CDE-NN                       13285003
                       FROM TUPCPLS                                     13285103
                      WHERE OPERCO_NBR   = '03'                         13285203
                        AND ITM_NBR      = :ASC-ITEM-NBR                13285303
                        AND STR_NBR      = :PV-LOC-NBR                  13285403
                        AND ((EFF_BEG_TMST <= CURRENT TIMESTAMP         13285503
                        AND EFF_END_TMST >= CURRENT TIMESTAMP)          13285603
                         OR (EFF_BEG_TMST <= CURRENT TIMESTAMP          13285703
                        AND EFF_END_TMST IS NULL))                      13285803
               END-EXEC                                                 13285903
                                                                        13286003
               EVALUATE TRUE                                            13286103
                   WHEN SQLCODE = ZERO                                  13286203
                   WHEN SQLCODE = +100                                  13286303
                   WHEN SQLCODE = -904                                  13286403
                   WHEN SQLCODE = -913                                  13286503
                       CONTINUE                                         13286603
                   WHEN SQLWARN0 NOT = SPACES                           13286703
                   WHEN SQLCODE < ZERO                                  13286803
                   WHEN SQLCODE > ZERO                                  13286903
                       MOVE '3965-GET-TUPCPLS-DETAIL'                   13287003
                                         TO DP013-PARAGRAPH             13287103
                       MOVE 'GET TUPCPLS-RCP DETAIL'                    13287203
                                         TO DP013-MESSAGE-TEXT (1)      13287303
                       MOVE SQLCA        TO DP013-SQLCA                 13287403
                       MOVE 'TUPCPLS'    TO DP013-DB2-TABLE-NAME (1)    13287503
                       SET DP013-DB2-ABEND                              13287603
                           DP013-XCTL-DISPLAY-RESTART                   13287703
                                         TO TRUE                        13287803
                       PERFORM DP013-0000-PROCESS-ABEND                 13287903
               END-EVALUATE                                             13288003
           END-PERFORM.                                                 13288103
                                                                        13288203
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13288303
               MOVE '3965-GET-TUPCPLS-DETAIL'                           13288403
                                         TO DP013-PARAGRAPH             13288503
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13288603
                                         TO DP013-MESSAGE-TEXT (1)      13288703
               MOVE 'GET TUPCPLS-RCP DETAIL'                            13288803
                                         TO DP013-MESSAGE-TEXT (2)      13288903
               MOVE SQLCA                TO DP013-SQLCA                 13289003
               MOVE 'TUPCPLS'            TO DP013-DB2-TABLE-NAME (1)    13289103
               SET DP013-DB2-ABEND                                      13289203
                   DP013-XCTL-DISPLAY-RESTART                           13289303
                                         TO TRUE                        13289403
               PERFORM DP013-0000-PROCESS-ABEND                         13289503
           END-IF.                                                      13289603
                                                                        13289703
      ******************************************************************13289803
      ** SET STATUS DESCRIPTION AND TICKET COLOR.                     **13289903
      ******************************************************************13290003
       3968-SET-STAT-TKTCLR.                                            13290103
                                                                        13290203
           EVALUATE ASC-STATUS                                          13290303
               WHEN '10'                                                13290403
                    MOVE 'NEW   '          TO ASC-STATUS-DESC           13290503
               WHEN '20'                                                13290603
                    MOVE 'ACTIVE'          TO ASC-STATUS-DESC           13290703
               WHEN '25'                                                13290803
                    MOVE 'MIXED'           TO ASC-STATUS-DESC           13290903
               WHEN '30'                                                13291003
                    MOVE 'CLEAR '          TO ASC-STATUS-DESC           13291103
               WHEN '40'                                                13291203
                    MOVE 'PROMO '          TO ASC-STATUS-DESC           13291303
               WHEN '90'                                                13291403
                    MOVE 'DISCON'          TO ASC-STATUS-DESC           13291503
               WHEN '98'                                                13291603
                    MOVE 'RENUM '          TO ASC-STATUS-DESC           13291703
               WHEN OTHER                                               13291803
                    MOVE '      '          TO ASC-STATUS-DESC           13291903
           END-EVALUATE.                                                13292003
                                                                        13292103
           IF ASC-STATUS = '30'                                         13292203
KP1005        IF UPCPLS-MKDN-CDE = '1' OR '2' OR 'F'                    13292305
KP1005           MOVE 'YELLOW'      TO ASC-TICKET-COLOR                 13292403
KP1005        ELSE                                                      13292503
KP1005           IF PV-PRC-CHG-DATE > PV-STAT-CHG-DATE                  13292603
KP1005              MOVE 'RED   '      TO ASC-TICKET-COLOR              13292703
KP1005           ELSE                                                   13292803
KP1005              MOVE 'YELLOW'      TO ASC-TICKET-COLOR              13292903
KP1005           END-IF                                                 13293003
KP1005        END-IF                                                    13293103
           ELSE                                                         13293203
              MOVE 'WHITE '         TO ASC-TICKET-COLOR                 13293303
           END-IF.                                                      13293403
                                                                        13293503
      ******************************************************************13293603
      ** FORMAT DATES.                                                **13293703
      ******************************************************************13293803
       3970-FORMAT-CHGD-DATES.                                          13293903
                                                                        13294003
           IF PV-DATE-YY > 80                                           13294103
               MOVE 19             TO PV-DATE-CC-FMT                    13294203
                                      PV-DATE-CC-C                      13294303
           ELSE                                                         13294403
               MOVE 20             TO PV-DATE-CC-FMT                    13294503
                                      PV-DATE-CC-C                      13294603
           END-IF.                                                      13294703
                                                                        13294803
           MOVE PV-DATE-YY         TO PV-DATE-YY-FMT                    13294903
                                      PV-DATE-YY-C.                     13295003
           MOVE PV-DATE-MM         TO PV-DATE-MM-FMT                    13295103
                                      PV-DATE-MM-C.                     13295203
           MOVE PV-DATE-DD         TO PV-DATE-DD-FMT                    13295303
                                      PV-DATE-DD-C.                     13295403
                                                                        13295503
      ******************************************************************13295603
      ** FORMAT DATES. DB2 DATE TO MM/DD/CCYY                         **13295703
      ******************************************************************13295803
       3972-FORMAT-DB2-DATES.                                           13295903
                                                                        13296003
           MOVE PV-DATE-CC-FMT-DB2 TO PV-DATE-CC-FMT                    13296103
                                      PV-DATE-CC-C.                     13296203
           MOVE PV-DATE-YY-FMT-DB2 TO PV-DATE-YY-FMT                    13296300
                                      PV-DATE-YY-C.                     13296400
           MOVE PV-DATE-MM-FMT-DB2 TO PV-DATE-MM-FMT                    13296500
                                      PV-DATE-MM-C.                     13296600
           MOVE PV-DATE-DD-FMT-DB2 TO PV-DATE-DD-FMT                    13296700
                                      PV-DATE-DD-C.                     13296800
                                                                        13296900
      ******************************************************************13297000
      ** GET SIZE DESCRIPTION FOR COMMAREA AND SCREEN.                **13297100
      ******************************************************************13297200
       3975-GET-SIZE-DESC.                                              13297300
                                                                        13297400
           MOVE TSK-SIZE-CDE TO SIZE-NRF-SIZE-CDE.                      13297500
                                                                        13297600
           PERFORM 3977-GET-TSIZE-DESC.                                 13297700
                                                                        13297800
           EVALUATE SQLCODE                                             13297900
              WHEN ZERO                                                 13298000
                 SET ASC-SIZE-DESC-VALID TO TRUE                        13298100
                 MOVE SIZE-KOHLS-DESC      TO ASC-SIZE-DESC             13298200
              WHEN +100                                                 13298300
                 SET ASC-SIZE-DESC-VALID TO TRUE                        13298400
                 MOVE SPACES               TO ASC-SIZE-DESC             13298500
              WHEN OTHER                                                13298600
                 SET ASC-SIZE-DESC-INVALID TO TRUE                      13298700
           END-EVALUATE.                                                13298800
                                                                        13298900
      ******************************************************************13299000
      ** CALL TSIZE FOR SIZE CODE DESCRIPTION.                        **13299100
      ******************************************************************13299200
       3977-GET-TSIZE-DESC.                                             13299300
                                                                        13299400
           PERFORM                                                      13299500
               WITH TEST AFTER                                          13299600
               VARYING PV-RETRY-COUNTER                                 13299700
               FROM 1 BY 1                                              13299800
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13299900
                         OR (SQLCODE = ZERO)                            13300000
                         OR (SQLCODE = +100))                           13300100
               EXEC SQL                                                 13300200
                   SELECT KOHLS_DESC                                    13300300
                       INTO :SIZE-KOHLS-DESC                            13300400
                       FROM TSIZE                                       13300500
                       WHERE NRF_SIZE_CDE = :SIZE-NRF-SIZE-CDE AND      13300600
                             (EFF_END_DTE IS NULL               OR      13300700
                              EFF_END_DTE > CURRENT DATE)               13300800
               END-EXEC                                                 13300900
           END-PERFORM.                                                 13301000
                                                                        13303300
W30677******************************************************************13303427
W30677** 3978-GET-BRAND-NAME.                                         **13303527
W30677******************************************************************13303627
W30677 3978-GET-BRAND-NAME.                                             13303727
W30677     MOVE ASC-SKU-NUMBER TO PV-SKU-NBR.                           13303927
W30677     PERFORM                                                      13304027
W30677         WITH TEST AFTER                                          13304127
W30677         VARYING PV-RETRY-COUNTER                                 13304227
W30677         FROM 1 BY 1                                              13304327
W30677         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13304427
W30677                   OR (SQLCODE = ZERO)                            13304527
W30677                   OR (SQLCODE = +100))                           13304627
W30677         EXEC SQL                                                 13305527
W30677             SELECT D.CHARTC_VAL_DESC                             13306027
W30677             INTO   :VSCHVL-CHARTC-VAL-DESC                       13306527
W30677             FROM   TSKXREF A                                     13306627
W30677                   ,TUPC    B                                     13306727
W30677                   ,TMDARVS C                                     13306827
W30677                   ,TVSCHVL D                                     13306927
W30677             WHERE A.SKU         = :PV-SKU-NBR                    13307027
W30677               AND A.INTR_UPC_ID = B.INTR_UPC_ID                  13307127
W30677               AND B.UPC_TYP_CDE = 'I'                            13307227
W30677               AND B.VS_ID       = C.VS_ID                        13307327
W30677               AND C.LBL_SEQ_NBR = D.CHARTC_SEQ_NBR               13307427
W30677               AND D.CHARTC_CDE  = 3                              13307527
W30677         END-EXEC                                                 13307627
W30677     END-PERFORM.                                                 13307727
W30677                                                                  13307827
W30677     EVALUATE SQLCODE                                             13307927
W30677        WHEN ZERO                                                 13308027
W30677           SET ASC-BRAND-NAME-VALID TO TRUE                       13308127
W30677           MOVE VSCHVL-CHARTC-VAL-DESC TO ASC-BRAND-NAME          13308227
W30677        WHEN +100                                                 13308327
W30677           SET ASC-BRAND-NAME-VALID TO TRUE                       13308427
W30677           MOVE SPACES              TO ASC-BRAND-NAME             13308527
W30677        WHEN OTHER                                                13308627
W30677           SET ASC-BRAND-NAME-INVALID TO TRUE                     13309027
W30677     END-EVALUATE.                                                13309327
W30677                                                                  13309427
      ******************************************************************13309500
      ** GET VENDOR INFORMATION FOR COMMAREA AND SCREEN.              **13309600
      ******************************************************************13309700
       3980-GET-VENDOR-INFO.                                            13309800
                                                                        13309900
           MOVE TSK-ENT-ID TO XMT00000-ENT-ID.                          13310000
                                                                        13310100
           PERFORM 3983-GET-XMT-VND-INFO.                               13310200
                                                                        13310300
           EVALUATE SQLCODE                                             13310400
              WHEN ZERO                                                 13310500
                 SET ASC-VENDOR-INFO-VALID TO TRUE                      13310600
                 MOVE XMT00000-PRIM-VND-NM TO ASC-VENDOR-NAME           13310700
                 MOVE XMT00000-VND-NBR     TO ASC-VENDOR-NBR            13310800
              WHEN +100                                                 13310900
                 SET ASC-VENDOR-INFO-VALID TO TRUE                      13311000
                 MOVE SPACES               TO ASC-VENDOR-NAME           13311100
                                              ASC-VENDOR-NBR            13311200
              WHEN OTHER                                                13311300
                 SET ASC-VENDOR-INFO-INVALID TO TRUE                    13311400
           END-EVALUATE.                                                13311500
                                                                        13311600
      ******************************************************************13311700
      ** CALL XMT_VND FOR VENDOR NAME AND NUMBER.                     **13311800
      ******************************************************************13311900
       3983-GET-XMT-VND-INFO.                                           13312000
                                                                        13312100
           PERFORM                                                      13312200
               WITH TEST AFTER                                          13312300
               VARYING PV-RETRY-COUNTER                                 13312400
               FROM 1 BY 1                                              13312500
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13312600
                         OR (SQLCODE = ZERO)                            13312700
                         OR (SQLCODE = +100))                           13312800
               EXEC SQL                                                 13312900
                   SELECT PRIM_VND_NM                                   13313000
                         ,VND_NBR                                       13313100
                       INTO :XMT00000-PRIM-VND-NM                       13313200
                           ,:XMT00000-VND-NBR                           13313300
                       FROM XMT_VND                                     13313400
                       WHERE ENT_ID  = :XMT00000-ENT-ID                 13313500
               END-EXEC                                                 13313600
           END-PERFORM.                                                 13313700
                                                                        13313800
      ******************************************************************13313900
      ** GET QUANTITY ON ORDER FOR COMMAREA AND SCREEN.               **13314000
      ******************************************************************13314100
       3985-GET-ON-ORDER.                                               13314200
                                                                        13314300
           INITIALIZE DCLTSKSTOO                                        13314400
                      PV-NULL-IND.                                      13314500
                                                                        13314600
           MOVE ASC-ITEM-NBR     TO SKSTOO-ITM-NBR.                     13314700
                                                                        13314800
           IF ASC-STORE-NUMBER-X = PC-CORP-LOCATION                     13314900
              PERFORM 3987-SUM-TSKSTOO-INFO-CORP                        13315000
           ELSE                                                         13315100
              MOVE ASC-STORE-NUMBER TO SKSTOO-STR-NBR                   13315200
              PERFORM 3988-SUM-TSKSTOO-INFO                             13315300
           END-IF.                                                      13315400
                                                                        13315500
           EVALUATE SQLCODE                                             13315600
              WHEN ZERO                                                 13315700
                 SET ASC-ON-ORDER-VALID TO TRUE                         13315800
                 IF PV-NULL-IND = -1                                    13315900
                    MOVE ZERO              TO SKSTOO-ONORD-UNT-QTY      13316000
                 END-IF                                                 13316100
                 MOVE SKSTOO-ONORD-UNT-QTY TO ASC-OO-QTY                13316200
              WHEN +100                                                 13316300
                 SET ASC-ON-ORDER-VALID TO TRUE                         13316400
                 MOVE SKSTOO-ONORD-UNT-QTY TO ASC-OO-QTY                13316500
              WHEN OTHER                                                13316600
                 SET ASC-ON-ORDER-INVALID TO TRUE                       13316700
           END-EVALUATE.                                                13316800
                                                                        13316900
      ******************************************************************13317000
      ** SUM ON ORDER QUANTITY FOR COMMAREA AND SCREEN.               **13317100
      ** FOR THE TOTAL CORP - STORE 0.                                **13317200
      ******************************************************************13317300
       3987-SUM-TSKSTOO-INFO-CORP.                                      13317400
                                                                        13317500
           PERFORM                                                      13317600
               WITH TEST AFTER                                          13317700
               VARYING PV-RETRY-COUNTER                                 13317800
               FROM 1 BY 1                                              13317900
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13318000
                         OR (SQLCODE = ZERO)                            13318100
                         OR (SQLCODE = +100))                           13318200
               EXEC SQL                                                 13318300
                    SELECT SUM(ONORD_UNT_QTY)                           13318400
                      INTO :SKSTOO-ONORD-UNT-QTY:PV-NULL-IND            13318500
                      FROM TSKSTOO                                      13318600
                     WHERE ITM_NBR = :SKSTOO-ITM-NBR                    13318700
               END-EXEC                                                 13318800
           END-PERFORM.                                                 13319000
                                                                        13319400
      ******************************************************************13319500
      ** SUM ON ORDER QUANTITY FOR COMMAREA AND SCREEN.               **13319600
      ******************************************************************13319700
       3988-SUM-TSKSTOO-INFO.                                           13319800
                                                                        13319900
           PERFORM                                                      13320000
               WITH TEST AFTER                                          13320100
               VARYING PV-RETRY-COUNTER                                 13320200
               FROM 1 BY 1                                              13320300
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13320400
                         OR (SQLCODE = ZERO)                            13320500
                         OR (SQLCODE = +100))                           13320600
               EXEC SQL                                                 13320700
                    SELECT SUM(ONORD_UNT_QTY)                           13320800
                      INTO :SKSTOO-ONORD-UNT-QTY:PV-NULL-IND            13320900
                      FROM TSKSTOO                                      13321000
                     WHERE ITM_NBR = :SKSTOO-ITM-NBR                    13321100
                       AND STR_NBR = :SKSTOO-STR-NBR                    13321200
               END-EXEC                                                 13321300
           END-PERFORM.                                                 13321400
                                                                        13321500
      ******************************************************************13321600
      ** GET XL INTRANSIT AND STR EXPECTED QTY FOR COMMAREA AND SCREEN.*13321700
      ******************************************************************13321800
       3990-GET-INTRAN-STR-OH.                                          13321900
                                                                        13322000
           INITIALIZE XL074-ITEM-COMMAREA.                              13322100
                                                                        13322200
           SET XL074-BY-SKU               TO TRUE.                      13322300
           MOVE ASC-SKU-NUMBER            TO XL074-KEY-SKU.             13322400
                                                                        13322500
           IF ASC-STORE-NUMBER-X = PC-CORP-LOCATION                     13322600
              SET XL074-BY-ALL-LOCATIONS  TO TRUE                       13322700
           ELSE                                                         13322800
              SET XL074-BY-STORE          TO TRUE                       13322900
           END-IF.                                                      13323000
           MOVE ASC-STORE-NUMBER          TO PV-LOC-NBR.                13323100
           MOVE PV-LOC-NBR                TO XL074-KEY-LOC-NBR.         13323200
                                                                        13323300
           CALL XL074-ONLINE-PGM                                        13323400
               USING DFHEIBLK                                           13323500
                     XL074-COMMAREA                                     13323600
                     XL074-ITEM-COMMAREA.                               13323700
                                                                        13323800
           EVALUATE XL074-RETURN-CODE                                   13323900
              WHEN '00'                                                 13324000
      *----------> SUCCESSFUL                                           13324100
                 SET ASC-STORE-OH-VALID      TO TRUE                    13324200
                 MOVE XL074-IT-QTY           TO ASC-INTRAN-QTY          13324300
W30677           MOVE XL074-SE-QTY           TO ASC-STORE-EXPECTED-QTY  13324427
                 IF ASC-SKU-STORE-VALID                                 13324611
                    COMPUTE ASC-STORE-OH-QTY =                          13324711
                        ASC-OH-QTY - XL074-SE-QTY                       13324811
                 END-IF                                                 13324911
              WHEN OTHER                                                13325011
      *----------> SOME TYPE OF ERROR                                   13325111
      *----------> ONLY ACCEPT +100 ERROR (NOT FOUND)                   13325211
                 IF XL074-SQLCODE = +100                                13325311
                    SET ASC-STORE-OH-VALID   TO TRUE                    13325411
                    MOVE +0                  TO ASC-INTRAN-QTY          13325511
                                                ASC-STORE-OH-QTY        13325611
W30677                                          ASC-STORE-EXPECTED-QTY  13325727
                 ELSE                                                   13325811
                    SET ASC-STORE-OH-INVALID TO TRUE                    13325911
                 END-IF                                                 13326011
           END-EVALUATE.                                                13326500
                                                                        13326600
      ******************************************************************13326700
      *  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *13326800
      ******************************************************************13326900
       4000-BUILD-INITIAL-PANEL.                                        13327000
           SET DP030-SET-CURSOR-APPL-1   TO TRUE                        13327100
           MOVE -1                       TO SKUL.                       13328000
                                                                        13330000
           MOVE MH000-SKU-NUMBER-X       TO ASC-SKU-NUMBER-X.           13340000
                                                                        13350000
      * STORE NUMBER WILL DEFAULT TO 0 (CORP LOCATION) IF NOTHING       13360000
      * IS RECEIVED IN THE STORE NUMBER FIELD.                          13370000
           IF MH000-STORE-NUMBER-X > SPACES                             13380000
             AND MH000-STORE-NUMBER-9 > 0                               13390000
              MOVE MH000-STORE-NUMBER-X  TO ASC-STORE-NUMBER-X          13400000
           ELSE                                                         13410000
              MOVE PC-CORP-LOCATION      TO ASC-STORE-NUMBER-X          13420000
           END-IF.                                                      13430000
                                                                        13440000
      ******************************************************************13450000
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *13460000
      ******************************************************************13470000
       4400-MOVE-COMMAREA-TO-SCREEN.                                    13480000
                                                                        13491000
           MOVE ASC-DEPT-NUMBER-X        TO DEPTO.                      13500000
           MOVE ASC-MCL-NUMBER-X         TO MCLO.                       13510000
           MOVE ASC-SCL-NUMBER-X         TO SCLO.                       13520000
           MOVE ASC-SKU-NUMBER-X         TO SKUO.                       13530000
           MOVE ASC-STORE-NUMBER-X       TO STOREO.                     13540000
           MOVE ASC-STORE-DESC           TO STDESCO.                    13550000
           MOVE ASC-SKU-DESC             TO SKUDSCO.                    13560000
           MOVE ASC-SIZE-CDE             TO SIZECDO.                    13580000
           MOVE ASC-RECLASS-DEPT         TO RCLDPLO.                    13580136
           MOVE ASC-RECLASS-SCL          TO RCLSCLO.                    13580235
      * IF SKU WAS NOT RECLASSED, MAKE RECLASS DEPT AND SCL INVISIBLE   13580336
           IF ASC-RECLASS-DEPT > SPACES                                 13580438
               MOVE DP015-ASK-NOR-OFF    TO RCLDPTA                     13580538
                                            RCLSCTA                     13580638
           ELSE                                                         13580936
               MOVE DP015-ASK-DRK-OFF    TO RCLDPTA                     13581038
                                            RCLSCTA                     13581138
           END-IF.                                                      13582036
           MOVE ASC-COLOR-DESC           TO COLORO.                     13590000
           MOVE ASC-COLOR-CDE            TO COLRCDO.                    13600000
           MOVE ASC-STATUS               TO STATUSO.                    13650000
           MOVE ASC-STATUS-DESC          TO STADSCO.                    13660000
           MOVE ASC-TICKET-COLOR         TO TKTCLRO.                    13680000
           MOVE ASC-STAT-CHGD-DTE        TO STCHDTO.                    13680100
           MOVE ASC-PRC-CHGD-DTE         TO PRCDTEO.                    13680200
                                                                        13680300
           EVALUATE ASC-TICKET-COLOR                                    13681000
               WHEN 'WHITE '                                            13681100
                   MOVE DP015-WHITE      TO TKTCLRC                     13682000
                                            STCHDTC                     13682100
                                            PRCDTEC                     13682200
               WHEN 'YELLOW'                                            13683000
                   MOVE DP015-YELLOW     TO TKTCLRC                     13684000
                                            STCHDTC                     13684100
                                            PRCDTEC                     13684200
               WHEN 'RED   '                                            13685000
                   MOVE DP015-RED        TO TKTCLRC                     13686000
                                            STCHDTC                     13686100
                                            PRCDTEC                     13686200
           END-EVALUATE.                                                13687000
                                                                        13688000
           MOVE ASC-VENDOR-STYLE         TO VNDSTYO.                    13690000
                                                                        13710100
           IF ASC-SKU-RCP                                               13710200
            AND ASC-STORE-NUMBER-X = PC-CORP-LOCATION                   13710300
             MOVE PV-CURRTL-FMT-MIXED    TO CURRTLO                     13710400
           ELSE                                                         13710500
              MOVE ASC-CURR-RTL          TO PV-CURRTL-FMT               13720000
              MOVE PV-CURRTL-FMT         TO CURRTLO                     13720100
           END-IF.                                                      13720200
                                                                        13720300
           MOVE ASC-SET-UP-DTE           TO SETDTEO.                    13730000
           MOVE ASC-GROUP-CDE            TO GRPCDEO.                    13740000
           MOVE ASC-GROUP-RTL            TO GRPRTLO.                    13750000
           MOVE ASC-STICKER-NBR          TO STKNBRO.                    13770000
                                                                        13771000
           MOVE ASC-ORIG-RTL             TO PV-ORGRTL-FMT.              13780000
           MOVE PV-ORGRTL-FMT            TO ORGRTLO.                    13780100
                                                                        13780200
           MOVE ASC-CURR-COST            TO PV-CURCST-FMT.              13790100
           MOVE PV-CURCST-FMT            TO CURCSTO.                    13790200
                                                                        13790300
           MOVE ASC-FIRST-COST           TO PV-FIRCST-FMT.              13800000
           MOVE PV-FIRCST-FMT            TO FIRCSTO.                    13800100
                                                                        13800200
           MOVE ASC-INNER-PK-QTY         TO PV-INPQTY-FMT.              13802000
           MOVE PV-INPQTY-FMT            TO INPQTYO.                    13802100
                                                                        13802200
           MOVE ASC-OUTER-PK-QTY         TO PV-OTPQTY-FMT.              13802300
           MOVE PV-OTPQTY-FMT            TO OTPQTYO.                    13802400
                                                                        13802500
   ****PLEASE NOTE THAT STORE ON-HAND IS ON-HAND QTY - STORE EXPECTED   13802600
   ****CANNOT COMPUTE STORE ON-HAND IF SKU-STORE ON-HAND WAS INVALID    13802700
           IF ASC-SKU-STORE-INVALID                                     13803000
              MOVE '********'            TO ONHANDO                     13804000
              MOVE '**********'          TO FIRSALO                     13804100
              MOVE '**********'          TO FIRRCTO                     13804200
              MOVE '**********'          TO LSTSALO                     13804300
              MOVE '**********'          TO LSTRCTO                     13804400
              MOVE '********'            TO STROHO                      13804500
W30677        MOVE '********'            TO STREPTO                     13804627
           ELSE                                                         13805000
              MOVE ASC-OH-QTY            TO PV-ONHAND-FMT               13806000
              MOVE PV-ONHAND-FMT         TO ONHANDO                     13807000
              MOVE ASC-FIRST-SALE-DTE    TO FIRSALO                     13807100
              MOVE ASC-FIRST-RCPT-DTE    TO FIRRCTO                     13807200
              MOVE ASC-LAST-SALE-DTE     TO LSTSALO                     13807300
              MOVE ASC-LAST-RCPT-DTE     TO LSTRCTO                     13807400
              IF ASC-STORE-OH-INVALID                                   13807500
                 MOVE '********'         TO STROHO                      13807600
W30677           MOVE '********'         TO STREPTO                     13807727
              ELSE                                                      13807800
W30677           MOVE ASC-STORE-OH-QTY       TO PV-STROH-FMT            13807927
W30677           MOVE PV-STROH-FMT           TO STROHO                  13808027
W30677           MOVE ASC-STORE-EXPECTED-QTY TO PV-STREPT-FMT           13808127
W30677           MOVE PV-STREPT-FMT          TO STREPTO                 13808227
              END-IF                                                    13808311
           END-IF.                                                      13808411
                                                                        13809000
           IF ASC-SIZE-DESC-INVALID                                     13809100
              MOVE '*****'               TO SIZEO                       13809200
           ELSE                                                         13809300
              MOVE ASC-SIZE-DESC         TO SIZEO                       13810000
           END-IF.                                                      13820000
                                                                        13840100
W30677     IF ASC-BRAND-NAME-INVALID                                    13840227
W30677        MOVE '********************' TO BNDNMEO                    13840327
W30677     ELSE                                                         13840827
W30677        MOVE ASC-BRAND-NAME         TO BNDNMEO                    13841127
W30677     END-IF.                                                      13842027
W30677                                                                  13861027
           IF ASC-VENDOR-INFO-INVALID                                   13861118
              MOVE '******************************'                     13861218
                                         TO VNDNMEO                     13861318
              MOVE '*********'           TO VNDNBRO                     13861418
           ELSE                                                         13861518
              MOVE ASC-VENDOR-NAME       TO VNDNMEO                     13861618
              MOVE ASC-VENDOR-NBR        TO VNDNBRO                     13861718
           END-IF.                                                      13861818
                                                                        13861918
           IF ASC-ON-ORDER-INVALID                                      13862018
              MOVE '********'            TO ONORDRO                     13862118
           ELSE                                                         13862218
              MOVE ASC-OO-QTY            TO PV-ONORDR-FMT               13862318
              MOVE PV-ONORDR-FMT         TO ONORDRO                     13862418
           END-IF.                                                      13862518
                                                                        13862618
           IF ASC-STORE-OH-INVALID                                      13862718
              MOVE '********'            TO INTQTYO                     13862818
           ELSE                                                         13862918
              MOVE ASC-INTRAN-QTY        TO PV-INTQTY-FMT               13863018
              MOVE PV-INTQTY-FMT         TO INTQTYO                     13863118
           END-IF.                                                      13864018
                                                                        13865000
       EJECT                                                            13870000
                                                                        13880000
      ******************************************************************13890000
      *    READ THE TEMP STORAGE QUEUE FOR SELECTED INFORMATION.       *13900000
      ******************************************************************13910000
       9000-READ-TS-QUEUE.                                              13920000
           MOVE '*9000-READ-TS-QUEUE.             *' TO DP013-PARAGRAPH 13930000
                                                                        13940000
           IF DP020-NEXT-ACT-INITIAL                                    13950000
               MOVE +1 TO MH000-TS-ITEM-NUMBER                          13960000
                          MH000-MH001-IDX.                              13970000
                                                                        13980000
           EXEC CICS                                                    13990000
                READQ TS                                                14000000
                    QUEUE (MH000-SEL-QUEUE-NAME)                        14010000
                    INTO  (MH001-TS-SEL-REC)                            14020000
                    ITEM  (MH000-TS-ITEM-NUMBER)                        14030000
                    RESP  (PV-CICS-RESPONSE)                            14040000
           END-EXEC.                                                    14050000
      *                                                                 14060000
           IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      14070000
               MOVE MH001-TS-SEL-REC     TO  ASC-MH001-AREA             14080000
           ELSE                                                         14090000
               IF PV-CICS-RESPONSE = DFHRESP (ITEMERR)                  14100000
                   MOVE PC-TSYMSG-00113  TO  DP020-MSG-NUMBER           14111000
                   SET PS-ERROR          TO  TRUE                       14120000
                   SET DP020-MSG-WARNING TO  TRUE                       14130000
                   SET DP030-SET-CURSOR-TRAILER TO TRUE                 14140000
               ELSE                                                     14150000
                  IF PV-CICS-RESPONSE = DFHRESP (QIDERR)                14160000
                     SET DP013-CICS-ABEND      TO  TRUE                 14170000
                     SET DP013-NO-ROLLBACK     TO  TRUE                 14180000
                     MOVE '9000-READ-TS-QIDERR'                         14190000
                                               TO  DP013-PARAGRAPH      14200000
                     MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'     14210000
                                               TO  DP013-MESSAGE-TEXT(1)14220000
                     MOVE '- QIDERR CONDITION (QUEUE DOESNT EXIST) '    14230000
                                               TO  DP013-MESSAGE-TEXT(2)14240000
                     PERFORM DP013-0000-PROCESS-ABEND                   14250000
                  ELSE                                                  14260000
                     SET DP013-CICS-ABEND      TO  TRUE                 14270000
                     SET DP013-NO-ROLLBACK     TO  TRUE                 14280000
                     MOVE '9000-READ-TS-QUEUE' TO  DP013-PARAGRAPH      14290000
                     MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'     14300000
                                               TO  DP013-MESSAGE-TEXT(1)14310000
                     PERFORM DP013-0000-PROCESS-ABEND                   14320000
                  END-IF                                                14330000
               END-IF                                                   14340000
           END-IF.                                                      14350000
                                                                        14360000
      ******************************************************************14370000
      *    UPDATE THE TEMP STORAGE QUEUE.                              *14380000
      ******************************************************************14390000
       9100-REWRITE-TS-QUEUE.                                           14400000
           MOVE '*9100-REWRITE-TS-QUEUE.          *' TO DP013-PARAGRAPH 14410000
                                                                        14420000
           EXEC CICS                                                    14430000
                WRITEQ TS                                               14440000
                    QUEUE (MH000-SEL-QUEUE-NAME)                        14450000
                    FROM  (MH001-TS-SEL-REC)                            14460000
                    ITEM  (MH000-TS-ITEM-NUMBER)                        14470000
                    RESP  (PV-CICS-RESPONSE)                            14480000
                    REWRITE                                             14490000
           END-EXEC.                                                    14500000
                                                                        14510000
           IF  PV-CICS-RESPONSE NOT = DFHRESP (NORMAL)                  14520000
               SET DP013-CICS-ABEND      TO  TRUE                       14530000
               SET DP013-NO-ROLLBACK     TO  TRUE                       14540000
               MOVE '9100-REWRITE-TS-QUEUE' TO  DP013-PARAGRAPH         14550000
               MOVE 'ATTEMPTING TO REWRITE SELECTED ITEMS QUEUE'        14560000
                                         TO  DP013-MESSAGE-TEXT(1)      14570000
               MOVE 'TO SIGNIFY THAT THE SKU HAS BEEN VIEWED   '        14580000
                                         TO  DP013-MESSAGE-TEXT(2)      14590000
               PERFORM DP013-0000-PROCESS-ABEND                         14600000
           END-IF.                                                      14610000
                                                                        14620000
      ******************************************************************14630000
      *    ABEND PROCESSOR MODULE                                      *14640000
      ******************************************************************14650000
           COPY DPPD013.                                                14660000
