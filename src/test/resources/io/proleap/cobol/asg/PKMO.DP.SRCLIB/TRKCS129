000100*-----------------------*                                         00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300*-----------------------*                                         00030003
000400 PROGRAM-ID.    TRKCS129.                                         00040003
000500 AUTHOR.        MICHAEL WALTERS                                   00050003
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060003
000700 DATE-WRITTEN.  04-26-95.                                         00070003
000800 DATE-COMPILED.                                                   00080003
000900*----------------------------------------------------------------*00090003
001000*    Y129 - FORECAST PO UPDATE                                   *00100003
001100*                                                                *00110003
001200*    THIS PROGRAM ALLOWS THE USER TO UPDATE A FORCAST PO.        *00120003
001300*----------------------------------------------------------------*00130003
001400* CHANGED 10-30-2014 CHERI PARMLEY           CHG0094517           00131008
001500*         EXPANDED PO# FROM 7 TO 8 DIGITS                         00132008
001600*----------------------------------------------------------------*00133008
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697         00135010
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00136010
263697* MAKING THE CALL DYNAMIC VS STATIC.                              00137010
263697*---------------------------------------------------------------* 00138010
CICS  * CHANGED 11/21/2022    BY JIM HUNTER      WR: CHG0278495         00139011
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00139111
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00139211
CICS  *-----------------------------------------------------------------00139311
001400                                                                  00140003
001500 ENVIRONMENT DIVISION.                                            00150003
001600                                                                  00160003
001700 DATA DIVISION.                                                   00170003
001800                                                                  00180003
001900                                                                  00190003
002000 WORKING-STORAGE SECTION.                                         00200003
002100                                                                  00210003
002200 01  DK-DB2-KEYS.                                                 00220003
002300     05  DK-PO-NBR                      PIC S9(09)  COMP.         00230003
002400     05  DK-SHIPT-ID                    PIC S9(09)  COMP.         00240003
002500     05  DK-EXPTED-CART-CNT             PIC S9(04)  COMP.         00250003
002600*                                                                 00260003
002700 01  DN-NULL-INDICATORS.                                          00270003
002800     05  DN-TRIP-ID                   PIC S9(4) COMP VALUE +0.    00280003
002900     05  DN-SHIP-EST-AR-TMST          PIC S9(4) COMP VALUE +0.    00290003
003000*                                                                 00300003
003100 01  PC-PROGRAM-CONSTANTS.                                        00310003
003200     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TR129A  '.  00320003
003300     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TRKM129 '.  00330003
003400     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TRKCS129'.  00340003
003500     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00350003
003600                                              COMP.               00360003
003700     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE  +3           00370003
003800                                              COMP.               00380003
003900     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE +1            00390003
004000                                              COMP.               00400003
004100     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00410003
004200     05  PC-LIST-FORMAT           PIC  X(01)  VALUE '1'.          00420003
004210     05  PC-U                     PIC  X(01)  VALUE 'U'.          00430005
004300     05  PC-ACTIVE                PIC  X(01)  VALUE 'A'.          00440003
004400     05  PC-PO-ACTIVE             PIC  X(02)  VALUE 'AC'.         00450003
004500     05  PC-APPROVED              PIC X(02)   VALUE 'AP'.         00460003
004600     05  PC-CANCELLED             PIC X(02)   VALUE 'CA'.         00470003
004700     05  PC-CANBALENCE            PIC X(02)   VALUE 'CB'.         00480003
004800     05  PC-COMPLETE              PIC X(02)   VALUE 'CM'.         00490003
004900     05  PC-DEFAULT-DATE          PIC X(10)   VALUE               00500003
005000                                  '0001-01-01'.                   00510003
005100     05  PC-DEFAULT-TIME          PIC X(08)   VALUE               00520003
005200                                  '00.00.00'.                     00530003
005300     05  PC-TSYMSG-NUMBERS.                                       00540003
005400         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00550003
005500         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00560003
005600         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00570003
005700         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       00580003
005800         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00590003
005900         10  PC-TSYMSG-00068      PIC  9(05)  VALUE  00068.       00600003
006000         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00610003
006100         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00620003
006200         10  PC-TSYMSG-00083      PIC  9(05)  VALUE  00083.       00630003
006300         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00640003
006400         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.       00650003
006500         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00660003
006600         10  PC-TSYMSG-00223      PIC  9(05)  VALUE  00223.       00670003
006700         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.       00680003
006800         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00690003
006900*                                                                 00700003
007000 01  PS-PROGRAM-SWITCHES.                                         00710003
007100     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00720003
007200         88  PS-ERROR                         VALUE  'Y'.         00730003
007300         88  PS-NO-ERROR                      VALUE  'N'.         00740003
007400     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         00750003
007500         88  PS-COMMAREA-VALID                VALUE  'Y'.         00760003
007600         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         00770003
007700     05  PS-FOUND-SW              PIC  X(01)  VALUE ' '.          00780003
007800         88  PS-FOUND                         VALUE 'Y'.          00790003
007900         88  PS-NOT-FOUND                     VALUE 'N'.          00800003
008000     05  PS-DPT-NOT-FOUND-SW      PIC  X(01)  VALUE 'N'.          00810003
008100         88  PS-DPT-NOT-FOUND                 VALUE 'Y'.          00820003
008200         88  PS-DPT-FOUND                     VALUE 'N'.          00830003
008300     05  PS-NO-DISTRO-SW          PIC  X(01)  VALUE 'N'.          00840003
008400         88  PS-DISTRO                        VALUE 'Y'.          00850003
008500         88  PS-NO-DISTRO                     VALUE 'N'.          00860003
008600     05  PS-DISPLAY-DISTRO-SW     PIC  X(01)  VALUE 'N'.          00870003
008700         88  PS-DISPLAY-DISTRO-MSG            VALUE 'Y'.          00880003
008800         88  PS-DONT-DISPLAY-DISTRO-MSG       VALUE 'N'.          00890003
008900     05  PS-DONE-SW               PIC  X(01)  VALUE 'N'.          00900003
009000         88  PS-DONE                          VALUE 'Y'.          00910003
009100         88  PS-NOT-DONE                      VALUE 'N'.          00920003
009200     05  PS-LIST-SW               PIC  X(01)  VALUE 'N'.          00930003
009300         88  PS-LIST-END                      VALUE 'Y'.          00940003
009400         88  PS-NO-LIST-END                   VALUE 'N'.          00950003
009500     05  PS-SHIPMENT-EXIST-SW     PIC  X(01)  VALUE 'N'.          00960003
009600         88  PS-SHIPMENT-EXIST                VALUE 'Y'.          00970003
009700         88  PS-SHIPMENT-DOESNT-EXIST         VALUE 'N'.          00980003
009800*                                                                 00990003
009900 01  PV-PROGRAM-VARIABLES.                                        01000003
010000     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01010003
010100                                              COMP SYNC.          01020003
010200     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01030003
010300                                              COMP SYNC.          01040003
010400     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0            01050003
010500                                              COMP SYNC.          01060003
010600     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            01070003
010700                                              COMP SYNC.          01080003
010800     05  PV-OPER-UNT-ID           PIC S9(4)   VALUE +0            01090003
010900                                              COMP.               01100003
011000     05  PV-W-FIRST-NAME.                                         01110003
011100         10  PV-WORKER-FIR-NAME   PIC X(10).                      01120003
011200         10  FILLER               PIC X(02).                      01130003
011300     05  PV-W-LAST-NAME.                                          01140003
011400         10  PV-WORKER-LAST-NAME  PIC X(10).                      01150003
011500         10  FILLER               PIC X(08).                      01160003
011600     05  PV-WORKER-NAME.                                          01170003
011700         10  PV-WORKER-FIRST      PIC X(10).                      01180003
011800         10  PV-WORKER-LAST       PIC X(10).                      01190003
011900     05  PV-DATE                  PIC X(10).                      01200003
012000     05  PV-TEMP-DATE.                                            01210003
012100         10  PV-DATE-CCYY         PIC X(04).                      01220003
012200         10  FILLER               PIC X(01).                      01230003
012300         10  PV-DATE-MM           PIC X(02).                      01240003
012400         10  FILLER               PIC X(01).                      01250003
012500         10  PV-DATE-DD           PIC X(02).                      01260003
012600     05  PV-WORK-DATE.                                            01270003
012700         10  PV-WK-DTE-MM         PIC X(02).                      01280003
012800         10  FILLER               PIC X(01) VALUE '/'.            01290003
012900         10  PV-WK-DTE-DD         PIC X(02).                      01300003
013000         10  FILLER               PIC X(01) VALUE '/'.            01310003
013100         10  PV-WK-DTE-CCYY       PIC X(04).                      01320003
013200     05  PV-WORK-DATE2.                                           01330003
013300         10  PV-WK2-DTE-MM        PIC X(02).                      01340003
013400         10  PV-WK2-DTE-DD        PIC X(02).                      01350003
013500         10  PV-WK2-DTE-YY        PIC X(04).                      01360003
013600     05  PV-TEMP-YYMM.                                            01370003
013700         10  PV-TEMP-YY           PIC X(02).                      01380003
013800         10  PV-TEMP-MM           PIC X(02).                      01390003
013900                                                                  01400003
014000 EJECT                                                            01410003
014100*----------------------------------------------------------------*01420003
014200*    CALLING PARAMETERS FOR LOCKING MODULE DPKCS044              *01430003
014300*----------------------------------------------------------------*01440003
014400                                                                  01450003
014500     COPY DPWS044.                                                01460003
014600 EJECT                                                            01470003
014700*----------------------------------------------------------------*01480003
014800*    MAP LAYOUT                                                  *01490003
014900*----------------------------------------------------------------*01500003
015000                                                                  01510003
015100     COPY TRKM129.                                                01520003
015200                                                                  01530003
015300                                                                  01540003
015400     EJECT                                                        01550003
015500*----------------------------------------------------------------*01560003
015600*    ATTRIBUTE SETTINGS COPYBOOK.                                *01570003
015700*----------------------------------------------------------------*01580003
015800                                                                  01590003
015900     COPY DPWS015.                                                01600003
016000                                                                  01610003
016100*----------------------------------------------------------------*01620003
016200*    FUNCTION KEYS COPYBOOK                                      *01630003
016300*----------------------------------------------------------------*01640003
016400                                                                  01650003
016500     COPY DPWS016.                                                01660003
016600******************************************************************01670003
016700** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01680003
016800** SUB-ROUTINE (DPKUT100).                                      **01690003
016900******************************************************************01700003
017000     COPY DPWS010I.                                               01710003
017100 EJECT                                                            01720003
017200***************************************************************** 01730003
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.            01740011
017400***************************************************************** 01750003
017500     COPY DPWS030.                                                01760003
CICS       COPY DPWS930.                                                01761011
017600 EJECT                                                            01770003
017700***************************************************************** 01780003
017800*    STANDARD COMMAREA.                                           01790003
017900***************************************************************** 01800003
018000                                                                  01810003
018100     COPY DPWS020.                                                01820003
018200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01830003
018300                                                                  01840003
018400***************************************************************** 01850003
018500*    INTER-APPLICATION COMMAREA.                                  01860003
018600***************************************************************** 01870003
018700                                                                  01880003
018800         10  INTER-APPL-COMM-AREA PIC X(200).                     01890003
018900*---------------------------------------------------------------* 01900003
019000*   TRWS017 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED TO THIS  * 01910003
019100*             PROGRAM FROM THE LIST PROGRAM.                    * 01920003
019200*---------------------------------------------------------------* 01930003
019300     COPY TRWS017.                                                01940003
019400     COPY TRWS001.                                                01950003
019500***************************************************************** 01960003
019600*    SPECIFIC COMMMAREA FOR TRKCS129.                             01970003
019700***************************************************************** 01980003
019800         10  ASC-SPECIFIC-COMMAREA.                               01990003
019900             15  ASC-ADD-COMPLETE-SW         PIC  X(01).          02000003
020000                 88  ASC-ADD-COMPLETE           VALUE 'Y'.        02010003
020100                 88  ASC-ADD-PENDING            VALUE 'N'.        02020003
020200             15  ASC-KEY-FIELDS.                                  02030003
      *CLP 10/30/14                                                     02031008
020300                 20  ASC-KEY-PO-NBR          PIC  9(08).          02040008
020400                 20  ASC-KEY-OPER-UNT-ID     PIC  9(04).          02050003
020500                 20  ASC-KEY-FCLTY-ID        PIC  9(04).          02060003
020600                 20  ASC-KEY-FCLTY-NME       PIC  X(25).          02070003
020700                 20  ASC-KEY-SHIPT-ID        PIC S9(09) COMP-3.   02080003
020800             15  ASC-SCREEN-FIELDS.                               02090003
020900                 20  ASC-PRO-NBR             PIC  X(22).          02100003
021000                 20  ASC-BOL-NBR             PIC  X(30).          02110003
021100                 20  ASC-PACKSLIP-IND        PIC  X(01).          02120003
021200                 20  ASC-EXPTED-CART-CNT     PIC  X(05).          02130003
021300                 20  ASC-EXPTED-CART-CNT-N   REDEFINES            02140003
021400                     ASC-EXPTED-CART-CNT     PIC  9(05).          02150003
021500                 20  ASC-REC-SEQ-NBR         PIC  9(03).          02160003
021600                 20  ASC-DEPT-NBR            PIC  X(04).          02170006
021601                 20  ASC-DEPT-NBR-N REDEFINES                     02171006
021602                     ASC-DEPT-NBR            PIC  9(04).          02172006
021700                 20  ASC-ENT-ID              PIC S9(09) COMP-3.   02180003
021800                 20  ASC-BUYER-NME           PIC  X(25).          02190003
021900                 20  ASC-VENDOR-NME          PIC  X(25).          02200003
022000                 20  ASC-NO-DISTRO-MSG       PIC  X(09).          02210003
022100                 20  ASC-PO-STATUS           PIC  X(02).          02220003
022200                 20  ASC-PO-STATUS-DESC      PIC  X(10).          02230003
022300                 20  ASC-DONT-SHIP-BEF-DTE   PIC  X(10).          02240003
022400                 20  ASC-CANCEL-DTE          PIC  X(10).          02250003
022500                 20  ASC-EXT-CAN-DTE         PIC  X(10).          02260003
022600                 20  ASC-ASN-CART-CNT        PIC  9(06).          02270003
022700                 20  ASC-FOR-CART-CNT        PIC  9(06).          02280003
022800             15  ASC-USE-SELECTION-QUEUE-IND                      02290003
022900                                             PIC  X(01).          02300003
023000                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    02310003
023100             15  ASC-SEL-QUEUE-NAME          PIC  X(08).          02320003
023200             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05)  COMP-3.  02330003
023300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02340003
023400                                             PIC S9(09)  COMP-3.  02350003
023500             15  ASC-SEL-SUB                 PIC S9(04)  COMP.    02360003
023600             15  ASC-SEL-ITEM                PIC S9(04)  COMP.    02370003
023700                                                                  02380003
023800     EJECT                                                        02390003
023900/                                                                 02400003
024000*---------------------------------------------------------------* 02410003
024100*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02420003
024200*---------------------------------------------------------------* 02430003
024300     COPY TRWS018.                                                02440003
024400*----------------------------------------------------------------*02450003
024500*    ABEND PROCESSING COPYBOOK.                                  *02460003
024600*----------------------------------------------------------------*02470003
024700                                                                  02480003
024800     COPY DPWS013.                                                02490003
024900                                                                  02500003
025000*    DB2 AREA FOR TSHIPMT (SHIPMENT TABLE)                        02510003
025100                                                                  02520003
025200     EXEC SQL                                                     02530003
025300          INCLUDE TSHIPMT                                         02540003
025400     END-EXEC.                                                    02550003
025500                                                                  02560003
025600*    DB2 AREA FOR TSHIPST (SHIPMENT STATUS TABLE)                 02570003
025700                                                                  02580003
025800     EXEC SQL                                                     02590003
025900          INCLUDE TSHIPST                                         02600003
026000     END-EXEC.                                                    02610003
026100                                                                  02620003
026200*    DB2 AREA FOR TSHSTYP (SHIPMENT STATUS TYPE TABLE)            02630003
026300                                                                  02640003
026400     EXEC SQL                                                     02650003
026500          INCLUDE TSHSTYP                                         02660003
026600     END-EXEC.                                                    02670003
026700                                                                  02680003
026800*    DB2 AREA FOR TSHPTPO (SHIPMENT/PO ASSOCIATION TABLE)         02690003
026900                                                                  02700003
027000     EXEC SQL                                                     02710003
027100          INCLUDE TSHPTPO                                         02720003
027200     END-EXEC.                                                    02730003
027300                                                                  02740003
027400*    DB2 AREA FOR TPLNSHP (PLANNED SHIPMENT TABLE)                02750003
027500                                                                  02760003
027600     EXEC SQL                                                     02770003
027700          INCLUDE TPLNSHP                                         02780003
027800     END-EXEC.                                                    02790003
027900                                                                  02800003
028000*    DB2 AREA FOR TPURCHS (PO-PURCHASE TABLE)                     02810003
028100                                                                  02820003
028200     EXEC SQL                                                     02830003
028300          INCLUDE TPURCHS                                         02840003
028400     END-EXEC.                                                    02850003
028500                                                                  02860003
028600*    DB2 AREA FOR TAUSHPO (PO ASSOCIATE SHIP PO AUDIT TABLE)      02870003
028700                                                                  02880003
028800     EXEC SQL                                                     02890003
028900          INCLUDE TAUSHPO                                         02900003
029000     END-EXEC.                                                    02910003
029100                                                                  02920003
029200*    DB2 AREA FOR TAUSHIP (SHIPMENT AUDIT TABLE)                  02930003
029300                                                                  02940003
029400     EXEC SQL                                                     02950003
029500          INCLUDE TAUSHIP                                         02960003
029600     END-EXEC.                                                    02970003
029700                                                                  02980003
029800*    DB2 AREA FOR TSTATCD (PO STATUS CODE TABLE)                  02990003
029900                                                                  03000003
030000     EXEC SQL                                                     03010003
030100          INCLUDE TSTATCD                                         03020003
030200     END-EXEC.                                                    03030003
030300                                                                  03040003
030400*    DB2 AREA FOR TENTNME (EXTERNAL ENTERPRISE NAME TABLE)        03050003
030500                                                                  03060003
030600     EXEC SQL                                                     03070003
030700          INCLUDE TENTNME                                         03080003
030800     END-EXEC.                                                    03090003
030900                                                                  03100003
031000*    DB2 AREA FOR TPURITM (PO LINE TABLE)                         03110003
031100                                                                  03120003
031200     EXEC SQL                                                     03130003
031300          INCLUDE TPURITM                                         03140003
031400     END-EXEC.                                                    03150003
031500                                                                  03160003
031600*    DB2 AREA FOR TALLPLN (DC ALLOC SPLIT TABLE)                  03170003
031700                                                                  03180003
031800     EXEC SQL                                                     03190003
031900          INCLUDE TALLPLN                                         03200003
032000     END-EXEC.                                                    03210003
032100                                                                  03220003
032200*    DB2 AREA FOR TMESTDS (STORE ALLOC PLAN TABLE)                03230003
032300                                                                  03240003
032400     EXEC SQL                                                     03250003
032500          INCLUDE TMESTDS                                         03260003
032600     END-EXEC.                                                    03270003
032700                                                                  03280003
032800*    DB2 AREA FOR TMDSEAR (MERCHANDISE AREA TABLE)                03290003
032900                                                                  03300003
033000     EXEC SQL                                                     03310003
033100          INCLUDE TMDSEAR                                         03320003
033200     END-EXEC.                                                    03330003
033300                                                                  03340003
033400*    DB2 AREA FOR TRSPBAR (RESPONSIBILITY AREA TABLE)             03350003
033500                                                                  03360003
033600     EXEC SQL                                                     03370003
033700          INCLUDE TRSPBAR                                         03380003
033800     END-EXEC.                                                    03390003
033900                                                                  03400003
034000*    DB2 AREA FOR COMMUNICATIONS                                  03410003
034100                                                                  03420003
034200     EXEC SQL                                                     03430003
034300          INCLUDE SQLCA                                           03440003
034400     END-EXEC.                                                    03450003
034500                                                                  03460003
034600*    CURSOR USED TO DETERMINE IF THE 'NO DISTRO' MESSAGE SHOULD BE03470003
034700*    DISPLAYED.                                                   03480003
034800                                                                  03490003
034900     EXEC SQL                                                     03500003
035000          DECLARE PO_CSR CURSOR FOR                               03510003
035100            SELECT DISTINCT(B.PO_LNE_NBR)                         03520003
035200            FROM   TPURCHS A                                      03530003
035300                  ,TPURITM B                                      03540003
035400            WHERE  A.PO_NBR = B.PO_NBR                            03550003
035500            AND    A.PO_NBR = :DK-PO-NBR                          03560003
035600            AND    A.VER_STATUS_CDE = B.VER_STATUS_CDE            03570003
035700            AND    A.VER_STATUS_CDE = :PC-ACTIVE                  03580003
035800     END-EXEC.                                                    03590003
035900 EJECT                                                            03600003
036000 LINKAGE SECTION.                                                 03610003
036100                                                                  03620003
036200 01  DFHCOMMAREA.                                                 03630003
036300     05  FILLER                         OCCURS  1 TO 4072 TIMES   03640003
036400                                        DEPENDING ON EIBCALEN.    03650003
036500         10  FILLER                     PIC  X(01).               03660003
036600                                                                  03670003
036700                                                                  03680003
036800 PROCEDURE DIVISION.                                              03690003
036900***************************************************************** 03700003
037000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03710003
037100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03720003
037200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03730003
037300**                                                             ** 03740003
037400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03750003
037500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03760003
037600***************************************************************** 03770003
037700 0000-MAIN-MODULE.                                                03780003
037800     INITIALIZE DP030-CICS-API-FIELDS.                            03790003
037900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03800003
038000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03810003
038100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03820003
038200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03830003
038300     MOVE LENGTH OF TR129AI        TO DP030-MAP-LENGTH (1).       03840003
038400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03850003
038500     PERFORM 0001-CALL-CICS-ARCH-API.                             03860003
038600*                                                                 03870003
038700     PERFORM 1000-CONTROL-PROCESSING                              03880003
038800*                                                                 03890003
038900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03900003
039000     PERFORM 0001-CALL-CICS-ARCH-API.                             03910003
039100                                                                  03920003
039200 0001-CALL-CICS-ARCH-API.                                         03930003
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03940011
039400                                    DFHCOMMAREA                   03950011
039500                                    DP030-CICS-API-FIELDS         03960011
039600                                    DP020-STANDARD-COMMAREA       03970011
039700                                    TR129AI.                      03980011
039800*                                                                 03990003
039900     IF  DP030-RC-CALL-SUCCESSFUL                                 04000003
040000         CONTINUE                                                 04010003
040100     ELSE                                                         04020003
040200         SET DP013-NO-ROLLBACK                                    04030003
040300             DP013-XCTL-DISPLAY-RESTART                           04040003
040400             DP013-CICS-ABEND      TO TRUE                        04050003
040500         MOVE 'BEFORE 0000-MAIN-MODULE'                           04060003
040600                                   TO DP013-PARAGRAPH             04070003
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04080011
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04090011
040900         MOVE DP030-RETURN-CODE                                   04100003
041000                                   TO DP013-MESSAGE-TEXT (3)      04110003
041100         PERFORM DP013-0000-PROCESS-ABEND                         04120003
041200     END-IF.                                                      04130003
041300 EJECT                                                            04140003
041400*----------------------------------------------------------------*04150003
041500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04160003
041600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04170003
041700*----------------------------------------------------------------*04180003
041800                                                                  04190003
041900 1000-CONTROL-PROCESSING.                                         04200003
042000                                                                  04210003
042100     EVALUATE TRUE                                                04220003
042200         WHEN DP020-NEXT-ACT-INITIAL                              04230003
042300             SET ASC-ADD-PENDING   TO TRUE                        04240003
042400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04250003
042500                                                                  04260003
042600***-----$TEMPLATE NOTE$-------------------------------------------04270003
042700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04280003
042800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04290003
042900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04300003
043000***---------------------------------------------------------------04310003
043100             IF  PS-COMMAREA-NOT-VALID                            04320003
043200                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         04330003
043300                 SET DP020-NEXT-ACT-APPL-ERROR                    04340003
043400                                   TO TRUE                        04350003
043500             ELSE                                                 04360003
043600*                PERFORM 2050-DELETE-DETAIL-QUEUE                 04370003
043700                 PERFORM 4000-BUILD-INITIAL-PANEL                 04380003
043800                 PERFORM 3200-RESET-ATTRIBUTES                    04390003
043900             END-IF                                               04400003
044000                                                                  04410003
044100         WHEN DP020-NEXT-ACT-READ-MAP                             04420003
044200             MOVE ASC-KEY-PO-NBR  TO DK-PO-NBR                    04430003
044300             MOVE ASC-KEY-SHIPT-ID TO DK-SHIPT-ID                 04440003
044400             PERFORM 4010-SELECT-STAT-CD-INFO                     04450003
044500             PERFORM 4060-GET-ENT-NAME                            04460003
044600             PERFORM 2000-PROCESS-PANEL                           04470003
044700                                                                  04480003
044800         WHEN DP020-NEXT-ACT-RETURN                               04490003
044900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04500003
045000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04510003
045100                                                                  04520003
045200         WHEN OTHER                                               04530003
045300             SET DP013-LOGIC-ABEND                                04540003
045400                 DP013-NO-ROLLBACK TO TRUE                        04550003
045500             MOVE '1000-CONTROL-PROCESSING'                       04560003
045600                                   TO DP013-PARAGRAPH             04570003
045700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04580003
045800                                   TO DP013-MESSAGE-TEXT(1)       04590003
045900             MOVE DP020-NEXT-APPL-ACTIVITY                        04600003
046000                                   TO DP013-MESSAGE-TEXT(2)       04610003
046100             PERFORM DP013-0000-PROCESS-ABEND                     04620003
046200     END-EVALUATE.                                                04630003
046300/                                                                 04640003
046400*----------------------------------------------------------------*04650003
046500* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *04660003
046600*----------------------------------------------------------------*04670003
046700                                                                  04680003
046800 1100-PROCESS-INTER-APPL-COMM.                                    04690003
046900                                                                  04700003
047000     INITIALIZE ASC-SPECIFIC-COMMAREA                             04710003
047100                                                                  04720003
047200     IF TR017-NUMBER-OF-TS-ITEMS   >  0                           04730003
047300         SET PS-COMMAREA-VALID         TO TRUE                    04740003
047400                                                                  04750003
047500         MOVE TR017-OPER-UNIT          TO ASC-KEY-OPER-UNT-ID     04760003
047600         MOVE TR017-FCLTY-ID           TO ASC-KEY-FCLTY-ID        04770003
047700         MOVE TR017-FCLTY-NME          TO ASC-KEY-FCLTY-NME       04780003
047800         MOVE TR017-SHIPT-ID           TO ASC-KEY-SHIPT-ID        04790003
047900                                          DK-SHIPT-ID             04800003
048000         MOVE TR017-PRO-NBR            TO ASC-PRO-NBR             04810003
048100         MOVE TR017-BOL-NBR            TO ASC-BOL-NBR             04820003
048200                                                                  04830003
048300         EVALUATE DP020-INT-APPL-FORMAT-IND                       04840003
048400             WHEN PC-LIST-FORMAT                                  04850003
048500                                                                  04860003
048600                  SET ASC-USE-SELECTION-QUEUE TO TRUE             04870003
048700                  MOVE TR017-NUMBER-OF-TS-ITEMS                   04880003
048800                                       TO ASC-NUMBER-OF-TS-ITEMS  04890003
048900                  MOVE TR017-SEL-QUEUE-NAME                       04900003
049000                                       TO ASC-SEL-QUEUE-NAME      04910003
049100                  PERFORM 1120-PREPARE-LIST-ENTRY                 04920003
049200                                                                  04930003
049300             WHEN OTHER                                           04940003
049400                  MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER        04950003
049500                  SET DP020-MSG-FATAL                             04960003
049600                      DP020-NEXT-ACT-APPL-ERROR                   04970003
049700                                       TO TRUE                    04980003
049800         END-EVALUATE                                             04990003
049900     ELSE                                                         05000003
050000         SET PS-COMMAREA-NOT-VALID     TO TRUE                    05010003
050100     END-IF.                                                      05020003
050200                                                                  05030003
050300/                                                                 05040003
050400*----------------------------------------------------------------*05050003
050500*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *05060003
050600*----------------------------------------------------------------*05070003
050700                                                                  05080003
050800 1120-PREPARE-LIST-ENTRY.                                         05090003
050900                                                                  05100003
051000     MOVE TR018-MAX-ITEMS          TO ASC-SEL-SUB.                05110003
051100     MOVE ZERO                     TO ASC-SEL-ITEM.               05120003
051200     PERFORM 2140-GET-NEXT-RECORD.                                05130003
051300                                                                  05140003
051400*----------------------------------------------------------------*05150003
051500* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*05160003
051600* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*05170003
051700* EDITS.                                                         *05180003
051800*----------------------------------------------------------------*05190003
051900 2000-PROCESS-PANEL.                                              05200003
052000                                                                  05210003
052100     EVALUATE TRUE                                                05220003
052200                                                                  05230003
052300         WHEN DP020-SRC-AID = DP016-CLEAR                         05240003
052400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05250003
052500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05260003
052600                                                                  05270003
052700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05280003
052800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05290003
052900             PERFORM 4000-BUILD-INITIAL-PANEL                     05300003
053000             PERFORM 3200-RESET-ATTRIBUTES                        05310003
053100                                                                  05320003
053200         WHEN OTHER                                               05330003
053300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05340003
053400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05350003
053500             IF  PS-NO-ERROR                                      05360003
053600                 PERFORM 2100-CHECK-FUNCTION-KEY                  05370003
053700                 SET DP030-CONTINUE-GO TO TRUE                    05380003
053800             ELSE                                                 05390003
053900                 SET DP030-OVERRIDE-GO TO TRUE                    05400003
054000             END-IF                                               05410003
054100     END-EVALUATE.                                                05420003
054200                                                                  05430003
054300 EJECT                                                            05440003
054400******************************************************************05450003
054500** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **05460003
054600** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **05470003
054700** FROM THE CICS ARCHITECTURE API.                              **05480003
054800******************************************************************05490003
054900 2100-CHECK-FUNCTION-KEY.                                         05500003
055000     EVALUATE TRUE                                                05510003
055100                                                                  05520003
055200         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  05530003
055300             MOVE ASC-KEY-PO-NBR   TO TR001-PO-NBR                05540009
055400             MOVE ASC-KEY-SHIPT-ID TO TR001-SHIPT-ID              05550003
055500                                                                  05560003
055600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05570003
055700             PERFORM 5000-UPDATE-TSHPTPO                          05580003
055800             SET ASC-ADD-COMPLETE  TO TRUE                        05590003
055900*            -- OBJECT WAS UPDATED ---                            05600003
056000             MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER            05610003
056100             SET DP020-MSG-INFORMATIONAL  TO TRUE                 05620003
056200             PERFORM 2110-PREPARE-INTER-APPL-COMM                 05630003
056300             SET DP030-ERASE-UNPROT TO TRUE                       05640003
056400                                                                  05650003
056500         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05660003
056600             IF  ASC-USE-SELECTION-QUEUE                          05670003
056700                 PERFORM 2140-GET-NEXT-RECORD                     05680003
056800                 IF PS-LIST-END                                   05690003
056900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05700003
057000                     SET PS-NO-LIST-END                           05710003
057100                                   TO TRUE                        05720003
057200                 ELSE                                             05730003
057300                     PERFORM 4000-BUILD-INITIAL-PANEL             05740003
057400                 END-IF                                           05750003
057500                 PERFORM 3200-RESET-ATTRIBUTES                    05760003
057600             ELSE                                                 05770003
057700                 MOVE PC-TSYMSG-00070                             05780003
057800                                   TO DP020-MSG-NUMBER            05790003
057900                 SET DP020-MSG-INFORMATIONAL                      05800003
058000                                   TO TRUE                        05810003
058100             END-IF                                               05820003
058200                                                                  05830003
058300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05840003
058400             IF  ASC-USE-SELECTION-QUEUE                          05850003
058500                 PERFORM 2150-GET-PREV-RECORD                     05860003
058600                 IF PS-LIST-END                                   05870003
058700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05880003
058800                     SET PS-NO-LIST-END                           05890003
058900                                   TO TRUE                        05900003
059000                 ELSE                                             05910003
059100*                    PERFORM 2050-DELETE-DETAIL-QUEUE             05920003
059200                     PERFORM 4000-BUILD-INITIAL-PANEL             05930003
059300                 END-IF                                           05940003
059400                 PERFORM 3200-RESET-ATTRIBUTES                    05950003
059500             ELSE                                                 05960003
059600                 MOVE PC-TSYMSG-00069                             05970003
059700                                   TO DP020-MSG-NUMBER            05980003
059800                 SET DP020-MSG-INFORMATIONAL                      05990003
059900                                   TO TRUE                        06000003
060000             END-IF                                               06010003
060100                                                                  06020003
060200         WHEN DP020-SRC-AID = DP016-ENTER                         06030003
060300             CONTINUE                                             06040003
060400                                                                  06050003
060500         WHEN OTHER                                               06060003
060600             SET DP013-NO-ROLLBACK                                06070003
060700                 DP013-XCTL-DISPLAY-RESTART                       06080003
060800                 DP013-CICS-ABEND  TO TRUE                        06090003
060900             MOVE '2100-CHECK-FUNCTION-KEY'                       06100003
061000                                   TO DP013-PARAGRAPH             06110003
061100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06120003
061200                                   TO DP013-MESSAGE-TEXT (1)      06130003
061300             PERFORM DP013-0000-PROCESS-ABEND                     06140003
061400     END-EVALUATE.                                                06150003
061500 EJECT                                                            06160003
061600******************************************************************06170003
061700** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **06180003
061800** INTER-APPLICATION COMMAREA.                                  **06190003
061900******************************************************************06200003
062000 2110-PREPARE-INTER-APPL-COMM.                                    06210003
062100*    MOVE ASC-MSG-NUMBER-N         TO DP058-MESSAGE-NUMBER.       06220003
062200                                                                  06230003
062300*----------------------------------------------------------------*06240003
062400*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*06250003
062500*----------------------------------------------------------------*06260003
062600                                                                  06270003
062700 2140-GET-NEXT-RECORD.                                            06280003
062800                                                                  06290003
062900     ADD +1                       TO ASC-SEL-SUB.                 06300003
063000                                                                  06310003
063100     IF  ASC-SEL-SUB > TR018-MAX-ITEMS                            06320003
063200         ADD +1                   TO ASC-SEL-ITEM                 06330003
063300         MOVE +1                  TO ASC-SEL-SUB                  06340003
063400     END-IF.                                                      06350003
063500                                                                  06360003
063600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06370003
063700         PERFORM 9100-READ-SEL-QUEUE                              06380003
063800         IF  TR018-ITEM (ASC-SEL-SUB) > ZERO                      06390003
063900             MOVE TR018-PO-NBR  (ASC-SEL-SUB)                     06400003
064000                                  TO ASC-KEY-PO-NBR               06410003
064100             MOVE ASC-KEY-PO-NBR  TO DK-PO-NBR                    06420003
064200             MOVE TR018-EXPTED-CART-CNT (ASC-SEL-SUB)             06430003
064300                                  TO ASC-EXPTED-CART-CNT-N        06440003
064400             MOVE TR018-REC-SEQ-NBR (ASC-SEL-SUB)                 06450003
064500                                  TO ASC-REC-SEQ-NBR              06460003
064600             SET TR018-INQ (ASC-SEL-SUB) TO TRUE                  06470003
064700             PERFORM 9200-REWRITE-SEL-QUEUE                       06480003
064800         ELSE                                                     06490003
064900             SUBTRACT +1 FROM ASC-SEL-SUB                         06500003
065000             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             06510003
065100             SET DP020-MSG-INFORMATIONAL                          06520003
065200                 PS-LIST-END             TO TRUE                  06530003
065300         END-IF                                                   06540003
065400     ELSE                                                         06550003
065500         SUBTRACT +1 FROM ASC-SEL-ITEM                            06560003
065600         MOVE TR018-MAX-ITEMS     TO ASC-SEL-SUB                  06570003
065700         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             06580003
065800         SET DP020-MSG-INFORMATIONAL                              06590003
065900             PS-LIST-END             TO TRUE                      06600003
066000     END-IF.                                                      06610003
066100                                                                  06620003
066200/                                                                 06630003
066300*----------------------------------------------------------------*06640003
066400*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *06650003
066500*    PROCESSED.                                                  *06660003
066600*----------------------------------------------------------------*06670003
066700                                                                  06680003
066800 2150-GET-PREV-RECORD.                                            06690003
066900                                                                  06700003
067000     SUBTRACT +1 FROM ASC-SEL-SUB.                                06710003
067100                                                                  06720003
067200     IF  ASC-SEL-SUB < +1                                         06730003
067300         SUBTRACT +1 FROM ASC-SEL-ITEM                            06740003
067400         MOVE TR018-MAX-ITEMS     TO ASC-SEL-SUB                  06750003
067500     END-IF.                                                      06760003
067600                                                                  06770003
067700     IF  ASC-SEL-ITEM > ZERO                                      06780003
067800         PERFORM 9100-READ-SEL-QUEUE                              06790003
067900         MOVE TR018-PO-NBR  (ASC-SEL-SUB)                         06800003
068000                                  TO ASC-KEY-PO-NBR               06810003
068100         MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR                    06820003
068200         MOVE TR018-EXPTED-CART-CNT (ASC-SEL-SUB)                 06830003
068300                                  TO ASC-EXPTED-CART-CNT          06840003
068400         MOVE TR018-REC-SEQ-NBR (ASC-SEL-SUB)                     06850003
068500                                  TO ASC-REC-SEQ-NBR              06860003
068600         SET TR018-INQ (ASC-SEL-SUB) TO TRUE                      06870003
068700         PERFORM 9200-REWRITE-SEL-QUEUE                           06880003
068800     ELSE                                                         06890003
068900         MOVE +1                  TO ASC-SEL-ITEM                 06900003
069000                                     ASC-SEL-SUB                  06910003
069100         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             06920003
069200         SET DP020-MSG-INFORMATIONAL                              06930003
069300             PS-LIST-END             TO TRUE                      06940003
069400     END-IF.                                                      06950003
069500                                                                  06960003
069600*----------------------------------------------------------------*06970003
069700* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*06980003
069800* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *06990003
069900* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *07000003
070000*----------------------------------------------------------------*07010003
070100                                                                  07020003
070200 2200-MOVE-SCREEN-TO-COMMAREA.                                    07030003
070300     IF  AEXPCNTL > ZERO                                          07040003
070400         MOVE AEXPCNTI             TO ASC-EXPTED-CART-CNT         07050003
070500     ELSE                                                         07060003
070600         IF  AEXPCNTF = DP015-ERASE-EOF                           07070003
070700             MOVE ZERO             TO ASC-EXPTED-CART-CNT         07080003
070800         END-IF                                                   07090003
070900     END-IF.                                                      07100003
071000                                                                  07110003
071100     IF  APCKSLPL > ZERO                                          07120003
071200         MOVE APCKSLPI             TO ASC-PACKSLIP-IND            07130003
071300     ELSE                                                         07140003
071400         IF  APCKSLPF = DP015-ERASE-EOF                           07150003
071500             MOVE SPACE            TO ASC-PACKSLIP-IND            07160003
071600         END-IF                                                   07170003
071700     END-IF.                                                      07180003
071800                                                                  07190003
071900*----------------------------------------------------------------*07200003
072000* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *07210003
072100* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *07220003
072200* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *07230003
072300*----------------------------------------------------------------*07240003
072400                                                                  07250003
072500 3000-EDIT-DATA-IN-COMMAREA.                                      07260003
072600     PERFORM 3200-RESET-ATTRIBUTES.                               07270003
072700                                                                  07280003
072800     IF  ASC-EXPTED-CART-CNT > SPACES                             07290003
072900         MOVE ASC-EXPTED-CART-CNT   TO DP010I-UNEDITED-FIELD      07300003
073000         MOVE LENGTH OF ASC-EXPTED-CART-CNT                       07310003
073100                                    TO DP010I-MAXIMUM-DIGITS      07320003
073200         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    07330003
073300         SET  DP010I-NEGATIVE-NOT-ALLOWED                         07340003
073400                                    TO TRUE                       07350003
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07361010
263697              USING DP010I-NUMERIC-EDIT-AREA                      07362010
073600         IF  DP010I-ERROR-DETECTED                                07370003
073700             SET PS-ERROR                                         07380003
073800                 DP020-MSG-FATAL    TO TRUE                       07390003
073900             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           07400003
074000             MOVE DP015-UNP-ALP-BRT-OFF                           07410003
074100                                    TO AEXPCNTA                   07420003
074200             MOVE DP015-RED         TO AEXPCNTC                   07430003
074300             MOVE DP015-REVERSE     TO AEXPCNTH                   07440003
074400             MOVE -1                TO AEXPCNTL                   07450003
074500             SET DP030-SET-CURSOR-APPL-1                          07460003
074600                                    TO TRUE                       07470003
074700         ELSE                                                     07480003
074800             MOVE DP010I-NUMERIC-FIELD                            07490003
074900                                    TO ASC-EXPTED-CART-CNT-N      07500003
075000             MOVE ASC-EXPTED-CART-CNT-N                           07510003
075100                                    TO AEXPCNTO                   07520003
075200         END-IF                                                   07530003
075300     END-IF.                                                      07540003
075400                                                                  07550003
075500     IF  ASC-PACKSLIP-IND = (' ' OR 'Y' OR 'N')                   07560003
075600         MOVE ASC-PACKSLIP-IND      TO APCKSLPO                   07570003
075700     ELSE                                                         07580003
075800         SET PS-ERROR                                             07590003
075900             DP020-MSG-FATAL        TO TRUE                       07600003
076000         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           07610003
076100         MOVE DP015-UNP-ALP-BRT-OFF TO APCKSLPA                   07620003
076200         MOVE DP015-RED             TO APCKSLPC                   07630003
076300         MOVE DP015-REVERSE         TO APCKSLPH                   07640003
076400         MOVE -1                    TO APCKSLPL                   07650003
076500         SET DP030-SET-CURSOR-APPL-1                              07660003
076600                                    TO TRUE                       07670003
076700     END-IF.                                                      07680003
076800                                                                  07690003
076900*                                                                 07700003
077000     IF  PS-NO-ERROR                                              07710003
077100         MOVE -1                   TO AEXPCNTL                    07720003
077200         SET DP030-SET-CURSOR-APPL-1                              07730003
077300                                   TO TRUE                        07740003
077400     END-IF.                                                      07750003
077500*                                                                 07760003
077600*                                                                 07770003
077700 3200-RESET-ATTRIBUTES.                                           07780003
077800     MOVE DP015-UNP-ALP-NOR-OFF    TO AEXPCNTA                    07790003
077900                                      APCKSLPA.                   07800003
078000     MOVE DP015-GREEN              TO AEXPCNTC                    07810003
078100                                      APCKSLPC.                   07820003
078200     MOVE DP015-UNDERLINE          TO AEXPCNTH                    07830003
078300                                      APCKSLPH.                   07840003
078400*                                                                 07850003
078500*                                                                 07860003
078600*----------------------------------------------------------------*07870003
078700* SET UP THE INFORMATION FOR THE CURRENT PO                      *07880003
078800*----------------------------------------------------------------*07890003
078900                                                                  07900003
079000 4000-BUILD-INITIAL-PANEL.                                        07910003
079100                                                                  07920003
079200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07930003
079300     MOVE -1                       TO AEXPCNTL.                   07940003
079400                                                                  07950003
079500     PERFORM 4010-SELECT-STAT-CD-INFO.                            07960003
079600                                                                  07970003
079700     MOVE ASC-KEY-OPER-UNT-ID         TO AOPERIDO.                07980003
079800     MOVE ASC-KEY-FCLTY-ID            TO AFCLTYO.                 07990003
079900     MOVE ASC-KEY-FCLTY-NME           TO AOPRDESO.                08000003
080000     MOVE ASC-PRO-NBR                 TO AFBILLO.                 08010003
080100     MOVE ASC-BOL-NBR                 TO ABOLO.                   08020003
080200     MOVE ASC-KEY-PO-NBR              TO APONBRO.                 08030003
080300                                                                  08040003
080400     IF PS-FOUND                                                  08050003
080500        PERFORM 4030-SELECT-DPT-BYR                               08060003
080600        PERFORM 4040-DETERMINE-NO-DISTRO                          08070003
080700        PERFORM 4050-SELECT-TSHPTPO                               08080003
080800        PERFORM 4060-GET-ENT-NAME                                 08090003
080900        PERFORM 4070-SELECT-VND-SHIP-DTE                          08100003
081000        PERFORM 4020-SELECT-TPLNSHP                               08110003
081100                                                                  08120003
081200        MOVE ASC-NO-DISTRO-MSG        TO ANODISTO                 08130003
081300        MOVE ASC-PO-STATUS-DESC       TO APOSTATO                 08140003
081400                                                                  08150003
081500        IF ASC-DONT-SHIP-BEF-DTE = '01/01/0001'                   08160003
081600            MOVE SPACES               TO ADNSDTEO                 08170003
081700        ELSE                                                      08180003
081800            MOVE ASC-DONT-SHIP-BEF-DTE                            08190003
081900                                      TO ADNSDTEO                 08200003
082000        END-IF                                                    08210003
082100                                                                  08220003
082200        IF ASC-CANCEL-DTE = '01/01/0001'                          08230003
082300            MOVE SPACES               TO ACANDTEO                 08240003
082400        ELSE                                                      08250003
082500            MOVE ASC-CANCEL-DTE       TO ACANDTEO                 08260003
082600        END-IF                                                    08270003
082700                                                                  08280003
082800        IF ASC-EXT-CAN-DTE = '01/01/0001'                         08290003
082900            MOVE SPACES               TO AEXCDTEO                 08300003
083000        ELSE                                                      08310003
083100            MOVE ASC-EXT-CAN-DTE      TO AEXCDTEO                 08320003
083200        END-IF                                                    08330003
083300                                                                  08340003
083400        MOVE ASC-PACKSLIP-IND         TO APCKSLPO                 08350003
083500        MOVE ASC-EXPTED-CART-CNT-N    TO AEXPCNTO                 08360003
083600        MOVE ASC-DEPT-NBR-N           TO ADPTNBRO                 08370006
083700        MOVE ASC-BUYER-NME            TO ABYRNMEO                 08380003
083800        MOVE ASC-VENDOR-NME           TO AVNDNMEO                 08390003
083900        MOVE ASC-ASN-CART-CNT         TO AASNCNTO                 08400003
084000        MOVE ASC-FOR-CART-CNT         TO AFORCNTO                 08410003
084100     ELSE                                                         08420003
084200        SET PS-ERROR              TO TRUE                         08430003
084300        SET DP020-MSG-FATAL       TO TRUE                         08440003
084400        MOVE -1                   TO APONBRL                      08450003
084500        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       08460003
084600        MOVE PC-TSYMSG-00083      TO DP020-MSG-NUMBER             08470003
084700        MOVE SPACES               TO ANODISTO                     08480003
084800                                     ADNSDTEO                     08490003
084900                                     ACANDTEO                     08500003
085000                                     AEXCDTEO                     08510003
085200*                                    ADPTDSCO                     08530003
085300                                     ABYRNMEO                     08540003
085310        MOVE ZEROES               TO ADPTNBRO                     08541006
085400     END-IF.                                                      08550003
085500                                                                  08560003
085600 4010-SELECT-STAT-CD-INFO.                                        08570003
085700*----------------------------------------------------------------*08580003
085800****   SELECT THE TPURCHS INFORMATION   *****                     08590003
085900*----------------------------------------------------------------*08600003
086000     PERFORM WITH TEST AFTER                                      08610003
086100         VARYING PV-RETRY-COUNTER                                 08620003
086200         FROM 1 BY 1                                              08630003
086300         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 08640003
086400                 OR SQLCODE = 0                                   08650003
086500                 OR SQLCODE = +100)                               08660003
086600                                                                  08670003
086700         EXEC SQL                                                 08680003
086800             SELECT STATUS_CDE                                    08690003
086900                   ,DEPT_NBR                                      08700003
087000                   ,ENT_ID                                        08710003
087100             INTO   :PURCHS-STATUS-CDE                            08720003
087200                   ,:PURCHS-DEPT-NBR                              08730003
087300                   ,:PURCHS-ENT-ID                                08740003
087400             FROM   TPURCHS                                       08750003
087500             WHERE  PO_NBR         = :DK-PO-NBR                   08760003
087600             AND    VER_STATUS_CDE = :PC-ACTIVE                   08770003
087700         END-EXEC                                                 08780003
087800                                                                  08790003
087900         EVALUATE TRUE                                            08800003
088000             WHEN SQLCODE = +0                                    08810003
088100                  SET PS-FOUND TO TRUE                            08820003
088200                  MOVE PURCHS-DEPT-NBR TO ASC-DEPT-NBR-N          08830006
088300                  MOVE PURCHS-ENT-ID   TO ASC-ENT-ID              08840003
088400                                                                  08850003
088500             WHEN SQLCODE = +100                                  08860003
088600                  SET PS-NOT-FOUND TO TRUE                        08870003
088700                  MOVE SPACES  TO ASC-NO-DISTRO-MSG               08880003
088800                                  ASC-PO-STATUS-DESC              08890003
088900                                  ASC-DONT-SHIP-BEF-DTE           08900003
089000                                  ASC-CANCEL-DTE                  08910003
089100                                  ASC-EXT-CAN-DTE                 08920003
089200                                  ASC-DEPT-NBR                    08930003
089300                                  ASC-BUYER-NME                   08940003
089400             WHEN SQLCODE = -904                                  08950003
089500             WHEN SQLCODE = -911                                  08960003
089600             WHEN SQLCODE = -913                                  08970003
089700                  CONTINUE                                        08980003
089800                                                                  08990003
089900             WHEN OTHER                                           09000003
090000                  MOVE '4010-SELECT-STAT-CD-INFO'                 09010003
090100                                  TO DP013-PARAGRAPH              09020003
090200                  MOVE 'UNSUCCESSFUL SELECT ON TPURCHS  '         09030003
090300                                  TO DP013-MESSAGE-TEXT (1)       09040003
090400                  MOVE SQLCA      TO DP013-SQLCA                  09050003
090500                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     09060003
090600                  SET DP013-DB2-ABEND                             09070003
090700                      DP013-XCTL-DISPLAY-RESTART                  09080003
090800                                  TO TRUE                         09090003
090900                  PERFORM DP013-0000-PROCESS-ABEND                09100003
091000         END-EVALUATE                                             09110003
091100     END-PERFORM.                                                 09120003
091200                                                                  09130003
091300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     09140003
091400        SQLCODE NOT = +0                                          09150003
091500         MOVE '4010-SELECT-STAT-CD-INFO'                          09160003
091600                         TO DP013-PARAGRAPH                       09170003
091700         MOVE 'UNSUCCESSFUL SELECT ON TPURCHS  '                  09180003
091800                         TO DP013-MESSAGE-TEXT (1)                09190003
091900         MOVE SQLCA      TO DP013-SQLCA                           09200003
092000         MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)              09210003
092100         SET DP013-DB2-ABEND                                      09220003
092200             DP013-XCTL-DISPLAY-RESTART                           09230003
092300                         TO TRUE                                  09240003
092400         PERFORM DP013-0000-PROCESS-ABEND                         09250003
092500     END-IF.                                                      09260003
092600                                                                  09270003
092700*                                                                 09280003
092800****   GET THE STATUS DESCRIPTION       *****                     09290003
092900*                                                                 09300003
093000     IF PS-FOUND                                                  09310003
093100        PERFORM WITH TEST AFTER                                   09320003
093200            VARYING PV-RETRY-COUNTER                              09330003
093300            FROM 1 BY 1                                           09340003
093400            UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES              09350003
093500                    OR SQLCODE = 0                                09360003
093600                    OR SQLCODE = +100)                            09370003
093700                                                                  09380003
093800            EXEC SQL                                              09390003
093900                SELECT STATUS_DESC                                09400003
094000                INTO   :STATCD-STATUS-DESC                        09410003
094100                FROM   TSTATCD                                    09420003
094200                WHERE  STATUS_CDE     = :PURCHS-STATUS-CDE        09430003
094300                AND    STATUS_TYP_CDE = 'P'                       09440003
094400            END-EXEC                                              09450003
094500                                                                  09460003
094600            EVALUATE TRUE                                         09470003
094700                WHEN SQLCODE = +0                                 09480003
094800                     MOVE PURCHS-STATUS-CDE  TO ASC-PO-STATUS     09490003
094900                     MOVE STATCD-STATUS-DESC TO ASC-PO-STATUS-DESC09500003
095000                                                                  09510003
095100                     EVALUATE PURCHS-STATUS-CDE                   09520003
095200                        WHEN PC-PO-ACTIVE                         09530003
095300                        WHEN PC-APPROVED                          09540003
095400                             MOVE DP015-BLUE         TO APOSTATC  09550003
095500                             MOVE DP015-HL-OFF       TO APOSTATH  09560003
095600                        WHEN OTHER                                09570003
095700                             MOVE DP015-YELLOW       TO APOSTATC  09580003
095800                             MOVE DP015-REVERSE      TO APOSTATH  09590003
095900                     END-EVALUATE                                 09600003
096000                                                                  09610003
096100                WHEN SQLCODE = +100                               09620003
096200                     SET PS-NOT-FOUND TO TRUE                     09630003
096300                WHEN SQLCODE = -904                               09640003
096400                WHEN SQLCODE = -911                               09650003
096500                WHEN SQLCODE = -913                               09660003
096600                     CONTINUE                                     09670003
096700                                                                  09680003
096800                WHEN OTHER                                        09690003
096900                     MOVE '4010-SELECT-STAT-CD-INFO'              09700003
097000                                     TO DP013-PARAGRAPH           09710003
097100                     MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '      09720003
097200                                     TO DP013-MESSAGE-TEXT (1)    09730003
097300                     MOVE SQLCA      TO DP013-SQLCA               09740003
097400                     MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)  09750003
097500                     SET DP013-DB2-ABEND                          09760003
097600                         DP013-XCTL-DISPLAY-RESTART               09770003
097700                                     TO TRUE                      09780003
097800                     PERFORM DP013-0000-PROCESS-ABEND             09790003
097900            END-EVALUATE                                          09800003
098000        END-PERFORM                                               09810003
098100     END-IF.                                                      09820003
098200                                                                  09830003
098300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     09840003
098400        SQLCODE NOT = +0                                          09850003
098500         MOVE '4010-SELECT-STAT-CD-INFO'                          09860003
098600                         TO DP013-PARAGRAPH                       09870003
098700         MOVE 'UNSUCCESSFUL SELECT ON TSTATCD  '                  09880003
098800                         TO DP013-MESSAGE-TEXT (1)                09890003
098900         MOVE SQLCA      TO DP013-SQLCA                           09900003
099000         MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)              09910003
099100         SET DP013-DB2-ABEND                                      09920003
099200             DP013-XCTL-DISPLAY-RESTART                           09930003
099300                         TO TRUE                                  09940003
099400         PERFORM DP013-0000-PROCESS-ABEND                         09950003
099500     END-IF.                                                      09960003
099600                                                                  09970003
099700 4020-SELECT-TPLNSHP.                                             09980003
099800*----------------------------------------------------------------*09990003
099900*  SELECT THE NEEDED INFORMATION FROM THE TPLNSHP TABLE           10000003
100000*----------------------------------------------------------------*10010003
100100                                                                  10020003
100200     PERFORM WITH TEST AFTER                                      10030003
100300         VARYING PV-RETRY-COUNTER                                 10040003
100400         FROM 1 BY 1                                              10050003
100500         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 10060003
100600                 OR SQLCODE = 0                                   10070003
100700                 OR SQLCODE = +100 )                              10080003
100800                                                                  10090003
100900         EXEC SQL                                                 10100003
101000             SELECT DONT_SHIP_BEF_DTE                             10110003
101100                   ,CAN_IFNOT_SHIP_DTE                            10120003
101200                   ,EXT_CAN_DTE                                   10130003
101300             INTO   :PLNSHP-DONT-SHIP-BEF-DTE                     10140003
101400                   ,:PLNSHP-CAN-IFNOT-SHIP-DTE                    10150003
101500                   ,:PLNSHP-EXT-CAN-DTE                           10160003
101600             FROM   TPLNSHP                                       10170003
101700             WHERE  PO_NBR         = :DK-PO-NBR                   10180003
101800             AND    VER_STATUS_CDE = :PC-ACTIVE                   10190003
101900         END-EXEC                                                 10200003
102000                                                                  10210003
102100         EVALUATE TRUE                                            10220003
102200             WHEN SQLCODE = +0                                    10230003
102300                MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-TEMP-DATE     10240003
102400                MOVE PV-DATE-CCYY  TO PV-WK-DTE-CCYY              10250003
102500                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                10260003
102600                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                10270003
102700                MOVE PV-WORK-DATE  TO ASC-DONT-SHIP-BEF-DTE       10280003
102800                                                                  10290003
102900                MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-TEMP-DATE    10300003
103000                MOVE PV-DATE-CCYY  TO PV-WK-DTE-CCYY              10310003
103100                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                10320003
103200                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                10330003
103300                MOVE PV-WORK-DATE  TO ASC-CANCEL-DTE              10340003
103400                                                                  10350003
103500                MOVE PLNSHP-EXT-CAN-DTE TO PV-TEMP-DATE           10360003
103600                MOVE PV-DATE-CCYY  TO PV-WK-DTE-CCYY              10370003
103700                MOVE PV-DATE-MM    TO PV-WK-DTE-MM                10380003
103800                MOVE PV-DATE-DD    TO PV-WK-DTE-DD                10390003
103900                MOVE PV-WORK-DATE  TO ASC-EXT-CAN-DTE             10400003
104000                                                                  10410003
104100             WHEN SQLCODE = +100                                  10420003
104200                MOVE SPACES        TO ASC-DONT-SHIP-BEF-DTE       10430003
104300                                      ASC-CANCEL-DTE              10440003
104400                                      ASC-EXT-CAN-DTE             10450003
104500                                                                  10460003
104600             WHEN SQLCODE = -904                                  10470003
104700             WHEN SQLCODE = -911                                  10480003
104800             WHEN SQLCODE = -913                                  10490003
104900                  CONTINUE                                        10500003
105000                                                                  10510003
105100             WHEN OTHER                                           10520003
105200                  MOVE '4020-SELECT-TPLNSHP'                      10530003
105300                                  TO DP013-PARAGRAPH              10540003
105400                  MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP  '         10550003
105500                                  TO DP013-MESSAGE-TEXT (1)       10560003
105600                  MOVE SQLCA      TO DP013-SQLCA                  10570003
105700                  MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)     10580003
105800                  SET DP013-DB2-ABEND                             10590003
105900                      DP013-XCTL-DISPLAY-RESTART                  10600003
106000                                  TO TRUE                         10610003
106100                  PERFORM DP013-0000-PROCESS-ABEND                10620003
106200         END-EVALUATE                                             10630003
106300     END-PERFORM.                                                 10640003
106400                                                                  10650003
106500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     10660003
106600        SQLCODE NOT = +0                                          10670003
106700         MOVE '4020-SELECT-TPLNSHP'                               10680003
106800                         TO DP013-PARAGRAPH                       10690003
106900         MOVE 'UNSUCCESSFUL SELECT ON TPLNSHP  '                  10700003
107000                         TO DP013-MESSAGE-TEXT (1)                10710003
107100         MOVE SQLCA      TO DP013-SQLCA                           10720003
107200         MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)              10730003
107300         SET DP013-DB2-ABEND                                      10740003
107400             DP013-XCTL-DISPLAY-RESTART                           10750003
107500                         TO TRUE                                  10760003
107600         PERFORM DP013-0000-PROCESS-ABEND                         10770003
107700     END-IF.                                                      10780003
107800                                                                  10790003
107900     IF PLNSHP-EXT-CAN-DTE = '0001-01-01'                         10800003
108000                                                                  10810003
108100         EVALUATE TRUE                                            10820003
108200             WHEN ((SHIPMT-VEND-SHIP-DTE >=                       10830003
108300                               PLNSHP-DONT-SHIP-BEF-DTE)          10840003
108400              AND  (SHIPMT-VEND-SHIP-DTE <=                       10850003
108500                               PLNSHP-CAN-IFNOT-SHIP-DTE))        10860003
108600                  MOVE DP015-HL-OFF  TO ADNSDTEH                  10870003
108700                  MOVE DP015-HL-OFF  TO ACANDTEH                  10880003
108800                  MOVE DP015-HL-OFF  TO AEXCDTEH                  10890003
108900                                                                  10900003
109000             WHEN (SHIPMT-VEND-SHIP-DTE <                         10910003
109100                               PLNSHP-DONT-SHIP-BEF-DTE)          10920003
109200             WHEN (SHIPMT-VEND-SHIP-DTE >                         10930003
109300                               PLNSHP-CAN-IFNOT-SHIP-DTE)         10940003
109400                  MOVE DP015-REVERSE TO ADNSDTEH                  10950003
109500                  MOVE DP015-REVERSE TO ACANDTEH                  10960003
109600                  MOVE DP015-HL-OFF  TO AEXCDTEH                  10970003
109700         END-EVALUATE                                             10980003
109800                                                                  10990003
109900     ELSE                                                         11000003
110000         EVALUATE TRUE                                            11010003
110100             WHEN ((SHIPMT-VEND-SHIP-DTE >=                       11020003
110200                               PLNSHP-DONT-SHIP-BEF-DTE)          11030003
110300              AND  (SHIPMT-VEND-SHIP-DTE <=                       11040003
110400                               PLNSHP-EXT-CAN-DTE ))              11050003
110500                  MOVE DP015-HL-OFF  TO ADNSDTEH                  11060003
110600                  MOVE DP015-HL-OFF  TO ACANDTEH                  11070003
110700                  MOVE DP015-HL-OFF  TO AEXCDTEH                  11080003
110800                                                                  11090003
110900             WHEN (SHIPMT-VEND-SHIP-DTE <                         11100003
111000                               PLNSHP-DONT-SHIP-BEF-DTE)          11110003
111100             WHEN (SHIPMT-VEND-SHIP-DTE >                         11120003
111200                               PLNSHP-EXT-CAN-DTE )               11130003
111300                  MOVE DP015-REVERSE TO ADNSDTEH                  11140003
111400                  MOVE DP015-REVERSE TO AEXCDTEH                  11150003
111500                  MOVE DP015-HL-OFF  TO ACANDTEH                  11160003
111600         END-EVALUATE                                             11170003
111700     END-IF.                                                      11180003
111800                                                                  11190003
111900                                                                  11200003
112000                                                                  11210003
112100 4030-SELECT-DPT-BYR.                                             11220003
112200*----------------------------------------------------------------*11230003
112300*  SELECT THE NEEDED INFORMATION FROM THE TMDSEAR AND TRSPBAR     11240003
112400*  TABLES                                                         11250003
112500*----------------------------------------------------------------*11260003
112600                                                                  11270003
112700     PERFORM WITH TEST AFTER                                      11280003
112800         VARYING PV-RETRY-COUNTER                                 11290003
112900         FROM 1 BY 1                                              11300003
113000         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 11310003
113100                 OR SQLCODE = 0 )                                 11320003
113200                                                                  11330003
113300         EXEC SQL                                                 11340003
113400             SELECT MDSEAR_DKEY                                   11350003
113500                   ,BYR_NBR                                       11360003
113600                   ,MDSEAR_DESC                                   11370003
113700             INTO   :MDSEAR-DKEY                                  11380003
113800                   ,:MDSEAR-BYR-NBR                               11390003
113900                   ,:MDSEAR-DESC                                  11400003
114000             FROM   TMDSEAR                                       11410003
114100             WHERE  DEPT_NBR       = :PURCHS-DEPT-NBR             11420003
114200             AND    MDSELV_CDE     = 'DPT'                        11430003
114300             AND    CURRENT DATE BETWEEN STRT_DTE AND END_DTE     11440003
114400         END-EXEC                                                 11450003
114500                                                                  11460003
114600         EVALUATE TRUE                                            11470003
114700             WHEN SQLCODE = +0                                    11480003
114800                  CONTINUE                                        11490003
114900                                                                  11500003
115000             WHEN SQLCODE = -904                                  11510003
115100             WHEN SQLCODE = -911                                  11520003
115200             WHEN SQLCODE = -913                                  11530003
115300                  CONTINUE                                        11540003
115400                                                                  11550003
115500             WHEN OTHER                                           11560003
115600                  MOVE '4030-SELECT-DPT-BYR'                      11570003
115700                                  TO DP013-PARAGRAPH              11580003
115800                  MOVE 'UNSUCCESSFUL SELECT ON TMDSEAR  '         11590003
115900                                  TO DP013-MESSAGE-TEXT (1)       11600003
116000                  MOVE SQLCA      TO DP013-SQLCA                  11610003
116100                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     11620003
116200                  SET DP013-DB2-ABEND                             11630003
116300                      DP013-XCTL-DISPLAY-RESTART                  11640003
116400                                  TO TRUE                         11650003
116500                  PERFORM DP013-0000-PROCESS-ABEND                11660003
116600         END-EVALUATE                                             11670003
116700     END-PERFORM.                                                 11680003
116800                                                                  11690003
116900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     11700003
117000        SQLCODE NOT = +0                                          11710003
117100         MOVE '4030-SELECT-DPT-BYR'                               11720003
117200                         TO DP013-PARAGRAPH                       11730003
117300         MOVE 'UNSUCCESSFUL SELECT ON TMDSEAR  '                  11740003
117400                         TO DP013-MESSAGE-TEXT (1)                11750003
117500         MOVE SQLCA      TO DP013-SQLCA                           11760003
117600         MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)              11770003
117700         SET DP013-DB2-ABEND                                      11780003
117800             DP013-XCTL-DISPLAY-RESTART                           11790003
117900                         TO TRUE                                  11800003
118000         PERFORM DP013-0000-PROCESS-ABEND                         11810003
118100     END-IF.                                                      11820003
118200                                                                  11830003
118300*                                                                 11840003
118400****   SELECT THE TRSPBAR INFORMATION   *****                     11850003
118500*                                                                 11860003
118600     IF PS-DPT-NOT-FOUND                                          11870003
118700        CONTINUE                                                  11880003
118800     ELSE                                                         11890003
118900        PERFORM WITH TEST AFTER                                   11900003
119000            VARYING PV-RETRY-COUNTER                              11910003
119100            FROM 1 BY 1                                           11920003
119200            UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES              11930003
119300                    OR SQLCODE = 0)                               11940003
119400                                                                  11950003
119500            EXEC SQL                                              11960003
119600                SELECT WORKER_NBR                                 11970003
119700                      ,WORKER_FIR_NAME                            11980003
119800                      ,WORKER_LAST_NAME                           11990003
119900                INTO   :RSPBAR-WORKER-NBR                         12000003
120000                      ,:RSPBAR-WORKER-FIR-NAME                    12010003
120100                      ,:RSPBAR-WORKER-LAST-NAME                   12020003
120200                FROM   TRSPBAR                                    12030003
120300                WHERE  MDSEAR_DKEY    = :MDSEAR-DKEY              12040003
120400                AND    RSPLVL_CDE    = 'BYR'                      12050003
120500                AND    CURRENT DATE BETWEEN WORKER_STRT_DTE AND   12060003
120600                                            WORKER_END_DTE        12070003
120700            END-EXEC                                              12080003
120800                                                                  12090003
120900            EVALUATE TRUE                                         12100003
121000                WHEN SQLCODE = +0                                 12110003
121100                  MOVE RSPBAR-WORKER-FIR-NAME TO PV-W-FIRST-NAME  12120003
121200                  MOVE RSPBAR-WORKER-LAST-NAME TO PV-W-LAST-NAME  12130003
121300                  MOVE PV-W-FIRST-NAME TO PV-WORKER-FIRST         12140003
121400                  MOVE PV-W-LAST-NAME  TO PV-WORKER-LAST          12150003
121500                  MOVE PV-WORKER-NAME  TO ASC-BUYER-NME           12160003
121600                                                                  12170003
121700                WHEN SQLCODE = -904                               12180003
121800                WHEN SQLCODE = -911                               12190003
121900                WHEN SQLCODE = -913                               12200003
122000                     CONTINUE                                     12210003
122100                                                                  12220003
122200                WHEN OTHER                                        12230003
122300                     MOVE '4030-SELECT-DPT-BYR'                   12240003
122400                                     TO DP013-PARAGRAPH           12250003
122500                     MOVE 'UNSUCCESSFUL SELECT ON TRSPBAR  '      12260003
122600                                     TO DP013-MESSAGE-TEXT (1)    12270003
122700                     MOVE SQLCA      TO DP013-SQLCA               12280003
122800                     MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)  12290003
122900                     SET DP013-DB2-ABEND                          12300003
123000                         DP013-XCTL-DISPLAY-RESTART               12310003
123100                                     TO TRUE                      12320003
123200                     PERFORM DP013-0000-PROCESS-ABEND             12330003
123300            END-EVALUATE                                          12340003
123400        END-PERFORM                                               12350003
123500     END-IF.                                                      12360003
123600                                                                  12370003
123700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     12380003
123800        SQLCODE NOT = +0                                          12390003
123900         MOVE '4030-SELECT-DPT-BYR'                               12400003
124000                         TO DP013-PARAGRAPH                       12410003
124100         MOVE 'UNSUCCESSFUL SELECT ON TRSPBAR  '                  12420003
124200                         TO DP013-MESSAGE-TEXT (1)                12430003
124300         MOVE SQLCA      TO DP013-SQLCA                           12440003
124400         MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (1)              12450003
124500         SET DP013-DB2-ABEND                                      12460003
124600             DP013-XCTL-DISPLAY-RESTART                           12470003
124700                         TO TRUE                                  12480003
124800         PERFORM DP013-0000-PROCESS-ABEND                         12490003
124900     END-IF.                                                      12500003
125000                                                                  12510003
125100                                                                  12520003
125200 4040-DETERMINE-NO-DISTRO.                                        12530003
125300******************************************************************12540003
125400*    THIS PARAGRAPH DETERMINES IF THE 'NO DISTRO' SHOULD BE       12550003
125500*    DISPLAYED FOR THE PO.                                        12560003
125600******************************************************************12570003
125700     PERFORM 4100-OPEN-PO-CSR.                                    12580003
125800     PERFORM 4110-FETCH-PO-CSR.                                   12590003
125900     SET PS-NOT-DONE TO TRUE.                                     12600003
126000     MOVE ASC-KEY-OPER-UNT-ID TO PV-OPER-UNT-ID.                  12610003
126100     PERFORM 4120-PROCESS-PO-CSR UNTIL PS-DONE.                   12620003
126200                                                                  12630003
126300     IF PS-DISPLAY-DISTRO-MSG                                     12640003
126400        MOVE 'NO DISTRO'      TO ASC-NO-DISTRO-MSG                12650003
126500     ELSE                                                         12660003
126600        MOVE SPACES           TO ASC-NO-DISTRO-MSG                12670003
126700     END-IF.                                                      12680003
126800                                                                  12690003
126900 4050-SELECT-TSHPTPO.                                             12700003
127000*----------------------------------------------------------------*12710003
127100*  SELECT THE NEEDED INFORMATION FROM THE TSHPTPO TABLE           12720003
127200*----------------------------------------------------------------*12730003
127300                                                                  12740003
127400     PERFORM WITH TEST AFTER                                      12750003
127500         VARYING PV-RETRY-COUNTER                                 12760003
127600         FROM 1 BY 1                                              12770003
127700         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 12780003
127800                 OR SQLCODE = 0)                                  12790003
127900                                                                  12800003
128000         EXEC SQL                                                 12810003
128100             SELECT PKSL_IND                                      12820003
128200                  , EXPTED_CART_CNT                               12830003
128300             INTO   :SHPTPO-PKSL-IND                              12840003
128400                  , :SHPTPO-EXPTED-CART-CNT                       12850003
128500             FROM   TSHPTPO                                       12860003
128600             WHERE  PO_NBR         = :DK-PO-NBR                   12870003
128700             AND    SHIPT_ID       = :DK-SHIPT-ID                 12880003
128800         END-EXEC                                                 12890003
128900                                                                  12900003
129000         EVALUATE TRUE                                            12910003
129100             WHEN SQLCODE = +0                                    12920003
129200                  MOVE SHPTPO-PKSL-IND   TO ASC-PACKSLIP-IND      12930003
129300                  MOVE SHPTPO-EXPTED-CART-CNT                     12940003
129400                                         TO ASC-EXPTED-CART-CNT-N 12950003
129500                                                                  12960003
129600             WHEN SQLCODE = -904                                  12970003
129700             WHEN SQLCODE = -911                                  12980003
129800             WHEN SQLCODE = -913                                  12990003
129900                  CONTINUE                                        13000003
130000                                                                  13010003
130100             WHEN OTHER                                           13020003
130200                  MOVE '4050-SELECT-TSHPTPO'                      13030003
130300                                  TO DP013-PARAGRAPH              13040003
130400                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         13050003
130500                                  TO DP013-MESSAGE-TEXT (1)       13060003
130600                  MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)       13070003
130700                  MOVE DK-SHIPT-ID                                13080003
130800                                  TO DP013-MESSAGE-TEXT (3)       13090003
130900                  MOVE SQLCA      TO DP013-SQLCA                  13100003
131000                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     13110003
131100                  SET DP013-DB2-ABEND                             13120003
131200                      DP013-XCTL-DISPLAY-RESTART                  13130003
131300                                  TO TRUE                         13140003
131400                  PERFORM DP013-0000-PROCESS-ABEND                13150003
131500         END-EVALUATE                                             13160003
131600     END-PERFORM.                                                 13170003
131700                                                                  13180003
131800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     13190003
131900        SQLCODE NOT = +0                                          13200003
132000         MOVE '4050-SELECT-TSHPTPO'  TO DP013-PARAGRAPH           13210003
132100         MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '                  13220003
132200                                     TO DP013-MESSAGE-TEXT (1)    13230003
132300         MOVE DK-PO-NBR              TO DP013-MESSAGE-TEXT (2)    13240003
132400         MOVE DK-SHIPT-ID            TO DP013-MESSAGE-TEXT (3)    13250003
132500         MOVE SQLCA                  TO DP013-SQLCA               13260003
132600         MOVE 'TSHPTPO '             TO DP013-DB2-TABLE-NAME (1)  13270003
132700         SET DP013-DB2-ABEND                                      13280003
132800             DP013-XCTL-DISPLAY-RESTART                           13290003
132900                                     TO TRUE                      13300003
133000         PERFORM DP013-0000-PROCESS-ABEND                         13310003
133100     END-IF.                                                      13320003
133200                                                                  13330003
133300*----------------------------------------------------------------*13340003
133400*    GET THE VENDOR NAME                                         *13350003
133500*----------------------------------------------------------------*13360003
133600 4060-GET-ENT-NAME.                                               13370003
133700                                                                  13380003
133800     PERFORM                                                      13390003
133900         WITH TEST AFTER                                          13400003
134000         VARYING PV-RETRY-COUNTER                                 13410003
134100         FROM 1 BY 1                                              13420003
134200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13430003
134300             OR (SQLCODE = +0)                                    13440003
134400             OR (SQLCODE = +100))                                 13450003
134500                                                                  13460003
134600         EXEC SQL                                                 13470003
134700              SELECT                                              13480003
134800                     ENT_NAME_DESC                                13490003
134900                   , STATUS_CDE                                   13500003
135000                   , NEW_STR_PO_IND                               13510003
135100                INTO                                              13520003
135200                     :ENTNME-ENT-NAME-DESC                        13530003
135300                   , :PURCHS-STATUS-CDE                           13540003
135400                   , :PURCHS-NEW-STR-PO-IND                       13550003
135500                FROM TPURCHS A                                    13560003
135600                    ,TENTNME B                                    13570003
135700               WHERE A.PO_NBR         = :DK-PO-NBR                13580003
135800                 AND A.VER_STATUS_CDE = 'A'                       13590003
135900                 AND B.TYPE_CDE       = '01'                      13600003
136000                 AND A.ENT_ID = B.ENT_ID                          13610003
136100         END-EXEC                                                 13620003
136200                                                                  13630003
136300         EVALUATE TRUE                                            13640003
136400             WHEN SQLCODE = +0                                    13650003
136500             WHEN SQLCODE = -904                                  13660003
136600             WHEN SQLCODE = -913                                  13670003
136700                  MOVE ENTNME-ENT-NAME-DESC                       13680003
136800                                  TO ASC-VENDOR-NME               13690003
136900             WHEN SQLCODE = +100                                  13700003
137000                  MOVE SPACES     TO ASC-VENDOR-NME               13710003
137100             WHEN SQLWARN0 NOT = SPACES                           13720003
137200             WHEN SQLCODE < +0                                    13730003
137300             WHEN SQLCODE > +0                                    13740003
137400                  MOVE '4060-GET-ENT-NAME'                        13750003
137500                                  TO DP013-PARAGRAPH              13760003
137600                  MOVE 'UNSUCCESSFUL SELECT ON TENTNME TABLE'     13770003
137700                                  TO DP013-MESSAGE-TEXT (1)       13780003
137800                  MOVE DK-SHIPT-ID TO DP013-MESSAGE-TEXT (2)      13790003
137900                  MOVE SQLCA      TO DP013-SQLCA                  13800003
138000                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     13810003
138100                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     13820003
138200                  SET DP013-DB2-ABEND                             13830003
138300                      DP013-XCTL-DISPLAY-RESTART                  13840003
138400                                  TO TRUE                         13850003
138500                  PERFORM DP013-0000-PROCESS-ABEND                13860003
138600         END-EVALUATE                                             13870003
138700     END-PERFORM.                                                 13880003
138800                                                                  13890003
138900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    13900003
139000        SQLCODE NOT = +0                                          13910003
139100         MOVE '4060-GET-ENT-NAME  '                               13920003
139200                                  TO DP013-PARAGRAPH              13930003
139300         MOVE 'MAX RETRIES EXCEEDED ON SELECT TENTNME TABLE'      13940003
139400                                  TO DP013-MESSAGE-TEXT (1)       13950003
139500         MOVE SQLCA               TO DP013-SQLCA                  13960003
139600         MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)     13970003
139700         MOVE 'TENTNME'           TO DP013-DB2-TABLE-NAME (2)     13980003
139800         SET DP013-DB2-ABEND                                      13990003
139900             DP013-XCTL-DISPLAY-RESTART                           14000003
140000                                  TO TRUE                         14010003
140100         PERFORM DP013-0000-PROCESS-ABEND                         14020003
140200     END-IF.                                                      14030003
140300                                                                  14040003
140400                                                                  14050003
140500*----------------------------------------------------------------*14060003
140600* SELECT THE VENDOR SHIP DATE.                                   *14070003
140700*----------------------------------------------------------------*14080003
140800                                                                  14090003
140900 4070-SELECT-VND-SHIP-DTE.                                        14100003
141000     PERFORM                                                      14110003
141100         WITH TEST AFTER                                          14120003
141200         VARYING PV-RETRY-COUNTER                                 14130003
141300         FROM 1 BY 1                                              14140003
141400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14150003
141500                   OR (SQLCODE = ZERO))                           14160003
141600                                                                  14170003
141700                                                                  14180003
141800         EXEC SQL                                                 14190003
141900              SELECT                                              14200003
142000                       VEND_SHIP_DTE                              14210003
142100              INTO                                                14220003
142200                      :SHIPMT-VEND-SHIP-DTE                       14230003
142300              FROM                                                14240003
142400                       TSHIPMT                                    14250003
142500              WHERE                                               14260003
142600                       SHIPT_ID = :DK-SHIPT-ID                    14270003
142700         END-EXEC                                                 14280003
142800                                                                  14290003
142900         EVALUATE TRUE                                            14300003
143000             WHEN SQLCODE = ZERO                                  14310003
143100             WHEN SQLCODE = -904                                  14320003
143200             WHEN SQLCODE = -913                                  14330003
143300                 CONTINUE                                         14340003
143400             WHEN SQLWARN0 NOT = SPACES                           14350003
143500             WHEN SQLCODE < ZERO                                  14360003
143600             WHEN SQLCODE > ZERO                                  14370003
143700                 MOVE '4070-SELECT-VND-SHIP-DTE'                  14380003
143800                                   TO DP013-PARAGRAPH             14390003
143900                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             14400003
144000                                   TO DP013-MESSAGE-TEXT (1)      14410003
144100                 MOVE SQLCA        TO DP013-SQLCA                 14420003
144200                 MOVE 'TSHPTMT '   TO DP013-DB2-TABLE-NAME (1)    14430003
144300                 SET DP013-DB2-ABEND                              14440003
144400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14450003
144500                 PERFORM DP013-0000-PROCESS-ABEND                 14460003
144600         END-EVALUATE                                             14470003
144700     END-PERFORM.                                                 14480003
144800*                                                                 14490003
144900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    14500003
145000        SQLCODE NOT = +0                                          14510003
145100         MOVE '4070-SELECT-VND-SHIP-DTE'                          14520003
145200                                   TO DP013-PARAGRAPH             14530003
145300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING SELECT     '   14540003
145400                                   TO DP013-MESSAGE-TEXT (1)      14550003
145500         MOVE SQLCA                TO DP013-SQLCA                 14560003
145600         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    14570003
145700         SET DP013-DB2-ABEND                                      14580003
145800             DP013-XCTL-DISPLAY-RESTART                           14590003
145900                                   TO TRUE                        14600003
146000         PERFORM DP013-0000-PROCESS-ABEND                         14610003
146100     END-IF.                                                      14620003
146200                                                                  14630003
146300 EJECT                                                            14640003
146400                                                                  14650003
146500                                                                  14660003
146600 4100-OPEN-PO-CSR.                                                14670003
146700                                                                  14680003
146800     PERFORM                                                      14690003
146900         WITH TEST AFTER                                          14700003
147000         VARYING PV-RETRY-COUNTER                                 14710003
147100         FROM 1 BY 1                                              14720003
147200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14730003
147300            OR (SQLCODE = +0))                                    14740003
147400*                                                                 14750003
147500         EXEC SQL                                                 14760003
147600              OPEN PO_CSR                                         14770003
147700         END-EXEC                                                 14780003
147800                                                                  14790003
147900         EVALUATE TRUE                                            14800003
148000             WHEN SQLCODE = +0                                    14810003
148100                  CONTINUE                                        14820003
148200             WHEN SQLCODE = -904                                  14830003
148300             WHEN SQLCODE = -913                                  14840003
148400                  CONTINUE                                        14850003
148500             WHEN SQLWARN0 NOT = SPACE                            14860003
148600             WHEN SQLCODE  NOT = +0                               14870003
148700                  MOVE '4100-OPEN-PO-CSR'                         14880003
148800                                   TO DP013-PARAGRAPH             14890003
148900                  MOVE 'OPEN PO CURSOR'                           14900003
149000                                   TO DP013-MESSAGE-TEXT (1)      14910003
149100                  MOVE SQLCA       TO DP013-SQLCA                 14920003
149200                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    14930003
149300                  SET DP013-DB2-ABEND                             14940003
149400                                   TO TRUE                        14950003
149500                  PERFORM DP013-0000-PROCESS-ABEND                14960003
149600         END-EVALUATE                                             14970003
149700     END-PERFORM.                                                 14980003
149800                                                                  14990003
149900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    15000003
150000        SQLCODE NOT = +0                                          15010003
150100         MOVE '4100-OPEN-PO-CSR' TO DP013-PARAGRAPH               15020003
150200         MOVE 'MAX RETRIES EXCEEDED FOR OPEN PO CURSOR'           15030003
150300                                   TO DP013-MESSAGE-TEXT (1)      15040003
150400         MOVE SQLCA                TO DP013-SQLCA                 15050003
150500         SET DP013-DB2-ABEND       TO TRUE                        15060003
150600         PERFORM DP013-0000-PROCESS-ABEND                         15070003
150700     END-IF.                                                      15080003
150800                                                                  15090003
150900 4110-FETCH-PO-CSR.                                               15100003
151000                                                                  15110003
151100     EXEC SQL                                                     15120003
151200          FETCH PO_CSR                                            15130003
151300          INTO :PURITM-PO-LNE-NBR                                 15140003
151400     END-EXEC                                                     15150003
151500                                                                  15160003
151600     EVALUATE TRUE                                                15170003
151700         WHEN SQLCODE = +0                                        15180003
151800              CONTINUE                                            15190003
151900                                                                  15200003
152000         WHEN SQLCODE = +100                                      15210003
152100              SET PS-DONE TO TRUE                                 15220003
152200                                                                  15230003
152300         WHEN SQLWARN0 NOT = SPACE                                15240003
152400         WHEN SQLCODE < +0                                        15250003
152500         WHEN SQLCODE > +0                                        15260003
152600              MOVE '4110-FETCH-PO-CSR'                            15270003
152700                                   TO DP013-PARAGRAPH             15280003
152800              MOVE 'FETCH PO CURSOR'                              15290003
152900                                   TO DP013-MESSAGE-TEXT (1)      15300003
153000              MOVE SQLCA           TO DP013-SQLCA                 15310003
153100              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    15320003
153200              SET DP013-DB2-ABEND  TO TRUE                        15330003
153300              PERFORM DP013-0000-PROCESS-ABEND                    15340003
153400     END-EVALUATE.                                                15350003
153500                                                                  15360003
153600                                                                  15370003
153700 4120-PROCESS-PO-CSR.                                             15380003
153800                                                                  15390003
153900     PERFORM                                                      15400003
154000         WITH TEST AFTER                                          15410003
154100         VARYING PV-RETRY-COUNTER                                 15420003
154200         FROM 1 BY 1                                              15430003
154300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15440003
154400            OR  (SQLCODE = +100)                                  15450003
154500            OR  (SQLCODE = +0))                                   15460003
154600                                                                  15470003
154700         EXEC SQL                                                 15480003
154800            SELECT  PLAN_NBR                                      15490003
154900            INTO   :ALLPLN-PLAN-NBR                               15500003
155000            FROM    TALLPLN                                       15510003
155100            WHERE   PO_NBR     = :DK-PO-NBR                       15520003
155200            AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR               15530003
155300            AND     DEST_NBR   = :PV-OPER-UNT-ID                  15540003
155400            AND     STATUS_CDE = :PC-PO-ACTIVE                    15550003
155500         END-EXEC                                                 15560003
155600                                                                  15570003
155700         EVALUATE TRUE                                            15580003
155800             WHEN SQLCODE = -904                                  15590003
155900             WHEN SQLCODE = -913                                  15600003
156000                  CONTINUE                                        15610003
156100                                                                  15620003
156200             WHEN SQLCODE = +0                                    15630003
156300                  SET PS-DISTRO         TO TRUE                   15640003
156400                                                                  15650003
156500             WHEN SQLCODE = +100                                  15660003
156600                  SET PS-NO-DISTRO      TO TRUE                   15670003
156700                                                                  15680003
156800             WHEN SQLWARN0 NOT = SPACE                            15690003
156900             WHEN SQLCODE < +0                                    15700003
157000             WHEN SQLCODE > +0                                    15710003
157100                  MOVE '4120-PROCESS-PO-CSR '                     15720003
157200                                   TO DP013-PARAGRAPH             15730003
157300                  MOVE 'SELECT ON TALLPLN'                        15740003
157400                                   TO DP013-MESSAGE-TEXT (1)      15750003
157500                  MOVE SQLCA       TO DP013-SQLCA                 15760003
157600                  MOVE 'TALLPLN'   TO DP013-DB2-TABLE-NAME (1)    15770003
157700                  SET DP013-DB2-ABEND                             15780003
157800                      DP013-XCTL-DISPLAY-RESTART                  15790003
157900                                   TO TRUE                        15800003
158000                  PERFORM DP013-0000-PROCESS-ABEND                15810003
158100         END-EVALUATE                                             15820003
158200     END-PERFORM.                                                 15830003
158300                                                                  15840003
158400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    15850003
158500        SQLCODE NOT = +0                                          15860003
158600         MOVE '4120-PROCESS-PO-CSR '                              15870003
158700                                   TO DP013-PARAGRAPH             15880003
158800         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   15890003
158900                                   TO DP013-MESSAGE-TEXT (1)      15900003
159000         MOVE 'ON TABLE TALLPLN '  TO DP013-MESSAGE-TEXT (2)      15910003
159100         MOVE SQLCA                TO DP013-SQLCA                 15920003
159200         SET DP013-DB2-ABEND                                      15930003
159300             DP013-XCTL-DISPLAY-RESTART                           15940003
159400                                   TO TRUE                        15950003
159500         PERFORM DP013-0000-PROCESS-ABEND                         15960003
159600     END-IF.                                                      15970003
159700                                                                  15980003
159800                                                                  15990003
159900     IF PS-DISTRO                                                 16000003
160000        PERFORM                                                   16010003
160100            WITH TEST AFTER                                       16020003
160200            VARYING PV-RETRY-COUNTER                              16030003
160300            FROM 1 BY 1                                           16040003
160400            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            16050003
160500               OR  (SQLCODE = +100)                               16060003
160600               OR  (SQLCODE = -811)                               16070003
160700               OR  (SQLCODE = +0))                                16080003
160800                                                                  16090003
160900            EXEC SQL                                              16100003
161000               SELECT  PO_NBR                                     16110003
161100               INTO   :MESTDS-PO-NBR                              16120003
161200               FROM    TMESTDS                                    16130003
161300               WHERE   PO_NBR     = :DK-PO-NBR                    16140003
161400               AND     PO_LNE_NBR = :PURITM-PO-LNE-NBR            16150003
161500               AND     PLAN_NBR   = :ALLPLN-PLAN-NBR              16160003
161600            END-EXEC                                              16170003
161700                                                                  16180003
161800            EVALUATE TRUE                                         16190003
161900                WHEN SQLCODE = -904                               16200003
162000                WHEN SQLCODE = -913                               16210003
162100                     CONTINUE                                     16220003
162200                                                                  16230003
162300                WHEN SQLCODE = +0                                 16240003
162400                WHEN SQLCODE = -811                               16250003
162500                     SET PS-DISTRO         TO TRUE                16260003
162600                                                                  16270003
162700                WHEN SQLCODE = +100                               16280003
162800                     SET PS-NO-DISTRO      TO TRUE                16290003
162900                                                                  16300003
163000                WHEN SQLWARN0 NOT = SPACE                         16310003
163100                WHEN SQLCODE < +0                                 16320003
163200                WHEN SQLCODE > +0                                 16330003
163300                     MOVE '4120-PROCESS-PO-CSR '                  16340003
163400                                      TO DP013-PARAGRAPH          16350003
163500                     MOVE 'SELECT ON TMESTDS'                     16360003
163600                                      TO DP013-MESSAGE-TEXT (1)   16370003
163700                     MOVE SQLCA       TO DP013-SQLCA              16380003
163800                     MOVE 'TMESTDS'   TO DP013-DB2-TABLE-NAME (1) 16390003
163900                     SET DP013-DB2-ABEND                          16400003
164000                         DP013-XCTL-DISPLAY-RESTART               16410003
164100                                      TO TRUE                     16420003
164200                     PERFORM DP013-0000-PROCESS-ABEND             16430003
164300            END-EVALUATE                                          16440003
164400        END-PERFORM                                               16450003
164500                                                                  16460003
164600        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                 16470003
164700            SQLCODE NOT = +0                                      16480003
164800            MOVE '4120-PROCESS-PO-CSR '                           16490003
164900                                      TO DP013-PARAGRAPH          16500003
165000            MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                16510003
165100                                      TO DP013-MESSAGE-TEXT (1)   16520003
165200            MOVE 'ON TABLE TMESTDS '  TO DP013-MESSAGE-TEXT (2)   16530003
165300            MOVE SQLCA                TO DP013-SQLCA              16540003
165400            SET DP013-DB2-ABEND                                   16550003
165500                DP013-XCTL-DISPLAY-RESTART                        16560003
165600                                      TO TRUE                     16570003
165700            PERFORM DP013-0000-PROCESS-ABEND                      16580003
165800        END-IF                                                    16590003
165900     END-IF.                                                      16600003
166000                                                                  16610003
166100     IF PS-NO-DISTRO                                              16620003
166200        SET PS-DISPLAY-DISTRO-MSG TO TRUE                         16630003
166300        SET PS-DONE TO TRUE                                       16640003
166400     ELSE                                                         16650003
166500        PERFORM 4110-FETCH-PO-CSR                                 16660003
166600     END-IF.                                                      16670003
166700                                                                  16680003
166800                                                                  16690003
166900*                                                                 16700003
167000 EJECT                                                            16710003
167100*----------------------------------------------------------------*16720003
167200*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *16730003
167300*----------------------------------------------------------------*16740003
167400                                                                  16750003
167500 4400-MOVE-COMMAREA-TO-SCREEN.                                    16760003
167600                                                                  16770003
167700     MOVE ASC-KEY-PO-NBR         TO APONBRO.                      16780003
167800     MOVE ASC-KEY-OPER-UNT-ID    TO AOPERIDO.                     16790003
167900     MOVE ASC-KEY-FCLTY-ID       TO AFCLTYO.                      16800003
168000     MOVE ASC-KEY-FCLTY-NME      TO AOPRDESO.                     16810003
168100     MOVE ASC-PRO-NBR            TO AFBILLO.                      16820003
168200     MOVE ASC-BOL-NBR            TO ABOLO.                        16830003
168300     MOVE ASC-EXPTED-CART-CNT-N  TO AEXPCNTO.                     16840003
168400     MOVE ASC-DEPT-NBR-N         TO ADPTNBRO.                     16850006
168500     MOVE ASC-NO-DISTRO-MSG      TO ANODISTO.                     16860003
168600     MOVE ASC-PO-STATUS-DESC     TO APOSTATO.                     16870003
168700                                                                  16880003
168800     IF ASC-DONT-SHIP-BEF-DTE = '01/01/0001'                      16890003
168900         MOVE SPACES             TO ADNSDTEO                      16900003
169000     ELSE                                                         16910003
169100         MOVE ASC-DONT-SHIP-BEF-DTE                               16920003
169200                                 TO ADNSDTEO                      16930003
169300     END-IF                                                       16940003
169400                                                                  16950003
169500     IF ASC-CANCEL-DTE = '01/01/0001'                             16960003
169600         MOVE SPACES             TO ACANDTEO                      16970003
169700     ELSE                                                         16980003
169800         MOVE ASC-CANCEL-DTE     TO ACANDTEO                      16990003
169900     END-IF                                                       17000003
170000                                                                  17010003
170100     IF ASC-EXT-CAN-DTE = '01/01/0001'                            17020003
170200         MOVE SPACES             TO AEXCDTEO                      17030003
170300     ELSE                                                         17040003
170400         MOVE ASC-EXT-CAN-DTE    TO AEXCDTEO                      17050003
170500     END-IF                                                       17060003
170600                                                                  17070003
170700     MOVE ASC-BUYER-NME          TO ABYRNMEO.                     17080003
170800     MOVE ASC-ASN-CART-CNT       TO AASNCNTO.                     17090003
170900     MOVE ASC-FOR-CART-CNT       TO AFORCNTO.                     17100003
171000     MOVE ASC-PACKSLIP-IND       TO APCKSLPO.                     17110003
171100     MOVE ASC-VENDOR-NME         TO AVNDNMEO.                     17120003
171200                                                                  17130003
171300 EJECT                                                            17140003
171400*----------------------------------------------------------------*17150003
171500* UPDATE THE ROW ON TSHTPO                                       *17160003
171600*----------------------------------------------------------------*17170003
171700 5000-UPDATE-TSHPTPO.                                             17180003
171800                                                                  17190003
171900     PERFORM WITH TEST AFTER                                      17200003
172000         VARYING PV-RETRY-COUNTER                                 17210003
172100         FROM 1 BY 1                                              17220003
172200         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 17230003
172300                 OR SQLCODE = 0)                                  17240003
172400                                                                  17250003
172500         EXEC SQL                                                 17260003
172600             SELECT                                               17270003
172700                    EXPTED_CART_CNT                               17280003
172800             INTO                                                 17290003
172900                   :SHPTPO-EXPTED-CART-CNT                        17300003
173000             FROM                                                 17310003
173100                    TSHPTPO                                       17320003
173200             WHERE                                                17330003
173300                    PO_NBR           = :DK-PO-NBR                 17340003
173400               AND  SHIPT_ID         = :DK-SHIPT-ID               17350003
173500         END-EXEC                                                 17360003
173600                                                                  17370003
173700         EVALUATE TRUE                                            17380003
173800             WHEN SQLCODE = +0                                    17390003
173900                  CONTINUE                                        17400003
174000                                                                  17410003
174100             WHEN SQLCODE = -904                                  17420003
174200             WHEN SQLCODE = -911                                  17430003
174300             WHEN SQLCODE = -913                                  17440003
174400                  CONTINUE                                        17450003
174500                                                                  17460003
174600             WHEN OTHER                                           17470003
174700                  MOVE '5000-UPDATE-TSHPTPO'                      17480003
174800                                  TO DP013-PARAGRAPH              17490003
174900                  MOVE 'UNSUCCESSFUL SELECT OF TSHPTPO  '         17500003
175000                                  TO DP013-MESSAGE-TEXT (1)       17510003
175100                  MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)       17520003
175200                  MOVE DK-SHIPT-ID                                17530003
175300                                  TO DP013-MESSAGE-TEXT (3)       17540003
175400                  MOVE SQLCA      TO DP013-SQLCA                  17550003
175500                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     17560003
175600                  SET DP013-DB2-ABEND                             17570003
175700                      DP013-XCTL-DISPLAY-RESTART                  17580003
175800                                  TO TRUE                         17590003
175900                  PERFORM DP013-0000-PROCESS-ABEND                17600003
176000         END-EVALUATE                                             17610003
176100     END-PERFORM.                                                 17620003
176200                                                                  17630003
176300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     17640003
176400        SQLCODE NOT = +0                                          17650003
176500         MOVE '5000-UPDATE-TSHPTPO'  TO DP013-PARAGRAPH           17660003
176600         MOVE 'UNSUCCESSFUL SELECT OF TSHPTPO  '                  17670003
176700                                     TO DP013-MESSAGE-TEXT (1)    17680003
176800         MOVE DK-PO-NBR              TO DP013-MESSAGE-TEXT (2)    17690003
176900         MOVE DK-SHIPT-ID            TO DP013-MESSAGE-TEXT (3)    17700003
177000         MOVE SQLCA                  TO DP013-SQLCA               17710003
177100         MOVE 'TSHPTPO '             TO DP013-DB2-TABLE-NAME (1)  17720003
177200         SET DP013-DB2-ABEND                                      17730003
177300             DP013-XCTL-DISPLAY-RESTART                           17740003
177400                                     TO TRUE                      17750003
177500         PERFORM DP013-0000-PROCESS-ABEND                         17760003
177600     END-IF.                                                      17770003
177700                                                                  17780003
177800     MOVE ASC-EXPTED-CART-CNT-N TO DK-EXPTED-CART-CNT.            17790003
177900                                                                  17800003
178000     PERFORM WITH TEST AFTER                                      17810003
178100         VARYING PV-RETRY-COUNTER                                 17820003
178200         FROM 1 BY 1                                              17830003
178300         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES                 17840003
178400                 OR SQLCODE = 0)                                  17850003
178500                                                                  17860003
178600         EXEC SQL                                                 17870003
178700             UPDATE TSHPTPO                                       17880003
178800                SET PKSL_IND         = :ASC-PACKSLIP-IND          17890003
178900                  , EXPTED_CART_CNT  = :DK-EXPTED-CART-CNT        17900003
179000                  , LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME   17910003
179100                  , LAST_UPD_DTE     =  CURRENT DATE              17920003
179200                  , LAST_UPD_TIME    =  CURRENT TIME              17930003
179300                  , LAST_UPD_USER_ID = :DP020-USERID              17940003
179400             WHERE  PO_NBR           = :DK-PO-NBR                 17950003
179500             AND    SHIPT_ID         = :DK-SHIPT-ID               17960003
179600         END-EXEC                                                 17970003
179700                                                                  17980003
179800         EVALUATE TRUE                                            17990003
179900             WHEN SQLCODE = +0                                    18000003
180000                  CONTINUE                                        18010003
180100                                                                  18020003
180200             WHEN SQLCODE = -904                                  18030003
180300             WHEN SQLCODE = -911                                  18040003
180400             WHEN SQLCODE = -913                                  18050003
180500                  CONTINUE                                        18060003
180600                                                                  18070003
180700             WHEN OTHER                                           18080003
180800                  MOVE '5000-UPDATE-TSHPTPO'                      18090003
180900                                  TO DP013-PARAGRAPH              18100003
181000                  MOVE 'UNSUCCESSFUL UPDATE OF TSHPTPO  '         18110003
181100                                  TO DP013-MESSAGE-TEXT (1)       18120003
181200                  MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)       18130003
181300                  MOVE DK-SHIPT-ID                                18140003
181400                                  TO DP013-MESSAGE-TEXT (3)       18150003
181500                  MOVE SQLCA      TO DP013-SQLCA                  18160003
181600                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     18170003
181700                  SET DP013-DB2-ABEND                             18180003
181800                      DP013-XCTL-DISPLAY-RESTART                  18190003
181900                                  TO TRUE                         18200003
182000                  PERFORM DP013-0000-PROCESS-ABEND                18210003
182100         END-EVALUATE                                             18220003
182200     END-PERFORM.                                                 18230003
182300                                                                  18240003
182400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND                     18250003
182500        SQLCODE NOT = +0                                          18260003
182600         MOVE '5000-UPDATE-TSHPTPO'  TO DP013-PARAGRAPH           18270003
182700         MOVE 'UNSUCCESSFUL UPDATE ON TSHPTPO  '                  18280003
182800                                     TO DP013-MESSAGE-TEXT (1)    18290003
182900         MOVE DK-PO-NBR              TO DP013-MESSAGE-TEXT (2)    18300003
183000         MOVE DK-SHIPT-ID            TO DP013-MESSAGE-TEXT (3)    18310003
183100         MOVE SQLCA                  TO DP013-SQLCA               18320003
183200         MOVE 'TSHPTPO '             TO DP013-DB2-TABLE-NAME (1)  18330003
183300         SET DP013-DB2-ABEND                                      18340003
183400             DP013-XCTL-DISPLAY-RESTART                           18350003
183500                                     TO TRUE                      18360003
183600         PERFORM DP013-0000-PROCESS-ABEND                         18370003
183700     END-IF.                                                      18380003
183800                                                                  18390003
183900     PERFORM 5100-AUDIT-TSHPTPO.                                  18400003
184000                                                                  18410003
184100***************************************************************** 18420003
184200*     INSERT A COPY OF THE SHPTPO ROW TO THE AUDIT TRAIL TABLE  * 18430003
184300*     AFTER INSERTING THE SHPTPO TABLE.                        *  18440003
184400***************************************************************** 18450003
184500                                                                  18460003
184600 5100-AUDIT-TSHPTPO.                                              18470003
184700                                                                  18480003
184800     PERFORM                                                      18490003
184900         WITH TEST AFTER                                          18500003
185000         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     18510003
185100         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            18520003
185200                (SQLCODE = ZERO)   OR                             18530003
185300                (SQLCODE = +100)                                  18540003
185400                                                                  18550003
185500         EXEC SQL                                                 18560003
185600             SELECT SHIPT_ID,                                     18570003
185700                    PO_NBR,                                       18580003
185900                    REC_SEQ_NBR,                                  18600003
186000                    EXPTED_CART_CNT,                              18610003
186100                    ACTL_CART_CNT,                                18620003
186200                    DMG_CART_CNT,                                 18630003
186300                    PKSL_IND,                                     18640003
186400                    VEND_NAME,                                    18650003
186500                    FRGT_CHG_AMT,                                 18660003
186600                    LAST_UPD_PGM_ID,                              18670003
186700                    CRE_USER_ID,                                  18680003
186800                    CARR_CART_CT,                                 18690003
186900                    CARR_LAST_UPD_DTE,                            18700003
187000                    CARR_LAST_UPD_TIME,                           18710003
187100                    VEND_CART_CT,                                 18720003
187200                    VEND_LAST_UPD_DTE,                            18730003
187300                    VEND_LAST_UPD_TIME,                           18740003
187400                    CRE_TMST,                                     18750003
187500                    LAST_UPD_DTE,                                 18760003
187600                    LAST_UPD_TIME,                                18770003
187700                    LAST_UPD_USER_ID,                             18780003
187800                    PRIM_SHIPT_IND                                18790003
187810                  , SPLT_XMIT_IND                                 18800003
187820                  , SPLT_XMIT_DTE                                 18810003
187830                  , SPLT_XMIT_TM                                  18820003
187900               INTO :SHPTPO-SHIPT-ID,                             18830003
188000                    :SHPTPO-PO-NBR,                               18840003
188200                    :SHPTPO-REC-SEQ-NBR,                          18860003
188300                    :SHPTPO-EXPTED-CART-CNT,                      18870003
188400                    :SHPTPO-ACTL-CART-CNT,                        18880003
188500                    :SHPTPO-DMG-CART-CNT,                         18890003
188600                    :SHPTPO-PKSL-IND,                             18900003
188700                    :SHPTPO-VEND-NAME,                            18910003
188800                    :SHPTPO-FRGT-CHG-AMT,                         18920003
188900                    :SHPTPO-LAST-UPD-PGM-ID,                      18930003
189000                    :SHPTPO-CRE-USER-ID,                          18940003
189100                    :SHPTPO-CARR-CART-CT,                         18950003
189200                    :SHPTPO-CARR-LAST-UPD-DTE,                    18960003
189300                    :SHPTPO-CARR-LAST-UPD-TIME,                   18970003
189400                    :SHPTPO-VEND-CART-CT,                         18980003
189500                    :SHPTPO-VEND-LAST-UPD-DTE,                    18990003
189600                    :SHPTPO-VEND-LAST-UPD-TIME,                   19000003
189700                    :SHPTPO-CRE-TMST,                             19010003
189800                    :SHPTPO-LAST-UPD-DTE,                         19020003
189900                    :SHPTPO-LAST-UPD-TIME,                        19030003
190000                    :SHPTPO-LAST-UPD-USER-ID,                     19040003
190100                    :SHPTPO-PRIM-SHIPT-IND                        19050003
190110                  , :SHPTPO-SPLT-XMIT-IND                         19060003
190120                  , :SHPTPO-SPLT-XMIT-DTE                         19070003
190130                  , :SHPTPO-SPLT-XMIT-TM                          19080003
190200               FROM TSHPTPO                                       19090003
190300              WHERE  PO_NBR           = :DK-PO-NBR                19100003
190400                AND  SHIPT_ID         = :DK-SHIPT-ID              19110003
190500         END-EXEC                                                 19120003
190600                                                                  19130003
190700         EVALUATE TRUE                                            19140003
190800             WHEN SQLCODE = ZERO                                  19150003
190900             WHEN SQLCODE = +100                                  19160003
191000             WHEN SQLCODE = -904                                  19170003
191100             WHEN SQLCODE = -913                                  19180003
191200                 CONTINUE                                         19190003
191300                                                                  19200003
191400             WHEN SQLWARN0 NOT = SPACE                            19210003
191500             WHEN SQLCODE  NOT = +0                               19220003
191600                  MOVE '5100-AUDIT-SHPTPO'                        19230003
191700                                   TO DP013-PARAGRAPH             19240003
191800                  MOVE 'SELECT SHPPTPO DATA'                      19250003
191900                                   TO DP013-MESSAGE-TEXT (1)      19260003
192000                  MOVE DK-PO-NBR   TO DP013-MESSAGE-TEXT (2)      19270003
192100                  MOVE DK-SHIPT-ID TO DP013-MESSAGE-TEXT (3)      19280003
192200                  MOVE SQLCA       TO DP013-SQLCA                 19290003
192300                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (1)    19300003
192400                  SET DP013-DB2-ABEND                             19310003
192500                                   TO TRUE                        19320003
192600                  PERFORM DP013-0000-PROCESS-ABEND                19330003
192700         END-EVALUATE                                             19340003
192800                                                                  19350003
192900     END-PERFORM.                                                 19360003
193000                                                                  19370003
193100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    19380003
193200         SQLCODE NOT = +0                                         19390003
193300         MOVE '5100-AUDIT-SHPTPO'                                 19400003
193400                                   TO DP013-PARAGRAPH             19410003
193500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT TSHPTPO'           19420003
193600                                   TO DP013-MESSAGE-TEXT (1)      19430003
193700         MOVE DK-PO-NBR            TO DP013-MESSAGE-TEXT (2)      19440003
193800         MOVE DK-SHIPT-ID          TO DP013-MESSAGE-TEXT (3)      19450003
193900         MOVE SQLCA                TO DP013-SQLCA                 19460003
194000         SET DP013-DB2-ABEND       TO TRUE                        19470003
194100         PERFORM DP013-0000-PROCESS-ABEND                         19480003
194200     END-IF.                                                      19490003
194300                                                                  19500003
194400     PERFORM                                                      19510003
194500         WITH TEST AFTER                                          19520003
194600         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     19530003
194700         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            19540003
194800                 SQLCODE = ZERO                                   19550003
194900                                                                  19560003
195000         EXEC SQL                                                 19570003
195100             INSERT INTO TAUSHPO                                  19580003
195200                   (SHIPT_ID,                                     19590003
195300                    PO_NBR,                                       19600003
195500                    REC_SEQ_NBR,                                  19620003
195600                    EXPTED_CART_CNT,                              19630003
195700                    ACTL_CART_CNT,                                19640003
195800                    DMG_CART_CNT,                                 19650003
195900                    PKSL_IND,                                     19660003
196000                    VEND_NAME,                                    19670003
196100                    FRGT_CHG_AMT,                                 19680003
196200                    LAST_UPD_PGM_ID,                              19690003
196300                    CRE_USER_ID,                                  19700003
196400                    CARR_CART_CT,                                 19710003
196500                    CARR_LAST_UPD_DTE,                            19720003
196600                    CARR_LAST_UPD_TIME,                           19730003
196700                    VEND_CART_CT,                                 19740003
196800                    VEND_LAST_UPD_DTE,                            19750003
196900                    VEND_LAST_UPD_TIME,                           19760003
197000                    CRE_TMST,                                     19770003
197100                    LAST_UPD_DTE,                                 19780003
197200                    LAST_UPD_TIME,                                19790003
197300                    LAST_UPD_USER_ID,                             19800003
197400                    PRIM_SHIPT_IND                                19810003
197410                  , SPLT_XMIT_IND                                 19820003
197420                  , SPLT_XMIT_DTE                                 19830003
197430                  , SPLT_XMIT_TM                                  19840003
197440                  , TRN_CDE )                                     19850003
197500             VALUES                                               19860003
197600                  (:SHPTPO-SHIPT-ID,                              19870003
197700                   :SHPTPO-PO-NBR,                                19880003
197900                   :SHPTPO-REC-SEQ-NBR,                           19900003
198000                   :SHPTPO-EXPTED-CART-CNT,                       19910003
198100                   :SHPTPO-ACTL-CART-CNT,                         19920003
198200                   :SHPTPO-DMG-CART-CNT,                          19930003
198300                   :SHPTPO-PKSL-IND,                              19940003
198400                   :SHPTPO-VEND-NAME,                             19950003
198500                   :SHPTPO-FRGT-CHG-AMT,                          19960003
198600                   :SHPTPO-LAST-UPD-PGM-ID,                       19970003
198700                   :SHPTPO-CRE-USER-ID,                           19980003
198800                   :SHPTPO-CARR-CART-CT,                          19990003
198900                   :SHPTPO-CARR-LAST-UPD-DTE,                     20000003
199000                   :SHPTPO-CARR-LAST-UPD-TIME,                    20010003
199100                   :SHPTPO-VEND-CART-CT,                          20020003
199200                   :SHPTPO-VEND-LAST-UPD-DTE,                     20030003
199300                   :SHPTPO-VEND-LAST-UPD-TIME,                    20040003
199400                   :SHPTPO-CRE-TMST,                              20050003
199500                   :SHPTPO-LAST-UPD-DTE,                          20060003
199600                   :SHPTPO-LAST-UPD-TIME,                         20070003
199700                   :SHPTPO-LAST-UPD-USER-ID,                      20080003
199800                   :SHPTPO-PRIM-SHIPT-IND                         20090003
199810                 , :SHPTPO-SPLT-XMIT-IND                          20100003
199820                 , :SHPTPO-SPLT-XMIT-DTE                          20110003
199830                 , :SHPTPO-SPLT-XMIT-TM                           20120003
199840                 , :PC-U )                                        20130005
199900         END-EXEC                                                 20140003
200000                                                                  20150003
200100         EVALUATE TRUE                                            20160003
200200             WHEN SQLCODE = ZERO                                  20170003
200300             WHEN SQLCODE = -904                                  20180003
200400             WHEN SQLCODE = -913                                  20190003
200500                 CONTINUE                                         20200003
200600                                                                  20210003
200700             WHEN SQLWARN0 NOT = SPACE                            20220003
200800             WHEN SQLCODE  NOT = +0                               20230003
200900                  MOVE '5100-AUDIT-SHPTPO'                        20240003
201000                                   TO DP013-PARAGRAPH             20250003
201100                  MOVE 'INSERT TAUSHPO DATA'                      20260003
201200                                   TO DP013-MESSAGE-TEXT (1)      20270003
201300                  MOVE SQLCA       TO DP013-SQLCA                 20280003
201400                  MOVE 'TAUSHPO'   TO DP013-DB2-TABLE-NAME (1)    20290003
201500                  SET DP013-DB2-ABEND                             20300003
201600                                   TO TRUE                        20310003
201700                  PERFORM DP013-0000-PROCESS-ABEND                20320003
201800         END-EVALUATE                                             20330003
201900     END-PERFORM.                                                 20340003
202000                                                                  20350003
202100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    20360003
202200         SQLCODE NOT = +0                                         20370003
202300         MOVE '5100-AUDIT-SHPTPO'                                 20380003
202400                                   TO DP013-PARAGRAPH             20390003
202500         MOVE 'MAX RETRIES EXCEEDED FOR INSERT TAUSHPO'           20400003
202600                                   TO DP013-MESSAGE-TEXT (1)      20410003
202700         MOVE SQLCA                TO DP013-SQLCA                 20420003
202800         SET DP013-DB2-ABEND       TO TRUE                        20430003
202900         PERFORM DP013-0000-PROCESS-ABEND                         20440003
203000     END-IF.                                                      20450003
203100                                                                  20460003
203200 EJECT                                                            20470003
203300                                                                  20480003
203400/                                                                 20490003
203500*----------------------------------------------------------------*20500003
203600* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *20510003
203700*----------------------------------------------------------------*20520003
203800                                                                  20530003
203900 9100-READ-SEL-QUEUE.                                             20540003
204000     EXEC CICS                                                    20550003
204100         READQ TS                                                 20560003
204200             QUEUE (ASC-SEL-QUEUE-NAME)                           20570003
204300             INTO  (TR018-SHIPMENT-SELECT-RECORD)                 20580003
204400             ITEM  (ASC-SEL-ITEM)                                 20590003
204500             RESP  (PV-CICS-RESPONSE)                             20600003
204600     END-EXEC.                                                    20610003
204700                                                                  20620003
204800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   20630003
204900         CONTINUE                                                 20640003
205000     ELSE                                                         20650003
205100         SET DP013-LOGIC-ABEND                                    20660003
205200             DP013-NO-ROLLBACK     TO TRUE                        20670003
205300         MOVE '9100-READ-SEL-QUEUE'                               20680003
205400                                   TO DP013-PARAGRAPH             20690003
205500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   20700003
205600                                   TO DP013-MESSAGE-TEXT (1)      20710003
205700         PERFORM DP013-0000-PROCESS-ABEND                         20720003
205800     END-IF.                                                      20730003
205900                                                                  20740003
206000/                                                                 20750003
206100*----------------------------------------------------------------*20760003
206200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *20770003
206300*----------------------------------------------------------------*20780003
206400 9200-REWRITE-SEL-QUEUE.                                          20790003
206500     EXEC CICS                                                    20800003
206600          WRITEQ TS                                               20810003
206700              QUEUE  (ASC-SEL-QUEUE-NAME)                         20820003
206800              FROM   (TR018-SHIPMENT-SELECT-RECORD)               20830003
206900              ITEM   (ASC-SEL-ITEM)                               20840003
207000              RESP   (PV-CICS-RESPONSE)                           20850003
207100              REWRITE                                             20860003
207200     END-EXEC.                                                    20870003
207300                                                                  20880003
207400     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               20890003
207500         SET DP013-CICS-ABEND                                     20900003
207600             DP013-NO-ROLLBACK     TO TRUE                        20910003
207700         MOVE '9200-REWRITE-SEL-QUEUE'                            20920003
207800                                   TO DP013-PARAGRAPH             20930003
207900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   20940003
208000                                   TO DP013-MESSAGE-TEXT (1)      20950003
208100         PERFORM DP013-0000-PROCESS-ABEND                         20960003
208200     END-IF.                                                      20970003
208300                                                                  20980003
208400 EJECT                                                            20990003
208500*----------------------------------------------------------------*21000003
208600*    ABEND PROCESSOR MODULE                                      *21010003
208700*----------------------------------------------------------------*21020003
208800                                                                  21030003
208900     COPY DPPD013.                                                21040003
