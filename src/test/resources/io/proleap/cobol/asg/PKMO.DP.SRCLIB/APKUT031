000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKUT031.                                         00020000
000300 AUTHOR.        JEAN KURK.                                        00030000
000400 DATE-WRITTEN.  JULY 2022.                                        00040000
000500 DATE-COMPILED.                                                   00050000
000600***************************************************************** 00060000
000700* CREATE UNJOURNALIZED RECEIPTS DETAIL FILE FOR SEPHORA         * 00070001
022195***************************************************************** 00080000
022196 ENVIRONMENT DIVISION.                                            00090000
022197 CONFIGURATION SECTION.                                           00100000
022198 SOURCE-COMPUTER.        IBM-370.                                 00110000
022200 OBJECT-COMPUTER.        IBM-370.                                 00120000
022300                                                                  00130000
022400 INPUT-OUTPUT SECTION.                                            00140000
022500                                                                  00150000
022600 FILE-CONTROL.                                                    00160000
022700     SELECT AP-INPUT-FILE   ASSIGN TO INP01.                      00170000
022800     SELECT AP-OUTPUT-FILE  ASSIGN TO OUT01.                      00180000
022900                                                                  00190000
023000 DATA DIVISION.                                                   00200000
023100 FILE SECTION.                                                    00210000
023200                                                                  00220000
023300 FD  AP-INPUT-FILE                                                00230000
023400     RECORDING MODE IS F                                          00240000
023500     LABEL RECORDS ARE STANDARD                                   00250000
023600     BLOCK CONTAINS 0 RECORDS                                     00260000
023700     RECORD CONTAINS 120 CHARACTERS                               00270000
023800     DATA RECORD IS AP-INPUT-RECORD.                              00280000
023900                                                                  00290000
024000 01  AP-INPUT-RECORD           PIC X(120).                        00300000
024100                                                                  00310000
024200 FD  AP-OUTPUT-FILE                                               00320000
024300     RECORDING MODE IS F                                          00330000
024400     LABEL RECORDS ARE STANDARD                                   00340000
024500     BLOCK CONTAINS 0 RECORDS                                     00350000
024600     RECORD CONTAINS 73 CHARACTERS                                00360010
024700     DATA RECORD IS AP-OUTPUT-RECORD.                             00370000
024800                                                                  00380000
024900 01  AP-OUTPUT-RECORD          PIC X(73).                         00390010
025000                                                                  00400000
025200                                                                  00420000
025300 WORKING-STORAGE SECTION.                                         00430000
025400                                                                  00440000
025500 01  PROGRAM-SWITCHES.                                            00450000
025600     05  PS-AP-INPUT-EOF        PIC X(01)  VALUE 'N'.             00460000
025700         88  NOT-AP-INPUT-EOF              VALUE 'N'.             00470000
025800         88  AP-INPUT-EOF                  VALUE 'Y'.             00480000
026500                                                                  00490000
026600 01  HEADER-RECORD.                                               00500005
026700     05  HEADER-1                    PIC X(54)  VALUE             00510005
026800        'PO,STORE,SKU,DEPT,QTY VRFYD,TOT 1ST COST,TOT UNIT COST'. 00520000
026700     05  HEADER-2                    PIC X(25)  VALUE             00520106
026800        ',RECVD DT,VENDOR'.                                       00520209
027600                                                                  00530000
028200 01  PROGRAM-COUNTERS.                                            00540000
028300     05  COUNT-AP-INPUT-TOTAL        PIC 9(09)  VALUE 0.          00550000
028600                                                                  00570000
028700     05  COUNT-OUT-TOTAL             PIC 9(09)  VALUE 0.          00580000
091000     05  DK-PO-NBR                    PIC S9(09) VALUE +0         00590000
091100                                                 COMP.            00600000
091000     05  DK-PO-LNE-NBR                PIC S9(09) VALUE +0         00610000
091100                                                 COMP.            00620000
029700                                                                  00630000
029800 01  ABEND-CODE                      PIC S9(04) VALUE 0 COMP SYNC.00640000
030400     88  AC-DB2-ERROR                           VALUE  +4013.     00700000
030500     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     00710000
030800                                                                  00740000
030900 01  ABEND-AREAS.                                                 00750000
031000     05  AA-ABEND-LIT                PIC X(40)  VALUE             00760000
031100             '*****       ABEND'.                                 00770000
031200     05  AA-PROGRAM-LIT              PIC X(40)  VALUE             00780000
031300             '*****   PROGRAM: APKUT031'.                         00790000
031400     05  AA-PARAGRAPH-LIT.                                        00800000
031500         10  FILLER                  PIC X(17)  VALUE             00810000
031600             '***** PARAGRAPH: '.                                 00820000
031700         10  AA-PARAGRAPH-NAME       PIC X(35)  VALUE SPACES.     00830000
031800     05  AA-MESSAGE-LINE.                                         00840000
031900         10  FILLER                  PIC X(06)  VALUE '*****'.    00850000
032000         10  AA-MESSAGE              PIC X(127) VALUE SPACES.     00860000
032100         10  FILLER REDEFINES AA-MESSAGE.                         00870000
032200             15 AA-MESSAGE-1         PIC X(45).                   00880000
032300             15 AA-MESSAGE-2         PIC X(45).                   00890000
032400             15 AA-MESSAGE-3         PIC X(37).                   00900000
032500     05  AA-DB2-ERROR-LIT            PIC X(40)  VALUE             00910000
032600             '*****    DB2 ERROR'.                                00920000
032700     05  AA-DB2-OPERATION-LIT.                                    00930000
032800         10  FILLER                  PIC X(17)  VALUE             00940000
032900             '***** OPERATION: '.                                 00950000
033000         10  AA-DB2-OPERATION.                                    00960000
033100             15  AA-DB2-OP-1         PIC X(25)  VALUE SPACES.     00970000
033200             15  AA-DB2-OP-2         PIC X(25)  VALUE SPACES.     00980000
033300     05  AA-DB2-TABLE-1              PIC X(18)  VALUE SPACES.     00990000
033700                                                                  01020000
034200     COPY APRD042.                                                01030000
034300                                                                  01040000
030900 01  OUTPUT-STRUCTURE.                                            01050000
031000     05  OUT-PO-NBR                  PIC 9(9).                    01060000
031000     05  OUT-DELIM1                  PIC X(1).                    01070000
031000     05  OUT-STR-NBR                 PIC 9(4).                    01080000
031000     05  OUT-DELIM2                  PIC X(1).                    01090000
031000     05  OUT-SKU-NBR                 PIC 9(9).                    01100000
031000     05  OUT-DELIM3                  PIC X(1).                    01110000
031000     05  OUT-DEPT-NBR                PIC 9(3).                    01120000
031000     05  OUT-DELIM4                  PIC X(1).                    01130002
031000     05  OUT-QTY-VRFD                PIC 9(5).                    01140000
031000     05  OUT-DELIM5                  PIC X(1).                    01150002
031000     05  OUT-1ST-COST                PIC 9(5).99.                 01160000
031000     05  OUT-DELIM6                  PIC X(1).                    01170002
031000     05  OUT-TOT-COST                PIC 9(5).99.                 01180000
031000     05  OUT-DELIM7                  PIC X(1).                    01181002
031000     05  OUT-REC-DTE                 PIC X(10).                   01182002
031000     05  OUT-DELIM8                  PIC X(1).                    01183003
031000     05  OUT-VND-NBR                 PIC X(9).                    01184003
034400                                                                  01190000
035100                                                                  01200000
035200*--------------------------------------------------------------*  01210000
035300*  DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA     *  01220000
035400*  MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS. *  01230000
035500*--------------------------------------------------------------*  01240000
035600     COPY DPWS004.                                                01250000
035800                                                                  01270000
036200     EXEC SQL                                                     01280000
036300          INCLUDE TPURITM                                         01290000
036400     END-EXEC.                                                    01300000
038200                                                                  01320000
038300*--------------------------------------------------------------*  01330000
038400*  COMMUNICATIONS AREA2 FOR DB2                                *  01340000
038500*--------------------------------------------------------------*  01350000
038600     COPY SQLCA2.                                                 01360000
038700*--------------------------------------------------------------*  01370000
038800*     SQL COMMUNICATIONS AREA DCLGEN                           *  01380000
038900*--------------------------------------------------------------*  01390000
039000     EXEC SQL                                                     01400000
039100         INCLUDE SQLCA                                            01410000
039200     END-EXEC.                                                    01420000
039400                                                                  01440000
039400                                                                  01450000
039600************************                                          01460000
039700 PROCEDURE DIVISION.                                              01470000
039800************************                                          01480000
039900 A100-MAINLINE-ROUTINE.                                           01490000
040000                                                                  01500000
040100     PERFORM B100-INITIALIZATION.                                 01510000
040200                                                                  01520000
040300     PERFORM B200-PROCESS-AP-INPUT                                01530000
040400       UNTIL AP-INPUT-EOF.                                        01540000
040500                                                                  01550000
040600     PERFORM B300-TERMINATION.                                    01560000
040700     GOBACK.                                                      01570000
040800                                                                  01580000
040900*--------------------------------------------------------------*  01590000
041000*  INITIALIZATION PROCESSING                                   *  01600000
041100*--------------------------------------------------------------*  01610000
041200 B100-INITIALIZATION.                                             01620000
041300                                                                  01630000
041400     DISPLAY ' '.                                                 01640000
041500     DISPLAY '**--------------- APKUT031 --------------------**'. 01650000
041600     DISPLAY 'DATE ' FUNCTION CURRENT-DATE(1:8)                   01660000
041700           '  TIME ' FUNCTION CURRENT-DATE(9:6)                   01670000
041800                                                                  01680000
041900     OPEN  INPUT AP-INPUT-FILE                                    01690000
042000          OUTPUT AP-OUTPUT-FILE.                                  01700000
042100                                                                  01710000
042200     PERFORM W000-WRITE-HEADER.                                   01720000
042200     PERFORM R100-READ-AP-INPUT.                                  01730000
042400                                                                  01750000
042500*--------------------------------------------------------------*  01760000
042600* PROCESS THE AP REMITTANCE FILE                               *  01770000
042700*--------------------------------------------------------------*  01780000
042800 B200-PROCESS-AP-INPUT.                                           01790000
042900                                                                  01800000
031000     MOVE AP042-PO-NBR TO  DK-PO-NBR.                             01810000
031000     MOVE AP042-PO-LNE-NBR TO  DK-PO-LNE-NBR.                     01820000
043000     PERFORM R600-GET-SKU.                                        01830000
046600                                                                  01840000
031000     MOVE AP042-PO-NBR TO  OUT-PO-NBR.                            01850000
031000     MOVE ',' TO  OUT-DELIM1.                                     01860000
031000     MOVE ',' TO  OUT-DELIM2.                                     01870000
031000     MOVE ',' TO  OUT-DELIM3.                                     01880000
031000     MOVE ',' TO  OUT-DELIM4.                                     01890000
031000     MOVE ',' TO  OUT-DELIM5.                                     01900000
031000     MOVE ',' TO  OUT-DELIM6.                                     01910000
031000     MOVE ',' TO  OUT-DELIM7.                                     01911003
031000     MOVE ',' TO  OUT-DELIM8.                                     01912003
031000     MOVE AP042-STR-NBR TO  OUT-STR-NBR.                          01920000
031000     MOVE AP042-DEPT-NBR TO  OUT-DEPT-NBR.                        01930000
031000     MOVE PURITM-RMS-PO-SKU-NBR TO  OUT-SKU-NBR.                  01940000
031000     MOVE AP042-PO-VRFD-QTY   TO  OUT-QTY-VRFD.                   01950000
031000     MOVE AP042-CALCD-VRFD-COST-AMT TO OUT-1ST-COST.              01960000
031000     MOVE AP042-CALCD-VRFD-COST-AMT TO OUT-TOT-COST.              01970000
031000     MOVE AP042-REC-DTE             TO OUT-REC-DTE.               01971003
031000     MOVE AP042-VND-NBR             TO OUT-VND-NBR.               01972003
031000     MOVE AP042-PO-VRFD-QTY         TO OUT-QTY-VRFD.              01980005
046900     PERFORM W100-WRITE-AP-OUTPUT.                                01990000
046900     PERFORM R100-READ-AP-INPUT.                                  02000000
047000                                                                  02010000
047200                                                                  02020000
047300*--------------------------------------------------------------*  02030000
047400*  END OF PROGRAM PROCESSING                                   *  02040000
047500*--------------------------------------------------------------*  02050000
047600 B300-TERMINATION.                                                02060000
047700     DISPLAY '**********************************************'.    02070000
047800     DISPLAY '**         APKUT031 RECORD COUNTS           **'.    02080000
047900     DISPLAY '**********************************************'.    02090000
048000     DISPLAY ' AP INPUT TOTAL      ' COUNT-AP-INPUT-TOTAL.        02100000
048000     DISPLAY ' AP OUTPUT TOTAL     ' COUNT-OUT-TOTAL.             02110000
049400     DISPLAY '**********************************************'.    02120000
049500                                                                  02130000
049600     CLOSE AP-INPUT-FILE                                          02140000
049700           AP-OUTPUT-FILE.                                        02150000
049800                                                                  02160000
049900                                                                  02170000
116500 R600-GET-SKU.                                                    02180000
116600     EXEC SQL                                                     02190000
116700         SELECT P.RMS_PO_SKU_NBR                                  02200000
117000           INTO :PURITM-RMS-PO-SKU-NBR                            02210000
117300           FROM TPURITM P                                         02220000
117600          WHERE P.PO_NBR   = :DK-PO-NBR                           02230000
117800            AND P.PO_LNE_NBR   = :DK-PO-LNE-NBR                   02240000
118400     END-EXEC.                                                    02250000
118500                                                                  02260000
118600     EVALUATE TRUE                                                02270000
118700         WHEN SQLCODE = ZERO                                      02280000
118900         WHEN SQLCODE = -811                                      02290000
119000             CONTINUE                                             02300000
119200         WHEN SQLCODE = +100                                      02310000
119300            DISPLAY 'SKU NOT FOUND FOR PO ' DK-PO-NBR             02320000
119300            MOVE ZEROES      TO PURITM-RMS-PO-SKU-NBR             02321000
119400         WHEN OTHER                                               02330000
119500             DISPLAY 'R600-GET-SKU'                               02340000
119600             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                02350000
119700             MOVE 'R600-GET-SKU'                                  02360000
119800                                           TO AA-PARAGRAPH-NAME   02370000
119900             MOVE 'UNSUCCESSFUL SELECT'    TO AA-DB2-OPERATION    02380000
120000             MOVE 'TPURITM'                TO AA-DB2-TABLE-1      02390000
120300             PERFORM Z998-DB2-ABEND                               02400000
120400     END-EVALUATE.                                                02410000
120600                                                                  02430000
120600                                                                  02431000
121000 R100-READ-AP-INPUT.                                              02440000
121100     READ AP-INPUT-FILE   INTO AP042-EXTRACT-FILE                 02450000
025900        AT END                                                    02460000
026000            SET AP-INPUT-EOF TO TRUE                              02470000
026100        NOT AT END                                                02480000
026200            ADD 1 TO COUNT-AP-INPUT-TOTAL                         02490000
026300     END-READ.                                                    02500000
121200                                                                  02510000
121400                                                                  02520000
121000 W000-WRITE-HEADER.                                               02530000
121100     WRITE AP-OUTPUT-RECORD FROM HEADER-RECORD.                   02540000
121300                                                                  02550000
121300                                                                  02560000
121000 W100-WRITE-AP-OUTPUT.                                            02570000
121100     WRITE AP-OUTPUT-RECORD FROM OUTPUT-STRUCTURE.                02580000
121200     ADD 1 TO COUNT-OUT-TOTAL.                                    02590000
121400                                                                  02600000
121500*--------------------------------------------------------------*  02610000
121600*  DB2 ABEND ROUTINE                                           *  02620000
121700*--------------------------------------------------------------*  02630000
121800 Z998-DB2-ABEND.                                                  02640000
121900                                                                  02650000
122000     DISPLAY '**********************************************'.    02660000
122100     DISPLAY '**        APKUT031 ABENDING !!!!!!!         **'.    02670000
122200     DISPLAY '**********************************************'.    02680000
122300                                                                  02690000
122400     DISPLAY AA-ABEND-LIT.                                        02700000
122500     DISPLAY AA-DB2-ERROR-LIT.                                    02710000
122600     DISPLAY AA-PROGRAM-LIT.                                      02720000
122700     DISPLAY AA-PARAGRAPH-LIT.                                    02730000
122800     DISPLAY AA-DB2-OPERATION-LIT.                                02740000
122900     DISPLAY AA-DB2-TABLE-1.                                      02750000
123200     SET AC-DB2-ERROR TO TRUE.                                    02780000
123300                                                                  02790000
123400     COPY DPPD004.                                                02800000
123500                                                                  02810000
123600     CALL 'ILBOABN0' USING ABEND-CODE.                            02820000
123700                                                                  02830000
