000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      MAKUT125.                                       00040000
000500 AUTHOR.          FRANK SANTANDREA                                00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    01/05/99.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900****************************************************************  00090000
001000* EXTRACT DATA FOR THE SALES MODIFIER REPORT                   *  00100000
001100****************************************************************  00110000
001200* WR21065 ADDED LOGIC FOR E-COMMERCE STORE(S)                  *  00120000
001300*                                                              *  00130000
001400* WR25478 DAVE METZGER 12/01/2004                              *  00140000
001500* INCREASED STORE NUMBER TO 4 BYTES (SEE DGM001)              *   00150000
001600****************************************************************  00160000
001700* P50650 03-20-2015 COGNIZANT MOVED 000 TO DEPARTMENT NUMBER      00170000
001800*                             FOR CORPORATE LIKE STORES           00180000
070941******************************************************************00181002
070941* DATE:         07/30/2018                                       *00182002
070941* WR/IR#:       CHG0205458                                       *00183003
070941* PROGRAMMER:   COGNIZANT                                        *00184002
070941* DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE            *00185002
001900******************************************************************00190002
002000                                                                  00200000
002100                                                                  00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300                                                                  00230000
002400 CONFIGURATION SECTION.                                           00240000
002500 SOURCE-COMPUTER. IBM-3090.                                       00250000
002600 OBJECT-COMPUTER. IBM-3090.                                       00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT SLSMOD-EXTRACT    ASSIGN TO IO02.                     00310001
003200                                                                  00320001
003300     SELECT ORACLE-LOGON-FILE ASSIGN TO ORALOGON.                 00330001
003400                                                                  00340001
003500                                                                  00350000
003600 DATA DIVISION.                                                   00360000
003700 FILE SECTION.                                                    00370000
003800                                                                  00380000
003900 FD  SLSMOD-EXTRACT                                               00390000
004000     RECORDING MODE F                                             00400000
004100     BLOCK CONTAINS 0 RECORDS.                                    00410000
004200 01  SM-EXTRACT                                      PIC X(142).  00420000
004300                                                                  00430000
004310 FD  ORACLE-LOGON-FILE                                            00431001
004320     RECORDING MODE IS F                                          00432001
004330     LABEL RECORDS ARE STANDARD                                   00433001
004340     BLOCK CONTAINS 0 RECORDS                                     00434001
004350     RECORD CONTAINS 80 CHARACTERS                                00435001
004360     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00436001
004370                                                                  00437001
004380 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                   00438001
004390                                                                  00439001
004400 WORKING-STORAGE SECTION.                                         00440000
004500                                                                  00450000
004600 01  WS-RFMT-DPT-NBR.                                             00460000
004700     05  WS-DPT-NBR                     PIC X(03)  VALUE SPACES.  00470000
004800     05  WS-DPT-REST                    PIC X(07)  VALUE SPACES.  00480000
004900                                                                  00490000
005000 01  PV-PROGRAM-VARIABLES.                                        00500000
005010     05  PV-ORACLE-USERID-LEN           PIC S9(04)  VALUE ZEROS   00501001
005020                                                    COMP SYNC.    00502001
005030     05  PV-ORACLE-PASSWORD-LEN         PIC S9(04)  VALUE ZEROS   00503001
005040                                                    COMP SYNC.    00504001
005100     05  PV-ABEND-PARAGRAPH              PIC X(30)  VALUE SPACES. 00510000
005200     05  PV-USERID                       PIC X(08)  VALUE SPACES. 00520000
005300     05  PV-LOCATION                     PIC X(04)  VALUE SPACES. 00530000
005400     05  PV-LOCATION-DESC                PIC X(40)  VALUE SPACES. 00540000
005500     05  PV-PRNT-E-BUS                   PIC X(01)  VALUE SPACES. 00550000
005600     05  PV-EFF-BEG-DTE                  PIC X(10)  VALUE SPACES. 00560000
005700     05  PV-EFF-END-DTE                  PIC X(10)  VALUE SPACES. 00570000
005800     05  PV-SM-COUNT                     PIC 9(06)  VALUE ZEROES. 00580000
005900     05  PV-ABEND-CODE                   PIC S9(04) VALUE +0      00590000
006000                                                    COMP SYNC.    00600000
006100                                                                  00610000
006200 01  PS-SWITCHES.                                                 00620000
006210     05  PS-END-OF-LOGON-FILE-SW         PIC X(01) VALUE 'N'.     00621001
006220         88  PS-END-OF-LOGON-FILE                  VALUE 'Y'.     00622001
006230     05  PS-END-OF-PROC-INST-FILE-SW     PIC X(01) VALUE 'N'.     00623001
006240         88  PS-END-OF-PROC-INST-FILE              VALUE 'Y'.     00624001
006250         88  PS-NOT-END-OF-PROC-INST-FILE          VALUE 'N'.     00625001
006260     05  PS-ORA-SRC-CTL-DONE-SW          PIC X(01) VALUE 'N'.     00626001
006270         88  PS-ORA-SRC-EMPTY                      VALUE 'Y'.     00627001
006300     05 PS-CLUSTERS-LEFT1-SWITCH         PIC X(01) VALUE 'Y'.     00630000
006400        88 PS-MORE-SLSMODS-LEFT                    VALUE 'Y'.     00640000
006500        88 PS-NO-MORE-SLSMODS-LEFT                 VALUE 'N'.     00650000
006510                                                                  00651001
006520 01  CC-ORACLE-CONNECTION.                                        00652001
006530     05  CC-ORACLE-USERID             PIC X(40).                  00653001
006540         88 CC-AUTO-LOGON                         VALUE '/'.      00654001
006550     05  CC-ORACLE-PASSWORD           PIC X(40).                  00655001
006600                                                                  00660000
006601 01  PS-CONSTANTS.                                                00660101
006610     05  PC-AUTO-LOGON                  PIC X(01) VALUE '/'.      00661001
006620                                                                  00662001
006700 01  WS-OUTPUT-MESSAGE-AREA-X.                                    00670000
006800     10  WS-MSG-ID                      PIC X(02) VALUE SPACES.   00680000
006900     10  WS-MESSAGE                     PIC X(102) VALUE SPACES.  00690000
007000 01  WS-OUTPUT.                                                   00700000
007100     05  WS-OUTPUT-MESSAGE-AREA         PIC X(104) VALUE SPACES.  00710000
007200                                                                  00720000
007300*  RECORD LAYOUT FOR THE MERCHANDISING   MAINTENANCE LOG          00730000
007400                                                                  00740000
007500     COPY MARD027.                                                00750000
007600                                                                  00760000
007700* DECLARE VARIABLES FOR SUBROUTINE CALL  (SQLCODE TEXT)           00770000
007800                                                                  00780000
007900 01  WS-MSG-TEXT                   PIC X(512).                    00790000
008000 01  WS-MAX-SIZE                   PIC S9(09) COMP                00800000
008100                                              VALUE 512.          00810000
008200 01  WS-MSG-LENGTH                 PIC S9(09) COMP.               00820000
008300                                                                  00830000
008400     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     00840000
008500                                                                  00850000
008600 01      USERNAME                   PIC X(10)  VARYING.           00860000
008700 01      PASSWD                     PIC X(10)  VARYING.           00870000
008800 01      PC-ENT01-TYPE-CDE          PIC X(02)  VALUE '01'.        00880000
008900 01      PV-ORACLE-ID               PIC X(1)   VALUE '/'.         00890000
009000 01      PV-CURRENT-TMST            PIC X(19)  VALUE SPACE.       00900000
009100 01      PV-ACTIVE-TMST             PIC X(10)      VALUE          00910000
009200                                    '9999-09-09'.                 00920000
009300 01      PV-SEAR-DKEY               PIC S9(10) COMP-3.            00930000
009400 01      PV-SHIP-END-TMST-NULL      PIC S9(04) VALUE +0           00940000
009500                                               COMP SYNC.         00950000
009600                                                                  00960000
009700 01  SORT-DATA.                                                   00970000
009800     05  PV-DMA-NBR                 PIC X(02)  VALUE SPACES.      00980000
009900     05  PV-NAME                    PIC X(32)  VALUE SPACES.      00990000
010000     05  PV-DMA-KEY                 PIC X(02)  VALUE SPACES.      01000000
010100     05  PV-DEPT-NBR                PIC X(03)  VALUE SPACES.      01010000
010200     05  PV-DEPT-NAME               PIC X(20)  VALUE SPACES.      01020000
010300                                                                  01030000
010400 01  PV-ITEM-ID                     PIC X(10) VALUE SPACES.       01040000
010500 01  PV-ORG-ID                      PIC X(10) VALUE SPACES.       01050000
010600 01  PV-SLS-PCT                     PIC X(10) VALUE SPACES.       01060000
010700                                                                  01070000
010800**************************************************************    01080000
010900*    VARIABLES FOR ORACLE DATA                                    01090000
011000**************************************************************    01100000
011100* ORACLE TABLE OF TSLSMOD                                         01110000
011200**************************************************************    01120000
011300     EXEC SQL                                                     01130000
011400          INCLUDE TSLSMOD                                         01140000
011500     END-EXEC.                                                    01150000
011600                                                                  01160000
011700**************************************************************    01170000
011800* ORACLE TABLE OF TITMCLT                                         01180000
011900**************************************************************    01190000
012000     EXEC SQL                                                     01200000
012100          INCLUDE TITMCLT                                         01210000
012200     END-EXEC.                                                    01220000
012300                                                                  01230000
012400**************************************************************    01240000
012500* ORACLE TABLE OF TORGCLT                                         01250000
012600**************************************************************    01260000
012700     EXEC SQL                                                     01270000
012800          INCLUDE TORGCLT                                         01280000
012900     END-EXEC.                                                    01290000
013000                                                                  01300000
013100**************************************************************    01310000
013200* COBOL DECLARATION FOR TABLE TMDSEAR                             01320000
013300**************************************************************    01330000
013400     EXEC SQL                                                     01340000
013500          INCLUDE TMDSEAR                                         01350000
013600     END-EXEC.                                                    01360000
013700                                                                  01370000
013800**************************************************************    01380000
013900* COBOL DECLARATION FOR TABLE TRSPBAR                             01390000
014000**************************************************************    01400000
014100     EXEC SQL                                                     01410000
014200          INCLUDE TRSPBAR                                         01420000
014300     END-EXEC.                                                    01430000
014400                                                                  01440000
014500******************************************************            01450000
014600* SET FIX COLUMN LENGTHS                             *            01460000
014700******************************************************            01470000
014800                                                                  01480000
014900     EXEC SQL                                                     01490000
015000          VAR ITMCLT-ITEM-CLUSTR-NAME  IS CHARF(20)               01500000
015100     END-EXEC.                                                    01510000
015200                                                                  01520000
015300     EXEC SQL                                                     01530000
015400          VAR ITMCLT-ITEM-CLUSTR-DESC  IS CHARF(40)               01540000
015500     END-EXEC.                                                    01550000
015600                                                                  01560000
015700     EXEC SQL END DECLARE SECTION END-EXEC.                       01570000
015800                                                                  01580000
015900* ORA COMMUNICATION AREA                                          01590000
016000                                                                  01600000
016100 01        SQLCA.                                                 01610000
016200           05  SQLCAID               PIC X(8).                    01620000
016300           05  SQLCABC               PIC S9(9) COMPUTATIONAL.     01630000
016400           05  SQLCODE               PIC S9(9) COMPUTATIONAL.     01640000
016500           05  SQLERRM.                                           01650000
016600               49 SQLERRML           PIC S9(4) COMPUTATIONAL.     01660000
016700               49 SQLERRMC           PIC X(70).                   01670000
016800           05  SQLERRP               PIC X(8).                    01680000
016900           05  SQLERRD OCCURS 6 TIMES                             01690000
017000                                     PIC S9(9) COMPUTATIONAL.     01700000
017100           05  SQLWARN.                                           01710000
017200               10 SQLWARN0           PIC X(1).                    01720000
017300               10 SQLWARN1           PIC X(1).                    01730000
017400               10 SQLWARN2           PIC X(1).                    01740000
017500               10 SQLWARN3           PIC X(1).                    01750000
017600               10 SQLWARN4           PIC X(1).                    01760000
017700               10 SQLWARN5           PIC X(1).                    01770000
017800               10 SQLWARN6           PIC X(1).                    01780000
017900               10 SQLWARN7           PIC X(1).                    01790000
018000           05  SQLEXT                PIC X(8).                    01800000
018100                                                                  01810000
018200     COPY SQLCA2.                                                 01820000
018300                                                                  01830000
018400**************************************************************    01840000
018500 PROCEDURE DIVISION.                                              01850000
018600**************************************************************    01860000
018700**************************************************************    01870000
018800* A000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01880000
018900* PROGRAM.                                                        01890000
019000**************************************************************    01900000
019100 A000-PROGRAM-MAINLINE.                                           01910000
019200                                                                  01920000
019300     PERFORM A100-INITIAL.                                        01930000
019400                                                                  01940000
019500     PERFORM A300-PROCESS-SALES-MODS.                             01950000
019600                                                                  01960000
019700     PERFORM A200-COMPLETE.                                       01970000
019800                                                                  01980000
019900     DISPLAY '*************************************************'. 01990000
020000     DISPLAY ' SALES MODIFIER RECORDS PROCESSED : ' PV-SM-COUNT.  02000000
020100     DISPLAY '*************************************************'. 02010000
020200                                                                  02020000
020300     STOP RUN.                                                    02030000
020400                                                                  02040000
020500**************************************************************    02050000
020600* A100-INITIAL.                                                   02060000
020700**************************************************************    02070000
020800 A100-INITIAL.                                                    02080000
020900     MOVE 'A100-INITIAL' TO PV-ABEND-PARAGRAPH.                   02090000
021000     MOVE ZEROES TO PV-SM-COUNT.                                  02100000
021100                                                                  02110000
021200**************************************************************    02120000
021300* LOGON                                                           02130000
021400**************************************************************    02140000
021410                                                                  02141001
021500     PERFORM A110-CONNECT-TO-ORACLE.                              02150001
023800                                                                  02380000
023900     EXEC SQL                                                     02390000
024000      ALTER SESSION                                               02400000
024100            SET NLS_DATE_FORMAT = 'YYYY-MM-DD-HH24.MI.SS'         02410000
024200     END-EXEC.                                                    02420000
024300                                                                  02430000
024400     EXEC SQL                                                     02440000
024500      SELECT SYSDATE                                              02450000
024600      INTO :PV-CURRENT-TMST                                       02460000
024700      FROM DUAL                                                   02470000
024800     END-EXEC.                                                    02480000
024900                                                                  02490000
025000     DISPLAY 'SYSDATE = ' PV-CURRENT-TMST.                        02500000
025100                                                                  02510000
025200* CURSOR FOR SLSMODS TABLE                                        02520000
025300     EXEC SQL                                                     02530000
025400       DECLARE SLSMODS CURSOR FOR                                 02540000
025500         SELECT                                                   02550000
025600                A.ITEM_CLUSTR_ID,                                 02560000
025700                A.ORG_CLUSTR_ID,                                  02570000
025800                A.SLS_MOD_PCT,                                    02580000
025900                A.EFF_BEG_TMST,                                   02590000
026000                A.EFF_END_TMST,                                   02600000
026100                B.ITEM_CLUSTR_NAME,                               02610000
026200                B.ITEM_CLUSTR_DESC                                02620000
026300         FROM TSLSMOD A,                                          02630000
026400              TITMCLT B                                           02640000
026500         WHERE  A.ITEM_CLUSTR_ID = B.ITEM_CLUSTR_ID               02650000
026600           AND  (A.EFF_END_TMST > :PV-CURRENT-TMST                02660000
026700            OR  A.EFF_END_TMST IS NULL)                           02670000
026800           AND  A.EXP_TMST IS NULL                                02680000
026900           AND  A.SLS_MOD_TYP_CDE = 'S'                           02690000
027000         ORDER BY B.ITEM_CLUSTR_ID                                02700000
027100     END-EXEC.                                                    02710000
027200                                                                  02720000
027300     OPEN OUTPUT SLSMOD-EXTRACT.                                  02730000
027400                                                                  02740000
027410****************************************************************  02741001
027420*   CONNECT TO THE APPROPRIATE ORACLE SERVER.                  *  02742001
027430****************************************************************  02743001
027440 A110-CONNECT-TO-ORACLE.                                          02744001
027460                                                                  02746001
027470     OPEN INPUT ORACLE-LOGON-FILE.                                02747001
027480                                                                  02748001
027490     PERFORM A120-READ-ORACLE-LOGON.                              02749001
027491                                                                  02749101
027492     CLOSE ORACLE-LOGON-FILE.                                     02749201
027493                                                                  02749301
027494     IF ((PS-END-OF-LOGON-FILE)                                   02749401
027495             OR (CC-ORACLE-CONNECTION = SPACES))                  02749501
027496         DISPLAY '** ABEND **'                                    02749601
027497         DISPLAY 'MAKUT125 - ORACLE LOGON CONTROL CARD '          02749701
027498                   'NOT PROVIDED'                                 02749801
027499         SET PS-ORA-SRC-EMPTY TO TRUE                             02749901
027500         CALL 'ILBOABN0' USING PV-ABEND-CODE                      02750001
027501     END-IF.                                                      02750101
027502                                                                  02750201
027503     IF CC-AUTO-LOGON                                             02750301
027504         DISPLAY 'MAKUT125 - AUTO LOGON TO ORACLE'                02750401
027505         EXEC SQL                                                 02750501
027506              CONNECT :USERNAME                                   02750601
027507         END-EXEC                                                 02750701
027508     ELSE                                                         02750801
027509         INITIALIZE PV-ORACLE-USERID-LEN                          02750901
027510                    PV-ORACLE-PASSWORD-LEN                        02751001
027511         INSPECT CC-ORACLE-USERID                                 02751101
027512             TALLYING PV-ORACLE-USERID-LEN                        02751201
027513          FOR CHARACTERS BEFORE INITIAL SPACE                     02751301
027514      INSPECT CC-ORACLE-PASSWORD                                  02751401
027515          TALLYING PV-ORACLE-PASSWORD-LEN                         02751501
027516          FOR CHARACTERS BEFORE INITIAL SPACE                     02751601
027517      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           02751701
027518                USERNAME-ARR                                      02751801
027519      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   02751901
027520      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       02752001
027521                PASSWD-ARR                                        02752101
027522      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   02752201
027523      DISPLAY 'MAKUT102 - LOGON TO ORACLE AS USER '               02752301
027524                USERNAME-ARR                                      02752401
027525      EXEC SQL                                                    02752501
027526        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   02752601
027527      END-EXEC                                                    02752701
027528      INITIALIZE CC-ORACLE-PASSWORD                               02752801
027529                 PASSWD                                           02752901
027530      END-IF.                                                     02753001
027531                                                                  02753101
027532     IF (SQLCODE NOT = 0)                                         02753201
027533         DISPLAY PV-ABEND-PARAGRAPH                               02753301
027534         DISPLAY 'MAKUT102 - ERROR LOGGING ON TO ORACLE'          02753401
027535         PERFORM Z999-SQL-ERROR                                   02753501
027536     END-IF.                                                      02753601
027537                                                                  02753701
027538****************************************************************  02753801
027539** READ THE ORACLE LOGON CONTROL CARD.                        **  02753901
027540****************************************************************  02754001
027541 A120-READ-ORACLE-LOGON.                                          02754101
027542                                                                  02754201
027543     READ ORACLE-LOGON-FILE                                       02754301
027544         INTO CC-ORACLE-CONNECTION                                02754401
027545         AT END                                                   02754501
027546             SET PS-END-OF-LOGON-FILE TO TRUE                     02754601
027547     END-READ.                                                    02754701
027548                                                                  02754801
027550**************************************************************    02755000
027600* A200-COMPLETE                                                   02760000
027700*                                                                 02770000
027800**************************************************************    02780000
027900 A200-COMPLETE.                                                   02790000
028000                                                                  02800000
028100     MOVE 'A200-COMPLETE' TO PV-ABEND-PARAGRAPH.                  02810000
028200                                                                  02820000
028300     CLOSE       SLSMOD-EXTRACT.                                  02830000
028400                                                                  02840000
028500     EXEC SQL                                                     02850000
028600       COMMIT RELEASE                                             02860000
028700     END-EXEC.                                                    02870000
028800                                                                  02880000
028900     IF SQLCODE NOT = ZERO                                        02890000
029000     MOVE SQLCODE    TO SQLCODE2                                  02900000
029100     MOVE SQLERRD(3) TO SQLERRD3                                  02910000
029200     DISPLAY '** ABEND **       ** = SQLERROR'                    02920000
029300     DISPLAY '** PROGRAM        ** = MAKUT125'                    02930000
029400     DISPLAY '** SQLCODE        ** = ' SQLCODE2                   02940000
029500     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3                   02950000
029600     DISPLAY '** SQLERRM        ** = ' SQLERRM                    02960000
029700     DISPLAY '** SQLERRMC       ** = ' SQLERRMC                   02970000
029800                                                                  02980000
029900     MOVE SPACES TO WS-MSG-TEXT                                   02990000
030000***  GET FULL TEXT OF ERROR MESSAGE                               03000000
030100                                                                  03010000
030200     CALL 'SQLGLM' USING WS-MSG-TEXT,                             03020000
030300                         WS-MAX-SIZE,                             03030000
030400                         WS-MSG-LENGTH                            03040000
030500     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT                03050000
030600     END-IF.                                                      03060000
030700                                                                  03070000
030800**************************************************************    03080000
030900* PROCESS SLAES MODS DATA                                         03090000
031000**************************************************************    03100000
031100  A300-PROCESS-SALES-MODS.                                        03110000
031200     MOVE 'A300-PROCESS-SALES-MODS' TO PV-ABEND-PARAGRAPH.        03120000
031300                                                                  03130000
031400     PERFORM B101-OPEN-SLSMODS-CURSOR.                            03140000
031500                                                                  03150000
031600     PERFORM C001-FETCH-SLSMODS-CURSOR.                           03160000
031700                                                                  03170000
031800     PERFORM B200-PROCESS-SLSMODS                                 03180000
031900       UNTIL PS-NO-MORE-SLSMODS-LEFT.                             03190000
032000                                                                  03200000
032100     PERFORM B300-CLOSE-SLSMODS-CURSOR.                           03210000
032200                                                                  03220000
032300**************************************************************    03230000
032400*  THIS SECTION PRINTS THE PAGE HEADINGS.                         03240000
032500**************************************************************    03250000
032600 A500-WRITE-EXTRACT-RECORD.                                       03260000
032700     MOVE 'A500-WRITE-EXTRACT-RECORD   ' TO PV-ABEND-PARAGRAPH.   03270000
032800                                                                  03280000
032900* SETUP HEADER INFORMATION FOR CORPORATE LIKE STORES.             03290000
033000     IF ITMCLT-ITEM-CLUSTR-NAME = 'CORP'                          03300000
033100        MOVE 'CORPORATE LEVEL'         TO PV-DEPT-NAME            03310000
033200        MOVE ITMCLT-ITEM-CLUSTR-DESC   TO PV-NAME                 03320000
033300     END-IF.                                                      03330000
033400                                                                  03340000
033500     MOVE PV-DMA-NBR                   TO DL-DMA-NBR.             03350000
033600     MOVE PV-NAME                      TO DL-DMA-NAME.            03360000
033700     MOVE WS-DPT-NBR                   TO DL-DPT-NBR.             03370000
033800     MOVE PV-DEPT-NAME                 TO DL-DPT-NAME.            03380000
033900     MOVE ITMCLT-ITEM-CLUSTR-NAME      TO DL-ITEM-NAME.           03390000
034000     MOVE ITMCLT-ITEM-CLUSTR-DESC      TO DL-ITEM-DESC.           03400000
034100     MOVE PV-LOCATION                  TO DL-LOCATION.            03410000
034200     MOVE PV-LOCATION-DESC             TO DL-LOCATION-DESC.       03420000
034300     MOVE PV-PRNT-E-BUS                TO DL-LOCATION-E-BUS.      03430000
034400     MOVE PV-SLS-PCT                   TO DL-SLS-MOD-PCT.         03440000
034500     MOVE PV-EFF-BEG-DTE               TO DL-EFF-BEG-DTE.         03450000
034600     MOVE PV-EFF-END-DTE               TO DL-EFF-END-DTE.         03460000
034700                                                                  03470000
034800     WRITE SM-EXTRACT FROM MARD027-SLSMOD-EXTRACT.                03480000
034900     MOVE SPACES      TO MARD027-SLSMOD-EXTRACT                   03490000
035000                         SORT-DATA.                               03500000
035100                                                                  03510000
035200**************************************************************    03520000
035300* B101-OPEN-SLSMODS-CURSOR.                                       03530000
035400**************************************************************    03540000
035500 B101-OPEN-SLSMODS-CURSOR.                                        03550000
035600     MOVE 'B101-OPEN-SLSMODS-CURSOR' TO PV-ABEND-PARAGRAPH.       03560000
035700                                                                  03570000
035800     EXEC SQL                                                     03580000
035900         OPEN  SLSMODS                                            03590000
036000     END-EXEC.                                                    03600000
036100                                                                  03610000
036200     EVALUATE TRUE                                                03620000
036300       WHEN SQLCODE = ZEROS                                       03630000
036400         CONTINUE                                                 03640000
036500       WHEN SQLCODE = 1403                                        03650000
036600         SET PS-NO-MORE-SLSMODS-LEFT TO TRUE                      03660000
036700         CONTINUE                                                 03670000
036800       WHEN OTHER                                                 03680000
036900         DISPLAY PV-ABEND-PARAGRAPH                               03690000
037000         PERFORM Z999-SQL-ERROR                                   03700000
037100     END-EVALUATE.                                                03710000
037200                                                                  03720000
037300**************************************************************    03730000
037400* B200-PROCESS-SLSMODS                                            03740000
037500**************************************************************    03750000
037600 B200-PROCESS-SLSMODS.                                            03760000
037700     MOVE 'B200-PROCESS-SLSMODS        ' TO PV-ABEND-PARAGRAPH.   03770000
037800                                                                  03780000
037900     IF PS-MORE-SLSMODS-LEFT                                      03790000
038000        PERFORM C002-GET-TMDSEAR-DATA1                            03800000
038100        PERFORM C005-GET-PRNT-ORG-DATA                            03810000
038200        PERFORM A500-WRITE-EXTRACT-RECORD                         03820000
038300        PERFORM C001-FETCH-SLSMODS-CURSOR                         03830000
038400     END-IF.                                                      03840000
038500                                                                  03850000
038600***************************************************************** 03860000
038700* B300-CLOSE-LKSTORE-CURSOR.                                    * 03870000
038800***************************************************************** 03880000
038900 B300-CLOSE-SLSMODS-CURSOR.                                       03890000
039000                                                                  03900000
039100     MOVE 'B300-CLOSE-SLSMODS-CURSOR' TO                          03910000
039200                                PV-ABEND-PARAGRAPH                03920000
039300                                                                  03930000
039400     EXEC SQL                                                     03940000
039500       CLOSE  SLSMODS                                             03950000
039600     END-EXEC.                                                    03960000
039700                                                                  03970000
039800     EVALUATE TRUE                                                03980000
039900       WHEN SQLCODE = ZEROS                                       03990000
040000       WHEN SQLCODE = 1403                                        04000000
040100         CONTINUE                                                 04010000
040200       WHEN OTHER                                                 04020000
040300         DISPLAY PV-ABEND-PARAGRAPH                               04030000
040400         PERFORM Z999-SQL-ERROR                                   04040000
040500     END-EVALUATE.                                                04050000
040600                                                                  04060000
040700******************************************************************04070000
040800* C001-FETCH-SLSMODS-CURSOR.                                     *04080000
040900******************************************************************04090000
041000 C001-FETCH-SLSMODS-CURSOR.                                       04100000
041100     MOVE 'C001-FETCH-SLSMODS-CURSOR' TO PV-ABEND-PARAGRAPH.      04110000
041200     MOVE +0 TO PV-SHIP-END-TMST-NULL.                            04120000
041300                                                                  04130000
041400     EXEC SQL                                                     04140000
041500       FETCH  SLSMODS                                             04150000
041600       INTO  :SLSMOD-ITEM-CLUSTR-ID,                              04160000
041700             :SLSMOD-ORG-CLUSTR-ID,                               04170000
041800             :SLSMOD-SLS-MOD-PCT,                                 04180000
041900             :SLSMOD-SHIP-BEG-TMST,                               04190000
042000             :SLSMOD-SHIP-END-TMST:PV-SHIP-END-TMST-NULL,         04200000
042100             :ITMCLT-ITEM-CLUSTR-NAME,                            04210000
042200             :ITMCLT-ITEM-CLUSTR-DESC                             04220000
042300     END-EXEC.                                                    04230000
042400                                                                  04240000
042500     EVALUATE TRUE                                                04250000
042600       WHEN SQLCODE = ZEROS                                       04260000
042700         MOVE ITMCLT-ITEM-CLUSTR-NAME     TO WS-RFMT-DPT-NBR      04270000
042800                                                                  04280000
042900          IF WS-DPT-NBR = 'COR'                                   04290000
043000            MOVE 900                          TO  WS-DPT-NBR      04300000
043100          END-IF                                                  04310000
043200                                                                  04320000
043300         MOVE WS-DPT-NBR                  TO PV-DEPT-NBR          04330000
043400         MOVE SLSMOD-ITEM-CLUSTR-ID       TO PV-ITEM-ID           04340000
043500         MOVE SLSMOD-ORG-CLUSTR-ID        TO PV-ORG-ID            04350000
043600         MOVE SLSMOD-SLS-MOD-PCT          TO PV-SLS-PCT           04360000
043700         MOVE SLSMOD-SHIP-BEG-TMST(1:10)  TO PV-EFF-BEG-DTE       04370000
043800         IF PV-SHIP-END-TMST-NULL > 0                             04380000
043900             MOVE LOW-VALUES                 TO PV-EFF-END-DTE    04390000
044000         ELSE                                                     04400000
044100             MOVE SLSMOD-SHIP-END-TMST(1:10) TO PV-EFF-END-DTE    04410000
044200         END-IF                                                   04420000
044300         ADD 1 TO PV-SM-COUNT                                     04430000
044400                                                                  04440000
044500       WHEN SQLCODE = 1403                                        04450000
044600         DISPLAY 'NO MORE SALES MODS'                             04460000
044700         SET PS-NO-MORE-SLSMODS-LEFT TO TRUE                      04470000
044800                                                                  04480000
044900       WHEN OTHER                                                 04490000
045000         DISPLAY PV-ABEND-PARAGRAPH                               04500000
045100         PERFORM Z999-SQL-ERROR                                   04510000
045200     END-EVALUATE.                                                04520000
045300                                                                  04530000
045400******************************************************************04540000
045500* C002-GET-TMDSEAR-DATA1.                                        *04550000
045600******************************************************************04560000
045700 C002-GET-TMDSEAR-DATA1.                                          04570000
045800     MOVE 'C002-GET-TMDSEAR-DATA1   ' TO PV-ABEND-PARAGRAPH.      04580000
045900                                                                  04590000
046000     EXEC SQL                                                     04600000
046100         SELECT DMA_NBR,                                          04610000
046200                MDSEAR_DESC                                       04620000
046300         INTO   :MDSEAR-DMA-NBR,                                  04630000
046400                :MDSEAR-DESC                                      04640000
046500         FROM   TMDSEAR                                           04650000
046600         WHERE  DEPT_NBR = :PV-DEPT-NBR                           04660000
046700           AND  MDSELV_CDE = 'DPT'                                04670000
046800           AND  END_DTE = '9999-09-09'                            04680000
046900     END-EXEC.                                                    04690000
047000                                                                  04700000
047100                                                                  04710000
047200     EVALUATE TRUE                                                04720000
047300       WHEN SQLCODE = ZEROS                                       04730000
047400         MOVE MDSEAR-DMA-NBR         TO PV-DMA-KEY                04740000
047500                                        PV-DMA-NBR                04750000
047600         MOVE MDSEAR-DESC            TO PV-DEPT-NAME              04760000
047700         PERFORM C003-GET-TMDSEAR-DATA2                           04770000
047800                                                                  04780000
047900       WHEN SQLCODE = 1403                                        04790000
048000         MOVE SPACES TO PV-DMA-KEY                                04800000
048100                                                                  04810000
048200       WHEN OTHER                                                 04820000
048300         DISPLAY 'ABEND FOR DEPARTMENT : ' PV-DEPT-NBR            04830000
048400         DISPLAY PV-ABEND-PARAGRAPH                               04840000
048500         PERFORM Z999-SQL-ERROR                                   04850000
048600     END-EVALUATE.                                                04860000
048700                                                                  04870000
048800******************************************************************04880000
048900* C003-GET-TMDSEAR-DATA2.                                        *04890000
049000******************************************************************04900000
049100 C003-GET-TMDSEAR-DATA2.                                          04910000
049200     MOVE 'C003-GET-TMDSEAR-DATA2   ' TO PV-ABEND-PARAGRAPH.      04920000
049300                                                                  04930000
049400     EXEC SQL                                                     04940000
049500        SELECT B.WORKER_FIR_NAME,                                 04950000
049600               B.WORKER_LAST_NAME                                 04960000
049700          INTO :RSPBAR-WORKER-FIR-NAME,                           04970000
049800               :RSPBAR-WORKER-LAST-NAME                           04980000
049900          FROM TMDSEAR A,                                         04990000
050000               TRSPBAR B                                          05000000
050100         WHERE A.MDSELV_CDE = 'DMA'                               05010000
050200           AND A.DMA_NBR = :PV-DMA-KEY                            05020000
050300           AND A.END_DTE = '9999-09-09'                           05030000
050400           AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                      05040000
050500           AND B.RSPLVL_CDE = 'DMM'                               05050000
050600           AND B.WORKER_END_DTE = '9999-09-09'                    05060000
050700     END-EXEC.                                                    05070000
050800                                                                  05080000
050900     EVALUATE TRUE                                                05090000
051000       WHEN SQLCODE = ZEROS                                       05100000
051100         STRING RSPBAR-WORKER-FIR-NAME DELIMITED BY ' '           05110000
051200                ' ' DELIMITED BY SIZE                             05120000
051300                RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE         05130000
051400         INTO PV-NAME                                             05140000
051500                                                                  05150000
051600       WHEN SQLCODE = 1403                                        05160000
051700         MOVE 'UNKNOWN' TO PV-NAME                                05170000
051800                                                                  05180000
051900       WHEN OTHER                                                 05190000
052000         DISPLAY PV-ABEND-PARAGRAPH                               05200000
052100         PERFORM Z999-SQL-ERROR                                   05210000
052200     END-EVALUATE.                                                05220000
052300                                                                  05230000
052400******************************************************************05240000
052500* C005-GET-PRNT-ORG-DATA                                         *05250000
052600******************************************************************05260000
052700 C005-GET-PRNT-ORG-DATA.                                          05270000
052800     MOVE 'C005-GET-PRNT-ORG-DATA   ' TO PV-ABEND-PARAGRAPH.      05280000
052900                                                                  05290000
053000     EXEC SQL                                                     05300000
053100         SELECT ORG_CLUSTR_NAME,                                  05310000
053200                ORG_CLUSTR_DESC,                                  05320000
053300                E_BUS_LOC_IND                                     05330000
053400         INTO   :ORGCLT-ORG-CLUSTR-NAME,                          05340000
053500                :ORGCLT-ORG-CLUSTR-DESC,                          05350000
053600                :ORGCLT-E-BUS-LOC-IND                             05360000
053700         FROM   TORGCLT                                           05370000
053800         WHERE  ORG_CLUSTR_ID = :SLSMOD-ORG-CLUSTR-ID             05380000
053900     END-EXEC.                                                    05390000
054000                                                                  05400000
054100     EVALUATE TRUE                                                05410000
054200       WHEN SQLCODE = ZEROS                                       05420000
054300         MOVE ORGCLT-ORG-CLUSTR-NAME TO PV-LOCATION               05430000
054400         MOVE ORGCLT-ORG-CLUSTR-DESC TO PV-LOCATION-DESC          05440000
054500         MOVE ORGCLT-E-BUS-LOC-IND   TO PV-PRNT-E-BUS             05450000
054600                                                                  05460000
054700       WHEN SQLCODE = 1403                                        05470000
054800         MOVE SPACES                 TO PV-LOCATION               05480000
054900         MOVE SPACES                 TO PV-LOCATION-DESC          05490000
055000         MOVE SPACES                 TO PV-PRNT-E-BUS             05500000
055100                                                                  05510000
055200       WHEN OTHER                                                 05520000
055300         DISPLAY PV-ABEND-PARAGRAPH                               05530000
055400         PERFORM Z999-SQL-ERROR                                   05540000
055500     END-EVALUATE.                                                05550000
055600                                                                  05560000
055700****************************************************************  05570000
055800* Z999-SQL-ERROR.                                              *  05580000
055900****************************************************************  05590000
056000 Z999-SQL-ERROR.                                                  05600000
056100                                                                  05610000
056200     MOVE SQLCODE    TO SQLCODE2.                                 05620000
056300     MOVE SQLERRD(3) TO SQLERRD3.                                 05630000
056400     DISPLAY '** ABEND **       ** = SQLERROR'.                   05640000
056500     DISPLAY '** PROGRAM        ** = MAKUT125'.                   05650001
056600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05660000
056700     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05670000
056800     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05680000
056900     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05690000
057000     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                05700000
057100                                                                  05710000
057200     MOVE SPACES TO WS-MSG-TEXT.                                  05720000
057300*    GET FULL TEXT OF ERROR MESSAGE                               05730000
057400                                                                  05740000
057500     CALL 'SQLGLM' USING WS-MSG-TEXT,                             05750000
057600                         WS-MAX-SIZE,                             05760000
057700                         WS-MSG-LENGTH.                           05770000
057800                                                                  05780000
057900     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               05790000
058000                                                                  05800000
058100     EXEC SQL                                                     05810000
058200      ROLLBACK WORK RELEASE                                       05820000
058300     END-EXEC.                                                    05830000
058400                                                                  05840000
058500     MOVE +4013 TO PV-ABEND-CODE.                                 05850000
058600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05860000
