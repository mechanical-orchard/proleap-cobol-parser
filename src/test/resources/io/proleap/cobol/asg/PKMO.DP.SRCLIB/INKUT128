       IDENTIFICATION DIVISION.                                                 
                                                                                
       PROGRAM-ID.    INKUT128.                                                 
       AUTHOR.        RONNA BUTZ.                                               
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  03/31/00.                                                 
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *  INKUT128                                                      *        
      ******************************************************************        
      *      I N V E N T O R Y   V A R I A N C E   U P D A T E         *        
      ******************************************************************        
      * CREATE A FILE OF REPLACEMENT RECORDS FOR UPDATING DATA WAREHOUSE        
      *                                                                *        
      * THERE ARE TWO INPUT FILES, AND ONE OUTPUT FILE.                *        
      *                                                                *        
      * THE INPUT FILES MUST BE SORTED BY ITEM NUMBER AND STORE.       *        
      *                                                                *        
      * THE DRIVING INPUT FILE IS THE VARIANCE UPDATES FILE            *        
      * FROM FSK025.  THE OTHER INPUT FILE IS THE VARIANCE MASTER FILE.*        
      *                                                                *        
      * ALL OF THE RECORDS ON THE VARIANCE UPDATE FILE WILL HAVE A     *        
      * CORRESPONDING RECORD ON THE OUTPUT FILE.  THE VARIANCE MASTER  *        
      * FILE WILL BE USED TO GET DATA FOR THE OUTPUT FILE.  IF THE     *        
      * VARIANCE UPDATE RECORD IS NOT ON THE VARIANCE MASTER FILE, THEN*        
      * THIS PROGRAM WILL ABEND.                                       *        
      *                                                                *        
      * THE VARIANCE MASTER FILE HAS RECORDS THAT ARE ALREADY SUMMED   *        
      * TOGETHER PER ITEM NUMBER/STORE.  THE VARIANCE UPDATE FILE      *        
      * HAS DETAIL RECORDS PER ITEM/STORE.                             *        
      *                                                                *        
      ******************** HISTORY OF CHANGES **************************        
      * CHG ID/                                                        *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES (MADE BY)          *        
      * -------  ----------  ----------------------------------------  *        
      * 24521    04/05/2003  ADD TRUE-CUTOFF-QTY INPUT AND OUTPUT.     *        
      *                      CHANGE PROGRAM TO EXECUTE AS DB2 SO THAT  *        
      *                      THE PROGRAM CAN VERIFY WHAT TYPE OF STORE *        
      *                      THE LOCATION IS AND SKIP CENTRAL STOCK.   *        
W26600* W26600  07-23-2004 JIM DRAWS MERCH LEDGER STORE EXPANSION      *        
      *                                                                *        
P11245* P11245   06/29/2012  CHANGED THE PROGRAM TO NON-DB2. THE       *        
      *                      "CENTRAL STOCK" STORES WERE BY-PASSED FROM*        
      * (INC000221962)       OUTPUT FILE BECAUSE OF WHICH BUSINESS     *        
      *                      OBJECT REPORT AND RDS REPORT WERE NOT IN  *        
      *                      SINK. HENCE THE CHECK FOR LOC-TY-CD = 'CS'*        
      *                      IS REMOVED.                               *        
      ******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                        
                                                                                
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT VARIANCE-UPDATE-FILE                                          
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT VARIANCE-MASTER-FILE                                          
               ASSIGN TO INP02.                                                 
                                                                                
           SELECT VARIANCE-REPLACE-FILE                                         
               ASSIGN OUT01.                                                    
                                                                                
                                                                                
       DATA DIVISION.                                                           
                                                                                
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  VARIANCE-UPDATE-FILE                                                 
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  VARIANCE-UPDATE-RECORD           PIC X(60).                          
                                                                                
       FD  VARIANCE-MASTER-FILE                                                 
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  VARIANCE-MASTER-RECORD           PIC  X(60).                         
                                                                                
       FD  VARIANCE-REPLACE-FILE                                                
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD                                           
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  VARIANCE-REPLACE-RECORD          PIC  X(60).                         
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
      ****************************************************************          
      * RECORD LAYOUT FOR VARIANCE RECORD                                       
      ****************************************************************          
                                                                                
24521      COPY INRD009.                                                        
                                                                                
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-MAX-MN                    PIC S9(04) COMP SYNC                
                                                       VALUE 12.                
                                                                                
24521  01  ABEND-CODE                      PIC S9(04)      VALUE ZEROES         
24521                          COMP SYNC.                                       
24521      88  ABEND-4008                                  VALUE +4008.         
24521      88  ABEND-4013                                  VALUE +4013.         
24521                                                                           
       01  PS-PROGRAM-SWITCHES.                                                 
24521      05  PS-NOT-EOF-MASTER-FILE      PIC X(01)       VALUE 'N'.           
24521          88 PS-EOF-MASTER-FILE                       VALUE 'Y'.           
24521      05  PS-NOT-EOF-UPDATE-FILE      PIC X(01)       VALUE 'N'.           
24521          88 PS-EOF-UPDATE-FILE                       VALUE 'Y'.           
P11245*    05  PS-STORE-TYPE-SW            PIC X(02)       VALUE SPACES.        
P11245*        88  PS-CS-STORE                             VALUE 'CS'.          
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
24521      05  PV-PROGRAM-NAME             PIC X(8)    VALUE 'INKUT128'.        
P11245*    05  PV-PREV-STORE-NBR           PIC S9(05)      VALUE ZEROES         
P11245*                        COMP-3.                                          
P11245*    05  PV-STORE-NBR-9              PIC S9(04) COMP VALUE +0.            
P11245*    05  PV-CS-RECORD-SKIPPED        PIC S9(11)      VALUE ZEROES         
P11245*                        COMP-3.                                          
P11245*    05  PV-CS-STORE-SKIPPED         PIC S9(11)      VALUE ZEROES         
P11245*                        COMP-3.                                          
24521      05  PV-UPDATE-RECORD-READ       PIC S9(11)      VALUE ZEROES         
24521                          COMP-3.                                          
24521      05  PV-REPLACE-STR-WRITTEN      PIC S9(11)      VALUE ZEROES         
24521                          COMP-3.                                          
24521      05  PV-REPLACE-ITM-WRITTEN      PIC S9(11)      VALUE ZEROES         
24521                          COMP-3.                                          
P11245*    05  PV-DB2-OPER-ATTEMPTED       PIC X(30)       VALUE SPACES.        
24521      05  PV-PARAGRAPH-NAME           PIC X(30)       VALUE SPACES.        
24521                                                                           
       01  HN-HOLD-UPDATE-NUMBERS.                                              
24521      05  HN-ITM-NBR                  PIC S9(15)V     VALUE ZEROES         
24521                          COMP-3.                                          
24521      05  HN-STR-NBR                  PIC S9(05)      VALUE ZEROES         
24521                          COMP-3.                                          
                                                                                
P11245****************************************************************          
P11245*  ERROR MESSAGE AREA FOR DB2                                             
P11245****************************************************************          
P11245*    COPY DPWS004.                                                        
P11245*                                                                         
P11245*****************************************************************         
P11245*    DB2 COMMUNICATION AREA                                               
P11245*****************************************************************         
P11245*                                                                         
P11245*    EXEC SQL                                                             
P11245*        INCLUDE SQLCA                                                    
P11245*    END-EXEC.                                                            
P11245*                                                                         
P11245*****************************************************************         
P11245*    DB2 STORE TABLE                                                      
P11245*****************************************************************         
P11245*                                                                         
P11245*    EXEC SQL                                                             
P11245*        INCLUDE XMT00001                                                 
P11245*    END-EXEC.                                                            
P11245*                                                                         
                                                                                
       LINKAGE SECTION.                                                         
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
                                                                                
       1000-MAIN-MODULE.                                                        
                                                                                
           OPEN INPUT  VARIANCE-UPDATE-FILE                                     
                       VARIANCE-MASTER-FILE                                     
                OUTPUT VARIANCE-REPLACE-FILE.                                   
                                                                                
24521      PERFORM 7000-READ-VARIANCE-UPDATE-FILE.                              
                                                                                
           IF PS-EOF-UPDATE-FILE                                                
               DISPLAY '************************************'                   
               DISPLAY 'INPUT VARIANCE UPDATE FILE IS EMPTY'                    
               DISPLAY '************************************'                   
           ELSE                                                                 
               PERFORM 2000-PROCESS-EXTRACT                                     
24521              UNTIL PS-EOF-UPDATE-FILE                                     
24521      END-IF.                                                              
                                                                                
           CLOSE VARIANCE-UPDATE-FILE                                           
                 VARIANCE-MASTER-FILE                                           
                 VARIANCE-REPLACE-FILE.                                         
                                                                                
           PERFORM 3000-EOJ.                                                    
                                                                                
           STOP RUN.                                                            
                                                                                
       2000-PROCESS-EXTRACT.                                                    
      ******************************************************************        
      *                                                                         
      *  MOVE THE ITEM AND STORE VALUES FROM THE VARIANCE UPDATE                
      *  FILE TO HOLD VARIABLES.                                                
      *                                                                         
      *  READ THROUGH THE VARIANCE MASTER FILE UNTIL THE                        
      *  ITEM NUMBER AND STORE NUMBER FROM THE VARIANCE UPDATE FILE             
      *  MATCHES.                                                               
      *                                                                         
      *  WHEN NOT FOUND, ABEND                                                  
      *  WHEN FOUND, WRITE THE MASTER RECORD TO THE OUTPUT FILE                 
      *                                                                         
      ******************************************************************        
24521      ADD +1                       TO PV-UPDATE-RECORD-READ.               
24521                                                                           
           MOVE IN009-ITM-NBR           TO HN-ITM-NBR.                          
           MOVE IN009-STR-NBR           TO HN-STR-NBR.                          
                                                                                
           INITIALIZE IN009-ITM-NBR                                             
                      IN009-STR-NBR.                                            
                                                                                
           PERFORM 7100-READ-VARIANCE-MASTER-FILE                               
               UNTIL (PS-EOF-MASTER-FILE)               OR                      
                     (PS-EOF-UPDATE-FILE)               OR                      
                     (IN009-ITM-NBR = HN-ITM-NBR        AND                     
                      IN009-STR-NBR = HN-STR-NBR).                              
                                                                                
24521      IF PS-EOF-MASTER-FILE                                                
24521          AND NOT PS-EOF-UPDATE-FILE                                       
               DISPLAY '* * * * * * * * * * * * * * * * * * * * * *'            
               DISPLAY '*'                                                      
               DISPLAY '* ABEND PROGRAM  : ' PV-PROGRAM-NAME                    
               DISPLAY '* IN PARAGRAPH   : 2000-PROCESS-EXTRACT'                
               DISPLAY '*'                                                      
               DISPLAY '*    VARIANCE UPDATE RECORD NOT FOUND '                 
                       'IN VARIANCE MASTER FILE.            '                   
               DISPLAY '*'                                                      
               DISPLAY '*      ITEM NUMBER                  :  '                
               DISPLAY '*      STORE NUMBER                 :  '                
               DISPLAY '*      VARIANCE UPDATE RECORD NUMBER:  '                
               DISPLAY '*'                                                      
               DISPLAY '* * * * * * * * * * * * * * * * * * * * * *'            
24521          SET ABEND-4008 TO TRUE                                           
               PERFORM 9999-ABEND                                               
           END-IF.                                                              
                                                                                
           IF (IN009-ITM-NBR = HN-ITM-NBR        AND                            
               IN009-STR-NBR = HN-STR-NBR)                                      
P11245*        IF IN009-STR-NBR NOT = PV-PREV-STORE-NBR                         
P11245*            MOVE IN009-STR-NBR TO PV-PREV-STORE-NBR                      
P11245*                                  PV-STORE-NBR-9                         
P11245*            PERFORM 2600-GET-STORE-ATTR                                  
P11245*            IF PS-CS-STORE                                               
P11245*                ADD +1   TO PV-CS-STORE-SKIPPED                          
P11245*            ELSE                                                         
P11245*                ADD +1   TO PV-REPLACE-STR-WRITTEN                       
P11245*            END-IF                                                       
P11245*        END-IF                                                           
P11245*        IF PS-CS-STORE                                                   
P11245*            ADD +1   TO PV-CS-RECORD-SKIPPED                             
P11245*        ELSE                                                             
               PERFORM 7200-WRITE-OUTPUT-RECORD                                 
P11245*        END-IF                                                           
               PERFORM 7000-READ-VARIANCE-UPDATE-FILE                           
           END-IF.                                                              
                                                                                
                                                                                
                                                                                
P11245******************************************************************        
P11245*     GET STORE ATTRIBUTES                                                
P11245******************************************************************        
P11245*2600-GET-STORE-ATTR.                                                     
P11245*                                                                         
P11245*    MOVE PV-STORE-NBR-9    TO XMT00001-LOC-NBR.                          
P11245*                                                                         
P11245*    EXEC SQL                                                             
P11245*         SELECT                                                          
P11245*                  A.LOC_TYP_CDE                                          
P11245*         INTO                                                            
P11245*               :PS-STORE-TYPE-SW                                         
P11245*         FROM  XMT_LOC A                                                 
P11245*         WHERE A.LOC_NBR      = :XMT00001-LOC-NBR                        
P11245*    END-EXEC.                                                            
P11245*                                                                         
P11245*    EVALUATE TRUE                                                        
P11245*        WHEN SQLCODE = ZERO                                              
P11245*            DISPLAY ' STORE ' XMT00001-LOC-NBR                           
P11245*                    ' TYPE ' PS-STORE-TYPE-SW                            
P11245*            CONTINUE                                                     
P11245*        WHEN OTHER                                                       
P11245*            DISPLAY ' STORE: ' XMT00001-LOC-NBR                          
P11245*                    '(' PV-PREV-STORE-NBR ')'                            
P11245*            MOVE '2600-GET-STORE-ATTR' TO PV-PARAGRAPH-NAME              
P11245*            MOVE 'SELECT FROM XMT0001' TO PV-DB2-OPER-ATTEMPTED          
P11245*            PERFORM 9998-SQL-ABEND                                       
P11245*    END-EVALUATE.                                                        
P11245*                                                                         
      ******************************************************************        
      *    DISPLAY PROGRAM STATISTICS                                           
      ******************************************************************        
       3000-EOJ.                                                                
                                                                                
           DISPLAY '* * * * * * * * * * * * * * * * * * * * * *'.               
           DISPLAY '*'.                                                         
           DISPLAY '*   PROGRAM STATS: '                                        
           DISPLAY '*'.                                                         
24521      DISPLAY '*   VARIANCE UPDATE RECORDS READ:           '               
24521              PV-UPDATE-RECORD-READ.                                       
P11245*    DISPLAY '*   NUMBER OF CENTRAL STOCK LOC SKIPPED:    '               
P11245*            PV-CS-STORE-SKIPPED.                                         
P11245*    DISPLAY '*   CENTRAL STOCK VARIANCE UPD REC SKIPPED: '               
P11245*            PV-CS-RECORD-SKIPPED.                                        
P11245*    DISPLAY '*   NUMBER OF STORES FOR REPLACEMENT RECS:  '               
P11245*            PV-REPLACE-STR-WRITTEN.                                      
24521      DISPLAY '*   REPLACEMENT RECORDS WRITTEN:            '               
24521              PV-REPLACE-ITM-WRITTEN.                                      
           DISPLAY '*'.                                                         
           DISPLAY '*'.                                                         
           DISPLAY '* * * * * * * * * * * * * * * * * * * * * *'.               
                                                                                
       7000-READ-VARIANCE-UPDATE-FILE.                                          
                                                                                
           INITIALIZE IN009-VARIANCE-RECORD.                                    
                                                                                
           READ VARIANCE-UPDATE-FILE                                            
               INTO IN009-VARIANCE-RECORD                                       
               AT END SET PS-EOF-UPDATE-FILE         TO TRUE.                   
                                                                                
       7100-READ-VARIANCE-MASTER-FILE.                                          
                                                                                
           INITIALIZE IN009-VARIANCE-RECORD.                                    
                                                                                
           READ VARIANCE-MASTER-FILE                                            
               INTO IN009-VARIANCE-RECORD                                       
               AT END SET PS-EOF-MASTER-FILE         TO TRUE.                   
                                                                                
                                                                                
       7200-WRITE-OUTPUT-RECORD.                                                
                                                                                
                                                                                
           WRITE VARIANCE-REPLACE-RECORD                                        
               FROM IN009-VARIANCE-RECORD.                                      
                                                                                
24521      ADD +1                       TO PV-REPLACE-ITM-WRITTEN.              
                                                                                
                                                                                
P11245******************************************************************        
P11245*    EXECUTE ABEND ROUTINE                                       *        
P11245******************************************************************        
P11245*9998-SQL-ABEND.                                                          
P11245*                                                                         
P11245*    SET ABEND-4013 TO TRUE.                                              
P11245*    DISPLAY ' '.                                                         
P11245*    DISPLAY '** ABEND **         ** = SQLERROR'.                         
P11245*    DISPLAY '** PROGRAM          ** = INKUT128'.                         
P11245*    DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.               
P11245*    DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.           
P11245*                                                                         
P11245*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
P11245*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
P11245*    COPY DPPD004.                                                        
P11245*                                                                         
P11245*    PERFORM 9999-ABEND.                                                  
P11245*                                                                         
P11245*                                                                         
24521  9999-ABEND.                                                              
24521                                                                           
24521      CALL 'ILBOABN0' USING ABEND-CODE.                                    
24521                                                                           
