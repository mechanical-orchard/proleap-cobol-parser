000100******************************************************************00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300******************************************************************00030002
000400                                                                  00040002
000500 PROGRAM-ID.   SUKUT137.                                          00050002
000600 AUTHOR.       CLARK SCHWENN.                                     00060002
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                           00070002
000800 DATE-WRITTEN. DECEMBER, 2008.                                    00080002
000900 DATE-COMPILED.                                                   00090002
001000                                                                  00100002
001100******************************************************************00110002
001200*  THIS PROGRAM WILL BE USED TO PULL CARTON DIRECTIVES DATA      *00120002
001300*  FROM SUT_CART_DIRV_TRKG TRACKING HISTORY TABLE FOR THE DUAL   *00130002
001400*  FEED PRINT AND APPLY WITH AUTOMATED CONVEYOR.  IT WILL PRODUCE*00140002
001500*  THIS CARTON DIRECTIVES OUTPUT FILE (KOHL'S DATA) AND BE       *00150002
001600*  MATCHED TO SUKUT138 OUTPUT FILE FROM THE SORT DIRECTOR'S      *00160070
001600*  MESSAGE DATA FOR THE PURPOSE OF DATA INTEGRITY                *00161070
001800******************************************************************00180002
001900******************************************************************00190002
002000 ENVIRONMENT DIVISION.                                            00200002
002100******************************************************************00210002
002200                                                                  00220002
002300 CONFIGURATION SECTION.                                           00230002
002500 SOURCE-COMPUTER.        IBM-3090.                                00250002
002600 OBJECT-COMPUTER.        IBM-3090.                                00260002
002700                                                                  00270002
002800 INPUT-OUTPUT SECTION.                                            00280002
003000 FILE-CONTROL.                                                    00300002
003100                                                                  00310002
003200     SELECT SURD085-CONTROL-FILE          ASSIGN TO INP01.        00320004
003500     SELECT SURD050-EXTRACT-FILE          ASSIGN TO OUT01.        00350004
003600     SELECT FTP-CNTL-FILE                 ASSIGN TO OUT02.        00360058
003800                                                                  00380002
003900******************************************************************00390002
004000 DATA DIVISION.                                                   00400002
004100******************************************************************00410002
004200                                                                  00420002
004300 FILE SECTION.                                                    00430002
004400                                                                  00440002
004500 FD  SURD085-CONTROL-FILE                                         00450002
004600     RECORDING MODE IS F                                          00460002
004700     LABEL RECORDS ARE STANDARD                                   00470002
004800     BLOCK CONTAINS 0 RECORDS.                                    00480002
004900                                                                  00490002
005000 01  SURD085-CONTROL-RECORD        PIC X(80).                     00500056
005100                                                                  00510002
005200 FD  SURD050-EXTRACT-FILE                                         00520002
005300     RECORDING MODE IS F                                          00530002
005400     LABEL RECORDS ARE STANDARD                                   00540002
005500     BLOCK CONTAINS 0 RECORDS.                                    00550002
005600                                                                  00560002
005700 01  SURD050-EXTRACT-RECORD        PIC X(1050).                   00570027
005701                                                                  00570108
005710 FD  FTP-CNTL-FILE                                                00571058
005720     RECORDING MODE IS F                                          00572008
005730     LABEL RECORDS ARE STANDARD                                   00573008
005740     BLOCK CONTAINS 0 RECORDS.                                    00574008
005750                                                                  00575008
005760 01  FTP-CNTL-RECORD               PIC X(80).                     00576058
005800/                                                                 00580004
006000******************************************************************00600002
006100 WORKING-STORAGE SECTION.                                         00610002
006200******************************************************************00620002
006210                                                                  00621004
006300 01  AC-ABEND-CODE                 PIC S9(04)        VALUE +0.    00630004
006500 01  ABEND-CODE                    PIC S9(04)        VALUE +0     00650004
006600                                              COMP SYNC.          00660004
006700 01  PA-PROGRAM-ACCUMULATORS.                                     00670002
006900     05 PA-CNTRL-RECS-READ         PIC S9(13) COMP-3 VALUE +0.    00690005
007100     05 PA-WRITTEN                 PIC S9(13) COMP-3 VALUE +0.    00710005
007400     05 PA-CNTRL-NO-MSG            PIC S9(13) COMP-3 VALUE +0.    00740005
007700     05 PA-FETCH                   PIC S9(13) COMP-3 VALUE +0.    00770005
008000                                                                  00800002
008100 01  PS-PROGRAM-SWITCHES.                                         00810002
008200     05  PS-END-OF-CNTRL-SW        PIC X(01)         VALUE 'N'.   00820005
008300         88  PS-END-OF-CNTRL                         VALUE 'Y'.   00830005
008400         88  PS-END-OF-CNTRL-NO                      VALUE 'N'.   00840005
008500     05  PS-VALID-DC-SW            PIC X(01)         VALUE 'N'.   00850005
008600         88  PS-VALID-DC                             VALUE 'Y'.   00860005
008700         88  PS-INVALID-DC                           VALUE 'N'.   00870005
008800     05  PS-NO-MORE-DIRECT-SW      PIC X(01)         VALUE 'N'.   00880005
008900         88  PS-NO-MORE-DIRECT                       VALUE 'Y'.   00890005
009000         88  PS-MORE-DIRECT                          VALUE 'N'.   00900005
009100     05  PS-NEW-LOGICAL-SW         PIC X(01)         VALUE 'N'.   00910005
009200         88  PS-NEW-LOGICAL                          VALUE 'Y'.   00920005
009300         88  PS-NEW-LOGICAL-NO                       VALUE 'N'.   00930005
009400     05  PS-ROW-FOUND-SW           PIC X(01)         VALUE 'N'.   00940005
009500         88  PS-ROW-FOUND                            VALUE 'Y'.   00950005
009600         88  PS-ROW-FOUND-NO                         VALUE 'N'.   00960005
009700                                                                  00970002
009800 01  PC-PROGRAM-CONSTANTS.                                        00980002
009900     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)         VALUE        00990005
010000                                 'SUKUT137'.                      01000005
010010     05  PC-FTP-CNTL-RECORD.                                      01001058
010011         10  PC-FTP-CNTL-REC-01.                                  01001158
010012* JAK WR39275 CHANGE HARDCODED VALUE TO A VARIABLE FIELD          01001267
010012*            15  FILLER            PIC X(10)         VALUE        01001367
010014*                            'CD /FROMSD'.                        01001467
010015*            15  FILLER            PIC X(70)         VALUE SPACES.01001567
010015             15  PC-FTP-DIRCT-PATH PIC X(60)         VALUE SPACES.01001667
010015             15  FILLER            PIC X(20)         VALUE SPACES.01001767
010016         10  PC-FTP-CNTL-REC-02.                                  01001867
010017             15  FILLER            PIC X(04)         VALUE        01001967
010018                             'GET '.                              01002067
010019             15  PC-FTP-CNTL-DATE.                                01002167
010020                 20  PC-FTP-CNTL-CC PIC X(02)        VALUE SPACES.01002267
010021                 20  PC-FTP-CNTL-YY PIC X(02)        VALUE SPACES.01002367
010022                 20  PC-FTP-CNTL-MM PIC X(02)        VALUE SPACES.01002467
010023                 20  PC-FTP-CNTL-DD PIC X(02)        VALUE SPACES.01002567
010012* JAK WR39275 CHANGE HARDCODED VALUE TO A VARIABLE FIELD          01002667
010030*            15  FILLER            PIC X(22)         VALUE        01003067
010031*                            '_DIRECTIVEHISTORY.HST '.            01003167
010030             15  PC-FTP-FILENAME   PIC X(40)         VALUE SPACES.01003267
010032             15  FILLER            PIC X(09)         VALUE        01003458
010033                             '//DD:DD01'.                         01003558
010040*            15  FILLER            PIC X(37)         VALUE SPACES.01004067
010040             15  FILLER            PIC X(19)         VALUE SPACES.01004168
010050         10  PC-FTP-CNTL-REC-03.                                  01005058
010060             15  FILLER            PIC X(04)         VALUE        01006058
010070                                 'QUIT'.                          01007058
010080             15  FILLER            PIC X(76)         VALUE SPACES.01008058
010100                                                                  01010002
010200 01  PV-PROGRAM-VARIABLES.                                        01020002
010400     05  PV-MINUS-DAYS             PIC S9(4)  COMP   VALUE +0.    01040054
010403     05  PV-NBR-FIELD              PIC 9(09)         VALUE ZEROS. 01040344
010404     05  PV-COUNT                  PIC S9(03) COMP-3 VALUE +0.    01040444
010405     05  PV-START                  PIC S9(03) COMP-3 VALUE +0.    01040544
010406     05  PV-LENGTH                 PIC S9(03) COMP-3 VALUE +0.    01040644
010500     05  PV-BRCDE-NBR              PIC X(22)         VALUE SPACES.01050005
010600     05  PV-MIN-CRE-TMST           PIC X(26)         VALUE SPACES.01060005
010700     05  PV-OPER-UNT-ID            PIC S9(4)  COMP   VALUE +0.    01070005
010800     05  PV-PARAGRAPH-NAME         PIC X(30)         VALUE SPACES.01080005
011200     05  PV-MLT-USE-CDE            PIC X(50)         VALUE SPACES.01120005
011600     05  PV-FORMAT-TMST.                                          01160002
011700         10  PV-FORMAT-TMST-DTE.                                  01170002
011800             15  PV-FORMAT-TMST-DTE-CY  PIC X(04)    VALUE SPACES.01180006
011900             15  PV-FORMAT-TMST-DTE-D1  PIC X(01)    VALUE '-'.   01190006
012000             15  PV-FORMAT-TMST-DTE-MM  PIC X(02)    VALUE SPACES.01200006
012100             15  PV-FORMAT-TMST-DTE-D2  PIC X(01)    VALUE '-'.   01210006
012200             15  PV-FORMAT-TMST-DTE-DD  PIC X(02)    VALUE SPACES.01220006
012300             15  PV-FORMAT-TMST-DTE-D3  PIC X(01)    VALUE '-'.   01230006
012400         10  PV-FORMAT-TMST-TM.                                   01240002
012500             15  PV-FORMAT-TMST-TM-HH   PIC X(02)    VALUE SPACES.01250006
012600             15  PV-FORMAT-TMST-TM-D1   PIC X(01)    VALUE '.'.   01260006
012700             15  PV-FORMAT-TMST-TM-MM   PIC X(02)    VALUE SPACES.01270006
012800             15  PV-FORMAT-TMST-TM-D2   PIC X(01)    VALUE '.'.   01280006
012900             15  PV-FORMAT-TMST-TM-SS   PIC X(02)    VALUE SPACES.01290006
013000             15  PV-FORMAT-TMST-TM-D3   PIC X(01)    VALUE '.'.   01300006
013100             15  PV-FORMAT-TMST-TM-NS   PIC X(06)    VALUE SPACES.01310010
013300         10  PV-FORMAT-OUTPUT-DATE.                               01330002
013400             15  PV-FORMAT-OTPT-DTE-CY  PIC X(04)    VALUE SPACES.01340006
013500             15  PV-FORMAT-OTPT-DTE-MM  PIC X(02)    VALUE SPACES.01350006
013600             15  PV-FORMAT-OTPT-DTE-DD  PIC X(02)    VALUE SPACES.01360006
013700         10  PV-FORMAT-OUTPUT-TIME.                               01370002
013800             15  PV-FORMAT-OTPT-TIME-HH PIC X(02)    VALUE SPACES.01380006
013900             15  PV-FORMAT-OTPT-TIME-MM PIC X(02)    VALUE SPACES.01390006
014000             15  PV-FORMAT-OTPT-TIME-SS PIC X(02)    VALUE SPACES.01400006
014100             15  PV-FORMAT-OTPT-TIME-NN PIC X(06)    VALUE SPACES.01410006
010404* JAK WR39275 ADD FIELDS - START                                  01410166
010404     05  PV-CNTL-CNT                   PIC S9(03) COMP-3 VALUE +0.01410267
010404     05  PV-DIRECTORY-PATH             PIC  X(60) VALUE SPACES.   01410367
010404     05  PV-FTP-FILENAME               PIC  X(40) VALUE SPACES.   01410467
010404* JAK WR39275 ADD FIELDS - END                                    01410567
014110/                                                                 01411003
014200******************************************************************01420002
014300*  IMPUT DUAL FEED CONTROL LAYOUT OF OPER UNT ID                  01430002
014400******************************************************************01440002
014500     COPY SURD085.                                                01450002
014600/                                                                 01460003
014800******************************************************************01480002
014900*  OUTPUT DIRECTIVE TRACKING LAYOUT                               01490002
015000******************************************************************01500002
015100     COPY SURD050.                                                01510057
015110/                                                                 01511003
015400******************************************************************01540002
015500*  DB2 FORMATTED MESSAGE AREA                                     01550002
015600******************************************************************01560002
015700     COPY DPWS004.                                                01570002
015710/                                                                 01571003
015900******************************************************************01590002
016000*  COMMUNICATIONS AREA FOR DB2                                    01600002
016100******************************************************************01610002
016200     EXEC SQL                                                     01620002
016300          INCLUDE SQLCA                                           01630002
016400     END-EXEC.                                                    01640002
016410/                                                                 01641003
016600******************************************************************01660002
016700*  DB2 DECLARATION - SHIPPING UNIT - CARTON DIRECTIVE TRACKING    01670002
016800*      TABLE (SUT_CART_DIRV_TRKG)                                 01680002
016900******************************************************************01690002
017000     EXEC SQL                                                     01700002
017100         INCLUDE SUT00102                                         01710002
017200     END-EXEC.                                                    01720002
017210/                                                                 01721003
017220******************************************************************01722012
017230*  DB2 DECLARATION - PO AUDIT REQUEST TABLE                       01723012
017240*      TABLE (SUT_PO_AUD_REQ)                                     01724012
017250******************************************************************01725012
017260     EXEC SQL                                                     01726012
017270         INCLUDE SUT00015                                         01727012
017280     END-EXEC.                                                    01728012
017290/                                                                 01729012
017900******************************************************************01790002
018000*  DB2 TABLE DECLARATION -  TCOCNTL  TABLE.                       01800002
018100******************************************************************01810002
018200     EXEC SQL                                                     01820002
018300          INCLUDE TCOCNTL                                         01830002
018400     END-EXEC.                                                    01840002
018410/                                                                 01841003
018500******************************************************************01850002
018600*  DB2 DECLARATION - WST_INTGRTN_TYP TABLE.                       01860002
018700******************************************************************01870002
018800     EXEC SQL                                                     01880002
018900          INCLUDE WST00008                                        01890002
019000     END-EXEC.                                                    01900002
019010/                                                                 01901003
019100******************************************************************01910002
019200*  DB2 DECLARATION - WST_ATTR_DEFN TABLE.                         01920002
019300******************************************************************01930002
019400     EXEC SQL                                                     01940002
019500          INCLUDE WST00009                                        01950002
019600     END-EXEC.                                                    01960002
019610/                                                                 01961003
019700******************************************************************01970002
019800*  DB2 DECLARATION - WST_ATTR_ELEM TABLE.                         01980002
019900******************************************************************01990002
020000     EXEC SQL                                                     02000002
020100          INCLUDE WST00010                                        02010002
020200     END-EXEC.                                                    02020002
020210/                                                                 02021003
020300******************************************************************02030002
020400*  DB2 TABLE DECLARATION.                                         02040002
020500*      (TENTNME)                                                  02050002
020600******************************************************************02060002
020700     EXEC SQL                                                     02070002
020800          INCLUDE TENTNME                                         02080002
020900     END-EXEC.                                                    02090002
020910/                                                                 02091003
021000******************************************************************02100002
021100*  DB2 TABLE DECLARATION -  PURCHASE TABLE.                       02110002
021200*      (TPURCHS)                                                  02120002
021300******************************************************************02130002
021400     EXEC SQL                                                     02140002
021500          INCLUDE TPURCHS                                         02150002
021600     END-EXEC.                                                    02160002
021610/                                                                 02161003
021700******************************************************************02170002
021800****THIS IS THE DRIVING CURSOR FOR THIS PGM FOR DUAL FEED PRINT***02180002
021900     EXEC SQL                                                     02190002
022000         DECLARE DIRECT_TRACKING_CSR CURSOR WITH HOLD FOR         02200002
022100         SELECT  H.BRCDE_NBR                                      02210002
022200                 ,H.CRE_TMST                                      02220002
022300                 ,H.OPER_UNT_ID                                   02230002
022400                 ,H.DIRV_RSN_CDE                                  02240002
022500                 ,H.LGCL_LOC_NM                                   02250002
022600                 ,H.AUD_CNTL_NBR                                  02260002
022700                 ,H.SHIPT_UNT_ID                                  02270002
022800                 ,H.AUD_STAT_CDE                                  02280002
022900                 ,H.PO_NBR                                        02290002
023000                 ,H.RCVR_SEQ_NBR                                  02300002
023100                 ,H.PO_LNE_NBR                                    02310002
023200                 ,H.PREPK_ID                                      02320002
023300                 ,H.STR_NBR                                       02330002
023400                 ,H.CRE_PGM_NM                                    02340002
023500                 ,H.ACKNL_SEQ_NBR                                 02350002
023600                 ,H.CASI_CDE                                      02360002
023700                 ,H.CART_STAT_CDE                                 02370002
023800                 ,H.AUD_FALR_RSN_NM                               02380002
023900                 ,H.STR_ZN_ID                                     02390002
024000                 ,H.SEASET_YR                                     02400002
024100                 ,H.SEASET_SHRT_NM                                02410002
024200                 ,H.CNVYR_PRC_ACTN_NM                             02420009
024400                 ,H.CRE_BY_USR_ID                                 02440002
024500           FROM SUT_CART_DIRV_TRKG H                              02450002
024600           WHERE H.OPER_UNT_ID     = :SUT00102-OPER-UNT-ID        02460002
024700           AND   DATE(H.CRE_TMST)  = :COCNTL-BTCH-PRC-DTE         02470002
024800           ORDER BY H.BRCDE_NBR                                   02480002
024810                   ,H.CRE_TMST                                    02481038
024900     END-EXEC.                                                    02490002
024910/                                                                 02491003
025000******************************************************************02500002
025100 PROCEDURE DIVISION.                                              02510002
025200******************************************************************02520002
025300******************************************************************02530002
025400*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *02540002
025500******************************************************************02550002
025600 0000-PROGRAM-MAINLINE.                                           02560002
025700                                                                  02570002
025800     PERFORM 1000-INITIALIZE.                                     02580002
025900                                                                  02590002
027300* JAK WR39275 PERFORM PARAGRAPH 2000 ONCE                         02591079
026000*    PERFORM 2000-PROCESS-INPUT                                   02600079
026100*           UNTIL PS-END-OF-CNTRL.                                02610079
026000     PERFORM 2000-PROCESS-INPUT.                                  02610179
026102                                                                  02610232
026210     PERFORM 1010-WRITE-FTP-CNTL.                                 02621058
026220                                                                  02622014
026300     PERFORM 8000-EOJ-ROUTINE.                                    02630002
026400     STOP RUN.                                                    02640002
026500/                                                                 02650014
026600******************************************************************02660002
026700*  OPENS INPUT FILES AND DOES PRIMING READ OF THE CONTROL FILE.  *02670002
026800******************************************************************02680002
026900 1000-INITIALIZE.                                                 02690002
027000                                                                  02700002
027100     OPEN INPUT SURD085-CONTROL-FILE.                             02710033
027200                                                                  02720002
027300* JAK WR39275 REWRITE INIT PROCESS - START                        02721066
027300****PRIMING READ LOGIC FOR CONTROL FILE***************************02730002
027400*    PERFORM 6000-READ-CONTROL-FILE.                              02740066
026100*                                                                 02742066
027500*    IF PS-END-OF-CNTRL                                           02750066
027600*        DISPLAY '**********************************'             02760066
027700*        DISPLAY '** NO RECORDS ON CONTROL FILE'                  02770066
027800*        DISPLAY '**********************************'             02780066
027900*        MOVE '1000-INITIALIZE'        TO PV-PARAGRAPH-NAME       02790066
027910*        PERFORM 9999-ABEND                                       02792066
028000*    ELSE                                                         02800066
028100*        MOVE SU085-INTGRTY-CHK-OPER-UNT-ID                       02810066
028200*                                  TO SUT00102-OPER-UNT-ID        02820066
028300*        PERFORM 6100-SELECT-PROCESS-DATE                         02830066
028400*        OPEN OUTPUT SURD050-EXTRACT-FILE                         02840066
028410*                    FTP-CNTL-FILE                                02841066
028500*    END-IF.                                                      02850066
028500                                                                  02850166
027400     PERFORM 6000-READ-CONTROL-FILE                               02850266
026100            UNTIL PS-END-OF-CNTRL.                                02850366
028500                                                                  02850466
027500     IF PV-CNTL-CNT = 0                                           02850566
027600         DISPLAY '**********************************'             02850666
027700         DISPLAY '** NO RECORDS ON CONTROL FILE'                  02850766
027800         DISPLAY '**********************************'             02850866
027900         MOVE '1000-INITIALIZE'        TO PV-PARAGRAPH-NAME       02850966
027910         PERFORM 9999-ABEND                                       02851066
027910     END-IF.                                                      02851166
028500                                                                  02851266
028400     OPEN OUTPUT SURD050-EXTRACT-FILE                             02851366
028410                 FTP-CNTL-FILE.                                   02851466
028500                                                                  02851566
027300* JAK WR39275 REWRITE INIT PROCESS - END                          02852066
028600/                                                                 02860014
028601******************************************************************02860114
028610* 1010-WRITE-FTP-CNTL                                            *02861058
028620******************************************************************02862014
028630 1010-WRITE-FTP-CNTL.                                             02863058
028631                                                                  02863214
028640     MOVE COCNTL-BTCH-PRC-DTE(06:02) TO PC-FTP-CNTL-MM.           02864058
028641     MOVE COCNTL-BTCH-PRC-DTE(09:02) TO PC-FTP-CNTL-DD.           02864158
028642     MOVE COCNTL-BTCH-PRC-DTE(01:02) TO PC-FTP-CNTL-CC.           02864258
028643     MOVE COCNTL-BTCH-PRC-DTE(03:02) TO PC-FTP-CNTL-YY.           02864358
028644                                                                  02864414
028644* JAK WR39275 MOVE FTP FIELDS FROM CONTROL CARD TO OUTPUT         02864567
028643     MOVE PV-DIRECTORY-PATH          TO PC-FTP-DIRCT-PATH.        02864669
028643     MOVE PV-FTP-FILENAME            TO PC-FTP-FILENAME.          02864768
028644                                                                  02864867
028644* IF THE FTP IS FROM A WINDOWS SERVER, THE DIRECTORY IS SET       02864973
028644* UP WITHIN THE IIS SOFTWARE ON THE SERVER, SO THERE IS NO NEED   02865073
028644* FOR THE CHANGE DIRECTORY COMMAND IN THE FTP COMMAND LIST.       02865173
028644* FOR UNIX SERVER FTPS, THIS IS NEEDED.                           02865273
028645*    WRITE FTP-CNTL-RECORD FROM PC-FTP-CNTL-REC-01.               02865374
028645     IF PC-FTP-DIRCT-PATH NOT = 'N/A'                             02865473
028645         WRITE FTP-CNTL-RECORD FROM PC-FTP-CNTL-REC-01            02865573
028645     END-IF.                                                      02865673
028644* JAK WR39275 END                                                 02865774
028646     WRITE FTP-CNTL-RECORD FROM PC-FTP-CNTL-REC-02.               02865873
028647     WRITE FTP-CNTL-RECORD FROM PC-FTP-CNTL-REC-03.               02866067
028702/                                                                 02870214
028900******************************************************************02890002
029000* MAIN PROCESSING PARAGRAPH.                                     *02900002
029100******************************************************************02910002
029200 2000-PROCESS-INPUT.                                              02920002
029300                                                                  02930002
029400     INITIALIZE PS-NO-MORE-DIRECT-SW.                             02940002
029500                                                                  02950002
029600* THIS IS THE DRIVING CARTON DIRECTIVE TRKG CURSOR**              02960002
029700     PERFORM 7000-OPEN-DIRECT-TRACKING-CSR.                       02970002
029800     SET PS-ROW-FOUND-NO   TO TRUE.                               02980002
029900     PERFORM 7100-FETCH-DIRECT-TRACK                              02990002
030000         UNTIL PS-NO-MORE-DIRECT.                                 03000002
030100     PERFORM 7300-CLOSE-DIRECT-TRACK-CSR.                         03010002
027300* JAK WR39275 DO NOT READ CONTROL FILE AGAIN                      03011066
030200*    PERFORM 6000-READ-CONTROL-FILE.                              03020066
030300     PERFORM 6050-CHECK-CONTROL-EOF.                              03030002
030400/                                                                 03040032
030500******************************************************************03050002
030600* READ A RECORD FROM THE DUAL FEED DIRECTIVE DATA CONTROL FILE   *03060002
030700******************************************************************03070002
030800 6000-READ-CONTROL-FILE.                                          03080002
030900                                                                  03090002
031000     READ SURD085-CONTROL-FILE                                    03100002
031100         INTO SU085-INTGRTY-CHK-CONTROL                           03110049
031200         AT END                                                   03120002
031300* JAK WR39275 ADD CONTROL RECORD COUNTER AND LOGIC                03130066
031300*          SET PS-END-OF-CNTRL TO TRUE.                           03130166
031300           SET PS-END-OF-CNTRL TO TRUE                            03130266
031200         NOT AT END                                               03131066
031300           ADD 1 TO PV-CNTL-CNT                                   03132066
034400           EVALUATE TRUE                                          03133066
034500              WHEN SU085-INTGRTY-REC-TYPE = 1                     03134066
028100                  MOVE SU085-INTGRTY-CHK-OPER-UNT-ID              03135166
028200                                   TO SUT00102-OPER-UNT-ID        03135266
028300                  PERFORM 6100-SELECT-PROCESS-DATE                03135566
034500              WHEN SU085-INTGRTY-REC-TYPE = 2                     03135666
028100                  MOVE SU085-DIRECTORY-PATH TO PV-DIRECTORY-PATH  03135766
034500              WHEN SU085-INTGRTY-REC-TYPE = 3                     03135866
028100                  MOVE SU085-FTP-FILENAME   TO PV-FTP-FILENAME    03135966
034700              WHEN OTHER                                          03136066
034800                  DISPLAY '** ABEND **'                           03137066
034900                  DISPLAY '** PROGRAM = SUKUT137 **'              03138066
035000                  DISPLAY '** PARA = 6000-READ-CONTROL-FILE'      03139066
035100                  DISPLAY '** INVALID CONTROL RECORD'             03139166
035300                  PERFORM 9100-SQL-ABEND                          03139366
035400           END-EVALUATE.                                          03139466
031400/                                                                 03140032
031500******************************************************************03150002
031600* CHECK END OF FILE FOR THE DUAL FEED CONTROL FILE.              *03160002
031700******************************************************************03170002
031800 6050-CHECK-CONTROL-EOF.                                          03180002
031900                                                                  03190002
032000     IF PS-END-OF-CNTRL                                           03200002
032100         DISPLAY '**********************************'             03210002
032200         DISPLAY '** NORMAL END OF FILE'                          03220002
032300         DISPLAY '**********************************'             03230002
032400     ELSE                                                         03240002
032500         PERFORM 6100-SELECT-PROCESS-DATE                         03250002
032600     END-IF.                                                      03260002
032700/                                                                 03270043
032800******************************************************************03280002
032900* SELECT PROCESS DATE FROM TCOCNTL.                              *03290002
033000******************************************************************03300002
033100 6100-SELECT-PROCESS-DATE.                                        03310002
033200                                                                  03320002
033300     ADD +1 TO PA-CNTRL-RECS-READ.                                03330002
033400                                                                  03340002
033500     INITIALIZE DCLTCOCNTL.                                       03350002
033600                                                                  03360002
033610     IF ( SU085-INTGRTY-CHK-MINUS-DAYS NOT NUMERIC )              03361052
033620         MOVE ZEROS                        TO PV-MINUS-DAYS       03362053
033621     ELSE                                                         03362153
033622         MOVE SU085-INTGRTY-CHK-MINUS-DAYS TO PV-MINUS-DAYS       03362253
033630     END-IF.                                                      03363052
033640                                                                  03364052
033700     EXEC SQL                                                     03370002
033800         SELECT  BTCH_PRC_DTE - :PV-MINUS-DAYS DAYS               03380053
033900           INTO :COCNTL-BTCH-PRC-DTE                              03390002
034000         FROM TCOCNTL                                             03400002
034100           WHERE OPER_UNT_ID          = :SUT00102-OPER-UNT-ID     03410002
034200     END-EXEC.                                                    03420002
034300                                                                  03430002
034400     EVALUATE TRUE                                                03440002
034500         WHEN SQLCODE        = +0                                 03450002
034600              CONTINUE                                            03460002
034700         WHEN OTHER                                               03470002
034800             DISPLAY '** ABEND **'                                03480002
034900             DISPLAY '** PROGRAM = SUKUT137 **'                   03490002
035000             DISPLAY '** PARAGRAPH = 6100-SELECT-PROCESS-DATE'    03500002
035100             DISPLAY '** BATCH PROCESS DATE NOT FOUND FOR DC*'    03510002
035200             DISPLAY '**OPER UNT ID =' SUT00102-OPER-UNT-ID       03520002
035300             PERFORM 9100-SQL-ABEND                               03530002
035400     END-EVALUATE.                                                03540002
035520/                                                                 03552043
035600***************************************************************** 03560002
035700* OPEN CURSOR FOR PULLING ALL DATA FOR EACH CARTON FOR THE DC     03570002
035800* AND BATCH DATE SPECIFIED.   THIS IS THE DRIVING CURSOR.         03580002
035900***************************************************************** 03590002
036000 7000-OPEN-DIRECT-TRACKING-CSR.                                   03600002
036100     EXEC SQL                                                     03610002
036200         OPEN DIRECT_TRACKING_CSR                                 03620002
036300     END-EXEC.                                                    03630002
036400                                                                  03640002
036500     EVALUATE TRUE                                                03650002
036600         WHEN SQLCODE = +0                                        03660002
036700            CONTINUE                                              03670002
036800         WHEN OTHER                                               03680002
036900             DISPLAY '** ABEND **'                                03690002
037000             DISPLAY '** PROGRAM = SUKUT137 **'                   03700002
037100             DISPLAY '** PARAGRAPH 7000-OPEN-DIRECT-TRACKING-CSR' 03710002
037200             PERFORM 9100-SQL-ABEND                               03720002
037300     END-EVALUATE.                                                03730002
037400                                                                  03740002
037500***************************************************************** 03750002
037600* PROCESS FETCHED ROW FROM DIRECT TRACKING CURSOR                 03760002
037700***************************************************************** 03770002
037800 7100-FETCH-DIRECT-TRACK.                                         03780002
037900                                                                  03790002
038000     PERFORM 7200-FETCH-DIRECT-TRACK-CSR.                         03800002
038100                                                                  03810002
038200     IF PS-MORE-DIRECT                                            03820002
038300          PERFORM 7400-SELECT-LOGIC-DEST                          03830002
038500          PERFORM 7600-SELECT-VENDOR-NAME                         03850002
038510          PERFORM 7650-SELECT-AUDIT-DATE                          03851013
038600     END-IF.                                                      03860002
038700                                                                  03870002
038800     IF PS-MORE-DIRECT                                            03880002
038900         IF PS-NEW-LOGICAL-NO                                     03890002
039000             DISPLAY '*NO ROWS FOR UNIQUE INDICATOR AND LOGICAL*' 03900002
039100             DISPLAY '*DESTINATION FOUND FOR:  *****************' 03910002
039200             DISPLAY '*DATE = ' COCNTL-BTCH-PRC-DTE               03920002
039300             DISPLAY '*DC   = ' SU085-INTGRTY-CHK-OPER-UNT-ID     03930002
039400             DISPLAY '*BAR CODE NBR = ' SUT00102-BRCDE-NBR        03940002
039500             DISPLAY '*PO NBR    = ' SUT00102-PO-NBR              03950002
039600             DISPLAY '*RECEIVE SEQ NBR = ' SUT00102-RCVR-SEQ-NBR  03960002
039700             DISPLAY '*DIRECT RSN CDE  = ' SUT00102-DIRV-RSN-CDE  03970002
039800             DISPLAY '*PO LINE NBR = ' SUT00102-PO-LNE-NBR        03980002
039900             DISPLAY '*PREPACK ID  = ' SUT00102-PREPK-ID          03990002
040000             DISPLAY '*STORE NBR   = ' SUT00102-STR-NBR           04000002
040100             PERFORM 7800-FORMAT-DETAIL-LINES                     04010002
040200             MOVE SPACES TO SU050-UNIQUE-IND                      04020002
040300             MOVE SPACES TO SU050-LOGICAL-DEST                    04030002
040400             PERFORM 7900-WRITE-OUTPUT-RECORD                     04040002
040500         ELSE                                                     04050002
040600             PERFORM 7800-FORMAT-DETAIL-LINES                     04060002
040700             PERFORM 7900-WRITE-OUTPUT-RECORD                     04070002
040800         END-IF                                                   04080002
040900     END-IF.                                                      04090002
041000                                                                  04100002
041100***************************************************************** 04110002
041200* FETCH DIRECT TRACKING DRIVING CURSOR                            04120002
041300***************************************************************** 04130002
041400 7200-FETCH-DIRECT-TRACK-CSR.                                     04140002
041500                                                                  04150002
041600     INITIALIZE DCLSUT00102                                       04160002
041700                PS-NO-MORE-DIRECT-SW.                             04170009
041900                                                                  04190002
042000     EXEC SQL                                                     04200002
042100         FETCH  DIRECT_TRACKING_CSR                               04210002
042200          INTO  :SUT00102-BRCDE-NBR                               04220002
042300               ,:SUT00102-CRE-TMST                                04230002
042400               ,:SUT00102-OPER-UNT-ID                             04240002
042500               ,:SUT00102-DIRV-RSN-CDE                            04250002
042600               ,:SUT00102-LGCL-LOC-NM                             04260002
042700               ,:SUT00102-AUD-CNTL-NBR                            04270002
042800               ,:SUT00102-SHIPT-UNT-ID                            04280002
042900               ,:SUT00102-AUD-STAT-CDE                            04290002
043000               ,:SUT00102-PO-NBR                                  04300002
043100               ,:SUT00102-RCVR-SEQ-NBR                            04310002
043200               ,:SUT00102-PO-LNE-NBR                              04320002
043300               ,:SUT00102-PREPK-ID                                04330002
043400               ,:SUT00102-STR-NBR                                 04340002
043500               ,:SUT00102-CRE-PGM-NM                              04350002
043600               ,:SUT00102-ACKNL-SEQ-NBR                           04360002
043700               ,:SUT00102-CASI-CDE                                04370002
043800               ,:SUT00102-CART-STAT-CDE                           04380002
043900               ,:SUT00102-AUD-FALR-RSN-NM                         04390002
044000               ,:SUT00102-STR-ZN-ID                               04400002
044100               ,:SUT00102-SEASET-YR                               04410002
044200               ,:SUT00102-SEASET-SHRT-NM                          04420002
044300               ,:SUT00102-CNVYR-PRC-ACTN-NM                       04430009
044400               ,:SUT00102-CRE-BY-USR-ID                           04440002
044500     END-EXEC.                                                    04450002
044600                                                                  04460002
044700     EVALUATE TRUE                                                04470002
044800         WHEN SQLCODE = +0                                        04480002
044900             ADD +1  TO PA-FETCH                                  04490002
045000             SET PS-ROW-FOUND          TO TRUE                    04500002
045100             SET PS-MORE-DIRECT        TO TRUE                    04510002
045200         WHEN SQLCODE = +100                                      04520002
045300             SET PS-NO-MORE-DIRECT     TO TRUE                    04530002
045400             IF PS-ROW-FOUND-SW = 'N'                             04540002
045500                 ADD +1 TO PA-CNTRL-NO-MSG                        04550002
045600                 DISPLAY '**********************************'     04560002
045700                 DISPLAY '** NO ROWS FOR KOHLS CARTON   ****'     04570002
045800                 DISPLAY '** DIRECTIVE TRACKING WERE FOUND**'     04580002
045900                 DISPLAY '** DIST CENT =                    '     04590002
046000                 DISPLAY  SU085-INTGRTY-CHK-OPER-UNT-ID           04600002
046100                 DISPLAY '** BATCH DATE = '                       04610002
046200                 DISPLAY  COCNTL-BTCH-PRC-DTE                     04620002
046300                 DISPLAY '**********************************'     04630002
046400             END-IF                                               04640002
046500         WHEN SQLWARN0 NOT = SPACE                                04650002
046600         WHEN SQLCODE < ZERO                                      04660002
046700         WHEN SQLCODE > ZERO                                      04670002
046800             DISPLAY '** ABEND **'                                04680002
046900             DISPLAY '** PROGRAM = SUKUT137 **'                   04690002
047000             DISPLAY '** PARAGRAPH = 7200-FETCH-DIRECT-TRACK-CSR' 04700002
047100             PERFORM 9100-SQL-ABEND                               04710002
047200     END-EVALUATE.                                                04720002
047300***************************************************************** 04730002
047400* CLOSE CURSOR FOR PULLING ALL DATA FOR EACH CARTON FOR THE DC    04740002
047500* AND PROCESS BATCH DATE SPECIFIED.                               04750002
047600***************************************************************** 04760002
047700 7300-CLOSE-DIRECT-TRACK-CSR.                                     04770002
047800     EXEC SQL                                                     04780002
047900         CLOSE DIRECT_TRACKING_CSR                                04790002
048000     END-EXEC.                                                    04800002
048100                                                                  04810002
048200     EVALUATE TRUE                                                04820002
048300         WHEN SQLCODE = +0                                        04830002
048400             CONTINUE                                             04840002
048500         WHEN SQLWARN0 NOT = SPACE                                04850002
048600         WHEN SQLCODE < ZERO                                      04860002
048700         WHEN SQLCODE > ZERO                                      04870002
048800             DISPLAY '** ABEND **'                                04880002
048900             DISPLAY '** PROGRAM = SUKUT137 **'                   04890002
049000             DISPLAY '** PARAGRAPH = 7300-CLOSE-DIRECT-TRACK-CSR' 04900002
049100             PERFORM 9100-SQL-ABEND                               04910002
049200     END-EVALUATE.                                                04920002
049300                                                                  04930002
049400***************************************************************** 04940002
049500* SELECT LOGICAL DESTINATION - UNIQUE ID - AND PRIORITY IND       04950002
049600* FOR OUTPUT FILE.                                                04960002
049700***************************************************************** 04970002
049800 7400-SELECT-LOGIC-DEST.                                          04980002
049900                                                                  04990002
050000     INITIALIZE PS-NEW-LOGICAL-SW                                 05000002
050100                DCLWST00008                                       05010002
050200                DCLWST00009                                       05020002
050300                DCLWST00010.                                      05030002
050400                                                                  05040002
050500     EXEC SQL                                                     05050002
050700         SELECT (I.ATTR_ELEM_TXT) AS UNIQUE_IND                   05070062
050900         INTO :PV-MLT-USE-CDE                                     05090062
051000         FROM WST_INTGRTN_TYP         A                           05100002
051100            , WST_ATTR_DEFN           B                           05110002
051200            , WST_ATTR_ELEM           C                           05120002
051300            , WST_ATTR_ELEM           D                           05130002
051400            , WST_ATTR_ELEM           E                           05140002
051500            , WST_ATTR_ELEM           F                           05150002
051600            , WST_ATTR_ELEM           G                           05160002
051700            , WST_ATTR_ELEM           H                           05170002
051800            , WST_ATTR_ELEM           I                           05180002
051900            , WST_ATTR_ELEM           J                           05190002
052000            , WST_ATTR_ELEM           K                           05200002
052100         WHERE A.INTGRTN_TYP_CDE    =  'ACAULGDST'                05210002
052200           AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          05220002
052300           AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          05230002
052400           AND A.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE          05240002
052500           AND A.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE          05250002
052600           AND A.INTGRTN_TYP_CDE    =  F.INTGRTN_TYP_CDE          05260002
052700           AND A.INTGRTN_TYP_CDE    =  G.INTGRTN_TYP_CDE          05270002
052800           AND A.INTGRTN_TYP_CDE    =  H.INTGRTN_TYP_CDE          05280002
052900           AND A.INTGRTN_TYP_CDE    =  I.INTGRTN_TYP_CDE          05290002
053000           AND A.INTGRTN_TYP_CDE    =  J.INTGRTN_TYP_CDE          05300002
053100           AND A.INTGRTN_TYP_CDE    =  K.INTGRTN_TYP_CDE          05310002
053200           AND B.ATTR_DEFN_SEQ_NBR  =  1                          05320002
053300           AND C.ATTR_DEFN_SEQ_NBR  =  1                          05330002
053400           AND D.ATTR_DEFN_SEQ_NBR  =  2                          05340002
053500           AND E.ATTR_DEFN_SEQ_NBR  =  3                          05350002
053600           AND F.ATTR_DEFN_SEQ_NBR  =  4                          05360002
053700           AND G.ATTR_DEFN_SEQ_NBR  =  5                          05370002
053800           AND H.ATTR_DEFN_SEQ_NBR  =  6                          05380002
053900           AND I.ATTR_DEFN_SEQ_NBR  =  7                          05390002
054000           AND J.ATTR_DEFN_SEQ_NBR  =  8                          05400002
054100           AND K.ATTR_DEFN_SEQ_NBR  =  9                          05410002
054200           AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR        05420002
054300           AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR        05430002
054400           AND C.ATTR_ELEM_SEQ_NBR  =  F.ATTR_ELEM_SEQ_NBR        05440002
054500           AND C.ATTR_ELEM_SEQ_NBR  =  G.ATTR_ELEM_SEQ_NBR        05450002
054600           AND C.ATTR_ELEM_SEQ_NBR  =  H.ATTR_ELEM_SEQ_NBR        05460002
054700           AND C.ATTR_ELEM_SEQ_NBR  =  I.ATTR_ELEM_SEQ_NBR        05470002
054800           AND C.ATTR_ELEM_SEQ_NBR  =  J.ATTR_ELEM_SEQ_NBR        05480002
054900           AND C.ATTR_ELEM_SEQ_NBR  =  K.ATTR_ELEM_SEQ_NBR        05490002
055000               AND F.ATTR_ELEM_TXT      =  'Y'                    05500002
055100               AND G.ATTR_ELEM_TMST    <=  CURRENT TIMESTAMP      05510002
055200               AND H.ATTR_ELEM_TMST    >=  CURRENT TIMESTAMP      05520002
055300               AND C.ATTR_ELEM_NBR      =  :SUT00102-OPER-UNT-ID  05530002
055400               AND D.ATTR_ELEM_TXT      =  :SUT00102-DIRV-RSN-CDE 05540002
055500     END-EXEC.                                                    05550002
055700                                                                  05570002
055800     EVALUATE TRUE                                                05580002
055900         WHEN SQLCODE        = +0                                 05590002
056000              SET PS-NEW-LOGICAL TO TRUE                          05600002
056100         WHEN SQLCODE        = +100                               05610002
056200         WHEN SQLCODE        = -305                               05620002
056300              SET PS-NEW-LOGICAL-NO TO TRUE                       05630002
056400         WHEN OTHER                                               05640002
056500             DISPLAY '** ABEND **'                                05650002
056600             DISPLAY '** PROGRAM = SUKUT137 **'                   05660002
056700             DISPLAY '** PARAGRAPH = 7400-SELECT-LOGIC-DEST'      05670002
056800             DISPLAY '**OPER UNT ID =' SUT00102-OPER-UNT-ID       05680002
056900             DISPLAY '**DIRV RSN CDE=' SUT00102-DIRV-RSN-CDE      05690002
057000             DISPLAY '**PO NBR      =' SUT00102-PO-NBR            05700002
057100             DISPLAY '** RCVR SEQ NBR =' SUT00102-RCVR-SEQ-NBR    05710002
057200             DISPLAY '** STR NBR    ='  SUT00102-STR-NBR          05720002
057300             PERFORM 9100-SQL-ABEND                               05730002
057400      END-EVALUATE.                                               05740002
057500/                                                                 05750064
062900***************************************************************** 06290002
063000* SELECT VENDOR NAME FOR OUTPUT FILE                              06300002
063100***************************************************************** 06310002
063200 7600-SELECT-VENDOR-NAME.                                         06320002
063300                                                                  06330002
063400     INITIALIZE DCLTPURCHS                                        06340002
063500                DCLTENTNME.                                       06350002
063600                                                                  06360002
063700     EXEC SQL                                                     06370002
063800         SELECT  DISTINCT                                         06380002
063900                  B.ENT_NAME_DESC                                 06390002
064000           INTO :ENTNME-ENT-NAME-DESC                             06400002
064100           FROM TPURCHS A,                                        06410002
064200                TENTNME B                                         06420002
064300           WHERE A.ENT_ID         =   B.ENT_ID                    06430002
064400           AND   A.VER_STATUS_CDE =   'A'                         06440002
064500           AND   B.TYPE_CDE       =   '01'                        06450060
064600           AND   A.PO_NBR         =   :SUT00102-PO-NBR            06460002
064700     END-EXEC.                                                    06470002
064800                                                                  06480002
064900     EVALUATE TRUE                                                06490002
065000         WHEN SQLCODE        = +0                                 06500002
065100             CONTINUE                                             06510002
065200         WHEN SQLCODE        = +100                               06520002
065300             DISPLAY '** PROGRAM = SUKUT137 **'                   06530007
065400             DISPLAY '** PARAGRAPH = 7600-SELECT-VENDOR-NAME'     06540002
065500             DISPLAY '** +100 CANNOT FIND ROW ******************' 06550002
065600             DISPLAY '**SUT00102-PO-NBR = '                       06560002
065700             DISPLAY  SUT00102-PO-NBR                             06570002
065800         WHEN OTHER                                               06580002
065900             DISPLAY '** ABEND **'                                06590002
066000             DISPLAY '** PROGRAM = SUKUT137 **'                   06600007
066100             DISPLAY '** PARAGRAPH = 7600-SELECT-VENDOR-NAME'     06610002
066200             DISPLAY '**SUT00102-PO-NBR = '                       06620002
066300             DISPLAY  SUT00102-PO-NBR                             06630002
066400             PERFORM 9100-SQL-ABEND                               06640002
066500     END-EVALUATE.                                                06650002
066600/                                                                 06660013
066610***************************************************************** 06661013
066620* SELECT AUDIT DATE                                               06662013
066630***************************************************************** 06663013
066640 7650-SELECT-AUDIT-DATE.                                          06664015
066650                                                                  06665013
066660     INITIALIZE DCLSUT00015.                                      06666013
066680                                                                  06668013
066681     EXEC SQL                                                     06668113
066690         SELECT DATE(A.CRE_TMST)                                  06669013
066692           INTO :SUT00015-CRE-TMST                                06669213
066694           FROM SUT_PO_AUD_REQ A                                  06669413
066695              , TENTNME        B                                  06669513
066696           WHERE A.PO_NBR         =  :SUT00102-PO-NBR             06669613
066697             AND A.RCVR_SEQ_NBR   =  :SUT00102-RCVR-SEQ-NBR       06669713
066698             AND A.PO_LNE_NBR     =  :SUT00102-PO-LNE-NBR         06669813
066699             AND A.PO_PREPK_ID    =  :SUT00102-PREPK-ID           06669913
066700             AND A.OPER_UNT_ID    =  :SUT00102-OPER-UNT-ID        06670013
066701             AND A.ENT_ID         =  B.ENT_ID                     06670113
066702             AND B.TYPE_CDE       =  '01'                         06670213
066703     END-EXEC.                                                    06670313
066704                                                                  06670413
066709     EVALUATE TRUE                                                06670917
066710         WHEN SQLCODE        = +0                                 06671017
066711             CONTINUE                                             06671117
066712         WHEN SQLCODE        = +100                               06671217
066713             DISPLAY '** PROGRAM = SUKUT137 **'                   06671317
066714             DISPLAY '** PARAGRAPH = 7650-SELECT-AUDIT-DATE'      06671417
066715             DISPLAY '** +100 CANNOT FIND ROW ******************' 06671517
066716             DISPLAY '**SUT00102-PO-NBR = '                       06671617
066717             DISPLAY  SUT00102-PO-NBR                             06671717
066718         WHEN OTHER                                               06671817
066719             DISPLAY '** ABEND **'                                06671917
066720             DISPLAY '** PROGRAM = SUKUT137 **'                   06672017
066721             DISPLAY '** PARAGRAPH = 7600-SELECT-VENDOR-NAME'     06672117
066722             DISPLAY '**SUT00102-PO-NBR = '                       06672217
066723             DISPLAY  SUT00102-PO-NBR                             06672317
066724             PERFORM 9100-SQL-ABEND                               06672417
066725     END-EVALUATE.                                                06672517
066726/                                                                 06672617
066730***************************************************************** 06673002
066800* FORMAT OUTPUT RECORD SU050-DIRECTIV-TRACKING-DATA (SURD050)     06680002
066900* FOR INPUT TO SUKUT138.                                          06690002
067000******************************************************************06700002
067100 7800-FORMAT-DETAIL-LINES.                                        06710002
067200                                                                  06720002
067300     INITIALIZE SU050-DIRECTIV-TRACKING-DATA.                     06730002
067400                                                                  06740002
067500     ADD +1                          TO PA-WRITTEN.               06750009
067601*                                                                 06760123
067602* KEY FIELDS                                                      06760223
067603*                                                                 06760323
067604     MOVE SUT00102-BRCDE-NBR         TO SU050-BRCD-NBR.           06760423
067610     MOVE SUT00102-CRE-TMST          TO SU050-CRE-TMST.           06761023
067620*                                                                 06762023
067630* COMPARE-FIELDS                                                  06763023
067640*                                                                 06764023
067700     MOVE SUT00102-CNVYR-PRC-ACTN-NM TO SU050-CNVYR-PRC-ACTN-CDE. 06770009
067710                                                                  06771034
067720     MOVE SUT00102-PO-NBR TO PV-NBR-FIELD.                        06772036
067721     PERFORM 7810-REFORMAT-NUMERICS.                              06772134
067722     MOVE PV-NBR-FIELD(PV-START:PV-LENGTH)                        06772236
067723                                     TO SU050-PO-NBR.             06772334
067724                                                                  06772434
067725     MOVE SUT00102-RCVR-SEQ-NBR TO PV-NBR-FIELD.                  06772539
067726     PERFORM 7810-REFORMAT-NUMERICS.                              06772639
067727     MOVE PV-NBR-FIELD(PV-START:PV-LENGTH)                        06772739
067728                                     TO SU050-RCVR-SEQ-NBR.       06772839
067734                                                                  06773439
067735     MOVE SUT00102-PO-LNE-NBR TO PV-NBR-FIELD.                    06773539
067736     PERFORM 7810-REFORMAT-NUMERICS.                              06773639
067737     MOVE PV-NBR-FIELD(PV-START:PV-LENGTH)                        06773739
067738                                     TO SU050-PO-LNE-NBR.         06773839
067739                                                                  06773939
067741     MOVE SUT00102-DIRV-RSN-CDE      TO SU050-DIRECTIV-REASON-CDE.06774134
067750     MOVE SUT00102-CASI-CDE          TO SU050-CURR-CASI-CDE.      06775034
067930     MOVE SUT00102-CART-STAT-CDE     TO SU050-CART-STAT-CDE.      06793009
067931     MOVE SUT00102-LGCL-LOC-NM       TO SU050-LOGICAL-DEST.       06793162
067932                                                                  06793239
067933     MOVE SUT00102-AUD-CNTL-NBR TO PV-NBR-FIELD.                  06793339
067934     PERFORM 7810-REFORMAT-NUMERICS.                              06793439
067935     MOVE PV-NBR-FIELD(PV-START:PV-LENGTH)                        06793539
067936                                     TO SU050-AUD-CNTL-NBR.       06793639
067937                                                                  06793739
067950     MOVE SUT00102-AUD-STAT-CDE      TO SU050-AUD-STAT-CDE.       06795009
067960     MOVE SUT00102-AUD-FALR-RSN-NM   TO SU050-AUD-FALR-RSN-NM.    06796009
067961                                                                  06796113
067962     MOVE SUT00015-CRE-TMST          TO PV-FORMAT-TMST.           06796213
067963     MOVE PV-FORMAT-TMST-DTE-CY      TO PV-FORMAT-OTPT-DTE-CY.    06796313
067964     MOVE PV-FORMAT-TMST-DTE-MM      TO PV-FORMAT-OTPT-DTE-MM.    06796413
067965     MOVE PV-FORMAT-TMST-DTE-DD      TO PV-FORMAT-OTPT-DTE-DD.    06796513
067966     MOVE PV-FORMAT-OUTPUT-DATE      TO SU050-AUD-CART-BEG-DTE.   06796613
067967                                                                  06796713
067968     MOVE SUT00102-PREPK-ID TO PV-NBR-FIELD.                      06796840
067969     PERFORM 7810-REFORMAT-NUMERICS.                              06796940
067970     MOVE PV-NBR-FIELD(PV-START:PV-LENGTH)                        06797040
067980                                     TO SU050-PRE-PACK-ID.        06798040
067990                                                                  06799040
067993     MOVE SUT00102-STR-ZN-ID         TO SU050-STR-ZN-ID.          06799309
067995     MOVE SUT00102-SEASET-SHRT-NM    TO SU050-SEASET-SHRT-NM.     06799509
067996                                                                  06799641
067997     MOVE SUT00102-STR-NBR TO PV-NBR-FIELD.                       06799741
067998     PERFORM 7810-REFORMAT-NUMERICS.                              06799841
067999     MOVE PV-NBR-FIELD(PV-START:PV-LENGTH)                        06799941
068000                                     TO SU050-STR-NBR.            06800041
068001                                                                  06800141
068003     MOVE ENTNME-ENT-NAME-DESC       TO SU050-VNDR-NAME.          06800323
068004     MOVE SUT00102-CRE-BY-USR-ID     TO SU050-CRE-BY-USR-ID.      06800409
068005                                                                  06800524
068006     IF ( PV-MLT-USE-CDE(1:1) = 'U' )                             06800624
068007         MOVE 'UNIQUE   '            TO SU050-UNIQUE-IND          06800725
068010     ELSE                                                         06801024
068011         MOVE 'NONUNIQUE'            TO SU050-UNIQUE-IND          06801125
068020     END-IF.                                                      06802024
073100/                                                                 07310008
073110***************************************************************** 07311034
073120* 7810-REFORMAT-NUMERICS                                          07312034
073130*     STRIP LEADING ZEROS BEFORE MOVING TO A CHARACTER FIELD      07313034
073140******************************************************************07314034
073150 7810-REFORMAT-NUMERICS.                                          07315034
073160                                                                  07316034
073170     MOVE +0 TO PV-COUNT.                                         07317034
073180     INSPECT PV-NBR-FIELD                                         07318036
073190            TALLYING PV-COUNT FOR LEADING ZEROS.                  07319034
073191                                                                  07319134
073192     IF ( PV-COUNT = LENGTH OF PV-NBR-FIELD )                     07319261
073193         MOVE PV-COUNT TO PV-START                                07319361
073194         MOVE +1       TO PV-LENGTH                               07319461
073195     ELSE                                                         07319561
073196         COMPUTE PV-START  = ( PV-COUNT + 1 )                     07319661
073197         COMPUTE PV-LENGTH = ( LENGTH OF PV-NBR-FIELD - PV-COUNT )07319761
073198     END-IF.                                                      07319861
073199                                                                  07319961
073243/                                                                 07324334
073250***************************************************************** 07325002
073300* WRITE OUTPUT RECORD SU050-DIRECTIV-TRACKING-DATA (SURD050)      07330002
073400* FOR INPUT TO SUKUT138.                                          07340002
073500******************************************************************07350002
073600 7900-WRITE-OUTPUT-RECORD.                                        07360002
073700                                                                  07370002
073800     WRITE SURD050-EXTRACT-RECORD                                 07380002
073900         FROM SU050-DIRECTIV-TRACKING-DATA.                       07390002
074000/                                                                 07400008
074100******************************************************************07410002
074200* CLOSE THE INPUT AND OUTPUT FILES AND DISPLAY MISCELLANEOUS     *07420002
074300* JOB SUMMARY INFORMATION.                                       *07430002
074400******************************************************************07440002
074500 8000-EOJ-ROUTINE.                                                07450002
074510                                                                  07451008
074600     CLOSE SURD085-CONTROL-FILE                                   07460010
074700           SURD050-EXTRACT-FILE                                   07470008
074710           FTP-CNTL-FILE.                                         07471058
074800                                                                  07480002
074900     DISPLAY '**********************************'.                07490002
075000     DISPLAY '** SUKUT137 SUMMARY **'.                            07500002
075100     DISPLAY 'CONTROL RECORD READ     = ' PA-CNTRL-RECS-READ.     07510002
075200     DISPLAY 'CONTROL RECORDS NO MSGS = ' PA-CNTRL-NO-MSG.        07520002
075300     DISPLAY '**********************************'.                07530002
075400     DISPLAY '**********************************'.                07540002
075500     DISPLAY 'RECORDS FETCHED FROM DRIVING CURSOR' PA-FETCH.      07550002
075600     DISPLAY 'RECORDS WRITTEN TO FILE = ' PA-WRITTEN.             07560002
075700     DISPLAY '**********************************'.                07570002
075800/                                                                 07580063
076100******************************************************************07610002
076200* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *07620002
076300* ERROR OR WARNING CODE OCCURS.                                  *07630002
076400******************************************************************07640002
076500******************************************************************07650002
076600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *07660002
076700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *07670002
076800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *07680002
076900* FORMAT.                                                        *07690002
077000******************************************************************07700002
077100 9100-SQL-ABEND.                                                  07710002
077200                                                                  07720002
077300     COPY DPPD004.                                                07730002
077400                                                                  07740002
077500     MOVE +4013 TO ABEND-CODE.                                    07750002
077600     CALL 'ILBOABN0' USING ABEND-CODE.                            07760002
077700******************************************************************07770002
077800* 9999-ABEND                                                      07780002
077900*     ABEND PROGRAM WHEN AN ERROR OCCURS.                         07790002
078000******************************************************************07800002
078100 9999-ABEND.                                                      07810002
078200                                                                  07820002
078300     DISPLAY '** ABEND           **'.                             07830002
078400     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  07840002
078500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        07850002
078600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         07860002
