000100***************************************************************** 00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300***************************************************************** 00030099
000400 PROGRAM-ID.    MAKUP102.                                         00040099
000500 AUTHOR.        KAREN WALL                                        00050099
000600 INSTALLATION.  KOHLS.                                            00060099
000700 DATE-WRITTEN   JULY  2005.                                       00070099
000800 DATE-COMPILED.                                                   00080099
000900***************************************************************** 00090099
001000*  THIS BATCH DB2 PROGRAM READS THE FILE CREATED BY IMKUT024    * 00100099
001100*  (PKMO.IM.ITEM.SKU.DOMAIN.EXTRACT.G**V00)                     * 00110099
001200*  CONTAINING SKU INFORMATION.  THIS DATA USED TO UPDATE        * 00120099
001300*  ASSOCIATED SKU INFORMATION IN THE ORACLE TABLE TMDSEIT FOR   * 00130099
001400*  THE FOLLOWING FIELDS THAT MAY BE DIFFERENT BETWEEN VSM AND   * 00140099
001500*    MA ITEM TABLES:                                              00150099
001600*              KOHLS-SIZE-CODE                                    00160099
001700*              KOHLS-SIZE-DESC                                    00170099
001800*              NRF-CLOR-CDE                                       00180099
001900*              CSTM-CLOR-DESC                                     00190099
002000*              E-BUS-ITM-IND                                      00200099
002100*              ASRT-BEG-DTE                                       00210099
002200*              ASRT-END-DTE                                       00220099
002300*                                                                 00230099
002400*  THIS PROGRAM WILL PUT INTO AN ERROR FILE ANY SQL ERRORS        00240099
002500*   INCLUDING:                                                    00250099
002600*     1.  SKU NOT FOUND IN MA ITEM TABLES                         00260099
002700*     2.  DUPLICATE SKUS ARE ACTIVE IN MA ITEM TABLES.            00270099
002800*   NO UPDATING WILL OCCUR OF ANY OF THE FIELDS FOR THESE SKUS    00280099
002900*                                                                 00290099
003000*                                                                 00300099
003100*  THIS IS USED AS A DATA INTEGRITY OF MA ITEM TABLES VERSUS    * 00310099
003200*  THE ITEM SKU COMMON EXTRACT FILE FROM VSM.                   * 00320099
003300***************************************************************** 00330099
070941**  HISTORY LOG:                                                * 00332099
070941***************************************************************** 00333099
070941* DATE:         07/30/2018                                      * 00335099
070941* WR/IR#:       CHG0205458                                      * 00336099
070941* PROGRAMMER:   COGNIZANT                                       * 00337099
070941* DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE           * 00338099
070941******************************************************************00339099
003400 ENVIRONMENT DIVISION.                                            00340099
003500 INPUT-OUTPUT SECTION.                                            00350099
003600                                                                  00360099
003700 FILE-CONTROL.                                                    00370099
003800                                                                  00380099
003900     SELECT SKU-UPDATE-IN             ASSIGN TO INP01.            00390099
004000     SELECT SKU-UPD-ERR-OUT           ASSIGN TO OUT01.            00400099
004100     SELECT ORACLE-LOGON-FILE         ASSIGN TO ORALOGON.         00410099
004200                                                                  00420099
004300***************************************************************** 00430099
004400 DATA DIVISION.                                                   00440099
004500***************************************************************** 00450099
004600 FILE SECTION.                                                    00460099
004700                                                                  00470099
004800 FD  SKU-UPDATE-IN                                                00480099
004900     RECORDING MODE IS F                                          00490099
005000     BLOCK CONTAINS 0 RECORDS                                     00500099
005100     LABEL RECORDS ARE OMITTED.                                   00510099
005200                                                                  00520099
005300 01  SKU-UPDATE-IN-RECORD         PIC X(500).                     00530099
005400                                                                  00540099
005500 FD  SKU-UPD-ERR-OUT                                              00550099
005600     RECORDING MODE IS F                                          00560099
005700     BLOCK CONTAINS 0 RECORDS                                     00570099
005800     LABEL RECORDS ARE OMITTED.                                   00580099
005900                                                                  00590099
006000 01  SKU-UPD-ERROR-RECORD         PIC X(550).                     00600099
006100                                                                  00610099
006200 FD  ORACLE-LOGON-FILE                                            00620099
006300     RECORDING MODE IS F                                          00630099
006400     LABEL RECORDS ARE STANDARD                                   00640099
006500     BLOCK CONTAINS 0 RECORDS                                     00650099
006600     RECORD CONTAINS 80 CHARACTERS                                00660099
006700     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00670099
006800                                                                  00680099
006900 01  OL-ORACLE-LOGON-RECORD      PIC X(80).                       00690099
007000                                                                  00700099
007100***************************************************************** 00710099
007200 WORKING-STORAGE SECTION.                                         00720099
007300                                                                  00730099
007400 01  PS-PROGRAM-SWITCHES.                                         00740099
007500     05  PS-END-OF-LOGON-FILE-SW      PIC X(01)  VALUE 'N'.       00750099
007600         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       00760099
007700     05  PS-END-OF-PROC-INST-FILE-SW  PIC X(01)  VALUE 'N'.       00770099
007800         88  PS-END-OF-PROC-INST-FILE            VALUE 'Y'.       00780099
007900         88  PS-NOT-END-OF-PROC-INST-FILE        VALUE 'N'.       00790099
008000     05  PS-ORA-SRC-CTL-DONE-SW       PIC X(01)  VALUE 'N'.       00800099
008100         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       00810099
008200     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00820099
008300         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00830099
008400         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00840099
008500                                                                  00850099
008600     05  PS-DISCREPANCY               PIC X(01)  VALUE 'N'.       00860099
008700         88  PS-DISCREPANCY-FND                  VALUE 'Y'.       00870099
008800         88  PS-DISCREPANCY-NOT-FND              VALUE 'N'.       00880099
008900                                                                  00890099
009000 01  CC-ORACLE-CONNECTION.                                        00900099
009100     05  CC-ORACLE-USERID             PIC X(40).                  00910099
009200         88 CC-AUTO-LOGON                         VALUE '/'.      00920099
009300     05  CC-ORACLE-PASSWORD           PIC X(40).                  00930099
009400                                                                  00940099
009500 01  PC-PROGRAM-CONSTANTS.                                        00950099
009600     05  PC-AUTO-LOGON                PIC  X(01) VALUE '/'.       00960099
009700     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'MAKUP102'.00970099
009800     05  PC-MAX-COMMIT-REC            PIC  9(09) VALUE 300.       00980099
009900                                                                  00990099
010000 01  PV-PROGRAM-VARIABLES.                                        01000099
010100     05  PV-ORACLE-USERID-LEN         PIC S9(04)  VALUE ZEROS     01010099
010200                                                  COMP SYNC.      01020099
010300     05  PV-ORACLE-PASSWORD-LEN       PIC S9(04)  VALUE ZEROS     01030099
010400                                                  COMP SYNC.      01040099
010500     05  PV-RECORDS-READ              PIC  9(09)  VALUE  0.       01050099
010600     05  PV-RECORDS-UPDATED           PIC  9(09)  VALUE  0.       01060099
010700                                                                  01070099
010800     05  PV-B4-KOHLS-SIZE-CDE         PIC  S9(09)  COMP.          01080099
010900     05  PV-B4-NRF-CLOR-CDE           PIC  X(03).                 01090099
011000     05  PV-B4-SIZE-DESC              PIC  X(10).                 01100099
011100     05  PV-B4-CSTM-CLOR-DESC         PIC  X(10).                 01110099
011200     05  PV-B4-E-ITM-IND              PIC  X(01).                 01120099
011300     05  PV-B4-E-ASRT-BEG-DTE         PIC  X(10).                 01130099
011400     05  PV-B4-E-ASRT-END-DTE         PIC  X(10).                 01140099
011500     05  PV-SIZE-DESC-NULL            PIC S9(04) COMP             01150099
011600                                                    VALUE 0.      01160099
011700     05  PV-COLOR-DESC-NULL           PIC S9(04) COMP             01170099
011800                                                  VALUE 0.        01180099
011900     05  PV-SIZE-CDE-NULL             PIC S9(04) COMP             01190099
012000                                                  VALUE 0.        01200099
012100     05  PV-COLOR-CDE-NULL            PIC S9(04) COMP             01210099
012200                                                  VALUE 0.        01220099
012300     05  PV-WEB-IND-NULL              PIC S9(04) COMP             01230099
012400                                                  VALUE 0.        01240099
012500     05  PV-ASRT-BEG-DTE-NULL         PIC S9(04) COMP             01250099
012600                                                  VALUE 0.        01260099
012700     05  PV-ASRT-END-DTE-NULL         PIC S9(04) COMP             01270099
012800                                                  VALUE 0.        01280099
012900     05  PV-DISP-SKU                  PIC  9(08)  VALUE  0.       01290099
013000     05  PV-SQLCODE                   PIC S9(09)  VALUE +0.       01300099
013100     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               01310099
013200     05  PV-CALLING-PARA              PIC X(10)   VALUE SPACES.   01320099
013300     05  PV-SKU-PROCESS-CODE          PIC X(01)   VALUE SPACES.   01330099
013400     05  PV-ERRMSGBUF.                                            01340099
013500         10 PV-EXTRACT-MSG            PIC  X(500) VALUE SPACES.   01350099
013600         10 PV-EXTRACT-SPACES         PIC  X(5)   VALUE SPACES.   01360099
013700         10 PV-EXTRACT-ERR-PARA       PIC  X(20)  VALUE SPACES.   01370099
013800         10 PV-EXTRACT-SPACES2        PIC  X(5)   VALUE SPACES.   01380099
013900         10 PV-EXTRACT-ERR            PIC  X(10)  VALUE SPACES.   01390099
014000     05  PV-TOTAL-ERR-REC             PIC  9(09)  VALUE ZEROS.    01400099
014100                                                                  01410099
014200* TOTALS FOR FIELD DISCREPANCIES BETWEEN VSM AND MA ITEM          01420099
014300     05  PV-CNT-E-ITM-DSP             PIC  9(09) VALUE ZEROS.     01430099
014400     05  PV-CNT-E-ASRT-BEG-DTE-DSP    PIC  9(09) VALUE ZEROS.     01440099
014500     05  PV-CNT-E-ASRT-END-DTE-DSP    PIC  9(09) VALUE ZEROS.     01450099
014600     05  PV-CNT-SIZE-CDE-DSP          PIC  9(09) VALUE ZEROS.     01460099
014700     05  PV-CNT-SIZE-DESC-DSP         PIC  9(09) VALUE ZEROS.     01470099
014800     05  PV-CNT-NRF-CLOR-CDE-DSP      PIC  9(09) VALUE ZEROS.     01480099
014900     05  PV-CNT-CSTM-CLOR-DESC-DSP    PIC  9(09) VALUE ZEROS.     01490099
015000                                                                  01500099
015100     05  PV-COUNT-RECORD-TO-COMMIT    PIC  9(09)  VALUE  0.       01510099
015200                                                                  01520099
015300 01  PS-PROGRAM-SWITCHES.                                         01530099
015400     05  PS-FOUND-SKU-SW                PIC  X(01)  VALUE 'N'.    01540099
015500         88  PS-FOUND-SKU                           VALUE 'Y'.    01550099
015600         88  PS-NOT-FOUND-SKU                       VALUE 'N'.    01560099
015700                                                                  01570099
015800     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01580099
015900                                                                  01590099
016000 01  PV-ORACLE-ID                     PIC X(1)    VALUE '/'.      01600099
016100 01  USERNAME                         PIC X(10)   VARYING.        01610099
016200 01  PASSWD                           PIC X(10)   VARYING.        01620099
016300 01  PV-CURRENT-TMST                  PIC X(19)   VALUE SPACES.   01630099
016400 01  PV-CURRENT-TMST-NEW              PIC X(19)   VALUE SPACES.   01640099
016500 01  PV-ABEND-FIELDS.                                             01650099
016600     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         01660099
016700                                                 COMP SYNC.       01670099
016800     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'MAKUP102'.01680099
016900     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01690099
017000     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01700099
017100     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    01710099
017200     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01720099
017300     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01730099
017400     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01740099
017500                                                                  01750099
017600                                                                  01760099
017700***********************************************************       01770099
017800*  COPYBOOK USED FOR THE SKU ADDS INPUT FILE              *       01780099
017900***********************************************************       01790099
018000     COPY IMRD053.                                                01800099
018100                                                                  01810099
018200***********************************************************       01820099
018300*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       01830099
018400***********************************************************       01840099
018500     COPY DPWS004.                                                01850099
018600                                                                  01860099
018700***********************************************************       01870099
018800*  ORACLE SQL COMMUNICATION AREA                          *       01880099
018900***********************************************************       01890099
019000                                                                  01900099
019100                                                                  01910099
019200     EXEC SQL                                                     01920099
019300          INCLUDE TITMCLT                                         01930099
019400     END-EXEC.                                                    01940099
019500                                                                  01950099
019600     EXEC SQL                                                     01960099
019700          INCLUDE TMDSEIT                                         01970099
019800     END-EXEC.                                                    01980099
019900                                                                  01990099
020000     EXEC SQL                                                     02000099
020100          INCLUDE SQLCA                                           02010099
020200     END-EXEC.                                                    02020099
020300                                                                  02030099
020400     EXEC SQL END DECLARE SECTION END-EXEC.                       02040099
020500                                                                  02050099
020600     COPY SQLCA2.                                                 02060099
020700 EJECT                                                            02070099
020800***********************************************************       02080099
020900***************************************************************** 02090099
021000 PROCEDURE DIVISION.                                              02100099
021100***************************************************************** 02110099
021200     DISPLAY '**** BEGINNING MAKUP102 ****'.                      02120099
021300     DISPLAY ' '.                                                 02130099
021400                                                                  02140099
021500     OPEN INPUT  SKU-UPDATE-IN.                                   02150099
021600     OPEN OUTPUT SKU-UPD-ERR-OUT.                                 02160099
021700                                                                  02170099
021800     PERFORM 0500-CONNECT-TO-ORACLE.                              02180099
021900     PERFORM 1000-READ-INPUT-FILE.                                02190099
022000                                                                  02200099
022100     PERFORM 2000-PROCESS-INPUT-FILE                              02210099
022200       UNTIL PS-EOF-INPUT-YES.                                    02220099
022300                                                                  02230099
022400     CLOSE SKU-UPDATE-IN.                                         02240099
022500     CLOSE SKU-UPD-ERR-OUT.                                       02250099
022600                                                                  02260099
022700     PERFORM 3000-TABLE-COMMIT.                                   02270099
022800                                                                  02280099
022900     DISPLAY '****  TOTALS  MAKUP102  ****'.                      02290099
023000     DISPLAY ' DISCREPANCY - E-ITM         = ' PV-CNT-E-ITM-DSP.  02300099
023100     DISPLAY ' DISCREPANCY- ASRT-BEG-DTE   = '                    02310099
023200                                       PV-CNT-E-ASRT-BEG-DTE-DSP. 02320099
023300     DISPLAY ' DISCREPANCY - ASRT-END-DTE  = '                    02330099
023400                                       PV-CNT-E-ASRT-END-DTE-DSP. 02340099
023500     DISPLAY ' DISDCREPANCY - SIZE CODE    = '                    02350099
023600                                       PV-CNT-SIZE-CDE-DSP.       02360099
023700     DISPLAY ' DISCREPANCY - SIZE DESC     = '                    02370099
023800                                       PV-CNT-SIZE-DESC-DSP.      02380099
023900     DISPLAY ' DISCREPANCY - COLOR CODE    = '                    02390099
024000                                       PV-CNT-NRF-CLOR-CDE-DSP.   02400099
024100     DISPLAY ' DISCREPANCY - COLOR DESC    = '                    02410099
024200                                       PV-CNT-CSTM-CLOR-DESC-DSP. 02420099
024300     DISPLAY ' '.                                                 02430099
024400     DISPLAY '  INPUT SKU RECS READ    = ' PV-RECORDS-READ.       02440099
024500     DISPLAY '  TMDSEIT ROWS UPDATED   = ' PV-RECORDS-UPDATED.    02450099
024600     DISPLAY '  TMDSEIT ROWS ERRORED   = ' PV-TOTAL-ERR-REC.      02460099
024700     DISPLAY ' '.                                                 02470099
024800     DISPLAY '****  END OF  MAKUP102  ****'.                      02480099
024900                                                                  02490099
025000     GOBACK.                                                      02500099
025100                                                                  02510099
025200                                                                  02520099
025300****************************************************************  02530099
025400*   CONNECT TO THE APPROPRIATE ORACLE SERVER.                  *  02540099
025500****************************************************************  02550099
025600 0500-CONNECT-TO-ORACLE.                                          02560099
025700                                                                  02570099
025800     MOVE 'A100-INITIAL' TO PV-ABEND-PARAGRAPH.                   02580099
025900     MOVE SPACES         TO PV-CALLING-PARA.                      02590099
026000     MOVE SPACES         TO PV-SKU-PROCESS-CODE.                  02600099
026100                                                                  02610099
026200     OPEN INPUT ORACLE-LOGON-FILE.                                02620099
026300                                                                  02630099
026400     PERFORM 0510-READ-ORACLE-LOGON.                              02640099
026500                                                                  02650099
026600     CLOSE ORACLE-LOGON-FILE.                                     02660099
026700                                                                  02670099
026800     IF ((PS-END-OF-LOGON-FILE)                                   02680099
026900             OR (CC-ORACLE-CONNECTION = SPACES))                  02690099
027000         DISPLAY '** ABEND **'                                    02700099
027100         DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '  02710099
027200                   'NOT PROVIDED'                                 02720099
027300         SET PS-ORA-SRC-EMPTY TO TRUE                             02730099
027400         CALL 'ILBOABN0' USING PV-ABEND-CODE                      02740099
027500     END-IF.                                                      02750099
027600                                                                  02760099
027700     IF CC-AUTO-LOGON                                             02770099
027800         DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'        02780099
027900         EXEC SQL                                                 02790099
028000              CONNECT :USERNAME                                   02800099
028100         END-EXEC                                                 02810099
028200     ELSE                                                         02820099
028300         INITIALIZE PV-ORACLE-USERID-LEN                          02830099
028400                    PV-ORACLE-PASSWORD-LEN                        02840099
028500         INSPECT CC-ORACLE-USERID                                 02850099
028600             TALLYING PV-ORACLE-USERID-LEN                        02860099
028700          FOR CHARACTERS BEFORE INITIAL SPACE                     02870099
028800      INSPECT CC-ORACLE-PASSWORD                                  02880099
028900          TALLYING PV-ORACLE-PASSWORD-LEN                         02890099
029000          FOR CHARACTERS BEFORE INITIAL SPACE                     02900099
029100      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           02910099
029200                USERNAME-ARR                                      02920099
029300      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   02930099
029400      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       02940099
029500                PASSWD-ARR                                        02950099
029600      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   02960099
029700      DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '       02970099
029800                USERNAME-ARR                                      02980099
029900      EXEC SQL                                                    02990099
030000        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   03000099
030100      END-EXEC                                                    03010099
030200      INITIALIZE CC-ORACLE-PASSWORD                               03020099
030300                 PASSWD                                           03030099
030400      END-IF.                                                     03040099
030500                                                                  03050099
030600     IF (SQLCODE NOT = 0)                                         03060099
030700         DISPLAY PV-ABEND-PARAGRAPH                               03070099
030800         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'  03080099
030900         PERFORM Z999-SQL-ABEND                                   03090099
031000     END-IF.                                                      03100099
031100                                                                  03110099
031200                                                                  03120099
031300     EXEC SQL                                                     03130099
031400      ALTER SESSION                                               03140099
031500            SET NLS_DATE_FORMAT = 'YYYY-MM-DD.HH24.MI.SS'         03150099
031600     END-EXEC.                                                    03160099
031700                                                                  03170099
031800                                                                  03180099
031900     EXEC SQL                                                     03190099
032000      SELECT SYSDATE                                              03200099
032100      INTO :PV-CURRENT-TMST                                       03210099
032200      FROM DUAL                                                   03220099
032300     END-EXEC.                                                    03230099
032400                                                                  03240099
032500     DISPLAY 'SYSDATE = ' PV-CURRENT-TMST.                        03250099
032600     MOVE PV-CURRENT-TMST TO PV-CURRENT-TMST-NEW.                 03260099
032700                                                                  03270099
032800                                                                  03280099
032900****************************************************************  03290099
033000** READ THE ORACLE LOGON CONTROL CARD.                        **  03300099
033100****************************************************************  03310099
033200 0510-READ-ORACLE-LOGON.                                          03320099
033300                                                                  03330099
033400     READ ORACLE-LOGON-FILE                                       03340099
033500         INTO CC-ORACLE-CONNECTION                                03350099
033600         AT END                                                   03360099
033700             SET PS-END-OF-LOGON-FILE TO TRUE                     03370099
033800     END-READ.                                                    03380099
033900*                                                                 03390099
034000                                                                  03400099
034100***************************************************************** 03410099
034200*  READ A SKU ADD EXTRACT RECORD THAT WILL BE USED TO UPDATE    * 03420099
034300*  A ROW OF DATA INTO THE ORACLE TMDSEIT TABLE.                 * 03430099
034400***************************************************************** 03440099
034500 1000-READ-INPUT-FILE.                                            03450099
034600                                                                  03460099
034700     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       03470099
034800                                                                  03480099
034900     INITIALIZE IM053-ITEM-SKU-DOMAIN-REC.                        03490099
035000                                                                  03500099
035100     READ SKU-UPDATE-IN                                           03510099
035200          INTO IM053-ITEM-SKU-DOMAIN-REC                          03520099
035300            AT END                                                03530099
035400               SET PS-EOF-INPUT-YES TO TRUE                       03540099
035500                                                                  03550099
035600            NOT AT END                                            03560099
035700               SET PS-EOF-INPUT-NO  TO TRUE                       03570099
035800               ADD +1 TO PV-RECORDS-READ                          03580099
035900     END-READ.                                                    03590099
036000                                                                  03600099
036100                                                                  03610099
036200***************************************************************** 03620099
036300*  LOAD THE INFORMATION FROM THE SKU ADD EXTRACT FILE INTO THE  * 03630099
036400*  HOST VARIABLES AND PERFORM A PARAGRAPH TO UPDATE THE NEW ROW * 03640099
036500*  INTO THE ORACLE TMDSEIT TABLE.                               * 03650099
036600***************************************************************** 03660099
036700 2000-PROCESS-INPUT-FILE.                                         03670099
036800                                                                  03680099
036900     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       03690099
037000                                                                  03700099
037100     SET  PS-NOT-FOUND-SKU           TO TRUE.                     03710099
037200                                                                  03720099
037300     PERFORM 2100-SELECT-TITMCLT.                                 03730099
037400                                                                  03740099
037500     IF PS-FOUND-SKU                                              03750099
037600        PERFORM 2200-SELECT-TMDSEIT.                              03760099
037700                                                                  03770099
037800     IF PS-FOUND-SKU                                              03780099
037900        PERFORM 2300-COMPARE-ITEM-ATTR.                           03790099
038000                                                                  03800099
038100     IF PS-FOUND-SKU                                              03810099
038200        AND  PS-DISCREPANCY-FND                                   03820099
038300         PERFORM 4000-UPDATE-TMDSEIT.                             03830099
038400                                                                  03840099
038500     PERFORM 1000-READ-INPUT-FILE.                                03850099
038600                                                                  03860099
038700***************************************************************** 03870099
038800*  FIRST SELECT ORACLE TABLE TITMCLT TO GET THE APPROPRIATE     * 03880099
038900*  ITEM-CLUSTR-ID BASED OFF OF SKU NUMBER RETRIEVED FROM THE    * 03890099
039000*  VSM COMMON EXTRACT TO GET THE ITEM ATTRIBUTE ROW ON ORACLE   * 03900099
039100*  TABLE TMDSEIT TO UPDATE.                                       03910099
039200***************************************************************** 03920099
039300 2100-SELECT-TITMCLT.                                             03930099
039400                                                                  03940099
039500         INITIALIZE ITMCLT-ITEM-CLUSTR-ID.                        03950099
039600                                                                  03960099
039700         EXEC SQL                                                 03970099
039800             SELECT ITEM_CLUSTR_ID                                03980099
039900             INTO  :ITMCLT-ITEM-CLUSTR-ID                         03990099
040000             FROM   TITMCLT                                       04000099
040100             WHERE                                                04010099
040200                 SKU               = :IM053-SKU                   04020099
040300             AND ITEM_CLUSTR_CDE   = 'I'                          04030099
040400             AND (EFF_END_TMST IS NULL                            04040099
040500              OR  EFF_END_TMST > :PV-CURRENT-TMST)                04050099
040600         END-EXEC.                                                04060099
040700                                                                  04070099
040800         EVALUATE TRUE                                            04080099
040900           WHEN SQLCODE = ZEROS                                   04090099
041000                SET PS-FOUND-SKU     TO TRUE                      04100099
041100           WHEN OTHER                                             04110099
041200             MOVE '2100-SELECT-TITMCLT ' TO PV-ABEND-PARAGRAPH    04120099
041300             PERFORM Z999-SQL-ABEND                               04130099
041400         END-EVALUATE.                                            04140099
041500                                                                  04150099
041600                                                                  04160099
041700***************************************************************** 04170099
041800*  UPDATE THE SKU INTO THE ORACLE TMDSEIT TABLE.                * 04180099
041900***************************************************************** 04190099
042000 2200-SELECT-TMDSEIT.                                             04200099
042100     MOVE ZEROES     TO  PV-B4-KOHLS-SIZE-CDE.                    04210099
042200     MOVE SPACES     TO  PV-B4-NRF-CLOR-CDE                       04220099
042300                         PV-B4-SIZE-DESC                          04230099
042400                         PV-B4-CSTM-CLOR-DESC                     04240099
042500                         PV-B4-E-ITM-IND                          04250099
042600                         PV-B4-E-ASRT-BEG-DTE                     04260099
042700                         PV-B4-E-ASRT-END-DTE.                    04270099
042800                                                                  04280099
042900                                                                  04290099
043000     EXEC SQL                                                     04300099
043100          SELECT KOHLS_SIZE_CDE                                   04310099
043200                ,NRF_CLOR_CDE                                     04320099
043300                ,SIZE_DESC                                        04330099
043400                ,COLOR_DESC                                       04340099
043500                ,E_ITM_IND                                        04350099
043600                ,E_ASRT_BEG_DTE                                   04360099
043700                ,E_ASRT_END_DTE                                   04370099
043800          INTO  :PV-B4-KOHLS-SIZE-CDE :PV-SIZE-CDE-NULL           04380099
043900               ,:PV-B4-NRF-CLOR-CDE   :PV-COLOR-CDE-NULL          04390099
044000               ,:PV-B4-SIZE-DESC      :PV-SIZE-DESC-NULL          04400099
044100               ,:PV-B4-CSTM-CLOR-DESC :PV-COLOR-DESC-NULL         04410099
044200               ,:PV-B4-E-ITM-IND      :PV-WEB-IND-NULL            04420099
044300               ,:PV-B4-E-ASRT-BEG-DTE :PV-ASRT-BEG-DTE-NULL       04430099
044400               ,:PV-B4-E-ASRT-END-DTE :PV-ASRT-END-DTE-NULL       04440099
044500          FROM TMDSEIT A                                          04450099
044600          WHERE                                                   04460099
044700               A.ITEM_CLUSTR_ID  = :ITMCLT-ITEM-CLUSTR-ID         04470099
044800     END-EXEC.                                                    04480099
044900                                                                  04490099
045000     EVALUATE TRUE                                                04500099
045100         WHEN SQLCODE = ZERO                                      04510099
045200              CONTINUE                                            04520099
045300         WHEN OTHER                                               04530099
045400              MOVE '2200-SELECT-TMDSEIT'                          04540099
045500                                     TO PV-ABEND-PARAGRAPH        04550099
045600              MOVE 'SELECT TMDSEIT'  TO PV-ABEND-OPERATION        04560099
045700              MOVE IM053-SKU         TO PV-DISP-SKU               04570099
045800              STRING '  SKU NBR: '            DELIMITED BY SIZE   04580099
045900                     PV-DISP-SKU              DELIMITED BY SIZE   04590099
046000                                   INTO PV-DB2-OPERATION-MESSAGE-104600099
046100              MOVE 'TMDSEIT'         TO PV-ABEND-TABLE            04610099
046200              PERFORM Z999-SQL-ABEND                              04620099
046300     END-EVALUATE.                                                04630099
046400                                                                  04640099
046500***************************************************************** 04650099
046600*  COMPARE THE VSM TO THE TMDSEIT VALUES.                       * 04660099
046700***************************************************************** 04670099
046800 2300-COMPARE-ITEM-ATTR.                                          04680099
046900     MOVE 'N'            TO PS-DISCREPANCY.                       04690099
047000                                                                  04700099
047100     IF IM053-E-BUS-ITM-IND  NOT EQUAL PV-B4-E-ITM-IND            04710099
047200        DISPLAY 'SKU ' IM053-SKU ' HAS DIFF WEB-ENABLE INFO '     04720099
047300          'VSM=' IM053-E-BUS-ITM-IND '  MA=' PV-B4-E-ITM-IND      04730099
047400        ADD 1            TO PV-CNT-E-ITM-DSP                      04740099
047500        MOVE 'Y'         TO PS-DISCREPANCY.                       04750099
047600                                                                  04760099
047700     IF (IM053-ASRT-BEG-DTE > SPACES OR                           04770099
047800        PV-B4-E-ASRT-BEG-DTE > SPACES) AND                        04780099
047900        IM053-ASRT-BEG-DTE NOT EQUAL PV-B4-E-ASRT-BEG-DTE         04790099
048000        DISPLAY 'SKU ' IM053-SKU ' HAS DIFF ASRT BEG DTE '        04800099
048100          'VSM=' IM053-ASRT-BEG-DTE '  MA=' PV-B4-E-ASRT-BEG-DTE  04810099
048200        ADD 1            TO PV-CNT-E-ASRT-BEG-DTE-DSP             04820099
048300        MOVE 'Y'         TO PS-DISCREPANCY.                       04830099
048400                                                                  04840099
048500     IF (IM053-ASRT-END-DTE > SPACES OR                           04850099
048600        PV-B4-E-ASRT-END-DTE > SPACES) AND                        04860099
048700        IM053-ASRT-END-DTE NOT EQUAL PV-B4-E-ASRT-END-DTE         04870099
048800        DISPLAY 'SKU ' IM053-SKU ' HAS DIFF ASRT END DTE  '       04880099
048900         'VSM=' IM053-ASRT-END-DTE '  MA=' PV-B4-E-ASRT-END-DTE   04890099
049000        ADD 1            TO PV-CNT-E-ASRT-END-DTE-DSP             04900099
049100        MOVE 'Y'         TO PS-DISCREPANCY.                       04910099
049200                                                                  04920099
049300     IF IM053-KOHLS-SIZE-CDE NOT EQUAL PV-B4-KOHLS-SIZE-CDE       04930099
049400        DISPLAY 'SKU ' IM053-SKU ' HAS DIFF SIZE CODE  '          04940099
049500         'VSM=' IM053-KOHLS-SIZE-CDE ' MA=' PV-B4-KOHLS-SIZE-CDE  04950099
049600        ADD 1            TO PV-CNT-SIZE-CDE-DSP                   04960099
049700        MOVE 'Y'         TO PS-DISCREPANCY.                       04970099
049800                                                                  04980099
049900     IF IM053-KOHLS-SIZE-DESC NOT EQUAL PV-B4-SIZE-DESC           04990099
050000        DISPLAY 'SKU ' IM053-SKU ' HAS DIFF SIZE DESC '           05000099
050100         'VSM=' IM053-KOHLS-SIZE-DESC '  MA=' PV-B4-SIZE-DESC     05010099
050200        ADD 1            TO PV-CNT-SIZE-DESC-DSP                  05020099
050300        MOVE 'Y'         TO PS-DISCREPANCY.                       05030099
050400                                                                  05040099
050500     IF IM053-NRF-CLOR-CDE NOT EQUAL PV-B4-NRF-CLOR-CDE           05050099
050600        DISPLAY 'SKU ' IM053-SKU ' HAS DIFF NRF COLOR CODE '      05060099
050700         'VSM=' IM053-NRF-CLOR-CDE  ' MA=' PV-B4-NRF-CLOR-CDE     05070099
050800        ADD 1            TO PV-CNT-NRF-CLOR-CDE-DSP               05080099
050900        MOVE 'Y'         TO PS-DISCREPANCY.                       05090099
051000                                                                  05100099
051100     IF IM053-CSTM-CLOR-DESC NOT EQUAL PV-B4-CSTM-CLOR-DESC       05110099
051200        DISPLAY 'SKU ' IM053-SKU ' HAS DIFF NRF COLOR DESC '      05120099
051300         'VSM=' IM053-CSTM-CLOR-DESC '  MA=' PV-B4-CSTM-CLOR-DESC 05130099
051400        ADD 1            TO PV-CNT-CSTM-CLOR-DESC-DSP             05140099
051500        MOVE 'Y'         TO PS-DISCREPANCY.                       05150099
051600                                                                  05160099
051700     IF PS-DISCREPANCY-FND                                        05170099
051800        IF IM053-E-BUS-ITM-IND = 'Y'                              05180099
051900            MOVE ZERO    TO PV-ASRT-BEG-DTE-NULL                  05190099
052000                            PV-ASRT-END-DTE-NULL                  05200099
052100        ELSE                                                      05210099
052200           MOVE -1       TO PV-ASRT-BEG-DTE-NULL                  05220099
052300                            PV-ASRT-END-DTE-NULL                  05230099
052400        END-IF.                                                   05240099
052500                                                                  05250099
052600*       DISPLAY '***********   ' IM053-SKU ' ABOVE *********'.    05260099
052700                                                                  05270099
052800                                                                  05280099
052900***************************************************************** 05290099
053000*  UPDATE THE SKU INTO THE ORACLE TMDSEIT TABLE.                * 05300099
053100***************************************************************** 05310099
053200 4000-UPDATE-TMDSEIT.                                             05320099
053300                                                                  05330099
053400     EXEC SQL                                                     05340099
053500       UPDATE   TMDSEIT                                           05350099
053600       SET STAT_CHNG_DTE  = :PV-CURRENT-TMST                      05360099
053700          ,KOHLS_SIZE_CDE = :IM053-KOHLS-SIZE-CDE                 05370099
053800          ,NRF_CLOR_CDE   = :IM053-NRF-CLOR-CDE                   05380099
053900          ,SIZE_DESC      = :IM053-KOHLS-SIZE-DESC                05390099
054000          ,COLOR_DESC     = :IM053-CSTM-CLOR-DESC                 05400099
054100          ,E_ITM_IND      = :IM053-E-BUS-ITM-IND                  05410099
054200          ,E_ASRT_BEG_DTE = :IM053-ASRT-BEG-DTE                   05420099
054300                                           :PV-ASRT-BEG-DTE-NULL  05430099
054400          ,E_ASRT_END_DTE = :IM053-ASRT-END-DTE                   05440099
054500                                           :PV-ASRT-END-DTE-NULL  05450099
054600       WHERE                                                      05460099
054700           ITEM_CLUSTR_ID  = :ITMCLT-ITEM-CLUSTR-ID               05470099
054800     END-EXEC.                                                    05480099
054900                                                                  05490099
055000     EVALUATE TRUE                                                05500099
055100         WHEN SQLCODE = ZERO                                      05510099
055200              ADD +1                 TO PV-RECORDS-UPDATED        05520099
055300              ADD +1                 TO                           05530099
055400                                    PV-COUNT-RECORD-TO-COMMIT     05540099
055500              IF PV-COUNT-RECORD-TO-COMMIT = PC-MAX-COMMIT-REC    05550099
055600                 MOVE 0              TO                           05560099
055700                                    PV-COUNT-RECORD-TO-COMMIT     05570099
055800                 PERFORM 3000-TABLE-COMMIT                        05580099
055900              END-IF                                              05590099
056000         WHEN OTHER                                               05600099
056100              MOVE '2100-UPDATE-TMDSEIT'                          05610099
056200                                     TO PV-ABEND-PARAGRAPH        05620099
056300              MOVE 'UPDATE TMDSEIT'  TO PV-ABEND-OPERATION        05630099
056400              MOVE IM053-SKU         TO PV-DISP-SKU               05640099
056500              STRING '  SKU NBR: '            DELIMITED BY SIZE   05650099
056600                     PV-DISP-SKU              DELIMITED BY SIZE   05660099
056700                                   INTO PV-DB2-OPERATION-MESSAGE-105670099
056800              MOVE 'TMDSEIT'         TO PV-ABEND-TABLE            05680099
056900              PERFORM Z999-SQL-ABEND                              05690099
057000     END-EVALUATE.                                                05700099
057100                                                                  05710099
057200                                                                  05720099
057300***************************************************************** 05730099
057400* COMMIT THE PENDING TABLE CHANGES.                             * 05740099
057500***************************************************************** 05750099
057600 3000-TABLE-COMMIT.                                               05760099
057700                                                                  05770099
057800     EXEC SQL                                                     05780099
057900          COMMIT                                                  05790099
058000     END-EXEC.                                                    05800099
058100                                                                  05810099
058200     DISPLAY 'COMMIT'.                                            05820099
058300                                                                  05830099
058400***************************************************************** 05840099
058500*  DISPLAY DB2 ERROR INFORMATION, DO NOT END PROGRAM OR ABEND,  * 05850099
058600*  JUST WRITE OUT ERROR INTO A FLAT FILE AND PROCEED WITH       * 05860099
058700*  THE PROCESS OF READING THE NEXT ROW.                         * 05870099
058800***************************************************************** 05880099
058900 Z999-SQL-ABEND.                                                  05890099
059000                                                                  05900099
059100     ADD +1                  TO PV-TOTAL-ERR-REC.                 05910099
059200     MOVE SQLCODE            TO PV-SQLCODE.                       05920099
059300                                                                  05930099
059400     DISPLAY '**ERROR*SKU ' IM053-SKU ' HAS SQLCODE OF '          05940099
059500            PV-SQLCODE ' IN PARA ' PV-ABEND-PARAGRAPH.            05950099
059600                                                                  05960099
059700     MOVE SKU-UPDATE-IN-RECORD                                    05970099
059800                             TO PV-EXTRACT-MSG.                   05980099
059900     MOVE PV-SQLCODE         TO PV-EXTRACT-ERR.                   05990099
060000     MOVE PV-ABEND-PARAGRAPH TO PV-EXTRACT-ERR-PARA.              06000099
060100                                                                  06010099
060200     WRITE SKU-UPD-ERROR-RECORD FROM  PV-ERRMSGBUF.               06020099
060300                                                                  06030099
