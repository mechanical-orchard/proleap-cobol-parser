000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.    VNKCS014.                                         00020003
000300 AUTHOR.        CHRIS KORTENDICK.                                 00030003
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040003
000500 DATE-WRITTEN.  06/93.                                            00050003
000600 DATE-COMPILED.                                                   00060003
000700******************************************************************00070003
000800*    V014 - VENDOR TERMS MAINTENANCE PROGRAM                      00080003
000900*                                                                 00090003
001000*    ADD OR UPDATE PAYMENT, SHIPPING, AND/OR PURCHASE TERMS FOR A 00100003
001100*    SPECIFIED VENDOR.                                            00110003
001200*                                                                 00120003
001300*                                                                 00130003
001400*  DATE  05/27/2003                                               00140003
001500*      CHANGE MADE: VENDOR MULTI PRE-PACK USAGE PROJECT.  ADDED   00150003
001600*      COMMAREA FIELD, ASC-PO-PREPK-CDE.  ADDED EDI-PO-PREPK-CDE  00160003
001700*      TO CURSOR IN PARAGRAPH 4010.  INCLUDE ASC-PO-PREPK-CDE IN  00170003
001800*      MOVE TO VNWS013 COPYBOOK IN PARAGRAPH 5060.                00180003
001900*      MADE BY: KEVIN CATLIN            WR/IR #: WR24663          00190003
002000*                                                                 00200003
002100*  DATE  08/29/2003                                               00210003
002200*      CHANGE MADE: ADDED CODE TO DISPLAY AND MAINTAIN VND_AUTH_ID00220003
002300*      FROM TVNDAGR.  THIS FIELD CAN ONLY HAVE A VALUE WHEN       00230003
002400*      RTV_RA_REQD_IND = 'Y'. IT IS NOT REQUIRED THOUGH. NEW PARAS00240003
002500*      3040- 3050- CONTAINS THE CODE THAT EDITS THE AUTHORIZATION 00250003
002600*      ID FOR CONTENT WHEN APPROPRIATE.  REMOVED THE USER AUTHORI-00260003
002700*      ZATION CODE IN PARAS 1139- 1140- 1141- 1142- 1143- 1144-   00270003
002800*      1145- & 1146- AND THE TABLES INVOLVED IN THIS PROCESS:     00280003
002900*      TWORKER, TMDSEAR, TRSPBAR, TORGUNT & TORGWRK.              00290003
003000*      MADE BY: MIKE BESKE              WR/IR #: WR21316          00300003
003100*                                                                 00310003
003200*  DATE  10/02/2003                                               00320003
003300*      CHANGE MADE: ADDED ADDITIONAL CHARACTERS TO THE 88 LEVEL   00330003
003400*      USED TO VALIDATE THE RTV AUTH ID. THESE CHARS ARE: / % -   00340003
003500*      MADE BY: MIKE BESKE              WR/IR #: WR24481          00350003
003600*                                                                 00360003
003700*  DATE  11/05/2003                                               00370003
003800*      CHANGE MADE: ADDED CODE TO MOVE THE 4 NEW COLUMNS FROM     00380003
003900*      TEXTENT (GVRNG_IND, GVRNG_ENT_ID, CART_LBL_IND,            00390003
004000*      CART_LBL_EFF_DTE) TO THE RMS PO MESSAGING CODE.            00400003
004100*      MADE BY: MIKE BESKE              WR/IR #: WR25358          00410003
004200*                                                                 00420003
004300*  DATE  04/01/2005                                               00430003
004400*      CHANGE MADE: ADDED 2 NEW MESSAGES, AND LOGIC IN THE RETURN 00440003
004500*      FROM CALLING VNKCS023 TO IDENTIFY THE FACT THAT THE        00450003
004600*      MAX NUMBER OF CAPABILITIES OR RELATIONSHIPS WAS EXCEEDED   00460003
004700*      WHEN SENDING A 'NEW VENDOR' MESSAGE TO RMS.                00470003
004800*      MADE BY: JACK KRAMER             WR/IR #: WR25278          00480003
004900*                                                                 00490003
005000*  DATE  07/21/2005                                               00500003
005100*      CHANGE MADE: OFF-INVOICE CO-OP ADVERTISING ALLOWANCES.     00510003
005200*      RECOMPILE FROM PRODUCTION TO INCORPORATE CHANGES TO        00520003
005300*      COPYBOOK VNWS013.                                          00530003
005400*      MADE BY: KRYSTEN LEARY           WR/IR #: WR28651          00540003
005500*                                                                 00550003
005600*  DATE  03/27/2006                                               00560003
005700*      CHANGE MADE: ADDED CODE FOR 3 NEW SHIPPING TERMS FIELDS:   00570003
005800*      LATE SHIPMENT PENALTY, CHARGE PERCENTAGE AND CHARGE FACTOR 00580003
005900*      CODE.  THESE FIELDS ARE RELATED TO EACH OTHER.  IF 'Y' IS  00590003
006000*      SELECTED FOR THE LATE SHIPMENT INDICATOR, THEN THE CHARGE  00600003
006100*      PERCENTAGE AND FACTOR CODE NEED VALUES ALSO.               00610003
006200*      MADE BY: MIKE BESKE              WR/IR #: WR30028          00620003
006300*                                                                 00630003
006310*  DATE  09/07/2021                                              *00631004
006320*            - CHANGE CALL OF DPKUT100 TO                       * 00632004
006330*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00633004
006340*              MAKING THE CALL DYNAMIC VS STATIC                * 00634004
006350*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00635006
006360*                                                               * 00636004
006310*  DATE  01/05/2023                                              *00637007
006320*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00638007
006350*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00639207
006400******************************************************************00640003
006500 ENVIRONMENT DIVISION.                                            00650003
006600 DATA DIVISION.                                                   00660003
006700 WORKING-STORAGE SECTION.                                         00670003
006800                                                                  00680003
006900 01  NI-NULL-INDICATORS.                                          00690003
007000     05  NI-EXTENT-DUN-NBR            PIC S9(4) COMP VALUE ZERO.  00700003
007100     05  NI-VNDAGR-ENT-ID             PIC S9(4) COMP VALUE ZERO.  00710003
007200     05  NI-VNDAGR-DEPT-NBR           PIC S9(4) COMP VALUE ZERO.  00720003
007300     05  NI-VNDAGR-AGRMT-TYP-ID       PIC S9(4) COMP VALUE ZERO.  00730003
007400     05  NI-VNDAGR-SEQ-NBR            PIC S9(4) COMP VALUE ZERO.  00740003
007500     05  NI-VNDAGR-EFFECTIVE-DATE     PIC S9(4) COMP VALUE ZERO.  00750003
007600     05  NI-VNDAGR-EXPIRATION-DATE    PIC S9(4) COMP VALUE ZERO.  00760003
007700     05  NI-VNDAGR-LAST-UPD-ID        PIC S9(4) COMP VALUE ZERO.  00770003
007800     05  NI-VNDAGR-PAYT-TERM-ID       PIC S9(4) COMP VALUE ZERO.  00780003
007900     05  NI-VNDAGR-FOB-POINT-TXT      PIC S9(4) COMP VALUE ZERO.  00790003
008000     05  NI-VNDAGR-SHIPT-POINT-TXT    PIC S9(4) COMP VALUE ZERO.  00800003
008100     05  NI-VNDAGR-RTV-RA-REQD-IND    PIC S9(4) COMP VALUE ZERO.  00810003
008200     05  NI-VNDAGR-RTV-NO-RA-REQD-IND PIC S9(4) COMP VALUE ZERO.  00820003
008300     05  NI-VNDAGR-DEBIT-DESTROY-IND  PIC S9(4) COMP VALUE ZERO.  00830003
008400     05  NI-VNDAGR-MARKOUT-IND        PIC S9(4) COMP VALUE ZERO.  00840003
008500     05  NI-VNDAGR-VND-AUTH-ID        PIC S9(4) COMP VALUE ZERO.  00850003
008600     05  NI-VNDAGR-LATE-SHIPT-IND     PIC S9(4) COMP VALUE ZERO.  00860003
008700     05  NI-VNDAGR-CHRG-PCT           PIC S9(4) COMP VALUE ZERO.  00870003
008800     05  NI-VNDAGR-CHRG-FCTR-CDE      PIC S9(4) COMP VALUE ZERO.  00880003
008900                                                                  00890003
009000 01  PC-PROGRAM-CONSTANTS.                                        00900003
009100     05  PC-CURRENT-MAP-NAME          PIC X(8)  VALUE 'VN014A  '. 00910003
009200     05  PC-CURRENT-MAPSET-NAME       PIC X(8)  VALUE 'VNKM014 '. 00920003
009300     05  PC-CURRENT-PROGRAM-NAME      PIC X(8)  VALUE 'VNKCS014'. 00930003
009400     05  PC-VNKCS023                  PIC X(8)  VALUE 'VNKCS023'. 00940003
009500     05  PC-VNKCS024                  PIC X(8)  VALUE 'VNKCS024'. 00950003
009600     05  PC-INTER-APPL-INQ            PIC X     VALUE '1'.        00960003
009700     05  PC-INTER-APPL-LIST           PIC X     VALUE '2'.        00970003
009800     05  PC-SHIPPING                  PIC X     VALUE '1'.        00980003
009900     05  PC-PAYMENT                   PIC X     VALUE '2'.        00990003
010000     05  PC-PURCHASE                  PIC X     VALUE '3'.        01000003
010100     05  PC-PRIMARY                   PIC XX    VALUE '01'.       01010003
010200     05  PC-PROD-STATUS               PIC X     VALUE ' '.        01020003
010300     05  PC-VALID-CHARS               PIC X.                      01030003
010400         88 VALID-CHARS               VALUES                      01040003
010500            'A' 'B' 'C' 'D' 'E' 'F' 'G' 'H' 'I' 'J' 'K' 'L'       01050003
010600            'M' 'N' 'O' 'P' 'Q' 'R' 'S' 'T' 'U' 'V' 'W' 'X'       01060003
010700            'Y' 'Z' '0' '1' '2' '3' '4' '5' '6' '7' '8' '9'       01070003
010800            '/' '%' '-'.                                          01080003
010900     05  PC-MAX-DATE                  PIC X(10)                   01090003
011000                                               VALUE '9999-12-31'.01100003
011100     05  PC-MAX-RETRIES               PIC S9(4) COMP SYNC         01110003
011200                                                VALUE +3.         01120003
011300     05  PC-APPL-MAP                  PIC S9(4) COMP SYNC         01130003
011400                                                VALUE +1.         01140003
011500     05  PC-TSYMSG-NUMBERS.                                       01150003
011600         10  PC-TSYMSG-00005          PIC 9(5)  VALUE 00005.      01160003
011700         10  PC-TSYMSG-00007          PIC 9(5)  VALUE 00007.      01170003
011800         10  PC-TSYMSG-00008          PIC 9(5)  VALUE 00008.      01180003
011900         10  PC-TSYMSG-00010          PIC 9(5)  VALUE 00010.      01190003
012000         10  PC-TSYMSG-00014          PIC 9(5)  VALUE 00014.      01200003
012100         10  PC-TSYMSG-00046          PIC 9(5)  VALUE 00046.      01210003
012200         10  PC-TSYMSG-00057          PIC 9(5)  VALUE 00057.      01220003
012300         10  PC-TSYMSG-00059          PIC 9(5)  VALUE 00059.      01230003
012400         10  PC-TSYMSG-00069          PIC 9(5)  VALUE 00069.      01240003
012500         10  PC-TSYMSG-00070          PIC 9(5)  VALUE 00070.      01250003
012600         10  PC-TSYMSG-00148          PIC 9(5)  VALUE 00148.      01260003
012700         10  PC-TSYMSG-00156          PIC 9(5)  VALUE 00156.      01270003
012800         10  PC-TSYMSG-00492          PIC 9(5)  VALUE 00492.      01280003
012900         10  PC-TSYMSG-00494          PIC 9(5)  VALUE 00494.      01290003
013000         10  PC-TSYMSG-02589          PIC 9(5)  VALUE 02589.      01300003
013100         10  PC-TSYMSG-02590          PIC 9(5)  VALUE 02590.      01310003
013200         10  PC-TSYMSG-02645          PIC 9(5)  VALUE 02645.      01320003
013300         10  PC-TSYMSG-02646          PIC 9(5)  VALUE 02646.      01330003
013400         10  PC-TSYMSG-03104          PIC 9(5)  VALUE 03104.      01340003
013500         10  PC-TSYMSG-03125          PIC 9(5)  VALUE 03125.      01350003
013600         10  PC-TSYMSG-03380          PIC 9(5)  VALUE 03380.      01360003
013700         10  PC-TSYMSG-03381          PIC 9(5)  VALUE 03381.      01370003
013800         10  PC-TSYMSG-03480          PIC 9(5)  VALUE 03480.      01380003
013900         10  PC-TSYMSG-03481          PIC 9(5)  VALUE 03481.      01390003
014000         10  PC-TSYMSG-03482          PIC 9(5)  VALUE 03482.      01400003
014100         10  PC-TSYMSG-03483          PIC 9(5)  VALUE 03483.      01410003
014200         10  PC-TSYMSG-03484          PIC 9(5)  VALUE 03484.      01420003
014300         10  PC-TSYMSG-03485          PIC 9(5)  VALUE 03485.      01430003
014400                                                                  01440003
014500 01  PS-PROGRAM-SWITCHES.                                         01450003
014600     05  PS-ERROR-SW                  PIC X     VALUE 'N'.        01460003
014700         88  PS-NO-ERROR                        VALUE 'N'.        01470003
014800         88  PS-ERROR                           VALUE 'Y'.        01480003
014900     05  PS-END-OF-LIST-SW            PIC X     VALUE 'N'.        01490003
015000         88  PS-NOT-END-OF-LIST                 VALUE 'N'.        01500003
015100         88  PS-END-OF-LIST                     VALUE 'Y'.        01510003
015200     05  PS-FIELDS-CHANGED-SW         PIC X     VALUE 'N'.        01520003
015300         88  PS-NO-FIELDS-CHANGED               VALUE 'N'.        01530003
015400         88  PS-FIELDS-CHANGED                  VALUE 'Y'.        01540003
015500     05  PS-RMS-FIELDS-CHANGED-SW     PIC X     VALUE 'N'.        01550003
015600         88  PS-NO-RMS-FIELDS-CHANGED           VALUE 'N'.        01560003
015700         88  PS-RMS-FIELDS-CHANGED              VALUE 'Y'.        01570003
015800     05  PS-TERMS-EXIST-SW            PIC X     VALUE 'N'.        01580003
015900         88  PS-TERMS-DONT-EXIST                VALUE 'N'.        01590003
016000         88  PS-TERMS-EXIST                     VALUE 'Y'.        01600003
016100     05  PS-EDIT-RTV-SW               PIC X     VALUE 'Y'.        01610003
016200         88  PS-EDIT-RTV                        VALUE 'Y'.        01620003
016300         88  PS-DONT-EDIT-RTV                   VALUE 'N'.        01630003
016400     05  PS-RTV-SEC-SW                PIC X     VALUE 'Y'.        01640003
016500         88  PS-HAS-RTV-SEC                     VALUE 'Y'.        01650003
016600         88  PS-NO-RTV-SEC                      VALUE 'N'.        01660003
016700     05  PS-VALID-AUTH-ID-SW          PIC X     VALUE 'Y'.        01670003
016800         88  PS-VALID-AUTH-ID                   VALUE 'Y'.        01680003
016900         88  PS-INVALID-AUTH-ID                 VALUE 'N'.        01690003
017000                                                                  01700003
017100 01  PV-PROGRAM-VARIABLES.                                        01710003
017200     05  PV-CICS-RESPONSE             PIC S9(4) COMP SYNC         01720003
017300                                                VALUE ZERO.       01730003
017400     05  PV-RETRY-COUNTER             PIC S9(4) COMP SYNC         01740003
017500                                                VALUE ZERO.       01750003
017600     05  PV-DEPT-NBR                  PIC XXX   VALUE SPACES.     01760003
017700     05  PV-INHOUSE-NBR-X.                                        01770003
017800         10  PV-INHOUSE-NBR           PIC 999   VALUE ZERO.       01780003
017900     05  PV-INHOUSE-NUMBER            PIC S999 COMP-3 VALUE ZERO. 01790003
018000     05  PV-PAY-TERM-ID               PIC S9(4) COMP SYNC         01800003
018100                                                VALUE ZERO.       01810003
018200     05  PV-FREIGHT-TERM-ID           PIC S9(4) COMP SYNC         01820003
018300                                                VALUE ZERO.       01830003
018400     05  PV-KOHLS-FRGT-PCT            PIC S9(1)V9(4) COMP-3       01840003
018500                                                VALUE ZERO.       01850003
018600     05  PV-VND-FRGT-PCT              PIC S9(1)V9(4) COMP-3       01860003
018700                                                VALUE ZERO.       01870003
018800     05  PV-CHARGE-PCT                PIC S9(1)V9(6) COMP-3       01880003
018900                                                VALUE ZERO.       01890003
019000     05  PV-PCT-FORMAT                PIC Z9.9999.                01900003
019100     05  PV-NUM-DISCOUNT-PCT          PIC 99    VALUE ZERO.       01910003
019200     05  PV-EDIT-KOHLS-FRGHT-PCT      PIC ZZZ.99.                 01920003
019300     05  PV-EDIT-VENDOR-FRGHT-PCT     PIC ZZZ.99.                 01930003
019400     05  PV-EDIT-CHARGE-PCT           PIC ZZ.9999.                01940003
019500     05  PV-EDIT-AUTO-CAN-DAYS        PIC ZZ9.                    01950003
019600     05  PV-EDIT-LEADTIME-DAYS        PIC ZZ9.                    01960003
019700     05  PV-EDIT-DISCOUNT-PCT         PIC ZZ.                     01970003
019800     05  PV-EDIT-DISCOUNT-DAYS        PIC ZZZ.                    01980003
019900     05  PV-EDIT-DUE-DAYS             PIC ZZZ.                    01990003
020000     05  PV-EDIT-PAY-TERM-ID          PIC ZZ9.                    02000003
020100     05  PV-EDIT-FREIGHT-TERM-ID      PIC ZZ9.                    02010003
020200     05  PV-AGRMT-TYP-ID              PIC X     VALUE SPACE.      02020003
020300     05  PV-CUR-SEQ-NBR               PIC S9(4) COMP VALUE ZERO.  02030003
020400     05  PV-NEW-SEQ-NBR               PIC S9(4) COMP VALUE ZERO.  02040003
020500     05  PV-TERMS-COUNT               PIC S9(4) COMP VALUE ZERO.  02050003
020600     05  PV-VEND-TYPE                 PIC X     VALUE SPACE.      02060003
020700     05  PV-VEND-NAME                 PIC X(30) VALUE SPACES.     02070003
020800     05  PV-DMA-NBR                   PIC XX    VALUE SPACES.     02080003
020900     05  PV-GMA-NBR                   PIC XX    VALUE SPACES.     02090003
021000     05  PV-DB2-COUNT                 PIC S9(9) COMP VALUE ZERO.  02100003
021100     05  PV-STRING                    PIC X(10).                  02110003
021200     05  PV-LASTPOS                   PIC S9(04) COMP.            02120003
021300                                                                  02130003
021400     05  PV-AUTHID.                                               02140003
021500         10  PV-AUTHID-AREA           OCCURS 10 TIMES             02150003
021600                                      INDEXED BY AUTHID-INDX.     02160003
021700             15  PV-AUTHID-ONE        PIC X(01).                  02170003
021800                                                                  02180003
021900     05  PV-ERROR-MESSAGE-AREA.                                   02190003
022000         10  PV-ERROR-MSG-1.                                      02200003
022100             15  FILLER                   PIC X(21)  VALUE        02210003
022200                 'UNSUCCESSFUL CALL TO '.                         02220003
022300             15  PV-ERROR-PGM-NAME        PIC X(08).              02230003
022400             15  FILLER                   PIC X(11)  VALUE        02240003
022500                 ' IN PARA:  '.                                   02250003
022600             15  PV-ERROR-PARA-NAME       PIC X(30).              02260003
022700         10  PV-ERROR-MSG-2.                                      02270003
022800             15  PV-ERROR-MESSAGE         PIC X(57).              02280003
022900         10  PV-ERROR-MSG-3.                                      02290003
023000             15  PV-ERROR-TYPE            PIC X(15).              02300003
023100             15  PV-OPTIONAL-TEXT         PIC X(10).              02310003
023200             15  PV-ERROR-REASON          PIC X(30).              02320003
023300                                                                  02330003
023400******************************************************************02340003
023500*    SELECTED ITEMS TEMPORARY STORAGE QUEUE ITEM LAYOUT           02350003
023600******************************************************************02360003
023700     COPY VNWS003.                                                02370003
023800                                                                  02380003
023900******************************************************************02390003
024000*    COPYBOOK TO CALL THE RMS DATA BUILDER ROUTINE (VNKCS023)    *02400003
024100******************************************************************02410003
024200 01  VN013-COMMAREA.                                              02420003
024300     COPY VNWS013.                                                02430003
024400                                                                  02440003
024500******************************************************************02450003
024600*    PAYMENT TERMS                                                02460003
024700******************************************************************02470003
024800     COPY POWS020.                                                02480003
024900                                                                  02490003
025000******************************************************************02500003
025100*    BMS MAP                                                      02510003
025200******************************************************************02520003
025300     COPY VNKM014.                                                02530003
025400                                                                  02540003
025500******************************************************************02550003
025600*    BMS ATTRIBUTES                                               02560003
025700******************************************************************02570003
025800     COPY DPWS015.                                                02580003
025900                                                                  02590003
026000******************************************************************02600003
026100*    FUNCTION KEYS                                                02610003
026200******************************************************************02620003
026300     COPY DPWS016.                                                02630003
026400                                                                  02640003
026500***************************************************************** 02650003
026600*    NUMERIC EDIT SUBROUTINE LAYOUT                               02660003
026700***************************************************************** 02670003
026800     COPY DPWS010I.                                               02680003
026900                                                                  02690003
027000*----------------------------------------------------------------*02700003
027100**  SECURITY SUBROUTINE PARAMETERS                                02710003
027200*----------------------------------------------------------------*02720003
027300                                                                  02730003
027400     COPY DPWS008.                                                02740003
027500                                                                  02750003
027600***************************************************************** 02760003
027700*    PARAMETERS FOR CALLING CICS ARCHITECTURE API                 02770007
027800***************************************************************** 02780003
027900     COPY DPWS030.                                                02790003
027900     COPY DPWS930.                                                02791007
028000                                                                  02800003
028100***************************************************************** 02810003
028200*    GLOBAL COMMUNICATION AREA                                    02820003
028300***************************************************************** 02830003
028400     COPY DPWS020.                                                02840003
028500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02850003
028600                                                                  02860003
028700***************************************************************** 02870003
028800*    INTER-APPLICATION COMMUNICATION AREA                         02880003
028900***************************************************************** 02890003
029000         10  INTER-APPL-COMM-AREA PIC X(200).                     02900003
029100     COPY VNWS001.                                                02910003
029200     COPY VNWS002.                                                02920003
029300                                                                  02930003
029400***************************************************************** 02940003
029500*    APPLICATION SPECIFIC COMMUNICATION AREA                      02950003
029600***************************************************************** 02960003
029700         10  ASC-SPECIFIC-COMMAREA.                               02970003
029800             15  ASC-INT-APPL-FORMAT-IND        PIC X.            02980003
029900             15  ASC-USE-SELECTION-QUEUE-IND                      02990003
030000                                                PIC X.            03000003
030100                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   03010003
030200             15  ASC-SEL-QUEUE-NAME             PIC X(8).         03020003
030300             15  ASC-NUMBER-OF-TS-ITEMS         PIC S9(5) COMP-3. 03030003
030400             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03040003
030500                                                PIC S9(9) COMP-3. 03050003
030600             15  ASC-SEL-SUB                    PIC S9(4) COMP.   03060003
030700             15  ASC-SEL-ITEM                   PIC S9(4) COMP.   03070003
030800             15  ASC-KEY-FIELDS.                                  03080003
030900                 20  ASC-DEPARTMENT             PIC XXX.          03090003
031000                 20  ASC-ENT-ID                 PIC S9(9) COMP.   03100003
031100                 20  ASC-VEND-TYPE              PIC X.            03110003
031200             15  ASC-SCREEN-FIELDS.                               03120003
031300                 20  ASC-ENT-NAME-DESC          PIC X(30).        03130003
031400                 20  ASC-INHOUSE-NBR            PIC XXX.          03140003
031500                 20  ASC-DUN-NBR                PIC X(9).         03150003
031600                 20  ASC-PAYT-TERM-ID           PIC XXX.          03160003
031700                 20  ASC-PAYT-TERM-ID-N         REDEFINES         03170003
031800                     ASC-PAYT-TERM-ID           PIC 999.          03180003
031900                 20  ASC-PAYT-TERM-ID-DESC      PIC X(28).        03190003
032000                 20  ASC-FOB-POINT-TXT          PIC X(20).        03200003
032100                 20  ASC-SHIPT-POINT-TXT        PIC X(20).        03210003
032200                 20  ASC-FRGT-PAYT-CDE          PIC X.            03220003
032300                 20  ASC-KOHLS-FRGT-PCT         PIC X(6).         03230003
032400                 20  ASC-KOHLS-FRGT-PCT-N       PIC 999V99.       03240003
032500                 20  ASC-VEND-FRGT-PCT          PIC X(6).         03250003
032600                 20  ASC-VEND-FRGT-PCT-N        PIC 999V99.       03260003
032700                 20  ASC-RTV-RA-REQD-IND        PIC X.            03270003
032800                 20  ASC-RTV-NO-RA-REQD-IND     PIC X.            03280003
032900                 20  ASC-DEBIT-DESTROY-IND      PIC X.            03290003
033000                 20  ASC-MARKOUT-IND            PIC X.            03300003
033100                 20  ASC-VND-AUTH-ID            PIC X(10).        03310003
033200                 20  ASC-FREIGHT-TERM-ID        PIC XXX.          03320003
033300                 20  ASC-FREIGHT-TERM-ID-N      REDEFINES         03330003
033400                     ASC-FREIGHT-TERM-ID        PIC 999.          03340003
033500                 20  ASC-STATUS-CDE             PIC X(01).        03350003
033600                 20  ASC-PRIM-TYP-CDE           PIC X(01).        03360003
033700                 20  ASC-VND-IN-RMS-IND         PIC X(01).        03370003
033800                 20  ASC-PO-PREPK-CDE           PIC X(01).        03380003
033900                 20  ASC-CHARGE-PCT-ONE         PIC X(07).        03390003
034000                 20  ASC-CHARGE-PCT-ONE-N REDEFINES               03400003
034100                     ASC-CHARGE-PCT-ONE         PIC Z9.9999.      03410003
034200                 20  ASC-CHARGE-PCT-SAVE        PIC X(07).        03420003
034300                 20  ASC-CHARGE-PCT             PIC X(07).        03430003
034400                 20  ASC-CHARGE-PCT-N           PIC 99V9999.      03440003
034500                 20  ASC-LATE-SHIPMENT-IND      PIC X.            03450003
034600                 20  ASC-CHARGE-FACTOR-CDE      PIC X.            03460003
034700             15  ASC-OLD-SCREEN-FIELDS.                           03470003
034800                 20  ASC-PAYT-TERM-ID-O         PIC XXX.          03480003
034900                 20  ASC-PAYT-TERM-ID-N-O       REDEFINES         03490003
035000                     ASC-PAYT-TERM-ID-O         PIC 999.          03500003
035100                 20  ASC-FOB-POINT-TXT-O        PIC X(20).        03510003
035200                 20  ASC-SHIPT-POINT-TXT-O      PIC X(20).        03520003
035300                 20  ASC-FRGT-PAYT-CDE-O        PIC X.            03530003
035400                 20  ASC-KOHLS-FRGT-PCT-O       PIC X(6).         03540003
035500                 20  ASC-KOHLS-FRGT-PCT-N-O     PIC 999V99.       03550003
035600                 20  ASC-VEND-FRGT-PCT-O        PIC X(6).         03560003
035700                 20  ASC-VEND-FRGT-PCT-N-O      PIC 999V99.       03570003
035800                 20  ASC-RTV-RA-REQD-IND-O      PIC X.            03580003
035900                 20  ASC-RTV-NO-RA-REQD-IND-O   PIC X.            03590003
036000                 20  ASC-DEBIT-DESTROY-IND-O    PIC X.            03600003
036100                 20  ASC-MARKOUT-IND-O          PIC X.            03610003
036200                 20  ASC-VND-AUTH-ID-O          PIC X(10).        03620003
036300                 20  ASC-FREIGHT-TERM-ID-O      PIC XXX.          03630003
036400                 20  ASC-FREIGHT-TERM-ID-N-O    REDEFINES         03640003
036500                     ASC-FREIGHT-TERM-ID-O      PIC 999.          03650003
036600                 20  ASC-CHARGE-PCT-O           PIC X(7).         03660003
036700                 20  ASC-CHARGE-PCT-N-O         PIC 99V9999.      03670003
036800                 20  ASC-LATE-SHIPMENT-IND-O    PIC X.            03680003
036900                 20  ASC-CHARGE-FACTOR-CDE-O    PIC X.            03690003
037000                                                                  03700003
037100******************************************************************03710003
037200*    ABEND PROCESSING                                             03720003
037300******************************************************************03730003
037400     COPY DPWS013.                                                03740003
037500                                                                  03750003
037600******************************************************************03760003
037700*    DB2 SQL COMMUNICATION AREA                                   03770003
037800******************************************************************03780003
037900     EXEC SQL                                                     03790003
038000          INCLUDE SQLCA                                           03800003
038100     END-EXEC.                                                    03810003
038200                                                                  03820003
038300******************************************************************03830003
038400*    DB2 DCLGEN FOR VENDOR DEPARTMENT TABLE                       03840003
038500******************************************************************03850003
038600     EXEC SQL                                                     03860003
038700          INCLUDE TVNDDPT                                         03870003
038800     END-EXEC.                                                    03880003
038900                                                                  03890003
039000******************************************************************03900003
039100*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE TABLE              03910003
039200******************************************************************03920003
039300     EXEC SQL                                                     03930003
039400          INCLUDE TEXTENT                                         03940003
039500     END-EXEC.                                                    03950003
039600                                                                  03960003
039700******************************************************************03970003
039800*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE NAME TABLE         03980003
039900******************************************************************03990003
040000     EXEC SQL                                                     04000003
040100          INCLUDE TENTNME                                         04010003
040200     END-EXEC.                                                    04020003
040300                                                                  04030003
040400******************************************************************04040003
040500*    DB2 DCLGEN FOR VENDOR AGREEMENT TABLE                        04050003
040600******************************************************************04060003
040700     EXEC SQL                                                     04070003
040800          INCLUDE TVNDAGR                                         04080003
040900     END-EXEC.                                                    04090003
041000                                                                  04100003
041100******************************************************************04110003
041200*    DB2 DCLGEN FOR VENDOR FREIGHT TERMS TABLE                    04120003
041300******************************************************************04130003
041400     EXEC SQL                                                     04140003
041500          INCLUDE TFRGTRM                                         04150003
041600     END-EXEC.                                                    04160003
041700                                                                  04170003
041800******************************************************************04180003
041900*    DB2 DCLGEN FOR VENDOR PAYMENT TERMS TABLE                    04190003
042000******************************************************************04200003
042100     EXEC SQL                                                     04210003
042200          INCLUDE TPAYTRM                                         04220003
042300     END-EXEC.                                                    04230003
042400                                                                  04240003
042500 LINKAGE SECTION.                                                 04250003
042600                                                                  04260003
042700 01  DFHCOMMAREA.                                                 04270003
042800     05  FILLER                       OCCURS 1 TO 4072 TIMES      04280003
042900                                      DEPENDING ON EIBCALEN.      04290003
043000         10  FILLER                   PIC  X.                     04300003
043100                                                                  04310003
043200 PROCEDURE DIVISION.                                              04320003
043300******************************************************************04330003
043400*    CALL CICS ARCHITECTURE APPLICATION PROGRAM INTERFACE.        04340003
043500*                                                                 04350003
043600*    PERFORM PROGRAM LOGIC.                                       04360003
043700*                                                                 04370003
043800*    CALL CICS ARCHITECTURE APPLICATION PROGRAM INTERFACE.        04380003
043900******************************************************************04390003
044000 0000-MAIN-MODULE.                                                04400003
044100                                                                  04410003
044200     INITIALIZE DP030-CICS-API-FIELDS.                            04420003
044300     MOVE +1                     TO DP030-NUMBER-OF-MAPS.         04430003
044400     MOVE PC-CURRENT-MAPSET-NAME TO DP030-MAPSET-NAME.            04440003
044500     MOVE PC-CURRENT-MAP-NAME    TO DP030-MAP-NAME (1).           04450003
044600     SET DP030-RECEIVE-APPL-MAP  TO TRUE.                         04460003
044700     MOVE LENGTH OF VN014AI      TO DP030-MAP-LENGTH (1).         04470003
044800     MOVE 'PROGRAM ENTRY CALL'   TO DP013-MESSAGE-TEXT (1).       04480003
044900                                                                  04490003
045000     PERFORM 0001-CALL-CICS-ARCH-API.                             04500003
045100                                                                  04510003
045200     PERFORM 1000-CONTROL-PROCESSING.                             04520003
045300                                                                  04530003
045400     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          04540003
045500                                                                  04550003
045600     PERFORM 0001-CALL-CICS-ARCH-API.                             04560003
045700                                                                  04570003
045800 0001-CALL-CICS-ARCH-API.                                         04580003
045900                                                                  04590003
046000*    CALL 'DPKCS030' USING DFHEIBLK                               04600007
046000     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04601007
046100                           DFHCOMMAREA                            04610003
046200                           DP030-CICS-API-FIELDS                  04620003
046300                           DP020-STANDARD-COMMAREA                04630003
046400                           VN014AI.                               04640003
046500                                                                  04650003
046600     IF NOT DP030-RC-CALL-SUCCESSFUL                              04660003
046700         SET DP013-CICS-ABEND                                     04670003
046800             DP013-NO-ROLLBACK                                    04680003
046900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   04690003
047000         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        04700003
047100*        MOVE 'UNSUCCESSFUL CALL TO DPKCS030, RETURN-CODE ON NEXT 04710007
047200*             'LINE'            TO DP013-MESSAGE-TEXT (2)         04720007
047100         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04721007
047200-             'N NEXT LINE'     TO DP013-MESSAGE-TEXT (2)         04722007
047300         MOVE DP030-RETURN-CODE TO DP013-MESSAGE-TEXT (3)         04730003
047400                                                                  04740003
047500         PERFORM DP013-0000-PROCESS-ABEND                         04750003
047600     END-IF.                                                      04760003
047700                                                                  04770003
047800******************************************************************04780003
047900*    EXECUTE APPROPRIATE LOGIC BASED ON ACTION TO BE PERFORMED    04790003
048000******************************************************************04800003
048100 1000-CONTROL-PROCESSING.                                         04810003
048200                                                                  04820003
048300     EVALUATE TRUE                                                04830003
048400                                                                  04840003
048500         WHEN DP020-NEXT-ACT-INITIAL                              04850003
048600              SET PS-NO-ERROR TO TRUE                             04860003
048700                                                                  04870003
048800              PERFORM 1100-PROCESS-INTER-APPL-COMM                04880003
048900                                                                  04890003
049000              IF PS-NO-ERROR                                      04900003
049100                                                                  04910003
049200                  PERFORM 4000-BUILD-INITIAL-PANEL                04920003
049300                  PERFORM 3200-RESET-ATTRIBUTES                   04930003
049400                                                                  04940003
049500                  PERFORM 3500-SAVE-SCREEN-FIELDS                 04950003
049600                                                                  04960003
049700              END-IF                                              04970003
049800                                                                  04980003
049900                                                                  04990003
050000         WHEN DP020-NEXT-ACT-READ-MAP                             05000003
050100                                                                  05010003
050200              PERFORM 2000-PROCESS-PANEL                          05020003
050300                                                                  05030003
050400                                                                  05040003
050500         WHEN DP020-NEXT-ACT-RETURN                               05050003
050600                                                                  05060003
050700              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05070003
050800                                                                  05080003
050900              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05090003
051000                                                                  05100003
051100                                                                  05110003
051200         WHEN OTHER                                               05120003
051300              SET DP013-LOGIC-ABEND                               05130003
051400                  DP013-NO-ROLLBACK TO TRUE                       05140003
051500              MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH   05150003
051600              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED' TO05160003
051700                                             DP013-MESSAGE-TEXT(1)05170003
051800              MOVE DP020-NEXT-APPL-ACTIVITY TO                    05180003
051900                                             DP013-MESSAGE-TEXT(2)05190003
052000              PERFORM DP013-0000-PROCESS-ABEND                    05200003
052100                                                                  05210003
052200     END-EVALUATE.                                                05220003
052300                                                                  05230003
052400******************************************************************05240003
052500*    WHEN THIS PROGRAM IS INITIATED FROM THE INQUIRY PROGRAM,     05250003
052600*    DEPARTMENT AND INHOUSE ARE PASSED                            05260003
052700*    WHEN THIS PROGRAM IS INITIATED FROM A LIST PROGRAM,          05270003
052800*    READ THE VENDOR(S) FROM THE SELECTION TEMP. STORAGE QUEUE    05280003
052900******************************************************************05290003
053000 1100-PROCESS-INTER-APPL-COMM.                                    05300003
053100                                                                  05310003
053200     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05320003
053300     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   05330003
053400                                                                  05340003
053500     EVALUATE DP020-INT-APPL-FORMAT-IND                           05350003
053600         WHEN PC-INTER-APPL-INQ                                   05360003
053700              MOVE VN001-DEPARTMENT-NUMBER TO PV-DEPT-NBR         05370003
053800              MOVE VN001-VENDOR-TYPE       TO PV-VEND-TYPE        05380003
053900              MOVE VN001-VENDOR-NAME       TO PV-VEND-NAME        05390003
054000              MOVE VN001-INHOUSE-NUMBER    TO PV-INHOUSE-NBR-X    05400003
054100              MOVE PV-INHOUSE-NBR          TO PV-INHOUSE-NUMBER   05410003
054200                                                                  05420003
054300              IF PV-VEND-TYPE = 'E'                               05430003
054400                  PERFORM 1111-GET-ENTERPRISE-ID                  05440003
054500              ELSE                                                05450003
054600                  PERFORM 1110-GET-ENTERPRISE-ID                  05460003
054700              END-IF                                              05470003
054800                                                                  05480003
054900         WHEN PC-INTER-APPL-LIST                                  05490003
055000              IF VN002-NUMBER-OF-SELECTED-ITEMS = ZERO            05500003
055100                  SET PS-ERROR                                    05510003
055200                      DP030-OVERRIDE-GO                           05520003
055300                      DP020-MSG-WARNING                           05530003
055400                      DP020-NEXT-ACT-APPL-ERROR TO TRUE           05540003
055500                  MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER        05550003
055600              ELSE                                                05560003
055700                  SET ASC-USE-SELECTION-QUEUE TO TRUE             05570003
055800                  MOVE VN002-NUMBER-OF-SELECTED-ITEMS TO          05580003
055900                                      ASC-NUMBER-OF-SELECTED-ITEMS05590003
056000                  MOVE VN002-NUMBER-OF-TS-ITEMS TO                05600003
056100                                            ASC-NUMBER-OF-TS-ITEMS05610003
056200                  MOVE VN002-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME 05620003
056300                  MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB        05630003
056400                  MOVE ZERO                 TO ASC-SEL-ITEM       05640003
056500                                                                  05650003
056600                  PERFORM 2010-GET-NEXT-VENDOR                    05660003
056700                                                                  05670003
056800              END-IF                                              05680003
056900                                                                  05690003
057000                                                                  05700003
057100         WHEN OTHER                                               05710003
057200              SET DP020-MSG-FATAL                                 05720003
057300                  DP020-NEXT-ACT-APPL-ERROR TO TRUE               05730003
057400              MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER            05740003
057500     END-EVALUATE.                                                05750003
057600                                                                  05760003
057700 1110-GET-ENTERPRISE-ID.                                          05770003
057800                                                                  05780003
057900     PERFORM WITH TEST AFTER                                      05790003
058000             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                05800003
058100             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         05810003
058200                     SQLCODE = ZERO OR                            05820003
058300                     SQLCODE = +100                               05830003
058400                                                                  05840003
058500             EXEC SQL                                             05850003
058600                  SELECT ENT_ID                                   05860003
058700                    INTO :VNDDPT-ENT-ID                           05870003
058800                    FROM TVNDDPT                                  05880003
058900                   WHERE DEPT_NBR    = :PV-DEPT-NBR               05890003
059000                     AND INHOUSE_NBR = :PV-INHOUSE-NUMBER         05900003
059100             END-EXEC                                             05910003
059200                                                                  05920003
059300             EVALUATE TRUE                                        05930003
059400                      WHEN SQLCODE = ZERO                         05940003
059500                      WHEN SQLCODE = +100                         05950003
059600                      WHEN SQLCODE = -904                         05960003
059700                      WHEN SQLCODE = -913                         05970003
059800                           CONTINUE                               05980003
059900                                                                  05990003
060000                      WHEN SQLWARN0 NOT = SPACES                  06000003
060100                      WHEN SQLCODE  NOT = ZERO                    06010003
060200                           MOVE '1110-GET-ENTERPRISE-ID' TO       06020003
060300                                                   DP013-PARAGRAPH06030003
060400                           MOVE 'UNSUCCESSFUL SELECT ENTERPRIS ID'06040003
060500                                         TO DP013-MESSAGE-TEXT (1)06050003
060600                           MOVE SQLCA TO DP013-SQLCA              06060003
060700                           MOVE 'TVNDDPT ' TO                     06070003
060800                                          DP013-DB2-TABLE-NAME (1)06080003
060900                           SET DP013-DB2-ABEND                    06090003
061000                               DP013-XCTL-DISPLAY-RESTART TO TRUE 06100003
061100                                                                  06110003
061200                           PERFORM DP013-0000-PROCESS-ABEND       06120003
061300             END-EVALUATE                                         06130003
061400     END-PERFORM.                                                 06140003
061500                                                                  06150003
061600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06160003
061700         MOVE '1110-GET-ENTERPRISE-ID' TO DP013-PARAGRAPH         06170003
061800         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE ID' TO   06180003
061900                                            DP013-MESSAGE-TEXT (1)06190003
062000         MOVE SQLCA      TO DP013-SQLCA                           06200003
062100         MOVE 'TVNDDPT ' TO DP013-DB2-TABLE-NAME (1)              06210003
062200         SET DP013-DB2-ABEND                                      06220003
062300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   06230003
062400                                                                  06240003
062500         PERFORM DP013-0000-PROCESS-ABEND                         06250003
062600     END-IF.                                                      06260003
062700                                                                  06270003
062800     IF SQLCODE = ZERO                                            06280003
062900         MOVE PV-DEPT-NBR   TO ASC-DEPARTMENT                     06290003
063000         MOVE VNDDPT-ENT-ID TO ASC-ENT-ID                         06300003
063100     END-IF.                                                      06310003
063200                                                                  06320003
063300     IF SQLCODE = +100                                            06330003
063400         SET PS-ERROR                                             06340003
063500             DP020-MSG-FATAL                                      06350003
063600             DP020-NEXT-ACT-APPL-ERROR TO TRUE                    06360003
063700         MOVE PC-TSYMSG-00156 TO DP020-MSG-NUMBER                 06370003
063800     END-IF.                                                      06380003
063900                                                                  06390003
064000 1111-GET-ENTERPRISE-ID.                                          06400003
064100                                                                  06410003
064200     PERFORM                                                      06420003
064300         WITH TEST AFTER                                          06430003
064400         VARYING PV-RETRY-COUNTER                                 06440003
064500         FROM 1 BY 1                                              06450003
064600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06460003
064700             OR (SQLCODE = +0)                                    06470003
064800             OR (SQLCODE = +100))                                 06480003
064900                                                                  06490003
065000         EXEC SQL                                                 06500003
065100              SELECT A.ENT_ID                                     06510003
065200                INTO :VNDDPT-ENT-ID                               06520003
065300                FROM TVNDDPT A                                    06530003
065400                    ,TENTNME B                                    06540003
065500               WHERE A.DEPT_NBR      = :PV-DEPT-NBR               06550003
065600                 AND B.ENT_ID        = A.ENT_ID                   06560003
065700                 AND B.ENT_NAME_DESC = :PV-VEND-NAME              06570003
065800                 AND B.TYPE_CDE      = '01'                       06580003
065900         END-EXEC                                                 06590003
066000                                                                  06600003
066100         EVALUATE TRUE                                            06610003
066200             WHEN SQLCODE = +0                                    06620003
066300                  MOVE PV-DEPT-NBR   TO ASC-DEPARTMENT            06630003
066400                  MOVE VNDDPT-ENT-ID TO ASC-ENT-ID                06640003
066500                                                                  06650003
066600             WHEN SQLCODE = +100                                  06660003
066700                  SET PS-ERROR                                    06670003
066800                      DP020-MSG-FATAL                             06680003
066900                      DP020-NEXT-ACT-APPL-ERROR                   06690003
067000                                     TO TRUE                      06700003
067100                  MOVE PC-TSYMSG-00014 TO DP020-MSG-NUMBER        06710003
067200                                                                  06720003
067300             WHEN SQLCODE = -904                                  06730003
067400             WHEN SQLCODE = -913                                  06740003
067500                  CONTINUE                                        06750003
067600                                                                  06760003
067700             WHEN SQLWARN0 NOT = SPACES                           06770003
067800             WHEN SQLCODE < +0                                    06780003
067900             WHEN SQLCODE > +0                                    06790003
068000                  MOVE '1111-GET-ENTERPRISE-ID'                   06800003
068100                                  TO DP013-PARAGRAPH              06810003
068200                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE ID'        06820003
068300                                  TO DP013-MESSAGE-TEXT (1)       06830003
068400                  MOVE SQLCA      TO DP013-SQLCA                  06840003
068500                  MOVE 'TVNDDPT ' TO DP013-DB2-TABLE-NAME (1)     06850003
068600                  SET DP013-DB2-ABEND                             06860003
068700                      DP013-XCTL-DISPLAY-RESTART                  06870003
068800                                  TO TRUE                         06880003
068900                  PERFORM DP013-0000-PROCESS-ABEND                06890003
069000         END-EVALUATE                                             06900003
069100     END-PERFORM.                                                 06910003
069200                                                                  06920003
069300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06930003
069400         MOVE '1111-GET-ENTERPRISE-ID'                            06940003
069500                                  TO DP013-PARAGRAPH              06950003
069600         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE ID'      06960003
069700                                  TO DP013-MESSAGE-TEXT (1)       06970003
069800         MOVE SQLCA               TO DP013-SQLCA                  06980003
069900         MOVE 'TVNDDPT '          TO DP013-DB2-TABLE-NAME (1)     06990003
070000         SET DP013-DB2-ABEND                                      07000003
070100             DP013-XCTL-DISPLAY-RESTART                           07010003
070200                                  TO TRUE                         07020003
070300         PERFORM DP013-0000-PROCESS-ABEND                         07030003
070400     END-IF.                                                      07040003
070500                                                                  07050003
070600******************************************************************07060003
070700*    PROCESS FUNCTION KEYS THAT DON'T REQUIRE DATA TO BE EDITED.  07070003
070800*    IF ONE OF THESE KEYS ISN'T USED, PERFORM DATA EDITS AND      07080003
070900*    PROCESS FUNCTION KEYS THAT REQUIRE DATA TO BE EDITED.        07090003
071000******************************************************************07100003
071100 2000-PROCESS-PANEL.                                              07110003
071200                                                                  07120003
071300     EVALUATE TRUE                                                07130003
071400         WHEN DP020-SRC-AID = DP016-CLEAR                         07140003
071500                                                                  07150003
071600              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  07160003
071700                                                                  07170003
071800              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07180003
071900                                                                  07190003
072000                                                                  07200003
072100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07210003
072200              MOVE ASC-DEPARTMENT  TO PV-DEPT-NBR                 07220003
072300              MOVE ASC-INHOUSE-NBR TO PV-INHOUSE-NBR-X            07230003
072400                                                                  07240003
072500              PERFORM 4000-BUILD-INITIAL-PANEL                    07250003
072600                                                                  07260003
072700              PERFORM 3200-RESET-ATTRIBUTES                       07270003
072800                                                                  07280003
072900              PERFORM 3500-SAVE-SCREEN-FIELDS                     07290003
073000                                                                  07300003
073100                                                                  07310003
073200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07320003
073300              IF ASC-USE-SELECTION-QUEUE                          07330003
073400                                                                  07340003
073500                  PERFORM 2010-GET-NEXT-VENDOR                    07350003
073600                                                                  07360003
073700                  IF PS-END-OF-LIST                               07370003
073800                      SET PS-NOT-END-OF-LIST TO TRUE              07380003
073900                  ELSE                                            07390003
074000                      PERFORM 4000-BUILD-INITIAL-PANEL            07400003
074100                                                                  07410003
074200                      PERFORM 3200-RESET-ATTRIBUTES               07420003
074300                  END-IF                                          07430003
074400              ELSE                                                07440003
074500                  SET PS-END-OF-LIST                              07450003
074600                      DP020-MSG-INFORMATIONAL TO TRUE             07460003
074700                  MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER        07470003
074800              END-IF                                              07480003
074900                                                                  07490003
075000                                                                  07500003
075100         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07510003
075200              IF ASC-USE-SELECTION-QUEUE                          07520003
075300                                                                  07530003
075400                  PERFORM 2020-GET-PREV-VENDOR                    07540003
075500                                                                  07550003
075600                  IF PS-END-OF-LIST                               07560003
075700                      SET PS-NOT-END-OF-LIST TO TRUE              07570003
075800                  ELSE                                            07580003
075900                      PERFORM 4000-BUILD-INITIAL-PANEL            07590003
076000                                                                  07600003
076100                      PERFORM 3200-RESET-ATTRIBUTES               07610003
076200                  END-IF                                          07620003
076300              ELSE                                                07630003
076400                  SET PS-END-OF-LIST                              07640003
076500                      DP020-MSG-INFORMATIONAL TO TRUE             07650003
076600                  MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER        07660003
076700              END-IF                                              07670003
076800                                                                  07680003
076900                                                                  07690003
077000         WHEN OTHER                                               07700003
077100                                                                  07710003
077200              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                07720003
077300                                                                  07730003
077400              PERFORM 2300-CHECK-RACF-ACCESS                      07740003
077500              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  07750003
077600                                                                  07760003
077700              IF PS-NO-ERROR                                      07770003
077800                  SET DP030-CONTINUE-GO TO TRUE                   07780003
077900                                                                  07790003
078000                  PERFORM 2100-CHECK-FUNCTION-KEY                 07800003
078100              ELSE                                                07810003
078200                  SET DP030-OVERRIDE-GO TO TRUE                   07820003
078300              END-IF                                              07830003
078400     END-EVALUATE.                                                07840003
078500                                                                  07850003
078600 2010-GET-NEXT-VENDOR.                                            07860003
078700                                                                  07870003
078800     ADD +1 TO ASC-SEL-SUB.                                       07880003
078900                                                                  07890003
079000     IF ASC-SEL-SUB > VN003-MAX-ITEMS                             07900003
079100         ADD  +1 TO ASC-SEL-ITEM                                  07910003
079200         MOVE +1 TO ASC-SEL-SUB                                   07920003
079300     END-IF.                                                      07930003
079400                                                                  07940003
079500     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 07950003
079600                                                                  07960003
079700         PERFORM 9100-READ-SELECTION-QUEUE                        07970003
079800                                                                  07980003
079900         IF VN003-ITEM (ASC-SEL-SUB) > ZERO                       07990003
080000             MOVE VN003-DEPARTMENT (ASC-SEL-SUB) TO ASC-DEPARTMENT08000003
080100                                                    PV-DEPT-NBR   08010003
080200             MOVE VN003-ENT-ID     (ASC-SEL-SUB) TO ASC-ENT-ID    08020003
080300             MOVE VN003-VEND-TYPE  (ASC-SEL-SUB) TO ASC-VEND-TYPE 08030003
080400             SET  VN003-INQ (ASC-SEL-SUB) TO TRUE                 08040003
080500                                                                  08050003
080600             PERFORM 9200-REWRITE-SELECTION-QUEUE                 08060003
080700                                                                  08070003
080800             INITIALIZE ASC-SCREEN-FIELDS                         08080003
080900         ELSE                                                     08090003
081000             SUBTRACT +1 FROM ASC-SEL-SUB                         08100003
081100             SET PS-END-OF-LIST                                   08110003
081200                 DP020-MSG-INFORMATIONAL TO TRUE                  08120003
081300             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             08130003
081400         END-IF                                                   08140003
081500     ELSE                                                         08150003
081600         SUBTRACT +1 FROM ASC-SEL-ITEM                            08160003
081700         MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB                      08170003
081800         SET PS-END-OF-LIST                                       08180003
081900             DP020-MSG-INFORMATIONAL TO TRUE                      08190003
082000         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                 08200003
082100     END-IF.                                                      08210003
082200                                                                  08220003
082300 2020-GET-PREV-VENDOR.                                            08230003
082400                                                                  08240003
082500     SUBTRACT +1 FROM ASC-SEL-SUB.                                08250003
082600     IF ASC-SEL-SUB < +1                                          08260003
082700         SUBTRACT +1 FROM ASC-SEL-ITEM                            08270003
082800         MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB                      08280003
082900     END-IF.                                                      08290003
083000                                                                  08300003
083100     IF ASC-SEL-ITEM > ZERO                                       08310003
083200                                                                  08320003
083300         PERFORM 9100-READ-SELECTION-QUEUE                        08330003
083400                                                                  08340003
083500         IF VN003-DEPARTMENT (ASC-SEL-SUB) > SPACES AND           08350003
083600            VN003-ENT-ID     (ASC-SEL-SUB) > ZERO                 08360003
083700             MOVE VN003-DEPARTMENT (ASC-SEL-SUB) TO ASC-DEPARTMENT08370003
083800             MOVE VN003-ENT-ID     (ASC-SEL-SUB) TO ASC-ENT-ID    08380003
083900         END-IF                                                   08390003
084000         INITIALIZE ASC-SCREEN-FIELDS                             08400003
084100     ELSE                                                         08410003
084200         MOVE +1 TO ASC-SEL-ITEM                                  08420003
084300                    ASC-SEL-SUB                                   08430003
084400         SET PS-END-OF-LIST                                       08440003
084500             DP020-MSG-INFORMATIONAL TO TRUE                      08450003
084600             MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER             08460003
084700     END-IF.                                                      08470003
084800                                                                  08480003
084900******************************************************************08490003
085000*    PROCESS FUNCTION KEYS THAT REQUIRE DATA TO BE EDITED         08500003
085100******************************************************************08510003
085200 2100-CHECK-FUNCTION-KEY.                                         08520003
085300                                                                  08530003
085400     EVALUATE TRUE                                                08540003
085500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08550003
085600              SET PS-NO-FIELDS-CHANGED TO TRUE                    08560003
085700                                                                  08570003
085800              PERFORM 3600-COMPARE-SCREEN-FIELDS                  08580003
085900                                                                  08590003
086000                                                                  08600003
086100              IF PS-FIELDS-CHANGED                                08610003
086200                  SET DP030-CONTINUE-GO TO TRUE                   08620003
086300                                                                  08630003
086400                  PERFORM 5000-UPDATE-TERMS                       08640003
086500                                                                  08650003
086600                  SET DP020-MSG-INFORMATIONAL TO TRUE             08660003
086700                  MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER        08670003
086800                                                                  08680003
086900                  IF PS-RMS-FIELDS-CHANGED            AND         08690003
087000                     ASC-PRIM-TYP-CDE           = 'M' AND         08700003
087100                     ASC-PAYT-TERM-ID           >  0  AND         08710003
087200                     ASC-FREIGHT-TERM-ID        >  0              08720003
087300                     IF ASC-VND-IN-RMS-IND      = 'Y'             08730003
087400                         INITIALIZE VN013-VENDOR-INTERFACE-PARMS  08740003
087500                         SET VN013-ACTION-UPDATE TO TRUE          08750003
087600                         PERFORM 5060-CALL-VNKCS023               08760003
087700                     ELSE                                         08770003
087800                         INITIALIZE VN013-VENDOR-INTERFACE-PARMS  08780003
087900                         SET VN013-ACTION-ADD    TO TRUE          08790003
088000                         PERFORM 5060-CALL-VNKCS023               08800003
088100                         IF VN013-RMS-VENDOR-ADDED                08810003
088200                             PERFORM 5070-UPDATE-TEXTENT          08820003
088300                         END-IF                                   08830003
088400                     END-IF                                       08840003
088500                  END-IF                                          08850003
088600                                                                  08860003
088700                  PERFORM 3500-SAVE-SCREEN-FIELDS                 08870003
088800                                                                  08880003
088900              ELSE                                                08890003
089000                  SET DP020-MSG-INFORMATIONAL TO TRUE             08900003
089100                  MOVE PC-TSYMSG-00046 TO DP020-MSG-NUMBER        08910003
089200              END-IF                                              08920003
089300                                                                  08930003
089400                                                                  08940003
089500         WHEN DP020-SRC-AID = DP016-ENTER                         08950003
089600              CONTINUE                                            08960003
089700                                                                  08970003
089800                                                                  08980003
089900         WHEN OTHER                                               08990003
090000              SET DP013-CICS-ABEND                                09000003
090100                  DP013-NO-ROLLBACK                               09010003
090200                  DP013-XCTL-DISPLAY-RESTART TO TRUE              09020003
090300              MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH   09030003
090400              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API' TO  09040003
090500                                            DP013-MESSAGE-TEXT (1)09050003
090600              PERFORM DP013-0000-PROCESS-ABEND                    09060003
090700                                                                  09070003
090800     END-EVALUATE.                                                09080003
090900                                                                  09090003
091000 2200-MOVE-SCREEN-TO-COMMAREA.                                    09100003
091100                                                                  09110003
091200     IF APAYTRML > ZERO                                           09120003
091300         MOVE APAYTRMI TO ASC-PAYT-TERM-ID                        09130003
091400     ELSE                                                         09140003
091500         IF APAYTRMF = DP015-ERASE-EOF                            09150003
091600             MOVE ZERO TO ASC-PAYT-TERM-ID-N                      09160003
091700         END-IF                                                   09170003
091800     END-IF.                                                      09180003
091900                                                                  09190003
092000     IF AFRTIDTL > ZERO                                           09200003
092100         MOVE AFRTIDTI TO ASC-FREIGHT-TERM-ID-N                   09210003
092200     ELSE                                                         09220003
092300         IF AFRTIDTF = DP015-ERASE-EOF                            09230003
092400             MOVE ZERO TO ASC-FREIGHT-TERM-ID-N                   09240003
092500         END-IF                                                   09250003
092600     END-IF.                                                      09260003
092700                                                                  09270003
092800     IF AFOBPNTL > ZERO                                           09280003
092900         MOVE AFOBPNTI TO ASC-FOB-POINT-TXT                       09290003
093000     ELSE                                                         09300003
093100         IF AFOBPNTF = DP015-ERASE-EOF                            09310003
093200             MOVE SPACES TO ASC-FOB-POINT-TXT                     09320003
093300         END-IF                                                   09330003
093400     END-IF.                                                      09340003
093500                                                                  09350003
093600     IF ASHPPNTL > ZERO                                           09360003
093700         MOVE ASHPPNTI TO ASC-SHIPT-POINT-TXT                     09370003
093800     ELSE                                                         09380003
093900         IF ASHPPNTF = DP015-ERASE-EOF                            09390003
094000             MOVE SPACES TO ASC-SHIPT-POINT-TXT                   09400003
094100         END-IF                                                   09410003
094200     END-IF.                                                      09420003
094300                                                                  09430003
094400     MOVE APAYFRGI TO ASC-FRGT-PAYT-CDE.                          09440003
094500     MOVE AKFRGHTI TO ASC-KOHLS-FRGT-PCT.                         09450003
094600     MOVE AVFRGHTI TO ASC-VEND-FRGT-PCT.                          09460003
094700                                                                  09470003
094800     IF ARTVRQDL > ZERO                                           09480003
094900         MOVE ARTVRQDI TO ASC-RTV-RA-REQD-IND                     09490003
095000     ELSE                                                         09500003
095100         IF ARTVRQDF = DP015-ERASE-EOF                            09510003
095200             MOVE SPACE TO ASC-RTV-RA-REQD-IND                    09520003
095300         END-IF                                                   09530003
095400     END-IF.                                                      09540003
095500                                                                  09550003
095600     IF ARTVNRQL > ZERO                                           09560003
095700         MOVE ARTVNRQI TO ASC-RTV-NO-RA-REQD-IND                  09570003
095800     ELSE                                                         09580003
095900         IF ARTVNRQF = DP015-ERASE-EOF                            09590003
096000             MOVE SPACE TO ASC-RTV-NO-RA-REQD-IND                 09600003
096100         END-IF                                                   09610003
096200     END-IF.                                                      09620003
096300                                                                  09630003
096400     IF ADBTDSTL > ZERO                                           09640003
096500         MOVE ADBTDSTI TO ASC-DEBIT-DESTROY-IND                   09650003
096600     ELSE                                                         09660003
096700         IF ADBTDSTF = DP015-ERASE-EOF                            09670003
096800             MOVE SPACE TO ASC-DEBIT-DESTROY-IND                  09680003
096900         END-IF                                                   09690003
097000     END-IF.                                                      09700003
097100                                                                  09710003
097200     IF AMRKOUTL > ZERO                                           09720003
097300         MOVE AMRKOUTI TO ASC-MARKOUT-IND                         09730003
097400     ELSE                                                         09740003
097500         IF AMRKOUTF = DP015-ERASE-EOF                            09750003
097600             MOVE SPACE TO ASC-MARKOUT-IND                        09760003
097700         END-IF                                                   09770003
097800     END-IF.                                                      09780003
097900                                                                  09790003
098000     IF AAUTHIDL > ZERO                                           09800003
098100         MOVE AAUTHIDI TO ASC-VND-AUTH-ID                         09810003
098200     ELSE                                                         09820003
098300         IF AAUTHIDF = DP015-ERASE-EOF                            09830003
098400             MOVE SPACE TO ASC-VND-AUTH-ID                        09840003
098500         END-IF                                                   09850003
098600     END-IF.                                                      09860003
098700                                                                  09870003
098800     IF ALTEINDL > ZERO                                           09880003
098900         MOVE ALTEINDI TO ASC-LATE-SHIPMENT-IND                   09890003
099000     ELSE                                                         09900003
099100         IF ALTEINDF = DP015-ERASE-EOF                            09910003
099200             MOVE SPACE TO ASC-LATE-SHIPMENT-IND                  09920003
099300         END-IF                                                   09930003
099400     END-IF.                                                      09940003
099500                                                                  09950003
099600     IF ACHGCDEL > ZERO                                           09960003
099700         MOVE ACHGCDEI TO ASC-CHARGE-FACTOR-CDE                   09970003
099800     ELSE                                                         09980003
099900         IF ACHGCDEF = DP015-ERASE-EOF                            09990003
100000             MOVE SPACE TO ASC-CHARGE-FACTOR-CDE                  10000003
100100         END-IF                                                   10010003
100200     END-IF.                                                      10020003
100300                                                                  10030003
100400     IF  ACHGPCTL > ZERO                                          10040003
100500         MOVE ACHGPCTI             TO ASC-CHARGE-PCT-N            10050003
100600                                      ASC-CHARGE-PCT              10060003
100700     ELSE                                                         10070003
100800         IF  ACHGPCTF = DP015-ERASE-EOF                           10080003
100900             MOVE SPACES           TO ASC-CHARGE-PCT              10090003
101000             MOVE ZERO             TO ASC-CHARGE-PCT-N            10100003
101100         END-IF                                                   10110003
101200     END-IF.                                                      10120003
101300                                                                  10130003
101400/                                                                 10140003
101500*----------------------------------------------------------------*10150003
101600*    CHECK FOR RTV UPDATE SECURITY.                              *10160003
101700*----------------------------------------------------------------*10170003
101800                                                                  10180003
101900 2300-CHECK-RACF-ACCESS.                                          10190003
102000     SET DP008-RSRC-TYPE-TRAN     TO TRUE.                        10200003
102100     MOVE 'V502'                  TO DP008-FUNCTION-NAME.         10210003
102200     SET DP008-ACCESS-TYPE-USE    TO TRUE.                        10220003
102300                                                                  10230003
102400     EXEC CICS                                                    10240003
102500        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                  10250003
102600             COMMAREA (DP008-SECURITY-COMMAREA)                   10260003
102700             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)              10270003
102800     END-EXEC.                                                    10280003
102900                                                                  10290003
103000     IF DP008-CALL-SUCCESSFUL                                     10300003
103100         IF DP008-ACCESS-ALLOWED                                  10310003
103200             SET PS-HAS-RTV-SEC TO TRUE                           10320003
103300         ELSE                                                     10330003
103400             SET PS-NO-RTV-SEC TO TRUE                            10340003
103500             SET PS-DONT-EDIT-RTV TO TRUE                         10350003
103600     ELSE                                                         10360003
103700        MOVE '2300-CHECK-RACF-ACCESS'                             10370003
103800                              TO DP013-PARAGRAPH                  10380003
103900         MOVE 'UNABLE TO ACCESS CICS'                             10390003
104000                              TO DP013-MESSAGE-TEXT (1)           10400003
104100         MOVE SQLCA           TO DP013-SQLCA                      10410003
104200         SET DP013-DB2-ABEND                                      10420003
104300             DP013-XCTL-DISPLAY-RESTART                           10430003
104400                              TO TRUE                             10440003
104500         PERFORM DP013-0000-PROCESS-ABEND                         10450003
104600     END-IF.                                                      10460003
104700                                                                  10470003
104800 3000-EDIT-DATA-IN-COMMAREA.                                      10480003
104900                                                                  10490003
105000     SET PS-NO-ERROR TO TRUE.                                     10500003
105100                                                                  10510003
105200     PERFORM 3200-RESET-ATTRIBUTES.                               10520003
105300                                                                  10530003
105400******************************************************************10540003
105500*   ONLY ONE OF THE FOUR PURCHASE TERMS FIELDS CAN = 'Y'          10550003
105600******************************************************************10560003
105700                                                                  10570003
105800     IF PS-DONT-EDIT-RTV                                          10580003
105900         CONTINUE                                                 10590003
106000     ELSE                                                         10600003
106100         IF (ASC-RTV-RA-REQD-IND   = 'Y'                          10610003
106200             AND (   ASC-RTV-NO-RA-REQD-IND = 'Y'                 10620003
106300                  OR ASC-DEBIT-DESTROY-IND = 'Y'                  10630003
106400                  OR ASC-MARKOUT-IND       = 'Y'))                10640003
106500             OR (ASC-RTV-NO-RA-REQD-IND = 'Y'                     10650003
106600                 AND (   ASC-DEBIT-DESTROY-IND = 'Y'              10660003
106700                      OR ASC-MARKOUT-IND       = 'Y'))            10670003
106800             OR (ASC-DEBIT-DESTROY-IND = 'Y'                      10680003
106900                 AND ASC-MARKOUT-IND   = 'Y')                     10690003
107000             SET PS-ERROR                                         10700003
107100                 DP020-MSG-FATAL                                  10710003
107200                 DP030-SET-CURSOR-APPL-1 TO TRUE                  10720003
107300             MOVE PC-TSYMSG-00492 TO DP020-MSG-NUMBER             10730003
107400             MOVE -1                    TO ARTVRQDL  ARTVNRQL     10740003
107500                                           ADBTDSTL  AMRKOUTL     10750003
107600             MOVE DP015-UNP-ALP-BRT-OFF TO ARTVRQDA  ARTVNRQA     10760003
107700                                           ADBTDSTA  AMRKOUTA     10770003
107800             MOVE DP015-RED             TO ARTVRQDC  ARTVNRQC     10780003
107900                                           ADBTDSTC  AMRKOUTC     10790003
108000             MOVE DP015-REVERSE         TO ARTVRQDH  ARTVNRQH     10800003
108100                                           ADBTDSTH  AMRKOUTH     10810003
108200         END-IF                                                   10820003
108300     END-IF.                                                      10830003
108400*                                                                 10840003
108500******************************************************************10850003
108600*   IF ALL 4 RETURN-TO-VENDOR ARRANGEMENTS ARE SPACE, SPACES ARE  10860003
108700*      UPDATED IN TABLE FOR ALL 4                                 10870003
108800*   IF ONE OF THE ARRANGEMENTS IS 'Y', 'N' IS UPDATED IN TABLE FOR10880003
108900*      THE OTHER 3                                                10890003
109000*   OTHERWISE, EDITS FOR EACH OF THE ARRANGEMENTS FOLLOW          10900003
109100******************************************************************10910003
109200                                                                  10920003
109300     IF PS-DONT-EDIT-RTV                                          10930003
109400         CONTINUE                                                 10940003
109500     ELSE                                                         10950003
109600         IF  ASC-RTV-RA-REQD-IND    = SPACE                       10960003
109700         AND ASC-RTV-NO-RA-REQD-IND = SPACE                       10970003
109800         AND ASC-DEBIT-DESTROY-IND  = SPACE                       10980003
109900         AND ASC-MARKOUT-IND        = SPACE                       10990003
110000             SET PS-DONT-EDIT-RTV TO TRUE                         11000003
110100             IF ASC-VND-AUTH-ID NOT = SPACE                       11010003
110200                PERFORM 3060-AUTH-ID-NOT-ALLOWED                  11020003
110300             END-IF                                               11030003
110400         ELSE                                                     11040003
110500            IF  ASC-RTV-RA-REQD-IND        = 'Y'                  11050003
110600            AND ASC-RTV-NO-RA-REQD-IND NOT = 'Y'                  11060003
110700            AND ASC-DEBIT-DESTROY-IND  NOT = 'Y'                  11070003
110800            AND ASC-MARKOUT-IND        NOT = 'Y'                  11080003
110900                MOVE 'N' TO ASC-RTV-NO-RA-REQD-IND ARTVNRQO       11090003
111000                            ASC-DEBIT-DESTROY-IND  ADBTDSTO       11100003
111100                            ASC-MARKOUT-IND        AMRKOUTO       11110003
111200            ELSE                                                  11120003
111300                IF  ASC-RTV-NO-RA-REQD-IND    = 'Y'               11130003
111400                AND ASC-RTV-RA-REQD-IND   NOT = 'Y'               11140003
111500                AND ASC-DEBIT-DESTROY-IND NOT = 'Y'               11150003
111600                AND ASC-MARKOUT-IND       NOT = 'Y'               11160003
111700                    MOVE 'N' TO ASC-RTV-RA-REQD-IND    ARTVRQDO   11170003
111800                                ASC-DEBIT-DESTROY-IND  ADBTDSTO   11180003
111900                                ASC-MARKOUT-IND        AMRKOUTO   11190003
112000                    IF ASC-VND-AUTH-ID NOT = SPACE                11200003
112100                       PERFORM 3060-AUTH-ID-NOT-ALLOWED           11210003
112200                    END-IF                                        11220003
112300                ELSE                                              11230003
112400                    IF  ASC-DEBIT-DESTROY-IND      = 'Y'          11240003
112500                    AND ASC-RTV-RA-REQD-IND    NOT = 'Y'          11250003
112600                    AND ASC-RTV-NO-RA-REQD-IND NOT = 'Y'          11260003
112700                    AND ASC-MARKOUT-IND        NOT = 'Y'          11270003
112800                        MOVE 'N' TO ASC-RTV-RA-REQD-IND  ARTVRQDO 11280003
112900                                  ASC-RTV-NO-RA-REQD-IND ARTVNRQO 11290003
113000                                  ASC-MARKOUT-IND        AMRKOUTO 11300003
113100                        IF ASC-VND-AUTH-ID NOT = SPACE            11310003
113200                           PERFORM 3060-AUTH-ID-NOT-ALLOWED       11320003
113300                        END-IF                                    11330003
113400                    ELSE                                          11340003
113500                        IF  ASC-MARKOUT-IND            = 'Y'      11350003
113600                        AND ASC-RTV-RA-REQD-IND    NOT = 'Y'      11360003
113700                        AND ASC-RTV-NO-RA-REQD-IND NOT = 'Y'      11370003
113800                        AND ASC-DEBIT-DESTROY-IND  NOT = 'Y'      11380003
113900                            MOVE 'N' TO ASC-RTV-RA-REQD-IND       11390003
114000                                        ARTVRQDO                  11400003
114100                                        ASC-RTV-NO-RA-REQD-IND    11410003
114200                                        ARTVNRQO                  11420003
114300                                        ASC-DEBIT-DESTROY-IND     11430003
114400                                        ADBTDSTO                  11440003
114500                            IF ASC-VND-AUTH-ID NOT = SPACE        11450003
114600                               PERFORM 3060-AUTH-ID-NOT-ALLOWED   11460003
114700                            END-IF                                11470003
114800                        ELSE                                      11480003
114900                            IF  ASC-MARKOUT-IND            = 'N'  11490003
115000                            AND ASC-RTV-RA-REQD-IND        = 'N'  11500003
115100                            AND ASC-RTV-NO-RA-REQD-IND     = 'N'  11510003
115200                            AND ASC-DEBIT-DESTROY-IND      = 'N'  11520003
115300                                IF ASC-VND-AUTH-ID NOT = SPACE    11530003
115400                                  PERFORM 3060-AUTH-ID-NOT-ALLOWED11540003
115500                                END-IF                            11550003
115600                            END-IF                                11560003
115700                        END-IF                                    11570003
115800                    END-IF                                        11580003
115900                END-IF                                            11590003
116000            END-IF                                                11600003
116100         END-IF                                                   11610003
116200     END-IF.                                                      11620003
116300                                                                  11630003
116400******************************************************************11640003
116500*   MARKOUT INDICATOR MUST BE 'Y' OR 'N'                          11650003
116600******************************************************************11660003
116700     IF PS-DONT-EDIT-RTV                                          11670003
116800         CONTINUE                                                 11680003
116900     ELSE                                                         11690003
117000        IF ASC-MARKOUT-IND NOT = 'Y' AND 'N'                      11700003
117100            SET PS-ERROR                                          11710003
117200                DP020-MSG-FATAL                                   11720003
117300                DP030-SET-CURSOR-APPL-1 TO TRUE                   11730003
117400            MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER              11740003
117500            MOVE -1                    TO AMRKOUTL                11750003
117600            MOVE DP015-UNP-ALP-BRT-OFF TO AMRKOUTA                11760003
117700            MOVE DP015-RED             TO AMRKOUTC                11770003
117800            MOVE DP015-REVERSE         TO AMRKOUTH                11780003
117900        END-IF                                                    11790003
118000     END-IF.                                                      11800003
118100                                                                  11810003
118200                                                                  11820003
118300******************************************************************11830003
118400*   DEBIT AND DESTROY INDICATOR MUST BE 'Y' OR 'N'                11840003
118500******************************************************************11850003
118600     IF PS-DONT-EDIT-RTV                                          11860003
118700         CONTINUE                                                 11870003
118800     ELSE                                                         11880003
118900        IF ASC-DEBIT-DESTROY-IND NOT = 'Y' AND 'N'                11890003
119000            SET PS-ERROR                                          11900003
119100                DP020-MSG-FATAL                                   11910003
119200                DP030-SET-CURSOR-APPL-1 TO TRUE                   11920003
119300            MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER              11930003
119400            MOVE -1                    TO ADBTDSTL                11940003
119500            MOVE DP015-UNP-ALP-BRT-OFF TO ADBTDSTA                11950003
119600            MOVE DP015-RED             TO ADBTDSTC                11960003
119700            MOVE DP015-REVERSE         TO ADBTDSTH                11970003
119800        END-IF                                                    11980003
119900     END-IF.                                                      11990003
120000                                                                  12000003
120100                                                                  12010003
120200******************************************************************12020003
120300*   RTV NO RA REQUIRED INDICATOR MUST BE 'Y' OR 'N'               12030003
120400******************************************************************12040003
120500     IF PS-DONT-EDIT-RTV                                          12050003
120600         CONTINUE                                                 12060003
120700     ELSE                                                         12070003
120800        IF ASC-RTV-NO-RA-REQD-IND NOT = 'Y' AND 'N'               12080003
120900            SET PS-ERROR                                          12090003
121000                DP020-MSG-FATAL                                   12100003
121100                DP030-SET-CURSOR-APPL-1 TO TRUE                   12110003
121200            MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER              12120003
121300            MOVE -1                    TO ARTVNRQL                12130003
121400            MOVE DP015-UNP-ALP-BRT-OFF TO ARTVNRQA                12140003
121500            MOVE DP015-RED             TO ARTVNRQC                12150003
121600            MOVE DP015-REVERSE         TO ARTVNRQH                12160003
121700        END-IF                                                    12170003
121800     END-IF.                                                      12180003
121900                                                                  12190003
122000                                                                  12200003
122100******************************************************************12210003
122200*   RTV RA REQUIRED INDICATOR MUST BE 'Y' OR 'N'                  12220003
122300******************************************************************12230003
122400     IF PS-DONT-EDIT-RTV                                          12240003
122500         CONTINUE                                                 12250003
122600     ELSE                                                         12260003
122700        IF ASC-RTV-RA-REQD-IND NOT = 'Y' AND 'N'                  12270003
122800            SET PS-ERROR                                          12280003
122900                DP020-MSG-FATAL                                   12290003
123000                DP030-SET-CURSOR-APPL-1 TO TRUE                   12300003
123100            MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER              12310003
123200            MOVE -1                    TO ARTVRQDL                12320003
123300            MOVE DP015-UNP-ALP-BRT-OFF TO ARTVRQDA                12330003
123400            MOVE DP015-RED             TO ARTVRQDC                12340003
123500            MOVE DP015-REVERSE         TO ARTVRQDH                12350003
123600        END-IF                                                    12360003
123700     END-IF.                                                      12370003
123800                                                                  12380003
123900                                                                  12390003
124000******************************************************************12400003
124100*   VENDOR AUTHORIZATION ID EDIT                                  12410003
124200******************************************************************12420003
124300     IF PS-DONT-EDIT-RTV                                          12430003
124400        CONTINUE                                                  12440003
124500     ELSE                                                         12450003
124600        IF (ASC-VND-AUTH-ID NOT = SPACES) AND                     12460003
124700           (ASC-RTV-RA-REQD-IND = 'Y')                            12470003
124800           PERFORM 3040-EDIT-VND-AUTH-ID                          12480003
124900           IF PS-INVALID-AUTH-ID                                  12490003
125000              SET PS-ERROR                                        12500003
125100                  DP020-MSG-FATAL                                 12510003
125200                  DP030-SET-CURSOR-APPL-1 TO TRUE                 12520003
125300              MOVE PC-TSYMSG-03104 TO DP020-MSG-NUMBER            12530003
125400              MOVE -1                    TO AAUTHIDL              12540003
125500              MOVE DP015-UNP-ALP-BRT-OFF TO AAUTHIDA              12550003
125600              MOVE DP015-RED             TO AAUTHIDC              12560003
125700              MOVE DP015-REVERSE         TO AAUTHIDH              12570003
125800           END-IF                                                 12580003
125900        END-IF                                                    12590003
126000     END-IF.                                                      12600003
126100                                                                  12610003
126200                                                                  12620003
126300******************************************************************12630003
126400*   VALIDATE FOB POINT                                            12640003
126500******************************************************************12650003
126600     IF ASC-FOB-POINT-TXT NOT = 'ORIGIN' AND 'DESTINATION' AND    12660003
126700                                'CONSOLIDATOR' AND SPACES         12670003
126800         SET PS-ERROR                                             12680003
126900             DP020-MSG-FATAL                                      12690003
127000             DP030-SET-CURSOR-APPL-1 TO TRUE                      12700003
127100         MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                 12710003
127200         MOVE -1                    TO AFOBPNTL                   12720003
127300         MOVE DP015-UNP-ALP-BRT-OFF TO AFOBPNTA                   12730003
127400         MOVE DP015-RED             TO AFOBPNTC                   12740003
127500         MOVE DP015-REVERSE         TO AFOBPNTH                   12750003
127600     END-IF.                                                      12760003
127700                                                                  12770003
127800******************************************************************12780003
127900*   CHARGE PERCENT (USED WITH LATE SHIPMENT PENALTY) FORMAT EDIT  12790003
128000******************************************************************12800003
128100     IF ACHGPCTL  > ZERO                                          12810003
128200         MOVE ASC-CHARGE-PCT     TO ASC-CHARGE-PCT-SAVE           12820003
128300       ELSE                                                       12830003
128400         MOVE ASC-CHARGE-PCT-N   TO ASC-CHARGE-PCT-ONE-N          12840003
128500         MOVE ASC-CHARGE-PCT-ONE TO ASC-CHARGE-PCT-SAVE           12850003
128600     END-IF.                                                      12860003
128700     IF  ASC-CHARGE-PCT-SAVE > SPACES                             12870003
128800         MOVE ASC-CHARGE-PCT-SAVE  TO DP010I-UNEDITED-FIELD       12880003
128900         MOVE 2                    TO DP010I-MAXIMUM-DIGITS       12890003
129000         MOVE 4                    TO DP010I-MAXIMUM-DECIMALS     12900003
129100         SET DP010I-NEGATIVE-NOT-ALLOWED                          12910003
129200                                   TO TRUE                        12920003
129310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12931004
129320                         USING DP010I-NUMERIC-EDIT-AREA           12932004
129400         IF  DP010I-ERROR-DETECTED                                12940003
129500             SET PS-ERROR                                         12950003
129600                 DP020-MSG-FATAL   TO TRUE                        12960003
129700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12970003
129800             MOVE DP015-UNP-ALP-BRT-OFF                           12980003
129900                                   TO ACHGPCTA                    12990003
130000             MOVE DP015-RED        TO ACHGPCTC                    13000003
130100             MOVE DP015-REVERSE    TO ACHGPCTH                    13010003
130200             MOVE -1               TO ACHGPCTL                    13020003
130300             SET DP030-SET-CURSOR-APPL-1                          13030003
130400                                   TO TRUE                        13040003
130500         ELSE                                                     13050003
130600             MOVE DP010I-NUMERIC-FIELD                            13060003
130700                                   TO ASC-CHARGE-PCT-N            13070003
130800             MOVE ASC-CHARGE-PCT-N TO ACHGPCTO                    13080003
130900             MOVE ACHGPCTO         TO ASC-CHARGE-PCT              13090003
131000         END-IF                                                   13100003
131100     ELSE                                                         13110003
131200         MOVE ZEROES               TO ASC-CHARGE-PCT-N            13120003
131300     END-IF.                                                      13130003
131400                                                                  13140003
131500***************************************************************   13150003
131600*   CHARGE PERCENT (USED WITH LATE SHIPMENT PENALTY) CHECKING     13160003
131700*   WHEN LATE SHIPMENT INDICATOR IS 'Y'                           13170003
131800***************************************************************   13180003
131900     IF ACHGPCTL = -1                                             13190003
132000        CONTINUE                                                  13200003
132100     ELSE                                                         13210003
132200        IF ASC-LATE-SHIPMENT-IND = 'Y'                            13220003
132300           IF ASC-CHARGE-PCT-N  > ZERO                            13230003
132400              CONTINUE                                            13240003
132500           ELSE                                                   13250003
132600              SET PS-ERROR              TO TRUE                   13260003
132700              SET DP020-MSG-FATAL       TO TRUE                   13270003
132800              MOVE PC-TSYMSG-03481      TO DP020-MSG-NUMBER       13280003
132900              MOVE DP015-UNP-ALP-BRT-OFF                          13290003
133000                                        TO ACHGPCTA               13300003
133100              MOVE DP015-RED            TO ACHGPCTC               13310003
133200              MOVE DP015-REVERSE        TO ACHGPCTH               13320003
133300              MOVE -1                   TO ACHGPCTL               13330003
133400              SET DP030-SET-CURSOR-APPL-1                         13340003
133500                                        TO TRUE                   13350003
133600           END-IF                                                 13360003
133700        END-IF                                                    13370003
133800     END-IF.                                                      13380003
133900                                                                  13390003
134000******************************************************************13400003
134100*   LATE SHIPMENT (PENALTY) INDICATOR MUST BE 'Y' OR 'N'          13410003
134200******************************************************************13420003
134300     IF ASC-LATE-SHIPMENT-IND  = 'Y' OR 'N'                       13430003
134400         CONTINUE                                                 13440003
134500     ELSE                                                         13450003
134600        SET PS-ERROR                                              13460003
134700            DP020-MSG-FATAL                                       13470003
134800            DP030-SET-CURSOR-APPL-1 TO TRUE                       13480003
134900        MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                  13490003
135000        MOVE -1                    TO ALTEINDL                    13500003
135100        MOVE DP015-UNP-ALP-BRT-OFF TO ALTEINDA                    13510003
135200        MOVE DP015-RED             TO ALTEINDC                    13520003
135300        MOVE DP015-REVERSE         TO ALTEINDH                    13530003
135400     END-IF.                                                      13540003
135500                                                                  13550003
135600                                                                  13560003
135700******************************************************************13570003
135800*   CHARGE FACTOR CODE MUST BE 'S' OR 'D' OR 'W'                  13580003
135900******************************************************************13590003
136000     IF ASC-CHARGE-FACTOR-CDE  = 'S' OR 'D' OR 'W' OR ' '         13600003
136100         CONTINUE                                                 13610003
136200     ELSE                                                         13620003
136300        SET PS-ERROR                                              13630003
136400            DP020-MSG-FATAL                                       13640003
136500            DP030-SET-CURSOR-APPL-1 TO TRUE                       13650003
136600        MOVE PC-TSYMSG-03480 TO DP020-MSG-NUMBER                  13660003
136700        MOVE -1                    TO ACHGCDEL                    13670003
136800        MOVE DP015-UNP-ALP-BRT-OFF TO ACHGCDEA                    13680003
136900        MOVE DP015-RED             TO ACHGCDEC                    13690003
137000        MOVE DP015-REVERSE         TO ACHGCDEH                    13700003
137100     END-IF.                                                      13710003
137200                                                                  13720003
137300***************************************************************   13730003
137400*   IF LATE SHIPMENT INDICATOR = 'Y' THEN CHARGE PERCENT CAN      13740003
137500*   NOT = ZERO                                                    13750003
137600***************************************************************   13760003
137700     IF  ASC-LATE-SHIPMENT-IND  = 'Y'                             13770003
137800         IF  ASC-CHARGE-PCT-N = ZEROS                             13780003
137900             SET PS-ERROR          TO TRUE                        13790003
138000             SET DP020-MSG-FATAL   TO TRUE                        13800003
138100             MOVE PC-TSYMSG-03482  TO DP020-MSG-NUMBER            13810003
138200             MOVE DP015-UNP-ALP-BRT-OFF                           13820003
138300                                   TO ACHGPCTA                    13830003
138400             MOVE DP015-RED        TO ACHGPCTC                    13840003
138500             MOVE DP015-REVERSE    TO ACHGPCTH                    13850003
138600             MOVE -1               TO ACHGPCTL                    13860003
138700             SET DP030-SET-CURSOR-APPL-1                          13870003
138800                                   TO TRUE                        13880003
138900         END-IF                                                   13890003
139000     END-IF.                                                      13900003
139100                                                                  13910003
139200***************************************************************   13920003
139300*   IF LATE SHIPMENT INDICATOR = 'N' THEN CHARGE PERCENT MUST     13930003
139400*   = ZERO                                                        13940003
139500***************************************************************   13950003
139600     IF ASC-LATE-SHIPMENT-IND = 'N'                               13960003
139700         IF ASC-CHARGE-PCT-N > ZEROES                             13970003
139800             SET PS-ERROR          TO TRUE                        13980003
139900             SET DP020-MSG-FATAL   TO TRUE                        13990003
140000             MOVE PC-TSYMSG-03483  TO DP020-MSG-NUMBER            14000003
140100             MOVE DP015-UNP-ALP-BRT-OFF                           14010003
140200                                   TO ACHGPCTA                    14020003
140300             MOVE DP015-RED        TO ACHGPCTC                    14030003
140400             MOVE DP015-REVERSE    TO ACHGPCTH                    14040003
140500             MOVE -1               TO ACHGPCTL                    14050003
140600             SET DP030-SET-CURSOR-APPL-1                          14060003
140700                                   TO TRUE                        14070003
140800         END-IF                                                   14080003
140900     END-IF.                                                      14090003
141000                                                                  14100003
141100***************************************************************   14110003
141200*   IF LATE SHIPMENT INDICATOR = 'Y' AND CHARGE PERCENT > ZERO    14120003
141300*   THEN CHARGE FACTOR IS REQUIRED AND MUST BE 'S', 'D' OR 'W'    14130003
141400***************************************************************   14140003
141500     IF (ASC-LATE-SHIPMENT-IND = 'Y') AND                         14150003
141600        (ASC-CHARGE-PCT-N > ZEROES)                               14160003
141700        IF ASC-CHARGE-FACTOR-CDE = 'S' OR 'D' OR 'W'              14170003
141800           CONTINUE                                               14180003
141900        ELSE                                                      14190003
142000           IF ASC-CHARGE-FACTOR-CDE = ' '                         14200003
142100              SET PS-ERROR          TO TRUE                       14210003
142200              SET DP020-MSG-FATAL   TO TRUE                       14220003
142300              MOVE PC-TSYMSG-03484  TO DP020-MSG-NUMBER           14230003
142400              MOVE DP015-UNP-ALP-BRT-OFF                          14240003
142500                                    TO ACHGCDEA                   14250003
142600              MOVE DP015-RED        TO ACHGCDEC                   14260003
142700              MOVE DP015-REVERSE    TO ACHGCDEH                   14270003
142800              MOVE -1               TO ACHGCDEL                   14280003
142900              SET DP030-SET-CURSOR-APPL-1                         14290003
143000                                    TO TRUE                       14300003
143100           ELSE                                                   14310003
143200              SET PS-ERROR          TO TRUE                       14320003
143300              SET DP020-MSG-FATAL   TO TRUE                       14330003
143400              MOVE PC-TSYMSG-03480  TO DP020-MSG-NUMBER           14340003
143500              MOVE DP015-UNP-ALP-BRT-OFF                          14350003
143600                                    TO ACHGCDEA                   14360003
143700              MOVE DP015-RED        TO ACHGCDEC                   14370003
143800              MOVE DP015-REVERSE    TO ACHGCDEH                   14380003
143900              MOVE -1               TO ACHGCDEL                   14390003
144000              SET DP030-SET-CURSOR-APPL-1                         14400003
144100                                    TO TRUE                       14410003
144200           END-IF                                                 14420003
144300        END-IF                                                    14430003
144400     END-IF.                                                      14440003
144500                                                                  14450003
144600***************************************************************   14460003
144700*   IF LATE SHIPMENT INDICATOR = 'N' AND CHARGE PERCENT = ZERO    14470003
144800*   THEN CHARGE FACTOR CAN ONLY BE SPACE                          14480003
144900***************************************************************   14490003
145000     IF (ASC-LATE-SHIPMENT-IND = 'N') AND                         14500003
145100        (ASC-CHARGE-PCT-N = ZEROES)                               14510003
145200        IF ASC-CHARGE-FACTOR-CDE = ' '                            14520003
145300           CONTINUE                                               14530003
145400        ELSE                                                      14540003
145500           SET PS-ERROR          TO TRUE                          14550003
145600           SET DP020-MSG-FATAL   TO TRUE                          14560003
145700           MOVE PC-TSYMSG-03485  TO DP020-MSG-NUMBER              14570003
145800           MOVE DP015-UNP-ALP-BRT-OFF                             14580003
145900                                 TO ACHGCDEA                      14590003
146000           MOVE DP015-RED        TO ACHGCDEC                      14600003
146100           MOVE DP015-REVERSE    TO ACHGCDEH                      14610003
146200           MOVE -1               TO ACHGCDEL                      14620003
146300           SET DP030-SET-CURSOR-APPL-1                            14630003
146400                                 TO TRUE                          14640003
146500        END-IF                                                    14650003
146600     END-IF.                                                      14660003
146700                                                                  14670003
146800******************************************************************14680003
146900*   FREIGHT TERMS ID CANNOT BE NEGATIVE IF IT IS ENTERED          14690003
147000******************************************************************14700003
147100     INSPECT ASC-FREIGHT-TERM-ID-N REPLACING LEADING ' ' BY ZERO. 14710003
147200     IF ASC-FREIGHT-TERM-ID-N < 0                                 14720003
147300         SET PS-ERROR                                             14730003
147400             DP020-MSG-FATAL                                      14740003
147500             DP030-SET-CURSOR-APPL-1 TO TRUE                      14750003
147600         MOVE PC-TSYMSG-02589 TO DP020-MSG-NUMBER                 14760003
147700         MOVE -1                    TO AFRTIDTL                   14770003
147800         MOVE DP015-UNP-ALP-BRT-OFF TO AFRTIDTA                   14780003
147900         MOVE DP015-RED             TO AFRTIDTC                   14790003
148000         MOVE DP015-REVERSE         TO AFRTIDTH                   14800003
148100     END-IF.                                                      14810003
148200                                                                  14820003
148300******************************************************************14830003
148400*   FREIGHT TERMS ID MUST EXIST ON TFRGTRM TO BE VALID IF IT      14840003
148500*   ENTERED                                                       14850003
148600******************************************************************14860003
148700     IF ASC-FREIGHT-TERM-ID-N > 0                                 14870003
148800        PERFORM 3020-VALIDATE-FRGT-TERM-ID                        14880003
148900     ELSE                                                         14890003
149000        IF ASC-FREIGHT-TERM-ID-N = 0                              14900003
149100           SET PS-ERROR                                           14910003
149200               DP020-MSG-FATAL                                    14920003
149300               DP030-SET-CURSOR-APPL-1 TO TRUE                    14930003
149400           MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER               14940003
149500           MOVE -1                    TO AFRTIDTL                 14950003
149600           MOVE DP015-UNP-ALP-BRT-OFF TO AFRTIDTA                 14960003
149700           MOVE DP015-RED             TO AFRTIDTC                 14970003
149800           MOVE DP015-REVERSE         TO AFRTIDTH                 14980003
149900           MOVE SPACE TO ASC-FRGT-PAYT-CDE                        14990003
150000           MOVE ZEROS TO ASC-KOHLS-FRGT-PCT-N                     15000003
150100                         ASC-VEND-FRGT-PCT-N                      15010003
150200           MOVE ASC-FRGT-PAYT-CDE        TO APAYFRGO              15020003
150300           MOVE ASC-KOHLS-FRGT-PCT-N     TO                       15030003
150400                    PV-EDIT-KOHLS-FRGHT-PCT                       15040003
150500           MOVE PV-EDIT-KOHLS-FRGHT-PCT  TO AKFRGHTO              15050003
150600           MOVE ASC-VEND-FRGT-PCT-N      TO                       15060003
150700                    PV-EDIT-VENDOR-FRGHT-PCT                      15070003
150800           MOVE PV-EDIT-VENDOR-FRGHT-PCT TO AVFRGHTO              15080003
150900        END-IF                                                    15090003
151000     END-IF.                                                      15100003
151100                                                                  15110003
151200******************************************************************15120003
151300*   PAYMENT TERMS IS A REQUIRED FIELD AND MUST BE NUMERIC         15130003
151400******************************************************************15140003
151500     INSPECT ASC-PAYT-TERM-ID REPLACING LEADING ' ' BY ZERO.      15150003
151600     IF ASC-PAYT-TERM-ID > 0                                      15160003
151700         MOVE ASC-PAYT-TERM-ID          TO DP010I-UNEDITED-FIELD  15170003
151800         MOVE LENGTH OF ASC-PAYT-TERM-ID TO DP010I-MAXIMUM-DIGITS 15180003
151900         MOVE ZERO                      TO DP010I-MAXIMUM-DECIMALS15190003
152000         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  15200003
152100                                                                  15210003
152210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15221004
152220                         USING DP010I-NUMERIC-EDIT-AREA           15222004
152300                                                                  15230003
152400         IF DP010I-ERROR-DETECTED                                 15240003
152500             SET PS-ERROR                                         15250003
152600                 DP020-MSG-FATAL                                  15260003
152700                 DP030-SET-CURSOR-APPL-1 TO TRUE                  15270003
152800             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             15280003
152900             MOVE -1                    TO APAYTRML               15290003
153000             MOVE DP015-UNP-ALP-BRT-OFF TO APAYTRMA               15300003
153100             MOVE DP015-RED             TO APAYTRMC               15310003
153200             MOVE DP015-REVERSE         TO APAYTRMH               15320003
153300         ELSE                                                     15330003
153400             PERFORM 3010-VALIDATE-PAYMENT-TERMS                  15340003
153500         END-IF                                                   15350003
153600     ELSE                                                         15360003
153700         SET PS-ERROR                                             15370003
153800             DP020-MSG-FATAL                                      15380003
153900             DP030-SET-CURSOR-APPL-1 TO TRUE                      15390003
154000         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                 15400003
154100         MOVE -1                    TO APAYTRML                   15410003
154200         MOVE DP015-UNP-ALP-BRT-OFF TO APAYTRMA                   15420003
154300         MOVE DP015-RED             TO APAYTRMC                   15430003
154400         MOVE DP015-REVERSE         TO APAYTRMH                   15440003
154500     END-IF.                                                      15450003
154600                                                                  15460003
154700 3010-VALIDATE-PAYMENT-TERMS.                                     15470003
154800                                                                  15480003
154900     MOVE DP010I-NUMERIC-FIELD TO ASC-PAYT-TERM-ID-N.             15490003
155000     MOVE ASC-PAYT-TERM-ID-N   TO PV-PAY-TERM-ID.                 15500003
155100                                                                  15510003
155200     PERFORM WITH TEST AFTER                                      15520003
155300             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                15530003
155400             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         15540003
155500                     SQLCODE = ZERO OR                            15550003
155600                     SQLCODE = +100                               15560003
155700                                                                  15570003
155800     EXEC SQL                                                     15580003
155900          SELECT PAY_TERM_ID                                      15590003
156000                ,DISCOUNT_DAYS_QTY                                15600003
156100                ,DISCOUNT_PCT                                     15610003
156200                ,DUE_DAY_QTY                                      15620003
156300                ,DUE_DAY_FR_DTE_TXT                               15630003
156400                ,OTHER_TXT                                        15640003
156500            INTO :PAYTRM-PAY-TERM-ID                              15650003
156600                ,:PAYTRM-DISCOUNT-DAYS-QTY                        15660003
156700                ,:PAYTRM-DISCOUNT-PCT                             15670003
156800                ,:PAYTRM-DUE-DAY-QTY                              15680003
156900                ,:PAYTRM-DUE-DAY-FR-DTE-TXT                       15690003
157000                ,:PAYTRM-OTHER-TXT                                15700003
157100            FROM TPAYTRM                                          15710003
157200           WHERE PAY_TERM_ID = :PV-PAY-TERM-ID                    15720003
157300     END-EXEC                                                     15730003
157400                                                                  15740003
157500     EVALUATE TRUE                                                15750003
157600         WHEN SQLCODE = ZERO                                      15760003
157700         WHEN SQLCODE = +100                                      15770003
157800         WHEN SQLCODE = -904                                      15780003
157900         WHEN SQLCODE = -913                                      15790003
158000              CONTINUE                                            15800003
158100                                                                  15810003
158200         WHEN SQLWARN0 NOT = SPACES                               15820003
158300         WHEN SQLCODE  NOT = ZERO                                 15830003
158400              MOVE '3010-VALIDATE-PAYMENT-TERMS' TO               15840003
158500                                                   DP013-PARAGRAPH15850003
158600              MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS' TO         15860003
158700                                            DP013-MESSAGE-TEXT (1)15870003
158800              MOVE SQLCA TO DP013-SQLCA                           15880003
158900              MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)         15890003
159000              SET DP013-DB2-ABEND                                 15900003
159100                  DP013-XCTL-DISPLAY-RESTART TO TRUE              15910003
159200                                                                  15920003
159300              PERFORM DP013-0000-PROCESS-ABEND                    15930003
159400     END-EVALUATE                                                 15940003
159500     END-PERFORM.                                                 15950003
159600                                                                  15960003
159700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         15970003
159800         MOVE '3010-VALIDATE-PAYMENT-TERMS' TO DP013-PARAGRAPH    15980003
159900         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAYMENT TERMS' TO   15990003
160000                                            DP013-MESSAGE-TEXT (1)16000003
160100         MOVE SQLCA      TO DP013-SQLCA                           16010003
160200         MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)              16020003
160300         SET DP013-DB2-ABEND                                      16030003
160400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16040003
160500                                                                  16050003
160600         PERFORM DP013-0000-PROCESS-ABEND                         16060003
160700     END-IF.                                                      16070003
160800                                                                  16080003
160900     IF SQLCODE = ZERO                                            16090003
161000         MOVE PAYTRM-PAY-TERM-ID  TO PV-EDIT-PAY-TERM-ID          16100003
161100         MOVE PV-EDIT-PAY-TERM-ID TO APAYTRMO                     16110003
161200         PERFORM 3015-FORMAT-PAYT-TERM-DESC                       16120003
161300         END-IF.                                                  16130003
161400                                                                  16140003
161500     MOVE ASC-PAYT-TERM-ID-DESC     TO APAYTXTO.                  16150003
161600                                                                  16160003
161700     IF SQLCODE = +100                                            16170003
161800         SET PS-ERROR                                             16180003
161900             DP020-MSG-FATAL                                      16190003
162000             DP030-SET-CURSOR-APPL-1 TO TRUE                      16200003
162100         MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                 16210003
162200         MOVE -1                    TO APAYTRML                   16220003
162300         MOVE DP015-UNP-ALP-BRT-OFF TO APAYTRMA                   16230003
162400         MOVE DP015-RED             TO APAYTRMC                   16240003
162500         MOVE DP015-REVERSE         TO APAYTRMH                   16250003
162600     END-IF.                                                      16260003
162700                                                                  16270003
162800 3015-FORMAT-PAYT-TERM-DESC.                                      16280003
162900                                                                  16290003
163000     COPY POPD001.                                                16300003
163100                                                                  16310003
163200 3020-VALIDATE-FRGT-TERM-ID.                                      16320003
163300                                                                  16330003
163400     INITIALIZE PV-DB2-COUNT.                                     16340003
163500     MOVE ASC-FREIGHT-TERM-ID-N TO PV-FREIGHT-TERM-ID.            16350003
163600                                                                  16360003
163700     PERFORM WITH TEST AFTER                                      16370003
163800             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                16380003
163900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         16390003
164000                     SQLCODE = ZERO OR                            16400003
164100                     SQLCODE = +100                               16410003
164200                                                                  16420003
164300     EXEC SQL                                                     16430003
164400          SELECT COUNT(*)                                         16440003
164500            INTO :PV-DB2-COUNT                                    16450003
164600            FROM TFRGTRM                                          16460003
164700           WHERE FRGT_TERM_ID = :PV-FREIGHT-TERM-ID               16470003
164800     END-EXEC                                                     16480003
164900                                                                  16490003
165000     EVALUATE TRUE                                                16500003
165100         WHEN SQLCODE = ZERO                                      16510003
165200         WHEN SQLCODE = +100                                      16520003
165300         WHEN SQLCODE = -904                                      16530003
165400         WHEN SQLCODE = -913                                      16540003
165500              CONTINUE                                            16550003
165600                                                                  16560003
165700         WHEN SQLWARN0 NOT = SPACES                               16570003
165800         WHEN SQLCODE  NOT = ZERO                                 16580003
165900              MOVE '3020-VALIDATE-FRGT-TERM-ID ' TO               16590003
166000                                                   DP013-PARAGRAPH16600003
166100              MOVE 'UNSUCCESSFUL SELECT FREIGHT TERMS' TO         16610003
166200                                            DP013-MESSAGE-TEXT (1)16620003
166300              MOVE SQLCA TO DP013-SQLCA                           16630003
166400              MOVE 'TFRGTRM ' TO DP013-DB2-TABLE-NAME (1)         16640003
166500              SET DP013-DB2-ABEND                                 16650003
166600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              16660003
166700                                                                  16670003
166800              PERFORM DP013-0000-PROCESS-ABEND                    16680003
166900     END-EVALUATE                                                 16690003
167000     END-PERFORM.                                                 16700003
167100                                                                  16710003
167200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16720003
167300         MOVE '3020-VALIDATE-FRGT-TERM-ID ' TO DP013-PARAGRAPH    16730003
167400         MOVE 'MAX RETRIES EXCEEDED ON SELECT FREIGHT TERMS' TO   16740003
167500                                            DP013-MESSAGE-TEXT (1)16750003
167600         MOVE SQLCA      TO DP013-SQLCA                           16760003
167700         MOVE 'TFRGTRM ' TO DP013-DB2-TABLE-NAME (1)              16770003
167800         SET DP013-DB2-ABEND                                      16780003
167900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16790003
168000                                                                  16800003
168100         PERFORM DP013-0000-PROCESS-ABEND                         16810003
168200     END-IF.                                                      16820003
168300                                                                  16830003
168400     IF PV-DB2-COUNT = ZERO                                       16840003
168500         SET PS-ERROR                                             16850003
168600             DP020-MSG-FATAL                                      16860003
168700             DP030-SET-CURSOR-APPL-1 TO TRUE                      16870003
168800         MOVE PC-TSYMSG-02590 TO DP020-MSG-NUMBER                 16880003
168900         MOVE -1                    TO AFRTIDTL                   16890003
169000         MOVE DP015-UNP-ALP-BRT-OFF TO AFRTIDTA                   16900003
169100         MOVE DP015-RED             TO AFRTIDTC                   16910003
169200         MOVE DP015-REVERSE         TO AFRTIDTH                   16920003
169300     ELSE                                                         16930003
169400         MOVE ASC-FREIGHT-TERM-ID     TO PV-EDIT-FREIGHT-TERM-ID  16940003
169500         MOVE PV-EDIT-FREIGHT-TERM-ID TO AFRTIDTO                 16950003
169600         PERFORM 3030-GET-FREIGHT-PCTS                            16960003
169700     END-IF.                                                      16970003
169800                                                                  16980003
169900 3030-GET-FREIGHT-PCTS.                                           16990003
170000                                                                  17000003
170100     PERFORM WITH TEST AFTER                                      17010003
170200             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                17020003
170300             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         17030003
170400                     SQLCODE = ZERO OR                            17040003
170500                     SQLCODE = +100                               17050003
170600                                                                  17060003
170700     EXEC SQL                                                     17070003
170800          SELECT KOHLS_FRGT_PCT                                   17080003
170900                ,VND_FRGT_PCT                                     17090003
171000            INTO :PV-KOHLS-FRGT-PCT                               17100003
171100                ,:PV-VND-FRGT-PCT                                 17110003
171200            FROM TFRGTRM                                          17120003
171300           WHERE FRGT_TERM_ID = :PV-FREIGHT-TERM-ID               17130003
171400     END-EXEC                                                     17140003
171500                                                                  17150003
171600     EVALUATE TRUE                                                17160003
171700         WHEN SQLCODE = ZERO                                      17170003
171800         WHEN SQLCODE = +100                                      17180003
171900         WHEN SQLCODE = -904                                      17190003
172000         WHEN SQLCODE = -913                                      17200003
172100              CONTINUE                                            17210003
172200                                                                  17220003
172300         WHEN SQLWARN0 NOT = SPACES                               17230003
172400         WHEN SQLCODE  NOT = ZERO                                 17240003
172500              MOVE '3030-GET-FREIGHT-PCTS      ' TO               17250003
172600                                                   DP013-PARAGRAPH17260003
172700              MOVE 'UNSUCCESSFUL SELECT FREIGHT TERMS' TO         17270003
172800                                            DP013-MESSAGE-TEXT (1)17280003
172900              MOVE SQLCA TO DP013-SQLCA                           17290003
173000              MOVE 'TFRGTRM ' TO DP013-DB2-TABLE-NAME (1)         17300003
173100              SET DP013-DB2-ABEND                                 17310003
173200                  DP013-XCTL-DISPLAY-RESTART TO TRUE              17320003
173300                                                                  17330003
173400              PERFORM DP013-0000-PROCESS-ABEND                    17340003
173500     END-EVALUATE                                                 17350003
173600     END-PERFORM.                                                 17360003
173700                                                                  17370003
173800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17380003
173900         MOVE '3030-GET-FREIGHT-PCTS      ' TO DP013-PARAGRAPH    17390003
174000         MOVE 'MAX RETRIES EXCEEDED ON SELECT FREIGHT TERMS' TO   17400003
174100                                            DP013-MESSAGE-TEXT (1)17410003
174200         MOVE SQLCA      TO DP013-SQLCA                           17420003
174300         MOVE 'TFRGTRM ' TO DP013-DB2-TABLE-NAME (1)              17430003
174400         SET DP013-DB2-ABEND                                      17440003
174500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   17450003
174600                                                                  17460003
174700         PERFORM DP013-0000-PROCESS-ABEND                         17470003
174800     END-IF.                                                      17480003
174900                                                                  17490003
175000     IF SQLCODE = ZERO                                            17500003
175100        PERFORM 3035-EDIT-FREIGHT-PCTS                            17510003
175200     END-IF.                                                      17520003
175300                                                                  17530003
175400     IF SQLCODE = +100                                            17540003
175500         MOVE SPACE TO ASC-FRGT-PAYT-CDE                          17550003
175600         MOVE ZEROS TO ASC-KOHLS-FRGT-PCT-N                       17560003
175700                       ASC-VEND-FRGT-PCT-N                        17570003
175800     END-IF.                                                      17580003
175900                                                                  17590003
176000     MOVE ASC-FRGT-PAYT-CDE        TO APAYFRGO.                   17600003
176100     MOVE ASC-KOHLS-FRGT-PCT-N     TO PV-EDIT-KOHLS-FRGHT-PCT.    17610003
176200     MOVE PV-EDIT-KOHLS-FRGHT-PCT  TO AKFRGHTO.                   17620003
176300     MOVE ASC-VEND-FRGT-PCT-N      TO PV-EDIT-VENDOR-FRGHT-PCT.   17630003
176400     MOVE PV-EDIT-VENDOR-FRGHT-PCT TO AVFRGHTO.                   17640003
176500                                                                  17650003
176600 3035-EDIT-FREIGHT-PCTS.                                          17660003
176700                                                                  17670003
176800     IF PV-KOHLS-FRGT-PCT = 1.0000                                17680003
176900        MOVE 'K'                   TO   ASC-FRGT-PAYT-CDE         17690003
177000        MOVE 100                   TO   ASC-KOHLS-FRGT-PCT-N      17700003
177100        MOVE ZERO                  TO   ASC-VEND-FRGT-PCT-N       17710003
177200     ELSE                                                         17720003
177300        IF PV-VND-FRGT-PCT = 1.0000                               17730003
177400           MOVE 'V'                TO   ASC-FRGT-PAYT-CDE         17740003
177500           MOVE ZERO               TO   ASC-KOHLS-FRGT-PCT-N      17750003
177600           MOVE 100                TO   ASC-VEND-FRGT-PCT-N       17760003
177700        ELSE                                                      17770003
177800           IF PV-KOHLS-FRGT-PCT > ZERO AND                        17780003
177900              PV-VND-FRGT-PCT   > ZERO                            17790003
178000              MOVE 'B'             TO   ASC-FRGT-PAYT-CDE         17800003
178100              MULTIPLY PV-KOHLS-FRGT-PCT BY +100 GIVING           17810003
178200                                        ASC-KOHLS-FRGT-PCT-N      17820003
178300              MULTIPLY PV-VND-FRGT-PCT BY +100 GIVING             17830003
178400                                        ASC-VEND-FRGT-PCT-N       17840003
178500           ELSE                                                   17850003
178600              IF PV-FREIGHT-TERM-ID = 0                           17860003
178700                 MOVE SPACE        TO   ASC-FRGT-PAYT-CDE         17870003
178800                 MOVE ZERO         TO   ASC-KOHLS-FRGT-PCT-N      17880003
178900                 MOVE ZERO         TO   ASC-VEND-FRGT-PCT-N       17890003
179000              END-IF                                              17900003
179100           END-IF                                                 17910003
179200        END-IF                                                    17920003
179300     END-IF.                                                      17930003
179400                                                                  17940003
179500******************************************************************17950003
179600*   EDIT THE VENDOR AUTHORIZATION ID.  IT CAN BE FREE-FORM, 10    17960003
179700*   POSITIONS LONG. SPECIAL CHARACTERS AND IMBEDDED SPACES ARE    17970003
179800*   NOT ALLOWED, ONLY A-Z AND 0-9 ARE USED. THE ONLY SPACES       17980003
179900*   ALLOWED ARE THOSE TRAILING AFTER ALL SIGNIFICANT POSITIONS.   17990003
180000******************************************************************18000003
180100 3040-EDIT-VND-AUTH-ID.                                           18010003
180200                                                                  18020003
180300     MOVE ZEROES TO PV-LASTPOS.                                   18030003
180400     MOVE SPACES TO PV-STRING.                                    18040003
180500     MOVE ASC-VND-AUTH-ID TO PV-STRING.                           18050003
180600     MOVE LENGTH OF PV-STRING TO PV-LASTPOS.                      18060003
180700                                                                  18070003
180800     PERFORM                                                      18080003
180900        UNTIL PV-STRING(PV-LASTPOS:1) > SPACES OR                 18090003
181000              PV-LASTPOS = +0                                     18100003
181100        COMPUTE PV-LASTPOS = PV-LASTPOS - 1                       18110003
181200     END-PERFORM.                                                 18120003
181300                                                                  18130003
181400     SET PS-VALID-AUTH-ID TO TRUE.                                18140003
181500     MOVE SPACES TO PV-AUTHID.                                    18150003
181600     MOVE ASC-VND-AUTH-ID TO PV-AUTHID.                           18160003
181700                                                                  18170003
181800     PERFORM 3050-CHECK-AUTH-ID                                   18180003
181900        VARYING AUTHID-INDX FROM 1 BY 1                           18190003
182000          UNTIL AUTHID-INDX > PV-LASTPOS                          18200003
182100             OR PS-INVALID-AUTH-ID.                               18210003
182200                                                                  18220003
182300 3050-CHECK-AUTH-ID.                                              18230003
182400                                                                  18240003
182500     MOVE PV-AUTHID-ONE(AUTHID-INDX) TO PC-VALID-CHARS.           18250003
182600                                                                  18260003
182700     IF NOT VALID-CHARS                                           18270003
182800        SET PS-INVALID-AUTH-ID TO TRUE                            18280003
182900     END-IF.                                                      18290003
183000                                                                  18300003
183100******************************************************************18310003
183200*   ERROR MESSAGE SET FOR ANYTHING IN THE AUTHORIZATION ID EXCEPT 18320003
183300*   WHEN RTV RA REQUIRED INDICATOR = 'Y'                          18330003
183400******************************************************************18340003
183500 3060-AUTH-ID-NOT-ALLOWED.                                        18350003
183600                                                                  18360003
183700     SET PS-ERROR                                                 18370003
183800         DP020-MSG-FATAL                                          18380003
183900         DP030-SET-CURSOR-APPL-1 TO TRUE.                         18390003
184000     MOVE PC-TSYMSG-03125 TO DP020-MSG-NUMBER.                    18400003
184100     MOVE -1                    TO AAUTHIDL.                      18410003
184200     MOVE DP015-UNP-ALP-BRT-OFF TO AAUTHIDA.                      18420003
184300     MOVE DP015-RED             TO AAUTHIDC.                      18430003
184400     MOVE DP015-REVERSE         TO AAUTHIDH.                      18440003
184500                                                                  18450003
184600                                                                  18460003
184700 3200-RESET-ATTRIBUTES.                                           18470003
184800                                                                  18480003
184900     MOVE DP015-UNP-NUM-NOR-OFF TO AFRTIDTA                       18490003
185000                                   APAYTRMA.                      18500003
185100                                                                  18510003
185200     MOVE DP015-UNP-ALP-NOR-OFF TO AFOBPNTA                       18520003
185300                                   ASHPPNTA                       18530003
185400                                   ARTVRQDA                       18540003
185500                                   ARTVNRQA                       18550003
185600                                   ADBTDSTA                       18560003
185700                                   AMRKOUTA                       18570003
185800                                   AAUTHIDA                       18580003
185900                                   ALTEINDA                       18590003
186000                                   ACHGPCTA                       18600003
186100                                   ACHGCDEA.                      18610003
186200     MOVE DP015-GREEN           TO APAYTRMC                       18620003
186300                                   AFRTIDTC                       18630003
186400                                   AFOBPNTC                       18640003
186500                                   ASHPPNTC                       18650003
186600                                   ARTVRQDC                       18660003
186700                                   ARTVNRQC                       18670003
186800                                   ADBTDSTC                       18680003
186900                                   AMRKOUTC                       18690003
187000                                   AAUTHIDC                       18700003
187100                                   ALTEINDC                       18710003
187200                                   ACHGPCTC                       18720003
187300                                   ACHGCDEC.                      18730003
187400     MOVE DP015-UNDERLINE       TO APAYTRMH                       18740003
187500                                   AFOBPNTH                       18750003
187600                                   AFRTIDTH                       18760003
187700                                   ASHPPNTH                       18770003
187800                                   ALTEINDH                       18780003
187900                                   ACHGPCTH                       18790003
188000                                   ACHGCDEH.                      18800003
188100     IF PS-HAS-RTV-SEC                                            18810003
188200         MOVE DP015-UNDERLINE  TO  ARTVRQDH                       18820003
188300                                   ARTVNRQH                       18830003
188400                                   ADBTDSTH                       18840003
188500                                   AMRKOUTH                       18850003
188600                                   AAUTHIDH                       18860003
188700     END-IF.                                                      18870003
188800     IF PS-NO-RTV-SEC                                             18880003
188900         MOVE DP015-ASK-NOR-OFF     TO ARTVRQDA                   18890003
189000                                       ARTVNRQA                   18900003
189100                                       ADBTDSTA                   18910003
189200                                       AMRKOUTA                   18920003
189300                                       AAUTHIDA                   18930003
189400         MOVE DP015-BLUE            TO ARTVRQDC                   18940003
189500                                       ARTVNRQC                   18950003
189600                                       ADBTDSTC                   18960003
189700                                       AMRKOUTC                   18970003
189800                                       AAUTHIDC                   18980003
189900         MOVE DP015-HL-OFF          TO ARTVRQDH                   18990003
190000                                       ARTVNRQH                   19000003
190100                                       ADBTDSTH                   19010003
190200                                       AMRKOUTH                   19020003
190300                                       AAUTHIDH                   19030003
190400      END-IF.                                                     19040003
190500******************************************************************19050003
190600*    SAVE SCREEN FIELDS FOR LATER COMPARISON                      19060003
190700******************************************************************19070003
190800 3500-SAVE-SCREEN-FIELDS.                                         19080003
190900                                                                  19090003
191000     MOVE ASC-PAYT-TERM-ID         TO ASC-PAYT-TERM-ID-O.         19100003
191100     MOVE ASC-FREIGHT-TERM-ID      TO ASC-FREIGHT-TERM-ID-O.      19110003
191200     MOVE ASC-FOB-POINT-TXT        TO ASC-FOB-POINT-TXT-O.        19120003
191300     MOVE ASC-SHIPT-POINT-TXT      TO ASC-SHIPT-POINT-TXT-O.      19130003
191400     MOVE ASC-RTV-RA-REQD-IND      TO ASC-RTV-RA-REQD-IND-O.      19140003
191500     MOVE ASC-RTV-NO-RA-REQD-IND   TO ASC-RTV-NO-RA-REQD-IND-O.   19150003
191600     MOVE ASC-DEBIT-DESTROY-IND    TO ASC-DEBIT-DESTROY-IND-O.    19160003
191700     MOVE ASC-MARKOUT-IND          TO ASC-MARKOUT-IND-O.          19170003
191800     MOVE ASC-VND-AUTH-ID          TO ASC-VND-AUTH-ID-O.          19180003
191900     MOVE ASC-LATE-SHIPMENT-IND    TO ASC-LATE-SHIPMENT-IND-O.    19190003
192000     MOVE ASC-CHARGE-FACTOR-CDE    TO ASC-CHARGE-FACTOR-CDE-O.    19200003
192100                                                                  19210003
192200     IF ASC-CHARGE-PCT = SPACES                                   19220003
192300         MOVE ' 0.0000'       TO ASC-CHARGE-PCT-O                 19230003
192400                                 ASC-CHARGE-PCT-SAVE              19240003
192500       ELSE                                                       19250003
192600         MOVE ASC-CHARGE-PCT  TO ASC-CHARGE-PCT-O                 19260003
192700                                 ASC-CHARGE-PCT-SAVE              19270003
192800     END-IF.                                                      19280003
192900     MOVE ASC-CHARGE-PCT-SAVE TO ASC-CHARGE-PCT.                  19290003
193000                                                                  19300003
193100 3600-COMPARE-SCREEN-FIELDS.                                      19310003
193200                                                                  19320003
193300     SET PS-NO-FIELDS-CHANGED TO TRUE.                            19330003
193400                                                                  19340003
193500     IF ASC-PAYT-TERM-ID         NOT = ASC-PAYT-TERM-ID-O       OR19350003
193600        ASC-FREIGHT-TERM-ID      NOT = ASC-FREIGHT-TERM-ID-O    OR19360003
193700        ASC-FOB-POINT-TXT        NOT = ASC-FOB-POINT-TXT-O      OR19370003
193800        ASC-SHIPT-POINT-TXT      NOT = ASC-SHIPT-POINT-TXT-O    OR19380003
193900        ASC-RTV-RA-REQD-IND      NOT = ASC-RTV-RA-REQD-IND-O    OR19390003
194000        ASC-RTV-NO-RA-REQD-IND   NOT = ASC-RTV-NO-RA-REQD-IND-O OR19400003
194100        ASC-DEBIT-DESTROY-IND    NOT = ASC-DEBIT-DESTROY-IND-O  OR19410003
194200        ASC-MARKOUT-IND          NOT = ASC-MARKOUT-IND-O        OR19420003
194300        ASC-VND-AUTH-ID          NOT = ASC-VND-AUTH-ID-O        OR19430003
194400        ASC-LATE-SHIPMENT-IND    NOT = ASC-LATE-SHIPMENT-IND-O  OR19440003
194500        ASC-CHARGE-FACTOR-CDE    NOT = ASC-CHARGE-FACTOR-CDE-O  OR19450003
194600        ASC-CHARGE-PCT           NOT = ASC-CHARGE-PCT-O           19460003
194700        SET PS-FIELDS-CHANGED TO TRUE                             19470003
194800     END-IF.                                                      19480003
194900                                                                  19490003
195000     SET PS-NO-RMS-FIELDS-CHANGED TO TRUE.                        19500003
195100                                                                  19510003
195200     IF ASC-PAYT-TERM-ID         NOT = ASC-PAYT-TERM-ID-O       OR19520003
195300        ASC-FREIGHT-TERM-ID      NOT = ASC-FREIGHT-TERM-ID-O      19530003
195400         SET PS-RMS-FIELDS-CHANGED TO TRUE                        19540003
195500     END-IF.                                                      19550003
195600                                                                  19560003
195700 4000-BUILD-INITIAL-PANEL.                                        19570003
195800                                                                  19580003
195900     INITIALIZE ASC-SCREEN-FIELDS.                                19590003
196000                                                                  19600003
196100     SET PS-NO-ERROR                                              19610003
196200         DP030-SET-CURSOR-APPL-1 TO TRUE.                         19620003
196300     MOVE -1 TO APAYTRML.                                         19630003
196400                                                                  19640003
196500     PERFORM 2300-CHECK-RACF-ACCESS.                              19650003
196600                                                                  19660003
196700     PERFORM 4010-GET-HEADING-INFO.                               19670003
196800                                                                  19680003
196900     PERFORM 4020-GET-PAY-TERM-ID.                                19690003
197000                                                                  19700003
197100     PERFORM 4030-GET-PAYMENT-TERMS.                              19710003
197200                                                                  19720003
197300     PERFORM 4040-GET-SHIPPING-TERMS.                             19730003
197400                                                                  19740003
197500     PERFORM 4050-GET-PURCHASE-TERMS.                             19750003
197600                                                                  19760003
197700     IF PS-NO-ERROR                                               19770003
197800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    19780003
197900                                                                  19790003
198000 4010-GET-HEADING-INFO.                                           19800003
198100                                                                  19810003
198200     PERFORM WITH TEST AFTER                                      19820003
198300             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                19830003
198400             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         19840003
198500                     SQLCODE = ZERO OR                            19850003
198600                     SQLCODE = +100                               19860003
198700                                                                  19870003
198800     EXEC SQL                                                     19880003
198900          SELECT A.INHOUSE_NBR                                    19890003
199000                ,B.ENT_NAME_DESC                                  19900003
199100                ,C.DUN_NBR                                        19910003
199200                ,C.STATUS_CDE                                     19920003
199300                ,C.EDI_PO_PREPK_CDE                               19930003
199400                ,C.PRIM_TYP_CDE                                   19940003
199500                ,C.VND_IN_RMS_IND                                 19950003
199600            INTO :VNDDPT-INHOUSE-NBR                              19960003
199700                ,:ENTNME-ENT-NAME-DESC                            19970003
199800                ,:EXTENT-DUN-NBR                                  19980003
199900                 :NI-EXTENT-DUN-NBR                               19990003
200000                ,:EXTENT-STATUS-CDE                               20000003
200100                ,:EXTENT-EDI-PO-PREPK-CDE                         20010003
200200                ,:EXTENT-PRIM-TYP-CDE                             20020003
200300                ,:EXTENT-VND-IN-RMS-IND                           20030003
200400            FROM TVNDDPT A, TENTNME B, TEXTENT C                  20040003
200500           WHERE A.ENT_ID   = :ASC-ENT-ID                         20050003
200600             AND A.DEPT_NBR = :ASC-DEPARTMENT                     20060003
200700             AND A.ENT_ID   = B.ENT_ID                            20070003
200800             AND B.SEQ_NBR  =                                     20080003
200900                 (SELECT MAX(SEQ_NBR)                             20090003
201000                    FROM TENTNME                                  20100003
201100                   WHERE ENT_ID   = :ASC-ENT-ID                   20110003
201200                     AND TYPE_CDE = :PC-PRIMARY)                  20120003
201300             AND B.TYPE_CDE = :PC-PRIMARY                         20130003
201400             AND A.ENT_ID   = C.ENT_ID                            20140003
201500     END-EXEC                                                     20150003
201600                                                                  20160003
201700     EVALUATE TRUE                                                20170003
201800         WHEN SQLCODE = ZERO                                      20180003
201900         WHEN SQLCODE = -904                                      20190003
202000         WHEN SQLCODE = -913                                      20200003
202100              CONTINUE                                            20210003
202200                                                                  20220003
202300         WHEN SQLWARN0 NOT = SPACES                               20230003
202400         WHEN SQLCODE  NOT = ZERO                                 20240003
202500              MOVE '4010-GET-HEADING-INFO' TO                     20250003
202600                                      DP013-PARAGRAPH             20260003
202700              MOVE 'UNSUCCESSFUL SELECT HEADING INFO'             20270003
202800                            TO DP013-MESSAGE-TEXT (1)             20280003
202900              MOVE SQLCA TO DP013-SQLCA                           20290003
203000              MOVE 'TVNDDPT ' TO                                  20300003
203100                             DP013-DB2-TABLE-NAME (1)             20310003
203200              MOVE 'TENTNME ' TO                                  20320003
203300                             DP013-DB2-TABLE-NAME (2)             20330003
203400              MOVE 'TEXTENT ' TO                                  20340003
203500                             DP013-DB2-TABLE-NAME (3)             20350003
203600              SET DP013-DB2-ABEND                                 20360003
203700                  DP013-XCTL-DISPLAY-RESTART TO TRUE              20370003
203800                                                                  20380003
203900              PERFORM DP013-0000-PROCESS-ABEND                    20390003
204000     END-EVALUATE                                                 20400003
204100     END-PERFORM.                                                 20410003
204200                                                                  20420003
204300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         20430003
204400         MOVE '4010-GET-HEADING-INFO' TO DP013-PARAGRAPH          20440003
204500         MOVE 'MAX RETRIES EXCEEDED ON SELECT HEADING INFO' TO    20450003
204600                                            DP013-MESSAGE-TEXT (1)20460003
204700         MOVE SQLCA      TO DP013-SQLCA                           20470003
204800         MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)              20480003
204900         MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)              20490003
205000         SET DP013-DB2-ABEND                                      20500003
205100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20510003
205200                                                                  20520003
205300         PERFORM DP013-0000-PROCESS-ABEND                         20530003
205400     END-IF.                                                      20540003
205500                                                                  20550003
205600     IF SQLCODE = ZERO                                            20560003
205700         MOVE VNDDPT-INHOUSE-NBR   TO ASC-INHOUSE-NBR             20570003
205800         MOVE ENTNME-ENT-NAME-DESC TO ASC-ENT-NAME-DESC           20580003
205900         IF NI-EXTENT-DUN-NBR = -1                                20590003
206000             MOVE SPACES           TO ASC-DUN-NBR                 20600003
206100         ELSE                                                     20610003
206200             MOVE EXTENT-DUN-NBR   TO ASC-DUN-NBR                 20620003
206300         END-IF                                                   20630003
206400         MOVE EXTENT-STATUS-CDE    TO ASC-STATUS-CDE              20640003
206500         MOVE EXTENT-EDI-PO-PREPK-CDE  TO ASC-PO-PREPK-CDE        20650003
206600         MOVE EXTENT-PRIM-TYP-CDE  TO ASC-PRIM-TYP-CDE            20660003
206700         MOVE EXTENT-VND-IN-RMS-IND                               20670003
206800                                   TO ASC-VND-IN-RMS-IND          20680003
206900     END-IF.                                                      20690003
207000                                                                  20700003
207100 4020-GET-PAY-TERM-ID.                                            20710003
207200                                                                  20720003
207300     PERFORM WITH TEST AFTER                                      20730003
207400             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                20740003
207500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         20750003
207600                     SQLCODE = ZERO OR                            20760003
207700                     SQLCODE = +100                               20770003
207800                                                                  20780003
207900     EXEC SQL                                                     20790003
208000          SELECT PAYT_TERM_ID                                     20800003
208100            INTO :VNDAGR-PAYT-TERM-ID                             20810003
208200                 :NI-VNDAGR-PAYT-TERM-ID                          20820003
208300            FROM TVNDAGR                                          20830003
208400           WHERE ENT_ID            = :ASC-ENT-ID                  20840003
208500             AND DEPT_NBR          = :ASC-DEPARTMENT              20850003
208600             AND AGRMT_TYP_ID      = :PC-PAYMENT                  20860003
208700             AND SEQ_NBR           =                              20870003
208800                 (SELECT MAX(SEQ_NBR)                             20880003
208900                    FROM TVNDAGR                                  20890003
209000                   WHERE ENT_ID            = :ASC-ENT-ID          20900003
209100                     AND DEPT_NBR          = :ASC-DEPARTMENT      20910003
209200                     AND AGRMT_TYP_ID      = :PC-PAYMENT)         20920003
209300     END-EXEC                                                     20930003
209400                                                                  20940003
209500     EVALUATE TRUE                                                20950003
209600         WHEN SQLCODE = ZERO                                      20960003
209700         WHEN SQLCODE = +100                                      20970003
209800         WHEN SQLCODE = -904                                      20980003
209900         WHEN SQLCODE = -913                                      20990003
210000              CONTINUE                                            21000003
210100                                                                  21010003
210200         WHEN SQLWARN0 NOT = SPACES                               21020003
210300         WHEN SQLCODE  NOT = ZERO                                 21030003
210400              MOVE '4020-GET-PAY-TERM-ID' TO DP013-PARAGRAPH      21040003
210500              MOVE 'UNSUCCESSFUL SELECT PAY TERM ID' TO           21050003
210600                                            DP013-MESSAGE-TEXT (1)21060003
210700              MOVE SQLCA TO DP013-SQLCA                           21070003
210800              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         21080003
210900              SET DP013-DB2-ABEND                                 21090003
211000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              21100003
211100                                                                  21110003
211200              PERFORM DP013-0000-PROCESS-ABEND                    21120003
211300     END-EVALUATE                                                 21130003
211400     END-PERFORM.                                                 21140003
211500                                                                  21150003
211600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21160003
211700         MOVE '4020-GET-PAY-TERM-ID' TO DP013-PARAGRAPH           21170003
211800         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAY TERM ID' TO     21180003
211900                                            DP013-MESSAGE-TEXT (1)21190003
212000         MOVE SQLCA      TO DP013-SQLCA                           21200003
212100         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              21210003
212200         SET DP013-DB2-ABEND                                      21220003
212300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   21230003
212400                                                                  21240003
212500         PERFORM DP013-0000-PROCESS-ABEND                         21250003
212600     END-IF.                                                      21260003
212700                                                                  21270003
212800     IF SQLCODE = ZERO                                            21280003
212900        IF NI-VNDAGR-PAYT-TERM-ID = -1                            21290003
213000            MOVE ZERO               TO ASC-PAYT-TERM-ID-N         21300003
213100        ELSE                                                      21310003
213200            MOVE VNDAGR-PAYT-TERM-ID TO ASC-PAYT-TERM-ID-N        21320003
213300        END-IF                                                    21330003
213400     END-IF.                                                      21340003
213500                                                                  21350003
213600 4030-GET-PAYMENT-TERMS.                                          21360003
213700                                                                  21370003
213800     MOVE ASC-PAYT-TERM-ID-N TO PV-PAY-TERM-ID.                   21380003
213900                                                                  21390003
214000     PERFORM WITH TEST AFTER                                      21400003
214100             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                21410003
214200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         21420003
214300                     SQLCODE = ZERO OR                            21430003
214400                     SQLCODE = +100                               21440003
214500                                                                  21450003
214600     EXEC SQL                                                     21460003
214700          SELECT DISCOUNT_DAYS_QTY                                21470003
214800                ,DISCOUNT_PCT                                     21480003
214900                ,DUE_DAY_QTY                                      21490003
215000                ,DUE_DAY_FR_DTE_TXT                               21500003
215100                ,OTHER_TXT                                        21510003
215200            INTO :PAYTRM-DISCOUNT-DAYS-QTY                        21520003
215300                ,:PAYTRM-DISCOUNT-PCT                             21530003
215400                ,:PAYTRM-DUE-DAY-QTY                              21540003
215500                ,:PAYTRM-DUE-DAY-FR-DTE-TXT                       21550003
215600                ,:PAYTRM-OTHER-TXT                                21560003
215700            FROM TPAYTRM                                          21570003
215800           WHERE PAY_TERM_ID = :PV-PAY-TERM-ID                    21580003
215900     END-EXEC                                                     21590003
216000                                                                  21600003
216100     EVALUATE TRUE                                                21610003
216200         WHEN SQLCODE = ZERO                                      21620003
216300         WHEN SQLCODE = +100                                      21630003
216400         WHEN SQLCODE = -904                                      21640003
216500         WHEN SQLCODE = -913                                      21650003
216600              CONTINUE                                            21660003
216700                                                                  21670003
216800         WHEN SQLWARN0 NOT = SPACES                               21680003
216900         WHEN SQLCODE  NOT = ZERO                                 21690003
217000              MOVE '4030-GET-PAYMENT-TERMS' TO DP013-PARAGRAPH    21700003
217100              MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS' TO         21710003
217200                                            DP013-MESSAGE-TEXT (1)21720003
217300              MOVE SQLCA TO DP013-SQLCA                           21730003
217400              MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)         21740003
217500              SET DP013-DB2-ABEND                                 21750003
217600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              21760003
217700                                                                  21770003
217800              PERFORM DP013-0000-PROCESS-ABEND                    21780003
217900     END-EVALUATE                                                 21790003
218000     END-PERFORM.                                                 21800003
218100                                                                  21810003
218200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21820003
218300         MOVE '4030-GET-PAYMENT-TERMS' TO DP013-PARAGRAPH         21830003
218400         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAYMENT TERMS' TO   21840003
218500                                            DP013-MESSAGE-TEXT (1)21850003
218600         MOVE SQLCA      TO DP013-SQLCA                           21860003
218700         MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)              21870003
218800         SET DP013-DB2-ABEND                                      21880003
218900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   21890003
219000                                                                  21900003
219100         PERFORM DP013-0000-PROCESS-ABEND                         21910003
219200     END-IF.                                                      21920003
219300                                                                  21930003
219400     IF SQLCODE = ZERO                                            21940003
219500         PERFORM 4035-FORMAT-PAYT-TERM-DESC                       21950003
219600     END-IF.                                                      21960003
219700     IF SQLCODE = +100                                            21970003
219800         MOVE SPACES TO ASC-PAYT-TERM-ID-DESC                     21980003
219900     END-IF.                                                      21990003
220000                                                                  22000003
220100 4035-FORMAT-PAYT-TERM-DESC.                                      22010003
220200                                                                  22020003
220300     COPY POPD001.                                                22030003
220400                                                                  22040003
220500 4040-GET-SHIPPING-TERMS.                                         22050003
220600                                                                  22060003
220700     PERFORM WITH TEST AFTER                                      22070003
220800             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                22080003
220900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         22090003
221000                     SQLCODE = ZERO OR                            22100003
221100                     SQLCODE = +100                               22110003
221200                                                                  22120003
221300     EXEC SQL                                                     22130003
221400          SELECT VT1.FOB_POINT_TXT                                22140003
221500                ,VT1.SHIPT_POINT_TXT                              22150003
221600                ,VT1.LATE_SHIPT_IND                               22160003
221700                ,VT1.CHRG_PCT                                     22170003
221800                ,VT1.CHRG_FCTR_CDE                                22180003
221900                ,COALESCE(B.FRGT_TERM_ID,0)                       22190003
222000                ,COALESCE(B.KOHLS_FRGT_PCT,0)                     22200003
222100                ,COALESCE(B.VND_FRGT_PCT,0)                       22210003
222200            INTO :VNDAGR-FOB-POINT-TXT                            22220003
222300                 :NI-VNDAGR-FOB-POINT-TXT                         22230003
222400                ,:VNDAGR-SHIPT-POINT-TXT                          22240003
222500                 :NI-VNDAGR-SHIPT-POINT-TXT                       22250003
222600                ,:VNDAGR-LATE-SHIPT-IND                           22260003
222700                 :NI-VNDAGR-LATE-SHIPT-IND                        22270003
222800                ,:VNDAGR-CHRG-PCT                                 22280003
222900                 :NI-VNDAGR-CHRG-PCT                              22290003
223000                ,:VNDAGR-CHRG-FCTR-CDE                            22300003
223100                 :NI-VNDAGR-CHRG-FCTR-CDE                         22310003
223200                ,:FRGTRM-FRGT-TERM-ID                             22320003
223300                ,:FRGTRM-KOHLS-FRGT-PCT                           22330003
223400                ,:FRGTRM-VND-FRGT-PCT                             22340003
223500          FROM                                                    22350003
223600                 (SELECT A.FOB_POINT_TXT                          22360003
223700                        ,A.SHIPT_POINT_TXT                        22370003
223800                        ,A.LATE_SHIPT_IND                         22380003
223900                        ,A.CHRG_PCT                               22390003
224000                        ,A.CHRG_FCTR_CDE                          22400003
224100                        ,A.FRGT_TERM_ID                           22410003
224200                  FROM TVNDAGR A                                  22420003
224300                 WHERE ENT_ID            = :ASC-ENT-ID            22430003
224400                   AND DEPT_NBR          = :ASC-DEPARTMENT        22440003
224500                   AND AGRMT_TYP_ID      = :PC-SHIPPING           22450003
224600                   AND SEQ_NBR           =                        22460003
224700                       (SELECT MAX(SEQ_NBR)                       22470003
224800                          FROM TVNDAGR                            22480003
224900                         WHERE ENT_ID          = :ASC-ENT-ID      22490003
225000                           AND DEPT_NBR        = :ASC-DEPARTMENT  22500003
225100                           AND AGRMT_TYP_ID    = :PC-SHIPPING))   22510003
225200                             AS VT1                               22520003
225300          LEFT OUTER JOIN TFRGTRM B                               22530003
225400               ON B.FRGT_TERM_ID = VT1.FRGT_TERM_ID               22540003
225500     END-EXEC                                                     22550003
225600                                                                  22560003
225700     EVALUATE TRUE                                                22570003
225800         WHEN SQLCODE = ZERO                                      22580003
225900         WHEN SQLCODE = +100                                      22590003
226000         WHEN SQLCODE = -904                                      22600003
226100         WHEN SQLCODE = -913                                      22610003
226200              CONTINUE                                            22620003
226300                                                                  22630003
226400         WHEN SQLWARN0 NOT = SPACES                               22640003
226500         WHEN SQLCODE  NOT = ZERO                                 22650003
226600              MOVE '4040-GET-SHIPPING-TERMS' TO DP013-PARAGRAPH   22660003
226700              MOVE 'UNSUCCESSFUL SELECT SHIPPING TERMS' TO        22670003
226800                                            DP013-MESSAGE-TEXT (1)22680003
226900              MOVE SQLCA TO DP013-SQLCA                           22690003
227000              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         22700003
227100              SET DP013-DB2-ABEND                                 22710003
227200                  DP013-XCTL-DISPLAY-RESTART TO TRUE              22720003
227300                                                                  22730003
227400              PERFORM DP013-0000-PROCESS-ABEND                    22740003
227500     END-EVALUATE                                                 22750003
227600     END-PERFORM.                                                 22760003
227700                                                                  22770003
227800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         22780003
227900         MOVE '4040-GET-SHIPPING-TERMS' TO DP013-PARAGRAPH        22790003
228000         MOVE 'MAX RETRIES EXCEEDED ON SELECT SHIPT TERMS' TO     22800003
228100                                            DP013-MESSAGE-TEXT (1)22810003
228200         MOVE SQLCA      TO DP013-SQLCA                           22820003
228300         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              22830003
228400         SET DP013-DB2-ABEND                                      22840003
228500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   22850003
228600                                                                  22860003
228700         PERFORM DP013-0000-PROCESS-ABEND                         22870003
228800     END-IF.                                                      22880003
228900                                                                  22890003
229000     IF SQLCODE = ZERO                                            22900003
229100        PERFORM 4045-EDIT-SHIPPING-TERMS                          22910003
229200     END-IF.                                                      22920003
229300                                                                  22930003
229400     IF SQLCODE = +100                                            22940003
229500         MOVE SPACE TO ASC-FOB-POINT-TXT                          22950003
229600                       ASC-SHIPT-POINT-TXT                        22960003
229700                       ASC-FRGT-PAYT-CDE                          22970003
229800         MOVE ZEROS TO ASC-KOHLS-FRGT-PCT-N                       22980003
229900                       ASC-VEND-FRGT-PCT-N                        22990003
230000                       ASC-FREIGHT-TERM-ID-N                      23000003
230100         MOVE 'N'   TO ASC-LATE-SHIPMENT-IND                      23010003
230200     END-IF.                                                      23020003
230300                                                                  23030003
230400 4045-EDIT-SHIPPING-TERMS.                                        23040003
230500                                                                  23050003
230600     IF NI-VNDAGR-FOB-POINT-TXT = -1                              23060003
230700         MOVE SPACES               TO ASC-FOB-POINT-TXT           23070003
230800     ELSE                                                         23080003
230900         MOVE VNDAGR-FOB-POINT-TXT TO ASC-FOB-POINT-TXT           23090003
231000     END-IF.                                                      23100003
231100                                                                  23110003
231200     IF NI-VNDAGR-SHIPT-POINT-TXT = -1                            23120003
231300         MOVE SPACES                 TO ASC-SHIPT-POINT-TXT       23130003
231400     ELSE                                                         23140003
231500         MOVE VNDAGR-SHIPT-POINT-TXT TO ASC-SHIPT-POINT-TXT       23150003
231600     END-IF.                                                      23160003
231700                                                                  23170003
231800     MOVE FRGTRM-FRGT-TERM-ID   TO   ASC-FREIGHT-TERM-ID-N.       23180003
231900                                                                  23190003
232000     IF NI-VNDAGR-CHRG-FCTR-CDE = -1                              23200003
232100         MOVE SPACES               TO ASC-CHARGE-FACTOR-CDE       23210003
232200     ELSE                                                         23220003
232300         MOVE VNDAGR-CHRG-FCTR-CDE TO ASC-CHARGE-FACTOR-CDE       23230003
232400     END-IF.                                                      23240003
232500                                                                  23250003
232600     IF NI-VNDAGR-LATE-SHIPT-IND = -1                             23260003
232700         MOVE 'N'                   TO ASC-LATE-SHIPMENT-IND      23270003
232800     ELSE                                                         23280003
232900         MOVE VNDAGR-LATE-SHIPT-IND TO ASC-LATE-SHIPMENT-IND      23290003
233000     END-IF.                                                      23300003
233100                                                                  23310003
233200     IF  NI-VNDAGR-CHRG-PCT = -1                                  23320003
233300         MOVE ZERO  TO ASC-CHARGE-PCT-N                           23330003
233400     ELSE                                                         23340003
233500         COMPUTE ASC-CHARGE-PCT-N =                               23350003
233600                 VNDAGR-CHRG-PCT * 100                            23360003
233700         MOVE ASC-CHARGE-PCT-N TO PV-PCT-FORMAT                   23370003
233800         MOVE PV-PCT-FORMAT TO ASC-CHARGE-PCT                     23380003
233900     END-IF.                                                      23390003
234000                                                                  23400003
234100     IF FRGTRM-KOHLS-FRGT-PCT = 1.0000                            23410003
234200        MOVE 'K'                   TO   ASC-FRGT-PAYT-CDE         23420003
234300        MOVE 100                   TO   ASC-KOHLS-FRGT-PCT-N      23430003
234400        MOVE ZERO                  TO   ASC-VEND-FRGT-PCT-N       23440003
234500     ELSE                                                         23450003
234600        IF FRGTRM-VND-FRGT-PCT = 1.0000                           23460003
234700           MOVE 'V'                TO   ASC-FRGT-PAYT-CDE         23470003
234800           MOVE ZERO               TO   ASC-KOHLS-FRGT-PCT-N      23480003
234900           MOVE 100                TO   ASC-VEND-FRGT-PCT-N       23490003
235000        ELSE                                                      23500003
235100           IF FRGTRM-KOHLS-FRGT-PCT > ZERO AND                    23510003
235200              FRGTRM-VND-FRGT-PCT   > ZERO                        23520003
235300              MOVE 'B'             TO   ASC-FRGT-PAYT-CDE         23530003
235400              MULTIPLY FRGTRM-KOHLS-FRGT-PCT BY +100 GIVING       23540003
235500                                        ASC-KOHLS-FRGT-PCT-N      23550003
235600              MULTIPLY FRGTRM-VND-FRGT-PCT BY +100 GIVING         23560003
235700                                        ASC-VEND-FRGT-PCT-N       23570003
235800           ELSE                                                   23580003
235900              IF FRGTRM-FRGT-TERM-ID = 0                          23590003
236000                 MOVE SPACE        TO   ASC-FRGT-PAYT-CDE         23600003
236100                 MOVE ZERO         TO   ASC-KOHLS-FRGT-PCT-N      23610003
236200                 MOVE ZERO         TO   ASC-VEND-FRGT-PCT-N       23620003
236300              END-IF                                              23630003
236400           END-IF                                                 23640003
236500        END-IF                                                    23650003
236600     END-IF.                                                      23660003
236700                                                                  23670003
236800                                                                  23680003
236900 4050-GET-PURCHASE-TERMS.                                         23690003
237000                                                                  23700003
237100     PERFORM WITH TEST AFTER                                      23710003
237200             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                23720003
237300             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         23730003
237400                     SQLCODE = ZERO OR                            23740003
237500                     SQLCODE = +100                               23750003
237600                                                                  23760003
237700     EXEC SQL                                                     23770003
237800          SELECT RTV_RA_REQD_IND                                  23780003
237900                ,RTV_NO_RA_REQD_IND                               23790003
238000                ,DEBIT_DESTROY_IND                                23800003
238100                ,MARKOUT_IND                                      23810003
238200                ,VND_AUTH_ID                                      23820003
238300            INTO :VNDAGR-RTV-RA-REQD-IND                          23830003
238400                 :NI-VNDAGR-RTV-RA-REQD-IND                       23840003
238500                ,:VNDAGR-RTV-NO-RA-REQD-IND                       23850003
238600                 :NI-VNDAGR-RTV-NO-RA-REQD-IND                    23860003
238700                ,:VNDAGR-DEBIT-DESTROY-IND                        23870003
238800                 :NI-VNDAGR-DEBIT-DESTROY-IND                     23880003
238900                ,:VNDAGR-MARKOUT-IND                              23890003
239000                 :NI-VNDAGR-MARKOUT-IND                           23900003
239100                ,:VNDAGR-VND-AUTH-ID                              23910003
239200                 :NI-VNDAGR-VND-AUTH-ID                           23920003
239300            FROM TVNDAGR                                          23930003
239400           WHERE ENT_ID            = :ASC-ENT-ID                  23940003
239500             AND DEPT_NBR          = :ASC-DEPARTMENT              23950003
239600             AND AGRMT_TYP_ID      = :PC-PURCHASE                 23960003
239700             AND SEQ_NBR           =                              23970003
239800                 (SELECT MAX(SEQ_NBR)                             23980003
239900                    FROM TVNDAGR                                  23990003
240000                   WHERE ENT_ID            = :ASC-ENT-ID          24000003
240100                     AND DEPT_NBR          = :ASC-DEPARTMENT      24010003
240200                     AND AGRMT_TYP_ID      = :PC-PURCHASE)        24020003
240300     END-EXEC                                                     24030003
240400                                                                  24040003
240500     EVALUATE TRUE                                                24050003
240600         WHEN SQLCODE = ZERO                                      24060003
240700         WHEN SQLCODE = +100                                      24070003
240800         WHEN SQLCODE = -904                                      24080003
240900         WHEN SQLCODE = -913                                      24090003
241000              CONTINUE                                            24100003
241100                                                                  24110003
241200         WHEN SQLWARN0 NOT = SPACES                               24120003
241300         WHEN SQLCODE  NOT = ZERO                                 24130003
241400              MOVE '4050-GET-PURCHASE-TERMS' TO DP013-PARAGRAPH   24140003
241500              MOVE 'UNSUCCESSFUL SELECT PURCHASE TERMS' TO        24150003
241600                                            DP013-MESSAGE-TEXT (1)24160003
241700              MOVE SQLCA TO DP013-SQLCA                           24170003
241800              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         24180003
241900              SET DP013-DB2-ABEND                                 24190003
242000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              24200003
242100                                                                  24210003
242200              PERFORM DP013-0000-PROCESS-ABEND                    24220003
242300     END-EVALUATE                                                 24230003
242400     END-PERFORM.                                                 24240003
242500                                                                  24250003
242600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         24260003
242700         MOVE '4050-GET-PURCHASE-TERMS' TO DP013-PARAGRAPH        24270003
242800         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE TERMS' TO  24280003
242900                                            DP013-MESSAGE-TEXT (1)24290003
243000         MOVE SQLCA      TO DP013-SQLCA                           24300003
243100         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              24310003
243200         SET DP013-DB2-ABEND                                      24320003
243300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   24330003
243400                                                                  24340003
243500         PERFORM DP013-0000-PROCESS-ABEND                         24350003
243600     END-IF.                                                      24360003
243700                                                                  24370003
243800     IF SQLCODE = ZERO                                            24380003
243900        IF NI-VNDAGR-RTV-RA-REQD-IND = -1                         24390003
244000            MOVE SPACE                  TO ASC-RTV-RA-REQD-IND    24400003
244100        ELSE                                                      24410003
244200            MOVE VNDAGR-RTV-RA-REQD-IND TO ASC-RTV-RA-REQD-IND    24420003
244300        END-IF                                                    24430003
244400        IF NI-VNDAGR-RTV-NO-RA-REQD-IND = -1                      24440003
244500            MOVE SPACE                   TO ASC-RTV-NO-RA-REQD-IND24450003
244600        ELSE                                                      24460003
244700            MOVE VNDAGR-RTV-NO-RA-REQD-IND                        24470003
244800                                         TO ASC-RTV-NO-RA-REQD-IND24480003
244900        END-IF                                                    24490003
245000        IF NI-VNDAGR-DEBIT-DESTROY-IND = -1                       24500003
245100            MOVE SPACE                    TO ASC-DEBIT-DESTROY-IND24510003
245200        ELSE                                                      24520003
245300            MOVE VNDAGR-DEBIT-DESTROY-IND TO ASC-DEBIT-DESTROY-IND24530003
245400        END-IF                                                    24540003
245500        IF NI-VNDAGR-MARKOUT-IND = -1                             24550003
245600            MOVE SPACE              TO ASC-MARKOUT-IND            24560003
245700        ELSE                                                      24570003
245800            MOVE VNDAGR-MARKOUT-IND TO ASC-MARKOUT-IND            24580003
245900        END-IF                                                    24590003
246000        IF NI-VNDAGR-VND-AUTH-ID = -1                             24600003
246100            MOVE SPACE              TO ASC-VND-AUTH-ID            24610003
246200        ELSE                                                      24620003
246300            MOVE VNDAGR-VND-AUTH-ID TO ASC-VND-AUTH-ID            24630003
246400        END-IF                                                    24640003
246500     END-IF.                                                      24650003
246600                                                                  24660003
246700     IF SQLCODE = +100                                            24670003
246800         MOVE SPACE TO ASC-RTV-RA-REQD-IND                        24680003
246900                       ASC-RTV-NO-RA-REQD-IND                     24690003
247000                       ASC-DEBIT-DESTROY-IND                      24700003
247100                       ASC-MARKOUT-IND                            24710003
247200                       ASC-VND-AUTH-ID                            24720003
247300     END-IF.                                                      24730003
247400                                                                  24740003
247500 4400-MOVE-COMMAREA-TO-SCREEN.                                    24750003
247600                                                                  24760003
247700     MOVE ASC-DEPARTMENT           TO ADPTNBRO.                   24770003
247800     MOVE ASC-ENT-NAME-DESC        TO AVNAMEO.                    24780003
247900     MOVE ASC-INHOUSE-NBR          TO AINHSO.                     24790003
248000     MOVE ASC-DUN-NBR              TO ADUNSO.                     24800003
248100     MOVE ASC-PAYT-TERM-ID         TO PV-EDIT-PAY-TERM-ID.        24810003
248200     MOVE PV-EDIT-PAY-TERM-ID      TO APAYTRMO.                   24820003
248300     MOVE ASC-PAYT-TERM-ID-DESC    TO APAYTXTO.                   24830003
248400     MOVE ASC-FREIGHT-TERM-ID-N    TO PV-EDIT-FREIGHT-TERM-ID.    24840003
248500     MOVE PV-EDIT-FREIGHT-TERM-ID  TO AFRTIDTO.                   24850003
248600     MOVE ASC-FOB-POINT-TXT        TO AFOBPNTO.                   24860003
248700     MOVE ASC-SHIPT-POINT-TXT      TO ASHPPNTO.                   24870003
248800     MOVE ASC-FRGT-PAYT-CDE        TO APAYFRGO.                   24880003
248900     MOVE ASC-KOHLS-FRGT-PCT-N     TO PV-EDIT-KOHLS-FRGHT-PCT.    24890003
249000     MOVE PV-EDIT-KOHLS-FRGHT-PCT  TO AKFRGHTO.                   24900003
249100     MOVE ASC-VEND-FRGT-PCT-N      TO PV-EDIT-VENDOR-FRGHT-PCT.   24910003
249200     MOVE PV-EDIT-VENDOR-FRGHT-PCT TO AVFRGHTO.                   24920003
249300     MOVE ASC-RTV-RA-REQD-IND      TO ARTVRQDO.                   24930003
249400     MOVE ASC-RTV-NO-RA-REQD-IND   TO ARTVNRQO.                   24940003
249500     MOVE ASC-DEBIT-DESTROY-IND    TO ADBTDSTO.                   24950003
249600     MOVE ASC-MARKOUT-IND          TO AMRKOUTO.                   24960003
249700     MOVE ASC-VND-AUTH-ID          TO AAUTHIDO.                   24970003
249800     MOVE ASC-LATE-SHIPMENT-IND    TO ALTEINDO.                   24980003
249900     MOVE ASC-CHARGE-FACTOR-CDE    TO ACHGCDEO.                   24990003
250000     MOVE ASC-CHARGE-PCT-N         TO ACHGPCTO.                   25000003
250100                                                                  25010003
250200 5000-UPDATE-TERMS.                                               25020003
250300                                                                  25030003
250400     IF ASC-PAYT-TERM-ID NOT = ASC-PAYT-TERM-ID-O                 25040003
250500         MOVE PC-PAYMENT TO PV-AGRMT-TYP-ID                       25050003
250600                                                                  25060003
250700         PERFORM 5010-GET-CUR-SEQ-NBR                             25070003
250800                                                                  25080003
250900         PERFORM 5020-EXPIRE-OLD-TERMS                            25090003
251000                                                                  25100003
251100         PERFORM 5030-INSERT-NEW-PAYMENT-TERMS                    25110003
251200     END-IF.                                                      25120003
251300                                                                  25130003
251400     IF ASC-FOB-POINT-TXT        NOT = ASC-FOB-POINT-TXT-O      OR25140003
251500        ASC-SHIPT-POINT-TXT      NOT = ASC-SHIPT-POINT-TXT-O    OR25150003
251600        ASC-FREIGHT-TERM-ID      NOT = ASC-FREIGHT-TERM-ID-O    OR25160003
251700        ASC-LATE-SHIPMENT-IND    NOT = ASC-LATE-SHIPMENT-IND-O  OR25170003
251800        ASC-CHARGE-FACTOR-CDE    NOT = ASC-CHARGE-FACTOR-CDE-O  OR25180003
251900        ASC-CHARGE-PCT           NOT = ASC-CHARGE-PCT-O           25190003
252000         MOVE PC-SHIPPING TO PV-AGRMT-TYP-ID                      25200003
252100                                                                  25210003
252200         PERFORM 5010-GET-CUR-SEQ-NBR                             25220003
252300                                                                  25230003
252400         PERFORM 5020-EXPIRE-OLD-TERMS                            25240003
252500                                                                  25250003
252600         PERFORM 5040-INSERT-NEW-SHIPPING-TERMS                   25260003
252700     END-IF.                                                      25270003
252800                                                                  25280003
252900     IF ASC-RTV-RA-REQD-IND      NOT = ASC-RTV-RA-REQD-IND-O    OR25290003
253000        ASC-RTV-NO-RA-REQD-IND   NOT = ASC-RTV-NO-RA-REQD-IND-O OR25300003
253100        ASC-DEBIT-DESTROY-IND    NOT = ASC-DEBIT-DESTROY-IND-O  OR25310003
253200        ASC-MARKOUT-IND          NOT = ASC-MARKOUT-IND-O        OR25320003
253300        ASC-VND-AUTH-ID          NOT = ASC-VND-AUTH-ID-O          25330003
253400         MOVE PC-PURCHASE TO PV-AGRMT-TYP-ID                      25340003
253500                                                                  25350003
253600         PERFORM 5010-GET-CUR-SEQ-NBR                             25360003
253700                                                                  25370003
253800         PERFORM 5020-EXPIRE-OLD-TERMS                            25380003
253900                                                                  25390003
254000         PERFORM 5050-INSERT-NEW-PURCHASE-TERMS                   25400003
254100     END-IF.                                                      25410003
254200                                                                  25420003
254300     IF ASC-USE-SELECTION-QUEUE                                   25430003
254400                                                                  25440003
254500         PERFORM 9100-READ-SELECTION-QUEUE                        25450003
254600                                                                  25460003
254700         SET VN003-UPD (ASC-SEL-SUB) TO TRUE                      25470003
254800                                                                  25480003
254900         PERFORM 9200-REWRITE-SELECTION-QUEUE                     25490003
255000     END-IF.                                                      25500003
255100                                                                  25510003
255200 5010-GET-CUR-SEQ-NBR.                                            25520003
255300                                                                  25530003
255400     PERFORM WITH TEST AFTER                                      25540003
255500             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                25550003
255600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         25560003
255700                     SQLCODE = ZERO OR                            25570003
255800                     SQLCODE = +100                               25580003
255900                                                                  25590003
256000     EXEC SQL                                                     25600003
256100          SELECT SEQ_NBR                                          25610003
256200            INTO :PV-CUR-SEQ-NBR                                  25620003
256300            FROM TVNDAGR                                          25630003
256400           WHERE ENT_ID            = :ASC-ENT-ID                  25640003
256500             AND DEPT_NBR          = :ASC-DEPARTMENT              25650003
256600             AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID             25660003
256700             AND SEQ_NBR           =                              25670003
256800                 (SELECT MAX(SEQ_NBR)                             25680003
256900                    FROM TVNDAGR                                  25690003
257000                   WHERE ENT_ID           = :ASC-ENT-ID           25700003
257100                     AND DEPT_NBR         = :ASC-DEPARTMENT       25710003
257200                    AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID)     25720003
257300     END-EXEC                                                     25730003
257400                                                                  25740003
257500     EVALUATE TRUE                                                25750003
257600         WHEN SQLCODE = ZERO                                      25760003
257700         WHEN SQLCODE = +100                                      25770003
257800         WHEN SQLCODE = -904                                      25780003
257900         WHEN SQLCODE = -913                                      25790003
258000              CONTINUE                                            25800003
258100                                                                  25810003
258200         WHEN SQLWARN0 NOT = SPACES                               25820003
258300         WHEN SQLCODE  NOT = ZERO                                 25830003
258400              MOVE '5010-GET-CUR-SEQ-NBR' TO DP013-PARAGRAPH      25840003
258500              MOVE 'UNSUCCESSFUL SELECT CUR SEQ NBR' TO           25850003
258600                                            DP013-MESSAGE-TEXT (1)25860003
258700              MOVE SQLCA TO DP013-SQLCA                           25870003
258800              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         25880003
258900              SET DP013-DB2-ABEND                                 25890003
259000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              25900003
259100                                                                  25910003
259200              PERFORM DP013-0000-PROCESS-ABEND                    25920003
259300     END-EVALUATE                                                 25930003
259400     END-PERFORM.                                                 25940003
259500                                                                  25950003
259600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         25960003
259700         MOVE '5010-GET-CUR-SEQ-NBR' TO DP013-PARAGRAPH           25970003
259800         MOVE 'MAX RETRIES EXCEEDED ON SELECT CUR SEQ NBR' TO     25980003
259900                                            DP013-MESSAGE-TEXT (1)25990003
260000         MOVE SQLCA      TO DP013-SQLCA                           26000003
260100         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              26010003
260200         SET DP013-DB2-ABEND                                      26020003
260300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   26030003
260400                                                                  26040003
260500         PERFORM DP013-0000-PROCESS-ABEND                         26050003
260600     END-IF.                                                      26060003
260700                                                                  26070003
260800     IF SQLCODE = ZERO                                            26080003
260900         ADD +1  PV-CUR-SEQ-NBR  GIVING PV-NEW-SEQ-NBR            26090003
261000     ELSE                                                         26100003
261100         IF SQLCODE = +100                                        26110003
261200             MOVE ZERO TO PV-CUR-SEQ-NBR                          26120003
261300             ADD +1  PV-CUR-SEQ-NBR  GIVING PV-NEW-SEQ-NBR        26130003
261400         END-IF                                                   26140003
261500     END-IF.                                                      26150003
261600                                                                  26160003
261700 5020-EXPIRE-OLD-TERMS.                                           26170003
261800                                                                  26180003
261900     PERFORM WITH TEST AFTER                                      26190003
262000             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                26200003
262100             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         26210003
262200                     SQLCODE = ZERO OR                            26220003
262300                     SQLCODE = +100                               26230003
262400                                                                  26240003
262500     EXEC SQL                                                     26250003
262600          UPDATE TVNDAGR                                          26260003
262700             SET EXPIRATION_DATE   = CURRENT DATE                 26270003
262800                ,LAST_UPD_ID       = :DP020-USERID                26280003
262900           WHERE ENT_ID            = :ASC-ENT-ID                  26290003
263000             AND DEPT_NBR          = :ASC-DEPARTMENT              26300003
263100             AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID             26310003
263200             AND SEQ_NBR           = :PV-CUR-SEQ-NBR              26320003
263300     END-EXEC                                                     26330003
263400                                                                  26340003
263500     EVALUATE TRUE                                                26350003
263600         WHEN SQLCODE = ZERO                                      26360003
263700         WHEN SQLCODE = +100                                      26370003
263800         WHEN SQLCODE = -904                                      26380003
263900         WHEN SQLCODE = -913                                      26390003
264000              CONTINUE                                            26400003
264100                                                                  26410003
264200         WHEN SQLWARN0 NOT = SPACES                               26420003
264300         WHEN SQLCODE  NOT = ZERO                                 26430003
264400              MOVE '5020-EXPIRE-OLD-TERMS' TO DP013-PARAGRAPH     26440003
264500              MOVE 'UNSUCCESSFUL UPDATE - EXPIRE OLD TERMS' TO    26450003
264600                                            DP013-MESSAGE-TEXT (1)26460003
264700              MOVE SQLCA TO DP013-SQLCA                           26470003
264800              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         26480003
264900              SET DP013-DB2-ABEND                                 26490003
265000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              26500003
265100                                                                  26510003
265200              PERFORM DP013-0000-PROCESS-ABEND                    26520003
265300     END-EVALUATE                                                 26530003
265400     END-PERFORM.                                                 26540003
265500                                                                  26550003
265600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         26560003
265700         MOVE '5020-EXPIRE-OLD-TERMS' TO DP013-PARAGRAPH          26570003
265800         MOVE 'MAX RETRIES EXCEEDED ON UPDATE - EXPIRE OLD TERMS' 26580003
265900                                         TO DP013-MESSAGE-TEXT (1)26590003
266000         MOVE SQLCA      TO DP013-SQLCA                           26600003
266100         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              26610003
266200         SET DP013-DB2-ABEND                                      26620003
266300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   26630003
266400                                                                  26640003
266500         PERFORM DP013-0000-PROCESS-ABEND                         26650003
266600     END-IF.                                                      26660003
266700                                                                  26670003
266800     IF SQLCODE = +100                                            26680003
266900         SET PS-TERMS-DONT-EXIST TO TRUE                          26690003
267000                                                                  26700003
267100         PERFORM 5022-CHECK-IF-TERMS-EXIST                        26710003
267200                                                                  26720003
267300         IF PS-TERMS-EXIST                                        26730003
267400             MOVE '5020-EXPIRE-OLD-TERMS' TO DP013-PARAGRAPH      26740003
267500             MOVE 'UNSUCCESSFUL UPDATE - EXPIRE OLD TERMS' TO     26750003
267600                                            DP013-MESSAGE-TEXT (1)26760003
267700             MOVE SQLCA TO DP013-SQLCA                            26770003
267800             MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)          26780003
267900             SET DP013-DB2-ABEND                                  26790003
268000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               26800003
268100                                                                  26810003
268200             PERFORM DP013-0000-PROCESS-ABEND                     26820003
268300         END-IF                                                   26830003
268400     END-IF.                                                      26840003
268500                                                                  26850003
268600 5022-CHECK-IF-TERMS-EXIST.                                       26860003
268700                                                                  26870003
268800     PERFORM WITH TEST AFTER                                      26880003
268900             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                26890003
269000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         26900003
269100                     SQLCODE = ZERO                               26910003
269200                                                                  26920003
269300     EXEC SQL                                                     26930003
269400          SELECT COUNT (*)                                        26940003
269500            INTO :PV-TERMS-COUNT                                  26950003
269600            FROM TVNDAGR                                          26960003
269700           WHERE ENT_ID            = :ASC-ENT-ID                  26970003
269800             AND DEPT_NBR          = :ASC-DEPARTMENT              26980003
269900             AND AGRMT_TYP_ID      = :PV-AGRMT-TYP-ID             26990003
270000     END-EXEC                                                     27000003
270100                                                                  27010003
270200     EVALUATE TRUE                                                27020003
270300         WHEN SQLCODE = ZERO                                      27030003
270400         WHEN SQLCODE = -904                                      27040003
270500         WHEN SQLCODE = -913                                      27050003
270600              CONTINUE                                            27060003
270700                                                                  27070003
270800         WHEN SQLWARN0 NOT = SPACES                               27080003
270900         WHEN SQLCODE  NOT = ZERO                                 27090003
271000              MOVE '5022-CHECK-IF-TERMS-EXIST' TO DP013-PARAGRAPH 27100003
271100              MOVE 'UNSUCCESSFUL SELECT COUNT OF TERMS' TO        27110003
271200                                            DP013-MESSAGE-TEXT (1)27120003
271300              MOVE SQLCA TO DP013-SQLCA                           27130003
271400              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         27140003
271500              SET DP013-DB2-ABEND                                 27150003
271600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              27160003
271700                                                                  27170003
271800              PERFORM DP013-0000-PROCESS-ABEND                    27180003
271900     END-EVALUATE                                                 27190003
272000     END-PERFORM.                                                 27200003
272100                                                                  27210003
272200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         27220003
272300         MOVE '5022-CHECK-IF-TERMS-EXIST' TO DP013-PARAGRAPH      27230003
272400         MOVE 'MAX RETRIES EXCEEDED ON SELECT COUNT OF TERMS' TO  27240003
272500                                            DP013-MESSAGE-TEXT (1)27250003
272600         MOVE SQLCA      TO DP013-SQLCA                           27260003
272700         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              27270003
272800         SET DP013-DB2-ABEND                                      27280003
272900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   27290003
273000                                                                  27300003
273100         PERFORM DP013-0000-PROCESS-ABEND                         27310003
273200     END-IF.                                                      27320003
273300                                                                  27330003
273400     IF SQLCODE = ZERO                                            27340003
273500        IF PV-TERMS-COUNT > ZERO                                  27350003
273600            SET PS-TERMS-EXIST TO TRUE.                           27360003
273700                                                                  27370003
273800 5030-INSERT-NEW-PAYMENT-TERMS.                                   27380003
273900                                                                  27390003
274000     MOVE ZERO TO NI-VNDAGR-PAYT-TERM-ID.                         27400003
274100                                                                  27410003
274200     MOVE ASC-PAYT-TERM-ID-N TO VNDAGR-PAYT-TERM-ID.              27420003
274300                                                                  27430003
274400     PERFORM WITH TEST AFTER                                      27440003
274500             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                27450003
274600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         27460003
274700                     SQLCODE = ZERO                               27470003
274800                                                                  27480003
274900     EXEC SQL                                                     27490003
275000          INSERT INTO TVNDAGR                                     27500003
275100                 ( ENT_ID                                         27510003
275200                  ,DEPT_NBR                                       27520003
275300                  ,AGRMT_TYP_ID                                   27530003
275400                  ,SEQ_NBR                                        27540003
275500                  ,EFFECTIVE_DATE                                 27550003
275600                  ,EXPIRATION_DATE                                27560003
275700                  ,PROD_STATUS_IND                                27570003
275800                  ,PAYT_TERM_ID                                   27580003
275900                  ,LAST_UPD_ID)                                   27590003
276000          VALUES ( :ASC-ENT-ID                                    27600003
276100                  ,:ASC-DEPARTMENT                                27610003
276200                  ,:PC-PAYMENT                                    27620003
276300                  ,:PV-NEW-SEQ-NBR                                27630003
276400                  , CURRENT DATE                                  27640003
276500                  ,:PC-MAX-DATE                                   27650003
276600                   :NI-VNDAGR-EXPIRATION-DATE                     27660003
276700                  ,:PC-PROD-STATUS                                27670003
276800                  ,:VNDAGR-PAYT-TERM-ID                           27680003
276900                   :NI-VNDAGR-PAYT-TERM-ID                        27690003
277000                  ,:DP020-USERID)                                 27700003
277100     END-EXEC                                                     27710003
277200                                                                  27720003
277300     EVALUATE TRUE                                                27730003
277400         WHEN SQLCODE = ZERO                                      27740003
277500         WHEN SQLCODE = -904                                      27750003
277600         WHEN SQLCODE = -913                                      27760003
277700              CONTINUE                                            27770003
277800                                                                  27780003
277900         WHEN SQLWARN0 NOT = SPACES                               27790003
278000         WHEN SQLCODE  NOT = ZERO                                 27800003
278100              MOVE '5030-INSERT-NEW-PAYMENT-TERMS' TO             27810003
278200                                                   DP013-PARAGRAPH27820003
278300              MOVE 'UNSUCCESSFUL INSERT NEW PAYMENT TERMS' TO     27830003
278400                                            DP013-MESSAGE-TEXT (1)27840003
278500              MOVE SQLCA TO DP013-SQLCA                           27850003
278600              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         27860003
278700              SET DP013-DB2-ABEND                                 27870003
278800                  DP013-XCTL-DISPLAY-RESTART TO TRUE              27880003
278900                                                                  27890003
279000              PERFORM DP013-0000-PROCESS-ABEND                    27900003
279100     END-EVALUATE                                                 27910003
279200     END-PERFORM.                                                 27920003
279300                                                                  27930003
279400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         27940003
279500         MOVE '5030-INSERT-NEW-PAYMENT-TERMS' TO DP013-PARAGRAPH  27950003
279600         MOVE 'MAX RETRIES EXCEEDED ON INSERT NEW PAYMENT TERMS'  27960003
279700                                         TO DP013-MESSAGE-TEXT (1)27970003
279800         MOVE SQLCA      TO DP013-SQLCA                           27980003
279900         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              27990003
280000         SET DP013-DB2-ABEND                                      28000003
280100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   28010003
280200                                                                  28020003
280300         PERFORM DP013-0000-PROCESS-ABEND                         28030003
280400     END-IF.                                                      28040003
280500                                                                  28050003
280600 5040-INSERT-NEW-SHIPPING-TERMS.                                  28060003
280700                                                                  28070003
280800     MOVE ZERO TO NI-VNDAGR-EXPIRATION-DATE                       28080003
280900                  NI-VNDAGR-FOB-POINT-TXT                         28090003
281000                  NI-VNDAGR-SHIPT-POINT-TXT                       28100003
281100                  NI-VNDAGR-LATE-SHIPT-IND                        28110003
281200                  NI-VNDAGR-CHRG-PCT                              28120003
281300                  NI-VNDAGR-CHRG-FCTR-CDE.                        28130003
281400                                                                  28140003
281500     MOVE ASC-FOB-POINT-TXT        TO VNDAGR-FOB-POINT-TXT.       28150003
281600     MOVE ASC-SHIPT-POINT-TXT      TO VNDAGR-SHIPT-POINT-TXT.     28160003
281700     MOVE ASC-FREIGHT-TERM-ID-N    TO VNDAGR-FRGT-TERM-ID.        28170003
281800                                                                  28180003
281900     MOVE ASC-LATE-SHIPMENT-IND TO VNDAGR-LATE-SHIPT-IND.         28190003
282000     MOVE +1 TO NI-VNDAGR-LATE-SHIPT-IND.                         28200003
282100                                                                  28210003
282200     IF  ASC-CHARGE-FACTOR-CDE = 'S' OR 'D' OR 'W'                28220003
282300         MOVE ASC-CHARGE-FACTOR-CDE TO VNDAGR-CHRG-FCTR-CDE       28230003
282400         MOVE +1 TO NI-VNDAGR-CHRG-FCTR-CDE                       28240003
282500     ELSE                                                         28250003
282600         MOVE -1 TO NI-VNDAGR-CHRG-FCTR-CDE                       28260003
282700     END-IF.                                                      28270003
282800                                                                  28280003
282900     MOVE +1 TO NI-VNDAGR-CHRG-PCT.                               28290003
283000     IF  ASC-CHARGE-PCT-N NOT = ZEROES                            28300003
283100         COMPUTE VNDAGR-CHRG-PCT =                                28310003
283200                 ASC-CHARGE-PCT-N / 100                           28320003
283300     ELSE                                                         28330003
283400         MOVE ZEROES TO VNDAGR-CHRG-PCT                           28340003
283500     END-IF.                                                      28350003
283600                                                                  28360003
283700     IF ASC-FREIGHT-TERM-ID-N = 0                                 28370003
283800        NEXT SENTENCE                                             28380003
283900     ELSE                                                         28390003
284000        PERFORM 5045-SELECT-FREIGHT-TERMS                         28400003
284100     END-IF.                                                      28410003
284200                                                                  28420003
284300     PERFORM WITH TEST AFTER                                      28430003
284400             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                28440003
284500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         28450003
284600                     SQLCODE = ZERO                               28460003
284700                                                                  28470003
284800     EXEC SQL                                                     28480003
284900          INSERT INTO TVNDAGR                                     28490003
285000                 ( ENT_ID                                         28500003
285100                  ,DEPT_NBR                                       28510003
285200                  ,AGRMT_TYP_ID                                   28520003
285300                  ,SEQ_NBR                                        28530003
285400                  ,EFFECTIVE_DATE                                 28540003
285500                  ,EXPIRATION_DATE                                28550003
285600                  ,PROD_STATUS_IND                                28560003
285700                  ,LATE_SHIPT_IND                                 28570003
285800                  ,FOB_POINT_TXT                                  28580003
285900                  ,SHIPT_POINT_TXT                                28590003
286000                  ,LAST_UPD_ID                                    28600003
286100                  ,FRGT_TERM_ID                                   28610003
286200                  ,CHRG_PCT                                       28620003
286300                  ,CHRG_FCTR_CDE)                                 28630003
286400          VALUES ( :ASC-ENT-ID                                    28640003
286500                  ,:ASC-DEPARTMENT                                28650003
286600                  ,:PC-SHIPPING                                   28660003
286700                  ,:PV-NEW-SEQ-NBR                                28670003
286800                  , CURRENT DATE                                  28680003
286900                  ,:PC-MAX-DATE                                   28690003
287000                   :NI-VNDAGR-EXPIRATION-DATE                     28700003
287100                  ,:PC-PROD-STATUS                                28710003
287200                  ,:VNDAGR-LATE-SHIPT-IND                         28720003
287300                   :NI-VNDAGR-LATE-SHIPT-IND                      28730003
287400                  ,:VNDAGR-FOB-POINT-TXT                          28740003
287500                   :NI-VNDAGR-FOB-POINT-TXT                       28750003
287600                  ,:VNDAGR-SHIPT-POINT-TXT                        28760003
287700                   :NI-VNDAGR-SHIPT-POINT-TXT                     28770003
287800                  ,:DP020-USERID                                  28780003
287900                  ,:VNDAGR-FRGT-TERM-ID                           28790003
288000                  ,:VNDAGR-CHRG-PCT                               28800003
288100                   :NI-VNDAGR-CHRG-PCT                            28810003
288200                  ,:VNDAGR-CHRG-FCTR-CDE                          28820003
288300                   :NI-VNDAGR-CHRG-FCTR-CDE)                      28830003
288400     END-EXEC                                                     28840003
288500                                                                  28850003
288600     EVALUATE TRUE                                                28860003
288700         WHEN SQLCODE = ZERO                                      28870003
288800         WHEN SQLCODE = -904                                      28880003
288900         WHEN SQLCODE = -913                                      28890003
289000              CONTINUE                                            28900003
289100                                                                  28910003
289200         WHEN SQLWARN0 NOT = SPACES                               28920003
289300         WHEN SQLCODE  NOT = ZERO                                 28930003
289400              MOVE '5040-INSERT-NEW-SHIPPING-TERMS' TO            28940003
289500                                                   DP013-PARAGRAPH28950003
289600              MOVE 'UNSUCCESSFUL INSERT NEW SHIPPING TERMS' TO    28960003
289700                                            DP013-MESSAGE-TEXT (1)28970003
289800              MOVE SQLCA TO DP013-SQLCA                           28980003
289900              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         28990003
290000              SET DP013-DB2-ABEND                                 29000003
290100                  DP013-XCTL-DISPLAY-RESTART TO TRUE              29010003
290200                                                                  29020003
290300              PERFORM DP013-0000-PROCESS-ABEND                    29030003
290400     END-EVALUATE                                                 29040003
290500     END-PERFORM.                                                 29050003
290600                                                                  29060003
290700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         29070003
290800         MOVE '5040-INSERT-NEW-SHIPPING-TERMS' TO DP013-PARAGRAPH 29080003
290900         MOVE 'MAX RETRIES EXCEEDED ON INSERT NEW SHIPT TERMS' TO 29090003
291000                                            DP013-MESSAGE-TEXT (1)29100003
291100         MOVE SQLCA      TO DP013-SQLCA                           29110003
291200         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              29120003
291300         SET DP013-DB2-ABEND                                      29130003
291400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   29140003
291500                                                                  29150003
291600         PERFORM DP013-0000-PROCESS-ABEND                         29160003
291700     END-IF.                                                      29170003
291800                                                                  29180003
291900 5045-SELECT-FREIGHT-TERMS.                                       29190003
292000                                                                  29200003
292100     PERFORM WITH TEST AFTER                                      29210003
292200             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                29220003
292300             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         29230003
292400                     SQLCODE = ZERO OR                            29240003
292500                     SQLCODE = +100                               29250003
292600                                                                  29260003
292700     EXEC SQL                                                     29270003
292800          SELECT KOHLS_FRGT_PCT                                   29280003
292900                ,VND_FRGT_PCT                                     29290003
293000            INTO :FRGTRM-KOHLS-FRGT-PCT                           29300003
293100                ,:FRGTRM-VND-FRGT-PCT                             29310003
293200            FROM TFRGTRM                                          29320003
293300           WHERE FRGT_TERM_ID = :PV-FREIGHT-TERM-ID               29330003
293400     END-EXEC                                                     29340003
293500                                                                  29350003
293600     EVALUATE TRUE                                                29360003
293700         WHEN SQLCODE = ZERO                                      29370003
293800         WHEN SQLCODE = +100                                      29380003
293900         WHEN SQLCODE = -904                                      29390003
294000         WHEN SQLCODE = -913                                      29400003
294100              CONTINUE                                            29410003
294200                                                                  29420003
294300         WHEN SQLWARN0 NOT = SPACES                               29430003
294400         WHEN SQLCODE  NOT = ZERO                                 29440003
294500              MOVE '5045-SELECT-FREIGHT-TERMS  ' TO               29450003
294600                                                   DP013-PARAGRAPH29460003
294700              MOVE 'UNSUCCESSFUL SELECT FREIGHT TERMS' TO         29470003
294800                                            DP013-MESSAGE-TEXT (1)29480003
294900              MOVE SQLCA TO DP013-SQLCA                           29490003
295000              MOVE 'TFRGTRM ' TO DP013-DB2-TABLE-NAME (1)         29500003
295100              SET DP013-DB2-ABEND                                 29510003
295200                  DP013-XCTL-DISPLAY-RESTART TO TRUE              29520003
295300                                                                  29530003
295400              PERFORM DP013-0000-PROCESS-ABEND                    29540003
295500     END-EVALUATE                                                 29550003
295600     END-PERFORM.                                                 29560003
295700                                                                  29570003
295800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         29580003
295900         MOVE '5045-SELECT-FREIGHT-TERMS  ' TO DP013-PARAGRAPH    29590003
296000         MOVE 'MAX RETRIES EXCEEDED ON SELECT FREIGHT TERMS' TO   29600003
296100                                            DP013-MESSAGE-TEXT (1)29610003
296200         MOVE SQLCA      TO DP013-SQLCA                           29620003
296300         MOVE 'TFRGTRM ' TO DP013-DB2-TABLE-NAME (1)              29630003
296400         SET DP013-DB2-ABEND                                      29640003
296500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   29650003
296600                                                                  29660003
296700         PERFORM DP013-0000-PROCESS-ABEND                         29670003
296800     END-IF.                                                      29680003
296900                                                                  29690003
297000     IF SQLCODE = +100                                            29700003
297100         SET PS-ERROR                                             29710003
297200             DP020-MSG-FATAL                                      29720003
297300             DP030-SET-CURSOR-APPL-1 TO TRUE                      29730003
297400         MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                 29740003
297500         MOVE -1                    TO AFRTIDTL                   29750003
297600         MOVE DP015-UNP-ALP-BRT-OFF TO AFRTIDTA                   29760003
297700         MOVE DP015-RED             TO AFRTIDTC                   29770003
297800         MOVE DP015-REVERSE         TO AFRTIDTH                   29780003
297900     END-IF.                                                      29790003
298000                                                                  29800003
298100 5050-INSERT-NEW-PURCHASE-TERMS.                                  29810003
298200                                                                  29820003
298300     MOVE ZERO TO NI-VNDAGR-EXPIRATION-DATE                       29830003
298400                  NI-VNDAGR-RTV-RA-REQD-IND                       29840003
298500                  NI-VNDAGR-RTV-NO-RA-REQD-IND                    29850003
298600                  NI-VNDAGR-DEBIT-DESTROY-IND                     29860003
298700                  NI-VNDAGR-MARKOUT-IND                           29870003
298800                  NI-VNDAGR-VND-AUTH-ID.                          29880003
298900                                                                  29890003
299000     MOVE ASC-RTV-RA-REQD-IND     TO VNDAGR-RTV-RA-REQD-IND.      29900003
299100     MOVE ASC-RTV-NO-RA-REQD-IND  TO VNDAGR-RTV-NO-RA-REQD-IND.   29910003
299200     MOVE ASC-DEBIT-DESTROY-IND   TO VNDAGR-DEBIT-DESTROY-IND.    29920003
299300     MOVE ASC-MARKOUT-IND         TO VNDAGR-MARKOUT-IND.          29930003
299400     MOVE ASC-VND-AUTH-ID         TO VNDAGR-VND-AUTH-ID.          29940003
299500                                                                  29950003
299600     PERFORM WITH TEST AFTER                                      29960003
299700             VARYING PV-RETRY-COUNTER  FROM 1 BY 1                29970003
299800             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         29980003
299900                     SQLCODE = ZERO                               29990003
300000                                                                  30000003
300100     EXEC SQL                                                     30010003
300200          INSERT INTO TVNDAGR                                     30020003
300300                 ( ENT_ID                                         30030003
300400                  ,DEPT_NBR                                       30040003
300500                  ,AGRMT_TYP_ID                                   30050003
300600                  ,SEQ_NBR                                        30060003
300700                  ,EFFECTIVE_DATE                                 30070003
300800                  ,EXPIRATION_DATE                                30080003
300900                  ,PROD_STATUS_IND                                30090003
301000                  ,RTV_RA_REQD_IND                                30100003
301100                  ,RTV_NO_RA_REQD_IND                             30110003
301200                  ,DEBIT_DESTROY_IND                              30120003
301300                  ,MARKOUT_IND                                    30130003
301400                  ,VND_AUTH_ID                                    30140003
301500                  ,LAST_UPD_ID)                                   30150003
301600          VALUES ( :ASC-ENT-ID                                    30160003
301700                  ,:ASC-DEPARTMENT                                30170003
301800                  ,:PC-PURCHASE                                   30180003
301900                  ,:PV-NEW-SEQ-NBR                                30190003
302000                  , CURRENT DATE                                  30200003
302100                  ,:PC-MAX-DATE                                   30210003
302200                   :NI-VNDAGR-EXPIRATION-DATE                     30220003
302300                  ,:PC-PROD-STATUS                                30230003
302400                  ,:VNDAGR-RTV-RA-REQD-IND                        30240003
302500                   :NI-VNDAGR-RTV-RA-REQD-IND                     30250003
302600                  ,:VNDAGR-RTV-NO-RA-REQD-IND                     30260003
302700                   :NI-VNDAGR-RTV-NO-RA-REQD-IND                  30270003
302800                  ,:VNDAGR-DEBIT-DESTROY-IND                      30280003
302900                   :NI-VNDAGR-DEBIT-DESTROY-IND                   30290003
303000                  ,:VNDAGR-MARKOUT-IND                            30300003
303100                   :NI-VNDAGR-MARKOUT-IND                         30310003
303200                  ,:VNDAGR-VND-AUTH-ID                            30320003
303300                   :NI-VNDAGR-VND-AUTH-ID                         30330003
303400                  ,:DP020-USERID)                                 30340003
303500     END-EXEC                                                     30350003
303600                                                                  30360003
303700     EVALUATE TRUE                                                30370003
303800         WHEN SQLCODE = ZERO                                      30380003
303900         WHEN SQLCODE = -904                                      30390003
304000         WHEN SQLCODE = -913                                      30400003
304100              CONTINUE                                            30410003
304200                                                                  30420003
304300         WHEN SQLWARN0 NOT = SPACES                               30430003
304400         WHEN SQLCODE  NOT = ZERO                                 30440003
304500              MOVE '5050-INSERT-NEW-PURCHASE-TERMS' TO            30450003
304600                                                   DP013-PARAGRAPH30460003
304700              MOVE 'UNSUCCESSFUL INSERT NEW PURCHASE TERMS' TO    30470003
304800                                            DP013-MESSAGE-TEXT (1)30480003
304900              MOVE SQLCA TO DP013-SQLCA                           30490003
305000              MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)         30500003
305100              SET DP013-DB2-ABEND                                 30510003
305200                  DP013-XCTL-DISPLAY-RESTART TO TRUE              30520003
305300                                                                  30530003
305400              PERFORM DP013-0000-PROCESS-ABEND                    30540003
305500     END-EVALUATE                                                 30550003
305600     END-PERFORM.                                                 30560003
305700                                                                  30570003
305800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         30580003
305900         MOVE '5050-INSERT-NEW-PURCHASE-TERMS' TO DP013-PARAGRAPH 30590003
306000         MOVE 'MAX RETRIES EXCEEDED ON INSERT NEW PURCH TERMS' TO 30600003
306100                                            DP013-MESSAGE-TEXT (1)30610003
306200         MOVE SQLCA      TO DP013-SQLCA                           30620003
306300         MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)              30630003
306400         SET DP013-DB2-ABEND                                      30640003
306500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   30650003
306600                                                                  30660003
306700         PERFORM DP013-0000-PROCESS-ABEND                         30670003
306800     END-IF.                                                      30680003
306900                                                                  30690003
307000 5060-CALL-VNKCS023.                                              30700003
307100******************************************************************30710003
307200*   CALL PROGRAM VNKCS023 TO BUILD THE REST OF THE REQUIRED DATA *30720003
307300*   TO INTERFACE TO RMS.                                         *30730003
307400******************************************************************30740003
307500     SET VN013-FUNCTION-TERMS       TO TRUE.                      30750003
307600     MOVE ASC-ENT-ID                TO VN013-ENT-ID.              30760003
307700     MOVE ASC-DUN-NBR               TO VN013-VND-NBR.             30770003
307800     MOVE ASC-PRIM-TYP-CDE          TO VN013-PRIM-TYP-CDE.        30780003
307900     MOVE ASC-VND-IN-RMS-IND        TO VN013-VND-IN-RMS-IND.      30790003
308000     MOVE ASC-STATUS-CDE            TO VN013-STATUS-CDE.          30800003
308100     MOVE ASC-PO-PREPK-CDE          TO VN013-PO-PREPK-CDE.        30810003
308200     MOVE ASC-ENT-NAME-DESC         TO VN013-ENT-NAME-DESC.       30820003
308300     MOVE ASC-DEPARTMENT            TO VN013-DEPT-NBR.            30830003
308400     MOVE ASC-PAYT-TERM-ID-N        TO VN013-PAYT-TERM-ID.        30840003
308500     MOVE ASC-FREIGHT-TERM-ID-N     TO VN013-FRGT-TERM-ID.        30850003
308600                                                                  30860003
308700     EXEC CICS LINK PROGRAM (PC-VNKCS023)                         30870003
308800                    COMMAREA(VN013-COMMAREA)                      30880003
308900                    RESP    (PV-CICS-RESPONSE)                    30890003
309000     END-EXEC.                                                    30900003
309100                                                                  30910003
309200     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       30920003
309300         CONTINUE                                                 30930003
309400     ELSE                                                         30940003
309500         SET DP013-ROLLBACK                                       30950003
309600             DP013-XCTL-DISPLAY-RESTART                           30960003
309700             DP013-CICS-ABEND      TO TRUE                        30970003
309800         MOVE '5060-CALL-VNKCS023' TO DP013-PARAGRAPH             30980003
309900         MOVE 'FAILED CALL TO RMS DATA BUILDER ROUTINE: VNKCS023' 30990003
310000                                   TO DP013-MESSAGE-TEXT (1)      31000003
310100         PERFORM DP013-0000-PROCESS-ABEND                         31010003
310200     END-IF.                                                      31020003
310300                                                                  31030003
310400     IF VN013-NO-ERRORS                                           31040003
310500         CONTINUE                                                 31050003
310600     ELSE                                                         31060003
310700         SET DP013-CICS-ABEND                                     31070003
310800             DP013-ROLLBACK                                       31080003
310900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   31090003
311000         MOVE '5060-CALL-VNKCS023'      TO DP013-PARAGRAPH        31100003
311100         MOVE VN013-PARAGRAPH-NAME      TO PV-ERROR-PARA-NAME     31110003
311200         MOVE VN013-MESSAGE             TO PV-ERROR-MESSAGE       31120003
311300         IF VN013-DB-ERROR                                        31130003
311400             MOVE 'DB2 ERROR      '     TO PV-ERROR-TYPE          31140003
311500             MOVE 'SQL CODE: '          TO PV-OPTIONAL-TEXT       31150003
311600             MOVE VN013-SQLCODE         TO PV-ERROR-REASON        31160003
311700         ELSE                                                     31170003
311800             MOVE SPACES                TO PV-OPTIONAL-TEXT       31180003
311900                                           PV-ERROR-REASON        31190003
312000             IF VN013-MQ-ERROR                                    31200003
312100                 MOVE 'MQ SERIES ERROR' TO PV-ERROR-TYPE          31210003
312200             ELSE                                                 31220003
312300                 MOVE 'UNKNOWN ERROR  ' TO PV-ERROR-TYPE          31230003
312400             END-IF                                               31240003
312500         END-IF                                                   31250003
312600         MOVE PV-ERROR-MSG-1       TO DP013-MESSAGE-TEXT (2)      31260003
312700         MOVE PV-ERROR-MSG-2       TO DP013-MESSAGE-TEXT (3)      31270003
312800         MOVE PV-ERROR-MSG-3       TO DP013-MESSAGE-TEXT (4)      31280003
312900         PERFORM DP013-0000-PROCESS-ABEND                         31290003
313000     END-IF.                                                      31300003
313100                                                                  31310003
313200     IF VN013-MAX-CPBLTY-EXCEEDED                                 31320003
313300         SET DP030-OVERRIDE-GO TO TRUE                            31330003
313400         MOVE PC-TSYMSG-03380  TO DP020-MSG-NUMBER                31340003
313500         SET DP020-MSG-WARNING TO TRUE                            31350003
313600     END-IF.                                                      31360003
313700                                                                  31370003
313800     IF VN013-MAX-RLTNSHP-EXCEEDED                                31380003
313900         SET DP030-OVERRIDE-GO TO TRUE                            31390003
314000         MOVE PC-TSYMSG-03381  TO DP020-MSG-NUMBER                31400003
314100         SET DP020-MSG-WARNING TO TRUE                            31410003
314200     END-IF.                                                      31420003
314300                                                                  31430003
314400     IF VN013-MAX-ADDR-EXCEEDED                                   31440003
314500         SET DP030-OVERRIDE-GO TO TRUE                            31450003
314600         MOVE PC-TSYMSG-02645  TO DP020-MSG-NUMBER                31460003
314700         SET DP020-MSG-WARNING TO TRUE                            31470003
314800     END-IF.                                                      31480003
314900                                                                  31490003
315000     IF VN013-MAX-DEPT-EXCEEDED                                   31500003
315100         SET DP030-OVERRIDE-GO TO TRUE                            31510003
315200         MOVE PC-TSYMSG-02646  TO DP020-MSG-NUMBER                31520003
315300         SET DP020-MSG-WARNING TO TRUE                            31530003
315400     END-IF.                                                      31540003
315500                                                                  31550003
315600 5070-UPDATE-TEXTENT.                                             31560003
315700                                                                  31570003
315800     PERFORM                                                      31580003
315900         WITH TEST AFTER                                          31590003
316000         VARYING PV-RETRY-COUNTER                                 31600003
316100         FROM 1 BY 1                                              31610003
316200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31620003
316300                   OR (SQLCODE = ZERO))                           31630003
316400         EXEC SQL                                                 31640003
316500           UPDATE TEXTENT                                         31650003
316600              SET VND_IN_RMS_IND     = 'Y'                        31660003
316700             WHERE ENT_ID  = :ASC-ENT-ID                          31670003
316800         END-EXEC                                                 31680003
316900                                                                  31690003
317000         EVALUATE TRUE                                            31700003
317100             WHEN SQLCODE = ZERO                                  31710003
317200             WHEN SQLCODE = -904                                  31720003
317300             WHEN SQLCODE = -913                                  31730003
317400                 CONTINUE                                         31740003
317500             WHEN SQLWARN0 NOT = SPACES                           31750003
317600             WHEN SQLCODE < ZERO                                  31760003
317700             WHEN SQLCODE > ZERO                                  31770003
317800                 MOVE '5070-UPDATE-TEXTENT'                       31780003
317900                                   TO DP013-PARAGRAPH             31790003
318000                 MOVE 'UPDATE A ROW ON THE EXTERNAL ENT TABLE'    31800003
318100                                   TO DP013-MESSAGE-TEXT(1)       31810003
318200                 MOVE SQLCA        TO DP013-SQLCA                 31820003
318300                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    31830003
318400                 SET DP013-DB2-ABEND                              31840003
318500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31850003
318600                 PERFORM DP013-0000-PROCESS-ABEND                 31860003
318700         END-EVALUATE                                             31870003
318800     END-PERFORM.                                                 31880003
318900                                                                  31890003
319000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31900003
319100         MOVE '5070-UPDATE-TEXTENT'                               31910003
319200                                   TO DP013-PARAGRAPH             31920003
319300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A VEN31930003
319400-             'DOR'                TO DP013-MESSAGE-TEXT (1)      31940003
319500         MOVE SQLCA                TO DP013-SQLCA                 31950003
319600         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    31960003
319700         SET DP013-DB2-ABEND                                      31970003
319800             DP013-XCTL-DISPLAY-RESTART                           31980003
319900                                   TO TRUE                        31990003
320000         PERFORM DP013-0000-PROCESS-ABEND                         32000003
320100     END-IF.                                                      32010003
320200                                                                  32020003
320300 9100-READ-SELECTION-QUEUE.                                       32030003
320400                                                                  32040003
320500     EXEC CICS READQ TS QUEUE (ASC-SEL-QUEUE-NAME)                32050003
320600                        INTO  (VN003-VENDOR-SEL-REC)              32060003
320700                        ITEM  (ASC-SEL-ITEM)                      32070003
320800                        RESP  (PV-CICS-RESPONSE)                  32080003
320900                        END-EXEC.                                 32090003
321000                                                                  32100003
321100     IF PV-CICS-RESPONSE NOT = DFHRESP (NORMAL)                   32110003
321200         SET DP013-LOGIC-ABEND                                    32120003
321300             DP013-NO-ROLLBACK TO TRUE                            32130003
321400         MOVE '9100-READ-SELECTION-QUEUE' TO DP013-PARAGRAPH      32140003
321500         MOVE 'UNSUCCESSFUL SELECTION TEMP STORAGE QUEUE READ' TO 32150003
321600                                            DP013-MESSAGE-TEXT (1)32160003
321700         PERFORM DP013-0000-PROCESS-ABEND                         32170003
321800     END-IF.                                                      32180003
321900                                                                  32190003
322000 9200-REWRITE-SELECTION-QUEUE.                                    32200003
322100                                                                  32210003
322200     EXEC CICS WRITEQ TS QUEUE   (ASC-SEL-QUEUE-NAME)             32220003
322300                         FROM    (VN003-VENDOR-SEL-REC)           32230003
322400                         ITEM    (ASC-SEL-ITEM)                   32240003
322500                         RESP    (PV-CICS-RESPONSE)               32250003
322600                         REWRITE                                  32260003
322700                         END-EXEC.                                32270003
322800                                                                  32280003
322900     IF PV-CICS-RESPONSE NOT = DFHRESP (NORMAL)                   32290003
323000         SET DP013-CICS-ABEND                                     32300003
323100             DP013-NO-ROLLBACK TO TRUE                            32310003
323200         MOVE '9200-REWRITE-SELECTION-QUEUE' TO DP013-PARAGRAPH   32320003
323300         MOVE 'UNSUCCESSFUL SELECTION TEMP STORAGE QUEUE REWRITE' 32330003
323400                                         TO DP013-MESSAGE-TEXT (1)32340003
323500         PERFORM DP013-0000-PROCESS-ABEND                         32350003
323600     END-IF.                                                      32360003
323700                                                                  32370003
323800******************************************************************32380003
323900*    ABEND PROCESSING                                             32390003
324000******************************************************************32400003
324100     COPY DPPD013.                                                32410003
