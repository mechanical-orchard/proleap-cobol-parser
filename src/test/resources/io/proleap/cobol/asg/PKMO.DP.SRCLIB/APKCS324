000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKCS324.                                         00020000
000300 AUTHOR.        MARC BLAZICH. G&R.                                00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  06-15-94.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    TRANID      - A324                                         * 00090000
001000*    TYPE        - CICS ARCHITECTURE INQUIRY - DB2              * 00100000
001100*    DESCRIPTION - AP - INVOICE INQUIRY                         * 00110000
001200*    MAPSET      - APKM324                                      * 00120000
001300*                                                               * 00130000
001400*    THIS PROGRAM WILL DISPLAY HIGH LEVEL INVOICE DATA.         * 00140000
001500*                                                               * 00150000
001600*---------------------------------------------------------------* 00160000
001700*---------------------------------------------------------------* 00170000
001800*                                                               * 00180000
001900* CHANGE LOG:                                                   * 00190000
002000*                                                               * 00200000
002100* 10/31/94    BMW  FIXED ALLW/CHARGE FLAG SO THAT IT IS SET     * 00210000
002200*                  CORRECTLY.                                   * 00220000
002300*                                                               * 00230000
002400* 01/17/95    BMW  REMOVED THE USE OF VALUE(PO_NBR, +0) IN THE  * 00240000
002500*                  WHERE CLAUSE SINCE IT WAS CAUSING TABLESCANS.* 00250000
002600*                                                               * 00260000
002700* 03/14/95  P.KEBER  CHANGED NEXT-ACT-RETURN LOGIC TO REBUILD   * 00270000
002800*                  THE SCREEN FROM THE COMMAREA.  ELIMINATED    * 00280000
002900*                  UNNECESSARY INTER-APPL-COMMAREA MOVES.  ADDED* 00290000
003000*                  NEW ENTRY USER ID FIELD TO SCREEN (IR#97).   * 00300000
003100*                  CORRECTED INVOICE STATUS CODE CHECK FOR PD   * 00310000
003200*                  TO PREVENT A BLANK SCREEN STATUS FOR PAID    * 00320000
003300*                  INVOICES (IR#112).                           * 00330000
003400*                                                               * 00340000
003500* 07/31/95    MJW  REMOVED MESSAGE 852 AND REPLACED WITH 858    * 00350000
003600*                                                               * 00360000
003700* 05/30/96    DSW  ADDED 'SPECIAL INSTRUCTIONS' TO SCREEN.      * 00370000
003800*                  (WR#3883)                                    * 00380000
003900* 03/21/97    MJW  ADDED LOGIC TO DISPLAY A DESCRIPTION FOR THE * 00390000
004000*                  WRITE OFF INVOICES.                          * 00400000
004100*                                                               * 00410000
004200* 04/09/97 MJW WR5901 ADD TO WHERE COND 'AND TERM_SEQ_NBR = 1'  * 00420000
004300*                     ADDED LOGIC TO DISPLAY BOTH THE PO AND    * 00430000
004400*                     THE INVOICE TERMS.                        * 00440000
004500*                                                               * 00450000
004600* 08/25/97    CJK  ADDED LOGIC TO DISPLAY EXPENSE INVOICES;     * 00460000
004700*  WR4164          ONE LABEL CHANGE, AND VARIOUS LOGIC CHANGES  * 00470000
004800*                  WERE REQUIRED. ADD LOGIC WILL NOT PASS INVC  * 00480000
004900*                  ID TO THE ADD PROGRAM.                       * 00490000
005000*          ***    ACCUMULATE ALLOWANCES ENTERED AS AMOUNTS TO   * 00500000
005100*                  BE SUBTRACTED FROM THE MDSE COST. THIS WILL  * 00510000
005200*                  CALCULATE THE CORRECT NET INVOICE AMOUNT.    * 00520000
005300*                                                               * 00530000
005400* 02/03/98   ROBIN BERNOSKI                  WR/IR #: WR5703    * 00540000
005500*            - MODIFIED THE MANNER IN WHICH THE STANDARD DATE   * 00550000
005600*              ROUTINE, DPKUT500, IS TO BE CALLED WITHIN A      * 00560000
005700*              PROGRAM SO THAT THE CALL IS DYNAMIC.             * 00570000
005800*            - REPLACED ++INCLUDES WITH COPY STATEMENTS.        * 00580000
005900*                                                               * 00590000
006000* 10/14/98   MIKE BESKE                      WR/IR #: 5998      * 00600000
006100*            PEOPLESOFT CONVERSION.  ELIMINATED THE COPYBOOKS   * 00610000
006200*            FOR IMS DATABASES.                                 * 00620000
006300*                                                               * 00630000
006400* 12/12/98   MIKE BESKE                      WR/IR #: 5998      * 00640000
006500*            PEOPLESOFT CONVERSION.  STARTED ALL COPYBOOKS IN   * 00650000
006600*            COL 12 PER Y2K RULES.                              * 00660000
006700*                                                               * 00670000
006800* 06/22/99   MIKE BESKE                      WR/IR #: 5998      * 00680000
006900*            PEOPLESOFT CONVERSION.  ADDED A DISPLAY FOR THE PAY* 00690000
007000*            RELEASE DATE TO THE SCREEN.  IT WILL NOT SHOW ANY  * 00700000
007100*            DATE IF THE VALUE IS 9999-09-09 (DEFAULT).  THE    * 00710000
007200*            ACTUAL VALUE FOR THIS DATE WILL COME FROM THE      * 00720000
007300*            AP_PRC_DTE.                                        * 00730000
007400*                                                               * 00740000
007500* 01/10/00   ROBIN BERNOSKI                  WR/IR #: 20537     * 00750000
007600*            MODIFICATIONS MADE TO INCLUDE TWO ADDITIONAL LINES * 00760000
007700*            ON THE AP-INVOICE INQUIRY SCREEN.  THE TWO FIELDS  * 00770000
007800*            ARE THE 'PAID ON' FIELD AND THE 'CHECK NUMBER'     * 00780000
007900*            FIELD.  THESE FIELDS WILL ONLY APPEAR WHEN THE     * 00790000
008000*            STATUS IS PAID AND A CHECK NUMBER EXISTS IN        * 00800000
008100*            PEOPLESOFT.                                        * 00810000
008200*                                                               * 00820000
008300* 08/11/00   W A EHMKE                       WR/IR #: 21186     * 00830000
008400*            THE EXPENSE INVOICE TABLE (TEXINVC) HAS BEEN       * 00840000
008500*            EXPANDED WITH A NEW COLUMN WHICH WILL CONTAIN A    * 00850000
008600*            'BOL' BILL OF LADING NUMBER.  MODIFY THE PROGRAM   * 00860000
008700*            LOGIC TO DISPLAY EITHER THE EXPENSE INVOICE        * 00870000
008800*            'EXINVC-IMPRT-BOL-ID' NUMBER OR THE 'EXINVC-IMPRT- * 00880000
008900*            ENTR-NBR' ON THE SCREEN.  DISPLAY WHICH EVER NUMBER* 00890000
009000*            OF THE TWO NUMBERS IS PRESENT.  THEY ARE MUTIALLY  * 00900000
009100*            EXCLUSIVE FIELDS.  THE DESTINATION IS A SHARRED    * 00910000
009200*            FIELD.                                             * 00920000
009300*                                                               * 00930000
009400* 08/30/00   MIKE BESKE                      WR/IR #: 20224     * 00940000
009500*            ADDED CODE TO FETCH THE ADDITIONAL EXTENDED DAYS   * 00950000
009600*            FROM TPOAGMT.  THIS IS PART OF THE MARK OUT OF     * 00960000
009700*            STOCK ENHANCEMENTS.                                * 00970000
009800*                                                               * 00980000
009900* 09/20/01   MIKE BESKE                      WR/IR #: 20530     * 00990000
010000*            ADDED A NEW LITERAL DESCRIPTION OF THE             * 01000000
010100*            INVOICE STATUS.  THE LITERAL 'PR' AND THE          * 01010000
010200*            DESCRIPTION IS 'PENDING RVW'.  MOD PARA 4400       * 01020000
010300*                                                               * 01030000
010400* 02/04/02   NANCY EILBES                    WR/IR #: 20530     * 01040000
010500*            MODIFIED LOGIC WHICH DECIDES WHETHER TO DISPLAY    * 01050000
010600*            THE BOL ID OR THE ENTRY NUMBER FOR IMPORT EXPENSE  * 01060000
010700*            INVOICES TO CHECK THE ENTRY NUMBER FIRST.  WITH    * 01070000
010800*            THE LOADING OF EDI210 INVOICES FOR EXPEDITORS,     * 01080000
010900*            BOTH FIELDS CAN NOW HAVE A VALUE ON THE DATABASE,  * 01090000
011000*            AND IN THIS CASE, THE ENTRY NUMBER SHOULD DISPLAY. * 01100000
011100*                                                               * 01110000
011200* 02/07/02   NANCY EILBES                    WR/IR #: 448294    * 01120000
011300*            INCREASED LENGTH OF CARTON COUNT FIELD FROM 4 TO 5.* 01130000
011400*                                                               * 01140000
011500*                                                               * 01150000
011600* 03/19/02   MIKE BESKE                      WR/IR #: 456854    * 01160000
011700*            ADDED CODE THAT WILL CORRECTLY FORMAT THE INVOICE  * 01170000
011800*            ID WHEN CHECKING PEOPLESOFT FOR THE CHECK NUMBER   * 01180000
011900*            IF THE INVOICE IS PAID. PARA 4180-                 * 01190000
012000*                                                               * 01200000
012100* 04/30/02   L SCHALLHORN                    WR/IR #: 23417     * 01210000
012200*            ADDED CODE THAT WILL CORRECTLY FORMAT THE CHECK    * 01220000
012300*            NUMBER FROM PEOPLESOFT TO A LENGTH OF 10.  VERSION * 01230000
012400*            8 CHECK NUMBER IS 20.                              * 01240000
012500*                                                               * 01250000
012600* 05/14/02   MIKE BESKE                      WR/IR #: 23500     * 01260000
012700*            REMOVED THE TPAYREQ TABLE AND ANY REFERENCES USING * 01270000
012800*            ITS COMPONENTS.  THESE WERE REPLACED BY THE NEW    * 01280000
012900*            TINVOIC TABLE AS PART OF THE ARK PO PHASE ONE PROJ.* 01290000
013000*                                                               * 01300000
013100* 08/24/02   KEVIN CATLIN                  WR/IR #: 23500       * 01310000
013200*            ARK PO PROJECT PHASE 1.  REMOVED TABLE TSTR000 AS  * 01320000
013300*            IT'S NOT BEING USED.  REPLACED PAYT-REQ-SEQ-NBR    * 01330000
013400*            WITH NEW INDEX OF PO_NBR AND INVC_ID FOR TABLES    * 01340000
013500*            TINVCTM AND TALCHRG.  PARAGRAPHS AFFECTED ARE      * 01350000
013600*            4160, 4170, AND 4175.                              * 01360000
013700*                                                               * 01370000
013800* 11/04/02   MIKE BESKE                      WR/IR #: 23750     * 01380000
013900*            COLBY DATING PROJECT. ADDED THE NEW STATUS DESC FOR* 01390000
014000*            'PJ'.                                              * 01400000
014100*                                                               * 01410000
014200*   02/10/2003                                                  * 01420000
014300*      CHANGED CALL TO PEOPLESOFT TABLE TO USE NEW ALIAS        * 01430000
014400*      NAMING STANDARD.                                         * 01440000
014500*   MADE BY: L SCHALLHORN                 WR#: 23417            * 01450000
014600*                                                               * 01460000
014700*   04/22/2004                                                  * 01470000
014800*      INCREASED THE STORE NBR SCREEN OUTPUT VARIABLE ASTRNBRO  * 01480000
014900*      TO HANDLE 4 CHARACTERS AS PART OF THE STORE CONSTRAINTS  * 01490000
015000*      PROJECT.                                                 * 01500000
015100*   MADE BY: MIKE BESKE                   WR#: 25805            * 01510000
015200*                                                               * 01520000
015300*   DATE  03/11/2007                                            * 01530000
015400*       CHANGE MADE: MATCH BY DC PROJECT                        * 01540000
015500*       ADDED CODE TO DISPLAY 4 ADDITIONAL FIELDS               * 01550000
015600*       ON THE ONLINE SCREEN FROM TINVOIC: DC_NBR, MTCH_LVL_CDE,* 01560000
015700*       CALC_DUE_DTE AND DUE_DTE_SRC_CDE.                       * 01570000
015800*       THE DUE DATE SOURCE CODE WILL BE                        * 01580000
015900*       REPRESENTED AS A SHORT DESCRIPTION.  MOD PARAS: 4010-,  * 01590000
016000*       4200-, 4400-.                                           * 01600000
016100*       MADE BY: MIKE BESKE              WR/IR #: WR21578       * 01610000
016200*                                                               * 01620000
016300*   05/14/2009                                                  * 01630000
016400*      MODIFIED PARA 4190- THAT GETS THE CHECK NUMBER FROM      * 01640000
016500*      PEOPLESOFT. SINCE PEOPLESOFT CAN HAVE TWO INVOICE ID'S   * 01650000
016600*      THAT ARE THE SAME EXCEPT FOR THE 'X' SUFFIX,BUT THE      * 01660000
016700*      TINVOIC WILL ONLY HAVE THE UN-SUFFIXED INVOICE-ID, THE   * 01670000
016800*      SQL INCLUDES PAYMENT_DATE > PAYMENT_RLSE_DATE CRITERIA   * 01680000
016900*      TO RETURN THE CORRECT INVOICE. ALSO, ADDED A RETRY LOGIC * 01690000
017000*      WITH THE 'X' SUFFIX WHEN THE ORIGINAL IS NOT FOUND.      * 01700000
017100*   MADE BY: SABITHA RAJARAM              WR#: 32642            * 01710000
017200*                                                               * 01720000
017300* DATE  01/11/2010                                              * 01730000
017400*     CHANGE MADE: REMOVED PO INSTRUCTIONS SECTION AND REPLACED * 01740000
017500*     WITH THE NEW TEXINVC COLUMNS.                             * 01750000
017600*     MADE BY: PAUL STROEDE            WR/IR #: WR23145         * 01760000
017700*                                                               * 01770000
017800* DATE  03/11/2010                                              * 01780000
017900*     CHANGE MADE: REPLACED THE DATE CONDITION IN PARAS 4190-   * 01790000
018000*     4195- THAT TRY TO FIND THE INVOICE ID ON PEOPLESOFT TO    * 01800000
018100*     RETRIEVE THE CHECK NUMBER AND PAYMENT DATE. THE DATE CON- * 01810000
018200*     DITION IS USING A 3 DAY RANGE BEFORE AND AFTER THE        * 01820000
018300*     INVC_DTE ON TINVOIC AND COMPARING IT TO THE INVOICE_DT ON * 01830000
018400*     PS_VOUCHER.  ADDED THE KOHLS DATE ROUTINE TO THE PROGRAM  * 01840000
018500*     TO CALCULATE THE LOW AND HIGH DATES FOR THIS RANGE.       * 01850000
018600*     MADE BY: MIKE BESKE              WR/IR #: PKE000000002370 * 01860000
018700* DATE  09/20/2011                                                01870000
018800*     CHANGE MADE: REMOVED DB2 CALL TO PEOPLESOFT TABLES          01880000
018900*     AND REPLACED WITH A CALL TO THE APKUT274 MODULE.  THIS      01890000
019000*     IS NEEDED AS A RESULT OF THE PEOPLESOFT FI UPGRADE AND      01900000
019100*     RE-PLATFORM AS PEOPLESOFT TABLES ARE NOW IN ORACLE.         01910000
019200*     CALLS TO THE 4950-VALIDATE-ACCOUNT-NO PARAGRAPH ARE         01920000
019300*     REMOVED AND REPLACED WITH A CALL TO APKUT274.               01930000
019400*     ALSO EXCHANGED THE XFT00003 PEOPLE SOFT TABLE WITH THE DB2  01940000
019500*     VERSION - XFT00017 TABLE.                                   01950000
019600*     IT STILL USES DP013-DB2-ABEND SO RELEVANT INFO IS DISPLAYED.01960000
019700*     MADE BY: STEVE KRIEG             WR/IR #: WR37038           01970000
019800* DATE  10/29/2014                                                01980000
019900*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                     01990000
020000*     EXTENDED PO# FROM 7 TO 9.                                   02000000
020100*     MADE BY: COGNIZANT               WR/IR #: CHG0094517        02010000
020200*---------------------------------------------------------------* 02020000
020300* DATE  09/27/2018                                                02030000
020400*     CHANGE MADE: MAINFRAME REFACTORING - REMOVED CGU042MC.      02040000
020500*     MADE BY: JIM HUNTER              WR/IR #: CHG0208819        02050000
020600*---------------------------------------------------------------* 02060000
020610* DATE  04/05/2019                                                02061000
020620*     CHANGE MADE: CHANGES TO REMOVE APKUT274 WHICH RETURNS CHECK 02062000
020621*     NUMBER FROM PEOPLESOFT AND TO MOVE THE INVOIC-BAR-CDE FIELD 02062100
020622*     TO THE CHECK NUMBER FIELD INSTEAD.  BAR-CDE FIELD IS BEING  02062200
020623*     REPURPOSED TO HOLD THE CHECK NUMBER - UPDATED IN APKUP063   02062300
020624*     REMOVED BARCODE FIELD IN APKM324 AND ALL HANDLING OF BARCODE02062400
020625*     FOR ITS FORMER PURPOSE FROM THE PROGRAM.                    02062500
020630*     MADE BY: COGNIZANT               WR/IR #: CHG0220043        02063000
020631* DATE  05/13/2021                                                02063105
020632*     CHANGE MADE: DISPLAY INVOICES WITH STATUS PJ (SEPHORA       02063203
020633*     PREPAID) THE SAME AS INVOICES WITH STATUS PD                02063303
020638*     MADE BY: JEAN KURK               WR/IR #: CHG0256549        02063803
020639* DATE  10/21/2022                                                02063905
020640*     ADD COPYBOOK DPWS930                                        02064005
020642*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API    02064205
020643*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864        02064305
020650*---------------------------------------------------------------* 02065000
020700                                                                  02070000
020800 ENVIRONMENT DIVISION.                                            02080000
020900 DATA DIVISION.                                                   02090000
021000                                                                  02100000
021100/                                                                 02110000
021200 WORKING-STORAGE SECTION.                                         02120000
021300                                                                  02130000
021400 01  DK-DB2-KEYS.                                                 02140000
021500     05  DK-INVC-ID                   PIC  X(22).                 02150000
021600     05  DK-PO-NBR-LOW                PIC S9(09) VALUE +0         02160000
021700                                                 COMP.            02170000
021800     05  DK-PO-NBR-HIGH               PIC S9(09) VALUE +0         02180000
021900                                                 COMP.            02190000
022000     05  DK-ENT-ID                    PIC S9(09) VALUE +0         02200000
022100                                                 COMP.            02210000
022200     05  DK-INVC-TYP-CDE1               PIC  X(02).               02220000
022300     05  DK-INVC-TYP-CDE2               PIC  X(02).               02230000
022400                                                                  02240000
022500 01  PC-PROGRAM-CONSTANTS.                                        02250000
022600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         02260000
022700                                                    'AP324A  '.   02270000
022800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         02280000
022900                                                    'APKM324 '.   02290000
023000     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     02300000
023100                                                    COMP.         02310000
023200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         02320000
023300                                                    'APKCS324'.   02330000
023400     05  PC-DPKUT100                    PIC  X(08)  VALUE         02340000
023500                                                    'DPKUT100'.   02350000
023800     05  PC-NULL-DATE                   PIC  X(10)  VALUE         02380000
023900                                                    '9999-09-09'. 02390000
024000     05  PC-NET-COST-ENTRY-DATE         PIC  X(10)  VALUE         02400000
024100                                                    '1997-05-01'. 02410000
024200     05  PC-PRIME1                      PIC S9(05)   COMP-3       02420000
024300                                            VALUE +38543.         02430000
024400     05  PC-PRIME2                      PIC S9(05)   COMP-3       02440000
024500                                            VALUE +58889.         02450000
024600     05  PC-ONE-BILLION                 PIC S9(11)   COMP-3       02460000
024700                                            VALUE +1000000000.    02470000
024800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      02480000
024900                                                    COMP-3.       02490000
025000     05  PC-TSYMSG-NUMBERS.                                       02500000
025100         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. 02510000
025200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 02520000
025300         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 02530000
025400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 02540000
025500         10  PC-TSYMSG-00009            PIC  9(05)  VALUE  00009. 02550000
025600         10  PC-TSYMSG-00016            PIC  9(05)  VALUE  00016. 02560000
025700         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. 02570000
025800         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 02580000
025900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE  00047. 02590000
026000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 02600000
026100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 02610000
026200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 02620000
026300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 02630000
026400         10  PC-TSYMSG-00112            PIC  9(05)  VALUE  00112. 02640000
026500         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 02650000
026600         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 02660000
026700         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 02670000
026800         10  PC-TSYMSG-00118            PIC  9(05)  VALUE  00118. 02680000
026900         10  PC-TSYMSG-00134            PIC  9(05)  VALUE  00134. 02690000
027000         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 02700000
027100         10  PC-TSYMSG-00158            PIC  9(05)  VALUE  00158. 02710000
027200         10  PC-TSYMSG-00164            PIC  9(05)  VALUE  00164. 02720000
027300         10  PC-TSYMSG-00165            PIC  9(05)  VALUE  00165. 02730000
027400         10  PC-TSYMSG-00224            PIC  9(05)  VALUE  00224. 02740000
027500         10  PC-TSYMSG-00231            PIC  9(05)  VALUE  00231. 02750000
027600         10  PC-TSYMSG-00349            PIC  9(05)  VALUE  00349. 02760000
027700         10  PC-TSYMSG-00354            PIC  9(05)  VALUE  00354. 02770000
027800         10  PC-TSYMSG-00396            PIC  9(05)  VALUE  00396. 02780000
027900         10  PC-TSYMSG-00482            PIC  9(05)  VALUE  00482. 02790000
028000         10  PC-TSYMSG-00494            PIC  9(05)  VALUE  00494. 02800000
028100         10  PC-TSYMSG-00601            PIC  9(05)  VALUE  00601. 02810000
028200         10  PC-TSYMSG-00726            PIC  9(05)  VALUE  00726. 02820000
028300         10  PC-TSYMSG-00849            PIC  9(05)  VALUE  00849. 02830000
028400         10  PC-TSYMSG-00855            PIC  9(05)  VALUE  00855. 02840000
028500         10  PC-TSYMSG-00858            PIC  9(05)  VALUE  00858. 02850000
028600         10  PC-TSYMSG-01564            PIC  9(05)  VALUE  01564. 02860000
028700     05  PC-TYP-CDE-CHARGE              PIC  X(01)  VALUE 'C'.    02870000
028800     05  PC-BILL-OF-LADING              PIC  X(15)                02880000
028900                                VALUE 'BILL OF LADING:'.          02890000
029000                                                                  02900000
029100 01  PV-PROGRAM-VARIABLES.                                        02910000
029200                                                                  02920000
029300     05  PV-DOCNO                       PIC X(10).                02930000
029400     05  PV-STRING                      PIC X(22).                02940000
029500     05  PV-START                       PIC S9(04) VALUE +0 COMP. 02950000
029600     05  PV-INVC-ID-LEN                 PIC S9(04) VALUE +0 COMP. 02960000
029700     05  PV-CHAR-COUNT                  PIC  99    VALUE  0.      02970000
029800     05  PV-INVC-ID                     PIC X(16).                02980000
029900     05  PV-INVC-ID-X                   PIC X(17)  VALUE SPACES.  02990000
030000     05  PV-DISC-PAY-DAY-QTY            PIC S9(4) COMP.           03000000
030100                                                                  03010000
030200     05  PV-NULL-INDICATOR.                                       03020000
030300         10  ALCHRG-AMOUNT-NN           PIC S9(4) COMP.           03030000
030400     05  PV-SUM-OF-CHARGES              PIC S9(11)V9(2)           03040000
030500                                                      COMP-3      03050000
030600                                                      VALUE +0.   03060000
030700     05  PV-NET-INVC-AMT                PIC S9(09)V99 COMP-3      03070000
030800                                                      VALUE +0.   03080000
030900     05  PV-SUM-OF-ALLOWANCES           PIC S9(11)V9(2)           03090000
031000                                                      COMP-3      03100000
031100                                                      VALUE +0.   03110000
031200     05  PV-DB2-COUNT                   PIC S9(9) COMP.           03120000
031300     05  PV-NUM3                        PIC Z(3).                 03130000
031400     05  PV-NUM3-X REDEFINES                                      03140000
031500         PV-NUM3                        PIC X(3).                 03150000
031600     05  PV-NUM3-9 REDEFINES                                      03160000
031700         PV-NUM3                        PIC 9(3).                 03170000
031800     05  PV-NUM4                        PIC Z(4).                 03180000
031900     05  PV-NUM4-X REDEFINES                                      03190000
032000         PV-NUM4                        PIC X(4).                 03200000
032100     05  PV-NUM4-9 REDEFINES                                      03210000
032200         PV-NUM4                        PIC 9(4).                 03220000
032300     05  PV-NUM9                        PIC Z(9).                 03230000
032400     05  PV-NUM9-X REDEFINES                                      03240000
032500         PV-NUM9                        PIC X(9).                 03250000
032600     05  PV-NUM11                       PIC Z(11).                03260000
032700     05  PV-NUM11-X REDEFINES                                     03270000
032800         PV-NUM11                       PIC X(11).                03280000
032900     05  PV-8V99                        PIC Z(8).99.              03290000
033000     05  PV-8V99-X REDEFINES                                      03300000
033100         PV-8V99                        PIC X(11).                03310000
033200     05  PV-3V99                        PIC Z(3).99.              03320000
033300     05  PV-3V99-X REDEFINES                                      03330000
033400         PV-3V99                        PIC X(06).                03340000
033500     05  PV-2V99                        PIC Z(2).99.              03350000
033600     05  PV-2V99-X REDEFINES                                      03360000
033700         PV-2V99                        PIC X(05).                03370000
033800     05  PV-WHOLE-PCT                   PIC 9(3).                 03380000
033900     05  PV-WHOLE-PCT-X REDEFINES                                 03390000
034000         PV-WHOLE-PCT                   PIC X(3).                 03400000
034100                                                                  03410000
034200     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      03420000
034300                                                    COMP SYNC.    03430000
034400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      03440000
034500                                                    COMP SYNC.    03450000
034600     05  PV-WORK-FIELD                   PIC S9(17)   COMP-3      03460000
034700                                                      VALUE +0.   03470000
034800     05  PV-WORK-FIELD2                  PIC S9(17)   COMP-3      03480000
034900                                                      VALUE +0.   03490000
035000                                                                  03500000
035100     05  PV-CCYYMMDD-DATE               PIC  X(10).               03510000
035200     05  PV-CCYYMMDD-DATE-RDF           REDEFINES                 03520000
035300         PV-CCYYMMDD-DATE.                                        03530000
035400         10  PV-CCYY                    PIC  X(04).               03540000
035500         10  PV-CCYY-9   REDEFINES PV-CCYY                        03550000
035600                                        PIC  9(04).               03560000
035700         10  PV-CCYY-RDF REDEFINES PV-CCYY.                       03570000
035800             15  PV-CC                  PIC  9(02).               03580000
035900             15  PV-YY                  PIC  9(02).               03590000
036000         10  PV-DASH1                   PIC  X(01).               03600000
036100         10  PV-MM                      PIC  X(02).               03610000
036200         10  PV-MM-9     REDEFINES PV-MM                          03620000
036300                                        PIC  9(02).               03630000
036400         10  PV-DASH2                   PIC  X(01).               03640000
036500         10  PV-DD                      PIC  X(02).               03650000
036600         10  PV-DD-9     REDEFINES PV-DD                          03660000
036700                                        PIC  9(02).               03670000
036800     05  PV-DUP-COUNTER                 PIC S9(04) COMP.          03680000
036900     05  PV-STATUS-CHG-DATE             PIC X(10)  VALUE SPACES.  03690000
037000     05  PV-HOLD-PAY-DATE.                                        03700000
037100         10  PV-HOLD-PAY-YEAR          PIC X(04)   VALUE SPACES.  03710000
037200         10  FILLER                    PIC X(01)   VALUE SPACES.  03720000
037300         10  PV-HOLD-PAY-MONTH         PIC X(02)   VALUE SPACES.  03730000
037400         10  FILLER                    PIC X(01)   VALUE SPACES.  03740000
037500         10  PV-HOLD-PAY-DAY           PIC X(02)   VALUE SPACES.  03750000
037600     05  PV-INVC-DTE                   PIC X(10)   VALUE SPACES.  03760000
037700     05  PV-INVC-DTE-LOW               PIC X(10)   VALUE SPACES.  03770000
037800     05  PV-INVC-DTE-HIGH              PIC X(10)   VALUE SPACES.  03780000
037900                                                                  03790000
038000 01  PV-REFORMAT-PAY-DATE.                                        03800000
038100     05  PV-REFORMATTED-MONTH           PIC X(02)   VALUE SPACES. 03810000
038200     05  FILLER                         PIC X(01)   VALUE '/'.    03820000
038300     05  PV-REFORMATTED-DAY             PIC X(02)   VALUE SPACES. 03830000
038400     05  FILLER                         PIC X(01)   VALUE '/'.    03840000
038500     05  PV-REFORMATTED-YEAR            PIC X(04)   VALUE SPACES. 03850000
038600                                                                  03860000
038700 01  PS-PROGRAM-SWITCHES.                                         03870000
038800     05  PS-VALID-DATE-SW               PIC  X(01).               03880000
038900         88  PS-VALID-DATE                          VALUE 'Y'.    03890000
039000         88  PS-INVALID-DATE                        VALUE 'N'.    03900000
039100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    03910000
039200         88  PS-NO-ERROR                            VALUE 'Y'.    03920000
039300         88  PS-ERROR                               VALUE 'N'.    03930000
039400     05  PS-TALCHRG-EXISTS-SW           PIC X.                    03940000
039500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    03950000
039600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    03960000
039700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    03970000
039800     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    03980000
039900         88  PS-DONE                                VALUE 'Y'.    03990000
040000         88  PS-NOT-DONE                            VALUE 'N'.    04000000
040100     05  PS-IMPRT-ENTR-NMR-SW           PIC  X(01)  VALUE 'N'.    04010000
040200         88  PS-IMPRT-ENTR-NBR-YES                  VALUE 'Y'.    04020000
040300         88  PS-IMPRT-ENTR-NBR-NO                   VALUE 'N'.    04030000
040400/                                                                 04040000
040600*---------------------------------------------------------------* 04060000
040700*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 04070000
040800*---------------------------------------------------------------* 04080000
040900                                                                  04090000
041000     COPY APWS301.                                                04100000
041100                                                                  04110000
041200/                                                                 04120000
041300*---------------------------------------------------------------* 04130000
041400*    MAP LAYOUT                                                 * 04140000
041500*---------------------------------------------------------------* 04150000
041600                                                                  04160000
041700     COPY APKM324.                                                04170000
041800                                                                  04180000
041900/                                                                 04190000
042000*---------------------------------------------------------------* 04200000
042100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04210000
042200*---------------------------------------------------------------* 04220000
042300                                                                  04230000
042400     COPY DPWS015.                                                04240000
042500                                                                  04250000
042600*---------------------------------------------------------------* 04260000
042700*    FUNCTION KEYS COPYBOOK.                                    * 04270000
042800*---------------------------------------------------------------* 04280000
042900                                                                  04290000
043000     COPY DPWS016.                                                04300000
043100                                                                  04310000
043200/                                                                 04320000
043300*---------------------------------------------------------------* 04330000
043400*  WORK AREA FOR NUMERIC EDIT ROUTINE - DPKUT100                * 04340000
043500*---------------------------------------------------------------* 04350000
043600     COPY DPWS010I.                                               04360000
043700                                                                  04370000
043800/                                                                 04380000
043900*---------------------------------------------------------------* 04390000
044000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 04400000
044100*---------------------------------------------------------------* 04410000
044200                                                                  04420000
044300     COPY DPWS030.                                                04430000
044310     COPY DPWS930.                                                04431005
044400                                                                  04440000
044500/                                                                 04450000
044600*--------------------------------------------------------------*  04460000
044700* WORK AREA PASSED IN CALL TO DPKUT500 DATE ROUTINE            *  04470000
044800*--------------------------------------------------------------*  04480000
044900     COPY DPWS500.                                                04490000
045000                                                                  04500000
045100/                                                                 04510000
045600*---------------------------------------------------------------* 04560000
045700*    STANDARD COMMAREA.                                         * 04570000
045800*---------------------------------------------------------------* 04580000
045900                                                                  04590000
046000     COPY DPWS020.                                                04600000
046100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04610000
046200                                                                  04620000
046300         10  INTER-APPL-COMM-AREA       PIC X(200).               04630000
046400     COPY APWS300.                                                04640000
046500*---------------------------------------------------------------* 04650000
046600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04660000
046700*---------------------------------------------------------------* 04670000
046800         10  ASC-SPECIFIC-COMMAREA.                               04680000
046900             15  ASC-INT-APPL-FORMAT-IND    PIC X(01).            04690000
047000                 88  ASC-INTER-APPL-CRIT-SPEC    VALUE '1'.       04700000
047100                 88  ASC-INTER-APPL-LIST         VALUE '5'.       04710000
047200             15  ASC-INVOICE-FOUND-SW       PIC X(01).            04720000
047300                 88  ASC-INVOICE-FOUND      VALUE 'Y'.            04730000
047400                 88  ASC-INVOICE-NOT-FOUND  VALUE 'N'.            04740000
047500                 88  ASC-INVOICE-DUPLICATE  VALUE 'D'.            04750000
047600             15  ASC-TALCHRG-EXISTS-SW      PIC X(01).            04760000
047700                 88  ASC-TALCHRG-EXISTS     VALUE 'Y'.            04770000
047800             15  ASC-KEY-FIELDS.                                  04780000
047900                 20  ASC-KEY-PAYT-REQ-SEQ-NBR     PIC S9(09) COMP.04790000
048000                 20  ASC-KEY-PO-NBR               PIC S9(09) COMP.04800000
048100                 20  ASC-KEY-INVC-ID              PIC  X(22).     04810000
048200                 20  ASC-KEY-INVC-STATUS          PIC  X(02).     04820000
048300                 20  ASC-KEY-INVC-TYP-CDE         PIC  X(02).     04830000
048400                     88  ASC-VALID-INVC-TYP    VALUE 'EI', 'MI'.  04840000
048500                     88  ASC-EXPENSE-INVC        VALUE 'EI'.      04850000
048600             15  ASC-ORIGINAL-FIELD-VALUES.                       04860000
048700                 20  ASC-PO-NBR                   PIC S9(09) COMP.04870000
048800                 20  ASC-DUN-NBR                  PIC  X(09).     04880000
048900                 20  ASC-HOLD-IND                 PIC  X(01).     04890000
049000                 20  ASC-INVC-DTE                 PIC  X(10).     04900000
049100                 20  FILLER REDEFINES                             04910000
049200                     ASC-INVC-DTE.                                04920000
049300                     25  ASC-INVC-DTE-CC          PIC  X(02).     04930000
049400                     25  ASC-INVC-DTE-YY          PIC  X(02).     04940000
049500                     25  FILLER                   PIC  X(01).     04950000
049600                     25  ASC-INVC-DTE-MM          PIC  X(02).     04960000
049700                     25  FILLER                   PIC  X(01).     04970000
049800                     25  ASC-INVC-DTE-DD          PIC  X(02).     04980000
049900                 20  ASC-BAR-CDE                  PIC  X(09).     04990000
050000                 20  ASC-STR-NBR                  PIC S9(04) COMP.05000000
050100                 20  ASC-GRO-COST-AMT             PIC S9(08)V99   05010000
050200                                                       COMP-3.    05020000
050300                 20  ASC-TOT-INVC-PC-QTY          PIC S9(09) COMP.05030000
050400                 20  ASC-TERM-SEL-CDE             PIC  X(01).     05040000
050500                 20  ASC-PO-SEL                   PIC  X(01).     05050000
050600                 20  ASC-IN-SEL                   PIC  X(01).     05060000
050700                 20  ASC-IN-DISC-PCT              PIC  99V99.     05070000
050800                 20  ASC-IN-DISC-DUE-DAY-QTY      PIC S9(04) COMP.05080000
050900                 20  ASC-IN-EOM                   PIC  X(01).     05090000
051000                 20  ASC-IN-TERM-TYP-CDE          PIC  X(02).     05100000
051100                 20  ASC-IN-EXTD-DAYS-QTY         PIC S9(04) COMP.05110000
051200                 20  ASC-IN-SPLIT-TERMS-IND       PIC  X(01).     05120000
051300                 20  ASC-KOHLS-FRGT-PCT           PIC S9V9(04)    05130000
051400                                                       COMP-3.    05140000
051500                 20  ASC-VEND-FRGT-PCT            PIC S9V9(04)    05150000
051600                                                       COMP-3.    05160000
051700                 20  ASC-KOHLS-FRGT-PCT-NUM       PIC   9(03).    05170000
051800                 20  ASC-VEND-FRGT-PCT-NUM        PIC   9(03).    05180000
051900                 20  ASC-BOL-ID                   PIC   X(30).    05190000
052000                 20  ASC-CONTAINER-ID             PIC   X(12).    05200000
052100                 20  ASC-ENTRY-NBR                PIC   X(16).    05210000
052200                 20  ASC-BKR-REF-NBR              PIC   X(16).    05220000
052300                 20  ASC-IMPRT-CHRG-CDE           PIC   X(03).    05230000
052400                 20  ASC-CARTON-CNT               PIC S9(04) COMP.05240000
052500                                                                  05250000
052600             15  ASC-OTHER-FIELDS.                                05260000
052700                 20  ASC-ENT-DATA.                                05270000
052800                     25  ASC-HOLD-VENDOR          PIC  X.         05280000
052900                     25  ASC-ENT-NAME-DESC        PIC  X(40).     05290000
053000                     25  ASC-ADDRESS-LINE1-DESC   PIC  X(40).     05300000
053100                     25  ASC-ADDRESS-LINE2-DESC   PIC  X(40).     05310000
053200                     25  ASC-CITY-NAME            PIC  X(15).     05320000
053300                     25  ASC-STATE-CDE            PIC  X(02).     05330000
053400                     25  ASC-ZIP-CDE              PIC  X(12).     05340000
053500                     25  ASC-DEPT-NBR             PIC  X(03).     05350000
053600                 20  ASC-NET-INVC-AMT             PIC S9(09)V99   05360000
053700                                                       COMP-3.    05370000
053800                 20  ASC-PO-DISCOUNT-PCT          PIC S99V99.     05380000
053900                 20  ASC-PO-DISCOUNT-DAYS-QTY     PIC S9(04) COMP.05390000
054000                 20  ASC-PO-DUE-DAY-FR-DTE-TXT    PIC  X(17).     05400000
054100                 20  ASC-PO-DISC-PAY-DAY-QTY      PIC S9(04) COMP.05410000
054200*                20  ASC-KEY-INVC-TYP-CDE         PIC  X(02).     05420000
054300                 20  ASC-ENTR-MTHD-CDE            PIC  X(02).     05430000
054400                 20  ASC-CRE-BY-USR-ID            PIC  X(08).     05440000
054500                 20  ASC-CRE-DTE                  PIC  X(10).     05450000
054600                 20  FILLER REDEFINES                             05460000
054700                     ASC-CRE-DTE.                                 05470000
054800                     25  ASC-CRE-DTE-CC           PIC  X(02).     05480000
054900                     25  ASC-CRE-DTE-YY           PIC  X(02).     05490000
055000                     25  FILLER                   PIC  X(01).     05500000
055100                     25  ASC-CRE-DTE-MM           PIC  X(02).     05510000
055200                     25  FILLER                   PIC  X(01).     05520000
055300                     25  ASC-CRE-DTE-DD           PIC  X(02).     05530000
055400                 20  ASC-PAYRLSE-DTE              PIC  X(10).     05540000
055500                 20  FILLER REDEFINES                             05550000
055600                     ASC-PAYRLSE-DTE.                             05560000
055700                     25  ASC-PAYRLSE-DTE-CC       PIC  X(02).     05570000
055800                     25  ASC-PAYRLSE-DTE-YY       PIC  X(02).     05580000
055900                     25  FILLER                   PIC  X(01).     05590000
056000                     25  ASC-PAYRLSE-DTE-MM       PIC  X(02).     05600000
056100                     25  FILLER                   PIC  X(01).     05610000
056200                     25  ASC-PAYRLSE-DTE-DD       PIC  X(02).     05620000
056300                 20  ASC-PAID-DATE                PIC  X(10).     05630000
056400                 20  ASC-CHECK-NBR                PIC  X(10).     05640000
056500                 20  ASC-CURRENT-TIMESTAMP        PIC  X(26).     05650000
056600                 20  ASC-CURRENT-TS-RDF       REDEFINES           05660000
056700                     ASC-CURRENT-TIMESTAMP.                       05670000
056800                     25  ASC-CURRENT-DATE         PIC X(10).      05680000
056900                     25  FILLER                   PIC X(01).      05690000
057000                     25  ASC-CURRENT-TIME.                        05700000
057100                         30  ASC-HH               PIC 9(02).      05710000
057200                         30  FILLER               PIC X(01).      05720000
057300                         30  ASC-MIN              PIC 9(02).      05730000
057400                         30  FILLER               PIC X(01).      05740000
057500                         30  ASC-SEC              PIC 9(02).      05750000
057600                         30  FILLER               PIC X(01).      05760000
057700                         30  ASC-MILLI-SEC        PIC 9(06).      05770000
057800                 20  ASC-DC-NBR                   PIC S9(04) COMP.05780000
057900                 20  ASC-MTCH-LVL-CDE             PIC  X(01).     05790000
058000                 20  ASC-DUE-DTE-SRC-CDE          PIC  X(01).     05800000
058100                 20  ASC-CALC-DTE                 PIC  X(10).     05810000
058200                 20  FILLER REDEFINES                             05820000
058300                     ASC-CALC-DTE.                                05830000
058400                     25  ASC-CALC-DTE-CC          PIC  X(02).     05840000
058500                     25  ASC-CALC-DTE-YY          PIC  X(02).     05850000
058600                     25  FILLER                   PIC  X(01).     05860000
058700                     25  ASC-CALC-DTE-MM          PIC  X(02).     05870000
058800                     25  FILLER                   PIC  X(01).     05880000
058900                     25  ASC-CALC-DTE-DD          PIC  X(02).     05890000
059000             15  ASC-USE-SELECTION-QUEUE-IND                      05900000
059100                                        PIC  X(01).               05910000
059200                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    05920000
059300             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               05930000
059400             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       05940000
059500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     05950000
059600                                        PIC S9(09)  COMP-3.       05960000
059700             15  ASC-SEL-SUB            PIC S9(04)  COMP.         05970000
059800             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         05980000
059900                                                                  05990000
060000/                                                                 06000000
060100*---------------------------------------------------------------* 06010000
060200*    ABEND PROCESSING COPYBOOK.                                 * 06020000
060300*---------------------------------------------------------------* 06030000
060400                                                                  06040000
060500     COPY DPWS013.                                                06050000
060600                                                                  06060000
060700/                                                                 06070000
060800*---------------------------------------------------------------* 06080000
060900*    DB2 TABLE LAYOUTS                                          * 06090000
061000*---------------------------------------------------------------* 06100000
061100                                                                  06110000
061200     EXEC SQL INCLUDE TEXTENT  END-EXEC.                          06120000
061300/                                                                 06130000
061400     EXEC SQL INCLUDE TBUSLOC  END-EXEC.                          06140000
061500/                                                                 06150000
061600     EXEC SQL INCLUDE TENTNME  END-EXEC.                          06160000
061700/                                                                 06170000
061800     EXEC SQL INCLUDE TPAYTRM  END-EXEC.                          06180000
061900/                                                                 06190000
062000     EXEC SQL INCLUDE TPURCHS  END-EXEC.                          06200000
062100/                                                                 06210000
062200     EXEC SQL INCLUDE TPLNSHP  END-EXEC.                          06220000
062300/                                                                 06230000
062400     EXEC SQL INCLUDE TPOAGMT  END-EXEC.                          06240000
062500/                                                                 06250000
062600     EXEC SQL INCLUDE TINVOIC  END-EXEC.                          06260000
062700/                                                                 06270000
062800     EXEC SQL INCLUDE TEXINVC  END-EXEC.                          06280000
062900/                                                                 06290000
063000     EXEC SQL INCLUDE TMDINVC  END-EXEC.                          06300000
063100/                                                                 06310000
063200     EXEC SQL INCLUDE TINVCTM  END-EXEC.                          06320000
063300/                                                                 06330000
063400     EXEC SQL INCLUDE TALCHRG  END-EXEC.                          06340000
063500/                                                                 06350000
063600*                                                                 06360000
063700*    EXEC SQL INCLUDE PFI00018 END-EXEC.                          06370000
063800*                                                                 06380000
063900*    EXEC SQL INCLUDE PFI00021 END-EXEC.                          06390000
064000*                                                                 06400000
064100*    EXEC SQL INCLUDE PFI00023 END-EXEC.                          06410000
064200/                                                                 06420000
064300*---------------------------------------------------------------* 06430000
064400*    DB2 AREA FOR COMMUNICATIONS                                * 06440000
064500*---------------------------------------------------------------* 06450000
064600     EXEC SQL                                                     06460000
064700          INCLUDE  SQLCA                                          06470000
064800     END-EXEC.                                                    06480000
064900                                                                  06490000
065000/                                                                 06500000
065100 LINKAGE SECTION.                                                 06510000
065200                                                                  06520000
065300 01  DFHCOMMAREA.                                                 06530000
065400     05  FILLER                         OCCURS  1 TO 4072 TIMES   06540000
065500                                        DEPENDING ON EIBCALEN.    06550000
065600         10  FILLER                     PIC X.                    06560000
065700                                                                  06570000
065800/                                                                 06580000
065900 PROCEDURE DIVISION.                                              06590000
066000*---------------------------------------------------------------* 06600000
066100*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 06610000
066200*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 06620000
066300*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 06630000
066400*---------------------------------------------------------------* 06640000
066500 0000-MAIN-MODULE.                                                06650000
066600                                                                  06660000
066700     INITIALIZE DP030-CICS-API-FIELDS.                            06670000
066800                                                                  06680000
066900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06690000
067000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06700000
067100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06710000
067200                                                                  06720000
067300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06730000
067400                                                                  06740000
067500     MOVE LENGTH OF AP324AI        TO DP030-MAP-LENGTH (1).       06750000
067600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06760000
067700                                                                  06770000
067800     PERFORM 0001-CALL-CICS-ARCH-API.                             06780000
067900     PERFORM 1000-CONTROL-PROCESSING                              06790000
068000                                                                  06800000
068100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06810000
068200     PERFORM 0001-CALL-CICS-ARCH-API.                             06820000
068300                                                                  06830000
068400*---------------------------------------------------------------* 06840000
068500*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 06850000
068600*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 06860000
068700*---------------------------------------------------------------* 06870000
068800 0001-CALL-CICS-ARCH-API.                                         06880000
068900     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06890005
069000                                    DFHCOMMAREA                   06900005
069100                                    DP030-CICS-API-FIELDS         06910005
069200                                    DP020-STANDARD-COMMAREA       06920005
069300                                    AP324AI.                      06930005
069400                                                                  06940000
069500     IF  DP030-RC-CALL-SUCCESSFUL                                 06950000
069600         CONTINUE                                                 06960000
069700     ELSE                                                         06970000
069800         SET DP013-NO-ROLLBACK                                    06980000
069900             DP013-XCTL-DISPLAY-RESTART                           06990000
070000             DP013-CICS-ABEND      TO TRUE                        07000000
070100         MOVE '0001-CALL-CICS-ARCH-API'                           07010000
070200                                   TO DP013-PARAGRAPH             07020000
070410         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07041005
070420-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07042005
070500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07050000
070600         PERFORM DP013-0000-PROCESS-ABEND                         07060000
070700     END-IF.                                                      07070000
070800                                                                  07080000
070900*---------------------------------------------------------------- 07090000
071000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       07100000
071100* COURSE OF ACTION IS FOR THIS TRANSACTION.                       07110000
071200*---------------------------------------------------------------- 07120000
071300                                                                  07130000
071400 1000-CONTROL-PROCESSING.                                         07140000
071500                                                                  07150000
071600     EVALUATE TRUE                                                07160000
071700         WHEN DP020-NEXT-ACT-INITIAL                              07170000
071800              PERFORM 1100-FIND-OBJECT-KEYS                       07180000
071900              IF  PS-ERROR                                        07190000
072000                  CONTINUE                                        07200000
072100              ELSE                                                07210000
072200                  PERFORM 4000-BUILD-INITIAL-PANEL                07220000
072300              END-IF                                              07230000
072400                                                                  07240000
072500         WHEN DP020-NEXT-ACT-READ-MAP                             07250000
072600             PERFORM 2000-PROCESS-PANEL                           07260000
072700                                                                  07270000
072800         WHEN DP020-NEXT-ACT-RETURN                               07280000
072900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07290000
073000                                                                  07300000
073100         WHEN OTHER                                               07310000
073200             SET DP013-LOGIC-ABEND TO TRUE                        07320000
073300             SET DP013-NO-ROLLBACK TO TRUE                        07330000
073400             MOVE '1000-CONTROL-PROCESSING'                       07340000
073500                                   TO DP013-PARAGRAPH             07350000
073600             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   07360000
073700                                   TO DP013-MESSAGE-TEXT(1)       07370000
073800             MOVE DP020-NEXT-APPL-ACTIVITY                        07380000
073900                                   TO DP013-MESSAGE-TEXT(2)       07390000
074000             PERFORM DP013-0000-PROCESS-ABEND                     07400000
074100     END-EVALUATE.                                                07410000
074200                                                                  07420000
074300/                                                                 07430000
074400*---------------------------------------------------------------- 07440000
074500*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE     07450000
074600*  INTER-APPLICATION FORMAT CODE.                                 07460000
074700*---------------------------------------------------------------- 07470000
074800 1100-FIND-OBJECT-KEYS.                                           07480000
074900                                                                  07490000
075000     INITIALIZE ASC-SPECIFIC-COMMAREA.                            07500000
075100                                                                  07510000
075200     MOVE DP020-INT-APPL-FORMAT-IND                               07520000
075300                                 TO ASC-INT-APPL-FORMAT-IND.      07530000
075400     MOVE AP300-INVC-ID          TO ASC-KEY-INVC-ID.              07540000
075500     MOVE AP300-PO-NBR           TO ASC-KEY-PO-NBR.               07550000
075600     MOVE AP300-INVC-TYP-CDE     TO ASC-KEY-INVC-TYP-CDE.         07560000
075700                                                                  07570000
075800     EVALUATE TRUE                                                07580000
075900                                                                  07590000
076000         WHEN ASC-INTER-APPL-CRIT-SPEC                            07600000
076100             IF ASC-KEY-INVC-ID > SPACES                          07610000
076200                 CONTINUE                                         07620000
076300             ELSE                                                 07630000
076400                 MOVE PC-TSYMSG-00849     TO DP020-MSG-NUMBER     07640000
076500                 SET DP020-MSG-FATAL                              07650000
076600                     DP020-NEXT-ACT-APPL-ERROR                    07660000
076700                     PS-ERROR        TO TRUE                      07670000
076800             END-IF                                               07680000
076900                                                                  07690000
077000         WHEN ASC-INTER-APPL-LIST                                 07700000
077100             SET ASC-USE-SELECTION-QUEUE                          07710000
077200                             TO TRUE                              07720000
077300             MOVE AP300-NUMBER-OF-SELECTED-ITEMS                  07730000
077400                             TO ASC-NUMBER-OF-SELECTED-ITEMS      07740000
077500             MOVE AP300-NUMBER-OF-TS-ITEMS                        07750000
077600                             TO ASC-NUMBER-OF-TS-ITEMS            07760000
077700             MOVE AP300-SEL-QUEUE-NAME                            07770000
077800                             TO ASC-SEL-QUEUE-NAME                07780000
077900             IF AP300-NUMBER-OF-SELECTED-ITEMS = +0               07790000
078000                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         07800000
078100                 SET DP020-MSG-FATAL                              07810000
078200                     DP020-NEXT-ACT-APPL-ERROR                    07820000
078300                     PS-ERROR        TO TRUE                      07830000
078400             ELSE                                                 07840000
078500                 PERFORM 1120-PREPARE-LIST-ENTRY                  07850000
078600             END-IF                                               07860000
078700                                                                  07870000
078800         WHEN OTHER                                               07880000
078900             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             07890000
079000             SET DP020-MSG-FATAL                                  07900000
079100                 DP020-NEXT-ACT-APPL-ERROR                        07910000
079200                 PS-ERROR        TO TRUE                          07920000
079300     END-EVALUATE.                                                07930000
079400                                                                  07940000
079500/                                                                 07950000
079600*---------------------------------------------------------------- 07960000
079700* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP      07970000
079800* STORAGE QUEUE PASSED FROM THE LIST.                             07980000
079900*---------------------------------------------------------------- 07990000
080000 1120-PREPARE-LIST-ENTRY.                                         08000000
080100                                                                  08010000
080200     MOVE AP301-MAX-ITEMS          TO ASC-SEL-SUB.                08020000
080300     MOVE ZERO                     TO ASC-SEL-ITEM.               08030000
080400     PERFORM 2110-GET-NEXT-RECORD.                                08040000
080500                                                                  08050000
080600/                                                                 08060000
080700*---------------------------------------------------------------- 08070000
080800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA    08080000
080900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT    08090000
081000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST   08100000
081100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       08110000
081200* FUNCTION KEYS CAN GET THIS FAR.                                 08120000
081300*---------------------------------------------------------------- 08130000
081400                                                                  08140000
081500 2000-PROCESS-PANEL.                                              08150000
081600                                                                  08160000
081700     EVALUATE TRUE                                                08170000
081800         WHEN DP020-SRC-AID = DP016-CLEAR                         08180000
081900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08190000
082000                                                                  08200000
082100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08210000
082200             SET DP030-DONT-ERASE                                 08220000
082300                 DP030-SEND-DATAONLY (PC-APPL-MAP)                08230000
082400                               TO TRUE                            08240000
082500             PERFORM 4000-BUILD-INITIAL-PANEL                     08250000
082600                                                                  08260000
082700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08270000
082800             IF  ASC-USE-SELECTION-QUEUE                          08280000
082900                 PERFORM 2110-GET-NEXT-RECORD                     08290000
083000                 PERFORM 4000-BUILD-INITIAL-PANEL                 08300000
083100             ELSE                                                 08310000
083200*                --- BOTTOM OF LIST ---                           08320000
083300                 MOVE PC-TSYMSG-00070                             08330000
083400                                   TO DP020-MSG-NUMBER            08340000
083500                 SET DP020-MSG-INFORMATIONAL                      08350000
083600                                   TO TRUE                        08360000
083700             END-IF                                               08370000
083800                                                                  08380000
083900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08390000
084000             IF  ASC-USE-SELECTION-QUEUE                          08400000
084100                 PERFORM 2120-GET-PREV-RECORD                     08410000
084200                 PERFORM 4000-BUILD-INITIAL-PANEL                 08420000
084300             ELSE                                                 08430000
084400*                --- TOP OF LIST ---                              08440000
084500                 MOVE PC-TSYMSG-00069                             08450000
084600                                   TO DP020-MSG-NUMBER            08460000
084700                 SET DP020-MSG-INFORMATIONAL                      08470000
084800                                   TO TRUE                        08480000
084900             END-IF                                               08490000
085000                                                                  08500000
085100         WHEN OTHER                                               08510000
085200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08520000
085300             SET DP030-CONTINUE-GO                                08530000
085400                               TO TRUE                            08540000
085500             PERFORM 2100-CHECK-FUNCTION-KEY                      08550000
085600     END-EVALUATE.                                                08560000
085700                                                                  08570000
085800/                                                                 08580000
085900*---------------------------------------------------------------- 08590000
086000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST. 08600000
086100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   08610000
086200* CICS ARCHITECTURE API.                                          08620000
086300*---------------------------------------------------------------- 08630000
086400 2100-CHECK-FUNCTION-KEY.                                         08640000
086500                                                                  08650000
086600     EVALUATE TRUE                                                08660000
086700         WHEN DP020-SRC-AID = DP016-ENTER                         08670000
086800             CONTINUE                                             08680000
086900                                                                  08690000
087000         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 08700000
087100             INITIALIZE AP300-INTER-APPL-COMMAREA                 08710000
087200             MOVE ASC-PO-NBR          TO AP300-PO-NBR             08720000
087300*  DON'T MOVE THE INVC-ID FOR AN ADD FUNCTION                     08730000
087400             IF DP020-SRC-AID NOT = DP016-PF13                    08740000
087500                 MOVE ASC-KEY-INVC-ID TO AP300-INVC-ID            08750000
087600             END-IF                                               08760000
087700             MOVE ASC-KEY-INVC-STATUS TO AP300-INVC-STATUS        08770000
087800             MOVE ASC-STR-NBR         TO AP300-STORE-NBR          08780000
087900             MOVE ASC-NET-INVC-AMT    TO AP300-NET-INVC-AMT       08790000
088000             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    08800000
088100                             TO AP300-NUMBER-OF-SELECTED-ITEMS    08810000
088200             MOVE ASC-NUMBER-OF-TS-ITEMS                          08820000
088300                             TO AP300-NUMBER-OF-TS-ITEMS          08830000
088400             MOVE ASC-SEL-QUEUE-NAME                              08840000
088500                             TO AP300-SEL-QUEUE-NAME              08850000
088600                                                                  08860000
088700         WHEN OTHER                                               08870000
088800             SET DP013-NO-ROLLBACK                                08880000
088900                 DP013-XCTL-DISPLAY-RESTART                       08890000
089000                 DP013-CICS-ABEND  TO TRUE                        08900000
089100             MOVE '2100-CHECK-FUNCTION-KEY'                       08910000
089200                                   TO DP013-PARAGRAPH             08920000
089300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08930000
089400                                   TO DP013-MESSAGE-TEXT (1)      08940000
089500             PERFORM DP013-0000-PROCESS-ABEND                     08950000
089600     END-EVALUATE.                                                08960000
089700                                                                  08970000
089800/                                                                 08980000
089900 2110-GET-NEXT-RECORD.                                            08990000
090000                                                                  09000000
090100     ADD +1                        TO ASC-SEL-SUB.                09010000
090200     IF  ASC-SEL-SUB > AP301-MAX-ITEMS                            09020000
090300         ADD +1                    TO ASC-SEL-ITEM                09030000
090400         MOVE +1                   TO ASC-SEL-SUB                 09040000
090500     END-IF.                                                      09050000
090600                                                                  09060000
090700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                09070000
090800         PERFORM 9100-READ-SEL-QUEUE                              09080000
090900         IF  AP301-ITEM (ASC-SEL-SUB) > ZERO                      09090000
091000             MOVE AP301-PO-NBR      (ASC-SEL-SUB)                 09100000
091100                                   TO ASC-KEY-PO-NBR              09110000
091200             MOVE AP301-INVC-ID  (ASC-SEL-SUB)                    09120000
091300                                   TO ASC-KEY-INVC-ID             09130000
091400             MOVE SPACE            TO ASC-KEY-INVC-TYP-CDE        09140000
091500             SET AP301-INQ (ASC-SEL-SUB)                          09150000
091600                                   TO TRUE                        09160000
091700             PERFORM 9200-REWRITE-LIST-QUEUE                      09170000
091800         ELSE                                                     09180000
091900             SUBTRACT +1 FROM ASC-SEL-SUB                         09190000
092000*            --- BOTTOM OF LIST ---                               09200000
092100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09210000
092200             SET DP020-MSG-INFORMATIONAL                          09220000
092300                                   TO TRUE                        09230000
092400         END-IF                                                   09240000
092500     ELSE                                                         09250000
092600         SUBTRACT +1 FROM ASC-SEL-ITEM                            09260000
092700         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 09270000
092800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09280000
092900         SET DP020-MSG-INFORMATIONAL                              09290000
093000                                   TO TRUE                        09300000
093100     END-IF.                                                      09310000
093200                                                                  09320000
093300/                                                                 09330000
093400 2120-GET-PREV-RECORD.                                            09340000
093500                                                                  09350000
093600     SUBTRACT +1 FROM ASC-SEL-SUB.                                09360000
093700     IF  ASC-SEL-SUB < +1                                         09370000
093800         SUBTRACT +1 FROM ASC-SEL-ITEM                            09380000
093900         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 09390000
094000     END-IF.                                                      09400000
094100                                                                  09410000
094200     IF  ASC-SEL-ITEM > ZERO                                      09420000
094300         PERFORM 9100-READ-SEL-QUEUE                              09430000
094400         MOVE AP301-PO-NBR      (ASC-SEL-SUB)                     09440000
094500                                   TO ASC-KEY-PO-NBR              09450000
094600         MOVE AP301-INVC-ID  (ASC-SEL-SUB)                        09460000
094700                                   TO ASC-KEY-INVC-ID             09470000
094800         MOVE SPACE                TO ASC-KEY-INVC-TYP-CDE        09480000
094900     ELSE                                                         09490000
095000         MOVE +1                   TO ASC-SEL-ITEM                09500000
095100                                      ASC-SEL-SUB                 09510000
095200*        --- TOP OF LIST ---                                      09520000
095300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09530000
095400         SET DP020-MSG-INFORMATIONAL                              09540000
095500                                   TO TRUE                        09550000
095600     END-IF.                                                      09560000
095700                                                                  09570000
095800/                                                                 09580000
095900*---------------------------------------------------------------- 09590000
096000*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST      09600000
096100*    ENTRY.                                                       09610000
096200*---------------------------------------------------------------- 09620000
096300                                                                  09630000
096400 4000-BUILD-INITIAL-PANEL.                                        09640000
096500                                                                  09650000
096600     INITIALIZE DCLTEXTENT                                        09660000
096700                DCLTBUSLOC                                        09670000
096800                DCLTENTNME                                        09680000
096900                DCLTPAYTRM                                        09690000
097000                DCLTPURCHS                                        09700000
097100                DCLTPLNSHP                                        09710000
097200                DCLTPOAGMT                                        09720000
097300                DCLTINVOIC                                        09730000
097400                DCLTMDINVC                                        09740000
097500                DCLTEXINVC                                        09750000
097600                DCLTINVCTM                                        09760000
097700                DCLTALCHRG                                        09770000
097800                DK-DB2-KEYS                                       09780000
097900                ASC-ORIGINAL-FIELD-VALUES                         09790000
098000                ASC-OTHER-FIELDS.                                 09800000
098100                                                                  09810000
098200     MOVE ASC-KEY-INVC-ID         TO DK-INVC-ID                   09820000
098300                                                                  09830000
098400     IF ASC-KEY-PO-NBR > +0                                       09840000
098500         MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR-LOW                09850000
098600                                     DK-PO-NBR-HIGH               09860000
098700     ELSE                                                         09870000
098800         MOVE +0                  TO DK-PO-NBR-LOW                09880000
098900         MOVE +999999999          TO DK-PO-NBR-HIGH               09890000
099000     END-IF.                                                      09900000
099100                                                                  09910000
099200     IF ASC-KEY-INVC-TYP-CDE = SPACE                              09920000
099300         MOVE LOW-VALUES          TO DK-INVC-TYP-CDE1             09930000
099400         MOVE HIGH-VALUES         TO DK-INVC-TYP-CDE2             09940000
099500     ELSE                                                         09950000
099600         MOVE ASC-KEY-INVC-TYP-CDE TO DK-INVC-TYP-CDE1            09960000
099700                                      DK-INVC-TYP-CDE2            09970000
099800     END-IF                                                       09980000
099900                                                                  09990000
100000     PERFORM 4010-VALIDATE-INVC-PO-COMBO.                         10000000
100100     MOVE INVOIC-INVC-DTE      TO PV-INVC-DTE.                    10010000
100200     MOVE INVOIC-PAYT-DTE      TO PV-HOLD-PAY-DATE.               10020000
100300     MOVE PV-HOLD-PAY-MONTH    TO PV-REFORMATTED-MONTH.           10030000
100400     MOVE PV-HOLD-PAY-DAY      TO PV-REFORMATTED-DAY.             10040000
100500     MOVE PV-HOLD-PAY-YEAR     TO PV-REFORMATTED-YEAR.            10050000
100600                                                                  10060000
100700     IF ASC-KEY-INVC-TYP-CDE = '  '                               10070000
100800         MOVE INVOIC-INVC-TYP-CDE   TO ASC-KEY-INVC-TYP-CDE       10080000
100900     END-IF                                                       10090000
101000                                                                  10100000
101100     IF ASC-INVOICE-NOT-FOUND OR                                  10110000
101200        ASC-INVOICE-DUPLICATE                                     10120000
101300         IF ASC-INVOICE-DUPLICATE                                 10130000
101400             MOVE PC-TSYMSG-00858    TO DP020-MSG-NUMBER          10140000
101500         ELSE                                                     10150000
101600*            MOVE PC-TSYMSG-00855    TO DP020-MSG-NUMBER          10160000
101700             MOVE PC-TSYMSG-01564    TO DP020-MSG-NUMBER          10170000
101800         END-IF                                                   10180000
101900         SET PS-ERROR                                             10190000
102000             DP020-MSG-FATAL                                      10200000
102100             DP020-NEXT-ACT-APPL-ERROR                            10210000
102200                               TO TRUE                            10220000
102300     ELSE                                                         10230000
102400         PERFORM 4100-GET-REMAINING-DATA                          10240000
102500         IF PS-NO-ERROR                                           10250000
102600             PERFORM 4200-MOVE-DATABASE-TO-COMMAREA               10260000
102700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10270000
102800         ELSE                                                     10280000
102900             SET DP020-MSG-FATAL                                  10290000
103000                 DP020-NEXT-ACT-APPL-ERROR                        10300000
103100                                   TO TRUE                        10310000
103200         END-IF                                                   10320000
103300     END-IF.                                                      10330000
103400                                                                  10340000
103500 4010-VALIDATE-INVC-PO-COMBO.                                     10350000
103600                                                                  10360000
103700     PERFORM                                                      10370000
103800         WITH TEST AFTER                                          10380000
103900         VARYING PV-RETRY-COUNTER                                 10390000
104000         FROM 1 BY 1                                              10400000
104100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10410000
104200            OR (SQLCODE = +0)                                     10420000
104300            OR (SQLCODE = +100)                                   10430000
104400            OR (SQLCODE = -811))                                  10440000
104500                                                                  10450000
104600**       ***   THE "VALUE" FUNCTION REPLACES NULL VALUES WITH     10460000
104700**       ***   WHATEVER VALUE IS SPECIFIED.  IN THIS CASE,        10470000
104800**       ***   ALL NULL PO_NBR'S  WILL BE TREATED AS IF THEIR     10480000
104900**       ***   PO_NBR'S WERE ZERO, AND WOULD NOT BE RETURNED      10490000
105000**       ***   IF AN ACTUAL ASC-KEY-PO-NBR WAS SPECIFIED, BUT     10500000
105100**       ***   WOULD BE RETURNED IF NO ASC-KEY-PO-NBR WAS         10510000
105200**       ***   SUPPLIED.                                          10520000
105300                                                                  10530000
105400         EXEC SQL                                                 10540000
105500           SELECT  PAYT_REQ_SEQ_NBR                               10550000
105600                  ,INVC_ID                                        10560000
105700                  ,STR_NBR                                        10570000
105800                  ,INVC_TYP_CDE                                   10580000
105900                  ,STATUS_CDE                                     10590000
106000                  ,INVC_DTE                                       10600000
106100                  ,HOLD_IND                                       10610000
106200                  ,ENTR_MTHD_CDE                                  10620000
106300                  ,PAYT_RLSE_TMST                                 10630000
106400                  ,PAYT_DTE                                       10640000
106500                  ,GRO_COST_AMT                                   10650000
106600                  ,BAR_CDE                                        10660000
106700                  ,SPLIT_TERMS_IND                                10670000
106800                  ,INVC_CART_CT                                   10680000
106900                  ,INVC_NET_COST_AMT                              10690000
107000                  ,RMIT_VND_ID                                    10700000
107100                  ,CRE_BY_USR_ID                                  10710000
107200                  ,CRE_DTE                                        10720000
107300                  ,VALUE(PO_NBR,+0)                               10730000
107400                  ,AP_PRC_DTE                                     10740000
107500                  ,AP_PRC_CDE                                     10750000
107600                  ,DATE(STATUS_CHG_TMST)                          10760000
107700                  ,DC_NBR                                         10770000
107800                  ,MTCH_LVL_CDE                                   10780000
107900                  ,DUE_DTE_SRC_CDE                                10790000
108000                  ,CALC_DUE_DTE                                   10800000
108100            INTO   :INVOIC-PAYT-REQ-SEQ-NBR                       10810000
108200                  ,:INVOIC-INVC-ID                                10820000
108300                  ,:INVOIC-STR-NBR                                10830000
108400                  ,:INVOIC-INVC-TYP-CDE                           10840000
108500                  ,:INVOIC-STATUS-CDE                             10850000
108600                  ,:INVOIC-INVC-DTE                               10860000
108700                  ,:INVOIC-HOLD-IND                               10870000
108800                  ,:INVOIC-ENTR-MTHD-CDE                          10880000
108900                  ,:INVOIC-PAYT-RLSE-TMST                         10890000
109000                  ,:INVOIC-PAYT-DTE                               10900000
109100                  ,:INVOIC-GRO-COST-AMT                           10910000
109200                  ,:INVOIC-BAR-CDE                                10920000
109300                  ,:INVOIC-SPLIT-TERMS-IND                        10930000
109400                  ,:INVOIC-INVC-CART-CT                           10940000
109500                  ,:INVOIC-INVC-NET-COST-AMT                      10950000
109600                  ,:INVOIC-RMIT-VND-ID                            10960000
109700                  ,:INVOIC-CRE-BY-USR-ID                          10970000
109800                  ,:INVOIC-CRE-DTE                                10980000
109900                  ,:INVOIC-PO-NBR                                 10990000
110000                  ,:INVOIC-AP-PRC-DTE                             11000000
110100                  ,:INVOIC-AP-PRC-CDE                             11010000
110200                  ,:PV-STATUS-CHG-DATE                            11020000
110300                  ,:INVOIC-DC-NBR                                 11030000
110400                  ,:INVOIC-MTCH-LVL-CDE                           11040000
110500                  ,:INVOIC-DUE-DTE-SRC-CDE                        11050000
110600                  ,:INVOIC-CALC-DUE-DTE                           11060000
110700             FROM   TINVOIC                                       11070000
110800            WHERE   INVC_ID                = :DK-INVC-ID          11080000
110900              AND   INVC_TYP_CDE     BETWEEN :DK-INVC-TYP-CDE1    11090000
111000                                         AND :DK-INVC-TYP-CDE2    11100000
111100              AND   PO_NBR                 IS NOT NULL            11110000
111200              AND   PO_NBR           BETWEEN :DK-PO-NBR-LOW       11120000
111300                                         AND :DK-PO-NBR-HIGH      11130000
111400         END-EXEC                                                 11140000
111500                                                                  11150000
111600         EVALUATE TRUE                                            11160000
111700             WHEN SQLCODE = +0                                    11170000
111800                 SET ASC-INVOICE-FOUND         TO TRUE            11180000
111900             WHEN SQLCODE = -904                                  11190000
112000             WHEN SQLCODE = -913                                  11200000
112100                 CONTINUE                                         11210000
112200             WHEN SQLCODE = -811                                  11220000
112300                                                                  11230000
112400                 SET ASC-INVOICE-DUPLICATE     TO TRUE            11240000
112500                                                                  11250000
112600             WHEN SQLCODE = +100                                  11260000
112700                                                                  11270000
112800                 SET ASC-INVOICE-NOT-FOUND     TO TRUE            11280000
112900                                                                  11290000
113000             WHEN SQLWARN0 NOT = SPACES                           11300000
113100             WHEN SQLCODE < ZERO                                  11310000
113200             WHEN SQLCODE > ZERO                                  11320000
113300                 MOVE '4010-SELECT-TINVOIC'                       11330000
113400                                   TO DP013-PARAGRAPH             11340000
113500                 MOVE 'SELECT ON TINVOIC'                         11350000
113600                                   TO DP013-MESSAGE-TEXT (1)      11360000
113700                 MOVE SQLCA        TO DP013-SQLCA                 11370000
113800                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    11380000
113900                 MOVE SPACES       TO DP013-DB2-TABLE-NAME (2)    11390000
114000                 SET DP013-DB2-ABEND                              11400000
114100                     DP013-XCTL-DISPLAY-RESTART                   11410000
114200                                   TO TRUE                        11420000
114300                 PERFORM DP013-0000-PROCESS-ABEND                 11430000
114400         END-EVALUATE                                             11440000
114500     END-PERFORM.                                                 11450000
114600                                                                  11460000
114700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11470000
114800         MOVE '4010-SELECT-TINVOIC'                               11480000
114900                                   TO DP013-PARAGRAPH             11490000
115000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     11500000
115100                                   TO DP013-MESSAGE-TEXT (1)      11510000
115200         MOVE SQLCA                TO DP013-SQLCA                 11520000
115300         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    11530000
115400         MOVE SPACES               TO DP013-DB2-TABLE-NAME (2)    11540000
115500         SET DP013-DB2-ABEND                                      11550000
115600             DP013-XCTL-DISPLAY-RESTART                           11560000
115700                                   TO TRUE                        11570000
115800         PERFORM DP013-0000-PROCESS-ABEND                         11580000
115900     END-IF.                                                      11590000
116000/                                                                 11600000
116100                                                                  11610000
116200 4100-GET-REMAINING-DATA.                                         11620000
116300                                                                  11630000
116400     IF INVOIC-RMIT-VND-ID > SPACES                               11640000
116500         PERFORM 4110-GET-ENT-NAME                                11650000
116600         PERFORM 4120-GET-BUSLOC-DATA                             11660000
116700     END-IF                                                       11670000
116800                                                                  11680000
116900     IF INVOIC-PO-NBR > +0                                        11690000
117000         PERFORM 4130-GET-TPURCHS-DEPT-NBR                        11700000
117100         PERFORM 4140-GET-TPAYTRM-DATA                            11710000
117200     END-IF                                                       11720000
117300                                                                  11730000
117400     IF ASC-EXPENSE-INVC                                          11740000
117500         PERFORM 4155-GET-TEXINVC-DATA                            11750000
117600     ELSE                                                         11760000
117700         PERFORM 4150-GET-TMDINVC-DATA                            11770000
117800     END-IF.                                                      11780000
117900                                                                  11790000
118000     PERFORM 4160-GET-TINVCTM-DATA.                               11800000
118100     PERFORM 4170-GET-TALCHRG-DATA.                               11810000
118200     PERFORM 4175-ACCUM-ALLOWANCES.                               11820000
118300/                                                                 11830000
118400 4110-GET-ENT-NAME.                                               11840000
118500                                                                  11850000
118600     PERFORM                                                      11860000
118700         WITH TEST AFTER                                          11870000
118800         VARYING PV-RETRY-COUNTER                                 11880000
118900         FROM 1 BY 1                                              11890000
119000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11900000
119100            OR (SQLCODE = +0)                                     11910000
119200            OR (SQLCODE = +100))                                  11920000
119300                                                                  11930000
119400         EXEC SQL                                                 11940000
119500           SELECT     A.ENT_ID                                    11950000
119600                     ,ENT_NAME_DESC                               11960000
119700             INTO    :EXTENT-ENT-ID                               11970000
119800                    ,:ENTNME-ENT-NAME-DESC                        11980000
119900             FROM    TEXTENT A                                    11990000
120000                    ,TENTNME B                                    12000000
120100            WHERE    DUN_NBR    = :INVOIC-RMIT-VND-ID             12010000
120200              AND    A.ENT_ID   = B.ENT_ID                        12020000
120300              AND    B.TYPE_CDE = '01'                            12030000
120400         END-EXEC                                                 12040000
120500                                                                  12050000
120600         EVALUATE TRUE                                            12060000
120700             WHEN SQLCODE = +0                                    12070000
120800             WHEN SQLCODE = -904                                  12080000
120900             WHEN SQLCODE = -913                                  12090000
121000             WHEN SQLCODE = +100                                  12100000
121100                 CONTINUE                                         12110000
121200             WHEN SQLWARN0 NOT = SPACES                           12120000
121300             WHEN SQLCODE < ZERO                                  12130000
121400             WHEN SQLCODE > ZERO                                  12140000
121500                 MOVE '4110-GET-ENT-NAME'                         12150000
121600                                   TO DP013-PARAGRAPH             12160000
121700                 MOVE 'SELECT ON TENTNME'                         12170000
121800                                   TO DP013-MESSAGE-TEXT (1)      12180000
121900                 MOVE SQLCA        TO DP013-SQLCA                 12190000
122000                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    12200000
122100                 MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (2)    12210000
122200                 SET DP013-DB2-ABEND                              12220000
122300                     DP013-XCTL-DISPLAY-RESTART                   12230000
122400                                   TO TRUE                        12240000
122500                 PERFORM DP013-0000-PROCESS-ABEND                 12250000
122600         END-EVALUATE                                             12260000
122700     END-PERFORM.                                                 12270000
122800                                                                  12280000
122900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12290000
123000         MOVE '4110-GET-ENT-NAME'                                 12300000
123100                                   TO DP013-PARAGRAPH             12310000
123200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     12320000
123300                                   TO DP013-MESSAGE-TEXT (1)      12330000
123400         MOVE SQLCA                TO DP013-SQLCA                 12340000
123500         MOVE 'TENTNME'            TO DP013-DB2-TABLE-NAME (1)    12350000
123600         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (2)    12360000
123700         SET DP013-DB2-ABEND                                      12370000
123800             DP013-XCTL-DISPLAY-RESTART                           12380000
123900                                   TO TRUE                        12390000
124000         PERFORM DP013-0000-PROCESS-ABEND                         12400000
124100     END-IF.                                                      12410000
124200/                                                                 12420000
124300 4120-GET-BUSLOC-DATA.                                            12430000
124400                                                                  12440000
124500     PERFORM                                                      12450000
124600         WITH TEST AFTER                                          12460000
124700         VARYING PV-RETRY-COUNTER                                 12470000
124800         FROM 1 BY 1                                              12480000
124900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12490000
125000            OR (SQLCODE = +0)                                     12500000
125100            OR (SQLCODE = +100))                                  12510000
125200                                                                  12520000
125300         EXEC SQL                                                 12530000
125400           SELECT     ADDRESS_LINE1_DESC                          12540000
125500                     ,ADDRESS_LINE2_DESC                          12550000
125600                     ,CITY_NAME                                   12560000
125700                     ,STATE_CDE                                   12570000
125800                     ,ZIP_CDE                                     12580000
125900             INTO    :BUSLOC-ADDRESS-LINE1-DESC                   12590000
126000                    ,:BUSLOC-ADDRESS-LINE2-DESC                   12600000
126100                    ,:BUSLOC-CITY-NAME                            12610000
126200                    ,:BUSLOC-STATE-CDE                            12620000
126300                    ,:BUSLOC-ZIP-CDE                              12630000
126400             FROM    TBUSLOC                                      12640000
126500            WHERE    ENT_ID       = :EXTENT-ENT-ID                12650000
126600              AND    FUNCTION_ID  = +9                            12660000
126700              AND    SEQ_NBR =                                    12670000
126800                (SELECT MIN(SEQ_NBR)                              12680000
126900                   FROM TBUSLOC                                   12690000
127000                  WHERE ENT_ID       = :EXTENT-ENT-ID             12700000
127100                    AND FUNCTION_ID  = +9)                        12710000
127200         END-EXEC                                                 12720000
127300                                                                  12730000
127400         EVALUATE TRUE                                            12740000
127500             WHEN SQLCODE = +0                                    12750000
127600             WHEN SQLCODE = -904                                  12760000
127700             WHEN SQLCODE = -913                                  12770000
127800             WHEN SQLCODE = +100                                  12780000
127900                 CONTINUE                                         12790000
128000                                                                  12800000
128100             WHEN SQLWARN0 NOT = SPACES                           12810000
128200             WHEN SQLCODE < ZERO                                  12820000
128300             WHEN SQLCODE > ZERO                                  12830000
128400                 MOVE '4120-GET-BUSLOC-DATA'                      12840000
128500                                   TO DP013-PARAGRAPH             12850000
128600                 MOVE 'SELECT ON BUSLOC'                          12860000
128700                                   TO DP013-MESSAGE-TEXT (1)      12870000
128800                 MOVE SQLCA        TO DP013-SQLCA                 12880000
128900                 MOVE 'TBUSLOC'    TO DP013-DB2-TABLE-NAME (1)    12890000
129000                 SET DP013-DB2-ABEND                              12900000
129100                     DP013-XCTL-DISPLAY-RESTART                   12910000
129200                                   TO TRUE                        12920000
129300                 PERFORM DP013-0000-PROCESS-ABEND                 12930000
129400         END-EVALUATE                                             12940000
129500     END-PERFORM.                                                 12950000
129600                                                                  12960000
129700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12970000
129800         MOVE '4120-GET-BUSLOC-DATA'                              12980000
129900                                   TO DP013-PARAGRAPH             12990000
130000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13000000
130100                                   TO DP013-MESSAGE-TEXT (1)      13010000
130200         MOVE SQLCA                TO DP013-SQLCA                 13020000
130300         MOVE 'TBUSLOC'            TO DP013-DB2-TABLE-NAME (1)    13030000
130400         SET DP013-DB2-ABEND                                      13040000
130500             DP013-XCTL-DISPLAY-RESTART                           13050000
130600                                   TO TRUE                        13060000
130700         PERFORM DP013-0000-PROCESS-ABEND                         13070000
130800     END-IF.                                                      13080000
130900 4130-GET-TPURCHS-DEPT-NBR.                                       13090000
131000                                                                  13100000
131100     PERFORM                                                      13110000
131200         WITH TEST AFTER                                          13120000
131300         VARYING PV-RETRY-COUNTER                                 13130000
131400         FROM 1 BY 1                                              13140000
131500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13150000
131600            OR (SQLCODE = +0)                                     13160000
131700            OR (SQLCODE = +100))                                  13170000
131800                                                                  13180000
131900         EXEC SQL                                                 13190000
132000           SELECT    DISTINCT DEPT_NBR                            13200000
132100             INTO    :PURCHS-DEPT-NBR                             13210000
132200             FROM    TPURCHS                                      13220000
132300            WHERE    PO_NBR       = :INVOIC-PO-NBR                13230000
132400              AND    PO_CATEG_CDE = 'MR'                          13240000
132500              AND    VER_STATUS_CDE = 'A'                         13250000
132600         END-EXEC                                                 13260000
132700                                                                  13270000
132800         EVALUATE TRUE                                            13280000
132900             WHEN SQLCODE = +0                                    13290000
133000             WHEN SQLCODE = +100                                  13300000
133100             WHEN SQLCODE = -904                                  13310000
133200             WHEN SQLCODE = -913                                  13320000
133300                 CONTINUE                                         13330000
133400                                                                  13340000
133500             WHEN SQLWARN0 NOT = SPACES                           13350000
133600             WHEN SQLCODE < ZERO                                  13360000
133700             WHEN SQLCODE > ZERO                                  13370000
133800                 MOVE '4130-GET-TPURCHS-DEPT-NBR'                 13380000
133900                                   TO DP013-PARAGRAPH             13390000
134000                 MOVE 'SELECT ON TPURCHS'                         13400000
134100                                   TO DP013-MESSAGE-TEXT (1)      13410000
134200                 MOVE SQLCA        TO DP013-SQLCA                 13420000
134300                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    13430000
134400                 SET DP013-DB2-ABEND                              13440000
134500                     DP013-XCTL-DISPLAY-RESTART                   13450000
134600                                   TO TRUE                        13460000
134700                 PERFORM DP013-0000-PROCESS-ABEND                 13470000
134800         END-EVALUATE                                             13480000
134900     END-PERFORM.                                                 13490000
135000                                                                  13500000
135100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13510000
135200         MOVE '4130-GET-TPURCHS-DEPT-NBR'                         13520000
135300                                   TO DP013-PARAGRAPH             13530000
135400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13540000
135500                                   TO DP013-MESSAGE-TEXT (1)      13550000
135600         MOVE SQLCA                TO DP013-SQLCA                 13560000
135700         MOVE 'TPURCHS'            TO DP013-DB2-TABLE-NAME (1)    13570000
135800         SET DP013-DB2-ABEND                                      13580000
135900             DP013-XCTL-DISPLAY-RESTART                           13590000
136000                                   TO TRUE                        13600000
136100         PERFORM DP013-0000-PROCESS-ABEND                         13610000
136200     END-IF.                                                      13620000
136300/                                                                 13630000
136400 4140-GET-TPAYTRM-DATA.                                           13640000
136500                                                                  13650000
136600     PERFORM                                                      13660000
136700         WITH TEST AFTER                                          13670000
136800         VARYING PV-RETRY-COUNTER                                 13680000
136900         FROM 1 BY 1                                              13690000
137000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13700000
137100            OR (SQLCODE = +0)                                     13710000
137200            OR (SQLCODE = +100))                                  13720000
137300                                                                  13730000
137400         EXEC SQL                                                 13740000
137500           SELECT    A.DISCOUNT_PCT                               13750000
137600                    ,A.DISCOUNT_DAYS_QTY                          13760000
137700                    ,A.DUE_DAY_QTY                                13770000
137800                    ,A.DUE_DAY_FR_DTE_TXT                         13780000
137900                    ,B.DISC_PAY_DAY_QTY                           13790000
138000             INTO    :PAYTRM-DISCOUNT-PCT                         13800000
138100                    ,:PAYTRM-DISCOUNT-DAYS-QTY                    13810000
138200                    ,:PAYTRM-DUE-DAY-QTY                          13820000
138300                    ,:PAYTRM-DUE-DAY-FR-DTE-TXT                   13830000
138400                    ,:POAGMT-DISC-PAY-DAY-QTY                     13840000
138500             FROM    TPAYTRM A                                    13850000
138600                    ,TPOAGMT B                                    13860000
138700            WHERE    PO_NBR         = :INVOIC-PO-NBR              13870000
138800              AND    VER_STATUS_CDE = 'A'                         13880000
138900              AND    AGRMT_TYP_ID   = '2'                         13890000
139000              AND    A.PAY_TERM_ID  = B.PAYT_TERM_ID              13900000
139100         END-EXEC                                                 13910000
139200                                                                  13920000
139300         EVALUATE TRUE                                            13930000
139400             WHEN SQLCODE = +0                                    13940000
139500             WHEN SQLCODE = +100                                  13950000
139600             WHEN SQLCODE = -904                                  13960000
139700             WHEN SQLCODE = -913                                  13970000
139800                 CONTINUE                                         13980000
139900                                                                  13990000
140000             WHEN SQLWARN0 NOT = SPACES                           14000000
140100             WHEN SQLCODE < ZERO                                  14010000
140200             WHEN SQLCODE > ZERO                                  14020000
140300                 MOVE '4140-GET-TPAYTRM-DATA'                     14030000
140400                                   TO DP013-PARAGRAPH             14040000
140500                 MOVE 'SELECT ON TPAYTRM'                         14050000
140600                                   TO DP013-MESSAGE-TEXT (1)      14060000
140700                 MOVE SQLCA        TO DP013-SQLCA                 14070000
140800                 MOVE 'TPAYTRM'    TO DP013-DB2-TABLE-NAME (1)    14080000
140900                 MOVE 'TPOAGMT'    TO DP013-DB2-TABLE-NAME (2)    14090000
141000                 SET DP013-DB2-ABEND                              14100000
141100                     DP013-XCTL-DISPLAY-RESTART                   14110000
141200                                   TO TRUE                        14120000
141300                 PERFORM DP013-0000-PROCESS-ABEND                 14130000
141400         END-EVALUATE                                             14140000
141500     END-PERFORM.                                                 14150000
141600                                                                  14160000
141700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14170000
141800         MOVE '4140-GET-TPAYTRM-DATA'                             14180000
141900                                   TO DP013-PARAGRAPH             14190000
142000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     14200000
142100                                   TO DP013-MESSAGE-TEXT (1)      14210000
142200         MOVE SQLCA                TO DP013-SQLCA                 14220000
142300         MOVE 'TPAYTRM'            TO DP013-DB2-TABLE-NAME (1)    14230000
142400         MOVE 'TPOAGMT'            TO DP013-DB2-TABLE-NAME (2)    14240000
142500         SET DP013-DB2-ABEND                                      14250000
142600             DP013-XCTL-DISPLAY-RESTART                           14260000
142700                                   TO TRUE                        14270000
142800         PERFORM DP013-0000-PROCESS-ABEND                         14280000
142900     END-IF.                                                      14290000
143000                                                                  14300000
143100     PERFORM 4141-GET-ADDL-TPOAGMT-DATA.                          14310000
143200                                                                  14320000
143300/                                                                 14330000
143400 4141-GET-ADDL-TPOAGMT-DATA.                                      14340000
143500                                                                  14350000
143600     MOVE ZERO TO PV-DISC-PAY-DAY-QTY.                            14360000
143700                                                                  14370000
143800     PERFORM                                                      14380000
143900         WITH TEST AFTER                                          14390000
144000         VARYING PV-RETRY-COUNTER                                 14400000
144100         FROM 1 BY 1                                              14410000
144200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14420000
144300            OR (SQLCODE = +0)                                     14430000
144400            OR (SQLCODE = +100))                                  14440000
144500                                                                  14450000
144600         EXEC SQL                                                 14460000
144700           SELECT    B.DISC_PAY_DAY_QTY                           14470000
144800             INTO    :PV-DISC-PAY-DAY-QTY                         14480000
144900             FROM    TPOAGMT B                                    14490000
145000            WHERE    PO_NBR         = :INVOIC-PO-NBR              14500000
145100              AND    VER_STATUS_CDE = 'A'                         14510000
145200              AND    AGRMT_TYP_ID   = '5'                         14520000
145300              AND    TYP_CDE        =  1                          14530000
145400         END-EXEC                                                 14540000
145500                                                                  14550000
145600         EVALUATE TRUE                                            14560000
145700             WHEN SQLCODE = +0                                    14570000
145800                ADD PV-DISC-PAY-DAY-QTY TO POAGMT-DISC-PAY-DAY-QTY14580000
145900                                                                  14590000
146000             WHEN SQLCODE = +100                                  14600000
146100             WHEN SQLCODE = -904                                  14610000
146200             WHEN SQLCODE = -913                                  14620000
146300                CONTINUE                                          14630000
146400                                                                  14640000
146500             WHEN SQLWARN0 NOT = SPACES                           14650000
146600             WHEN SQLCODE < ZERO                                  14660000
146700             WHEN SQLCODE > ZERO                                  14670000
146800                 MOVE '4141-GET-ADDL-TPOAGMT-DATA'                14680000
146900                                   TO DP013-PARAGRAPH             14690000
147000                 MOVE 'SELECT ON TPOAGMT'                         14700000
147100                                   TO DP013-MESSAGE-TEXT (1)      14710000
147200                 MOVE SQLCA        TO DP013-SQLCA                 14720000
147300                 MOVE 'TPOAGMT'    TO DP013-DB2-TABLE-NAME (1)    14730000
147400                 MOVE SPACE        TO DP013-DB2-TABLE-NAME (2)    14740000
147500                 SET DP013-DB2-ABEND                              14750000
147600                     DP013-XCTL-DISPLAY-RESTART                   14760000
147700                                   TO TRUE                        14770000
147800                 PERFORM DP013-0000-PROCESS-ABEND                 14780000
147900         END-EVALUATE                                             14790000
148000     END-PERFORM.                                                 14800000
148100                                                                  14810000
148200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14820000
148300         MOVE '4141-GET-ADDL-TPOAGMT-DATA'                        14830000
148400                                   TO DP013-PARAGRAPH             14840000
148500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     14850000
148600                                   TO DP013-MESSAGE-TEXT (1)      14860000
148700         MOVE SQLCA                TO DP013-SQLCA                 14870000
148800         MOVE 'TPOAGMT'            TO DP013-DB2-TABLE-NAME (1)    14880000
148900         MOVE SPACE                TO DP013-DB2-TABLE-NAME (2)    14890000
149000         SET DP013-DB2-ABEND                                      14900000
149100             DP013-XCTL-DISPLAY-RESTART                           14910000
149200                                   TO TRUE                        14920000
149300         PERFORM DP013-0000-PROCESS-ABEND                         14930000
149400     END-IF.                                                      14940000
149500/                                                                 14950000
149600 4150-GET-TMDINVC-DATA.                                           14960000
149700                                                                  14970000
149800     PERFORM                                                      14980000
149900         WITH TEST AFTER                                          14990000
150000         VARYING PV-RETRY-COUNTER                                 15000000
150100         FROM 1 BY 1                                              15010000
150200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15020000
150300            OR (SQLCODE = +0)                                     15030000
150400            OR (SQLCODE = +100))                                  15040000
150500                                                                  15050000
150600         EXEC SQL                                                 15060000
150700           SELECT    TOT_INVC_PC_QTY                              15070000
150800                    ,TERM_SEL_CDE                                 15080000
150900                    ,KOHLS_FRGT_PCT                               15090000
151000                    ,VEND_FRGT_PCT                                15100000
151100                    ,BOL_ID                                       15110000
151200                    ,IMPRT_CHRG_PRC_CDE                           15120000
151300             INTO    :MDINVC-TOT-INVC-PC-QTY                      15130000
151400                    ,:MDINVC-TERM-SEL-CDE                         15140000
151500                    ,:MDINVC-KOHLS-FRGT-PCT                       15150000
151600                    ,:MDINVC-VEND-FRGT-PCT                        15160000
151700                    ,:MDINVC-BOL-ID                               15170000
151800                    ,:MDINVC-IMPRT-CHRG-PRC-CDE                   15180000
151900             FROM    TMDINVC                                      15190000
152000            WHERE    PO_NBR           = :INVOIC-PO-NBR            15200000
152100              AND    INVC_ID          = :INVOIC-INVC-ID           15210000
152200         END-EXEC                                                 15220000
152300                                                                  15230000
152400         EVALUATE TRUE                                            15240000
152500             WHEN SQLCODE = +0                                    15250000
152600             WHEN SQLCODE = +100                                  15260000
152700             WHEN SQLCODE = -904                                  15270000
152800             WHEN SQLCODE = -913                                  15280000
152900                 CONTINUE                                         15290000
153000                                                                  15300000
153100             WHEN SQLWARN0 NOT = SPACES                           15310000
153200             WHEN SQLCODE < ZERO                                  15320000
153300             WHEN SQLCODE > ZERO                                  15330000
153400                 MOVE '4150-GET-TMDINVC-DATA'                     15340000
153500                                   TO DP013-PARAGRAPH             15350000
153600                 MOVE 'SELECT ON TMDINVC'                         15360000
153700                                   TO DP013-MESSAGE-TEXT (1)      15370000
153800                 MOVE SQLCA        TO DP013-SQLCA                 15380000
153900                 MOVE 'TMDINVC'    TO DP013-DB2-TABLE-NAME (1)    15390000
154000                 SET DP013-DB2-ABEND                              15400000
154100                     DP013-XCTL-DISPLAY-RESTART                   15410000
154200                                   TO TRUE                        15420000
154300                 PERFORM DP013-0000-PROCESS-ABEND                 15430000
154400         END-EVALUATE                                             15440000
154500     END-PERFORM.                                                 15450000
154600                                                                  15460000
154700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15470000
154800         MOVE '4150-GET-TMDINVC-DATA'                             15480000
154900                                   TO DP013-PARAGRAPH             15490000
155000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     15500000
155100                                   TO DP013-MESSAGE-TEXT (1)      15510000
155200         MOVE SQLCA                TO DP013-SQLCA                 15520000
155300         MOVE 'TMDINVC'            TO DP013-DB2-TABLE-NAME (1)    15530000
155400         SET DP013-DB2-ABEND                                      15540000
155500             DP013-XCTL-DISPLAY-RESTART                           15550000
155600                                   TO TRUE                        15560000
155700         PERFORM DP013-0000-PROCESS-ABEND                         15570000
155800     END-IF.                                                      15580000
155900/                                                                 15590000
156000 4155-GET-TEXINVC-DATA.                                           15600000
156100                                                                  15610000
156200     PERFORM                                                      15620000
156300         WITH TEST AFTER                                          15630000
156400         VARYING PV-RETRY-COUNTER                                 15640000
156500         FROM 1 BY 1                                              15650000
156600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15660000
156700            OR (SQLCODE = +0)                                     15670000
156800            OR (SQLCODE = +100))                                  15680000
156900                                                                  15690000
157000         EXEC SQL                                                 15700000
157100           SELECT    IMPRT_ENTR_NBR,                              15710000
157200                     IMPRT_BOL_ID,                                15720000
157300                     INVC_CONTNR_ID,                              15730000
157400                     IMPRT_BKR_REF_NBR                            15740000
157500             INTO    :EXINVC-IMPRT-ENTR-NBR,                      15750000
157600                     :EXINVC-IMPRT-BOL-ID,                        15760000
157700                     :EXINVC-INVC-CONTNR-ID,                      15770000
157800                     :EXINVC-IMPRT-BKR-REF-NBR                    15780000
157900             FROM    TEXINVC                                      15790000
158000            WHERE    PO_NBR           = :INVOIC-PO-NBR            15800000
158100              AND    INVC_ID          = :INVOIC-INVC-ID           15810000
158200         END-EXEC                                                 15820000
158300                                                                  15830000
158400         EVALUATE TRUE                                            15840000
158500             WHEN SQLCODE = +0                                    15850000
158600             WHEN SQLCODE = +100                                  15860000
158700             WHEN SQLCODE = -904                                  15870000
158800             WHEN SQLCODE = -913                                  15880000
158900                 CONTINUE                                         15890000
159000                                                                  15900000
159100             WHEN SQLWARN0 NOT = SPACES                           15910000
159200             WHEN SQLCODE < ZERO                                  15920000
159300             WHEN SQLCODE > ZERO                                  15930000
159400                 MOVE '4155-GET-TEXINVC-DATA'                     15940000
159500                                   TO DP013-PARAGRAPH             15950000
159600                 MOVE 'SELECT ON TEXINVC'                         15960000
159700                                   TO DP013-MESSAGE-TEXT (1)      15970000
159800                 MOVE SQLCA        TO DP013-SQLCA                 15980000
159900                 MOVE 'TEXINVC'    TO DP013-DB2-TABLE-NAME (1)    15990000
160000                 SET DP013-DB2-ABEND                              16000000
160100                     DP013-XCTL-DISPLAY-RESTART                   16010000
160200                                   TO TRUE                        16020000
160300                 PERFORM DP013-0000-PROCESS-ABEND                 16030000
160400         END-EVALUATE                                             16040000
160500     END-PERFORM.                                                 16050000
160600                                                                  16060000
160700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16070000
160800         MOVE '4155-GET-TEXINVC-DATA'                             16080000
160900                                   TO DP013-PARAGRAPH             16090000
161000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     16100000
161100                                   TO DP013-MESSAGE-TEXT (1)      16110000
161200         MOVE SQLCA                TO DP013-SQLCA                 16120000
161300         MOVE 'TEXINVC'            TO DP013-DB2-TABLE-NAME (1)    16130000
161400         SET DP013-DB2-ABEND                                      16140000
161500             DP013-XCTL-DISPLAY-RESTART                           16150000
161600                                   TO TRUE                        16160000
161700         PERFORM DP013-0000-PROCESS-ABEND                         16170000
161800     END-IF.                                                      16180000
161900/                                                                 16190000
162000 4160-GET-TINVCTM-DATA.                                           16200000
162100                                                                  16210000
162200     PERFORM                                                      16220000
162300         WITH TEST AFTER                                          16230000
162400         VARYING PV-RETRY-COUNTER                                 16240000
162500         FROM 1 BY 1                                              16250000
162600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16260000
162700            OR (SQLCODE = +0)                                     16270000
162800            OR (SQLCODE = +100))                                  16280000
162900                                                                  16290000
163000         EXEC SQL                                                 16300000
163100           SELECT    DISC_PCT                                     16310000
163200                    ,DISC_DUE_DAY_QTY                             16320000
163300                    ,NET_DUE_DAY_QTY                              16330000
163400                    ,TERM_TYP_CDE                                 16340000
163500                    ,EXTD_DAYS_QTY                                16350000
163600             INTO    :INVCTM-DISC-PCT                             16360000
163700                    ,:INVCTM-DISC-DUE-DAY-QTY                     16370000
163800                    ,:INVCTM-NET-DUE-DAY-QTY                      16380000
163900                    ,:INVCTM-TERM-TYP-CDE                         16390000
164000                    ,:INVCTM-EXTD-DAYS-QTY                        16400000
164100             FROM    TINVCTM                                      16410000
164200            WHERE    PO_NBR           = :INVOIC-PO-NBR            16420000
164300              AND    INVC_ID          = :INVOIC-INVC-ID           16430000
164400              AND    TERM_SEQ_NBR     = 1                         16440000
164500         END-EXEC                                                 16450000
164600                                                                  16460000
164700         EVALUATE TRUE                                            16470000
164800             WHEN SQLCODE = +0                                    16480000
164900             WHEN SQLCODE = +100                                  16490000
165000             WHEN SQLCODE = -904                                  16500000
165100             WHEN SQLCODE = -913                                  16510000
165200                 CONTINUE                                         16520000
165300                                                                  16530000
165400             WHEN SQLWARN0 NOT = SPACES                           16540000
165500             WHEN SQLCODE < ZERO                                  16550000
165600             WHEN SQLCODE > ZERO                                  16560000
165700                 MOVE '4160-GET-TMDINVC-DATA'                     16570000
165800                                   TO DP013-PARAGRAPH             16580000
165900                 MOVE 'SELECT ON TMDINVC'                         16590000
166000                                   TO DP013-MESSAGE-TEXT (1)      16600000
166100                 MOVE SQLCA        TO DP013-SQLCA                 16610000
166200                 MOVE 'TMDINVC'    TO DP013-DB2-TABLE-NAME (1)    16620000
166300                 SET DP013-DB2-ABEND                              16630000
166400                     DP013-XCTL-DISPLAY-RESTART                   16640000
166500                                   TO TRUE                        16650000
166600                 PERFORM DP013-0000-PROCESS-ABEND                 16660000
166700         END-EVALUATE                                             16670000
166800     END-PERFORM.                                                 16680000
166900                                                                  16690000
167000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16700000
167100         MOVE '4160-GET-TMDINVC-DATA'                             16710000
167200                                   TO DP013-PARAGRAPH             16720000
167300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     16730000
167400                                   TO DP013-MESSAGE-TEXT (1)      16740000
167500         MOVE SQLCA                TO DP013-SQLCA                 16750000
167600         MOVE 'TMDINVC'            TO DP013-DB2-TABLE-NAME (1)    16760000
167700         SET DP013-DB2-ABEND                                      16770000
167800             DP013-XCTL-DISPLAY-RESTART                           16780000
167900                                   TO TRUE                        16790000
168000         PERFORM DP013-0000-PROCESS-ABEND                         16800000
168100     END-IF.                                                      16810000
168200                                                                  16820000
168300/                                                                 16830000
168400                                                                  16840000
168500 4170-GET-TALCHRG-DATA.                                           16850000
168600*---------------------------------------------------------------* 16860000
168700*    NOTES: - I.GRO_COST_AMT AND A.ALW_CHRG_PCT MUST BE MULTI-  * 16870000
168800*             PLIED BEFORE DIVIDING BY 100 OR AN OVERFLOW ERROR * 16880000
168900*             OCCURS.                                           * 16890000
169000*           - SINCE THE DECIMAL FUNCTION DOES NOT ROUND, 0.005  * 16900000
169100*             MUST BE ADDED TO THE DIVISION RESULT TO DO THE    * 16910000
169200*             ROUNDING.                                         * 16920000
169300*           - THEN THE RESULTS MAY BE SUMMED WITHOUT CAUSING    * 16930000
169400*             AN OVERFLOW ERROR.                                * 16940000
169500*---------------------------------------------------------------* 16950000
169600                                                                  16960000
169700     MOVE INVOIC-GRO-COST-AMT    TO ASC-NET-INVC-AMT.             16970000
169800     MOVE 'N'                    TO PS-TALCHRG-EXISTS-SW.         16980000
169900     MOVE +1                     TO ALCHRG-AMOUNT-NN.             16990000
170000                                                                  17000000
170100     INITIALIZE PV-SUM-OF-CHARGES                                 17010000
170200                PV-DB2-COUNT.                                     17020000
170300     PERFORM                                                      17030000
170400         WITH TEST AFTER                                          17040000
170500         VARYING PV-RETRY-COUNTER                                 17050000
170600         FROM 1 BY 1                                              17060000
170700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17070000
170800                   OR (SQLCODE = ZERO)                            17080000
170900                   OR (SQLCODE = +100))                           17090000
171000         EXEC SQL                                                 17100000
171100            SELECT  SUM(DECIMAL                                   17110000
171200                       (((I.GRO_COST_AMT * A.ALW_CHRG_PCT)        17120000
171300                       + 0.005),13,2)                             17130000
171400                       + A.ALW_CHRG_AMT)                          17140000
171500                   ,COUNT(*)                                      17150000
171600              INTO  :PV-SUM-OF-CHARGES                            17160000
171700                             :ALCHRG-AMOUNT-NN                    17170000
171800                   ,:PV-DB2-COUNT                                 17180000
171900              FROM  TINVOIC I                                     17190000
172000                   ,TALCHRG A                                     17200000
172100             WHERE  I.PO_NBR           = :INVOIC-PO-NBR           17210000
172200               AND  I.INVC_ID          = :INVOIC-INVC-ID          17220000
172300               AND  I.PO_NBR           = A.PO_NBR                 17230000
172400               AND  I.INVC_ID          = A.INVC_ID                17240000
172500               AND  A.ALW_CHRG_TYP_CDE = 'C'                      17250000
172600         END-EXEC                                                 17260000
172700                                                                  17270000
172800         EVALUATE TRUE                                            17280000
172900             WHEN SQLCODE = ZERO                                  17290000
173000                 IF PV-DB2-COUNT > 0                              17300000
173100                     MOVE 'Y'    TO PS-TALCHRG-EXISTS-SW          17310000
173200                 END-IF                                           17320000
173300                 IF PV-SUM-OF-CHARGES > +0                        17330000
173400                     ADD PV-SUM-OF-CHARGES                        17340000
173500                                 TO ASC-NET-INVC-AMT              17350000
173600                 END-IF                                           17360000
173700                                                                  17370000
173800             WHEN SQLCODE = +100                                  17380000
173900             WHEN SQLCODE = -305                                  17390000
174000                 CONTINUE                                         17400000
174100                                                                  17410000
174200             WHEN SQLCODE = -904                                  17420000
174300             WHEN SQLCODE = -913                                  17430000
174400                 MOVE '4170-GET-TALCHRG-DATA'                     17440000
174500                                 TO DP013-PARAGRAPH               17450000
174600                 MOVE 'SUM CHARGES FOR NET AMT'                   17460000
174700                                 TO DP013-MESSAGE-TEXT (1)        17470000
174800                 MOVE 'TINVOIC'  TO DP013-DB2-TABLE-NAME (1)      17480000
174900                 MOVE 'TALCHRG'  TO DP013-DB2-TABLE-NAME (2)      17490000
175000                 MOVE SQLCA      TO DP013-SQLCA                   17500000
175100                 SET DP013-LINK-RETURN                            17510000
175200                     DP013-DB2-ABEND                              17520000
175300                     DP013-ROLLBACK  TO TRUE                      17530000
175400                 PERFORM DP013-0000-PROCESS-ABEND                 17540000
175500                 MOVE 'TALCHRG'  TO DP020-MSG-TEXT                17550000
175600                 SET DP020-MSG-FATAL TO TRUE                      17560000
175700*            --- CONFLICT FOR DATABASE ---                        17570000
175800                 MOVE PC-TSYMSG-00482                             17580000
175900                                 TO DP020-MSG-NUMBER              17590000
176000                 SET PS-ERROR    TO TRUE                          17600000
176100                                                                  17610000
176200             WHEN OTHER                                           17620000
176300                 MOVE '4170-GET-TALCHRG-DATA'                     17630000
176400                                 TO DP013-PARAGRAPH               17640000
176500                 MOVE 'SUM CHARGES FOR NET AMT'                   17650000
176600                                 TO DP013-MESSAGE-TEXT (1)        17660000
176700                 MOVE 'TINVOIC'  TO DP013-DB2-TABLE-NAME (1)      17670000
176800                 MOVE 'TALCHRG'  TO DP013-DB2-TABLE-NAME (2)      17680000
176900                 MOVE SQLCA      TO DP013-SQLCA                   17690000
177000                 SET DP013-DB2-ABEND                              17700000
177100                     DP013-XCTL-DISPLAY-RESTART                   17710000
177200                                 TO TRUE                          17720000
177300                 PERFORM DP013-0000-PROCESS-ABEND                 17730000
177400         END-EVALUATE                                             17740000
177500     END-PERFORM.                                                 17750000
177600                                                                  17760000
177700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17770000
177800         MOVE '4170-GET-TALCHRG-DATA'                             17780000
177900                                 TO DP013-PARAGRAPH               17790000
178000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     17800000
178100                                 TO DP013-MESSAGE-TEXT (1)        17810000
178200         MOVE 'ALLOWANCES   '    TO DP013-MESSAGE-TEXT (2)        17820000
178300         MOVE SQLCA              TO DP013-SQLCA                   17830000
178400         MOVE 'TALCHRG'          TO DP013-DB2-TABLE-NAME (1)      17840000
178500         SET DP013-DB2-ABEND                                      17850000
178600             DP013-XCTL-DISPLAY-RESTART                           17860000
178700                                 TO TRUE                          17870000
178800         PERFORM DP013-0000-PROCESS-ABEND                         17880000
178900     END-IF.                                                      17890000
179000                                                                  17900000
179100 4175-ACCUM-ALLOWANCES.                                           17910000
179200*---------------------------------------------------------------* 17920000
179300*    NOTES: - ACCUMULATE ALLOWANCES ENTERED AS AMOUNTS. THESE   * 17930000
179400*             WILL BE SUBTRACTED FROM THE GROSS INVOICE AMOUNT  * 17940000
179500*             TO GET THE TOTAL INVOICE AMOUNT.                  * 17950000
179600*      ***  DON'T ACCUMULATE ALLOWANCES ENTERED AS PERCENTAGES. * 17960000
179700*           - WE ALSO NEED TO SET THE PS-TALCHRG-EXISTS-SW IF   * 17970000
179800*             ANY ALLOWANCWES ARE FOUND.                        * 17980000
179900*             4170 ACCUMULATES ALL NET CHARGES, AND SETS        * 17990000
180000*             PS-TALCHRG-EXISTS-SW IF ANY CHARGES ARE FOUND.    * 18000000
180100*---------------------------------------------------------------* 18010000
180200                                                                  18020000
180300     INITIALIZE PV-SUM-OF-ALLOWANCES                              18030000
180400                PV-DB2-COUNT.                                     18040000
180500     PERFORM                                                      18050000
180600         WITH TEST AFTER                                          18060000
180700         VARYING PV-RETRY-COUNTER                                 18070000
180800         FROM 1 BY 1                                              18080000
180900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18090000
181000                   OR (SQLCODE = ZERO)                            18100000
181100                   OR (SQLCODE = +100))                           18110000
181200                                                                  18120000
181300         EXEC SQL                                                 18130000
181400            SELECT  SUM(ALW_CHRG_AMT)                             18140000
181500                   ,COUNT(*)                                      18150000
181600              INTO  :PV-SUM-OF-ALLOWANCES                         18160000
181700                              :ALCHRG-AMOUNT-NN                   18170000
181800                   ,:PV-DB2-COUNT                                 18180000
181900              FROM  TALCHRG                                       18190000
182000             WHERE  PO_NBR           = :INVOIC-PO-NBR             18200000
182100               AND  INVC_ID          = :INVOIC-INVC-ID            18210000
182200               AND  ALW_CHRG_TYP_CDE = 'A'                        18220000
182300         END-EXEC                                                 18230000
182400                                                                  18240000
182500         EVALUATE TRUE                                            18250000
182600             WHEN SQLCODE = ZERO                                  18260000
182700                 IF PV-DB2-COUNT > 0                              18270000
182800                     MOVE 'Y'    TO PS-TALCHRG-EXISTS-SW          18280000
182900                 END-IF                                           18290000
183000                 IF PV-SUM-OF-ALLOWANCES > +0                     18300000
183100                     SUBTRACT PV-SUM-OF-ALLOWANCES FROM           18310000
183200                          ASC-NET-INVC-AMT                        18320000
183300                 END-IF                                           18330000
183400             WHEN SQLCODE = -904                                  18340000
183500             WHEN SQLCODE = -913                                  18350000
183600             WHEN SQLCODE = +100                                  18360000
183700                 CONTINUE                                         18370000
183800             WHEN OTHER                                           18380000
183900                 MOVE '4175-ACCUM-ALLOWANCES'                     18390000
184000                                 TO DP013-PARAGRAPH               18400000
184100                 MOVE 'CHECK FOR ALLOWANCES'                      18410000
184200                                 TO DP013-MESSAGE-TEXT (1)        18420000
184300                 MOVE 'TALCHRG'  TO DP013-DB2-TABLE-NAME (1)      18430000
184400                 MOVE SQLCA      TO DP013-SQLCA                   18440000
184500                 SET DP013-DB2-ABEND                              18450000
184600                     DP013-XCTL-DISPLAY-RESTART                   18460000
184700                                 TO TRUE                          18470000
184800                 PERFORM DP013-0000-PROCESS-ABEND                 18480000
184900         END-EVALUATE                                             18490000
185000     END-PERFORM.                                                 18500000
185100                                                                  18510000
185200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18520000
185300         MOVE '4175-ACCUM-ALLOWANCES'                             18530000
185400                                 TO DP013-PARAGRAPH               18540000
185500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO COUNT '     18550000
185600                                 TO DP013-MESSAGE-TEXT (1)        18560000
185700         MOVE 'ALLOWANCES   '    TO DP013-MESSAGE-TEXT (2)        18570000
185800         MOVE SQLCA              TO DP013-SQLCA                   18580000
185900         MOVE 'TALCHRG'          TO DP013-DB2-TABLE-NAME (1)      18590000
186000         SET DP013-DB2-ABEND                                      18600000
186100             DP013-XCTL-DISPLAY-RESTART                           18610000
186200                                 TO TRUE                          18620000
186300         PERFORM DP013-0000-PROCESS-ABEND                         18630000
186400     END-IF.                                                      18640000
186500/                                                                 18650000
186600                                                                  18660000
201400*---------------------------------------------------------------- 20140000
201500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.      20150000
201600*---------------------------------------------------------------- 20160000
201700                                                                  20170000
201800 4200-MOVE-DATABASE-TO-COMMAREA.                                  20180000
201900                                                                  20190000
202000     MOVE  INVOIC-PAYT-REQ-SEQ-NBR    TO ASC-KEY-PAYT-REQ-SEQ-NBR 20200000
202100     MOVE  INVOIC-STR-NBR             TO ASC-STR-NBR              20210000
202200     MOVE  INVOIC-INVC-TYP-CDE        TO ASC-KEY-INVC-TYP-CDE     20220000
202300     MOVE  INVOIC-STATUS-CDE          TO ASC-KEY-INVC-STATUS      20230000
202400     MOVE  INVOIC-INVC-DTE            TO ASC-INVC-DTE             20240000
202500     MOVE  INVOIC-HOLD-IND            TO ASC-HOLD-IND             20250000
202600     MOVE  INVOIC-ENTR-MTHD-CDE       TO ASC-ENTR-MTHD-CDE        20260000
202700     MOVE  INVOIC-GRO-COST-AMT        TO ASC-GRO-COST-AMT         20270000
202810     MOVE  INVOIC-BAR-CDE             TO ASC-CHECK-NBR            20281000
202900     MOVE  INVOIC-SPLIT-TERMS-IND     TO ASC-IN-SPLIT-TERMS-IND   20290000
203000     MOVE  INVOIC-INVC-CART-CT        TO ASC-CARTON-CNT           20300000
203100     IF INVOIC-AP-PRC-CDE = SPACE AND                             20310000
203200        INVOIC-AP-PRC-DTE = '0001-01-01'                          20320000
203300        MOVE  '9999-09-09'               TO ASC-PAYRLSE-DTE       20330000
203400     ELSE                                                         20340000
203500        MOVE  INVOIC-AP-PRC-DTE          TO ASC-PAYRLSE-DTE       20350000
203600     END-IF.                                                      20360000
203700*  ASC-NET-INVC-AMT ALREADY CONTAINS THE CALCULATED NET INVC AMT  20370000
203800     IF ASC-KEY-INVC-STATUS NOT = 'OB'                            20380000
203900       AND INVOIC-INVC-NET-COST-AMT = 0                           20390000
204000         CONTINUE                                                 20400000
204100     ELSE                                                         20410000
204200         MOVE  INVOIC-INVC-NET-COST-AMT                           20420000
204300                                 TO ASC-NET-INVC-AMT              20430000
204400     END-IF.                                                      20440000
204500                                                                  20450000
204600     MOVE  INVOIC-RMIT-VND-ID         TO ASC-DUN-NBR              20460000
204700     MOVE  INVOIC-PO-NBR              TO ASC-KEY-PO-NBR           20470000
204800                                         ASC-PO-NBR               20480000
204900     MOVE  INVOIC-CRE-BY-USR-ID       TO ASC-CRE-BY-USR-ID        20490000
205000     MOVE  INVOIC-CRE-DTE             TO ASC-CRE-DTE              20500000
205100     MOVE  INVOIC-DC-NBR              TO ASC-DC-NBR               20510000
205200     MOVE  INVOIC-MTCH-LVL-CDE        TO ASC-MTCH-LVL-CDE         20520000
205300     MOVE  INVOIC-DUE-DTE-SRC-CDE     TO ASC-DUE-DTE-SRC-CDE      20530000
205400     MOVE  INVOIC-CALC-DUE-DTE        TO ASC-CALC-DTE             20540000
205500                                                                  20550000
205600     MOVE  ENTNME-ENT-NAME-DESC       TO ASC-ENT-NAME-DESC        20560000
205700     MOVE  BUSLOC-ADDRESS-LINE1-DESC  TO ASC-ADDRESS-LINE1-DESC   20570000
205800     MOVE  BUSLOC-ADDRESS-LINE2-DESC  TO ASC-ADDRESS-LINE2-DESC   20580000
205900     MOVE  BUSLOC-CITY-NAME           TO ASC-CITY-NAME            20590000
206000     MOVE  BUSLOC-STATE-CDE           TO ASC-STATE-CDE            20600000
206100     MOVE  BUSLOC-ZIP-CDE             TO ASC-ZIP-CDE              20610000
206200     MOVE  PURCHS-DEPT-NBR            TO ASC-DEPT-NBR             20620000
206300                                                                  20630000
206400     COMPUTE ASC-PO-DISCOUNT-PCT = PAYTRM-DISCOUNT-PCT * 100      20640000
206500                                                                  20650000
206600     IF PAYTRM-DISCOUNT-PCT = 0                                   20660000
206700         MOVE PAYTRM-DUE-DAY-QTY TO ASC-PO-DISCOUNT-DAYS-QTY      20670000
206800     ELSE                                                         20680000
206900         MOVE PAYTRM-DISCOUNT-DAYS-QTY TO ASC-PO-DISCOUNT-DAYS-QTY20690000
207000     END-IF                                                       20700000
207100                                                                  20710000
207200     MOVE  PAYTRM-DUE-DAY-FR-DTE-TXT  TO ASC-PO-DUE-DAY-FR-DTE-TXT20720000
207300     MOVE  POAGMT-DISC-PAY-DAY-QTY    TO ASC-PO-DISC-PAY-DAY-QTY  20730000
207400     MOVE  MDINVC-TOT-INVC-PC-QTY     TO ASC-TOT-INVC-PC-QTY      20740000
207500                                                                  20750000
207600     MOVE  MDINVC-TERM-SEL-CDE        TO ASC-TERM-SEL-CDE         20760000
207700                                                                  20770000
207800     IF ASC-TERM-SEL-CDE = 'P'                                    20780000
207900         MOVE 'S'                   TO ASC-PO-SEL                 20790000
208000         MOVE ' '                   TO ASC-IN-SEL                 20800000
208100     ELSE                                                         20810000
208200         MOVE ' '                   TO ASC-PO-SEL                 20820000
208300         MOVE 'S'                   TO ASC-IN-SEL                 20830000
208400     END-IF                                                       20840000
208500                                                                  20850000
208600     MOVE  MDINVC-KOHLS-FRGT-PCT      TO ASC-KOHLS-FRGT-PCT       20860000
208700     COMPUTE ASC-KOHLS-FRGT-PCT-NUM =                             20870000
208800             ASC-KOHLS-FRGT-PCT       * 100                       20880000
208900     MOVE  MDINVC-VEND-FRGT-PCT       TO ASC-VEND-FRGT-PCT        20890000
209000     COMPUTE ASC-VEND-FRGT-PCT-NUM =                              20900000
209100             ASC-VEND-FRGT-PCT        * 100                       20910000
209200                                                                  20920000
209300     SET PS-IMPRT-ENTR-NBR-NO   TO TRUE                           20930000
209400                                                                  20940000
209500     MOVE SPACES TO ASC-BOL-ID.                                   20950000
209600     MOVE SPACES TO ASC-ENTRY-NBR.                                20960000
209700     MOVE SPACES TO ASC-CONTAINER-ID.                             20970000
209800     MOVE SPACES TO ASC-BKR-REF-NBR.                              20980000
209900     MOVE SPACES TO ASC-IMPRT-CHRG-CDE.                           20990000
210000                                                                  21000000
210100     IF ASC-EXPENSE-INVC                                          21010000
210200        MOVE EXINVC-IMPRT-ENTR-NBR    TO ASC-ENTRY-NBR            21020000
210300        MOVE EXINVC-IMPRT-BOL-ID      TO ASC-BOL-ID               21030000
210400        MOVE EXINVC-INVC-CONTNR-ID    TO ASC-CONTAINER-ID         21040000
210500        MOVE EXINVC-IMPRT-BKR-REF-NBR TO ASC-BKR-REF-NBR          21050000
210600     ELSE                                                         21060000
210700        MOVE MDINVC-BOL-ID           TO ASC-BOL-ID                21070000
210800        MOVE MDINVC-IMPRT-CHRG-PRC-CDE                            21080000
210900                                     TO ASC-IMPRT-CHRG-CDE        21090000
211000     END-IF                                                       21100000
211100                                                                  21110000
211200                                                                  21120000
211300     COMPUTE ASC-IN-DISC-PCT = INVCTM-DISC-PCT * 100              21130000
211400     IF INVCTM-DISC-PCT = .0000                                   21140000
211500         MOVE INVCTM-NET-DUE-DAY-QTY  TO ASC-IN-DISC-DUE-DAY-QTY  21150000
211600     ELSE                                                         21160000
211700         MOVE INVCTM-DISC-DUE-DAY-QTY TO ASC-IN-DISC-DUE-DAY-QTY  21170000
211800     END-IF                                                       21180000
211900                                                                  21190000
212000     MOVE  INVCTM-TERM-TYP-CDE        TO ASC-IN-TERM-TYP-CDE      21200000
212100                                                                  21210000
212200     IF ASC-IN-TERM-TYP-CDE = '02'                                21220000
212300         MOVE 'Y'                     TO ASC-IN-EOM               21230000
212400     ELSE                                                         21240000
212500         MOVE 'N'                     TO ASC-IN-EOM               21250000
212600     END-IF                                                       21260000
212700     MOVE  INVCTM-EXTD-DAYS-QTY       TO ASC-IN-EXTD-DAYS-QTY     21270000
212800     MOVE  PS-TALCHRG-EXISTS-SW       TO ASC-TALCHRG-EXISTS-SW.   21280000
212900                                                                  21290000
213000 4400-MOVE-COMMAREA-TO-SCREEN.                                    21300000
213100                                                                  21310000
213200     MOVE ASC-KEY-INVC-ID           TO AINVNBRO                   21320000
213300                                                                  21330000
213400     MOVE DP015-BLUE                TO ASTATUSC                   21340000
213500     EVALUATE ASC-KEY-INVC-STATUS                                 21350000
213600         WHEN 'EN'                                                21360000
213700             MOVE 'ENTERED    '     TO ASTATUSO                   21370000
213800         WHEN 'RC'                                                21380000
213900             MOVE 'RECONCILE  '     TO ASTATUSO                   21390000
214000         WHEN 'RL'                                                21400000
214100             MOVE 'RELEASED   '     TO ASTATUSO                   21410000
214200         WHEN 'OP'                                                21420000
214300             MOVE 'OPEN TO PAY'     TO ASTATUSO                   21430000
214400         WHEN 'PD'                                                21440000
214500             MOVE 'PAID       '     TO ASTATUSO                   21450000
214600         WHEN 'PJ'                                                21460000
214700             MOVE 'PENDNG JRNL'     TO ASTATUSO                   21470000
214800         WHEN 'DE'                                                21480000
214900             MOVE 'DELETED    '     TO ASTATUSO                   21490000
215000         WHEN 'PR'                                                21500000
215100             MOVE DP015-YELLOW      TO ASTATUSC                   21510000
215200             MOVE 'PENDING RVW'     TO ASTATUSO                   21520000
215300         WHEN 'OB'                                                21530000
215400             MOVE DP015-YELLOW      TO ASTATUSC                   21540000
215500             MOVE 'OUT OF BAL '     TO ASTATUSO                   21550000
215600         WHEN 'IB'                                                21560000
215700             MOVE DP015-YELLOW      TO ASTATUSC                   21570000
215800             MOVE 'ITM IMBALNC'     TO ASTATUSO                   21580000
215900         WHEN 'BM'                                                21590000
216000             MOVE DP015-YELLOW      TO ASTATUSC                   21600000
216100             MOVE 'BATCH MATCH'     TO ASTATUSO                   21610000
216200     END-EVALUATE                                                 21620000
216300                                                                  21630000
216400     MOVE ASC-KEY-PO-NBR            TO PV-NUM9                    21640000
216500     MOVE PV-NUM9-X                 TO APONUMO                    21650000
216600     MOVE ASC-DUN-NBR               TO ADUNNBRO                   21660000
216700     MOVE ASC-HOLD-IND              TO AHLDINDO                   21670000
216800     STRING ASC-INVC-DTE-MM         DELIMITED BY SIZE             21680000
216900            '/'                     DELIMITED BY SIZE             21690000
217000            ASC-INVC-DTE-DD         DELIMITED BY SIZE             21700000
217100            '/'                     DELIMITED BY SIZE             21710000
217200            ASC-INVC-DTE-YY         DELIMITED BY SIZE             21720000
217300                                  INTO AINVDTEO                   21730000
217400     MOVE ASC-ENT-NAME-DESC         TO ANAMEO                     21740000
217600     MOVE ASC-ADDRESS-LINE1-DESC    TO AADDR1O                    21760000
217700     MOVE ASC-STR-NBR               TO PV-NUM4-9                  21770000
217800     MOVE PV-NUM4-X                 TO ASTRNBRO                   21780000
217900     MOVE ASC-ADDRESS-LINE2-DESC    TO AADDR2O                    21790000
218000     MOVE ASC-DEPT-NBR              TO ADPTNBRO                   21800000
218100     MOVE ASC-CITY-NAME             TO ACITYO                     21810000
218200     MOVE ASC-STATE-CDE             TO ASTATEO                    21820000
218300     MOVE ASC-ZIP-CDE               TO AZIPO                      21830000
218400     MOVE ASC-DC-NBR                TO PV-NUM4-9                  21840000
218500     MOVE PV-NUM4-X                 TO ADCNBRO                    21850000
218600     MOVE ASC-MTCH-LVL-CDE          TO AMTCHCDO                   21860000
218700     IF ASC-GRO-COST-AMT = +0                                     21870000
218800         MOVE SPACES                TO ATOTCSTO                   21880000
218900     ELSE                                                         21890000
219000         MOVE ASC-GRO-COST-AMT      TO PV-8V99                    21900000
219100         MOVE PV-8V99-X             TO ATOTCSTO                   21910000
219200     END-IF                                                       21920000
219300                                                                  21930000
219400     MOVE ASC-TOT-INVC-PC-QTY       TO PV-NUM11                   21940000
219500     MOVE PV-NUM11-X                TO ATOTINVO                   21950000
219600                                                                  21960000
219700     MOVE ASC-NET-INVC-AMT          TO PV-8V99                    21970000
219800     MOVE PV-8V99-X                 TO ANETINVO                   21980000
219900                                                                  21990000
220200     PERFORM 4410-FILL-PO-FIELDS.                                 22020000
221400     PERFORM 4420-FILL-INVC-FIELDS.                               22140000
222500                                                                  22250000
222600     MOVE ASC-CARTON-CNT            TO ACARTCTO                   22260000
222700                                                                  22270000
222800     MOVE PC-BILL-OF-LADING         TO ABOLLBLO                   22280000
222900                                                                  22290000
223000     EVALUATE TRUE                                                22300000
223100        WHEN ASC-KEY-INVC-TYP-CDE = 'MI'                          22310000
223200             MOVE 'MERCHANDISE'       TO AINVTYPO                 22320000
223300        WHEN ASC-KEY-INVC-TYP-CDE = 'WO'                          22330000
223400             MOVE 'WRITE OFF  '       TO AINVTYPO                 22340000
223500        WHEN ASC-KEY-INVC-TYP-CDE = 'RI'                          22350000
223600             MOVE 'REMAINDER  '       TO AINVTYPO                 22360000
223700        WHEN ASC-EXPENSE-INVC                                     22370000
223800             MOVE 'EXPENSE    '       TO AINVTYPO                 22380000
223900        WHEN OTHER                                                22390000
224000             MOVE 'NOT DEFINED'       TO AINVTYPO                 22400000
224100     END-EVALUATE                                                 22410000
224200                                                                  22420000
224300     MOVE ASC-KOHLS-FRGT-PCT-NUM    TO PV-NUM3                    22430000
224400     MOVE PV-NUM3-X                 TO ACMPFRTO                   22440000
224500                                                                  22450000
224600     MOVE ASC-VEND-FRGT-PCT-NUM     TO PV-NUM3                    22460000
224700     MOVE PV-NUM3-X                 TO AVNDFRTO                   22470000
224800                                                                  22480000
224900     MOVE ASC-ENTR-MTHD-CDE         TO AENTMTHO                   22490000
225000     MOVE ASC-BOL-ID                TO ABOLNBRO                   22500000
225100     MOVE ASC-IMPRT-CHRG-CDE        TO ACHRGCDO                   22510000
225200     MOVE ASC-IN-SPLIT-TERMS-IND    TO ASPLITO                    22520000
225300     STRING ASC-CRE-DTE-MM          DELIMITED BY SIZE             22530000
225400            '/'                     DELIMITED BY SIZE             22540000
225500            ASC-CRE-DTE-DD          DELIMITED BY SIZE             22550000
225600            '/'                     DELIMITED BY SIZE             22560000
225700            ASC-CRE-DTE-YY          DELIMITED BY SIZE             22570000
225800                                  INTO AENTDTEO                   22580000
225900                                                                  22590000
226000     MOVE ASC-TALCHRG-EXISTS-SW     TO AALLWCHO                   22600000
226100                                                                  22610000
226200     EVALUATE TRUE                                                22620000
226300        WHEN ASC-DUE-DTE-SRC-CDE = 'I'                            22630000
226400             MOVE 'INVOICE  ' TO ADUESRCO                         22640000
226500        WHEN ASC-DUE-DTE-SRC-CDE = 'R'                            22650000
226600             MOVE 'RECEIVER ' TO ADUESRCO                         22660000
226700        WHEN ASC-DUE-DTE-SRC-CDE = 'X'                            22670000
226800             MOVE 'EXCEPTION' TO ADUESRCO                         22680000
226900        WHEN OTHER                                                22690000
227000             MOVE 'UNKNOWN  ' TO ADUESRCO                         22700000
227100     END-EVALUATE                                                 22710000
227200                                                                  22720000
227300     STRING ASC-CALC-DTE-MM         DELIMITED BY SIZE             22730000
227400            '/'                     DELIMITED BY SIZE             22740000
227500            ASC-CALC-DTE-DD         DELIMITED BY SIZE             22750000
227600            '/'                     DELIMITED BY SIZE             22760000
227700            ASC-CALC-DTE-YY         DELIMITED BY SIZE             22770000
227800                                  INTO ACALCDTO                   22780000
227900                                                                  22790000
228000     MOVE ASC-CRE-BY-USR-ID         TO AENTUIDO                   22800000
228100     IF ASC-PAYRLSE-DTE = '9999-09-09'                            22810000
228200         MOVE SPACES                   TO APRLDTEO                22820000
228300     ELSE                                                         22830000
228400        STRING ASC-PAYRLSE-DTE-MM      DELIMITED BY SIZE          22840000
228500               '/'                     DELIMITED BY SIZE          22850000
228600               ASC-PAYRLSE-DTE-DD      DELIMITED BY SIZE          22860000
228700               '/'                     DELIMITED BY SIZE          22870000
228800               ASC-PAYRLSE-DTE-YY      DELIMITED BY SIZE          22880000
228900                                     INTO APRLDTEO                22890000
229000     END-IF.                                                      22900000
229100                                                                  22910000
229200     MOVE '+--------------------------------------------+'        22920000
229300                                    TO ABOXBOTO                   22930000
229400*    IF INVOIC-STATUS-CDE = 'PD' AND                              22940003
229500*       PV-STATUS-CHG-DATE     > '1999-10-04'                     22950003
230000*       IF PV-HOLD-PAY-DATE NOT = SPACES                          23000003
230100*          MOVE PV-HOLD-PAY-MONTH    TO PV-REFORMATTED-MONTH      23010003
230200*          MOVE PV-HOLD-PAY-DAY      TO PV-REFORMATTED-DAY        23020003
230300*          MOVE PV-HOLD-PAY-YEAR     TO PV-REFORMATTED-YEAR       23030003
230400*          MOVE PV-REFORMAT-PAY-DATE TO ASC-PAID-DATE             23040003
230500*       ELSE                                                      23050003
230600*          MOVE SPACES TO ASC-PAID-DATE                           23060003
230700*       END-IF                                                    23070003
230800*       MOVE ASC-PAID-DATE TO APAID1O                             23080003
230900*    ELSE                                                         23090003
231000*** THE CODE BELOW COVERS INVOICES BEFORE PEOPLESOFT WAS FIRST    23100000
231100*** INSTALLED IN OCT 1999.                                        23110000
231200*       IF INVOIC-STATUS-CDE = 'PD' AND                           23120003
231300*          PV-STATUS-CHG-DATE     < '1999-10-04'                  23130003
231400*          MOVE PV-REFORMAT-PAY-DATE       TO ASC-PAID-DATE       23140003
231600*       END-IF                                                    23160003
231700*    END-IF.                                                      23170003
231701                                                                  23170103
231710     MOVE PV-REFORMAT-PAY-DATE TO ASC-PAID-DATE.                  23171003
231800                                                                  23180000
231810*    IF INVOIC-STATUS-CDE = 'PD'                                  23181003
231820     IF (INVOIC-STATUS-CDE = 'PD' OR INVOIC-STATUS-CDE = 'PJ')    23182003
231900        IF ASC-PAID-DATE > SPACES                                 23190000
231910           AND ASC-PAID-DATE NOT = '09/09/9999'                   23191004
232000           MOVE 'PAID ON..:' TO APAIDNAPO                         23200000
232100           MOVE ASC-PAID-DATE TO APAID1O                          23210000
232200        ELSE                                                      23220000
232300           MOVE SPACES        TO APAIDNAPO                        23230000
232400                                 APAID1O                          23240000
232500        END-IF                                                    23250000
232600                                                                  23260000
232700        IF ASC-CHECK-NBR > SPACES                                 23270000
232800           MOVE 'CHECK NBR:'  TO ACHECKAPO                        23280000
232900           MOVE ASC-CHECK-NBR TO ACHEC1O                          23290000
233000        ELSE                                                      23300000
233100           MOVE SPACES        TO ACHECKAPO                        23310000
233200                                 ACHEC1O                          23320000
233300        END-IF                                                    23330000
233301     ELSE                                                         23330101
233302        MOVE SPACES        TO APAIDNAPO                           23330201
233303                              APAID1O                             23330301
233304                              ACHECKAPO                           23330402
233305                              ACHEC1O                             23330501
233310     END-IF.                                                      23331000
233400                                                                  23340000
233500     IF ASC-EXPENSE-INVC                                          23350000
233600         MOVE 'CONTAINER ID..:' TO ACNTNRAPO                      23360000
233700         MOVE ASC-CONTAINER-ID    TO ACNTNRO                      23370000
233800         MOVE 'REFERENCE NBR.:'   TO AREFNCAPO                    23380000
233900         MOVE ASC-BKR-REF-NBR     TO AREFNBRO                     23390000
234000         MOVE 'ENTRY NUMBER..:'   TO AENTRYAPO                    23400000
234100         MOVE ASC-ENTRY-NBR       TO AENTRYO                      23410000
234200     ELSE                                                         23420000
234300         MOVE SPACES TO ACNTNRAPO                                 23430000
234400                        ACNTNRO                                   23440000
234500                        AREFNCAPO                                 23450000
234600                        AREFNBRO                                  23460000
234700                        AENTRYAPO                                 23470000
234800                        AENTRYO                                   23480000
234900     END-IF.                                                      23490000
235000/                                                                 23500000
235100 4410-FILL-PO-FIELDS.                                             23510000
235200                                                                  23520000
235300*WR5091 IF PO SEL THEN FILL IN 'S' ELSE ' '                       23530000
235400     IF ASC-PO-SEL = 'S'                                          23540000
235500        MOVE 'S'                    TO APOSELO                    23550000
235600     ELSE                                                         23560000
235700        MOVE ' '                    TO APOSELO                    23570000
235800     END-IF                                                       23580000
235900                                                                  23590000
236000     IF ASC-PO-DISCOUNT-PCT = 0                                   23600000
236100         MOVE 'NET'                 TO APOPCTO                    23610000
236200     ELSE                                                         23620000
236300         MOVE ASC-PO-DISCOUNT-PCT   TO PV-2V99                    23630000
236400         MOVE PV-2V99-X             TO APOPCTO                    23640000
236500     END-IF                                                       23650000
236600                                                                  23660000
236700     MOVE ASC-PO-DISCOUNT-DAYS-QTY  TO PV-NUM3                    23670000
236800     MOVE PV-NUM3-X                 TO APODAYO                    23680000
236900                                                                  23690000
237000     IF ASC-PO-DUE-DAY-FR-DTE-TXT = 'EOM'                         23700000
237100         MOVE 'Y'                   TO APOEOMO                    23710000
237200     ELSE                                                         23720000
237300         MOVE 'N'                   TO APOEOMO                    23730000
237400     END-IF                                                       23740000
237500                                                                  23750000
237600     MOVE ASC-PO-DISC-PAY-DAY-QTY   TO PV-NUM3                    23760000
237700     MOVE PV-NUM3-X                 TO APOEXTO.                   23770000
237800                                                                  23780000
237900 4420-FILL-INVC-FIELDS.                                           23790000
238000                                                                  23800000
238100*WR5091 IF INV SEL THEN FILL IN 'S' ELSE ' '                      23810000
238200     IF ASC-IN-SEL = 'S'                                          23820000
238300        MOVE 'S'                    TO AINSELO                    23830000
238400     ELSE                                                         23840000
238500        MOVE ' '                    TO AINSELO                    23850000
238600     END-IF                                                       23860000
238700                                                                  23870000
238800     IF ASC-IN-DISC-PCT = 0                                       23880000
238900         MOVE 'NET'             TO AINPCTO                        23890000
239000     ELSE                                                         23900000
239100         MOVE ASC-IN-DISC-PCT   TO PV-2V99                        23910000
239200         MOVE PV-2V99-X         TO AINPCTO                        23920000
239300     END-IF                                                       23930000
239400                                                                  23940000
239500     MOVE  ASC-IN-DISC-DUE-DAY-QTY TO PV-NUM3                     23950000
239600     MOVE  PV-NUM3-X                TO AINDAYO                    23960000
239700                                                                  23970000
239800     MOVE  ASC-IN-EOM               TO AINEOMO                    23980000
239900                                                                  23990000
240000     MOVE  ASC-IN-EXTD-DAYS-QTY     TO PV-NUM3                    24000000
240100     MOVE  PV-NUM3-X                TO AINEXTO                    24010000
240200                                                                  24020000
240300     MOVE ASC-IN-SPLIT-TERMS-IND TO ASPLITO.                      24030000
240400/                                                                 24040000
240500*---------------------------------------------------------------- 24050000
240600* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.        24060000
240700*---------------------------------------------------------------- 24070000
240800                                                                  24080000
240900 9100-READ-SEL-QUEUE.                                             24090000
241000     EXEC CICS                                                    24100000
241100         READQ TS                                                 24110000
241200             QUEUE (ASC-SEL-QUEUE-NAME)                           24120000
241300             INTO  (AP301-INVC-LIST-TS-RCRD)                      24130000
241400             ITEM  (ASC-SEL-ITEM)                                 24140000
241500             RESP  (PV-CICS-RESPONSE)                             24150000
241600     END-EXEC.                                                    24160000
241700                                                                  24170000
241800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   24180000
241900         CONTINUE                                                 24190000
242000     ELSE                                                         24200000
242100         SET DP013-LOGIC-ABEND                                    24210000
242200             DP013-NO-ROLLBACK     TO TRUE                        24220000
242300         MOVE '9100-READ-SEL-QUEUE'                               24230000
242400                                   TO DP013-PARAGRAPH             24240000
242500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   24250000
242600                                   TO DP013-MESSAGE-TEXT (1)      24260000
242700         PERFORM DP013-0000-PROCESS-ABEND                         24270000
242800     END-IF.                                                      24280000
242900                                                                  24290000
243000/                                                                 24300000
243100*---------------------------------------------------------------- 24310000
243200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        24320000
243300*---------------------------------------------------------------- 24330000
243400 9200-REWRITE-LIST-QUEUE.                                         24340000
243500                                                                  24350000
243600     EXEC CICS                                                    24360000
243700          WRITEQ TS                                               24370000
243800              QUEUE  (ASC-SEL-QUEUE-NAME)                         24380000
243900              FROM   (AP301-INVC-LIST-TS-RCRD)                    24390000
244000              ITEM   (ASC-SEL-ITEM)                               24400000
244100              RESP   (PV-CICS-RESPONSE)                           24410000
244200              REWRITE                                             24420000
244300     END-EXEC.                                                    24430000
244400                                                                  24440000
244500     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               24450000
244600         SET DP013-CICS-ABEND                                     24460000
244700             DP013-NO-ROLLBACK     TO TRUE                        24470000
244800         MOVE '9200-REWRITE-LIST-QUEUE'                           24480000
244900                                   TO DP013-PARAGRAPH             24490000
245000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   24500000
245100                                   TO DP013-MESSAGE-TEXT (1)      24510000
245200         PERFORM DP013-0000-PROCESS-ABEND                         24520000
245300     END-IF.                                                      24530000
245400                                                                  24540000
245500/                                                                 24550000
245600*---------------------------------------------------------------- 24560000
245700*    ABEND PROCESSOR MODULE                                       24570000
245800*---------------------------------------------------------------- 24580000
245900                                                                  24590000
246000     COPY DPPD013.                                                24600000
