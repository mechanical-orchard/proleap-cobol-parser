000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'PACK-TO-LITE SML UPLOAD FROM PCC P2L SYSTEM'.             00020000
000300                                                                  00030000
000400 PROGRAM-ID.             PCKCS723.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           AUTUMN 2000.                             00070000
000800 DATE-COMPILED.                                                   00080000
000900****************************************************************  00090000
001000*  WILL BE USED AS A SERVER TO PROCESS UPLOADED SML DATA FROM THE 00100000
001100*  THEOPACK  PACK-TO-LIGHT APPLICATION.                           00110000
001200*                                                                 00120000
001300* THIS PROGRAM IS STARTED FROM THE THEOPACK PACK-TO-LIGHT         00130000
001400* SYSTEM.  ON THAT SYSTEM, THE APPLICATION WILL UPLOAD DATA FROM  00140000
001500* THE SYSTEM TO THE MAINFRAME WHEN A STORE TOTE (SML) IS CLOSED.  00150000
001600*                                                                 00160000
001700* THIS PROGRAM IS EXECUTED VIA A SOCKET CALL.                     00170000
001800*                                                                 00180000
001900* WHEN THE PROGRAM IS EXECUTED, IT WILL TAKE THE DATA FROM THE    00190000
002000* SOCKET CALL AND ATTEMPT TO UPDATE THE CARTON DATABASES WITHIN   00200000
002100* THE KOHL'S LEGACY SYSTEM TO REFLECT THE CREATION OF A CARTON    00210000
002200* AND THE CONTENTS OF THE CARTON.                                 00220000
002300*                                                                 00230000
002400* IF THE UPDATE IS SUCCESSFUL, A GOOD CONFIRMATION WILL BE PASSED 00240000
002500* TO THE PACK-TO-LIGHT SYSTEM AND PROCESSING IS COMPLETED.  IF    00250000
002600* THE UPDATE IS NOT SUCCESSFUL, A BAD CONFIRMATION WILL BE        00260000
002700* PASSED TO THE PACK-TO-LIGHT SYSTEM AND PROCESSING WILL BE       00270000
002800* COMPLETED (WHEN A BAD CONFIRMATION IS SENT BACK TO THE PACK-    00280000
002900* TO-LIGHT SYSTEM, THAT SYSTEM WILL ATTEMPT TO RE-SEND THE DATA   00290000
003000* AT A LATER TIME).                                               00300000
003100****************************************************************  00310000
003200                                                                  00320000
003300/                                                                 00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500 DATA DIVISION.                                                   00350000
003600 WORKING-STORAGE SECTION.                                         00360000
003700                                                                  00370000
003800*                                                                 00380000
003900*  SOCKET COMMANDS CODES NEED FOR THE TCP/IP SOCKET CALLS         00390000
004000*                                                                 00400000
004100 01  FILLER                           PIC X(20) VALUE             00410000
004200     '******START DPWS081*'.                                      00420000
004300     COPY DPWS081.                                                00430000
004400 01  FILLER                           PIC X(20) VALUE             00440000
004500     '********END DPWS081*'.                                      00450000
004600                                                                  00460000
004700*   ENHANCED SML UPLOAD                                           00470000
004800     COPY PCWS185.                                                00480000
004900/                                                                 00490000
005000*-----------------------------------------------------------------00500000
005100*  COPYBOOK FOR LOGISTIC MODULE XLKUT001                          00510000
005200*-----------------------------------------------------------------00520000
005300     COPY XLWS001.                                                00530000
005400                                                                  00540000
005500/                                                                 00550000
005600 77  TASK-START                     PIC X(40)                     00560000
005700      VALUE IS 'CONFIRMS....CICS-TCPIP INTERFACE START.;'.        00570000
005800 77  TASK-END                       PIC X(40)                     00580000
005900      VALUE IS 'CONFIRMS....CICS-TCPIP INTERFACE END....'.        00590000
006000*                                                                 00600000
006100 01  TCP-BUF-AREA.                                                00610000
006200     05  TCP-BUF-ALL                     PIC X(100) VALUE SPACES. 00620000
006300     05  TCP-BUF REDEFINES TCP-BUF-ALL                            00630000
006400                OCCURS 100 TIMES         PIC  X(01).              00640000
006500 01  PV-BUFFER-SUB                    PIC 9(08) BINARY VALUE ZERO.00650000
006600                                                                  00660000
006700 01  DK-DB2-KEYS.                                                 00670000
006800     05  DK-SHIPT-UNT-ID              PIC S9(18)V COMP-3          00680000
006900                                           VALUE ZERO.            00690000
007000     05  DK-OPER-UNT-ID               PIC S9(4) VALUE ZERO        00700000
007100                                           COMP SYNC.             00710000
007200                                                                  00720000
007300     05  DK-ORD-NBR              PIC S9(9) VALUE ZERO COMP SYNC.  00730000
007400     05  DK-REC-SEQ-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00740000
007410     05  DK-REC-SEQ-NBR-THSND    PIC S9(9) VALUE ZERO COMP SYNC.  00741024
007500     05  DK-ORD-LNE-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00750000
007600     05  DK-WRK-ORD-SEQ-NBR      PIC S9(4) VALUE ZERO COMP SYNC.  00760000
007700     05  DK-STR-NBR              PIC S9(4) VALUE ZERO COMP SYNC.  00770000
007800     05  DK-PREPK-REC-SEQ-NBR    PIC S9(9) VALUE ZERO COMP SYNC.  00780000
007900     05  DK-PREPK-ID             PIC S9(4) VALUE ZERO COMP SYNC.  00790000
008000     05  DK-TRNID                PIC  X(4) VALUE SPACE.           00800000
008100     05  DK-TIMESTAMP            PIC  X(26) VALUE SPACE.          00810000
008200     05  DK-MODU-NBR                  PIC  S9(4) COMP.            00820000
008300     05  DK-CRE-DTE-NUM          PIC  X(10) VALUE ZEROES.         00830000
008400     05  DK-OPEN-DTE-NUM         PIC  X(10) VALUE ZEROES.         00840000
008500     05  DK-UPC-NBR              PIC S9(15)V VALUE ZERO COMP-3.   00850000
008600                                                                  00860000
008700 01  PD-PROGRAM-DISPLAYS.                                         00870000
008800     05  PD-OPER-UNT-ID          PIC  9(4) VALUE ZERO.            00880000
008900     05  PD-ORD-NBR              PIC  9(9) VALUE ZERO.            00890000
009000     05  PD-REC-SEQ-NBR          PIC  9(9) VALUE ZERO.            00900000
009100     05  PD-ORD-LNE-NBR          PIC  9(9) VALUE ZERO.            00910000
009200     05  PD-SHIPT-UNT-ID         PIC  9(18)V VALUE ZERO.          00920000
009300     05  PD-P2L-MOD              PIC  9(4)  VALUE ZERO.           00930000
009400     05  PD-PREPK-ID             PIC  9(4)  VALUE ZERO.           00940000
009500                                                                  00950000
009600 01  PS-PROGRAM-SWITCHES.                                         00960000
009610     05  PS-SOCKET-ERROR-SW           PIC X(01) VALUE 'N'.        00961012
009620         88  PS-SOCKET-ERROR-NO                 VALUE 'N'.        00962012
009630         88  PS-SOCKET-ERROR                    VALUE 'Y'.        00963012
009700     05  PS-ABEND-LOOP-SW             PIC X(01) VALUE 'N'.        00970000
009800         88  PS-ABEND-LOOP-NO                   VALUE 'N'.        00980000
009900         88  PS-ABEND-LOOP                      VALUE 'Y'.        00990000
010000     05  PS-ERROR-SW                  PIC X(01) VALUE 'N'.        01000000
010100         88  PS-ERRORS-NO                       VALUE 'N'.        01010000
010200         88  PS-ERRORS-YES                      VALUE 'Y'.        01020000
010300     05  PS-SUPPRESS-SW               PIC X(01) VALUE 'N'.        01030000
010400         88  PS-OKAY-INSERT                     VALUE 'N'.        01040000
010500         88  PS-SUPPRESS-INSERT                 VALUE 'Y'.        01050000
010600     05  PS-OTBND-CART-FOUND-SW       PIC X(01) VALUE 'Y'.        01060000
010700         88  PS-OTBND-CART-FOUND                VALUE 'Y'.        01070000
010800         88  PS-OTBND-CART-NOT-FOUND            VALUE 'N'.        01080000
010900     05  PS-OTBND-CART-MST-SW         PIC X(01) VALUE 'N'.        01090008
011000         88  PS-OTBND-CART-MST                  VALUE 'Y'.        01100000
011100         88  PS-OTBND-CART-NOT-MST              VALUE 'N'.        01110000
011200     05  PS-ADD-UPDATE-LABEL-SW       PIC X(01) VALUE SPACE.      01120000
011300         88  PS-ADD-LABEL                       VALUE 'A'.        01130000
011400         88  PS-UPDATE-LABEL                    VALUE 'U'.        01140000
011500     05  PS-PREPK-CSR-SW              PIC X(01) VALUE SPACE.      01150000
011600         88  PS-END-OF-PREPK-CSR                VALUE 'Y'.        01160000
011700         88  PS-START-OF-PREPK-CSR              VALUE 'N'.        01170000
011800     05  PS-PREPK-CSR-OPEN-SW         PIC X(01) VALUE 'N'.        01180000
011900         88  PS-PREPK-CSR-OPEN                  VALUE 'Y'.        01190000
012000         88  PS-PREPK-CSR-CLOSED                VALUE 'N'.        01200000
012100     05  PS-SOCKET-SW                 PIC X(01) VALUE 'N'.        01210000
012200         88  PS-SOCKET-OPEN                     VALUE 'Y'.        01220000
012300         88  PS-SOCKET-CLOSED                   VALUE 'N'.        01230000
012400     05  PS-SHOW-DEBUG-SW             PIC X(01) VALUE 'N'.        01240000
012500         88  PS-DONT-SHOW-DEBUG-INFO            VALUE 'N'.        01250000
012600         88  PS-SHOW-DEBUG-INFO                 VALUE 'Y'.        01260000
012700     05  PS-DUMP-TO-LOG-SW            PIC X(01) VALUE 'N'.        01270000
012800         88  PS-DONT-DUMP-TO-LOG                VALUE 'N'.        01280000
012900         88  PS-DUMP-TO-LOG                     VALUE 'Y'.        01290000
013000                                                                  01300000
013100     05  PS-OTBND-UPC-FOUND-SW           PIC  X(01)  VALUE 'Y'.   01310000
013200         88  PS-OTBND-UPC-FOUND                      VALUE 'Y'.   01320000
013300         88  PS-OTBND-UPC-NOT-FOUND                  VALUE 'N'.   01330000
013400                                                                  01340000
013500     05  PS-PART-RECEIVE-SW              PIC  X(01)  VALUE 'S'.   01350000
013600         88  PS-PART-RECEIVE                         VALUE 'P'.   01360000
013700         88  PS-COMP-RECEIVE                         VALUE 'C'.   01370000
013800         88  PS-ERROR-RECEIVE                        VALUE 'E'.   01380000
013900         88  PS-START-RECEIVE                        VALUE 'S'.   01390000
014000     05  PS-PARTIAL-PROCESSING-SW        PIC  X(01)  VALUE 'N'.   01400000
014100         88  PS-SKIP-PARTIAL-PROCESSING              VALUE 'N'.   01410000
014200         88  PS-DO-PARTIAL-PROCESSING                VALUE 'Y'.   01420000
014210     05  PS-SUCCESSFUL-PKD-UPC-SW        PIC  X(01)  VALUE 'N'.   01421018
014220         88  PS-SUCCESSFUL-PKD-UPC-NO                VALUE 'N'.   01422018
014230         88  PS-SUCCESSFUL-PKD-UPC-YES               VALUE 'Y'.   01423018
014300                                                                  01430000
014400 01  PC-PROGRAM-CONSTANTS.                                        01440000
014500     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKCS723'. 01450000
014600     05  PC-LOG-QUEUE                 PIC X(04) VALUE 'CSSL'.     01460000
014700     05  PC-MSG-TABLE-SIZE            PIC S9(03) COMP-3 VALUE 200.01470000
014800*    HEX '3B'                                                     01480000
014900     05  PC-TERM-CHARACTER            PIC  X(01)   VALUE ''.     01490022
014910     05  PC-TERM-CHARACTER-2          PIC  X(01)   VALUE x'3B'.   01491022
015000     05  PC-A                         PIC X(01) VALUE 'A'.        01500000
015100                                                                  01510000
015200 01  PV-PROGRAM-VARIABLES.                                        01520000
015210     05  PV-DISPLAY-SOCKETS           PIC  9(8)  VALUE ZERO.      01521011
015220     05  PV-DISPLAY-SOCKNO            PIC  9(8)- VALUE ZERO.      01522011
015300     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01530003
015400                                                     COMP SYNC.   01540003
015500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01550003
015600                                                    COMP SYNC.    01560003
015700     05  PV-SAVE-ORD-LNE-NBR          PIC  S9(9) COMP             01570000
015800                                        VALUE ZERO.               01580000
015900     05  PV-SAVE-PO-NUMBER            PIC  S9(9) COMP             01590000
016000                                        VALUE ZERO.               01600000
016100     05  PV-SAVE-RCVR-NMBR            PIC  S9(9) COMP             01610000
016200                                        VALUE ZERO.               01620000
016300     05  PV-TIMESTAMP.                                            01630000
016400         10  PV-TIMESTAMP-CCYY        PIC X(04).                  01640000
016500         10  PV-TMST-DASH-1           PIC X(01).                  01650000
016600         10  PV-TIMESTAMP-MM          PIC X(02).                  01660000
016700         10  PV-TMST-DASH-2           PIC X(01).                  01670000
016800         10  PV-TIMESTAMP-DD          PIC X(02).                  01680000
016900         10  PV-TMST-DASH-3           PIC X(01).                  01690000
017000         10  PV-TIMESTAMP-HH          PIC X(02).                  01700000
017100         10  PV-TMST-DOT-1            PIC X(01).                  01710000
017200         10  PV-TIMESTAMP-MIN         PIC X(02).                  01720000
017300         10  PV-TMST-DOT-2            PIC X(01).                  01730000
017400         10  PV-TIMESTAMP-SS          PIC X(02).                  01740000
017500         10  PV-TMST-DOT-3            PIC X(01).                  01750000
017600         10  PV-TMST-MICRO-SS         PIC 9(06).                  01760000
017700     05  PV-SAVE-UPLOAD-REC           PIC   X(100).               01770000
017800     05  PV-MODU-NBR-X                PIC   X(3).                 01780000
017900     05  PV-MODU-NBR-9-3 REDEFINES PV-MODU-NBR-X                  01790000
018000                                      PIC   9(3).                 01800000
018100     05  PV-MODU-NBR-X3  REDEFINES PV-MODU-NBR-X.                 01810000
018200         10  PV-MODU-NBR-FIRST-2      PIC   9(2).                 01820000
018300         10  PV-MODU-NBR-LAST-1       PIC   X(1).                 01830000
018400     05  PV-TASK-START-LENGTH         PIC 9(8) BINARY             01840000
018500                                                VALUE 40.         01850000
018600     05  PV-COMPARE-NUM              PIC S9(09) COMP VALUE ZEROES.01860000
018700     05  PV-AMOUNT                   PIC S9(05) VALUE ZEROES.     01870000
018800     05  PV-AMOUNT-DISPLAY           PIC -9(05).                  01880000
018900     05  PV-CURRENT-DATE              PIC X(10) VALUE SPACES.     01890000
019000     05  PV-STORE-NBR.                                            01900000
019100         10  PV-STORE-NBR-N           PIC 9(04) VALUE ZERO.       01910000
019200     05  PV-SML-NBR.                                              01920000
019300         10  PV-SML-NBR-N             PIC 9(18).                  01930000
019400     05  PV-HOLD-SML-NBR              PIC X(20) VALUE ZEROES.     01940000
019500     05  PV-REVISION-NBR.                                         01950000
019600         10  PV-REVISION-NBR-N        PIC 99 VALUE ZERO.          01960000
019700     05  PV-REVISION-NBR-OLD.                                     01970000
019800         10  PV-REVISION-NBR-OLD-N    PIC 99 VALUE ZERO.          01980000
019900     05  PV-RECS-READ                 PIC S9(9) COMP VALUE ZERO.  01990000
020000     05  PV-RECS-READ-DISPLAY         PIC  9(9)      VALUE ZERO.  02000000
020100     05  PV-PC185-TOTAL               PIC  9(9)      VALUE ZERO.  02010000
020200     05  PV-PACKED-QTY-X.                                         02020000
020300         10  PV-PACKED-QTY            PIC S9(06) VALUE ZERO.      02030016
020400     05  PV-WHOLE-PACKS               PIC S9(07) COMP VALUE ZERO. 02040000
020500     05  PV-ODD-UNITS                 PIC S9(07) COMP VALUE ZERO. 02050000
020600     05  PV-ABEND-COUNT               PIC 9(05) VALUE ZERO.       02060000
020700     05  PV-ERROR-COUNT               PIC 9(03) VALUE ZERO.       02070000
020800     05  PV-ERROR-CODE                PIC X(03) VALUE ZERO.       02080000
020900     05  PV-OPEN-DATE                 PIC X(10) VALUE SPACES.     02090000
021000     05  PV-OPEN-TIME                 PIC X(08) VALUE SPACES.     02100000
021100     05  PV-CLOSE-TMST.                                           02110000
021200         10  PV-CLOSE-CCYY            PIC X(04) VALUE ZEROES.     02120000
021300         10  FILLER                   PIC X(01) VALUE '-'.        02130000
021400         10  PV-CLOSE-MO              PIC X(02) VALUE ZEROES.     02140000
021500         10  FILLER                   PIC X(01) VALUE '-'.        02150000
021600         10  PV-CLOSE-DD              PIC X(02) VALUE ZEROES.     02160000
021700         10  FILLER                   PIC X(01) VALUE '-'.        02170000
021800         10  PV-CLOSE-HH              PIC X(02) VALUE ZEROES.     02180000
021900         10  FILLER                   PIC X(01) VALUE '.'.        02190000
022000         10  PV-CLOSE-MM              PIC X(02) VALUE ZEROES.     02200000
022100         10  FILLER                   PIC X(01) VALUE '.'.        02210000
022200         10  PV-CLOSE-SS              PIC X(02) VALUE ZEROES.     02220000
022300         10  FILLER                   PIC X(01) VALUE '.'.        02230000
022400         10  FILLER                   PIC X(06) VALUE ZEROES.     02240000
022500     05  PV-CLOSE-TIMESTAMP REDEFINES PV-CLOSE-TMST               02250000
022600                                      PIC X(26).                  02260000
022700     05  PV-PRC-TMST                  PIC X(26) VALUE SPACES.     02270000
022800                                                                  02280000
022900     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02290000
023000                                                     COMP SYNC.   02300000
023100     05  PV-TASK-X.                                               02310000
023200         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  02320000
023300     05  PV-RECEIVE-LENGTH               PIC S9(04)  VALUE +0     02330000
023400                                                     COMP SYNC.   02340000
023500     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02350000
023600     05  PV-RETCODE                      PIC  9(08)  VALUE ZEROS. 02360000
023700     05  PV-TCPLENG                      PIC  9(08)  VALUE ZEROS. 02370000
023800     05  PV-ERRNO                        PIC  9(08)  VALUE ZEROS. 02380000
023900     05  PV-TCP-BUF                      PIC  X(100) VALUE SPACES.02390000
024000     05  PV-SQLCODE                   PIC -9(5) VALUE ZEROES.     02400000
024100     05  PV-PREV-SEQUENCE             PIC S9(05) COMP-3           02410000
024200                                                     VALUE ZERO.  02420000
024300     05  PV-NEXT-SEQUENCE             PIC S9(05) COMP-3           02430000
024400                                                     VALUE ZERO.  02440000
024500                                                                  02450000
024600     05  PV-ACTUAL-DISTRO-QTY-X.                                  02460000
024700         10 PV-ACTUAL-DISTRO-QTY         PIC 9(06).               02470000
024800     05  PV-ORD-NBR-X.                                            02480000
024900         10 PV-ORD-NBR                   PIC 9(08).               02490000
025000     05  PV-REC-SEQ-NBR-X.                                        02500000
025100         10 PV-REC-SEQ-NBR               PIC 9(03).               02510000
025200     05  PV-ORD-LNE-NBR-X.                                        02520000
025300         10 PV-ORD-LNE-NBR               PIC 9(04).               02530000
025400                                                                  02540000
025500     05  PV-TCP-EXP-LENGTH               PIC 9(08)   VALUE 100.   02550000
025600     05  PV-TCP-RET-LENGTH               PIC 9(08)   VALUE ZEROS. 02560000
025700     05  PV-TCP-REM-LENGTH               PIC 9(08)   VALUE ZEROS. 02570000
025800     05  PV-TCP-PRCSD-LENGTH             PIC 9(08)   VALUE ZEROS. 02580000
025810     05  PV-PKD-UPC-COUNT                PIC 9(03)   VALUE ZEROS. 02581018
025900                                                                  02590000
026000 01  PV-DEBUG-DISPLAY-STUFF.                                      02600000
026100     05  PV-DISP-NBR                  PIC 9(05) VALUE ZERO.       02610000
026200     05  PV-DISP-TASK                 PIC 9(07) VALUE ZERO.       02620000
026300     05  PV-DISP-PACKS                PIC 9(05) VALUE ZERO.       02630000
026400     05  PV-DISP-ODD-UNITS            PIC 9(05) VALUE ZERO.       02640000
026500     05  PV-DISP-RETCODE              PIC -9(07) VALUE ZERO.      02650000
026600     05  PV-DISP-OPER-UNT-ID          PIC 9(04) VALUE ZERO.       02660000
026700     05  PV-DISP-PO                   PIC 9(08) VALUE ZERO.       02670000
026800     05  PV-DISP-LINE                 PIC 9(04) VALUE ZERO.       02680000
026900     05  PV-DISP-REC-SEQ-NBR          PIC 9(04) VALUE ZERO.       02690000
026910     05  PV-DISP-REC-THSND            PIC 9(04) VALUE ZERO.       02691025
027000     05  PV-DISP-PREPK-ID             PIC 9(04) VALUE ZERO.       02700000
027100     05  PV-DISP-ITEM                 PIC 9(15) VALUE ZERO.       02710000
027200     05  PV-DISP-SHPUNT               PIC 9(18) VALUE ZERO.       02720000
027300     05  PV-DISP-MSG-NBR              PIC 9(03) VALUE ZERO.       02730000
027400     05  PV-DISP-SYSTEM-TMST          PIC X(26) VALUE SPACES.     02740000
027500     05  PV-DISP-TABLE-1              PIC X(08) VALUE SPACES.     02750000
027600     05  PV-DISP-TABLE-2              PIC X(08) VALUE SPACES.     02760000
027700     05  PV-DISP-TABLE-3              PIC X(08) VALUE SPACES.     02770000
027800     05  PV-DISP-CHILD                PIC 9(09) VALUE ZERO.       02780000
027900                                                                  02790000
028000     05  PV-CHILD-COUNT               PIC S9(09)  COMP.           02800000
028100                                                                  02810000
028101* DMH - 03/07/08 - BEGIN                                          02810109
028102* add select parameter before recv socket command to determine if 02810209
028103* is still active                                                 02810309
028104*                                                                 02810409
028105* SELECT-NUMFDS needs to be set to 3.  1 for each p2l system and  02810509
028106* one for the print management system                             02810609
028107*                                                                 02810709
028108*                                                                 02810809
028109 01  SELECT-PARMS.                                                02810909
028110     02  SELECT-NUMFDS          PIC 9(8) COMP VALUE 3.            02811009
028111     02  SELECT-TIMEOUT.                                          02811109
028112         03  SELECT-SECS        PIC 9(8) COMP VALUE 05.           02811209
028113         03  SELECT-MILLSECS    PIC 9(8) COMP VALUE 0.            02811309
028114     02  SELECT-RD-MASK         PIC X(16).                        02811409
028115     02  SELECT-WR-MASK         PIC X(16).                        02811509
028116     02  SELECT-EX-MASK         PIC X(16).                        02811609
028117     02  SELECT-RR-MASK         PIC X(16).                        02811709
028118     02  SELECT-RW-MASK         PIC X(16).                        02811809
028119     02  SELECT-RE-MASK         PIC X(16).                        02811909
028121                                                                  02812110
028122 01  CHAR-MASK.                                                   02812210
028123     02 CHAR-STRING             PIC  X(100).                      02812310
028124                                                                  02812410
028125 01  CHAR-ARRAY REDEFINES CHAR-MASK.                              02812510
028126     02  CHAR-ENTRY-TABLE OCCURS 100 TIMES.                       02812610
028127       03  CHAR-ENTRY         PIC  X.                             02812710
028128                                                                  02812810
028129 01  BIT-MASK.                                                    02812910
028130     02  BIT-ARRAY            PIC  X(16).                         02813010
028131                                                                  02813110
028132 01  BIT-FUNCTION-CODES.                                          02813210
028133     02  CTOB                 PIC  X(4) VALUE 'CTOB'.             02813310
028134     02  BTOC                 PIC  X(4) VALUE 'BTOC'.             02813410
028135                                                                  02813510
028136 01  BIT-MASK-LENGTH          PIC  9(8) COMP VALUE 100.           02813610
028137                                                                  02813710
028138 01  BITMASK-TOKEN            PIC X(16) VALUE 'TCPIPBITMASKCOBL'. 02813810
028139 01  SOCKETS                  PIC  9(8) COMP VALUE 100.           02813910
028140 01  SOCKNO                   PIC S9(8) BINARY.                   02814010
028141 01  EZRETC                   PIC S9(8) COMP.                     02814110
028142                                                                  02814210
028143 01  SOCKET-SELECT-ERR.                                           02814310
028144     05  FILLER                       PIC X(10)                   02814410
028145         VALUE ' PCKCS723-'.                                      02814513
028146     05  FILLER                       PIC X(14)                   02814610
028147         VALUE 'SOCKET SELECT-'.                                  02814710
028148     05  FILLER                       PIC X(7)                    02814810
028149         VALUE '-RETCD='.                                         02814910
028150     05  SOCKET-RETCODE               PIC 9(10)-.                 02815010
028151     05  FILLER                       PIC X(1) VALUE SPACES.      02815113
028152     05  SOCKET-ERRNO                 PIC 9(8).                   02815210
028153     05  FILLER                       PIC X(1) VALUE SPACES.      02815313
028154     05  SOCKET-DESCR                 PIC X(10).                  02815413
028155     05  FILLER                       PIC X(1) VALUE SPACES.      02815513
028156     05  SOCKET-MESSAGE               PIC X(100).                 02815613
028161*                                                                 02816110
028162* DMH - 03/07/08 - END                                            02816210
028163*                                                                 02816310
028170                                                                  02817009
028200*  WORK AREAS FOR PROCESSING PARTIAL SOCKET TRANSMISSIONS         02820000
028300 01  PT-TCP-RECEIVE-TABLE.                                        02830000
028400     05  PT-TCP-RECEIVE OCCURS 100 TIMES                          02840000
028500                        INDEXED BY PT-RECEIVE-IDX.                02850000
028600         10  PT-TCP-RECEIVE-CHAR         PIC X(01).               02860000
028700                                                                  02870000
028800 01  PT-TCP-ASSEMBLE-TABLE.                                       02880000
028900     05  PT-TCP-DATA-ASSEMBLE OCCURS 100 TIMES                    02890000
029000                              INDEXED BY PT-ASSEMBLE-IDX.         02900000
029100         10  PT-TCP-DATA-CHAR            PIC X(01).               02910000
029200/                                                                 02920000
029300 01  PT-MSG-TABLE.                                                02930000
029400     05  PT-MSG-LINES OCCURS 200 TIMES                            02940000
029500                              INDEXED BY PT-MSG-IDX.              02950000
029600         10  PT-MSG-SEQ                  PIC S9(05) COMP-3.       02960000
029700         10  PT-MSG-LINE                 PIC X(69).               02970000
029800                                                                  02980000
029900* DSNTIAR OUTPUT LINES                                            02990000
030000     COPY DPWS004.                                                03000000
030100                                                                  03010000
030200*    P2L SHIP UNIT CARTONS                                        03020000
030300     EXEC SQL                                                     03030000
030400         INCLUDE SUT00024                                         03040000
030500     END-EXEC.                                                    03050000
030600/                                                                 03060000
030700*    P2L SHIP UNIT ITEMS                                          03070000
030800     EXEC SQL                                                     03080000
030900         INCLUDE SUT00028                                         03090000
031000     END-EXEC.                                                    03100000
031100/                                                                 03110000
031200*    P2L SHIP CARTON LOCATION                                     03120000
031300     EXEC SQL                                                     03130000
031400         INCLUDE SUT00027                                         03140000
031500     END-EXEC.                                                    03150000
031600/                                                                 03160000
031700*    OUTBOUND PACK TABLE                                          03170000
031800     EXEC SQL                                                     03180000
031900         INCLUDE SUT00041                                         03190000
032000     END-EXEC.                                                    03200000
032100/                                                                 03210000
032200*    CORPORATE CONTROL                                            03220000
032300     EXEC SQL                                                     03230000
032400         INCLUDE TCOCNTL                                          03240000
032500     END-EXEC.                                                    03250000
032600/                                                                 03260000
032700*    RECVG SYSTEMS PARM TABLE                                     03270000
032800     EXEC SQL                                                     03280000
032900         INCLUDE TKRPRPM                                          03290000
033000     END-EXEC.                                                    03300000
033100                                                                  03310000
033200*    DATE TABLE                                                   03320000
033300     EXEC SQL                                                     03330000
033400         INCLUDE TDTATTR                                          03340000
033500     END-EXEC.                                                    03350000
033600                                                                  03360000
033700*    DISTRIBUTION TRANSACTION HEADER                              03370000
033800     EXEC SQL                                                     03380000
033900         INCLUDE TDISTHD                                          03390000
034000     END-EXEC.                                                    03400000
034100/                                                                 03410000
034200*    RECEIPT ITEM DISTRIBUTION TABLE                              03420000
034300     EXEC SQL                                                     03430000
034400         INCLUDE TRECITM                                          03440000
034500     END-EXEC.                                                    03450000
034600/                                                                 03460000
034700*    PO-PURCHASE ITEM TABLE                                       03470000
034800     EXEC SQL                                                     03480000
034900         INCLUDE TPURITM                                          03490000
035000     END-EXEC.                                                    03500000
035100                                                                  03510000
035200     EXEC SQL                                                     03520000
035300         INCLUDE TP2LMOD                                          03530000
035400     END-EXEC.                                                    03540000
035500                                                                  03550000
035600     EXEC SQL                                                     03560000
035700         INCLUDE SUT00025                                         03570000
035800     END-EXEC.                                                    03580000
035900/                                                                 03590000
036000*    P2L UPLOAD ERROR TABLE                                       03600000
036100     EXEC SQL                                                     03610000
036200         INCLUDE TUPLDER                                          03620000
036300     END-EXEC.                                                    03630000
036400/                                                                 03640000
036500*    PO PREPACK TABLE                                             03650000
036600     EXEC SQL                                                     03660000
036700         INCLUDE TPOPRPK                                          03670000
036800     END-EXEC.                                                    03680000
036900/                                                                 03690000
037000*---------------------------------------------------------------* 03700000
037100* PREPACK CURSOR FOR LINES FOR A SPECIFIC PULL THAT WERE NOT    * 03710000
037200* USED AS THE DRIVER/PROCESS LINE                               * 03720000
037300*---------------------------------------------------------------* 03730000
037400     EXEC SQL                                                     03740000
037500          DECLARE PRE-PACK-LNE-CSR CURSOR FOR                     03750000
037600              SELECT A.ORD_LNE_NBR                                03760000
037700                   , A.PREPK_RATO_QTY                             03770000
037800                   , B.ITM_NBR                                    03780000
037900              FROM                                                03790000
038000                  TRECITM A                                       03800000
038100                , TPURITM B                                       03810000
038200               WHERE A.ORD_NBR        = :DK-ORD-NBR               03820000
038300                 AND A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR           03830000
038400                 AND A.PREPK_ID       = :DK-PREPK-ID              03840000
038500                 AND A.PREPK_RATO_QTY > 0                         03850000
038600                 AND A.ORD_NBR        = B.PO_NBR                  03860000
038700                 AND A.ORD_LNE_NBR   <> :DK-ORD-LNE-NBR           03870000
038800                 AND A.ORD_LNE_NBR    = B.APP_PO_LNE_NBR          03880000
038900                 AND A.PO_VER_NBR     = B.VER_NBR                 03890000
039000                 AND A.VER_STATUS_CDE = 'A'                       03900000
039100            ORDER BY                                              03910000
039200                A.ORD_LNE_NBR                                     03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500                                                                  03950000
039600                                                                  03960000
039700     EXEC SQL                                                     03970000
039800          INCLUDE SQLCA                                           03980000
039900     END-EXEC.                                                    03990000
040000*----------------------------------------------------------       04000000
040100 PROCEDURE DIVISION.                                              04010000
040200                                                                  04020000
040300     PERFORM 1000-INITIALIZE.                                     04030000
040400     PERFORM 2000-PROCESS-SOCKET                                  04040000
040500         UNTIL PC185-TRAILER                                      04050000
040600            OR DP081-TCP-IP-READ-ERR                              04060000
040700            OR PS-ERRORS-YES.                                     04070000
040800                                                                  04080000
040900                                                                  04090000
041000     MOVE PV-RECS-READ  TO PV-RECS-READ-DISPLAY.                  04100007
041100     STRING ' PC185= ' PC185-TOTAL-RECORD-COUNT                   04110000
041200            '   PV-RECS-READ= ' PV-RECS-READ-DISPLAY              04120000
041300         DELIMITED BY SIZE                                        04130000
041400         INTO PV-CICS-MSG-AREA.                                   04140007
041500     PERFORM 9990-WRITE-CICS.                                     04150007
041600                                                                  04160000
041700*** DMH 5/7/03 - BEGIN                                            04170000
041800     IF PC185-TRAILER                                             04180000
041900        IF PC185-TRL-SML-NBR NUMERIC                              04190000
042000           CONTINUE                                               04200000
042100        ELSE                                                      04210000
042200           STRING                                                 04220000
042300              ' TRAILER SML  NOT NUMERIC ' PC185-TRL-SML-NBR      04230000
042400                                     DELIMITED BY SIZE            04240000
042500                                INTO PV-CICS-MSG-AREA             04250000
042600              PERFORM 9990-WRITE-CICS                             04260000
042700           SET PS-ERRORS-YES             TO TRUE                  04270000
042800           MOVE '002'                   TO PV-ERROR-CODE          04280000
042900           PERFORM 9920-ALS-ERROR                                 04290000
043000        END-IF                                                    04300000
043100                                                                  04310000
043200        IF PC185-TOTAL-RECORD-COUNT NUMERIC  OR                   04320000
043300           PS-ERRORS-YES                                          04330000
043400           CONTINUE                                               04340000
043500        ELSE                                                      04350000
043600           STRING                                                 04360000
043700              ' TRLR COUNT   NOT NUMERIC '                        04370000
043800               PC185-TOTAL-RECORD-COUNT                           04380000
043900                                     DELIMITED BY SIZE            04390000
044000                                INTO PV-CICS-MSG-AREA             04400000
044100              PERFORM 9990-WRITE-CICS                             04410000
044200           SET PS-ERRORS-YES             TO TRUE                  04420000
044300           MOVE '002'                   TO PV-ERROR-CODE          04430000
044400           PERFORM 9920-ALS-ERROR                                 04440000
044500        END-IF                                                    04450000
044600     END-IF.                                                      04460000
044700*** DMH 5/7/03 - END                                              04470000
044800                                                                  04480000
044900     IF PS-ERRORS-NO                                              04490000
045000         IF PC185-TRAILER                                         04500000
045100             EVALUATE TRUE                                        04510000
045200             WHEN PC185-TOTAL-RECORD-COUNT = ZERO                 04520000
045300*                INSERT A DUMMY ROW                               04530000
045400                 INITIALIZE DCLSUT00028                           04540000
045500                 MOVE ZERO            TO DK-ORD-NBR               04550000
045600                                         DK-REC-SEQ-NBR           04560000
045700                                         DK-ORD-LNE-NBR           04570000
045800                                         SUT00028-SHPD-UNT-QTY    04580000
045900                                         DK-UPC-NBR               04590000
046000                 PERFORM 7500-INSERT-OTBND-UPC                    04600000
046100                 MOVE '102'           TO PV-ERROR-CODE            04610000
046200                 PERFORM 7000-INSERT-TUPLDER                      04620000
046300                 INITIALIZE PC185-SML-UPLOAD-RECORD               04630000
046400                 MOVE PV-HOLD-SML-NBR TO PC185-CFM-SML-NBR        04640000
046500                 SET PC185-SUCCESSFUL TO TRUE                     04650000
046600                 MOVE ';'             TO PC185-CFM-TERM-CHAR      04660000
046700                 PERFORM 8300-SEND-ERROR-CONFIRM-QNX              04670000
046800                 PERFORM 8400-CLOSE-SOCKET                        04680000
046900             WHEN PC185-TOTAL-RECORD-COUNT = PV-RECS-READ         04690000
047000                 INITIALIZE PC185-SML-UPLOAD-RECORD               04700000
047100                 MOVE PV-HOLD-SML-NBR TO PC185-CFM-SML-NBR        04710000
047200                 SET PC185-SUCCESSFUL TO TRUE                     04720000
047300                 MOVE ';'             TO PC185-CFM-TERM-CHAR      04730000
047400                 PERFORM 8300-SEND-ERROR-CONFIRM-QNX              04740000
047500                 PERFORM 8400-CLOSE-SOCKET                        04750000
047600             WHEN OTHER                                           04760000
047700                  MOVE PC185-TOTAL-RECORD-COUNT TO PV-PC185-TOTAL 04770000
047800                  MOVE PV-RECS-READ TO PV-RECS-READ-DISPLAY       04780000
047900                  STRING ' ACTUAL='     PV-RECS-READ-DISPLAY      04790000
048000                         '   FROM PCC=' PV-PC185-TOTAL            04800000
048100                         DELIMITED BY SIZE                        04810000
048200                    INTO PV-CICS-MSG-AREA                         04820000
048300                  PERFORM 9990-WRITE-CICS                         04830000
048400                                                                  04840000
048500                 MOVE '001'           TO PV-ERROR-CODE            04850000
048600                 PERFORM 9920-ALS-ERROR                           04860000
048700             END-EVALUATE                                         04870000
048800         END-IF                                                   04880000
048900     END-IF.                                                      04890000
049000                                                                  04900000
049100*    RELEASE EXCLUSIVE USE OF THE LOG QUEUE                       04910000
049200     IF PS-SHOW-DEBUG-INFO                                        04920000
049300         EXEC CICS DEQ                                            04930000
049400             RESOURCE(PC-LOG-QUEUE)                               04940000
049500         END-EXEC                                                 04950000
049600     END-IF.                                                      04960007
049700                                                                  04970000
049800     PERFORM 1001-GET-SYSTEM-TIMESTAMP.                           04980007
049900     IF PS-DUMP-TO-LOG                                            04990000
050000         PERFORM 9999-FINAL-DUMP                                  05000000
050100     END-IF                                                       05010000
050200                                                                  05020000
050300     STRING ' PCKCS723 ENDED   - TASK = ' PV-TASK-X               05030000
050400         '  ' PV-DISP-SYSTEM-TMST                                 05040000
050500         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 05050007
050600     PERFORM 9991-WRITEQ.                                         05060007
050700     MOVE SPACES            TO PV-CICS-MSG-AREA.                  05070007
050800     PERFORM 9991-WRITEQ.                                         05080007
050900                                                                  05090000
051000     EXEC CICS                                                    05100000
051100         RETURN                                                   05110000
051200     END-EXEC.                                                    05120000
051300                                                                  05130000
051400     GOBACK.                                                      05140000
051500/                                                                 05150000
051600 1000-INITIALIZE.                                                 05160000
051700                                                                  05170000
051800     MOVE SPACES                      TO PV-CICS-MSG-AREA.        05180007
051900     PERFORM 9991-WRITEQ.                                         05190007
052000     MOVE EIBTASKN                    TO PV-TASK.                 05200007
052100     PERFORM 1001-GET-SYSTEM-TIMESTAMP.                           05210007
052200     STRING ' PCKCS723 STARTED - TASK = ' PV-TASK-X               05220000
052300         '  ' PV-DISP-SYSTEM-TMST                                 05230000
052400         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 05240007
052500     PERFORM 9991-WRITEQ.                                         05250007
052600                                                                  05260000
052700                                                                  05270000
052800     MOVE SPACES                      TO PV-CICS-MSG-AREA.        05280007
052900     INITIALIZE PT-MSG-TABLE.                                     05290000
053000     MOVE 1                           TO PT-MSG-SEQ (PT-MSG-IDX). 05300007
053100                                                                  05310000
053200     PERFORM 7100-FIND-OPER-UNT-ID.                               05320007
053300                                                                  05330000
053400     PERFORM 7110-SELECT-TKRPRPM.                                 05340000
053500                                                                  05350000
053600     STRING ' PS-SHOW-DEBUG-SW= ' PS-SHOW-DEBUG-SW                05360000
053700         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 05370007
053800     PERFORM 9990-WRITE-CICS.                                     05380000
053900                                                                  05390000
053901     PERFORM 7115-GET-SOCKET-TIMEOUT.                             05390109
053920                                                                  05392009
054000* RESERVE THE LOG QUEUE FOR THE EXCLUSIVE USE OF THIS TRANSACTION 05400000
054100* TO KEEP OTHER TRANSACTIONS FROM INTERUPTING THE DISPLAY.        05410000
054200* THIS IS DONE ONLY IF THE DEBUGGING FLAG FOR THE DC IS           05420000
054300* SWITCHED ON.  IF AN ERROR OCCURS WHEN THE FLAG IS OFF,          05430000
054400* WE WILL ENQ THE LOG BEFORE DUMPING THE MESSAGE TABLE.           05440000
054500                                                                  05450000
054600     IF PS-SHOW-DEBUG-INFO                                        05460000
054700         EXEC CICS ENQ                                            05470000
054800             RESOURCE(PC-LOG-QUEUE)                               05480000
054900         END-EXEC                                                 05490000
055000     END-IF.                                                      05500007
055100                                                                  05510000
055200     PERFORM 1100-GET-COMMAREA-FROM-LSTNR.                        05520000
055300                                                                  05530000
055400     PERFORM 8000-TAKE-SOCKET.                                    05540000
055500                                                                  05550000
055600     PERFORM 8100-CONFIRM-CONNECTION.                             05560000
055700                                                                  05570000
055800     MOVE ZEROS                       TO PV-TCP-RET-LENGTH        05580000
055900                                         PV-TCP-REM-LENGTH        05590000
056000                                         PV-TCP-PRCSD-LENGTH.     05600000
056100     MOVE SPACES                      TO TCP-BUF-AREA.            05610007
056200                                                                  05620000
056300     MOVE PC185-SML-BUFFER-SIZE       TO DP081-TCPLENG            05630000
056400                                         DP081-NBR-BYTES.         05640000
056500                                                                  05650000
056600     PERFORM 8000-RECEIVE-SOCKET UNTIL PC185-HEADER               05660000
056700                                 OR PS-ERRORS-YES.                05670000
056800                                                                  05680000
056900     IF PS-ERRORS-NO                                              05690000
057000         PERFORM 1400-EDIT-HEADER                                 05700000
057100     END-IF.                                                      05710000
057200                                                                  05720000
057300 1001-GET-SYSTEM-TIMESTAMP.                                       05730000
057400     EXEC SQL                                                     05740000
057500         SELECT                                                   05750000
057600             CURRENT TIMESTAMP                                    05760000
057700         INTO :PV-DISP-SYSTEM-TMST                                05770000
057800         FROM SYSIBM.SYSDUMMY1                                    05780000
057900     END-EXEC.                                                    05790000
058000/                                                                 05800000
058100 1100-GET-COMMAREA-FROM-LSTNR.                                    05810000
058200     STRING                                                       05820000
058300            ' PCKCS723 - 1100-GET-COMMAREA-FROM-LSTNR'            05830000
058400     DELIMITED BY SIZE                                            05840000
058500     INTO PV-CICS-MSG-AREA.                                       05850007
058600     PERFORM 9990-WRITE-CICS.                                     05860007
058700                                                                  05870000
058800     MOVE LENGTH OF DP081-LSTN-TCPSOCKET-PARM                     05880000
058900                                      TO PV-RECEIVE-LENGTH.       05890000
059000                                                                  05900000
059100     EXEC CICS                                                    05910000
059200         RETRIEVE                                                 05920000
059300             INTO    (DP081-LSTN-TCPSOCKET-PARM)                  05930000
059400             LENGTH  (PV-RECEIVE-LENGTH)                          05940000
059500             RESP    (PV-CICS-RESPONSE)                           05950000
059600     END-EXEC.                                                    05960000
059700                                                                  05970000
059800     EVALUATE TRUE                                                05980000
059900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05990000
060000             CONTINUE                                             06000000
060100         WHEN OTHER                                               06010000
060200             SET PS-ERRORS-YES        TO TRUE                     06020000
060300             MOVE PV-CICS-RESPONSE    TO PV-DISP-NBR              06030000
060400             STRING ' DFHRESP= '  PV-DISP-NBR                     06040000
060500             DELIMITED BY SIZE                                    06050000
060600             INTO PV-CICS-MSG-AREA                                06060000
060700             PERFORM 9990-WRITE-CICS                              06070000
060800                                                                  06080000
060900     END-EVALUATE.                                                06090000
061000/                                                                 06100000
061100 1400-EDIT-HEADER.                                                06110000
061200                                                                  06120000
061300     STRING '  PCKCS723 - 1400-EDIT-HEADER'                       06130000
061400         DELIMITED BY SIZE                                        06140000
061500         INTO PV-CICS-MSG-AREA.                                   06150007
061600     PERFORM 9990-WRITE-CICS.                                     06160007
061700                                                                  06170000
061800     STRING  ' '                                                  06180000
061900            PC185-SML-UPLOAD-RECORD                               06190000
062000     DELIMITED BY SIZE                                            06200000
062100     INTO PV-CICS-MSG-AREA.                                       06210007
062200     PERFORM 9990-WRITE-CICS.                                     06220000
062300                                                                  06230000
062400     MOVE PC185-HDR-SML-NBR           TO PV-HOLD-SML-NBR.         06240007
062500     IF PC185-STORE-NBR NUMERIC                                   06250000
062600         MOVE PC185-STORE-NBR         TO PV-STORE-NBR             06260000
062700         MOVE PV-STORE-NBR-N          TO DK-STR-NBR               06270000
062800     ELSE                                                         06280000
062900         STRING                                                   06290000
063000            ' STORE NUMBER NOT NUMERIC ' PC185-STORE-NBR          06300000
063100              DELIMITED BY SIZE                                   06310000
063200                                INTO PV-CICS-MSG-AREA             06320000
063300              PERFORM 9990-WRITE-CICS                             06330000
063400         SET PS-ERRORS-YES             TO TRUE                    06340000
063500         MOVE '002'                   TO PV-ERROR-CODE            06350000
063600         PERFORM 9920-ALS-ERROR                                   06360000
063700     END-IF.                                                      06370007
063800                                                                  06380000
063900     IF PC185-REVISION-NBR NUMERIC                                06390000
064000         MOVE PC185-REVISION-NBR      TO PV-REVISION-NBR          06400000
064100     ELSE                                                         06410000
064200         STRING                                                   06420000
064300            ' REVISION NUMBER NOT NUMERIC' PC185-REVISION-NBR     06430000
064400              DELIMITED BY SIZE                                   06440000
064500                                INTO PV-CICS-MSG-AREA             06450000
064600              PERFORM 9990-WRITE-CICS                             06460000
064700         SET PS-ERRORS-YES             TO TRUE                    06470000
064800         MOVE '003'                   TO PV-ERROR-CODE            06480000
064900         PERFORM 9920-ALS-ERROR                                   06490000
065000     END-IF.                                                      06500007
065100                                                                  06510000
065200     PERFORM 1401-CHECK-SHIPT-UNT-FORMAT.                         06520007
065300                                                                  06530000
065400     IF PS-ERRORS-NO                                              06540000
065500         PERFORM 7150-SELECT-OTBND-CART                           06550000
065600     END-IF.                                                      06560007
065700                                                                  06570000
065800     IF PS-ERRORS-NO                                              06580000
065900         IF PS-OTBND-CART-FOUND                                   06590000
066000             PERFORM 3903-BUILD-COMPARE-DATES                     06600000
066100             IF SUT00024-CART-SRC-CDE     = 'P2L'  OR             06610000
066200                SUT00024-CART-SRC-CDE     = 'JWL'  OR             06620000
066300* DMH 2/20/06 - BEGIN                                             06630000
066400                SUT00024-CART-SRC-CDE     = 'MST'                 06640000
066500* DMH 2/20/06 - END                                               06650000
066600                 CONTINUE                                         06660000
066700             ELSE                                                 06670000
066800                 STRING                                           06680000
066900                ' OTBND CART ERROR ' SUT00024-CART-SRC-CDE        06690000
067000                  DELIMITED BY SIZE                               06700000
067100                                INTO PV-CICS-MSG-AREA             06710000
067200                  PERFORM 9990-WRITE-CICS                         06720000
067300                 PERFORM 1402-SOURCE-ERROR                        06730000
067400             END-IF                                               06740000
067500                                                                  06750000
067600* DMH 2/20/06 - BEGIN                                             06760000
067700             IF SUT00024-CART-SRC-CDE     = 'MST'                 06770000
067800                SET  PS-OTBND-CART-MST  TO  TRUE                  06780000
067900                PERFORM 7420-CHECK-CHILD-CRTNS                    06790000
068000                IF  PV-CHILD-COUNT        > 0                     06800000
068100                    STRING                                        06810000
068200                  ' OTBND MSTR ERROR ' SUT00024-CART-SRC-CDE      06820000
068300                    DELIMITED BY SIZE                             06830000
068400                                INTO PV-CICS-MSG-AREA             06840000
068500                    PERFORM 9990-WRITE-CICS                       06850000
068600                    PERFORM 1402-SOURCE-ERROR                     06860000
068700                END-IF                                            06870000
068800             ELSE                                                 06880000
068900* DMH 2/20/06 - END                                               06890000
069000                                                                  06900000
069100             IF SUT00024-CART-RVSN-NBR < PV-REVISION-NBR-N        06910000
069200                    OR                                            06920000
069300                (SUT00024-CART-RVSN-NBR = PV-REVISION-NBR-N AND   06930000
069400                 DK-CRE-DTE-NUM  =  DK-OPEN-DTE-NUM)              06940000
069500                 CONTINUE                                         06950000
069600             ELSE                                                 06960000
069700                 IF SUT00024-CART-RVSN-NBR = PV-REVISION-NBR-N    06970000
069800                     PERFORM 1403-CHECK-4-REV-ERROR               06980000
069900                 ELSE                                             06990000
070000                     MOVE SUT00024-CART-RVSN-NBR                  07000000
070100                                            TO PV-REVISION-NBR-OLD07010000
070200                     STRING                                       07020000
070300                    ' REVISION NBR NOT GREATER THAN CURRENT '     07030000
070400                    'OLD= ' PV-REVISION-NBR-OLD                   07040000
070500                    ' NEW= ' PV-REVISION-NBR                      07050000
070600                      DELIMITED BY SIZE   INTO PV-CICS-MSG-AREA   07060000
070700                      PERFORM 9990-WRITE-CICS                     07070000
070800                      PERFORM 1403-CHECK-4-REV-ERROR              07080000
070900                 END-IF                                           07090000
071000                                                                  07100000
071100* DMH 2/20/06 - END                                               07110000
071200             END-IF                                               07120000
071300* DMH 2/20/06 - END                                               07130000
071400                                                                  07140000
071500             END-IF                                               07150000
071600         END-IF                                                   07160000
071700     END-IF.                                                      07170007
071800                                                                  07180000
071900                                                                  07190000
072000     IF PS-ERRORS-NO                                              07200000
072100         EVALUATE TRUE                                            07210000
072200         WHEN PS-OTBND-CART-FOUND  AND                            07220000
072300              PS-OTBND-CART-NOT-MST                               07230000
072400             SET PS-UPDATE-LABEL      TO TRUE                     07240000
072500             STRING                                               07250000
072600                ' UPDATE LABEL '                                  07260000
072700                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         07270000
072800                  PERFORM 9990-WRITE-CICS                         07280000
072900         WHEN PS-OTBND-CART-FOUND  AND                            07290000
073000              PS-OTBND-CART-MST                                   07300000
073100             SET PS-UPDATE-LABEL      TO TRUE                     07310000
073200             STRING                                               07320000
073300                ' UPDATE MASTER'                                  07330000
073400                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         07340000
073500                  PERFORM 9990-WRITE-CICS                         07350000
073600         WHEN PS-OTBND-CART-NOT-FOUND                             07360000
073700             SET PS-ADD-LABEL         TO TRUE                     07370000
073800             STRING                                               07380000
073900                ' ADD LABEL '                                     07390000
074000                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         07400000
074100                  PERFORM 9990-WRITE-CICS                         07410000
074200         WHEN OTHER                                               07420000
074300             PERFORM 1404-ID-ERROR                                07430000
074400         END-EVALUATE                                             07440000
074500     END-IF.                                                      07450000
074600                                                                  07460000
074700 1401-CHECK-SHIPT-UNT-FORMAT.                                     07470000
074800                                                                  07480000
074900     STRING ' 1401-CHECK-SHIPT-UNT-FORMAT'                        07490000
075000         DELIMITED BY SIZE                                        07500000
075100         INTO PV-CICS-MSG-AREA.                                   07510007
075200     PERFORM 9990-WRITE-CICS.                                     07520007
075300                                                                  07530000
075400     IF PC185-HDR-SML-NBR (1:20) NOT NUMERIC                      07540000
075500         SET PS-ERRORS-YES             TO TRUE                    07550000
075600         MOVE '004'                   TO PV-ERROR-CODE            07560000
075700         PERFORM 9910-USER-ERROR                                  07570000
075800     ELSE                                                         07580000
075900         IF PC185-HDR-SML-NBR (1:3) NOT = '004'                   07590000
076000             MOVE PC185-HDR-SML-NBR (3:18)                        07600000
076100                                      TO PV-SML-NBR               07610000
076200             SET PS-ERRORS-YES         TO TRUE                    07620000
076300             MOVE '005'               TO PV-ERROR-CODE            07630000
076400             PERFORM 9910-USER-ERROR                              07640000
076500         ELSE                                                     07650000
076600             MOVE PC185-HDR-SML-NBR (3:18)                        07660000
076700                                      TO PV-SML-NBR               07670000
076800             MOVE PV-SML-NBR-N        TO DK-SHIPT-UNT-ID          07680000
076900* DMH 6/6/2001 BEGIN                                              07690000
077000             MOVE PC185-HDR-SML-NBR (10:3)                        07700000
077100                                      TO PV-DISP-OPER-UNT-ID      07710000
077200             MOVE PV-DISP-OPER-UNT-ID TO DK-OPER-UNT-ID           07720000
077300* DMH 6/6/2001 END                                                07730000
077400         END-IF                                                   07740000
077500     END-IF.                                                      07750000
077600                                                                  07760000
077700     STRING ' DK-SHIPT-UNT-ID= '  PV-SML-NBR-N                    07770000
077800         DELIMITED BY SIZE                                        07780000
077900         INTO PV-CICS-MSG-AREA.                                   07790007
078000     PERFORM 9990-WRITE-CICS.                                     07800000
078100                                                                  07810000
078200                                                                  07820000
078300 1402-SOURCE-ERROR.                                               07830000
078400     STRING '  PCKCS723 - 1402-SOURCE-ERROR'                      07840000
078500         DELIMITED BY SIZE                                        07850000
078600         INTO PV-CICS-MSG-AREA.                                   07860007
078700     PERFORM 9990-WRITE-CICS.                                     07870007
078800                                                                  07880000
078900     SET PS-ERRORS-YES                TO TRUE.                    07890007
079000     MOVE '006'                       TO PV-ERROR-CODE.           07900007
079100     PERFORM 9910-USER-ERROR.                                     07910000
079200                                                                  07920000
079300 1403-CHECK-4-REV-ERROR.                                          07930000
079400     STRING '  PCKCS723 - 1403-CHECK-4-REV-ERROR'                 07940000
079500         DELIMITED BY SIZE                                        07950000
079600         INTO PV-CICS-MSG-AREA.                                   07960007
079700     PERFORM 9990-WRITE-CICS.                                     07970007
079800                                                                  07980000
079900     IF SUT00024-CART-SRC-CDE = 'P2L'                             07990000
080000     OR SUT00024-CART-SRC-CDE = 'JWL'                             08000000
080100         PERFORM 3903-BUILD-COMPARE-DATES                         08010000
080200         PERFORM 3920-COMPARE-DATES                               08020000
080300     ELSE                                                         08030000
080400         SET PS-ERRORS-YES                TO TRUE                 08040000
080500         MOVE '007'                       TO PV-ERROR-CODE        08050000
080600         PERFORM 9910-USER-ERROR                                  08060000
080700     END-IF.                                                      08070000
080800                                                                  08080000
080900 1404-ID-ERROR.                                                   08090000
081000     STRING '  PCKCS723 - 1404-ID-ERROR'                          08100000
081100         DELIMITED BY SIZE                                        08110000
081200         INTO PV-CICS-MSG-AREA.                                   08120007
081300     PERFORM 9990-WRITE-CICS.                                     08130007
081400                                                                  08140000
081500     SET PS-ERRORS-YES                TO TRUE.                    08150007
081600     MOVE '008'                       TO PV-ERROR-CODE.           08160007
081700     PERFORM 9910-USER-ERROR.                                     08170000
081800/                                                                 08180000
081900 2000-PROCESS-SOCKET.                                             08190000
082000                                                                  08200000
082100     STRING '  PCKCS723 - 2000-PROCESS-SOCKET'                    08210000
082200         DELIMITED BY SIZE                                        08220000
082300         INTO PV-CICS-MSG-AREA.                                   08230007
082400     PERFORM 9990-WRITE-CICS.                                     08240007
082500                                                                  08250000
082600                                                                  08260002
082700*    INITIALIZE PV-CICS-MSG-AREA.                                 08270015
082800*    STRING  ' '                                                  08280015
082900*           PC185-SML-UPLOAD-RECORD                               08290015
083000*    DELIMITED BY SIZE                                            08300015
083100*    INTO PV-CICS-MSG-AREA.                                       08310015
083200*    EXEC CICS                                                    08320015
083300*         WRITEQ TD                                               08330015
083400*          QUEUE  ('CSSL')                                        08340015
083500*           FROM  (PV-CICS-MSG-AREA)                              08350015
083600*         LENGTH  (PV-COMMAREA-LENGTH)                            08360015
083700*           RESP  (PV-CICS-RESP)                                  08370015
083800*    END-EXEC.                                                    08380015
083900                                                                  08390005
084000     EVALUATE TRUE                                                08400000
084100         WHEN PC185-HEADER                                        08410007
084200             PERFORM 3000-PROCESS-HEADER                          08420007
084300                                                                  08430000
084400         WHEN PC185-DETAIL                                        08440007
084500             PERFORM 4000-PROCESS-DETAIL                          08450007
084600                                                                  08460000
084700         WHEN PC185-TRAILER                                       08470007
084800             CONTINUE                                             08480007
084900     END-EVALUATE.                                                08490000
085000                                                                  08500000
085100                                                                  08510000
085200     IF PS-SOCKET-OPEN                                            08520000
085300         PERFORM 8000-RECEIVE-SOCKET                              08530000
085400     END-IF.                                                      08540000
085500                                                                  08550000
085600 3000-PROCESS-HEADER.                                             08560000
085700                                                                  08570000
085800     STRING '  PCKCS723 - 3000-PROCESS-HEADER'                    08580000
085900     DELIMITED BY SIZE                                            08590000
086000     INTO PV-CICS-MSG-AREA.                                       08600007
086100     PERFORM 9990-WRITE-CICS.                                     08610007
086200                                                                  08620001
086300     INITIALIZE PV-CICS-MSG-AREA.                                 08630007
086400     STRING  ' '                                                  08640005
086500            PC185-SML-UPLOAD-RECORD                               08650005
086600     DELIMITED BY SIZE                                            08660005
086700     INTO PV-CICS-MSG-AREA.                                       08670007
086800     PERFORM 9990-WRITE-CICS.                                     08680005
086900                                                                  08690000
087000     MOVE PC185-SML-UPLOAD-RECORD     TO PV-SAVE-UPLOAD-REC.      08700000
087100     MOVE PC185-P2L-MODULE-NBR TO PV-MODU-NBR-X.                  08710000
087200     IF PV-MODU-NBR-LAST-1 = SPACES                               08720000
087300         MOVE PV-MODU-NBR-FIRST-2  TO DK-MODU-NBR                 08730000
087400     ELSE                                                         08740000
087500         MOVE PV-MODU-NBR-9-3      TO DK-MODU-NBR                 08750000
087600     END-IF.                                                      08760000
087700     PERFORM 7120-SELECT-TP2LMOD.                                 08770000
087800                                                                  08780000
087900* THESE SWITCHES WERE SET IN 1000-INITIALIZE                      08790000
088000     IF PS-ADD-LABEL                                              08800000
088100         PERFORM 3100-CREATE-NEW-LABELS                           08810000
088200     ELSE                                                         08820000
088300                                                                  08830000
088400* DMH 02/20/06 - BEGIN                                            08840000
088500         IF  PS-UPDATE-LABEL  AND                                 08850000
088600             PS-OTBND-CART-MST                                    08860000
088700                PERFORM 3300-UPDATE-MST-LABELS                    08870000
088800         ELSE                                                     08880000
088900* DMH 02/20/06 - END                                              08890000
089000                                                                  08900000
089100             IF PS-UPDATE-LABEL                                   08910000
089200                PERFORM 3200-UPDATE-LABELS                        08920000
089300             END-IF                                               08930000
089400         END-IF                                                   08940000
089500     END-IF.                                                      08950000
089600                                                                  08960000
089700 3100-CREATE-NEW-LABELS.                                          08970000
089800     STRING '  PCKCS723 - 3100-CREATE-NEW-LABELS'                 08980000
089900     DELIMITED BY SIZE                                            08990000
090000     INTO PV-CICS-MSG-AREA.                                       09000007
090100     PERFORM 9990-WRITE-CICS.                                     09010007
090200                                                                  09020000
090300     PERFORM 3900-BUILD-OTBND-CART.                               09030000
090400     PERFORM 7350-INSERT-OTBND-CART.                              09040000
090500     PERFORM 3910-BUILD-OTBND-LOC.                                09050000
090600     PERFORM 7300-INSERT-OTBND-LOC.                               09060000
090700     PERFORM 7250-DELETE-OTBND-UPC.                               09070000
090800     PERFORM 7255-DELETE-OTBND-PK.                                09080000
090900*    SUT_OTBND_UPC ROWS WILL BE INSERTED WHEN PROCESSING DETAILS  09090000
091000     PERFORM 7260-DELETE-SUT00025.                                09100000
091100                                                                  09110000
091200 3200-UPDATE-LABELS.                                              09120000
091300                                                                  09130000
091400     STRING '  PCKCS723 - 3200-UPDATE-LABELS'                     09140000
091500         DELIMITED BY SIZE                                        09150000
091600         INTO PV-CICS-MSG-AREA.                                   09160007
091700     PERFORM 9990-WRITE-CICS.                                     09170007
091800                                                                  09180000
091900     PERFORM 3901-BUILD-OPEN-DATE.                                09190000
092000     PERFORM 3902-BUILD-CLOSE-DATE.                               09200000
092100     PERFORM 7200-UPDATE-OTBND-CART.                              09210000
092200     PERFORM 7310-INACTIVATE-OTBND-LOC.                           09220000
092300     PERFORM 3910-BUILD-OTBND-LOC.                                09230000
092400     PERFORM 7300-INSERT-OTBND-LOC.                               09240000
092500     PERFORM 7250-DELETE-OTBND-UPC.                               09250000
092600     PERFORM 7255-DELETE-OTBND-PK.                                09260000
092700*    SUT_OTBND_UPC ROWS WILL BE UPDATED WHEN PROCESSING DETAILS   09270000
092800     PERFORM 7260-DELETE-SUT00025.                                09280000
092900                                                                  09290000
093000* DMH 02/20/06 - BEGIN                                            09300000
093100 3300-UPDATE-MST-LABELS.                                          09310000
093200     STRING '  PCKCS723 - 3300-UPDATE-MST-LABELS'                 09320000
093300         DELIMITED BY SIZE                                        09330000
093400         INTO PV-CICS-MSG-AREA.                                   09340007
093500     PERFORM 9990-WRITE-CICS.                                     09350007
093600                                                                  09360000
093700     PERFORM 7210-DELETE-OTBND-CART.                              09370000
093800     PERFORM 3900-BUILD-OTBND-CART.                               09380000
093900     PERFORM 7350-INSERT-OTBND-CART.                              09390000
094000     PERFORM 3910-BUILD-OTBND-LOC.                                09400000
094100     PERFORM 7300-INSERT-OTBND-LOC.                               09410000
094200                                                                  09420000
094300* DMH 02/20/06 - END                                              09430000
094400                                                                  09440000
094500 3900-BUILD-OTBND-CART.                                           09450000
094600                                                                  09460000
094700     STRING                                                       09470000
094800            '  PCKCS723 - 3900-BUILD-OTBND-CART'                  09480000
094900     DELIMITED BY SIZE                                            09490000
095000     INTO PV-CICS-MSG-AREA.                                       09500007
095100     PERFORM 9990-WRITE-CICS.                                     09510007
095200                                                                  09520000
095300     PERFORM 3901-BUILD-OPEN-DATE.                                09530000
095400                                                                  09540000
095500     MOVE DK-SHIPT-UNT-ID             TO SUT00024-SHIPT-UNT-ID    09550000
095600                                         SUT00024-PRNT-CART-ID    09560000
095700                                         SUT00024-ORIG-CART-ID.   09570000
095800                                                                  09580000
095900     MOVE DK-STR-NBR                  TO SUT00024-DEST-LOC-NBR.   09590000
096000                                                                  09600000
096100                                                                  09610000
096200     MOVE DK-OPER-UNT-ID              TO SUT00024-ORGN-LOC-NBR.   09620000
096300     IF  P2LMOD-MODU-MDSE-TYP-CDE = 'F'                           09630000
096400         MOVE 'JWL'                   TO SUT00024-CART-SRC-CDE    09640000
096500     ELSE                                                         09650000
096600         MOVE 'P2L'                   TO SUT00024-CART-SRC-CDE    09660000
096700     END-IF.                                                      09670000
096800     MOVE 'N'                         TO SUT00024-MSTR-CART-IND.  09680000
096900     MOVE 'Y'                         TO SUT00024-ACTV-IND.       09690000
097000                                                                  09700000
097100     PERFORM 3902-BUILD-CLOSE-DATE.                               09710000
097200     MOVE SPACES                      TO SUT00024-CRE-USR-ID.     09720000
097300     MOVE PC-CURRENT-PROGRAM-NAME     TO SUT00024-CRE-PGM-NM.     09730000
097400     MOVE PC185-REVISION-NBR          TO SUT00024-CART-RVSN-NBR.  09740000
097500                                                                  09750000
097600 3901-BUILD-OPEN-DATE.                                            09760000
097700                                                                  09770000
097800     STRING '  PCKCS723 - 3201-BUILD-OPEN-DATE'                   09780000
097900         DELIMITED BY SIZE                                        09790000
098000         INTO PV-CICS-MSG-AREA.                                   09800007
098100     PERFORM 9990-WRITE-CICS.                                     09810007
098200                                                                  09820000
098300     STRING                                                       09830000
098400          PC185-OPEN-DATE-TIME (1:4)                              09840000
098500          '-'                                                     09850000
098600          PC185-OPEN-DATE-TIME (5:2)                              09860000
098700          '-'                                                     09870000
098800          PC185-OPEN-DATE-TIME (7:2)                              09880000
098900          DELIMITED BY SIZE                                       09890000
099000          INTO PV-OPEN-DATE.                                      09900007
099100                                                                  09910000
099200     STRING                                                       09920000
099300          PC185-OPEN-DATE-TIME (9:2)                              09930000
099400          '.'                                                     09940000
099500          PC185-OPEN-DATE-TIME (11:2)                             09950000
099600          '.'                                                     09960000
099700          PC185-OPEN-DATE-TIME (13:2)                             09970000
099800          DELIMITED BY SIZE                                       09980000
099900          INTO PV-OPEN-TIME.                                      09990000
100000                                                                  10000000
100100 3902-BUILD-CLOSE-DATE.                                           10010000
100200     STRING '  PCKCS723 - 3202-BUILD-CLOSE-DATE'                  10020000
100300         DELIMITED BY SIZE                                        10030000
100400         INTO PV-CICS-MSG-AREA.                                   10040007
100500     PERFORM 9990-WRITE-CICS.                                     10050007
100600                                                                  10060000
100700* CLOSED DATE IS USED FOR SUT_OTBND_LOC ROW                       10070000
100800     MOVE PC185-CLOSE-DATE-TIME (1:4) TO  PV-CLOSE-CCYY.          10080007
100900     MOVE PC185-CLOSE-DATE-TIME (5:2) TO  PV-CLOSE-MO.            10090007
101000     MOVE PC185-CLOSE-DATE-TIME (7:2) TO  PV-CLOSE-DD.            10100007
101100     MOVE PC185-CLOSE-DATE-TIME (9:2) TO  PV-CLOSE-HH.            10110007
101200     MOVE PC185-CLOSE-DATE-TIME(11:2) TO  PV-CLOSE-MM.            10120007
101300     MOVE PC185-CLOSE-DATE-TIME(13:2) TO  PV-CLOSE-SS.            10130000
101400                                                                  10140000
101500 3903-BUILD-COMPARE-DATES.                                        10150000
101600                                                                  10160000
101700     STRING '  PCKCS723 - 3903-BUILD-COMPARE-DATES'               10170000
101800         DELIMITED BY SIZE                                        10180000
101900         INTO PV-CICS-MSG-AREA.                                   10190007
102000     PERFORM 9990-WRITE-CICS.                                     10200007
102100                                                                  10210000
102200     STRING                                                       10220000
102300          SUT00024-CRE-DTE  (1:10)                                10230000
102400          DELIMITED BY SIZE                                       10240000
102500          INTO DK-CRE-DTE-NUM.                                    10250000
102600                                                                  10260000
102700     STRING                                                       10270000
102800          PC185-OPEN-DATE-TIME (1:4)                              10280000
102900               '-'                                                10290000
103000          PC185-OPEN-DATE-TIME (5:2)                              10300000
103100               '-'                                                10310000
103200          PC185-OPEN-DATE-TIME (7:2)                              10320000
103300          DELIMITED BY SIZE                                       10330000
103400          INTO DK-OPEN-DTE-NUM.                                   10340000
103500                                                                  10350000
103600                                                                  10360000
103700 3910-BUILD-OTBND-LOC.                                            10370000
103800                                                                  10380000
103900     STRING '  PCKCS723 - 3910-BUILD-OTBND-LOC'                   10390000
104000         DELIMITED BY SIZE                                        10400000
104100         INTO PV-CICS-MSG-AREA.                                   10410007
104200     PERFORM 9990-WRITE-CICS.                                     10420007
104300                                                                  10430000
104400     INITIALIZE DCLSUT00027.                                      10440000
104500     MOVE DK-SHIPT-UNT-ID             TO SUT00027-SHIPT-UNT-ID.   10450000
104600     MOVE DK-OPER-UNT-ID              TO SUT00027-LOC-NBR.        10460000
104700     MOVE 'LTP'                       TO SUT00027-SCN-CDE.        10470000
104800     MOVE PC-CURRENT-PROGRAM-NAME     TO SUT00027-CRE-USR-ID.     10480000
104900     MOVE PV-CLOSE-TIMESTAMP          TO SUT00027-CRE-TMST.       10490000
105000     MOVE ZERO                        TO SUT00027-OTBND-TRIP-ID.  10500000
105100                                                                  10510000
105200     MOVE  DK-OPER-UNT-ID      TO  PD-OPER-UNT-ID.                10520007
105300     MOVE  DK-ORD-NBR          TO  PD-ORD-NBR.                    10530007
105400     MOVE  DK-REC-SEQ-NBR      TO  PD-REC-SEQ-NBR.                10540007
105500     MOVE  DK-ORD-LNE-NBR      TO  PD-ORD-LNE-NBR.                10550007
105600     MOVE  DK-SHIPT-UNT-ID     TO  PD-SHIPT-UNT-ID.               10560007
105700                                                                  10570000
105800     STRING ' '                                                   10580000
105900         PD-OPER-UNT-ID '-'                                       10590000
106000         PD-ORD-NBR '-'                                           10600000
106100         PD-REC-SEQ-NBR '-'                                       10610000
106200         PD-ORD-LNE-NBR                                           10620000
106300         DELIMITED BY SIZE                                        10630000
106400         INTO PV-CICS-MSG-AREA.                                   10640007
106500                                                                  10650000
106600     PERFORM 9990-WRITE-CICS.                                     10660000
106700                                                                  10670000
106800     STRING ' '                                                   10680000
106900         PD-SHIPT-UNT-ID                                          10690000
107000         '   '                                                    10700000
107100         PV-CLOSE-TIMESTAMP                                       10710000
107200         DELIMITED BY SIZE                                        10720000
107300         INTO PV-CICS-MSG-AREA.                                   10730007
107400                                                                  10740000
107500     PERFORM 9990-WRITE-CICS.                                     10750000
107600                                                                  10760000
107700     CALL 'DSNTIAR' USING SQLCA                                   10770000
107800                          DP004-FORMATTED-MESSAGE                 10780000
107900                          DP004-ERROR-LINE-LENGTH.                10790000
108000                                                                  10800000
108100     MOVE DP004-ASTERISK-LINE         TO PV-CICS-MSG-AREA.        10810007
108200     PERFORM 9990-WRITE-CICS.                                     10820000
108300                                                                  10830000
108400 3920-COMPARE-DATES.                                              10840000
108500                                                                  10850000
108600     STRING '  PCKCS723 - 3920-COMPARE-DATES'                     10860000
108700         DELIMITED BY SIZE                                        10870000
108800         INTO PV-CICS-MSG-AREA.                                   10880007
108900     PERFORM 9990-WRITE-CICS.                                     10890007
109000                                                                  10900000
109100     MOVE ZEROES TO PV-COMPARE-NUM                                10910000
109200                    PV-AMOUNT.                                    10920000
109300     EXEC SQL                                                     10930000
109400         SELECT (B.JLN_DTE - A.JLN_DTE)                           10940000
109500                ,C.FUNC_QTY                                       10950000
109600           INTO :PV-COMPARE-NUM                                   10960000
109700               ,:KRPRPM-FUNC-QTY                                  10970000
109800           FROM TDTATTR A                                         10980000
109900               ,TDTATTR B                                         10990000
110000               ,TKRPRPM C                                         11000000
110100          WHERE A.KY_DTE            = :DK-CRE-DTE-NUM             11010000
110200            AND B.KY_DTE            = :DK-OPEN-DTE-NUM            11020000
110300            AND C.SYS_PRC_FUNC_CDE  = 'P2LSDY'                    11030000
110400            AND C.LOC_ID            = :DK-OPER-UNT-ID             11040000
110500            AND C.INTFC_SYS_CDE     = 'KHL'                       11050000
110600            AND C.FUNC_PRC_STAT_CDE = 'AC'                        11060000
110700     END-EXEC.                                                    11070000
110800                                                                  11080000
110900     EVALUATE SQLCODE                                             11090000
111000         WHEN ZERO                                                11100000
111100             CONTINUE                                             11110000
111200         WHEN OTHER                                               11120000
111300             MOVE ZEROES TO KRPRPM-FUNC-QTY                       11130000
111400                            PV-COMPARE-NUM                        11140000
111500     END-EVALUATE.                                                11150000
111600                                                                  11160000
111700     COMPUTE PV-AMOUNT = PV-COMPARE-NUM -  KRPRPM-FUNC-QTY.       11170000
111800                                                                  11180000
111900     INITIALIZE PV-CICS-MSG-AREA.                                 11190007
112000     STRING ' CRE-DTE='    DK-CRE-DTE-NUM                         11200000
112100            '  OPEN-DTE='  DK-OPEN-DTE-NUM                        11210000
112200              DELIMITED BY SIZE                                   11220000
112300         INTO PV-CICS-MSG-AREA.                                   11230007
112400     PERFORM 9990-WRITE-CICS.                                     11240007
112500                                                                  11250000
112600     INITIALIZE PV-CICS-MSG-AREA.                                 11260007
112700     MOVE PV-AMOUNT   TO  PV-AMOUNT-DISPLAY.                      11270007
112800     STRING ' AMOUNT  ' PV-AMOUNT-DISPLAY DELIMITED BY SIZE       11280000
112900         INTO PV-CICS-MSG-AREA.                                   11290007
113000     PERFORM 9990-WRITE-CICS.                                     11300007
113100                                                                  11310000
113200     IF PV-AMOUNT > ZERO                                          11320000
113300         MOVE '011'            TO  PV-ERROR-CODE                  11330000
113400         PERFORM 9915-REUSE-SML-ERROR                             11340000
113500     ELSE                                                         11350000
113600         SET PS-ERRORS-YES     TO TRUE                            11360000
113700         MOVE '007'            TO PV-ERROR-CODE                   11370000
113800         PERFORM 9910-USER-ERROR                                  11380000
113900     END-IF.                                                      11390000
114000                                                                  11400000
114100*-----------------------------------------------------------------11410000
114200 4000-PROCESS-DETAIL.                                             11420000
114300                                                                  11430000
114400     STRING '  PCKCS723 - 4000-PROCESS-DETAIL'                    11440000
114500         DELIMITED BY SIZE                                        11450000
114600         INTO PV-CICS-MSG-AREA.                                   11460007
114700     PERFORM 9990-WRITE-CICS.                                     11470007
114800                                                                  11480000
114900     INITIALIZE PV-CICS-MSG-AREA.                                 11490007
115000     STRING  ' '                                                  11500005
115100            PC185-SML-UPLOAD-RECORD                               11510005
115200     DELIMITED BY SIZE                                            11520005
115300     INTO PV-CICS-MSG-AREA.                                       11530007
115400     PERFORM 9990-WRITE-CICS.                                     11540005
115500                                                                  11550001
115600     ADD 1                            TO PV-RECS-READ.            11560000
115700     EVALUATE TRUE                                                11570000
115800     WHEN PC185-DISTRO-NBR (1:15) NUMERIC                         11580000
115900         MOVE PC185-ORD-NBR           TO PV-ORD-NBR-X             11590000
116000         MOVE PV-ORD-NBR              TO DK-ORD-NBR               11600000
116100         MOVE PC185-REC-SEQ-NBR       TO PV-REC-SEQ-NBR-X         11610000
116200         MOVE PV-REC-SEQ-NBR          TO DK-REC-SEQ-NBR           11620000
116300         MOVE PC185-ORD-LNE-NBR       TO PV-ORD-LNE-NBR-X         11630000
116400         MOVE PV-ORD-LNE-NBR          TO DK-ORD-LNE-NBR           11640000
116500                                                                  11650000
116600         IF PC185-PACKED-QTY NUMERIC                              11660000
116700             MOVE PC185-PACKED-QTY    TO PV-PACKED-QTY-X          11670000
116800         ELSE                                                     11680000
116801*** dmh 4/1/09 - begin                                            11680117
116802         IF PC185-PACKED-QTY-N NUMERIC  AND                       11680217
116803            PC185-PACKED-QTY-S  = '-'                             11680317
116804             MOVE PC185-PACKED-QTY-N  TO PV-PACKED-QTY            11680417
116805             MULTIPLY PV-PACKED-QTY  BY -1                        11680517
116806               GIVING PV-PACKED-QTY                               11680617
116810         ELSE                                                     11681017
116820*** dmh 4/1/09 - end                                              11682017
116900             MOVE '009'               TO PV-ERROR-CODE            11690000
117000             PERFORM 9910-USER-ERROR                              11700000
117100         END-IF                                                   11710000
117110         END-IF                                                   11711017
117200                                                                  11720000
117300         PERFORM 7400-SELECT-TDISTHD-TRECITM                      11730000
117400                                                                  11740000
117500         IF PS-ERRORS-NO                                          11750000
117600             IF DISTHD-PREPK-LNE-PRC-CDE = 'D'                    11760000
117700                 PERFORM 4010-CHECK-ODD-UNITS                     11770000
117800                 PERFORM 4100-PROCESS-DRIVER-LINE                 11780000
117900                 IF PS-ERRORS-NO                                  11790000
118000                     PERFORM 4200-PROCESS-PREPK-ITEMS             11800000
118100                 END-IF                                           11810000
118200             ELSE                                                 11820000
118300                 MOVE PV-PACKED-QTY   TO PV-WHOLE-PACKS           11830000
118400                 MOVE ZERO            TO PV-ODD-UNITS             11840000
118500                 PERFORM 4100-PROCESS-DRIVER-LINE                 11850000
118600             END-IF                                               11860000
118700         END-IF                                                   11870000
118800                                                                  11880000
118900     WHEN OTHER                                                   11890000
119000                                                                  11900000
119100         SET PS-ERRORS-YES            TO TRUE                     11910000
119200         MOVE '010'                   TO PV-ERROR-CODE            11920000
119300         PERFORM 9920-ALS-ERROR                                   11930000
119400                                                                  11940000
119500     END-EVALUATE.                                                11950000
119600                                                                  11960000
119700 4010-CHECK-ODD-UNITS.                                            11970000
119800                                                                  11980000
119900     STRING '  PCKCS723 - 4010-CHECK-ODD-UNITS'                   11990000
120000         DELIMITED BY SIZE                                        12000000
120100         INTO PV-CICS-MSG-AREA.                                   12010007
120200     PERFORM 9990-WRITE-CICS.                                     12020007
120300                                                                  12030000
120400     DIVIDE PV-PACKED-QTY BY RECITM-PREPK-RATO-QTY                12040000
120500     GIVING                                                       12050000
120600         PV-WHOLE-PACKS                                           12060000
120700     REMAINDER                                                    12070000
120800         PV-ODD-UNITS                                             12080000
120900     END-DIVIDE.                                                  12090000
121000                                                                  12100000
121100 4100-PROCESS-DRIVER-LINE.                                        12110000
121200                                                                  12120000
121300     STRING '  PCKCS723 - 4100-PROCESS-DRIVER-LINE'               12130000
121400         DELIMITED BY SIZE                                        12140000
121500         INTO PV-CICS-MSG-AREA.                                   12150007
121600     PERFORM 9990-WRITE-CICS.                                     12160007
121700                                                                  12170000
121800     MOVE PV-PACKED-QTY               TO SUT00028-SHPD-UNT-QTY.   12180007
121900     MOVE PV-WHOLE-PACKS              TO PV-DISP-PACKS.           12190007
122000     MOVE PV-ODD-UNITS                TO PV-DISP-ODD-UNITS.       12200007
122100                                                                  12210000
122200     STRING ' WHOLE-PACKS= ' PV-DISP-PACKS                        12220000
122300            ' ODD UNITS= ' PV-DISP-ODD-UNITS                      12230000
122400         DELIMITED BY SIZE                                        12240000
122500         INTO PV-CICS-MSG-AREA.                                   12250007
122600     PERFORM 9990-WRITE-CICS.                                     12260007
122700                                                                  12270000
122800     PERFORM 7450-UPDATE-OTBND-UPC-QTY.                           12280007
122900                                                                  12290000
123000     IF PS-OTBND-UPC-NOT-FOUND                                    12300000
123100         PERFORM 4110-GET-ONE-UPC                                 12310000
123200         IF PS-ERRORS-NO                                          12320000
123300             PERFORM 7500-INSERT-OTBND-UPC                        12330000
123400         END-IF                                                   12340000
123500     ELSE                                                         12350000
123600         PERFORM 4110-GET-ONE-UPC                                 12360000
123700     END-IF.                                                      12370000
123800                                                                  12380000
123900     IF  DISTHD-PREPK-LNE-PRC-CDE = 'D'                           12390000
124000         PERFORM 4130-GET-PK-SKU-NBR                              12400000
124100         IF   PS-ERRORS-NO                                        12410000
124200              PERFORM 4140-UPDATE-OTBND-PACK                      12420000
124300              IF  PV-ODD-UNITS > 0                                12430000
124400                  PERFORM 4160-UPDATE-OTBND-CART                  12440000
124500             END-IF                                               12450000
124600         END-IF                                                   12460000
124700     END-IF.                                                      12470000
124800                                                                  12480000
124900     IF  P2LMOD-AUD-IND   = 'Y'                                   12490000
125000         PERFORM 4105-FORMAT-DATE                                 12500000
125100         IF  PS-ERRORS-NO                                         12510000
125200             PERFORM 7700-INSERT-SUT00025                         12520000
125300         END-IF                                                   12530000
125400     END-IF.                                                      12540000
125500                                                                  12550000
125600 4105-FORMAT-DATE.                                                12560000
125700     MOVE PC185-PACKED-TIME (1:4)     TO PV-TIMESTAMP-CCYY.       12570000
125800     MOVE PC185-PACKED-TIME (5:2)     TO PV-TIMESTAMP-MM.         12580000
125900     MOVE PC185-PACKED-TIME (7:2)     TO PV-TIMESTAMP-DD.         12590000
126000     MOVE PC185-PACKED-TIME (9:2)     TO PV-TIMESTAMP-HH.         12600000
126100     MOVE PC185-PACKED-TIME (11:2)    TO PV-TIMESTAMP-MIN.        12610000
126200     MOVE PC185-PACKED-TIME (13:2)    TO PV-TIMESTAMP-SS.         12620000
126300     MOVE '-'                         TO PV-TMST-DASH-1           12630000
126400                                         PV-TMST-DASH-2           12640000
126500                                         PV-TMST-DASH-3.          12650007
126600     MOVE '.'                         TO PV-TMST-DOT-1            12660000
126700                                         PV-TMST-DOT-2            12670000
126800                                         PV-TMST-DOT-3.           12680000
126900     MOVE ZEROES                      TO PV-TMST-MICRO-SS.        12690000
127000     MOVE PV-TIMESTAMP                TO DK-TIMESTAMP.            12700000
127100                                                                  12710000
127200 4110-GET-ONE-UPC.                                                12720000
127300     STRING '  PCKCS723 - 4110-GET-ONE-UPC'                       12730000
127400         DELIMITED BY SIZE                                        12740000
127500         INTO PV-CICS-MSG-AREA.                                   12750007
127600     PERFORM 9990-WRITE-CICS.                                     12760007
127700                                                                  12770000
127800     MOVE DK-ORD-NBR                  TO PV-DISP-PO.              12780007
127900     MOVE DK-ORD-LNE-NBR              TO PV-DISP-LINE.            12790007
128000     MOVE PURITM-ITM-NBR              TO PV-DISP-ITEM.            12800007
128100                                                                  12810000
128200     STRING ' PO-NBR= ' PV-DISP-PO                                12820000
128300            ' LINE-NBR= ' PV-DISP-LINE                            12830000
128400            ' PURITM-ITM-NBR= ' PV-DISP-ITEM                      12840000
128500         DELIMITED BY SIZE                                        12850000
128600         INTO PV-CICS-MSG-AREA.                                   12860007
128700     PERFORM 9990-WRITE-CICS.                                     12870000
128800                                                                  12880000
128900                                                                  12890000
129000     EXEC SQL                                                     12900000
129100          SELECT ITM_NBR                                          12910000
129200            INTO :PURITM-ITM-NBR                                  12920000
129300            FROM TPURITM                                          12930000
129400           WHERE PO_NBR          = :DK-ORD-NBR                    12940000
129500             AND APP_PO_LNE_NBR  = :DK-ORD-LNE-NBR                12950000
129600             AND VER_STATUS_CDE  = 'A'                            12960000
129700     END-EXEC.                                                    12970000
129800                                                                  12980000
129900     EVALUATE TRUE                                                12990000
130000         WHEN SQLCODE = ZERO                                      13000000
130100             IF PURITM-ITM-NBR > ZERO                             13010000
130200                 PERFORM 4115-CALL-XLKUT001                       13020000
130300             END-IF                                               13030000
130400         WHEN SQLCODE = +100                                      13040000
130500             MOVE 'TPURITM'           TO PV-DISP-TABLE-1          13050000
130600             PERFORM 9955-SQL-ERROR                               13060000
130700             MOVE '012'               TO PV-ERROR-CODE            13070000
130800             PERFORM 9910-USER-ERROR                              13080000
130900         WHEN SQLCODE = -904                                      13090000
131000         WHEN SQLCODE = -911                                      13100000
131100         WHEN SQLCODE = -913                                      13110000
131200             MOVE 'TPURITM'           TO PV-DISP-TABLE-1          13120000
131300             PERFORM 9955-SQL-ERROR                               13130000
131400             MOVE '013'               TO PV-ERROR-CODE            13140000
131500             PERFORM 9900-SOFT-ABORT                              13150000
131600         WHEN SQLWARN0 NOT = SPACES                               13160000
131700         WHEN SQLCODE < ZERO                                      13170000
131800         WHEN SQLCODE > ZERO                                      13180000
131900             MOVE 'TPURITM'           TO PV-DISP-TABLE-1          13190000
132000             PERFORM 9955-SQL-ERROR                               13200000
132100             MOVE '014'               TO PV-ERROR-CODE            13210000
132200             PERFORM 9910-USER-ERROR                              13220000
132300     END-EVALUATE.                                                13230000
132400                                                                  13240000
132500*----------------------------------------------------------------*13250000
132600* CALL LOGISTICS ITEM ACCESS MODULE (XLKUT001)                   *13260000
132700*----------------------------------------------------------------*13270000
132800 4115-CALL-XLKUT001.                                              13280000
132900     STRING ' PCKCS723 - 4115-CALL-XLKUT001'                      13290000
133000         DELIMITED BY SIZE                                        13300000
133100         INTO PV-CICS-MSG-AREA.                                   13310007
133200     PERFORM 9990-WRITE-CICS.                                     13320007
133300                                                                  13330000
133400      INITIALIZE XL001-ITEM-COMMAREA.                             13340000
133500      MOVE PURITM-ITM-NBR   TO XL001-KEY-ITM-NBR.                 13350000
133600                                                                  13360000
133700      SET  XL001-BY-ITEM                                          13370000
133800           XL001-SELECT-UPC     TO TRUE.                          13380000
133900                                                                  13390000
134000      CALL XL001-VSM-PGM USING DFHEIBLK                           13400000
134100                               XL001-COMMAREA                     13410000
134200                               XL001-ITEM-COMMAREA.               13420000
134300                                                                  13430000
134400      EVALUATE TRUE                                               13440000
134500          WHEN XL001-SUCCESSFUL                                   13450000
134600              MOVE XL001-UPC-NBR  TO  DK-UPC-NBR                  13460000
134700                                                                  13470000
134800          WHEN XL001-SQL-ERROR                                    13480000
134900              IF XL001-UPC-SQLCODE = +0                           13490000
135000                  MOVE XL001-UPC-NBR  TO  DK-UPC-NBR              13500000
135100              ELSE                                                13510000
135200                  MOVE ZEROES         TO  DK-UPC-NBR              13520000
135300              END-IF                                              13530000
135400                                                                  13540000
135500          WHEN XL001-INVALID-ACCESS                               13550000
135600             MOVE 'XLKUT001'          TO PV-DISP-TABLE-1          13560000
135700             PERFORM 9955-SQL-ERROR                               13570000
135800             MOVE '015'               TO PV-ERROR-CODE            13580000
135900             PERFORM 9910-USER-ERROR                              13590000
136000      END-EVALUATE.                                               13600007
136100                                                                  13610000
136200*---------------------------------------------------------------  13620000
136300 4130-GET-PK-SKU-NBR.                                             13630000
136400                                                                  13640000
136500     STRING ' PCKCS723 - 4130-GET-PK-SKU-NBR'                     13650000
136600         DELIMITED BY SIZE                                        13660000
136700         INTO PV-CICS-MSG-AREA.                                   13670007
136800     PERFORM 9990-WRITE-CICS.                                     13680007
136900                                                                  13690000
137000     EXEC SQL                                                     13700000
137100         SELECT PK_SKU_NBR                                        13710000
137200         INTO   :POPRPK-PK-SKU-NBR                                13720000
137300         FROM   TPOPRPK                                           13730000
137400         WHERE  PO_NBR         = :DK-ORD-NBR                      13740000
137500           AND  PO_PREPK_ID    = :RECITM-PREPK-ID                 13750000
137600           AND  PREPK_STAT_CDE = 'A'                              13760000
137700     END-EXEC.                                                    13770000
137800                                                                  13780000
137900     EVALUATE TRUE                                                13790000
138000         WHEN SQLCODE = ZERO                                      13800000
138100              CONTINUE                                            13810000
138200         WHEN SQLCODE = +100                                      13820000
138300                                                                  13830000
138400              MOVE  DK-ORD-NBR       TO  PD-ORD-NBR               13840000
138500              MOVE  RECITM-PREPK-ID  TO  PD-PREPK-ID              13850000
138600              STRING ' PCKCS723 - 4115- '                         13860000
138700                     '  PO-' PD-ORD-NBR                           13870000
138800                     '  PREPK-' PD-PREPK-ID                       13880000
138900                                          DELIMITED BY SIZE       13890000
139000                                     INTO PV-CICS-MSG-AREA        13900000
139100              PERFORM 9990-WRITE-CICS                             13910000
139200                                                                  13920000
139300             MOVE 'TPOPRPK'           TO PV-DISP-TABLE-1          13930000
139400             PERFORM 9955-SQL-ERROR                               13940000
139500             MOVE '070'               TO PV-ERROR-CODE            13950000
139600             PERFORM 9910-USER-ERROR                              13960000
139700         WHEN SQLCODE = -904                                      13970000
139800         WHEN SQLCODE = -911                                      13980000
139900         WHEN SQLCODE = -913                                      13990000
140000             MOVE 'TPOPRPK'           TO PV-DISP-TABLE-1          14000000
140100             PERFORM 9955-SQL-ERROR                               14010000
140200             MOVE '071'               TO PV-ERROR-CODE            14020000
140300             PERFORM 9900-SOFT-ABORT                              14030000
140400         WHEN SQLWARN0 NOT = SPACES                               14040000
140500         WHEN SQLCODE < ZERO                                      14050000
140600         WHEN SQLCODE > ZERO                                      14060000
140700             MOVE 'TPOPRPK'           TO PV-DISP-TABLE-1          14070000
140800             PERFORM 9955-SQL-ERROR                               14080000
140900             MOVE '072'               TO PV-ERROR-CODE            14090000
141000             PERFORM 9910-USER-ERROR                              14100000
141100     END-EVALUATE.                                                14110000
141200                                                                  14120000
141300*---------------------------------------------------------------- 14130000
141400 4140-UPDATE-OTBND-PACK.                                          14140000
141500                                                                  14150000
141600     STRING ' PCKCS723 - 4140-UPDATE-OTBND-PACK'                  14160000
141700         DELIMITED BY SIZE                                        14170000
141800         INTO PV-CICS-MSG-AREA.                                   14180007
141900     PERFORM 9990-WRITE-CICS.                                     14190007
142000                                                                  14200000
142100     EXEC SQL                                                     14210000
142200         UPDATE SUT_OTBND_PK                                      14220000
142300         SET                                                      14230000
142400            SHPD_PK_QTY  = SHPD_PK_QTY + :PV-WHOLE-PACKS          14240000
142500         WHERE SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                   14250000
142600           AND TRN_NBR       = :DK-ORD-NBR                        14260000
142700           AND RCVR_SEQ_NBR  = :DK-REC-SEQ-NBR                    14270000
142800           AND PK_SKU_NBR    = :POPRPK-PK-SKU-NBR                 14280000
142900     END-EXEC.                                                    14290000
143000                                                                  14300000
143100     EVALUATE TRUE                                                14310000
143200         WHEN SQLCODE = ZERO                                      14320000
143300              CONTINUE                                            14330000
143400         WHEN SQLCODE = +100                                      14340000
143500             PERFORM 4150-INSERT-OTBND-PACK                       14350000
143600         WHEN SQLCODE = -904                                      14360000
143700         WHEN SQLCODE = -911                                      14370000
143800         WHEN SQLCODE = -913                                      14380000
143900             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          14390000
144000             PERFORM 9955-SQL-ERROR                               14400000
144100             MOVE '073'               TO PV-ERROR-CODE            14410000
144200             PERFORM 9900-SOFT-ABORT                              14420000
144300         WHEN SQLWARN0 NOT = SPACES                               14430000
144400         WHEN SQLCODE < ZERO                                      14440000
144500         WHEN SQLCODE > ZERO                                      14450000
144600             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          14460000
144700             PERFORM 9955-SQL-ERROR                               14470000
144800             MOVE '074'               TO PV-ERROR-CODE            14480000
144900             PERFORM 9910-USER-ERROR                              14490000
145000     END-EVALUATE.                                                14500000
145100                                                                  14510000
145200*---------------------------------------------------------------- 14520000
145300 4150-INSERT-OTBND-PACK.                                          14530000
145400                                                                  14540000
145500     STRING ' PCKCS723 - 4150-INSERT-OTBND-PACK'                  14550000
145600         DELIMITED BY SIZE                                        14560000
145700         INTO PV-CICS-MSG-AREA.                                   14570007
145800     PERFORM 9990-WRITE-CICS.                                     14580007
145900                                                                  14590000
146000     EXEC SQL                                                     14600000
146100         INSERT INTO SUT_OTBND_PK                                 14610000
146200               ( SHIPT_UNT_ID                                     14620000
146300                ,TRN_NBR                                          14630000
146400                ,RCVR_SEQ_NBR                                     14640000
146500                ,TRN_TYP_CDE                                      14650000
146600                ,PK_SKU_NBR                                       14660000
146700                ,SHPD_PK_QTY )                                    14670000
146800         VALUES                                                   14680000
146900              (:DK-SHIPT-UNT-ID                                   14690000
147000             , :DK-ORD-NBR                                        14700000
147100             , :DK-REC-SEQ-NBR                                    14710000
147200             , 'PO'                                               14720000
147300             , :POPRPK-PK-SKU-NBR                                 14730000
147400             , :PV-WHOLE-PACKS )                                  14740000
147500     END-EXEC.                                                    14750000
147600                                                                  14760000
147700     EVALUATE TRUE                                                14770000
147800         WHEN SQLCODE = ZERO                                      14780000
147900              CONTINUE                                            14790000
148000         WHEN SQLCODE = +100                                      14800000
148100             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          14810000
148200             PERFORM 9955-SQL-ERROR                               14820000
148300             MOVE '075'               TO PV-ERROR-CODE            14830000
148400             PERFORM 9910-USER-ERROR                              14840000
148500         WHEN SQLCODE = -904                                      14850000
148600         WHEN SQLCODE = -911                                      14860000
148700         WHEN SQLCODE = -913                                      14870000
148800             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          14880000
148900             PERFORM 9955-SQL-ERROR                               14890000
149000             MOVE '076'               TO PV-ERROR-CODE            14900000
149100             PERFORM 9900-SOFT-ABORT                              14910000
149200         WHEN SQLWARN0 NOT = SPACES                               14920000
149300         WHEN SQLCODE < ZERO                                      14930000
149400         WHEN SQLCODE > ZERO                                      14940000
149500             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          14950000
149600             PERFORM 9955-SQL-ERROR                               14960000
149700             MOVE '077'               TO PV-ERROR-CODE            14970000
149800             PERFORM 9910-USER-ERROR                              14980000
149900     END-EVALUATE.                                                14990000
150000                                                                  15000000
150100*---------------------------------------------------------------- 15010000
150200 4160-UPDATE-OTBND-CART.                                          15020000
150300                                                                  15030000
150400     STRING ' PCKCS723 - 4160-UPDATE-OTBND-CART'                  15040000
150500         DELIMITED BY SIZE                                        15050000
150600         INTO PV-CICS-MSG-AREA.                                   15060007
150700     PERFORM 9990-WRITE-CICS.                                     15070007
150800                                                                  15080000
150900     EXEC SQL                                                     15090000
151000         UPDATE SUT_OTBND_CART                                    15100000
151100         SET                                                      15110000
151200             ODD_UNT_IND     = 'Y'                                15120000
151300         WHERE SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                   15130000
151400     END-EXEC.                                                    15140000
151500                                                                  15150000
151600     EVALUATE TRUE                                                15160000
151700         WHEN SQLCODE = ZERO                                      15170000
151800              CONTINUE                                            15180000
151900         WHEN SQLCODE = +100                                      15190000
152000             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          15200000
152100             PERFORM 9955-SQL-ERROR                               15210000
152200             MOVE '078'               TO PV-ERROR-CODE            15220000
152300             PERFORM 9910-USER-ERROR                              15230000
152400         WHEN SQLCODE = -904                                      15240000
152500         WHEN SQLCODE = -911                                      15250000
152600         WHEN SQLCODE = -913                                      15260000
152700             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          15270000
152800             PERFORM 9955-SQL-ERROR                               15280000
152900             MOVE '079'               TO PV-ERROR-CODE            15290000
153000             PERFORM 9900-SOFT-ABORT                              15300000
153100         WHEN SQLWARN0 NOT = SPACES                               15310000
153200         WHEN SQLCODE < ZERO                                      15320000
153300         WHEN SQLCODE > ZERO                                      15330000
153400             MOVE 'OTBD_PK'           TO PV-DISP-TABLE-1          15340000
153500             PERFORM 9955-SQL-ERROR                               15350000
153600             MOVE '080'               TO PV-ERROR-CODE            15360000
153700             PERFORM 9910-USER-ERROR                              15370000
153800     END-EVALUATE.                                                15380000
153900                                                                  15390000
154000*---------------------------------------------------------------- 15400000
154100 4200-PROCESS-PREPK-ITEMS.                                        15410000
154200                                                                  15420000
154300     STRING ' PCKCS723 - 4200-PROCESS-PREPK-ITEMS'                15430000
154400         DELIMITED BY SIZE                                        15440000
154500         INTO PV-CICS-MSG-AREA.                                   15450007
154600     PERFORM 9990-WRITE-CICS.                                     15460007
154700                                                                  15470000
154800                                                                  15480000
154900     PERFORM 7600-OPEN-PREPK-CSR.                                 15490007
155000     PERFORM 7610-FETCH-PREPK-CSR.                                15500007
155100     PERFORM UNTIL PS-END-OF-PREPK-CSR                            15510000
155200             OR PS-ERRORS-YES                                     15520000
155300                                                                  15530000
155400* DMH - 8/17/2004 - BEGIN                                         15540000
155500* ***    IF RECITM-ORD-LNE-NBR = PV-SAVE-ORD-LNE-NBR              15550000
155600                                                                  15560000
155700         IF DK-ORD-NBR         = PV-SAVE-PO-NUMBER    AND         15570000
155800            DK-REC-SEQ-NBR     = PV-SAVE-RCVR-NMBR    AND         15580000
155900            RECITM-ORD-LNE-NBR = PV-SAVE-ORD-LNE-NBR              15590000
156000* DMH - 8/17/2004 - END                                           15600000
156100             CONTINUE                                             15610000
156200         ELSE                                                     15620000
156300             MOVE DK-ORD-NBR         TO PV-SAVE-PO-NUMBER         15630000
156400             MOVE DK-REC-SEQ-NBR     TO PV-SAVE-RCVR-NMBR         15640000
156500             MOVE RECITM-ORD-LNE-NBR TO PV-SAVE-ORD-LNE-NBR       15650000
156600             MULTIPLY PV-WHOLE-PACKS BY RECITM-PREPK-RATO-QTY     15660000
156700                                      GIVING SUT00028-SHPD-UNT-QTY15670000
156800             MOVE RECITM-ORD-LNE-NBR      TO DK-ORD-LNE-NBR       15680000
156900             PERFORM 7450-UPDATE-OTBND-UPC-QTY                    15690000
157000             IF PS-OTBND-UPC-NOT-FOUND                            15700000
157100                 PERFORM 7500-INSERT-OTBND-UPC                    15710000
157200             END-IF                                               15720000
157300             IF  P2LMOD-AUD-IND   = 'Y'                           15730000
157400                 PERFORM 4105-FORMAT-DATE                         15740000
157500                 IF  PS-ERRORS-NO                                 15750000
157600                     PERFORM 7700-INSERT-SUT00025                 15760000
157700                 END-IF                                           15770000
157800            END-IF                                                15780000
157900         END-IF                                                   15790000
158000                                                                  15800000
158100         IF PS-PREPK-CSR-OPEN                                     15810000
158200             PERFORM 7610-FETCH-PREPK-CSR                         15820000
158300         END-IF                                                   15830000
158400                                                                  15840000
158500     END-PERFORM.                                                 15850000
158600                                                                  15860000
158700     IF PS-PREPK-CSR-OPEN                                         15870000
158800         PERFORM 7620-CLOSE-PREPK-CSR                             15880000
158900     END-IF.                                                      15890000
159000/                                                                 15900000
159100 7000-INSERT-TUPLDER.                                             15910000
159200                                                                  15920000
159300     STRING ' PCKCS723 - 7000-INSERT-TUPLDER'                     15930000
159400         DELIMITED BY SIZE                                        15940000
159500         INTO PV-CICS-MSG-AREA.                                   15950007
159600     PERFORM 9990-WRITE-CICS.                                     15960007
159700                                                                  15970000
159800     INITIALIZE                       UPLDER-PKT-TXT              15980000
159900                                      UPLDER-UPLD-TRN-CDE.        15990007
160000     ADD 1                            TO PV-ERROR-COUNT.          16000007
160100     MOVE PV-ERROR-COUNT              TO UPLDER-UPLD-SEQ-NBR.     16010007
160200     IF PV-ERROR-CODE = '102'                                     16020000
160300         MOVE PV-SAVE-UPLOAD-REC      TO UPLDER-PKT-TXT           16030000
160400     ELSE                                                         16040000
160500         INITIALIZE                      UPLDER-PKT-TXT           16050000
160600         STRING ' ' PV-SQLCODE ' '       DELIMITED BY SIZE        16060000
160700              PC185-SML-UPLOAD-RECORD    DELIMITED BY SIZE        16070000
160800                                    INTO UPLDER-PKT-TXT           16080000
160900     END-IF.                                                      16090000
161000     SET PS-OKAY-INSERT               TO TRUE.                    16100007
161100                                                                  16110000
161200     INITIALIZE PV-CICS-MSG-AREA.                                 16120007
161300     STRING ' '  PV-ERROR-CODE ' '                                16130000
161400            UPLDER-PKT-TXT                                        16140000
161500         DELIMITED BY SIZE                                        16150000
161600         INTO PV-CICS-MSG-AREA.                                   16160007
161700     PERFORM 9990-WRITE-CICS.                                     16170007
161800                                                                  16180000
161900     EXEC SQL                                                     16190000
162000     INSERT INTO TUPLDER                                          16200000
162100         (                                                        16210000
162200           OPER_UNT_ID                                            16220000
162300         , UPLD_TRN_CDE                                           16230000
162400         , ERR_CDE                                                16240000
162500         , PRC_TMST                                               16250000
162600         , UPLD_SEQ_NBR                                           16260000
162700         , PKT_TXT                                                16270000
162800         )                                                        16280000
162900         VALUES                                                   16290000
163000         (                                                        16300000
163100           :DK-OPER-UNT-ID                                        16310000
163200         , 'A'                                                    16320000
163300         , :PV-ERROR-CODE                                         16330000
163400         , :PV-PRC-TMST                                           16340000
163500         , :PV-RECS-READ                                          16350000
163600         , :UPLDER-PKT-TXT                                        16360000
163700         )                                                        16370000
163800     END-EXEC.                                                    16380000
163900                                                                  16390000
164000     EVALUATE TRUE                                                16400000
164100         WHEN SQLCODE = ZERO                                      16410000
164200             CONTINUE                                             16420000
164300         WHEN SQLCODE = -904                                      16430000
164400         WHEN SQLCODE = -911                                      16440000
164500         WHEN SQLCODE = -913                                      16450000
164600             MOVE 'TUPLDER'           TO PV-DISP-TABLE-1          16460000
164700             PERFORM 9955-SQL-ERROR                               16470000
164800             MOVE '081'               TO PV-ERROR-CODE            16480021
164900             SET PC185-ERROR                                      16490000
165000                 PS-SUPPRESS-INSERT   TO TRUE                     16500000
165100             PERFORM 9920-ALS-ERROR                               16510000
165200                                                                  16520000
165300         WHEN SQLWARN0 NOT = SPACES                               16530000
165400         WHEN SQLCODE  NOT = ZERO                                 16540000
165500             MOVE 'TUPLDER'           TO PV-DISP-TABLE-1          16550000
165600             PERFORM 9955-SQL-ERROR                               16560000
165700             INITIALIZE PC185-SML-UPLOAD-RECORD                   16570000
165800             MOVE PV-HOLD-SML-NBR     TO PC185-CFM-SML-NBR        16580000
165900             SET PC185-SUCCESSFUL     TO TRUE                     16590000
166000             MOVE ';'                 TO PC185-CFM-TERM-CHAR      16600000
166100             PERFORM 8300-SEND-ERROR-CONFIRM-QNX                  16610000
166200             PERFORM 8400-CLOSE-SOCKET                            16620000
166300             SET PS-DUMP-TO-LOG       TO TRUE                     16630000
166400     END-EVALUATE.                                                16640000
166500                                                                  16650000
166600                                                                  16660000
166700 7100-FIND-OPER-UNT-ID.                                           16670000
166800                                                                  16680000
166900     STRING ' PCKCS723 - 7100-FIND-OPER-UNT-ID'                   16690000
167000         DELIMITED BY SIZE                                        16700000
167100         INTO PV-CICS-MSG-AREA.                                   16710007
167200     PERFORM 9990-WRITE-CICS.                                     16720007
167300                                                                  16730000
167400     MOVE EIBTRNID                    TO DK-TRNID.                16740007
167500     EXEC SQL                                                     16750000
167600          SELECT LOC_ID                                           16760000
167700                ,CURRENT TIMESTAMP                                16770000
167800            INTO :KRPRPM-LOC-ID                                   16780000
167900                ,:PV-PRC-TMST                                     16790000
168000            FROM TKRPRPM                                          16800000
168100           WHERE INTFC_SYS_CDE     = 'PCC'                        16810000
168200             AND SYS_PRC_FUNC_CDE  = 'P2LSML'                     16820000
168300             AND FUNC_TXT          = :DK-TRNID                    16830000
168400             AND FUNC_PRC_STAT_CDE = 'AC'                         16840000
168500     END-EXEC.                                                    16850000
168600                                                                  16860000
168700     EVALUATE TRUE                                                16870000
168800         WHEN SQLCODE = ZERO                                      16880000
168900             MOVE  KRPRPM-LOC-ID  TO  DK-OPER-UNT-ID              16890000
169000         WHEN SQLCODE = +100                                      16900000
169100             MOVE 'TKRPRPM'           TO PV-DISP-TABLE-1          16910000
169200             PERFORM 9955-SQL-ERROR                               16920000
169300             MOVE ZERO                TO DK-OPER-UNT-ID           16930000
169400             PERFORM 9910-USER-ERROR                              16940000
169500         WHEN SQLCODE = -904                                      16950000
169600         WHEN SQLCODE = -911                                      16960000
169700         WHEN SQLCODE = -913                                      16970000
169800             MOVE 'TKRPRPM'           TO PV-DISP-TABLE-1          16980000
169900             PERFORM 9955-SQL-ERROR                               16990000
170000             MOVE '013'               TO PV-ERROR-CODE            17000000
170100             PERFORM 9900-SOFT-ABORT                              17010000
170200         WHEN SQLWARN0 NOT = SPACES                               17020000
170300         WHEN SQLCODE < ZERO                                      17030000
170400         WHEN SQLCODE > ZERO                                      17040000
170500             MOVE 'TKRPRPM'           TO PV-DISP-TABLE-1          17050000
170600             PERFORM 9955-SQL-ERROR                               17060000
170700             MOVE ZERO                TO DK-OPER-UNT-ID           17070000
170800             PERFORM 9910-USER-ERROR                              17080000
170900     END-EVALUATE.                                                17090000
171000                                                                  17100000
171100                                                                  17110000
171200                                                                  17120000
171300 7110-SELECT-TKRPRPM.                                             17130000
171400                                                                  17140000
171500     STRING '  PCKCS723 - 7110-SELECT-TKRPRPM'                    17150000
171600         DELIMITED BY SIZE                                        17160000
171700         INTO PV-CICS-MSG-AREA.                                   17170007
171800     PERFORM 9990-WRITE-CICS.                                     17180007
171900                                                                  17190000
172000                                                                  17200000
172100     EXEC SQL                                                     17210000
172200          SELECT FUNC_TXT                                         17220000
172300            INTO :KRPRPM-FUNC-TXT                                 17230000
172400            FROM TKRPRPM                                          17240000
172500           WHERE LOC_ID            = :DK-OPER-UNT-ID              17250000
172600             AND INTFC_SYS_CDE    = 'DNP'                         17260000
172700             AND SYS_PRC_FUNC_CDE = 'DNPSML'                      17270000
172800             AND FUNC_PRC_STAT_CDE = 'AC'                         17280000
172900     END-EXEC.                                                    17290000
173000                                                                  17300000
173100     EVALUATE TRUE                                                17310000
173200         WHEN SQLCODE = ZERO                                      17320000
173300             IF KRPRPM-FUNC-TXT = 'Y'                             17330000
173400                 SET PS-SHOW-DEBUG-INFO                           17340000
173500                                      TO TRUE                     17350000
173600             ELSE                                                 17360000
173700                 SET PS-DONT-SHOW-DEBUG-INFO                      17370000
173800                                      TO TRUE                     17380000
173900             END-IF                                               17390000
174000         WHEN SQLCODE = +100                                      17400000
174100             SET PS-DONT-SHOW-DEBUG-INFO                          17410000
174200                                      TO TRUE                     17420000
174300         WHEN SQLCODE = -904                                      17430000
174400         WHEN SQLCODE = -911                                      17440000
174500         WHEN SQLCODE = -913                                      17450000
174600             MOVE 'TKRPRPM'           TO PV-DISP-TABLE-1          17460000
174700             PERFORM 9955-SQL-ERROR                               17470000
174800             MOVE '019'               TO PV-ERROR-CODE            17480000
174900             PERFORM 9900-SOFT-ABORT                              17490000
175000         WHEN SQLWARN0 NOT = SPACES                               17500000
175100         WHEN SQLCODE < ZERO                                      17510000
175200         WHEN SQLCODE > ZERO                                      17520000
175300             MOVE 'TKRPRPM'           TO PV-DISP-TABLE-1          17530000
175400             PERFORM 9955-SQL-ERROR                               17540000
175500             MOVE '020'               TO PV-ERROR-CODE            17550000
175600             PERFORM 9910-USER-ERROR                              17560000
175700     END-EVALUATE.                                                17570000
175800                                                                  17580000
175801                                                                  17580109
175802*----------------------------------------------------------------*17580209
175803* SELECT SOCKET TIMEOUT FROM PARAMETER DATABASE                  *17580309
175804* DMH - 03/07/08 - BEGIN                                          17580409
175805*----------------------------------------------------------------*17580509
175810 7115-GET-SOCKET-TIMEOUT.                                         17581009
175811     STRING '  PCKCS723 - 7115-GET-SOCKET-TIMEOUT'                17581109
175812         DELIMITED BY SIZE                                        17581209
175813         INTO PV-CICS-MSG-AREA.                                   17581309
175814     PERFORM 9990-WRITE-CICS.                                     17581409
175815                                                                  17581509
175816                                                                  17581609
175817     EXEC SQL                                                     17581709
175818          SELECT  FUNC_QTY                                        17581809
175819            INTO :KRPRPM-FUNC-QTY                                 17581909
175820            FROM  TKRPRPM                                         17582009
175821           WHERE  LOC_ID            = 90                          17582109
175822             AND  INTFC_SYS_CDE    = 'KHL'                        17582209
175823             AND  SYS_PRC_FUNC_CDE = 'SCKTM6'                     17582309
175824             AND  FUNC_PRC_STAT_CDE = 'AC'                        17582409
175825     END-EXEC.                                                    17582509
175826                                                                  17582609
175827     EVALUATE TRUE                                                17582709
175828         WHEN SQLCODE = ZERO                                      17582809
175829              MOVE KRPRPM-FUNC-QTY  TO  SELECT-SECS               17582909
175830                                                                  17583009
175837         WHEN SQLCODE = +100                                      17583709
175838              CONTINUE                                            17583809
175839                                                                  17583909
175847         WHEN SQLWARN0 NOT = SPACES                               17584709
175848         WHEN SQLCODE < ZERO                                      17584809
175849         WHEN SQLCODE > ZERO                                      17584909
175850             MOVE 'TKRPRPM'           TO PV-DISP-TABLE-1          17585009
175851             PERFORM 9955-SQL-ERROR                               17585109
175852             MOVE '020'               TO PV-ERROR-CODE            17585209
175853             PERFORM 9910-USER-ERROR                              17585309
175854                                                                  17585409
175855     END-EVALUATE.                                                17585509
175856                                                                  17585609
175860                                                                  17586009
175900 7120-SELECT-TP2LMOD.                                             17590000
176000                                                                  17600000
176100     STRING '  PCKCS723 - 7120-SELECT-TP2LMOD'                    17610000
176200         DELIMITED BY SIZE                                        17620000
176300         INTO PV-CICS-MSG-AREA.                                   17630007
176400     PERFORM 9990-WRITE-CICS.                                     17640007
176500                                                                  17650000
176600     MOVE  DK-OPER-UNT-ID  TO  PD-OPER-UNT-ID.                    17660007
176700     MOVE  DK-MODU-NBR     TO  PD-P2L-MOD.                        17670007
176800     INITIALIZE  PV-CICS-MSG-AREA.                                17680007
176900     STRING ' OPER='  PD-OPER-UNT-ID                              17690000
177000            '  MOD='  PD-P2L-MOD   DELIMITED BY SIZE              17700000
177100         INTO PV-CICS-MSG-AREA.                                   17710007
177200     PERFORM 9990-WRITE-CICS.                                     17720007
177300                                                                  17730000
177400     EXEC SQL                                                     17740000
177500          SELECT MODU_MDSE_TYP_CDE                                17750000
177600                ,AUD_IND                                          17760000
177700            INTO :P2LMOD-MODU-MDSE-TYP-CDE                        17770000
177800                ,:P2LMOD-AUD-IND                                  17780000
177900            FROM TP2LMOD                                          17790000
178000           WHERE OPER_UNT_ID       = :DK-OPER-UNT-ID              17800000
178100             AND MODU_NBR          = :DK-MODU-NBR                 17810000
178200     END-EXEC.                                                    17820000
178300                                                                  17830000
178400     EVALUATE TRUE                                                17840000
178500         WHEN SQLCODE = ZERO                                      17850000
178600             CONTINUE                                             17860000
178700                                                                  17870000
178800         WHEN SQLCODE = +100                                      17880000
178900             SET PS-DONT-SHOW-DEBUG-INFO                          17890000
179000                                      TO TRUE                     17900000
179100         WHEN SQLCODE = -904                                      17910000
179200         WHEN SQLCODE = -911                                      17920000
179300         WHEN SQLCODE = -913                                      17930000
179400             MOVE 'TP2LMOD'           TO PV-DISP-TABLE-1          17940000
179500             PERFORM 9955-SQL-ERROR                               17950000
179600             MOVE '062'               TO PV-ERROR-CODE            17960000
179700             PERFORM 9900-SOFT-ABORT                              17970000
179800         WHEN SQLWARN0 NOT = SPACES                               17980000
179900         WHEN SQLCODE < ZERO                                      17990000
180000         WHEN SQLCODE > ZERO                                      18000000
180100             MOVE 'TKRPRPM'           TO PV-DISP-TABLE-1          18010000
180200             PERFORM 9955-SQL-ERROR                               18020000
180300             MOVE '063'               TO PV-ERROR-CODE            18030000
180400             PERFORM 9910-USER-ERROR                              18040000
180500     END-EVALUATE.                                                18050000
180600/                                                                 18060000
180700 7150-SELECT-OTBND-CART.                                          18070000
180800                                                                  18080000
180900     STRING '  PCKCS723 - 7150-SELECT-OTBND-CART'                 18090000
181000         DELIMITED BY SIZE                                        18100000
181100         INTO PV-CICS-MSG-AREA.                                   18110007
181200     PERFORM 9990-WRITE-CICS.                                     18120007
181300                                                                  18130000
181400     INITIALIZE DCLSUT00024.                                      18140000
181500                                                                  18150000
181600     EXEC SQL                                                     18160000
181700         SELECT                                                   18170000
181800             CRE_DTE                                              18180000
181900         ,   CART_RVSN_NBR                                        18190000
182000         ,   CART_SRC_CDE                                         18200000
182100         INTO                                                     18210000
182200            :SUT00024-CRE-DTE                                     18220000
182300         ,  :SUT00024-CART-RVSN-NBR                               18230000
182400         ,  :SUT00024-CART-SRC-CDE                                18240000
182500         FROM SUT_OTBND_CART                                      18250000
182600         WHERE                                                    18260000
182700             SHIPT_UNT_ID     = :DK-SHIPT-UNT-ID                  18270000
182800     END-EXEC.                                                    18280000
182900                                                                  18290000
183000     EVALUATE TRUE                                                18300000
183100         WHEN SQLCODE = ZERO                                      18310000
183200             SET PS-OTBND-CART-NOT-MST                            18320000
183300                 PS-OTBND-CART-FOUND    TO TRUE                   18330000
183400         WHEN SQLCODE = +100                                      18340000
183500             SET PS-OTBND-CART-NOT-MST                            18350000
183600                 PS-OTBND-CART-NOT-FOUND TO TRUE                  18360000
183700         WHEN SQLCODE = -904                                      18370000
183800         WHEN SQLCODE = -911                                      18380000
183900         WHEN SQLCODE = -913                                      18390000
184000             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          18400000
184100             PERFORM 9955-SQL-ERROR                               18410000
184200             MOVE '021'               TO PV-ERROR-CODE            18420000
184300             PERFORM 9900-SOFT-ABORT                              18430000
184400         WHEN SQLWARN0 NOT = SPACES                               18440000
184500         WHEN SQLCODE < ZERO                                      18450000
184600         WHEN SQLCODE > ZERO                                      18460000
184700             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          18470000
184800             PERFORM 9955-SQL-ERROR                               18480000
184900             MOVE '022'               TO PV-ERROR-CODE            18490000
185000             PERFORM 9910-USER-ERROR                              18500000
185100     END-EVALUATE.                                                18510000
185200                                                                  18520000
185300 7200-UPDATE-OTBND-CART.                                          18530000
185400                                                                  18540000
185500     STRING '  PCKCS723 - 7200-UPDATE-OTBND-CART'                 18550000
185600         DELIMITED BY SIZE                                        18560000
185700         INTO PV-CICS-MSG-AREA.                                   18570007
185800     PERFORM 9990-WRITE-CICS.                                     18580007
185900                                                                  18590000
186000* THE NEW REVISION NUMBER COMES FROM PC185-REVISION-NBR           18600000
186100     MOVE PV-REVISION-NBR-N           TO SUT00024-CART-RVSN-NBR   18610000
186200                                         PV-DISP-NBR.             18620007
186300                                                                  18630000
186400     STRING ' PV-OPEN-DATE= '   PV-OPEN-DATE                      18640000
186500            ' PV-OPEN-TIME= '   PV-OPEN-TIME                      18650000
186600            ' SUT00024-CART-RVSN-NBR = ' PV-DISP-NBR              18660000
186700         DELIMITED BY SIZE                                        18670000
186800         INTO PV-CICS-MSG-AREA.                                   18680007
186900     PERFORM 9990-WRITE-CICS.                                     18690007
187000                                                                  18700000
187100     INITIALIZE  PV-CICS-MSG-AREA.                                18710007
187200     MOVE  DK-SHIPT-UNT-ID     TO  PD-SHIPT-UNT-ID.               18720007
187300     STRING ' SHIPT-UNT-ID-'   PD-SHIPT-UNT-ID                    18730000
187400         DELIMITED BY SIZE                                        18740000
187500         INTO PV-CICS-MSG-AREA.                                   18750007
187600     PERFORM 9990-WRITE-CICS.                                     18760007
187700                                                                  18770000
187800     EXEC SQL                                                     18780000
187900         UPDATE SUT_OTBND_CART                                    18790000
188000         SET                                                      18800000
188100             CRE_DTE         = :PV-OPEN-DATE                      18810000
188200         ,   CRE_TM          = :PV-OPEN-TIME                      18820000
188300         ,   CART_RVSN_NBR   = :SUT00024-CART-RVSN-NBR            18830000
188400         WHERE SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                   18840000
188500     END-EXEC.                                                    18850000
188600                                                                  18860000
188700     EVALUATE TRUE                                                18870000
188800         WHEN SQLCODE = ZERO                                      18880000
188900             CONTINUE                                             18890000
189000         WHEN SQLCODE = -904                                      18900000
189100         WHEN SQLCODE = -911                                      18910000
189200         WHEN SQLCODE = -913                                      18920000
189300             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          18930000
189400             PERFORM 9955-SQL-ERROR                               18940000
189500             SET PS-ERRORS-YES         TO TRUE                    18950000
189600             MOVE '023'               TO PV-ERROR-CODE            18960000
189700             PERFORM 9900-SOFT-ABORT                              18970000
189800         WHEN SQLWARN0 NOT = SPACES                               18980000
189900         WHEN SQLCODE < ZERO                                      18990000
190000         WHEN SQLCODE > ZERO                                      19000000
190100             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          19010000
190200             PERFORM 9955-SQL-ERROR                               19020000
190300             MOVE '024'               TO PV-ERROR-CODE            19030000
190400             PERFORM 9910-USER-ERROR                              19040000
190500     END-EVALUATE.                                                19050000
190600                                                                  19060000
190700 7210-DELETE-OTBND-CART.                                          19070000
190800                                                                  19080000
190900     STRING '  PCKCS723 - 7210-DELETE-OTBND-CART'                 19090000
191000         DELIMITED BY SIZE                                        19100000
191100         INTO PV-CICS-MSG-AREA.                                   19110007
191200                                                                  19120000
191300     PERFORM 9990-WRITE-CICS.                                     19130007
191400                                                                  19140000
191500     EXEC SQL                                                     19150000
191600     DELETE                                                       19160000
191700         FROM SUT_OTBND_CART                                      19170000
191800     WHERE                                                        19180000
191900         SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                          19190000
192000     END-EXEC.                                                    19200000
192100                                                                  19210000
192200     EVALUATE TRUE                                                19220000
192300         WHEN SQLCODE = ZERO                                      19230000
192400         WHEN SQLCODE = +100                                      19240000
192500             CONTINUE                                             19250000
192600         WHEN SQLCODE = -904                                      19260000
192700         WHEN SQLCODE = -911                                      19270000
192800         WHEN SQLCODE = -913                                      19280000
192900             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          19290000
193000             PERFORM 9955-SQL-ERROR                               19300000
193100             SET PS-ERRORS-YES         TO TRUE                    19310000
193200             MOVE '025'               TO PV-ERROR-CODE            19320000
193300             PERFORM 9900-SOFT-ABORT                              19330000
193400                                                                  19340000
193500         WHEN SQLWARN0 NOT = SPACES                               19350000
193600         WHEN SQLCODE  NOT = ZERO                                 19360000
193700             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          19370000
193800             PERFORM 9955-SQL-ERROR                               19380000
193900             SET PS-ERRORS-YES         TO TRUE                    19390000
194000             MOVE '026'               TO PV-ERROR-CODE            19400000
194100             PERFORM 9910-USER-ERROR                              19410000
194200     END-EVALUATE.                                                19420000
194300                                                                  19430000
194400                                                                  19440000
194500 7250-DELETE-OTBND-UPC.                                           19450000
194600                                                                  19460000
194700     STRING '  PCKCS723 - 7250-DELETE-OTBND-UPC'                  19470000
194800         DELIMITED BY SIZE                                        19480000
194900         INTO PV-CICS-MSG-AREA.                                   19490007
195000                                                                  19500000
195100     PERFORM 9990-WRITE-CICS.                                     19510007
195200                                                                  19520000
195300     EXEC SQL                                                     19530000
195400     DELETE                                                       19540000
195500         FROM SUT_OTBND_UPC                                       19550000
195600     WHERE                                                        19560000
195700         SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                          19570000
195800     END-EXEC.                                                    19580000
195900                                                                  19590000
196000     EVALUATE TRUE                                                19600000
196100         WHEN SQLCODE = ZERO                                      19610000
196200         WHEN SQLCODE = +100                                      19620000
196300             CONTINUE                                             19630000
196400         WHEN SQLCODE = -904                                      19640000
196500         WHEN SQLCODE = -911                                      19650000
196600         WHEN SQLCODE = -913                                      19660000
196700             MOVE 'SUT00028'          TO PV-DISP-TABLE-1          19670000
196800             PERFORM 9955-SQL-ERROR                               19680000
196900             SET PS-ERRORS-YES         TO TRUE                    19690000
197000             MOVE '025'               TO PV-ERROR-CODE            19700000
197100             PERFORM 9900-SOFT-ABORT                              19710000
197200                                                                  19720000
197300         WHEN SQLWARN0 NOT = SPACES                               19730000
197400         WHEN SQLCODE  NOT = ZERO                                 19740000
197500             MOVE 'SUT00028'          TO PV-DISP-TABLE-1          19750000
197600             PERFORM 9955-SQL-ERROR                               19760000
197700             SET PS-ERRORS-YES         TO TRUE                    19770000
197800             MOVE '026'               TO PV-ERROR-CODE            19780000
197900             PERFORM 9910-USER-ERROR                              19790000
198000     END-EVALUATE.                                                19800000
198100                                                                  19810000
198200                                                                  19820000
198300 7255-DELETE-OTBND-PK.                                            19830000
198400                                                                  19840000
198500     STRING '  PCKCS723 - 7255-DELETE-OTBND-PK'                   19850000
198600         DELIMITED BY SIZE                                        19860000
198700         INTO PV-CICS-MSG-AREA.                                   19870007
198800                                                                  19880000
198900     PERFORM 9990-WRITE-CICS.                                     19890007
199000                                                                  19900000
199100     EXEC SQL                                                     19910000
199200     DELETE                                                       19920000
199300         FROM SUT_OTBND_PK                                        19930000
199400     WHERE                                                        19940000
199500         SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                          19950000
199600     END-EXEC.                                                    19960000
199700                                                                  19970000
199800     EVALUATE TRUE                                                19980000
199900         WHEN SQLCODE = ZERO                                      19990000
200000         WHEN SQLCODE = +100                                      20000000
200100             CONTINUE                                             20010000
200200         WHEN SQLCODE = -904                                      20020000
200300         WHEN SQLCODE = -911                                      20030000
200400         WHEN SQLCODE = -913                                      20040000
200500             MOVE 'SUT00041'          TO PV-DISP-TABLE-1          20050000
200600             PERFORM 9955-SQL-ERROR                               20060000
200700             SET PS-ERRORS-YES         TO TRUE                    20070000
200800             MOVE '025'               TO PV-ERROR-CODE            20080000
200900             PERFORM 9900-SOFT-ABORT                              20090000
201000                                                                  20100000
201100         WHEN SQLWARN0 NOT = SPACES                               20110000
201200         WHEN SQLCODE  NOT = ZERO                                 20120000
201300             MOVE 'SUT00041'          TO PV-DISP-TABLE-1          20130000
201400             PERFORM 9955-SQL-ERROR                               20140000
201500             SET PS-ERRORS-YES         TO TRUE                    20150000
201600             MOVE '026'               TO PV-ERROR-CODE            20160000
201700             PERFORM 9910-USER-ERROR                              20170000
201800     END-EVALUATE.                                                20180000
201900                                                                  20190000
202000                                                                  20200000
202100 7260-DELETE-SUT00025.                                            20210000
202200                                                                  20220000
202300     STRING '  PCKCS723 - 7260-DELETE-SUT00025'                   20230000
202400         DELIMITED BY SIZE                                        20240000
202500         INTO PV-CICS-MSG-AREA.                                   20250007
202600                                                                  20260000
202700     PERFORM 9990-WRITE-CICS.                                     20270007
202800                                                                  20280000
202900     EXEC SQL                                                     20290000
203000     DELETE                                                       20300000
203100         FROM SUT_OTBND_PKD_UPC                                   20310000
203200     WHERE                                                        20320000
203300         SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                          20330000
203400     END-EXEC.                                                    20340000
203500                                                                  20350000
203600     EVALUATE TRUE                                                20360000
203700         WHEN SQLCODE = ZERO                                      20370000
203800         WHEN SQLCODE = +100                                      20380000
203900             CONTINUE                                             20390000
204000         WHEN SQLCODE = -904                                      20400000
204100         WHEN SQLCODE = -911                                      20410000
204200         WHEN SQLCODE = -913                                      20420000
204300             MOVE 'SUT_OTBND_PKD_UPC' TO PV-DISP-TABLE-1          20430000
204400             PERFORM 9955-SQL-ERROR                               20440000
204500             SET PS-ERRORS-YES         TO TRUE                    20450000
204600             MOVE '060'               TO PV-ERROR-CODE            20460000
204700             PERFORM 9900-SOFT-ABORT                              20470000
204800                                                                  20480000
204900         WHEN SQLWARN0 NOT = SPACES                               20490000
205000         WHEN SQLCODE  NOT = ZERO                                 20500000
205100             MOVE 'SUT_OTBND_PKD_UPC' TO PV-DISP-TABLE-1          20510000
205200             PERFORM 9955-SQL-ERROR                               20520000
205300             SET PS-ERRORS-YES         TO TRUE                    20530000
205400             MOVE '061'               TO PV-ERROR-CODE            20540000
205500             PERFORM 9910-USER-ERROR                              20550000
205600     END-EVALUATE.                                                20560000
205700                                                                  20570000
205800 7300-INSERT-OTBND-LOC.                                           20580000
205900                                                                  20590000
206000     STRING '  PCKCS723 - 7300-INSERT-OTBND-LOC'                  20600000
206100         DELIMITED BY SIZE                                        20610000
206200         INTO PV-CICS-MSG-AREA.                                   20620007
206300     PERFORM 9990-WRITE-CICS.                                     20630007
206400                                                                  20640000
206500     STRING ' SUT00027-CRE-TMST= ' SUT00027-CRE-TMST              20650000
206600         DELIMITED BY SIZE                                        20660000
206700         INTO PV-CICS-MSG-AREA.                                   20670007
206800     PERFORM 9990-WRITE-CICS.                                     20680007
206900                                                                  20690000
207000     EXEC SQL                                                     20700000
207100         INSERT                                                   20710000
207200           INTO SUT_OTBND_LOC                                     20720000
207300               (SHIPT_UNT_ID                                      20730000
207400              , LOC_NBR                                           20740000
207500              , SCN_CDE                                           20750000
207600              , CRE_USR_ID                                        20760000
207700              , CRE_TMST                                          20770000
207800              , ACTV_CDE                                          20780000
207900              , INBD_TRIP_ID)                                     20790000
208000                                                                  20800000
208100         VALUES (:SUT00027-SHIPT-UNT-ID                           20810000
208200               , :SUT00027-LOC-NBR                                20820000
208300               , :SUT00027-SCN-CDE                                20830000
208400               , :SUT00027-CRE-USR-ID                             20840000
208500               , :SUT00027-CRE-TMST                               20850000
208600               , 'A'                                              20860000
208700               , 0)                                               20870000
208800     END-EXEC.                                                    20880000
208900                                                                  20890000
209000     EVALUATE TRUE                                                20900000
209100         WHEN SQLCODE = ZERO                                      20910000
209200             CONTINUE                                             20920000
209300         WHEN SQLCODE = -803                                      20930000
209400             PERFORM 7301-INSERT-OTBND-LOC                        20940006
209500         WHEN SQLCODE = -904                                      20950000
209600         WHEN SQLCODE = -911                                      20960000
209700         WHEN SQLCODE = -913                                      20970000
209800             MOVE 'SUT00027'          TO PV-DISP-TABLE-1          20980000
209900             PERFORM 9955-SQL-ERROR                               20990000
210000             SET PS-ERRORS-YES         TO TRUE                    21000000
210100             MOVE '027'               TO PV-ERROR-CODE            21010000
210200             PERFORM 9900-SOFT-ABORT                              21020000
210300                                                                  21030000
210400         WHEN SQLWARN0 NOT = SPACES                               21040000
210500         WHEN SQLCODE  NOT = ZERO                                 21050000
210600             MOVE 'SUT00027'          TO PV-DISP-TABLE-1          21060000
210700             PERFORM 9955-SQL-ERROR                               21070000
210800             SET PS-ERRORS-YES         TO TRUE                    21080000
210900             MOVE '028'               TO PV-ERROR-CODE            21090000
211000             PERFORM 9910-USER-ERROR                              21100000
211100     END-EVALUATE.                                                21110000
211200                                                                  21120000
211300 7301-INSERT-OTBND-LOC.                                           21130005
211400                                                                  21140005
211500     STRING '  PCKCS723 - 7301-INSERT-OTBND-LOC'                  21150005
211600         DELIMITED BY SIZE                                        21160005
211700         INTO PV-CICS-MSG-AREA.                                   21170007
211800     PERFORM 9990-WRITE-CICS.                                     21180007
211900                                                                  21190005
212000     STRING ' SUT00027-CRE-TMST= ' SUT00027-CRE-TMST              21200005
212100         DELIMITED BY SIZE                                        21210005
212200         INTO PV-CICS-MSG-AREA.                                   21220007
212300     PERFORM 9990-WRITE-CICS.                                     21230007
212400                                                                  21240005
212500     EXEC SQL                                                     21250005
212600         INSERT                                                   21260005
212700           INTO SUT_OTBND_LOC                                     21270005
212800               (SHIPT_UNT_ID                                      21280005
212900              , LOC_NBR                                           21290005
213000              , SCN_CDE                                           21300005
213100              , CRE_USR_ID                                        21310005
213200              , CRE_TMST                                          21320005
213300              , ACTV_CDE                                          21330005
213400              , INBD_TRIP_ID)                                     21340005
213500                                                                  21350005
213600         VALUES (:SUT00027-SHIPT-UNT-ID                           21360005
213700               , :SUT00027-LOC-NBR                                21370005
213800               , :SUT00027-SCN-CDE                                21380005
213900               , :SUT00027-CRE-USR-ID                             21390005
214000               , CURRENT TIMESTAMP                                21400005
214100               , 'A'                                              21410005
214200               , 0)                                               21420005
214300     END-EXEC.                                                    21430005
214400                                                                  21440005
214500     EVALUATE TRUE                                                21450005
214600         WHEN SQLCODE = ZERO                                      21460005
214700             CONTINUE                                             21470005
214800         WHEN SQLCODE = -904                                      21480005
214900         WHEN SQLCODE = -911                                      21490005
215000         WHEN SQLCODE = -913                                      21500005
215100             MOVE 'SUT00027'          TO PV-DISP-TABLE-1          21510005
215200             PERFORM 9955-SQL-ERROR                               21520005
215300             SET PS-ERRORS-YES         TO TRUE                    21530005
215400             MOVE '110'               TO PV-ERROR-CODE            21540021
215500             PERFORM 9900-SOFT-ABORT                              21550005
215600                                                                  21560005
215700         WHEN SQLWARN0 NOT = SPACES                               21570005
215800         WHEN SQLCODE  NOT = ZERO                                 21580005
215900             MOVE 'SUT00027'          TO PV-DISP-TABLE-1          21590005
216000             PERFORM 9955-SQL-ERROR                               21600005
216100             SET PS-ERRORS-YES         TO TRUE                    21610005
216200             MOVE '111'               TO PV-ERROR-CODE            21620021
216300             PERFORM 9910-USER-ERROR                              21630005
216400     END-EVALUATE.                                                21640005
216500                                                                  21650005
216600                                                                  21660005
216700 7310-INACTIVATE-OTBND-LOC.                                       21670000
216800                                                                  21680000
216900     STRING '  PCKCS723 - 7310-INACTIVATE-OTBND-LOC'              21690000
217000         DELIMITED BY SIZE                                        21700000
217100         INTO PV-CICS-MSG-AREA.                                   21710007
217200     PERFORM 9990-WRITE-CICS.                                     21720007
217300                                                                  21730000
217400                                                                  21740000
217500     EXEC SQL                                                     21750000
217600         UPDATE SUT_OTBND_LOC                                     21760000
217700         SET                                                      21770000
217800             ACTV_CDE        = 'I'                                21780000
217900         WHERE SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                   21790000
218000           AND SCN_CDE       = 'LTP'                              21800005
218100     END-EXEC.                                                    21810000
218200                                                                  21820000
218300     EVALUATE TRUE                                                21830000
218400         WHEN SQLCODE = ZERO                                      21840000
218500             CONTINUE                                             21850000
218600         WHEN SQLCODE = -904                                      21860000
218700         WHEN SQLCODE = -911                                      21870000
218800         WHEN SQLCODE = -913                                      21880000
218900             MOVE 'SUT00027'          TO PV-DISP-TABLE-1          21890000
219000             PERFORM 9955-SQL-ERROR                               21900000
219100             SET PS-ERRORS-YES         TO TRUE                    21910000
219200             MOVE '029'               TO PV-ERROR-CODE            21920000
219300             PERFORM 9900-SOFT-ABORT                              21930000
219400         WHEN SQLWARN0 NOT = SPACES                               21940000
219500         WHEN SQLCODE < ZERO                                      21950000
219600         WHEN SQLCODE > ZERO                                      21960000
219700             MOVE '030'               TO PV-ERROR-CODE            21970000
219800             MOVE 'SUT00027'          TO PV-DISP-TABLE-1          21980000
219900             PERFORM 9955-SQL-ERROR                               21990000
220000             MOVE '031'               TO PV-ERROR-CODE            22000000
220100             PERFORM 9910-USER-ERROR                              22010000
220200     END-EVALUATE.                                                22020000
220300                                                                  22030000
220400                                                                  22040000
220500                                                                  22050000
220600 7350-INSERT-OTBND-CART.                                          22060000
220700                                                                  22070000
220800     STRING '  PCKCS723 - 7350-INSERT-OTBND-CART'                 22080000
220900         DELIMITED BY SIZE                                        22090000
221000         INTO PV-CICS-MSG-AREA.                                   22100007
221100     PERFORM 9990-WRITE-CICS.                                     22110007
221200                                                                  22120000
221300     STRING ' OPEN DATE IS ' PV-OPEN-DATE                         22130000
221400            ' OPEN TIME IS ' PV-OPEN-TIME                         22140000
221500         DELIMITED BY SIZE                                        22150000
221600         INTO PV-CICS-MSG-AREA.                                   22160007
221700     PERFORM 9990-WRITE-CICS.                                     22170007
221800                                                                  22180000
221900     EXEC SQL                                                     22190000
222000         INSERT INTO SUT_OTBND_CART                               22200000
222100             (SHIPT_UNT_ID                                        22210000
222200         ,    ORGN_LOC_NBR                                        22220000
222300         ,    DEST_LOC_NBR                                        22230000
222400         ,    CART_SRC_CDE                                        22240000
222500         ,    MSTR_CART_IND                                       22250000
222600         ,    PRNT_CART_ID                                        22260000
222700         ,    ORIG_CART_ID                                        22270000
222800         ,    ACTV_IND                                            22280000
222900         ,    CRE_DTE                                             22290000
223000         ,    CRE_TM                                              22300000
223100         ,    CRE_USR_ID                                          22310000
223200         ,    CRE_PGM_NM                                          22320000
223300         ,    CART_RVSN_NBR                                       22330000
223400         ,    CART_TYP_CDE                                        22340000
223500         )                                                        22350000
223600             VALUES                                               22360000
223700            (:DK-SHIPT-UNT-ID                                     22370000
223800         ,   :SUT00024-ORGN-LOC-NBR                               22380000
223900         ,   :SUT00024-DEST-LOC-NBR                               22390000
224000         ,   :SUT00024-CART-SRC-CDE                               22400000
224100         ,   :SUT00024-MSTR-CART-IND                              22410000
224200         ,   :SUT00024-PRNT-CART-ID                               22420000
224300         ,   :SUT00024-ORIG-CART-ID                               22430000
224400         ,   :SUT00024-ACTV-IND                                   22440000
224500         ,   :PV-OPEN-DATE                                        22450000
224600         ,   :PV-OPEN-TIME                                        22460000
224700         ,   :SUT00024-CRE-USR-ID                                 22470000
224800         ,   :SUT00024-CRE-PGM-NM                                 22480000
224900         ,   :SUT00024-CART-RVSN-NBR                              22490000
225000         ,   'S'                                                  22500000
225100         )                                                        22510000
225200         END-EXEC                                                 22520000
225300                                                                  22530000
225400     EVALUATE TRUE                                                22540000
225500         WHEN SQLCODE = ZERO                                      22550000
225600             CONTINUE                                             22560000
225700         WHEN SQLCODE = -904                                      22570000
225800         WHEN SQLCODE = -911                                      22580000
225900         WHEN SQLCODE = -913                                      22590000
226000             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          22600000
226100             PERFORM 9955-SQL-ERROR                               22610000
226200             SET PS-ERRORS-YES         TO TRUE                    22620000
226300             MOVE '032'               TO PV-ERROR-CODE            22630000
226400             PERFORM 9900-SOFT-ABORT                              22640000
226500                                                                  22650000
226600         WHEN SQLWARN0 NOT = SPACES                               22660000
226700         WHEN SQLCODE  NOT = ZERO                                 22670000
226800             MOVE 'SUT00024'          TO PV-DISP-TABLE-1          22680000
226900             PERFORM 9955-SQL-ERROR                               22690000
227000             SET PS-ERRORS-YES         TO TRUE                    22700000
227100             MOVE '033'               TO PV-ERROR-CODE            22710000
227200             PERFORM 9910-USER-ERROR                              22720000
227300     END-EVALUATE.                                                22730000
227400                                                                  22740000
227500 7400-SELECT-TDISTHD-TRECITM.                                     22750000
227600                                                                  22760000
227700     STRING '  PCKCS723 - 7400-SELECT-TDISTHD-TRECITM'            22770000
227800         DELIMITED BY SIZE                                        22780000
227900         INTO PV-CICS-MSG-AREA.                                   22790007
228000     PERFORM 9990-WRITE-CICS.                                     22800007
228100                                                                  22810000
228200     MOVE DK-ORD-NBR                  TO PV-DISP-PO.              22820007
228300     MOVE DK-ORD-LNE-NBR              TO PV-DISP-LINE.            22830007
228400     MOVE DK-REC-SEQ-NBR              TO PV-DISP-REC-SEQ-NBR.     22840007
228500     STRING ' PO-NBR= ' PV-DISP-PO                                22850000
228600            ' LINE-NBR= ' PV-DISP-LINE                            22860000
228700            ' RCVR= ' PV-DISP-REC-SEQ-NBR                         22870000
228800         DELIMITED BY SIZE                                        22880000
228900         INTO PV-CICS-MSG-AREA.                                   22890007
229000     PERFORM 9990-WRITE-CICS.                                     22900007
229100                                                                  22910000
229200                                                                  22920000
229300     EXEC SQL                                                     22930000
229400         SELECT                                                   22940000
229500             A.PREPK_ID                                           22950000
229600         ,   CASE  A.PREPK_RATO_QTY                               22960000
229700                 WHEN 0                                           22970000
229800                     THEN 1                                       22980000
229900                 ELSE                                             22990000
230000                     A.PREPK_RATO_QTY                             23000000
230100             END                                                  23010000
230200         ,   B.PREPK_LNE_PRC_CDE                                  23020000
230300         INTO                                                     23030000
230400             :RECITM-PREPK-ID                                     23040000
230500         ,   :RECITM-PREPK-RATO-QTY                               23050000
230600         ,   :DISTHD-PREPK-LNE-PRC-CDE                            23060000
230700         FROM                                                     23070000
230800             TRECITM A                                            23080000
230900         ,   TDISTHD B                                            23090000
231000         WHERE                                                    23100000
231100             A.ORD_NBR        = :DK-ORD-NBR      AND              23110000
231200             A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR  AND              23120000
231300             A.ORD_LNE_NBR    = :DK-ORD-LNE-NBR  AND              23130000
231400             A.VER_STATUS_CDE = 'A'              AND              23140000
231500             B.ORD_NBR        = A.ORD_NBR        AND              23150000
231600             B.RCVR_SEQ_NBR   = A.REC_SEQ_NBR    AND              23160000
231700             B.ORD_LNE_NBR    = A.ORD_LNE_NBR                     23170000
231800     END-EXEC.                                                    23180000
231900                                                                  23190000
232000     EVALUATE TRUE                                                23200000
232100         WHEN SQLCODE = ZERO                                      23210000
232200              MOVE RECITM-PREPK-ID    TO DK-PREPK-ID              23220000
232300                                                                  23230000
232400              INITIALIZE  PV-CICS-MSG-AREA                        23240000
232500              MOVE RECITM-PREPK-ID    TO PD-PREPK-ID              23250000
232600              STRING ' PCKCS723 - 7400 - '                        23260000
232700                     ' PREPK-ID=' PD-PREPK-ID                     23270000
232800                     ' PREPK-PRCS-CDE=' DISTHD-PREPK-LNE-PRC-CDE  23280000
232900                                         DELIMITED BY SIZE        23290000
233000                                    INTO PV-CICS-MSG-AREA         23300000
233100              PERFORM 9990-WRITE-CICS                             23310000
233200                                                                  23320000
233300         WHEN SQLCODE = +100                                      23330000
233400              perform 7410-SELECT-TDISTHD-TRECITM-TH              23340025
233500                                                                  23350000
233600         WHEN SQLCODE = -904                                      23360000
233700         WHEN SQLCODE = -911                                      23370000
233800         WHEN SQLCODE = -913                                      23380000
233900             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          23390000
234000             MOVE 'TDISTHD'           TO PV-DISP-TABLE-2          23400000
234100             PERFORM 9955-SQL-ERROR                               23410000
234200             SET PS-ERRORS-YES        TO TRUE                     23420000
234300             MOVE '034'               TO PV-ERROR-CODE            23430000
234400             PERFORM 9900-SOFT-ABORT                              23440000
234500         WHEN SQLWARN0 NOT = SPACES                               23450000
234600         WHEN SQLCODE < ZERO                                      23460000
234700         WHEN SQLCODE > ZERO                                      23470000
234800             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          23480000
234900             MOVE 'TDISTHD'           TO PV-DISP-TABLE-2          23490000
235000             PERFORM 9955-SQL-ERROR                               23500000
235100             SET PS-ERRORS-YES         TO TRUE                    23510000
235200             MOVE '035'               TO PV-ERROR-CODE            23520000
235300             PERFORM 9910-USER-ERROR                              23530000
235400     END-EVALUATE.                                                23540000
235500                                                                  23550000
235510                                                                  23551023
235511******************************************************************23551123
235512* if +100 in 7400 then check if the receiver is actually for the *23551223
235513* +1000 receiver number - p2l only allows for 3 digit rcvr       *23551323
235514* ex:  rcvr shows 234 but should actually be 1234                *23551423
235515******************************************************************23551523
235520 7410-SELECT-TDISTHD-TRECITM-TH.                                  23552025
235530                                                                  23553023
235540     STRING '  PCKCS723 - 7410-SELECT-TDISTHD-TRECITM-TH'         23554025
235550         DELIMITED BY SIZE                                        23555023
235560         INTO PV-CICS-MSG-AREA.                                   23556023
235570     PERFORM 9990-WRITE-CICS.                                     23557023
235580                                                                  23558023
235590     MOVE DK-ORD-NBR                  TO PV-DISP-PO.              23559023
235591     MOVE DK-ORD-LNE-NBR              TO PV-DISP-LINE.            23559123
235592     MOVE DK-REC-SEQ-NBR              TO PV-DISP-REC-SEQ-NBR.     23559223
235593     MOVE DK-REC-SEQ-NBR              TO DK-REC-SEQ-NBR-THSND.    23559323
235594     ADD  +1000                       TO DK-REC-SEQ-NBR-THSND.    23559423
235595     MOVE DK-REC-SEQ-NBR-THSND        TO PV-DISP-REC-THSND.       23559523
235596                                                                  23559623
235597     STRING ' PO-NBR= ' PV-DISP-PO                                23559723
235598            ' LINE-NBR= ' PV-DISP-LINE                            23559823
235599            ' RCVR= ' PV-DISP-REC-SEQ-NBR                         23559923
235600            ' +1000= ' PV-DISP-REC-thsnd                          23560023
235601         DELIMITED BY SIZE                                        23560123
235602         INTO PV-CICS-MSG-AREA.                                   23560223
235603     PERFORM 9990-WRITE-CICS.                                     23560323
235604                                                                  23560423
235605                                                                  23560523
235606     EXEC SQL                                                     23560623
235607         SELECT                                                   23560723
235608             A.PREPK_ID                                           23560823
235609         ,   CASE  A.PREPK_RATO_QTY                               23560923
235610                 WHEN 0                                           23561023
235611                     THEN 1                                       23561123
235612                 ELSE                                             23561223
235613                     A.PREPK_RATO_QTY                             23561323
235614             END                                                  23561423
235615         ,   B.PREPK_LNE_PRC_CDE                                  23561523
235616         INTO                                                     23561623
235617             :RECITM-PREPK-ID                                     23561723
235618         ,   :RECITM-PREPK-RATO-QTY                               23561823
235619         ,   :DISTHD-PREPK-LNE-PRC-CDE                            23561923
235620         FROM                                                     23562023
235621             TRECITM A                                            23562123
235622         ,   TDISTHD B                                            23562223
235623         WHERE                                                    23562323
235624             A.ORD_NBR        = :DK-ORD-NBR            AND        23562423
235625             A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR-THSND  AND        23562523
235626             A.ORD_LNE_NBR    = :DK-ORD-LNE-NBR        AND        23562623
235627             A.VER_STATUS_CDE = 'A'                    AND        23562723
235628             B.ORD_NBR        = A.ORD_NBR              AND        23562823
235629             B.RCVR_SEQ_NBR   = A.REC_SEQ_NBR          AND        23562923
235630             B.ORD_LNE_NBR    = A.ORD_LNE_NBR                     23563023
235631     END-EXEC.                                                    23563123
235632                                                                  23563223
235633     EVALUATE TRUE                                                23563323
235634         WHEN SQLCODE = ZERO                                      23563423
235635              MOVE  DK-REC-SEQ-NBR-THSND  TO  DK-REC-SEQ-NBR      23563523
235636                                                                  23563623
235637              MOVE RECITM-PREPK-ID    TO DK-PREPK-ID              23563723
235638                                                                  23563823
235639              INITIALIZE  PV-CICS-MSG-AREA                        23563923
235640              MOVE RECITM-PREPK-ID    TO PD-PREPK-ID              23564023
235641              STRING ' PCKCS723 - 7410 - '                        23564123
235642                     ' PREPK-ID=' PD-PREPK-ID                     23564223
235643                     ' PREPK-PRCS-CDE=' DISTHD-PREPK-LNE-PRC-CDE  23564323
235644                                         DELIMITED BY SIZE        23564423
235645                                    INTO PV-CICS-MSG-AREA         23564523
235646              PERFORM 9990-WRITE-CICS                             23564623
235647                                                                  23564723
235648              MOVE '120'               TO PV-ERROR-CODE           23564823
235649              PERFORM 7000-INSERT-TUPLDER                         23564923
235650                                                                  23565023
235651         WHEN SQLCODE = +100                                      23565123
235652              MOVE SPACE              TO DISTHD-PREPK-LNE-PRC-CDE 23565223
235653                                                                  23565323
235654              MOVE '121'               TO PV-ERROR-CODE           23565423
235655              PERFORM 7000-INSERT-TUPLDER                         23565523
235656                                                                  23565623
235657                                                                  23565723
235658         WHEN SQLCODE = -904                                      23565823
235659         WHEN SQLCODE = -911                                      23565923
235660         WHEN SQLCODE = -913                                      23566023
235661             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          23566123
235662             MOVE 'TDISTHD'           TO PV-DISP-TABLE-2          23566223
235663             PERFORM 9955-SQL-ERROR                               23566323
235664             SET PS-ERRORS-YES        TO TRUE                     23566423
235665             MOVE '034'               TO PV-ERROR-CODE            23566523
235666             PERFORM 9900-SOFT-ABORT                              23566623
235667         WHEN SQLWARN0 NOT = SPACES                               23566723
235668         WHEN SQLCODE < ZERO                                      23566823
235669         WHEN SQLCODE > ZERO                                      23566923
235670             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          23567023
235671             MOVE 'TDISTHD'           TO PV-DISP-TABLE-2          23567123
235672             PERFORM 9955-SQL-ERROR                               23567223
235673             SET PS-ERRORS-YES         TO TRUE                    23567323
235674             MOVE '035'               TO PV-ERROR-CODE            23567423
235675             PERFORM 9910-USER-ERROR                              23567523
235676     END-EVALUATE.                                                23567623
235677                                                                  23567723
235680* DMH 2/20/06 - BEGIN                                             23568000
235700 7420-CHECK-CHILD-CRTNS.                                          23570000
235800                                                                  23580000
235900     STRING '  PCKCS723 - 7420-CHECK-CHILD-CRTNS'                 23590000
236000         DELIMITED BY SIZE                                        23600000
236100         INTO PV-CICS-MSG-AREA.                                   23610007
236200     PERFORM 9990-WRITE-CICS.                                     23620007
236300                                                                  23630000
236400     MOVE DK-ORD-NBR                  TO PV-DISP-PO.              23640007
236500     MOVE DK-ORD-LNE-NBR              TO PV-DISP-LINE.            23650007
236600     MOVE DK-REC-SEQ-NBR              TO PV-DISP-REC-SEQ-NBR.     23660007
236700     STRING ' PO-NBR= ' PV-DISP-PO                                23670000
236800            ' LINE-NBR= ' PV-DISP-LINE                            23680000
236900            ' RCVR= ' PV-DISP-REC-SEQ-NBR                         23690000
237000         DELIMITED BY SIZE                                        23700000
237100         INTO PV-CICS-MSG-AREA.                                   23710007
237200     PERFORM 9990-WRITE-CICS.                                     23720007
237300                                                                  23730000
237400     EXEC SQL                                                     23740000
237500         SELECT COUNT(*)                                          23750000
237600           INTO :PV-CHILD-COUNT                                   23760000
237700           FROM SUT_OTBND_CART                                    23770000
237800          WHERE PRNT_CART_ID  =  :DK-SHIPT-UNT-ID                 23780000
237900            AND SHIPT_UNT_ID  <> :DK-SHIPT-UNT-ID                 23790000
238000         END-EXEC                                                 23800000
238100                                                                  23810000
238200     EVALUATE TRUE                                                23820000
238300         WHEN SQLCODE = ZERO                                      23830000
238400              MOVE PV-CHILD-COUNT     TO PV-DISP-CHILD            23840000
238500                                                                  23850000
238600              INITIALIZE  PV-CICS-MSG-AREA                        23860000
238700              STRING ' PCKCS723 - 7420 - '                        23870000
238800                     ' CHILD COUNT = '  PV-DISP-CHILD             23880000
238900                     DELIMITED BY SIZE                            23890000
239000                INTO PV-CICS-MSG-AREA                             23900000
239100              PERFORM 9990-WRITE-CICS                             23910000
239200                                                                  23920000
239300         WHEN SQLCODE = +100                                      23930000
239400              MOVE ZEROES             TO PV-CHILD-COUNT           23940000
239500                                                                  23950000
239600         WHEN SQLCODE = -904                                      23960000
239700         WHEN SQLCODE = -911                                      23970000
239800         WHEN SQLCODE = -913                                      23980000
239900             MOVE 'SUT_OTBND_CART'    TO PV-DISP-TABLE-1          23990000
240000             PERFORM 9955-SQL-ERROR                               24000000
240100             SET PS-ERRORS-YES        TO TRUE                     24010000
240200             MOVE '034'               TO PV-ERROR-CODE            24020000
240300             PERFORM 9900-SOFT-ABORT                              24030000
240400         WHEN SQLWARN0 NOT = SPACES                               24040000
240500         WHEN SQLCODE < ZERO                                      24050000
240600         WHEN SQLCODE > ZERO                                      24060000
240700             MOVE 'SUT_OTBND_CART'    TO PV-DISP-TABLE-1          24070000
240800             PERFORM 9955-SQL-ERROR                               24080000
240900             SET PS-ERRORS-YES         TO TRUE                    24090000
241000             MOVE '035'               TO PV-ERROR-CODE            24100000
241100             PERFORM 9910-USER-ERROR                              24110000
241200     END-EVALUATE.                                                24120000
241300* DMH 2/20/06 - END                                               24130000
241400                                                                  24140000
241500                                                                  24150000
241600 7450-UPDATE-OTBND-UPC-QTY.                                       24160000
241700                                                                  24170000
241800     STRING '  PCKCS723 - 7450-UPDATE-OTBND-UPC-QTY'              24180000
241900         DELIMITED BY SIZE                                        24190000
242000         INTO PV-CICS-MSG-AREA.                                   24200007
242100     PERFORM 9990-WRITE-CICS.                                     24210007
242200                                                                  24220000
242300     MOVE DK-ORD-NBR                  TO PV-DISP-PO.              24230007
242400     MOVE DK-ORD-LNE-NBR              TO PV-DISP-LINE.            24240007
242500     MOVE DK-SHIPT-UNT-ID             TO PV-DISP-SHPUNT.          24250007
242600     STRING ' PO-NBR= ' PV-DISP-PO                                24260000
242700            ' LINE-NBR= ' PV-DISP-LINE                            24270000
242800            ' RCVR= ' PV-DISP-REC-SEQ-NBR                         24280000
242900            ' '       PV-DISP-SHPUNT                              24290000
243000         DELIMITED BY SIZE                                        24300000
243100         INTO PV-CICS-MSG-AREA.                                   24310007
243200     PERFORM 9990-WRITE-CICS.                                     24320007
243300                                                                  24330000
243400                                                                  24340000
243500     EXEC SQL                                                     24350000
243600         UPDATE SUT_OTBND_UPC                                     24360000
243700             SET SHPD_UNT_QTY   =                                 24370000
243800                             SHPD_UNT_QTY + :SUT00028-SHPD-UNT-QTY24380000
243900         WHERE                                                    24390000
244000             SHIPT_UNT_ID       = :DK-SHIPT-UNT-ID    AND         24400000
244100             TRN_NBR            = :DK-ORD-NBR         AND         24410000
244200             TRN_LNE_NBR        = :DK-ORD-LNE-NBR     AND         24420000
244300             RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR     AND         24430000
244400             TRN_TYP_CDE        = 'PO'                            24440000
244500     END-EXEC.                                                    24450000
244600                                                                  24460000
244700     EVALUATE TRUE                                                24470000
244800         WHEN SQLCODE = ZERO                                      24480000
244900             SET PS-OTBND-UPC-FOUND   TO TRUE                     24490000
245000         WHEN SQLCODE = +100                                      24500000
245100             SET PS-OTBND-UPC-NOT-FOUND TO TRUE                   24510000
245200         WHEN SQLCODE = -904                                      24520000
245300         WHEN SQLCODE = -911                                      24530000
245400         WHEN SQLCODE = -913                                      24540000
245500             MOVE 'SUT00028'          TO PV-DISP-TABLE-1          24550000
245600             PERFORM 9955-SQL-ERROR                               24560000
245700             SET PS-ERRORS-YES         TO TRUE                    24570000
245800             MOVE '036'               TO PV-ERROR-CODE            24580000
245900             PERFORM 9900-SOFT-ABORT                              24590000
246000         WHEN SQLWARN0 NOT = SPACES                               24600000
246100         WHEN SQLCODE < ZERO                                      24610000
246200         WHEN SQLCODE > ZERO                                      24620000
246300             MOVE '037'               TO PV-ERROR-CODE            24630000
246400             MOVE 'SUT00028'          TO PV-DISP-TABLE-1          24640000
246500             PERFORM 9955-SQL-ERROR                               24650000
246600             MOVE '038'               TO PV-ERROR-CODE            24660000
246700             PERFORM 9910-USER-ERROR                              24670000
246800     END-EVALUATE.                                                24680000
246900                                                                  24690000
247000 7500-INSERT-OTBND-UPC.                                           24700000
247100                                                                  24710000
247200     STRING '  PCKCS723 - 7500-INSERT-OTBND-UPC'                  24720000
247300         DELIMITED BY SIZE                                        24730000
247400         INTO PV-CICS-MSG-AREA.                                   24740007
247500     PERFORM 9990-WRITE-CICS.                                     24750007
247600                                                                  24760000
247700     EXEC SQL                                                     24770000
247800         INSERT INTO SUT_OTBND_UPC                                24780000
247900             (                                                    24790000
248000                 SHIPT_UNT_ID                                     24800000
248100             ,   TRN_NBR                                          24810000
248200             ,   TRN_LNE_NBR                                      24820000
248300             ,   TRN_TYP_CDE                                      24830000
248400             ,   UPC_NBR                                          24840000
248500             ,   SHPD_UNT_QTY                                     24850000
248600             ,   RCVR_SEQ_NBR                                     24860000
248700             )                                                    24870000
248800             VALUES                                               24880000
248900             (                                                    24890000
249000                 :DK-SHIPT-UNT-ID                                 24900000
249100             ,   :DK-ORD-NBR                                      24910000
249200             ,   :DK-ORD-LNE-NBR                                  24920000
249300             ,   'PO'                                             24930000
249400             ,   :DK-UPC-NBR                                      24940000
249500             ,   :SUT00028-SHPD-UNT-QTY                           24950000
249600             ,   :DK-REC-SEQ-NBR                                  24960000
249700             )                                                    24970000
249800     END-EXEC.                                                    24980007
249900                                                                  24990000
250000     EVALUATE TRUE                                                25000000
250100         WHEN SQLCODE = ZERO                                      25010000
250200             CONTINUE                                             25020000
250300         WHEN SQLCODE = -904                                      25030000
250400         WHEN SQLCODE = -911                                      25040000
250500         WHEN SQLCODE = -913                                      25050000
250600             MOVE 'SUT00028'          TO PV-DISP-TABLE-1          25060000
250700             PERFORM 9955-SQL-ERROR                               25070000
250800             SET PS-ERRORS-YES         TO TRUE                    25080000
250900             MOVE '039'               TO PV-ERROR-CODE            25090000
251000             PERFORM 9900-SOFT-ABORT                              25100000
251100         WHEN SQLWARN0 NOT = SPACES                               25110000
251200         WHEN SQLCODE NOT EQUAL ZERO                              25120000
251300             MOVE '040'               TO PV-ERROR-CODE            25130000
251400             MOVE 'SUT00028'          TO PV-DISP-TABLE-1          25140000
251500             PERFORM 9955-SQL-ERROR                               25150000
251600             MOVE '041'               TO PV-ERROR-CODE            25160000
251700             PERFORM 9910-USER-ERROR                              25170000
251800     END-EVALUATE.                                                25180000
251900                                                                  25190000
252000                                                                  25200000
252100 7600-OPEN-PREPK-CSR.                                             25210000
252200                                                                  25220000
252300     STRING '  PCKCS723 - 7600-OPEN-PREPK-CSR'                    25230000
252400         DELIMITED BY SIZE                                        25240000
252500         INTO PV-CICS-MSG-AREA.                                   25250007
252600     PERFORM 9990-WRITE-CICS.                                     25260007
252700                                                                  25270000
252800     MOVE DK-ORD-NBR                  TO PV-DISP-PO.              25280007
252900     MOVE DK-ORD-LNE-NBR              TO PV-DISP-LINE.            25290007
253000     MOVE DK-SHIPT-UNT-ID             TO PV-DISP-SHPUNT.          25300007
253100     MOVE DK-PREPK-ID                 TO PV-DISP-PREPK-ID.        25310007
253200     STRING ' PO-NBR= ' PV-DISP-PO                                25320000
253300            ' LINE-NBR= ' PV-DISP-LINE                            25330000
253400            ' RCVR= ' PV-DISP-REC-SEQ-NBR                         25340000
253500            ' PREPK-ID= ' PV-DISP-PREPK-ID                        25350000
253600         DELIMITED BY SIZE                                        25360000
253700         INTO PV-CICS-MSG-AREA.                                   25370007
253800     PERFORM 9990-WRITE-CICS.                                     25380007
253900                                                                  25390000
254000     EXEC SQL                                                     25400000
254100         OPEN PRE-PACK-LNE-CSR                                    25410000
254200     END-EXEC.                                                    25420000
254300                                                                  25430000
254400     EVALUATE TRUE                                                25440000
254500         WHEN SQLCODE = ZERO                                      25450000
254600             SET PS-START-OF-PREPK-CSR                            25460000
254700                 PS-PREPK-CSR-OPEN    TO TRUE                     25470000
254800         WHEN SQLCODE = -904                                      25480000
254900         WHEN SQLCODE = -911                                      25490000
255000         WHEN SQLCODE = -913                                      25500000
255100             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          25510000
255200             MOVE 'TPURITM'           TO PV-DISP-TABLE-2          25520000
255300             PERFORM 9955-SQL-ERROR                               25530000
255400             SET PS-ERRORS-YES                                    25540000
255500                 PS-PREPK-CSR-CLOSED  TO TRUE                     25550000
255600             MOVE '047'               TO PV-ERROR-CODE            25560000
255700             PERFORM 9900-SOFT-ABORT                              25570000
255800         WHEN SQLWARN0 NOT = SPACES                               25580000
255900         WHEN SQLCODE < ZERO                                      25590000
256000         WHEN SQLCODE > ZERO                                      25600000
256100             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          25610000
256200             MOVE 'TPURITM'           TO PV-DISP-TABLE-2          25620000
256300             PERFORM 9955-SQL-ERROR                               25630000
256400             SET PS-ERRORS-YES                                    25640000
256500                 PS-PREPK-CSR-CLOSED  TO TRUE                     25650000
256600             MOVE '048'               TO PV-ERROR-CODE            25660000
256700             PERFORM 9910-USER-ERROR                              25670000
256800     END-EVALUATE.                                                25680000
256900                                                                  25690000
257000 7610-FETCH-PREPK-CSR.                                            25700000
257100                                                                  25710000
257200     STRING '  PCKCS723 - 7610-FETCH-PREPK-CSR'                   25720000
257300         DELIMITED BY SIZE                                        25730000
257400         INTO PV-CICS-MSG-AREA.                                   25740007
257500     PERFORM 9990-WRITE-CICS.                                     25750007
257600                                                                  25760000
257700     EXEC SQL                                                     25770000
257800         FETCH PRE-PACK-LNE-CSR                                   25780000
257900         INTO                                                     25790000
258000             :RECITM-ORD-LNE-NBR                                  25800000
258100         ,   :RECITM-PREPK-RATO-QTY                               25810000
258200         ,   :PURITM-ITM-NBR                                      25820000
258300     END-EXEC.                                                    25830000
258400                                                                  25840000
258500     MOVE RECITM-ORD-LNE-NBR          TO PV-DISP-LINE.            25850007
258600     MOVE RECITM-PREPK-RATO-QTY       TO PV-DISP-NBR.             25860007
258700     MOVE PURITM-ITM-NBR              TO PV-DISP-ITEM.            25870007
258800     STRING ' PO-NBR= ' PV-DISP-PO                                25880000
258900            ' RECITM-LINE-NBR= ' PV-DISP-LINE                     25890000
259000            ' PURITM-ITM-NBR= ' PV-DISP-ITEM                      25900000
259100            ' PREPK-RATO-QTY= '  PV-DISP-NBR                      25910000
259200         DELIMITED BY SIZE                                        25920000
259300         INTO PV-CICS-MSG-AREA.                                   25930007
259400     PERFORM 9990-WRITE-CICS.                                     25940007
259500                                                                  25950000
259600     EVALUATE TRUE                                                25960000
259700         WHEN SQLCODE = ZERO                                      25970000
259800* DMH ADDED 2/8/03 - BEGIN                                        25980000
259900              MOVE RECITM-ORD-LNE-NBR TO DK-ORD-LNE-NBR           25990000
260000* DMH ADDED 2/8/03 - END                                          26000000
260100              PERFORM 4110-GET-ONE-UPC                            26010000
260200         WHEN SQLCODE = +100                                      26020000
260300             SET PS-END-OF-PREPK-CSR  TO TRUE                     26030000
260400         WHEN SQLCODE = -904                                      26040000
260500         WHEN SQLCODE = -911                                      26050000
260600         WHEN SQLCODE = -913                                      26060000
260700             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          26070000
260800             MOVE 'TPURITM'           TO PV-DISP-TABLE-2          26080000
260900             PERFORM 9955-SQL-ERROR                               26090000
261000             SET PS-ERRORS-YES                                    26100000
261100                 PS-PREPK-CSR-CLOSED  TO TRUE                     26110000
261200             MOVE '049'               TO PV-ERROR-CODE            26120000
261300             PERFORM 9900-SOFT-ABORT                              26130000
261400         WHEN SQLWARN0 NOT = SPACES                               26140000
261500         WHEN SQLCODE < ZERO                                      26150000
261600         WHEN SQLCODE > ZERO                                      26160000
261700             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          26170000
261800             MOVE 'TPURITM'           TO PV-DISP-TABLE-2          26180000
261900             PERFORM 9955-SQL-ERROR                               26190000
262000             SET PS-ERRORS-YES                                    26200000
262100                 PS-PREPK-CSR-CLOSED  TO TRUE                     26210000
262200             MOVE '050'               TO PV-ERROR-CODE            26220000
262300             PERFORM 9910-USER-ERROR                              26230000
262400     END-EVALUATE.                                                26240000
262500                                                                  26250000
262600 7620-CLOSE-PREPK-CSR.                                            26260000
262700                                                                  26270000
262800     STRING '  PCKCS723 - 7620-CLOSE-PREPK-CSR'                   26280000
262900         DELIMITED BY SIZE                                        26290000
263000         INTO PV-CICS-MSG-AREA.                                   26300007
263100     PERFORM 9990-WRITE-CICS.                                     26310007
263200                                                                  26320000
263300     EXEC SQL                                                     26330000
263400         CLOSE PRE-PACK-LNE-CSR                                   26340000
263500     END-EXEC.                                                    26350000
263600                                                                  26360000
263700     EVALUATE TRUE                                                26370000
263800         WHEN SQLCODE = ZERO                                      26380000
263900              CONTINUE                                            26390000
264000         WHEN SQLWARN0 NOT = SPACES                               26400000
264100         WHEN SQLCODE < ZERO                                      26410000
264200         WHEN SQLCODE > ZERO                                      26420000
264300             MOVE 'TRECITM'           TO PV-DISP-TABLE-1          26430000
264400             MOVE 'TPURITM'           TO PV-DISP-TABLE-2          26440000
264500             PERFORM 9955-SQL-ERROR                               26450000
264600             SET PS-ERRORS-YES         TO TRUE                    26460000
264700             MOVE '051'               TO PV-ERROR-CODE            26470000
264800             PERFORM 9910-USER-ERROR                              26480000
264900     END-EVALUATE.                                                26490000
265000                                                                  26500000
265100 7700-INSERT-SUT00025.                                            26510000
265200                                                                  26520000
265300     STRING '  PCKCS723 - 7700-INSERT-SUT00025'                   26530000
265400         DELIMITED BY SIZE                                        26540000
265500         INTO PV-CICS-MSG-AREA.                                   26550007
265600     PERFORM 9990-WRITE-CICS.                                     26560007
265700                                                                  26570000
265800     EXEC SQL                                                     26580000
265900         INSERT INTO SUT_OTBND_PKD_UPC                            26590000
266000             (                                                    26600000
266100                 SHIPT_UNT_ID                                     26610000
266200             ,   TRN_NBR                                          26620000
266300             ,   RCVR_SEQ_NBR                                     26630000
266400             ,   TRN_LNE_NBR                                      26640000
266500             ,   TRN_TYP_CDE                                      26650000
266600             ,   UPC_NBR                                          26660000
266700             ,   PKD_BY_USR_ID                                    26670000
266800             ,   PKD_TMST                                         26680000
266900             ,   PKD_QTY                                          26690000
267000             ,   MODU_NBR                                         26700000
267100             )                                                    26710000
267200             VALUES                                               26720000
267300             (                                                    26730000
267400                 :DK-SHIPT-UNT-ID                                 26740000
267500             ,   :DK-ORD-NBR                                      26750000
267600             ,   :DK-REC-SEQ-NBR                                  26760000
267700             ,   :DK-ORD-LNE-NBR                                  26770000
267800             ,   'PO'                                             26780000
267900             ,   :DK-UPC-NBR                                      26790000
268000             ,   :PC185-USER-ID                                   26800000
268100             ,   :DK-TIMESTAMP                                    26810000
268200             ,   :SUT00028-SHPD-UNT-QTY                           26820000
268300             ,   :DK-MODU-NBR                                     26830000
268400             )                                                    26840000
268500     END-EXEC.                                                    26850007
268600                                                                  26860000
268700     EVALUATE TRUE                                                26870000
268800         WHEN SQLCODE = ZERO                                      26880000
268900             CONTINUE                                             26890000
268901* JAK 07/2007 - ADD CODE FOR -803                                 26890108
268910         WHEN SQLCODE = -803                                      26891008
268911             SET  PS-SUCCESSFUL-PKD-UPC-NO  TO TRUE               26891118
268912             MOVE  ZEROES  TO  PV-PKD-UPC-COUNT                   26891218
268920             PERFORM 7701-INSERT-SUT00025                         26892008
268930               UNTIL PS-SUCCESSFUL-PKD-UPC-YES                    26893019
268940                  OR PV-PKD-UPC-COUNT > 5                         26894018
269000         WHEN SQLCODE = -904                                      26900000
269100         WHEN SQLCODE = -911                                      26910000
269200         WHEN SQLCODE = -913                                      26920000
269300             MOVE 'SUT_OTBND_PKD_UPC'       TO PV-DISP-TABLE-1    26930000
269400             PERFORM 9955-SQL-ERROR                               26940000
269500             SET PS-ERRORS-YES         TO TRUE                    26950000
269600             MOVE '064'               TO PV-ERROR-CODE            26960000
269700             PERFORM 9900-SOFT-ABORT                              26970000
269800         WHEN SQLWARN0 NOT = SPACES                               26980000
269900         WHEN SQLCODE NOT EQUAL ZERO                              26990000
270000             MOVE '065'               TO PV-ERROR-CODE            27000000
270100             MOVE 'SUT_OTBND_PKD_UPC' TO PV-DISP-TABLE-1          27010000
270200             MOVE DK-TIMESTAMP        TO PV-CLOSE-TIMESTAMP       27020000
270300             PERFORM 9955-SQL-ERROR                               27030000
270400             MOVE '066'               TO PV-ERROR-CODE            27040000
270500             MOVE SQLCODE             TO PV-SQLCODE               27050000
270600             PERFORM 9910-USER-ERROR                              27060000
270700     END-EVALUATE.                                                27070000
270800/                                                                 27080000
270810* JAK 07/2007 - ADD PARAGRAPH 7701                                27081008
270830 7701-INSERT-SUT00025.                                            27083008
270840                                                                  27084008
270850     STRING '  PCKCS723 - 7701-INSERT-SUT00025'                   27085008
270860         DELIMITED BY SIZE                                        27086008
270870         INTO PV-CICS-MSG-AREA.                                   27087008
270880     PERFORM 9990-WRITE-CICS.                                     27088008
270890                                                                  27089008
270891     ADD  1  TO  PV-PKD-UPC-COUNT                                 27089118
270892                                                                  27089218
270893* IF THE INSERT RETURNED -803, THEN THE TIMESTAMP NEEDS TO        27089308
270894* BE INCREASED, IN ORDER TO CREATE A UNIQUE KEY.                  27089408
270895* IT THE -803 IS ENCOUNTERED WITH THIS INSERT, THEN IT IS AN ERROR27089508
270896     ADD  1                           TO PV-TMST-MICRO-SS.        27089620
270897     MOVE PV-TIMESTAMP                TO DK-TIMESTAMP.            27089708
270898                                                                  27089808
270899     EXEC SQL                                                     27089908
270900         INSERT INTO SUT_OTBND_PKD_UPC                            27090008
270901             (                                                    27090108
270902                 SHIPT_UNT_ID                                     27090208
270903             ,   TRN_NBR                                          27090308
270904             ,   RCVR_SEQ_NBR                                     27090408
270905             ,   TRN_LNE_NBR                                      27090508
270906             ,   TRN_TYP_CDE                                      27090608
270907             ,   UPC_NBR                                          27090708
270908             ,   PKD_BY_USR_ID                                    27090808
270909             ,   PKD_TMST                                         27090908
270910             ,   PKD_QTY                                          27091008
270911             ,   MODU_NBR                                         27091108
270912             )                                                    27091208
270913             VALUES                                               27091308
270914             (                                                    27091408
270915                 :DK-SHIPT-UNT-ID                                 27091508
270916             ,   :DK-ORD-NBR                                      27091608
270917             ,   :DK-REC-SEQ-NBR                                  27091708
270918             ,   :DK-ORD-LNE-NBR                                  27091808
270919             ,   'PO'                                             27091908
270920             ,   :DK-UPC-NBR                                      27092008
270921             ,   :PC185-USER-ID                                   27092108
270922             ,   :DK-TIMESTAMP                                    27092208
270923             ,   :SUT00028-SHPD-UNT-QTY                           27092308
270924             ,   :DK-MODU-NBR                                     27092408
270925             )                                                    27092508
270926     END-EXEC.                                                    27092608
270927                                                                  27092708
270928     EVALUATE TRUE                                                27092808
270929         WHEN SQLCODE = ZERO                                      27092908
270930              SET  PS-SUCCESSFUL-PKD-UPC-YES  TO  TRUE            27093018
270932         WHEN SQLCODE = -803                                      27093218
270933              SET  PS-SUCCESSFUL-PKD-UPC-NO   TO  TRUE            27093319
270935         WHEN SQLCODE = -904                                      27093518
270936         WHEN SQLCODE = -911                                      27093618
270937         WHEN SQLCODE = -913                                      27093718
270938             MOVE 'SUT_OTBND_PKD_UPC'       TO PV-DISP-TABLE-1    27093818
270939             PERFORM 9955-SQL-ERROR                               27093918
270940             SET PS-ERRORS-YES         TO TRUE                    27094018
270941             MOVE '064'               TO PV-ERROR-CODE            27094118
270942             PERFORM 9900-SOFT-ABORT                              27094218
270943         WHEN SQLWARN0 NOT = SPACES                               27094318
270944         WHEN SQLCODE NOT EQUAL ZERO                              27094418
270945             MOVE '065'               TO PV-ERROR-CODE            27094518
270946             MOVE 'SUT_OTBND_PKD_UPC' TO PV-DISP-TABLE-1          27094618
270947             MOVE DK-TIMESTAMP        TO PV-CLOSE-TIMESTAMP       27094718
270948             PERFORM 9955-SQL-ERROR                               27094818
270949             MOVE '066'               TO PV-ERROR-CODE            27094918
270950             MOVE SQLCODE             TO PV-SQLCODE               27095018
270951             PERFORM 9910-USER-ERROR                              27095118
270952     END-EVALUATE.                                                27095218
270953/                                                                 27095318
270960 8000-RECEIVE-SOCKET.                                             27096018
271000                                                                  27100000
271100     STRING '  PCKCS723 - 8000-RECEIVE-SOCKET'                    27110000
271200         DELIMITED BY SIZE                                        27120000
271300         INTO PV-CICS-MSG-AREA.                                   27130007
271400     PERFORM 9990-WRITE-CICS.                                     27140007
271500                                                                  27150000
271600     SET PS-START-RECEIVE             TO TRUE.                    27160000
271700     INITIALIZE PC185-SML-UPLOAD-RECORD.                          27170000
271800                                                                  27180000
271801     PERFORM 8150-CHECK-SOCKET-CONNECTION.                        27180109
271810                                                                  27181009
271900     PERFORM 8200-RECEIVE-SOCKET-RECORD                           27190000
272000     MOVE TCP-BUF-AREA                TO PC185-SML-UPLOAD-RECORD. 27200000
272100                                                                  27210000
272200     IF  PC185-HEADER                                             27220000
272300         INITIALIZE PV-CICS-MSG-AREA                              27230000
272400         STRING ' PCKCS723 -'                                     27240000
272500                ' TASK = ' PV-TASK-X                              27250000
272600                ' - '                                             27260000
272700                  PC185-SML-UPLOAD-RECORD                         27270000
272800             DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              27280000
272900         PERFORM 9991-WRITEQ                                      27290000
273000         INITIALIZE PV-CICS-MSG-AREA                              27300000
273100     END-IF.                                                      27310000
273200                                                                  27320000
273300     IF  PS-ABEND-LOOP                                            27330000
273400         ADD  1  TO  PV-ABEND-COUNT                               27340000
273500     END-IF.                                                      27350007
273600                                                                  27360000
273700     STRING ' '                                                   27370000
273800            PV-ABEND-COUNT                                        27380000
273900            ' '                                                   27390000
274000            PC185-SML-UPLOAD-RECORD                               27400000
274100     DELIMITED BY SIZE                                            27410000
274200     INTO PV-CICS-MSG-AREA.                                       27420007
274300     PERFORM 9990-WRITE-CICS.                                     27430000
274400                                                                  27440000
274500                                                                  27450000
274600*----------------------------------------------------------------*27460000
274700*  ACQUIRE A SOCKET FROM ANOTHER PROGRAM AND CREATE A NEW SOCKET.*27470000
274800*----------------------------------------------------------------*27480000
274900 8000-TAKE-SOCKET.                                                27490000
275000                                                                  27500000
275100     IF  PS-SHOW-DEBUG-INFO                                       27510000
275200         STRING ' 8000-TAKE-SOCKET'      DELIMITED BY SIZE        27520000
275300                                    INTO PV-CICS-MSG-AREA         27530000
275400         PERFORM 9990-WRITE-CICS                                  27540000
275500     END-IF.                                                      27550000
275600                                                                  27560000
275700     MOVE DP081-AF-INET               TO DP081-CID-DOMAIN-LSTN.   27570007
275800     MOVE DP081-LSTN-NAME             TO DP081-CID-NAME-LSTN.     27580007
275900     MOVE DP081-LSTN-SUBTASKNAME      TO                          27590000
276000                                       DP081-CID-SUBTASKNAME-LSTN.27600007
276100     MOVE DP081-LSTN-GIVE-TAKE-SOCKET TO DP081-SOCK-ID.           27610007
276200     CALL 'EZASOKET'                                              27620000
276300         USING                                                    27630000
276400                DP081-TAKESOCKET-CMD                              27640000
276500                DP081-SOCK-ID                                     27650000
276600                DP081-CLIENTID-LSTN                               27660000
276700                DP081-ERRNO                                       27670000
276800                DP081-RETCODE.                                    27680000
276900                                                                  27690000
277000     IF  PS-SHOW-DEBUG-INFO                                       27700000
277100         MOVE DP081-RETCODE           TO PV-DISP-RETCODE          27710000
277200         MOVE DP081-ERRNO             TO PV-ERRNO                 27720000
277300         STRING  ' DP081-RETCODE= '  PV-DISP-RETCODE              27730000
277400                 ' DP081-ERRNO  = '  PV-ERRNO                     27740000
277500                                         DELIMITED BY SIZE        27750000
277600                                    INTO PV-CICS-MSG-AREA         27760000
277700         PERFORM 9990-WRITE-CICS                                  27770000
277800     END-IF.                                                      27780000
277900                                                                  27790000
278000* IF THE TAKESOCKET IS SUCCESSFUL, THE NEW SOCKET ID IS           27800000
278100*  CONTAINED IN THE RETCODE                                       27810000
278200                                                                  27820000
278300     IF DP081-RETCODE >= ZERO                                     27830000
278400         MOVE DP081-RETCODE           TO DP081-SOCK-ID            27840000
278500         SET PS-SOCKET-OPEN           TO TRUE                     27850000
278600     ELSE                                                         27860000
278700         SET PS-ERRORS-YES            TO TRUE                     27870000
278800         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    27880000
278900         SET  DP081-TCP-IP-TAKE-ERR   TO TRUE                     27890000
279000         MOVE DP081-ERRNO             TO DP081-TCP-IP-ERR-NBR     27900000
279100         SET PS-SOCKET-CLOSED         TO TRUE                     27910000
279200         MOVE DP081-ERRNO             TO PV-ERRNO                 27920000
279300         STRING ' PCKCS723 -'                                     27930000
279400                ' DP081-ERRNO= ' PV-ERRNO                         27940000
279500             DELIMITED BY SIZE                                    27950000
279600             INTO PV-CICS-MSG-AREA                                27960000
279700         PERFORM 9990-WRITE-CICS                                  27970000
279800         MOVE '035'                   TO PV-ERROR-CODE            27980000
279900         PERFORM 9920-ALS-ERROR                                   27990000
280000                                                                  28000000
280100     END-IF.                                                      28010000
280200/                                                                 28020000
280300*----------------------------------------------------------------*28030000
280400*    CONFIRM THE CONNECTION ON THE SOCKET THAT WE RECEIVED FROM  *28040000
280500*    THE PACK TO LIGHT SYSTEM.                                   *28050000
280600*----------------------------------------------------------------*28060000
280700 8100-CONFIRM-CONNECTION.                                         28070000
280800                                                                  28080000
280900     IF  PS-SHOW-DEBUG-INFO                                       28090000
281000         STRING ' 8100-CONFIRM-CONNECTION' DELIMITED BY SIZE      28100000
281100                                      INTO PV-CICS-MSG-AREA       28110000
281200         PERFORM 9990-WRITE-CICS                                  28120000
281300     END-IF.                                                      28130000
281400                                                                  28140000
281500     MOVE SPACES                      TO TCP-BUF-AREA.            28150007
281600     MOVE TASK-START                  TO TCP-BUF-AREA.            28160007
281700     MOVE PV-TASK-START-LENGTH        TO DP081-NBR-BYTES          28170000
281800                                         DP081-TCPLENG.           28180000
281900                                                                  28190000
282000* TRANSLATE EBCDIC TO ASCII                                       28200000
282100     CALL 'EZACIC04'                                              28210000
282200         USING  DP081-TOASCII-TOKEN                               28220000
282300                TCP-BUF-AREA                                      28230000
282400                DP081-TCPLENG.                                    28240000
282500                                                                  28250000
282600* WRITE DATA ON A CONNECTED SOCKET                                28260000
282700     CALL 'EZASOKET'                                              28270000
282800         USING  DP081-WRITE-CMD                                   28280000
282900                DP081-SOCK-ID                                     28290000
283000                DP081-NBR-BYTES                                   28300000
283100                TCP-BUF-AREA                                      28310000
283200                DP081-ERRNO                                       28320000
283300                DP081-RETCODE.                                    28330000
283400                                                                  28340000
283500                                                                  28350000
283600     IF  PS-SHOW-DEBUG-INFO                                       28360000
283700         MOVE DP081-RETCODE           TO PV-DISP-RETCODE          28370000
283800         MOVE DP081-ERRNO             TO PV-ERRNO                 28380000
283900         STRING  ' DP081-RETCODE= '  PV-DISP-RETCODE              28390000
284000                 ' DP081-ERRNO  = '  PV-ERRNO                     28400000
284100                                         DELIMITED BY SIZE        28410000
284200                                    INTO PV-CICS-MSG-AREA         28420000
284300         PERFORM 9990-WRITE-CICS                                  28430000
284400     END-IF.                                                      28440007
284500                                                                  28450000
284600     IF DP081-RETCODE < ZERO                                      28460000
284700         SET PS-ERRORS-YES            TO TRUE                     28470000
284800         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    28480000
284900         SET  DP081-TCP-IP-WRITE-ERR  TO TRUE                     28490000
285000         MOVE DP081-ERRNO             TO DP081-TCP-IP-ERR-NBR     28500000
285100         MOVE '036'                   TO PV-ERROR-CODE            28510000
285200         STRING ' DP081-ERRNO= ' PV-ERRNO                         28520000
285300         DELIMITED BY SIZE                                        28530000
285400         INTO PV-CICS-MSG-AREA                                    28540000
285500         PERFORM 9990-WRITE-CICS                                  28550000
285600         MOVE '037'                   TO PV-ERROR-CODE            28560000
285700         PERFORM 9920-ALS-ERROR                                   28570000
285800                                                                  28580000
285900     END-IF.                                                      28590000
286000/                                                                 28600000
286001                                                                  28600109
286010* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 28601009
286020*  added Select socket command to check if socket connection    * 28602009
286030*  is still active.  if return code > 0 then socket is active   * 28603009
286040*  if return code = 0 socket is no longer active.               * 28604009
286050* DMH - 03/07/08 - BEGIN                                          28605009
286060* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 28606009
286070 8150-CHECK-SOCKET-CONNECTION.                                    28607009
286080                                                                  28608009
286081     INITIALIZE  PV-CICS-MSG-AREA.                                28608109
286083     STRING 'PCKCS723 - 8150-CHECK-SOCKET-CONNECT'                28608309
286084                                              DELIMITED BY SIZE   28608409
286085                                         INTO PV-CICS-MSG-AREA.   28608509
286086     PERFORM 9990-WRITE-CICS.                                     28608609
286107                                                                  28610709
286108* ZERO OUT ALL OUTPUT BIT MASKS FOR SELECT                        28610809
286109     PERFORM VARYING SOCKNO FROM 1 BY 1 UNTIL SOCKNO > SOCKETS    28610909
286110        MOVE '0' TO CHAR-ENTRY(SOCKNO)                            28611009
286111     END-PERFORM.                                                 28611109
286112     PERFORM 8160-CHAR-TO-BIT.                                    28611209
286113                                                                  28611309
286115     IF  PS-SHOW-DEBUG-INFO                                       28611509
286117        INITIALIZE                       PV-CICS-MSG-AREA         28611709
286118        MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO         28611809
286119        MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS        28611909
286120        STRING ' PCKCS723- 8150-'                                 28612009
286121               '  SOCKNO='   PV-DISPLAY-SOCKNO                    28612109
286122               '  SOCKETS='  PV-DISPLAY-SOCKETS                   28612209
286123                                         DELIMITED BY SIZE        28612309
286124                                    INTO PV-CICS-MSG-AREA         28612409
286125        MOVE LENGTH OF PV-CICS-MSG-AREA                           28612509
286126                                      TO PV-COMMAREA-LENGTH       28612609
286127        EXEC CICS                                                 28612709
286128            WRITEQ TD                                             28612809
286129                QUEUE   ('CSSL')                                  28612909
286130                FROM    (PV-CICS-MSG-AREA)                        28613009
286131                LENGTH  (PV-COMMAREA-LENGTH)                      28613109
286132                RESP    (PV-CICS-RESP)                            28613209
286133        END-EXEC                                                  28613309
286134     END-IF.                                                      28613409
286136                                                                  28613609
286137     MOVE BIT-MASK TO SELECT-RR-MASK.                             28613709
286138     MOVE BIT-MASK TO SELECT-RW-MASK.                             28613809
286139     MOVE BIT-MASK TO SELECT-RE-MASK.                             28613909
286140     MOVE BIT-MASK TO SELECT-EX-MASK.                             28614009
286141     MOVE BIT-MASK TO SELECT-WR-MASK.                             28614109
286142                                                                  28614209
286143* set all input bit masks for select to 1                         28614309
286144     PERFORM VARYING SOCKNO FROM 1 BY 1 UNTIL SOCKNO > SOCKETS    28614409
286145        MOVE '1' TO CHAR-ENTRY(SOCKNO)                            28614509
286146     END-PERFORM.                                                 28614609
286147     PERFORM 8160-CHAR-TO-BIT.                                    28614709
286148     MOVE BIT-MASK TO SELECT-RD-MASK.                             28614809
286149                                                                  28614909
286152     INITIALIZE                       PV-CICS-MSG-AREA            28615213
286153     MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO            28615313
286154     MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS           28615413
286155     STRING ' PCKCS723- 8150-'                                    28615513
286156            '  SOCKNO='   PV-DISPLAY-SOCKNO                       28615613
286157            '  SOCKETS='  PV-DISPLAY-SOCKETS                      28615713
286158                                      DELIMITED BY SIZE           28615813
286159                                 INTO PV-CICS-MSG-AREA            28615913
286160     MOVE LENGTH OF PV-CICS-MSG-AREA                              28616013
286161                                   TO PV-COMMAREA-LENGTH          28616113
286162     PERFORM 9990-WRITE-CICS.                                     28616213
286171                                                                  28617109
286172*                                                                 28617209
286173* ISSUE THE SELECT COMMAND ----------------------------           28617309
286174* SELECT WILL FLIP A BIT IN THE READ MASK TO '1' FOR ANY          28617409
286175* SOCKET THAT HAS DATA TO BE PROCESSED.                           28617509
286176*                                                                 28617609
286177                                                                  28617709
286178     MOVE 0 TO DP081-ERRNO.                                       28617809
286179     MOVE 0 TO DP081-RETCODE.                                     28617909
286180     CALL 'EZASOKET' USING DP081-SELECT-CMD                       28618009
286181         SELECT-NUMFDS SELECT-TIMEOUT                             28618109
286182         SELECT-RD-MASK SELECT-WR-MASK SELECT-EX-MASK             28618209
286183         SELECT-RR-MASK SELECT-RW-MASK SELECT-RE-MASK             28618309
286184         DP081-ERRNO DP081-RETCODE.                               28618409
286185                                                                  28618509
286186                                                                  28618609
286189     INITIALIZE                       PV-CICS-MSG-AREA            28618913
286190     MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO            28619013
286191     MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS           28619113
286192     STRING ' PCKCS723- 8150-'                                    28619213
286193            '  RD-MASK=' SELECT-RD-MASK                           28619313
286194            '  WR-MASK=' SELECT-WR-MASK                           28619413
286195            '  EX-MASK=' SELECT-EX-MASK                           28619513
286196                                      DELIMITED BY SIZE           28619613
286197                                 INTO PV-CICS-MSG-AREA            28619713
286198     MOVE LENGTH OF PV-CICS-MSG-AREA                              28619813
286199                                   TO PV-COMMAREA-LENGTH          28619913
286200     PERFORM 9990-WRITE-CICS.                                     28620013
286208                                                                  28620809
286209     INITIALIZE                       PV-CICS-MSG-AREA            28620913
286210     MOVE SOCKNO                 TO  PV-DISPLAY-SOCKNO            28621013
286211     MOVE SOCKETS                TO  PV-DISPLAY-SOCKETS           28621113
286212     STRING ' PCKCS723  8150-'                                    28621213
286213            '  RR-MASK=' SELECT-RR-MASK                           28621313
286214            '  RW-MASK=' SELECT-RW-MASK                           28621413
286215            '  RE-MASK=' SELECT-RE-MASK                           28621513
286216            '  BIT-MASK=' BIT-MASK                                28621613
286217                                      DELIMITED BY SIZE           28621713
286218                                 INTO PV-CICS-MSG-AREA            28621813
286219     MOVE LENGTH OF PV-CICS-MSG-AREA                              28621913
286220                                   TO PV-COMMAREA-LENGTH          28622013
286221     PERFORM 9990-WRITE-CICS.                                     28622113
286230                                                                  28623009
286231                                                                  28623109
286232     IF DP081-RETCODE < 0                                         28623209
286233         INITIALIZE  PV-CICS-MSG-AREA                             28623309
286234         SET  PS-SOCKET-ERROR        TO TRUE                      28623409
286235         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    28623509
286236         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    28623609
286237         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      28623709
286238                                        SOCKET-ERRNO              28623809
286239         MOVE DP081-RETCODE          TO SOCKET-RETCODE            28623909
286240         MOVE PC185-SML-UPLOAD-RECORD TO SOCKET-MESSAGE           28624013
286241         MOVE 'SEE ERROR NBR '       TO SOCKET-DESCR              28624113
286245         MOVE SOCKET-SELECT-ERR      TO PV-CICS-MSG-AREA          28624509
286246         PERFORM 9990-WRITE-CICS                                  28624613
286247                                                                  28624709
286248         INITIALIZE  PV-CICS-MSG-AREA                             28624809
286249         STRING ' PCKCS723 -'                                     28624913
286250                 PC185-SML-UPLOAD-RECORD                          28625013
286251                                         DELIMITED BY SIZE        28625113
286260                                     INTO PV-CICS-MSG-AREA        28626009
286261         PERFORM 9990-WRITE-CICS                                  28626113
286262                                                                  28626209
286263         INITIALIZE  PV-CICS-MSG-AREA                             28626309
286264         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      28626409
286265         MOVE DP081-TCP-IP-LOGGING-MSG TO PV-CICS-MSG-AREA        28626509
286266         PERFORM 9990-WRITE-CICS                                  28626613
286267                                                                  28626709
286268     END-IF.                                                      28626809
286269                                                                  28626909
286270     IF DP081-RETCODE = 0                                         28627009
286271         INITIALIZE  PV-CICS-MSG-AREA                             28627109
286272         SET  PS-SOCKET-ERROR        TO TRUE                      28627209
286273         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    28627309
286274         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    28627409
286275         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      28627509
286276                                        SOCKET-ERRNO              28627609
286277         MOVE DP081-RETCODE          TO SOCKET-RETCODE            28627709
286278         MOVE PC185-SML-UPLOAD-RECORD TO SOCKET-MESSAGE           28627813
286281         MOVE 'SOCKET TIMEOUT'       TO SOCKET-DESCR              28628109
286282                                                                  28628209
286283         MOVE SOCKET-SELECT-ERR      TO PV-CICS-MSG-AREA          28628309
286284         PERFORM 9990-WRITE-CICS                                  28628413
286285                                                                  28628509
286286         INITIALIZE  PV-CICS-MSG-AREA                             28628609
286287         STRING ' PCKCS723 -'            DELIMITED BY SIZE        28628709
286288                 PC185-SML-UPLOAD-RECORD                          28628813
286289                                         DELIMITED BY SIZE        28628913
286298                                     INTO PV-CICS-MSG-AREA        28629809
286299         PERFORM 9990-WRITE-CICS                                  28629913
286300                                                                  28630009
286301         INITIALIZE  PV-CICS-MSG-AREA                             28630109
286302         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      28630209
286303         MOVE DP081-TCP-IP-LOGGING-MSG TO PV-CICS-MSG-AREA        28630309
286304         PERFORM 9990-WRITE-CICS                                  28630413
286305                                                                  28630509
286306     END-IF.                                                      28630609
286307                                                                  28630709
286308***************************************************************   28630809
286309* CHAR-TO-BIT                                                 *   28630909
286310* CONVERT THE CHARACTER ARRAY TO A SELECT BIT MASK SO THAT THE*   28631009
286311* COBOL PROGRAM CAN WRITE IT.                                 *   28631109
286312***************************************************************   28631209
286313 8160-CHAR-TO-BIT.                                                28631309
286314                                                                  28631409
286316     INITIALIZE                       PV-CICS-MSG-AREA            28631609
286317     STRING ' PCKCS723- 8160-CHAR-TO-BIT              '           28631709
286318                                         DELIMITED BY SIZE        28631809
286319                                    INTO PV-CICS-MSG-AREA         28631909
286320     MOVE LENGTH OF PV-CICS-MSG-AREA                              28632009
286321                                      TO PV-COMMAREA-LENGTH       28632109
286322     PERFORM 9990-WRITE-CICS.                                     28632209
286331                                                                  28633109
286332* CHAR-TO-BIT                                                     28633209
286333* CONVERT THE CHARACTER ARRAY TO A SELECT BIT MASK SO THAT THE    28633309
286334* COBOL PROGRAM CAN WRITE IT.                                     28633409
286335*                                                                 28633509
286336     CALL 'EZACIC06' USING BITMASK-TOKEN CTOB                     28633609
286337          BIT-MASK CHAR-MASK BIT-MASK-LENGTH EZRETC               28633709
286338     IF  EZRETC < 0 THEN                                          28633809
286339         MOVE '!EZCIC06 - CTOB-EXCP ' TO PV-CICS-MSG-AREA         28633909
286340         MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH    28634009
286341                                                                  28634109
286342         EXEC CICS                                                28634209
286343             WRITEQ TD                                            28634309
286344                 QUEUE   ('CSSL')                                 28634409
286345                 FROM    (PV-CICS-MSG-AREA)                       28634509
286346                 LENGTH  (PV-COMMAREA-LENGTH)                     28634609
286347                 RESP    (PV-CICS-RESPONSE)                       28634709
286348         END-EXEC                                                 28634809
286349                                                                  28634909
286350         INITIALIZE  PV-CICS-MSG-AREA                             28635009
286351         SET  PS-SOCKET-ERROR        TO TRUE                      28635109
286352         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    28635209
286353         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    28635309
286354         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      28635409
286355                                        SOCKET-ERRNO              28635509
286356         MOVE DP081-RETCODE          TO SOCKET-RETCODE            28635609
286357         MOVE PC185-SML-UPLOAD-RECORD TO SOCKET-MESSAGE           28635713
286360         MOVE 'SEE ERROR NO '        TO SOCKET-DESCR              28636009
286361                                                                  28636109
286362         MOVE SOCKET-SELECT-ERR      TO PV-CICS-MSG-AREA          28636209
286363         PERFORM 9990-WRITE-CICS                                  28636313
286364                                                                  28636409
286365         INITIALIZE  PV-CICS-MSG-AREA                             28636509
286366         STRING ' PCKCS723 -'            DELIMITED BY SIZE        28636609
286367                 PC185-SML-UPLOAD-RECORD                          28636713
286368                                         DELIMITED BY SIZE        28636813
286377                                     INTO PV-CICS-MSG-AREA        28637709
286378         PERFORM 9990-WRITE-CICS                                  28637813
286379                                                                  28637909
286380         INITIALIZE  PV-CICS-MSG-AREA                             28638009
286381         MOVE DP081-ERRNO            TO DP081-TCP-IP-ERR-NBR      28638109
286382         MOVE DP081-TCP-IP-LOGGING-MSG TO PV-CICS-MSG-AREA        28638209
286383         PERFORM 9990-WRITE-CICS                                  28638313
286384                                                                  28638409
286385     END-IF.                                                      28638509
286386                                                                  28638609
286387* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 28638709
286388* DMH - 03/07/08 - END                                            28638814
286389                                                                  28638909
286390                                                                  28639009
286391 8200-RECEIVE-SOCKET-RECORD.                                      28639100
286392                                                                  28639200
286393     IF  PS-SHOW-DEBUG-INFO                                       28639300
286400         STRING ' 8200-RECEIVE-SOCKET-RECORD' DELIMITED BY SIZE   28640000
286500                                         INTO PV-CICS-MSG-AREA    28650000
286600         PERFORM 9990-WRITE-CICS                                  28660000
286700     END-IF.                                                      28670000
286800                                                                  28680000
286900     SET PS-SOCKET-OPEN               TO TRUE.                    28690000
287000     MOVE ZERO                        TO PV-BUFFER-SUB.           28700007
287100     MOVE SPACES                      TO TCP-BUF-AREA.            28710007
287200     MOVE PC185-DL-DETAIL             TO DP081-TCPLENG.           28720000
287300     MOVE 1                           TO DP081-NBR-BYTES.         28730007
287400                                                                  28740000
287500                                                                  28750000
287600     PERFORM UNTIL TCP-BUF (PV-BUFFER-SUB) = PC-TERM-CHARACTER    28760000
287610                or TCP-BUF (PV-BUFFER-SUB) = PC-TERM-CHARACTER-2  28761022
287700                OR PS-SOCKET-CLOSED                               28770000
287800                                                                  28780000
287900*    MOVE ' READY TO RECEIVE COMMAND' TO PV-CICS-MSG-AREA         28790000
288000*    PERFORM 9990-WRITE-CICS                                      28800000
288100                                                                  28810000
288200     CALL 'EZASOKET'                                              28820000
288300         USING                                                    28830000
288400                DP081-RECV-CMD                                    28840000
288500                DP081-SOCK-ID                                     28850000
288600                DP081-FLAG                                        28860000
288700                DP081-NBR-BYTES                                   28870000
288800                TCP-BUF (PV-BUFFER-SUB + 1)                       28880000
288900                DP081-ERRNO                                       28890000
289000                DP081-RETCODE                                     28900000
289100                                                                  28910000
289200                                                                  28920000
289300     MOVE DP081-RETCODE               TO PV-DISP-RETCODE          28930000
289400*    STRING  ' DP081-RETCODE= '  PV-DISP-RETCODE                  28940000
289500*            ' DP081-ERRNO  = '  PV-ERRNO                         28950000
289600*            DELIMITED BY SIZE                                    28960000
289700*            INTO PV-CICS-MSG-AREA                                28970000
289800*    PERFORM 9990-WRITE-CICS                                      28980000
289900                                                                  28990000
290000                                                                  29000000
290100     EVALUATE TRUE                                                29010000
290200     WHEN DP081-RETCODE > ZERO                                    29020000
290300         ADD DP081-RETCODE            TO PV-BUFFER-SUB            29030000
290400     WHEN DP081-RETCODE < ZERO                                    29040000
290500         SET PS-ERRORS-YES            TO TRUE                     29050000
290600         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    29060000
290700         SET  DP081-TCP-IP-READ-ERR   TO TRUE                     29070000
290800         MOVE DP081-ERRNO             TO DP081-TCP-IP-ERR-NBR     29080000
290900         STRING 'DP081-ERRNO= ' PV-ERRNO                          29090000
291000         DELIMITED BY SIZE                                        29100000
291100         INTO PV-CICS-MSG-AREA                                    29110000
291200         PERFORM 9990-WRITE-CICS                                  29120000
291300         PERFORM 8400-CLOSE-SOCKET                                29130000
291400         MOVE '038'                   TO PV-ERROR-CODE            29140000
291500         PERFORM 9920-ALS-ERROR                                   29150000
291600                                                                  29160000
291700     WHEN DP081-RETCODE = ZERO                                    29170000
291800* THE SOCKET IS CLOSED                                            29180000
291900         SET PS-ERRORS-YES                                        29190000
292000             PS-SOCKET-CLOSED         TO TRUE                     29200000
292100         INITIALIZE PV-CICS-MSG-AREA                              29210000
292200         MOVE DP081-RETCODE           TO PV-RETCODE               29220000
292300         MOVE DP081-NBR-BYTES         TO PV-TCPLENG               29230000
292400         STRING ' PCKCS723:'                                      29240000
292500                'SOCKET ERROR EQ 0'                               29250000
292600                ' RETCODE='                                       29260000
292700                  PV-RETCODE                                      29270000
292800                ' TCPLENG='                                       29280000
292900                  PV-TCPLENG                                      29290000
293000                ' ERRNO='                                         29300000
293100                  PV-ERRNO                                        29310000
293200                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA          29320000
293300         PERFORM 9990-WRITE-CICS                                  29330000
293400         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    29340000
293500         SET DP081-TCP-IP-READ-ERR    TO TRUE                     29350000
293600         MOVE DP081-ERRNO             TO DP081-TCP-IP-ERR-NBR     29360000
293700         MOVE '039'                   TO PV-ERROR-CODE            29370000
293800         PERFORM 9920-ALS-ERROR                                   29380000
293900                                                                  29390000
294000     END-EVALUATE                                                 29400000
294100     END-PERFORM.                                                 29410000
294200                                                                  29420000
294300* BEGIN OF TRANSLATE ASCII TO EBCDIC                              29430000
294400     CALL 'EZACIC05'                                              29440000
294500          USING  DP081-TOEBCDIC-TOKEN                             29450000
294600                 TCP-BUF-AREA                                     29460000
294700                 DP081-TCPLENG.                                   29470000
294800* END OF TRANSLATE ASCII TO EBCDIC                                29480000
294900                                                                  29490000
295000                                                                  29500000
295100 8300-SEND-ERROR-CONFIRM-QNX.                                     29510000
295200                                                                  29520000
295300     IF  PS-SHOW-DEBUG-INFO                                       29530000
295400         STRING ' 8300-SEND-ERROR-CONFIRM-QNX'  DELIMITED BY SIZE 29540000
295500                                           INTO PV-CICS-MSG-AREA  29550000
295600         PERFORM 9990-WRITE-CICS                                  29560000
295700     END-IF.                                                      29570000
295800                                                                  29580000
295900     MOVE SPACES                      TO TCP-BUF-AREA.            29590007
296000     MOVE ';'                         TO PC185-CFM-TERM-CHAR.     29600007
296100     MOVE PC185-SML-UPLOAD-RECORD     TO TCP-BUF-AREA.            29610007
296200     MOVE PC185-DL-ERROR              TO DP081-NBR-BYTES          29620000
296300                                         DP081-TCPLENG            29630000
296400                                         PV-DISP-NBR.             29640007
296500                                                                  29650000
296600     IF  PS-SHOW-DEBUG-INFO                                       29660000
296700         STRING ' TCP-BUF-AREA=' TCP-BUF-AREA                     29670000
296800                ' DP081-NBR-BYTES= '                              29680000
296900                  PV-DISP-NBR              DELIMITED BY SIZE      29690000
297000                                          INTO PV-CICS-MSG-AREA   29700000
297100         PERFORM 9990-WRITE-CICS                                  29710000
297200     END-IF.                                                      29720000
297300                                                                  29730000
297400* TRANSLATE EBCDIC TO ASCII                                       29740000
297500     CALL 'EZACIC04'                                              29750000
297600         USING  DP081-TOASCII-TOKEN                               29760000
297700                TCP-BUF-AREA                                      29770000
297800                DP081-TCPLENG.                                    29780000
297900                                                                  29790000
298000* WRITE DATA ON A CONNECTED SOCKET                                29800000
298100     CALL 'EZASOKET'                                              29810000
298200         USING                                                    29820000
298300                DP081-WRITE-CMD                                   29830000
298400                DP081-SOCK-ID                                     29840000
298500                DP081-NBR-BYTES                                   29850000
298600                TCP-BUF-AREA                                      29860000
298700                DP081-ERRNO                                       29870000
298800                DP081-RETCODE.                                    29880000
298900                                                                  29890000
299000     MOVE DP081-RETCODE               TO PV-DISP-RETCODE.         29900007
299100     MOVE DP081-ERRNO                 TO PV-ERRNO.                29910007
299200                                                                  29920000
299300     IF  PS-SHOW-DEBUG-INFO                                       29930000
299400         STRING  ' DP081-RETCODE= '  PV-DISP-RETCODE              29940000
299500                 ' DP081-ERRNO  = '  PV-ERRNO                     29950000
299600                                          DELIMITED BY SIZE       29960000
299700                                     INTO PV-CICS-MSG-AREA        29970000
299800         PERFORM 9990-WRITE-CICS                                  29980000
299900     END-IF.                                                      29990000
300000                                                                  30000000
300100     IF DP081-RETCODE < ZERO                                      30010000
300200         SET PS-ERRORS-YES            TO TRUE                     30020000
300300         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    30030000
300400         SET  DP081-TCP-IP-SEND-TO-ERR                            30040000
300500                                      TO TRUE                     30050000
300600         MOVE DP081-ERRNO             TO DP081-TCP-IP-ERR-NBR     30060000
300700         STRING ' DP081-ERRNO= ' PV-ERRNO                         30070000
300800             DELIMITED BY SIZE                                    30080000
300900             INTO PV-CICS-MSG-AREA                                30090000
301000         PERFORM 9990-WRITE-CICS                                  30100000
301100                                                                  30110000
301200     END-IF.                                                      30120000
301300/                                                                 30130000
301400*----------------------------------------------------------------*30140000
301500*    CLOSE THE SOCKET GIVEN TO US BY THE PACK TO LIGHT SYSTEM.   *30150000
301600*----------------------------------------------------------------*30160000
301700 8400-CLOSE-SOCKET.                                               30170000
301800                                                                  30180000
301900     IF  PS-SHOW-DEBUG-INFO                                       30190000
302000         STRING ' 8400-CLOSE-SOCKET' DELIMITED BY SIZE            30200000
302100                                INTO PV-CICS-MSG-AREA             30210000
302200         PERFORM 9990-WRITE-CICS                                  30220000
302300     END-IF.                                                      30230000
302400                                                                  30240000
302500* CLOSE THE CONNECTED SOCKET                                      30250000
302600     IF PS-SOCKET-OPEN                                            30260000
302700         SET PS-SOCKET-CLOSED         TO TRUE                     30270000
302800         CALL 'EZASOKET'                                          30280000
302900             USING                                                30290000
303000                DP081-CLOSE-CMD                                   30300000
303100                DP081-SOCK-ID                                     30310000
303200                DP081-ERRNO                                       30320000
303300                DP081-RETCODE                                     30330000
303400                                                                  30340000
303500         IF  PS-SHOW-DEBUG-INFO                                   30350000
303600             MOVE DP081-RETCODE           TO PV-DISP-RETCODE      30360000
303700             MOVE DP081-ERRNO             TO PV-ERRNO             30370000
303800             STRING ' DP081-RETCODE= ' PV-DISP-RETCODE            30380000
303900                    ' DP081-ERRNO  = '  PV-ERRNO                  30390000
304000                                             DELIMITED BY SIZE    30400000
304100                                        INTO PV-CICS-MSG-AREA     30410000
304200             PERFORM 9990-WRITE-CICS                              30420000
304300         END-IF                                                   30430000
304400                                                                  30440000
304500         IF DP081-RETCODE < ZERO                                  30450000
304600         SET PS-ERRORS-YES            TO TRUE                     30460000
304700         MOVE PC-CURRENT-PROGRAM-NAME TO DP081-TCP-IP-PGM-NAME    30470000
304800         SET  DP081-TCP-IP-CLOSE-ERR  TO TRUE                     30480000
304900         MOVE DP081-ERRNO             TO DP081-TCP-IP-ERR-NBR     30490000
305000         STRING ' DP081-ERRNO= ' PV-ERRNO                         30500000
305100             DELIMITED BY SIZE                                    30510000
305200             INTO PV-CICS-MSG-AREA                                30520000
305300         PERFORM 9990-WRITE-CICS                                  30530000
305400         END-IF                                                   30540000
305500     END-IF.                                                      30550000
305600/                                                                 30560000
305700 9900-SOFT-ABORT.                                                 30570000
305800                                                                  30580000
305900     SET PS-ERRORS-YES                TO TRUE.                    30590007
306000                                                                  30600000
306100     IF  PS-SHOW-DEBUG-INFO                                       30610000
306200         STRING ' 9000-SOFT-ABORT'       DELIMITED BY SIZE        30620000
306300                                    INTO PV-CICS-MSG-AREA         30630000
306400         PERFORM 9990-WRITE-CICS                                  30640000
306500     END-IF.                                                      30650000
306600                                                                  30660000
306700     PERFORM 9950-ROLLBACK.                                       30670000
306800                                                                  30680000
306900     PERFORM 7000-INSERT-TUPLDER.                                 30690000
307000                                                                  30700000
307100     SET PC185-ERROR                  TO TRUE.                    30710007
307200     PERFORM 9920-ALS-ERROR.                                      30720000
307300                                                                  30730000
307400 9910-USER-ERROR.                                                 30740000
307500                                                                  30750000
307600     SET PS-ERRORS-YES                TO TRUE.                    30760007
307700                                                                  30770000
307800     IF  PS-SHOW-DEBUG-INFO                                       30780000
307900         STRING ' 9910-USER-ERROR'       DELIMITED BY SIZE        30790000
308000                                    INTO PV-CICS-MSG-AREA         30800000
308100         PERFORM 9990-WRITE-CICS                                  30810000
308200     END-IF.                                                      30820000
308300                                                                  30830000
308400     PERFORM 9950-ROLLBACK.                                       30840000
308500     PERFORM 7000-INSERT-TUPLDER.                                 30850000
308600                                                                  30860000
308700* DMH - 02/11/04 - BEGIN                                          30870000
308800* ADDED THIS PERFORM SO THAT WE CONTINUE TO RECEIVE THE DATA      30880000
308900* BEING SENT FROM PACK-TO-LIGHT UNTIL WE RECEIVE ALL THE RECORDS  30890000
309000* AL DOES NOT RECOGNIZE OUR CONFIRMATION UNTIL AFTER THEY ARE     30900000
309100* DONE SENDING ALL OF THE DATA RECORDS                            30910000
309200     SET  PS-ABEND-LOOP  TO  TRUE.                                30920007
309300     PERFORM 8000-RECEIVE-SOCKET                                  30930000
309400       UNTIL PC185-TRAILER                                        30940000
309500          OR DP081-TCP-IP-READ-ERR                                30950000
309600          OR PV-ABEND-COUNT  >  3000.                             30960000
309700* DMH - 11/21/03 - END                                            30970000
309800                                                                  30980000
309900     INITIALIZE PC185-SML-UPLOAD-RECORD.                          30990007
310000     MOVE PV-HOLD-SML-NBR             TO PC185-CFM-SML-NBR.       31000007
310100     SET PC185-SUCCESSFUL             TO TRUE.                    31010007
310200     MOVE ';'                         TO PC185-CFM-TERM-CHAR.     31020007
310300                                                                  31030000
310400     IF  PS-SHOW-DEBUG-INFO                                       31040000
310500         STRING ' PC185-SML-UPLOAD-RECORD '  DELIMITED BY SIZE    31050000
310600                                        INTO PV-CICS-MSG-AREA     31060000
310700         PERFORM 9990-WRITE-CICS                                  31070000
310800                                                                  31080000
310900         STRING ' ' PC185-SML-UPLOAD-RECORD DELIMITED BY SIZE     31090000
311000                                       INTO PV-CICS-MSG-AREA      31100000
311100         PERFORM 9990-WRITE-CICS                                  31110000
311200     END-IF.                                                      31120000
311300                                                                  31130000
311400     PERFORM 8300-SEND-ERROR-CONFIRM-QNX.                         31140007
311500     PERFORM 8400-CLOSE-SOCKET.                                   31150000
311600     SET PS-DUMP-TO-LOG               TO TRUE.                    31160000
311700     PERFORM 9990-WRITE-CICS.                                     31170000
311800                                                                  31180000
311900 9915-REUSE-SML-ERROR.                                            31190000
312000                                                                  31200000
312100     STRING ' 9915-REUSE-SML-ERROR'                               31210000
312200         DELIMITED BY SIZE                                        31220000
312300         INTO PV-CICS-MSG-AREA.                                   31230007
312400     PERFORM 9990-WRITE-CICS.                                     31240007
312500                                                                  31250000
312600     PERFORM 7000-INSERT-TUPLDER.                                 31260000
312700                                                                  31270000
312800 9920-ALS-ERROR.                                                  31280000
312900                                                                  31290000
313000     IF  PS-SHOW-DEBUG-INFO                                       31300000
313100         STRING ' 9920-ALS-ERROR'        DELIMITED BY SIZE        31310000
313200                                    INTO PV-CICS-MSG-AREA         31320000
313300         PERFORM 9990-WRITE-CICS                                  31330000
313400     END-IF.                                                      31340000
313500                                                                  31350000
313600     PERFORM 9950-ROLLBACK.                                       31360000
313700     PERFORM 7000-INSERT-TUPLDER.                                 31370000
313800                                                                  31380000
313900     INITIALIZE PC185-SML-UPLOAD-RECORD.                          31390007
314000     MOVE PV-HOLD-SML-NBR             TO PC185-CFM-SML-NBR.       31400007
314100     SET PC185-ERROR                  TO TRUE.                    31410007
314200     MOVE ';'                         TO PC185-CFM-TERM-CHAR.     31420007
314300     PERFORM 8300-SEND-ERROR-CONFIRM-QNX.                         31430007
314400     PERFORM 8400-CLOSE-SOCKET.                                   31440007
314500     SET PS-ERRORS-YES                TO TRUE.                    31450000
314600     SET PS-DUMP-TO-LOG               TO TRUE.                    31460000
314700     PERFORM 9990-WRITE-CICS.                                     31470000
314800                                                                  31480000
314900 9950-ROLLBACK.                                                   31490000
315000                                                                  31500000
315100     IF  PS-SHOW-DEBUG-INFO                                       31510000
315200         STRING ' 9950-ROLLBACK'        DELIMITED BY SIZE         31520000
315300                                   INTO PV-CICS-MSG-AREA          31530000
315400         PERFORM 9990-WRITE-CICS                                  31540000
315500     END-IF.                                                      31550000
315600                                                                  31560000
315700     EXEC CICS SYNCPOINT                                          31570000
315800         ROLLBACK                                                 31580000
315900     END-EXEC.                                                    31590000
316000                                                                  31600000
316100 9955-SQL-ERROR.                                                  31610000
316200                                                                  31620000
316300     SET PS-ERRORS-YES                TO TRUE.                    31630007
316400     MOVE SQLCODE                     TO PV-SQLCODE.              31640007
316500     STRING ' PCKCS723 -'                                         31650000
316600            ' SQLCODE = ' PV-SQLCODE                              31660000
316700            ' TABLE(S) = '                                        31670000
316800            PV-DISP-TABLE-1 ' '                                   31680000
316900            PV-DISP-TABLE-2 ' '                                   31690000
317000            PV-DISP-TABLE-3             DELIMITED BY SIZE         31700000
317100                                   INTO PV-CICS-MSG-AREA.         31710007
317200     PERFORM 9990-WRITE-CICS.                                     31720000
317300                                                                  31730000
317400     STRING ' PCKCS723 -'                                         31740000
317500            ' DK-TIMESTAMP = '                                    31750000
317600            DK-TIMESTAMP               DELIMITED BY SIZE          31760000
317700                                   INTO PV-CICS-MSG-AREA.         31770007
317800     PERFORM 9990-WRITE-CICS.                                     31780000
317900                                                                  31790000
318000     CALL 'DSNTIAR' USING SQLCA                                   31800000
318100                          DP004-FORMATTED-MESSAGE                 31810000
318200                          DP004-ERROR-LINE-LENGTH.                31820000
318300                                                                  31830000
318400     MOVE DP004-ASTERISK-LINE         TO PV-CICS-MSG-AREA.        31840007
318500     PERFORM 9990-WRITE-CICS.                                     31850007
318600                                                                  31860000
318700     PERFORM                                                      31870000
318800         VARYING DP004-MSG-IDX                                    31880000
318900         FROM 1 BY 1                                              31890000
319000         UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES            31900000
319100              MOVE DP004-MESSAGE-LINE (DP004-MSG-IDX)             31910000
319200                                      TO PV-CICS-MSG-AREA         31920000
319300              PERFORM 9990-WRITE-CICS                             31930000
319400                                                                  31940000
319500     END-PERFORM.                                                 31950000
319600                                                                  31960000
319700 9990-WRITE-CICS.                                                 31970000
319800                                                                  31980000
319900* IF YOU'RE AT THE LAST OCCURRENCE OF THE TABLE,                  31990000
320000* THE NEXT MESSAGE WILL GO INTO THE FIRST OCCURRENCE.  KEEP       32000000
320100* INCREMENTING THE SEQUENCE SO THAT IF THE TABLE IS DUMPED TO THE 32010000
320200* LOG YOU WILL BE ABLE TO SEE THE LAST 200 LINES AND HOW THEY     32020000
320300* WRAPPED AROUND.                                                 32030000
320400                                                                  32040000
320500     EVALUATE TRUE                                                32050000
320600     WHEN PT-MSG-IDX < PC-MSG-TABLE-SIZE                          32060000
320700         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 32070000
320800         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         32080000
320900         SET PT-MSG-IDX UP BY 1                                   32090000
321000     WHEN PT-MSG-IDX = PC-MSG-TABLE-SIZE                          32100000
321100         MOVE PV-CICS-MSG-AREA        TO PT-MSG-LINE (PT-MSG-IDX) 32110000
321200         MOVE PT-MSG-SEQ (PT-MSG-IDX) TO PV-PREV-SEQUENCE         32120000
321300         SET PT-MSG-IDX               TO 1                        32130000
321400     END-EVALUATE.                                                32140007
321500                                                                  32150000
321600     COMPUTE PV-NEXT-SEQUENCE = PV-PREV-SEQUENCE + 1.             32160007
321700     MOVE PV-NEXT-SEQUENCE            TO PT-MSG-SEQ (PT-MSG-IDX). 32170007
321800                                                                  32180000
321900                                                                  32190000
322000*  IF THE DC HAS TRACE PROCESSING TURNED ON, ALL MESSAGES WILL    32200000
322100*  BE DISPLAYED AS THEY OCCUR.  DUMPING THE MESSAGE TABLE WILL    32210000
322200*  BE UNNECESSARY BECAUSE OF THE REAL-TIME DISPLAYS.              32220000
322300*                                                                 32230000
322400     IF PS-SHOW-DEBUG-INFO                                        32240000
322500         PERFORM 9991-WRITEQ                                      32250000
322600     END-IF.                                                      32260007
322700     MOVE SPACES                      TO PV-CICS-MSG-AREA.        32270000
322800                                                                  32280000
322900 9991-WRITEQ.                                                     32290000
323000     EXEC CICS                                                    32300000
323100         WRITEQ TD                                                32310000
323200         QUEUE(PC-LOG-QUEUE)                                      32320000
323300         FROM(PV-CICS-MSG-AREA)                                   32330000
323400         RESP(PV-CICS-RESPONSE)                                   32340000
323500     END-EXEC.                                                    32350000
323600                                                                  32360000
323700 9999-FINAL-DUMP.                                                 32370000
323800*  IF AN ERROR HAS OCCURRED, DUMP THE MESSAGE TABLE WHICH WILL    32380000
323900*  CONTAIN THE LAST 200 TRACE DISPLAYS.  IF THE TABLE EVER        32390000
324000*  OVERFLOW, YOU WILL SEE THE SEQUENCE NUMBERS WRAP.  UNUSED      32400000
324100*  OCCRENCES ARE NOT DISPLAYED.                                   32410000
324200*                                                                 32420000
324300                                                                  32430000
324400     STRING ' 9999-FINAL-DUMP'                                    32440000
324500         DELIMITED BY SIZE                                        32450000
324600         INTO PV-CICS-MSG-AREA.                                   32460007
324700     PERFORM 9990-WRITE-CICS.                                     32470007
324800                                                                  32480000
324900         EXEC CICS ENQ                                            32490000
325000             RESOURCE(PC-LOG-QUEUE)                               32500000
325100         END-EXEC.                                                32510007
325200                                                                  32520000
325300         MOVE PV-TASK                 TO PV-DISP-TASK.            32530007
325400         PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL             32540000
325500                         PT-MSG-IDX > PC-MSG-TABLE-SIZE           32550000
325600             IF PT-MSG-SEQ (PT-MSG-IDX) > ZERO                    32560000
325700                 MOVE PT-MSG-SEQ (PT-MSG-IDX)                     32570000
325800                                      TO PV-DISP-MSG-NBR          32580000
325900                 STRING ' ' PV-DISP-TASK ' '                      32590000
326000                      PV-DISP-MSG-NBR ' '                         32600000
326100                      PT-MSG-LINE (PT-MSG-IDX)                    32610000
326200                      DELIMITED BY SIZE                           32620000
326300                                    INTO PV-CICS-MSG-AREA         32630000
326400                 PERFORM 9991-WRITEQ                              32640000
326500             END-IF                                               32650000
326600         END-PERFORM.                                             32660007
326700                                                                  32670000
326800         SET PT-MSG-IDX               TO 1.                       32680007
326900         SET PS-DONT-DUMP-TO-LOG      TO TRUE.                    32690007
327000                                                                  32700000
327100         EXEC CICS DEQ                                            32710000
327200             RESOURCE(PC-LOG-QUEUE)                               32720000
327300         END-EXEC.                                                32730000
327400                                                                  32740000
