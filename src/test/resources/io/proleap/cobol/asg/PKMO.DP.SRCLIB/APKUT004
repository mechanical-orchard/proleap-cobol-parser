000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.     APKUT004.                                        00020001
000300 AUTHOR.         DAVE COLOMBO  COMPUWARE.                         00030001
000400 DATE-WRITTEN.   MARCH 1999.                                      00040001
000500 DATE-COMPILED.                                                   00050001
000600***************************************************************** 00060001
000700*   JOURNALIZED RECEIPT EXTRACT REFORMAT FOR GL INTERFACE       * 00070001
000800*                                                               * 00080001
000900*   COBOL390 WITH SQL                                           * 00090001
001000*                                                               * 00100001
001100*  THIS PROGRAM WILL EXTRACT THE TOTAL COST OF JOURNALIZED      * 00110001
001200*  RECEIPTS FOR THE FISCAL WEEK BEING PROCESSED AND CREATE      * 00120001
001300*  ENTRIES TO BE INTERFACED TO THE GL. THE EXTRACT WILL SELECT  * 00130001
001400*  THE SUM OF THE COST ON THE VERIFIED RECEIPTS THAT INDICATE   * 00140001
001500*  THEY WERE JOURNALIZED DURING THE WEEK. TWO GL INTERFACE      * 00150001
001600*  RECORDS WILL BE CREATED. ONE TO DEBIT THE UNJOURNALIZED      * 00160001
001700*  RECEIPTS ACCOUNT AND ONE TO CREDIT THE AP TRADE ACCOUNT.     * 00170001
001800*                                                               * 00180001
001900* INPUT:                                                        * 00190001
002000*  1. DATE CONTROL CARD                                         * 00200001
002100*                                                               * 00210001
002200* DB2:                                                          * 00220001
002300*  1. PO-PURCHASE ITEM TABLE                      (TPURITM)     * 00230001
002400*  2. RC-RECEIPT DISTRIBUTION TABLE               (TRECDIS)     * 00240001
002500*  3. RC-RECEIPT ITEM TABLE                       (TRECITM)     * 00250001
002510*  4. PURCHASE ORDER TABLE                        (TPURCHS)     * 00251001
002520*                                                               * 00252001
002530* OUTPUT:                                                       * 00253001
002540*  1. GL INTERFACE FILE                           (APRD012)     * 00254001
002550*                                                               * 00255001
002560***************************************************************** 00256001
002570* CHANGE LOG:                                                   * 00257001
002580* 03/24/99   INITIAL VERSION.                       WR 05998    * 00258001
002590*                                                               * 00259001
002600* 08/31/1999   JILL JUEL                            WR 05998    * 00260001
002700*    REMOVE SELECT TO GET THE TOTAL RECEIPTS COST AND REPLACE   * 00270001
002800*    WITH RECDIS_CSR AND POLINE_CSR. IN B200 ADD LOGIC TO BUMP  * 00280001
002900*    THE RECDIS_CSR WITH POLINE_CSR AND TOTAL THE JOURNALIZE    * 00290001
003000*    AMOUNT.                                                    * 00300001
003100*                                                               * 00310001
003200* 03/16/03   LISA SBRAGIA                           WR20704     * 00320001
003300*            VERSION 8 REQUIRED RECOMPILE AND CODE              * 00330001
003400*            WAS REQUIRED TO BE CHECKED OUT DUE TO PRODUCTION   * 00340001
003500*            TURNOVER ISSUES IN COORDINATION WITH UPGRADE.      * 00350001
003600*                                                               * 00360001
003700* 11/27/07   CHRISTINE TWIEHAUS                     WR32664     * 00370001
003800*     MODIFY PROGRAM TO USE THE FIRST COST IN PLACE OF THE UNIT * 00380001
003801*     COST DEPENDING ON THE PO TYPE.  CHANGE WAS NEEDED FOR THE * 00380101
003802*     PRIVATE LABEL ACCOUNTING PROJECT BECAUSE ON DOMESTIC      * 00380201
003803*     PRIVATE LABEL POS, THE UNIT COST INCLUDES A LOAD AMOUNT   * 00380301
003804*     WHICH SHOULD NOT BE INCLUDED IN THE AMOUNT MOVED FROM THE * 00380401
003805*     UNJOURNALIZED RECEIPT ACCOUNT TO THE AP TRADE ACCOUNT.    * 00380501
003806*     ADDED TABLE TPURCHS TO OBTAIN PO TYPE CODE.               * 00380601
003807*                                                                *00380701
003808*DATE  08/26/2014                                                *00380801
003809*    CHANGE MADE: IN PARAGRAPH C100-CALCULATE-MONETARY-AMT, THE  *00380901
003810*    TOTAL RECEIPT VALUE IS CALCULATED FOR EACH PO USING EITHER  *00381001
003811*    THE FIRST COST OR THE UNIT COST, DEPENDING ON THE PO TYPE.  *00381101
003812*    WITH THE DEPLOY OF RMS13, CD POS NEED TO CHANGE TO USE THE  *00381201
003813*    FIRST COST, AS IT IS NO LONGER FORCED TO MATCH THE UNIT COST*00381301
003814*    MADE BY: NANCY EILBES            WR/IR #: CHG0090700        *00381401
003815*                                                                *00381501
003816*DATE  09/12/2019                                                *00381601
003817*    CHANGE MADE: MODIFIED THE OFFSET ACCOUNT NUMBER FROM 20118  *00381701
003818*    TO 20115.  THIS NEW ACCOUNT WAS ESTABLISHED FOR ERP GO LIVE *00381801
003819*    AS THE AP CLEARING ACCOUNT.                                 *00381901
003820*    MADE BY: NANCY EILBES            WR/IR #: CHG0231367        *00382001
003821*                                                                *00382101
003822*DATE  10/02/2019                                                *00382201
003823*    CHANGE MADE: RENAMED PROGRAM APKUT004.  RENAMED COPYBOOK    *00382301
003824*    GLRD002 TO APRD012.  THESE CHANGES WERE MADE TO MIGRATE     *00382401
003825*    THIS PROCESS TO MAKE IT PART OF LEGACY ACCOUNTS PAYABLE     *00382501
003826*    SYSTEM SO MAINFRAME GL SYSTEM ID CAN BE ELIMINATED.         *00382601
003827*    MADE BY: NANCY EILBES            WR/IR #: CHG0??????        *00382701
003828*                                                                *00382801
003829*----------------------------------------------------------------*00382901
003830                                                                  00383001
003831 ENVIRONMENT DIVISION.                                            00383101
003832 CONFIGURATION SECTION.                                           00383201
003833 SOURCE-COMPUTER.    IBM-3090.                                    00383301
003834 OBJECT-COMPUTER.    IBM-3090.                                    00383401
003835                                                                  00383501
003836 INPUT-OUTPUT SECTION.                                            00383601
003837 FILE-CONTROL.                                                    00383701
003840     SELECT GL-INTERFACE-FILE             ASSIGN TO UT-S-OUT01.   00384001
003850                                                                  00385001
003860 DATA DIVISION.                                                   00386001
003870 FILE SECTION.                                                    00387001
003880                                                                  00388001
003890 FD  GL-INTERFACE-FILE                                            00389001
003900     RECORDING MODE IS F                                          00390001
004000     LABEL RECORDS ARE STANDARD                                   00400001
004100     DATA RECORD IS GL-INTERFACE-REC.                             00410001
004200 01  GL-INTERFACE-REC            PIC  X(180).                     00420001
004300                                                                  00430001
004400 WORKING-STORAGE SECTION.                                         00440001
004500                                                                  00450001
004600 01  PC-PROGRAM-CONSTANTS.                                        00460001
004700     05  FILLER                  PIC  X(30)  VALUE                00470001
004800         '** BEGINING OF APKUT004 W/S **'.                        00480001
004900                                                                  00490001
005000     05  PC-PROGRAM-NAME         PIC  X(08)     VALUE 'APKUT004'. 00500001
005100     05  PC-JOURNALIZED-RCPTS.                                    00510001
005200         10  FILLER              PIC  X(20)     VALUE             00520001
005300             'JOURNALIZED RECEIPT '.                              00530001
005400         10  PC-VRFD-RCPTS-DTE   PIC  X(10)     VALUE SPACES.     00540001
005500                                                                  00550001
005600 01  PV-PROGRAM-VARIABLES.                                        00560001
005700     05  PV-CURRENT-DATE.                                         00570001
005800         10  PV-CURRENT-CCYY     PIC  9(04)     VALUE ZEROS.      00580001
005900         10  PV-CURRENT-MONTH    PIC  9(02)     VALUE ZEROS.      00590001
006000         10  PV-CURRENT-DAY      PIC  9(02)     VALUE ZEROS.      00600001
006100     05  PV-DISPLAY-DATE.                                         00610001
006200         10  PV-DISPLAY-MONTH    PIC  9(02)     VALUE ZEROS.      00620001
006300         10  FILLER              PIC  X(01)     VALUE '-'.        00630001
006400         10  PV-DISPLAY-DAY      PIC  9(02)     VALUE ZEROS.      00640001
006500         10  FILLER              PIC  X(01)     VALUE '-'.        00650001
006600         10  PV-DISPLAY-CCYY     PIC  9(04)     VALUE ZEROS.      00660001
006700     05  PV-RUN-DTE-CYMD.                                         00670001
006800         10  PV-RUN-DTE-CC       PIC  X(02)     VALUE SPACES.     00680001
006900         10  PV-RUN-DTE-YY       PIC  X(02)     VALUE SPACES.     00690001
007000         10  PV-RUN-DTE-MM       PIC  X(02)     VALUE SPACES.     00700001
007100         10  PV-RUN-DTE-DD       PIC  X(02)     VALUE SPACES.     00710001
007200     05  PV-START-DTE            PIC  X(10)     VALUE SPACES.     00720001
007300     05  PV-END-DTE              PIC  X(10)     VALUE SPACES.     00730001
007400     05  PV-RCPTS-AMT            PIC S9(15)V99  VALUE ZEROS       00740001
007500                                                COMP-3.           00750001
007600     05  PV-RCPTS-COST           PIC S9(15)V999 VALUE ZEROS       00760001
007700                                                COMP-3.           00770001
007800     05  PV-OUT-COST             PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.    00780001
007900     05  PV-OUT-AMT              PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99-.     00790001
008000     05  PV-SUMMED-ITM-QTY       PIC S9(9)      COMP.             00800001
008100                                                                  00810001
008200 01  HOLD-FIELDS.                                                 00820001
008300     05  HOLD-ORD-NBR            PIC S9(9)      VALUE 0 COMP.     00830001
008400                                                                  00840001
008500 01  PV-COUNTERS.                                                 00850001
008600     05  PV-RETRY-COUNTER        PIC S9(04)     COMP.             00860001
008700     05  PV-COUNT-STOREEXT       PIC  9(07)     COMP-3.           00870001
008800     05  PV-COUNT-APRD012        PIC  9(07)     COMP-3.           00880001
008900                                                                  00890001
009000 01  PS-PROGRAM-SWITCHES.                                         00900001
009100     05  PS-END-OF-RECDIS-CSR    PIC X(01)      VALUE 'N'.        00910001
009200         88  NOT-END-OF-RECDIS-CSR              VALUE 'N'.        00920001
009300         88  END-OF-RECDIS-CSR                  VALUE 'Y'.        00930001
009400     05  PS-END-OF-POLINE-CSR    PIC X(01)      VALUE 'N'.        00940001
009500         88  NOT-END-OF-POLINE-CSR              VALUE 'N'.        00950001
009600         88  END-OF-POLINE-CSR                  VALUE 'Y'.        00960001
009700     05  PS-NEW-ORD-NBR          PIC X(01)      VALUE 'N'.        00970001
009800         88  NEW-ORD-NBR                        VALUE 'N'.        00980001
009900         88  SAME-ORD-NBR                       VALUE 'Y'.        00990001
010000                                                                  01000001
010100                                                                  01010001
010200*----------------------------------------------------------------*01020001
010300*  COMMUNICATIONS AREA2 FOR DB2                                  *01030001
010400*----------------------------------------------------------------*01040001
010500     COPY SQLCA2.                                                 01050001
010600                                                                  01060001
010700     EXEC SQL                                                     01070001
010800          INCLUDE SQLCA                                           01080001
010900     END-EXEC.                                                    01090001
011000                                                                  01100001
011100*----------------------------------------------------------------*01110001
011200*  PO-PURCHASE ITEM TABLE                                        *01120001
011300*----------------------------------------------------------------*01130001
011400     EXEC SQL                                                     01140001
011500          INCLUDE TPURITM                                         01150001
011600     END-EXEC.                                                    01160001
011700                                                                  01170001
011800*----------------------------------------------------------------*01180001
011900*  PO-PURCHASE ORDER TABLE                                       *01190001
012000*----------------------------------------------------------------*01200001
012100     EXEC SQL                                                     01210001
012200          INCLUDE TPURCHS                                         01220001
012300     END-EXEC.                                                    01230001
012400                                                                  01240001
012500*----------------------------------------------------------------*01250001
012600*  RC-RECEIPT DISTRIBUTION TABLE                                 *01260001
012700*----------------------------------------------------------------*01270001
012800     EXEC SQL                                                     01280001
012900          INCLUDE TRECDIS                                         01290001
013000     END-EXEC.                                                    01300001
013100                                                                  01310001
013200*----------------------------------------------------------------*01320001
013300*  RC-RECEIPT ITEM TABLE                                         *01330001
013400*----------------------------------------------------------------*01340001
013500     EXEC SQL                                                     01350001
013600          INCLUDE TRECITM                                         01360001
013700     END-EXEC.                                                    01370001
013800                                                                  01380001
013900*----------------------------------------------------------------*01390001
014000*  RECDIS CURSOR                                                 *01400001
014100*----------------------------------------------------------------*01410001
014200     EXEC SQL                                                     01420001
014300         DECLARE RECDIS_CSR CURSOR FOR                            01430001
014400             SELECT ORD_NBR                                       01440001
014500                  , REC_SEQ_NBR                                   01450001
014600                  , ORD_LNE_NBR                                   01460001
014700                  , SUM(AP_VERIFY_ITM_QTY)                        01470001
014800               FROM TRECDIS                                       01480001
014900              WHERE AP_PRC_CDE IN ('J','W')                       01490001
015000                AND VER_STATUS_CDE = 'A'                          01500001
015100                AND AP_PRC_DTE BETWEEN :PV-START-DTE              01510001
015200                                   AND :PV-END-DTE                01520001
015300              GROUP BY ORD_NBR                                    01530001
015400                     , REC_SEQ_NBR                                01540001
015500                     , ORD_LNE_NBR                                01550001
015600              ORDER BY ORD_NBR                                    01560001
015700                     , REC_SEQ_NBR                                01570001
015800                     , ORD_LNE_NBR                                01580001
015900     END-EXEC.                                                    01590001
016000*----------------------------------------------------------------*01600001
016100*  POLINE CURSOR                                                 *01610001
016200*----------------------------------------------------------------*01620001
016300     EXEC SQL                                                     01630001
016400         DECLARE POLINE_CSR CURSOR FOR                            01640001
016500             SELECT PI.APP_PO_LNE_NBR                             01650001
016600                  , PI.UNT_COST_AMT                               01660001
016700                  , RI.REC_SEQ_NBR                                01670001
016800                  , PI.PRD_1ST_COST_AMT                           01680001
016900               FROM TPURITM PI                                    01690001
017000                  , TRECITM RI                                    01700001
017100              WHERE PI.PO_NBR = :RECDIS-ORD-NBR                   01710001
017200                AND PI.PO_NBR = RI.ORD_NBR                        01720001
017300                AND PI.VER_NBR = RI.PO_VER_NBR                    01730001
017400                AND PI.APP_PO_LNE_NBR = RI.ORD_LNE_NBR            01740001
017500                AND RI.VER_STATUS_CDE = 'A'                       01750001
017600              ORDER BY RI.REC_SEQ_NBR                             01760001
017700                     , PI.APP_PO_LNE_NBR                          01770001
017800     END-EXEC.                                                    01780001
017900*----------------------------------------------------------------*01790001
018000*  CONTROL CARD RECORD LAYOUT                                    *01800001
018100*----------------------------------------------------------------*01810001
018200 01  CONTROL-CARD-RECORD.                                         01820001
018300     05  CC-RUN-DTE.                                              01830001
018400         10  CC-RUN-DTE-CC       PIC  X(02).                      01840001
018500         10  CC-RUN-DTE-YY       PIC  X(02).                      01850001
018600         10  FILLER              PIC  X(01).                      01860001
018700         10  CC-RUN-DTE-MM       PIC  X(02).                      01870001
018800         10  FILLER              PIC  X(01).                      01880001
018900         10  CC-RUN-DTE-DD       PIC  X(02).                      01890001
019000     05  FILLER                  PIC  X(70).                      01900001
019100                                                                  01910001
019200*----------------------------------------------------------------*01920001
019300*  GENERAL LEDGER INTERFACE FILE                                 *01930001
019400*----------------------------------------------------------------*01940001
019500     COPY APRD012.                                                01950001
019600                                                                  01960001
019700*----------------------------------------------------------------*01970001
019800* WORKING STORAGE FOR DATE ROUTINE                               *01980001
019900*----------------------------------------------------------------*01990001
020000     COPY DPWS500.                                                02000001
020100                                                                  02010001
020200                                                                  02020001
020300*----------------------------------------------------------------*02030001
020400*  ABEND DATA AREAS                                              *02040001
020500*----------------------------------------------------------------*02050001
020600 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02060001
020700                                             COMP SYNC.           02070001
020800     88  AC-INVALID-CONTROL-CARD             VALUE +4003.         02080001
020900     88  AC-OPEN-ERROR                       VALUE +4005.         02090001
021000     88  AC-CLOSE-ERROR                      VALUE +4006.         02100001
021100     88  AC-DB2-ERROR                        VALUE +4013.         02110001
021200     88  AC-UNSUCCESSFUL-SELECT              VALUE +4015.         02120001
021300     88  AC-DATE-ERROR                       VALUE +4019.         02130001
021400                                                                  02140001
021500 01  ABEND-AREAS.                                                 02150001
021600     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02160001
021700             '*****       ABEND'.                                 02170001
021800     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02180001
021900             '*****   PROGRAM: APKUT004'.                         02190001
022000     05  AA-PARAGRAPH-LIT.                                        02200001
022100         10  FILLER              PIC  X(17)  VALUE                02210001
022200             '***** PARAGRAPH: '.                                 02220001
022300         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02230001
022400     05  AA-MESSAGE-LINE-1.                                       02240001
022500         10  FILLER              PIC  X(06)  VALUE '*****'.       02250001
022600         10  AA-MESSAGE-1        PIC  X(127) VALUE SPACES.        02260001
022700     05  AA-MESSAGE-LINE-2.                                       02270001
022800         10  FILLER              PIC  X(06)  VALUE '*****'.       02280001
022900         10  AA-MESSAGE-2        PIC  X(127) VALUE SPACES.        02290001
023000     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02300001
023100             '*****    DB2 ERROR'.                                02310001
023200     05  AA-DB2-OPERATION-LIT.                                    02320001
023300         10  FILLER              PIC  X(17)  VALUE                02330001
023400             '***** OPERATION: '.                                 02340001
023500         10  AA-DB2-OPERATION.                                    02350001
023600             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02360001
023700             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02370001
023800     05  AA-DB2-TABLE-1          PIC  X(18)  VALUE SPACES.        02380001
023900     05  AA-DB2-TABLE-2          PIC  X(18)  VALUE SPACES.        02390001
024000     05  AA-DB2-TABLE-3          PIC  X(18)  VALUE SPACES.        02400001
024100     05  AA-DB2-TABLE-4          PIC  X(18)  VALUE SPACES.        02410001
024200                                                                  02420001
024300     COPY DPWS004.                                                02430001
024400 01  FILLER                      PIC  X(25)  VALUE                02440001
024500     '** END OF APKUT004 W/S **'.                                 02450001
024600                                                                  02460001
024700 PROCEDURE DIVISION.                                              02470001
024800 A100-MAIN.                                                       02480001
024900                                                                  02490001
025000     PERFORM B100-HOUSEKEEPING.                                   02500001
025100                                                                  02510001
025200     PERFORM B200-PROCESS-JRNL-RECEIPTS.                          02520001
026000                                                                  02600001
026100     PERFORM B300-END-PROGRAM.                                    02610001
026200                                                                  02620001
026300     GOBACK.                                                      02630001
026400                                                                  02640001
026500                                                                  02650001
026600 B100-HOUSEKEEPING.                                               02660001
026700*----------------------------------------------------------------*02670001
026800*    INITIALIZATION PROCESS                                      *02680001
026900*----------------------------------------------------------------*02690001
027000                                                                  02700001
027100     MOVE FUNCTION CURRENT-DATE        TO PV-CURRENT-DATE.        02710001
027200     MOVE PV-CURRENT-CCYY              TO PV-DISPLAY-CCYY.        02720001
027300     MOVE PV-CURRENT-MONTH             TO PV-DISPLAY-MONTH.       02730001
027400     MOVE PV-CURRENT-DAY               TO PV-DISPLAY-DAY.         02740001
027500                                                                  02750001
027600     DISPLAY '** APKUT004 BEGIN PROCESSING ON '                   02760001
027700             PV-DISPLAY-DATE ' **'.                               02770001
027800                                                                  02780001
027900     OPEN OUTPUT GL-INTERFACE-FILE.                               02790001
028000                                                                  02800001
028100     INITIALIZE DCLTPURITM                                        02810001
028200                DCLTRECDIS                                        02820001
028300                DCLTRECITM                                        02830001
028400                DCLTPURCHS                                        02840001
028500                CONTROL-CARD-RECORD                               02850001
028600                AA-DB2-TABLE-1                                    02860001
028700                AA-DB2-TABLE-2                                    02870001
028800                AA-DB2-TABLE-3                                    02880001
028900                AA-DB2-TABLE-4                                    02890001
029000                PV-COUNTERS.                                      02900001
029100                                                                  02910001
029200     ACCEPT CONTROL-CARD-RECORD.                                  02920001
029300     IF CC-RUN-DTE > SPACES                                       02930001
029400         INSPECT CC-RUN-DTE REPLACING ALL '/' BY '-'              02940001
029500     ELSE                                                         02950001
029600         MOVE 'B100-INITIALIZE'        TO AA-PARAGRAPH-NAME       02960001
029700         MOVE 'INVALID RUN DATE'       TO AA-MESSAGE-1            02970001
029800         MOVE SPACES                   TO AA-MESSAGE-2            02980001
029900         SET AC-INVALID-CONTROL-CARD   TO TRUE                    02990001
030000         PERFORM Z999-ABEND                                       03000001
030100     END-IF.                                                      03010001
030200                                                                  03020001
030300     INITIALIZE DPG51                                             03030001
030400                DPG52                                             03040001
030500                DPG53                                             03050001
030600                DPG54                                             03060001
030700                DPG55                                             03070001
030800                DPG56.                                            03080001
030900                                                                  03090001
031000     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   03100001
031100     MOVE CC-RUN-DTE                   TO DPG52-LK-DATE-INPUT.    03110001
031200     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          03120001
031300                                                                  03130001
031400     IF DPG55-NUMERIC-WEEK-DAY-SAT                                03140001
031500         NEXT SENTENCE                                            03150001
031600     ELSE                                                         03160001
031700         MOVE 'B100-INITIALIZE'        TO AA-PARAGRAPH-NAME       03170001
031800         MOVE 'RUN DATE IS NOT A SATURDAY'                        03180001
031900                                       TO AA-MESSAGE-1            03190001
032000         MOVE CC-RUN-DTE               TO AA-MESSAGE-2            03200001
032100         SET AC-DATE-ERROR             TO TRUE                    03210001
032200         PERFORM Z999-ABEND                                       03220001
032300     END-IF.                                                      03230001
032400                                                                  03240001
032500     MOVE DPG55-1ST-WKDY-DB2ISO-FMT    TO PV-START-DTE.           03250001
032600     MOVE CC-RUN-DTE                   TO PV-END-DTE              03260001
032700                                          PC-VRFD-RCPTS-DTE.      03270001
032800     MOVE CC-RUN-DTE-CC                TO PV-RUN-DTE-CC.          03280001
032900     MOVE CC-RUN-DTE-YY                TO PV-RUN-DTE-YY.          03290001
033000     MOVE CC-RUN-DTE-MM                TO PV-RUN-DTE-MM.          03300001
033100     MOVE CC-RUN-DTE-DD                TO PV-RUN-DTE-DD.          03310001
033200*    DISPLAY CONTROL CARD INFO                                    03320001
033300     DISPLAY '** START DATE = ' PV-START-DTE.                     03330001
033400     DISPLAY '**   END DATE = ' PV-END-DTE.                       03340001
033500                                                                  03350001
033600     PERFORM Y100-OPEN-RECDIS-CSR.                                03360001
033700     PERFORM S100-FETCH-RECDIS-CSR.                               03370001
033800     SET SAME-ORD-NBR TO TRUE.                                    03380001
033900     PERFORM S300-SELECT-PO-TYPE-CDE.                             03390001
034000     PERFORM Y200-OPEN-POLINE-CSR.                                03400001
034100     PERFORM S200-FETCH-POLINE-CSR.                               03410001
034200                                                                  03420001
034300                                                                  03430001
034400 B200-PROCESS-JRNL-RECEIPTS.                                      03440001
034500*----------------------------------------------------------------*03450001
034600*    BUILD JOURNALIZED ENTRIES TO BE INTERFACED TO               *03460001
034700*    GENERAL LEDGER.                                             *03470001
034800*----------------------------------------------------------------*03480001
034900                                                                  03490001
035000     PERFORM C100-CALCULATE-MONETARY-AMT                          03500001
035100       UNTIL END-OF-RECDIS-CSR.                                   03510001
035200                                                                  03520001
035300     INITIALIZE AP012-GL-INTERFACE-TRN.                           03530001
035400     MOVE 'KDS'                      TO AP012-BUSINESS-UNIT.      03540001
035500     MOVE '20110'                    TO AP012-ACCOUNT.            03550001
035600     MOVE '90000'                    TO AP012-DEPTID.             03560001
035700     SET AP012-DONT-FORCE-SUSPENSE   TO TRUE.                     03570001
035800     MOVE '0900'                     TO AP012-LOCATION.           03580001
035900     MOVE PV-RUN-DTE-CYMD            TO AP012-TRN-EFF-CYMD.       03590001
036000     SET AP012-MONETARY-AMT-DR       TO TRUE.                     03600001
036100*    COMPUTE PV-RCPTS-AMT ROUNDED = (PV-RCPTS-COST * 1).          03610001
036200     MOVE PV-RCPTS-AMT               TO AP012-MONETARY-AMT.       03620001
036300     MOVE PC-JOURNALIZED-RCPTS       TO AP012-JRNL-LINE-DESC.     03630001
036400     PERFORM W100-WRITE-GL-INTERFACE.                             03640001
036500                                                                  03650001
036600     SET AP012-MONETARY-AMT-CR       TO TRUE.                     03660001
036700     MOVE '20115'                    TO AP012-ACCOUNT.            03670001
036800***  MOVE '20118'                    TO AP012-ACCOUNT.            03680001
036900     PERFORM W100-WRITE-GL-INTERFACE.                             03690001
037000                                                                  03700001
037100                                                                  03710001
037200 B300-END-PROGRAM.                                                03720001
037300*----------------------------------------------------------------*03730001
037400*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *03740001
037500*----------------------------------------------------------------*03750001
037600                                                                  03760001
037700*    MOVE PV-RCPTS-COST TO PV-OUT-COST.                           03770001
037800*    DISPLAY 'PV-RCPTS-COST = ' PV-OUT-COST.                      03780001
037900     MOVE PV-RCPTS-AMT               TO PV-OUT-AMT.               03790001
038000                                                                  03800001
038100     DISPLAY '*************************************************'. 03810001
038200     DISPLAY '************* APKUT004 SUMMARY ******************'. 03820001
038300     DISPLAY ' '.                                                 03830001
038400     DISPLAY '** GL INTERFACE RECS WRITTEN = ' PV-COUNT-APRD012.  03840001
038500     DISPLAY '** RECEIPTS COST AMOUNT = ' PV-OUT-AMT.             03850001
038600     DISPLAY ' '.                                                 03860001
038700     DISPLAY '** APKUT004 ENDING **'.                             03870001
038800     DISPLAY '*************************************************'. 03880001
038900                                                                  03890001
039000     PERFORM Y300-CLOSE-RECDIS-CSR.                               03900001
039100     CLOSE GL-INTERFACE-FILE.                                     03910001
039200                                                                  03920001
039300*----------------------------------------------------------------*03930001
039400*    FETCH RECDIS_CSR CURSOR                                     *03940001
039500*----------------------------------------------------------------*03950001
039600 C100-CALCULATE-MONETARY-AMT.                                     03960001
039700     IF END-OF-POLINE-CSR                                         03970001
039800         PERFORM Y400-CLOSE-POLINE-CSR                            03980001
039900         PERFORM Y200-OPEN-POLINE-CSR                             03990001
040000         PERFORM S200-FETCH-POLINE-CSR                            04000001
040100     ELSE                                                         04010001
040200         IF SAME-ORD-NBR                                          04020001
040300             IF RECDIS-REC-SEQ-NBR = RECITM-REC-SEQ-NBR           04030001
040400                 IF RECDIS-ORD-LNE-NBR = PURITM-APP-PO-LNE-NBR    04040001
040500                    IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'   04050001
040600****                                        OR 'CD'               04060001
040700                        COMPUTE PV-RCPTS-COST = (PV-SUMMED-ITM-QTY04070001
040800                           * PURITM-UNT-COST-AMT)     + .005      04080001
040900                    ELSE                                          04090001
041000                        COMPUTE PV-RCPTS-COST = (PV-SUMMED-ITM-QTY04100001
041100                           * PURITM-PRD-1ST-COST-AMT) + .005      04110001
041110                    END-IF                                        04111001
041120                    ADD PV-RCPTS-COST TO PV-RCPTS-AMT             04112001
041130                    PERFORM S100-FETCH-RECDIS-CSR                 04113001
041140                    PERFORM S200-FETCH-POLINE-CSR                 04114001
041150                 ELSE                                             04115001
041160                     IF RECDIS-ORD-LNE-NBR > PURITM-APP-PO-LNE-NBR04116001
041170                         PERFORM S200-FETCH-POLINE-CSR            04117001
041180                     ELSE                                         04118001
041190                         PERFORM S100-FETCH-RECDIS-CSR            04119001
041200                     END-IF                                       04120001
041300                 END-IF                                           04130001
041400             ELSE                                                 04140001
041500                 IF RECDIS-REC-SEQ-NBR > RECITM-REC-SEQ-NBR       04150001
041600                     PERFORM S200-FETCH-POLINE-CSR                04160001
041700                 ELSE                                             04170001
041800                     PERFORM S100-FETCH-RECDIS-CSR                04180001
041900                 END-IF                                           04190001
042000             END-IF                                               04200001
042100         ELSE                                                     04210001
042200             SET SAME-ORD-NBR TO TRUE                             04220001
042210             PERFORM S300-SELECT-PO-TYPE-CDE                      04221001
042220             PERFORM Y400-CLOSE-POLINE-CSR                        04222001
042230             PERFORM Y200-OPEN-POLINE-CSR                         04223001
042240             PERFORM S200-FETCH-POLINE-CSR                        04224001
042250         END-IF                                                   04225001
042260     END-IF.                                                      04226001
042270                                                                  04227001
042280*----------------------------------------------------------------*04228001
042290*    FETCH RECDIS_CSR CURSOR                                     *04229001
042300*    NOTE: COLUMN FUNCTION 'SUM' WILL NOT RETURN SQL CODE +100   *04230001
042400*          WHEN A ROW IS NOT FOUND. INSTEAD, IT RETURNS A -305   *04240001
042500*          AS A RESULT OF ATTEMPTING TO SUM NULL VALUES.         *04250001
042600*----------------------------------------------------------------*04260001
042700 S100-FETCH-RECDIS-CSR.                                           04270001
042800     EXEC SQL                                                     04280001
042900         FETCH RECDIS_CSR                                         04290001
043000          INTO :RECDIS-ORD-NBR                                    04300001
043100             , :RECDIS-REC-SEQ-NBR                                04310001
043200             , :RECDIS-ORD-LNE-NBR                                04320001
043300             , :PV-SUMMED-ITM-QTY                                 04330001
043400     END-EXEC.                                                    04340001
043500     EVALUATE TRUE                                                04350001
043600         WHEN SQLCODE = ZERO                                      04360001
043700              SET NOT-END-OF-RECDIS-CSR TO TRUE                   04370001
043800              IF RECDIS-ORD-NBR = HOLD-ORD-NBR                    04380001
043900                 SET SAME-ORD-NBR TO TRUE                         04390001
044000              ELSE                                                04400001
044100                 SET NEW-ORD-NBR TO TRUE                          04410001
044200                 MOVE RECDIS-ORD-NBR TO HOLD-ORD-NBR              04420001
044300              END-IF                                              04430001
044400         WHEN SQLCODE = +100                                      04440001
044500              SET END-OF-RECDIS-CSR TO TRUE                       04450001
044600         WHEN SQLCODE = -305                                      04460001
044700              MOVE ZEROES TO PV-SUMMED-ITM-QTY                    04470001
044800         WHEN OTHER                                               04480001
044900             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                04490001
045000             MOVE 'S100-FETCH-RECDIS-CSR'  TO AA-PARAGRAPH-NAME   04500001
045100             MOVE 'UNSUCCESSFUL FETCH '    TO AA-DB2-OPERATION    04510001
045200             MOVE 'RECDIS-CSR'             TO AA-DB2-TABLE-1      04520001
045300             MOVE SPACES                   TO AA-DB2-TABLE-2      04530001
045400             MOVE SPACES                   TO AA-DB2-TABLE-3      04540001
045500             PERFORM Z998-DB2-ABEND                               04550001
045600     END-EVALUATE.                                                04560001
045700*----------------------------------------------------------------*04570001
045800*    FETCH POLINE_CSR CURSOR                                     *04580001
045900*----------------------------------------------------------------*04590001
046000 S200-FETCH-POLINE-CSR.                                           04600001
046100     EXEC SQL                                                     04610001
046200         FETCH POLINE_CSR                                         04620001
046300          INTO :PURITM-APP-PO-LNE-NBR                             04630001
046400             , :PURITM-UNT-COST-AMT                               04640001
046500             , :RECITM-REC-SEQ-NBR                                04650001
046600             , :PURITM-PRD-1ST-COST-AMT                           04660001
046700     END-EXEC.                                                    04670001
046800     EVALUATE TRUE                                                04680001
046900         WHEN SQLCODE = ZERO                                      04690001
047000              SET NOT-END-OF-POLINE-CSR TO TRUE                   04700001
047100         WHEN SQLCODE = +100                                      04710001
047200              SET END-OF-POLINE-CSR TO TRUE                       04720001
047300         WHEN OTHER                                               04730001
047400             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                04740001
047500             MOVE 'S200-FETCH-POLINE-CSR'  TO AA-PARAGRAPH-NAME   04750001
047600             MOVE 'UNSUCCESSFUL FETCH '    TO AA-DB2-OPERATION    04760001
047700             MOVE 'POLINE-CSR'             TO AA-DB2-TABLE-1      04770001
047800             MOVE SPACES                   TO AA-DB2-TABLE-2      04780001
047900             MOVE SPACES                   TO AA-DB2-TABLE-3      04790001
048000             PERFORM Z998-DB2-ABEND                               04800001
048100     END-EVALUATE.                                                04810001
048200                                                                  04820001
048300*----------------------------------------------------------------*04830001
048400*    SELECT PURCHASE ORDER TYPE (IMPORT OR DOMESTIC)             *04840001
048500*----------------------------------------------------------------*04850001
048600 S300-SELECT-PO-TYPE-CDE.                                         04860001
048700                                                                  04870001
048800     EXEC SQL                                                     04880001
048900         SELECT PO_TYP_CDE                                        04890001
049000          INTO :PURCHS-PO-TYP-CDE                                 04900001
049100           FROM TPURCHS                                           04910001
049200          WHERE PO_NBR         = :RECDIS-ORD-NBR                  04920001
049300            AND VER_STATUS_CDE = 'A'                              04930001
049400     END-EXEC.                                                    04940001
049500                                                                  04950001
049600     EVALUATE TRUE                                                04960001
049700         WHEN SQLCODE = ZERO                                      04970001
049710             CONTINUE                                             04971001
049720         WHEN OTHER                                               04972001
049730             SET AC-UNSUCCESSFUL-SELECT     TO TRUE               04973001
049740             MOVE 'S300-SELECT-PO-TYPE-CDE' TO AA-PARAGRAPH-NAME  04974001
049750             MOVE 'UNSUCCESSFUL SELECT'     TO AA-DB2-OPERATION   04975001
049760             MOVE 'TPURCHS'                 TO AA-DB2-TABLE-1     04976001
049770             PERFORM Z998-DB2-ABEND                               04977001
049780     END-EVALUATE.                                                04978001
049790                                                                  04979001
054300                                                                  05430001
054400                                                                  05440001
054500 W100-WRITE-GL-INTERFACE.                                         05450001
054600*----------------------------------------------------------------*05460001
054700*    WRITE THE ACCOUNTS PAYABLE AGED OPEN PAYABLE RECORD         *05470001
054800*----------------------------------------------------------------*05480001
054900                                                                  05490001
055000     WRITE GL-INTERFACE-REC FROM AP012-GL-INTERFACE-TRN.          05500001
055100     ADD 1 TO PV-COUNT-APRD012.                                   05510001
055200                                                                  05520001
055300                                                                  05530001
055400*----------------------------------------------------------------*05540001
055500*    OPEN RECDIS_CSR CURSOR                                      *05550001
055600*----------------------------------------------------------------*05560001
055700 Y100-OPEN-RECDIS-CSR.                                            05570001
055800     EXEC SQL                                                     05580001
055900         OPEN RECDIS_CSR                                          05590001
056000     END-EXEC.                                                    05600001
056100     EVALUATE TRUE                                                05610001
056200         WHEN SQLCODE = ZERO                                      05620001
056300             CONTINUE                                             05630001
056400         WHEN OTHER                                               05640001
056500             SET AC-OPEN-ERROR TO TRUE                            05650001
056600             MOVE 'Y100-OPEN-RECDIS-CSR'   TO AA-PARAGRAPH-NAME   05660001
056700             MOVE 'UNSUCCESSFUL OPEN'      TO AA-DB2-OPERATION    05670001
056800             MOVE 'TRECDIS'                TO AA-DB2-TABLE-1      05680001
056900             MOVE SPACES                   TO AA-DB2-TABLE-2      05690001
057000             MOVE SPACES                   TO AA-DB2-TABLE-3      05700001
057100             PERFORM Z998-DB2-ABEND                               05710001
057200     END-EVALUATE.                                                05720001
057300*----------------------------------------------------------------*05730001
057400*    OPEN POLINE_CSR CURSOR                                      *05740001
057500*----------------------------------------------------------------*05750001
057600 Y200-OPEN-POLINE-CSR.                                            05760001
057700     EXEC SQL                                                     05770001
057800         OPEN POLINE_CSR                                          05780001
057900     END-EXEC.                                                    05790001
058000     EVALUATE TRUE                                                05800001
058100         WHEN SQLCODE = ZERO                                      05810001
058200             CONTINUE                                             05820001
058300         WHEN OTHER                                               05830001
058400             SET AC-OPEN-ERROR TO TRUE                            05840001
058500             MOVE 'Y200-OPEN-POLINE-CSR'   TO AA-PARAGRAPH-NAME   05850001
058600             MOVE 'UNSUCCESSFUL OPEN'      TO AA-DB2-OPERATION    05860001
058700             MOVE 'TPURITM'                TO AA-DB2-TABLE-1      05870001
058800             MOVE 'TRECITM'                TO AA-DB2-TABLE-2      05880001
058900             MOVE SPACES                   TO AA-DB2-TABLE-3      05890001
059000             PERFORM Z998-DB2-ABEND                               05900001
059100     END-EVALUATE.                                                05910001
059200*----------------------------------------------------------------*05920001
059300*    CLOSE RECDIS_CSR CURSOR                                     *05930001
059400*----------------------------------------------------------------*05940001
059500 Y300-CLOSE-RECDIS-CSR.                                           05950001
059600     EXEC SQL                                                     05960001
059700         CLOSE RECDIS_CSR                                         05970001
059800     END-EXEC.                                                    05980001
059900     EVALUATE TRUE                                                05990001
060000         WHEN SQLCODE = ZERO                                      06000001
060100             CONTINUE                                             06010001
060200         WHEN OTHER                                               06020001
060300             SET AC-CLOSE-ERROR TO TRUE                           06030001
060400             MOVE 'Y300-CLOSE-RECDIS-CSR'  TO AA-PARAGRAPH-NAME   06040001
060500             MOVE 'UNSUCCESSFUL CLOSE'     TO AA-DB2-OPERATION    06050001
060600             MOVE 'TRECDIS'                TO AA-DB2-TABLE-1      06060001
060700             MOVE SPACES                   TO AA-DB2-TABLE-2      06070001
060800             MOVE SPACES                   TO AA-DB2-TABLE-3      06080001
060900             PERFORM Z998-DB2-ABEND                               06090001
061000     END-EVALUATE.                                                06100001
061100*----------------------------------------------------------------*06110001
061200*    CLOSE POLINE_CSR CURSOR                                     *06120001
061300*----------------------------------------------------------------*06130001
061400 Y400-CLOSE-POLINE-CSR.                                           06140001
061500     EXEC SQL                                                     06150001
061600         CLOSE POLINE_CSR                                         06160001
061700     END-EXEC.                                                    06170001
061800     EVALUATE TRUE                                                06180001
061900         WHEN SQLCODE = ZERO                                      06190001
062000             CONTINUE                                             06200001
062100         WHEN OTHER                                               06210001
062200             SET AC-CLOSE-ERROR TO TRUE                           06220001
062300             MOVE 'Y400-CLOSE-POLINE-CSR'  TO AA-PARAGRAPH-NAME   06230001
062400             MOVE 'UNSUCCESSFUL CLOSE'     TO AA-DB2-OPERATION    06240001
062500             MOVE 'TPURITM'                TO AA-DB2-TABLE-1      06250001
062600             MOVE 'TRECITM'                TO AA-DB2-TABLE-2      06260001
062700             MOVE SPACES                   TO AA-DB2-TABLE-3      06270001
062800             PERFORM Z998-DB2-ABEND                               06280001
062900     END-EVALUATE.                                                06290001
063000                                                                  06300001
063100*----------------------------------------------------------------*06310001
063200*    CALENDAR ROUTINE                                            *06320001
063300*----------------------------------------------------------------*06330001
063400 Z900-CALL-CALENDAR-ROUTINE.                                      06340001
063500                                                                  06350001
063600     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   06360001
063700                                                                  06370001
063800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06380001
063900                                             DPG54 DPG55 DPG56.   06390001
064000                                                                  06400001
064100     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  06410001
064200         MOVE 'Z900-CALL-CALENDAR-ROUTINE'                        06420001
064300                                       TO AA-PARAGRAPH-NAME       06430001
064400         MOVE DPG54-ERROR-MESSAGE      TO AA-MESSAGE-1            06440001
064500         MOVE DPG52-DB2-ISO-DATE-FMT   TO AA-MESSAGE-2            06450001
064600         SET AC-DATE-ERROR             TO TRUE                    06460001
064700         PERFORM Z999-ABEND                                       06470001
064800     END-IF.                                                      06480001
064900                                                                  06490001
065000                                                                  06500001
065100 Z998-DB2-ABEND.                                                  06510001
065200*----------------------------------------------------------------*06520001
065300*    ABEND ROUTINE FOR DB2 ERRORS                                *06530001
065400*----------------------------------------------------------------*06540001
065500                                                                  06550001
065600     DISPLAY AA-ABEND-LIT.                                        06560001
065700     DISPLAY AA-DB2-ERROR-LIT.                                    06570001
065800     DISPLAY AA-PROGRAM-LIT.                                      06580001
065900     DISPLAY AA-PARAGRAPH-LIT.                                    06590001
066000     DISPLAY AA-DB2-OPERATION-LIT.                                06600001
066100     DISPLAY AA-DB2-TABLE-1.                                      06610001
066200     DISPLAY AA-DB2-TABLE-2.                                      06620001
066300     DISPLAY AA-DB2-TABLE-3.                                      06630001
066400     DISPLAY AA-DB2-TABLE-4.                                      06640001
066500     SET AC-DB2-ERROR TO TRUE.                                    06650001
066600                                                                  06660001
066700     COPY DPPD004.                                                06670001
066800                                                                  06680001
066900     CALL 'ILBOABN0' USING ABEND-CODE.                            06690001
067000                                                                  06700001
067100 Z999-ABEND.                                                      06710001
067200*----------------------------------------------------------------*06720001
067300*    ABEND ROUTINE                                               *06730001
067400*----------------------------------------------------------------*06740001
067500                                                                  06750001
067600     DISPLAY AA-ABEND-LIT.                                        06760001
067700     DISPLAY AA-PROGRAM-LIT.                                      06770001
067800     DISPLAY AA-PARAGRAPH-LIT.                                    06780001
067900     DISPLAY AA-MESSAGE-LINE-1.                                   06790001
068000     DISPLAY AA-MESSAGE-LINE-2.                                   06800001
068100                                                                  06810001
068200     CALL 'ILBOABN0' USING ABEND-CODE.                            06820001
068300                                                                  06830001
068400                                                                  06840001
