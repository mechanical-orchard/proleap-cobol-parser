000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKUT105.                                         00020026
000300 AUTHOR.        SUE BARTELT.                                      00030026
000400 DATE-WRITTEN   04/2004.                                          00040031
000500***                                                               00050000
000600***   ASSIGN DC AND SKU TO 870 FILE COMING FROM ESTEE.  OUTPUT TO 00060031
000700***   A 870 REJECTION FILE AND A 870 VALID FILE.                  00070031
000800***                                                               00080000
C98147******************************************************************00090084
C98147*   CHANGE LOG                                                    00100084
C98147******************************************************************00110084
C98147* 11/04/14 MADE BY: LINDA FRIESS                CHG0098147        00120084
C98147* CHANGES: RECOMPILED TO BRING IN PORD033 & ETRD034 COPYBOOKS     00130084
C98147*          WITH EXPANDED PO NUMBER                                00140084
C98147***************************************************************** 00150084
000900 ENVIRONMENT DIVISION.                                            00160000
001000 INPUT-OUTPUT SECTION.                                            00170000
001100 FILE-CONTROL.                                                    00180000
001200                                                                  00190000
001300     SELECT INPUT-FILE                                            00200000
001400            ASSIGN TO INP01.                                      00210000
001500                                                                  00220000
001600     SELECT OUTPUT-VALID-FILE                                     00230026
001700            ASSIGN TO OUT01.                                      00240020
001800                                                                  00250000
001600     SELECT OUTPUT-REJECT-FILE                                    00260026
001700            ASSIGN TO OUT02.                                      00270026
001800                                                                  00280026
001900 DATA DIVISION.                                                   00290000
002000 FILE SECTION.                                                    00300000
002100                                                                  00310000
002200 FD  INPUT-FILE                                                   00320000
002300     LABEL RECORDS ARE STANDARD                                   00330000
002400     RECORDING MODE IS F                                          00340000
002500     RECORD CONTAINS 100 CHARACTERS                               00350026
002600     BLOCK CONTAINS 0 RECORDS                                     00360000
002700     DATA RECORD IS INPUT-RECORD.                                 00370000
002800                                                                  00380000
002900 01  INPUT-RECORD                     PIC X(100).                 00390026
003000                                                                  00400000
003100 FD  OUTPUT-VALID-FILE                                            00410026
003200     LABEL RECORDS ARE STANDARD                                   00420019
003300     RECORDING MODE IS F                                          00430019
003400     RECORD CONTAINS 200 CHARACTERS                               00440026
003500     BLOCK CONTAINS 0 RECORDS                                     00450019
003600     DATA RECORD IS OUTPUT-VALID-RECORD.                          00460038
003700                                                                  00470019
003800 01  OUTPUT-VALID-RECORD              PIC X(200).                 00480026
003000                                                                  00490026
003100 FD  OUTPUT-REJECT-FILE                                           00500026
003200     LABEL RECORDS ARE STANDARD                                   00510026
003300     RECORDING MODE IS F                                          00520026
003400     RECORD CONTAINS 200 CHARACTERS                               00530026
003500     BLOCK CONTAINS 0 RECORDS                                     00540026
003600     DATA RECORD IS OUTPUT-REJECT-RECORD.                         00550038
003700                                                                  00560026
003800 01  OUTPUT-REJECT-RECORD              PIC X(200).                00570026
003900                                                                  00580000
004000 WORKING-STORAGE SECTION.                                         00590000
004100                                                                  00600000
004900 01  WS-INDS-SWITCHES.                                            00610000
005000     05  WS-PO-IND                    PIC X     VALUE 'C'.        00620000
005100         88  CURRENT-PO                         VALUE 'C'.        00630000
005200         88  NEW-PO                             VALUE 'N'.        00640000
005300     05  WS-MORE-INPUT-SW             PIC X     VALUE 'Y'.        00650000
005400         88  MORE-INPUT                         VALUE 'Y'.        00660000
005500         88  NO-MORE-INPUT                      VALUE 'N'.        00670000
005600     05  WS-MORE-OUTPUT-SW            PIC X     VALUE 'Y'.        00680000
005700         88  MORE-OUTPUT                        VALUE 'Y'.        00690000
005800         88  NO-MORE-OUTPUT                     VALUE 'N'.        00700000
005900     05  WS-MORE-ALLOCS-SW            PIC X     VALUE 'Y'.        00710000
006000         88  MORE-ALLOCS                        VALUE 'Y'.        00720000
006100         88  NO-MORE-ALLOCS                     VALUE 'N'.        00730000
006200     05  WS-STORE-FOUND-SW            PIC X     VALUE 'N'.        00740000
006300         88  WS-STORE-FOUND                     VALUE 'Y'.        00750000
006400         88  WS-STORE-NOT-FOUND                 VALUE 'N'.        00760000
006500     05  WS-INDEX-FOUND-SW            PIC X     VALUE 'N'.        00770000
006600         88  WS-INDEX-FOUND                     VALUE 'Y'.        00780000
006700         88  WS-INDEX-NOT-FOUND                 VALUE 'N'.        00790000
008200                                                                  00800000
008300 01  WS-RECORD-COUNTS.                                            00810000
008400     05  WS-TOT-SKUS-IN               PIC 9(03) VALUE ZERO.       00820000
008500     05  WS-TOT-SKUS-OUT              PIC 9(03) VALUE ZERO.       00830000
008600     05  WS-SKU-CNT                   PIC 9(03) VALUE ZERO.       00840000
008700                                                                  00850000
008800 01  WS-DISPLAY-FIELDS.                                           00860000
008900     05  WS-PO-NBR-D                  PIC ZZZZZZZZ9.              00870000
009000     05  WS-TOT-SKUS-IN-D             PIC ZZ9.                    00880000
009100     05  WS-TOT-SKUS-OUT-D            PIC ZZ9.                    00890000
009200     05  WS-DISPLAY-PO-NBR-LIT        PIC X(17) VALUE             00900000
009300         'PURCHASE ORDER : '.                                     00910000
009400     05  WS-DISPLAY-SKUS-IN-LIT       PIC X(17) VALUE             00920000
009500         'S K U"S   INPUT: '.                                     00930000
009600     05  WS-DISPLAY-SKUS-OUT-LIT      PIC X(17) VALUE             00940000
009700         'S K U"S  OUTPUT: '.                                     00950000
009800     05  WS-DISPLAY-LINE              PIC X(80) VALUE SPACES.     00960000
009900                                                                  00970000
008300 01  PV-PROGRAM-VARIABLES.                                        00980034
           05  PV-SKU                       PIC S9(08)V COMP-3.         00990050
           05  PV-LOCATION                  PIC S9(04)  COMP.           01000050
013501     05  PV-PO-NUMBER                 PIC S9(09) VALUE +0         01010034
013502                                                     COMP.        01020034
015900     05 PV-ITEM-UPC                   PIC S9(15)V COMP-3.         01030050
015800     05 PV-DEPT                       PIC X(03).                  01040045
015900     05 PV-REDF-DEPT REDEFINES PV-DEPT   PIC 9(03).               01050045
           05 PV-VENDOR-OSR-REF                PIC X(30).               01060048
           05 PV-VENDOR-OSR-DATE               PIC X(08).               01070048
           05 PV-VENDOR-INTERNAL-NUMBER        PIC X(30).               01080048
           05 PV-DEPT-NUMBER                   PIC X(03).               01090048
           05 PV-ISA-CONTROL-NUMBER            PIC 9(9).                01100066
007200     05 PV-NULL-IND                      PIC S9(04) VALUE +0 COMP.01110058
013400******************************************************************01120026
013500*   INPUT FILE LAYOUT                                             01130026
013600******************************************************************01140026
013700     COPY ETRD034.                                                01150053
013300                                                                  01160000
013400******************************************************************01170000
013500*   OUTPUT FILE LAYOUT  (BOTH VALID AND REJECT)                   01180026
013600******************************************************************01190000
013700     COPY PORD033.                                                01200026
013800                                                                  01210000
016700******************************************************************01220043
016800*    FIELDS NECESSARY TO CALL THE SQLCA MESSAGE MODULE.           01230043
016900******************************************************************01240043
017000                                                                  01250043
017100     COPY DPWS004.                                                01260043
017200                                                                  01270043
067000******************************************************************01280044
067100*    SQL COMMUNICATION AREA                                       01290044
067200******************************************************************01300044
067300                                                                  01310044
067400     EXEC SQL                                                     01320044
067500         INCLUDE SQLCA                                            01330044
067600     END-EXEC.                                                    01340044
067700                                                                  01350044
039628***************************************************************** 01360033
039629* DB2 TABLE DCLGENS NEEDED FOR THIS PROGRAM.                      01370033
039630***************************************************************** 01380033
039631                                                                  01390033
039632     EXEC SQL                                                     01400033
039633         INCLUDE TPURCHS                                          01410033
039634     END-EXEC.                                                    01420033
039635                                                                  01430033
039632     EXEC SQL                                                     01440033
039633         INCLUDE TPURITM                                          01450033
039634     END-EXEC.                                                    01460033
039631                                                                  01470033
039632     EXEC SQL                                                     01480033
039633         INCLUDE TALLPLN                                          01490033
039634     END-EXEC.                                                    01500033
039631                                                                  01510033
039632     EXEC SQL                                                     01520033
039633         INCLUDE TMESTDS                                          01530033
039634     END-EXEC.                                                    01540033
  9631                                                                  01550033
039632     EXEC SQL                                                     01560033
039633         INCLUDE TSKXREF                                          01570033
039634     END-EXEC.                                                    01580033
  9631                                                                  01590033
039632     EXEC SQL                                                     01600033
039633         INCLUDE TUPCSKU                                          01610033
039634     END-EXEC.                                                    01620033
                                                                        01630033
013900 PROCEDURE DIVISION.                                              01640000
014000                                                                  01650000
014100     PERFORM 1000-OPEN-FILES.                                     01660000
014200                                                                  01670000
           READ INPUT-FILE                                              01680041
               INTO ET034-ORDER-STATUS-REPORT                           01690053
                 AT END                                                 01700032
                    DISPLAY  'EMPTY INPUT FILE'                         01710032
                    SET NO-MORE-INPUT TO TRUE.                          01720032
                                                                        01730032
014300     PERFORM 2000-PROCESS-INPUT-FILE                              01740000
014400             UNTIL NO-MORE-INPUT.                                 01750000
014500                                                                  01760000
014600     PERFORM 3000-CLOSE-FILES.                                    01770000
014700                                                                  01780000
014800     STOP RUN.                                                    01790000
014900                                                                  01800000
015000 1000-OPEN-FILES.                                                 01810000
015100                                                                  01820000
015200     OPEN INPUT  INPUT-FILE                                       01830000
015300          OUTPUT OUTPUT-VALID-FILE                                01840026
                OUTPUT OUTPUT-REJECT-FILE.                              01850026
015400                                                                  01860000
015500     INITIALIZE PO033-ORDER-QTY-UPDATE-RECORD.                    01870032
016500                                                                  01880000
016600 2000-PROCESS-INPUT-FILE.                                         01890000
017500                                                                  01900000
           EVALUATE TRUE                                                01910052
                                                                        01920066
               WHEN ET034-EDI-DATA                                      01930053
PKE                MOVE ET034-ISA-CONTROL-NUMBER TO                     01940082
09227                   PV-ISA-CONTROL-NUMBER                           01950082
                                                                        01960048
               WHEN ET034-ORDER-STATUS-DATA                             01970053
                   MOVE ET034-VENDOR-OSR-REF          TO                01980053
                        PV-VENDOR-OSR-REF                               01990048
                   MOVE ET034-VENDOR-OSR-DATE         TO                02000053
                        PV-VENDOR-OSR-DATE                              02010048
                   MOVE ET034-VENDOR-INTERNAL-NUMBER  TO                02020053
                        PV-VENDOR-INTERNAL-NUMBER                       02030048
                   MOVE ET034-DEPT-NUMBER             TO                02040053
                        PV-DEPT-NUMBER                                  02050048
                   INITIALIZE PV-PO-NUMBER                              02060048
                              PO033-PO-DOES-NOT-EXIST-SW                02070056
                              PO033-PO-NOT-ACTIVE-SW                    02080056
                              PO033-UNMATCHED-DEPT-SW                   02090056
                              PO033-DTL-REJECTION-REASONS               02100056
                              PO033-NON-VMI-PO-SW                       02110068
                                                                        02120056
               WHEN ET034-ORDER-DETAIL-DATA                             02130056
                   IF ET034-PO-NUMBER = PV-PO-NUMBER                    02140056
                       INITIALIZE PO033-DTL-REJECTION-REASONS           02150056
                       PERFORM 2100-PROCESS-CURRENT-PO-I                02160056
                   ELSE                                                 02170056
                       MOVE ET034-PO-NUMBER TO PV-PO-NUMBER             02180056
                       INITIALIZE PO033-PO-DOES-NOT-EXIST-SW            02190056
                                  PO033-PO-NOT-ACTIVE-SW                02200056
                                  PO033-UNMATCHED-DEPT-SW               02210056
                                  PO033-DTL-REJECTION-REASONS           02220056
                                  PO033-NON-VMI-PO-SW                   02230068
                       PERFORM 2500-CHECK-FOR-PO-EXIST                  02240056
                       PERFORM 2100-PROCESS-CURRENT-PO-I                02250056
                   END-IF                                               02260056
           END-EVALUATE.                                                02270048
                                                                        02280032
           PERFORM 8000-READ-INPUT-FILE.                                02290032
018100                                                                  02300000
021400 2100-PROCESS-CURRENT-PO-I.                                       02310000
022500                                                                  02320000
           MOVE PV-PO-NUMBER              TO PO033-PO-NUMBER.           02330048
           MOVE PV-VENDOR-OSR-REF         TO PO033-VENDOR-OSR-REF.      02340048
           MOVE PV-VENDOR-OSR-DATE        TO PO033-VENDOR-OSR-DATE.     02350048
           MOVE PV-VENDOR-INTERNAL-NUMBER TO                            02360048
                                          PO033-VENDOR-INTERNAL-NUMBER. 02370048
           MOVE PV-DEPT-NUMBER            TO PO033-DEPT-NUMBER          02380048
                                             PV-DEPT.                   02390048
           MOVE PV-ISA-CONTROL-NUMBER TO PO033-ISA-CONTROL-NUMBER       02400066
           MOVE ET034-PO-DATE      TO PO033-PO-DATE.                    02410053
           MOVE ET034-LOCATION     TO PO033-LOCATION.                   02420053
           MOVE ET034-ITEM-UPC     TO PO033-ITEM-UPC                    02430053
                                      PV-ITEM-UPC.                      02440048
           MOVE ET034-QTY-ORDERED  TO PO033-QTY-ORDERED.                02450053
           MOVE ET034-UOM          TO PO033-UOM.                        02460053
           MOVE ET034-ACTION-CODE  TO PO033-ACTION-CODE.                02470053
                                                                        02480057
           IF ET034-QTY-ADJUSTED < 0                                    02490057
              SET PO033-ADJUSTED-QTY-NEGATIVE TO TRUE                   02500057
           ELSE                                                         02510057
              MOVE ET034-QTY-ADJUSTED TO PO033-QTY-ADJUSTED             02520057
           END-IF.                                                      02530057
                                                                        02540030
           IF (PO033-PO-DOES-NOT-EXIST OR PO033-NON-VMI-PO OR           02550075
               PO033-PO-NOT-ACTIVE)                                     02560075
              MOVE ZERO   TO PO033-SKU                                  02570037
              MOVE ZERO   TO PO033-DC                                   02580032
           ELSE                                                         02590032
              PERFORM 2600-SELECT-SKU                                   02600032
              IF (PO033-INVALID-UPC)                                    02610064
                 MOVE ZERO TO PO033-SKU                                 02620064
              ELSE                                                      02630032
                 MOVE SKXREF-SKU TO PO033-SKU                           02640032
                 PERFORM 2700-FIND-DC                                   02650032
               END-IF                                                   02660032
           END-IF.                                                      02670042
                                                                        02680048
           IF PO033-PO-DOES-NOT-EXIST       OR                          02690056
              PO033-PO-NOT-ACTIVE           OR                          02700056
              PO033-NON-VMI-PO              OR                          02710068
              PO033-PO-NOT-ACTIVE           OR                          02720075
              PO033-DTL-REJECTION                                       02730056
               PERFORM 9100-WRITE-OUTPUT-REJECT-FILE                    02740048
           ELSE                                                         02750048
               PERFORM 9000-WRITE-OUTPUT-VALID-FILE                     02760048
           END-IF.                                                      02770048
039900                                                                  02780000
       2500-CHECK-FOR-PO-EXIST.                                         02790027
                                                                        02800027
261400     EXEC SQL                                                     02810027
261500          SELECT DEPT_NBR                                         02820031
261600                ,STATUS_CDE                                       02830031
                      ,PO_TYP_CDE                                       02840068
261702            INTO :PURCHS-DEPT-NBR                                 02850031
261800                ,:PURCHS-STATUS-CDE                               02860031
                      ,:PURCHS-PO-TYP-CDE                               02870068
261900            FROM TPURCHS                                          02880027
262000           WHERE PO_NBR = :PV-PO-NUMBER                           02890036
262100             AND VER_STATUS_CDE = 'A'                             02900027
262200     END-EXEC.                                                    02910027
262300                                                                  02920027
262400     IF SQLCODE = +000                                            02930027
               IF PURCHS-PO-TYP-CDE NOT EQUAL 'VN'                      02940068
                  SET PO033-NON-VMI-PO TO TRUE                          02950068
               ELSE                                                     02960068
                  IF (PURCHS-STATUS-CDE = 'CA') OR                      02970068
                     (PURCHS-STATUS-CDE = 'CM')                         02980068
                     SET PO033-PO-NOT-ACTIVE TO TRUE                    02990068
                  END-IF                                                03000068
               END-IF                                                   03010031
           END-IF.                                                      03020077
262600     IF SQLCODE = 100                                             03030028
262700         SET PO033-PO-DOES-NOT-EXIST TO TRUE                      03040027
263300     END-IF.                                                      03050027
                                                                        03060027
       2600-SELECT-SKU.                                                 03070032
                                                                        03080032
261400     EXEC SQL                                                     03090032
261500          SELECT A.SKU                                            03100032
261702            INTO :SKXREF-SKU:PV-NULL-IND                          03110058
261900            FROM TSKXREF A                                        03120032
                      ,TUPCSKU B                                        03130032
262000           WHERE B.UPC_NBR = :PV-ITEM-UPC                         03140049
262100             AND A.ITM_NBR = B.ITEM_NBR                           03150032
262200     END-EXEC.                                                    03160032
262300                                                                  03170032
262400     IF SQLCODE = +000                                            03180032
              CONTINUE                                                  03190064
           END-IF.                                                      03200058
                                                                        03210032
262600     IF SQLCODE = 100                                             03220032
262700         SET PO033-INVALID-UPC TO TRUE                            03230032
               MOVE ZERO   TO PO033-SKU                                 03240063
263300     END-IF.                                                      03250058
                                                                        03260032
       2700-FIND-DC.                                                    03270032
           INITIALIZE PO033-DC.                                         03280061
           MOVE PO033-SKU      TO PV-SKU.                               03290056
           MOVE PO033-LOCATION TO PV-LOCATION.                          03300050
                                                                        03310032
261400     EXEC SQL                                                     03320032
261500          SELECT DEST_NBR                                         03330032
261702            INTO :ALLPLN-DEST-NBR                                 03340032
261900            FROM TPURITM A                                        03350032
                      ,TALLPLN B                                        03360032
                      ,TMESTDS C                                        03370032
262000           WHERE A.RMS_PO_SKU_NBR = :PV-SKU                       03380050
262100             AND C.STR_NBR = :PV-LOCATION                         03390050
                   AND A.PO_NBR = :PV-PO-NUMBER                         03400036
                   AND A.PO_NBR = B.PO_NBR                              03410032
                   AND A.PO_NBR = C.PO_NBR                              03420032
                   AND A.PO_LNE_NBR = B.PO_LNE_NBR                      03430032
                   AND A.PO_LNE_NBR = C.PO_LNE_NBR                      03440032
                   AND C.PLAN_NBR = B.PLAN_NBR                          03450032
262200     END-EXEC.                                                    03460032
262300                                                                  03470032
262400     IF SQLCODE = +000                                            03480032
               MOVE ALLPLN-DEST-NBR TO PO033-DC                         03490040
           END-IF                                                       03500032
                                                                        03510032
262600     IF SQLCODE = 100                                             03520032
262700         PERFORM 2725-CHECK-FOR-SKU-ON-PO                         03530032
263300     END-IF.                                                      03540041
                                                                        03550032
       2725-CHECK-FOR-SKU-ON-PO.                                        03560032
                                                                        03570074
261400     EXEC SQL                                                     03580032
261500          SELECT RMS_PO_SKU_NBR                                   03590032
                      ,STATUS_CDE                                       03600065
261702            INTO :PURITM-RMS-PO-SKU-NBR                           03610034
                      ,:PURITM-STATUS-CDE                               03620065
261900            FROM TPURITM A                                        03630032
262000           WHERE A.PO_NBR = :PV-PO-NUMBER                         03640036
262100             AND A.RMS_PO_SKU_NBR = :PV-SKU                       03650051
262200     END-EXEC.                                                    03660032
262300                                                                  03670032
262400     IF SQLCODE = +000                                            03680032
               IF PURITM-STATUS-CDE = 'CA' OR                           03690069
                  PURITM-STATUS-CDE = 'CB'                              03700070
                  SET PO033-SKU-CANCELLED TO TRUE                       03710069
               ELSE                                                     03720065
                  SET PO033-STORE-NOT-ON-ORDER TO TRUE                  03730065
               END-IF                                                   03740073
           END-IF                                                       03750032
                                                                        03760032
262600     IF SQLCODE = +100                                            03770073
262700         SET PO033-SKU-NOT-ON-ORDER TO TRUE                       03780032
 63300     END-IF.                                                      03790032
                                                                        03800032
040000 3000-CLOSE-FILES.                                                03810000
040100                                                                  03820000
040200     CLOSE INPUT-FILE                                             03830000
040300           OUTPUT-VALID-FILE                                      03840041
                 OUTPUT-REJECT-FILE.                                    03850041
040400                                                                  03860000
040500 8000-READ-INPUT-FILE.                                            03870000
040600                                                                  03880000
040700     READ INPUT-FILE INTO ET034-ORDER-STATUS-REPORT               03890053
040800          AT END  SET NO-MORE-INPUT TO TRUE.                      03900000
040900                                                                  03910000
041400                                                                  03920000
041500 9000-WRITE-OUTPUT-VALID-FILE.                                    03930048
041600                                                                  03940000
041700     WRITE OUTPUT-VALID-RECORD FROM                               03950048
                 PO033-ORDER-QTY-UPDATE-RECORD.                         03960048
                                                                        03970048
041500 9100-WRITE-OUTPUT-REJECT-FILE.                                   03980048
041600                                                                  03990048
041700     WRITE OUTPUT-REJECT-RECORD FROM                              04000048
041700           PO033-ORDER-QTY-UPDATE-RECORD.                         04010048
