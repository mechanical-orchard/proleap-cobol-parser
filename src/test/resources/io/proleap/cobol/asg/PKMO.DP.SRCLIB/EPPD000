000100*                                                                 00010000
000500******************************************************************00050000
000600*                                                                *00060000
000700******************************************************************00070000
000800                                                                  00080000
000900 EP000-0000-INITIALIZE.                                           00090000
001000     PERFORM EP000-3000-FORMAT-CURRENT-DATE.                      00100001
001100                                                                  00110000
001110     INITIALIZE EP000-MESSAGE-LINE-TABLE                          00111022
001111                EP000-SL-SYSTEM-LOG-MESSAGE.                      00111122
001120                                                                  00112022
001200     EXEC CICS                                                    00120000
001300         ASSIGN                                                   00130000
001400             SYSID   (EP000-PV-CURRENT-SYSID)                     00140000
001500             NETNAME (EP000-PV-CURRENT-NETNAME)                   00150000
001600             RESP    (PV-CICS-RESPONSE)                           00160000
001700     END-EXEC.                                                    00170000
001800*EP000-EXIT.                                                      00180000
006300                                                                  00630000
006400******************************************************************00640000
006500*  POST A PRE-FORMATTED ERROR MESSAGE, AND ANY ADDITIONAL        *00650000
006600*  MESSAGES TO THE POS CICS SYSTEM LOG.  ATTEMPT TO ENQUEUE      *00660000
006700*  THE POS LOG TO ENSURE THAT ALL MESSAGES FOR THE SAME ERROR    *00670000
006800*  CONSECUTIVE IN THE LOG (MESSAGES WILL BE POSTED EVEN IF THE   *00680000
006900*  ENQUEUE IS NOT SUCCESSFUL).  POST THE ERROR MESSAGE, AND ANY  *00690000
007200*  ADDITIONAL MESSAGES (CONTINUATION OR ADDITIONAL INFORMATION)  *00720000
007300*  AFTER THE PRIMARY MESSAGE.  DEQUEUE THE POS CICS SYSTEM LOG.  *00730000
007500******************************************************************00750000
007600                                                                  00760000
007700 EP000-1000-POST-MESSAGE.                                         00770003
007701                                                                  00770109
007702     PERFORM EP000-3000-FORMAT-CURRENT-DATE.                      00770214
007703     MOVE EP000-DT-FORMAT-DATE-MMDDYY  TO  EP000-SL-MESSAGE-DATE. 00770309
007710     MOVE EP000-DT-CURRENT-TIME  TO  EP000-SL-MESSAGE-TIME.       00771009
007720                                                                  00772013
007800     MOVE PC-CURRENT-PROGRAM-NAME  TO  EP000-SL-PROGRAM-NAME.     00780012
007801                                                                  00780115
007802     MOVE EP000-SL-PN-SYSID  TO  EP000-SL-PI-SYSID.               00780215
007803     EVALUATE TRUE                                                00780315
007809         WHEN ( EP000-SL-PGM-TYPE-CICS )                          00780915
007810             SET EP000-SL-PTYP-CICS  TO  TRUE                     00781015
007811         WHEN ( EP000-SL-PGM-TYPE-UTIL )                          00781115
007812             SET EP000-SL-PTYP-UTIL  TO  TRUE                     00781215
007813         WHEN ( EP000-SL-PGM-TYPE-UPDATE )                        00781315
007814             SET EP000-SL-PTYP-UPDATE  TO  TRUE                   00781415
007815         WHEN ( EP000-SL-PGM-TYPE-REPORT )                        00781515
007817             SET EP000-SL-PTYP-REPORT  TO  TRUE                   00781715
007818     END-EVALUATE.                                                00781815
007819     MOVE EP000-SL-PN-PGM-NUMBER  TO  EP000-SL-PI-PGM-NUMBER.     00781915
008200                                                                  00820000
008300     PERFORM EP000-2000-ENQUEUE-SYSTEM-LOG.                       00830000
008400                                                                  00840000
008410     PERFORM                                                      00841017
008420         VARYING EP000-MD-INDEX                                   00842017
008431         FROM 1 BY 1                                              00843120
008434         UNTIL ( ( EP000-MD-INDEX > EP000-MESSAGE-LINE-COUNTER )  00843421
008435              OR ( EP000-MD-INDEX > EP000-MAX-MESSAGE-LINES )     00843521
008436              OR ( EP000-MD-SYSTEM-LOG-MESSAGE (EP000-MD-INDEX)   00843618
008437                   = SPACES ) )                                   00843718
008438                                                                  00843817
008440         MOVE EP000-MD-SYSTEM-LOG-MESSAGE (EP000-MD-INDEX)        00844018
008450             TO  EP000-SL-SYS-LOG-MESSAGE-DTL                     00845018
008500         PERFORM EP000-2100-WRITE-SYS-LOG-MSG                     00850017
008510     END-PERFORM.                                                 00851019
009200                                                                  00920000
009900     IF EP000-SL-SYSTEM-LOG-ENQUEUED                              00990000
010000         PERFORM EP000-2200-DEQUEUE-SYSTEM-LOG                    01000000
010100     END-IF.                                                      01010000
010200                                                                  01020000
010400     INITIALIZE EP000-MESSAGE-LINE-TABLE                          01040022
010500                EP000-SL-SYSTEM-LOG-MESSAGE.                      01050022
010600*EP000-1000-EXIT.                                                 01060000
010700                                                                  01070000
010800******************************************************************01080000
010900*  ENQUEUE THE CICS SYSTEM LOG RESOURCE.  THIS ENSURES THAT ALL  *01090000
011000*  MESSAGES RELATING TO THE SAME ERROR, WILL REMAIN NEXT TO EACH *01100000
011100*  OTHER IN THE LOG.  THE INTERNAL NAME FOR THE SYSTEM LOG       *01110000
011200*  TRANSIENT DATA QUEUE WILL BE USED FOR THE "ENQUEUE".  IF AN   *01120000
011300*  EXCEPTIONAL CONDITION ARISES, AN ERROR MESSAGE WILL BE LOGGED.*01130000
011400******************************************************************01140000
011500                                                                  01150000
011600 EP000-2000-ENQUEUE-SYSTEM-LOG.                                   01160000
011700     EXEC CICS                                                    01170000
011800         ENQ                                                      01180000
011900             RESOURCE (EP000-SL-SYS-LOG-QUEUE-NAME)               01190000
012000             LENGTH   (EP000-SL-SYS-LOG-Q-NAME-LENGTH)            01200000
012100             RESP     (PV-CICS-RESPONSE)                          01210000
012200     END-EXEC.                                                    01220000
012300                                                                  01230000
012400     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    01240000
012500         INITIALIZE EP000-SL-SYS-LOG-MESSAGE-DTL                  01250000
012600         MOVE PV-CICS-RESPONSE TO EP000-SL-CICS-RESPONSE-DISPLAY  01260000
012700         STRING 'ENQUEUE OF THE SYSTEM LOG ('   DELIMITED BY SIZE 01270000
012800                EP000-SL-SYS-LOG-QUEUE-NAME     DELIMITED BY SIZE 01280000
012900                ') FAILED - EIBRESP = '         DELIMITED BY SIZE 01290000
013000                EP000-SL-CICS-RESPONSE-DISPLAY  DELIMITED BY SIZE 01300000
013100             INTO EP000-SL-SYS-LOG-MESSAGE-DTL                    01310000
013200         SET EP000-SL-ERROR TO TRUE                               01320006
013300         PERFORM EP000-2100-WRITE-SYS-LOG-MSG                     01330002
013400         SET EP000-SL-SYSTEM-LOG-DEQUEUED TO TRUE                 01340000
013500     ELSE                                                         01350000
013600         SET EP000-SL-SYSTEM-LOG-ENQUEUED TO TRUE                 01360000
013700     END-IF.                                                      01370000
013800*EP000-2000-EXIT.                                                 01380000
013900                                                                  01390000
014000******************************************************************01400000
014100*  WRITE A MESSAGE TO THE CICS SYSTEM LOG FOR THE CURRENT CICS   *01410000
014200*  REGION.  ALL EXCEPTIONAL CONDITIONS WILL BE IGNORED.          *01420000
014300******************************************************************01430000
014400                                                                  01440000
014500 EP000-2100-WRITE-SYS-LOG-MSG.                                    01450000
014600     EXEC CICS                                                    01460000
014700         WRITEQ TD                                                01470000
014800             QUEUE  (EP000-SL-SYS-LOG-QUEUE-NAME)                 01480000
014900             FROM   (EP000-SL-SYSTEM-LOG-MESSAGE)                 01490000
015000             LENGTH (EP000-SL-SYS-LOG-MSG-LENGTH)                 01500000
015100             RESP   (PV-CICS-RESPONSE)                            01510000
015200     END-EXEC.                                                    01520000
015300*EP000-2100-EXIT.                                                 01530000
015400                                                                  01540000
015500******************************************************************01550000
015600*  DEQUEUE THE CICS SYSTEM LOG RESOURCE.  ALL EXCEPTIONAL        *01560000
015700*  CONDITIONS WILL BE IGNORED.                                   *01570000
015800******************************************************************01580000
015900                                                                  01590000
016000 EP000-2200-DEQUEUE-SYSTEM-LOG.                                   01600000
016100     EXEC CICS                                                    01610000
016200         DEQ                                                      01620000
016300             RESOURCE (EP000-SL-SYS-LOG-QUEUE-NAME)               01630000
016400             LENGTH   (EP000-SL-SYS-LOG-Q-NAME-LENGTH)            01640000
016500             RESP     (PV-CICS-RESPONSE)                          01650000
016600     END-EXEC.                                                    01660000
016700                                                                  01670000
016800     SET EP000-SL-SYSTEM-LOG-DEQUEUED TO TRUE.                    01680000
016900*EP000-2200-EXIT.                                                 01690000
017000                                                                  01700000
019000******************************************************************01900000
019100*  FORMAT THE CURRENT DATE AND TIME, USING THE ABSOLUTE TIME.    *01910000
019200*  GET THE FOUR-DIGIT YEAR TO EXPAND THE DATE INTO YYYYMMDD      *01920000
019300*  FORMAT.                                                       *01930000
019400******************************************************************01940000
019500                                                                  01950000
019600 EP000-3000-FORMAT-CURRENT-DATE.                                  01960000
019700     EXEC CICS                                                    01970000
019800         ASKTIME                                                  01980000
019900             ABSTIME (EP000-DT-CURRENT-ABSTIME)                   01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200     EXEC CICS                                                    02020000
020300         FORMATTIME                                               02030000
020400             ABSTIME  (EP000-DT-CURRENT-ABSTIME)                  02040007
020500             YYYYMMDD (EP000-DT-CURRENT-DATE-YYYYMMDD)            02050007
020600             TIME     (EP000-DT-CURRENT-TIME-X)                   02060007
020610             DATESEP  ('-')                                       02061025
020700     END-EXEC.                                                    02070000
020800                                                                  02080000
020801     EXEC CICS                                                    02080107
020802         FORMATTIME                                               02080207
020803             ABSTIME (EP000-DT-CURRENT-ABSTIME)                   02080308
020804             MMDDYY  (EP000-DT-FORMAT-DATE-MMDDYY)                02080407
020806     END-EXEC.                                                    02080607
020807                                                                  02080707
020810     MOVE EP000-DT-CURRENT-YEAR   TO  EP000-DT-CURR-YEAR.         02081007
020812     MOVE EP000-DT-CURRENT-MONTH  TO  EP000-DT-CURR-MONTH.        02081207
020820     MOVE EP000-DT-CURRENT-DAY    TO  EP000-DT-CURR-DAY.          02082008
021600                                                                  02160000
021800*EP000-3000-EXIT.                                                 02180000
