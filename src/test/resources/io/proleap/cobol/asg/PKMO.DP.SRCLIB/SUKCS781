000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020005
000300******************************************************************00030000
000310******************************************************************00031016
000320*  this is a copy of SUKCS770 for pna testing for thin slice     *00032016
000330*                                                                *00033016
000340* THIS IS PART OF THE MAINFRAME MODERNIZATION SELECTION CRITERIA *00034016
000350*                                                                *00035016
000400******************************************************************00040000
000500*  I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE SOCKET  *00050000
000600* SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.  THIS  00060000
000700* PROGRAM IS USING "EZASOKET".                                    00070000
000800******************************************************************00080000
000900                                                                  00090000
001000 PROGRAM-ID.       SUKCS781.                                      00100016
001100 AUTHOR.           GERMAN BANDA.                                  00110000
001200 INSTALLATION.     KOHLS.                                         00120000
001300 DATE-WRITTEN      January 2009.                                  00130000
001400 DATE-COMPILED.                                                   00140000
001500                                                                  00150000
001600******************************************************************00160000
001700* THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO ACCUSORT   00170000
001800* FAST LABEL SYSTEM. THE RECEIVED DATA REPRESENT CARTONS SCANNED  00180000
001900* THAT WILL BE PROCESSED THROUGH CHECK-IN. LABEL DATA WILL BE     00190000
002000* RETURNED TO THE ACCUSORT BOX TO PRODUCE A LABEL.                00200000
002100******************************************************************00210000
002200* 06/20/2013  Change Made:                 PR# 5148B             *00220000
002300*             This program needed to be compiled due to copybook *00230000
002400*             PCWS249 and PCSW052 changing lengths due to RFID   *00240000
002500*             label changes.                                     *00250000
002600*  MADE BY:   Cheri Parmley           WR/IR #: CRQ0055296        *00260000
002700******************************************************************00270000
002800* 07/19/13 RLK BEG                                                00280000
002900* 07/17/2013  RICH KELLEN  CHG0058309  TKID: TKMAA71             *00290000
003000*             CHANGE TO ADD CREATION OF NEW DESTINATION AND       00300000
003100*             MESSAGE LABELS FOR SOME NON-AUTO CONVEYOR DC'S.     00310000
003200*             THE DC'S USING THE NEW LABEL TYPES WILL BE          00320000
003300*             BY A NEW ROW TYPE ON THE TKRPRPM TABLE.             00330000
003400* 07/19/13 RLK END                                                00340000
003500******************************************************************00350000
003600* 04/27/2017  CHERI PARMLEY CHG0166773                           *00360000
003700*             WITHIN 2000-PROCESS-DIVERT-REQUEST AND WHEN DUAL    00370000
003800*             FEED IS ON ANOTHER CHECK IS DONE IN                 00380000
003900*             2030-GET-DC-PADCLS TO CHECK IF THE DC IS TURNED ON  00390000
004000*             CURRENTLY DC840 IS ON AND IF ITS A P2L FORCED DIVERT00400000
004100*             IT WILL SET THE PS-P2L-FRCD-DVRT-DC-YES SWITCH      00410000
004200*             WHICH IS LOOKED AT IN SUKCS771.                     00420000
004300* CHANGES FOUND AT *CLP 03-13-2017                                00430000
004400******************************************************************00440000
004500* 06/20/2017   Cheri Parmley CHG0171081     TKID: TKMAF76        *00450003
004600*              Program SUKCS781 ran for Blue Springs inititally  *00460003
004700*              as to not effect other DC's. Then regression      *00470003
004800*              testing occurred in Macon and Ottawa. After       *00480003
004900*              successful regression SUKCS771 was rolled out to  *00490004
005000*              all DC's.                                         *00500004
005100******************************************************************00510003
005200* 06/20/2013  Change Made:                                       *00520005
005300*             This program needed to be compiled due to copybook *00530005
005400*             PCWS249 changing lengths due to RFID/EAS project.  *00540005
005500*  MADE BY:   Jim Arendt              WR/IR #: CHG0176459        *00550005
005600******************************************************************00560005
005610* 02/14/2023  Change Made:                                       *00561007
005620*             Remove copybook for UPC Check Digit routine        *00562007
005640*  MADE BY:   Jean Kurk               WR/IR #: CHG0281369        *00564007
005650******************************************************************00565007
005700 ENVIRONMENT DIVISION.                                            00570000
005800 DATA DIVISION.                                                   00580000
005900 WORKING-STORAGE SECTION.                                         00590000
006000                                                                  00600000
006100*  SOCKET COMMANDS CODES NEED FOR THE TCP/IP SOCKET CALLS         00610000
006200*                                                                 00620000
006300     COPY DPWS081.                                                00630000
006400                                                                  00640000
006500*---------------------------------------------------------------* 00650000
006600*  RECORD LAYOUT FOR THE MESSAGE LABEL FORM/DATA                  00660000
006700*---------------------------------------------------------------* 00670000
006800     COPY PCWS248.                                                00680000
006900                                                                  00690000
007000     EJECT                                                        00700000
007100*                                                                 00710000
007200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00720000
007300                                                                  00730000
007400 01  TASK-START.                                                  00740000
007500     05  FILLER                         PIC X(09)                 00750000
007600      VALUE IS 'CONFIRMS '.                                       00760000
007700     05  TASK-START-TRAN                PIC X(04).                00770000
007800     05  FILLER                         PIC X(18)                 00780000
007900      VALUE IS ' INTERFACE STARTED'.                              00790000
008000     05  TASK-START-CR                  PIC X(01).                00800000
008100*                                                                 00810000
008200 01  TCP-BUF2.                                                    00820000
008300     05 TCP-BUF                          PIC  X(109) VALUE SPACE. 00830000
008400     05 TCP-BUF-DATA                     PIC  X(13)  VALUE SPACE. 00840000
008500                                                                  00850000
008600*                                                                 00860000
008700 01  TCP-BUF3.                                                    00870000
008800     05 TCP-BUF-3                        PIC  X(1584) VALUE SPACE.00880000
008900     05 TCP-BUF-DATA-3                   PIC  X(13)  VALUE SPACE. 00890000
009000                                                                  00900000
009100 01  PC-PROGRAM-CONSTANTS.                                        00910000
009200     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE +3     00920000
009300                                                     COMP-3.      00930000
009400     05  PC-CURRENT-PGM-NAME             PIC  X(08)  VALUE        00940000
009500         'SUKCS781'.                                              00950016
009600***  05  PC-CRTN-CHKIN-PGM          PIC X(08) VALUE 'SUKCS771'.   00960017
009610     05  PC-CRTN-CHKIN-PGM          PIC X(08) VALUE 'SUKCS782'.   00961017
009700     05  PC-CR                      PIC X(01) VALUE ';'.          00970000
009800     05  PC-TERM-CHAR               PIC X(01) VALUE ''.          00980000
009900     05  PC-DEFAULT-TMST            PIC X(26)                     00990000
010000                              VALUE '9999-09-09-09.09.09.999999'. 01000000
010100     05  PC-OF                      PIC  X(04)  VALUE ' OF '.     01010000
010200 01  PC-LABEL-ERROR-MESSAGE.                                      01020000
010300     05  PC-KEYED-DATA-ERROR-MSG    PIC X(35) VALUE               01030000
010400                           '*****  KEYED DATA ERROR    ********'. 01040000
010500     05  PC-RETURN-INPUT-SCREEN-MSG  PIC X(35) VALUE              01050000
010600                           '***RETURN TO INPUT DATA SCREEN*****'. 01060000
010700     05  PC-TRIP-ERROR-MESSAGE     PIC X(35) VALUE                01070000
010800                           '**VALIDATE TRIP ID AND TRIP STATUS*'. 01080000
010900     05  PC-USER-ERROR-MESSAGE     PIC X(35) VALUE                01090000
011000                           '**VALIDATE USER ID                *'. 01100000
011100* DMH - 9/22/11                                                   01110000
011200     05  PC-BARCODE-1-ERROR-MSG.                                  01120000
011300         10 FILLER                  PIC X(06) VALUE '***   '.     01130000
011400         10 PC-BARCODE-1-ERROR      PIC X(22) VALUE SPACES.       01140000
011500         10 FILLER                  PIC X(07) VALUE '    ***'.    01150000
011600*                                                                 01160000
011700     05  PC-BARCODE-2-ERROR-MSG.                                  01170000
011800         10 FILLER                  PIC X(06) VALUE '***   '.     01180000
011900         10 PC-BARCODE-2-ERROR      PIC X(22) VALUE SPACES.       01190000
012000         10 FILLER                  PIC X(07) VALUE '    ***'.    01200000
012100*                                                                 01210000
012200 01  DK-DB2-KEYS.                                                 01220000
012300     05  DK-BRCDE-NBR                    PIC  X(22) VALUE SPACES. 01230000
012400     05  DK-DATE                         PIC  X(10) VALUE SPACES. 01240000
012500     05  DK-TIME                         PIC  X(08) VALUE SPACES. 01250000
012600     05  DK-FUNC-CDE                     PIC  X(06) VALUE SPACES. 01260000
012700     05  DK-LOC-ID                       PIC S9(04)  COMP.        01270000
012800     05  DK-STR-NBR                      PIC S9(04)  COMP.        01280000
012900     05  DK-CTN                          PIC S9(18)V COMP-3.      01290000
013000     05  DK-SHIPT-UNT-ID                 PIC S9(18)V COMP-3       01300000
013100                                                    VALUE ZERO.   01310000
013200     05  DK-OPER-UNT-ID                  PIC S9(04)  COMP.        01320000
013300     05  DK-PNA-STA-NBR                  PIC S9(04)  COMP.        01330000
013400     05  DK-DIVERT-ID                    PIC S9(09)  COMP.        01340000
013500     05  DK-DOOR-ID                      PIC X(04)  VALUE SPACES. 01350000
013600     05  DK-USER-ID                      PIC X(08)  VALUE SPACES. 01360000
013700     05  DK-ERROR-CODE                   PIC X(03)  VALUE ZERO.   01370000
013800     05  DK-PRC-TMST                     PIC X(26)  VALUE SPACES. 01380000
013900     05  DK-RECS-READ                    PIC S9(9)   COMP         01390000
014000                                                    VALUE ZERO.   01400000
014100                                                                  01410000
014200 01  PS-PROGRAM-SWITCHES.                                         01420000
014300     05  PS-CARTON-SW                    PIC X(01)   VALUE 'N'.   01430000
014400         88  PS-ALL-CARTON                           VALUE 'N'.   01440000
014500         88  PS-END-OF-CARTON                        VALUE 'Y'.   01450000
014600     05  PS-LOG-TO-ERR-FILE-SW           PIC X(01)   VALUE ' '.   01460000
014700         88  PS-LOG-TO-ERR-FILE                      VALUE 'Y'.   01470000
014800         88  PS-DO-NOT-LOG                           VALUE 'N'.   01480000
014900     05  PS-PARM-REC-FOUND-SW            PIC X(01)   VALUE ' '.   01490000
015000         88  PS-NO-PARM-REC-FOUND                    VALUE 'N'.   01500000
015100         88  PS-PARM-REC-FOUND                       VALUE 'Y'.   01510000
015200     05  PS-DUPLICATE-CARTON-SW          PIC X(01)   VALUE ' '.   01520000
015300         88  PS-NO-DUPLICATE-CARTON                  VALUE 'N'.   01530000
015400         88  PS-DUPLICATE-CARTON                     VALUE 'Y'.   01540000
015500     05  PS-PART-RECEIVE-SW              PIC  X(01)  VALUE 'S'.   01550000
015600         88  PS-PART-RECEIVE                         VALUE 'P'.   01560000
015700         88  PS-COMP-RECEIVE                         VALUE 'C'.   01570000
015800         88  PS-ERROR-RECEIVE                        VALUE 'E'.   01580000
015900         88  PS-START-RECEIVE                        VALUE 'S'.   01590000
016000     05  PS-SOCKET-CLOSE-SW              PIC X(01)   VALUE 'N'.   01600000
016100         88  PS-SOCKET-CLOSED                        VALUE 'Y'.   01610000
016200         88  PS-SOCKET-NOT-CLOSED                    VALUE 'N'.   01620000
016300     05  PS-INPUT-DATA-ERROR-SW          PIC X(01)   VALUE 'N'.   01630000
016400         88  PS-INPUT-DATA-ERROR-YES                 VALUE 'Y'.   01640000
016500         88  PS-INPUT-DATA-ERROR-NO                  VALUE 'N'.   01650000
016600     05  PS-DC-INTERFC-LABOR-SW          PIC X(01)   VALUE 'N'.   01660000
016700         88  PS-DC-INTERFC-LABOR-YES                 VALUE 'Y'.   01670000
016800         88  PS-DC-INTERFC-LABOR-NO                  VALUE 'N'.   01680000
016900     05  PS-DATABASE-ERROR-SW            PIC X(01)   VALUE 'N'.   01690000
017000         88  PS-DB2-ERROR-YES                        VALUE 'Y'.   01700000
017100         88  PS-DB2-ERROR-NO                         VALUE 'N'.   01710000
017200     05  PS-TRIP-ERROR-SW                PIC X(01)   VALUE 'N'.   01720000
017300         88  PS-TRIP-ERROR-YES                       VALUE 'Y'.   01730000
017400         88  PS-TRIP-ERROR-NO                        VALUE 'N'.   01740000
017500     05  PS-USER-ERROR-SW                PIC X(01)   VALUE 'N'.   01750000
017600         88  PS-USER-ERROR-YES                       VALUE 'Y'.   01760000
017700         88  PS-USER-ERROR-NO                        VALUE 'N'.   01770000
017800     05  PS-CSSL-LOGGING-SW              PIC X(01)   VALUE 'N'.   01780000
017900         88  PS-CSSL-LOGGING-YES                     VALUE 'Y'.   01790000
018000         88  PS-CSSL-LOGGING-NO                      VALUE 'N'.   01800000
018100     05  PS-P2L-FORCED-DIVERT-DC-SW  PIC  X(01)  VALUE 'N'.       01810000
018200         88  PS-P2L-FRCD-DVRT-DC-YES             VALUE 'Y'.       01820000
018300         88  PS-P2L-FRCD-DVRT-DC-NO              VALUE 'N'.       01830000
018400*    05  PS-DC-FLOWBACK-SW           PIC  X(01)  VALUE 'N'.       01840000
018500*        88  PS-DC-FLOWBACK-YES                  VALUE 'Y'.       01850000
018600*        88  PS-DC-FLOWBACK-NO                   VALUE 'N'.       01860000
018700     05  PS-DUAL-FEED-SW             PIC  X(01)  VALUE 'N'.       01870000
018800         88  PS-DUAL-FEED-ON                     VALUE 'Y'.       01880000
018900         88  PS-DUAL-FEED-OFF                    VALUE 'N'.       01890000
019000* DMH - 9/21/11                                                   01900000
019100     05  PS-VENDOR-SSCC-SW            PIC X(01)  VALUE 'N'.       01910000
019200         88  PS-VENDOR-SSCC-YES                  VALUE 'Y'.       01920000
019300         88  PS-VENDOR-SSCC-NO                   VALUE 'N'.       01930000
019400     05  PS-MULT-VNDR-SSCC-SW         PIC X(01)  VALUE 'N'.       01940000
019500         88  PS-MULT-VNDR-SSCC-YES               VALUE 'Y'.       01950000
019600         88  PS-MULT-VNDR-SSCC-NO                VALUE 'N'.       01960000
019700     05  PS-VENDOR-SSCC-1-SW          PIC X(01)  VALUE 'N'.       01970000
019800         88  PS-VENDOR-SSCC-1-YES                VALUE 'Y'.       01980000
019900         88  PS-VENDOR-SSCC-1-NO                 VALUE 'N'.       01990000
020000     05  PS-VENDOR-SSCC-2-SW          PIC X(01)  VALUE 'N'.       02000000
020100         88  PS-VENDOR-SSCC-2-YES                VALUE 'Y'.       02010000
020200         88  PS-VENDOR-SSCC-2-NO                 VALUE 'N'.       02020000
020300     05  PS-initial-start-SW          PIC X(01)  VALUE 'N'.       02030000
020400         88  PS-initial-start-yes                VALUE 'Y'.       02040000
020500         88  PS-initial-start-no                 VALUE 'N'.       02050000
020600     05  PS-BLD-INTERNAL-TABLE-SW        PIC  X(01)  VALUE 'N'.   02060000
020700         88  PS-BLD-INTERNAL-TABLE-YES               VALUE 'Y'.   02070000
020800         88  PS-BLD-INTERNAL-TABLE-NO                VALUE 'N'.   02080000
020900     05  PS-CAPTURE-DATA-sw              PIC  X(01)  VALUE 'N'.   02090000
021000         88  PS-CAPTURE-DATA                         VALUE 'Y'.   02100000
021100         88  PS-CAPTURE-DATA-NO                      VALUE 'N'.   02110000
021200*CLP 03-13-2017                                                   02120000
021300     05  PS-IS-PADCLS-FOUND              PIC  X(01)  VALUE 'N'.   02130000
021400         88  PS-DC-PADCLS-FOUND                      VALUE 'Y'.   02140000
021500         88  PS-DC-PADCLS-NOT-FOUND                  VALUE 'N'.   02150000
021600*                                                                 02160000
021700                                                                  02170000
021800 01  PV-PROGRAM-VARIABLES.                                        02180000
021900     05  PV-DP081-RETCODE                PIC  ZZZZZZZZ9-.         02190000
022000     05  PV-HOLD-TRIP-ID                 PIC  S9(9) COMP.         02200000
022100     05  PV-HOLD-USER-ID                 PIC  X(08) VALUE SPACES. 02210000
022200     05  PV-HOLD-DOOR-ID                 PIC  X(04) VALUE SPACES. 02220000
022300     05  PV-HOLD-DC-NBR                  PIC  9(04).              02230000
022400     05  PV-ASGMT-STRT-DTE               PIC  X(10)  VALUE SPACE. 02240000
022500     05  PV-ASGMT-NBR-TXT                PIC  X(10)  VALUE SPACE. 02250000
022600     05  PV-ASGMT-NBR-SEQ-NBR            PIC S9(09)  VALUE ZERO.  02260000
022700     05  PV-TRIP-ID                      PIC S9(09)  VALUE ZERO.  02270000
022800                                                                  02280000
022900     05  PV-OTBND-CART-SHIPT-UNT-ID      PIC S9(18)V COMP-3       02290000
023000                                                    VALUE ZERO.   02300000
023100     05 PV-DC-5-CHAR-ABBR               PIC X(05) VALUE SPACES.   02310000
023200     05 PV-DC-5-CHAR-ABBR-R REDEFINES PV-DC-5-CHAR-ABBR.          02320000
023300         15 FILLER                      PIC  X(03).               02330000
023400         15 PV-2-DIGIT-DC-ABBR          PIC  X(02).               02340000
023500     05  PV-SHIPT-UNIT-ID                PIC  9(18).              02350000
023600     05  PV-PRNT-CART-ID                 PIC S9(18)V COMP-3       02360000
023700                                                    VALUE ZERO.   02370000
023800     05  PV-LABEL-DWNLD-LENGTH           PIC  9(8).               02380000
023900     05  PV-DISP-SHIPT-UNT-ID            PIC S9(18).              02390000
024000     05  PV-DISP-TCP-COUNT               PIC  9(04).              02400000
024100     05  PV-SULBXF-BRCDE-NBR.                                     02410000
024200         10  FILLER                      PIC  X(06).              02420000
024300         10  PV-SULBXF-STORE-NBR         PIC  9(03).              02430000
024400         10  FILLER                      PIC  X(13).              02440000
024500     05  PV-DISPLAY-SQLCODE              PIC S9(09).              02450000
024600     05  PV-DISPLAY-TRIP-ID              PIC  9(09).              02460000
024700     05  PV-DISPLAY-TRIP-51              PIC  9(09).              02470000
024800     05  PV-DISPLAY-TRIP-92              PIC  X(09).              02480000
024900     05  PV-DISPL-ASGMT-SEQ-NBR          PIC S9(09).              02490000
025000                                                                  02500000
025100     05  PV-DISP-DC                      PIC  Z(04).              02510000
025200     05  PV-DISP-PNA-STA                 PIC  Z(04).              02520000
025300     05  PV-DISP-TRIP                    PIC  Z(10).              02530000
025310     05  PV-DISP-LENGTH                  PIC  ZZZZZZZZZ-.         02531015
025400*                                                                 02540000
025500     05  PV-DSPLY-PRTR                   PIC  X(06)  VALUE SPACES.02550000
025600     05  PV-DSPLY-PRTR-R REDEFINES PV-DSPLY-PRTR.                 02560000
025700         10  PV-DSPLY-DC                 PIC  X(02).              02570000
025800         10  PV-DSPLY-DASH               PIC  X(01).              02580000
025900         10  PV-DSPLY-PRTR-ID            PIC  X(03).              02590000
026000*                                                                 02600000
026100     05  PV-ACTV-IND                     PIC  X(01).              02610000
026200     05  PV-ERROR-MESSAGE                PIC  X(09) VALUE SPACES. 02620000
026300     05  PV-ENTRIES                      PIC S9(03)  VALUE ZEROS  02630000
026400                                                     COMP-3.      02640000
026500     05  PV-SQL-CODE                     PIC 9(09).               02650000
026600     05  PV-RECEIVE-RQST-TMST            PIC X(26).               02660000
026700     05  PV-RECEIVE-RQST-TMST-r rEDEFINES PV-RECEIVE-RQST-TMST.   02670000
026800         10  FILLER                      PIC  X(11).              02680000
026900         10  PV-INIT-HH                  PIC  9(02).              02690000
027000         10  FILLER                      PIC  X(01).              02700000
027100         10  PV-INIT-MM                  PIC  9(02).              02710000
027200         10  FILLER                      PIC  X(01).              02720000
027300         10  PV-INIT-SS                  PIC  9(02).              02730000
027400         10  FILLER                      PIC  X(07).              02740000
027500     05  PV-INIT-TIME-KEY.                                        02750000
027600         10  PV-INIT-KEY-HH              PIC  9(02).              02760000
027700         10  PV-INIT-KEY-MM              PIC  9(02).              02770000
027800         10  PV-INIT-KEY-SS              PIC  9(02).              02780000
027900     05  PV-HOLD-TIMESTAMP               PIC X(26).               02790000
028000     05  PV-TIMESTAMP                    PIC X(26).               02800000
028100     05  PV-CONTAINER-ID.                                         02810000
028200         10  PV-CONTAINER-00             PIC X(02).               02820000
028300         10  PV-SHIPT-UNT-ID             PIC 9(18).               02830000
028400         10  PV-CONTAINER-SPACES         PIC X(02).               02840000
028500     05  FILLER REDEFINES PV-CONTAINER-ID.                        02850000
028600         10  FILLER                      PIC X(06).               02860000
028700         10  PV-STORE-NBR                PIC 9(03).               02870000
028800         10  FILLER                      PIC X(13).               02880000
028900     05  PV-SHIPT-UNT-ID-REDEF           PIC 9(18).               02890000
029000     05  FILLER REDEFINES PV-SHIPT-UNT-ID-REDEF.                  02900000
029100         10  PV-SHIPT-UNT-ID-FIL-1       PIC 9(04).               02910000
029200         10  PV-STORE-NUMBER             PIC 9(03).               02920000
029300         10  PV-SHIPT-UNT-ID-FIL-2       PIC 9(11).               02930000
029400     05  PV-DATE.                                                 02940000
029500         10  PV-DATE-CCYY                PIC X(04).               02950000
029600         10  PV-DATE-DASH1               PIC X(01)  VALUE '-'.    02960000
029700         10  PV-DATE-MM                  PIC X(02).               02970000
029800         10  PV-DATE-DASH2               PIC X(01)  VALUE '-'.    02980000
029900         10  PV-DATE-DD                  PIC X(02).               02990000
030000     05  PV-TIME.                                                 03000000
030100         10  PV-TIME-HH                  PIC X(02).               03010000
030200         10  PV-TIME-DOT1                PIC X(01)  VALUE '.'.    03020000
030300         10  PV-TIME-MM                  PIC X(02).               03030000
030400         10  PV-TIME-DOT2                PIC X(01)  VALUE '.'.    03040000
030500         10  PV-TIME-SS                  PIC X(02).               03050000
030600     05  PV-IN-DATE                      PIC 9(08).               03060000
030700     05  FILLER REDEFINES PV-IN-DATE.                             03070000
030800         10  PV-IN-DATE-CCYY             PIC X(04).               03080000
030900         10  PV-IN-DATE-MM               PIC X(02).               03090000
031000         10  PV-IN-DATE-DD               PIC X(02).               03100000
031100     05  PV-IN-TIME                      PIC 9(06).               03110000
031200     05  FILLER REDEFINES PV-IN-TIME.                             03120000
031300         10  PV-IN-TIME-HH               PIC X(02).               03130000
031400         10  PV-IN-TIME-MM               PIC X(02).               03140000
031500         10  PV-IN-TIME-SS               PIC X(02).               03150000
031600                                                                  03160000
031700     05 PV-WORK-DB2-DATE                 PIC X(10)   VALUE SPACES.03170000
031800     05 PV-WORK-DB2-DATE-R    REDEFINES PV-WORK-DB2-DATE.         03180000
031900         10 PV-WORK-CC                   PIC  9(02).              03190000
032000         10 PV-WORK-YY                   PIC  9(02).              03200000
032100         10 FILLER                       PIC  X(01).              03210000
032200         10 PV-WORK-MM                   PIC  9(02).              03220000
032300         10 FILLER                       PIC  X(01).              03230000
032400         10 PV-WORK-DD                   PIC  9(02).              03240000
032500     05 PV-LBL-DATE                      PIC  X(08)  VALUE SPACES.03250000
032600     05 PV-LBL-DATE-R REDEFINES PV-LBL-DATE.                      03260000
032700        10  PV-LBL-DATE-MM               PIC  X(02).              03270000
032800        10  PV-LBL-DASH1                 PIC  X(01).              03280000
032900        10  PV-LBL-DATE-DD               PIC  X(02).              03290000
033000        10  PV-LBL-DASH2                 PIC  X(01).              03300000
033100        10  PV-LBL-DATE-YY               PIC  X(02).              03310000
033200                                                                  03320000
033300     05 PV-CURRENT-TIME-LBL.                                      03330000
033400         10 PV-CURRENT-HOUR-LBL          PIC  9(02)  VALUE ZEROES.03340000
033500         10 FILLER                       PIC  X(01)  VALUE ':'.   03350000
033600         10 PV-CURRENT-MIN-LBL           PIC  9(02)  VALUE ZEROES.03360000
033700                                                                  03370000
033800     05  PV-CURRENT-TIME                 PIC X(08)  VALUE SPACES. 03380000
033900     05  PV-CURRENT-TIME-R REDEFINES     PV-CURRENT-TIME.         03390000
034000         10 PV-CURRENT-HR                PIC  9(02).              03400000
034100         10 FILLER                       PIC  X(01).              03410000
034200         10 PV-CURRENT-MN                PIC  9(02).              03420000
034300         10 FILLER                       PIC  X(03).              03430000
034400     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  03440000
034500                                                     COMP SYNC.   03450000
034600     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     03460000
034700                                                     COMP SYNC.   03470000
034800     05  PV-PARTIAL-TCP-COUNT            PIC S9(04)  VALUE ZEROS  03480000
034900                                                     COMP SYNC.   03490000
035000     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZEROS  03500000
035100                                                     COMP SYNC.   03510000
035200     05  PV-INPUT-DATA-ERR-COUNT         PIC S9(04)  VALUE ZEROS. 03520000
035300     05  PV-TASK-X.                                               03530000
035400         10  PV-TASK                     PIC 9(07)   VALUE ZERO.  03540000
035500     05  PV-RECEIVE-LENGTH               PIC S9(04)  VALUE +0     03550000
035600                                                     COMP SYNC.   03560000
035700     05  PV-CICS-MSG-AREA                PIC  X(120) VALUE SPACE. 03570000
035800     05  PV-CICS-MSG-HOLD.                                        03580000
035900         10  FILLER                      PIC  X(01)  VALUE SPACE. 03590000
036000         10  PV-CICS-MSG-DATA            PIC  X(119) VALUE SPACE. 03600000
036100     05  PV-CICS-MSG-HOLD2.                                       03610000
036200         10  FILLER                      PIC  X(01)  VALUE SPACE. 03620000
036300         10  PV-CICS-MSG-DATA2           PIC  X(119) VALUE SPACE. 03630000
036400                                                                  03640000
036500     05  PV-DMH-DISPLAY-DATA             PIC  X(1650) VALUE SPACE.03650000
036600     05  PV-DMH-DISPLAY-DATA-R REDEFINES PV-DMH-DISPLAY-DATA.     03660000
036700         10  PV-DMH-DISPLAY-1            PIC  X(100).             03670000
036800         10  PV-DMH-DISPLAY-2            PIC  X(100).             03680000
036900         10  PV-DMH-DISPLAY-3            PIC  X(100).             03690000
037000         10  PV-DMH-DISPLAY-4            PIC  X(100).             03700000
037100         10  PV-DMH-DISPLAY-5            PIC  X(100).             03710000
037200         10  PV-DMH-DISPLAY-6            PIC  X(100).             03720000
037300         10  PV-DMH-DISPLAY-7            PIC  X(100).             03730000
037400         10  PV-DMH-DISPLAY-8            PIC  X(100).             03740000
037500         10  PV-DMH-DISPLAY-9            PIC  X(100).             03750000
037600         10  PV-DMH-DISPLAY-10           PIC  X(100).             03760000
037700         10  PV-DMH-DISPLAY-11           PIC  X(100).             03770000
037800         10  PV-DMH-DISPLAY-12           PIC  X(100).             03780000
037900         10  PV-DMH-DISPLAY-13           PIC  X(100).             03790000
038000         10  PV-DMH-DISPLAY-14           PIC  X(100).             03800000
038100         10  PV-DMH-DISPLAY-15           PIC  X(100).             03810000
038200         10  PV-DMH-DISPLAY-16           PIC  X(100).             03820000
038300         10  PV-DMH-DISPLAY-17           PIC  X(50).              03830000
038400     05  PV-CICS-MSG-AREA-DMH            PIC  X(105) VALUE SPACE. 03840000
038500                                                                  03850000
038600     05  PV-RETCODE                      PIC  9(08)  VALUE ZEROS. 03860000
038700     05  PV-TCPLENG                      PIC  9(08)  VALUE ZEROS. 03870000
038800     05  PV-ERRNO                        PIC  9(08)  VALUE ZEROS. 03880000
038900     05  PV-TCP-BUF                      PIC  X(109) VALUE SPACES.03890000
039000                                                                  03900000
039100     05  PV-TCP-EXP-LENGTH               PIC 9(08)   VALUE 109.   03910000
039200     05  PV-TCP-RET-LENGTH               PIC 9(08)   VALUE ZEROS. 03920000
039300     05  PV-TCP-REM-LENGTH               PIC 9(08)   VALUE ZEROS. 03930000
039400     05  PV-TCP-PRCSD-LENGTH             PIC 9(08)   VALUE ZEROS. 03940000
039500     05  PV-ABEND-CODE                   PIC S9(04)  COMP SYNC    03950000
039600                                                 VALUE ZERO.      03960000
039700     05  PV-ERROR-COUNT                  PIC 9(03)   VALUE ZERO.  03970000
039800     05  PV-SOCK-ID                      PIC 9(04).               03980000
039900     05  PV-CID-DOMAIN-LSTN              PIC 9(08).               03990000
040000     05  PV-NBR-BYTES                    PIC 9(08).               04000000
040100                                                                  04010000
040200     05  PV-SSCC-UNCHKIN                 PIC S9(18)V COMP-3.      04020000
040300     05  PV-VENDOR-SSCC                  PIC S9(18)V COMP-3.      04030000
040400     05  PV-disp-sscc                    PIC  9(18).              04040000
040500                                                                  04050000
040600     05  PV-DURATION-SEC                 PIC S9(09) COMP VALUE 0. 04060000
040700     05  PV-disp-duration                PIC  9(09)   VALUE ZEROS.04070000
040800     05  PV-DISP-PARM-SECONDS            PIC  9(09)   VALUE ZEROS.04080000
040900     05  PV-DURATION-nano-sec            PIC S9(10) COMP VALUE 0. 04090000
041000     05  PV-work-nano-sec                PIC  9(10) value zeroes. 04100000
041100     05  PV-work-nano-sec-redef redefines pv-work-nano-sec.       04110000
041200         10  PV-work-nano-min-1-2        pic  9(02).              04120000
041300         10  PV-work-nano-sec-3-4        pic  9(02).              04130000
041400         10  PV-work-nano-micro-5-10     pic  9(06).              04140000
041500     05  PV-disp-nano-sec                PIC  x(12).              04150000
041600     05  PV-disp-nano-sec-redef redefines pv-disp-nano-sec.       04160000
041700         10  PV-disp-nano-min-1-2        pic  9(02).              04170000
041800         10  pv-disp-nano-dash-1         pic  x(01).              04180000
041900         10  PV-disp-nano-sec-3-4        pic  9(02).              04190000
042000         10  pv-disp-nano-dash-2         pic  x(01).              04200000
042100         10  PV-disp-nano-micro-5-10     pic  9(06).              04210000
042200     05  PV-curRENT-PARA-TMST            PIC  x(26).              04220000
042300     05  PV-disp-sqlcode                 PIC  -999  value zeroes. 04230000
042400     05  PV-PARM-SECONDS                 PIC S9(09) COMP VALUE 0. 04240000
042500     05  PV-TKRPRPM-TEXT                 PIC  X(25) VALUE SPACES. 04250000
042600     05  PV-TKRPRPM-TEXT-Redef1 redefines PV-TKRPRPM-TEXT.        04260000
042700         10  PV-TKRPRPM-TEXT-Y-N         PIC  X(01).              04270000
042800         10  FILLER                      PIC  X(01).              04280000
042900         10  PV-TKRPRPM-TEXT-ALL         PIC  X(03).              04290000
043000         10  FILLER                      PIC  X(20).              04300000
043100     05  PV-TKRPRPM-TEXT-REDEF2 redefines PV-TKRPRPM-TEXT.        04310000
043200         10  FILLER                      PIC  X(02).              04320000
043300         10  PV-TKRPRPM-TEXT-PNA-STA     PIC  9(03).              04330000
043400         10  FILLER                      PIC  X(20).              04340000
043500                                                                  04350000
043600* dmh - 05/29/2015                                                04360000
043700     05  PV-TKRPRPM-CAPTURE              PIC  X(25) VALUE SPACES. 04370000
043800     05  PV-TKRPRPM-CAPT-REDEF1 REDEFINES PV-TKRPRPM-CAPTURE.     04380000
043900         10  PV-TKRPRPM-CAPT-Y-N         PIC  X(01).              04390000
044000         10  FILLER                      PIC  X(01).              04400000
044100         10  PV-TKRPRPM-CAPT-STA         PIC  9(03).              04410000
044200         10  FILLER                      PIC  X(20).              04420000
044300     05  PV-CAPTURE-CNT           PIC S9(9) COMP VALUE ZEROES.    04430000
044400     05  PV-RANDOM-TMST           PIC X(26)      VALUE SPACES.    04440000
044500     05  PC-RANDOM-PGM            PIC  X(08)  VALUE 'DPKUT902'.   04450000
044600     05  PV-CAPTURE-RANDOM-NBR    PIC  9(09)  VALUE ZEROES.       04460000
044700                                                                  04470000
044800                                                                  04480000
044900*----------------------------------------------------------------*04490000
045000* PARAGRAPH TRACKING TABLE - USED FOR DEBUGGING                  *04500000
045100* WILL TRACK PARAGRAPHS IN THIS TABLE - IF WE SEE TRANSACTION    *04510000
045200* IF TAKING LONGER THEN X SECONDS TO RESPOND, WILL DUMP THE      *04520000
045300* TABLE TO CSSL                                                  *04530000
045400* PARM PATIM1                                                    *04540000
045500*----------------------------------------------------------------*04550000
045600 01  PT-PARA-TRACKING-TABLE.                                      04560000
045700     05  PT-ENTRIES               OCCURS 1500 TIMES               04570000
045800                                  INDEXED BY PT-TRACK-IDX.        04580000
045900         10 FILLER                PIC  X(01) VALUE SPACE.         04590000
046000         10 PT-PROGRAM            PIC  X(08) VALUE 'SUKCS781'.    04600016
046100         10 FILLER                PIC  X(01) VALUE SPACE.         04610000
046200         10 pt-dc                 PIC  9(04) VALUE zeroes.        04620000
046300         10 filler                PIC  X(01) VALUE '-'.           04630000
046400         10 pt-pna-sta            PIC  9(03) VALUE zeroes.        04640000
046500         10 filler                PIC  X(01) VALUE '-'.           04650000
046600         10 pt-start-hhmmss       PIC  9(06) VALUE zeroes.        04660000
046700         10 FILLER                PIC  X(01) VALUE SPACE.         04670000
046800         10 PT-INDEX-NBR          PIC  9(05) VALUE ZEROES.        04680000
046900         10 FILLER                PIC  X(01) VALUE SPACE.         04690000
047000         10 PT-paragraph          PIC  X(04) VALUE SPACE.         04700000
047100         10 FILLER                PIC  X(01) VALUE SPACE.         04710000
047200         10 PT-TIMESTAMP          PIC  X(26) VALUE SPACE.         04720000
047300         10 FILLER                PIC  X(01) VALUE SPACE.         04730000
047400         10 PT-DURATION           PIC  9(09) VALUE ZEROES.        04740000
047500         10 FILLER                PIC  X(01) VALUE SPACE.         04750000
047600         10 PT-nano-sec           PIC  x(12) VALUE ZEROES.        04760000
047700     05  PT-MAX-PARA-ENTRIES      PIC  9(04) VALUE 1500.          04770000
047800     05  PT-CURR-ENTRIES          PIC  9(04) VALUE ZEROES.        04780000
047900     05  PT-CURR-PARA             PIC  X(04) VALUE SPACES.        04790000
048000                                                                  04800000
048100*                                                                 04810000
048200*                                                                 04820000
048300 01  PT-MSG-TABLE.                                                04830000
048400     05  PT-MESSAGES OCCURS 40 TIMES INDEXED BY PT-MSG-IDX.       04840000
048500         10  PT-MSG.                                              04850000
048600             15 PT-MESSAGE               PIC X(52).               04860000
048700             15 FILLER                   PIC X(1).                04870000
048800             15 PT-TASK                  PIC 9(07).               04880000
048900             15 FILLER                   PIC X(1).                04890000
049000                                                                  04900000
049100                                                                  04910000
049200 01  PT-TCP-RECEIVE-TABLE.                                        04920000
049300     05  PT-TCP-RECEIVE OCCURS 109 TIMES                          04930000
049400                        INDEXED BY PT-RECEIVE-IDX.                04940000
049500         10  PT-TCP-RECEIVE-CHAR         PIC X(01).               04950000
049600                                                                  04960000
049700 01  PT-TCP-ASSEMBLE-TABLE.                                       04970000
049800     05  PT-TCP-DATA-ASSEMBLE OCCURS 50 TIMES                     04980000
049900                              INDEXED BY PT-ASSEMBLE-IDX.         04990000
050000         10  PT-TCP-DATA-CHAR            PIC X(01).               05000000
050100                                                                  05010000
050200* add select parameter before recv socket command to determine if 05020000
050300* is still active                                                 05030000
050400*                                                                 05040000
050500 01  SELECT-PARMS.                                                05050000
050600     02  SELECT-NUMFDS          PIC 9(8) COMP VALUE 1.            05060000
050700     02  SELECT-TIMEOUT.                                          05070000
050800         03  SELECT-SECS        PIC 9(8) COMP VALUE 60.           05080000
050900         03  SELECT-MILLSECS    PIC 9(8) COMP VALUE 0.            05090000
051000     02  SELECT-RD-MASK         PIC X(16).                        05100000
051100     02  SELECT-WR-MASK         PIC X(16).                        05110000
051200     02  SELECT-EX-MASK         PIC X(16).                        05120000
051300     02  SELECT-RR-MASK         PIC X(16).                        05130000
051400     02  SELECT-RW-MASK         PIC X(16).                        05140000
051500     02  SELECT-RE-MASK         PIC X(16).                        05150000
051600                                                                  05160000
051700 01  CHAR-MASK.                                                   05170000
051800     02 CHAR-STRING             PIC  X(100).                      05180000
051900                                                                  05190000
052000 01  CHAR-ARRAY REDEFINES CHAR-MASK.                              05200000
052100     02  CHAR-ENTRY-TABLE OCCURS 100 TIMES.                       05210000
052200       03  CHAR-ENTRY         PIC  X.                             05220000
052300                                                                  05230000
052400 01  BIT-MASK.                                                    05240000
052500     02  BIT-ARRAY            PIC  X(16).                         05250000
052600                                                                  05260000
052700 01  BIT-FUNCTION-CODES.                                          05270000
052800     02  CTOB                 PIC  X(4) VALUE 'CTOB'.             05280000
052900     02  BTOC                 PIC  X(4) VALUE 'BTOC'.             05290000
053000                                                                  05300000
053100 01  BIT-MASK-LENGTH          PIC  9(8) COMP VALUE 100.           05310000
053200                                                                  05320000
053300 01  BITMASK-TOKEN            PIC X(16) VALUE 'TCPIPBITMASKCOBL'. 05330000
053400 01  SOCKETS                  PIC  9(8) COMP VALUE 100.           05340000
053500 01  SOCKNO                   PIC S9(8) BINARY.                   05350000
053600 01  EZRETC                   PIC S9(8) COMP.                     05360000
053700/                                                                 05370000
053800                                                                  05380000
053900*                                                                 05390000
054000*  LISTENER QUEUE NAMES                                           05400000
054100*                                                                 05410000
054200     COPY RFWS001.                                                05420000
054300                                                                  05430000
054400*                                                                 05440000
054500*  RECORD LAYOUT BEING TRANSMITTED FROM THE CONVEYOR SYSTEM       05450000
054600*                                                                 05460000
054700     COPY SUWS051.                                                05470000
054800                                                                  05480000
054900*                                                                 05490000
055000*  RECORD LAYOUT BEING TRANSMITTED TO THE CONVEYOR SYSTEM         05500000
055100*                                                                 05510000
055200     COPY SUWS052.                                                05520000
055300                                                                  05530000
055400*                                                                 05540000
055500*                                                                 05550000
055600*  RECORD LAYOUT PASSED FOR THE CHECK-IN MODULE                   05560000
055700*                                                                 05570000
055800     COPY SUWS054.                                                05580000
055900                                                                  05590000
056000*  RECORD LAYOUT PASSED FOR THE dual-feed module                  05600000
056100*                                                                 05610000
056200     COPY SUWS092.                                                05620000
056300                                                                  05630000
056400*                                                                 05640000
056500*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                05650000
056600*                                                                 05660000
056700     COPY DPWS013.                                                05670000
056800                                                                  05680000
056900*                                                                 05690000
057000*  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  05700000
057100*                                                                 05710000
057200     COPY DPRD507I.                                               05720000
057300                                                                  05730000
057400*                                                                 05740000
057500*  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     05750000
057600*                                                                 05760000
057700     COPY DPWS011.                                                05770000
057800                                                                  05780000
057900*                                                                 05790000
058000*  DATE VALIDATION CALLING PARAMETER LIST                        *05800000
058100*                                                                 05810000
058200     COPY DPWS500.                                                05820000
058300                                                                  05830000
058900*                                                                 05890006
059000     COPY SUWS108.                                                05900006
059100/                                                                 05910000
059200*    COMMAREAS FOR CALLED PROGRAMS                                05920000
059300*                                                                 05930000
059400*    DLKUP001 COMMAREA                                            05940000
059500     COPY DLWS001.                                                05950000
059600                                                                  05960000
059700*---------------------------------------------------------------* 05970000
059800*    DLKCS410 COMMAREA                                            05980000
059900*---------------------------------------------------------------* 05990000
060000     COPY DLWS016.                                                06000000
060100                                                                  06010000
060200*---------------------------------------------------------------* 06020000
060300*    XLKUP033 COMMAREA                                            06030000
060400*---------------------------------------------------------------* 06040000
060500     COPY XLWS072.                                                06050000
060600                                                                  06060000
060700*---------------------------------------------------------------* 06070000
060800*    XLKUP033 DATA                                                06080000
060900*---------------------------------------------------------------* 06090000
061000     COPY SUWS050.                                                06100000
061100*---------------------------------------------------------------* 06110000
061200*    TEMPLATE                                                     06120000
061300*---------------------------------------------------------------* 06130000
061400     COPY DLWS011.                                                06140000
061500/                                                                 06150000
061600*----------------------------------------------------------------*06160000
061700*  RANDOM NUMBER AREA                                            *06170000
061800*----------------------------------------------------------------*06180000
061900     COPY DPWS902.                                                06190000
062000                                                                  06200000
062100                                                                  06210000
062200*                                                                 06220000
062300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE KOHLS/RETEK        06230000
062400*  PARM TABLE                                                     06240000
062500     EXEC SQL                                                     06250000
062600          INCLUDE TKRPRPM                                         06260000
062700     END-EXEC.                                                    06270000
062800                                                                  06280000
062900*                                                                 06290000
063000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRIP STATUS TABLE  06300000
063100     EXEC SQL                                                     06310000
063200         INCLUDE TTRIPST                                          06320000
063300     END-EXEC.                                                    06330000
063400                                                                  06340000
063500*                                                                 06350000
063600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRIP STATUS CODE   06360000
063700*  TABLE                                                          06370000
063800     EXEC SQL                                                     06380000
063900         INCLUDE TTRSTYP                                          06390000
064000     END-EXEC.                                                    06400000
064100                                                                  06410000
064200*                                                                 06420000
064300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE VEH TRIP TABLE     06430000
064400     EXEC SQL                                                     06440000
064500         INCLUDE TVHTRIP                                          06450000
064600     END-EXEC.                                                    06460000
064700                                                                  06470000
064800*                                                                 06480000
064900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE DOMAIN USER TABLE  06490000
065000*  TABLE                                                          06500000
065100     EXEC SQL                                                     06510000
065200         INCLUDE XLT00024                                         06520000
065300     END-EXEC.                                                    06530000
065400*                                                                 06540000
065500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CONTROL DC DOOR    06550000
065600*  TABLE                                                          06560000
065700     EXEC SQL                                                     06570000
065800          INCLUDE TCNDCDR                                         06580000
065900     END-EXEC.                                                    06590000
066000                                                                  06600000
066100*                                                                 06610000
066200*  INBOUND CARTON DATABASE                                        06620000
066300*                                                                 06630000
066400     EXEC SQL                                                     06640000
066500          INCLUDE TSHPUNT                                         06650000
066600     END-EXEC.                                                    06660000
066700                                                                  06670000
066800*  LOCATION DOMAIN TABLE                                          06680000
066900     EXEC SQL                                                     06690000
067000          INCLUDE XLT00010                                        06700000
067100     END-EXEC.                                                    06710000
067200                                                                  06720000
067300******************************************************************06730000
067400*  LABEL REQUEST MESSAGE TABLE (SUT_LBL_REQ_MSG)                  06740000
067500******************************************************************06750000
067600     EXEC SQL                                                     06760000
067700          INCLUDE SUT00043                                        06770000
067800     END-EXEC.                                                    06780000
067900                                                                  06790000
068000******************************************************************06800000
068100*  DIVERT MODULE REASON CODE TABLE (SUT_ACM_DIVERT)               06810000
068200******************************************************************06820000
068300     EXEC SQL                                                     06830000
068400          INCLUDE SUT00045                                        06840000
068500     END-EXEC.                                                    06850000
068600                                                                  06860000
068700******************************************************************06870000
068800*  CARTON LABEL REQUEST REASON CODE TABLE (SUT_ACM_CART_LBL)      06880000
068900******************************************************************06890000
069000     EXEC SQL                                                     06900000
069100          INCLUDE SUT00046                                        06910000
069200     END-EXEC.                                                    06920000
069300                                                                  06930000
069400******************************************************************06940000
069500*    SUT_INBD_TRIP_DOOR                                           06950000
069600******************************************************************06960000
069700     EXEC SQL                                                     06970000
069800         INCLUDE SUT00040                                         06980000
069900     END-EXEC.                                                    06990000
070000                                                                  07000000
070100******************************************************************07010000
070200*    SUT_PNA_STA                                                  07020000
070300******************************************************************07030000
070400     EXEC SQL                                                     07040000
070500         INCLUDE SUT00107                                         07050000
070600     END-EXEC.                                                    07060000
070700                                                                  07070000
070800******************************************************************07080000
070900*    SUT_PNA_STA_DOOR                                             07090000
071000******************************************************************07100000
071100     EXEC SQL                                                     07110000
071200         INCLUDE SUT00109                                         07120000
071300     END-EXEC.                                                    07130000
071400                                                                  07140000
071500******************************************************************07150000
071600*    wft_dat_xfer - 1 to many detail                              07160000
071700******************************************************************07170000
071800     EXEC SQL                                                     07180000
071900         INCLUDE wft00005                                         07190000
072000     END-EXEC.                                                    07200000
072100                                                                  07210000
072200******************************************************************07220000
072300*    wft_dat_cntl - 1 header                                      07230000
072400******************************************************************07240000
072500     EXEC SQL                                                     07250000
072600         INCLUDE wft00004                                         07260000
072700     END-EXEC.                                                    07270000
072800                                                                  07280000
072900*                                                                 07290000
073000*  COMMUNICATIONS AREA FOR DB2                                    07300000
073100*                                                                 07310000
073200     EXEC SQL                                                     07320000
073300         INCLUDE SQLCA                                            07330000
073400     END-EXEC.                                                    07340000
073500     COPY SQLCA2.                                                 07350000
073600*                                                                 07360000
073700 01  PC-PROGRAM-CONSTANTS.                                        07370000
073800     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        07380000
073900         'SUKCS781'.                                              07390016
074000*    05  PC-CALENDAR-PGM                 PIC  X(08)  VALUE        07400000
074100*        'DPKUT500'.                                              07410000
074200*                                                                 07420000
074300 01  PS-PROGRAM-SWITCHES.                                         07430000
074400     05  PS-ACTIVE-XREF-ROW-FOUND-SW     PIC  X(01)  VALUE 'Y'.   07440000
074500         88  PS-ACTIVE-XREF-ROW-FOUND                VALUE 'Y'.   07450000
074600         88  PS-ACTIVE-XREF-ROW-NOT-FOUND            VALUE 'N'.   07460000
074700*                                                                 07470000
074800                                                                  07480000
074900**                                                                07490000
075000 PROCEDURE DIVISION.                                              07500000
075100                                                                  07510000
075200 0000-PROGRAM-MAINLINE.                                           07520000
075300                                                                  07530000
075400     SET  PS-INITIAL-START-YES                                    07540000
075500          PS-CSSL-LOGGING-NO                                      07550000
075600          PS-CAPTURE-DATA-NO                                      07560000
075700          PS-BLD-INTERNAL-TABLE-NO  to  true.                     07570000
075800                                                                  07580000
075900     MOVE ' 0000-PROGRAM-MAINLINE'                                07590000
076000                                 TO DP013-PARAGRAPH.              07600000
076100     MOVE EIBTASKN               TO PV-TASK                       07610000
076200     STRING ' SUKCS781 06/04 -STARTED - TASK = ' PV-TASK-X        07620016
076300         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  07630000
076400     PERFORM 9990-WRITE-CICS                                      07640000
076500                                                                  07650000
076600     MOVE SPACES                 TO PT-MSG-TABLE.                 07660000
076700     SET PT-MSG-IDX              TO 1.                            07670000
076800     MOVE EIBTASKN               TO PT-TASK(PT-MSG-IDX)           07680000
076900     MOVE ' SUKCS781 - STARTED'  TO PT-MESSAGE(PT-MSG-IDX)        07690016
077000                                                                  07700000
077100     PERFORM 1000-GET-COMMAREA-FROM-LSTNR.                        07710000
077200                                                                  07720000
077300* JUST FOR TESTING - BEGIN                                        07730000
077400*    STRING ' COMMAREA = ' DP081-LSTN-TCPSOCKET-PARM              07740000
077500*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  07750000
077600*    PERFORM 9990-WRITE-CICS                                      07760000
077700* JUST FOR TESTING - END                                          07770000
077800                                                                  07780000
077900     PERFORM 1100-TAKE-SOCKET.                                    07790000
078000                                                                  07800000
078100     PERFORM 1200-CONFIRM-CONNECTION.                             07810000
078200                                                                  07820000
078300     PERFORM 4420-SELECT-SOCKET-TIMEOUT                           07830000
078400     PERFORM 9000-SYNCPOINT.                                      07840000
078500                                                                  07850000
078600     INITIALIZE   PV-HOLD-DC-NBR                                  07860000
078700                  PV-HOLD-TRIP-ID                                 07870000
078800                  PV-HOLD-DOOR-ID                                 07880000
078900                  PV-HOLD-USER-ID.                                07890000
079000                                                                  07900000
079100     PERFORM 2000-PROCESS-DIVERT-REQUEST                          07910000
079200         UNTIL PS-ERROR-RECEIVE.                                  07920000
079300                                                                  07930000
079400* JUST FOR TESTING - BEGIN                                        07940000
079500*    INITIALIZE PV-CICS-MSG-AREA                                  07950000
079600*    STRING ' SUKCS781 - BEGIN OF GOOD CLOSE SOCKET '             07960016
079700*                TCP-BUF                                          07970000
079800*    DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                     07980000
079900*    PERFORM 9990-WRITE-CICS.                                     07990000
080000* JUST FOR TESTING - END                                          08000000
080100                                                                  08010000
080200*    PERFORM 1500-CLOSE-SOCKET.                                   08020000
080300                                                                  08030000
080400     SET PT-MSG-IDX              UP BY 1.                         08040000
080500     MOVE EIBTASKN               TO PT-TASK(PT-MSG-IDX)           08050000
080600     MOVE ' SUKCS781 - CLOSE SOCKET OK'                           08060016
080700                                 TO PT-MESSAGE(PT-MSG-IDX)        08070000
080800                                                                  08080000
080900     STRING ' SUKCS781 SUCCESSFUL - TASK = ' PV-TASK-X            08090016
081000         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  08100000
081100     PERFORM 9990-WRITE-CICS                                      08110000
081200                                                                  08120000
081300     GOBACK.                                                      08130000
081400/                                                                 08140000
081500************************************************************      08150000
081600* THE LISTENER HAS BEEN STARTED AND A SOCKET HAS BEEN      *      08160000
081700* ESTABLISHED WITHIN THE LISTENER PROGRAM.  THE LISTENER   *      08170000
081800* PROGRAM IN TURN WILL START THIS PROGRAM, SO WE MUST      *      08180000
081900* DO A RETREIVE TO GET THE COMMAREA WHICH WAS PASSED.      *      08190000
082000************************************************************      08200000
082100 1000-GET-COMMAREA-FROM-LSTNR.                                    08210000
082200                                                                  08220000
082300     MOVE ' 1000-GET-COMMAREA-FROM-LSTNR'                         08230000
082400                                 TO DP013-PARAGRAPH.              08240000
082500     MOVE LENGTH OF DP081-LSTN-TCPSOCKET-PARM                     08250000
082600                                          TO  PV-RECEIVE-LENGTH.  08260000
082700                                                                  08270000
082800     EXEC CICS                                                    08280000
082900         RETRIEVE                                                 08290000
083000             INTO    (DP081-LSTN-TCPSOCKET-PARM)                  08300000
083100             LENGTH  (PV-RECEIVE-LENGTH)                          08310000
083200             RESP    (PV-CICS-RESPONSE)                           08320000
083300     END-EXEC.                                                    08330000
083400                                                                  08340000
083500     EVALUATE TRUE                                                08350000
083600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08360000
083700             CONTINUE                                             08370000
083800         WHEN OTHER                                               08380000
083900             MOVE ' 1000-GET-COMMAREA-FROM-LSTNR'                 08390000
084000                 TO DP013-PARAGRAPH                               08400000
084100             MOVE 'UNABLE TO RETRIEVE COMMAREA FROM LISTENER'     08410000
084200                 TO DP013-MESSAGE-TEXT (1)                        08420000
084300             PERFORM 9999-WRITE-CICS-LOG-MSG                      08430000
084400     END-EVALUATE.                                                08440000
084500/                                                                 08450000
084600*----------------------------------------------------------------*08460000
084700*  ACQUIRE A SOCKET FROM ANOTHER PROGRAM AND CREATE A NEW SOCKET.*08470000
084800*----------------------------------------------------------------*08480000
084900 1100-TAKE-SOCKET.                                                08490000
085000                                                                  08500000
085100     MOVE ' 1100-TAKE-SOCKET'                                     08510000
085200                                 TO DP013-PARAGRAPH.              08520000
085300* JUST FOR TESTING - BEGIN                                        08530000
085400*    STRING 'SUKCS781 - 1100-TAKE-SOCKET' DELIMITED BY SIZE       08540016
085500*    INTO PV-CICS-MSG-AREA                                        08550000
085600*    PERFORM 9990-WRITE-CICS                                      08560000
085700* JUST FOR TESTING - END                                          08570000
085800                                                                  08580000
085900     MOVE DP081-AF-INET               TO DP081-CID-DOMAIN-LSTN.   08590000
086000     MOVE DP081-LSTN-NAME             TO DP081-CID-NAME-LSTN.     08600000
086100****TESTING - BEGIN                                               08610000
086200         SET PT-MSG-IDX              UP BY 1                      08620000
086300         MOVE DP081-CID-DOMAIN-LSTN   TO PV-CID-DOMAIN-LSTN       08630000
086400****TESTING - END                                                 08640000
086500     MOVE DP081-LSTN-SUBTASKNAME      TO                          08650000
086600                                       DP081-CID-SUBTASKNAME-LSTN.08660000
086700     MOVE DP081-LSTN-GIVE-TAKE-SOCKET TO DP081-SOCK-ID.           08670000
086800****TESTING - BEGIN                                               08680000
086900*        SET PT-MSG-IDX              UP BY 1                      08690000
087000*        STRING                                                   08700000
087100*             'SUKCS781 - 1100-TAKE-SOCKET-RES '                  08710016
087200*             DP081-CID-RES-LSTN          DELIMITED BY SIZE       08720000
087300*                             INTO PT-MESSAGE(PT-MSG-IDX)         08730000
087400****TESTING - END                                                 08740000
087500     CALL 'EZASOKET'                                              08750000
087600         USING                                                    08760000
087700                DP081-TAKESOCKET-CMD                              08770000
087800                DP081-SOCK-ID                                     08780000
087900                DP081-CLIENTID-LSTN                               08790000
088000                DP081-ERRNO                                       08800000
088100                DP081-RETCODE.                                    08810000
088200                                                                  08820000
088300* IF THE TAKESOCKET IS SUCCESSFUL, THE NEW SOCKET ID IS           08830000
088400*  CONTAINED IN THE RETCODE                                       08840000
088500                                                                  08850000
088600     IF DP081-RETCODE >= ZERO                                     08860000
088700         MOVE DP081-RETCODE           TO DP081-SOCK-ID            08870000
088800     ELSE                                                         08880000
088900         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        08890000
089000         SET  DP081-TCP-IP-TAKE-ERR TO TRUE                       08900000
089100*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE08910000
089200*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  08920000
089300*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               08930000
089400*   DP013-MESSAGE-TEXT GROUP LEVEL.                               08940000
089500         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          08950000
089600         SET  DP013-OTHER-ABEND   TO TRUE                         08960000
089700         SET  DP013-NO-ROLLBACK   TO TRUE                         08970000
089800         MOVE ' 1100-TAKE-SOCKET' TO DP013-PARAGRAPH              08980000
089900         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  08990000
090000         PERFORM 9999-WRITE-CICS-LOG-MSG                          09000000
090100     END-IF.                                                      09010000
090200/                                                                 09020000
090300*----------------------------------------------------------------*09030000
090400*    CONFIRM THE CONNECTION ON THE SOCKET THAT WE RECEIVED FROM  *09040000
090500*    THE PACK TO LIGHT SYSTEM.                                   *09050000
090600*----------------------------------------------------------------*09060000
090700 1200-CONFIRM-CONNECTION.                                         09070000
090800                                                                  09080000
090900     MOVE ' 1200-CONFIRM-CONNECTION'                              09090000
091000                                 TO DP013-PARAGRAPH.              09100000
091100* JUST FOR TESTING - BEGIN                                        09110000
091200*    STRING 'SUKCS781 - 1200-CONFIRM-CONNECTION' DELIMITED BY SIZE09120016
091300*    INTO PV-CICS-MSG-AREA                                        09130000
091400*    PERFORM 9990-WRITE-CICS                                      09140000
091500* JUST FOR TESTING - END                                          09150000
091600                                                                  09160000
091700     MOVE SPACES  TO  TCP-BUF2.                                   09170000
091800     MOVE PC-CR    TO TASK-START-CR.                              09180000
091900     MOVE EIBTRNID TO TASK-START-TRAN.                            09190000
092000     MOVE TASK-START TO TCP-BUF.                                  09200000
092100     MOVE 32      TO  DP081-NBR-BYTES                             09210000
092200                      DP081-TCPLENG.                              09220000
092300                                                                  09230000
092400* JUST FOR TESTING - BEGIN                                        09240000
092500*    STRING TCP-BUF  DELIMITED BY SIZE                            09250000
092600*    INTO PV-CICS-MSG-AREA                                        09260000
092700*    PERFORM 9990-WRITE-CICS                                      09270000
092800* JUST FOR TESTING - END                                          09280000
092900                                                                  09290000
093000* TRANSLATE EBCDIC TO ASCII                                       09300000
093100     CALL 'EZACIC04'                                              09310000
093200         USING  DP081-TOASCII-TOKEN                               09320000
093300                TCP-BUF                                           09330000
093400                DP081-TCPLENG.                                    09340000
093500                                                                  09350000
093600* WRITE DATA ON A CONNECTED SOCKET                                09360000
093700     CALL 'EZASOKET'                                              09370000
093800         USING  DP081-WRITE-CMD                                   09380000
093900                DP081-SOCK-ID                                     09390000
094000                DP081-NBR-BYTES                                   09400000
094100                TCP-BUF                                           09410000
094200                DP081-ERRNO                                       09420000
094300                DP081-RETCODE.                                    09430000
094400*                                                                 09440000
094500     IF DP081-RETCODE < ZERO                                      09450000
094600         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        09460000
094700         SET  DP081-TCP-IP-WRITE-ERR TO TRUE                      09470000
094800*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         09480000
094900*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE09490000
095000*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  09500000
095100*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               09510000
095200*   DP013-MESSAGE-TEXT GROUP LEVEL.                               09520000
095300         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          09530000
095400         SET  DP013-OTHER-ABEND   TO TRUE                         09540000
095500         SET  DP013-NO-ROLLBACK   TO TRUE                         09550000
095600         MOVE ' 1200-CONFIRM-CONNECTION'                          09560000
095700             TO DP013-PARAGRAPH                                   09570000
095800         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  09580000
095900         PERFORM 9999-WRITE-CICS-LOG-MSG                          09590000
096000     END-IF.                                                      09600000
096100*----------------------------------------------------------------*09610000
096200*    CLOSE THE SOCKET GIVEN TO US BY THE PACK TO LIGHT SYSTEM.   *09620000
096300*----------------------------------------------------------------*09630000
096400 1500-CLOSE-SOCKET.                                               09640000
096500                                                                  09650000
096600     MOVE ' 1500-CLOSE-SOCKET'                                    09660000
096700                                 TO DP013-PARAGRAPH.              09670000
096800* JUST FOR TESTING - BEGIN                                        09680000
096900*    STRING 'SUKCS781 - 1500-CLOSE-SOCKET' DELIMITED BY SIZE      09690016
097000*    INTO PV-CICS-MSG-AREA                                        09700000
097100*    PERFORM 9990-WRITE-CICS                                      09710000
097200* JUST FOR TESTING - END                                          09720000
097300                                                                  09730000
097400* CLOSE THE CONNECTED SOCKET                                      09740000
097500     SET PS-SOCKET-CLOSED   TO TRUE.                              09750000
097600                                                                  09760000
097700     CALL 'EZASOKET'                                              09770000
097800         USING                                                    09780000
097900                DP081-CLOSE-CMD                                   09790000
098000                DP081-SOCK-ID                                     09800000
098100                DP081-ERRNO                                       09810000
098200                DP081-RETCODE.                                    09820000
098300                                                                  09830000
098400     IF DP081-RETCODE < ZERO                                      09840000
098500         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        09850000
098600         SET  DP081-TCP-IP-CLOSE-ERR TO TRUE                      09860000
098700*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         09870000
098800*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE09880000
098900*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  09890000
099000*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               09900000
099100*   DP013-MESSAGE-TEXT GROUP LEVEL.                               09910000
099200         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          09920000
099300         SET  DP013-OTHER-ABEND   TO TRUE                         09930000
099400         SET  DP013-NO-ROLLBACK   TO TRUE                         09940000
099500         MOVE ' 1500-CLOSE-SOCKET'                                09950000
099600             TO DP013-PARAGRAPH                                   09960000
099700         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  09970000
099800         PERFORM 9999-WRITE-CICS-LOG-MSG                          09980000
099900     END-IF.                                                      09990000
100000                                                                  10000000
100100                                                                  10010000
100200*---------------------------------------------------------------* 10020000
100300* BUILD INTERNAL TABLE WITN PARAGRAPH TRACKING                  * 10030000
100400* DMH - 12/22/14                                                * 10040000
100500*---------------------------------------------------------------* 10050000
100600 1600-INTERNAL-TABLE.                                             10060000
100700                                                                  10070000
100800     PERFORM 1800-GET-CURRENT-TMST.                               10080000
100900     ADD  +1  TO  PT-CURR-ENTRIES.                                10090000
101000     SET  PT-TRACK-IDX to PT-CURR-ENTRIES                         10100000
101100                                                                  10110000
101200     MOVE 'SUKCS781'           TO PT-PROGRAM(PT-TRACK-IDX).       10120016
101300     move pt-curr-entries      TO PT-INDEX-NBR(PT-TRACK-IDX).     10130000
101400     MOVE PT-CURR-PARA         TO PT-PARAGRAPH(PT-TRACK-IDX).     10140000
101500     MOVE PV-CURRENT-PARA-TMST TO PT-TIMESTAMP(PT-TRACK-IDX).     10150000
101600     MOVE PV-DURATION-SEC      TO PT-DURATION(PT-TRACK-IDX).      10160000
101700                                                                  10170000
101800     move PV-DURATION-nano-sec    to PV-work-nano-sec.            10180000
101900     move PV-work-nano-min-1-2    to PV-disp-nano-min-1-2.        10190000
102000     move '-'                     to pv-disp-nano-dash-1.         10200000
102100     move PV-work-nano-sec-3-4    to PV-disp-nano-sec-3-4.        10210000
102200     move '-'                     to pv-disp-nano-dash-2.         10220000
102300     move PV-work-nano-micro-5-10 to PV-disp-nano-micro-5-10.     10230000
102400     MOVE PV-disp-nano-sec     TO PT-NANO-SEC(PT-TRACK-IDX).      10240000
102500                                                                  10250000
102600     MOVE SU051-DC-NUMBER      TO PT-DC(PT-TRACK-IDX).            10260000
102700     MOVE SU051-ACCM-LINE-NMBR TO PT-PNA-STA(PT-TRACK-IDX).       10270000
102800     MOVE PV-INIT-TIME-KEY     TO PT-START-HHMMSS(PT-TRACK-IDX).  10280000
102900                                                                  10290000
103000     IF  PS-CSSL-LOGGING-YES                                      10300000
103100         INITIALIZE PV-CICS-MSG-AREA                              10310000
103200         MOVE PT-ENTRIES(PT-TRACK-IDX)  TO PV-CICS-MSG-AREA       10320000
103300         PERFORM 9990-WRITE-CICS                                  10330000
103400     END-IF                                                       10340000
103500                                                                  10350000
103600     IF  PT-TRACK-IDX >=  PT-MAX-PARA-ENTRIES                     10360000
103700         MOVE ZEROES TO PT-CURR-ENTRIES                           10370000
103800         SET  PT-TRACK-IDX  to PT-CURR-ENTRIES                    10380000
103900     END-IF.                                                      10390000
104000                                                                  10400000
104100*---------------------------------------------------------------* 10410000
104200*                                                               * 10420000
104300* DMH - 12/22/14                                                * 10430000
104400*---------------------------------------------------------------* 10440000
104500 1610-BUILD-MESSAGE-DISPLAY.                                      10450000
104600                                                                  10460000
104700     IF  PS-CSSL-LOGGING-YES                                      10470000
104800         PERFORM 1800-GET-CURRENT-TMST                            10480000
104900     end-if.                                                      10490000
105000                                                                  10500000
105100     MOVE  1  TO  PT-CURR-ENTRIES                                 10510000
105200                                                                  10520000
105300     SET  PT-TRACK-IDX TO PT-CURR-ENTRIES.                        10530000
105400                                                                  10540000
105500     MOVE 'SUKCS781'           TO PT-PROGRAM(PT-TRACK-IDX).       10550016
105600     MOVE +1                   TO PT-INDEX-NBR(PT-TRACK-IDX).     10560000
105700     MOVE PT-CURR-PARA         TO PT-PARAGRAPH(PT-TRACK-IDX).     10570000
105800     MOVE PV-CURRENT-PARA-TMST TO PT-TIMESTAMP(PT-TRACK-IDX).     10580000
105900     MOVE PV-DURATION-SEC      TO PT-DURATION(PT-TRACK-IDX).      10590000
106000                                                                  10600000
106100     move PV-DURATION-nano-sec    to PV-work-nano-sec.            10610000
106200     move PV-work-nano-min-1-2    to PV-disp-nano-min-1-2.        10620000
106300     move '-'                     to pv-disp-nano-dash-1.         10630000
106400     move PV-work-nano-sec-3-4    to PV-disp-nano-sec-3-4.        10640000
106500     move '-'                     to pv-disp-nano-dash-2.         10650000
106600     move PV-work-nano-micro-5-10 to PV-disp-nano-micro-5-10.     10660000
106700     MOVE PV-disp-nano-sec     TO PT-NANO-SEC(PT-TRACK-IDX).      10670000
106800                                                                  10680000
106900     MOVE SU051-DC-NUMBER      TO PT-DC(PT-TRACK-IDX).            10690000
107000     MOVE SU051-ACCM-LINE-NMBR TO PT-PNA-STA(PT-TRACK-IDX).       10700000
107100     MOVE PV-INIT-TIME-KEY     TO PT-START-HHMMSS(PT-TRACK-IDX).  10710000
107200                                                                  10720000
107300     IF  PS-CSSL-LOGGING-YES                                      10730000
107400         INITIALIZE PV-CICS-MSG-AREA                              10740000
107500         MOVE PT-ENTRIES(PT-TRACK-IDX)  TO PV-CICS-MSG-AREA       10750000
107600         PERFORM 9990-WRITE-CICS                                  10760000
107700     END-IF.                                                      10770000
107800                                                                  10780000
107900                                                                  10790000
108000*---------------------------------------------------------------* 10800000
108100*                                                               * 10810000
108200* DMH - 12/22/14                                                * 10820000
108300*---------------------------------------------------------------* 10830000
108400 1620-WRITE-SUWS051-TO-CSSL.                                      10840000
108500                                                                  10850000
108600     INITIALIZE PV-CICS-MSG-AREA                                  10860000
108700                                                                  10870000
108800     MOVE SQLCODE                  TO PV-DISP-SQLCODE             10880000
108900     MOVE SU051-DC-NUMBER          TO PV-DISP-DC                  10890000
109000     MOVE SU051-TRIP-ID            TO PV-DISP-TRIP                10900000
109100     MOVE SU051-ACCM-LINE-NMBR     TO PV-DISP-PNA-STA             10910000
109200                                                                  10920000
109300     STRING  ' SUKCS781 1620-'                                    10930016
109400             ' DC:'     PV-DISP-DC                                10940000
109500             ' B1:'     SU051-BAR-CODE-1                          10950000
109600             ' B2:'     SU051-BAR-CODE-2                          10960000
109700             ' B3:'     SU051-BAR-CODE-3                          10970000
109800                        DELIMITED BY SIZE                         10980000
109900                   INTO PV-CICS-MSG-AREA                          10990000
110000                                                                  11000000
110100     PERFORM 9990-WRITE-CICS                                      11010000
110200                                                                  11020000
110300     INITIALIZE PV-CICS-MSG-AREA                                  11030000
110400     STRING  ' SUKCS781 '                                         11040016
110500             ' TRIP:'   PV-DISP-TRIP                              11050000
110600             ' DR:'     SU051-DOOR-NUMBER                         11060000
110700             ' USR:'    SU051-USER-ID                             11070000
110800             ' STA:'    PV-DISP-PNA-STA                           11080000
110900             ' SQL:'    PV-DISP-SQLCODE                           11090000
111000                        DELIMITED BY SIZE                         11100000
111100                   INTO PV-CICS-MSG-AREA                          11110000
111200                                                                  11120000
111300     PERFORM 9990-WRITE-CICS.                                     11130000
111400                                                                  11140000
111500                                                                  11150000
111600*---------------------------------------------------------------* 11160000
111700*                                                               * 11170000
111800* DMH - 12/22/14                                                * 11180000
111900*---------------------------------------------------------------* 11190000
112000 1630-DUMP-TABLE-TO-CSSL.                                         11200000
112100                                                                  11210000
112200     INITIALIZE PV-CICS-MSG-AREA                                  11220000
112300                                                                  11230000
112400     MOVE PT-ENTRIES(PT-TRACK-IDX)  TO PV-CICS-MSG-AREA           11240000
112500                                                                  11250000
112600     PERFORM 9990-WRITE-CICS.                                     11260000
112700                                                                  11270000
112800                                                                  11280000
112900*---------------------------------------------------------------* 11290000
113000*                                                               * 11300000
113100* DMH - 12/22/14                                                * 11310000
113200*---------------------------------------------------------------* 11320000
113300 1640-CLEAR-TABLE.                                                11330000
113400                                                                  11340000
113500     MOVE  SPACES  TO  PT-PROGRAM(PT-TRACK-IDX).                  11350000
113600     MOVE  ZEROES  TO  PT-INDEX-NBR(PT-TRACK-IDX).                11360000
113700     MOVE  SPACES  TO  PT-PARAGRAPH(PT-TRACK-IDX).                11370000
113800     MOVE  SPACES  TO  PT-TIMESTAMP(PT-TRACK-IDX).                11380000
113900     MOVE  ZEROES  TO  PT-DURATION(PT-TRACK-IDX).                 11390000
114000                                                                  11400000
114100                                                                  11410000
114200*---------------------------------------------------------------* 11420000
114300*                                                               * 11430000
114400* DMH - 12/22/14                                                * 11440000
114500*---------------------------------------------------------------* 11450000
114600 1800-GET-CURRENT-TMST.                                           11460000
114700     EXEC SQL                                                     11470000
114800          SET :PV-CURRENT-PARA-TMST = CURRENT TIMESTAMP           11480000
114900     END-EXEC.                                                    11490000
115000                                                                  11500000
115100     EXEC SQL                                                     11510000
115200          SELECT                                                  11520000
115300                 TIMESTAMPDIFF( 2 ,CHAR(:PV-CURRENT-PARA-TMST     11530000
115400                   - TIMESTAMP(:PV-RECEIVE-RQST-TMST)))           11540000
115500               , TIMESTAMPDIFF( 1 ,CHAR(:PV-CURRENT-PARA-TMST     11550000
115600                   - TIMESTAMP(:PV-RECEIVE-RQST-TMST)))           11560000
115700            INTO :PV-DURATION-SEC                                 11570000
115800               , :PV-DURATION-nano-sec                            11580000
115900            FROM  SYSIBM.SYSDUMMY1                                11590000
116000     END-EXEC.                                                    11600000
116100                                                                  11610000
116200                                                                  11620000
116300                                                                  11630000
116400******************************************************************11640000
116500*    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 11650000
116600******************************************************************11660000
116700 2000-PROCESS-DIVERT-REQUEST.                                     11670000
116800                                                                  11680000
116900                                                                  11690000
117000     MOVE ' 2000-PROCESS-DIVERT-REQUEST'                          11700000
117100                                 TO DP013-PARAGRAPH.              11710000
117200******************************************************************11720000
117300**CHECK SOCKET CONNECTION                                        *11730000
117400******************************************************************11740000
117500                                                                  11750000
117600     PERFORM 2100-RECEIVE-DATA-FROM-ASI.                          11760000
117700                                                                  11770000
117800     IF NOT PS-ERROR-RECEIVE                                      11780000
117900        EXEC SQL                                                  11790000
118000            SET :PV-RECEIVE-RQST-TMST = CURRENT TIMESTAMP         11800000
118100        END-EXEC                                                  11810000
118200                                                                  11820000
118300        MOVE  PV-INIT-HH    TO  PV-INIT-KEY-HH                    11830000
118400        MOVE  PV-INIT-MM    TO  PV-INIT-KEY-MM                    11840000
118500        MOVE  PV-INIT-SS    TO  PV-INIT-KEY-SS                    11850000
118600                                                                  11860000
118700        if  PS-INITIAL-START-YES                                  11870000
118800            INITIALIZE PV-CICS-MSG-AREA                           11880000
118900            STRING ' SUKCS781 2000'                               11890016
119000                   ' TASK:'                 PV-TASK-X             11900000
119100                   ' PV-RECEIVE-RQST-TMST:' PV-RECEIVE-RQST-TMST  11910000
119200                   ' PV-INIT-TIME-KEY:'     PV-INIT-TIME-KEY      11920000
119300                                            DELIMITED BY SIZE     11930000
119400                                       INTO PV-CICS-MSG-AREA      11940000
119500            PERFORM 9990-WRITE-CICS                               11950000
119600        END-IF                                                    11960000
119700                                                                  11970000
119800        INITIALIZE PV-CICS-MSG-AREA                               11980000
119900        MOVE DP081-RETCODE TO PV-RETCODE                          11990000
120000        MOVE DP081-TCPLENG TO PV-TCPLENG                          12000000
120100        MOVE DP081-ERRNO   TO PV-ERRNO                            12010000
120200                                                                  12020000
120300        PERFORM 2040-SELECT-PNA-STATION                           12030000
120400                                                                  12040000
120500        IF  PS-INITIAL-START-YES                                  12050000
120600            STRING ' SUKCS781 2000'                               12060016
120700                   ' TASK:'     PV-TASK-X                         12070000
120800                   ' DC:'       SU051-DC-NUMBER                   12080000
120900                   ' PNA:'     SU051-ACCM-LINE-NMBR               12090000
121000                   ' DR:'      SU051-DOOR-NUMBER                  12100000
121100                   ' INITIAL STARTUP'                             12110000
121200                                DELIMITED BY SIZE                 12120000
121300                           inTO PV-CICS-MSG-AREA                  12130000
121400            PERFORM 9990-WRITE-CICS                               12140000
121500                                                                  12150000
121600            set  PS-INITIAL-START-no  to  true                    12160000
121700                                                                  12170000
121800        END-IF                                                    12180000
121900                                                                  12190000
122000                                                                  12200000
122100        IF PS-DUAL-FEED-ON                                        12210000
122200           PERFORM 6000-CALL-SUKUT709                             12220000
122300           MOVE SU092-USER-ID  TO SU051-USER-ID                   12230000
122400           MOVE SU092-TRIP-ID  TO SU051-TRIP-ID                   12240000
122500           MOVE SU092-DOOR-ID  TO SU051-DOOR-NUMBER               12250000
122600        ELSE                                                      12260000
122700           MOVE SU051-DC-NUMBER          TO TRIPST-OPER-UNT-ID    12270000
122800           MOVE SU051-TRIP-ID            TO TRIPST-TRIP-ID        12280000
122900                                            PV-DISPLAY-TRIP-ID    12290000
123000           MOVE SU051-DOOR-NUMBER        TO DK-DOOR-ID            12300000
123100           MOVE SU051-USER-ID            TO DK-USER-ID            12310000
123200        END-IF                                                    12320000
123300                                                                  12330000
123400        MOVE SU051-ACCM-LINE-NMBR  TO                             12340000
123500                             SUT00107-ACM-LBL-STA-NBR             12350000
123600                                                                  12360000
123700        perform 4403-CHECK-FOR-CAPTURE                            12370000
123800                                                                  12380000
123900        IF (SU051-DC-NUMBER   =  PV-HOLD-DC-NBR)  AND             12390000
124000           (SU051-TRIP-ID     =  PV-HOLD-TRIP-ID) AND             12400000
124100           (SU051-DOOR-NUMBER =  PV-HOLD-DOOR-ID) AND             12410000
124200           (SU051-USER-ID     =  PV-HOLD-USER-ID)                 12420000
124300              CONTINUE                                            12430000
124400        ELSE                                                      12440000
124500            PERFORM 4405-CHECK-FOR-LOGGING                        12450000
124600            PERFORM 4407-CHECK-PARA-TRACK-sec                     12460000
124700                                                                  12470000
124800            MOVE  '2000'  TO  PT-CURR-PARA                        12480000
124900            IF  PS-BLD-INTERNAL-TABLE-YES                         12490000
125000                PERFORM 1600-INTERNAL-TABLE                       12500000
125100            else                                                  12510000
125200                MOVE 1            TO PT-CURR-ENTRIES              12520000
125300                SET  PT-TRACK-IDX to PT-CURR-ENTRIES              12530000
125400                perform 1610-BUILD-MESSAGE-DISPLAY                12540000
125500            END-IF                                                12550000
125600                                                                  12560000
125700            IF PS-DUAL-FEED-OFF                                   12570000
125800                PERFORM 4000-VALIDATE-TRIP-ID                     12580000
125900                IF PS-INPUT-DATA-ERROR-NO AND PS-DB2-ERROR-NO     12590000
126000                   PERFORM 4100-VALIDATE-DOOR-ID                  12600000
126100                END-IF                                            12610000
126200                IF PS-INPUT-DATA-ERROR-NO AND PS-DB2-ERROR-NO     12620000
126300                   PERFORM 4200-VALIDATE-USER-ID                  12630000
126400                END-IF                                            12640000
126500                IF PS-INPUT-DATA-ERROR-NO AND PS-DB2-ERROR-NO     12650000
126600                   PERFORM 4410-CHECK-P2L-FRCD-DIVERT             12660000
126700                END-IF                                            12670000
126800            ELSE                                                  12680000
126900*CLP 03-13-2017                                                   12690000
127000                PERFORM 2030-GET-DC-PADCLS                        12700000
127100                IF PS-DC-PADCLS-FOUND                             12710000
127200                   IF PS-INPUT-DATA-ERROR-NO AND PS-DB2-ERROR-NO  12720000
127300                      PERFORM 4410-CHECK-P2L-FRCD-DIVERT          12730000
127400                   END-IF                                         12740000
127500                END-IF                                            12750000
127600*               IF PS-INPUT-DATA-ERROR-NO AND PS-DB2-ERROR-NO     12760000
127700*                  PERFORM 4415-CHECK-DC-FLOWBACK                 12770000
127800*               END-IF                                            12780000
127900            END-IF                                                12790000
128000            IF PS-INPUT-DATA-ERROR-NO AND PS-DB2-ERROR-NO         12800000
128100               MOVE SU051-DC-NUMBER    TO PV-HOLD-DC-NBR          12810000
128200               MOVE SU051-TRIP-ID      TO PV-HOLD-TRIP-ID         12820000
128300               MOVE SU051-DOOR-NUMBER  TO PV-HOLD-DOOR-ID         12830000
128400               MOVE SU051-USER-ID      TO PV-HOLD-USER-ID         12840000
128500               PERFORM 4400-CHECK-DC-LABOR                        12850000
128600               IF PS-DC-INTERFC-LABOR-YES                         12860000
128700                  PERFORM 4500-PROCESS-LABOR                      12870000
128800                  IF PS-DB2-ERROR-YES                             12880000
128900                     INITIALIZE  PV-HOLD-DC-NBR                   12890000
129000                                 PV-HOLD-TRIP-ID                  12900000
129100                                 PV-HOLD-DOOR-ID                  12910000
129200                                 PV-HOLD-USER-ID                  12920000
129300                  END-IF                                          12930000
129400               END-IF                                             12940000
129500            ELSE                                                  12950000
129600               INITIALIZE  PV-HOLD-DC-NBR                         12960000
129700                           PV-HOLD-TRIP-ID                        12970000
129800                           PV-HOLD-DOOR-ID                        12980000
129900                           PV-HOLD-USER-ID                        12990000
130000            END-IF                                                13000000
130100        END-IF                                                    13010000
130200                                                                  13020000
130300*                                                                 13030000
130400*** DMH - 9/21/11 ADDED                                           13040000
130500*** THIS LOGIC WAS ADDED TO MAKE SURE THAT 2 SSCC ARE NOT SCANNED 13050000
130600*                                                                 13060000
130700        IF  PS-DUAL-FEED-ON                                       13070000
130800            CONTINUE                                              13080000
130900        ELSE                                                      13090000
131000*** 9/27/11 - begin                                               13100000
131100                SET PS-VENDOR-SSCC-NO                             13110000
131200                    PS-MULT-VNDR-SSCC-NO                          13120000
131300                    PS-VENDOR-SSCC-1-NO                           13130000
131400                    PS-VENDOR-SSCC-2-NO  TO TRUE                  13140000
131500*** 9/27/11 - end                                                 13150000
131600            IF  SU051-BAR-CODE-1  >  0  AND                       13160000
131700                SU051-BAR-CODE-2  >  0                            13170000
131800                SET PS-VENDOR-SSCC-NO                             13180000
131900                    PS-MULT-VNDR-SSCC-NO                          13190000
132000                    PS-VENDOR-SSCC-1-NO                           13200000
132100                    PS-VENDOR-SSCC-2-NO  TO TRUE                  13210000
132200                                                                  13220000
132300                MOVE SU051-BAR-CODE-1     TO PV-SSCC-UNCHKIN      13230000
132400                PERFORM 4430-CHECK-VNDR-SSCC                      13240000
132500                IF  PS-VENDOR-SSCC-YES                            13250000
132600                    SET PS-VENDOR-SSCC-1-YES  TO TRUE             13260000
132700                END-IF                                            13270000
132800                                                                  13280000
132900                SET PS-VENDOR-SSCC-NO TO TRUE                     13290000
133000                MOVE SU051-BAR-CODE-2     TO PV-SSCC-UNCHKIN      13300000
133100                PERFORM 4430-CHECK-VNDR-SSCC                      13310000
133200                IF  PS-VENDOR-SSCC-YES                            13320000
133300                    SET PS-VENDOR-SSCC-2-YES  TO TRUE             13330000
133400                END-IF                                            13340000
133500            END-IF                                                13350000
133600                                                                  13360000
133700                IF  PS-VENDOR-SSCC-1-YES  AND                     13370000
133800                    PS-VENDOR-SSCC-2-YES                          13380000
133900                    SET PS-INPUT-DATA-ERROR-YES                   13390000
134000                        PS-MULT-VNDR-SSCC-YES                     13400000
134100                        SU054-MULT-SSCC-YES    TO  TRUE           13410000
134200                    MOVE 'MULT SSCC' TO PV-ERROR-MESSAGE          13420000
134300                END-IF                                            13430000
134400        END-IF                                                    13440000
134500                                                                  13450000
134600                                                                  13460000
134700*** DMH - 9/21/11 ENDED                                           13470000
134800*                                                                 13480000
134900                                                                  13490000
135000*    STRING ' SUKCS781 2000'                                      13500016
135100*           ' TASK:'        pv-task-x                             13510000
135200*           ' INPUT ERROR'  PS-INPUT-DATA-ERROR-SW                13520000
135300*                           delimited by size                     13530000
135400*                      INTO PV-CICS-MSG-AREA                      13540000
135500*    PERFORM 9990-WRITE-CICS                                      13550000
135600     IF PS-INPUT-DATA-ERROR-NO AND PS-DB2-ERROR-NO                13560000
135700        PERFORM 5000-LINK-CARTON-CHECK-IN                         13570000
135701*thin slice                                                       13570111
135710        IF  SU054-THIN-SLICE-ELIGIBLE                             13571012
135711             SET SU054-KOHLS-MESSAGE-LABEL  to  true              13571111
135714             MOVE 'NEW CK-IN' TO PV-ERROR-MESSAGE                 13571411
135740        END-IF                                                    13574011
135750*thin slice                                                       13575011
135800     ELSE                                                         13580000
135900        PERFORM 5200-LOAD-LABEL-DATA-MSG                          13590000
136000        SET PS-DB2-ERROR-NO  TO TRUE                              13600000
136100     END-IF                                                       13610000
136200*  IF ALL OPERATIONS WERE SUCCESSFUL UP TO THIS POINT, THIS       13620000
136300*  COMPLETES A LOGICAL UNIT OF WORK.  ABENDS WILL NOT INCLUDE     13630000
136400*  A ROLLBACK COMMAND BECAUSE ANY RETRANSMISSION WILL OVERLAY     13640000
136500*  THE PACK VALUES.                                               13650000
136600                                                                  13660000
136700        PERFORM 9000-SYNCPOINT                                    13670000
136800                                                                  13680000
136900        PERFORM 2500-SEND-LABEL-REQUEST                           13690000
137000        MOVE PV-PARTIAL-TCP-COUNT TO PV-DISP-TCP-COUNT            13700000
137100                                                                  13710000
137200                                                                  13720000
137300* DMH 1/8/15 - BEGIN                                              13730000
137400         IF  PS-BLD-INTERNAL-TABLE-YES  and                       13740000
137500             PV-DURATION-SEC     >=  PV-PARM-SECONDS              13750000
137600                                                                  13760000
137700             move spaces to  pv-ciCS-MSG-AREA                     13770000
137800             PERFORM 9990-WRITE-CICS                              13780000
137900                                                                  13790000
138000             INITIALIZE PV-CICS-MSG-AREA                          13800000
138100             move pv-duration-sec to  PV-disp-duration            13810000
138200             STRING ' SUKCS781-DID NOT MEET SLA'                  13820016
138300                   ' 2000-'                                       13830000
138400                   ' DC:'        SU051-DC-NUMBER                  13840000
138500                   ' STA:'       SU051-ACCM-LINE-NMBR             13850000
138600                   ' KEY:'       PV-INIT-TIME-KEY                 13860000
138700                   ' tmst:'      PV-CURRENT-PARA-TMST             13870000
138800                   ' DURATION:'  PV-disp-duration                 13880000
138900                                 DELIMITED BY SIZE                13890000
139000                            INTO PV-CICS-MSG-AREA                 13900000
139100             PERFORM 9990-WRITE-CICS                              13910000
139200                                                                  13920000
139300             INITIALIZE PV-CICS-MSG-AREA                          13930000
139400             STRING ' SUKCS781-'                                  13940016
139500                   ' 2000-'                                       13950000
139600                   ' KEY:'       PV-INIT-TIME-KEY                 13960000
139700                   ' init:'       PV-RECEIVE-RQST-TMST            13970000
139800                   ' curr:'      PV-CURRENT-PARA-TMST             13980000
139900                                 DELIMITED BY SIZE                13990000
140000                            INTO PV-CICS-MSG-AREA                 14000000
140100                                                                  14010000
140200             PERFORM 1620-WRITE-SUWS051-TO-CSSL                   14020000
140300                                                                  14030000
140400             move spaces to  pv-ciCS-MSG-AREA                     14040000
140500             PERFORM 9990-WRITE-CICS                              14050000
140600                                                                  14060000
140700             PERFORM 1630-DUMP-TABLE-TO-CSSL                      14070000
140800             VARYING PT-TRACK-IDX                                 14080000
140900                FROM 1 BY 1                                       14090000
141000               UNTIL PT-TRACK-IDX >=  PT-CURR-ENTRIES             14100000
141100                  OR PT-TRACK-IDX >=  PT-MAX-PARA-ENTRIES         14110000
141200                                                                  14120000
141300             PERFORM 1640-CLEAR-TABLE                             14130000
141400             VARYING PT-TRACK-IDX                                 14140000
141500                FROM 1 BY 1                                       14150000
141600               UNTIL PT-TRACK-IDX >=  PT-CURR-ENTRIES             14160000
141700                  OR PT-TRACK-IDX >=  PT-MAX-PARA-ENTRIES         14170000
141800                                                                  14180000
141900             MOVE ZEROES TO PT-CURR-ENTRIES                       14190000
142000             SET  PT-TRACK-IDX  to  PT-CURR-ENTRIES               14200000
142100                                                                  14210000
142200             INITIALIZE PV-CICS-MSG-AREA                          14220000
142300             move pv-duration-sec to  PV-disp-duration            14230000
142400             STRING ' SUKCS781-DID NOT MEET SLA'                  14240016
142500                   ' 2000-'                                       14250000
142600                   ' DC:'        SU051-DC-NUMBER                  14260000
142700                   ' STA:'       SU051-ACCM-LINE-NMBR             14270000
142800                   ' KEY:'       PV-INIT-TIME-KEY                 14280000
142900                   ' done'                                        14290000
143000                                 DELIMITED BY SIZE                14300000
143100                            INTO PV-CICS-MSG-AREA                 14310000
143200             PERFORM 9990-WRITE-CICS                              14320000
143300                                                                  14330000
143400             move spaces to  pv-ciCS-MSG-AREA                     14340000
143500             PERFORM 9990-WRITE-CICS                              14350000
143600                                                                  14360000
143700         END-IF                                                   14370000
143800                                                                  14380000
143900* DMH 1/8/15 - BEGIN                                              14390000
144000                                                                  14400000
144100     END-IF.                                                      14410000
144200*    INITIALIZE PV-CICS-MSG-AREA.                                 14420000
144300*    STRING ' SUKCS781 2000'                                      14430016
144400*           ' TASK:'         pv-task-x                            14440000
144500*           ' count:'        PV-DISP-TCP-COUNT                    14450000
144600*           ' CODE:          DK-ERROR-CODE                        14460000
144700*                            DELIMITED BY SIZE                    14470000
144800*                       INTO PV-CICS-MSG-AREA.                    14480000
144900*    PERFORM 9990-WRITE-CICS.                                     14490000
145000*    IF PV-PARTIAL-TCP-COUNT > 4 AND                              14500000
145100*       (DK-ERROR-CODE = '101' OR                                 14510000
145200*        DK-ERROR-CODE = '102')                                   14520000
145300*        SET PS-ERROR-RECEIVE TO TRUE                             14530000
145400*    END-IF.                                                      14540000
145500                                                                  14550000
145600 2030-GET-DC-PADCLS.                                              14560000
145700     SET PS-DC-PADCLS-NOT-FOUND  TO TRUE.                         14570000
145800     MOVE SU051-DC-NUMBER    TO  KRPRPM-LOC-ID.                   14580000
145900                                                                  14590000
146000     EXEC SQL                                                     14600000
146100          SELECT  SYS_PRC_FUNC_CDE                                14610000
146200            INTO :KRPRPM-SYS-PRC-FUNC-CDE                         14620000
146300            FROM  TKRPRPM                                         14630000
146400           WHERE  LOC_ID            = :KRPRPM-LOC-ID              14640000
146500             AND  INTFC_SYS_CDE     = 'ACM'                       14650000
146600             AND  SYS_PRC_FUNC_CDE  = 'PADCLS'                    14660000
146700             AND  FUNC_TXT          = 'Y'                         14670000
146800            WITH UR                                               14680000
146900     END-EXEC.                                                    14690000
147000                                                                  14700000
147100     EVALUATE TRUE                                                14710000
147200       WHEN SQLCODE = +0                                          14720000
147300           SET  PS-DC-PADCLS-FOUND       TO TRUE                  14730000
147400       WHEN SQLCODE = +100                                        14740000
147500           SET  PS-DC-PADCLS-NOT-FOUND   TO TRUE                  14750000
147600       WHEN SQLWARN0 NOT = SPACES                                 14760000
147700       WHEN SQLCODE NOT EQUAL ZERO                                14770000
147800           perform 1620-WRITE-SUWS051-TO-CSSL                     14780000
147900                                                                  14790000
148000           SET PS-CSSL-LOGGING-NO TO TRUE                         14800000
148100           MOVE '2030-GET-DC-PADCLS'                              14810000
148200                           TO DP013-PARAGRAPH                     14820000
148300           MOVE 'CHECK DC P2 DIVERT '                             14830000
148400                           TO DP013-MESSAGE-TEXT(1)               14840000
148500           MOVE PV-DISPLAY-TRIP-ID                                14850000
148600                           TO DP013-MESSAGE-TEXT(2)               14860000
148700           MOVE SQLCA      TO DP013-SQLCA                         14870000
148800           MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(1)             14880000
148900           PERFORM 9999-WRITE-CICS-LOG-MSG                        14890000
149000     END-EVALUATE.                                                14900000
149100                                                                  14910000
149200 2040-SELECT-PNA-STATION.                                         14920000
149300                                                                  14930000
149400     MOVE  '2040'  TO  PT-CURR-PARA.                              14940000
149500     IF  PS-BLD-INTERNAL-TABLE-YES                                14950000
149600         PERFORM 1600-INTERNAL-TABLE                              14960000
149700     else                                                         14970000
149800         MOVE 1            TO PT-CURR-ENTRIES                     14980000
149900         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     14990000
150000         perform 1610-BUILD-MESSAGE-DISPLAY                       15000000
150100     END-IF.                                                      15010000
150200                                                                  15020000
150300     MOVE SU051-DC-NUMBER      TO DK-OPER-UNT-ID.                 15030000
150400     MOVE SU051-ACCM-LINE-NMBR TO DK-PNA-STA-NBR.                 15040000
150500                                                                  15050000
150600     EXEC SQL                                                     15060000
150700         SELECT                                                   15070000
150800                 SUT107.OPER_UNT_ID                               15080000
150900                ,SUT107.ACM_LBL_STA_NBR                           15090000
151000                                                                  15100000
151100           INTO                                                   15110000
151200                 :SUT00107-OPER-UNT-ID                            15120000
151300                ,:SUT00107-ACM-LBL-STA-NBR                        15130000
151400                                                                  15140000
151500           FROM  SUT_PNA_STA     SUT107                           15150000
151600          WHERE  SUT107.OPER_UNT_ID      = :DK-OPER-UNT-ID        15160000
151700            AND  SUT107.ACM_LBL_STA_NBR  = :DK-PNA-STA-NBR        15170000
151800           with ur                                                15180000
151900     END-EXEC.                                                    15190000
152000                                                                  15200000
152100     EVALUATE TRUE                                                15210000
152200         WHEN SQLCODE = ZERO                                      15220000
152300              SET PS-DUAL-FEED-ON  TO TRUE                        15230000
152400                                                                  15240000
152500         WHEN SQLCODE = +100                                      15250000
152600              SET PS-DUAL-FEED-OFF TO TRUE                        15260000
152700                                                                  15270000
152800         WHEN SQLWARN0 NOT = SPACES                               15280000
152900         WHEN SQLCODE < +0                                        15290000
153000         WHEN SQLCODE > +0                                        15300000
153100             perform 1620-WRITE-SUWS051-TO-CSSL                   15310000
153200                                                                  15320000
153300             MOVE '2040-SELECT-PNA-STATION ' TO DP013-PARAGRAPH   15330000
153400             MOVE 'TROUBLE selecting station'                     15340000
153500                                      TO DP013-MESSAGE-TEXT (1)   15350000
153600             MOVE SQLCA        TO DP013-SQLCA                     15360000
153700             MOVE 'SUT_PNA_STA       '  TO                        15370000
153800                                  DP013-DB2-TABLE-NAME (1)        15380000
153900             SET DP013-DB2-ABEND                                  15390000
154000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15400000
154100**??         PERFORM DP013-0000-PROCESS-ABEND                     15410000
154200         END-EVALUATE.                                            15420000
154300                                                                  15430000
154400                                                                  15440000
154500/                                                                 15450000
154600*----------------------------------------------------------------*15460000
154700*    RECEIVE THE DATA FROM THE PACK TO LIGHT SYSTEM.  THIS DATA  *15470000
154800*    WILL CONSIST OF A HEADER RECORD CONTAINING INFORMATION ON   *15480000
154900*    WHEN THE LINE WAS COMPLETED IN THE PACK TO LIGHT SYSTEM.    *15490000
155000*    DETAIL RECORDS ARE ALSO SENT FOR EACH STORE ON THE RECEIVER *15500000
155100*    LINE CONTAINING THE NUMBER OF PIECES PROCESSED.  A TRAILER  *15510000
155200*    RECORD IS SENT CONTAINING THE NUMBER OF STORE RECORDS THAT  *15520000
155300*    WERE SENT TO BE USED FOR CROSS-CHECK VALIDATION.            *15530000
155400*----------------------------------------------------------------*15540000
155500 2100-RECEIVE-DATA-FROM-ASI.                                      15550000
155600                                                                  15560000
155700     MOVE  '2100'  TO  PT-CURR-PARA.                              15570000
155800     IF  PS-BLD-INTERNAL-TABLE-YES                                15580000
155900         PERFORM 1600-INTERNAL-TABLE                              15590000
156000     else                                                         15600000
156100         MOVE 1            TO PT-CURR-ENTRIES                     15610000
156200         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     15620000
156300         perform 1610-BUILD-MESSAGE-DISPLAY                       15630000
156400     END-IF.                                                      15640000
156500                                                                  15650000
156600     MOVE ' 2100-RECEIVE-DATA-FROM-ASI'                           15660000
156700                                 TO DP013-PARAGRAPH.              15670000
156800     SET PS-START-RECEIVE TO TRUE.                                15680000
156900     MOVE ZEROS   TO  PV-TCP-RET-LENGTH                           15690000
157000                      PV-TCP-REM-LENGTH                           15700000
157100                      PV-TCP-PRCSD-LENGTH.                        15710000
157200     MOVE SPACES  TO  TCP-BUF2                                    15720000
157300                      PT-TCP-RECEIVE-TABLE                        15730000
157400                      PT-TCP-ASSEMBLE-TABLE.                      15740000
157500     MOVE PV-TCP-EXP-LENGTH TO DP081-TCPLENG                      15750000
157600                               DP081-NBR-BYTES.                   15760000
157700                                                                  15770000
157800     PERFORM 2800-CHECK-SOCKET-CONNECTION                         15780000
157900     IF NOT PS-ERROR-RECEIVE                                      15790000
158000        PERFORM 3000-RECEIVE-TCP                                  15800000
158100            UNTIL PS-COMP-RECEIVE                                 15810000
158200                                                                  15820000
158300        INITIALIZE SU051-LABEL-REQUEST-RECORD                     15830000
158400                                                                  15840000
158500        MOVE TCP-BUF2               TO SU051-LABEL-REQUEST-RECORD 15850000
158600                                                                  15860000
158700        IF PS-CSSL-LOGGING-YES                                    15870000
158800           MOVE SPACES TO PV-CICS-MSG-AREA                        15880000
158900           STRING ' SUKCS781 2100'                                15890016
159000                  ' TASK:'     PV-TASK-X                          15900000
159100                  ' DC:'       SU051-DC-NUMBER                    15910000
159200                  ' BC1:'      SU051-BAR-CODE-1                   15920000
159300                  ' BC2:'      SU051-BAR-CODE-2                   15930000
159400                               delimited BY SIZE                  15940000
159500                          INTO PV-CICS-MSG-AREA                   15950000
159600           PERFORM 9990-WRITE-CICS                                15960000
159700                                                                  15970000
159800           MOVE SPACES TO PV-CICS-MSG-AREA                        15980000
159900           STRING ' SUKCS781 2100'                                15990016
160000                  ' TASK:'     PV-TASK-X                          16000000
160100                  ' bc3:'      SU051-BAR-CODE-3                   16010000
160200                  ' DOOR:'     SU051-DOOR-NUMBER                  16020000
160300                  ' TRIP:'     SU051-TRIP-ID                      16030000
160400                  ' USER:'     SU051-USER-ID                      16040000
160500                  ' PNA:'      SU051-ACCM-LINE-NMBR               16050000
160600                               DELIMITED BY SIZE                  16060000
160700                          INTO PV-CICS-MSG-AREA                   16070000
160800           PERFORM 9990-WRITE-CICS                                16080000
160900                                                                  16090000
161000            INITIALIZE PV-CICS-MSG-AREA                           16100000
161100            STRING ' SUKCS781 2100'                               16110016
161200                   ' TASK:'                 PV-TASK-X             16120000
161300                   ' PV-RECEIVE-RQST-TMST:' PV-RECEIVE-RQST-TMST  16130000
161400                   ' PV-INIT-TIME-KEY:'     PV-INIT-TIME-KEY      16140000
161500                                            DELIMITED BY SIZE     16150000
161600                                       INTO PV-CICS-MSG-AREA      16160000
161700            PERFORM 9990-WRITE-CICS                               16170000
161800                                                                  16180000
161900     END-IF.                                                      16190000
162000                                                                  16200000
162100                                                                  16210000
162200* JUST FOR TESTING - BEGIN                                        16220000
162300*    INITIALIZE PV-CICS-MSG-AREA.                                 16230000
162400*    STRING ' SUKCS781 2100'                                      16240016
162500*           ' TASK:'  pv-task-x                                   16250000
162600*                     TCP-BUF2                                    16260000
162700*                     DELIMITED BY SIZE                           16270000
162800*                INTO PV-CICS-MSG-AREA.                           16280000
162900*    PERFORM 9990-WRITE-CICS.                                     16290000
163000*                                                                 16300000
163100*    INITIALIZE PV-CICS-MSG-AREA.                                 16310000
163200*    MOVE DP081-RETCODE TO PV-RETCODE.                            16320000
163300*    MOVE DP081-TCPLENG TO PV-TCPLENG.                            16330000
163400*    MOVE DP081-ERRNO   TO PV-ERRNO.                              16340000
163500*                                                                 16350000
163600*    STRING ' SUKCS781 2100'                                      16360016
163700*           ' TASK:'  pv-task-x                                   16370000
163800*           ' DC:'    SU051-DC-NUMBER                             16380000
163900*           ' SEQ:'   SU051-MESSAGE-SEQ-NUMBER                    16390000
164000*           ' BC1:'   SU051-BAR-CODE-1                            16400000
164100*           ' Bc2:'   SU051-BAR-CODE-2                            16410000
164200*           ' Bc3:'   SU051-BAR-CODE-3                            16420000
164300*                     DELIMITED BY SIZE                           16430000
164400*                into PV-CICS-MSG-AREA.                           16440000
164500*    PERFORM 9990-WRITE-CICS.                                     16450000
164600*    STRING ' SUKCS781 2100'                                      16460016
164700*           ' TASK:'  pv-task-x                                   16470000
164800*           ' DOOR:'  SU051-DOOR-NUMBER                           16480000
164900*           ' TRIP:'  SU051-trip-id                               16490000
165000*           ' USER:'  SU051-USER-ID                               16500000
165100*           ' PNA:'   SU051-ACCM-LINE-NMBR                        16510000
165200*           ' DATE:'  SU051-DATE                                  16520000
165300*           ' TIME:'  SU051-time                                  16530000
165400*                     DELIMITED BY SIZE                           16540000
165500*                INTO PV-CICS-MSG-AREA.                           16550000
165600*    PERFORM 9990-WRITE-CICS.                                     16560000
165700* JUST FOR TESTING - END                                          16570000
165800                                                                  16580000
165900*----------------------------------------------------------------*16590000
166000*----------------------------------------------------------------*16600000
166100 2500-SEND-LABEL-REQUEST.                                         16610000
166200                                                                  16620000
166300     MOVE  '2500'  TO  PT-CURR-PARA.                              16630000
166400     IF  PS-BLD-INTERNAL-TABLE-YES                                16640000
166500         PERFORM 1600-INTERNAL-TABLE                              16650000
166600     else                                                         16660000
166700         MOVE 1            TO PT-CURR-ENTRIES                     16670000
166800         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     16680000
166900         perform 1610-BUILD-MESSAGE-DISPLAY                       16690000
167000     END-IF.                                                      16700000
167100                                                                  16710000
167200     MOVE ' 2500-SEND-LABEL-REQUEST'                              16720000
167300                                 TO DP013-PARAGRAPH.              16730000
167400     IF  PS-CSSL-LOGGING-YES                                      16740000
167500                                                                  16750000
167600       MOVE SU054-TRIP-ID TO PV-TRIP-ID                           16760000
167700       EVALUATE TRUE                                              16770000
167800           WHEN SU054-BAR-CODE-1 NOT = SPACES                     16780000
167900                STRING ' SUKCS781 2500'                           16790016
168000                       ' TASK:'             PV-TASK-X             16800000
168100                       ' SUWS054 FIELDS 1: ' SU054-BAR-CODE-1     16810000
168200                       '-'                  PV-TRIP-ID            16820000
168300                       '-'                  SU054-USER-ID         16830000
168400                       '-'                  SU054-FRCD-DIVERT-IND 16840000
168500                                            DELIMITED BY SIZE     16850000
168600                                       INTO PV-CICS-MSG-AREA      16860000
168700                                                                  16870000
168800           WHEN SU054-BAR-CODE-2 NOT = SPACES                     16880000
168900                STRING ' SUKCS781 2500'                           16890016
169000                       ' TASK:'             PV-TASK-X             16900000
169100                       ' SUWS054 FIELDS 2: ' SU054-BAR-CODE-2     16910000
169200                       '-'                  PV-TRIP-ID            16920000
169300                       '-'                  SU054-USER-ID         16930000
169400                       '-'                  SU054-FRCD-DIVERT-IND 16940000
169500                                            DELIMITED BY SIZE     16950000
169600                                       INTO PV-CICS-MSG-AREA      16960000
169700                                                                  16970000
169800           WHEN SU054-BAR-CODE-3 NOT = SPACES                     16980000
169900                STRING ' SUKCS781 2500'                           16990016
170000                       ' TASK:'             PV-TASK-X             17000000
170100                       ' SUWS054 FIELDS 3: ' SU054-BAR-CODE-3     17010000
170200                       '-'                  PV-TRIP-ID            17020000
170300                       '-'                  SU054-USER-ID         17030000
170400                       '-'                  SU054-FRCD-DIVERT-IND 17040000
170500                                            DELIMITED BY SIZE     17050000
170600                                       INTO PV-CICS-MSG-AREA      17060000
170700                                                                  17070000
170800           WHEN OTHER                                             17080000
170900                STRING ' SUKCS781 2500'                           17090016
171000                       ' TASK:'             PV-TASK-X             17100000
171100                       ' SUWS054 FIELDS OTHER:'                   17110000
171200                       '-'                  PV-TRIP-ID            17120000
171300                       '-'                  SU054-USER-ID         17130000
171400                       '-'                  SU054-FRCD-DIVERT-IND 17140000
171500                                            DELIMITED BY SIZE     17150000
171600                                       INTO PV-CICS-MSG-AREA      17160000
171700       END-EVALUATE                                               17170000
171800       PERFORM 9990-WRITE-CICS                                    17180000
171900     END-IF.                                                      17190000
172000                                                                  17200000
172100     MOVE SPACES              TO TCP-BUF3.                        17210000
172200     EVALUATE TRUE                                                17220000
172300       WHEN SU054-NO-LABEL-REQ                                    17230000
172400          MOVE SU051-MESSAGE-SEQ-NUMBER                           17240000
172500                              TO SU052-MESSAGE-SEQ-NUMBER-NL      17250000
172600          MOVE SU054-KOHLS-SML                                    17260000
172700                              TO SU052-KOHLS-NO-LABEL             17270000
172800          MOVE SU054-FRCD-DIVERT-IND TO SU052-FRCD-DIVERT-IND-NL  17280000
172900          MOVE SU054-DWNLD-PRINT-IND TO SU052-DWNLD-PRINT-IND-NL  17290000
173000          MOVE SPACES                TO                           17300000
173100                                 SU052-FRMTD-LABEL-DATA-NL        17310000
173200          MOVE SU052-TERMINATING-CHAR                             17320000
173300                                TO SU052-RECORD-TERMINATOR-NL     17330000
173400          MOVE SU052-NO-LABEL-REQ-WRK                             17340000
173500                                TO PV-LABEL-DWNLD-LENGTH          17350000
173600          MOVE SU052-NO-LABEL-REQ TO TCP-BUF-3                    17360000
173700       WHEN SU054-KOHLS-SML-LABEL                                 17370000
173800          MOVE SU051-MESSAGE-SEQ-NUMBER                           17380000
173900                              TO SU052-MESSAGE-SEQ-NUMBER-SML     17390000
174000          MOVE SU054-KOHLS-SML                                    17400000
174100                              TO SU052-KOHLS-SML-LBL              17410000
174200          MOVE SU054-FRCD-DIVERT-IND TO SU052-FRCD-DIVERT-IND-SML 17420000
174300          MOVE +0             TO    SU052-VALID-SIGN-ON-IND-SML   17430000
174400          MOVE SU054-DWNLD-PRINT-IND TO SU052-DWNLD-PRINT-IND-SML 17440000
174500          MOVE SU054-LABEL-DATA-FORMAT TO                         17450000
174600                                 SU052-FRMTD-LABEL-DATA-SML       17460000
174700          MOVE SU052-TERMINATING-CHAR                             17470000
174800                                TO SU052-RECORD-TERMINATOR-SML    17480000
174900          MOVE SU052-LBL-DATA-LGTH-SML-WRK                        17490000
175000                                TO PV-LABEL-DWNLD-LENGTH          17500000
175100          MOVE SU052-LABEL-DWNLD-RECORD-SML TO TCP-BUF-3          17510000
175200* 07/19/13 RLK BEG                                                17520000
175300       WHEN SU054-KOHLS-CRTN-LABEL                                17530000
175400          MOVE SU051-MESSAGE-SEQ-NUMBER                           17540000
175500                              TO SU052-MESSAGE-SEQ-NUMBER-CL      17550000
175600          MOVE SU054-KOHLS-SML                                    17560000
175700                              TO SU052-KOHLS-NO-LABEL-CL          17570000
175800                                                                  17580000
175900*DMH 5/29/15 - BEG                                                17590000
176000*         INSPECT   SU052-KOHLS-NO-LABEL-CL                       17600000
176100*         REPLACING all 'XXXX'                                    17610000
176200*                    BY '0000'                                    17620000
176300*DMH 5/29/15 - END                                                17630000
176400                                                                  17640000
176500          MOVE SU054-FRCD-DIVERT-IND TO SU052-FRCD-DIVERT-IND-CL  17650000
176600          MOVE +0             TO    SU052-VALID-SIGN-ON-IND-CL    17660000
176700          MOVE SU054-DWNLD-PRINT-IND TO SU052-DWNLD-PRINT-IND-CL  17670000
176800          MOVE SU054-LABEL-DATA-FORMAT TO                         17680000
176900                                 SU052-FRMTD-LABEL-DATA-CL        17690000
177000          MOVE SU052-TERMINATING-CHAR                             17700000
177100                                TO SU052-RECORD-TERMINATOR-CL     17710000
177200          MOVE SU052-CRTN-LABEL-WRK                               17720000
177300                                TO PV-LABEL-DWNLD-LENGTH          17730000
177400          MOVE SU052-RFID-CRTN-LABEL-REQ TO TCP-BUF-3             17740000
177500*** DMH - BEGIN                                                   17750000
177600     IF PS-CSSL-LOGGING-YES                                       17760000
177700         MOVE  SU052-FRMTD-LABEL-DATA-CL                          17770000
177800           TO  PV-DMH-DISPLAY-DATA                                17780000
177900                                                                  17790000
178000       INITIALIZE PV-CICS-MSG-AREA-DMH                            17800000
178100       STRING ' S770:' PV-DMH-DISPLAY-1                           17810000
178200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               17820000
178300        PERFORM 9990-WRITE-CICS-DMH                               17830000
178400                                                                  17840000
178500       INITIALIZE PV-CICS-MSG-AREA-DMH                            17850000
178600       STRING ' S770:' PV-DMH-DISPLAY-2                           17860000
178700        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               17870000
178800        PERFORM 9990-WRITE-CICS-DMH                               17880000
178900                                                                  17890000
179000       INITIALIZE PV-CICS-MSG-AREA-DMH                            17900000
179100       STRING ' S770:' PV-DMH-DISPLAY-3                           17910000
179200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               17920000
179300        PERFORM 9990-WRITE-CICS-DMH                               17930000
179400                                                                  17940000
179500       INITIALIZE PV-CICS-MSG-AREA-DMH                            17950000
179600       STRING ' S770:' PV-DMH-DISPLAY-4                           17960000
179700        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               17970000
179800        PERFORM 9990-WRITE-CICS-DMH                               17980000
179900                                                                  17990000
180000       INITIALIZE PV-CICS-MSG-AREA-DMH                            18000000
180100       STRING ' S770:' PV-DMH-DISPLAY-5                           18010000
180200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               18020000
180300        PERFORM 9990-WRITE-CICS-DMH                               18030000
180400                                                                  18040000
180500       INITIALIZE PV-CICS-MSG-AREA-DMH                            18050000
180600       STRING ' S770:' PV-DMH-DISPLAY-6                           18060000
180700        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               18070000
180800        PERFORM 9990-WRITE-CICS-DMH                               18080000
180900                                                                  18090000
181000       INITIALIZE PV-CICS-MSG-AREA-DMH                            18100000
181100       STRING ' S770:' PV-DMH-DISPLAY-16                          18110000
181200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               18120000
181300        PERFORM 9990-WRITE-CICS-DMH                               18130000
181400     END-IF                                                       18140000
181500                                                                  18150000
181600*** DMH - END                                                     18160000
181700* 07/19/13 RLK END                                                18170000
181800       WHEN SU054-KOHLS-MESSAGE-LABEL                             18180000
181900          IF SU054-KEYED-DATA-ERROR                               18190000
182000              MOVE +0  TO SU054-DWNLD-PRINT-IND                   18200000
182100          ELSE                                                    18210000
182200            SET  SU054-GENERIC-MESSAGE-LBL                        18220000
182300                 SU054-GENERIC-MESSAGE-LBL-REQ TO TRUE            18230000
182400          END-IF                                                  18240000
182500          MOVE SU051-MESSAGE-SEQ-NUMBER                           18250000
182600                              TO SU052-MESSAGE-SEQ-NUMBER-MSG     18260000
182700          MOVE SU054-KOHLS-SML                                    18270000
182800                              TO SU052-KOHLS-MSG-LBL              18280000
182900          MOVE +1             TO SU052-FRCD-DIVERT-IND-MSG        18290000
183000          IF PS-INPUT-DATA-ERROR-YES                              18300000
183100             ADD  +1 TO PV-INPUT-DATA-ERR-COUNT                   18310000
183200          END-IF                                                  18320000
183300                                                                  18330000
183400          IF PS-INPUT-DATA-ERROR-YES AND                          18340000
183500             (PV-INPUT-DATA-ERR-COUNT > +1 )                      18350000
183600             MOVE +1       TO    SU052-VALID-SIGN-ON-IND-MSG      18360000
183700             MOVE +0       TO    PV-INPUT-DATA-ERR-COUNT          18370000
183800          ELSE                                                    18380000
183900             MOVE +0       TO    SU052-VALID-SIGN-ON-IND-MSG      18390000
184000          END-IF                                                  18400000
184100                                                                  18410000
184200          MOVE SU054-DWNLD-PRINT-IND TO SU052-DWNLD-PRINT-IND-MSG 18420000
184300          MOVE SU054-LABEL-DATA-FORMAT TO                         18430000
184400                                 SU052-FRMTD-LABEL-DATA-MSG       18440000
184500          MOVE SU052-TERMINATING-CHAR                             18450000
184600                                TO SU052-RECORD-TERMINATOR-MSG    18460000
184700          MOVE SU052-LBL-DATA-LGTH-MSG-WRK                        18470000
184800                                TO PV-LABEL-DWNLD-LENGTH          18480000
184900          MOVE SU052-LABEL-DWNLD-RECORD-MSG TO TCP-BUF-3          18490000
185000*                                                                 18500000
185100*** dmh 10-4-11 begin                                             18510000
185200*                                                                 18520000
185300          IF PS-CSSL-LOGGING-YES                                  18530000
185400             STRING ' SUKCS781 2500'                              18540016
185500                    ' TASK:'  pv-task-x                           18550000
185600                     SU052-LABEL-DWNLD-RECORD-MSG                 18560000
185700                                         DELIMITED BY SIZE        18570000
185800               INTO PV-CICS-MSG-AREA                              18580000
185900             PERFORM 9990-WRITE-CICS                              18590000
186000          end-if                                                  18600000
186100*                                                                 18610000
186200*** dmh 10-4-11 end                                               18620000
186300*                                                                 18630000
186400                                                                  18640000
186500                                                                  18650000
186600       WHEN SU054-KOHLS-P2L-LABEL                                 18660000
186700          MOVE SU051-MESSAGE-SEQ-NUMBER                           18670000
186800                              TO SU052-MESSAGE-SEQ-NUMBER-P2L     18680000
186900          MOVE SU054-KOHLS-SML                                    18690000
187000                              TO SU052-KOHLS-P2L-LBL              18700000
187100          MOVE SU054-FRCD-DIVERT-IND TO SU052-FRCD-DIVERT-IND-P2L 18710000
187200          MOVE +0       TO    SU052-VALID-SIGN-ON-IND-P2L         18720000
187300          MOVE SU054-DWNLD-PRINT-IND TO SU052-DWNLD-PRINT-IND-P2L 18730000
187400          MOVE SU054-LABEL-DATA-FORMAT TO                         18740000
187500                                 SU052-FRMTD-LABEL-DATA-P2L       18750000
187600          MOVE SU052-TERMINATING-CHAR                             18760000
187700                                TO SU052-RECORD-TERMINATOR-P2L    18770000
187800          MOVE SU052-LBL-DATA-LGTH-P2L-WRK                        18780000
187900                                TO PV-LABEL-DWNLD-LENGTH          18790000
188000          MOVE SU052-LABEL-DWNLD-RECORD-P2L TO TCP-BUF-3          18800000
188100       WHEN SU054-KOHLS-BLIND-RCPT                                18810000
188200          MOVE SU051-MESSAGE-SEQ-NUMBER                           18820000
188300                              TO SU052-MESSAGE-SEQ-NUMBER-CS      18830000
188400          MOVE SU054-KOHLS-SML                                    18840000
188500                              TO SU052-KOHLS-CS-LBL               18850000
188600          MOVE SU054-FRCD-DIVERT-IND TO SU052-FRCD-DIVERT-IND-CS  18860000
188700          MOVE +0                 TO    SU052-VALID-SIGN-ON-IND-CS18870000
188800          MOVE SU054-DWNLD-PRINT-IND TO SU052-DWNLD-PRINT-IND-CS  18880000
188900          MOVE SU054-LABEL-DATA-FORMAT TO                         18890000
189000                                 SU052-FRMTD-LABEL-DATA-CS        18900000
189100          MOVE SU052-TERMINATING-CHAR                             18910000
189200                                TO SU052-RECORD-TERMINATOR-CS     18920000
189300          MOVE SU052-LBL-DATA-LGTH-CS-WRK                         18930000
189400                                TO PV-LABEL-DWNLD-LENGTH          18940000
189500          MOVE SU052-LABEL-DWNLD-RECORD-CS  TO TCP-BUF-3          18950000
189600     END-EVALUATE                                                 18960000
189700     SET PS-INPUT-DATA-ERROR-NO     TO TRUE                       18970000
189800     MOVE PV-LABEL-DWNLD-LENGTH TO                                18980000
189900                                 DP081-NBR-BYTES                  18990000
190000                                 DP081-TCPLENG.                   19000000
190100                                                                  19010000
190200******************************************************************19020000
190300**   PERFORM INSERT TO LBL REQ TABLES                             19030000
190400******************************************************************19040000
190500     PERFORM 5300-LOAD-LBL-REQ-MSG                                19050000
190600******************************************************************19060000
190700                                                                  19070000
190800     IF PS-CSSL-LOGGING-YES                                       19080000
190900       INITIALIZE PV-CICS-MSG-AREA                                19090000
191000       STRING ' SUKCS781 2500'                                    19100016
191100              ' TASK:'           pv-task-x                        19110000
191200              ' DWNLD LENGTH  '  PV-LABEL-DWNLD-LENGTH            19120000
191300                                 DELIMITED BY SIZE                19130000
191400                            INTO PV-CICS-MSG-AREA                 19140000
191500        PERFORM 9990-WRITE-CICS                                   19150000
191600                                                                  19160000
191700       INITIALIZE PV-CICS-MSG-AREA                                19170000
191800       STRING ' SUKCS781 2500'                                    19180016
191900              ' TASK:'               pv-taSK-X                    19190000
192000              ' SEND GOOD CONFIRM '  TCP-BUF-3                    19200000
192100                                     DELIMITED BY SIZE            19210000
192200                                INTO PV-CICS-MSG-AREA             19220000
192300        PERFORM 9990-WRITE-CICS                                   19230000
192400     END-IF                                                       19240000
192500                                                                  19250000
192600     IF PS-CSSL-LOGGING-YES                                       19260000
192700         MOVE  TCP-BUF-3                                          19270000
192800           TO  PV-DMH-DISPLAY-DATA                                19280000
192900                                                                  19290000
193000       INITIALIZE PV-CICS-MSG-AREA-DMH                            19300000
193100       STRING ' S770:' PV-DMH-DISPLAY-1                           19310000
193200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               19320000
193300        PERFORM 9990-WRITE-CICS-DMH                               19330000
193400                                                                  19340000
193500       INITIALIZE PV-CICS-MSG-AREA-DMH                            19350000
193600       STRING ' S770:' PV-DMH-DISPLAY-2                           19360000
193700        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               19370000
193800        PERFORM 9990-WRITE-CICS-DMH                               19380000
193900                                                                  19390000
194000       INITIALIZE PV-CICS-MSG-AREA-DMH                            19400000
194100       STRING ' S770:' PV-DMH-DISPLAY-3                           19410000
194200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               19420000
194300        PERFORM 9990-WRITE-CICS-DMH                               19430000
194400                                                                  19440000
194500       INITIALIZE PV-CICS-MSG-AREA-DMH                            19450000
194600       STRING ' S770:' PV-DMH-DISPLAY-4                           19460000
194700        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               19470000
194800        PERFORM 9990-WRITE-CICS-DMH                               19480000
194900                                                                  19490000
195000       INITIALIZE PV-CICS-MSG-AREA-DMH                            19500000
195100       STRING ' S770:' PV-DMH-DISPLAY-5                           19510000
195200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               19520000
195300        PERFORM 9990-WRITE-CICS-DMH                               19530000
195400                                                                  19540000
195500       INITIALIZE PV-CICS-MSG-AREA-DMH                            19550000
195600       STRING ' S770:' PV-DMH-DISPLAY-6                           19560000
195700        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               19570000
195800        PERFORM 9990-WRITE-CICS-DMH                               19580000
195900                                                                  19590000
196000       INITIALIZE PV-CICS-MSG-AREA-DMH                            19600000
196100       STRING ' S770:' PV-DMH-DISPLAY-16                          19610000
196200        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA-DMH               19620000
196300        PERFORM 9990-WRITE-CICS-DMH                               19630000
196400     END-IF                                                       19640000
196500                                                                  19650000
196600* DMH - 5/29/15 - BEG                                             19660000
196700     IF  PS-CAPTURE-DATA                                          19670000
196800         PERFORM 2600-CAPTURE-DATA                                19680000
196900     END-IF                                                       19690000
197000* DMH - 5/29/15 - BEG                                             19700000
197100                                                                  19710000
197200*** DMH - END                                                     19720000
197300* TRANSLATE EBCDIC TO ASCII                                       19730000
197400     CALL 'EZACIC04'                                              19740000
197500         USING  DP081-TOASCII-TOKEN                               19750000
197600                TCP-BUF-3                                         19760000
197700                DP081-TCPLENG.                                    19770000
197800                                                                  19780000
197900* WRITE DATA ON A CONNECTED SOCKET                                19790000
198000     CALL 'EZASOKET'                                              19800000
198100         USING                                                    19810000
198200                DP081-WRITE-CMD                                   19820000
198300                DP081-SOCK-ID                                     19830000
198400                DP081-NBR-BYTES                                   19840000
198500                TCP-BUF-3                                         19850000
198600                DP081-ERRNO                                       19860000
198700                DP081-RETCODE.                                    19870000
198800*                                                                 19880000
198900*                                                                 19890000
199000     IF DP081-RETCODE < ZERO                                      19900000
199100         INITIALIZE PV-CICS-MSG-AREA                              19910000
199200         STRING ' SUKCS781 2500'                                  19920016
199300                ' TASK:'              pv-task-x                   19930000
199400                ' BAD RETURN CODE  '  tcp-buf-3                   19940000
199500                                      DELIMITED BY SIZE           19950000
199600                                 INTO PV-CICS-MSG-AREA            19960000
199700         PERFORM 9990-WRITE-CICS                                  19970000
199800         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        19980000
199900         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    19990000
200000*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         20000000
200100*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE20010000
200200*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  20020000
200300*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               20030000
200400*   DP013-MESSAGE-TEXT GROUP LEVEL.                               20040000
200500         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          20050000
200600         SET  DP013-OTHER-ABEND   TO TRUE                         20060000
200700         SET  DP013-NO-ROLLBACK   TO TRUE                         20070000
200800         MOVE ' 2500-SEND-LABEL-REQUEST'                          20080000
200900             TO DP013-PARAGRAPH                                   20090000
201000         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  20100000
201100         PERFORM 9999-WRITE-CICS-LOG-MSG                          20110000
201200     END-IF.                                                      20120000
201300/                                                                 20130000
201400                                                                  20140000
201500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20150000
201600* WRITE LABEL STRING - TCP-BUF-3  TO WFT TABLES                 * 20160000
201700* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20170000
201800 2600-CAPTURE-DATA.                                               20180000
201900                                                                  20190000
202000      add  1  to  pv-capture-cnt.                                 20200000
202100                                                                  20210000
202200      if  pv-capture-cnt  =  1                                    20220000
202300          perform 2610-wft-dat-cntl                               20230000
202400          perform 2620-wft-dat-xfer                               20240000
202500      else                                                        20250000
202600          perform 2620-wft-dat-xfer                               20260000
202700      end-if.                                                     20270000
202800                                                                  20280000
202900                                                                  20290000
203000 2610-wft-dat-cntl.                                               20300000
203100                                                                  20310000
203200     CALL PC-RANDOM-PGM USING DFHEIBLK                            20320000
203300                              DFHCOMMAREA                         20330000
203400                              DP902-RANDNBR-ROUTINE-FIELDS.       20340000
203500                                                                  20350000
203600     move DP902-RANDOM-NUMBER     to PV-CAPTURE-RANDOM-NBR        20360000
203700                                                                  20370000
203800     EXEC SQL                                                     20380000
203900          SET :PV-RANDOM-TMST = CURRENT TIMESTAMP                 20390000
204000     END-EXEC.                                                    20400000
204100                                                                  20410000
204200     MOVE 'LABEL'                  TO WFT00004-TRN-TYP-CDE        20420000
204300     MOVE PV-CAPTURE-RANDOM-NBR    TO WFT00004-PRC-GP-ID          20430000
204400     MOVE PV-RANDOM-TMST           TO WFT00004-PRC-CNTL-TMST      20440000
204500     MOVE 0                        TO WFT00004-STR-NBR            20450000
204600     MOVE 'READY'                  TO WFT00004-STAT-CDE           20460000
204700     MOVE PV-RANDOM-TMST           TO WFT00004-BEG-PRC-TMST       20470000
204800     MOVE PC-DEFAULT-TMST          TO WFT00004-END-PRC-TMST       20480000
204900     MOVE 0                        TO WFT00004-DAT-LOD-VER-NBR    20490000
205000                                                                  20500000
205100     EXEC SQL                                                     20510000
205200        INSERT INTO WFT_DAT_CNTL                                  20520000
205300               ( TRN_TYP_CDE                                      20530000
205400                ,PRC_GP_ID                                        20540000
205500                ,PRC_CNTL_TMST                                    20550000
205600                ,STR_NBR                                          20560000
205700                ,STAT_CDE                                         20570000
205800                ,BEG_PRC_TMST                                     20580000
205900                ,END_PRC_TMST                                     20590000
206000                ,DAT_LOD_VER_NBR)                                 20600000
206100        VALUES (:WFT00004-TRN-TYP-CDE                             20610000
206200              , :WFT00004-PRC-GP-ID                               20620000
206300              , :WFT00004-PRC-CNTL-TMST                           20630000
206400              , :WFT00004-STR-NBR                                 20640000
206500              , :WFT00004-STAT-CDE                                20650000
206600              , :WFT00004-BEG-PRC-TMST                            20660000
206700              , :WFT00004-END-PRC-TMST                            20670000
206800              , :WFT00004-DAT-LOD-VER-NBR)                        20680000
206900     END-EXEC.                                                    20690000
207000                                                                  20700000
207100         EVALUATE TRUE                                            20710000
207200             WHEN SQLCODE = ZERO                                  20720000
207300                 CONTINUE                                         20730000
207400             WHEN SQLWARN0 NOT = SPACES                           20740000
207500             WHEN SQLCODE < ZERO                                  20750000
207600             WHEN SQLCODE > ZERO                                  20760000
207700                                                                  20770000
207800             MOVE '2610-wft-dat-cntl  '      TO DP013-PARAGRAPH   20780000
207900             MOVE 'WRITE HEADER TO WFT_DAT_CNTL'                  20790000
208000                                      TO DP013-MESSAGE-TEXT (1)   20800000
208100             MOVE SQLCA        TO DP013-SQLCA                     20810000
208200             MOVE 'WFT_DAT_CNTL      '  TO                        20820000
208300                                  DP013-DB2-TABLE-NAME (1)        20830000
208400             SET DP013-DB2-ABEND        to true                   20840000
208500                                                                  20850000
208600         END-EVALUATE.                                            20860000
208700                                                                  20870000
208800                                                                  20880000
208900 2620-WFT-DAT-XFER.                                               20890000
209000                                                                  20900000
209100     MOVE 'LABEL'                  TO WFT00005-TRN-TYP-CDE        20910000
209200     MOVE PV-CAPTURE-RANDOM-NBR    TO WFT00005-PRC-GP-ID          20920000
209300     MOVE PV-RANDOM-TMST           TO WFT00005-PRC-CNTL-TMST      20930000
209400     MOVE PV-CAPTURE-CNT           TO WFT00005-PRC-LOD-SEQ-ID     20940000
209500     MOVE 'DETAIL'                 TO WFT00005-RDM-PRC-TYP-CDE    20950000
209600     MOVE LENGTH OF TCP-BUF-3      TO WFT00005-LOD-DAT-TXT-LEN    20960000
209700     MOVE TCP-BUF-3                TO WFT00005-LOD-DAT-TXT-TEXT   20970000
209800                                                                  20980000
209900     EXEC SQL                                                     20990000
210000        INSERT INTO WFT_dat_XFER                                  21000000
210100               ( TRN_TYP_CDE                                      21010000
210200                ,PRC_GP_ID                                        21020000
210300                ,PRC_CNTL_TMST                                    21030000
210400                ,PRC_LOD_SEQ_ID                                   21040000
210500                ,RDM_PRC_TYP_CDE                                  21050000
210600                ,LOD_DAT_TXT)                                     21060000
210700        VALUES (:WFT00005-TRN-TYP-CDE                             21070000
210800               ,:WFT00005-PRC-GP-ID                               21080000
210900               ,:WFT00005-PRC-CNTL-TMST                           21090000
211000               ,:WFT00005-PRC-LOD-SEQ-ID                          21100000
211100               ,:WFT00005-RDM-PRC-TYP-CDE                         21110000
211200               ,:WFT00005-LOD-DAT-TXT)                            21120000
211300     END-EXEC.                                                    21130000
211400                                                                  21140000
211500         EVALUATE TRUE                                            21150000
211600             WHEN SQLCODE = ZERO                                  21160000
211700                 CONTINUE                                         21170000
211800             WHEN SQLWARN0 NOT = SPACES                           21180000
211900             WHEN SQLCODE < ZERO                                  21190000
212000             WHEN SQLCODE > ZERO                                  21200000
212100                                                                  21210000
212200             MOVE '2620-wft-dat-XFER  '      TO DP013-PARAGRAPH   21220000
212300             MOVE 'WRITE detail TO WFT_DAT_xfer'                  21230000
212400                                      TO DP013-MESSAGE-TEXT (1)   21240000
212500             MOVE SQLCA        TO DP013-SQLCA                     21250000
212600             MOVE 'WFT_DAT_CNTL      '  TO                        21260000
212700                                  DP013-DB2-TABLE-NAME (1)        21270000
212800             SET DP013-DB2-ABEND        to true                   21280000
212900                                                                  21290000
213000         END-EVALUATE.                                            21300000
213100                                                                  21310000
213200                                                                  21320000
213300 2800-CHECK-SOCKET-CONNECTION.                                    21330000
213400                                                                  21340000
213500     MOVE  '2800'  TO  PT-CURR-PARA.                              21350000
213600     IF  PS-BLD-INTERNAL-TABLE-YES                                21360000
213700         PERFORM 1600-INTERNAL-TABLE                              21370000
213800     else                                                         21380000
213900         MOVE 1            TO PT-CURR-ENTRIES                     21390000
214000         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     21400000
214100         perform 1610-BUILD-MESSAGE-DISPLAY                       21410000
214200     END-IF.                                                      21420000
214300                                                                  21430000
214400     MOVE ' 2800-CHECK-SOCKET-CONNECTION '                        21440000
214500                                 TO DP013-PARAGRAPH.              21450000
214600                                                                  21460000
214700* ZERO OUT ALL OUTPUT BIT MASKS FOR SELECT                        21470000
214800     PERFORM VARYING SOCKNO FROM 1 BY 1 UNTIL SOCKNO > SOCKETS    21480000
214900        MOVE '0' TO CHAR-ENTRY(SOCKNO)                            21490000
215000     END-PERFORM.                                                 21500000
215100     PERFORM 2900-CHAR-TO-BIT.                                    21510000
215200     MOVE BIT-MASK TO SELECT-RR-MASK.                             21520000
215300     MOVE BIT-MASK TO SELECT-RW-MASK.                             21530000
215400     MOVE BIT-MASK TO SELECT-RE-MASK.                             21540000
215500     MOVE BIT-MASK TO SELECT-EX-MASK.                             21550000
215600     MOVE BIT-MASK TO SELECT-WR-MASK.                             21560000
215700                                                                  21570000
215800* set all input bit masks for select to 1                         21580000
215900     PERFORM VARYING SOCKNO FROM 1 BY 1 UNTIL SOCKNO > SOCKETS    21590000
216000        MOVE '1' TO CHAR-ENTRY(SOCKNO)                            21600000
216100     END-PERFORM.                                                 21610000
216200     PERFORM 2900-CHAR-TO-BIT.                                    21620000
216300     MOVE BIT-MASK TO SELECT-RD-MASK.                             21630000
216400*                                                                 21640000
216500* ISSUE THE SELECT COMMAND ----------------------------           21650000
216600* SELECT WILL FLIP A BIT IN THE READ MASK TO '1' FOR ANY          21660000
216700* SOCKET THAT HAS DATA TO BE PROCESSED.                           21670000
216800*                                                                 21680000
216900                                                                  21690000
217000     MOVE 0 TO DP081-ERRNO.                                       21700000
217100     MOVE 0 TO DP081-RETCODE.                                     21710000
217200     CALL 'EZASOKET' USING DP081-SELECT-CMD                       21720000
217300         SELECT-NUMFDS SELECT-TIMEOUT                             21730000
217400         SELECT-RD-MASK SELECT-WR-MASK SELECT-EX-MASK             21740000
217500         SELECT-RR-MASK SELECT-RW-MASK SELECT-RE-MASK             21750000
217600         DP081-ERRNO DP081-RETCODE.                               21760000
217700                                                                  21770000
217800     If  PS-CSSL-LOGGING-YES                                      21780000
217900         MOVE  DP081-RETCODE  TO  PV-DP081-RETCODE                21790000
218000         INITIALIZE PV-CICS-MSG-AREA                              21800000
218100         STRING ' SUKCS781 2800'                                  21810016
218200                ' TASK:'          pv-task-x                       21820000
218300                ' DP081-RETCODE:' PV-DP081-RETCODE                21830000
218400                                  DELIMITED BY SIZE               21840000
218500                             INTO PV-CICS-MSG-AREA                21850000
218600         PERFORM 9990-WRITE-CICS                                  21860000
218700     END-IF                                                       21870000
218800                                                                  21880000
218900     IF DP081-RETCODE < 0                                         21890000
219000        INITIALIZE PV-CICS-MSG-AREA                               21900000
219100        SET PS-ERROR-RECEIVE TO TRUE                              21910000
219200        MOVE DP081-RETCODE TO PV-RETCODE                          21920000
219300        MOVE DP081-NBR-BYTES TO PV-TCPLENG                        21930000
219400        MOVE DP081-ERRNO   TO PV-ERRNO                            21940000
219500        STRING ' SUKCS781 2800'                                   21950016
219600               ' TASK:'          pv-task-x                        21960000
219700               ' SOCKET ERROR < 0'                                21970000
219800               ' RETCODE:'       PV-RETCODE                       21980000
219900               ' TCPLENG:'       PV-TCPLENG                       21990000
220000               ' ERRNO:'         PV-ERRNO                         22000000
220100               ' receive socket error'                            22010000
220200                                 DELIMITED BY SIZE                22020000
220300                            INTO PV-CICS-MSG-AREA                 22030000
220400          PERFORM 9990-WRITE-CICS                                 22040000
220500        SET PS-ERROR-RECEIVE TO TRUE                              22050000
220600                                                                  22060000
220700        INITIALIZE PV-CICS-MSG-AREA                               22070000
220800                                                                  22080000
220900        MOVE PC-CURRENT-PROGRAM-NAME    TO DP081-TCP-IP-PGM-NAME  22090000
221000        SET  DP081-TCP-IP-READ-ERR      TO TRUE                   22100000
221100        MOVE DP081-ERRNO                TO DP081-TCP-IP-ERR-NBR   22110000
221200        MOVE DP081-TCP-IP-LOGGING-MSG   TO PV-CICS-MSG-DATA       22120000
221300        MOVE PV-CICS-MSG-HOLD           TO PV-CICS-MSG-AREA       22130000
221400        MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH     22140000
221500                                                                  22150000
221600        EXEC CICS                                                 22160000
221700            WRITEQ TD                                             22170000
221800                QUEUE   ('CSSL')                                  22180000
221900                FROM    (PV-CICS-MSG-AREA)                        22190000
222000                LENGTH  (PV-COMMAREA-LENGTH)                      22200000
222100                RESP    (PV-CICS-RESPONSE)                        22210000
222200        END-EXEC                                                  22220000
222300                                                                  22230000
222400                                                                  22240000
222500     ELSE                                                         22250000
222600     IF DP081-RETCODE = 0                                         22260000
222700        INITIALIZE PV-CICS-MSG-AREA                               22270000
222800        SET PS-ERROR-RECEIVE TO TRUE                              22280000
222900        MOVE DP081-RETCODE TO PV-RETCODE                          22290000
223000        MOVE DP081-NBR-BYTES TO PV-TCPLENG                        22300000
223100        MOVE DP081-ERRNO   TO PV-ERRNO                            22310000
223200        STRING ' SUKCS781 2800'                                   22320016
223300               ' TASK:'          pv-task-x                        22330000
223400               ' SOCKET ERROR = 0'                                22340000
223500               ' RETCODE:'       PV-RETCODE                       22350000
223600               ' TCPLENG:'       PV-TCPLENG                       22360000
223700               ' ERRNO:'         PV-ERRNO                         22370000
223800               ' socket timeout'                                  22380000
223900                                 DELIMITED BY SIZE                22390000
224000                            INTO PV-CICS-MSG-AREA                 22400000
224100          PERFORM 9990-WRITE-CICS                                 22410000
224200        SET PS-ERROR-RECEIVE TO TRUE                              22420000
224300                                                                  22430000
224400        INITIALIZE PV-CICS-MSG-AREA                               22440000
224500                                                                  22450000
224600        MOVE PC-CURRENT-PROGRAM-NAME    TO DP081-TCP-IP-PGM-NAME  22460000
224700        SET  DP081-TCP-IP-READ-ERR      TO TRUE                   22470000
224800        MOVE DP081-ERRNO                TO DP081-TCP-IP-ERR-NBR   22480000
224900        MOVE DP081-TCP-IP-LOGGING-MSG   TO PV-CICS-MSG-DATA       22490000
225000        MOVE PV-CICS-MSG-HOLD           TO PV-CICS-MSG-AREA       22500000
225100        MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH     22510000
225200                                                                  22520000
225300        EXEC CICS                                                 22530000
225400            WRITEQ TD                                             22540000
225500                QUEUE   ('CSSL')                                  22550000
225600                FROM    (PV-CICS-MSG-AREA)                        22560000
225700                LENGTH  (PV-COMMAREA-LENGTH)                      22570000
225800                RESP    (PV-CICS-RESPONSE)                        22580000
225900        END-EXEC                                                  22590000
226000                                                                  22600000
226100     END-IF.                                                      22610000
226200                                                                  22620000
226300***************************************************************   22630000
226400* CHAR-TO-BIT                                                 *   22640000
226500* CONVERT THE CHARACTER ARRAY TO A SELECT BIT MASK SO THAT THE*   22650000
226600* COBOL PROGRAM CAN WRITE IT.                                 *   22660000
226700***************************************************************   22670000
226800 2900-CHAR-TO-BIT.                                                22680000
226900                                                                  22690000
227000     MOVE  '2900'  TO  PT-CURR-PARA.                              22700000
227100     IF  PS-BLD-INTERNAL-TABLE-YES                                22710000
227200         PERFORM 1600-INTERNAL-TABLE                              22720000
227300     else                                                         22730000
227400         MOVE 1            TO PT-CURR-ENTRIES                     22740000
227500         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     22750000
227600         perform 1610-BUILD-MESSAGE-DISPLAY                       22760000
227700     END-IF.                                                      22770000
227800                                                                  22780000
227900     MOVE ' 2900-CHAR-TO-BIT    '                                 22790000
228000                                 TO DP013-PARAGRAPH.              22800000
228100                                                                  22810000
228200*                                                                 22820000
228300* CHAR-TO-BIT                                                     22830000
228400* CONVERT THE CHARACTER ARRAY TO A SELECT BIT MASK SO THAT THE    22840000
228500* COBOL PROGRAM CAN WRITE IT.                                     22850000
228600*                                                                 22860000
228700     CALL 'EZACIC06' USING BITMASK-TOKEN CTOB                     22870000
228800          BIT-MASK CHAR-MASK BIT-MASK-LENGTH EZRETC               22880000
228900     IF  EZRETC < 0 THEN                                          22890000
229000         MOVE '!EZCIC06 - CTOB-EXCP ' TO PV-CICS-MSG-AREA         22900000
229100         MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH    22910000
229200                                                                  22920000
229300         EXEC CICS                                                22930000
229400             WRITEQ TD                                            22940000
229500                 QUEUE   ('CSSL')                                 22950000
229600                 FROM    (PV-CICS-MSG-AREA)                       22960000
229700                 LENGTH  (PV-COMMAREA-LENGTH)                     22970000
229800                 RESP    (PV-CICS-RESPONSE)                       22980000
229900         END-EXEC                                                 22990000
230000         INITIALIZE PV-CICS-MSG-AREA                              23000000
230100         STRING ' SUKCS781 2900'                                  23010016
230200                ' TASK:'         pv-task-x                        23020000
230300                ' RECEIVE ERROR '                                 23030000
230400                                 DELIMITED BY SIZE                23040000
230500                            INTO PV-CICS-MSG-AREA                 23050000
230600          PERFORM 9990-WRITE-CICS                                 23060000
230700         SET PS-ERROR-RECEIVE TO TRUE                             23070000
230800     END-IF.                                                      23080000
230900                                                                  23090000
231000*----------------------------------------------------------------*23100000
231100*    THIS PARAGRAPH WILL CONTROL THE RECEIVES TO CAPTURE ALL     *23110000
231200*    OF THE DATA BEING PASSED TO THE MAINFRAME FROM THE ASI      *23120000
231300*    SYSTEM.  THIS PARAGRAPH IS WRITTEN WITH THE UNDERSTANDING   *23130000
231400*    THAT A RECEIVE COMMAND MAY OR MAY NOT BRING BACK AN ENTIRE  *23140000
231500*    SOCKET PACKET OF DATA.  WE ARE EXPECTING A BLOCK OF 50      *23150000
231600*    CHARACTERS TO BE RECEIVED, HOWEVER, IF LESS THAN 50 ARE     *23160000
231700*    RECEIVED, THEN THIS PARAGRAPH WILL LOOP UNTIL THE ENTIRE    *23170000
231800*    FIFTY IS RECEIVED.                                          *23180000
231900*----------------------------------------------------------------*23190000
232000                                                                  23200000
232100 3000-RECEIVE-TCP.                                                23210000
232200                                                                  23220000
232300     MOVE  '3000'  TO  PT-CURR-PARA.                              23230000
232400     IF  PS-BLD-INTERNAL-TABLE-YES                                23240000
232500         PERFORM 1600-INTERNAL-TABLE                              23250000
232600     else                                                         23260000
232700         MOVE 1            TO PT-CURR-ENTRIES                     23270000
232800         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     23280000
232900         perform 1610-BUILD-MESSAGE-DISPLAY                       23290000
233000     END-IF.                                                      23300000
233100                                                                  23310000
233200     MOVE ' 3000-RECEIVE-TCP-PARA'                                23320000
233300                                 TO DP013-PARAGRAPH.              23330000
233400                                                                  23340000
233500     CALL 'EZASOKET'                                              23350000
233600         USING                                                    23360000
233700                DP081-RECV-CMD                                    23370000
233800                DP081-SOCK-ID                                     23380000
233900                DP081-FLAG                                        23390000
234000                DP081-NBR-BYTES                                   23400000
234100                TCP-BUF                                           23410000
234200                DP081-ERRNO                                       23420000
234300                DP081-RETCODE.                                    23430000
234400                                                                  23440000
234500                                                                  23450000
234600     IF  DP081-RETCODE < ZERO                                     23460000
234700             INITIALIZE PV-CICS-MSG-AREA                          23470000
234800             SET PS-ERROR-RECEIVE TO TRUE                         23480000
234900             MOVE DP081-RETCODE TO PV-RETCODE                     23490000
235000             MOVE DP081-NBR-BYTES TO PV-TCPLENG                   23500000
235100             MOVE DP081-ERRNO   TO PV-ERRNO                       23510000
235200             STRING ' SUKCS781 3000'                              23520016
235300                    ' TASK:'      pv-task-x                       23530000
235400                    ' sOCKET ERROR < 0'                           23540000
235500                    ' RETCODE:'   PV-RETCODE                      23550000
235600                    ' TCPLENG:'   PV-TCPLENG                      23560000
235700                    ' ERRNO:'     PV-ERRNO                        23570000
235800                                  DELIMITED BY SIZE               23580000
235900                             INTO PV-CICS-MSG-AREA                23590000
236000             PERFORM 9990-WRITE-CICS                              23600000
236100         SET PS-ERROR-RECEIVE TO TRUE                             23610000
236200*        PERFORM 3300-SEND-ERROR-CONFIRM-ASI                      23620000
236300*        PERFORM 1500-CLOSE-SOCKET                                23630000
236400         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        23640000
236500         SET  DP081-TCP-IP-READ-ERR TO TRUE                       23650000
236600*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         23660000
236700*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE23670000
236800*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  23680000
236900*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               23690000
237000*   DP013-MESSAGE-TEXT GROUP LEVEL.                               23700000
237100         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          23710000
237200         SET  DP013-OTHER-ABEND   TO TRUE                         23720000
237300         SET  DP013-NO-ROLLBACK   TO TRUE                         23730000
237400         MOVE ' 3000-RECEIVE-TCP-1'                               23740000
237500             TO DP013-PARAGRAPH                                   23750000
237600         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  23760000
237700         PERFORM 9999-WRITE-CICS-LOG-MSG                          23770000
237800     ELSE                                                         23780000
237900         IF  DP081-RETCODE = 0                                    23790000
238000             INITIALIZE PV-CICS-MSG-AREA                          23800000
238100             SET PS-ERROR-RECEIVE TO TRUE                         23810000
238200             MOVE DP081-RETCODE TO PV-RETCODE                     23820000
238300             MOVE DP081-NBR-BYTES TO PV-TCPLENG                   23830000
238400             MOVE DP081-ERRNO   TO PV-ERRNO                       23840000
238500             STRING ' SUKCS781 3000'                              23850016
238600                    ' TASK:'       pv-task-x                      23860000
238700                    ' SOCKET ERROR EQ 0'                          23870000
238800                    ' RETCODE:'    PV-RETCODE                     23880000
238900                    ' TCPLENG:'    PV-TCPLENG                     23890000
239000                    ' ERRNO:'      PV-ERRNO                       23900000
239100                                   DELIMITED BY SIZE              23910000
239200                              INTO PV-CICS-MSG-AREA               23920000
239300             PERFORM 9990-WRITE-CICS                              23930000
239400             MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME    23940000
239500             SET  DP081-TCP-IP-READ-ERR TO TRUE                   23950000
239600*            MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR     23960000
239700*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE23970000
239800*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  23980000
239900*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               23990000
240000*   DP013-MESSAGE-TEXT GROUP LEVEL.                               24000000
240100             COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10      24010000
240200             SET  DP013-OTHER-ABEND   TO TRUE                     24020000
240300             SET  DP013-NO-ROLLBACK   TO TRUE                     24030000
240400             MOVE ' 3000-RECEIVE-TCP-2'                           24040000
240500                 TO DP013-PARAGRAPH                               24050000
240600             MOVE DP081-TCP-IP-LOGGING-MSG                        24060000
240700                                      TO DP013-MESSAGE-TEXT (1)   24070000
240800             PERFORM 9999-WRITE-CICS-LOG-MSG                      24080000
240900         ELSE                                                     24090000
241000             MOVE DP081-RETCODE TO PV-TCP-RET-LENGTH              24100000
241100             IF  PV-TCP-RET-LENGTH = PV-TCP-EXP-LENGTH            24110000
241200                 SET PS-COMP-RECEIVE TO TRUE                      24120000
241300*                BEGIN OF TRANSLATE ASCII TO EBCDIC               24130000
241400                 CALL 'EZACIC05'                                  24140000
241500                     USING  DP081-TOEBCDIC-TOKEN                  24150000
241600                            TCP-BUF2                              24160000
241700                            DP081-NBR-BYTES                       24170000
241800*                END OF TRANSLATE ASCII TO EBCDIC                 24180000
241900                                                                  24190000
242000               IF PS-CSSL-LOGGING-YES                             24200000
242100                  INITIALIZE PV-CICS-MSG-AREA                     24210000
242200                  STRING ' SUKCS781 3000'                         24220016
242300                         ' TASK:'          pv-task-x              24230000
242400                         ' GOOD RECEIVE '  TCP-BUF                24240000
242500                                           DELIMITED BY SIZE      24250000
242600                                      INTO PV-CICS-MSG-AREA       24260000
242700                  PERFORM 9990-WRITE-CICS                         24270000
242800                                                                  24280000
242900                  MOVE DP081-NBR-BYTES   TO PV-NBR-BYTES          24290000
243000                  INITIALIZE PV-CICS-MSG-AREA                     24300000
243100                  STRING ' SUKCS781 3000'                         24310016
243200                         ' TASK:'          pv-task-x              24320000
243300                         ' NBR OF BYTES '  PV-NBR-BYTES           24330000
243400                                           DELIMITED BY SIZE      24340000
243500                                      INTO PV-CICS-MSG-AREA       24350000
243600                  PERFORM 9990-WRITE-CICS                         24360000
243700               END-IF                                             24370000
243800                                                                  24380000
243900             ELSE                                                 24390000
244000                 IF  PV-TCP-RET-LENGTH > DP081-NBR-BYTES          24400000
244100                     SET PS-ERROR-RECEIVE TO TRUE                 24410000
244200                     INITIALIZE PV-CICS-MSG-AREA                  24420000
244300                     MOVE DP081-RETCODE TO PV-RETCODE             24430000
244400                     MOVE DP081-NBR-BYTES TO PV-TCPLENG           24440000
244500                     MOVE DP081-ERRNO   TO PV-ERRNO               24450000
244600                     STRING ' SUKCS781 3000'                      24460016
244700                            ' TASK:'            pv-task-x         24470000
244800                            'SOCKET LENGTH ERROR #1'              24480000
244900                            ' RETCODE:'         PV-RETCODE        24490000
245000                            ' DP081-NBR-BYTES:' PV-TCPLENG        24500000
245100                            ' ERRNO:'           PV-ERRNO          24510000
245200                                                DELIMITED BY SIZE 24520000
245300                                           INTO PV-CICS-MSG-AREA  24530000
245400                     PERFORM 9990-WRITE-CICS                      24540000
245500*                    PERFORM 1500-CLOSE-SOCKET                    24550000
245600*                    BEGIN OF TRANSLATE ASCII TO EBCDIC           24560000
245700                     CALL 'EZACIC05'                              24570000
245800                         USING  DP081-TOEBCDIC-TOKEN              24580000
245900                                TCP-BUF2                          24590000
246000                                DP081-NBR-BYTES                   24600000
246100*                    END OF TRANSLATE ASCII TO EBCDIC             24610000
246200                                                                  24620000
246300* JUST FOR TESTING - BEGIN                                        24630000
246400*                    INITIALIZE PV-CICS-MSG-AREA                  24640000
246500*                    STRING ' SUKCS781 3000'                      24650016
246600*                           ' TASK:'            pv-task-x         24660000
246700*                         TCP-BUF2                                24670000
246800*                                               DELIMITED BY SIZE 24680000
246900*                                          INTO PV-CICS-MSG-AREA  24690000
247000*                    PERFORM 9990-WRITE-CICS                      24700000
247100* JUST FOR TESTING - END                                          24710000
247200                                                                  24720000
247300                     MOVE PC-CURRENT-PGM-NAME TO                  24730000
247400                                            DP081-TCP-IP-PGM-NAME 24740000
247500                     SET  DP081-TCP-IP-READ-ERR TO TRUE           24750000
247600*                    MOVE DP081-ERRNO         TO                  24760000
247700*                                            DP081-TCP-IP-ERR-NBR 24770000
247800*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE24780000
247900*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  24790000
248000*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               24800000
248100*   DP013-MESSAGE-TEXT GROUP LEVEL.                               24810000
248200                     COMPUTE DP081-TCP-IP-ERR-NBR =               24820000
248300                                            DP081-ERRNO * 10      24830000
248400                     SET  DP013-OTHER-ABEND   TO TRUE             24840000
248500                     SET  DP013-NO-ROLLBACK   TO TRUE             24850000
248600                     MOVE ' 3000-RECEIVE-TCP-3'                   24860000
248700                         TO DP013-PARAGRAPH                       24870000
248800                     MOVE DP081-TCP-IP-LOGGING-MSG TO             24880000
248900                          DP013-MESSAGE-TEXT (1)                  24890000
249000                     PERFORM 9999-WRITE-CICS-LOG-MSG              24900000
249100                 ELSE                                             24910000
249200                     ADD 1 TO PV-PARTIAL-TCP-COUNT                24920000
249300                     PERFORM 3100-PROCESS-PARTIAL-TCP             24930000
249400                 END-IF                                           24940000
249500             END-IF                                               24950000
249600         END-IF                                                   24960000
249700     END-IF.                                                      24970000
249800                                                                  24980000
249900*----------------------------------------------------------------*24990000
250000*    THIS PARAGRAPH WILL BE USED WHEN WHAT IS RECEIVED VIA A     *25000000
250100*    SOCKET IS LESS THAN WHAT WAS EXPECTED TO BE RETURNED.       *25010000
250200*    THIS PARAGRAPH WILL DETERMINE IF THE PARTIAL IS A FIRST     *25020000
250300*    RECEIPT OF A NEW PACKET OR AN ADDITIONAL RECEIPT OF A       *25030000
250400*    PACKAGE AND THEN TAKE THE RECEIVED DATA AND CHARACTER BY    *25040000
250500*    CHARACTER MOVE FROM THE RECEIVED FIELD TO THE ASSEMBLE      *25050000
250600*    FIELD IN ORDER TO BUILD THE SOCKET PACKET OVER MULTIPLE     *25060000
250700*    RECEIVE COMMANDS.                                           *25070000
250800*----------------------------------------------------------------*25080000
250900                                                                  25090000
251000 3100-PROCESS-PARTIAL-TCP.                                        25100000
251100                                                                  25110000
251200     MOVE  '3100'  TO  PT-CURR-PARA.                              25120000
251300     IF  PS-BLD-INTERNAL-TABLE-YES                                25130000
251400         PERFORM 1600-INTERNAL-TABLE                              25140000
251500     else                                                         25150000
251600         MOVE 1            TO PT-CURR-ENTRIES                     25160000
251700         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     25170000
251800         perform 1610-BUILD-MESSAGE-DISPLAY                       25180000
251900     END-IF.                                                      25190000
252000                                                                  25200000
252100*    MOVE ' 3100-PROCESS-PARTIAL-TCP'                             25210000
252200*                                TO DP013-PARAGRAPH.              25220000
252300*    INITIALIZE PV-CICS-MSG-AREA.                                 25230000
252400*    MOVE ' SUKCS781: 3100-PROCESS-PARTIAL-TCP'                   25240016
252500*                            TO PV-CICS-MSG-AREA.                 25250000
252600*    PERFORM 9990-WRITE-CICS.                                     25260000
252700     IF  PS-START-RECEIVE                                         25270000
252800         SET PS-PART-RECEIVE TO TRUE                              25280000
252900         SET PT-ASSEMBLE-IDX TO 1                                 25290000
253000         MOVE ZEROS TO PV-TCP-PRCSD-LENGTH                        25300000
253100     END-IF.                                                      25310000
253200                                                                  25320000
253300     ADD PV-TCP-RET-LENGTH TO PV-TCP-PRCSD-LENGTH.                25330000
253400                                                                  25340000
253500     IF  PV-TCP-PRCSD-LENGTH > PV-TCP-EXP-LENGTH                  25350000
253600         INITIALIZE PV-CICS-MSG-AREA                              25360000
253700         MOVE DP081-RETCODE TO PV-RETCODE                         25370000
253800         MOVE DP081-NBR-BYTES TO PV-TCPLENG                       25380000
253900         MOVE DP081-ERRNO   TO PV-ERRNO                           25390000
254000         STRING ' SUKCS781 3100'                                  25400016
254100                ' TASK:'         pv-task-x                        25410000
254200                ' SOCKET TOTAL LENGTH ERROR'                      25420000
254300                ' RETCODE:'      PV-RETCODE                       25430000
254400                ' TOTLENG:'      PV-TCP-PRCSD-LENGTH              25440000
254500                ' ERRNO:'        PV-ERRNO                         25450000
254600                                 delimited by size                25460000
254700                            iNTO PV-CICS-MSG-AREA                 25470000
254800         PERFORM 9990-WRITE-CICS                                  25480000
254900*        PERFORM 1500-CLOSE-SOCKET                                25490000
255000*        BEGIN OF TRANSLATE ASCII TO EBCDIC                       25500000
255100         CALL 'EZACIC05'                                          25510000
255200             USING  DP081-TOEBCDIC-TOKEN                          25520000
255300                    TCP-BUF2                                      25530000
255400                    DP081-NBR-BYTES                               25540000
255500*        END OF TRANSLATE ASCII TO EBCDIC                         25550000
255600                                                                  25560000
255700* JUST FOR TESTING - BEGIN                                        25570000
255800*        INITIALIZE PV-CICS-MSG-AREA                              25580000
255900*        STRING ' SUKCS781:'                                      25590016
256000*             TCP-BUF2                                            25600000
256100*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              25610000
256200*        PERFORM 9990-WRITE-CICS                                  25620000
256300* JUST FOR TESTING - END                                          25630000
256400                                                                  25640000
256500         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        25650000
256600         SET  DP081-TCP-IP-READ-ERR TO TRUE                       25660000
256700*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         25670000
256800*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE25680000
256900*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  25690000
257000*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               25700000
257100*   DP013-MESSAGE-TEXT GROUP LEVEL.                               25710000
257200         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          25720000
257300         SET  DP013-OTHER-ABEND   TO TRUE                         25730000
257400         SET  DP013-NO-ROLLBACK   TO TRUE                         25740000
257500         MOVE ' 3100-PROCESS-PARTIAL-TCP'                         25750000
257600             TO DP013-PARAGRAPH                                   25760000
257700         MOVE DP081-TCP-IP-LOGGING-MSG TO                         25770000
257800              DP013-MESSAGE-TEXT (1)                              25780000
257900         PERFORM 9999-WRITE-CICS-LOG-MSG                          25790000
258000     END-IF.                                                      25800000
258100                                                                  25810000
258200*  DISPLAYS ADDED TO DISPLAY A PARTIAL SOCKET RECEIVE             25820000
258300*  \/                                                             25830000
258400                                                                  25840000
258500     INITIALIZE PV-CICS-MSG-AREA.                                 25850000
258600     MOVE DP081-RETCODE TO PV-RETCODE.                            25860000
258700     MOVE DP081-NBR-BYTES TO PV-TCPLENG.                          25870000
258800     MOVE DP081-ERRNO   TO PV-ERRNO.                              25880000
258900                                                                  25890000
259000     IF PS-CSSL-LOGGING-YES                                       25900000
259100        STRING ' SUKCS781 3100'                                   25910016
259200               ' TASK:'  pv-task-x                                25920000
259300               ' SOCKET PARTIAL RECEIVE'                          25930000
259400               ' RETCODE:'   PV-RETCODE                           25940000
259500               ' TCPLENG:'   PV-TCPLENG                           25950000
259600               ' ERRNO:'     PV-ERRNO                             25960000
259700                             DELIMITED BY SIZE                    25970000
259800                        INTO PV-CICS-MSG-AREA                     25980000
259900        PERFORM 9990-WRITE-CICS                                   25990000
260000     END-IF                                                       26000000
260100                                                                  26010000
260200*        BEGIN OF TRANSLATE ASCII TO EBCDIC                       26020000
260300     MOVE TCP-BUF TO PV-TCP-BUF.                                  26030000
260400     CALL 'EZACIC05'                                              26040000
260500         USING  DP081-TOEBCDIC-TOKEN                              26050000
260600                PV-TCP-BUF                                        26060000
260700                DP081-NBR-BYTES.                                  26070000
260800*        END OF TRANSLATE ASCII TO EBCDIC                         26080000
260900                                                                  26090000
261000* JUST FOR TESTING - BEGIN                                        26100000
261100*    INITIALIZE PV-CICS-MSG-AREA.                                 26110000
261200*    STRING ' SUKCS781 3100'                                      26120016
261300*           ' TASK:'         pv-task-x                            26130000
261400*           '-'              PV-TCP-BUF                           26140000
261500*                             DELIMITED BY SIZE                   26150000
261600*                        INTO PV-CICS-MSG-AREA.                   26160000
261700*    PERFORM 9990-WRITE-CICS.                                     26170000
261800* JUST FOR TESTING - END                                          26180000
261900                                                                  26190000
262000*  /\                                                             26200000
262100*  DISPLAYS ADDED TO DISPLAY A PARTIAL SOCKET RECEIVE             26210000
262200                                                                  26220000
262300     MOVE TCP-BUF TO PT-TCP-RECEIVE-TABLE.                        26230000
262400                                                                  26240000
262500     PERFORM 3200-ASSEMBLE-DATA                                   26250000
262600         VARYING PT-RECEIVE-IDX FROM 1 BY 1                       26260000
262700             UNTIL PT-RECEIVE-IDX > PV-TCP-RET-LENGTH.            26270000
262800                                                                  26280000
262900     IF  PV-TCP-PRCSD-LENGTH = PV-TCP-EXP-LENGTH                  26290000
263000         SET PS-COMP-RECEIVE TO TRUE                              26300000
263100         MOVE SPACES TO TCP-BUF2                                  26310000
263200         MOVE PT-TCP-ASSEMBLE-TABLE TO TCP-BUF                    26320000
263300         MOVE PV-TCP-EXP-LENGTH TO DP081-NBR-BYTES                26330000
263400*        BEGIN OF TRANSLATE ASCII TO EBCDIC                       26340000
263500         CALL 'EZACIC05'                                          26350000
263600             USING  DP081-TOEBCDIC-TOKEN                          26360000
263700                    TCP-BUF2                                      26370000
263800                    DP081-NBR-BYTES                               26380000
263900*        END OF TRANSLATE ASCII TO EBCDIC                         26390000
264000                                                                  26400000
264100* JUST FOR TESTING - BEGIN                                        26410000
264200*        INITIALIZE PV-CICS-MSG-AREA                              26420000
264300*        STRING ' SUKCS781:STRUNG DATA  '                         26430016
264400*             TCP-BUF2                                            26440000
264500*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              26450000
264600*        PERFORM 9990-WRITE-CICS                                  26460000
264700* JUST FOR TESTING - END                                          26470000
264800                                                                  26480000
264900     ELSE                                                         26490000
265000         SUBTRACT PV-TCP-PRCSD-LENGTH FROM                        26500000
265100                  PV-TCP-EXP-LENGTH   GIVING                      26510000
265200                  PV-TCP-REM-LENGTH                               26520000
265300         MOVE PV-TCP-REM-LENGTH TO DP081-NBR-BYTES                26530000
265400                                                                  26540000
265500* JUST FOR TESTING - BEGIN                                        26550000
265600*        INITIALIZE PV-CICS-MSG-AREA                              26560000
265700*        STRING ' SUKCS781 3100'                                  26570016
265800*               ' TASK:'             PV-TASK-X                    26580000
265900*               ' SOCKET GET MORE LENGTH'                         26590000
266000*               ' PRCSD:'            PV-TCP-PRCSD-LENGTH          26600000
266100*               ' EXPECT:'           PV-TCP-EXP-LENGTH            26610000
266200*               ' REMAIN:'           PV-TCP-REM-LENGTH            26620000
266300*                                    DELIMITED BY SIZE            26630000
266400*                               INTO PV-CICS-MSG-AREA             26640000
266500*        PERFORM 9990-WRITE-CICS                                  26650000
266600* JUST FOR TESTING - END                                          26660000
266700                                                                  26670000
266800     END-IF.                                                      26680000
266900                                                                  26690000
267000                                                                  26700000
267100*----------------------------------------------------------------*26710000
267200*    THIS PARAGRAPH WILL ASSEMBLE THE DATA THAT WAS RECEIVED     *26720000
267300*    WITH THE DATA RECEIVED FROM PREVIOUS RECEIVES FOR THE       *26730000
267400*    SOCKET PACKET.                                              *26740000
267500*----------------------------------------------------------------*26750000
267600                                                                  26760000
267700 3200-ASSEMBLE-DATA.                                              26770000
267800                                                                  26780000
267900     MOVE  '3200'  TO  PT-CURR-PARA.                              26790000
268000     IF  PS-BLD-INTERNAL-TABLE-YES                                26800000
268100         PERFORM 1600-INTERNAL-TABLE                              26810000
268200     else                                                         26820000
268300         MOVE 1            TO PT-CURR-ENTRIES                     26830000
268400         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     26840000
268500         perform 1610-BUILD-MESSAGE-DISPLAY                       26850000
268600     END-IF.                                                      26860000
268700                                                                  26870000
268800     MOVE ' 3200-ASSEMBLE-DATA'                                   26880000
268900                                 TO DP013-PARAGRAPH.              26890000
269000     MOVE PT-TCP-RECEIVE-CHAR (PT-RECEIVE-IDX) TO                 26900000
269100          PT-TCP-DATA-CHAR (PT-ASSEMBLE-IDX).                     26910000
269200     SET PT-ASSEMBLE-IDX UP BY 1.                                 26920000
269300                                                                  26930000
269400                                                                  26940000
269500*----------------------------------------------------------------*26950000
269600*    SEND AN ERROR CONFIRMATION RECORD TO THE PACK TO LIGHT      *26960000
269700*    SYSTEM, INDICATING THERE WAS AN ERROR WITH THE DATA WE      *26970000
269800*    RECEIVED FROM THEM.                                         *26980000
269900*----------------------------------------------------------------*26990000
270000 3300-SEND-ERROR-CONFIRM-ASI.                                     27000000
270100                                                                  27010000
270200     MOVE  '3300'  TO  PT-CURR-PARA.                              27020000
270300     IF  PS-BLD-INTERNAL-TABLE-YES                                27030000
270400         PERFORM 1600-INTERNAL-TABLE                              27040000
270500     else                                                         27050000
270600         MOVE 1            TO PT-CURR-ENTRIES                     27060000
270700         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     27070000
270800         perform 1610-BUILD-MESSAGE-DISPLAY                       27080000
270900     END-IF.                                                      27090000
271000                                                                  27100000
271100     MOVE ' 3300-SEND-ERROR-CONFIRM-ASI'                          27110000
271200                                 TO DP013-PARAGRAPH.              27120000
271300                                                                  27130000
271400     MOVE SPACES              TO TCP-BUF2.                        27140000
271500     MOVE SU051-MESSAGE-SEQ-NUMBER                                27150000
271600                              TO SU052-MESSAGE-SEQ-NUMBER-SML.    27160000
271700     MOVE SPACES              TO SU052-KOHLS-SML-LBL              27170000
271800     MOVE +1                  TO SU052-FRCD-DIVERT-IND-SML        27180000
271900     MOVE +1                  TO SU052-DWNLD-PRINT-IND-SML        27190000
272000     MOVE SU052-LABEL-DWNLD-RECORD-MSG TO TCP-BUF.                27200000
272100                                                                  27210000
272200     MOVE 14                  TO                                  27220000
272300                                 DP081-NBR-BYTES                  27230000
272400                                 DP081-TCPLENG.                   27240000
272500                                                                  27250000
272600* TRANSLATE EBCDIC TO ASCII                                       27260000
272700     CALL 'EZACIC04'                                              27270000
272800         USING  DP081-TOASCII-TOKEN                               27280000
272900                TCP-BUF                                           27290000
273000                DP081-TCPLENG.                                    27300000
273100                                                                  27310000
273200* WRITE DATA ON A CONNECTED SOCKET                                27320000
273300     CALL 'EZASOKET'                                              27330000
273400         USING                                                    27340000
273500                DP081-WRITE-CMD                                   27350000
273600                DP081-SOCK-ID                                     27360000
273700                DP081-NBR-BYTES                                   27370000
273800                TCP-BUF                                           27380000
273900                DP081-ERRNO                                       27390000
274000                DP081-RETCODE.                                    27400000
274100*                                                                 27410000
274200     IF DP081-RETCODE < ZERO                                      27420000
274300         MOVE PC-CURRENT-PGM-NAME TO DP081-TCP-IP-PGM-NAME        27430000
274400         SET  DP081-TCP-IP-SEND-TO-ERR TO TRUE                    27440000
274500*        MOVE DP081-ERRNO         TO DP081-TCP-IP-ERR-NBR         27450000
274600*   THE DP081-TCP-IP-ERR-NBR FIELD IS MULTIPLIED BY 10 BECAUSE THE27460000
274700*   DP081-TCP-IP-LOGGING-MSG GROUP LEVEL IS 80 CHARACTERS.  THIS  27470000
274800*   IS TRUNCATED TO 79 CHARACTERS WHEN MOVED TO THE               27480000
274900*   DP013-MESSAGE-TEXT GROUP LEVEL.                               27490000
275000         COMPUTE DP081-TCP-IP-ERR-NBR = DP081-ERRNO * 10          27500000
275100         SET  DP013-OTHER-ABEND   TO TRUE                         27510000
275200         SET  DP013-NO-ROLLBACK   TO TRUE                         27520000
275300         MOVE ' 3300-SEND-ERROR-CONFIRM-ASI'                      27530000
275400             TO DP013-PARAGRAPH                                   27540000
275500         MOVE DP081-TCP-IP-LOGGING-MSG TO DP013-MESSAGE-TEXT (1)  27550000
275600         PERFORM 9999-WRITE-CICS-LOG-MSG                          27560000
275700     END-IF.                                                      27570000
275800/                                                                 27580000
275900                                                                  27590000
276000*                                                                 27600000
276100                                                                  27610000
276200 4000-VALIDATE-TRIP-ID.                                           27620000
276300                                                                  27630000
276400     MOVE  '4000'  TO  PT-CURR-PARA.                              27640000
276500     IF  PS-BLD-INTERNAL-TABLE-YES                                27650000
276600         PERFORM 1600-INTERNAL-TABLE                              27660000
276700     else                                                         27670000
276800         MOVE 1            TO PT-CURR-ENTRIES                     27680000
276900         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     27690000
277000         perform 1610-BUILD-MESSAGE-DISPLAY                       27700000
277100     END-IF.                                                      27710000
277200                                                                  27720000
277300     MOVE SU051-TRIP-ID            TO TRIPST-TRIP-ID              27730000
277400     MOVE SU051-DC-NUMBER          TO DK-OPER-UNT-ID              27740000
277500                                                                  27750000
277600     EXEC SQL                                                     27760000
277700       SELECT DISTINCT                                            27770000
277800              A.TRIP_STATUS_CDE                                   27780000
277900            , CURRENT DATE                                        27790000
278000            , CURRENT TIME                                        27800000
278100       INTO   :TRIPST-TRIP-STATUS-CDE                             27810000
278200            , :PV-WORK-DB2-DATE                                   27820000
278300            , :PV-CURRENT-TIME                                    27830000
278400       FROM   TTRIPST A                                           27840000
278500             ,TTRSTYP B                                           27850000
278600             ,TVHTRIP C                                           27860000
278700       WHERE  A.TRIP_ID     = :TRIPST-TRIP-ID                     27870000
278800         AND  A.TRIP_ID     = C.TRIP_ID                           27880000
278900         AND  C.VEH_NBR     IS NOT NULL                           27890000
279000         AND  A.TRIP_STATUS_CDE  = B.TRIP_STATUS_CDE              27900000
279100         AND  A.OPER_UNT_ID      = :DK-OPER-UNT-ID                27910000
279200         AND  B.PRTY_CDE =                                        27920000
279300             (SELECT DISTINCT                                     27930000
279400                  MAX(D.PRTY_CDE)                                 27940000
279500               FROM   TTRIPST C                                   27950000
279600                     ,TTRSTYP D                                   27960000
279700               WHERE  C.TRIP_ID     = :TRIPST-TRIP-ID             27970000
279800                 AND  C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)      27980000
279900        with ur                                                   27990000
280000     END-EXEC.                                                    28000000
280100                                                                  28010000
280200     EVALUATE TRUE                                                28020000
280300         WHEN SQLCODE = ZERO                                      28030000
280400             SET PS-INPUT-DATA-ERROR-NO                           28040000
280500                 PS-TRIP-ERROR-NO        TO TRUE                  28050000
280600         WHEN SQLCODE = +100                                      28060000
280700             SET PS-INPUT-DATA-ERROR-YES                          28070000
280800                 PS-TRIP-ERROR-YES       TO TRUE                  28080000
280900             MOVE 'TRIP ERR ' TO PV-ERROR-MESSAGE                 28090000
281000         WHEN SQLWARN0 NOT = SPACES                               28100000
281100         WHEN SQLCODE NOT EQUAL ZERO                              28110000
281200             perform 1620-WRITE-SUWS051-TO-CSSL                   28120000
281300                                                                  28130000
281400             MOVE '7500-VALIDATE-TRIP-ID'                         28140000
281500                             TO DP013-PARAGRAPH                   28150000
281600             MOVE 'CHECK TRIP STATUS'                             28160000
281700                             TO DP013-MESSAGE-TEXT(1)             28170000
281800             MOVE PV-DISPLAY-TRIP-ID                              28180000
281900                             TO DP013-MESSAGE-TEXT(2)             28190000
282000             MOVE SQLCA      TO DP013-SQLCA                       28200000
282100             MOVE 'TTRIPST'  TO DP013-DB2-TABLE-NAME(1)           28210000
282200             PERFORM 9999-WRITE-CICS-LOG-MSG                      28220000
282300     END-EVALUATE.                                                28230000
282400*                                                                 28240000
282500                                                                  28250000
282600 4100-VALIDATE-DOOR-ID.                                           28260000
282700                                                                  28270000
282800     MOVE  '4100'  TO  PT-CURR-PARA.                              28280000
282900     IF  PS-BLD-INTERNAL-TABLE-YES                                28290000
283000         PERFORM 1600-INTERNAL-TABLE                              28300000
283100     else                                                         28310000
283200         MOVE 1            TO PT-CURR-ENTRIES                     28320000
283300         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     28330000
283400         perform 1610-BUILD-MESSAGE-DISPLAY                       28340000
283500     END-IF.                                                      28350000
283600                                                                  28360000
283700     MOVE SU051-DOOR-NUMBER        TO DK-DOOR-ID                  28370000
283800     MOVE SU051-DC-NUMBER          TO DK-OPER-UNT-ID              28380000
283900                                                                  28390000
284000     EXEC SQL                                                     28400000
284100         SELECT DIVERT_LOC_ID                                     28410000
284200         INTO :CNDCDR-DIVERT-LOC-ID                               28420000
284300         FROM TCNDCDR                                             28430000
284400         WHERE  OPER_UNT_ID    = :DK-OPER-UNT-ID                  28440000
284500           AND  DOOR_ID        = :DK-DOOR-ID                      28450000
284600           AND  DOOR_TYP_CDE   = 'RC'                             28460000
284700          WITH UR                                                 28470000
284800     END-EXEC.                                                    28480000
284900                                                                  28490000
285000     EVALUATE TRUE                                                28500000
285100         WHEN SQLCODE = ZERO                                      28510000
285200             SET PS-INPUT-DATA-ERROR-NO TO TRUE                   28520000
285300         WHEN SQLCODE = +100                                      28530000
285400             MOVE 'DOOR ERR ' TO PV-ERROR-MESSAGE                 28540000
285500             SET PS-INPUT-DATA-ERROR-YES TO TRUE                  28550000
285600         WHEN SQLWARN0 NOT = SPACES                               28560000
285700         WHEN SQLCODE NOT EQUAL ZERO                              28570000
285800             perform 1620-WRITE-SUWS051-TO-CSSL                   28580000
285900                                                                  28590000
286000             MOVE '4100-VALIDATE-DOOR-ID'                         28600000
286100                             TO DP013-PARAGRAPH                   28610000
286200             MOVE 'VALIDATE DOOR ID'                              28620000
286300                             TO DP013-MESSAGE-TEXT(1)             28630000
286400             MOVE PV-DISPLAY-TRIP-ID                              28640000
286500                             TO DP013-MESSAGE-TEXT(2)             28650000
286600             MOVE SQLCA      TO DP013-SQLCA                       28660000
286700             MOVE 'TCNDCDR'  TO DP013-DB2-TABLE-NAME(1)           28670000
286800             PERFORM 9999-WRITE-CICS-LOG-MSG                      28680000
286900     END-EVALUATE.                                                28690000
287000                                                                  28700000
287100 4200-VALIDATE-USER-ID.                                           28710000
287200                                                                  28720000
287300     MOVE  '4200'  TO  PT-CURR-PARA.                              28730000
287400     IF  PS-BLD-INTERNAL-TABLE-YES                                28740000
287500         PERFORM 1600-INTERNAL-TABLE                              28750000
287600     else                                                         28760000
287700         MOVE 1            TO PT-CURR-ENTRIES                     28770000
287800         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     28780000
287900         perform 1610-BUILD-MESSAGE-DISPLAY                       28790000
288000     END-IF.                                                      28800000
288100                                                                  28810000
288200     IF PS-DUAL-FEED-OFF                                          28820000
288300        MOVE SU051-USER-ID             TO DK-USER-ID              28830000
288400     ELSE                                                         28840000
288500        MOVE SU092-USER-ID             TO DK-USER-ID              28850000
288600     END-IF.                                                      28860000
288700     EXEC SQL                                                     28870000
288800         SELECT USR_LAST_NM                                       28880000
288900         INTO :XLT00024-USR-LAST-NM                               28890000
289000         FROM XLT_USR                                             28900000
289100         WHERE  USR_ID         = :DK-USER-ID                      28910000
289200          with ur                                                 28920000
289300     END-EXEC.                                                    28930000
289400                                                                  28940000
289500     EVALUATE TRUE                                                28950000
289600         WHEN SQLCODE = ZERO                                      28960000
289700             SET PS-INPUT-DATA-ERROR-NO TO TRUE                   28970000
289800         WHEN SQLCODE = +100                                      28980000
289900             MOVE 'BAD USRID' TO PV-ERROR-MESSAGE                 28990000
290000             SET PS-INPUT-DATA-ERROR-YES TO TRUE                  29000000
290100         WHEN SQLWARN0 NOT = SPACES                               29010000
290200         WHEN SQLCODE NOT EQUAL ZERO                              29020000
290300             perform 1620-WRITE-SUWS051-TO-CSSL                   29030000
290400                                                                  29040000
290500             MOVE '4200-VALIDATE-USER-ID'                         29050000
290600                             TO DP013-PARAGRAPH                   29060000
290700             MOVE 'VALIDATE USER ID '                             29070000
290800                             TO DP013-MESSAGE-TEXT(1)             29080000
290900             MOVE PV-DISPLAY-TRIP-ID                              29090000
291000                             TO DP013-MESSAGE-TEXT(2)             29100000
291100             MOVE SQLCA      TO DP013-SQLCA                       29110000
291200             MOVE 'XLT_USR'  TO DP013-DB2-TABLE-NAME(1)           29120000
291300             PERFORM 9999-WRITE-CICS-LOG-MSG                      29130000
291400     END-EVALUATE.                                                29140000
291500                                                                  29150000
291600 4300-SELECT-DC-LOC.                                              29160000
291700                                                                  29170000
291800     MOVE  '4300'  TO  PT-CURR-PARA.                              29180000
291900     IF  PS-BLD-INTERNAL-TABLE-YES                                29190000
292000         PERFORM 1600-INTERNAL-TABLE                              29200000
292100     else                                                         29210000
292200         MOVE 1            TO PT-CURR-ENTRIES                     29220000
292300         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     29230000
292400         perform 1610-BUILD-MESSAGE-DISPLAY                       29240000
292500     END-IF.                                                      29250000
292600                                                                  29260000
292700     MOVE  SU051-DC-NUMBER TO XLT00010-LOC-NBR                    29270000
292800                                                                  29280000
292900     EXEC SQL                                                     29290000
293000          SELECT  LOC_5_ABBR_NM                                   29300000
293100          INTO    :XLT00010-LOC-5-ABBR-NM                         29310000
293200          FROM   XLT_LOC                                          29320000
293300          WHERE  LOC_NBR   = :XLT00010-LOC-NBR                    29330000
293400           with ur                                                29340000
293500     END-EXEC.                                                    29350000
293600                                                                  29360000
293700     EVALUATE TRUE                                                29370000
293800         WHEN SQLCODE = ZERO                                      29380000
293900             MOVE XLT00010-LOC-5-ABBR-NM TO PV-DC-5-CHAR-ABBR     29390000
294000         WHEN SQLWARN0 NOT = SPACES                               29400000
294100         WHEN SQLCODE NOT EQUAL ZERO                              29410000
294200             perform 1620-WRITE-SUWS051-TO-CSSL                   29420000
294300                                                                  29430000
294400             MOVE '4300-SELECT-DC-LOC'                            29440000
294500                             TO DP013-PARAGRAPH                   29450000
294600             MOVE 'VALIDATE LOC  ID '                             29460000
294700                             TO DP013-MESSAGE-TEXT(1)             29470000
294800             MOVE PV-DISPLAY-TRIP-ID                              29480000
294900                             TO DP013-MESSAGE-TEXT(2)             29490000
295000             MOVE SQLCA      TO DP013-SQLCA                       29500000
295100             MOVE 'XLT_LOC'  TO DP013-DB2-TABLE-NAME(1)           29510000
295200             PERFORM 9999-WRITE-CICS-LOG-MSG                      29520000
295300     END-EVALUATE.                                                29530000
295400*                                                                 29540000
295500 4400-CHECK-DC-LABOR.                                             29550000
295600                                                                  29560000
295700     MOVE  '4400'  TO  PT-CURR-PARA.                              29570000
295800     IF  PS-BLD-INTERNAL-TABLE-YES                                29580000
295900         PERFORM 1600-INTERNAL-TABLE                              29590000
296000     else                                                         29600000
296100         MOVE 1            TO PT-CURR-ENTRIES                     29610000
296200         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     29620000
296300         perform 1610-BUILD-MESSAGE-DISPLAY                       29630000
296400     END-IF.                                                      29640000
296500                                                                  29650000
296600     MOVE SU051-DC-NUMBER    TO  KRPRPM-LOC-ID.                   29660000
296700                                                                  29670000
296800     EXEC SQL                                                     29680000
296900          SELECT  FUNC_TXT                                        29690000
297000            INTO :KRPRPM-FUNC-TXT                                 29700000
297100            FROM  TKRPRPM                                         29710000
297200           WHERE  LOC_ID            = :KRPRPM-LOC-ID              29720000
297300             AND  INTFC_SYS_CDE     = 'DLX'                       29730000
297400             AND  SYS_PRC_FUNC_CDE  = 'DLLBIN'                    29740000
297500            with ur                                               29750000
297600     END-EXEC.                                                    29760000
297700                                                                  29770000
297800     EVALUATE TRUE                                                29780000
297900                                                                  29790000
298000         WHEN SQLCODE = +0                                        29800000
298100              IF  KRPRPM-FUNC-TXT  = 'Y'                          29810000
298200                  SET  PS-DC-INTERFC-LABOR-YES TO  TRUE           29820000
298300              ELSE                                                29830000
298400                  SET  PS-DC-INTERFC-LABOR-NO  TO  TRUE           29840000
298500              END-IF                                              29850000
298600         WHEN SQLWARN0 NOT = SPACES                               29860000
298700         WHEN SQLCODE NOT EQUAL ZERO                              29870000
298800             perform 1620-WRITE-SUWS051-TO-CSSL                   29880000
298900                                                                  29890000
299000             SET PS-DB2-ERROR-YES TO TRUE                         29900000
299100             MOVE '4400-CHECK-DC-LABOR  '                         29910000
299200                             TO DP013-PARAGRAPH                   29920000
299300             MOVE 'CHECK DC FOR LABOR'                            29930000
299400                             TO DP013-MESSAGE-TEXT(1)             29940000
299500             MOVE PV-DISPLAY-TRIP-ID                              29950000
299600                             TO DP013-MESSAGE-TEXT(2)             29960000
299700             MOVE SQLCA      TO DP013-SQLCA                       29970000
299800             MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(1)           29980000
299900             PERFORM 9999-WRITE-CICS-LOG-MSG                      29990000
300000     END-EVALUATE.                                                30000000
300100                                                                  30010000
300200                                                                  30020000
300300*---------------------------------------------------------------* 30030000
300400* check parm table (TKRPRPM) to check for capturint the label   * 30040000
300500* stream going to PNA into WFT_DAT_CNTL table                   * 30050000
300600* This parm is set up as text.                                  * 30060000
300700*  y/n space 3 digit pna station                                * 30070000
300800* EX:  Y 001  -  this will capture the label stream for PNA     * 30080000
300900*                station 1 at the given DC                      * 30090000
301000*  2015-05-29 - DMH                                             * 30100000
301100*---------------------------------------------------------------* 30110000
301200 4403-CHECK-FOR-CAPTURE.                                          30120000
301300                                                                  30130000
301400     MOVE SU051-DC-NUMBER    TO  KRPRPM-LOC-ID.                   30140000
301500     EXEC SQL                                                     30150000
301600          SELECT  FUNC_TXT                                        30160000
301700            INTO :PV-TKRPRPM-CAPTURE                              30170000
301800            FROM  TKRPRPM                                         30180000
301900           WHERE  LOC_ID            = :KRPRPM-LOC-ID              30190000
302000             AND  INTFC_SYS_CDE     = 'KHL'                       30200000
302100             AND  SYS_PRC_FUNC_CDE  = 'PACAPT'                    30210000
302200            WITH UR                                               30220000
302300     END-EXEC.                                                    30230000
302400                                                                  30240000
302500     EVALUATE TRUE                                                30250000
302600                                                                  30260000
302700         WHEN SQLCODE = +0                                        30270000
302800             IF  PV-TKRPRPM-CAPT-Y-N     = 'Y'    and             30280000
302900                 PV-TKRPRPM-CAPT-STA     = SU051-ACCM-LINE-NMBR   30290000
303000                  SET  PS-CAPTURE-DATA      TO  TRUE              30300000
303100             ELSE                                                 30310000
303200                  SET  PS-CAPTURE-DATA-NO   TO  TRUE              30320000
303300             END-IF                                               30330000
303400         WHEN SQLCODE = +100                                      30340000
303500             SET  PS-CAPTURE-DATA-NO   TO  TRUE                   30350000
303600         WHEN SQLWARN0 NOT = SPACES                               30360000
303700         WHEN SQLCODE NOT EQUAL ZERO                              30370000
303800             perform 1620-WRITE-SUWS051-TO-CSSL                   30380000
303900                                                                  30390000
304000             SET PS-CAPTURE-DATA-NO TO TRUE                       30400000
304100             MOVE '4403-CHECK-FOR-CAPTURE'                        30410000
304200                             TO DP013-PARAGRAPH                   30420000
304300             MOVE 'CHECK DC CAPTURING LABEL STREAM'               30430000
304400                             TO DP013-MESSAGE-TEXT(1)             30440000
304500             MOVE PV-DISPLAY-TRIP-ID                              30450000
304600                             TO DP013-MESSAGE-TEXT(2)             30460000
304700             MOVE SQLCA      TO DP013-SQLCA                       30470000
304800             MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(1)           30480000
304900             PERFORM 9999-WRITE-CICS-LOG-MSG                      30490000
305000     END-EVALUATE.                                                30500000
305100                                                                  30510000
305200                                                                  30520000
305300 4405-CHECK-FOR-LOGGING.                                          30530000
305400                                                                  30540000
305500     MOVE SU051-DC-NUMBER    TO  KRPRPM-LOC-ID.                   30550000
305600                                                                  30560000
305700     EXEC SQL                                                     30570000
305800          SELECT  FUNC_TXT                                        30580000
305900            INTO :KRPRPM-FUNC-TXT                                 30590000
306000            FROM  TKRPRPM                                         30600000
306100           WHERE  LOC_ID            = :KRPRPM-LOC-ID              30610000
306200             AND  INTFC_SYS_CDE     = 'ACM'                       30620000
306300             AND  SYS_PRC_FUNC_CDE  = 'PACRT1'                    30630000
306400            with ur                                               30640000
306500     END-EXEC.                                                    30650000
306600                                                                  30660000
306700     EVALUATE TRUE                                                30670000
306800                                                                  30680000
306900         WHEN SQLCODE = +0                                        30690000
307000             MOVE KRPRPM-FUNC-TXT TO  PV-TKRPRPM-TEXT             30700000
307100             IF  PV-TKRPRPM-TEXT-Y-N  = 'Y'    and                30710000
307200                 PV-TKRPRPM-TEXT-ALL  = 'ALL'                     30720000
307300                  SET  PS-CSSL-LOGGING-YES  TO  TRUE              30730000
307400             ELSE                                                 30740000
307500             IF  PV-TKRPRPM-TEXT-Y-N     = 'Y'    and             30750000
307600                 PV-TKRPRPM-TEXT-PNA-STA = SU051-ACCM-LINE-NMBR   30760000
307700                  SET  PS-CSSL-LOGGING-YES  TO  TRUE              30770000
307800              ELSE                                                30780000
307900                  SET  PS-CSSL-LOGGING-NO   TO  TRUE              30790000
308000              END-IF                                              30800000
308100              END-IF                                              30810000
308200         WHEN SQLWARN0 NOT = SPACES                               30820000
308300         WHEN SQLCODE NOT EQUAL ZERO                              30830000
308400             perform 1620-WRITE-SUWS051-TO-CSSL                   30840000
308500                                                                  30850000
308600             SET PS-CSSL-LOGGING-NO TO TRUE                       30860000
308700             MOVE '4405-CHECK-FOR-LOGGING'                        30870000
308800                             TO DP013-PARAGRAPH                   30880000
308900             MOVE 'CHECK DC FOR LOGGING'                          30890000
309000                             TO DP013-MESSAGE-TEXT(1)             30900000
309100             MOVE PV-DISPLAY-TRIP-ID                              30910000
309200                             TO DP013-MESSAGE-TEXT(2)             30920000
309300             MOVE SQLCA      TO DP013-SQLCA                       30930000
309400             MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(1)           30940000
309500             PERFORM 9999-WRITE-CICS-LOG-MSG                      30950000
309600     END-EVALUATE.                                                30960000
309700                                                                  30970000
309800*---------------------------------------------------------------* 30980000
309900* check parm table (TKRPRPM) to check for logging to CSSL       * 30990000
310000* IF PROGRAM IS TAKING TOO LONG TO RESPOND.  THE VALUE WILL     * 31000000
310100* BE seconds AND WILL BE USED TO DETERMINE IF WE SHOULD WRITE   * 31010000
310200* pt-pARA-tRACKING TABLE TO CSSL                                * 31020000
310300* check parm table (TKRPRPM) to check if will be building the   * 31030000
310400* internal table during processing.  this will be used when     * 31040000
310500* dc's report long resonse times                                * 31050000
310600*  2014-12-22 - DMH - Added "WITH UR" to SQL                    * 31060000
310700*---------------------------------------------------------------* 31070000
310800 4407-CHECK-PARA-TRACK-sec.                                       31080000
310900                                                                  31090000
311000     MOVE SU051-DC-NUMBER        TO KRPRPM-LOC-ID                 31100000
311100                                                                  31110000
311200     EXEC SQL                                                     31120000
311300          SELECT  FUNC_QTY                                        31130000
311400               ,  FUNC_txt                                        31140000
311500            INTO :PV-PARM-seconds                                 31150000
311600               ,  :PS-BLD-INTERNAL-TABLE-SW                       31160000
311700            FROM  TKRPRPM                                         31170000
311800           WHERE  SYS_PRC_FUNC_CDE  = 'PATIM1'                    31180000
311900             AND  INTFC_SYS_CDE     = 'ACM'                       31190000
312000             AND  LOC_ID            = :KRPRPM-LOC-ID              31200000
312100             AND  fUNC_BEG_TMST    <=  current timestamp          31210000
312200             AND  fUNC_END_TMST    >=  current timestamp          31220000
312300            WITH UR                                               31230000
312400     END-EXEC.                                                    31240000
312500                                                                  31250000
312600     EVALUATE TRUE                                                31260000
312700         WHEN SQLCODE = ZERO                                      31270000
312800              CONTINUE                                            31280000
312900         WHEN SQLCODE = +100                                      31290000
313000              MOVE 999999999  TO  PV-PARM-seconds                 31300000
313100         WHEN SQLWARN0 NOT = SPACES                               31310000
313200         WHEN SQLCODE < ZERO                                      31320000
313300         WHEN SQLCODE > ZERO                                      31330000
313400              perform 1620-WRITE-SUWS051-TO-CSSL                  31340000
313500                                                                  31350000
313600              INITIALIZE PV-CICS-MSG-AREA                         31360000
313700                                                                  31370000
313800              MOVE SQLCODE              TO PV-DISP-SQLCODE        31380000
313900              MOVE SU051-DC-NUMBER      TO PV-DISP-DC             31390000
314000              MOVE SU051-TRIP-ID        TO PV-DISP-TRIP           31400000
314100              MOVE SU051-ACCM-LINE-NMBR TO PV-DISP-PNA-STA        31410000
314200                                                                  31420000
314300              STRING  'SUKCS781 4407'                             31430016
314400                      ' TASK:'   pv-task-x                        31440000
314500                      ' DC:'     PV-DISP-DC                       31450000
314600                      ' B1:'     SU051-BAR-CODE-1                 31460000
314700                      ' B2:'     SU051-BAR-CODE-2                 31470000
314800                      ' B3:'     SU051-BAR-CODE-3                 31480000
314900                                 DELIMITED BY SIZE                31490000
315000                            INTO PV-CICS-MSG-AREA                 31500000
315100                                                                  31510000
315200              PERFORM 9990-WRITE-CICS                             31520000
315300                                                                  31530000
315400              INITIALIZE PV-CICS-MSG-AREA                         31540000
315500              STRING  'SUKCS781 4407'                             31550016
315600                      ' TASK:'   pv-task-x                        31560000
315700                      ' TRIP:'   PV-DISP-TRIP                     31570000
315800                      ' DR:'     SU051-DOOR-NUMBER                31580000
315900                      ' USR:'    SU051-USER-ID                    31590000
316000                      ' STA:'    PV-DISP-PNA-STA                  31600000
316100                      ' SQL:'    PV-DISP-SQLCODE                  31610000
316200                      ' TKRPRPM-PATIM1'                           31620000
316300                                 DELIMITED BY SIZE                31630000
316400                            INTO PV-CICS-MSG-AREA                 31640000
316500                                                                  31650000
316600              PERFORM 9990-WRITE-CICS                             31660000
316700                                                                  31670000
316800     END-EVALUATE.                                                31680000
316900                                                                  31690000
317000     IF  PS-CSSL-LOGGING-YES                                      31700000
317100         INITIALIZE PV-CICS-MSG-AREA                              31710000
317200         MOVE PV-PARM-SECONDS  TO  PV-DISP-PARM-SECONDS           31720000
317300         STRING ' SUKCS781 4407'                                  31730016
317400                ' TASK:'            pv-task-x                     31740000
317500                ' PV-PARM-SECONDS:' PV-DISP-PARM-SECONDS          31750000
317600                ' PS-BLD-INTERNAL-TABLE-SW:'                      31760000
317700                                    PS-BLD-INTERNAL-TABLE-SW      31770000
317800                                           DELIMITED BY SIZE      31780000
317900                                      INTO PV-CICS-MSG-AREA       31790000
318000         PERFORM 9990-WRITE-CICS                                  31800000
318100     END-IF.                                                      31810000
318200                                                                  31820000
318300                                                                  31830000
318400******************************************************************31840000
318500 4410-CHECK-P2L-FRCD-DIVERT.                                      31850000
318600                                                                  31860000
318700     MOVE  '4410'  TO  PT-CURR-PARA.                              31870000
318800     IF  PS-BLD-INTERNAL-TABLE-YES                                31880000
318900         PERFORM 1600-INTERNAL-TABLE                              31890000
319000     else                                                         31900000
319100         MOVE 1            TO PT-CURR-ENTRIES                     31910000
319200         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     31920000
319300         perform 1610-BUILD-MESSAGE-DISPLAY                       31930000
319400     END-IF.                                                      31940000
319500                                                                  31950000
319600     MOVE SU051-DC-NUMBER    TO  KRPRPM-LOC-ID.                   31960000
319700                                                                  31970000
319800     EXEC SQL                                                     31980000
319900          SELECT  SYS_PRC_FUNC_CDE                                31990000
320000            INTO :KRPRPM-SYS-PRC-FUNC-CDE                         32000000
320100            FROM  TKRPRPM                                         32010000
320200           WHERE  LOC_ID            = :KRPRPM-LOC-ID              32020000
320300             AND  INTFC_SYS_CDE     = 'ACM'                       32030000
320400             AND  SYS_PRC_FUNC_CDE  = 'PAPTLD'                    32040000
320500             AND  FUNC_TXT          = 'Y'                         32050000
320600            with ur                                               32060000
320700     END-EXEC.                                                    32070000
320800                                                                  32080000
320900     EVALUATE TRUE                                                32090000
321000       WHEN SQLCODE = +0                                          32100000
321100           SET  PS-P2L-FRCD-DVRT-DC-YES  TO TRUE                  32110000
321200       WHEN SQLCODE = +100                                        32120000
321300           SET  PS-P2L-FRCD-DVRT-DC-NO   TO TRUE                  32130000
321400       WHEN SQLWARN0 NOT = SPACES                                 32140000
321500       WHEN SQLCODE NOT EQUAL ZERO                                32150000
321600           perform 1620-WRITE-SUWS051-TO-CSSL                     32160000
321700                                                                  32170000
321800           SET PS-CSSL-LOGGING-NO TO TRUE                         32180000
321900           MOVE '4410-CHECK-P2L-FRCD-DIVERT'                      32190000
322000                           TO DP013-PARAGRAPH                     32200000
322100           MOVE 'CHECK DC P2 DIVERT '                             32210000
322200                           TO DP013-MESSAGE-TEXT(1)               32220000
322300           MOVE PV-DISPLAY-TRIP-ID                                32230000
322400                           TO DP013-MESSAGE-TEXT(2)               32240000
322500           MOVE SQLCA      TO DP013-SQLCA                         32250000
322600           MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(1)             32260000
322700           PERFORM 9999-WRITE-CICS-LOG-MSG                        32270000
322800     END-EVALUATE.                                                32280000
322900                                                                  32290000
323000******************************************************************32300000
323100*4415-CHECK-DC-FLOWBACK.                                          32310000
323200*    IF PS-CSSL-LOGGING-YES                                       32320000
323300*      STRING ' SUKCS781 DC FLOWBACK CHECK'                       32330016
323400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32340000
323500*      PERFORM 9990-WRITE-CICS                                    32350000
323600*    END-IF                                                       32360000
323700*    MOVE SU051-DC-NUMBER    TO  KRPRPM-LOC-ID.                   32370000
323800*                                                                 32380000
323900*    EXEC SQL                                                     32390000
324000*         SELECT LOC_ID                                           32400000
324100*         INTO :KRPRPM-LOC-ID                                     32410000
324200*         FROM TKRPRPM                                            32420000
324300*         WHERE LOC_ID            = :KRPRPM-LOC-ID                32430000
324400*           AND INTFC_SYS_CDE     = 'KHL'                         32440000
324500*           AND SYS_PRC_FUNC_CDE  = 'FLWBCK'                      32450000
324600*           AND FUNC_PRC_STAT_CDE = 'AC'                          32460000
324700*           AND (CURRENT DATE                                     32470000
324800*       BETWEEN DATE(FUNC_BEG_TMST) AND                           32480000
324900*               DATE(FUNC_END_TMST) )                             32490000
325000*    END-EXEC.                                                    32500000
325100*                                                                 32510000
325200*    EVALUATE TRUE                                                32520000
325300*      WHEN SQLCODE = +0                                          32530000
325400*          SET  PS-DC-FLOWBACK-YES  TO TRUE                       32540000
325500*      WHEN SQLCODE = +100                                        32550000
325600*          SET  PS-DC-FLOWBACK-NO   TO TRUE                       32560000
325700*      WHEN SQLWARN0 NOT = SPACES                                 32570000
325800*      WHEN SQLCODE NOT EQUAL ZERO                                32580000
325900*          SET PS-CSSL-LOGGING-NO TO TRUE                         32590000
326000*          MOVE '4415-CHECK-DC-FLOWBACK  '                        32600000
326100*                          TO DP013-PARAGRAPH                     32610000
326200*          MOVE 'CHECK DC FLOWBACK  '                             32620000
326300*                          TO DP013-MESSAGE-TEXT(1)               32630000
326400*          MOVE PV-DISPLAY-TRIP-ID                                32640000
326500*                          TO DP013-MESSAGE-TEXT(2)               32650000
326600*          MOVE SQLCA      TO DP013-SQLCA                         32660000
326700*          MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(1)             32670000
326800*          PERFORM 9999-WRITE-CICS-LOG-MSG                        32680000
326900*    END-EVALUATE.                                                32690000
327000*                                                                 32700000
327100******************************************************************32710000
327200 4420-SELECT-SOCKET-TIMEOUT.                                      32720000
327300                                                                  32730000
327400     MOVE  '4420'  TO  PT-CURR-PARA.                              32740000
327500     IF  PS-BLD-INTERNAL-TABLE-YES                                32750000
327600         PERFORM 1600-INTERNAL-TABLE                              32760000
327700     else                                                         32770000
327800         MOVE 1            TO PT-CURR-ENTRIES                     32780000
327900         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     32790000
328000         perform 1610-BUILD-MESSAGE-DISPLAY                       32800000
328100     END-IF.                                                      32810000
328200                                                                  32820000
328300     EXEC SQL                                                     32830000
328400          SELECT  FUNC_QTY                                        32840000
328500            INTO :KRPRPM-FUNC-QTY                                 32850000
328600            FROM  TKRPRPM                                         32860000
328700           WHERE  LOC_ID            = 090                         32870000
328800             AND  SYS_PRC_FUNC_CDE  = 'SCKTM5'                    32880000
328900             AND  FUNC_PRC_STAT_CDE = 'AC'                        32890000
329000             AND  INTFC_SYS_CDE     = 'KHL'                       32900000
329100            with ur                                               32910000
329200     END-EXEC.                                                    32920000
329300                                                                  32930000
329400     EVALUATE TRUE                                                32940000
329500                                                                  32950000
329600         WHEN SQLCODE = +0                                        32960000
329700              MOVE KRPRPM-FUNC-QTY  TO  SELECT-SECS               32970000
329800                                                                  32980000
329900         WHEN SQLCODE = +100                                      32990000
330000              CONTINUE                                            33000000
330100       WHEN SQLWARN0 NOT = SPACES                                 33010000
330200       WHEN SQLCODE NOT EQUAL ZERO                                33020000
330300           perform 1620-WRITE-SUWS051-TO-CSSL                     33030000
330400                                                                  33040000
330500           MOVE '4420-SELECT-SOCKET-TIMEOUT'                      33050000
330600                           TO DP013-PARAGRAPH                     33060000
330700           MOVE 'CHECK SOCKET TIMEOUT '                           33070000
330800                           TO DP013-MESSAGE-TEXT(1)               33080000
330900           MOVE PV-DISPLAY-TRIP-ID                                33090000
331000                           TO DP013-MESSAGE-TEXT(2)               33100000
331100           MOVE SQLCA      TO DP013-SQLCA                         33110000
331200           MOVE 'TKRPRPM'  TO DP013-DB2-TABLE-NAME(1)             33120000
331300           PERFORM 9999-WRITE-CICS-LOG-MSG                        33130000
331400     END-EVALUATE.                                                33140000
331500                                                                  33150000
331600                                                                  33160000
331700******************************************************************33170000
331800* THIS PARAGRAPH IS USED IF MULTIPLE BARCODES ARE SCANNED AND    *33180000
331900* NEITHER IS A CHECKED IN SSCC, AND NEITHER IS AN SML            *33190000
332000* THIS IS TO CHECK IF THE BARCODE IS A VALID SSCC                *33200000
332100* DMH - 9/21/11 ADDED                                            *33210000
332200******************************************************************33220000
332300 4430-CHECK-VNDR-SSCC.                                            33230000
332400                                                                  33240000
332500     MOVE  '4430'  TO  PT-CURR-PARA.                              33250000
332600     IF  PS-BLD-INTERNAL-TABLE-YES                                33260000
332700         PERFORM 1600-INTERNAL-TABLE                              33270000
332800     else                                                         33280000
332900         MOVE 1            TO PT-CURR-ENTRIES                     33290000
333000         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     33300000
333100         perform 1610-BUILD-MESSAGE-DISPLAY                       33310000
333200     END-IF.                                                      33320000
333300                                                                  33330000
333400     EXEC SQL                                                     33340000
333500        SELECT  SHIPT_UNT_ID                                      33350000
333600          INTO :PV-VENDOR-SSCC                                    33360000
333700          FROM  TSHPUNT                                           33370000
333800         WHERE  SHIPT_UNT_ID   = :PV-SSCC-UNCHKIN                 33380000
333900     END-EXEC.                                                    33390000
334000                                                                  33400000
334100     EVALUATE TRUE                                                33410000
334200         WHEN SQLCODE = ZERO                                      33420000
334300              SET PS-VENDOR-SSCC-YES  TO TRUE                     33430000
334400         WHEN SQLCODE = +100                                      33440000
334500              SET PS-VENDOR-SSCC-NO   TO TRUE                     33450000
334600         WHEN SQLWARN0 NOT = SPACES                               33460000
334700         WHEN SQLCODE NOT EQUAL ZERO                              33470000
334800             perform 1620-WRITE-SUWS051-TO-CSSL                   33480000
334900                                                                  33490000
335000             mOVE '4430-CHECK-VNDR-SSCC'                          33500000
335100                             TO DP013-PARAGRAPH                   33510000
335200             MOVE 'CHECK WHEN MULTIPLE SSCC'                      33520000
335300                             TO DP013-MESSAGE-TEXT(1)             33530000
335400             MOVE  PV-SSCC-UNCHKIN  TO  PV-DISP-SSCC              33540000
335500             MOVE PV-DISP-SSCC                                    33550000
335600                             TO DP013-MESSAGE-TEXT(2)             33560000
335700             STRING ' SUKCS781:'                                  33570016
335800                  ' DC='                                          33580000
335900                  SU051-DC-NUMBER                                 33590000
336000                  ' DOOR ='                                       33600000
336100                  su108-DOOR-ID                                   33610006
336200                  ' USER= '                                       33620000
336300                  SU051-USER-ID                                   33630000
336400                 DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT(3)     33640000
336500             MOVE 'TSHPUNT'            TO DP013-DB2-TABLE-NAME(1) 33650000
336600             PERFORM 9999-WRITE-CICS-LOG-MSG                      33660000
336700     END-EVALUATE.                                                33670000
336800                                                                  33680000
336900                                                                  33690000
337000 4500-PROCESS-LABOR.                                              33700000
337100                                                                  33710000
337200     MOVE  '4500'  TO  PT-CURR-PARA.                              33720000
337300     IF  PS-BLD-INTERNAL-TABLE-YES                                33730000
337400         PERFORM 1600-INTERNAL-TABLE                              33740000
337500     else                                                         33750000
337600         MOVE 1            TO PT-CURR-ENTRIES                     33760000
337700         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     33770000
337800         perform 1610-BUILD-MESSAGE-DISPLAY                       33780000
337900     END-IF.                                                      33790000
338000                                                                  33800000
338100     PERFORM 4550-SELECT-INBD-TRIP-DOOR.                          33810000
338200     PERFORM 4600-DL-WORK.                                        33820000
338300                                                                  33830000
338400 4550-SELECT-INBD-TRIP-DOOR.                                      33840000
338500                                                                  33850000
338600     MOVE  '4550'  TO  PT-CURR-PARA.                              33860000
338700     IF  PS-BLD-INTERNAL-TABLE-YES                                33870000
338800         PERFORM 1600-INTERNAL-TABLE                              33880000
338900     else                                                         33890000
339000         MOVE 1            TO PT-CURR-ENTRIES                     33900000
339100         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     33910000
339200         perform 1610-BUILD-MESSAGE-DISPLAY                       33920000
339300     END-IF.                                                      33930000
339400                                                                  33940000
339500     IF PS-DUAL-FEED-OFF                                          33950000
339600        MOVE SU051-TRIP-ID           TO su108-TRIP-ID             33960006
339700     ELSE                                                         33970000
339800        MOVE SU092-TRIP-ID           TO su108-TRIP-ID             33980006
339900     END-IF.                                                      33990000
340000                                                                  34000000
340100     EXEC SQL                                                     34010000
340200         SELECT                                                   34020000
340300             DOOR1.DOOR_ID                                        34030000
340400         INTO                                                     34040000
340500             :SUT00040-DOOR-ID                                    34050000
340600         FROM                                                     34060000
340700             SUT_INBD_TRIP_DOOR DOOR1                             34070000
340800         WHERE DOOR1.TRIP_ID          = :su108-TRIP-ID            34080006
340900             AND                                                  34090000
341000             DOOR1.CRE_TMST =                                     34100000
341100           (                                                      34110000
341200             SELECT MAX (DOOR2.CRE_TMST)                          34120000
341300             FROM                                                 34130000
341400             SUT_INBD_TRIP_DOOR DOOR2                             34140000
341500             WHERE                                                34150000
341600               DOOR1.TRIP_ID          = DOOR2.TRIP_ID             34160000
341700            )                                                     34170000
341800     END-EXEC.                                                    34180000
341900                                                                  34190000
342000     EVALUATE TRUE                                                34200000
342100         WHEN SQLCODE = ZERO                                      34210000
342200             SET su108-FIRST-TRIP-SCAN-NO                         34220006
342300                                      TO TRUE                     34230000
342400             MOVE SUT00040-DOOR-ID    TO SU108-OLD-DOOR-ID        34240006
342500         WHEN SQLCODE = +100                                      34250000
342600         WHEN SQLCODE = -305                                      34260000
342700             SET SU108-FIRST-TRIP-SCAN-YES                        34270006
342800                                      TO TRUE                     34280000
342900             MOVE SPACES              TO SU108-OLD-DOOR-ID        34290006
343000         WHEN OTHER                                               34300000
343100             perform 1620-WRITE-SUWS051-TO-CSSL                   34310000
343200                                                                  34320000
343300             MOVE SU108-TRIP-ID  TO PV-DISPLAY-TRIP-ID            34330006
343400             MOVE '4550-SELECT-INBD-TRIP-DOOR'                    34340000
343500                             TO DP013-PARAGRAPH                   34350000
343600             MOVE 'SELECT INBD TRIP '                             34360000
343700                             TO DP013-MESSAGE-TEXT(1)             34370000
343800             MOVE PV-DISPLAY-TRIP-ID                              34380000
343900                             TO DP013-MESSAGE-TEXT(2)             34390000
344000             STRING ' SUKCS781 4550'                              34400016
344100                    ' TASK:'         pv-task-x                    34410000
344200                    ' DC:'           SU051-DC-NUMBER              34420000
344300                    ' DOOR:'         SU108-DOOR-ID                34430006
344400                    ' USER:'         SU051-USER-ID                34440000
344500                                     DELIMITED BY SIZE            34450000
344600                                INTO DP013-MESSAGE-TEXT(3)        34460000
344700             MOVE 'SUT_INBD_TRIP_DOOR'  TO DP013-DB2-TABLE-NAME(1)34470000
344800             PERFORM 9999-WRITE-CICS-LOG-MSG                      34480000
344900     END-EVALUATE.                                                34490000
345000/                                                                 34500000
345100 4600-DL-WORK.                                                    34510000
345200                                                                  34520000
345300     MOVE  '4600'  TO  PT-CURR-PARA.                              34530000
345400     IF  PS-BLD-INTERNAL-TABLE-YES                                34540000
345500         PERFORM 1600-INTERNAL-TABLE                              34550000
345600     else                                                         34560000
345700         MOVE 1            TO PT-CURR-ENTRIES                     34570000
345800         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     34580000
345900         perform 1610-BUILD-MESSAGE-DISPLAY                       34590000
346000     END-IF.                                                      34600000
346100                                                                  34610000
346200     IF SU108-FIRST-TRIP-SCAN-NO                                  34620006
346300         PERFORM 4650-OLD-TRIP-DOOR                               34630000
346400     ELSE                                                         34640000
346500         PERFORM 4700-NEW-TRIP-DOOR                               34650000
346600     END-IF.                                                      34660000
346700                                                                  34670000
346800/                                                                 34680000
346900 4650-OLD-TRIP-DOOR.                                              34690000
347000                                                                  34700000
347100     MOVE  '4650'  TO  PT-CURR-PARA.                              34710000
347200     IF  PS-BLD-INTERNAL-TABLE-YES                                34720000
347300         PERFORM 1600-INTERNAL-TABLE                              34730000
347400     else                                                         34740000
347500         MOVE 1            TO PT-CURR-ENTRIES                     34750000
347600         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     34760000
347700         perform 1610-BUILD-MESSAGE-DISPLAY                       34770000
347800     END-IF.                                                      34780000
347900                                                                  34790000
348000     IF SU108-OLD-DOOR-ID NOT = SU108-DOOR-ID                     34800006
348100         PERFORM 4750-INSERT-TRIP-DOOR                            34810000
348200     END-IF.                                                      34820000
348300                                                                  34830000
348400                                                                  34840000
348500*                                                                 34850000
348600*** if user id is spaces dont call Labor module                   34860000
348700*** dmh 5/10/12                                                   34870000
348800*                                                                 34880000
348900     IF  PS-DUAL-FEED-OFF  AND                                    34890000
349000         SU051-USER-ID         =  SPACES                          34900000
349100              STRING ' SUKCS781 4650'                             34910016
349200                     ' TASK:'              PV-TASK-X              34920000
349300                     ' - NO USERID -'                             34930000
349400                     ' WILL NOT CALL LABOR MODULE - A'            34940000
349500                                           DELIMITED BY SIZE      34950000
349600                                      INTO PV-CICS-MSG-AREA       34960000
349700              MOVE LENGTH OF PV-CICS-MSG-AREA                     34970000
349800                                        TO PV-COMMAREA-LENGTH     34980000
349900              PERFORM 9990-WRITE-CICS                             34990000
350000              STRING ' SUKCS781 4650'                             35000016
350100                     ' TASK:'              PV-TASK-X              35010000
350200                     '-'                   SU051-DC-NUMBER        35020000
350300                     '-'                   SU051-BAR-CODE-1       35030000
350400                     '-'                   SU051-DOOR-NUMBER      35040000
350500                     '-'                   SU051-TRIP-ID          35050000
350600                     '-'                   SU051-ACCM-LINE-NMBR   35060000
350700                                           DELIMITED BY SIZE      35070000
350800                                      INTO PV-CICS-MSG-AREA       35080000
350900              MOVE LENGTH OF PV-CICS-MSG-AREA                     35090000
351000                                        TO PV-COMMAREA-LENGTH     35100000
351100              PERFORM 9990-WRITE-CICS                             35110000
351200     ELSE                                                         35120000
351300         IF  SU092-USER-ID     =  SPACES                          35130000
351400              MOVE SU092-KEY-DC-LOC      TO  PV-DISP-DC           35140000
351500              MOVE SU092-KEY-ACM-STN-NBR TO  PV-DISP-PNA-STA      35150000
351600              MOVE SU092-TRIP-ID         TO  PV-DISP-TRIP         35160000
351700              STRING ' SUKCS781 4650'                             35170016
351800                     ' TASK:'              PV-TASK-X              35180000
351900                     ' - NO USERID -'                             35190000
352000                     ' WILL NOT CALL LABOR MODULE - B'            35200000
352100                                           DELIMITED BY SIZE      35210000
352200                                      INTO PV-CICS-MSG-AREA       35220000
352300              MOVE LENGTH OF PV-CICS-MSG-AREA                     35230000
352400                                        TO PV-COMMAREA-LENGTH     35240000
352500              PERFORM 9990-WRITE-CICS                             35250000
352600              STRING ' SUKCS781 4650'                             35260016
352700                     ' TASK:'              PV-TASK-X              35270000
352800                     '-'                   PV-DISP-DC             35280000
352900                     '-'                   SU092-KEY-BAR-CODE-1   35290000
353000                     '-'                   SU092-DOOR-ID          35300000
353100                     '-'                   PV-DISP-TRIP           35310000
353200                     '-'                   PV-DISP-PNA-STA        35320000
353300                                           DELIMITED BY SIZE      35330000
353400                                      INTO PV-CICS-MSG-AREA       35340000
353500              MOVE LENGTH OF PV-CICS-MSG-AREA                     35350000
353600                                        TO PV-COMMAREA-LENGTH     35360000
353700              PERFORM 9990-WRITE-CICS                             35370000
353800         ELSE                                                     35380000
353900             PERFORM 4710-LINK-DLKCS410                           35390000
354000         END-IF                                                   35400000
354100     END-IF.                                                      35410000
354200                                                                  35420000
354300 4700-NEW-TRIP-DOOR.                                              35430000
354400                                                                  35440000
354500     MOVE  '4700'  TO  PT-CURR-PARA.                              35450000
354600     IF  PS-BLD-INTERNAL-TABLE-YES                                35460000
354700         PERFORM 1600-INTERNAL-TABLE                              35470000
354800     else                                                         35480000
354900         MOVE 1            TO PT-CURR-ENTRIES                     35490000
355000         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     35500000
355100         perform 1610-BUILD-MESSAGE-DISPLAY                       35510000
355200     END-IF.                                                      35520000
355300                                                                  35530000
355400*                                                                 35540000
355500*** if user id is spaces dont call Labor module                   35550000
355600*** dmh 5/10/12                                                   35560000
355700*                                                                 35570000
355800     IF  PS-DUAL-FEED-OFF  AND                                    35580000
355900         SU051-USER-ID         =  SPACES                          35590000
356000              STRING ' SUKCS781 4700'                             35600016
356100                     ' TASK:'              PV-TASK-X              35610000
356200                     ' - NO USERID -'                             35620000
356300                     ' WILL NOT CALL LABOR MODULE - C'            35630000
356400                                           DELIMITED BY SIZE      35640000
356500                                      INTO PV-CICS-MSG-AREA       35650000
356600              MOVE LENGTH OF PV-CICS-MSG-AREA                     35660000
356700                                        TO PV-COMMAREA-LENGTH     35670000
356800              PERFORM 9990-WRITE-CICS                             35680000
356900              STRING ' SUKCS781 4700'                             35690016
357000                     ' TASK:'              PV-TASK-X              35700000
357100                     '-'                   SU051-DC-NUMBER        35710000
357200                     '-'                   SU051-BAR-CODE-1       35720000
357300                     '-'                   SU051-DOOR-NUMBER      35730000
357400                     '-'                   SU051-TRIP-ID          35740000
357500                     '-'                   SU051-ACCM-LINE-NMBR   35750000
357600                                           DELIMITED BY SIZE      35760000
357700                                      INTO PV-CICS-MSG-AREA       35770000
357800              MOVE LENGTH OF PV-CICS-MSG-AREA                     35780000
357900                                        TO PV-COMMAREA-LENGTH     35790000
358000              PERFORM 9990-WRITE-CICS                             35800000
358100     ELSE                                                         35810000
358200         IF  SU092-USER-ID     =  SPACES                          35820000
358300              MOVE SU092-KEY-DC-LOC      TO  PV-DISP-DC           35830000
358400              MOVE SU092-KEY-ACM-STN-NBR TO  PV-DISP-PNA-STA      35840000
358500              MOVE SU092-TRIP-ID         TO  PV-DISP-TRIP         35850000
358600              STRING ' SUKCS781 4700'                             35860016
358700                     ' TASK:'              PV-TASK-X              35870000
358800                     ' - NO USERID -'                             35880000
358900                     ' WILL NOT CALL LABOR MODULE - D'            35890000
359000                                           DELIMITED BY SIZE      35900000
359100                                      INTO PV-CICS-MSG-AREA       35910000
359200              MOVE LENGTH OF PV-CICS-MSG-AREA                     35920000
359300                                        TO PV-COMMAREA-LENGTH     35930000
359400              PERFORM 9990-WRITE-CICS                             35940000
359500              STRING ' SUKCS781 4600'                             35950016
359600                     ' TASK:'              PV-TASK-X              35960000
359700                     '-'                   PV-DISP-DC             35970000
359800                     '-'                   SU092-KEY-BAR-CODE-1   35980000
359900                     '-'                   SU092-DOOR-ID          35990000
360000                     '-'                   PV-DISP-TRIP           36000000
360100                     '-'                   PV-DISP-PNA-STA        36010000
360200                                           DELIMITED BY SIZE      36020000
360300                                      INTO PV-CICS-MSG-AREA       36030000
360400              MOVE LENGTH OF PV-CICS-MSG-AREA                     36040000
360500                                        TO PV-COMMAREA-LENGTH     36050000
360600              PERFORM 9990-WRITE-CICS                             36060000
360700         ELSE                                                     36070000
360800             PERFORM 4710-LINK-DLKCS410                           36080000
360900                                                                  36090000
361000             IF DL016-SUCCESSFUL                                  36100000
361100                PERFORM 4750-INSERT-TRIP-DOOR                     36110000
361200             END-IF                                               36120000
361300                                                                  36130000
361400*    GET THE NEXT ASSIGNMENT SEQUENCE NUMBER                      36140000
361500             PERFORM 4800-CALL-DLKUP001                           36150000
361600                                                                  36160000
361700*    UPDATE EAI TABLES                                            36170000
361800             PERFORM 4850-CALL-XLKUP033                           36180000
361900                                                                  36190000
362000         END-IF                                                   36200000
362100     END-IF.                                                      36210000
362200                                                                  36220000
362300                                                                  36230000
362400 4710-LINK-DLKCS410.                                              36240000
362500                                                                  36250000
362600     MOVE  '4710'  TO  PT-CURR-PARA.                              36260000
362700     IF  PS-BLD-INTERNAL-TABLE-YES                                36270000
362800         PERFORM 1600-INTERNAL-TABLE                              36280000
362900     else                                                         36290000
363000         MOVE 1            TO PT-CURR-ENTRIES                     36300000
363100         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     36310000
363200         perform 1610-BUILD-MESSAGE-DISPLAY                       36320000
363300     END-IF.                                                      36330000
363400                                                                  36340000
363500     MOVE ' 4710-LINK-DLKCS410  '                                 36350000
363600                                 TO DP013-PARAGRAPH.              36360000
363700                                                                  36370000
363800     INITIALIZE DL016-PGM-COMMAREA                                36380000
363900     SET DL016-ESTABLISH-ASGMT        TO TRUE                     36390000
364000     SET DL016-DO-NOT-COMMIT-UPDATE   TO TRUE                     36400000
364100     MOVE 'SUKCS781'                  TO DL016-CALLING-PGM-NM     36410016
364200     IF PS-DUAL-FEED-OFF                                          36420000
364300        MOVE SU051-USER-ID            TO DL016-SIGN-ON-USR-ID     36430000
364400     ELSE                                                         36440000
364500        MOVE SU092-USER-ID            TO DL016-SIGN-ON-USR-ID     36450000
364600     END-IF.                                                      36460000
364700                                                                  36470000
364800     SET DL011-RECV-WRK-TYP           TO TRUE                     36480000
364900     MOVE DL011-KEY-WK-TYP            TO DL016-ASGMT-NBR-WRK-TYP  36490000
365000                                                                  36500000
365100     MOVE SU051-DOOR-NUMBER          TO DL011-RD-WRK-AREA-DOOR-NBR36510000
365200     MOVE DL011-RECV-DOOR-WRK-AREA    TO DL016-EAI-WK-AREA-DESC   36520000
365300                                                                  36530000
365400     SET DL011-RECV-WRK-TYP           TO TRUE                     36540000
365500     MOVE DL011-KEY-WK-TYP            TO DL016-EAI-WK-TYP-DESC    36550000
365600                                                                  36560000
365700     MOVE SU051-DC-NUMBER             TO DL016-EAI-DC-NBR         36570000
365800     MOVE SU051-USER-ID               TO DL016-EAI-CRE-BY-USR-ID  36580000
365900     SET DL016-EAI-USR-IS-UNKNOWN     TO TRUE                     36590000
366000                                                                  36600000
366100     MOVE LENGTH OF DL016-PGM-COMMAREA                            36610000
366200                                      TO PV-COMMAREA-LENGTH       36620000
366300                                                                  36630000
366400     EXEC CICS LINK                                               36640000
366500         PROGRAM  (DL016-USER-PGM)                                36650000
366600         COMMAREA (DL016-PGM-COMMAREA)                            36660000
366700         LENGTH   (PV-COMMAREA-LENGTH)                            36670000
366800     END-EXEC.                                                    36680000
366900                                                                  36690000
367000     EVALUATE TRUE                                                36700000
367100         WHEN DL016-SUCCESSFUL                                    36710000
367200                                                                  36720000
367300             MOVE DL016-ESO-ASGMT-NBR-TXT                         36730000
367400                                      TO SU054-ASGMT-NBR-TXT      36740000
367500                                         PV-ASGMT-NBR-TXT         36750000
367600             MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR                     36760000
367700                                       TO SU054-ASGMT-NBR-SEQ-NBR 36770000
367800                                          PV-ASGMT-NBR-SEQ-NBR    36780000
367900             MOVE DL016-ESO-ASGMT-START-DTE                       36790000
368000                                       TO SU054-ASGMT-STRT-DTE    36800000
368100                                          PV-ASGMT-STRT-DTE       36810000
368200             IF PS-CSSL-LOGGING-YES                               36820000
368300                STRING ' SUKCS781 4710'                           36830016
368400                       ' TASK:'        pv-task-x                  36840000
368500                       ' ASGMT TXT:'   SU054-ASGMT-NBR-TXT        36850000
368600                       ' ASGMT SEQ:'   PV-DISPL-ASGMT-SEQ-NBR     36860000
368700                       ' ASGMT DTE:'   SU054-ASGMT-STRT-DTE       36870000
368800                                       DELIMITED BY SIZE          36880000
368900                                  INTO PV-CICS-MSG-AREA           36890000
369000                PERFORM 9990-WRITE-CICS                           36900000
369100             END-IF                                               36910000
369200         WHEN OTHER                                               36920000
369300              STRING ' SUKCS781 (OTHER)'                          36930016
369400                     ' TASK:'        pv-task-x                    36940000
369500                     ' 4710-LINK-DLKCS410'                        36950000
369600                     ' MODULE FAIL:' DL016-CALL-MOD-FAIL-Nm       36960000
369700                     ' PARA:'        DL016-CALL-MOD-FAIL-SQL-PARA 36970000
369800                                     DELIMITED BY SIZE            36980000
369900                                INTO PV-CICS-MSG-AREA             36990000
370000              MOVE LENGTH OF PV-CICS-MSG-AREA                     37000000
370100                                        TO PV-COMMAREA-LENGTH     37010000
370200              PERFORM 9990-WRITE-CICS                             37020000
370300              STRING ' SUKCS781 (OTHER)'                          37030016
370400                     ' TASK:'         pv-task-x                   37040000
370500                     ' 4710-LINK-DLKCS410 '                       37050000
370600                     ' MOD FAIL ERR:' DL016-CALL-MOD-FAIL-ERR-Cde 37060000
370700                     ' MOD FAIL SQL:' DL016-CALL-MOD-FAIL-SQL-cde 37070000
370800                                      DELIMITED BY SIZE           37080000
370900                                 INTO PV-CICS-MSG-AREA            37090000
371000              MOVE LENGTH OF PV-CICS-MSG-AREA                     37100000
371100                                        TO PV-COMMAREA-LENGTH     37110000
371200              PERFORM 9990-WRITE-CICS                             37120000
371300              STRING ' SUKCS781 (OTHER)'                          37130016
371400                     ' TASK:'           pv-task-x                 37140000
371500                     ' 4710-LINK-DLKCS410 '                       37150000
371600                     ' MOD RETURN CDE:' DL016-RETURN-CODE         37160000
371700                                        delimited by size         37170000
371800                                   INTO PV-CICS-MSG-AREA          37180000
371900              MOVE LENGTH OF PV-CICS-MSG-AREA                     37190000
372000                                        TO PV-COMMAREA-LENGTH     37200000
372100              PERFORM 9990-WRITE-CICS                             37210000
372200     END-EVALUATE.                                                37220000
372300                                                                  37230000
372400 4750-INSERT-TRIP-DOOR.                                           37240000
372500                                                                  37250000
372600     MOVE  '4750'  TO  PT-CURR-PARA.                              37260000
372700     IF  PS-BLD-INTERNAL-TABLE-YES                                37270000
372800         PERFORM 1600-INTERNAL-TABLE                              37280000
372900     else                                                         37290000
373000         MOVE 1            TO PT-CURR-ENTRIES                     37300000
373100         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     37310000
373200         perform 1610-BUILD-MESSAGE-DISPLAY                       37320000
373300     END-IF.                                                      37330000
373400                                                                  37340000
373500     MOVE SU051-DOOR-NUMBER     TO SU108-DOOR-ID                  37350006
373600                                                                  37360000
373700     EXEC SQL                                                     37370000
373800         INSERT INTO SUT_INBD_TRIP_DOOR                           37380000
373900     (                                                            37390000
374000         TRIP_ID                                                  37400000
374100     ,   CRE_TMST                                                 37410000
374200     ,   DOOR_ID                                                  37420000
374300     ,   CRE_BY_USR_ID                                            37430000
374400     )                                                            37440000
374500     VALUES                                                       37450000
374600     (                                                            37460000
374700         :SU108-TRIP-ID                                           37470006
374800     ,   CURRENT TIMESTAMP                                        37480000
374900     ,   :SU108-DOOR-ID                                           37490006
375000     ,   :SU051-USER-ID                                           37500000
375100     )                                                            37510000
375200     END-EXEC.                                                    37520000
375300                                                                  37530000
375400     EVALUATE TRUE                                                37540000
375500         WHEN SQLCODE = ZERO                                      37550000
375600             CONTINUE                                             37560000
375700         WHEN OTHER                                               37570000
375800             perform 1620-WRITE-SUWS051-TO-CSSL                   37580000
375900                                                                  37590000
376000             MOVE SU108-TRIP-ID  TO PV-DISPLAY-TRIP-ID            37600006
376100             MOVE '4750-INSERT-TRIP-DOOR'                         37610000
376200                             TO DP013-PARAGRAPH                   37620000
376300             MOVE 'INSERT TRIP DOOR '                             37630000
376400                             TO DP013-MESSAGE-TEXT(1)             37640000
376500             MOVE PV-DISPLAY-TRIP-ID                              37650000
376600                             TO DP013-MESSAGE-TEXT(2)             37660000
376700             STRING ' SUKCS781 4750'                              37670016
376800                    ' TASK:'         PV-TASK-X                    37680000
376900                    ' DC:'           SU051-DC-NUMBER              37690000
377000                    ' DOOR:'         SU108-DOOR-ID                37700006
377100                    ' USER:'         SU051-USER-ID                37710000
377200                                     DELIMITED BY SIZE            37720000
377300                                INTO DP013-MESSAGE-TEXT(3)        37730000
377400             MOVE 'SUT_INBD_TRIP_DOOR'  TO DP013-DB2-TABLE-NAME(1)37740000
377500             PERFORM 9999-WRITE-CICS-LOG-MSG                      37750000
377600     END-EVALUATE.                                                37760000
377700/                                                                 37770000
377800 4800-CALL-DLKUP001.                                              37780000
377900                                                                  37790000
378000     MOVE  '4800'  TO  PT-CURR-PARA.                              37800000
378100     IF  PS-BLD-INTERNAL-TABLE-YES                                37810000
378200         PERFORM 1600-INTERNAL-TABLE                              37820000
378300     else                                                         37830000
378400         MOVE 1            TO PT-CURR-ENTRIES                     37840000
378500         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     37850000
378600         perform 1610-BUILD-MESSAGE-DISPLAY                       37860000
378700     END-IF.                                                      37870000
378800                                                                  37880000
378900     INITIALIZE DL001-ASGMT-COMMAREA.                             37890000
379000                                                                  37900000
379100     SET DL001-BY-ASGMT-KEY                                       37910000
379200         DL001-COMMIT-UPDATE                                      37920000
379300         DL001-FIND-NEXT-ASGMT        TO TRUE                     37930000
379400                                                                  37940000
379500     MOVE PV-ASGMT-STRT-DTE           TO DL001-KEY-START-DTE      37950000
379600     MOVE PV-ASGMT-NBR-TXT            TO DL001-KEY-NBR-TXT        37960000
379700     MOVE PV-ASGMT-NBR-SEQ-NBR        TO DL001-KEY-NBR-SEQ-NBR    37970000
379800                                                                  37980000
379900     MOVE 1                          TO DL001-NBR-OF-NBRS-NEED-QTY37990000
380000     MOVE PC-CURRENT-PROGRAM-NAME     TO DL001-ORIG-CALLING-PGM-NM38000000
380100                                                                  38010000
380200     CALL DL001-USER-PGM USING DFHEIBLK                           38020000
380300                               DL001-COMMAREA                     38030000
380400                               DL001-ASGMT-COMMAREA               38040000
380500                                                                  38050000
380600     IF DL001-SUCCESSFUL                                          38060000
380700*       *  ASSIGNMENT SENT IN HAS BEEN CLOSED, DLKUP001 HAS SENT *38070000
380800*       *  BACK CURRENT OPEN ASSIGNMENT.                         *38080000
380900        IF DL001-ASGMT-NEXT-USED                                  38090000
381000           MOVE DL001-NXT-START-DTE   TO PV-ASGMT-STRT-DTE        38100000
381100           MOVE DL001-NXT-NBR-TXT     TO PV-ASGMT-NBR-TXT         38110000
381200           MOVE DL001-NXT-NBR-SEQ-NBR TO PV-ASGMT-NBR-SEQ-NBR     38120000
381300        END-IF                                                    38130000
381400     ELSE                                                         38140000
381500           MOVE '4800-CALL-DLKUP001  '                            38150000
381600                           TO DP013-PARAGRAPH                     38160000
381700           MOVE 'CALL DLKUP001 MODULE '                           38170000
381800                           TO DP013-MESSAGE-TEXT(1)               38180000
381900           STRING ' SUKCS781:'                                    38190016
382000                ' DL001-RETURN-CODE '                             38200000
382100                DL001-RETURN-CODE                                 38210000
382200                ' DL001-SQL-ERROR-PARA'                           38220000
382300                DL001-SQL-ERROR-PARA                              38230000
382400               DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT(2)       38240000
382500           STRING ' SUKCS781:'                                    38250016
382600                ' DL001-CALL-MOD-FAIL-NM'                         38260000
382700                DL001-CALL-MOD-FAIL-NM                            38270000
382800                ' CALL-MOD-FAIL-ERR-CDE'                          38280000
382900                DL001-CALL-MOD-FAIL-ERR-CDE                       38290000
383000               DELIMITED BY SIZE INTO DP013-MESSAGE-TEXT(3)       38300000
383100           PERFORM 9999-WRITE-CICS-LOG-MSG                        38310000
383200     END-IF.                                                      38320000
383300/                                                                 38330000
383400 4850-CALL-XLKUP033.                                              38340000
383500                                                                  38350000
383600     MOVE  '4850'  TO  PT-CURR-PARA.                              38360000
383700     IF  PS-BLD-INTERNAL-TABLE-YES                                38370000
383800         PERFORM 1600-INTERNAL-TABLE                              38380000
383900     else                                                         38390000
384000         MOVE 1            TO PT-CURR-ENTRIES                     38400000
384100         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     38410000
384200         perform 1610-BUILD-MESSAGE-DISPLAY                       38420000
384300     END-IF.                                                      38430000
384400                                                                  38440000
384500                                                                  38450000
384600     INITIALIZE XL072-EAI-EXPORT-COMMAREA                         38460000
384700                SU050-DTL-TXT-AREA                                38470000
384800                                                                  38480000
384900     SET XL072-SU-APP-ID          TO TRUE.                        38490000
385000     MOVE 'RECEIVING'                 TO XL072-EVNT-OBJ-TXT       38500000
385100     MOVE 'TRAILER OPEN'          TO XL072-EVNT-OBJ-ACTN-TXT.     38510000
385200     MOVE SU051-USER-ID           TO XL072-CRE-BY-USR-ID.         38520000
385300     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            38530000
385400     MOVE SU051-TRIP-ID           TO XL072-EVNT-KY-1-NBR.         38540000
385500                                                                  38550000
385600*    MOVE SU001-BATCH-NUMBER      TO XL072-EVNT-KY-2-NBR.         38560000
385700     MOVE +1                      TO XL072-EVNT-KY-2-NBR.         38570000
385800     MOVE SU051-USER-ID           TO XL072-EVNT-KY-1-TXT.         38580000
385900     SET XL072-DO-NOT-COMMIT-UPDATE TO TRUE.                      38590000
386000     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-ORIG-CALLING-PGM-NM.   38600000
386100                                                                  38610000
386200     SET XL072-SUWS050-COPYBOOK TO TRUE.                          38620000
386300                                                                  38630000
386400     SET SU050-OPEN-INBND-TRLR        TO TRUE                     38640000
386500     MOVE PV-ASGMT-STRT-DTE           TO SU050-AB-ASGMT-STRT-DTE  38650000
386600     MOVE PV-ASGMT-NBR-TXT            TO SU050-AB-ASGMT-NBR-TXT   38660000
386700     MOVE PV-ASGMT-NBR-SEQ-NBR       TO SU050-AB-ASGMT-NBR-SEQ-NBR38670000
386800     MOVE DL001-SEQ-START-NBR        TO SU050-AB-ASGMT-SEQ-DTL-NBR38680000
386900     MOVE SU051-DOOR-NUMBER           TO SU050-AB-DOOR-NBR        38690000
387000     MOVE SU050-DTL-TXT-AREA          TO XL072-DTL-TXT            38700000
387100                                                                  38710000
387200     CALL XL072-USER-PGM USING DFHEIBLK                           38720000
387300                               XL072-COMMAREA                     38730000
387400                               XL072-EAI-EXPORT-COMMAREA.         38740000
387500                                                                  38750000
387600     IF XL072-SUCCESSFUL                                          38760000
387700        CONTINUE                                                  38770000
387800     ELSE                                                         38780000
387900           MOVE '4850-CALL-XLKUP033  '                            38790000
388000                           TO DP013-PARAGRAPH                     38800000
388100           MOVE 'CALL XLKUP033 MODULE '                           38810000
388200                           TO DP013-MESSAGE-TEXT(1)               38820000
388300           STRING ' SUKCS781 4850'                                38830016
388400                  ' TASK:'                pv-task-x               38840000
388500                  ' DL001-RETURN-CODE '   XL072-RETURN-CODE       38850000
388600                  ' XL072-SQL-ERROR-PARA' XL072-SQL-ERROR-PARA    38860000
388700                                          DELIMITED BY SIZE       38870000
388800                                     INTO DP013-MESSAGE-TEXT(2)   38880000
388900           STRING ' SUKCS781 4850'                                38890016
389000                  ' TASK:'                  pv-task-x             38900000
389100                  ' XL072-CALL-MOD-FAIL-NM' XL072-CALL-MOD-FAIL-NM38910000
389200                  ' CALL-MOD-FAIL-ERR-CDE'                        38920000
389300                                 XL072-CALL-MOD-FAIL-ERR-CDE      38930000
389400                                            DELIMITED BY SIZE     38940000
389500                                       INTO DP013-MESSAGE-TEXT(3) 38950000
389600           PERFORM 9999-WRITE-CICS-LOG-MSG                        38960000
389700     END-IF.                                                      38970000
389800                                                                  38980000
389900 5000-LINK-CARTON-CHECK-IN.                                       38990000
390000                                                                  39000000
390100     MOVE  '5000'  TO  PT-CURR-PARA.                              39010000
390200     IF  PS-BLD-INTERNAL-TABLE-YES                                39020000
390300         PERFORM 1600-INTERNAL-TABLE                              39030000
390400     else                                                         39040000
390500         MOVE 1            TO PT-CURR-ENTRIES                     39050000
390600         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     39060000
390700         perform 1610-BUILD-MESSAGE-DISPLAY                       39070000
390800     END-IF.                                                      39080000
390900                                                                  39090000
391000     INITIALIZE  SU054-CRTN-CHECKIN-RECORD.                       39100000
391100     MOVE SU051-DC-NUMBER         TO SU054-DC-NUMBER              39110000
391200     MOVE SU051-TRIP-ID           TO SU054-TRIP-ID                39120000
391300**** DISPLAY 'SU054-TRIP-ID = ' SU054-TRIP-ID.                    39130002
391400     MOVE SU051-USER-ID           TO SU054-USER-ID                39140000
391500     MOVE SU051-BAR-CODE-1        TO SU054-BAR-CODE-1             39150000
391600     MOVE SU051-BAR-CODE-2        TO SU054-BAR-CODE-2             39160000
391700     MOVE SU051-BAR-CODE-3        TO SU054-BAR-CODE-3             39170000
391800     MOVE SU051-DOOR-NUMBER       TO SU054-DOOR-NUMBER            39180000
391900     MOVE SU051-ACCM-LINE-NMBR    TO SU054-ACCM-LINE-NMBR         39190000
392000     IF PV-ASGMT-NBR-TXT   > SPACES                               39200000
392100        MOVE  PV-ASGMT-NBR-TXT     TO SU054-ASGMT-NBR-TXT         39210000
392200        MOVE  PV-ASGMT-NBR-SEQ-NBR TO SU054-ASGMT-NBR-SEQ-NBR     39220000
392300        MOVE  PV-ASGMT-STRT-DTE    TO SU054-ASGMT-STRT-DTE        39230000
392400     END-IF                                                       39240000
392500     IF PS-P2L-FRCD-DVRT-DC-YES                                   39250000
392600        SET SU054-P2L-DC-DIVERT-YES TO TRUE                       39260000
392700     ELSE                                                         39270000
392800        SET SU054-P2L-DC-DIVERT-NO TO TRUE                        39280000
392900     END-IF                                                       39290000
393000*    IF PS-DC-FLOWBACK-YES                                        39300000
393100*       SET SU054-FLOWBACK-YES TO TRUE                            39310000
393200*    ELSE                                                         39320000
393300*       SET SU054-FLOWBACK-NO  TO TRUE                            39330000
393400*    END-IF                                                       39340000
393500     IF PS-CSSL-LOGGING-YES                                       39350000
393600        STRING ' SUKCS781 5000'                                   39360016
393700               ' TASK:'  PV-TASK-X                                39370000
393800               ' DC:'    SU054-DC-NUMBER                          39380000
393900               ' BC1:'   SU054-BAR-CODE-1                         39390000
394000               ' BC2:'   SU054-BAR-CODE-2                         39400000
394100               ' BC3:'   SU054-BAR-CODE-3                         39410000
394200                         DELIMITED BY SIZE                        39420000
394300                    INTO PV-CICS-MSG-AREA                         39430000
394400        PERFORM 9990-WRITE-CICS                                   39440000
394500                                                                  39450000
394600        STRING ' SUKCS781 5000'                                   39460016
394700               ' TASK:'  PV-TASK-X                                39470000
394800               ' DOOR:'  SU054-DOOR-NUMBER                        39480000
394900               ' USER:'  SU054-USER-ID                            39490000
395000                         DELIMITED BY SIZE                        39500000
395100                    INTO PV-CICS-MSG-AREA                         39510000
395200        PERFORM 9990-WRITE-CICS                                   39520000
395300     END-IF                                                       39530000
395400                                                                  39540000
395500     MOVE LENGTH OF SU054-CRTN-CHECKIN-RECORD                     39550000
395600                                      TO PV-COMMAREA-LENGTH.      39560000
395601                                                                  39560115
395610     IF PS-CSSL-LOGGING-YES                                       39561015
395620        move spaces  TO  PV-CICS-MSG-AREA                         39562015
395630        PERFORM 9990-WRITE-CICS                                   39563015
395640                                                                  39564015
395641        MOVE PV-COMMAREA-LENGTH  TO  PV-DISP-LENGTH               39564115
395642                                                                  39564215
395650        STRING ' SUKCS781 5000 - BEFORE LINK'                     39565016
395660               ' TASK:'  PV-TASK-X                                39566015
395670               ' LENGTH:'  PV-DISP-LENGTH                         39567015
395692                         DELIMITED BY SIZE                        39569215
395693                    INTO PV-CICS-MSG-AREA                         39569315
395694        PERFORM 9990-WRITE-CICS                                   39569415
395695     END-IF                                                       39569515
395696                                                                  39569615
395700                                                                  39570000
395800     EXEC CICS                                                    39580000
395900         LINK PROGRAM  (PC-CRTN-CHKIN-PGM)                        39590000
396000              COMMAREA (SU054-CRTN-CHECKIN-RECORD)                39600000
396100              LENGTH   (PV-COMMAREA-LENGTH)                       39610000
396200              RESP     (PV-CICS-RESPONSE)                         39620000
396300     END-EXEC.                                                    39630000
396301                                                                  39630108
396530     IF PS-CSSL-LOGGING-YES                                       39653008
397300        move spaces  TO  PV-CICS-MSG-AREA                         39730013
397400        PERFORM 9990-WRITE-CICS                                   39740000
397500                                                                  39750000
397510        STRING ' SUKCS781 5000 - RETURN'                          39751016
397520               ' TASK:'  PV-TASK-X                                39752013
397530               ' DC:'    SU054-DC-NUMBER                          39753013
397540               ' BC1:'   SU054-BAR-CODE-1                         39754013
397550               ' BC2:'   SU054-BAR-CODE-2                         39755013
397560               ' BC3:'   SU054-BAR-CODE-3                         39756013
397570                         DELIMITED BY SIZE                        39757013
397580                    INTO PV-CICS-MSG-AREA                         39758013
397590        PERFORM 9990-WRITE-CICS                                   39759013
397591                                                                  39759113
397600        STRING ' SUKCS781 5000'                                   39760016
397700               ' TASK:'  PV-TASK-X                                39770000
397800               ' SU054-MODULE-DIVERT-CDE:'                        39780000
397900                 SU054-MODULE-DIVERT-CDE                          39790000
398000               ' SU054-REQUEST-LABEL-CDE:'                        39800000
398100                 SU054-REQUEST-LABEL-CDE                          39810000
398200               ' SU054-LABEL-PROCESSING:'                         39820000
398300                 SU054-LABEL-PROCESSING                           39830000
398400                 DELIMITED BY SIZE                                39840000
398500            INTO PV-CICS-MSG-AREA                                 39850000
398600        PERFORM 9990-WRITE-CICS                                   39860000
398601                                                                  39860111
398610        STRING ' SUKCS781 5000'                                   39861016
398620               ' TASK:'  PV-TASK-X                                39862011
398630               '  ' SU054-KOHLS-SML '  '                          39863011
398631               '  ' SU054-THIN-SLICE-IND '  '                     39863114
398632               '  *******************  '                          39863214
398640               '  REQ:'  SU054-REQUEST-LABEL-CDE                  39864013
398650               '  LBL:'  SU054-LABEL-PROCESSING                   39865013
398660               '  THIN:' SU054-THIN-SLICE-IND                     39866013
398690                 DELIMITED BY SIZE                                39869011
398691            INTO PV-CICS-MSG-AREA                                 39869111
398692        PERFORM 9990-WRITE-CICS                                   39869211
398693                                                                  39869313
398695        move spaces  TO  PV-CICS-MSG-AREA                         39869513
398696        PERFORM 9990-WRITE-CICS                                   39869613
398697                                                                  39869713
398700     END-IF.                                                      39870000
398800                                                                  39880000
398900                                                                  39890000
399000                                                                  39900000
399100 5200-LOAD-LABEL-DATA-MSG.                                        39910000
399200                                                                  39920000
399300     MOVE  '5200'  TO  PT-CURR-PARA.                              39930000
399400     IF  PS-BLD-INTERNAL-TABLE-YES                                39940000
399500         PERFORM 1600-INTERNAL-TABLE                              39950000
399600     else                                                         39960000
399700         MOVE 1            TO PT-CURR-ENTRIES                     39970000
399800         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     39980000
399900         perform 1610-BUILD-MESSAGE-DISPLAY                       39990000
400000     END-IF.                                                      40000000
400100                                                                  40010000
400200     MOVE 'LINE NO:'                TO PC248-LNE-PCK-HDG          40020000
400300     MOVE '@@@@@@@@@@@@@@'          TO PC248-PCK-UNTS-HDG         40030000
400400     MOVE '@@@@@@@@@@@@@@@@'        TO PC248-PKINOT-UNTS-HDG      40040000
400500     MOVE '@@@@'                    TO PC248-PCK-UNTS             40050000
400600                                                                  40060000
400700     MOVE PC248-FORM-OTPK-HDG       TO PC248-OUTPK-UNTS-HDG       40070000
400800     MOVE PC248-FORM-NO-INPK-BOX    TO PC248-INPK-CONVY-BOX       40080000
400900                                                                  40090000
401000     MOVE PC248-FORM-NO-RPRT-BOX    TO  PC248-REPRINT-BOX         40100000
401100     MOVE PC248-FORM-NO-RPRT-FLD    TO  PC248-REPRINT-TEXT        40110000
401200***                                                               40120000
401300     PERFORM 4300-SELECT-DC-LOC                                   40130000
401400     MOVE PV-2-DIGIT-DC-ABBR        TO  PV-DSPLY-DC.              40140000
401500     MOVE '-'                       TO  PV-DSPLY-DASH.            40150000
401600     MOVE SU051-ACCM-LINE-NMBR      TO  PV-DSPLY-PRTR-ID.         40160000
401700     MOVE PV-DSPLY-PRTR             TO  PC248-SML-PRTR-NBR.       40170000
401800*                                                                 40180000
401900                                                                  40190000
402000     MOVE PV-WORK-YY                TO  PV-LBL-DATE-YY.           40200000
402100     MOVE PV-WORK-MM                TO  PV-LBL-DATE-MM.           40210000
402200     MOVE PV-WORK-DD                TO  PV-LBL-DATE-DD.           40220000
402300     MOVE '-'                       TO  PV-LBL-DASH1              40230000
402400                                        PV-LBL-DASH2.             40240000
402500     MOVE PV-LBL-DATE               TO  PC248-LBL-PRT-DATE.       40250000
402600*                                                                 40260000
402700     MOVE PV-CURRENT-TIME           TO  PV-CURRENT-TIME-LBL       40270000
402800     MOVE PV-CURRENT-TIME-LBL       TO  PC248-LBL-PRT-TIME.       40280000
402900*                                                                 40290000
403000     MOVE 'CI'                      TO  PC248-FROM-APPLICATION.   40300000
403100     MOVE 'PRTAP'                   TO  PC248-PRTR-ATTACHED       40310000
403200     MOVE '-SML-'                   TO  PC248-LBL-DESC.           40320000
403300     MOVE PC248-LABEL-INFO-WORK     TO  PC248-LABEL-INFO.         40330000
403400*                                                                 40340000
403500     MOVE +1                                                      40350000
403600                                   TO PC248-LABEL-NBR.            40360000
403700     MOVE PC-OF                    TO PC248-LABEL-OF.             40370000
403800     MOVE +1                       TO PC248-TOT-LABEL.            40380000
403900                                                                  40390000
404000     MOVE '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'                   40400000
404100                                    TO  PC248-DEPT-CLASS-NAME     40410000
404200                                                                  40420000
404300                                                                  40430000
404400     MOVE '@@@@@@@@@@'              TO  PC248-FIXTURE             40440000
404500     MOVE '@@@@@@@@@@@@@@@@@@@@@@@@@' TO  PC248-SET               40450000
404600     MOVE SU051-TRIP-ID             TO  PC248-TRIP-ID             40460000
404700     MOVE SU051-USER-ID             TO  PC248-USER-ID.            40470000
404800                                                                  40480000
404900     MOVE PV-ERROR-MESSAGE          TO PC248-IINFO-MSG            40490000
405000                                       SU054-KOHLS-SML.           40500000
405100*    MOVE  +1                       TO PC248-SML-LBL-QTY.         40510000
405200     SET  PC248-STR-LNE-1-NO                                      40520000
405300          PC248-STR-LNE-2-NO                                      40530000
405400          PC248-STR-LNE-3-NO        TO  TRUE                      40540000
405500     MOVE PC248-FORM-NO-STORE       TO  PC248-STORE-NBR           40550000
405600     IF PS-TRIP-ERROR-YES                                         40560000
405700        MOVE PC-TRIP-ERROR-MESSAGE     TO                         40570000
405800                                 PC248-ERROR-MSG-1                40580000
405900     ELSE                                                         40590000
406000        MOVE PC-KEYED-DATA-ERROR-MSG   TO                         40600000
406100                                 PC248-ERROR-MSG-1                40610000
406200     END-IF                                                       40620000
406300     IF PS-USER-ERROR-YES                                         40630000
406400        MOVE PC-USER-ERROR-MESSAGE     TO                         40640000
406500                                 PC248-ERROR-MSG-1                40650000
406600     ELSE                                                         40660000
406700        MOVE PC-KEYED-DATA-ERROR-MSG   TO                         40670000
406800                                 PC248-ERROR-MSG-1                40680000
406900     END-IF                                                       40690000
407000     MOVE PC-RETURN-INPUT-SCREEN-MSG   TO                         40700000
407100                                 PC248-ERROR-MSG-2                40710000
407200*                                                                 40720000
407300*** DMH 9/22/11 - BEGIN                                           40730000
407400     IF  SU092-MULT-SSCC-YES                                      40740000
407500        MOVE SU092-KEY-BAR-CODE-1  TO  PC-BARCODE-1-ERROR         40750000
407600        MOVE PC-BARCODE-1-ERROR-MSG    TO                         40760000
407700                                 PC248-ERROR-MSG-1                40770000
407800        MOVE SU092-KEY-BAR-CODE-2  TO  PC-BARCODE-2-ERROR         40780000
407900        MOVE PC-BARCODE-2-ERROR-MSG    TO                         40790000
408000                                 PC248-ERROR-MSG-2                40800000
408100     END-IF                                                       40810000
408200*                                                                 40820000
408300     IF  PS-DUAL-FEED-OFF  AND                                    40830000
408400         SU054-MULT-SSCC-YES                                      40840000
408500        MOVE SU051-BAR-CODE-1      TO  PC-BARCODE-1-ERROR         40850000
408600        MOVE PC-BARCODE-1-ERROR-MSG    TO                         40860000
408700                                 PC248-ERROR-MSG-1                40870000
408800        MOVE SU051-BAR-CODE-2      TO  PC-BARCODE-2-ERROR         40880000
408900        MOVE PC-BARCODE-2-ERROR-MSG    TO                         40890000
409000                                 PC248-ERROR-MSG-2                40900000
409100     END-IF                                                       40910000
409200*** DMH 9/22/11 - END                                             40920000
409300*                                                                 40930000
409400                                                                  40940000
409500     SET PC248-OH-ZERO-MSG-NO       TO TRUE.                      40950000
409600                                                                  40960000
409700     MOVE PC248-SML-BATCH-LBL       TO                            40970000
409800                                        SU054-LABEL-DATA-FORMAT.  40980000
409900     IF  SU092-UCC128-NOT-FOUND  or                               40990000
410000         SU092-MULT-SSCC-YES                                      41000000
410100         SET  SU054-GENERIC-MESSAGE-LBL                           41010000
410200              SU054-GENERIC-MESSAGE-LBL-REQ  TO  TRUE             41020000
410300     ELSE                                                         41030000
410400     IF  SU054-MULT-SSCC-YES                                      41040000
410500         SET  SU054-GENERIC-MESSAGE-LBL                           41050000
410600              SU054-GENERIC-MESSAGE-LBL-REQ  TO  TRUE             41060000
410700     ELSE                                                         41070000
410800                                                                  41080000
410900         SET SU054-KEYED-DATA-ERROR                               41090000
411000             SU054-KEYED-DATA-ERR-LBL-REQ TO TRUE                 41100000
411100     END-IF                                                       41110000
411200     END-IF.                                                      41120000
411300                                                                  41130000
411400     SET SU054-KOHLS-MESSAGE-LABEL  TO TRUE.                      41140000
411500                                                                  41150000
411600     IF PS-CSSL-LOGGING-YES                                       41160000
411700        MOVE  SPACES TO  PV-CICS-MSG-AREA                         41170000
411800        STRING ' SUKCS781-5200-'                                  41180016
411900               ' TASK:'  pv-task-x                                41190000
412000               '    '    PC248-ERROR-MSG-1                        41200000
412100               '    '    PC248-ERROR-MSG-2                        41210000
412200                         DELIMITED BY SIZE                        41220000
412300                    INTO PV-CICS-MSG-AREA                         41230000
412400        PERFORM 9990-WRITE-CICS                                   41240000
412500     END-IF.                                                      41250000
412600                                                                  41260000
412700 5300-LOAD-LBL-REQ-MSG.                                           41270000
412800                                                                  41280000
412900     MOVE  '5300'  TO  PT-CURR-PARA.                              41290000
413000     IF  PS-BLD-INTERNAL-TABLE-YES                                41300000
413100         PERFORM 1600-INTERNAL-TABLE                              41310000
413200     else                                                         41320000
413300         MOVE 1            TO PT-CURR-ENTRIES                     41330000
413400         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     41340000
413500         perform 1610-BUILD-MESSAGE-DISPLAY                       41350000
413600     END-IF.                                                      41360000
413700                                                                  41370000
413800      INITIALIZE  DCLSUT00043.                                    41380000
413900      MOVE SU051-DC-NUMBER      TO SUT00043-DC-NBR                41390000
414000      MOVE SU051-ACCM-LINE-NMBR                                   41400000
414100                                TO SUT00043-ACM-LBL-STA-NBR       41410000
414200      MOVE PV-RECEIVE-RQST-TMST TO SUT00043-ACM-MSG-RCV-TMST      41420000
414300      MOVE SU051-MESSAGE-SEQ-NUMBER                               41430000
414400                                TO SUT00043-ACM-MSG-SEQ-NBR       41440000
414500      MOVE SU051-BAR-CODE-1     TO SUT00043-CART-BRCDE-1-NBR      41450000
414600      MOVE SU051-BAR-CODE-2     TO SUT00043-CART-BRCDE-2-NBR      41460000
414700      MOVE SU051-BAR-CODE-3     TO SUT00043-CART-BRCDE-3-NBR      41470000
414800      MOVE SU051-DOOR-NUMBER    TO SUT00043-DOOR-ID               41480000
414900      MOVE SU051-TRIP-ID        TO SUT00043-INBD-TRIP-ID          41490000
415000      MOVE SU051-USER-ID        TO SUT00043-USR-ID                41500000
415100                                                                  41510000
415200      MOVE SU051-DATE (1:4)     TO  PV-DATE-CCYY                  41520000
415300      MOVE SU051-DATE (5:2)     TO  PV-DATE-MM                    41530000
415400      MOVE SU051-DATE (7:2)     TO  PV-DATE-DD                    41540000
415500      MOVE PV-DATE              TO  SUT00043-ACM-CART-RCV-DTE     41550000
415600                                                                  41560000
415700      MOVE SU051-TIME (1:2)     TO  PV-TIME-HH                    41570000
415800      MOVE SU051-TIME (3:2)     TO  PV-TIME-MM                    41580000
415900      MOVE SU051-TIME (5:2)     TO  PV-TIME-SS                    41590000
416000      MOVE PV-TIME              TO  SUT00043-ACM-CART-RCV-TM      41600000
416100      IF PS-CSSL-LOGGING-YES                                      41610000
416200         STRING ' SUKCS781 5300'                                  41620016
416300                ' TASK:'          pv-task-x                       41630000
416400                ' SML:'           SU054-KOHLS-SML                 41640000
416500                ' DIVERT CDE:'    SUT00043-ACM-DIVERT-CDE         41650000
416600                ' CRTN TYPE CDE:' SUT00043-ACM-CART-LBL-CDE       41660000
416700                ' pna:'           SU051-ACCM-LINE-NMBR            41670000
416800                ' DATE:'          SU051-DATE                      41680000
416900                ' TIME:'          SU051-time                      41690000
417000                                  DELIMITED BY SIZE               41700000
417100                             INTO PV-CICS-MSG-AREA                41710000
417200         PERFORM 9990-WRITE-CICS                                  41720000
417300      END-IF                                                      41730000
417400                                                                  41740000
417500      MOVE SU054-KOHLS-SML      TO  SUT00043-KOHLS-BRCDE-NBR      41750000
417600      MOVE SU054-MODULE-DIVERT-CDE                                41760000
417700                                TO  SUT00043-ACM-DIVERT-CDE       41770000
417800      MOVE SU054-REQUEST-LABEL-CDE                                41780000
417900                                TO  SUT00043-ACM-CART-LBL-CDE     41790000
418000                                                                  41800000
418100      PERFORM 5400-INSERT-LBL-REQ-MSG.                            41810000
418200      PERFORM 9000-SYNCPOINT.                                     41820000
418300                                                                  41830000
418400 5400-INSERT-LBL-REQ-MSG.                                         41840000
418500                                                                  41850000
418600     MOVE  '5400'  TO  PT-CURR-PARA.                              41860000
418700     IF  PS-BLD-INTERNAL-TABLE-YES                                41870000
418800         PERFORM 1600-INTERNAL-TABLE                              41880000
418900     else                                                         41890000
419000         MOVE 1            TO PT-CURR-ENTRIES                     41900000
419100         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     41910000
419200         perform 1610-BUILD-MESSAGE-DISPLAY                       41920000
419300     END-IF.                                                      41930000
419400                                                                  41940000
419500      EXEC SQL                                                    41950000
419600        INSERT INTO SUT_LBL_REQ_MSG                               41960000
419700               ( DC_NBR                                           41970000
419800               , ACM_LBL_STA_NBR                                  41980000
419900               , ACM_MSG_RCV_TMST                                 41990000
420000               , ACM_MSG_SEQ_NBR                                  42000000
420100               , CART_BRCDE_1_NBR                                 42010000
420200               , CART_BRCDE_2_NBR                                 42020000
420300               , CART_BRCDE_3_NBR                                 42030000
420400               , DOOR_ID                                          42040000
420500               , INBD_TRIP_ID                                     42050000
420600               , USR_ID                                           42060000
420700               , ACM_CART_RCV_DTE                                 42070000
420800               , ACM_CART_RCV_TM                                  42080000
420900               , ACM_MSG_SNT_TMST                                 42090000
421000               , KOHLS_BRCDE_NBR                                  42100000
421100               , ACM_DIVERT_CDE                                   42110000
421200               , ACM_CART_LBL_CDE )                               42120000
421300        VALUES (                                                  42130000
421400                :SUT00043-DC-NBR                                  42140000
421500               ,:SUT00043-ACM-LBL-STA-NBR                         42150000
421600               ,:SUT00043-ACM-MSG-RCV-TMST                        42160000
421700               ,:SUT00043-ACM-MSG-SEQ-NBR                         42170000
421800               ,:SUT00043-CART-BRCDE-1-NBR                        42180000
421900               ,:SUT00043-CART-BRCDE-2-NBR                        42190000
422000               ,:SUT00043-CART-BRCDE-3-NBR                        42200000
422100               ,:SUT00043-DOOR-ID                                 42210000
422200               ,:SUT00043-INBD-TRIP-ID                            42220000
422300               ,:SUT00043-USR-ID                                  42230000
422400               ,:SUT00043-ACM-CART-RCV-DTE                        42240000
422500               ,:SUT00043-ACM-CART-RCV-TM                         42250000
422600               , CURRENT TIMESTAMP                                42260000
422700               ,:SUT00043-KOHLS-BRCDE-NBR                         42270000
422800               ,:SUT00043-ACM-DIVERT-CDE                          42280000
422900               ,:SUT00043-ACM-CART-LBL-CDE                        42290000
423000                 )                                                42300000
423100       END-EXEC                                                   42310000
423200                                                                  42320000
423300       EVALUATE TRUE                                              42330000
423400           WHEN SQLCODE = ZERO                                    42340000
423500           WHEN SQLCODE = -545                                    42350000
423600                CONTINUE                                          42360000
423700           WHEN SQLWARN0 NOT = SPACES                             42370000
423800           WHEN SQLCODE NOT EQUAL ZERO                            42380000
423900               perform 1620-WRITE-SUWS051-TO-CSSL                 42390000
424000                                                                  42400000
424100               STRING ' SUKCS781 5400'                            42410016
424200                      ' TASK:'  pv-task-x                         42420000
424300                      ' DC:'    SU051-DC-NUMBER                   42430000
424400                      ' SEQ:'   SU051-MESSAGE-SEQ-NUMBER          42440000
424500                      ' Bc1:'   SU051-BAR-CODE-1                  42450000
424600                      ' Bc2:'   SU051-BAR-CODE-2                  42460000
424700                      ' Bc3:'   SU051-BAR-CODE-3                  42470000
424800                                DELIMITED BY Size                 42480000
424900                           iNTO PV-CICS-MSG-AREA                  42490000
425000               PERFORM 9990-WRITE-CICS                            42500000
425100               STRING ' SUKCS781 5400'                            42510016
425200                      ' TASK:'  pv-task-x                         42520000
425300                      ' DOOR:'  SU051-DOOR-NUMBER                 42530000
425400                      ' TRIP:'  SU051-TRIP-ID                     42540000
425500                      ' USER:'  SU051-USER-ID                     42550000
425600                      ' PNA:'   SU051-ACCM-LINE-NMBR              42560000
425700                      ' DATE:'  SU051-DATE                        42570000
425800                      ' TIME:'  SU051-TIME                        42580000
425900                                DELIMITED BY SIZE                 42590000
426000                           INTO PV-CICS-MSG-AREA                  42600000
426100               PERFORM 9990-WRITE-CICS                            42610000
426200               MOVE '5400-INSERT-LBL-REQ-MSG'                     42620000
426300                               TO DP013-MESSAGE-TEXT(1)           42630000
426400               MOVE 'INSERT LBL REQ MESSAGE '                     42640000
426500                               TO DP013-MESSAGE-TEXT(2)           42650000
426600                                                                  42660000
426700               MOVE 'SUT_LBL_REQ_MSG'                             42670000
426800                               TO DP013-DB2-TABLE-NAME(1)         42680000
426900               PERFORM 9999-WRITE-CICS-LOG-MSG                    42690000
427000       END-EVALUATE.                                              42700000
427100                                                                  42710000
427200 6000-CALL-SUKUT709.                                              42720000
427300                                                                  42730000
427400     MOVE  '6000'  TO  PT-CURR-PARA.                              42740000
427500     IF  PS-BLD-INTERNAL-TABLE-YES                                42750000
427600         PERFORM 1600-INTERNAL-TABLE                              42760000
427700     else                                                         42770000
427800         MOVE 1            TO PT-CURR-ENTRIES                     42780000
427900         SET  PT-TRACK-IDX to PT-CURR-ENTRIES                     42790000
428000         perform 1610-BUILD-MESSAGE-DISPLAY                       42800000
428100     END-IF.                                                      42810000
428200                                                                  42820000
428300     IF  PS-CSSL-LOGGING-YES                                      42830000
428400                                                                  42840000
428500         STRING ' SUKCS781 6000'                                  42850016
428600                ' TASK:'    PV-TASK-X                             42860000
428700                ' BC1:'     SU051-BAR-CODE-1                      42870000
428800                ' BC2:'     SU051-BAR-CODE-2                      42880000
428900                            DELIMITED BY SIZE                     42890000
429000                       INTO PV-CICS-MSG-AREA                      42900000
429100         PERFORM 9990-WRITE-CICS                                  42910000
429200     END-IF.                                                      42920000
429300                                                                  42930000
429400     INITIALIZE SU092-ITEM-COMMAREA.                              42940000
429500                                                                  42950000
429600     SET SU092-PRINT-APPLY TO TRUE.                               42960000
429700     SET SU092-SUCCESSFUL  TO TRUE.                               42970000
429800                                                                  42980000
429900     MOVE SU051-ACCM-LINE-NMBR TO  SU092-KEY-ACM-STN-NBR.         42990000
430000     MOVE SU051-DC-NUMBER      TO  SU092-KEY-DC-LOC.              43000000
430100     MOVE SU051-BAR-CODE-1     TO  SU092-KEY-BAR-CODE-1.          43010000
430200     MOVE SU051-BAR-CODE-2     TO  SU092-KEY-BAR-CODE-2.          43020000
430300     MOVE SU051-BAR-CODE-3     TO  SU092-KEY-BAR-CODE-3.          43030000
430400                                                                  43040000
430500     CALL SU092-VSM-PGM  USING DFHEIBLK                           43050000
430600                               SU092-COMMAREA                     43060000
430700                               SU092-ITEM-COMMAREA.               43070000
430800                                                                  43080000
430900     EVALUATE TRUE                                                43090000
431000         WHEN SU092-SUCCESSFUL                                    43100000
431100              IF SU092-NO-TRIP-ID-FOUND                           43110000
431200                 SET PS-INPUT-DATA-ERROR-YES                      43120000
431300                     PS-TRIP-ERROR-YES         TO TRUE            43130000
431400                 MOVE 'TRIP ERR ' TO PV-ERROR-MESSAGE             43140000
431500              END-IF                                              43150000
431600              IF SU092-NO-USER-ID-FOUND                           43160000
431700                 SET PS-INPUT-DATA-ERROR-YES                      43170000
431800                     PS-USER-ERROR-YES         TO TRUE            43180000
431900                 MOVE 'BAD USRID' TO PV-ERROR-MESSAGE             43190000
432000              END-IF                                              43200000
432100*                                                                 43210000
432200*** dmh - 9/14/11 begin                                           43220000
432300*                                                                 43230000
432400              IF SU092-UCC128-NOT-FOUND                           43240000
432500***dmh 10/4      SET PS-INPUT-DATA-ERROR-YES                      43250000
432600***dmh 10/4          PS-USER-ERROR-YES         TO TRUE            43260000
432700                 MOVE 'NOT FOUND' TO PV-ERROR-MESSAGE             43270000
432800              END-IF                                              43280000
432900*                                                                 43290000
433000*** dmh - 9/14/11 end                                             43300000
433100*                                                                 43310000
433200*                                                                 43320000
433300*** dmh - 9/21/11 begin                                           43330000
433400*                                                                 43340000
433500              IF SU092-MULT-SSCC-YES                              43350000
433600                 SET PS-INPUT-DATA-ERROR-YES                      43360000
433700                     PS-TRIP-ERROR-YES                            43370000
433800                     SU054-MULT-SSCC-YES       TO TRUE            43380000
433900                 MOVE 'MULT SSCC' TO PV-ERROR-MESSAGE             43390000
434000              END-IF                                              43400000
434100*                                                                 43410000
434200*** dmh - 9/21/11 end                                             43420000
434300*                                                                 43430000
434400*             PERFORM 6200-FORMAT-DATA                            43440000
434500                                                                  43450000
434600         WHEN SU092-PNA-STA-NOT-FOUND                             43460000
434700              SET PS-INPUT-DATA-ERROR-YES                         43470000
434800                  PS-TRIP-ERROR-YES         TO TRUE               43480000
434900              MOVE 'INVD PNA ' TO PV-ERROR-MESSAGE                43490000
435000                                                                  43500000
435100         WHEN SU092-SQL-ERROR                                     43510000
435200              SET PS-INPUT-DATA-ERROR-YES   TO TRUE               43520000
435300              MOVE 'DB2 ERROR' TO PV-ERROR-MESSAGE                43530000
435400               STRING ' SUKCS781 6000'                            43540016
435500                      ' TASK:'  PV-TASK-X                         43550000
435600                      ' DC:'    SU051-DC-NUMBER                   43560000
435700                      ' SEQ:'   SU051-MESSAGE-SEQ-NUMBER          43570000
435800                      ' BC1:'   SU051-BAR-CODE-1                  43580000
435900                      ' BC2:'   SU051-BAR-CODE-2                  43590000
436000                      ' BC3:'   SU051-BAR-CODE-3                  43600000
436100                                DELIMITED BY SIZE                 43610000
436200                           INTO PV-CICS-MSG-AREA                  43620000
436300               PERFORM 9990-WRITE-CICS                            43630000
436400               STRING ' SUKCS781 6000'                            43640016
436500                      ' TASK:'  PV-TASK-X                         43650000
436600                      ' DOOR:'  SU051-DOOR-NUMBER                 43660000
436700                      ' TRIP:'  SU051-TRIP-ID                     43670000
436800                      ' USER:'  SU051-USER-ID                     43680000
436900                      ' PNA:'   SU051-ACCM-LINE-NMBR              43690000
437000                      ' DATE:'  SU051-DATE                        43700000
437100                      ' TIME:'  SU051-TIME                        43710000
437200                                DELIMITED BY SIZE                 43720000
437300                           INTO PV-CICS-MSG-AREA                  43730000
437400               PERFORM 9990-WRITE-CICS                            43740000
437500               MOVE '6000-CALL-SUKUT709'                          43750000
437600                               TO DP013-PARAGRAPH                 43760000
437700               MOVE 'DETERMINE CARTON TRAILER '                   43770000
437800                               TO DP013-MESSAGE-TEXT(1)           43780000
437900                                                                  43790000
438000               MOVE 'MULTIPLE'                                    43800000
438100                               TO DP013-DB2-TABLE-NAME(1)         43810000
438200               MOVE SQLCA        TO DP013-SQLCA                   43820000
438300               SET DP013-DB2-ABEND                                43830000
438400                   DP013-XCTL-DISPLAY-RESTART TO TRUE             43840000
438500               PERFORM 9999-WRITE-CICS-LOG-MSG                    43850000
438600                                                                  43860000
438700     END-EVALUATE.                                                43870000
438800                                                                  43880000
438900     IF PS-CSSL-LOGGING-YES                                       43890000
439000        STRING ' SUKCS781 6000'                                   43900016
439100               ' TASK:'  PV-TASK-X                                43910000
439200               ' DC:'    SU054-DC-NUMBER                          43920000
439300               ' BC1:'   SU092-KEY-BAR-CODE-1                     43930000
439400               ' BC2:'   SU092-KEY-BAR-CODE-2                     43940000
439500               ' BC3:'   SU092-KEY-BAR-CODE-3                     43950000
439600                         DELIMITED BY SIZE                        43960000
439700                    INTO PV-CICS-MSG-AREA                         43970000
439800        PERFORM 9990-WRITE-CICS                                   43980000
439900                                                                  43990000
440000        STRING ' SUKCS781 6000'                                   44000016
440100               ' TASK:'            PV-TASK-X                      44010000
440200               ' SU092-UCC128:'    SU092-UCC128-FOUND-IND         44020000
440300               ' SU092-MULT-SSCC'  SU092-MULT-SSCC-IND            44030000
440400               ' SU092-FLAGS:'     SU092-FLAGS                    44040000
440500                                   DELIMITED BY SIZE              44050000
440600                              INTO PV-CICS-MSG-AREA               44060000
440700        PERFORM 9990-WRITE-CICS                                   44070000
440800     END-IF.                                                      44080000
440900                                                                  44090000
441000                                                                  44100000
441100*6200-FORMAT-DATA.                                                44110000
441200*                                                                 44120000
441300* JUST FOR TESTING - BEGIN                                        44130000
441400*    MOVE SU092-TRIP-ID  TO PV-TRIP-ID.                           44140000
441500*    STRING ' SUKCS781 6000'                                      44150016
441600*           ' TASK:'            pv-task-x                         44160000
441700*            PV-ERROR-MESSAGE  '-'                                44170000
441800*            PV-TRIP-ID        '-'                                44180000
441900*            SU092-USER-ID     '-'                                44190000
442000*            SU092-DOOR-ID     '-'                                44200000
442100*    DELIMITED BY SIZE                                            44210000
442200*    INTO PV-CICS-MSG-AREA.                                       44220000
442300*    PERFORM 9990-WRITE-CICS.                                     44230000
442400* JUST FOR TESTING - END                                          44240000
442500                                                                  44250000
442600                                                                  44260000
442700 9000-SYNCPOINT.                                                  44270000
442800     EXEC CICS                                                    44280000
442900         SYNCPOINT                                                44290000
443000     END-EXEC.                                                    44300000
443100/                                                                 44310000
443200 9990-WRITE-CICS.                                                 44320000
443300     EXEC CICS                                                    44330000
443400         WRITEQ TD                                                44340000
443500         QUEUE('CSSL')                                            44350000
443600         FROM(PV-CICS-MSG-AREA)                                   44360000
443700         RESP(PV-CICS-RESPONSE)                                   44370000
443800     END-EXEC.                                                    44380000
443900                                                                  44390000
444000     MOVE SPACES TO PV-CICS-MSG-AREA.                             44400000
444100                                                                  44410000
444200 9990-WRITE-CICS-DMH.                                             44420000
444300     EXEC CICS                                                    44430000
444400         WRITEQ TD                                                44440000
444500         QUEUE('CSSL')                                            44450000
444600         FROM(PV-CICS-MSG-AREA-DMH)                               44460000
444700         RESP(PV-CICS-RESPONSE)                                   44470000
444800     END-EXEC.                                                    44480000
444900                                                                  44490000
445000     MOVE SPACES TO PV-CICS-MSG-AREA-DMH.                         44500000
445100                                                                  44510000
445200 9800-SQL-WARNING.                                                44520000
445300                                                                  44530000
445400      MOVE SQLCODE               TO SQLCODE2.                     44540000
445500      MOVE SQLERRD(3)            TO SQLERRD3.                     44550000
445600      DISPLAY '** ABEND **       ** = SQLWARNING'.                44560000
445700      DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PGM-NAME.      44570000
445800      DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 44580000
445900      DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 44590000
446000      DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                 44600000
446100      DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                 44610000
446200      DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                 44620000
446300      DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                 44630000
446400      DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                 44640000
446500      DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                 44650000
446600      DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                 44660000
446700      DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                 44670000
446800                                                                  44680000
446900      MOVE 4013                  TO PV-ABEND-CODE                 44690000
447000      CALL 'ILBOABN0' USING PV-ABEND-CODE.                        44700000
447100                                                                  44710000
447200                                                                  44720000
447300 9900-SQL-ERROR.                                                  44730000
447400                                                                  44740000
447500      MOVE SQLCODE               TO SQLCODE2.                     44750000
447600      MOVE SQLERRD(3)            TO SQLERRD3.                     44760000
447700      DISPLAY '** ABEND **       ** = SQLERROR'.                  44770000
447800      DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PGM-NAME.      44780000
447900      DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 44790000
448000      DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 44800000
448100      DISPLAY '** SQLERRM        ** = ' SQLERRM.                  44810000
448200      DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                 44820000
448300                                                                  44830000
448400      MOVE 4013                  TO PV-ABEND-CODE                 44840000
448500      CALL 'ILBOABN0' USING PV-ABEND-CODE.                        44850000
448600*                                                                 44860000
448700 9999-WRITE-CICS-LOG-MSG.                                         44870000
448800                                                                  44880000
448900     MOVE PC-CURRENT-PGM-NAME    TO DP013-PROGRAM.                44890000
449000     MOVE DP013-LOCATION         TO PV-CICS-MSG-AREA.             44900000
449100     PERFORM 9990-WRITE-CICS.                                     44910000
449200     STRING ' SUKCS781 9999'                                      44920016
449300            ' TASK:'           pv-task-x                          44930000
449400            ' DC:'             SU051-DC-NUMBER                    44940000
449500                               DELIMITED BY SIZE                  44950000
449600                          INTO PV-CICS-MSG-AREA.                  44960000
449700     PERFORM 9990-WRITE-CICS.                                     44970000
449800     IF DP013-MESSAGE-TEXT(1) > SPACES                            44980000
449900         MOVE DP013-MESSAGE-TEXT(1)  TO PV-CICS-MSG-AREA          44990000
450000         PERFORM 9990-WRITE-CICS                                  45000000
450100     END-IF.                                                      45010000
450200     IF DP013-MESSAGE-TEXT(2) > SPACES                            45020000
450300         MOVE DP013-MESSAGE-TEXT(2)  TO PV-CICS-MSG-AREA          45030000
450400         PERFORM 9990-WRITE-CICS                                  45040000
450500     END-IF.                                                      45050000
450600     IF DP013-MESSAGE-TEXT(3) > SPACES                            45060000
450700         MOVE DP013-MESSAGE-TEXT(3)  TO PV-CICS-MSG-AREA          45070000
450800         PERFORM 9990-WRITE-CICS                                  45080000
450900     END-IF.                                                      45090000
451000     IF DP013-MESSAGE-TEXT(4) > SPACES                            45100000
451100         MOVE DP013-MESSAGE-TEXT(4)  TO PV-CICS-MSG-AREA          45110000
451200         PERFORM 9990-WRITE-CICS                                  45120000
451300     END-IF.                                                      45130000
451400     IF DP013-DB2-TABLE-NAME(1) > SPACES                          45140000
451500         MOVE DP013-DB2-TABLE-NAME(1)                             45150000
451600                                     TO PV-CICS-MSG-AREA          45160000
451700         PERFORM 9990-WRITE-CICS                                  45170000
451800     END-IF.                                                      45180000
451900     IF DP013-DB2-TABLE-NAME(2) > SPACES                          45190000
452000         MOVE DP013-DB2-TABLE-NAME(2)                             45200000
452100                                     TO PV-CICS-MSG-AREA          45210000
452200         PERFORM 9990-WRITE-CICS                                  45220000
452300     END-IF.                                                      45230000
452400     IF SQLCODE NOT EQUAL ZERO                                    45240000
452500         MOVE 'DB2 ERROR'            TO PV-ERROR-MESSAGE          45250000
452600         MOVE SQLCODE                TO PV-SQL-CODE               45260000
452700         STRING ' SUKCS781 9999'                                  45270016
452800                ' TASK:'           pv-task-x                      45280000
452900                'SQL CODe:'        PV-SQL-CODE                    45290000
453000                                   DELIMITED BY SIZE              45300000
453100                              INTO PV-CICS-MSG-AREA               45310000
453200         PERFORM 9990-WRITE-CICS                                  45320000
453300     END-IF.                                                      45330000
453400     PERFORM VARYING PT-MSG-IDX FROM 1 BY 1 UNTIL                 45340000
453500                     PT-MESSAGE(PT-MSG-IDX) = SPACES              45350000
453600                     OR PT-MSG-IDX > 40                           45360000
453700         MOVE PT-MSG(PT-MSG-IDX) TO PV-CICS-MSG-AREA              45370000
453800         PERFORM 9990-WRITE-CICS                                  45380000
453900     END-PERFORM.                                                 45390000
454000                                                                  45400000
454100*    IF PS-SOCKET-NOT-CLOSED                                      45410000
454200*        PERFORM 1500-CLOSE-SOCKET                                45420000
454300*    END-IF.                                                      45430000
454400                                                                  45440000
454500     EXEC CICS                                                    45450000
454600         RETURN                                                   45460000
454700     END-EXEC.                                                    45470000
454800*                                                                 45480000
454900*    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           45490000
455000*                                                                 45500000
455100                                                                  45510000
455200     COPY DPPD011.                                                45520000
455300*                                                                 45530000
