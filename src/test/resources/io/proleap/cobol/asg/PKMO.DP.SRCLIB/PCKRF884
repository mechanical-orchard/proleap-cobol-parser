000010 IDENTIFICATION DIVISION.                                         00001054
000020 PROGRAM-ID.             PCKRF884.                                00002054
000030 AUTHOR.                 LYNN MCADAMS.                            00003054
000040 INSTALLATION.           KOHLS.                                   00004054
000050 DATE-WRITTEN            MARCH, 2001.                             00005054
000060 DATE-COMPILED.                                                   00006054
000070                                                                  00007054
000080******************************************************************00008054
000090* THIS PROGRAM IS DISPLAYED BY SELECTING OPTION 1, CARTON         00009054
000091* FUNCTIONS, ON THE MANIFESTING MENU (PCKRF850) SCREEN.           00009154
000092*                                                                 00009254
000093* THIS PROGRAM DISPLAYS THE CARTON FUNCTIONS SUBMENU ON THE       00009354
000094* LRT (LASER RADIO TERMINAL) AND PASSES CONTROL TO THE PROGRAM    00009454
000095* WHICH PROCESSES THE SELECTED FUNCTION.                          00009554
000096******************************************************************00009654
000097                                                                  00009754
000098 ENVIRONMENT DIVISION.                                            00009854
000099 DATA DIVISION.                                                   00009954
000100                                                                  00010054
000101 WORKING-STORAGE SECTION.                                         00010154
000102 01  CA-COMMAREA.                                                 00010254
000103     05  CA-COMMON-DATA.                                          00010354
000104         10  CA-TRANSACTION-STATUS                                00010454
000105                                         PIC  X(01)  VALUE SPACES.00010554
000106             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00010654
000107             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00010754
000108         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACES.00010854
000109         10  CA-CALL-FROM-PGM-NME        PIC  X(08)  VALUE SPACES.00010954
000110             88  CA-CALL-FROM-CARTON-FUNC      VALUE 'PCKRF884'.  00011054
000111     05  CA-PROGRAM-DATA.                                         00011154
000112         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACES.00011254
000113             88  CA-VALID-SELECTION                  VALUE        00011354
000114                 '1', '2', '3', '4', 'T'.                         00011454
000115             88  CA-SELECTION-TEST                   VALUE 'T'.   00011554
000116         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00011654
000117                                         PIC  9(01).              00011754
000118             88  CA-SELECTION-ONE                    VALUE 1.     00011854
000119             88  CA-SELECTION-TWO                    VALUE 2.     00011954
000120             88  CA-SELECTION-THREE                  VALUE 3.     00012054
000121             88  CA-SELECTION-FOUR                   VALUE 4.     00012154
000122         10  CA-FILLER1                  PIC  X(290) VALUE SPACES.00012254
000123                                                                  00012354
000124 01  CA-COMMAREA-2.                                               00012454
000125     COPY PCWS033.                                                00012554
000126                                                                  00012654
000127* HELP SCREEN COMMAREA                                            00012754
000128     COPY PCWS192.                                                00012854
000129* HELP SCREEN WORK AREA                                           00012954
000130     COPY PCWS188.                                                00013054
000131/                                                                 00013154
000132 01  PC-PROGRAM-CONSTANTS.                                        00013254
000133     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00013354
000134         'PCKRF884'.                                              00013454
000135     05  PC-MANF-MENU-PGM                PIC  X(08)  VALUE        00013554
000136         'PCKRF850'.                                              00013654
000137     05  PC-AUTOVE-MODULE           PIC  X(08) VALUE 'RCKUT127'.  00013754
000138     05  PC-AUTOVE-MODULE-LENGTH    PIC S9(04) VALUE  +400        00013854
000139                                                    COMP SYNC.    00013954
000140     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'E884'.00014054
000141     05  PC-CHECK-AUTH-FOR-TRAN-E730     PIC  X(04)  VALUE 'E730'.00014154
000142     05  PC-CHECK-AUTH-FOR-TRAN-E864     PIC  X(04)  VALUE 'E864'.00014254
000143     05  PC-CHECK-AUTH-FOR-TRAN-E861     PIC  X(04)  VALUE 'E861'.00014354
000144     05  PC-CHECK-AUTH-FOR-TRAN-E880     PIC  X(04)  VALUE 'E880'.00014454
000145     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00014554
000146         'END OF SESSION     '.                                   00014654
000147     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00014754
000148         'INVALID SELECTION  '.                                   00014854
000149     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00014954
000150         'UNRECOGNIZED PF KEY'.                                   00015054
000151     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00015154
000152         'USER NOT AUTHORIZED'.                                   00015254
000153     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00015354
000154         'NUMERIC VALUE REQ. '.                                   00015454
000155     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00015554
000156         'F3 =END            '.                                   00015654
000157     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00015754
000158         'TRANS NOT AVAILABLE'.                                   00015854
000159     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00015954
000160         'CICS ABEND -CALL DP'.                                   00016054
000161     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00016154
000162         'CICSAUTH BAD RETURN'.                                   00016254
000163     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00016354
000164         'SELECTION NOT AVAIL'.                                   00016454
000165     05  PC-AUTOVE-NO-CRTN-BLD-MSG       PIC X(19)   VALUE        00016554
000166         'AUTOVE CANT BLD CTN'.                                   00016654
000167                                                                  00016754
000168 01  PN-PGM-NAME-DATA.                                            00016854
000169     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00016954
000170         'PCKRF730'.                                              00017054
000171*VML CHG'D SELECTION-02-PROGRAM FROM PCKRF864 TO PCKRF886 7/07    00017154
000172*VML TO GO TO MASTER (CONTAINER) TYPE SCREEN                      00017254
000173     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00017354
000174         'PCKRF886'.                                              00017454
000175     05  PN-SELECTION-03-PROGRAM         PIC  X(08)  VALUE        00017554
000176         'PCKRF861'.                                              00017654
000177     05  PN-SELECTION-04-PROGRAM         PIC  X(08)  VALUE        00017754
000178         'PCKRF880'.                                              00017854
000179                                                                  00017954
000180 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00018054
000181*LMM 05  PN-PGM-NAME  OCCURS 5 TIMES                              00018154
000182     05  PN-PGM-NAME  OCCURS 4 TIMES                              00018254
000183                      INDEXED BY PN-INDX                          00018354
000184                                         PIC  X(08).              00018454
000185                                                                  00018554
000186* DMH 09/2015 - ADD KEY FIELDS                                    00018656
000187 01  DK-DB2-KEYS.                                                 00018756
000188     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00018856
000189     05  DK-CURRENT-TIMESTAMP            PIC X(26)   VALUE SPACES.00018956
000190                                                                  00019060
000193 01  PS-PROGRAM-SWITCHES.                                         00019354
000194     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00019454
000195         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00019554
000196         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00019654
000197                                                                  00019760
000198* DMH 09/2015   ADD WMOS SWITCH                                   00019858
000199     05  PS-DC-ON-WMOS-SW               PIC  X       VALUE 'N'.   00019958
000200         88  PS-DC-ON-WMOS-YES                       VALUE 'Y'.   00020058
000210         88  PS-DC-ON-WMOS-NO                        VALUE 'N'.   00021058
000227                                                                  00022754
000228 01  PV-PROGRAM-VARIABLES.                                        00022854
000229     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00022954
000230                                                     COMP SYNC.   00023054
000231     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00023164
000232                                                     COMP SYNC.   00023264
000233     05  PV-CICS-RESP                    PIC S9(08)  VALUE ZEROS  00023354
000234                                                     COMP SYNC.   00023454
000235     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACES.00023554
000236                                                                  00023654
000237     05  PV-CICS-MESSAGE-AREA      PIC X(100)  VALUE SPACES.      00023754
000238     05  PV-DISP-OPER              PIC 9(04)   VALUE ZEROES.      00023854
000239     05  PV-DISP-USERID            PIC X(08)   VALUE SPACES.      00023954
000240                                                                  00024058
000241     05  PV-CSSL-MSG                     PIC  X(100) VALUE SPACE. 00024158
000242     05  PV-CSSL-MSG-LENGTH              PIC S9(04)  VALUE +0     00024258
000243                                                     COMP SYNC.   00024358
000244     05  PV-TIMESTAMP                    PIC  X(26)  VALUE SPACE. 00024458
000245     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   00024558
000246                                                     COMP SYNC.   00024658
000247     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   00024758
000248                                                     COMP.        00024858
000249     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 00024958
000250     05  PV-SYSTEM-ID.                                            00025058
000251         10  FILLER              PIC  X(04)  VALUE SPACE.         00025158
000252         10  PV-REGION-IND       PIC  X(01).                      00025258
000253             88  PV-TEST-CICS                VALUE 'T'.           00025358
000254             88  PV-QA-CICS                  VALUE 'Q'.           00025458
000255             88  PV-PROD-CICS                VALUE 'P'.           00025558
000256             88  PV-LEARN-CICS               VALUE 'L'.           00025658
000257         10  FILLER              PIC  X(03)  VALUE SPACES.        00025758
000258*                                                                 00025858
000259 01  TS-TEMP-STORAGE-QUEUE-INFO.                                  00025958
000260     05  TS-INFO-QUEUE-NAME.                                      00026058
000261         10  TS-INFO-QUEUE-TERMINAL      PIC  X(04)  VALUE SPACE. 00026158
000262         10  FILLER                      PIC  X(04)  VALUE 'INFO'.00026258
000263                                                                  00026358
000264* DMH 09/02                                                       00026459
000265     05  PC-DC-IN-WMOS-MSG               PIC X(19)   VALUE        00026559
000266         'ERR - DC IS ON WMS'.                                    00026659
000267                                                                  00026759
000268                                                                  00026858
000269*                                                                 00026954
000270*-----------------------------------------------------------------00027054
000271*  COPYBOOK FOR AUTO VE ACCESS MODULE                             00027154
000272*-----------------------------------------------------------------00027254
000273     COPY RCWS040.                                                00027354
000274                                                                  00027454
000275     COPY DPWS026.                                                00027554
000276                                                                  00027654
000277*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00027754
000278     COPY DPWS013.                                                00027854
000279                                                                  00027954
000280*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        00028054
000281     COPY DPWS008.                                                00028154
000282                                                                  00028254
000283*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00028354
000284     COPY DPWS010I.                                               00028454
000285                                                                  00028554
000286*  MAPSET                                                         00028654
000287     COPY PCKM884.                                                00028754
000288                                                                  00028854
000289*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   00028954
000290     COPY DPWS015.                                                00029054
000291                                                                  00029154
000292     COPY DFHAID.                                                 00029254
000293                                                                  00029357
000294* DMH 09/2015 - ADD WST00008/9/10                                 00029457
000295******************************************************************00029557
000296*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 00029657
000297******************************************************************00029757
000298     EXEC SQL                                                     00029857
000299          INCLUDE WST00008                                        00029957
000300     END-EXEC.                                                    00030057
000301******************************************************************00030157
000302*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   00030257
000303******************************************************************00030357
000304     EXEC SQL                                                     00030457
000305          INCLUDE WST00009                                        00030557
000306     END-EXEC.                                                    00030657
000307******************************************************************00030757
000308*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   00030857
000309******************************************************************00030957
000310     EXEC SQL                                                     00031057
000311          INCLUDE WST00010                                        00031157
000312     END-EXEC.                                                    00031257
000313                                                                  00031357
000314     EXEC SQL                                                     00031457
000315         INCLUDE SQLCA                                            00031557
000316     END-EXEC.                                                    00031657
000317                                                                  00031757
000318                                                                  00031857
000319                                                                  00031954
000320 LINKAGE SECTION.                                                 00032054
000321 01  DFHCOMMAREA.                                                 00032154
000322     05  FILLER                       OCCURS 1 TO 4072 TIMES      00032254
000323                                      DEPENDING ON EIBCALEN.      00032354
000324         10  FILLER                   PIC X.                      00032454
000325                                                                  00032561
000326 PROCEDURE DIVISION.                                              00032654
000327 0000-PROGRAM-MAINLINE.                                           00032754
000328     INITIALIZE                         CA-COMMAREA.              00032854
000329     MOVE DFHCOMMAREA                TO CA-COMMAREA.              00032954
000330     MOVE LOW-VALUES                 TO PC884AI.                  00033054
000331                                                                  00033154
000332     EVALUATE TRUE                                                00033254
000333         WHEN EIBCALEN = ZERO                                     00033354
000334         WHEN EIBTRNID = 'Z278'                                   00033454
000335         WHEN EIBAID = DFHCLEAR                                   00033554
000336         WHEN CA-INITIALIZE-SCREEN                                00033654
000337              INITIALIZE CA-COMMAREA                              00033754
000338*             MOVE PC-PROGRAM-FUNCTION-KEYS                       00033854
000339*                                    TO AMSGLNO                   00033954
000340              PERFORM 8000-SEND-MAP                               00034054
000341              PERFORM 8200-RETURN-TRANID                          00034154
000342         WHEN EIBAID = DFHENTER                                   00034254
000343              PERFORM 1000-RECEIVE-MAP                            00034354
000344              PERFORM 1100-EDIT-SELECTION                         00034454
000345         WHEN EIBAID = DFHPF3                                     00034554
000346              MOVE PC-MANF-MENU-PGM TO PV-TRANSFER-PROGRAM        00034654
000347              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               00034754
000348         WHEN EIBAID = DFHPF1                                     00034854
000349              PERFORM 1200-HELP-SCREEN                            00034954
000350         WHEN OTHER                                               00035054
000351              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     00035154
000352                                     TO AMSGLNO                   00035254
000353              PERFORM 8100-SEND-DATA-ONLY                         00035354
000354              PERFORM 8200-RETURN-TRANID                          00035454
000355     END-EVALUATE.                                                00035554
000356                                                                  00035654
000357     GOBACK.                                                      00035754
000358*                                                                 00035854
000359*                                                                 00035954
000360 1000-RECEIVE-MAP.                                                00036054
000361     EXEC CICS                                                    00036154
000362         RECEIVE MAP    ('PC884A')                                00036254
000363                 MAPSET ('PCKM884')                               00036354
000364                 RESP   (PV-CICS-RESP)                            00036454
000365     END-EXEC.                                                    00036554
000366                                                                  00036654
000367     EVALUATE TRUE                                                00036754
000368         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     00036854
000369              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  00036954
000370         WHEN PV-CICS-RESP = DFHRESP (MAPFAIL)                    00037054
000371              CONTINUE                                            00037154
000372         WHEN OTHER                                               00037254
000373              MOVE '1000-RECEIVE-MAP'                             00037354
000374                                     TO DP013-PARAGRAPH           00037454
000375              MOVE 'UNABLE TO RECEIVE MAP'                        00037554
000376                                     TO DP013-MESSAGE-TEXT (1)    00037654
000377              SET DP013-LOGIC-ABEND  TO TRUE                      00037754
000378              SET DP013-NO-ROLLBACK  TO TRUE                      00037854
000379              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              00037954
000380     END-EVALUATE.                                                00038054
000381*                                                                 00038154
000382*                                                                 00038254
000383 1010-RECEIVE-SCREEN-FIELDS.                                      00038354
000384     IF  ASELECTL > ZERO                                          00038454
000385         MOVE ASELECTI               TO CA-SELECTION-X            00038554
000386     END-IF.                                                      00038654
000387*                                                                 00038754
000388*                                                                 00038854
000389 1100-EDIT-SELECTION.                                             00038954
000390                                                                  00039054
000391     IF  CA-SELECTION-TEST                                        00039154
000392         CONTINUE                                                 00039254
000393     ELSE                                                         00039354
000394         MOVE CA-SELECTION-X         TO DP010I-UNEDITED-FIELD     00039454
000395         MOVE 1                      TO DP010I-MAXIMUM-DIGITS     00039554
000396         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   00039654
000397         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  00039754
000398                                                                  00039854
000400         CALL DP010I-NUMERIC-EDIT-ROUTINE                         00040068
000401                         USING DP010I-NUMERIC-EDIT-AREA           00040168
000402                                                                  00040254
000403         IF  DP010I-ERROR-DETECTED                                00040354
000404             MOVE PC-NON-NUMERIC-SELECTION-MSG TO AMSGLNO         00040454
000405             PERFORM 8100-SEND-DATA-ONLY                          00040554
000406             PERFORM 8200-RETURN-TRANID                           00040654
000407         ELSE                                                     00040754
000408             MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION          00040854
000409         END-IF                                                   00040954
000410     END-IF.                                                      00041054
000411                                                                  00041154
000412     EVALUATE TRUE                                                00041254
000413*LMM WHEN CA-SELECTION-X = '2' OR 'T'                             00041354
000414*LMM WHEN CA-SELECTION-X = '1 ' OR '2' OR '3' OR '4' OR 'T'       00041454
000415                                                                  00041554
000416*LMM WHEN CA-SELECTION-X = '1'                                    00041654
000417*        PERFORM DP026-0000-GET-LOGON-INFO                        00041754
000418*        MOVE DP026-USERID                TO PC033-USER-ID        00041854
000419*LMM     MOVE DP026-OPER-UNT-ID           TO PC033-OPER-UNT-ID    00041954
000420*        MOVE DP026-LOCATION-NBR          TO PC033-OPER-UNT-ID    00042054
000421*        MOVE DP026-FCLTY-ID              TO PC033-FCLTY-ID       00042154
000422*        MOVE DP026-QUEUE-TERM            TO PC033-TERM-ID        00042254
000423*        MOVE 'PCKRF884'                  TO PC033-MENU-PROGRAM   00042354
000424                                                                  00042454
000425*LMM     PERFORM 2350-CALL-AUTOVE-MODULE                          00042554
000426                                                                  00042654
000427     WHEN CA-SELECTION-X = '2' OR '3' OR '4' OR 'T'               00042754
000428         PERFORM 2000-PROCESS-SELECTION                           00042854
000429     WHEN OTHER                                                   00042954
000430         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  00043054
000431         MOVE PC-INVALID-SELECTION-MSG                            00043154
000432                                     TO AMSGLNO                   00043254
000433         PERFORM 8100-SEND-DATA-ONLY                              00043354
000434         PERFORM 8200-RETURN-TRANID                               00043454
000435     END-EVALUATE.                                                00043554
000436*                                                                 00043654
000437*                                                                 00043754
000438 1200-HELP-SCREEN.                                                00043854
000439     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      00043954
000440     MOVE 'PCKRF884'                  TO PC192-PROGRAM-NAME       00044054
000441     COPY PCPD188.                                                00044154
000442     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      00044254
000443     PERFORM 2200-XCTL-TO-HELP.                                   00044354
000444*                                                                 00044454
000445*                                                                 00044554
000446 2000-PROCESS-SELECTION.                                          00044654
000447     SET PN-INDX                     TO CA-SELECTION.             00044754
000448     IF CA-SELECTION < 5                                          00044854
000449         PERFORM 9000-CHECK-RACF                                  00044954
000450     ELSE                                                         00045054
000451         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       00045154
000452         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    00045254
000453     END-IF.                                                      00045354
000454                                                                  00045454
000455* DMH 09/2015 - ADD WMOS CHECK                                    00045555
000456     PERFORM 2040-FIND-SYSTEM-ID.                                 00045663
000457     PERFORM 2050-FIND-LOGON-INFO.                                00045763
000458     PERFORM 2060-GET-CURR-TMST.                                  00045855
000459*    MOVE MP026-OPER-UNIT-ID         TO DK-OPER-UNT-ID.           00045955
000460     MOVE PC033-OPER-UNT-ID          TO DK-OPER-UNT-ID.           00046055
000461     PERFORM 2070-CHECK-DC-WMOS.                                  00046155
000462                                                                  00046255
000463* IF THE DC IS SET UP ON WMOS, THEN THE ONLY OPTION AVAILABLE     00046355
000464* FROM THIS SCREEN IS 4-CARTON STATUS                             00046456
000465*                                                                 00046555
000466     IF  PS-DC-ON-WMOS-NO                                         00046655
000467         CONTINUE                                                 00046755
000468     ELSE                                                         00046855
000469     IF  PS-DC-ON-WMOS-YES  AND                                   00046955
000470         CA-SELECTION = 4                                         00047056
000471         CONTINUE                                                 00047155
000472     ELSE                                                         00047255
000473         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  00047355
000474         MOVE PC-DC-IN-WMOS-MSG                                   00047455
000475                                     TO AMSGLNO                   00047555
000476         SET PS-NO-ACCESS-ALLOWED    TO TRUE                      00047655
000477     END-IF                                                       00047755
000478     END-IF.                                                      00047855
000479* DMH 09/2015 - END                                               00047955
000480                                                                  00048055
000481     IF  PS-ACCESS-ALLOWED                                        00048155
000482         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       00048255
000483         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    00048355
000484     ELSE                                                         00048455
000485         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  00048555
000486         PERFORM 8100-SEND-DATA-ONLY                              00048655
000487         PERFORM 8200-RETURN-TRANID                               00048755
000488     END-IF.                                                      00048855
000489                                                                  00048955
000490                                                                  00049055
000491* DMH 09/2015 - START                                             00049155
000492 2040-FIND-SYSTEM-ID.                                             00049263
000493                                                                  00049363
000494     EXEC CICS                                                    00049463
000495         INQUIRE                                                  00049563
000496             TRANSACTION   (PC-MENU-TRANID)                       00049663
000497             REMOTESYSTEM  (PV-SYSID)                             00049763
000498             RESP          (PV-CICS-RESPONSE)                     00049863
000499     END-EXEC.                                                    00049963
000500                                                                  00050063
000501     EVALUATE TRUE                                                00050163
000502         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 00050263
000503             CONTINUE                                             00050363
000504         WHEN OTHER                                               00050463
000505             MOVE '1200-FIND-SYSTEM-ID'                           00050563
000506                 TO DP013-PARAGRAPH                               00050663
000507             MOVE 'UNABLE TO DETERMINE SYSTEM ID'                 00050763
000508                 TO DP013-MESSAGE-TEXT (1)                        00050863
000509             SET DP013-CICS-ABEND      TO  TRUE                   00050963
000510             SET DP013-NO-ROLLBACK     TO  TRUE                   00051063
000511             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               00051163
000512             MOVE 'CICS ERR/HELP DESK '                           00051263
000513                                       TO  AMSGLNO                00051363
000514             PERFORM 8100-SEND-DATA-ONLY                          00051463
000515             PERFORM 8200-RETURN-TRANID                           00051563
000516     END-EVALUATE.                                                00051663
000517                                                                  00051763
000518 2050-FIND-LOGON-INFO.                                            00051863
000519     MOVE LENGTH OF DP026-SIGN-ON-INFO                            00051963
000520                    TO  PV-SIGN-ON-INFO-LENGTH.                   00052063
000521     MOVE EIBTRMID  TO  TS-INFO-QUEUE-TERMINAL.                   00052163
000522     MOVE +1        TO  PV-TS-ITEM.                               00052263
000523                                                                  00052363
000524     IF PV-SYSID = SPACES                                         00052463
000525         EXEC CICS                                                00052563
000526             READQ TS                                             00052663
000527                 QUEUE  (TS-INFO-QUEUE-NAME)                      00052763
000528                 ITEM   (PV-TS-ITEM)                              00052863
000529                 INTO   (DP026-SIGN-ON-INFO)                      00052963
000530                 RESP   (PV-CICS-RESPONSE)                        00053063
000531         END-EXEC                                                 00053163
000532     ELSE                                                         00053263
000533         EXEC CICS                                                00053363
000534             READQ TS                                             00053463
000535                 QUEUE   (TS-INFO-QUEUE-NAME)                     00053563
000536                 SYSID   (PV-SYSID)                               00053663
000537                 ITEM    (PV-TS-ITEM)                             00053763
000538                 INTO    (DP026-SIGN-ON-INFO)                     00053863
000539                 LENGTH  (PV-SIGN-ON-INFO-LENGTH)                 00053963
000540                 RESP    (PV-CICS-RESPONSE)                       00054063
000541         END-EXEC                                                 00054163
000542     END-IF.                                                      00054263
000543                                                                  00054363
000544     EVALUATE TRUE                                                00054463
000545         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 00054563
000546**           MOVE DP026-LOCATION-NBR  TO MP026-OPER-UNIT-ID       00054663
000547**           MOVE DP026-USERID    TO MP026-USERID                 00054763
000548             MOVE DP026-LOCATION-NBR  TO PC033-OPER-UNT-ID        00054866
000549             MOVE DP026-USERID    TO PC033-USER-ID                00054967
000550         WHEN OTHER                                               00055063
000551                                                                  00055163
000552             INITIALIZE PV-CSSL-MSG                               00055263
000553             STRING ' PCKRF850 2050-FIND-LOGON-INFO'              00055363
000554                    ' CANT READ LOGON TSQ -'                      00055463
000555                    ' PV-SYSID:'  PV-SYSID                        00055563
000556                    ' USER:'      DP026-USERID                    00055663
000557                    DELIMITED BY SIZE INTO PV-CSSL-MSG            00055763
000558                                                                  00055863
000559              MOVE LENGTH OF PV-CSSL-MSG                          00055963
000560                TO PV-CSSL-MSG-LENGTH                             00056063
000561                                                                  00056163
000562              EXEC CICS                                           00056263
000563                   WRITEQ TD                                      00056363
000564                    QUEUE  ('CSSL')                               00056463
000565                     FROM  (PV-CSSL-MSG)                          00056563
000566                   LENGTH  (PV-CSSL-MSG-LENGTH)                   00056663
000567                     RESP  (PV-CICS-RESP)                         00056763
000568              END-EXEC                                            00056863
000569                                                                  00056963
000570     END-EVALUATE.                                                00057063
000571                                                                  00057163
000572 2060-GET-CURR-TMST.                                              00057255
000573                                                                  00057355
000574         EXEC SQL                                                 00057455
000575             SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP        00057555
000576         END-EXEC.                                                00057655
000577                                                                  00057755
000578                                                                  00057855
000579 2070-CHECK-DC-WMOS.                                              00057955
000580                                                                  00058055
000581     EXEC SQL                                                     00058155
000582          SELECT   A.INTGRTN_TYP_DESC                             00058255
000583            INTO  :WST00008-INTGRTN-TYP-DESC                      00058355
000584            FROM                                                  00058455
000585                  WST_INTGRTN_TYP  A                              00058555
000586               ,  WST_ATTR_DEFN    B                              00058655
000587               ,  WST_ATTR_ELEM    C                              00058755
000588               ,  WST_ATTR_ELEM    D                              00058855
000589               ,  WST_ATTR_ELEM    E                              00058955
000590            WHERE                                                 00059055
000591                  A.INTGRTN_TYP_CDE   = 'WMOSON'                  00059155
000592              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         00059255
000593              AND B.ATTR_DEFN_SEQ_NBR = 1                         00059355
000594              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         00059455
000595              AND C.ATTR_DEFN_SEQ_NBR = 1                         00059555
000596              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         00059655
000597              AND D.ATTR_DEFN_SEQ_NBR = 2                         00059755
000598              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         00059855
000599              AND E.ATTR_DEFN_SEQ_NBR = 3                         00059955
000600              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       00060055
000601              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       00060155
000602              AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID           00060255
000603              AND E.ATTR_ELEM_TMST   <= :DK-CURRENT-TIMESTAMP     00060355
000604     END-EXEC.                                                    00060455
000605                                                                  00060555
000606     EVALUATE TRUE                                                00060655
000607         WHEN SQLCODE = ZERO                                      00060755
000608             SET PS-DC-ON-WMOS-YES      TO TRUE                   00060855
000609         WHEN OTHER                                               00060955
000610             SET PS-DC-ON-WMOS-NO       TO TRUE                   00061055
000611     END-EVALUATE.                                                00061155
000612* DMH 09/2015 - END                                               00061255
000613                                                                  00061355
000614                                                                  00061455
000615*                                                                 00061555
000616*                                                                 00061655
000617 2100-XCTL-TO-SELECTED-PROGRAM.                                   00061755
000618                                                                  00061855
000619     INITIALIZE PC033-COMMON-DATA.                                00061955
000620     SET PC033-INITIALIZE-SCREEN     TO TRUE.                     00062055
000621     MOVE PC-CURRENT-PROGRAM-NAME    TO PC033-LAST-PROGRAM.       00062155
000622     IF CA-SELECTION = 1                                          00062255
000623         MOVE 'PCKRF730'              TO PC033-ROOT-PROGRAM       00062355
000624         MOVE 'PCKRF884'              TO PC033-MENU-PROGRAM       00062455
000625     END-IF                                                       00062555
000626                                                                  00062655
000627     PERFORM DP026-0000-GET-LOGON-INFO.                           00062755
000628     MOVE DP026-USERID                TO PC033-USER-ID.           00062860
000629*LMM MOVE DP026-OPER-UNT-ID           TO PC033-OPER-UNT-ID        00062960
000630     MOVE DP026-LOCATION-NBR          TO PC033-OPER-UNT-ID        00063060
000631     MOVE DP026-FCLTY-ID              TO PC033-FCLTY-ID           00063160
000632     MOVE DP026-QUEUE-TERM            TO PC033-TERM-ID            00063260
000633     SET PC033-PROCESS-BY-UPC         TO TRUE                     00063360
000634     MOVE 'PCKRF884'                  TO PC033-MENU-PROGRAM       00063460
000635                                                                  00063560
000636                                                                  00063660
000637     MOVE LENGTH OF CA-COMMAREA-2 TO PV-COMMAREA-LENGTH           00063760
000638                                                                  00063860
000639     EXEC CICS                                                    00063960
000640         XCTL                                                     00064060
000641             PROGRAM   (PV-TRANSFER-PROGRAM)                      00064160
000642             COMMAREA  (PC033-COMMON-DATA)                        00064260
000643             LENGTH    (PV-COMMAREA-LENGTH)                       00064360
000644             RESP      (PV-CICS-RESP)                             00064460
000645     END-EXEC.                                                    00064560
000646                                                                  00064660
000647     EVALUATE TRUE                                                00064760
000648         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     00064860
000649              CONTINUE                                            00064960
000650         WHEN OTHER                                               00065060
000651              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                00065160
000652                                     TO DP013-PARAGRAPH           00065260
000653              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       00065360
000654                                     TO DP013-MESSAGE-TEXT (1)    00065460
000655              MOVE PV-TRANSFER-PROGRAM                            00065560
000656                                     TO DP013-MESSAGE-TEXT (2)    00065660
000657              SET DP013-CICS-ABEND   TO TRUE                      00065760
000658              SET DP013-NO-ROLLBACK  TO TRUE                      00065860
000659              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              00065960
000660              MOVE PC-TRANS-UNAVAILABLE-MSG                       00066060
000661                                     TO AMSGLNO                   00066160
000662              SET CA-PROCESS-SCREEN TO TRUE                       00066260
000663              PERFORM 8100-SEND-DATA-ONLY                         00066360
000664              PERFORM 8200-RETURN-TRANID                          00066460
000665     END-EVALUATE.                                                00066560
000666                                                                  00066660
000667     COPY DPPD026.                                                00066760
000668*                                                                 00066860
000669 2200-XCTL-TO-HELP.                                               00066960
000670                                                                  00067060
000671     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       00067160
000672                                                                  00067260
000673     EXEC CICS                                                    00067360
000674         XCTL                                                     00067460
000675             PROGRAM   (PV-TRANSFER-PROGRAM)                      00067560
000676             COMMAREA  (PC192-COMMAREA)                           00067660
000677             LENGTH    (PV-COMMAREA-LENGTH)                       00067760
000678             RESP      (PV-CICS-RESP)                             00067860
000679     END-EXEC.                                                    00067960
000680                                                                  00068060
000681     EVALUATE TRUE                                                00068160
000682         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     00068260
000683              CONTINUE                                            00068360
000684         WHEN OTHER                                               00068460
000685              MOVE '2200-XCTL-TO-HELP'                            00068560
000686                                     TO DP013-PARAGRAPH           00068660
000687              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       00068760
000688                                     TO DP013-MESSAGE-TEXT (1)    00068860
000689              MOVE PV-TRANSFER-PROGRAM                            00068960
000690                                     TO DP013-MESSAGE-TEXT (2)    00069060
000691              SET DP013-CICS-ABEND   TO TRUE                      00069160
000692              SET DP013-NO-ROLLBACK  TO TRUE                      00069260
000693              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              00069360
000694              MOVE PC-TRANS-UNAVAILABLE-MSG                       00069460
000695                                     TO AMSGLNO                   00069560
000696              SET CA-PROCESS-SCREEN TO TRUE                       00069660
000697              PERFORM 8100-SEND-DATA-ONLY                         00069760
000698              PERFORM 8200-RETURN-TRANID                          00069860
000699     END-EVALUATE.                                                00069960
000700*                                                                 00070060
000701*----------------------------------------------------------------*00070160
000702*    CALL TO (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)          00070260
000703*----------------------------------------------------------------*00070360
000704 2350-CALL-AUTOVE-MODULE.                                         00070460
000705                                                                  00070560
000706     INITIALIZE RC040-FIELDS.                                     00070660
000707     MOVE PC033-OPER-UNT-ID    TO RC040-SIGNON-LOCATION.          00070760
000708     MOVE PC033-USER-ID        TO RC040-USER-ID.                  00070860
000709     MOVE 'PCKRF884'           TO RC040-CALLING-PROGRAM.          00070960
000710                                                                  00071060
000711     SET RC040-DC-LEVEL        TO TRUE.                           00071160
000712                                                                  00071260
000713     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  00071360
000714                                        RC040-COMMAREA            00071460
000715                                        RC040-FIELDS.             00071560
000716     EVALUATE TRUE                                                00071660
000717         WHEN RC040-SUCCESSFUL                                    00071760
000718             IF  RC040-FACILITY-AUTOVE-YES                        00071860
000719                 MOVE PC-AUTOVE-NO-CRTN-BLD-MSG                   00071960
000720                                        TO AMSGLNO                00072060
000721                 PERFORM 8100-SEND-DATA-ONLY                      00072160
000722                 PERFORM 8200-RETURN-TRANID                       00072260
000723             ELSE                                                 00072360
000724                 PERFORM 2000-PROCESS-SELECTION                   00072460
000725             END-IF                                               00072560
000726                                                                  00072660
000727         WHEN RC040-NOT-SUCCESSFUL                                00072760
000728         WHEN RC040-INVALID-SQL                                   00072860
000729         WHEN RC040-DATABASE-BUSY                                 00072960
000730             MOVE PC033-OPER-UNT-ID      TO PV-DISP-OPER          00073060
000731             MOVE PC033-USER-ID          TO PV-DISP-USERID        00073160
000732                                                                  00073260
000733             STRING ' RCKUT127 - '           DELIMITED BY SIZE    00073360
000734               '2350-CALL-AUTOVE-MODULE '    DELIMITED BY SIZE    00073460
000735                    ' OPER UNT ID - '        DELIMITED BY SIZE    00073560
000736                    PV-DISP-OPER             DELIMITED BY SIZE    00073660
000737                    ' USERID      - '        DELIMITED BY SIZE    00073760
000738                    PV-DISP-USERID           DELIMITED BY SIZE    00073860
000739                    ' SUCCESS IND - '        DELIMITED BY SIZE    00073960
000740                    RC040-SUCCESS-IND        DELIMITED BY SIZE    00074060
000741                    ' SQLCA       - '        DELIMITED BY SIZE    00074160
000742                    RC040-SQLCA              DELIMITED BY SIZE    00074260
000743                    ' AUTOVE SW   - '        DELIMITED BY SIZE    00074360
000744                    RC040-FACILITY-AUTOVE-SW DELIMITED BY SIZE    00074460
000745                    ' CRA RET MSG - '        DELIMITED BY SIZE    00074560
000746                    RC040-CRA-RET-MSG        DELIMITED BY SIZE    00074660
000747                    ' CRA REQ ID  - '        DELIMITED BY SIZE    00074760
000748                    RC040-CRA-REQ-ID         DELIMITED BY SIZE    00074860
000749                                INTO PV-CICS-MESSAGE-AREA         00074960
000750             PERFORM 9900-WRITE-CICS-LOG                          00075060
000751                                                                  00075160
000752             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               00075260
000753                                                                  00075360
000754         WHEN OTHER                                               00075460
000755             STRING ' RCKUT127         -'    DELIMITED BY SIZE    00075560
000756               '2350-CALL-AUTOVE-MODULE '    DELIMITED BY SIZE    00075660
000757                    ' OPER UNT ID - '        DELIMITED BY SIZE    00075760
000758                    PV-DISP-OPER             DELIMITED BY SIZE    00075860
000759                    ' USERID      - '        DELIMITED BY SIZE    00075960
000760                    PV-DISP-USERID           DELIMITED BY SIZE    00076060
000761                    ' SUCCESS IND - '        DELIMITED BY SIZE    00076160
000762                    RC040-SUCCESS-IND        DELIMITED BY SIZE    00076260
000763                    ' SQLCA       - '        DELIMITED BY SIZE    00076360
000764                    RC040-SQLCA              DELIMITED BY SIZE    00076460
000765                    ' AUTOVE SW   - '        DELIMITED BY SIZE    00076560
000766                    RC040-FACILITY-AUTOVE-SW DELIMITED BY SIZE    00076660
000767                    ' CRA RET MSG - '        DELIMITED BY SIZE    00076760
000768                    RC040-CRA-RET-MSG        DELIMITED BY SIZE    00076860
000769                    ' CRA REQ ID  - '        DELIMITED BY SIZE    00076960
000770                    RC040-CRA-REQ-ID         DELIMITED BY SIZE    00077060
000771                                    INTO PV-CICS-MESSAGE-AREA     00077160
000772                 PERFORM 9900-WRITE-CICS-LOG                      00077260
000773                                                                  00077360
000774                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           00077460
000775                                                                  00077560
000776             MOVE '2350-CALL-AUTOVE-MODULE '                      00077660
000777                              TO DP013-PARAGRAPH                  00077760
000778             MOVE 'CALL TO RCKUT127               '               00077860
000779                              TO DP013-MESSAGE-TEXT(1)            00077960
000780             STRING 'MSG - '            DELIMITED BY SIZE         00078060
000781                     RC040-CRA-RET-MSG   DELIMITED BY SIZE        00078160
000782                              INTO DP013-MESSAGE-TEXT (2)         00078260
000783             MOVE 'CHECK CSSL FOR MORE DETAIL     '               00078360
000784                                TO DP013-MESSAGE-TEXT (3)         00078460
000785             MOVE PC033-OPER-UNT-ID  TO PV-DISP-OPER              00078560
000786             MOVE PC033-USER-ID      TO PV-DISP-USERID            00078660
000787                                                                  00078760
000788             STRING  ' OPER   - '         DELIMITED BY SIZE       00078860
000789                     PV-DISP-OPER         DELIMITED BY SIZE       00078960
000790                     ' USERID - '         DELIMITED BY SIZE       00079060
000791                     PV-DISP-USERID       DELIMITED BY SIZE       00079160
000792                              INTO DP013-MESSAGE-TEXT (4)         00079260
000793             MOVE RC040-SQLCA    TO DP013-SQLCA                   00079360
000794             SET DP013-DB2-ABEND                                  00079460
000795                              TO TRUE                             00079560
000796             SET DP013-ROLLBACK                                   00079660
000797                              TO TRUE                             00079760
000798             SET DP013-XCTL-DISPLAY-RESTART                       00079860
000799                              TO TRUE                             00079960
000800             PERFORM DP014-0000-PROCESS-ABEND                     00080060
000801                                                                  00080160
000802     END-EVALUATE.                                                00080260
000803/                                                                 00080360
000804*                                                                 00080460
000805 8000-SEND-MAP.                                                   00080560
000806     EXEC CICS                                                    00080660
000807         SEND MAP       ('PC884A')                                00080760
000808              MAPSET    ('PCKM884')                               00080860
000809              ERASE                                               00080960
000810              RESP      (PV-CICS-RESP)                            00081060
000811     END-EXEC.                                                    00081160
000812                                                                  00081260
000813     EVALUATE TRUE                                                00081360
000814         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     00081460
000815              CONTINUE                                            00081560
000816         WHEN OTHER                                               00081660
000817              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           00081760
000818              MOVE 'UNABLE TO SEND MAP'                           00081860
000819                                     TO DP013-MESSAGE-TEXT (1)    00081960
000820              SET DP013-CICS-ABEND   TO TRUE                      00082060
000821              SET DP013-NO-ROLLBACK  TO TRUE                      00082160
000822              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              00082260
000823     END-EVALUATE.                                                00082360
000824*                                                                 00082460
000825*                                                                 00082560
000826 8100-SEND-DATA-ONLY.                                             00082660
000827     MOVE -1 TO ASELECTL.                                         00082760
000828                                                                  00082860
000829     EXEC CICS                                                    00082960
000830         SEND MAP       ('PC884A')                                00083060
000831              MAPSET    ('PCKM884')                               00083160
000832              CURSOR                                              00083260
000833              DATAONLY                                            00083360
000834              RESP      (PV-CICS-RESP)                            00083460
000835     END-EXEC.                                                    00083560
000836                                                                  00083660
000837     EVALUATE TRUE                                                00083760
000838         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     00083860
000839              CONTINUE                                            00083960
000840         WHEN OTHER                                               00084060
000841              MOVE '8100-SEND-DATA-ONLY'                          00084160
000842                                     TO DP013-PARAGRAPH           00084260
000843              MOVE 'UNABLE TO SEND DATA'                          00084360
000844                                     TO DP013-MESSAGE-TEXT (1)    00084460
000845              SET DP013-CICS-ABEND   TO TRUE                      00084560
000846              SET DP013-NO-ROLLBACK  TO TRUE                      00084660
000847              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              00084760
000848     END-EVALUATE.                                                00084860
000849*                                                                 00084960
000850*                                                                 00085060
000851 8200-RETURN-TRANID.                                              00085160
000852     MOVE LENGTH OF CA-COMMAREA-2     TO PV-COMMAREA-LENGTH       00085260
000853     EXEC CICS                                                    00085360
000854         RETURN TRANSID   (PC-MENU-TRANID)                        00085460
000855                COMMAREA  (CA-COMMAREA)                           00085560
000856                LENGTH    (PV-COMMAREA-LENGTH)                    00085660
000857                RESP      (PV-CICS-RESP)                          00085760
000858     END-EXEC.                                                    00085860
000859                                                                  00085960
000860     EVALUATE TRUE                                                00086060
000861         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     00086160
000862              CONTINUE                                            00086260
000863         WHEN OTHER                                               00086360
000864              MOVE '8200-RETURN-TRANID'                           00086460
000865                                     TO DP013-PARAGRAPH           00086560
000866              MOVE 'UNABLE TO RETURN TO TRANID'                   00086660
000867                                     TO DP013-MESSAGE-TEXT (1)    00086760
000868              SET DP013-CICS-ABEND   TO TRUE                      00086860
000869              SET DP013-NO-ROLLBACK  TO TRUE                      00086960
000870              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              00087060
000871     END-EVALUATE.                                                00087160
000872*                                                                 00087260
000873*                                                                 00087360
000874 8300-LOGOFF-TO-VTAM-SCREEN.                                      00087460
000875     EXEC CICS                                                    00087560
000876         START TRANSID  ('Z011')                                  00087660
000877               TERMID   (EIBTRMID)                                00087760
000878               NOHANDLE                                           00087860
000879     END-EXEC.                                                    00087960
000880*                                                                 00088060
000881*                                                                 00088160
000882 9000-CHECK-RACF.                                                 00088260
000883******************************************************************00088360
000884*  CHECK ACCESS AUTHORITY OF USER                                 00088460
000885******************************************************************00088560
000886     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     00088660
000887     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     00088760
000888                                                                  00088860
000889     EVALUATE TRUE                                                00088960
000890         WHEN CA-SELECTION-ONE                                    00089060
000891              MOVE PC-CHECK-AUTH-FOR-TRAN-E730                    00089160
000892                                      TO DP008-RESOURCE-NAME      00089260
000893         WHEN CA-SELECTION-TWO                                    00089360
000894              MOVE PC-CHECK-AUTH-FOR-TRAN-E864                    00089460
000895                                      TO DP008-RESOURCE-NAME      00089560
000896         WHEN CA-SELECTION-THREE                                  00089660
000897              MOVE PC-CHECK-AUTH-FOR-TRAN-E861                    00089760
000898                                      TO DP008-RESOURCE-NAME      00089860
000899         WHEN CA-SELECTION-FOUR                                   00089960
000900              MOVE PC-CHECK-AUTH-FOR-TRAN-E880                    00090060
000901                                      TO DP008-RESOURCE-NAME      00090160
000902     END-EVALUATE.                                                00090260
000903                                                                  00090360
000904     EXEC CICS                                                    00090460
000905          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               00090560
000906               COMMAREA (DP008-SECURITY-COMMAREA)                 00090660
000907               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          00090760
000908               RESP     (PV-CICS-RESP)                            00090860
000909     END-EXEC.                                                    00090960
000910                                                                  00091060
000911     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           00091160
000912         IF  DP008-CALL-SUCCESSFUL                                00091260
000913             IF  DP008-ACCESS-ALLOWED                             00091360
000914                 SET PS-ACCESS-ALLOWED                            00091460
000915                                     TO TRUE                      00091560
000916             ELSE                                                 00091660
000917                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   00091760
000918                                     TO AMSGLNO                   00091860
000919             END-IF                                               00091960
000920         ELSE                                                     00092060
000921             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   00092160
000922         END-IF                                                   00092260
000923     ELSE                                                         00092360
000924         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           00092460
000925         MOVE 'BAD LINK TO RACF PROGRAM'                          00092560
000926                                     TO DP013-MESSAGE-TEXT (1)    00092660
000927         SET DP013-CICS-ABEND        TO TRUE                      00092760
000928         SET DP013-NO-ROLLBACK       TO TRUE                      00092860
000929         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   00092960
000930     END-IF.                                                      00093060
000931*                                                                 00093160
000932*                                                                 00093260
000933 9900-WRITE-CICS-LOG.                                             00093360
000934                                                                  00093460
000935     MOVE LENGTH OF PV-CICS-MESSAGE-AREA                          00093560
000936          TO PV-COMMAREA-LENGTH                                   00093660
000937                                                                  00093760
000938     EXEC CICS                                                    00093860
000939         WRITEQ TD                                                00093960
000940             QUEUE  ('CSSL')                                      00094060
000941             FROM   (PV-CICS-MESSAGE-AREA)                        00094160
000942             LENGTH (PV-COMMAREA-LENGTH)                          00094260
000943             RESP   (PV-CICS-RESP)                                00094360
000944     END-EXEC.                                                    00094460
000945                                                                  00094560
000946     MOVE SPACES TO PV-CICS-MESSAGE-AREA.                         00094660
000947                                                                  00094760
000948*                                                                 00094860
000949 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  00094960
000950     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            00095060
000951     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           00095160
000952     INITIALIZE DP013-SRC-TASK-NUMBER                             00095260
000953                DP013-STACK.                                      00095360
000954     SET DP013-LINK-RETURN           TO TRUE.                     00095460
000955                                                                  00095560
000956     EXEC CICS                                                    00095660
000957         LINK                                                     00095760
000958             PROGRAM   (DP013-NAME)                               00095860
000959             COMMAREA  (DP013-PARAMETERS)                         00095960
000960             LENGTH    (DP013-LENGTH)                             00096060
000961     END-EXEC.                                                    00096160
000962                                                                  00096260
000963*----------------------------------------------------------------*00096360
000964*    ABEND PROCESSOR MODULE                                      *00096460
000965*----------------------------------------------------------------*00096560
000970                                                                  00097060
001000     COPY DPPD014.                                                00100060
