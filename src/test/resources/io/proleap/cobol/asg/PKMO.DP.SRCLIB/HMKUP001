      * ------------------------------------------------------------- * 00010000
       IDENTIFICATION DIVISION.                                         00020000
      * ------------------------------------------------------------- * 00030000
       PROGRAM-ID.      HMKUP001.                                       00040000
       AUTHOR.          PAUL KEBER.                                     00050000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
       DATE-WRITTEN.    02-13-2001.                                     00070000
                                                                        00080000
      ***************************************************************** 00090000
      *  HMKUP001 - UPDATE MBS DB2 DATABASES FROM RMS MERCHANDISE     * 00100000
      *             HIERARCHY TABLES.                                 * 00110000
      ***************************************************************** 00120000
      *  THIS PROGRAM "GETS" MESSAGES OFF THE MQ SERIES DATA QUEUE FOR  00130000
      *  RMS MERCHANDISE HIERARCHY UPDATES AND USES IT TO UPDATE THE    00140000
      *  APPROPRIATE MBS DB2 TABLES.  A COMMIT WILL OCCUR AFTER         00150000
      *  PROCESSING EACH MESSAGE FROM THE QUEUE.                        00160000
      ***************************************************************** 00170000
      *    WR/PITS#     DATE        DESCRIPTION                       * 00180000
      *    --------   --------   -----------------------------------  * 00190000
      *    99999      04/30/01   P. KEBER - CHANGED INPUT | TO !      * 00200000
      *    99999      05/02/01   P. KEBER - CHANGED INPUT | TO ' '    * 00210000
      *                                     CHANGED INPUT _ TO ' '    * 00220000
      *    99999      05/07/01   P. KEBER - REMOVED LOGIC TO DELETE   * 00230000
      *                          TMDSEDP AND TMDSECL ROWS.            * 00240000
      *    23223      01/10/02   B. MCASEY  REMOVED LOGIC TO UPDATE   * 00250000
      *                          INV-OH-VAR-PCT/QTY COLUMNS.  THE     * 00260000
      *                          PROGRAM WILL ONLY MOVE IN A NULL     * 00270000
      *                          VALUE IN ON INSERTS.                 * 00280000
      *    25297      06/23/03   B. MCASEY  ADDED LOGIC TO REACTIVATE * 00290000
      *                          AN END DATED SUBCLASS AND ADDED A NEW* 00300000
      *                          CALL TO A NEW SUBROUTINE TO END-DATE * 00310000
      *                          SUBCLASSES INSTEAD OF CREATING A VSAM* 00320000
      *                          RECORD.                              * 00330000
      *   WR24988     07/09/2003 ADDED THE MQ WAIT TIME TO THE GET.   * 00340000
      *                          THIS PREVENTS MESSAGES FROM BEING    * 00350000
      *                          LEFT IN THE QUEUE.                   * 00360000
0816PK*   WR30627     08/16/2006 P. KEBER  PROCESS K_EMT_PRVT_BRND_   * 00370000
0816PK*                          COST_FCTR DATABASE MESSAGES.         * 00380000
0823PK*   WR30627     08/23/2006 P. KEBER  CORRECT ERROR IN THE 7162- * 00390000
0823PK*                          ROUTINE.                             * 00400000
0307PK*   WR31557     03/06/2007 P. KEBER  MAINTAIN BUS_GP_SHRT_DESC  * 00410000
0307PK*                          ON THE TMDSEBG TABLE. CREATE A NEW   * 00420000
0307PK*                          BUS_GP_SHRT_DESC UPDATES OUTPUT FILE.* 00430000
C14666*CRQ000000014666                                                  00440000
C14666*               07/10/2012 BRUCE GRAHAM / KFORCE                  00450005
C14666*                      INSERT TWO ROWS FOR THE TDPTSHK TABLE. ONE 00460000
C14666*                      FOR BRICK AND MORTAR AND ONE FOR E-COMM.   00470000
C14666*                      EACH CHANNEL NEEDS A SEPERATE ROW.         00480000
C14666*                      ALSO ADDED ADDITIONAL ATTRIBUTES BECAUSE   00490000
C14666*                      THE TABLE IS BEING EXPANDED.              *00500000
C14666*                      ALSO CHANGED DAFDAF REFERENCES TO TMDSEBG *00510004
C14666*                      BECAUSE DBA CHANGED NAMES IN THE DCLGEN.   00520004
HMISUE*   PRB0047687  05/22/2014 COGNIZANT                              00530009
HMISUE*                          MOVED LOW VALUES TO THE VARIABLE       00540009
HMISUE*                          PV-NEW-BUYER-NUMBER WHEN THERE IS      00550009
HMISUE*                          A CHANGE AT DIVISION(DMA) LEVEL        00560009
HMISUE*                          NOT AT BUYER LEVEL.                    00570009
RMSRET*   CHG0150794  09/02/2016 COGNIZANT                              00580013
RMSRET*                          REMOVED THE LOGIC WRITTING ERROR       00590011
RMSRET*                          RECORDS TO OUTPUT ERROR FILE FOR       00600011
RMSRET*                          DUPLICATE INSERTS IN DIVISION,GROUPS   00610011
RMSRET*                          DEPS,CLASS TABLES. CHANGE TAG - RMSRET 00620011
219606*   CHG0219606  03/08/2019 DELETED PARA. 8300-PUT-MSG-ON-DLQ      00630019
219606*                          TO PREVENT MESSAGES FROM BEING         00640019
219606*                          WRITTEN TO THE DEAD LETTER QUEUE.      00650019
219606*                          ALSO, DELETED CALLS IN PARAGRAPH       00660019
219606*                          1500-MQ-SETUP TO OPEN QUEUE MANAGER    00670019
219606*                          AND GET QUEUE NAME FOR DEAD LETTER     00680019
219606*                          QUEUE.                                 00690019
      ***************************************************************** 00700011
      *---------------------------------------------------------------* 00710011
       ENVIRONMENT DIVISION.                                            00720000
      * ------------------------------------------------------------- * 00730000
                                                                        00740000
       CONFIGURATION SECTION.                                           00750000
                                                                        00760000
       SOURCE-COMPUTER.       IBM-3090.                                 00770000
       OBJECT-COMPUTER.       IBM-3090.                                 00780000
                                                                        00790000
       INPUT-OUTPUT SECTION.                                            00800000
                                                                        00810000
       FILE-CONTROL.                                                    00820000
           SELECT CONTROL-CARD-1   ASSIGN TO INP01.                     00830000
           SELECT CONTROL-CARD-2   ASSIGN TO INP02.                     00840000
           SELECT BATCH-CONTROL-FILE                                    00850000
               ORGANIZATION IS INDEXED                                  00860000
               RECORD KEY IS BCR-KEY                                    00870000
               FILE STATUS IS PV-VSAM-STATUS                            00880000
               ACCESS IS RANDOM                                         00890000
                                   ASSIGN TO INP03.                     00900000
           SELECT ERROR-FILE       ASSIGN OUT01.                        00910000
           SELECT BACKUP-FILE      ASSIGN OUT02.                        00920000
           SELECT BUSGP-UPDTS-FILE ASSIGN OUT03.                        00930000
                                                                        00940000
                                                                        00950000
                                                                        00960000
      * ------------------------------------------------------------- * 00970000
       DATA DIVISION.                                                   00980000
      * ------------------------------------------------------------- * 00990000
       FILE SECTION.                                                    01000000
                                                                        01010000
       FD  CONTROL-CARD-1                                               01020000
           RECORDING MODE F                                             01030000
           BLOCK CONTAINS 0 RECORDS                                     01040000
           LABEL RECORDS ARE OMITTED.                                   01050000
       01  CONTROL-CARD-1-LINE           PIC  X(80).                    01060000
                                                                        01070000
       FD  CONTROL-CARD-2                                               01080000
           RECORDING MODE F                                             01090000
           BLOCK CONTAINS 0 RECORDS                                     01100000
           LABEL RECORDS ARE OMITTED.                                   01110000
       01  CONTROL-CARD-2-LINE           PIC  X(80).                    01120000
                                                                        01130000
       FD  BATCH-CONTROL-FILE.                                          01140000
       01  BATCH-CONTROL-RECORD.                                        01150000
           05  BCR-KEY                   PIC X(30).                     01160000
           05  BCR-DATA                  PIC X(70).                     01170000
                                                                        01180000
       FD  ERROR-FILE                                                   01190000
           RECORDING MODE F                                             01200000
           LABEL RECORDS OMITTED                                        01210000
           BLOCK CONTAINS  0 RECORDS.                                   01220000
       01  ERROR-RECORD                  PIC X(500).                    01230000
                                                                        01240000
       FD  BACKUP-FILE                                                  01250000
           RECORDING MODE F                                             01260000
           LABEL RECORDS OMITTED                                        01270000
           BLOCK CONTAINS  0 RECORDS.                                   01280000
       01  BACKUP-RECORD                 PIC X(500).                    01290000
                                                                        01300000
       FD  BUSGP-UPDTS-FILE                                             01310000
           RECORDING MODE F                                             01320000
           LABEL RECORDS OMITTED                                        01330000
           BLOCK CONTAINS  0 RECORDS.                                   01340000
       01  BUSGP-UPDTS-RECORD            PIC X(32).                     01350000
                                                                        01360000
      * ------------------------------------------------------------- * 01370000
       WORKING-STORAGE SECTION.                                         01380000
      * ------------------------------------------------------------- * 01390000
                                                                        01400000
       01  WS-MQCONN                 PIC X(8)  VALUE 'CSQBCONN'.        01410000
       01  WS-MQOPEN                 PIC X(8)  VALUE 'CSQBOPEN'.        01420000
       01  WS-MQINQ                  PIC X(8)  VALUE 'CSQBINQ'.         01430000
       01  WS-MQGET                  PIC X(8)  VALUE 'CSQBGET'.         01440000
       01  WS-MQPUT1                 PIC X(8)  VALUE 'CSQBPUT1'.        01450000
       01  WS-MQBACK                 PIC X(8)  VALUE 'CSQBBACK'.        01460000
       01  WS-MQCMIT                 PIC X(8)  VALUE 'CSQBCOMM'.        01470000
       01  WS-MQCLOSE                PIC X(8)  VALUE 'CSQBCLOS'.        01480000
       01  WS-MQDISC                 PIC X(8)  VALUE 'CSQBDISC'.        01490000
       01  WS-GET-MORE-STORES-RETRY  PIC X(1)  VALUE 'N'.               01500000
                                                                        01510000
      *    API CONTROL BLOCKS                                           01520000
                                                                        01530000
       01  MQM-OBJECT-DESCRIPTOR.                                       01540000
           COPY CMQODV.                                                 01550000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01560000
           COPY CMQMDV.                                                 01570000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01580000
           COPY CMQGMOV.                                                01590000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01600000
           COPY CMQPMOV.                                                01610000
                                                                        01620000
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01630000
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01640000
                                                                        01650000
       01  MQM-CONSTANTS.                                               01660000
           COPY CMQV.                                                   01670000
      *                                                                 01680000
      *----------------------------------------------------------------*01690000
      *    CONTROL CARD                                                 01700000
      *----------------------------------------------------------------*01710000
       01  CC-CONTROL-CARD-1.                                           01720000
           05  CC-QMGR-NAME              PIC X(48).                     01730000
           05  FILLER                    PIC X(32).                     01740000
                                                                        01750000
       01  CC-CONTROL-CARD-2.                                           01760000
           05  CC-MERCH-HIER-QNAME       PIC X(48).                     01770000
           05  FILLER                    PIC X(32).                     01780000
                                                                        01790000
      *----------------------------------------------------------------*01800000
      *    PROGRAM ACCUMULATORS                                         01810000
      *----------------------------------------------------------------*01820000
       01  PA-PROGRAM-ACCUMULATORS.                                     01830000
           05  PA-LINE-COUNT             PIC 9(03)    COMP-3 VALUE 0.   01840000
           05  PA-LINE-NO                PIC 9(03)    COMP-3 VALUE 0.   01850000
           05  PA-PAGE-COUNT             PIC 9(05)    COMP-3 VALUE 0.   01860000
           05  PA-NUMPUTS                PIC S9(07) BINARY VALUE 0.     01870000
           05  PA-MQGET                  PIC 9(07) VALUE 0.             01880000
           05  PA-ERRORS                 PIC 9(07) VALUE 0.             01890000
RMSRET     05  PA-SKIPPED-ERRORS         PIC 9(07) VALUE 0.             01900011
           05  PA-SUBCL-ATTR-MSGS        PIC 9(07) VALUE 0.             01910000
           05  PA-SUBCL-ATTR-INSERTS     PIC 9(07) VALUE 0.             01920000
           05  PA-SUBCL-ATTR-UPDATES     PIC 9(07) VALUE 0.             01930000
           05  PA-CODE-DETAIL-MSGS       PIC 9(07) VALUE 0.             01940000
           05  PA-CODE-DETAIL-INSERTS    PIC 9(07) VALUE 0.             01950000
           05  PA-CODE-DETAIL-UPDATES    PIC 9(07) VALUE 0.             01960000
           05  PA-CODE-DETAIL-DELETES    PIC 9(07) VALUE 0.             01970000
           05  PA-BUS-GROUP-MSGS         PIC 9(07) VALUE 0.             01980000
           05  PA-BUS-GROUP-INSERTS      PIC 9(07) VALUE 0.             01990000
           05  PA-BUS-GROUP-UPDATES      PIC 9(07) VALUE 0.             02000000
           05  PA-BUS-GRP-SHRT-DESC-UPDTS                               02010000
                                         PIC 9(07) VALUE 0.             02020000
           05  PA-BUS-GROUP-DELETES      PIC 9(07) VALUE 0.             02030000
           05  PA-DEPS-ATTRS-MSGS        PIC 9(07) VALUE 0.             02040000
           05  PA-DEPS-ATTRS-INSERTS     PIC 9(07) VALUE 0.             02050000
           05  PA-DEPS-ATTRS-UPDATES-1   PIC 9(07) VALUE 0.             02060000
           05  PA-DEPS-ATTRS-UPDATES-2   PIC 9(07) VALUE 0.             02070000
           05  PA-DEPS-MDSEDP-UPDATES    PIC 9(07) VALUE 0.             02080000
           05  PA-DIVISION-MSGS          PIC 9(07) VALUE 0.             02090000
           05  PA-DIVISION-INSERTS       PIC 9(07) VALUE 0.             02100000
           05  PA-DIVISION-UPDATES       PIC 9(07) VALUE 0.             02110000
           05  PA-DIVISION-BTCH-DELETES  PIC 9(07) VALUE 0.             02120000
           05  PA-GROUPS-MSGS            PIC 9(07) VALUE 0.             02130000
           05  PA-GROUPS-INSERTS         PIC 9(07) VALUE 0.             02140000
           05  PA-GROUPS-UPDATES         PIC 9(07) VALUE 0.             02150000
           05  PA-GROUPS-BATCH-UPDATES   PIC 9(07) VALUE 0.             02160000
           05  PA-GROUPS-BATCH-DELETES   PIC 9(07) VALUE 0.             02170000
           05  PA-DEPS-MSGS              PIC 9(07) VALUE 0.             02180000
           05  PA-DEPS-INSERTS           PIC 9(07) VALUE 0.             02190000
           05  PA-DEPS-TDPTSHK-INSERTS   PIC 9(07) VALUE 0.             02200000
           05  PA-DEPS-UPDATES           PIC 9(07) VALUE 0.             02210000
           05  PA-DEPS-BTCH-DMA-UPDATES  PIC 9(07) VALUE 0.             02220000
           05  PA-DEPS-BTCH-BYR-UPDATES  PIC 9(07) VALUE 0.             02230000
           05  PA-DEPS-BATCH-DELETES     PIC 9(07) VALUE 0.             02240000
           05  PA-CLASS-MSGS             PIC 9(07) VALUE 0.             02250000
           05  PA-CLASS-INSERTS          PIC 9(07) VALUE 0.             02260000
           05  PA-CLASS-UPDATES          PIC 9(07) VALUE 0.             02270000
           05  PA-CLASS-BATCH-DELETES    PIC 9(07) VALUE 0.             02280000
           05  PA-CLASS-ATTR-MSGS        PIC 9(07) VALUE 0.             02290000
           05  PA-CLASS-ATTR-UPDATES     PIC 9(07) VALUE 0.             02300000
           05  PA-SUBCLASS-MSGS          PIC 9(07) VALUE 0.             02310000
           05  PA-SUBCLASS-INSERTS       PIC 9(07) VALUE 0.             02320000
           05  PA-SUBCLASS-UPDATES       PIC 9(07) VALUE 0.             02330000
           05  PA-SUBCLASS-BATCH-DELETES PIC 9(07) VALUE 0.             02340000
           05  PA-TRSPBAR-INSERTS        PIC 9(07) VALUE 0.             02350000
0816PK     05  PA-PRVT-BRND-MSGS         PIC 9(07) VALUE 0.             02360000
0816PK     05  PA-PRVT-BRND-INSERTS      PIC 9(07) VALUE 0.             02370000
0816PK     05  PA-PRVT-BRND-UPDATES      PIC 9(07) VALUE 0.             02380000
0816PK     05  PA-PRVT-BRND-DELETES      PIC 9(07) VALUE 0.             02390000
                                                                        02400000
      *----------------------------------------------------------------*02410000
      *    PROGRAM CONSTANTS                                            02420000
      *----------------------------------------------------------------*02430000
       01  PC-PROGRAM-CONSTANTS.                                        02440000
           05  PC-PGM-NAME               PIC X(09) VALUE 'HMKUP001 '.   02450000
           05  PC-F2                     PIC X(02) VALUE 'F2'.          02460000
           05  PC-OPER-CO                PIC X(02) VALUE '03'.          02470000
           05  PC-BYR                    PIC X(03) VALUE 'BYR'.         02480000
           05  PC-DMM                    PIC X(03) VALUE 'DMM'.         02490000
           05  PC-GMM                    PIC X(03) VALUE 'GMM'.         02500000
           05  PC-DEFAULT-DATE           PIC X(10) VALUE '9999-09-09'.  02510000
           05  PC-DEFAULT-INSERT-CHKDATE PIC X(08) VALUE '99990909'.    02520000
           05  PC-DEFAULT-BYR-UID        PIC X(08) VALUE 'TKBYR00 '.    02530000
           05  PC-DEFAULT-DMM-UID        PIC X(08) VALUE 'TKDMM00 '.    02540000
           05  PC-DEFAULT-GMM-UID        PIC X(08) VALUE 'TKGMM00 '.    02550000
           05  PC-CLASS-TABLE            PIC X(30) VALUE                02560000
              'CLASS                         '.                         02570000
           05  PC-CODE-DETAIL-TABLE      PIC X(30) VALUE                02580000
              'CODE_DETAIL                   '.                         02590000
           05  PC-DEPS-TABLE             PIC X(30) VALUE                02600000
              'DEPS                          '.                         02610000
           05  PC-DIVISION-TABLE         PIC X(30) VALUE                02620000
              'DIVISION                      '.                         02630000
           05  PC-GROUPS-TABLE           PIC X(30) VALUE                02640000
              'GROUPS                        '.                         02650000
           05  PC-K-EMT-BUS-GROUP-TABLE  PIC X(30) VALUE                02660000
              'K_EMT_BUSINESS_GROUP          '.                         02670000
           05  PC-K-EMT-CLS-ATTRS-TABLE  PIC X(30) VALUE                02680000
              'K_EMT_CLASS_ATTRIBUTES        '.                         02690000
           05  PC-K-EMT-DEPS-ATTRS-TABLE PIC X(30) VALUE                02700000
              'K_EMT_DEPS_ATTRIBUTES         '.                         02710000
0816PK     05  PC-K-EMT-PRVT-BRND-TABLE  PIC X(30) VALUE                02720000
0816PK        'K_EMT_PRVT_BRND_COST_FCTR     '.                         02730000
           05  PC-K-EMT-SCL-ATTRS-TABLE  PIC X(30) VALUE                02740000
              'K_EMT_SUBCLASS_ATTRIBUTES     '.                         02750000
           05  PC-SUBCLASS-TABLE         PIC X(30) VALUE                02760000
              'SUBCLASS                      '.                         02770000
           05  PC-CORP-LEVEL-CD          PIC X(03)  VALUE 'CO '.        02780000
           05  PC-GMA-LEVEL-CD           PIC X(03)  VALUE 'GMA'.        02790000
           05  PC-DMA-LEVEL-CD           PIC X(03)  VALUE 'DMA'.        02800000
           05  PC-DPT-LEVEL-CD           PIC X(03)  VALUE 'DPT'.        02810000
           05  PC-MCL-LEVEL-CD           PIC X(03)  VALUE 'MCL'.        02820000
           05  PC-SCL-LEVEL-CD           PIC X(03)  VALUE 'SCL'.        02830000
           05  PC-FIFTY-STARS            PIC X(50)  VALUE ALL '*'.      02840000
           05  PC-ONE                    PIC 9(01)  VALUE 1.            02850000
           05  PC-999                    PIC 9(03)  VALUE 999.          02860000
           05  PC-ZERO-CHAR              PIC X(01)  VALUE ZERO.         02870000
           05  PC-MAX-RETRIES            PIC 9(04)  VALUE 3 COMP.       02880000
0603RM*    05  PC-ROW-ALREADY-EXISTS     PIC S9(04) VALUE -1.           02890000
0603RM     05  PC-ROW-ALREADY-EXISTS     PIC S9(04) VALUE -803.         02900000
           05  PC-ROW-NOT-FOUND          PIC S9(04) VALUE +100.         02910000
           05  PC-DEADLOCK               PIC S9(04) VALUE -913.         02920000
           05  PC-UNAVAILABLE-RESOURCES  PIC S9(04) VALUE -904.         02930000
0603RM     05  PC-HMKUP002-PGM           PIC X(08)  VALUE 'HMKUP002'.   02940000
C14666     05  PC-SYSTEM                 PIC X(08)  VALUE 'SYSTEM  '.   02950000
C14666     05  PC-N                      PIC X(01)  VALUE 'N'.          02960001
C14666     05  PC-Y                      PIC X(01)  VALUE 'Y'.          02970001
                                                                        02980000
      *----------------------------------------------------------------*02990000
      *    PROGRAM SWITCHES                                             03000000
      *----------------------------------------------------------------*03010000
       01  PS-PROGRAM-SWITCHES.                                         03020000
           05  PS-CONTROL-CARD-1-SW      PIC X(01) VALUE 'N'.           03030000
               88  PS-CONTROL-CARD-1-END           VALUE 'Y'.           03040000
               88  PS-CONTROL-CARD-1-START         VALUE 'N'.           03050000
           05  PS-CONTROL-CARD-2-SW      PIC X(01) VALUE 'N'.           03060000
               88  PS-CONTROL-CARD-2-END           VALUE 'Y'.           03070000
               88  PS-CONTROL-CARD-2-START         VALUE 'N'.           03080000
           05  PS-TMDSEAR-DELETE-OK-SW   PIC X(01) VALUE 'N'.           03090000
               88  PS-TMDSEAR-DELETE-OK            VALUE 'Y'.           03100000
               88  PS-TMDSEAR-DELETE-NOT-OK        VALUE 'N'.           03110000
           05  PS-MQGET-SUCCESSFUL-SW    PIC X(01) VALUE 'N'.           03120000
               88  PS-MQGET-SUCCESSFUL             VALUE 'Y'.           03130000
           05  PS-STOP-REC-PROC-IND      PIC X(01) VALUE 'N'.           03140000
               88  PS-DONT-STOP-REC-PROCESS        VALUE 'N'.           03150000
               88  PS-STOP-REC-PROCESSING          VALUE 'Y'.           03160000
           05  PS-NO-RECORD-FOUND-IND    PIC X(01) VALUE 'N'.           03170000
               88  PS-NO-RECORD-FOUND              VALUE 'Y'.           03180000
           05  PS-TMDSECL-FOUND-SW       PIC X(01) VALUE 'N'.           03190000
               88  PS-TMDSECL-NOT-FOUND            VALUE 'Y'.           03200000
           05  PS-INPUT-REC-ERR-SW       PIC X(01) VALUE 'N'.           03210000
               88  PS-INPUT-REC-ERROR              VALUE 'Y'.           03220000
               88  PS-NO-INPUT-REC-ERROR           VALUE 'N'.           03230000
           05  PS-ROW-FOUND-SW           PIC X(01) VALUE 'Y'.           03240000
               88  PS-ROW-FOUND                    VALUE 'Y'.           03250000
               88  PS-ROW-NOT-FOUND                VALUE 'N'.           03260000
                                                                        03270000
      *----------------------------------------------------------------*03280000
      *    PROGRAM VARIABLES                                            03290000
      *----------------------------------------------------------------*03300000
       01  PV-PROGRAM-VARIABLES.                                        03310000
           05  PV-MSGLENGTH             PIC S9(9) BINARY VALUE +500.    03320000
           05  PV-DATA-LENGTH           PIC S9(9) BINARY.               03330000
           05  PV-SELECT-COUNT          PIC S9(9) BINARY VALUE 1.       03340000
           05  PV-SELECTOR-TABLE.                                       03350000
               10  PV-SELECTOR          PIC S9(9) BINARY OCCURS 1 TIMES.03360000
           05  PV-INT-ATTR-COUNT        PIC S9(9) BINARY VALUE 0.       03370000
           05  PV-INT-ATTR-TABLE.                                       03380000
               10  PV-INT-ATTR          PIC S9(9) BINARY OCCURS 1 TIMES.03390000
           05  PV-CHAR-ATTR-LENGTH      PIC S9(9) BINARY VALUE 48.      03400000
           05  PV-PCT-NULL              PIC S9(4) VALUE +0              03410000
                                                  COMP.                 03420000
           05  PV-QTY-NULL              PIC S9(4) VALUE +0              03430000
                                                  COMP.                 03440000
           05  PV-EFF-END-DTE-NI        PIC S9(4) VALUE +0              03450000
                                                  COMP.                 03460000
           05  PV-DPTDIS-CDE              PIC X(02)  VALUE SPACES.      03470000
               88  PV-DPTDIS-CDE-MISC                VALUE '00'.        03480000
               88  PV-DPTDIS-CDE-HARDLINES           VALUE '01'.        03490000
               88  PV-DPTDIS-CDE-SOFTLINES           VALUE '02'.        03500000
           05  PV-MDSEAR-CDE              PIC X(01)  VALUE SPACE.       03510000
               88  PV-MDSEAR-CDE-MISC                VALUE '0'.         03520000
               88  PV-MDSEAR-CDE-HARDLINES           VALUE '1'.         03530000
               88  PV-MDSEAR-CDE-SOFTLINES           VALUE '2'.         03540000
           05  PV-MDSECL-TAX-DFLT-IND     PIC X(01)  VALUE SPACE.       03550000
               88  PV-MDSECL-TAX-DFLT-NONTAX         VALUE '0'.         03560000
               88  PV-MDSECL-TAX-DFLT-TAX            VALUE '1'.         03570000
           05  PV-FIFTEEN-DIGIT-NUM       PIC 9(15)  VALUE ZERO.        03580000
           05  PV-FIFTEEN-DIGIT-CHAR REDEFINES PV-FIFTEEN-DIGIT-NUM     03590000
                                          PIC X(15).                    03600000
           05  PV-FOUR-DIGIT-NUM          PIC 9(04)  VALUE ZERO.        03610000
           05  PV-THREE-DIGITS REDEFINES PV-FOUR-DIGIT-NUM.             03620000
               10  FILLER                 PIC X(01).                    03630000
               10  PV-THREE-DIGIT-CHAR    PIC X(03).                    03640000
           05  PV-TWO-DIGITS REDEFINES PV-FOUR-DIGIT-NUM.               03650000
               10  FILLER                 PIC X(02).                    03660000
               10  PV-TWO-DIGIT-CHAR      PIC X(02).                    03670000
           05  PV-NEW-BUYER-NUMBER        PIC X(03)  VALUE SPACES.      03680000
           05  PV-NEW-MERCH-DATA          PIC X(12)  VALUE SPACES.      03690000
           05  PV-NEW-MERCH-REDEF REDEFINES PV-NEW-MERCH-DATA.          03700000
               10  PV-NEW-MERCH-GMA       PIC X(02).                    03710000
               10  PV-NEW-MERCH-DMA       PIC X(02).                    03720000
               10  PV-NEW-MERCH-DPT       PIC X(03).                    03730000
               10  PV-NEW-MERCH-MCL       PIC X(02).                    03740000
               10  PV-NEW-MERCH-SCL       PIC X(03).                    03750000
           05  PV-OLD-MERCH-DATA          PIC X(12)  VALUE SPACES.      03760000
           05  PV-OLD-MERCH-REDEF REDEFINES PV-OLD-MERCH-DATA.          03770000
               10  PV-OLD-MERCH-GMA       PIC X(02).                    03780000
               10  PV-OLD-MERCH-DMA       PIC X(02).                    03790000
               10  PV-OLD-MERCH-DPT       PIC X(03).                    03800000
               10  PV-OLD-MERCH-MCL       PIC X(02).                    03810000
               10  PV-OLD-MERCH-SCL       PIC X(03).                    03820000
           05  PV-OLD-EFF-BEG-DTE         PIC X(10)  VALUE SPACES.      03830000
           05  PV-SQL-SUB                 PIC 9(04)  VALUE 0.           03840000
           05  PV-SHRINK-YR-NBR           PIC 9(04)  VALUE 0.           03850000
           05  PV-MDSEAR-DKEY             PIC S9(06)V COMP-3            03860000
                                                     VALUE 0.           03870000
           05  PV-PARENT-MDSEAR-DKEY      PIC S9(06)V COMP-3            03880000
                                                     VALUE 0.           03890000
           05  PV-QM-NAME                 PIC X(48)  VALUE SPACES.      03900000
           05  PV-PARAGRAPH               PIC X(50)  VALUE SPACES.      03910000
           05  PV-ACTION                  PIC X(08)  VALUE SPACES.      03920000
           05  PV-MSGBUFFER               PIC X(500) VALUE SPACES.      03930000
           05  PV-BATCH-CNTL-RECORD       PIC X(100) VALUE SPACES.      03940000
           05  PV-CHAR-ATTRS            PIC X(48) VALUE SPACES.         03950000
           05  PV-CURRENT-DATE.                                         03960000
               10  PV-CURRENT-YEAR      PIC X(04) VALUE SPACES.         03970000
               10  FILLER               PIC X(01) VALUE '-'.            03980000
               10  PV-CURRENT-MONTH     PIC X(02) VALUE SPACES.         03990000
               10  FILLER               PIC X(01) VALUE '-'.            04000000
               10  PV-CURRENT-DAY       PIC X(02) VALUE SPACES.         04010000
           05  PV-HCONN                 PIC S9(9) BINARY VALUE 0.       04020000
           05  PV-GQ-HANDLE             PIC S9(9) BINARY VALUE 0.       04030000
           05  PV-OPEN-OPTIONS          PIC S9(9) BINARY.               04040000
           05  PV-COMPLETION-CODE       PIC S9(9) BINARY.               04050000
           05  PV-REASON                PIC S9(9) BINARY.               04060000
           05  PV-RETRY-COUNT           PIC S9(03) VALUE +0 COMP.       04070000
           05  PV-CON-REASON            PIC S9(9) BINARY.               04080000
           05  PV-ISP-QMGR-NAME.                                        04090000
               10  PV-ISP-VALUE         PIC X(03) VALUE SPACES.         04100000
               10  PV-ISP-STORE-NUMBER  PIC 9(04) VALUE ZEROS.          04110000
               10  PV-ISP-PRIM-SECD     PIC X(01) VALUE SPACES.         04120000
           05  PV-VSAM-STATUS           PIC XX    VALUE SPACE.          04130000
               88  PV-GOOD-STATUS                 VALUE '00'.           04140000
               88  PV-AT-END                      VALUE '10'.           04150000
               88  PV-NOT-FOUND                   VALUE '23'.           04160000
               88  PV-VERIFIED                    VALUE '97'.           04170000
           05  PV-MESSAGE               PIC X(50) VALUE SPACES.         04180000
           05  PV-INPUT-RECORD          PIC X(100) VALUE SPACES.        04190000
               88  PV-COMMIT-DB2-INSERTS          VALUE                 04200000
                   'ATTEMPT TO COMMIT INSERTS TO DB2 TABLE'.            04210000
           05  PV-ERROR-MESSAGE         PIC X(48) VALUE SPACES.         04220000
                                                                        04230000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   04240000
           05  PH-COMPLETION-CODE       PIC  S9(09) BINARY VALUE +0.    04250000
           05  PH-REASON                PIC  S9(09) BINARY VALUE +0.    04260000
                                                                        04270000
      ***************************************************************** 04280000
      *  MERCHANDISE BRIDGING RMS TO DB2 COPYBOOK                       04290000
      ***************************************************************** 04300000
           COPY HMRD001.                                                04310000
                                                                        04320000
      ***************************************************************** 04330000
      *    BATCH PARAMETER CONTROL RECORD LAYOUT.                       04340000
      ***************************************************************** 04350000
           COPY MBWS018.                                                04360000
                                                                        04370000
      ***************************************************************** 04380000
      *  MERCHANDISE HIERARCHY RECORD LAYOUT USED TO END-DATE SUBCLASS  04390000
      ***************************************************************** 04400000
           COPY HMWS002.                                                04410000
                                                                        04420000
      ***************************************************************** 04430000
      *  BUSINESS GROUP SHORT DESCRIPTION UPDATES COPYBOOK              04440000
      ***************************************************************** 04450000
           COPY HMRD017.                                                04460000
                                                                        04470000
      *----------------------------------------------------------------*04480000
      *    ABEND CODES THE ARE APPLICATION DEFINED                      04490000
      *----------------------------------------------------------------*04500000
       01  ABEND-CODE                  PIC S9(4)    VALUE ZEROS         04510000
                                                    COMP SYNC.          04520000
           88  AC-CONTROL-CARD-1-MISSING            VALUE +4001.        04530000
           88  AC-CONTROL-CARD-2-MISSING            VALUE +4002.        04540000
           88  AC-BTCH-CNTL-INV-STATUS              VALUE +4003.        04550000
           88  AC-TABLE-OVERFLOW-ERROR              VALUE +4004.        04560000
           88  AC-DB2-ERROR                         VALUE +4013.        04570000
           88  AC-MQ-ERROR                          VALUE +4020.        04580000
                                                                        04590000
      * ------------------------------------------------------------- * 04600000
      *  COMMUNICATION AREAS FOR DB2                                    04610000
      * ------------------------------------------------------------- * 04620000
           EXEC SQL                                                     04630000
               INCLUDE SQLCA                                            04640000
           END-EXEC.                                                    04650000
                                                                        04660000
      * ------------------------------------------------------------- * 04670000
      *  ERROR MESSAGE AREA FOR DB2                                   * 04680000
      * ------------------------------------------------------------- * 04690000
           COPY DPWS004.                                                04700000
                                                                        04710000
      * ------------------------------------------------------------- * 04720000
      *  SQL AND COBOL DECLARATIONS FOR APPLICATION AVAIL TABLE(TAPLAVL)04730000
                                                                        04740000
           EXEC SQL                                                     04750000
               INCLUDE TAPLAVL                                          04760000
           END-EXEC.                                                    04770000
                                                                        04780000
      *  SQL AND COBOL DECLARATIONS FOR DEPARTMENT SHRINK TABLE(TDPTSHK)04790000
                                                                        04800000
           EXEC SQL                                                     04810000
               INCLUDE TDPTSHK                                          04820000
           END-EXEC.                                                    04830000
                                                                        04840000
      *  SQL AND COBOL DECLARATIONS FOR DATE ATTRIBUTES TABLE (TDTATTR) 04850000
                                                                        04860000
           EXEC SQL                                                     04870000
               INCLUDE TDTATTR                                          04880000
           END-EXEC.                                                    04890000
                                                                        04900000
      *  SQL AND COBOL DECLARATIONS FOR MERCHANDISE AREA TABLE (TMDSEAR)04910000
                                                                        04920000
           EXEC SQL                                                     04930000
               INCLUDE TMDSEAR                                          04940000
           END-EXEC.                                                    04950000
                                                                        04960000
      *  SQL AND COBOL DECLARATIONS FOR MERCH BUSINESS GRP TBL(TMDSEBG) 04970000
                                                                        04980000
           EXEC SQL                                                     04990000
               INCLUDE TMDSEBG                                          05000000
           END-EXEC.                                                    05010000
                                                                        05020000
      *  SQL AND COBOL DECLARATIONS FOR MERCHANDISE CLASS TBL (TMDSECL) 05030000
                                                                        05040000
           EXEC SQL                                                     05050000
               INCLUDE TMDSECL                                          05060000
           END-EXEC.                                                    05070000
                                                                        05080000
      *  SQL AND COBOL DECLARATIONS FOR MERCHANDISE DEPT TABLE (TMDSEDP)05090000
                                                                        05100000
           EXEC SQL                                                     05110000
               INCLUDE TMDSEDP                                          05120000
           END-EXEC.                                                    05130000
                                                                        05140000
      *  SQL AND COBOL DECLARATIONS FOR M/L CONTROL TABLE(TMLCNTL)      05150000
                                                                        05160000
           EXEC SQL                                                     05170000
               INCLUDE TMLCNTL                                          05180000
           END-EXEC.                                                    05190000
                                                                        05200000
      *  SQL AND COBOL DECLARATIONS FOR RESPONSIBILITY AREA TBL(TRSPBAR)05210000
                                                                        05220000
           EXEC SQL                                                     05230000
               INCLUDE TRSPBAR                                          05240000
           END-EXEC.                                                    05250000
                                                                        05260000
      *  SQL AND COBOL DECLARATIONS FOR STORE ZONE AREA TABLE (TSTRZN)  05270000
                                                                        05280000
           EXEC SQL                                                     05290000
               INCLUDE TSTRZN                                           05300000
           END-EXEC.                                                    05310000
                                                                        05320000
      *  SQL AND COBOL DECLARATIONS FOR THE WORKER TABLE (TWORKER)      05330000
                                                                        05340000
           EXEC SQL                                                     05350000
               INCLUDE TWORKER                                          05360000
           END-EXEC.                                                    05370000
                                                                        05380000
0816PK*  DECLARATIONS FOR THE PRIVATE BRAND TABLE (XMT_PRVT_BRND_FCTR)  05390000
0816PK                                                                  05400000
0816PK     EXEC SQL                                                     05410000
0816PK         INCLUDE XMT00022                                         05420000
0816PK     END-EXEC.                                                    05430000
                                                                        05440000
      ***************************************************************** 05450000
      *    APPLICATION AVAILABILITY CURSOR                              05460000
      ***************************************************************** 05470000
           EXEC SQL                                                     05480000
               DECLARE APLAVL_CUR CURSOR FOR                            05490000
                  SELECT APLSYS_CDE,                                    05500000
                         MDSEAR_DKEY,                                   05510000
                         MDSEAR_STRT_DTE,                               05520000
                         MDSEAR_END_DTE                                 05530000
                  FROM TAPLAVL                                          05540000
                  WHERE (MDSEAR_DKEY = :PV-MDSEAR-DKEY) AND             05550000
                        (MDSEAR_END_DTE > DATE(CURRENT TIMESTAMP))      05560000
           END-EXEC.                                                    05570000
                                                                        05580000
      * ------------------------------------------------------------- * 05590000
       PROCEDURE DIVISION.                                              05600000
      * ------------------------------------------------------------- * 05610000
       0000-HMKUP001.                                                   05620000
                                                                        05630000
           PERFORM 1000-INITIALIZE.                                     05640000
                                                                        05650000
           IF PS-CONTROL-CARD-1-END                                     05660000
               CONTINUE                                                 05670000
           ELSE                                                         05680000
               PERFORM 2000-PROCESS-MESSAGES UNTIL                      05690000
                     NOT PS-MQGET-SUCCESSFUL                            05700000
           END-IF.                                                      05710000
                                                                        05720000
           PERFORM 2400-EOJ-PROCESSING.                                 05730000
           STOP RUN.                                                    05740000
                                                                        05750000
      *----------------------------------------------------------------*05760000
      *  INITIALIZATION ROUTINE.                                        05770000
      *----------------------------------------------------------------*05780000
       1000-INITIALIZE.                                                 05790000
                                                                        05800000
           MOVE FUNCTION CURRENT-DATE (1:4) TO PV-CURRENT-YEAR.         05810000
           MOVE FUNCTION CURRENT-DATE (5:2) TO PV-CURRENT-MONTH.        05820000
           MOVE FUNCTION CURRENT-DATE (7:2) TO PV-CURRENT-DAY.          05830000
           DISPLAY '***HMKUP001 CURRENT DATE = ' PV-CURRENT-DATE.       05840000
                                                                        05850000
           SET PS-CONTROL-CARD-1-START TO TRUE.                         05860000
           OPEN INPUT CONTROL-CARD-1                                    05870000
                      CONTROL-CARD-2.                                   05880000
           OPEN I-O BATCH-CONTROL-FILE.                                 05890000
           OPEN OUTPUT ERROR-FILE                                       05900000
                       BACKUP-FILE                                      05910000
                       BUSGP-UPDTS-FILE.                                05920000
                                                                        05930000
           PERFORM 8000-READ-CONTROL-CARD1.                             05940000
                                                                        05950000
           IF PS-CONTROL-CARD-1-END                                     05960000
               SET AC-CONTROL-CARD-1-MISSING TO TRUE                    05970000
               DISPLAY '* * * * * * * * * * * * * * * * *'              05980000
               DISPLAY '*    ***HMKUP001 ABEND***       *'              05990000
               DISPLAY '*                               *'              06000000
               DISPLAY '*   CONTROL CARD MISSING -      *'              06010000
               DISPLAY '*   FOR QMGR NAME               *'              06020000
               DISPLAY '*                               *'              06030000
               DISPLAY '*   ABEND CODE: ' ABEND-CODE                    06040000
                           '             *'                             06050000
               DISPLAY '* * * * * * * * * * * * * * * * *'              06060000
               CALL 'ILBOABN0'    USING  ABEND-CODE                     06070000
           ELSE                                                         06080000
               DISPLAY PC-PGM-NAME                                      06090000
                       '- '                                             06100000
                       PC-FIFTY-STARS                                   06110000
               DISPLAY PC-PGM-NAME                                      06120000
                       '- CONTROL CARD: '                               06130000
                       CC-CONTROL-CARD-1                                06140000
           END-IF.                                                      06150000
                                                                        06160000
           PERFORM 8010-READ-CONTROL-CARD2.                             06170000
           IF PS-CONTROL-CARD-2-END                                     06180000
               SET AC-CONTROL-CARD-2-MISSING TO TRUE                    06190000
               DISPLAY '* * * * * * * * * * * * * * * * *'              06200000
               DISPLAY '*    ***HMKUP001 ABEND***       *'              06210000
               DISPLAY '*                               *'              06220000
               DISPLAY '*   CONTROL CARD MISSING -      *'              06230000
               DISPLAY '*   RMS TO DB2 QUEUE NAME       *'              06240000
               DISPLAY '*                               *'              06250000
               DISPLAY '*   ABEND CODE: ' ABEND-CODE                    06260000
                           '             *'                             06270000
               DISPLAY '* * * * * * * * * * * * * * * * *'              06280000
               CALL 'ILBOABN0'    USING  ABEND-CODE                     06290000
           ELSE                                                         06300000
               DISPLAY PC-PGM-NAME                                      06310000
                       '- '                                             06320000
                       PC-FIFTY-STARS                                   06330000
               DISPLAY PC-PGM-NAME                                      06340000
                       '- CONTROL CARD: '                               06350000
                       CC-CONTROL-CARD-2                                06360000
           END-IF.                                                      06370000
                                                                        06380000
           CLOSE CONTROL-CARD-1.                                        06390000
           CLOSE CONTROL-CARD-2.                                        06400000
                                                                        06410000
           PERFORM 1500-MQ-SETUP.                                       06420000
           PERFORM 8200-MQGET-MSG.                                      06430000
                                                                        06440000
                                                                        06450000
                                                                        06460000
      * ------------------------------------------------------------- * 06470000
      *  SETUP MQ VALUES                                                06480000
      * ------------------------------------------------------------- * 06490000
                                                                        06500000
       1500-MQ-SETUP.                                                   06510000
      *    CONNECT TO THE QUEUE MANAGER                                 06520000
                                                                        06530000
           MOVE CC-QMGR-NAME TO PV-QM-NAME.                             06540000
           CALL WS-MQCONN USING PV-QM-NAME                              06550000
                               PV-HCONN                                 06560000
                               PV-COMPLETION-CODE                       06570000
                               PV-REASON.                               06580000
                                                                        06590000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              06600000
      *    AND EXIT                                                     06610000
                                                                        06620000
           MOVE PV-REASON TO PV-CON-REASON.                             06630000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   06640000
              MOVE 'MQCONN ERROR'   TO PV-ERROR-MESSAGE                 06650000
              PERFORM 9000-DISPLAY-MQ-ERROR                             06660000
           END-IF.                                                      06670000
           DISPLAY 'MQCONN SUCCESSFUL TO ', PV-QM-NAME.                 06680000
                                                                        06690000
      *    OPEN THE RMS MERCH HIERARCHY QUEUE FOR INPUT                 06700000
                                                                        06710000
           COMPUTE PV-OPEN-OPTIONS = MQOO-INPUT-SHARED +                06720000
                                     MQOO-FAIL-IF-QUIESCING.            06730000
           MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            06740000
           MOVE CC-MERCH-HIER-QNAME      TO MQOD-OBJECTNAME.            06750000
           MOVE PV-QM-NAME               TO MQOD-OBJECTQMGRNAME.        06760000
      *                                                                 06770000
           CALL WS-MQOPEN USING PV-HCONN                                06780000
                               MQM-OBJECT-DESCRIPTOR                    06790000
                               PV-OPEN-OPTIONS                          06800000
                               PV-GQ-HANDLE                             06810000
                               PV-COMPLETION-CODE                       06820000
                               PV-REASON.                               06830000
      *                                                                 06840000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    06850000
      *    AND EXIT.                                                    06860000
      *                                                                 06870000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   06880000
              MOVE 'MQOPEN ERROR'   TO PV-ERROR-MESSAGE                 06890000
              PERFORM 1700-DISCONNECT-QMGR                              06900000
              PERFORM 9000-DISPLAY-MQ-ERROR                             06910000
           END-IF.                                                      06920000
           DISPLAY 'MQOPEN SUCCESSFUL TO ' MQOD-OBJECTNAME.             06930000
                                                                        06940000
                                                                        06950000
      * ------------------------------------------------------------- * 06960000
      *  CLOSE MQ QUEUE                                                 06970000
      * ------------------------------------------------------------- * 06980000
                                                                        06990000
       1600-CLOSE-QUEUE.                                                07000000
                                                                        07010000
           CALL WS-MQCLOSE USING PV-HCONN                               07020000
                                 PV-GQ-HANDLE                           07030000
                                 MQCO-NONE                              07040000
                                 PV-COMPLETION-CODE                     07050000
                                 PV-REASON.                             07060000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   07070000
              MOVE 'MQCLOSE ERROR' TO PV-ERROR-MESSAGE                  07080000
              PERFORM 9000-DISPLAY-MQ-ERROR                             07090000
           ELSE                                                         07100000
              DISPLAY 'MQCLOSE SUCCESSFUL'                              07110000
           END-IF.                                                      07120000
                                                                        07130000
                                                                        07140000
      * ------------------------------------------------------------- * 07150000
      *  DISCONNECT QUEUE MANAGER                                       07160000
      * ------------------------------------------------------------- * 07170000
                                                                        07180000
       1700-DISCONNECT-QMGR.                                            07190000
                                                                        07200000
           IF PV-CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED      07210000
              CALL WS-MQDISC USING PV-HCONN                             07220000
                                  PV-COMPLETION-CODE                    07230000
                                  PV-REASON                             07240000
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                07250000
                 MOVE 'MQDISC ERROR'   TO PV-ERROR-MESSAGE              07260000
                 PERFORM 9000-DISPLAY-MQ-ERROR                          07270000
              ELSE                                                      07280000
                 DISPLAY 'MQDISC SUCCESSFUL'                            07290000
              END-IF                                                    07300000
           END-IF.                                                      07310000
                                                                        07320000
                                                                        07330000
      * ------------------------------------------------------------- * 07340000
      *  PROCESS MESSAGES                                               07350000
      * ------------------------------------------------------------- * 07360000
                                                                        07370000
       2000-PROCESS-MESSAGES.                                           07380000
                                                                        07390000
                                                                        07400000
           MOVE 'N' TO PS-INPUT-REC-ERR-SW.                             07410000
                                                                        07420000
           EVALUATE TRUE                                                07430000
              WHEN HM001-RMS-TBL-NAME = PC-K-EMT-SCL-ATTRS-TABLE        07440000
                 PERFORM 3100-PROCESS-SUBCL-ATTRS-MSGS                  07450000
              WHEN HM001-RMS-TBL-NAME = PC-CODE-DETAIL-TABLE            07460000
                 PERFORM 3200-PROCESS-CODE-DETAIL-MSGS                  07470000
              WHEN HM001-RMS-TBL-NAME = PC-K-EMT-BUS-GROUP-TABLE        07480000
                 PERFORM 3300-PROCESS-BUS-GROUP-MSGS                    07490000
              WHEN HM001-RMS-TBL-NAME = PC-K-EMT-DEPS-ATTRS-TABLE       07500000
                 PERFORM 3400-PROCESS-DEPS-ATTRS-MSGS                   07510000
                 IF PS-DONT-STOP-REC-PROCESS                            07520000
                     PERFORM 3800-PROCESS-DEPS-ATTRS-MDSEAR             07530000
                 END-IF                                                 07540000
              WHEN HM001-RMS-TBL-NAME = PC-DIVISION-TABLE               07550000
                 PERFORM 3500-PROCESS-DIVISION-MSGS                     07560000
              WHEN HM001-RMS-TBL-NAME = PC-GROUPS-TABLE                 07570000
                 PERFORM 3600-PROCESS-GROUPS-MESSAGES                   07580000
              WHEN HM001-RMS-TBL-NAME = PC-DEPS-TABLE                   07590000
                 PERFORM 3700-PROCESS-DEPS-MESSAGES                     07600000
                 IF PS-DONT-STOP-REC-PROCESS                            07610000
                     PERFORM 4200-PROCESS-DEPS-MDSEDP                   07620000
                 END-IF                                                 07630000
              WHEN HM001-RMS-TBL-NAME = PC-CLASS-TABLE                  07640000
                 PERFORM 3900-PROCESS-CLASS-MESSAGES                    07650000
0102RM*       WHEN HM001-RMS-TBL-NAME = PC-K-EMT-CLS-ATTRS-TABLE        07660000
0102RM*          PERFORM 4000-PROCESS-CLASS-ATTRS-MSGS                  07670000
              WHEN HM001-RMS-TBL-NAME = PC-SUBCLASS-TABLE               07680000
                 PERFORM 4100-PROCESS-SUBCLASS-MESSAGES                 07690000
0816PK        WHEN HM001-RMS-TBL-NAME = PC-K-EMT-PRVT-BRND-TABLE        07700000
0816PK           PERFORM 4300-PROCESS-PRVT-BRND-MSGS                    07710000
              WHEN OTHER                                                07720000
                   DISPLAY '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'            07730000
                   DISPLAY ' ERROR IN 2000-PROCESS-MESSAGES'            07740000
                   DISPLAY ' CANNOT PROCESS TABLE NAME     '            07750000
219606                       HM001-RMS-TBL-NAME                         07760019
                   DISPLAY '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'            07770000
                   PERFORM 9910-WRITE-ERROR-RECORD                      07780000
           END-EVALUATE.                                                07790000
                                                                        07800000
           IF PS-INPUT-REC-ERROR                                        07810000
               PERFORM 8410-ROLLBACK-DB2                                07820000
           ELSE                                                         07830000
               PERFORM 8400-COMMIT-DB2                                  07840000
           END-IF.                                                      07850000
           PERFORM 8450-COMMIT-MQ.                                      07860000
           PERFORM 8200-MQGET-MSG.                                      07870000
                                                                        07880000
                                                                        07890000
       2400-EOJ-PROCESSING.                                             07900000
                                                                        07910000
           DISPLAY '*-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-*'    07920000
           DISPLAY 'END OF JOB RECORD COUNTERS'.                        07930000
           DISPLAY 'SUCCESSFUL MQGETS     ' PA-MQGET.                   07940000
           DISPLAY '*-%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-*'.             07950000
           DISPLAY 'SUBCLASS-ATTR-MSGS    ' PA-SUBCL-ATTR-MSGS.         07960000
           DISPLAY 'SUBCLASS-ATTR-INSERTS ' PA-SUBCL-ATTR-INSERTS.      07970000
           DISPLAY 'SUBCLASS-ATTR-UPDATES ' PA-SUBCL-ATTR-UPDATES.      07980000
           DISPLAY 'CODE-DETAIL-MESSAGES  ' PA-CODE-DETAIL-MSGS.        07990000
           DISPLAY 'CODE-DETAIL-INSERTS   ' PA-CODE-DETAIL-INSERTS.     08000000
           DISPLAY 'CODE-DETAIL-UPDATES   ' PA-CODE-DETAIL-UPDATES.     08010000
           DISPLAY 'CODE-DETAIL-DELETES   ' PA-CODE-DETAIL-DELETES.     08020000
           DISPLAY 'BUSINESS-GRP-MESSAGES ' PA-BUS-GROUP-MSGS.          08030000
           DISPLAY 'BUSINESS-GRP-INSERTS  ' PA-BUS-GROUP-INSERTS.       08040000
           DISPLAY 'BUSINESS-GRP-UPDATES  ' PA-BUS-GROUP-UPDATES.       08050000
           DISPLAY 'BUS-GRP-SHRT-DESC-UPD ' PA-BUS-GRP-SHRT-DESC-UPDTS. 08060000
           DISPLAY 'BUSINESS-GRP-DELETES  ' PA-BUS-GROUP-DELETES.       08070000
           DISPLAY 'DEPS-ATTRS-MESSAGES   ' PA-DEPS-ATTRS-MSGS.         08080000
           DISPLAY 'DEPS-ATTRS-INSERTS    ' PA-DEPS-ATTRS-INSERTS.      08090000
           DISPLAY 'DEPS-ATTRS-UPDATES-1  ' PA-DEPS-ATTRS-UPDATES-1.    08100000
           DISPLAY 'DEPS-ATTRS-UPDATES-2  ' PA-DEPS-ATTRS-UPDATES-2.    08110000
           DISPLAY 'DEPS-MDSEDP-UPDATES   ' PA-DEPS-MDSEDP-UPDATES.     08120000
           DISPLAY 'DIVISION-MESSAGES     ' PA-DIVISION-MSGS.           08130000
           DISPLAY 'DIVISION-INSERTS      ' PA-DIVISION-INSERTS.        08140000
           DISPLAY 'DIVISION-UPDATES      ' PA-DIVISION-UPDATES.        08150000
           DISPLAY 'DIVISION-DELETES      ' PA-DIVISION-BTCH-DELETES.   08160000
           DISPLAY 'GROUPS-MESSAGES       ' PA-GROUPS-MSGS.             08170000
           DISPLAY 'GROUPS-INSERTS        ' PA-GROUPS-INSERTS.          08180000
           DISPLAY 'GROUPS-UPDATES        ' PA-GROUPS-UPDATES.          08190000
           DISPLAY 'GROUPS-BATCH-UPDATES  ' PA-GROUPS-BATCH-UPDATES.    08200000
           DISPLAY 'GROUPS-BATCH-DELETES  ' PA-GROUPS-BATCH-DELETES.    08210000
           DISPLAY 'DEPS-MESSAGES         ' PA-DEPS-MSGS.               08220000
           DISPLAY 'DEPS-INSERTS          ' PA-DEPS-INSERTS.            08230000
           DISPLAY 'DEPS-TDPTSHK-INSERTS  ' PA-DEPS-TDPTSHK-INSERTS.    08240000
           DISPLAY 'DEPS-UPDATES          ' PA-DEPS-UPDATES.            08250000
           DISPLAY 'DEPS-BTCH-DMA-UPDTS   ' PA-DEPS-BTCH-DMA-UPDATES.   08260000
           DISPLAY 'DEPS-BTCH-BYR-UPDTS   ' PA-DEPS-BTCH-BYR-UPDATES.   08270000
           DISPLAY 'DEPS-BATCH-DELETES    ' PA-DEPS-BATCH-DELETES.      08280000
           DISPLAY 'CLASS-MESSAGES        ' PA-CLASS-MSGS.              08290000
           DISPLAY 'CLASS-INSERTS         ' PA-CLASS-INSERTS.           08300000
           DISPLAY 'CLASS-UPDATES         ' PA-CLASS-UPDATES.           08310000
           DISPLAY 'CLASS-BATCH-DELETES   ' PA-CLASS-BATCH-DELETES.     08320000
           DISPLAY 'CLASS-ATTR-MESSAGES   ' PA-CLASS-ATTR-MSGS.         08330000
           DISPLAY 'CLASS-ATTR-UPDATES    ' PA-CLASS-ATTR-UPDATES.      08340000
           DISPLAY 'SUBCLASS-MESSAGES     ' PA-SUBCLASS-MSGS.           08350000
           DISPLAY 'SUBCLASS-INSERTS      ' PA-SUBCLASS-INSERTS.        08360000
           DISPLAY 'SUBCLASS-UPDATES      ' PA-SUBCLASS-UPDATES.        08370000
           DISPLAY 'SUBCLASS-BTCH-DELETES ' PA-SUBCLASS-BATCH-DELETES.  08380000
           DISPLAY 'TRSPBAR-INSERTS       ' PA-TRSPBAR-INSERTS.         08390000
0816PK     DISPLAY 'PRVT-BRND-MESSAGES    ' PA-PRVT-BRND-MSGS.          08400000
0816PK     DISPLAY 'PRVT-BRND-INSERTS     ' PA-PRVT-BRND-INSERTS.       08410000
0816PK     DISPLAY 'PRVT-BRND-UPDATES     ' PA-PRVT-BRND-UPDATES.       08420000
0816PK     DISPLAY 'PRVT-BRND-DELETES     ' PA-PRVT-BRND-DELETES.       08430000
           DISPLAY '*-%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-*'.             08440000
           DISPLAY 'RECORDS WITH ERRORS   ' PA-ERRORS.                  08450000
RMSRET     DISPLAY 'SKIPPED ERROR RECORDS ' PA-SKIPPED-ERRORS.          08460011
           DISPLAY '*-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-*'    08470000
           CLOSE ERROR-FILE.                                            08480000
           CLOSE BACKUP-FILE.                                           08490000
           CLOSE BUSGP-UPDTS-FILE.                                      08500000
           PERFORM 1600-CLOSE-QUEUE.                                    08510000
           PERFORM 1700-DISCONNECT-QMGR.                                08520000
                                                                        08530000
      *-- THIS RETURN CODE WILL GENERATE AN EMAIL IN A SUBSEQUENT       08540000
      *-- STEP IN THE JOB                                               08550000
           IF PA-ERRORS > 0                                             08560000
               MOVE 4095 TO RETURN-CODE                                 08570000
           END-IF.                                                      08580000
                                                                        08590000
      * ------------------------------------------------------------- * 08600000
      * PROCESS THE KOHL'S SUBCLASS ATTRIBUTES MESSAGES                 08610000
      * ------------------------------------------------------------- * 08620000
       3100-PROCESS-SUBCL-ATTRS-MSGS.                                   08630000
                                                                        08640000
           MOVE '3100-PROCESS-SUBCL-ATTRS-MSGS' TO  PV-PARAGRAPH.       08650000
                                                                        08660000
           ADD 1 TO PA-SUBCL-ATTR-MSGS.                                 08670000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            08680000
                                                                        08690000
           IF HM001-ACTN-TYP-INSERT                                     08700000
             OR HM001-ACTN-TYP-UPDATE                                   08710000
               IF HM001-SCLATTR-TX-DFLT-TAXABLE                         08720000
                   SET PV-MDSECL-TAX-DFLT-TAX TO TRUE                   08730000
               ELSE                                                     08740000
                   IF HM001-SCLATTR-TX-DFLT-NONTAX                      08750000
                       SET PV-MDSECL-TAX-DFLT-NONTAX TO TRUE            08760000
                   ELSE                                                 08770000
                       MOVE 'INVALID TX_DFLT_IND VALUE' TO PV-MESSAGE   08780000
                       DISPLAY '*************************************'  08790000
                       DISPLAY '**  ERROR     **'                       08800000
                       DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME       08810000
                       DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH      08820000
                       DISPLAY '**  MESSAGE   **  = ' PV-MESSAGE        08830000
                       DISPLAY '*************************************'  08840000
                       PERFORM 9910-WRITE-ERROR-RECORD                  08850000
                       SET PS-STOP-REC-PROCESSING TO TRUE               08860000
                   END-IF                                               08870000
               END-IF                                                   08880000
           END-IF.                                                      08890000
                                                                        08900000
           IF PS-DONT-STOP-REC-PROCESS                                  08910000
               MOVE HM001-SCLATTR-DEPT     TO PV-FOUR-DIGIT-NUM         08920000
               MOVE PV-THREE-DIGIT-CHAR    TO MDSEAR-DEPT-NBR           08930000
               MOVE HM001-SCLATTR-CLASS    TO PV-FOUR-DIGIT-NUM         08940000
               MOVE PV-TWO-DIGIT-CHAR      TO MDSEAR-MAJ-CL-NBR         08950000
               MOVE HM001-SCLATTR-SUBCLASS TO PV-FOUR-DIGIT-NUM         08960000
               MOVE PV-THREE-DIGIT-CHAR    TO MDSEAR-SUB-CL-NBR         08970000
               PERFORM 7850-GET-SUBCLASS-MDSEAR-INFO                    08980000
           END-IF.                                                      08990000
                                                                        09000000
           IF PS-DONT-STOP-REC-PROCESS                                  09010000
               IF HM001-ACTN-TYP-INSERT                                 09020000
                   PERFORM 3110-INSERT-MERCH-CLASS-DATA                 09030000
               ELSE                                                     09040000
                   MOVE MDSEAR-DKEY TO MDSECL-MDSEAR-DKEY               09050000
                   IF HM001-ACTN-TYP-UPDATE                             09060000
                       PERFORM 3120-UPDATE-MERCH-CLASS-DATA             09070000
                   END-IF                                               09080000
               END-IF                                                   09090000
           END-IF.                                                      09100000
                                                                        09110000
      * ------------------------------------------------------------- * 09120000
      * INSERT A NEW ROW IN THE MERCHANDISE CLASS TABLE                 09130000
      * WITH K_EMT_SUBCLASS_ATTRIBUTES DATA                             09140000
      * ------------------------------------------------------------- * 09150000
       3110-INSERT-MERCH-CLASS-DATA.                                    09160000
                                                                        09170000
           MOVE MDSEAR-DKEY                 TO MDSECL-MDSEAR-DKEY.      09180000
           MOVE PV-MDSECL-TAX-DFLT-IND      TO MDSECL-TAX-DFLT-IND.     09190000
           MOVE HM001-SCLATTR-POS-MDSE-DESC TO MDSECL-POS-DESC.         09200000
           PERFORM 7010-INSERT-TMDSECL-ROW.                             09210000
0603RM     IF SQLCODE = PC-ROW-ALREADY-EXISTS                           09220000
0603RM         PERFORM 3120-UPDATE-MERCH-CLASS-DATA                     09230000
0603RM     END-IF.                                                      09240000
                                                                        09250000
      * ------------------------------------------------------------- * 09260000
      * UPDATE THE MERCHANDISE CLASS TABLE DATA WITH                    09270000
      * K_EMT_SUBCLASS_ATTRIBUTES DATA                                  09280000
      * ------------------------------------------------------------- * 09290000
       3120-UPDATE-MERCH-CLASS-DATA.                                    09300000
                                                                        09310000
           MOVE PV-MDSECL-TAX-DFLT-IND      TO MDSECL-TAX-DFLT-IND.     09320000
           MOVE HM001-SCLATTR-POS-MDSE-DESC TO MDSECL-POS-DESC.         09330000
           PERFORM 7011-UPDATE-TMDSECL-ROW.                             09340000
                                                                        09350000
      * ------------------------------------------------------------- * 09360000
      * PROCESS THE CODE DETAIL MESSAGES (TYPE 'STZN')                  09370000
      * ------------------------------------------------------------- * 09380000
       3200-PROCESS-CODE-DETAIL-MSGS.                                   09390000
                                                                        09400000
           MOVE '3200-PROCESS-CODE-DETAIL-MSGS' TO  PV-PARAGRAPH.       09410000
                                                                        09420000
           ADD 1 TO PA-CODE-DETAIL-MSGS.                                09430000
                                                                        09440000
           IF HM001-ACTN-TYP-INSERT                                     09450000
               PERFORM 3210-INSERT-STORE-ZONE-DATA                      09460000
           ELSE                                                         09470000
               MOVE HM001-CDE-DTL-CODE  TO STRZN-STR-ZN-ID              09480000
               IF HM001-ACTN-TYP-UPDATE                                 09490000
                   PERFORM 3220-UPDATE-STORE-ZONE-DATA                  09500000
               ELSE                                                     09510000
                   IF HM001-ACTN-TYP-DELETE                             09520000
                       PERFORM 7022-DELETE-TSTRZN-ROW                   09530000
                   END-IF                                               09540000
               END-IF                                                   09550000
           END-IF.                                                      09560000
      * ------------------------------------------------------------- * 09570000
      * INSERT A NEW ROW IN THE STORE ZONE TABLE WITH CODE_DETAIL DATA  09580000
      * ------------------------------------------------------------- * 09590000
       3210-INSERT-STORE-ZONE-DATA.                                     09600000
                                                                        09610000
           MOVE HM001-CDE-DTL-CODE      TO STRZN-STR-ZN-ID.             09620000
           MOVE HM001-CDE-DTL-CODE-DESC TO STRZN-STR-ZN-DESC.           09630000
           PERFORM 7020-INSERT-TSTRZN-ROW.                              09640000
                                                                        09650000
      * ------------------------------------------------------------- * 09660000
      * UPDATE THE STORE ZONE TABLE WITH CODE_DETAIL DATA               09670000
      * ------------------------------------------------------------- * 09680000
       3220-UPDATE-STORE-ZONE-DATA.                                     09690000
                                                                        09700000
           MOVE HM001-CDE-DTL-CODE-DESC TO STRZN-STR-ZN-DESC.           09710000
           PERFORM 7021-UPDATE-TSTRZN-ROW.                              09720000
                                                                        09730000
      * ------------------------------------------------------------- * 09740000
      * PROCESS THE KOHL'S BUSINESS GROUP MESSAGES                      09750000
      * ------------------------------------------------------------- * 09760000
       3300-PROCESS-BUS-GROUP-MSGS.                                     09770000
                                                                        09780000
           MOVE '3300-PROCESS-BUS-GROUP-MSGS' TO  PV-PARAGRAPH.         09790000
                                                                        09800000
           ADD 1 TO PA-BUS-GROUP-MSGS.                                  09810000
                                                                        09820000
           IF HM001-ACTN-TYP-INSERT                                     09830000
               PERFORM 3310-INSERT-BUS-GROUP-DATA                       09840000
           ELSE                                                         09850000
DAFDAF*        MOVE HM001-BUS-GRP-BUS-GP-NBR TO MDSEBG-NBR              09860000
DAFDAF         MOVE HM001-BUS-GRP-BUS-GP-NBR TO MDSEBG-MDSEBG-NBR       09870000
               IF HM001-ACTN-TYP-UPDATE                                 09880000
0307PK             PERFORM 7033-SELECT-TMDSEBG-SHRT-DESC                09890000
0307PK             IF SQLCODE = ZERO                                    09900000
0307PK               AND HM001-BUS-GRP-BUS-GP-SHRT-DESC NOT =           09910000
0307PK                   MDSEBG-BUS-GP-SHRT-DESC                        09920000
0307PK                 PERFORM 3330-CREATE-BUSGPSD-UPDTS-REC            09930000
0307PK             END-IF                                               09940000
                   PERFORM 3320-UPDATE-BUS-GROUP-DATA                   09950000
               ELSE                                                     09960000
                   IF HM001-ACTN-TYP-DELETE                             09970000
                       PERFORM 7032-DELETE-TMDSEBG-ROW                  09980000
                   END-IF                                               09990000
               END-IF                                                   10000000
           END-IF.                                                      10010000
      * ------------------------------------------------------------- * 10020000
      * INSERT A NEW ROW IN THE MERCHANDISE BUSINESS GROUP TABLE WITH   10030000
      * K_EMT_BUSINESS_GROUP DATA                                       10040000
      * ------------------------------------------------------------- * 10050000
       3310-INSERT-BUS-GROUP-DATA.                                      10060000
                                                                        10070000
DAFDAF*    MOVE HM001-BUS-GRP-BUS-GP-NBR  TO MDSEBG-NBR.                10080000
DAFDAF     MOVE HM001-BUS-GRP-BUS-GP-NBR  TO MDSEBG-MDSEBG-NBR.         10090000
DAFDAF*    MOVE HM001-BUS-GRP-BUS-GP-DESC TO MDSEBG-DESC.               10100000
DAFDAF     MOVE HM001-BUS-GRP-BUS-GP-DESC TO MDSEBG-MDSEBG-DESC.        10110000
0307PK     MOVE HM001-BUS-GRP-BUS-GP-SHRT-DESC                          10120000
0307PK                                    TO MDSEBG-BUS-GP-SHRT-DESC.   10130000
           PERFORM 7030-INSERT-TMDSEBG-ROW.                             10140000
                                                                        10150000
      * ------------------------------------------------------------- * 10160000
      * UPDATE THE MERCHANDISE BUSINESS GROUP TABLE WITH                10170000
      * K_EMT_BUSINESS_GROUP DATA                                       10180000
      * ------------------------------------------------------------- * 10190000
       3320-UPDATE-BUS-GROUP-DATA.                                      10200000
                                                                        10210000
DAFDAF*    MOVE HM001-BUS-GRP-BUS-GP-DESC TO MDSEBG-DESC.               10220000
DAFDAF     MOVE HM001-BUS-GRP-BUS-GP-DESC TO MDSEBG-MDSEBG-DESC.        10230000
0307PK     MOVE HM001-BUS-GRP-BUS-GP-SHRT-DESC                          10240000
0307PK                                    TO MDSEBG-BUS-GP-SHRT-DESC.   10250000
           PERFORM 7031-UPDATE-TMDSEBG-ROW.                             10260000
                                                                        10270000
0307PK* ------------------------------------------------------------- * 10280000
0307PK* CREATE A BUSINESS GROUP SHORT DESCRIPTION UPDATES RECORD.       10290000
0307PK* ------------------------------------------------------------- * 10300000
0307PK 3330-CREATE-BUSGPSD-UPDTS-REC.                                   10310000
0307PK                                                                  10320000
0307PK     MOVE HM001-BUS-GRP-BUS-GP-NBR  TO HM017-BUS-GRP-BUS-GP-NBR.  10330000
0307PK     MOVE HM001-BUS-GRP-BUS-GP-SHRT-DESC                          10340000
0307PK                               TO HM017-BUS-GRP-BUS-GP-SHRT-DESC. 10350000
0307PK     MOVE MDSEBG-BUS-GP-SHRT-DESC                                 10360000
0307PK                               TO HM017-BUS-GRP-OLD-SHRT-DESC.    10370000
0307PK     MOVE ZERO                      TO HM017-BUS-GRP-DEPT.        10380000
0307PK     PERFORM 8150-WRITE-BUSGP-UPDTS-REC.                          10390000
                                                                        10400000
      * ------------------------------------------------------------- * 10410000
      * PROCESS THE DEPS ATTRIBUTES TABLE MESSAGES FOR TMDSEDP          10420000
      * ------------------------------------------------------------- * 10430000
       3400-PROCESS-DEPS-ATTRS-MSGS.                                    10440000
                                                                        10450000
           MOVE '3400-PROCESS-DEPS-ATTRS-MSGS' TO  PV-PARAGRAPH.        10460000
                                                                        10470000
           ADD 1 TO PA-DEPS-ATTRS-MSGS.                                 10480000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            10490000
                                                                        10500000
           IF HM001-ACTN-TYP-INSERT                                     10510000
             OR HM001-ACTN-TYP-UPDATE                                   10520000
               IF HM001-DEPATTR-MLC-MISC                                10530000
                   SET PV-DPTDIS-CDE-MISC TO TRUE                       10540000
               ELSE                                                     10550000
                   IF HM001-DEPATTR-MLC-HARDLINES                       10560000
                       SET PV-DPTDIS-CDE-HARDLINES TO TRUE              10570000
                   ELSE                                                 10580000
                     IF HM001-DEPATTR-MLC-SOFTLINES                     10590000
                         SET PV-DPTDIS-CDE-SOFTLINES TO TRUE            10600000
                     ELSE                                               10610000
                         MOVE 'INVALID MDSE_LNE_CDE VALUE' TO PV-MESSAGE10620000
                         DISPLAY '*************************************'10630000
                         DISPLAY '**  ERROR     **'                     10640000
                         DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME     10650000
                         DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH    10660000
                         DISPLAY '**  MESSAGE   **  = ' PV-MESSAGE      10670000
                         DISPLAY '*************************************'10680000
                         PERFORM 9910-WRITE-ERROR-RECORD                10690000
                         SET PS-STOP-REC-PROCESSING TO TRUE             10700000
                     END-IF                                             10710000
                   END-IF                                               10720000
               END-IF                                                   10730000
           END-IF.                                                      10740000
                                                                        10750000
           IF PS-DONT-STOP-REC-PROCESS                                  10760000
               MOVE HM001-DEPATTR-DEPT        TO PV-FOUR-DIGIT-NUM      10770000
               MOVE PV-THREE-DIGIT-CHAR       TO MDSEAR-DEPT-NBR        10780000
               PERFORM 7810-GET-DEPT-MDSEAR-INFO                        10790000
           END-IF.                                                      10800000
                                                                        10810000
           IF PS-DONT-STOP-REC-PROCESS                                  10820000
               IF HM001-ACTN-TYP-INSERT                                 10830000
                   PERFORM 3410-INSERT-MERCH-DEPT-DATA                  10840000
               ELSE                                                     10850000
                   MOVE MDSEAR-DKEY TO MDSEDP-MDSEAR-DKEY               10860000
                   IF HM001-ACTN-TYP-UPDATE                             10870000
                       PERFORM 7045-SELECT-TMDSEDP-DATA                 10880000
                       IF PS-DONT-STOP-REC-PROCESS                      10890000
                           IF HM001-DEPATTR-BUS-GP-NBR NOT =            10900000
                                 MDSEDP-MDSEBG-NBR                      10910000
                               PERFORM 3430-CREATE-DPTBUSGP-UPDTS-REC   10920000
                           END-IF                                       10930000
                           IF PS-NO-INPUT-REC-ERROR                     10940000
                               PERFORM 3420-UPDATE-MERCH-DEPT-DATA      10950000
                           END-IF                                       10960000
                       END-IF                                           10970000
                   END-IF                                               10980000
               END-IF                                                   10990000
           END-IF.                                                      11000000
                                                                        11010000
      * ------------------------------------------------------------- * 11020000
      * INSERT A NEW ROW IN THE MERCHANDISE DEPARTMENT TABLE            11030000
      * WITH K_EMT_DEPS_ATTRIBUTES DATA                                 11040000
      * ------------------------------------------------------------- * 11050000
       3410-INSERT-MERCH-DEPT-DATA.                                     11060000
                                                                        11070000
           MOVE MDSEAR-DKEY                 TO MDSEDP-MDSEAR-DKEY.      11080000
           MOVE PV-CURRENT-DATE             TO MDSEDP-CHG-DTE.          11090000
           MOVE HM001-DEPATTR-BUS-GP-NBR    TO MDSEDP-MDSEBG-NBR.       11100000
           MOVE PV-DPTDIS-CDE               TO MDSEDP-DPTDIS-CDE.       11110000
           MOVE PV-CURRENT-DATE             TO MDSEDP-ARDEPT-CHG-DTE.   11120000
           MOVE MDSEAR-DESC                 TO MDSEDP-ARDEPT-DESC.      11130000
           MOVE 'N'                         TO MDSEDP-CONS-IND.         11140000
           MOVE ZERO                        TO MDSEDP-PLAN-FRGT-PCT.    11150000
           MOVE 'Y'                         TO MDSEDP-SKU-LVL-UPD-IND.  11160000
           MOVE 'Y'                         TO MDSEDP-VS-MGT-CNVER-IND. 11170000
           MOVE HM001-DEPATTR-DAYS-BEF-SHIP TO MDSEDP-DAYS-BEF-SHIP-NBR.11180000
           MOVE HM001-DEPATTR-DAYS-AFT-CLR  TO MDSEDP-DAYS-AFT-CLR-NBR. 11190000
           MOVE HM001-DEPATTR-STR-ZN-CDE    TO MDSEDP-STR-ZN-ID.        11200000
           PERFORM 7040-INSERT-TMDSEDP-ROW.                             11210000
                                                                        11220000
           IF PS-DONT-STOP-REC-PROCESS                                  11230000
               PERFORM 6100-ADD-DPT-SHRINK                              11240000
           END-IF.                                                      11250000
                                                                        11260000
      * ------------------------------------------------------------- * 11270000
      * UPDATE THE MERCHANDISE DEPARTMENT TABLE DATA WITH               11280000
      * K_EMT_DEPS_ATTRIBUTES DATA                                      11290000
      * ------------------------------------------------------------- * 11300000
       3420-UPDATE-MERCH-DEPT-DATA.                                     11310000
                                                                        11320000
           IF HM001-DEPATTR-BUS-GP-NBR NOT = MDSEDP-MDSEBG-NBR          11330000
             OR PV-DPTDIS-CDE NOT = MDSEDP-DPTDIS-CDE                   11340000
             OR HM001-DEPATTR-DAYS-BEF-SHIP NOT =                       11350000
                                                MDSEDP-DAYS-BEF-SHIP-NBR11360000
             OR HM001-DEPATTR-DAYS-AFT-CLR NOT = MDSEDP-DAYS-AFT-CLR-NBR11370000
             OR HM001-DEPATTR-STR-ZN-CDE NOT = MDSEDP-STR-ZN-ID         11380000
               MOVE PV-CURRENT-DATE         TO MDSEDP-CHG-DTE           11390000
               MOVE HM001-DEPATTR-BUS-GP-NBR TO MDSEDP-MDSEBG-NBR       11400000
               IF MDSEDP-DPTDIS-CDE NOT EQUAL PV-DPTDIS-CDE             11410000
                   MOVE PV-CURRENT-DATE     TO MDSEDP-ARDEPT-CHG-DTE    11420000
               END-IF                                                   11430000
               MOVE PV-DPTDIS-CDE           TO MDSEDP-DPTDIS-CDE        11440000
               MOVE HM001-DEPATTR-DAYS-BEF-SHIP                         11450000
                                            TO MDSEDP-DAYS-BEF-SHIP-NBR 11460000
               MOVE HM001-DEPATTR-DAYS-AFT-CLR                          11470000
                                            TO MDSEDP-DAYS-AFT-CLR-NBR  11480000
               MOVE HM001-DEPATTR-STR-ZN-CDE TO MDSEDP-STR-ZN-ID        11490000
               PERFORM 7041-UPDATE-TMDSEDP-ROW                          11500000
           END-IF.                                                      11510000
                                                                        11520000
      * ------------------------------------------------------------- * 11530000
      * CREATE A DEPARTMENT'S BUSINESS GROUP CHANGE UPDATES RECORD.     11540000
      * ------------------------------------------------------------- * 11550000
       3430-CREATE-DPTBUSGP-UPDTS-REC.                                  11560000
                                                                        11570000
           MOVE HM001-DEPATTR-BUS-GP-NBR  TO HM017-BUS-GRP-BUS-GP-NBR   11580000
DAFDAF*                                      MDSEBG-NBR.                11590000
DAFDAF                                MDSEBG-MDSEBG-NBR.                11600000
           PERFORM 7033-SELECT-TMDSEBG-SHRT-DESC.                       11610000
           IF SQLCODE = ZERO                                            11620000
               MOVE MDSEBG-BUS-GP-SHRT-DESC                             11630000
                                      TO HM017-BUS-GRP-BUS-GP-SHRT-DESC 11640000
               MOVE HM001-DEPATTR-DEPT TO HM017-BUS-GRP-DEPT            11650000
               PERFORM 8150-WRITE-BUSGP-UPDTS-REC                       11660000
           ELSE                                                         11670000
               MOVE '3430-CREATE-DPTBUSGP-UPDTS-REC' TO PV-PARAGRAPH    11680000
               MOVE 'SELECT ROW '                    TO PV-ACTION       11690000
               MOVE 'BAD SQLCODE FOR SELECT TMDSEBG' TO PV-MESSAGE      11700000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   11710000
               PERFORM 9900-PROCESS-DB2-ERROR                           11720000
           END-IF.                                                      11730000
                                                                        11740000
      * ------------------------------------------------------------- * 11750000
      * PROCESS THE DIVISION TABLE MESSAGES                           * 11760000
      * ------------------------------------------------------------- * 11770000
       3500-PROCESS-DIVISION-MSGS.                                      11780000
                                                                        11790000
           MOVE '3500-PROCESS-DIVISION-MSGS' TO  PV-PARAGRAPH.          11800000
                                                                        11810000
           ADD 1 TO PA-DIVISION-MSGS.                                   11820000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            11830000
                                                                        11840000
           MOVE PC-OPER-CO                TO MDSEAR-OPERCO-NBR.         11850000
           MOVE HM001-DIV-DIVISION        TO PV-FOUR-DIGIT-NUM.         11860000
           MOVE PV-TWO-DIGIT-CHAR         TO MDSEAR-GMA-NBR.            11870000
           MOVE '00'                      TO MDSEAR-DMA-NBR.            11880000
           MOVE '000'                     TO MDSEAR-DEPT-NBR.           11890000
           MOVE '00'                      TO MDSEAR-MAJ-CL-NBR.         11900000
           MOVE '000'                     TO MDSEAR-SUB-CL-NBR.         11910000
           IF HM001-ACTN-TYP-INSERT                                     11920000
               PERFORM 3510-INSERT-DIVISION-DATA                        11930000
           ELSE                                                         11940000
               IF HM001-ACTN-TYP-UPDATE                                 11950000
                   PERFORM 3520-UPDATE-DIVISION-DATA                    11960000
               ELSE                                                     11970000
                   IF HM001-ACTN-TYP-DELETE                             11980000
                       MOVE LOW-VALUES          TO PV-OLD-MERCH-DATA    11990000
                       MOVE MDSEAR-GMA-NBR      TO PV-OLD-MERCH-GMA     12000000
                       PERFORM 5030-BUILD-MBKUT008                      12010000
                       ADD 1 TO PA-DIVISION-BTCH-DELETES                12020000
                   END-IF                                               12030000
               END-IF                                                   12040000
           END-IF.                                                      12050000
      * ------------------------------------------------------------- * 12060000
      * INSERT A NEW ROW IN THE MERCHANDISE AREA TABLE WITH DIVISION    12070000
      * DATA                                                            12080000
      * ------------------------------------------------------------- * 12090000
       3510-INSERT-DIVISION-DATA.                                       12100000
                                                                        12110000
           PERFORM 7860-GET-CORP-MDSEAR-DKEY.                           12120000
                                                                        12130000
           IF PS-DONT-STOP-REC-PROCESS                                  12140000
               MOVE MDSEAR-DKEY             TO PV-PARENT-MDSEAR-DKEY    12150000
               MOVE PC-GMA-LEVEL-CD         TO MDSEAR-MDSELV-CDE        12160000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CHG-DTE           12170000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CRE-DTE           12180000
               MOVE PV-CURRENT-DATE         TO MDSEAR-STRT-DTE          12190000
               MOVE PC-DEFAULT-DATE         TO MDSEAR-END-DTE           12200000
               MOVE SPACE                   TO MDSEAR-GEN-MDSE-TYP-CDE  12210000
               MOVE HM001-DIV-DIV-NAME      TO MDSEAR-DESC              12220000
               IF HM001-DIV-BUYER = ZERO                                12230000
                   MOVE SPACES              TO MDSEAR-BYR-NBR           12240000
               ELSE                                                     12250000
                   MOVE HM001-DIV-BUYER     TO PV-FOUR-DIGIT-NUM        12260000
                   MOVE PV-THREE-DIGIT-CHAR TO MDSEAR-BYR-NBR           12270000
               END-IF                                                   12280000
               STRING MDSEAR-OPERCO-NBR                                 12290000
                      MDSEAR-GMA-NBR                                    12300000
                      MDSEAR-DMA-NBR                                    12310000
                      MDSEAR-DEPT-NBR                                   12320000
                      MDSEAR-MAJ-CL-NBR                                 12330000
                      MDSEAR-SUB-CL-NBR                                 12340000
                      PC-ZERO-CHAR                                      12350000
                          DELIMITED BY SIZE                             12360000
                      INTO PV-FIFTEEN-DIGIT-CHAR                        12370000
               MOVE PV-FIFTEEN-DIGIT-NUM    TO MDSEAR-LIST-SEQ-NBR      12380000
               PERFORM 7820-GET-MAX-MDSEAR-DKEY                         12390000
               IF PS-DONT-STOP-REC-PROCESS                              12400000
                   COMPUTE MDSEAR-DKEY = MDSEAR-DKEY + 1                12410000
                   PERFORM 7050-INSERT-TMDSEAR-GMA-ROW                  12420000
               END-IF                                                   12430000
           END-IF.                                                      12440000
                                                                        12450000
           IF PS-DONT-STOP-REC-PROCESS                                  12460000
               MOVE PC-DEFAULT-GMM-UID TO WORKER-UID-NBR                12470000
               MOVE PC-GMM             TO RSPBAR-RSPLVL-CDE             12480000
               PERFORM 6200-ADD-RESPB-AREA                              12490000
           END-IF.                                                      12500000
                                                                        12510000
           IF PS-DONT-STOP-REC-PROCESS                                  12520000
               PERFORM 6000-ADD-APPL-SYS-AVAIL                          12530000
           END-IF.                                                      12540000
                                                                        12550000
      * ------------------------------------------------------------- * 12560000
      * UPDATE THE MERCHANDISE AREA TABLE WITH DIVISION DATA            12570000
      * ------------------------------------------------------------- * 12580000
       3520-UPDATE-DIVISION-DATA.                                       12590000
                                                                        12600000
           MOVE HM001-DIV-DIV-NAME        TO MDSEAR-DESC.               12610000
           IF HM001-DIV-BUYER = ZERO                                    12620000
               MOVE SPACES                TO MDSEAR-BYR-NBR             12630000
           ELSE                                                         12640000
               MOVE HM001-DIV-BUYER       TO PV-FOUR-DIGIT-NUM          12650000
               MOVE PV-THREE-DIGIT-CHAR   TO MDSEAR-BYR-NBR             12660000
           END-IF.                                                      12670000
           MOVE PV-CURRENT-DATE           TO MDSEAR-CHG-DTE.            12680000
           PERFORM 7051-UPDATE-TMDSEAR-GMA-ROW.                         12690000
                                                                        12700000
      * ------------------------------------------------------------- * 12710000
      * PROCESS THE GROUPS TABLE MESSAGES                             * 12720000
      * ------------------------------------------------------------- * 12730000
       3600-PROCESS-GROUPS-MESSAGES.                                    12740000
                                                                        12750000
           MOVE '3600-PROCESS-GROUPS-MESSAGES' TO  PV-PARAGRAPH.        12760000
                                                                        12770000
           ADD 1 TO PA-GROUPS-MSGS.                                     12780000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            12790000
                                                                        12800000
           MOVE PC-OPER-CO                TO MDSEAR-OPERCO-NBR.         12810000
           MOVE HM001-GRPS-GROUP-NO       TO PV-FOUR-DIGIT-NUM.         12820000
           MOVE PV-TWO-DIGIT-CHAR         TO MDSEAR-DMA-NBR.            12830000
           MOVE '000'                     TO MDSEAR-DEPT-NBR.           12840000
           MOVE '00'                      TO MDSEAR-MAJ-CL-NBR.         12850000
           MOVE '000'                     TO MDSEAR-SUB-CL-NBR.         12860000
           IF HM001-ACTN-TYP-INSERT                                     12870000
               PERFORM 3610-INSERT-GROUPS-DATA                          12880000
           ELSE                                                         12890000
               IF HM001-ACTN-TYP-UPDATE                                 12900000
                   PERFORM 3620-UPDATE-GROUPS-DATA                      12910000
               ELSE                                                     12920000
                   IF HM001-ACTN-TYP-DELETE                             12930000
                       MOVE LOW-VALUES          TO PV-OLD-MERCH-DATA    12940000
                       MOVE HM001-GRPS-DIVISION TO PV-FOUR-DIGIT-NUM    12950000
                       MOVE PV-TWO-DIGIT-CHAR   TO PV-OLD-MERCH-GMA     12960000
                       MOVE MDSEAR-DMA-NBR      TO PV-OLD-MERCH-DMA     12970000
                       PERFORM 5030-BUILD-MBKUT008                      12980000
                       ADD 1 TO PA-GROUPS-BATCH-DELETES                 12990000
                   END-IF                                               13000000
               END-IF                                                   13010000
           END-IF.                                                      13020000
                                                                        13030000
      * ------------------------------------------------------------- * 13040000
      * INSERT A NEW ROW IN THE MERCHANDISE AREA TABLE WITH GROUPS      13050000
      * DATA                                                            13060000
      * ------------------------------------------------------------- * 13070000
       3610-INSERT-GROUPS-DATA.                                         13080000
                                                                        13090000
           MOVE HM001-GRPS-DIVISION       TO PV-FOUR-DIGIT-NUM.         13100000
           MOVE PV-TWO-DIGIT-CHAR         TO MDSEAR-GMA-NBR.            13110000
           PERFORM 7800-GET-GMA-MDSEAR-INFO.                            13120000
                                                                        13130000
           IF PS-DONT-STOP-REC-PROCESS                                  13140000
               MOVE MDSEAR-DKEY             TO PV-PARENT-MDSEAR-DKEY    13150000
               MOVE HM001-GRPS-DIVISION     TO PV-FOUR-DIGIT-NUM        13160000
               MOVE PV-TWO-DIGIT-CHAR       TO MDSEAR-GMA-NBR           13170000
               MOVE PC-DMA-LEVEL-CD         TO MDSEAR-MDSELV-CDE        13180000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CHG-DTE           13190000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CRE-DTE           13200000
               MOVE PV-CURRENT-DATE         TO MDSEAR-STRT-DTE          13210000
               MOVE PC-DEFAULT-DATE         TO MDSEAR-END-DTE           13220000
               MOVE HM001-GRPS-GROUP-NAME   TO MDSEAR-DESC              13230000
               IF HM001-GRPS-BUYER = ZERO                               13240000
                   MOVE SPACES              TO MDSEAR-BYR-NBR           13250000
               ELSE                                                     13260000
                   MOVE HM001-GRPS-BUYER    TO PV-FOUR-DIGIT-NUM        13270000
                   MOVE PV-THREE-DIGIT-CHAR TO MDSEAR-BYR-NBR           13280000
               END-IF                                                   13290000
               STRING MDSEAR-OPERCO-NBR                                 13300000
                      MDSEAR-GMA-NBR                                    13310000
                      MDSEAR-DMA-NBR                                    13320000
                      MDSEAR-DEPT-NBR                                   13330000
                      MDSEAR-MAJ-CL-NBR                                 13340000
                      MDSEAR-SUB-CL-NBR                                 13350000
                      PC-ZERO-CHAR                                      13360000
                          DELIMITED BY SIZE                             13370000
                      INTO PV-FIFTEEN-DIGIT-CHAR                        13380000
               MOVE PV-FIFTEEN-DIGIT-NUM    TO MDSEAR-LIST-SEQ-NBR      13390000
               PERFORM 7820-GET-MAX-MDSEAR-DKEY                         13400000
               IF PS-DONT-STOP-REC-PROCESS                              13410000
                   COMPUTE MDSEAR-DKEY = MDSEAR-DKEY + 1                13420000
                   PERFORM 7060-INSERT-TMDSEAR-DMA-ROW                  13430000
               END-IF                                                   13440000
           END-IF.                                                      13450000
                                                                        13460000
           IF PS-DONT-STOP-REC-PROCESS                                  13470000
               MOVE PC-DEFAULT-DMM-UID TO WORKER-UID-NBR                13480000
               MOVE PC-DMM             TO RSPBAR-RSPLVL-CDE             13490000
               PERFORM 6200-ADD-RESPB-AREA                              13500000
           END-IF.                                                      13510000
                                                                        13520000
           IF PS-DONT-STOP-REC-PROCESS                                  13530000
               PERFORM 6000-ADD-APPL-SYS-AVAIL                          13540000
           END-IF.                                                      13550000
                                                                        13560000
      * ------------------------------------------------------------- * 13570000
      * UPDATE THE MERCHANDISE AREA TABLE WITH GROUPS DATA              13580000
      * ------------------------------------------------------------- * 13590000
       3620-UPDATE-GROUPS-DATA.                                         13600000
                                                                        13610000
           PERFORM 7830-GET-DMA-MDSEAR-INFO.                            13620000
                                                                        13630000
           IF PS-DONT-STOP-REC-PROCESS                                  13640000
               IF HM001-GRPS-BUYER = ZERO                               13650000
                   MOVE SPACES                TO PV-THREE-DIGIT-CHAR    13660000
               ELSE                                                     13670000
                   MOVE HM001-GRPS-BUYER      TO PV-FOUR-DIGIT-NUM      13680000
               END-IF                                                   13690000
               MOVE HM001-GRPS-BUYER          TO PV-FOUR-DIGIT-NUM      13700000
               IF HM001-GRPS-GROUP-NAME NOT = MDSEAR-DESC               13710000
                 OR PV-THREE-DIGIT-CHAR NOT = MDSEAR-BYR-NBR            13720000
                   MOVE HM001-GRPS-GROUP-NAME TO MDSEAR-DESC            13730000
                   MOVE PV-THREE-DIGIT-CHAR   TO MDSEAR-BYR-NBR         13740000
                   MOVE PV-CURRENT-DATE       TO MDSEAR-CHG-DTE         13750000
                   PERFORM 7061-UPDATE-TMDSEAR-DMA-ROW                  13760000
               END-IF                                                   13770000
           END-IF.                                                      13780000
                                                                        13790000
           IF PS-DONT-STOP-REC-PROCESS                                  13800000
               MOVE HM001-GRPS-DIVISION     TO PV-FOUR-DIGIT-NUM        13810000
               IF PV-TWO-DIGIT-CHAR NOT = MDSEAR-GMA-NBR                13820000
                   MOVE LOW-VALUES          TO PV-OLD-MERCH-DATA        13830000
                   MOVE MDSEAR-GMA-NBR      TO PV-OLD-MERCH-GMA         13840000
                   MOVE MDSEAR-DMA-NBR      TO PV-OLD-MERCH-DMA         13850000
                   MOVE LOW-VALUES          TO PV-NEW-MERCH-DATA        13860000
                   MOVE PV-TWO-DIGIT-CHAR   TO PV-NEW-MERCH-GMA         13870000
                   MOVE MDSEAR-DMA-NBR      TO PV-NEW-MERCH-DMA         13880000
                   MOVE LOW-VALUES          TO PV-NEW-BUYER-NUMBER      13890000
                   PERFORM 5010-BUILD-MBKUT007                          13900000
                   ADD 1 TO PA-GROUPS-BATCH-UPDATES                     13910000
               END-IF                                                   13920000
           END-IF.                                                      13930000
                                                                        13940000
      * ------------------------------------------------------------- * 13950000
      * PROCESS THE DEPS TABLE MESSAGES                                 13960000
      * ------------------------------------------------------------- * 13970000
       3700-PROCESS-DEPS-MESSAGES.                                      13980000
                                                                        13990000
           MOVE '3700-PROCESS-DEPS-MESSAGES' TO PV-PARAGRAPH.           14000000
                                                                        14010000
           ADD 1 TO PA-DEPS-MSGS.                                       14020000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            14030000
                                                                        14040000
           MOVE PC-OPER-CO                TO MDSEAR-OPERCO-NBR.         14050000
           MOVE HM001-DEPS-DEPT           TO PV-FOUR-DIGIT-NUM.         14060000
           MOVE PV-THREE-DIGIT-CHAR       TO MDSEAR-DEPT-NBR.           14070000
           MOVE '00'                      TO MDSEAR-MAJ-CL-NBR.         14080000
           MOVE '000'                     TO MDSEAR-SUB-CL-NBR.         14090000
           IF HM001-ACTN-TYP-INSERT                                     14100000
               PERFORM 3710-INSERT-DEPS-DATA                            14110000
           ELSE                                                         14120000
               IF HM001-ACTN-TYP-UPDATE                                 14130000
                   PERFORM 3720-UPDATE-DEPS-DATA                        14140000
               ELSE                                                     14150000
                   IF HM001-ACTN-TYP-DELETE                             14160000
                       PERFORM 7810-GET-DEPT-MDSEAR-INFO                14170000
                       MOVE LOW-VALUES          TO PV-OLD-MERCH-DATA    14180000
                       MOVE MDSEAR-GMA-NBR      TO PV-OLD-MERCH-GMA     14190000
                       MOVE MDSEAR-DMA-NBR      TO PV-OLD-MERCH-DMA     14200000
                       MOVE MDSEAR-DEPT-NBR     TO PV-OLD-MERCH-DPT     14210000
                       PERFORM 5030-BUILD-MBKUT008                      14220000
                       ADD 1 TO PA-DEPS-BATCH-DELETES                   14230000
                   END-IF                                               14240000
               END-IF                                                   14250000
           END-IF.                                                      14260000
                                                                        14270000
      * ------------------------------------------------------------- * 14280000
      * INSERT A NEW ROW IN THE MERCHANDISE AREA TABLE WITH DEPS        14290000
      * DATA                                                            14300000
      * ------------------------------------------------------------- * 14310000
       3710-INSERT-DEPS-DATA.                                           14320000
                                                                        14330000
           MOVE HM001-DEPS-GROUP-NO       TO PV-FOUR-DIGIT-NUM.         14340000
           MOVE PV-TWO-DIGIT-CHAR         TO MDSEAR-DMA-NBR.            14350000
           PERFORM 7830-GET-DMA-MDSEAR-INFO.                            14360000
                                                                        14370000
           IF PS-DONT-STOP-REC-PROCESS                                  14380000
               MOVE MDSEAR-DKEY             TO PV-PARENT-MDSEAR-DKEY    14390000
               MOVE PC-DPT-LEVEL-CD         TO MDSEAR-MDSELV-CDE        14400000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CHG-DTE           14410000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CRE-DTE           14420000
               MOVE PV-CURRENT-DATE         TO MDSEAR-STRT-DTE          14430000
               MOVE PC-DEFAULT-DATE         TO MDSEAR-END-DTE           14440000
               MOVE SPACE                   TO MDSEAR-GEN-MDSE-TYP-CDE  14450000
               MOVE HM001-DEPS-DEPT-NAME    TO MDSEAR-DESC              14460000
               IF HM001-DEPS-BUYER = ZERO                               14470000
                   MOVE SPACES              TO MDSEAR-BYR-NBR           14480000
               ELSE                                                     14490000
                   MOVE HM001-DEPS-BUYER    TO PV-FOUR-DIGIT-NUM        14500000
                   MOVE PV-THREE-DIGIT-CHAR TO MDSEAR-BYR-NBR           14510000
               END-IF                                                   14520000
               STRING MDSEAR-OPERCO-NBR                                 14530000
                      MDSEAR-GMA-NBR                                    14540000
                      MDSEAR-DMA-NBR                                    14550000
                      MDSEAR-DEPT-NBR                                   14560000
                      MDSEAR-MAJ-CL-NBR                                 14570000
                      MDSEAR-SUB-CL-NBR                                 14580000
                      PC-ZERO-CHAR                                      14590000
                          DELIMITED BY SIZE                             14600000
                      INTO PV-FIFTEEN-DIGIT-CHAR                        14610000
               MOVE PV-FIFTEEN-DIGIT-NUM    TO MDSEAR-LIST-SEQ-NBR      14620000
               PERFORM 7820-GET-MAX-MDSEAR-DKEY                         14630000
               IF PS-DONT-STOP-REC-PROCESS                              14640000
                   COMPUTE MDSEAR-DKEY = MDSEAR-DKEY + 1                14650000
                   PERFORM 7070-INSERT-TMDSEAR-DPT-ROW                  14660000
               END-IF                                                   14670000
           END-IF.                                                      14680000
                                                                        14690000
           IF PS-DONT-STOP-REC-PROCESS                                  14700000
               MOVE PC-DEFAULT-BYR-UID TO WORKER-UID-NBR                14710000
               MOVE PC-BYR             TO RSPBAR-RSPLVL-CDE             14720000
               PERFORM 6200-ADD-RESPB-AREA                              14730000
           END-IF.                                                      14740000
                                                                        14750000
           IF PS-DONT-STOP-REC-PROCESS                                  14760000
               PERFORM 6000-ADD-APPL-SYS-AVAIL                          14770000
           END-IF.                                                      14780000
                                                                        14790000
      * ------------------------------------------------------------- * 14800000
      * UPDATE THE MERCHANDISE AREA TABLE WITH DEPS DATA                14810000
      * ------------------------------------------------------------- * 14820000
       3720-UPDATE-DEPS-DATA.                                           14830000
                                                                        14840000
           PERFORM 7810-GET-DEPT-MDSEAR-INFO.                           14850000
                                                                        14860000
           IF PS-DONT-STOP-REC-PROCESS                                  14870000
               IF HM001-DEPS-DEPT-NAME NOT = MDSEAR-DESC                14880000
                   MOVE HM001-DEPS-DEPT-NAME  TO MDSEAR-DESC            14890000
                   MOVE PV-CURRENT-DATE       TO MDSEAR-CHG-DTE         14900000
                   PERFORM 7071-UPDATE-TMDSEAR-DPT-ROW                  14910000
               END-IF                                                   14920000
           END-IF.                                                      14930000
                                                                        14940000
           IF PS-DONT-STOP-REC-PROCESS                                  14950000
               MOVE HM001-DEPS-GROUP-NO     TO PV-FOUR-DIGIT-NUM        14960000
               IF PV-TWO-DIGIT-CHAR NOT = MDSEAR-DMA-NBR                14970000
                   IF HM001-DEPS-BUYER = ZERO                           14980000
                       MOVE SPACES          TO PV-THREE-DIGIT-CHAR      14990000
                   ELSE                                                 15000000
                       MOVE HM001-DEPS-BUYER TO PV-FOUR-DIGIT-NUM       15010000
                   END-IF                                               15020000
                   IF PV-THREE-DIGIT-CHAR   NOT = MDSEAR-BYR-NBR        15030000
                       MOVE PV-THREE-DIGIT-CHAR TO PV-NEW-BUYER-NUMBER  15040000
HMISUE             ELSE                                                 15050008
HMISUE                 MOVE LOW-VALUES          TO PV-NEW-BUYER-NUMBER  15060008
                   END-IF                                               15070000
                   MOVE LOW-VALUES          TO PV-OLD-MERCH-DATA        15080000
                   MOVE MDSEAR-GMA-NBR      TO PV-OLD-MERCH-GMA         15090000
                   MOVE MDSEAR-DMA-NBR      TO PV-OLD-MERCH-DMA         15100000
                   MOVE MDSEAR-DEPT-NBR     TO PV-OLD-MERCH-DPT         15110000
                   MOVE LOW-VALUES          TO PV-NEW-MERCH-DATA        15120000
                   MOVE HM001-DEPS-GROUP-NO TO PV-FOUR-DIGIT-NUM        15130000
                   MOVE PV-TWO-DIGIT-CHAR   TO MDSEAR-DMA-NBR           15140000
                   PERFORM 7830-GET-DMA-MDSEAR-INFO                     15150000
                   MOVE MDSEAR-GMA-NBR      TO PV-NEW-MERCH-GMA         15160000
                   MOVE PV-TWO-DIGIT-CHAR   TO PV-NEW-MERCH-DMA         15170000
                   MOVE MDSEAR-DEPT-NBR     TO PV-NEW-MERCH-DPT         15180000
                   PERFORM 5010-BUILD-MBKUT007                          15190000
                   ADD 1 TO PA-DEPS-BTCH-DMA-UPDATES                    15200000
               ELSE                                                     15210000
                   IF HM001-DEPS-BUYER = ZERO                           15220000
                       MOVE SPACES          TO PV-THREE-DIGIT-CHAR      15230000
                   ELSE                                                 15240000
                       MOVE HM001-DEPS-BUYER TO PV-FOUR-DIGIT-NUM       15250000
                   END-IF                                               15260000
                   IF PV-THREE-DIGIT-CHAR   NOT = MDSEAR-BYR-NBR        15270000
                       MOVE PV-THREE-DIGIT-CHAR TO PV-NEW-BUYER-NUMBER  15280000
                       PERFORM 5020-BUILD-MBKUT006                      15290000
                       ADD 1 TO PA-DEPS-BTCH-BYR-UPDATES                15300000
                   END-IF                                               15310000
               END-IF                                                   15320000
           END-IF.                                                      15330000
                                                                        15340000
      * ------------------------------------------------------------- * 15350000
      * PROCESS THE DEPS ATTRIBUTE TABLE MESSAGES FOR TMDSEAR           15360000
      * ------------------------------------------------------------- * 15370000
       3800-PROCESS-DEPS-ATTRS-MDSEAR.                                  15380000
                                                                        15390000
           MOVE '3800-PROCESS-DEPS-ATTRS-MDSEAR' TO PV-PARAGRAPH.       15400000
                                                                        15410000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            15420000
                                                                        15430000
           IF HM001-ACTN-TYP-INSERT                                     15440000
             OR HM001-ACTN-TYP-UPDATE                                   15450000
               IF HM001-DEPATTR-MLC-MISC                                15460000
                   SET PV-MDSEAR-CDE-MISC TO TRUE                       15470000
               ELSE                                                     15480000
                   IF HM001-DEPATTR-MLC-HARDLINES                       15490000
                       SET PV-MDSEAR-CDE-HARDLINES TO TRUE              15500000
                   ELSE                                                 15510000
                     IF HM001-DEPATTR-MLC-SOFTLINES                     15520000
                         SET PV-MDSEAR-CDE-SOFTLINES TO TRUE            15530000
                     ELSE                                               15540000
                       MOVE 'INVALID MDSE_LNE_CDE VALUE' TO PV-MESSAGE  15550000
                       DISPLAY '*************************************'  15560000
                       DISPLAY '**  ERROR     **'                       15570000
                       DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME       15580000
                       DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH      15590000
                       DISPLAY '**  MESSAGE   **  = ' PV-MESSAGE        15600000
                       DISPLAY '*************************************'  15610000
                       PERFORM 9910-WRITE-ERROR-RECORD                  15620000
                       SET PS-STOP-REC-PROCESSING TO TRUE               15630000
                     END-IF                                             15640000
                   END-IF                                               15650000
               END-IF                                                   15660000
                                                                        15670000
               IF PS-DONT-STOP-REC-PROCESS                              15680000
                   MOVE HM001-DEPATTR-DEPT     TO PV-FOUR-DIGIT-NUM     15690000
                   MOVE PV-THREE-DIGIT-CHAR    TO MDSEAR-DEPT-NBR       15700000
                   PERFORM 7810-GET-DEPT-MDSEAR-INFO                    15710000
               END-IF                                                   15720000
                                                                        15730000
               IF PS-DONT-STOP-REC-PROCESS                              15740000
                   PERFORM 3810-UPDATE-DEPS-ATTRS-DATA                  15750000
               END-IF                                                   15760000
           END-IF.                                                      15770000
                                                                        15780000
      * ------------------------------------------------------------- * 15790000
      * UPDATE THE MERCHANDISE AREA TABLE WITH DEPS ATTRIBUTES DATA     15800000
      * ------------------------------------------------------------- * 15810000
       3810-UPDATE-DEPS-ATTRS-DATA.                                     15820000
                                                                        15830000
           IF PV-MDSEAR-CDE NOT = MDSEAR-GEN-MDSE-TYP-CDE               15840000
0102RM*      OR (HM001-DEPATTR-INV-OH-VAR-PCT NOT =                     15850000
0102RM*                                      MDSEAR-PHY-INV-OH-VAR-PCT) 15860000
0102RM*      OR (HM001-DEPATTR-INV-OH-VAR-QTY NOT =                     15870000
0102RM*                                      MDSEAR-PHY-INV-OH-VAR-QTY) 15880000
               MOVE PV-MDSEAR-CDE       TO MDSEAR-GEN-MDSE-TYP-CDE      15890000
0102RM*        MOVE HM001-DEPATTR-INV-OH-VAR-PCT                        15900000
0102RM*                                 TO MDSEAR-PHY-INV-OH-VAR-PCT    15910000
0102RM*        IF MDSEAR-PHY-INV-OH-VAR-PCT = ZERO                      15920000
0102RM*            MOVE -1              TO PV-PCT-NULL                  15930000
0102RM*        ELSE                                                     15940000
0102RM*            MOVE ZERO            TO PV-PCT-NULL                  15950000
0102RM*        END-IF                                                   15960000
0102RM*        MOVE HM001-DEPATTR-INV-OH-VAR-QTY                        15970000
0102RM*                                 TO MDSEAR-PHY-INV-OH-VAR-QTY    15980000
0102RM*        IF MDSEAR-PHY-INV-OH-VAR-QTY = ZERO                      15990000
0102RM*            MOVE -1              TO PV-QTY-NULL                  16000000
0102RM*        ELSE                                                     16010000
0102RM*            MOVE ZERO            TO PV-QTY-NULL                  16020000
0102RM*        END-IF                                                   16030000
               MOVE PV-CURRENT-DATE     TO MDSEAR-CHG-DTE               16040000
               PERFORM 7080-UPDATE-TMDSEAR-DPT-ATTRS                    16050000
           END-IF.                                                      16060000
                                                                        16070000
      * ------------------------------------------------------------- * 16080000
      * PROCESS THE CLASS TABLE MESSAGES                                16090000
      * ------------------------------------------------------------- * 16100000
       3900-PROCESS-CLASS-MESSAGES.                                     16110000
                                                                        16120000
           MOVE '3900-PROCESS-CLASS-MESSAGES' TO PV-PARAGRAPH.          16130000
                                                                        16140000
           ADD 1 TO PA-CLASS-MSGS.                                      16150000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            16160000
                                                                        16170000
           MOVE PC-OPER-CO                TO MDSEAR-OPERCO-NBR.         16180000
           MOVE HM001-CLASS-DEPT          TO PV-FOUR-DIGIT-NUM.         16190000
           MOVE PV-THREE-DIGIT-CHAR       TO MDSEAR-DEPT-NBR.           16200000
           MOVE HM001-CLASS-CLASS         TO PV-FOUR-DIGIT-NUM.         16210000
           MOVE PV-TWO-DIGIT-CHAR         TO MDSEAR-MAJ-CL-NBR.         16220000
           MOVE '000'                     TO MDSEAR-SUB-CL-NBR.         16230000
           IF HM001-ACTN-TYP-INSERT                                     16240000
               PERFORM 3910-INSERT-CLASS-DATA                           16250000
           ELSE                                                         16260000
               PERFORM 7840-GET-CLASS-MDSEAR-INFO                       16270000
               IF PS-DONT-STOP-REC-PROCESS                              16280000
                   IF HM001-ACTN-TYP-UPDATE                             16290000
                       PERFORM 3920-UPDATE-CLASS-DATA                   16300000
                   ELSE                                                 16310000
                       IF HM001-ACTN-TYP-DELETE                         16320000
                           PERFORM 3930-DELETE-CLASS-DATA               16330000
                       END-IF                                           16340000
                   END-IF                                               16350000
               END-IF                                                   16360000
           END-IF.                                                      16370000
                                                                        16380000
      * ------------------------------------------------------------- * 16390000
      * INSERT A NEW ROW IN THE MERCHANDISE AREA TABLE WITH CLASS       16400000
      * DATA                                                            16410000
      * ------------------------------------------------------------- * 16420000
       3910-INSERT-CLASS-DATA.                                          16430000
                                                                        16440000
           PERFORM 7810-GET-DEPT-MDSEAR-INFO.                           16450000
                                                                        16460000
           IF PS-DONT-STOP-REC-PROCESS                                  16470000
               MOVE MDSEAR-DKEY             TO PV-PARENT-MDSEAR-DKEY    16480000
               MOVE PC-MCL-LEVEL-CD         TO MDSEAR-MDSELV-CDE        16490000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CHG-DTE           16500000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CRE-DTE           16510000
               MOVE PV-CURRENT-DATE         TO MDSEAR-STRT-DTE          16520000
               MOVE PC-DEFAULT-DATE         TO MDSEAR-END-DTE           16530000
               MOVE HM001-CLASS-CLASS-NAME  TO MDSEAR-DESC              16540000
               STRING MDSEAR-OPERCO-NBR                                 16550000
                      MDSEAR-GMA-NBR                                    16560000
                      MDSEAR-DMA-NBR                                    16570000
                      MDSEAR-DEPT-NBR                                   16580000
                      MDSEAR-MAJ-CL-NBR                                 16590000
                      MDSEAR-SUB-CL-NBR                                 16600000
                      PC-ZERO-CHAR                                      16610000
                          DELIMITED BY SIZE                             16620000
                      INTO PV-FIFTEEN-DIGIT-CHAR                        16630000
               MOVE PV-FIFTEEN-DIGIT-NUM    TO MDSEAR-LIST-SEQ-NBR      16640000
               PERFORM 7820-GET-MAX-MDSEAR-DKEY                         16650000
               IF PS-DONT-STOP-REC-PROCESS                              16660000
                   COMPUTE MDSEAR-DKEY = MDSEAR-DKEY + 1                16670000
                   PERFORM 7090-INSERT-TMDSEAR-MCL-ROW                  16680000
               END-IF                                                   16690000
           END-IF.                                                      16700000
                                                                        16710000
           IF PS-DONT-STOP-REC-PROCESS                                  16720000
               PERFORM 6000-ADD-APPL-SYS-AVAIL                          16730000
           END-IF.                                                      16740000
                                                                        16750000
      * ------------------------------------------------------------- * 16760000
      * UPDATE THE MERCHANDISE AREA TABLE WITH CLASS DATA               16770000
      * ------------------------------------------------------------- * 16780000
       3920-UPDATE-CLASS-DATA.                                          16790000
                                                                        16800000
           IF HM001-CLASS-CLASS-NAME NOT = MDSEAR-DESC                  16810000
               MOVE HM001-CLASS-CLASS-NAME TO MDSEAR-DESC               16820000
               MOVE PV-CURRENT-DATE        TO MDSEAR-CHG-DTE            16830000
               PERFORM 7091-UPDATE-TMDSEAR-MCL-ROW                      16840000
           END-IF.                                                      16850000
                                                                        16860000
      * ------------------------------------------------------------- * 16870000
      * CREATE A BATCH DELETE MERCHANDISE AREA TABLE CLASS DATA RECORD  16880000
      * ------------------------------------------------------------- * 16890000
       3930-DELETE-CLASS-DATA.                                          16900000
                                                                        16910000
           MOVE LOW-VALUES              TO PV-OLD-MERCH-DATA.           16920000
           MOVE MDSEAR-GMA-NBR          TO PV-OLD-MERCH-GMA.            16930000
           MOVE MDSEAR-DMA-NBR          TO PV-OLD-MERCH-DMA.            16940000
           MOVE MDSEAR-DEPT-NBR         TO PV-OLD-MERCH-DPT.            16950000
           MOVE MDSEAR-MAJ-CL-NBR       TO PV-OLD-MERCH-MCL.            16960000
           PERFORM 5030-BUILD-MBKUT008.                                 16970000
           ADD 1 TO PA-CLASS-BATCH-DELETES.                             16980000
                                                                        16990000
      * ------------------------------------------------------------- * 17000000
      * PROCESS THE CLASS ATTRIBUTES TABLE MESSAGES                     17010000
      * ------------------------------------------------------------- * 17020000
0102RM*4000-PROCESS-CLASS-ATTRS-MSGS.                                   17030000
0102RM*                                                                 17040000
0102RM*    MOVE '4000-PROCESS-CLASS-ATTRS-MSGS' TO PV-PARAGRAPH.        17050000
0102RM*                                                                 17060000
0102RM*    ADD 1 TO PA-CLASS-ATTR-MSGS.                                 17070000
0102RM*    MOVE 'N' TO PS-STOP-REC-PROC-IND.                            17080000
0102RM*                                                                 17090000
0102RM*    MOVE HM001-CLSATTR-DEPT        TO PV-FOUR-DIGIT-NUM.         17100000
0102RM*    MOVE PV-THREE-DIGIT-CHAR       TO MDSEAR-DEPT-NBR.           17110000
0102RM*    MOVE HM001-CLSATTR-CLASS       TO PV-FOUR-DIGIT-NUM.         17120000
0102RM*    MOVE PV-TWO-DIGIT-CHAR         TO MDSEAR-MAJ-CL-NBR.         17130000
0102RM*    MOVE '000'                     TO MDSEAR-SUB-CL-NBR.         17140000
0102RM*    PERFORM 7840-GET-CLASS-MDSEAR-INFO.                          17150000
0102RM*                                                                 17160000
0102RM*    IF PS-DONT-STOP-REC-PROCESS                                  17170000
0102RM*        IF HM001-ACTN-TYP-INSERT                                 17180000
0102RM*          OR HM001-ACTN-TYP-UPDATE                               17190000
0102RM*            PERFORM 4010-UPDATE-CLASS-ATTRS-DATA                 17200000
0102RM*        ELSE                                                     17210000
0102RM*            DISPLAY '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   17220000
0102RM*            DISPLAY ' ERROR IN 4000-PROCESS-CLASS-ATTRS-MSGS'    17230000
0102RM*            DISPLAY ' INVALID ACTION TYPE CODE      '            17240000
0102RM*            DISPLAY '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'   17250000
0102RM*            PERFORM 9910-WRITE-ERROR-RECORD                      17260000
0102RM*        END-IF                                                   17270000
0102RM*    END-IF.                                                      17280000
                                                                        17290000
      * ------------------------------------------------------------- * 17300000
      * UPDATE THE MERCHANDISE AREA TABLE WITH CLASS ATTRIBUTES DATA    17310000
      * ------------------------------------------------------------- * 17320000
0102RM*4010-UPDATE-CLASS-ATTRS-DATA.                                    17330000
0102RM*                                                                 17340000
0102RM*    MOVE HM001-CLSATTR-INV-OH-VAR-PCT                            17350000
0102RM*                                 TO MDSEAR-PHY-INV-OH-VAR-PCT.   17360000
0102RM*    IF MDSEAR-PHY-INV-OH-VAR-PCT = ZERO                          17370000
0102RM*        MOVE -1                  TO PV-PCT-NULL                  17380000
0102RM*    ELSE                                                         17390000
0102RM*        MOVE ZERO                TO PV-PCT-NULL                  17400000
0102RM*    END-IF.                                                      17410000
0102RM*    MOVE HM001-CLSATTR-INV-OH-VAR-QTY                            17420000
0102RM*                                 TO MDSEAR-PHY-INV-OH-VAR-QTY.   17430000
0102RM*    IF MDSEAR-PHY-INV-OH-VAR-QTY = ZERO                          17440000
0102RM*        MOVE -1                  TO PV-QTY-NULL                  17450000
0102RM*    ELSE                                                         17460000
0102RM*        MOVE ZERO                TO PV-QTY-NULL                  17470000
0102RM*    END-IF.                                                      17480000
0102RM*    MOVE PV-CURRENT-DATE         TO MDSEAR-CHG-DTE.              17490000
0102RM*    PERFORM 7100-UPDATE-TMDSEAR-MCL-ATTRS.                       17500000
                                                                        17510000
      * ------------------------------------------------------------- * 17520000
      * PROCESS THE SUBCLASS TABLE MESSAGES                             17530000
      * ------------------------------------------------------------- * 17540000
       4100-PROCESS-SUBCLASS-MESSAGES.                                  17550000
                                                                        17560000
           MOVE '4100-PROCESS-SUBCLASS-MESSAGES' TO PV-PARAGRAPH.       17570000
                                                                        17580000
           ADD 1 TO PA-SUBCLASS-MSGS.                                   17590000
           MOVE 'N' TO PS-STOP-REC-PROC-IND.                            17600000
                                                                        17610000
           MOVE PC-OPER-CO                TO MDSEAR-OPERCO-NBR.         17620000
           MOVE HM001-SUBCL-DEPT          TO PV-FOUR-DIGIT-NUM.         17630000
           MOVE PV-THREE-DIGIT-CHAR       TO MDSEAR-DEPT-NBR.           17640000
           MOVE HM001-SUBCL-CLASS         TO PV-FOUR-DIGIT-NUM.         17650000
           MOVE PV-TWO-DIGIT-CHAR         TO MDSEAR-MAJ-CL-NBR.         17660000
           IF HM001-ACTN-TYP-INSERT                                     17670000
               PERFORM 4110-INSERT-SUBCLASS-DATA                        17680000
           ELSE                                                         17690000
               MOVE HM001-SUBCL-SUBCLASS  TO PV-FOUR-DIGIT-NUM          17700000
               MOVE PV-THREE-DIGIT-CHAR   TO MDSEAR-SUB-CL-NBR          17710000
               PERFORM 7850-GET-SUBCLASS-MDSEAR-INFO                    17720000
               IF PS-DONT-STOP-REC-PROCESS                              17730000
                   IF HM001-ACTN-TYP-UPDATE                             17740000
                       PERFORM 4120-UPDATE-SUBCLASS-DATA                17750000
                   ELSE                                                 17760000
                       IF HM001-ACTN-TYP-DELETE                         17770000
                           PERFORM 4130-DELETE-SUBCLASS-DATA            17780000
                       END-IF                                           17790000
                   END-IF                                               17800000
               END-IF                                                   17810000
           END-IF.                                                      17820000
                                                                        17830000
      * ------------------------------------------------------------- * 17840000
      * INSERT A NEW ROW IN THE MERCHANDISE AREA TABLE WITH SUBCLASS    17850000
      * DATA                                                            17860000
      * ------------------------------------------------------------- * 17870000
       4110-INSERT-SUBCLASS-DATA.                                       17880000
                                                                        17890000
           MOVE '000'                       TO MDSEAR-SUB-CL-NBR.       17900000
           PERFORM 7840-GET-CLASS-MDSEAR-INFO.                          17910000
                                                                        17920000
           IF PS-DONT-STOP-REC-PROCESS                                  17930000
               MOVE MDSEAR-DKEY             TO PV-PARENT-MDSEAR-DKEY    17940000
               MOVE HM001-SUBCL-SUBCLASS    TO PV-FOUR-DIGIT-NUM        17950000
               MOVE PV-THREE-DIGIT-CHAR     TO MDSEAR-SUB-CL-NBR        17960000
               MOVE PC-SCL-LEVEL-CD         TO MDSEAR-MDSELV-CDE        17970000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CHG-DTE           17980000
               MOVE PV-CURRENT-DATE         TO MDSEAR-CRE-DTE           17990000
               MOVE PV-CURRENT-DATE         TO MDSEAR-STRT-DTE          18000000
               MOVE PC-DEFAULT-DATE         TO MDSEAR-END-DTE           18010000
               MOVE HM001-SUBCL-SUB-NAME    TO MDSEAR-DESC              18020000
               STRING MDSEAR-OPERCO-NBR                                 18030000
                      MDSEAR-GMA-NBR                                    18040000
                      MDSEAR-DMA-NBR                                    18050000
                      MDSEAR-DEPT-NBR                                   18060000
                      MDSEAR-MAJ-CL-NBR                                 18070000
                      MDSEAR-SUB-CL-NBR                                 18080000
                      PC-ZERO-CHAR                                      18090000
                          DELIMITED BY SIZE                             18100000
                      INTO PV-FIFTEEN-DIGIT-CHAR                        18110000
               MOVE PV-FIFTEEN-DIGIT-NUM    TO MDSEAR-LIST-SEQ-NBR      18120000
               PERFORM 7820-GET-MAX-MDSEAR-DKEY                         18130000
               IF PS-DONT-STOP-REC-PROCESS                              18140000
                   COMPUTE MDSEAR-DKEY = MDSEAR-DKEY + 1                18150000
                   PERFORM 7110-INSERT-TMDSEAR-SCL-ROW                  18160000
               END-IF                                                   18170000
           END-IF.                                                      18180000
0603RM*  WR25297 - WHEN ATTEMPTING TO INSERT A SUBCLASS AND IT          18190000
0603RM*            ALREADY EXISTS, NEED TO CHECK THE END DATE.  IF      18200000
0603RM*            AN END DATE EXISTS ON TMDSEAR, THE SUBCLASS SHOULD   18210000
0603RM*            BE REACTIVATED.  IN RMS, WHEN THE SUBCLASS IS ENDED  18220000
0603RM*            IT IS PHYSICALLY DELETED FROM THE TABLE.  IN TMDSEAR 18230000
0603RM*            THE ROW IS JUST END DATED.  IF THE SUBCLASS IS RE-   18240000
0603RM*            ADDED, THE ROW ON TMDSEAR SHOULD BE REACTIVATED BY   18250000
0603RM*            MOVING '9999-09-09' TO THE END DATE.  SIMILARLY, THE 18260000
0603RM*            TAPLAVL TABLE ROWS FOR THAT MDSEAR-KEY MUST BE RE-   18270000
0603RM*            ACTIVATED.                                           18280000
0603RM     IF SQLCODE = PC-ROW-ALREADY-EXISTS                           18290000
0603RM         MOVE HM001-SUBCL-SUBCLASS  TO PV-FOUR-DIGIT-NUM          18300000
0603RM         MOVE PV-THREE-DIGIT-CHAR   TO MDSEAR-SUB-CL-NBR          18310000
0603RM         PERFORM 7855-GET-SUBCLASS-MDSEAR-DATES                   18320000
0603RM         IF PS-DONT-STOP-REC-PROCESS                              18330000
0603RM             IF MDSEAR-END-DTE < PC-DEFAULT-DATE                  18340000
0603RM                 MOVE PC-DEFAULT-DATE      TO MDSEAR-END-DTE      18350000
0603RM                 MOVE HM001-SUBCL-SUB-NAME TO MDSEAR-DESC         18360000
0603RM                 PERFORM 7112-UPDATE-TMDSEAR-SCL-DTE              18370000
0603RM                 IF PS-DONT-STOP-REC-PROCESS                      18380000
0603RM                     MOVE MDSEAR-DKEY TO APLAVL-MDSEAR-DKEY       18390000
0603RM                     PERFORM 7905-UPD-TAPLAVL-DTE                 18400000
0603RM                 END-IF                                           18410000
0603RM             END-IF                                               18420000
0603RM         END-IF                                                   18430000
0603RM     ELSE                                                         18440000
               IF PS-DONT-STOP-REC-PROCESS                              18450000
                   PERFORM 6000-ADD-APPL-SYS-AVAIL                      18460000
               END-IF                                                   18470000
0603RM     END-IF.                                                      18480000
                                                                        18490000
      * ------------------------------------------------------------- * 18500000
      * UPDATE THE MERCHANDISE AREA TABLE WITH SUBCLASS DATA            18510000
      * ------------------------------------------------------------- * 18520000
       4120-UPDATE-SUBCLASS-DATA.                                       18530000
                                                                        18540000
           IF HM001-SUBCL-SUB-NAME NOT = MDSEAR-DESC                    18550000
               MOVE HM001-SUBCL-SUB-NAME TO MDSEAR-DESC                 18560000
               MOVE PV-CURRENT-DATE      TO MDSEAR-CHG-DTE              18570000
               PERFORM 7111-UPDATE-TMDSEAR-SCL-ROW                      18580000
           END-IF.                                                      18590000
                                                                        18600000
      * ------------------------------------------------------------- * 18610000
      * CREATE A BATCH DELETE MERCHANDISE AREA TABLE SUBCLASS RECORD    18620000
      * ------------------------------------------------------------- * 18630000
       4130-DELETE-SUBCLASS-DATA.                                       18640000
                                                                        18650000
           MOVE LOW-VALUES              TO PV-OLD-MERCH-DATA.           18660000
           MOVE MDSEAR-GMA-NBR          TO PV-OLD-MERCH-GMA.            18670000
           MOVE MDSEAR-DMA-NBR          TO PV-OLD-MERCH-DMA.            18680000
           MOVE MDSEAR-DEPT-NBR         TO PV-OLD-MERCH-DPT.            18690000
           MOVE MDSEAR-MAJ-CL-NBR       TO PV-OLD-MERCH-MCL.            18700000
           MOVE MDSEAR-SUB-CL-NBR       TO PV-OLD-MERCH-SCL.            18710000
0603RM*    PERFORM 5030-BUILD-MBKUT008.                                 18720000
0603RM     MOVE LOW-VALUES           TO  HM002-HM-SUBR-RECORD.          18730000
0603RM     SET HM002-MBS-DATE-CHANGE TO  TRUE.                          18740000
0603RM     MOVE PC-OPER-CO           TO  HM002-OPERATING-CO-002.        18750000
0603RM     MOVE PV-OLD-MERCH-DATA    TO  HM002-MERCH-AREA-002.          18760000
0603RM     MOVE PV-CURRENT-DATE      TO  HM002-NEW-END-DATE-002.        18770000
0603RM                                                                  18780000
0603RM     PERFORM 4130-CALL-HMKUP002.                                  18790000
0603RM     IF HM002-GOOD-CALL                                           18800000
               ADD 1 TO PA-SUBCLASS-BATCH-DELETES                       18810000
0603RM     END-IF.                                                      18820000
                                                                        18830000
0603RM 4130-CALL-HMKUP002.                                              18840000
0603RM     CALL PC-HMKUP002-PGM USING HM002-HM-SUBR-RECORD.             18850000
                                                                        18860000
      * ------------------------------------------------------------- * 18870000
      * PROCESS THE DEPS TABLE MESSAGES FOR TMDSEDP                     18880000
      * ------------------------------------------------------------- * 18890000
       4200-PROCESS-DEPS-MDSEDP.                                        18900000
                                                                        18910000
           MOVE '4200-PROCESS-DEPS-MDSEDP' TO  PV-PARAGRAPH.            18920000
                                                                        18930000
           IF HM001-ACTN-TYP-UPDATE                                     18940000
               MOVE 'N'                    TO PS-STOP-REC-PROC-IND      18950000
               MOVE HM001-DEPS-DEPT        TO PV-FOUR-DIGIT-NUM         18960000
               MOVE PV-THREE-DIGIT-CHAR    TO MDSEAR-DEPT-NBR           18970000
               PERFORM 7810-GET-DEPT-MDSEAR-INFO                        18980000
               IF PS-DONT-STOP-REC-PROCESS                              18990000
                   MOVE MDSEAR-DKEY TO MDSEDP-MDSEAR-DKEY               19000000
                   PERFORM 7045-SELECT-TMDSEDP-DATA                     19010000
                   IF PS-DONT-STOP-REC-PROCESS                          19020000
                     AND MDSEDP-ARDEPT-DESC NOT EQUAL                   19030000
                                            HM001-DEPS-DEPT-NAME        19040000
                       MOVE PV-CURRENT-DATE TO MDSEDP-ARDEPT-CHG-DTE    19050000
                                               MDSEDP-CHG-DTE           19060000
                       MOVE HM001-DEPS-DEPT-NAME                        19070000
                                            TO MDSEDP-ARDEPT-DESC       19080000
                       PERFORM 7120-UPDATE-DEPS-TMDSEDP                 19090000
                   END-IF                                               19100000
               END-IF                                                   19110000
           END-IF.                                                      19120000
                                                                        19130000
      * ------------------------------------------------------------- * 19140000
      * PROCESS THE K_EMT_PRVT_BRND_COST_FCTR MESSAGES                  19150000
      * ------------------------------------------------------------- * 19160000
0816PK 4300-PROCESS-PRVT-BRND-MSGS.                                     19170000
                                                                        19180000
           MOVE '4300-PROCESS-PRVT-BRND-MSGS' TO  PV-PARAGRAPH.         19190000
                                                                        19200000
           ADD 1 TO PA-PRVT-BRND-MSGS.                                  19210000
                                                                        19220000
           IF HM001-ACTN-TYP-INSERT                                     19230000
               PERFORM 4310-INSERT-PRVT-BRND-DATA                       19240000
           ELSE                                                         19250000
               MOVE HM001-PRVT-BRND-DEPT TO XMT00022-DEPT-NBR           19260000
               MOVE HM001-PRVT-BRND-EFF-BEG-DTE                         19270000
                                         TO XMT00022-EFF-BEG-DTE        19280000
               IF HM001-ACTN-TYP-UPDATE                                 19290000
                   PERFORM 4320-UPDATE-PRVT-BRND-DATA                   19300000
               ELSE                                                     19310000
                   IF HM001-ACTN-TYP-DELETE                             19320000
                       PERFORM 7162-DELETE-XMT-PRVT-BRND-FCTR           19330000
                   END-IF                                               19340000
               END-IF                                                   19350000
           END-IF.                                                      19360000
                                                                        19370000
      * ------------------------------------------------------------- * 19380000
      * INSERT A NEW ROW IN THE XMT_PRVT_BRND_FCTR TABLE WITH           19390000
      * K_EMT_PRVT_BRND_COST_FCTR DATA.                                 19400000
      * ------------------------------------------------------------- * 19410000
0816PK 4310-INSERT-PRVT-BRND-DATA.                                      19420000
                                                                        19430000
           MOVE HM001-PRVT-BRND-DEPT    TO XMT00022-DEPT-NBR.           19440000
           MOVE HM001-PRVT-BRND-EFF-BEG-DTE                             19450000
                                        TO XMT00022-EFF-BEG-DTE.        19460000
           MOVE HM001-PRVT-BRND-EFF-END-DTE                             19470000
                                        TO XMT00022-EFF-END-DTE.        19480000
           IF HM001-PRVT-BRND-EFF-END-DTE = PC-DEFAULT-DATE             19490000
               MOVE -1 TO PV-EFF-END-DTE-NI                             19500000
           ELSE                                                         19510000
               MOVE +0 TO PV-EFF-END-DTE-NI                             19520000
           END-IF.                                                      19530000
           MOVE HM001-PRVT-BRND-LOD-PCT TO XMT00022-LOD-PCT.            19540000
           PERFORM 7160-INSERT-XMT-PRVT-BRND-FCTR.                      19550000
                                                                        19560000
      * ------------------------------------------------------------- * 19570000
      * UPDATE THE XMT_PRVT_BRND_FCTR TABLE WITH                        19580000
      * K_EMT_PRVT_BRND_COST_FCTR DATA.                                 19590000
      * ------------------------------------------------------------- * 19600000
0816PK 4320-UPDATE-PRVT-BRND-DATA.                                      19610000
                                                                        19620000
           MOVE HM001-PRVT-BRND-EFF-END-DTE                             19630000
                                        TO XMT00022-EFF-END-DTE.        19640000
           IF HM001-PRVT-BRND-EFF-END-DTE = PC-DEFAULT-DATE             19650000
               MOVE -1 TO PV-EFF-END-DTE-NI                             19660000
           ELSE                                                         19670000
               MOVE +0 TO PV-EFF-END-DTE-NI                             19680000
           END-IF.                                                      19690000
           MOVE HM001-PRVT-BRND-LOD-PCT TO XMT00022-LOD-PCT.            19700000
           MOVE HM001-PRVT-BRND-EFF-BEG-DTE-O                           19710000
                                         TO PV-OLD-EFF-BEG-DTE.         19720000
           PERFORM 7161-UPDATE-XMT-PRVT-BRND-FCTR.                      19730000
                                                                        19740000
      * ------------------------------------------------------------- * 19750000
      * BUILD THE REALIGNMENT BATCH CONTROL RECORD HERE.                19760000
      * ------------------------------------------------------------- * 19770000
       5010-BUILD-MBKUT007.                                             19780000
                                                                        19790000
           MOVE LOW-VALUES           TO  MB018-BATCH-CNTL-RECORD.       19800000
           SET MB018-MBS-REALIGNMENT TO  TRUE.                          19810000
           MOVE PC-OPER-CO           TO  MB018-OPERATING-CO-007.        19820000
           MOVE PV-OLD-MERCH-DATA    TO  MB018-OLD-MERCH-AREA-007.      19830000
           MOVE PV-NEW-MERCH-DATA    TO  MB018-NEW-MERCH-AREA-007.      19840000
           MOVE PV-NEW-BUYER-NUMBER  TO  MB018-NEW-BUYER-NUMBER-007.    19850000
           MOVE PV-CURRENT-DATE      TO  MB018-NEW-START-DATE-007.      19860000
                                                                        19870000
           PERFORM 5040-WRITE-BATCH-CNTL-RECORD.                        19880000
                                                                        19890000
      * ------------------------------------------------------------- * 19900000
      * BUILD THE BUYER CHANGE BATCH CONTROL RECORD HERE.               19910000
      * ------------------------------------------------------------- * 19920000
       5020-BUILD-MBKUT006.                                             19930000
                                                                        19940000
           MOVE LOW-VALUES           TO  MB018-BATCH-CNTL-RECORD.       19950000
           SET MB018-ASSIGN-BUYER-NUMBER                                19960000
                                     TO  TRUE                           19970000
           MOVE PC-OPER-CO           TO  MB018-OPERATING-CO-006.        19980000
           MOVE MDSEAR-DEPT-NBR      TO  MB018-DEPARTMENT-NUMBER-006.   19990000
           MOVE PV-NEW-BUYER-NUMBER  TO  MB018-NEW-BUYER-NUMBER-006.    20000000
           MOVE PV-CURRENT-DATE      TO  MB018-NEW-BUYER-DATE-006.      20010000
                                                                        20020000
           PERFORM 5040-WRITE-BATCH-CNTL-RECORD.                        20030000
                                                                        20040000
      * ------------------------------------------------------------- * 20050000
      * BUILD THE MBS DATE CHANGE BATCH CONTROL RECORD HERE.            20060000
      * THIS RECORD WILL BE USED TO DELETE MBS DATA.                    20070000
      * ------------------------------------------------------------- * 20080000
       5030-BUILD-MBKUT008.                                             20090000
                                                                        20100000
           MOVE LOW-VALUES           TO  MB018-BATCH-CNTL-RECORD.       20110000
           SET MB018-MBS-DATE-CHANGE TO  TRUE.                          20120000
           MOVE PC-OPER-CO           TO  MB018-OPERATING-CO-008.        20130000
           MOVE PV-OLD-MERCH-DATA    TO  MB018-MERCH-AREA-008.          20140000
           MOVE PV-CURRENT-DATE      TO  MB018-NEW-END-DATE-008.        20150000
                                                                        20160000
           PERFORM 5040-WRITE-BATCH-CNTL-RECORD.                        20170000
                                                                        20180000
      * ------------------------------------------------------------- * 20190000
      * WRITE OR REWRITE THE BATCH CONTROL RECORD HERE.                 20200000
      * ------------------------------------------------------------- * 20210000
       5040-WRITE-BATCH-CNTL-RECORD.                                    20220000
                                                                        20230000
           MOVE MB018-BATCH-CNTL-RECORD                                 20240000
                                     TO  PV-BATCH-CNTL-RECORD.          20250000
           MOVE MB018-BCR-KEY        TO  BCR-KEY.                       20260000
                                                                        20270000
           PERFORM 5045-READ-BATCH-CONTROL.                             20280000
           IF PV-GOOD-STATUS                                            20290000
               MOVE PV-BATCH-CNTL-RECORD                                20300000
                                     TO  MB018-BATCH-CNTL-RECORD        20310000
               PERFORM 5046-REWRITE-BATCH-CONTROL                       20320000
           ELSE                                                         20330000
               PERFORM 5047-WRITE-BATCH-CONTROL                         20340000
           END-IF.                                                      20350000
                                                                        20360000
      * ------------------------------------------------------------- * 20370000
      * READ THE BATCH PARAMETER CONTROL FILE TO DETERMINE WHETHER      20380000
      * THE REQUESTED RECORD TO BE ADDED ALREADY EXISTS.                20390000
      * ------------------------------------------------------------- * 20400000
       5045-READ-BATCH-CONTROL.                                         20410000
                                                                        20420000
           READ BATCH-CONTROL-FILE                                      20430000
               INTO MB018-BATCH-CNTL-RECORD                             20440000
               KEY IS BCR-KEY.                                          20450000
                                                                        20460000
           IF  PV-GOOD-STATUS                                           20470000
               CONTINUE                                                 20480000
           ELSE                                                         20490000
               IF PV-NOT-FOUND                                          20500000
                   MOVE LOW-VALUES TO MB018-BATCH-CNTL-RECORD           20510000
               ELSE                                                     20520000
                   PERFORM 8500-BACK-OUT-MQ                             20530000
                   DISPLAY '* * * * * * * * * * * * * * * * *'          20540000
                   DISPLAY '*    ***HMKUP001 ABEND***       *'          20550000
                   DISPLAY '*                               *'          20560000
                   DISPLAY '*   INVALID STATUS ON THE BATCH *'          20570000
                   DISPLAY '*   CONTROL DATASET - READ.     *'          20580000
                   DISPLAY '*                               *'          20590000
                   DISPLAY '* STATUS = '                                20600000
                           PV-VSAM-STATUS                               20610000
                           '                  *'                        20620000
                   DISPLAY '*                               *'          20630000
                   DISPLAY '* * * * * * * * * * * * * * * * *'          20640000
                   SET AC-BTCH-CNTL-INV-STATUS TO TRUE                  20650000
                   CALL 'ILBOABN0'    USING  ABEND-CODE                 20660000
               END-IF                                                   20670000
           END-IF.                                                      20680000
                                                                        20690000
      * ------------------------------------------------------------- * 20700000
      * THE VSAM RECORD ALREADY EXISTS, THEREFORE, WE MUST UPDATE IT.   20710000
      * ------------------------------------------------------------- * 20720000
       5046-REWRITE-BATCH-CONTROL.                                      20730000
      *                                                                 20740000
HMISUE*    DISPLAY PV-BATCH-CNTL-RECORD.                                20750010
           REWRITE BATCH-CONTROL-RECORD                                 20760000
               FROM PV-BATCH-CNTL-RECORD.                               20770000
      *                                                                 20780000
           IF  PV-GOOD-STATUS                                           20790000
               CONTINUE                                                 20800000
           ELSE                                                         20810000
               PERFORM 8500-BACK-OUT-MQ                                 20820000
               DISPLAY '* * * * * * * * * * * * * * * * *'              20830000
               DISPLAY '*    ***HMKUP001 ABEND***       *'              20840000
               DISPLAY '*                               *'              20850000
               DISPLAY '*   INVALID STATUS ON THE BATCH *'              20860000
               DISPLAY '*   CONTROL DATASET - REWRITE.  *'              20870000
               DISPLAY '*                               *'              20880000
               DISPLAY '* STATUS = '                                    20890000
                       PV-VSAM-STATUS                                   20900000
                       '                  *'                            20910000
               DISPLAY '*                               *'              20920000
               DISPLAY '* * * * * * * * * * * * * * * * *'              20930000
               SET AC-BTCH-CNTL-INV-STATUS TO TRUE                      20940000
               CALL 'ILBOABN0'    USING  ABEND-CODE                     20950000
           END-IF.                                                      20960000
                                                                        20970000
      * ------------------------------------------------------------- * 20980000
      * THE VSAM RECORD DOESN'T EXISTS, THEREFORE, WE MUST WRITE IT.    20990000
      * ------------------------------------------------------------- * 21000000
       5047-WRITE-BATCH-CONTROL.                                        21010000
      *                                                                 21020000
HMISUE*    DISPLAY PV-BATCH-CNTL-RECORD.                                21030010
           WRITE BATCH-CONTROL-RECORD                                   21040000
               FROM PV-BATCH-CNTL-RECORD.                               21050000
      *                                                                 21060000
           IF  PV-GOOD-STATUS                                           21070000
               CONTINUE                                                 21080000
           ELSE                                                         21090000
               PERFORM 8500-BACK-OUT-MQ                                 21100000
               DISPLAY '* * * * * * * * * * * * * * * * *'              21110000
               DISPLAY '*    ***HMKUP001 ABEND***       *'              21120000
               DISPLAY '*                               *'              21130000
               DISPLAY '*   INVALID STATUS ON THE BATCH *'              21140000
               DISPLAY '*   CONTROL DATASET - WRITE.    *'              21150000
               DISPLAY '*                               *'              21160000
               DISPLAY '* STATUS = '                                    21170000
                       PV-VSAM-STATUS                                   21180000
                       '                  *'                            21190000
               DISPLAY '*                               *'              21200000
               DISPLAY '* * * * * * * * * * * * * * * * *'              21210000
               SET AC-BTCH-CNTL-INV-STATUS TO TRUE                      21220000
               CALL 'ILBOABN0'    USING  ABEND-CODE                     21230000
           END-IF.                                                      21240000
                                                                        21250000
      * ------------------------------------------------------------- * 21260000
      * ADD THE APPLICATION AVAILABILITY ROWS (TAPLAVL).                21270000
      *   1)  USING THE DKEY OF THE PARENT OF THE MDSEAR TO BE ADDED,   21280000
      *       MATCH PARENT DKEYS ON MDSEAR AND APPL SYSTEM AVAIL.       21290000
      *       GET THE APPL SYSTEM AVAIL INFORMATION AND INSERT A NEW ROW21300000
      *       (WITH THE NEW DKEY) FOR EVERY "PARENT ROW" FOUND.         21310000
      *                                                                 21320000
      *   2)  MAKE SURE THAT APPLICATION AVAILABILITY OF PARENT MDSEAR  21330000
      *       IS WITHIN RANGE OF MDSEAR BEING ADDED. ADJUST START DATE  21340000
      *       IF NECESSARY. BYPASS APLAVL ROW IF IT IS OUTSIDE THE      21350000
      *       RANGE OF THE MERCHANDISE START AND END DATES COMPLETELY.  21360000
      * ------------------------------------------------------------- * 21370000
       6000-ADD-APPL-SYS-AVAIL.                                         21380000
                                                                        21390000
           MOVE PV-PARENT-MDSEAR-DKEY TO PV-MDSEAR-DKEY.                21400000
           PERFORM 7870-OPEN-APLAVL-CURSOR.                             21410000
           SET PS-ROW-FOUND TO TRUE.                                    21420000
           PERFORM 7880-FETCH-APPL-AVAIL-ROW.                           21430000
                                                                        21440000
           PERFORM UNTIL PS-ROW-NOT-FOUND                               21450000
                                                                        21460000
               IF APLAVL-MDSEAR-END-DTE < PV-CURRENT-DATE               21470000
                   CONTINUE                                             21480000
               ELSE                                                     21490000
                   MOVE MDSEAR-DKEY     TO APLAVL-MDSEAR-DKEY           21500000
                   MOVE PC-OPER-CO      TO APLAVL-OPERCO-NBR            21510000
                   IF APLAVL-MDSEAR-STRT-DTE < PV-CURRENT-DATE          21520000
                       MOVE PV-CURRENT-DATE    TO APLAVL-MDSEAR-STRT-DTE21530000
                   END-IF                                               21540000
                   PERFORM 7900-INSERT-APLAVL-ROW                       21550000
               END-IF                                                   21560000
                                                                        21570000
               IF PS-ROW-NOT-FOUND                                      21580000
                   MOVE 'TAPLAVL ROW NOT FOUND IN FETCH'                21590000
                                     TO PV-MESSAGE                      21600000
                   MOVE HMRD001-RECORD TO PV-INPUT-RECORD               21610000
                   PERFORM 9900-PROCESS-DB2-ERROR                       21620000
                   SET PS-STOP-REC-PROCESSING TO TRUE                   21630000
               ELSE                                                     21640000
                   PERFORM 7880-FETCH-APPL-AVAIL-ROW                    21650000
               END-IF                                                   21660000
                                                                        21670000
           END-PERFORM.                                                 21680000
                                                                        21690000
           PERFORM 7890-CLOSE-APLAVL-CURSOR.                            21700000
                                                                        21710000
      * ------------------------------------------------------------- * 21720000
      * INSERT SHRINK PERCENT ROWS IN TDPTSHK FOR THE NEW DEPARTMENT    21730000
      * ------------------------------------------------------------- * 21740000
       6100-ADD-DPT-SHRINK.                                             21750000
                                                                        21760000
           MOVE MDSEAR-DKEY               TO DPTSHK-MDSEAR-DKEY.        21770000
           PERFORM 7860-GET-FISCAL-YR-NBR.                              21780000
           IF PS-DONT-STOP-REC-PROCESS                                  21790000
               MOVE DTATTR-FSCL-YR-NBR    TO DPTSHK-SHRINK-YR-NBR       21800000
C14666         MOVE PC-N                  TO DPTSHK-E-BUS-IND           21810000
C14666         MOVE PC-SYSTEM             TO DPTSHK-LAST-UPD-BY-USR     21820000
               PERFORM 7140-INSERT-TDPTSHK-ROW                          21830000
C14666         IF PS-DONT-STOP-REC-PROCESS                              21840003
C14666             MOVE PC-Y              TO DPTSHK-E-BUS-IND           21850003
C14666             PERFORM 7140-INSERT-TDPTSHK-ROW                      21860003
C14666         END-IF                                                   21870003
           END-IF.                                                      21880000
                                                                        21890000
           IF PS-DONT-STOP-REC-PROCESS                                  21900000
               MOVE DPTSHK-SHRINK-YR-NBR  TO PV-SHRINK-YR-NBR           21910000
               SUBTRACT 1 FROM PV-SHRINK-YR-NBR                         21920000
               MOVE PV-SHRINK-YR-NBR      TO DPTSHK-SHRINK-YR-NBR       21930000
C14666         MOVE PC-N                  TO DPTSHK-E-BUS-IND           21940003
               PERFORM 7140-INSERT-TDPTSHK-ROW                          21950003
C14666         IF PS-DONT-STOP-REC-PROCESS                              21960003
C14666             MOVE PC-Y              TO DPTSHK-E-BUS-IND           21970003
C14666             PERFORM 7140-INSERT-TDPTSHK-ROW                      21980003
C14666         END-IF                                                   21990003
           END-IF.                                                      22000000
                                                                        22010000
      * ------------------------------------------------------------- * 22020000
      * INSERT A DEFAULT ROW IN TRSPBAR FOR THE NEW GMA, DMA, OR DEPT.  22030000
      * ------------------------------------------------------------- * 22040000
       6200-ADD-RESPB-AREA.                                             22050000
                                                                        22060000
           PERFORM 7910-GET-WORKER-INF0.                                22070000
           IF PS-DONT-STOP-REC-PROCESS                                  22080000
               MOVE MDSEAR-DKEY           TO RSPBAR-MDSEAR-DKEY         22090000
               MOVE WORKER-NBR            TO RSPBAR-WORKER-NBR          22100000
               MOVE WORKER-LAST-NAME      TO RSPBAR-WORKER-LAST-NAME    22110000
               MOVE WORKER-FIR-NAME       TO RSPBAR-WORKER-FIR-NAME     22120000
               MOVE PV-CURRENT-DATE       TO RSPBAR-WORKER-STRT-DTE     22130000
               MOVE PC-DEFAULT-DATE       TO RSPBAR-WORKER-END-DTE      22140000
               MOVE '03'                  TO RSPBAR-OPERCO-NBR          22150000
               PERFORM 7150-INSERT-TRSPBAR-ROW                          22160000
           END-IF.                                                      22170000
                                                                        22180000
      * ------------------------------------------------------------- * 22190000
      * INSERT THE MERCHANDISE CLASS DATA                               22200000
      * ------------------------------------------------------------- * 22210000
       7010-INSERT-TMDSECL-ROW.                                         22220000
                                                                        22230000
           MOVE '7010-INSERT-TMDSECL-ROW' TO PV-PARAGRAPH.              22240000
           MOVE 'INSERT ROW '             TO PV-ACTION.                 22250000
                                                                        22260000
           PERFORM                                                      22270000
               WITH TEST AFTER                                          22280000
               VARYING PV-SQL-SUB                                       22290000
               FROM 1 BY 1                                              22300000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        22310000
                  OR SQLCODE = 0                                        22320000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    22330000
                  OR PS-INPUT-REC-ERROR                                 22340000
      *                                                                 22350000
                 EXEC SQL                                               22360000
                     INSERT INTO TMDSECL                                22370000
                            (MDSEAR_DKEY                                22380000
                           , POS_DESC                                   22390000
                           , TAX_DFLT_IND)                              22400000
                     VALUES (:MDSECL-MDSEAR-DKEY                        22410000
                           , :MDSECL-POS-DESC                           22420000
                           , :MDSECL-TAX-DFLT-IND)                      22430000
                 END-EXEC                                               22440000
      *                                                                 22450000
               EVALUATE TRUE                                            22460000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              22470000
                   WHEN SQLCODE = PC-DEADLOCK                           22480000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 22490000
                        CONTINUE                                        22500000
                   WHEN SQLCODE = ZERO                                  22510000
                       ADD 1 TO PA-SUBCL-ATTR-INSERTS                   22520000
                   WHEN SQLWARN0 NOT = SPACE                            22530000
                   WHEN SQLCODE NOT =  ZERO                             22540000
                       MOVE 'BAD SQLCODE FOR TMDSECL INSERT'            22550000
                                     TO  PV-MESSAGE                     22560000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           22570000
                       PERFORM 9900-PROCESS-DB2-ERROR                   22580000
                       SET PS-INPUT-REC-ERROR TO TRUE                   22590000
               END-EVALUATE                                             22600000
           END-PERFORM.                                                 22610000
      *                                                                 22620000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               22630000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSECL INSERT'          22640000
                      TO PV-MESSAGE                                     22650000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   22660000
               PERFORM 9900-PROCESS-DB2-ERROR                           22670000
           END-IF.                                                      22680000
      *                                                                 22690000
0603RM*    IF SQLCODE = PC-ROW-ALREADY-EXISTS                           22700000
0603RM*        MOVE 'TMDSECL ROW ALREADY EXISTS FOR INSERT'             22710000
0603RM*                              TO  PV-MESSAGE                     22720000
0603RM*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   22730000
0603RM*        PERFORM 9900-PROCESS-DB2-ERROR                           22740000
0603RM*    END-IF.                                                      22750000
                                                                        22760000
      * ------------------------------------------------------------- * 22770000
      * UPDATE THE MERCHANDISE CLASS DATA                               22780000
      * ------------------------------------------------------------- * 22790000
       7011-UPDATE-TMDSECL-ROW.                                         22800000
                                                                        22810000
           MOVE '7011-UPDATE-TMDSECL-ROW' TO PV-PARAGRAPH.              22820000
           MOVE 'UPDATE ROW '             TO PV-ACTION.                 22830000
                                                                        22840000
           PERFORM                                                      22850000
               WITH TEST AFTER                                          22860000
               VARYING PV-SQL-SUB                                       22870000
               FROM 1 BY 1                                              22880000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        22890000
                  OR SQLCODE = 0                                        22900000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         22910000
                  OR PS-INPUT-REC-ERROR                                 22920000
      *                                                                 22930000
                 EXEC SQL                                               22940000
                     UPDATE TMDSECL                                     22950000
                     SET POS_DESC        = :MDSECL-POS-DESC             22960000
                       , TAX_DFLT_IND    = :MDSECL-TAX-DFLT-IND         22970000
                     WHERE MDSEAR_DKEY   = :MDSECL-MDSEAR-DKEY          22980000
                 END-EXEC                                               22990000
      *                                                                 23000000
               EVALUATE TRUE                                            23010000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              23020000
                   WHEN SQLCODE = PC-DEADLOCK                           23030000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      23040000
                        CONTINUE                                        23050000
                   WHEN SQLCODE = ZERO                                  23060000
                        ADD 1 TO PA-SUBCL-ATTR-UPDATES                  23070000
                   WHEN SQLWARN0 NOT = SPACE                            23080000
                   WHEN SQLCODE NOT = ZERO                              23090000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSECL'            23100000
                                     TO  PV-MESSAGE                     23110000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           23120000
                       PERFORM 9900-PROCESS-DB2-ERROR                   23130000
                       SET PS-INPUT-REC-ERROR TO TRUE                   23140000
               END-EVALUATE                                             23150000
           END-PERFORM.                                                 23160000
      *                                                                 23170000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              23180000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSECL'           23190000
                                     TO  PV-MESSAGE                     23200000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   23210000
               PERFORM 9900-PROCESS-DB2-ERROR                           23220000
           END-IF.                                                      23230000
      *                                                                 23240000
           IF SQLCODE = PC-ROW-NOT-FOUND                                23250000
               MOVE 'TMDSECL ROW NOT FOUND FOR UPDATE'                  23260000
                                     TO  PV-MESSAGE                     23270000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   23280000
               PERFORM 9900-PROCESS-DB2-ERROR                           23290000
           END-IF.                                                      23300000
                                                                        23310000
      * ------------------------------------------------------------- * 23320000
      * INSERT THE STORE ZONE TABLE DATA                                23330000
      * ------------------------------------------------------------- * 23340000
       7020-INSERT-TSTRZN-ROW.                                          23350000
                                                                        23360000
           MOVE '7020-INSERT-TSTRZN-ROW' TO PV-PARAGRAPH.               23370000
           MOVE 'INSERT ROW '             TO PV-ACTION.                 23380000
                                                                        23390000
           PERFORM                                                      23400000
               WITH TEST AFTER                                          23410000
               VARYING PV-SQL-SUB                                       23420000
               FROM 1 BY 1                                              23430000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        23440000
                  OR SQLCODE = 0                                        23450000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    23460000
                  OR PS-INPUT-REC-ERROR                                 23470000
      *                                                                 23480000
                 EXEC SQL                                               23490000
                     INSERT INTO TSTRZN                                 23500000
                            (STR_ZN_ID                                  23510000
                           , STR_ZN_DESC)                               23520000
                     VALUES (:STRZN-STR-ZN-ID                           23530000
                           , :STRZN-STR-ZN-DESC)                        23540000
                 END-EXEC                                               23550000
      *                                                                 23560000
               EVALUATE TRUE                                            23570000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              23580000
                   WHEN SQLCODE = PC-DEADLOCK                           23590000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 23600000
                        CONTINUE                                        23610000
                   WHEN SQLCODE = ZERO                                  23620000
                       ADD 1 TO PA-CODE-DETAIL-INSERTS                  23630000
                   WHEN SQLWARN0 NOT = SPACE                            23640000
                   WHEN SQLCODE NOT =  ZERO                             23650000
                       MOVE 'BAD SQLCODE FOR TSTRZN INSERT'             23660000
                                     TO  PV-MESSAGE                     23670000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           23680000
                       PERFORM 9900-PROCESS-DB2-ERROR                   23690000
                       SET PS-INPUT-REC-ERROR TO TRUE                   23700000
               END-EVALUATE                                             23710000
           END-PERFORM.                                                 23720000
      *                                                                 23730000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               23740000
               MOVE  'MAX RETRIES EXCEEDED FOR TSTRZN INSERT'           23750000
                      TO PV-MESSAGE                                     23760000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   23770000
               PERFORM 9900-PROCESS-DB2-ERROR                           23780000
           END-IF.                                                      23790000
      *                                                                 23800000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           23810000
               MOVE 'TSTRZN ROW ALREADY EXISTS FOR INSERT'              23820000
                                     TO  PV-MESSAGE                     23830000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   23840000
               PERFORM 9900-PROCESS-DB2-ERROR                           23850000
           END-IF.                                                      23860000
                                                                        23870000
      * ------------------------------------------------------------- * 23880000
      * UPDATE THE STORE ZONE TABLE DATA                                23890000
      * ------------------------------------------------------------- * 23900000
       7021-UPDATE-TSTRZN-ROW.                                          23910000
                                                                        23920000
           MOVE '7021-UPDATE-TSTRZN-ROW' TO PV-PARAGRAPH.               23930000
           MOVE 'UPDATE ROW '             TO PV-ACTION.                 23940000
                                                                        23950000
           PERFORM                                                      23960000
               WITH TEST AFTER                                          23970000
               VARYING PV-SQL-SUB                                       23980000
               FROM 1 BY 1                                              23990000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        24000000
                  OR SQLCODE = 0                                        24010000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         24020000
                  OR PS-INPUT-REC-ERROR                                 24030000
      *                                                                 24040000
                 EXEC SQL                                               24050000
                     UPDATE TSTRZN                                      24060000
                     SET STR_ZN_DESC = :STRZN-STR-ZN-DESC               24070000
                     WHERE STR_ZN_ID = :STRZN-STR-ZN-ID                 24080000
                 END-EXEC                                               24090000
      *                                                                 24100000
               EVALUATE TRUE                                            24110000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              24120000
                   WHEN SQLCODE = PC-DEADLOCK                           24130000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      24140000
                        CONTINUE                                        24150000
                   WHEN SQLCODE = ZERO                                  24160000
                        ADD 1 TO PA-CODE-DETAIL-UPDATES                 24170000
                   WHEN SQLWARN0 NOT = SPACE                            24180000
                   WHEN SQLCODE NOT = ZERO                              24190000
                       MOVE 'BAD SQLCODE FOR UPDATE TSTRZN'             24200000
                                     TO  PV-MESSAGE                     24210000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           24220000
                       PERFORM 9900-PROCESS-DB2-ERROR                   24230000
                       SET PS-INPUT-REC-ERROR TO TRUE                   24240000
               END-EVALUATE                                             24250000
           END-PERFORM.                                                 24260000
      *                                                                 24270000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              24280000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TSTRZN'            24290000
                                     TO  PV-MESSAGE                     24300000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   24310000
               PERFORM 9900-PROCESS-DB2-ERROR                           24320000
           END-IF.                                                      24330000
      *                                                                 24340000
           IF SQLCODE = PC-ROW-NOT-FOUND                                24350000
               MOVE 'TSTRZN ROW NOT FOUND FOR UPDATE'                   24360000
                                     TO  PV-MESSAGE                     24370000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   24380000
               PERFORM 9900-PROCESS-DB2-ERROR                           24390000
           END-IF.                                                      24400000
                                                                        24410000
      * ------------------------------------------------------------- * 24420000
      * DELETE THE STORE ZONE TABLE DATA                                24430000
      * ------------------------------------------------------------- * 24440000
       7022-DELETE-TSTRZN-ROW.                                          24450000
                                                                        24460000
           MOVE '7022-DELETE-TSTRZN-ROW' TO PV-PARAGRAPH.               24470000
           MOVE 'DELETE ROW '             TO PV-ACTION.                 24480000
                                                                        24490000
           PERFORM                                                      24500000
               WITH TEST AFTER                                          24510000
               VARYING PV-SQL-SUB                                       24520000
               FROM 1 BY 1                                              24530000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        24540000
                  OR SQLCODE = 0                                        24550000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         24560000
                  OR PS-INPUT-REC-ERROR                                 24570000
      *                                                                 24580000
                 EXEC SQL                                               24590000
                     DELETE FROM TSTRZN                                 24600000
                     WHERE STR_ZN_ID = :STRZN-STR-ZN-ID                 24610000
                 END-EXEC                                               24620000
      *                                                                 24630000
               EVALUATE TRUE                                            24640000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              24650000
                   WHEN SQLCODE = PC-DEADLOCK                           24660000
                        CONTINUE                                        24670000
                   WHEN SQLCODE = ZERO                                  24680000
                        ADD 1 TO PA-CODE-DETAIL-DELETES                 24690000
                   WHEN SQLWARN0 NOT = SPACE                            24700000
                   WHEN SQLCODE NOT = ZERO                              24710000
                       MOVE 'BAD SQLCODE FOR DELETE TSTRZN'             24720000
                                     TO  PV-MESSAGE                     24730000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           24740000
                       PERFORM 9900-PROCESS-DB2-ERROR                   24750000
                       SET PS-INPUT-REC-ERROR TO TRUE                   24760000
               END-EVALUATE                                             24770000
           END-PERFORM.                                                 24780000
      *                                                                 24790000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              24800000
               MOVE 'MAX RETRIES EXCEEDED FOR DELETE TSTRZN'            24810000
                                     TO  PV-MESSAGE                     24820000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   24830000
               PERFORM 9900-PROCESS-DB2-ERROR                           24840000
           END-IF.                                                      24850000
      *                                                                 24860000
           IF SQLCODE = PC-ROW-NOT-FOUND                                24870000
               MOVE 'TSTRZN ROW NOT FOUND FOR DELETE'                   24880000
                                     TO  PV-MESSAGE                     24890000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   24900000
               PERFORM 9900-PROCESS-DB2-ERROR                           24910000
           END-IF.                                                      24920000
                                                                        24930000
      * ------------------------------------------------------------- * 24940000
      * INSERT THE MERCHANDISE BUSINESS GROUP TABLE DATA                24950000
      * ------------------------------------------------------------- * 24960000
       7030-INSERT-TMDSEBG-ROW.                                         24970000
                                                                        24980000
           MOVE '7030-INSERT-TMDSEBG-ROW' TO PV-PARAGRAPH.              24990000
           MOVE 'INSERT ROW '             TO PV-ACTION.                 25000000
                                                                        25010000
           PERFORM                                                      25020000
               WITH TEST AFTER                                          25030000
               VARYING PV-SQL-SUB                                       25040000
               FROM 1 BY 1                                              25050000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        25060000
                  OR SQLCODE = 0                                        25070000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    25080000
                  OR PS-INPUT-REC-ERROR                                 25090000
      *                                                                 25100000
                 EXEC SQL                                               25110000
                     INSERT INTO TMDSEBG                                25120000
                            (MDSEBG_NBR                                 25130000
                           , MDSEBG_DESC                                25140000
0307PK                     , BUS_GP_SHRT_DESC)                          25150000
DAFDAF*              VALUES (:MDSEBG-NBR                                25160000
DAFDAF               VALUES (:MDSEBG-MDSEBG-NBR                         25170000
DAFDAF*                    , :MDSEBG-DESC                               25180000
DAFDAF                     , :MDSEBG-MDSEBG-DESC                        25190000
0307PK                     , :MDSEBG-BUS-GP-SHRT-DESC)                  25200000
                 END-EXEC                                               25210000
      *                                                                 25220000
               EVALUATE TRUE                                            25230000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              25240000
                   WHEN SQLCODE = PC-DEADLOCK                           25250000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 25260000
                        CONTINUE                                        25270000
                   WHEN SQLCODE = ZERO                                  25280000
                       ADD 1 TO PA-BUS-GROUP-INSERTS                    25290000
                   WHEN SQLWARN0 NOT = SPACE                            25300000
                   WHEN SQLCODE NOT =  ZERO                             25310000
                       MOVE 'BAD SQLCODE FOR TMDSEBG INSERT'            25320000
                                     TO  PV-MESSAGE                     25330000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           25340000
                       PERFORM 9900-PROCESS-DB2-ERROR                   25350000
                       SET PS-INPUT-REC-ERROR TO TRUE                   25360000
               END-EVALUATE                                             25370000
           END-PERFORM.                                                 25380000
      *                                                                 25390000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               25400000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSEBG INSERT'          25410000
                      TO PV-MESSAGE                                     25420000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   25430000
               PERFORM 9900-PROCESS-DB2-ERROR                           25440000
           END-IF.                                                      25450000
      *                                                                 25460000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           25470000
               MOVE 'TMDSEBG ROW ALREADY EXISTS FOR INSERT'             25480000
                                     TO  PV-MESSAGE                     25490000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   25500000
               PERFORM 9900-PROCESS-DB2-ERROR                           25510000
           END-IF.                                                      25520000
                                                                        25530000
      * ------------------------------------------------------------- * 25540000
      * UPDATE THE MERCHANDISE BUSINESS GROUP TABLE DATA                25550000
      * ------------------------------------------------------------- * 25560000
       7031-UPDATE-TMDSEBG-ROW.                                         25570000
                                                                        25580000
           MOVE '7031-UPDATE-TMDSEBG-ROW' TO PV-PARAGRAPH.              25590000
           MOVE 'UPDATE ROW '             TO PV-ACTION.                 25600000
                                                                        25610000
           PERFORM                                                      25620000
               WITH TEST AFTER                                          25630000
               VARYING PV-SQL-SUB                                       25640000
               FROM 1 BY 1                                              25650000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        25660000
                  OR SQLCODE = 0                                        25670000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         25680000
                  OR PS-INPUT-REC-ERROR                                 25690000
      *                                                                 25700000
                 EXEC SQL                                               25710000
                     UPDATE TMDSEBG                                     25720000
DAFDAF*              SET MDSEBG_DESC      = :MDSEBG-DESC                25730000
DAFDAF               SET MDSEBG_DESC      = :MDSEBG-MDSEBG-DESC         25740000
0307PK                  ,BUS_GP_SHRT_DESC = :MDSEBG-BUS-GP-SHRT-DESC    25750000
DAFDAF*              WHERE MDSEBG_NBR     = :MDSEBG-NBR                 25760000
DAFDAF               WHERE MDSEBG_NBR     = :MDSEBG-MDSEBG-NBR          25770000
                 END-EXEC                                               25780000
      *                                                                 25790000
               EVALUATE TRUE                                            25800000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              25810000
                   WHEN SQLCODE = PC-DEADLOCK                           25820000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      25830000
                        CONTINUE                                        25840000
                   WHEN SQLCODE = ZERO                                  25850000
                        ADD 1 TO PA-BUS-GROUP-UPDATES                   25860000
                   WHEN SQLWARN0 NOT = SPACE                            25870000
                   WHEN SQLCODE NOT = ZERO                              25880000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEBG'            25890000
                                     TO  PV-MESSAGE                     25900000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           25910000
                       PERFORM 9900-PROCESS-DB2-ERROR                   25920000
                       SET PS-INPUT-REC-ERROR TO TRUE                   25930000
               END-EVALUATE                                             25940000
           END-PERFORM.                                                 25950000
      *                                                                 25960000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              25970000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEBG'           25980000
                                     TO  PV-MESSAGE                     25990000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   26000000
               PERFORM 9900-PROCESS-DB2-ERROR                           26010000
           END-IF.                                                      26020000
      *                                                                 26030000
           IF SQLCODE = PC-ROW-NOT-FOUND                                26040000
               MOVE 'TMDSEBG ROW NOT FOUND FOR UPDATE'                  26050000
                                     TO  PV-MESSAGE                     26060000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   26070000
               PERFORM 9900-PROCESS-DB2-ERROR                           26080000
           END-IF.                                                      26090000
                                                                        26100000
      * ------------------------------------------------------------- * 26110000
      * DELETE THE MERCHANDISE BUSINESS GROUP TABLE DATA                26120000
      * ------------------------------------------------------------- * 26130000
       7032-DELETE-TMDSEBG-ROW.                                         26140000
                                                                        26150000
           MOVE '7032-DELETE-TMDSEBG-ROW' TO PV-PARAGRAPH.              26160000
           MOVE 'DELETE ROW '             TO PV-ACTION.                 26170000
                                                                        26180000
           PERFORM                                                      26190000
               WITH TEST AFTER                                          26200000
               VARYING PV-SQL-SUB                                       26210000
               FROM 1 BY 1                                              26220000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        26230000
                  OR SQLCODE = 0                                        26240000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         26250000
                  OR PS-INPUT-REC-ERROR                                 26260000
      *                                                                 26270000
                 EXEC SQL                                               26280000
                     DELETE FROM TMDSEBG                                26290000
DAFDAF*              WHERE MDSEBG_NBR = :MDSEBG-NBR                     26300000
DAFDAF               WHERE MDSEBG_NBR = :MDSEBG-MDSEBG-NBR              26310000
                 END-EXEC                                               26320000
      *                                                                 26330000
               EVALUATE TRUE                                            26340000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              26350000
                   WHEN SQLCODE = PC-DEADLOCK                           26360000
                        CONTINUE                                        26370000
                   WHEN SQLCODE = ZERO                                  26380000
                        ADD 1 TO PA-BUS-GROUP-DELETES                   26390000
                   WHEN SQLWARN0 NOT = SPACE                            26400000
                   WHEN SQLCODE NOT = ZERO                              26410000
                       MOVE 'BAD SQLCODE FOR DELETE TMDSEBG'            26420000
                                     TO  PV-MESSAGE                     26430000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           26440000
                       PERFORM 9900-PROCESS-DB2-ERROR                   26450000
                       SET PS-INPUT-REC-ERROR TO TRUE                   26460000
               END-EVALUATE                                             26470000
           END-PERFORM.                                                 26480000
      *                                                                 26490000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              26500000
               MOVE 'MAX RETRIES EXCEEDED FOR DELETE TMDSEBG'           26510000
                                     TO  PV-MESSAGE                     26520000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   26530000
               PERFORM 9900-PROCESS-DB2-ERROR                           26540000
           END-IF.                                                      26550000
      *                                                                 26560000
           IF SQLCODE = PC-ROW-NOT-FOUND                                26570000
               MOVE 'TMDSEBG ROW NOT FOUND FOR DELETE'                  26580000
                                     TO  PV-MESSAGE                     26590000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   26600000
               PERFORM 9900-PROCESS-DB2-ERROR                           26610000
           END-IF.                                                      26620000
                                                                        26630000
      * ------------------------------------------------------------- * 26640000
      * SELECT THE MERCHANDISE BUSINESS GROUP SHORT DESCRIPTION         26650000
      * ------------------------------------------------------------- * 26660000
       7033-SELECT-TMDSEBG-SHRT-DESC.                                   26670000
                                                                        26680000
           MOVE '7033-SELECT-TMDSEBG-SHRT-DESC' TO PV-PARAGRAPH.        26690000
           MOVE 'SELECT ROW '                   TO PV-ACTION.           26700000
                                                                        26710000
           PERFORM                                                      26720000
               WITH TEST AFTER                                          26730000
               VARYING PV-SQL-SUB                                       26740000
               FROM 1 BY 1                                              26750000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        26760000
                  OR SQLCODE = 0                                        26770000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         26780000
                  OR PS-INPUT-REC-ERROR                                 26790000
      *                                                                 26800000
                 EXEC SQL                                               26810000
                     SELECT BUS_GP_SHRT_DESC                            26820000
                       INTO :MDSEBG-BUS-GP-SHRT-DESC                    26830000
                       FROM TMDSEBG                                     26840000
DAFDAF*              WHERE MDSEBG_NBR = :MDSEBG-NBR                     26850000
DAFDAF               WHERE MDSEBG_NBR = :MDSEBG-MDSEBG-NBR              26860000
                 END-EXEC                                               26870000
      *                                                                 26880000
               EVALUATE TRUE                                            26890000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              26900000
                   WHEN SQLCODE = PC-DEADLOCK                           26910000
                   WHEN SQLCODE = ZERO                                  26920000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      26930000
                        CONTINUE                                        26940000
                   WHEN SQLWARN0 NOT = SPACE                            26950000
                   WHEN SQLCODE NOT = ZERO                              26960000
                       MOVE 'BAD SQLCODE FOR SELECT TMDSEBG'            26970000
                                     TO  PV-MESSAGE                     26980000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           26990000
                       PERFORM 9900-PROCESS-DB2-ERROR                   27000000
                       SET PS-INPUT-REC-ERROR TO TRUE                   27010000
               END-EVALUATE                                             27020000
           END-PERFORM.                                                 27030000
      *                                                                 27040000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              27050000
               MOVE 'MAX RETRIES EXCEEDED FOR SELECT TMDSEBG'           27060000
                                     TO  PV-MESSAGE                     27070000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   27080000
               PERFORM 9900-PROCESS-DB2-ERROR                           27090000
           END-IF.                                                      27100000
                                                                        27110000
      * ------------------------------------------------------------- * 27120000
      * INSERT THE MERCHANDISE DEPARTMENT DATA                          27130000
      * ------------------------------------------------------------- * 27140000
       7040-INSERT-TMDSEDP-ROW.                                         27150000
                                                                        27160000
           MOVE '7040-INSERT-TMDSEDP-ROW' TO PV-PARAGRAPH.              27170000
           MOVE 'INSERT ROW '             TO PV-ACTION.                 27180000
                                                                        27190000
           PERFORM                                                      27200000
               WITH TEST AFTER                                          27210000
               VARYING PV-SQL-SUB                                       27220000
               FROM 1 BY 1                                              27230000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        27240000
                  OR SQLCODE = 0                                        27250000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    27260000
                  OR PS-STOP-REC-PROCESSING                             27270000
      *                                                                 27280000
                 EXEC SQL                                               27290000
                     INSERT INTO TMDSEDP                                27300000
                            (MDSEAR_DKEY                                27310000
                           , CHG_DTE                                    27320000
                           , MDSEBG_NBR                                 27330000
                           , DPTDIS_CDE                                 27340000
                           , ARDEPT_CHG_DTE                             27350000
                           , ARDEPT_DESC                                27360000
                           , CONS_IND                                   27370000
                           , PLAN_FRGT_PCT                              27380000
                           , SKU_LVL_UPD_IND                            27390000
                           , VS_MGT_CNVER_IND                           27400000
                           , DAYS_BEF_SHIP_NBR                          27410000
                           , DAYS_AFT_CLR_NBR                           27420000
                           , STR_ZN_ID)                                 27430000
                     VALUES (:MDSEDP-MDSEAR-DKEY                        27440000
                           , :MDSEDP-CHG-DTE                            27450000
                           , :MDSEDP-MDSEBG-NBR                         27460000
                           , :MDSEDP-DPTDIS-CDE                         27470000
                           , :MDSEDP-ARDEPT-CHG-DTE                     27480000
                           , :MDSEDP-ARDEPT-DESC                        27490000
                           , :MDSEDP-CONS-IND                           27500000
                           , :MDSEDP-PLAN-FRGT-PCT                      27510000
                           , :MDSEDP-SKU-LVL-UPD-IND                    27520000
                           , :MDSEDP-VS-MGT-CNVER-IND                   27530000
                           , :MDSEDP-DAYS-BEF-SHIP-NBR                  27540000
                           , :MDSEDP-DAYS-AFT-CLR-NBR                   27550000
                           , :MDSEDP-STR-ZN-ID)                         27560000
                 END-EXEC                                               27570000
      *                                                                 27580000
               EVALUATE TRUE                                            27590000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              27600000
                   WHEN SQLCODE = PC-DEADLOCK                           27610000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 27620000
                        CONTINUE                                        27630000
                   WHEN SQLCODE = ZERO                                  27640000
                       ADD 1 TO PA-DEPS-ATTRS-INSERTS                   27650000
                   WHEN SQLWARN0 NOT = SPACE                            27660000
                   WHEN SQLCODE NOT =  ZERO                             27670000
                       MOVE 'BAD SQLCODE FOR TMDSEDP INSERT'            27680000
                                     TO  PV-MESSAGE                     27690000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           27700000
                       PERFORM 9900-PROCESS-DB2-ERROR                   27710000
                       SET PS-STOP-REC-PROCESSING TO TRUE               27720000
               END-EVALUATE                                             27730000
           END-PERFORM.                                                 27740000
      *                                                                 27750000
      *                                                                 27760000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               27770000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSEDP INSERT'          27780000
                      TO PV-MESSAGE                                     27790000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   27800000
               PERFORM 9900-PROCESS-DB2-ERROR                           27810000
               SET PS-STOP-REC-PROCESSING TO TRUE                       27820000
           END-IF.                                                      27830000
      *                                                                 27840000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           27850000
               MOVE 'TMDSEDP ROW ALREADY EXISTS FOR INSERT'             27860000
                                     TO  PV-MESSAGE                     27870000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   27880000
               PERFORM 9900-PROCESS-DB2-ERROR                           27890000
               SET PS-STOP-REC-PROCESSING TO TRUE                       27900000
           END-IF.                                                      27910000
                                                                        27920000
      * ------------------------------------------------------------- * 27930000
      * UPDATE THE MERCHANDISE DEPARTMENT DATA                          27940000
      * ------------------------------------------------------------- * 27950000
       7041-UPDATE-TMDSEDP-ROW.                                         27960000
                                                                        27970000
           MOVE '7041-UPDATE-TMDSEDP-ROW' TO PV-PARAGRAPH.              27980000
           MOVE 'UPDATE ROW '             TO PV-ACTION.                 27990000
                                                                        28000000
           PERFORM                                                      28010000
               WITH TEST AFTER                                          28020000
               VARYING PV-SQL-SUB                                       28030000
               FROM 1 BY 1                                              28040000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        28050000
                  OR SQLCODE = 0                                        28060000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         28070000
                  OR PS-INPUT-REC-ERROR                                 28080000
      *                                                                 28090000
                 EXEC SQL                                               28100000
                     UPDATE TMDSEDP                                     28110000
                     SET CHG_DTE           = :MDSEDP-CHG-DTE            28120000
                       , MDSEBG_NBR        = :MDSEDP-MDSEBG-NBR         28130000
                       , DPTDIS_CDE        = :MDSEDP-DPTDIS-CDE         28140000
                       , ARDEPT_CHG_DTE    = :MDSEDP-ARDEPT-CHG-DTE     28150000
                       , DAYS_BEF_SHIP_NBR = :MDSEDP-DAYS-BEF-SHIP-NBR  28160000
                       , DAYS_AFT_CLR_NBR  = :MDSEDP-DAYS-AFT-CLR-NBR   28170000
                       , STR_ZN_ID         = :MDSEDP-STR-ZN-ID          28180000
                     WHERE MDSEAR_DKEY     = :MDSEDP-MDSEAR-DKEY        28190000
                 END-EXEC                                               28200000
      *                                                                 28210000
               EVALUATE TRUE                                            28220000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              28230000
                   WHEN SQLCODE = PC-DEADLOCK                           28240000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      28250000
                        CONTINUE                                        28260000
                   WHEN SQLCODE = ZERO                                  28270000
                        ADD 1 TO PA-DEPS-ATTRS-UPDATES-1                28280000
                   WHEN SQLWARN0 NOT = SPACE                            28290000
                   WHEN SQLCODE NOT = ZERO                              28300000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEDP'            28310000
                                     TO  PV-MESSAGE                     28320000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           28330000
                       PERFORM 9900-PROCESS-DB2-ERROR                   28340000
                       SET PS-INPUT-REC-ERROR TO TRUE                   28350000
               END-EVALUATE                                             28360000
           END-PERFORM.                                                 28370000
      *                                                                 28380000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              28390000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEDP'           28400000
                                     TO  PV-MESSAGE                     28410000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   28420000
               PERFORM 9900-PROCESS-DB2-ERROR                           28430000
           END-IF.                                                      28440000
      *                                                                 28450000
           IF SQLCODE = PC-ROW-NOT-FOUND                                28460000
               MOVE 'TMDSEDP ROW NOT FOUND FOR UPDATE'                  28470000
                                     TO  PV-MESSAGE                     28480000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   28490000
               PERFORM 9900-PROCESS-DB2-ERROR                           28500000
           END-IF.                                                      28510000
                                                                        28520000
      *                                                                 28530000
      *----------------------------------------------------------------*28540000
      *   GETS CURRENT MERCHANDISE DEPARTMENT DATA VALUES               28550000
      *----------------------------------------------------------------*28560000
       7045-SELECT-TMDSEDP-DATA.                                        28570000
      *                                                                 28580000
           MOVE '7045-SELECT-TMDSEDP-DATA' TO PV-PARAGRAPH.             28590000
      *                                                                 28600000
           PERFORM                                                      28610000
               WITH TEST AFTER                                          28620000
               VARYING PV-SQL-SUB                                       28630000
               FROM 1 BY 1                                              28640000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        28650000
                  OR SQLCODE = ZERO                                     28660000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         28670000
                  OR PS-STOP-REC-PROCESSING                             28680000
      *                                                                 28690000
                 EXEC SQL                                               28700000
                     SELECT MDSEBG_NBR,                                 28710000
                            DPTDIS_CDE,                                 28720000
                            ARDEPT_CHG_DTE,                             28730000
                            ARDEPT_DESC,                                28740000
                            DPTDIS_CDE,                                 28750000
                            DAYS_BEF_SHIP_NBR,                          28760000
                            DAYS_AFT_CLR_NBR,                           28770000
                            STR_ZN_ID                                   28780000
                     INTO  :MDSEDP-MDSEBG-NBR,                          28790000
                           :MDSEDP-DPTDIS-CDE,                          28800000
                           :MDSEDP-ARDEPT-CHG-DTE,                      28810000
                           :MDSEDP-ARDEPT-DESC,                         28820000
                           :MDSEDP-DPTDIS-CDE,                          28830000
                           :MDSEDP-DAYS-BEF-SHIP-NBR,                   28840000
                           :MDSEDP-DAYS-AFT-CLR-NBR,                    28850000
                           :MDSEDP-STR-ZN-ID                            28860000
                     FROM   TMDSEDP                                     28870000
                     WHERE MDSEAR_DKEY = :MDSEDP-MDSEAR-DKEY            28880000
                 END-EXEC                                               28890000
      *                                                                 28900000
               EVALUATE TRUE                                            28910000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              28920000
                   WHEN SQLCODE = PC-DEADLOCK                           28930000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      28940000
                   WHEN SQLCODE = ZERO                                  28950000
                        CONTINUE                                        28960000
                   WHEN SQLWARN0 NOT = SPACE                            28970000
                   WHEN SQLCODE NOT = ZERO                              28980000
                       MOVE 'BAD SQLCODE FOR GET TMDSEDP'               28990000
                                     TO  PV-MESSAGE                     29000000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           29010000
                       PERFORM 9900-PROCESS-DB2-ERROR                   29020000
                       SET PS-STOP-REC-PROCESSING TO TRUE               29030000
               END-EVALUATE                                             29040000
           END-PERFORM.                                                 29050000
      *                                                                 29060000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               29070000
               MOVE 'MAX RETRIES EXCEEDED FOR GET TMDSEDP'              29080000
                                     TO  PV-MESSAGE                     29090000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   29100000
               PERFORM 9900-PROCESS-DB2-ERROR                           29110000
               SET PS-STOP-REC-PROCESSING TO TRUE                       29120000
           END-IF.                                                      29130000
                                                                        29140000
           IF SQLCODE = PC-ROW-NOT-FOUND                                29150000
               MOVE 'TMDSEDP ROW NOT FOUND FOR SELECT'                  29160000
                                     TO PV-MESSAGE                      29170000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   29180000
               PERFORM 9900-PROCESS-DB2-ERROR                           29190000
               SET PS-STOP-REC-PROCESSING TO TRUE                       29200000
           END-IF.                                                      29210000
                                                                        29220000
      * ------------------------------------------------------------- * 29230000
      * INSERT THE MERCHANDISE AREA TABLE GMA DATA                      29240000
      * ------------------------------------------------------------- * 29250000
       7050-INSERT-TMDSEAR-GMA-ROW.                                     29260000
                                                                        29270000
           MOVE '7050-INSERT-TMDSEAR-GMA-ROW' TO PV-PARAGRAPH.          29280000
           MOVE 'INSERT ROW '                 TO PV-ACTION.             29290000
                                                                        29300000
           PERFORM                                                      29310000
               WITH TEST AFTER                                          29320000
               VARYING PV-SQL-SUB                                       29330000
               FROM 1 BY 1                                              29340000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        29350000
                  OR SQLCODE = 0                                        29360000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    29370000
                  OR PS-STOP-REC-PROCESSING                             29380000
      *                                                                 29390000
                 EXEC SQL                                               29400000
                     INSERT INTO TMDSEAR                                29410000
                            (OPERCO_NBR                                 29420000
                           , GMA_NBR                                    29430000
                           , DMA_NBR                                    29440000
                           , DEPT_NBR                                   29450000
                           , MAJ_CL_NBR                                 29460000
                           , SUB_CL_NBR                                 29470000
                           , MDSELV_CDE                                 29480000
                           , MDSEAR_DKEY                                29490000
                           , CHG_DTE                                    29500000
                           , CRE_DTE                                    29510000
                           , STRT_DTE                                   29520000
                           , END_DTE                                    29530000
                           , GEN_MDSE_TYP_CDE                           29540000
                           , MDSEAR_DESC                                29550000
                           , BYR_NBR                                    29560000
                           , LIST_SEQ_NBR                               29570000
                           , PHY_INV_OH_VAR_PCT                         29580000
                           , PHY_INV_OH_VAR_QTY)                        29590000
                     VALUES (:MDSEAR-OPERCO-NBR                         29600000
                           , :MDSEAR-GMA-NBR                            29610000
                           , :MDSEAR-DMA-NBR                            29620000
                           , :MDSEAR-DEPT-NBR                           29630000
                           , :MDSEAR-MAJ-CL-NBR                         29640000
                           , :MDSEAR-SUB-CL-NBR                         29650000
                           , :MDSEAR-MDSELV-CDE                         29660000
                           , :MDSEAR-DKEY                               29670000
                           , :MDSEAR-CHG-DTE                            29680000
                           , :MDSEAR-CRE-DTE                            29690000
                           , :MDSEAR-STRT-DTE                           29700000
                           , :MDSEAR-END-DTE                            29710000
                           , :MDSEAR-GEN-MDSE-TYP-CDE                   29720000
                           , :MDSEAR-DESC                               29730000
                           , :MDSEAR-BYR-NBR                            29740000
                           , :MDSEAR-LIST-SEQ-NBR                       29750000
                           , NULL                                       29760000
                           , NULL)                                      29770000
                 END-EXEC                                               29780000
      *                                                                 29790000
               EVALUATE TRUE                                            29800000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              29810000
                   WHEN SQLCODE = PC-DEADLOCK                           29820000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 29830000
                        CONTINUE                                        29840000
                   WHEN SQLCODE = ZERO                                  29850000
                       ADD 1 TO PA-DIVISION-INSERTS                     29860000
                   WHEN SQLWARN0 NOT = SPACE                            29870000
                   WHEN SQLCODE NOT =  ZERO                             29880000
                       MOVE 'BAD SQLCODE FOR TMDSEAR GMA INSERT'        29890000
                                     TO  PV-MESSAGE                     29900000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           29910000
                       PERFORM 9900-PROCESS-DB2-ERROR                   29920000
                       SET PS-STOP-REC-PROCESSING TO TRUE               29930000
               END-EVALUATE                                             29940000
           END-PERFORM.                                                 29950000
      *                                                                 29960000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               29970000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSEAR GMA INSERT'      29980000
                      TO PV-MESSAGE                                     29990000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   30000000
               PERFORM 9900-PROCESS-DB2-ERROR                           30010000
               SET PS-STOP-REC-PROCESSING TO TRUE                       30020000
           END-IF.                                                      30030000
      *                                                                 30040000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           30050000
RMSRET*        MOVE 'TMDSEAR GMA ROW ALREADY EXISTS FOR INSERT'         30060011
RMSRET*                              TO  PV-MESSAGE                     30070011
RMSRET*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   30080011
RMSRET*        PERFORM 9900-PROCESS-DB2-ERROR                           30090011
RMSRET*        SET PS-STOP-REC-PROCESSING TO TRUE                       30100011
RMSRET         ADD 1 TO PA-SKIPPED-ERRORS                               30110011
           END-IF.                                                      30120000
                                                                        30130000
      * ------------------------------------------------------------- * 30140000
      * UPDATE THE MERCHANDISE AREA TABLE GMA DATA                      30150000
      * ------------------------------------------------------------- * 30160000
       7051-UPDATE-TMDSEAR-GMA-ROW.                                     30170000
                                                                        30180000
           MOVE '7051-UPDATE-TMDSEAR-GMA-ROW' TO PV-PARAGRAPH.          30190000
           MOVE 'UPDATE ROW '                 TO PV-ACTION.             30200000
                                                                        30210000
           PERFORM                                                      30220000
               WITH TEST AFTER                                          30230000
               VARYING PV-SQL-SUB                                       30240000
               FROM 1 BY 1                                              30250000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        30260000
                  OR SQLCODE = 0                                        30270000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         30280000
                  OR PS-STOP-REC-PROCESSING                             30290000
      *                                                                 30300000
                 EXEC SQL                                               30310000
                     UPDATE TMDSEAR                                     30320000
                     SET   MDSEAR_DESC = :MDSEAR-DESC                   30330000
                         , BYR_NBR     = :MDSEAR-BYR-NBR                30340000
                         , CHG_DTE     = :MDSEAR-CHG-DTE                30350000
                     WHERE OPERCO_NBR  = :MDSEAR-OPERCO-NBR AND         30360000
                           GMA_NBR     = :MDSEAR-GMA-NBR    AND         30370000
                           DMA_NBR     = :MDSEAR-DMA-NBR    AND         30380000
                           DEPT_NBR    = :MDSEAR-DEPT-NBR   AND         30390000
                           MAJ_CL_NBR  = :MDSEAR-MAJ-CL-NBR AND         30400000
                           SUB_CL_NBR  = :MDSEAR-SUB-CL-NBR AND         30410000
                           END_DTE > DATE (CURRENT TIMESTAMP)           30420000
                 END-EXEC                                               30430000
      *                                                                 30440000
               EVALUATE TRUE                                            30450000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              30460000
                   WHEN SQLCODE = PC-DEADLOCK                           30470000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      30480000
                        CONTINUE                                        30490000
                   WHEN SQLCODE = ZERO                                  30500000
                        ADD 1 TO PA-DIVISION-UPDATES                    30510000
                   WHEN SQLWARN0 NOT = SPACE                            30520000
                   WHEN SQLCODE NOT = ZERO                              30530000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR GMA'        30540000
                                     TO  PV-MESSAGE                     30550000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           30560000
                       PERFORM 9900-PROCESS-DB2-ERROR                   30570000
                       SET PS-STOP-REC-PROCESSING TO TRUE               30580000
               END-EVALUATE                                             30590000
           END-PERFORM.                                                 30600000
      *                                                                 30610000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              30620000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR GMA'       30630000
                                     TO  PV-MESSAGE                     30640000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   30650000
               PERFORM 9900-PROCESS-DB2-ERROR                           30660000
               SET PS-STOP-REC-PROCESSING TO TRUE                       30670000
           END-IF.                                                      30680000
      *                                                                 30690000
           IF SQLCODE = PC-ROW-NOT-FOUND                                30700000
               MOVE 'TMDSEAR GMA ROW NOT FOUND FOR UPDATE'              30710000
                                     TO  PV-MESSAGE                     30720000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   30730000
               PERFORM 9900-PROCESS-DB2-ERROR                           30740000
               SET PS-STOP-REC-PROCESSING TO TRUE                       30750000
           END-IF.                                                      30760000
                                                                        30770000
      * ------------------------------------------------------------- * 30780000
      * INSERT THE MERCHANDISE AREA TABLE DMA DATA                      30790000
      * ------------------------------------------------------------- * 30800000
       7060-INSERT-TMDSEAR-DMA-ROW.                                     30810000
                                                                        30820000
           MOVE '7060-INSERT-TMDSEAR-DMA-ROW' TO PV-PARAGRAPH.          30830000
           MOVE 'INSERT ROW '                 TO PV-ACTION.             30840000
                                                                        30850000
           PERFORM                                                      30860000
               WITH TEST AFTER                                          30870000
               VARYING PV-SQL-SUB                                       30880000
               FROM 1 BY 1                                              30890000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        30900000
                  OR SQLCODE = 0                                        30910000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    30920000
                  OR PS-STOP-REC-PROCESSING                             30930000
      *                                                                 30940000
                 EXEC SQL                                               30950000
                     INSERT INTO TMDSEAR                                30960000
                            (OPERCO_NBR                                 30970000
                           , GMA_NBR                                    30980000
                           , DMA_NBR                                    30990000
                           , DEPT_NBR                                   31000000
                           , MAJ_CL_NBR                                 31010000
                           , SUB_CL_NBR                                 31020000
                           , MDSELV_CDE                                 31030000
                           , MDSEAR_DKEY                                31040000
                           , CHG_DTE                                    31050000
                           , CRE_DTE                                    31060000
                           , STRT_DTE                                   31070000
                           , END_DTE                                    31080000
                           , GEN_MDSE_TYP_CDE                           31090000
                           , MDSEAR_DESC                                31100000
                           , BYR_NBR                                    31110000
                           , LIST_SEQ_NBR                               31120000
                           , PHY_INV_OH_VAR_PCT                         31130000
                           , PHY_INV_OH_VAR_QTY)                        31140000
                     VALUES (:MDSEAR-OPERCO-NBR                         31150000
                           , :MDSEAR-GMA-NBR                            31160000
                           , :MDSEAR-DMA-NBR                            31170000
                           , :MDSEAR-DEPT-NBR                           31180000
                           , :MDSEAR-MAJ-CL-NBR                         31190000
                           , :MDSEAR-SUB-CL-NBR                         31200000
                           , :MDSEAR-MDSELV-CDE                         31210000
                           , :MDSEAR-DKEY                               31220000
                           , :MDSEAR-CHG-DTE                            31230000
                           , :MDSEAR-CRE-DTE                            31240000
                           , :MDSEAR-STRT-DTE                           31250000
                           , :MDSEAR-END-DTE                            31260000
                           , :MDSEAR-GEN-MDSE-TYP-CDE                   31270000
                           , :MDSEAR-DESC                               31280000
                           , :MDSEAR-BYR-NBR                            31290000
                           , :MDSEAR-LIST-SEQ-NBR                       31300000
                           , NULL                                       31310000
                           , NULL)                                      31320000
                 END-EXEC                                               31330000
      *                                                                 31340000
               EVALUATE TRUE                                            31350000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              31360000
                   WHEN SQLCODE = PC-DEADLOCK                           31370000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 31380000
                        CONTINUE                                        31390000
                   WHEN SQLCODE = ZERO                                  31400000
                       ADD 1 TO PA-GROUPS-INSERTS                       31410000
                   WHEN SQLWARN0 NOT = SPACE                            31420000
                   WHEN SQLCODE NOT =  ZERO                             31430000
                       MOVE 'BAD SQLCODE FOR TMDSEAR DMA INSERT'        31440000
                                     TO  PV-MESSAGE                     31450000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           31460000
                       PERFORM 9900-PROCESS-DB2-ERROR                   31470000
                       SET PS-STOP-REC-PROCESSING TO TRUE               31480000
               END-EVALUATE                                             31490000
           END-PERFORM.                                                 31500000
      *                                                                 31510000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               31520000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSEAR DMA INSERT'      31530000
                      TO PV-MESSAGE                                     31540000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   31550000
               PERFORM 9900-PROCESS-DB2-ERROR                           31560000
               SET PS-STOP-REC-PROCESSING TO TRUE                       31570000
           END-IF.                                                      31580000
      *                                                                 31590000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           31600000
RMSRET*        MOVE 'TMDSEAR DMA ROW ALREADY EXISTS FOR INSERT'         31610011
RMSRET*                              TO  PV-MESSAGE                     31620011
RMSRET*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   31630011
RMSRET*        PERFORM 9900-PROCESS-DB2-ERROR                           31640011
RMSRET*        SET PS-STOP-REC-PROCESSING TO TRUE                       31650011
RMSRET         ADD 1 TO PA-SKIPPED-ERRORS                               31660011
           END-IF.                                                      31670000
                                                                        31680000
      * ------------------------------------------------------------- * 31690000
      * UPDATE THE MERCHANDISE AREA TABLE DMA DATA                      31700000
      * ------------------------------------------------------------- * 31710000
       7061-UPDATE-TMDSEAR-DMA-ROW.                                     31720000
                                                                        31730000
           MOVE '7061-UPDATE-TMDSEAR-DMA-ROW' TO PV-PARAGRAPH.          31740000
           MOVE 'UPDATE ROW '                 TO PV-ACTION.             31750000
                                                                        31760000
           PERFORM                                                      31770000
               WITH TEST AFTER                                          31780000
               VARYING PV-SQL-SUB                                       31790000
               FROM 1 BY 1                                              31800000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        31810000
                  OR SQLCODE = 0                                        31820000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         31830000
                  OR PS-STOP-REC-PROCESSING                             31840000
      *                                                                 31850000
                 EXEC SQL                                               31860000
                     UPDATE TMDSEAR                                     31870000
                     SET   MDSEAR_DESC = :MDSEAR-DESC                   31880000
                         , BYR_NBR     = :MDSEAR-BYR-NBR                31890000
                         , CHG_DTE     = :MDSEAR-CHG-DTE                31900000
                     WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   31910000
                 END-EXEC                                               31920000
      *                                                                 31930000
               EVALUATE TRUE                                            31940000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              31950000
                   WHEN SQLCODE = PC-DEADLOCK                           31960000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      31970000
                        CONTINUE                                        31980000
                   WHEN SQLCODE = ZERO                                  31990000
                        ADD 1 TO PA-GROUPS-UPDATES                      32000000
                   WHEN SQLWARN0 NOT = SPACE                            32010000
                   WHEN SQLCODE NOT = ZERO                              32020000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR DMA'        32030000
                                     TO  PV-MESSAGE                     32040000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           32050000
                       PERFORM 9900-PROCESS-DB2-ERROR                   32060000
                       SET PS-STOP-REC-PROCESSING TO TRUE               32070000
               END-EVALUATE                                             32080000
           END-PERFORM.                                                 32090000
      *                                                                 32100000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              32110000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR DMA'       32120000
                                     TO  PV-MESSAGE                     32130000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   32140000
               PERFORM 9900-PROCESS-DB2-ERROR                           32150000
               SET PS-STOP-REC-PROCESSING TO TRUE                       32160000
           END-IF.                                                      32170000
      *                                                                 32180000
           IF SQLCODE = PC-ROW-NOT-FOUND                                32190000
               MOVE 'TMDSEAR DMA ROW NOT FOUND FOR UPDATE'              32200000
                                     TO  PV-MESSAGE                     32210000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   32220000
               PERFORM 9900-PROCESS-DB2-ERROR                           32230000
               SET PS-STOP-REC-PROCESSING TO TRUE                       32240000
           END-IF.                                                      32250000
                                                                        32260000
      * ------------------------------------------------------------- * 32270000
      * INSERT THE MERCHANDISE AREA TABLE DPT DATA                      32280000
      * ------------------------------------------------------------- * 32290000
       7070-INSERT-TMDSEAR-DPT-ROW.                                     32300000
                                                                        32310000
           MOVE '7070-INSERT-TMDSEAR-DPT-ROW' TO PV-PARAGRAPH.          32320000
           MOVE 'INSERT ROW '                 TO PV-ACTION.             32330000
                                                                        32340000
           PERFORM                                                      32350000
               WITH TEST AFTER                                          32360000
               VARYING PV-SQL-SUB                                       32370000
               FROM 1 BY 1                                              32380000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        32390000
                  OR SQLCODE = 0                                        32400000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    32410000
                  OR PS-STOP-REC-PROCESSING                             32420000
      *                                                                 32430000
                 EXEC SQL                                               32440000
                     INSERT INTO TMDSEAR                                32450000
                            (OPERCO_NBR                                 32460000
                           , GMA_NBR                                    32470000
                           , DMA_NBR                                    32480000
                           , DEPT_NBR                                   32490000
                           , MAJ_CL_NBR                                 32500000
                           , SUB_CL_NBR                                 32510000
                           , MDSELV_CDE                                 32520000
                           , MDSEAR_DKEY                                32530000
                           , CHG_DTE                                    32540000
                           , CRE_DTE                                    32550000
                           , STRT_DTE                                   32560000
                           , END_DTE                                    32570000
                           , GEN_MDSE_TYP_CDE                           32580000
                           , MDSEAR_DESC                                32590000
                           , BYR_NBR                                    32600000
                           , LIST_SEQ_NBR                               32610000
                           , PHY_INV_OH_VAR_PCT                         32620000
                           , PHY_INV_OH_VAR_QTY)                        32630000
                     VALUES (:MDSEAR-OPERCO-NBR                         32640000
                           , :MDSEAR-GMA-NBR                            32650000
                           , :MDSEAR-DMA-NBR                            32660000
                           , :MDSEAR-DEPT-NBR                           32670000
                           , :MDSEAR-MAJ-CL-NBR                         32680000
                           , :MDSEAR-SUB-CL-NBR                         32690000
                           , :MDSEAR-MDSELV-CDE                         32700000
                           , :MDSEAR-DKEY                               32710000
                           , :MDSEAR-CHG-DTE                            32720000
                           , :MDSEAR-CRE-DTE                            32730000
                           , :MDSEAR-STRT-DTE                           32740000
                           , :MDSEAR-END-DTE                            32750000
                           , :MDSEAR-GEN-MDSE-TYP-CDE                   32760000
                           , :MDSEAR-DESC                               32770000
                           , :MDSEAR-BYR-NBR                            32780000
                           , :MDSEAR-LIST-SEQ-NBR                       32790000
                           , NULL                                       32800000
                           , NULL)                                      32810000
                 END-EXEC                                               32820000
      *                                                                 32830000
               EVALUATE TRUE                                            32840000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              32850000
                   WHEN SQLCODE = PC-DEADLOCK                           32860000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 32870000
                        CONTINUE                                        32880000
                   WHEN SQLCODE = ZERO                                  32890000
                       ADD 1 TO PA-DEPS-INSERTS                         32900000
                   WHEN SQLWARN0 NOT = SPACE                            32910000
                   WHEN SQLCODE NOT =  ZERO                             32920000
                       MOVE 'BAD SQLCODE FOR TMDSEAR DPT INSERT'        32930000
                                     TO  PV-MESSAGE                     32940000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           32950000
                       PERFORM 9900-PROCESS-DB2-ERROR                   32960000
                       SET PS-STOP-REC-PROCESSING TO TRUE               32970000
               END-EVALUATE                                             32980000
           END-PERFORM.                                                 32990000
      *                                                                 33000000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               33010000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSEAR DPT INSERT'      33020000
                      TO PV-MESSAGE                                     33030000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   33040000
               PERFORM 9900-PROCESS-DB2-ERROR                           33050000
               SET PS-STOP-REC-PROCESSING TO TRUE                       33060000
           END-IF.                                                      33070000
      *                                                                 33080000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           33090000
RMSRET*        MOVE 'TMDSEAR DPT ROW ALREADY EXISTS FOR INSERT'         33100011
RMSRET*                              TO  PV-MESSAGE                     33110011
RMSRET*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   33120011
RMSRET*        PERFORM 9900-PROCESS-DB2-ERROR                           33130011
RMSRET*        SET PS-STOP-REC-PROCESSING TO TRUE                       33140011
RMSRET         ADD 1 TO PA-SKIPPED-ERRORS                               33150011
           END-IF.                                                      33160000
                                                                        33170000
      * ------------------------------------------------------------- * 33180000
      * UPDATE THE MERCHANDISE AREA TABLE DPT DATA                      33190000
      * ------------------------------------------------------------- * 33200000
       7071-UPDATE-TMDSEAR-DPT-ROW.                                     33210000
                                                                        33220000
           MOVE '7071-UPDATE-TMDSEAR-DPT-ROW' TO PV-PARAGRAPH.          33230000
           MOVE 'UPDATE ROW '                 TO PV-ACTION.             33240000
                                                                        33250000
           PERFORM                                                      33260000
               WITH TEST AFTER                                          33270000
               VARYING PV-SQL-SUB                                       33280000
               FROM 1 BY 1                                              33290000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        33300000
                  OR SQLCODE = 0                                        33310000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         33320000
                  OR PS-STOP-REC-PROCESSING                             33330000
      *                                                                 33340000
                 EXEC SQL                                               33350000
                     UPDATE TMDSEAR                                     33360000
                     SET   MDSEAR_DESC = :MDSEAR-DESC                   33370000
                         , CHG_DTE     = :MDSEAR-CHG-DTE                33380000
                     WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   33390000
                 END-EXEC                                               33400000
      *                                                                 33410000
               EVALUATE TRUE                                            33420000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              33430000
                   WHEN SQLCODE = PC-DEADLOCK                           33440000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      33450000
                        CONTINUE                                        33460000
                   WHEN SQLCODE = ZERO                                  33470000
                        ADD 1 TO PA-DEPS-UPDATES                        33480000
                   WHEN SQLWARN0 NOT = SPACE                            33490000
                   WHEN SQLCODE NOT = ZERO                              33500000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR DPT'        33510000
                                     TO  PV-MESSAGE                     33520000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           33530000
                       PERFORM 9900-PROCESS-DB2-ERROR                   33540000
                       SET PS-STOP-REC-PROCESSING TO TRUE               33550000
               END-EVALUATE                                             33560000
           END-PERFORM.                                                 33570000
      *                                                                 33580000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              33590000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR DPT'       33600000
                                     TO  PV-MESSAGE                     33610000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   33620000
               PERFORM 9900-PROCESS-DB2-ERROR                           33630000
               SET PS-STOP-REC-PROCESSING TO TRUE                       33640000
           END-IF.                                                      33650000
      *                                                                 33660000
           IF SQLCODE = PC-ROW-NOT-FOUND                                33670000
               MOVE 'TMDSEAR DPT ROW NOT FOUND FOR UPDATE'              33680000
                                     TO  PV-MESSAGE                     33690000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   33700000
               PERFORM 9900-PROCESS-DB2-ERROR                           33710000
               SET PS-STOP-REC-PROCESSING TO TRUE                       33720000
           END-IF.                                                      33730000
                                                                        33740000
      * ------------------------------------------------------------- * 33750000
      * UPDATE THE MERCHANDISE AREA TABLE DPT DATA WITH DEPARTMENT      33760000
      * ATTRIBUTES DATA                                                 33770000
      * ------------------------------------------------------------- * 33780000
       7080-UPDATE-TMDSEAR-DPT-ATTRS.                                   33790000
                                                                        33800000
           MOVE '7080-UPDATE-TMDSEAR-DPT-ATTRS' TO PV-PARAGRAPH.        33810000
           MOVE 'UPDATE ROW '                   TO PV-ACTION.           33820000
                                                                        33830000
           PERFORM                                                      33840000
               WITH TEST AFTER                                          33850000
               VARYING PV-SQL-SUB                                       33860000
               FROM 1 BY 1                                              33870000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        33880000
                  OR SQLCODE = 0                                        33890000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         33900000
                  OR PS-STOP-REC-PROCESSING                             33910000
      *                                                                 33920000
                 EXEC SQL                                               33930000
                     UPDATE TMDSEAR                                     33940000
                     SET   GEN_MDSE_TYP_CDE = :MDSEAR-GEN-MDSE-TYP-CDE  33950000
                         , CHG_DTE     = :MDSEAR-CHG-DTE                33960000
                     WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   33970000
                 END-EXEC                                               33980000
      *                                                                 33990000
               EVALUATE TRUE                                            34000000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              34010000
                   WHEN SQLCODE = PC-DEADLOCK                           34020000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      34030000
                        CONTINUE                                        34040000
                   WHEN SQLCODE = ZERO                                  34050000
                        ADD 1 TO PA-DEPS-ATTRS-UPDATES-2                34060000
                   WHEN SQLWARN0 NOT = SPACE                            34070000
                   WHEN SQLCODE NOT = ZERO                              34080000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR DPT'        34090000
                                     TO  PV-MESSAGE                     34100000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           34110000
                       PERFORM 9900-PROCESS-DB2-ERROR                   34120000
                       SET PS-STOP-REC-PROCESSING TO TRUE               34130000
               END-EVALUATE                                             34140000
           END-PERFORM.                                                 34150000
      *                                                                 34160000
0102RM*                  , PHY_INV_OH_VAR_PCT =                         34170000
0102RM*                    :MDSEAR-PHY-INV-OH-VAR-PCT :PV-PCT-NULL      34180000
0102RM*                  , PHY_INV_OH_VAR_QTY =                         34190000
0102RM*                    :MDSEAR-PHY-INV-OH-VAR-QTY :PV-QTY-NULL      34200000
      *                                                                 34210000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              34220000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR DPT'       34230000
                                     TO  PV-MESSAGE                     34240000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   34250000
               PERFORM 9900-PROCESS-DB2-ERROR                           34260000
               SET PS-STOP-REC-PROCESSING TO TRUE                       34270000
           END-IF.                                                      34280000
      *                                                                 34290000
           IF SQLCODE = PC-ROW-NOT-FOUND                                34300000
               MOVE 'TMDSEAR DPT ROW NOT FOUND FOR UPDATE'              34310000
                                     TO  PV-MESSAGE                     34320000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   34330000
               PERFORM 9900-PROCESS-DB2-ERROR                           34340000
               SET PS-STOP-REC-PROCESSING TO TRUE                       34350000
           END-IF.                                                      34360000
                                                                        34370000
      * ------------------------------------------------------------- * 34380000
      * INSERT THE MERCHANDISE AREA TABLE MCL DATA                      34390000
      * ------------------------------------------------------------- * 34400000
       7090-INSERT-TMDSEAR-MCL-ROW.                                     34410000
                                                                        34420000
           MOVE '7090-INSERT-TMDSEAR-MCL-ROW' TO PV-PARAGRAPH.          34430000
           MOVE 'INSERT ROW '                 TO PV-ACTION.             34440000
                                                                        34450000
           PERFORM                                                      34460000
               WITH TEST AFTER                                          34470000
               VARYING PV-SQL-SUB                                       34480000
               FROM 1 BY 1                                              34490000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        34500000
                  OR SQLCODE = 0                                        34510000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    34520000
                  OR PS-STOP-REC-PROCESSING                             34530000
      *                                                                 34540000
                 EXEC SQL                                               34550000
                     INSERT INTO TMDSEAR                                34560000
                            (OPERCO_NBR                                 34570000
                           , GMA_NBR                                    34580000
                           , DMA_NBR                                    34590000
                           , DEPT_NBR                                   34600000
                           , MAJ_CL_NBR                                 34610000
                           , SUB_CL_NBR                                 34620000
                           , MDSELV_CDE                                 34630000
                           , MDSEAR_DKEY                                34640000
                           , CHG_DTE                                    34650000
                           , CRE_DTE                                    34660000
                           , STRT_DTE                                   34670000
                           , END_DTE                                    34680000
                           , GEN_MDSE_TYP_CDE                           34690000
                           , MDSEAR_DESC                                34700000
                           , BYR_NBR                                    34710000
                           , LIST_SEQ_NBR                               34720000
                           , PHY_INV_OH_VAR_PCT                         34730000
                           , PHY_INV_OH_VAR_QTY)                        34740000
                     VALUES (:MDSEAR-OPERCO-NBR                         34750000
                           , :MDSEAR-GMA-NBR                            34760000
                           , :MDSEAR-DMA-NBR                            34770000
                           , :MDSEAR-DEPT-NBR                           34780000
                           , :MDSEAR-MAJ-CL-NBR                         34790000
                           , :MDSEAR-SUB-CL-NBR                         34800000
                           , :MDSEAR-MDSELV-CDE                         34810000
                           , :MDSEAR-DKEY                               34820000
                           , :MDSEAR-CHG-DTE                            34830000
                           , :MDSEAR-CRE-DTE                            34840000
                           , :MDSEAR-STRT-DTE                           34850000
                           , :MDSEAR-END-DTE                            34860000
                           , :MDSEAR-GEN-MDSE-TYP-CDE                   34870000
                           , :MDSEAR-DESC                               34880000
                           , :MDSEAR-BYR-NBR                            34890000
                           , :MDSEAR-LIST-SEQ-NBR                       34900000
                           , NULL                                       34910000
                           , NULL)                                      34920000
                 END-EXEC                                               34930000
      *                                                                 34940000
               EVALUATE TRUE                                            34950000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              34960000
                   WHEN SQLCODE = PC-DEADLOCK                           34970000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 34980000
                        CONTINUE                                        34990000
                   WHEN SQLCODE = ZERO                                  35000000
                       ADD 1 TO PA-CLASS-INSERTS                        35010000
                   WHEN SQLWARN0 NOT = SPACE                            35020000
                   WHEN SQLCODE NOT =  ZERO                             35030000
                       MOVE 'BAD SQLCODE FOR TMDSEAR MCL INSERT'        35040000
                                     TO  PV-MESSAGE                     35050000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           35060000
                       PERFORM 9900-PROCESS-DB2-ERROR                   35070000
                       SET PS-STOP-REC-PROCESSING TO TRUE               35080000
               END-EVALUATE                                             35090000
           END-PERFORM.                                                 35100000
      *                                                                 35110000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               35120000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSEAR MCL INSERT'      35130000
                      TO PV-MESSAGE                                     35140000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   35150000
               PERFORM 9900-PROCESS-DB2-ERROR                           35160000
               SET PS-STOP-REC-PROCESSING TO TRUE                       35170000
           END-IF.                                                      35180000
      *                                                                 35190000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           35200000
RMSRET*        MOVE 'TMDSEAR MCL ROW ALREADY EXISTS FOR INSERT'         35210011
RMSRET*                              TO  PV-MESSAGE                     35220011
RMSRET*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   35230011
RMSRET*        PERFORM 9900-PROCESS-DB2-ERROR                           35240011
RMSRET*        SET PS-STOP-REC-PROCESSING TO TRUE                       35250011
RMSRET         ADD 1 TO PA-SKIPPED-ERRORS                               35260011
           END-IF.                                                      35270000
                                                                        35280000
      * ------------------------------------------------------------- * 35290000
      * UPDATE THE MERCHANDISE AREA TABLE MCL DATA                      35300000
      * ------------------------------------------------------------- * 35310000
       7091-UPDATE-TMDSEAR-MCL-ROW.                                     35320000
                                                                        35330000
           MOVE '7091-UPDATE-TMDSEAR-MCL-ROW' TO PV-PARAGRAPH.          35340000
           MOVE 'UPDATE ROW '                 TO PV-ACTION.             35350000
                                                                        35360000
           PERFORM                                                      35370000
               WITH TEST AFTER                                          35380000
               VARYING PV-SQL-SUB                                       35390000
               FROM 1 BY 1                                              35400000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        35410000
                  OR SQLCODE = 0                                        35420000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         35430000
                  OR PS-STOP-REC-PROCESSING                             35440000
      *                                                                 35450000
                 EXEC SQL                                               35460000
                     UPDATE TMDSEAR                                     35470000
                     SET   MDSEAR_DESC = :MDSEAR-DESC                   35480000
                         , CHG_DTE     = :MDSEAR-CHG-DTE                35490000
                     WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   35500000
                 END-EXEC                                               35510000
      *                                                                 35520000
               EVALUATE TRUE                                            35530000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              35540000
                   WHEN SQLCODE = PC-DEADLOCK                           35550000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      35560000
                        CONTINUE                                        35570000
                   WHEN SQLCODE = ZERO                                  35580000
                        ADD 1 TO PA-CLASS-UPDATES                       35590000
                   WHEN SQLWARN0 NOT = SPACE                            35600000
                   WHEN SQLCODE NOT = ZERO                              35610000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR MCL'        35620000
                                     TO  PV-MESSAGE                     35630000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           35640000
                       PERFORM 9900-PROCESS-DB2-ERROR                   35650000
                       SET PS-STOP-REC-PROCESSING TO TRUE               35660000
               END-EVALUATE                                             35670000
           END-PERFORM.                                                 35680000
      *                                                                 35690000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              35700000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR MCL'       35710000
                                     TO  PV-MESSAGE                     35720000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   35730000
               PERFORM 9900-PROCESS-DB2-ERROR                           35740000
               SET PS-STOP-REC-PROCESSING TO TRUE                       35750000
           END-IF.                                                      35760000
      *                                                                 35770000
           IF SQLCODE = PC-ROW-NOT-FOUND                                35780000
               MOVE 'TMDSEAR MCL ROW NOT FOUND FOR UPDATE'              35790000
                                     TO  PV-MESSAGE                     35800000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   35810000
               PERFORM 9900-PROCESS-DB2-ERROR                           35820000
               SET PS-STOP-REC-PROCESSING TO TRUE                       35830000
           END-IF.                                                      35840000
                                                                        35850000
      * ------------------------------------------------------------- * 35860000
      * UPDATE THE MERCHANDISE AREA TABLE MCL DATA WITH DEPARTMENT      35870000
      * ATTRIBUTES DATA                                                 35880000
      * ------------------------------------------------------------- * 35890000
0102RM*7100-UPDATE-TMDSEAR-MCL-ATTRS.                                   35900000
0102RM*                                                                 35910000
0102RM*    MOVE '7100-UPDATE-TMDSEAR-MCL-ATTRS' TO PV-PARAGRAPH.        35920000
0102RM*    MOVE 'UPDATE ROW '                   TO PV-ACTION.           35930000
0102RM*                                                                 35940000
0102RM*    PERFORM                                                      35950000
0102RM*        WITH TEST AFTER                                          35960000
0102RM*        VARYING PV-SQL-SUB                                       35970000
0102RM*        FROM 1 BY 1                                              35980000
0102RM*        UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        35990000
0102RM*           OR SQLCODE = 0                                        36000000
0102RM*           OR SQLCODE = PC-ROW-NOT-FOUND                         36010000
0102RM*           OR PS-STOP-REC-PROCESSING                             36020000
0102RM*                                                                 36030000
0102RM*          EXEC SQL                                               36040000
0102RM*              UPDATE TMDSEAR                                     36050000
0102RM*              SET   PHY_INV_OH_VAR_PCT =                         36060000
0102RM*                    :MDSEAR-PHY-INV-OH-VAR-PCT :PV-PCT-NULL      36070000
0102RM*                  , PHY_INV_OH_VAR_QTY =                         36080000
0102RM*                    :MDSEAR-PHY-INV-OH-VAR-QTY :PV-QTY-NULL      36090000
0102RM*                  , CHG_DTE     = :MDSEAR-CHG-DTE                36100000
0102RM*              WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   36110000
0102RM*          END-EXEC                                               36120000
0102RM*                                                                 36130000
0102RM*        EVALUATE TRUE                                            36140000
0102RM*            WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              36150000
0102RM*            WHEN SQLCODE = PC-DEADLOCK                           36160000
0102RM*            WHEN SQLCODE = PC-ROW-NOT-FOUND                      36170000
0102RM*                 CONTINUE                                        36180000
0102RM*            WHEN SQLCODE = ZERO                                  36190000
0102RM*                 ADD 1 TO PA-CLASS-ATTR-UPDATES                  36200000
0102RM*            WHEN SQLWARN0 NOT = SPACE                            36210000
0102RM*            WHEN SQLCODE NOT = ZERO                              36220000
0102RM*                MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR MCL'        36230000
0102RM*                              TO  PV-MESSAGE                     36240000
0102RM*                MOVE HMRD001-RECORD TO PV-INPUT-RECORD           36250000
0102RM*                PERFORM 9900-PROCESS-DB2-ERROR                   36260000
0102RM*                SET PS-STOP-REC-PROCESSING TO TRUE               36270000
0102RM*        END-EVALUATE                                             36280000
0102RM*    END-PERFORM.                                                 36290000
0102RM*                                                                 36300000
0102RM*    IF  PV-SQL-SUB > PC-MAX-RETRIES                              36310000
0102RM*        MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR MCL'       36320000
0102RM*                              TO  PV-MESSAGE                     36330000
0102RM*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   36340000
0102RM*        PERFORM 9900-PROCESS-DB2-ERROR                           36350000
0102RM*        SET PS-STOP-REC-PROCESSING TO TRUE                       36360000
0102RM*    END-IF.                                                      36370000
0102RM*                                                                 36380000
0102RM*    IF SQLCODE = PC-ROW-NOT-FOUND                                36390000
0102RM*        MOVE 'TMDSEAR MCL ROW NOT FOUND FOR UPDATE'              36400000
0102RM*                              TO  PV-MESSAGE                     36410000
0102RM*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   36420000
0102RM*        PERFORM 9900-PROCESS-DB2-ERROR                           36430000
0102RM*        SET PS-STOP-REC-PROCESSING TO TRUE                       36440000
0102RM*    END-IF.                                                      36450000
                                                                        36460000
      * ------------------------------------------------------------- * 36470000
      * INSERT THE MERCHANDISE AREA TABLE SCL DATA                      36480000
      * ------------------------------------------------------------- * 36490000
       7110-INSERT-TMDSEAR-SCL-ROW.                                     36500000
                                                                        36510000
           MOVE '7110-INSERT-TMDSEAR-SCL-ROW' TO PV-PARAGRAPH.          36520000
           MOVE 'INSERT ROW '                 TO PV-ACTION.             36530000
                                                                        36540000
           PERFORM                                                      36550000
               WITH TEST AFTER                                          36560000
               VARYING PV-SQL-SUB                                       36570000
               FROM 1 BY 1                                              36580000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        36590000
                  OR SQLCODE = 0                                        36600000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    36610000
                  OR PS-STOP-REC-PROCESSING                             36620000
      *                                                                 36630000
                 EXEC SQL                                               36640000
                     INSERT INTO TMDSEAR                                36650000
                            (OPERCO_NBR                                 36660000
                           , GMA_NBR                                    36670000
                           , DMA_NBR                                    36680000
                           , DEPT_NBR                                   36690000
                           , MAJ_CL_NBR                                 36700000
                           , SUB_CL_NBR                                 36710000
                           , MDSELV_CDE                                 36720000
                           , MDSEAR_DKEY                                36730000
                           , CHG_DTE                                    36740000
                           , CRE_DTE                                    36750000
                           , STRT_DTE                                   36760000
                           , END_DTE                                    36770000
                           , GEN_MDSE_TYP_CDE                           36780000
                           , MDSEAR_DESC                                36790000
                           , BYR_NBR                                    36800000
                           , LIST_SEQ_NBR                               36810000
                           , PHY_INV_OH_VAR_PCT                         36820000
                           , PHY_INV_OH_VAR_QTY)                        36830000
                     VALUES (:MDSEAR-OPERCO-NBR                         36840000
                           , :MDSEAR-GMA-NBR                            36850000
                           , :MDSEAR-DMA-NBR                            36860000
                           , :MDSEAR-DEPT-NBR                           36870000
                           , :MDSEAR-MAJ-CL-NBR                         36880000
                           , :MDSEAR-SUB-CL-NBR                         36890000
                           , :MDSEAR-MDSELV-CDE                         36900000
                           , :MDSEAR-DKEY                               36910000
                           , :MDSEAR-CHG-DTE                            36920000
                           , :MDSEAR-CRE-DTE                            36930000
                           , :MDSEAR-STRT-DTE                           36940000
                           , :MDSEAR-END-DTE                            36950000
                           , :MDSEAR-GEN-MDSE-TYP-CDE                   36960000
                           , :MDSEAR-DESC                               36970000
                           , :MDSEAR-BYR-NBR                            36980000
                           , :MDSEAR-LIST-SEQ-NBR                       36990000
                           , NULL                                       37000000
                           , NULL)                                      37010000
                 END-EXEC                                               37020000
      *                                                                 37030000
               EVALUATE TRUE                                            37040000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              37050000
                   WHEN SQLCODE = PC-DEADLOCK                           37060000
0603RM*            WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 37070000
                        CONTINUE                                        37080000
                   WHEN SQLCODE = ZERO                                  37090000
                       ADD 1 TO PA-SUBCLASS-INSERTS                     37100000
0603RM             WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 37110000
0603RM                 MOVE 'SUBCLASS ALREADY EXISTS ON TMDSEAR'        37120000
0603RM                               TO  PV-MESSAGE                     37130000
0603RM                 DISPLAY PV-PARAGRAPH                             37140000
0603RM                 DISPLAY 'SUBCLASS ALREADY EXISTS ON TMDSEAR'     37150000
0603RM                 MOVE HMRD001-RECORD TO PV-INPUT-RECORD           37160000
0603RM*                PERFORM 9900-PROCESS-DB2-ERROR                   37170000
0603RM*                SET PS-STOP-REC-PROCESSING TO TRUE               37180000
                   WHEN SQLWARN0 NOT = SPACE                            37190000
                   WHEN SQLCODE NOT =  ZERO                             37200000
                       MOVE 'BAD SQLCODE FOR TMDSEAR SCL INSERT'        37210000
                                     TO  PV-MESSAGE                     37220000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           37230000
                       PERFORM 9900-PROCESS-DB2-ERROR                   37240000
                       SET PS-STOP-REC-PROCESSING TO TRUE               37250000
               END-EVALUATE                                             37260000
           END-PERFORM.                                                 37270000
      *                                                                 37280000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               37290000
               MOVE  'MAX RETRIES EXCEEDED FOR TMDSEAR SCL INSERT'      37300000
                      TO PV-MESSAGE                                     37310000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   37320000
               PERFORM 9900-PROCESS-DB2-ERROR                           37330000
               SET PS-STOP-REC-PROCESSING TO TRUE                       37340000
           END-IF.                                                      37350000
      *                                                                 37360000
0603RM*    IF SQLCODE = PC-ROW-ALREADY-EXISTS                           37370000
0603RM*        MOVE 'TMDSEAR SCL ROW ALREADY EXISTS FOR INSERT'         37380000
0603RM*                              TO  PV-MESSAGE                     37390000
0603RM*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   37400000
0603RM*        PERFORM 9900-PROCESS-DB2-ERROR                           37410000
0603RM*        SET PS-STOP-REC-PROCESSING TO TRUE                       37420000
0603RM*    END-IF.                                                      37430000
                                                                        37440000
      *------------------------------------------------------------- *  37450000
      *   UPDATE THE MERCHANDISE AREA TABLE SCL DATA                    37460000
      *------------------------------------------------------------- *  37470000
         7111-UPDATE-TMDSEAR-SCL-ROW.                                   37480000
                                                                        37490000
             MOVE '7111-UPDATE-TMDSEAR-SCL-ROW' TO PV-PARAGRAPH.        37500000
             MOVE 'UPDATE ROW '         TO PV-ACTION.                   37510000
                                                                        37520000
             PERFORM                                                    37530000
                 WITH TEST AFTER                                        37540000
                 VARYING PV-SQL-SUB                                     37550000
                 FROM 1 BY 1                                            37560000
                 UNTIL PV-SQL-SUB > PC-MAX-RETRIES                      37570000
                    OR SQLCODE = 0                                      37580000
                    OR SQLCODE = PC-ROW-NOT-FOUND                       37590000
                    OR PS-STOP-REC-PROCESSING                           37600000
*                                                                       37610000
                 EXEC SQL                                               37620000
                     UPDATE TMDSEAR                                     37630000
                     SET   MDSEAR_DESC = :MDSEAR-DESC                   37640000
                         , CHG_DTE     = :MDSEAR-CHG-DTE                37650000
                     WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   37660000
                 END-EXEC                                               37670000
      *                                                                 37680000
               EVALUATE TRUE                                            37690000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              37700000
                   WHEN SQLCODE = PC-DEADLOCK                           37710000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      37720000
                        CONTINUE                                        37730000
                   WHEN SQLCODE = ZERO                                  37740000
                        ADD 1 TO PA-SUBCLASS-UPDATES                    37750000
                   WHEN SQLWARN0 NOT = SPACE                            37760000
                   WHEN SQLCODE NOT = ZERO                              37770000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR SCL'        37780000
                                     TO  PV-MESSAGE                     37790000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           37800000
                       PERFORM 9900-PROCESS-DB2-ERROR                   37810000
                       SET PS-STOP-REC-PROCESSING TO TRUE               37820000
               END-EVALUATE                                             37830000
           END-PERFORM.                                                 37840000
      *                                                                 37850000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              37860000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR SCL'       37870000
                                     TO  PV-MESSAGE                     37880000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   37890000
               PERFORM 9900-PROCESS-DB2-ERROR                           37900000
               SET PS-STOP-REC-PROCESSING TO TRUE                       37910000
           END-IF.                                                      37920000
      *                                                                 37930000
           IF SQLCODE = PC-ROW-NOT-FOUND                                37940000
               MOVE 'TMDSEAR SCL ROW NOT FOUND FOR UPDATE'              37950000
                                     TO  PV-MESSAGE                     37960000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   37970000
               PERFORM 9900-PROCESS-DB2-ERROR                           37980000
               SET PS-STOP-REC-PROCESSING TO TRUE                       37990000
           END-IF.                                                      38000000
                                                                        38010000
0603RM* ------------------------------------------------------------- * 38020000
0603RM* UPDATE THE MERCHANDISE AREA TABLE SCL END DATE                  38030000
0603RM* ------------------------------------------------------------- * 38040000
0603RM 7112-UPDATE-TMDSEAR-SCL-DTE.                                     38050000
0603RM                                                                  38060000
0603RM     MOVE '7112-UPDATE-TMDSEAR-SCL-DTE' TO PV-PARAGRAPH.          38070000
0603RM     MOVE 'UPDATE ROW '                 TO PV-ACTION.             38080000
0603RM                                                                  38090000
0603RM     PERFORM                                                      38100000
0603RM         WITH TEST AFTER                                          38110000
0603RM         VARYING PV-SQL-SUB                                       38120000
0603RM         FROM 1 BY 1                                              38130000
0603RM         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        38140000
0603RM            OR SQLCODE = 0                                        38150000
0603RM            OR SQLCODE = PC-ROW-NOT-FOUND                         38160000
0603RM            OR PS-STOP-REC-PROCESSING                             38170000
0603RM                                                                  38180000
0603RM           EXEC SQL                                               38190000
0603RM               UPDATE TMDSEAR                                     38200000
0603RM               SET   MDSEAR_DESC = :MDSEAR-DESC                   38210000
0603RM                   , CHG_DTE     = :MDSEAR-CHG-DTE                38220000
0603RM                   , END_DTE     = :MDSEAR-END-DTE                38230000
0603RM               WHERE MDSEAR_DKEY = :MDSEAR-DKEY                   38240000
0603RM           END-EXEC                                               38250000
0603RM*                                                                 38260000
0603RM         EVALUATE TRUE                                            38270000
0603RM             WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              38280000
0603RM             WHEN SQLCODE = PC-DEADLOCK                           38290000
0603RM             WHEN SQLCODE = PC-ROW-NOT-FOUND                      38300000
0603RM                  CONTINUE                                        38310000
0603RM             WHEN SQLCODE = ZERO                                  38320000
0603RM                  ADD 1 TO PA-SUBCLASS-UPDATES                    38330000
0603RM             WHEN SQLWARN0 NOT = SPACE                            38340000
0603RM             WHEN SQLCODE NOT = ZERO                              38350000
0603RM                 MOVE 'BAD SQLCODE FOR UPDATE TMDSEAR SCL'        38360000
0603RM                               TO  PV-MESSAGE                     38370000
0603RM                 MOVE HMRD001-RECORD TO PV-INPUT-RECORD           38380000
0603RM                 PERFORM 9900-PROCESS-DB2-ERROR                   38390000
0603RM                 SET PS-STOP-REC-PROCESSING TO TRUE               38400000
0603RM         END-EVALUATE                                             38410000
0603RM     END-PERFORM.                                                 38420000
0603RM*                                                                 38430000
0603RM     IF  PV-SQL-SUB > PC-MAX-RETRIES                              38440000
0603RM         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEAR SCL'       38450000
0603RM                               TO  PV-MESSAGE                     38460000
0603RM         MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   38470000
0603RM         PERFORM 9900-PROCESS-DB2-ERROR                           38480000
0603RM         SET PS-STOP-REC-PROCESSING TO TRUE                       38490000
0603RM     END-IF.                                                      38500000
0603RM*                                                                 38510000
0603RM     IF SQLCODE = PC-ROW-NOT-FOUND                                38520000
0603RM         MOVE 'TMDSEAR SCL ROW NOT FOUND FOR UPDATE'              38530000
0603RM                               TO  PV-MESSAGE                     38540000
0603RM         MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   38550000
0603RM         PERFORM 9900-PROCESS-DB2-ERROR                           38560000
0603RM         SET PS-STOP-REC-PROCESSING TO TRUE                       38570000
0603RM     END-IF.                                                      38580000
      * ------------------------------------------------------------- * 38590000
      * UPDATE THE MERCHANDISE DEPARTMENT DATA WITH DEPS INFO           38600000
      * ------------------------------------------------------------- * 38610000
       7120-UPDATE-DEPS-TMDSEDP.                                        38620000
                                                                        38630000
           MOVE '7120-UPDATE-DEPS-TMDSEDP' TO PV-PARAGRAPH.             38640000
           MOVE 'UPDATE ROW '              TO PV-ACTION.                38650000
                                                                        38660000
           PERFORM                                                      38670000
               WITH TEST AFTER                                          38680000
               VARYING PV-SQL-SUB                                       38690000
               FROM 1 BY 1                                              38700000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        38710000
                  OR SQLCODE = 0                                        38720000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         38730000
                  OR PS-INPUT-REC-ERROR                                 38740000
      *                                                                 38750000
                 EXEC SQL                                               38760000
                     UPDATE TMDSEDP                                     38770000
                     SET ARDEPT_CHG_DTE    = :MDSEDP-ARDEPT-CHG-DTE     38780000
                       , ARDEPT_DESC       = :MDSEDP-ARDEPT-DESC        38790000
                       , CHG_DTE           = :MDSEDP-CHG-DTE            38800000
                     WHERE MDSEAR_DKEY     = :MDSEDP-MDSEAR-DKEY        38810000
                 END-EXEC                                               38820000
      *                                                                 38830000
               EVALUATE TRUE                                            38840000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              38850000
                   WHEN SQLCODE = PC-DEADLOCK                           38860000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      38870000
                        CONTINUE                                        38880000
                   WHEN SQLCODE = ZERO                                  38890000
                        ADD 1 TO PA-DEPS-MDSEDP-UPDATES                 38900000
                   WHEN SQLWARN0 NOT = SPACE                            38910000
                   WHEN SQLCODE NOT = ZERO                              38920000
                       MOVE 'BAD SQLCODE FOR UPDATE TMDSEDP'            38930000
                                     TO  PV-MESSAGE                     38940000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           38950000
                       PERFORM 9900-PROCESS-DB2-ERROR                   38960000
                       SET PS-INPUT-REC-ERROR TO TRUE                   38970000
               END-EVALUATE                                             38980000
           END-PERFORM.                                                 38990000
      *                                                                 39000000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              39010000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE TMDSEDP'           39020000
                                     TO  PV-MESSAGE                     39030000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   39040000
               PERFORM 9900-PROCESS-DB2-ERROR                           39050000
           END-IF.                                                      39060000
      *                                                                 39070000
           IF SQLCODE = PC-ROW-NOT-FOUND                                39080000
               MOVE 'TMDSEDP ROW NOT FOUND FOR UPDATE'                  39090000
                                     TO  PV-MESSAGE                     39100000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   39110000
               PERFORM 9900-PROCESS-DB2-ERROR                           39120000
           END-IF.                                                      39130000
                                                                        39140000
      * ------------------------------------------------------------- * 39150000
      * INSERT THE DEPARTMENT SHRINK PERCENT ROWS                       39160000
      * ------------------------------------------------------------- * 39170000
       7140-INSERT-TDPTSHK-ROW.                                         39180000
                                                                        39190000
           MOVE '7140-INSERT-TDPTSHK-ROW' TO PV-PARAGRAPH.              39200000
           MOVE 'INSERT ROW '             TO PV-ACTION.                 39210000
                                                                        39220000
           PERFORM                                                      39230000
               WITH TEST AFTER                                          39240000
               VARYING PV-SQL-SUB                                       39250000
               FROM 1 BY 1                                              39260000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        39270000
                  OR SQLCODE = 0                                        39280000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    39290000
                  OR PS-STOP-REC-PROCESSING                             39300000
                                                                        39310000
                 EXEC SQL                                               39320000
                     INSERT INTO TDPTSHK                                39330000
                            (MDSEAR_DKEY                                39340000
                           , SHRINK_YR_NBR                              39350000
                           , CHG_TMST                                   39360000
                           , JAN_SHRINK_PCT                             39370000
                           , FEB_SHRINK_PCT                             39380000
                           , MAR_SHRINK_PCT                             39390000
                           , APR_SHRINK_PCT                             39400000
                           , MAY_SHRINK_PCT                             39410000
                           , JUN_SHRINK_PCT                             39420000
                           , JUL_SHRINK_PCT                             39430000
                           , AUG_SHRINK_PCT                             39440000
                           , SEP_SHRINK_PCT                             39450000
                           , OCT_SHRINK_PCT                             39460000
                           , NOV_SHRINK_PCT                             39470000
C14666                     , DEC_SHRINK_PCT                             39480004
C14666                     , E_BUS_IND                                  39490000
C14666                     , SHNK_PCT_CHG_DTE                           39500000
C14666                     , LAST_UPD_BY_USR)                           39510000
                     VALUES (:DPTSHK-MDSEAR-DKEY                        39520000
                           , :DPTSHK-SHRINK-YR-NBR                      39530000
                           ,  CURRENT TIMESTAMP                         39540000
                           ,  0                                         39550000
                           ,  0                                         39560000
                           ,  0                                         39570000
                           ,  0                                         39580000
                           ,  0                                         39590000
                           ,  0                                         39600000
                           ,  0                                         39610000
                           ,  0                                         39620000
                           ,  0                                         39630000
                           ,  0                                         39640000
                           ,  0                                         39650000
C14666                     ,  0                                         39660004
C14666                     ,  :DPTSHK-E-BUS-IND                         39670000
C14666                     ,  CURRENT DATE                              39680000
C14666                     ,  :DPTSHK-LAST-UPD-BY-USR)                  39690000
                 END-EXEC                                               39700000
      *                                                                 39710000
      *                                                                 39720000
               EVALUATE TRUE                                            39730000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              39740000
                   WHEN SQLCODE = PC-DEADLOCK                           39750000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 39760000
                        CONTINUE                                        39770000
                   WHEN SQLCODE = ZERO                                  39780000
                       ADD 1 TO PA-DEPS-TDPTSHK-INSERTS                 39790000
                   WHEN SQLWARN0 NOT = SPACE                            39800000
                   WHEN SQLCODE NOT =  ZERO                             39810000
                       MOVE 'BAD SQLCODE FOR TDPTSHK INSERT'            39820000
                                     TO  PV-MESSAGE                     39830000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           39840000
                       PERFORM 9900-PROCESS-DB2-ERROR                   39850000
                       SET PS-STOP-REC-PROCESSING TO TRUE               39860000
               END-EVALUATE                                             39870000
           END-PERFORM.                                                 39880000
      *                                                                 39890000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               39900000
               MOVE  'MAX RETRIES EXCEEDED FOR TDPTSHK INSERT'          39910000
                      TO PV-MESSAGE                                     39920000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   39930000
               PERFORM 9900-PROCESS-DB2-ERROR                           39940000
               SET PS-STOP-REC-PROCESSING TO TRUE                       39950000
           END-IF.                                                      39960000
      *                                                                 39970000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           39980000
               MOVE 'TDPTSHK ROW ALREADY EXISTS FOR INSERT'             39990000
                                     TO  PV-MESSAGE                     40000000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   40010000
               PERFORM 9900-PROCESS-DB2-ERROR                           40020000
               SET PS-STOP-REC-PROCESSING TO TRUE                       40030000
           END-IF.                                                      40040000
                                                                        40050000
      * ------------------------------------------------------------- * 40060000
      * INSERT THE RESPONSIBILITY AREA ROW                              40070000
      * ------------------------------------------------------------- * 40080000
       7150-INSERT-TRSPBAR-ROW.                                         40090000
                                                                        40100000
           MOVE '7150-INSERT-TRSPBAR-ROW' TO PV-PARAGRAPH.              40110000
           MOVE 'INSERT ROW '             TO PV-ACTION.                 40120000
                                                                        40130000
           PERFORM                                                      40140000
               WITH TEST AFTER                                          40150000
               VARYING PV-SQL-SUB                                       40160000
               FROM 1 BY 1                                              40170000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        40180000
                  OR SQLCODE = 0                                        40190000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    40200000
                  OR PS-STOP-REC-PROCESSING                             40210000
                                                                        40220000
                 EXEC SQL                                               40230000
                     INSERT INTO TRSPBAR                                40240000
                            (MDSEAR_DKEY                                40250000
                           , WORKER_NBR                                 40260000
                           , RSPLVL_CDE                                 40270000
                           , WORKER_STRT_DTE                            40280000
                           , WORKER_END_DTE                             40290000
                           , WORKER_FIR_NAME                            40300000
                           , WORKER_LAST_NAME                           40310000
                           , OPERCO_NBR)                                40320000
                     VALUES (:RSPBAR-MDSEAR-DKEY                        40330000
                           , :RSPBAR-WORKER-NBR                         40340000
                           , :RSPBAR-RSPLVL-CDE                         40350000
                           , :RSPBAR-WORKER-STRT-DTE                    40360000
                           , :RSPBAR-WORKER-END-DTE                     40370000
                           , :RSPBAR-WORKER-FIR-NAME                    40380000
                           , :RSPBAR-WORKER-LAST-NAME                   40390000
                           , :RSPBAR-OPERCO-NBR)                        40400000
                 END-EXEC                                               40410000
      *                                                                 40420000
      *                                                                 40430000
               EVALUATE TRUE                                            40440000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              40450000
                   WHEN SQLCODE = PC-DEADLOCK                           40460000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 40470000
                       CONTINUE                                         40480000
                   WHEN SQLCODE = ZERO                                  40490000
                       ADD 1 TO PA-TRSPBAR-INSERTS                      40500000
                   WHEN SQLWARN0 NOT = SPACE                            40510000
                   WHEN SQLCODE NOT =  ZERO                             40520000
                       MOVE 'BAD SQLCODE FOR TRSPBAR INSERT'            40530000
                                     TO  PV-MESSAGE                     40540000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           40550000
                       PERFORM 9900-PROCESS-DB2-ERROR                   40560000
                       SET PS-STOP-REC-PROCESSING TO TRUE               40570000
               END-EVALUATE                                             40580000
           END-PERFORM.                                                 40590000
      *                                                                 40600000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               40610000
               MOVE  'MAX RETRIES EXCEEDED FOR TRSPBAR INSERT'          40620000
                      TO PV-MESSAGE                                     40630000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   40640000
               PERFORM 9900-PROCESS-DB2-ERROR                           40650000
               SET PS-STOP-REC-PROCESSING TO TRUE                       40660000
           END-IF.                                                      40670000
      *                                                                 40680000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           40690000
RMSRET*        MOVE 'TRSPBAR ROW ALREADY EXISTS FOR INSERT'             40700011
RMSRET*                              TO  PV-MESSAGE                     40710011
RMSRET*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   40720011
RMSRET*        PERFORM 9900-PROCESS-DB2-ERROR                           40730011
RMSRET*        SET PS-STOP-REC-PROCESSING TO TRUE                       40740011
RMSRET         ADD 1 TO PA-SKIPPED-ERRORS                               40750011
           END-IF.                                                      40760000
                                                                        40770000
      * ------------------------------------------------------------- * 40780000
      * INSERT THE XMT PRIVATE BRAND FACTOR TABLE DATA                  40790000
      * ------------------------------------------------------------- * 40800000
0816PK 7160-INSERT-XMT-PRVT-BRND-FCTR.                                  40810000
                                                                        40820000
           MOVE '7160-INSERT-XMT-PRVT-BRND-FCTR' TO PV-PARAGRAPH.       40830000
           MOVE 'INSERT ROW '             TO PV-ACTION.                 40840000
                                                                        40850000
           PERFORM                                                      40860000
               WITH TEST AFTER                                          40870000
               VARYING PV-SQL-SUB                                       40880000
               FROM 1 BY 1                                              40890000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        40900000
                  OR SQLCODE = 0                                        40910000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    40920000
                  OR PS-INPUT-REC-ERROR                                 40930000
      *                                                                 40940000
                 EXEC SQL                                               40950000
                     INSERT INTO XMT_PRVT_BRND_FCTR                     40960000
                            (DEPT_NBR                                   40970000
                            ,EFF_BEG_DTE                                40980000
                            ,EFF_END_DTE                                40990000
                            ,LOD_PCT)                                   41000000
                     VALUES (:XMT00022-DEPT-NBR                         41010000
                            ,:XMT00022-EFF-BEG-DTE                      41020000
                            ,:XMT00022-EFF-END-DTE :PV-EFF-END-DTE-NI   41030000
                            ,:XMT00022-LOD-PCT)                         41040000
                 END-EXEC                                               41050000
      *                                                                 41060000
               EVALUATE TRUE                                            41070000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              41080000
                   WHEN SQLCODE = PC-DEADLOCK                           41090000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 41100000
                        CONTINUE                                        41110000
                   WHEN SQLCODE = ZERO                                  41120000
                       ADD 1 TO PA-PRVT-BRND-INSERTS                    41130000
                   WHEN SQLWARN0 NOT = SPACE                            41140000
                   WHEN SQLCODE NOT =  ZERO                             41150000
                       MOVE 'BAD SQLCODE FOR XMT_PRVT_BRND_FCTR INSERT' 41160000
                             TO PV-MESSAGE                              41170000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           41180000
                       PERFORM 9900-PROCESS-DB2-ERROR                   41190000
                       SET PS-INPUT-REC-ERROR TO TRUE                   41200000
               END-EVALUATE                                             41210000
           END-PERFORM.                                                 41220000
      *                                                                 41230000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               41240000
               MOVE 'MAX RETRIES EXCEEDED FOR XMT_PRVT_BRND_FCTR INSERT'41250000
                     TO PV-MESSAGE                                      41260000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   41270000
               PERFORM 9900-PROCESS-DB2-ERROR                           41280000
           END-IF.                                                      41290000
      *                                                                 41300000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           41310000
               MOVE 'XMT_PRVT_BRND_FCTR ROW ALREADY EXISTS FOR INSERT'  41320000
                                     TO  PV-MESSAGE                     41330000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   41340000
               PERFORM 9900-PROCESS-DB2-ERROR                           41350000
           END-IF.                                                      41360000
                                                                        41370000
      * ------------------------------------------------------------- * 41380000
      * UPDATE THE XMT PRIVATE BRAND FACTOR TABLE DATA                  41390000
      * ------------------------------------------------------------- * 41400000
0816PK 7161-UPDATE-XMT-PRVT-BRND-FCTR.                                  41410000
                                                                        41420000
           MOVE '7161-UPDATE-XMT-PRVT-BRND-FCTR' TO PV-PARAGRAPH.       41430000
           MOVE 'UPDATE ROW '             TO PV-ACTION.                 41440000
                                                                        41450000
           PERFORM                                                      41460000
               WITH TEST AFTER                                          41470000
               VARYING PV-SQL-SUB                                       41480000
               FROM 1 BY 1                                              41490000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        41500000
                  OR SQLCODE = 0                                        41510000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         41520000
                  OR PS-INPUT-REC-ERROR                                 41530000
      *                                                                 41540000
                 EXEC SQL                                               41550000
                     UPDATE XMT_PRVT_BRND_FCTR                          41560000
                     SET EFF_BEG_DTE = :XMT00022-EFF-BEG-DTE            41570000
                        ,EFF_END_DTE = :XMT00022-EFF-END-DTE            41580000
                                       :PV-EFF-END-DTE-NI               41590000
                        ,LOD_PCT     = :XMT00022-LOD-PCT                41600000
                     WHERE DEPT_NBR  = :XMT00022-DEPT-NBR               41610000
                       AND EFF_BEG_DTE = :PV-OLD-EFF-BEG-DTE            41620000
                 END-EXEC                                               41630000
      *                                                                 41640000
               EVALUATE TRUE                                            41650000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              41660000
                   WHEN SQLCODE = PC-DEADLOCK                           41670000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      41680000
                        CONTINUE                                        41690000
                   WHEN SQLCODE = ZERO                                  41700000
                        ADD 1 TO PA-PRVT-BRND-UPDATES                   41710000
                   WHEN SQLWARN0 NOT = SPACE                            41720000
                   WHEN SQLCODE NOT = ZERO                              41730000
                       MOVE 'BAD SQLCODE FOR UPDATE XMT_PRVT_BRND_FCTR' 41740000
                                     TO  PV-MESSAGE                     41750000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           41760000
                       PERFORM 9900-PROCESS-DB2-ERROR                   41770000
                       SET PS-INPUT-REC-ERROR TO TRUE                   41780000
               END-EVALUATE                                             41790000
           END-PERFORM.                                                 41800000
      *                                                                 41810000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              41820000
               MOVE 'MAX RETRIES EXCEEDED FOR UPDATE XMT_PRVT_BRND_FCTR'41830000
                     TO PV-MESSAGE                                      41840000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   41850000
               PERFORM 9900-PROCESS-DB2-ERROR                           41860000
           END-IF.                                                      41870000
      *                                                                 41880000
           IF SQLCODE = PC-ROW-NOT-FOUND                                41890000
               MOVE 'XMT_PRVT_BRND_FCTR ROW NOT FOUND FOR UPDATE'       41900000
                     TO PV-MESSAGE                                      41910000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   41920000
               PERFORM 9900-PROCESS-DB2-ERROR                           41930000
           END-IF.                                                      41940000
                                                                        41950000
      * ------------------------------------------------------------- * 41960000
      * DELETE THE XMT PRIVATE BRAND FACTOR TABLE DATA                  41970000
      * ------------------------------------------------------------- * 41980000
0816PK 7162-DELETE-XMT-PRVT-BRND-FCTR.                                  41990000
                                                                        42000000
           MOVE '7162-DELETE-XMT-PRVT-BRND-FCTR' TO PV-PARAGRAPH.       42010000
           MOVE 'DELETE ROW '             TO PV-ACTION.                 42020000
                                                                        42030000
           PERFORM                                                      42040000
               WITH TEST AFTER                                          42050000
               VARYING PV-SQL-SUB                                       42060000
               FROM 1 BY 1                                              42070000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        42080000
                  OR SQLCODE = 0                                        42090000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         42100000
                  OR PS-INPUT-REC-ERROR                                 42110000
      *                                                                 42120000
                 EXEC SQL                                               42130000
                     DELETE FROM XMT_PRVT_BRND_FCTR                     42140000
                     WHERE DEPT_NBR  = :XMT00022-DEPT-NBR               42150000
                       AND EFF_BEG_DTE = :XMT00022-EFF-BEG-DTE          42160000
                 END-EXEC                                               42170000
      *                                                                 42180000
               EVALUATE TRUE                                            42190000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              42200000
                   WHEN SQLCODE = PC-DEADLOCK                           42210000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      42220000
                        CONTINUE                                        42230000
                   WHEN SQLCODE = ZERO                                  42240000
                        ADD 1 TO PA-PRVT-BRND-DELETES                   42250000
                   WHEN SQLWARN0 NOT = SPACE                            42260000
                   WHEN SQLCODE NOT = ZERO                              42270000
                       MOVE 'BAD SQLCODE FOR DELETE XMT_PRVT_BRND_FCTR' 42280000
                                     TO  PV-MESSAGE                     42290000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           42300000
                       PERFORM 9900-PROCESS-DB2-ERROR                   42310000
                       SET PS-INPUT-REC-ERROR TO TRUE                   42320000
               END-EVALUATE                                             42330000
           END-PERFORM.                                                 42340000
      *                                                                 42350000
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              42360000
               MOVE 'MAX RETRIES EXCEEDED FOR DELETE XMT_PRVT_BRND_FCTR'42370000
                                     TO  PV-MESSAGE                     42380000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   42390000
               PERFORM 9900-PROCESS-DB2-ERROR                           42400000
           END-IF.                                                      42410000
      *                                                                 42420000
           IF SQLCODE = PC-ROW-NOT-FOUND                                42430000
               MOVE 'XMT_PRVT_BRND_FCTR ROW NOT FOUND FOR DELETE'       42440000
                                     TO  PV-MESSAGE                     42450000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   42460000
               PERFORM 9900-PROCESS-DB2-ERROR                           42470000
           END-IF.                                                      42480000
                                                                        42490000
      * ------------------------------------------------------------- * 42500000
      * GETS THE GMA MERCHANDISE AREA DATA KEY FROM TMDSEAR             42510000
      * ------------------------------------------------------------- * 42520000
       7800-GET-GMA-MDSEAR-INFO.                                        42530000
      *                                                                 42540000
           MOVE '7800-GET-GMA-MDSEAR-INFO' TO PV-PARAGRAPH.             42550000
      *                                                                 42560000
           PERFORM                                                      42570000
               WITH TEST AFTER                                          42580000
               VARYING PV-SQL-SUB                                       42590000
               FROM 1 BY 1                                              42600000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        42610000
                  OR SQLCODE = ZERO                                     42620000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         42630000
                  OR PS-STOP-REC-PROCESSING                             42640000
      *                                                                 42650000
                 EXEC SQL                                               42660000
                     SELECT MDSEAR_DKEY,                                42670000
                            GEN_MDSE_TYP_CDE                            42680000
                     INTO  :MDSEAR-DKEY,                                42690000
                           :MDSEAR-GEN-MDSE-TYP-CDE                     42700000
                     FROM   TMDSEAR                                     42710000
                     WHERE  OPERCO_NBR    = :PC-OPER-CO        AND      42720000
                            GMA_NBR       = :MDSEAR-GMA-NBR    AND      42730000
                            MDSELV_CDE    = :PC-GMA-LEVEL-CD   AND      42740000
                            CURRENT DATE BETWEEN STRT_DTE AND END_DTE   42750000
                 END-EXEC                                               42760000
      *                                                                 42770000
               EVALUATE TRUE                                            42780000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              42790000
                   WHEN SQLCODE = PC-DEADLOCK                           42800000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      42810000
                   WHEN SQLCODE = ZERO                                  42820000
                        CONTINUE                                        42830000
                   WHEN SQLWARN0 NOT = SPACE                            42840000
                   WHEN SQLCODE NOT = ZERO                              42850000
                       MOVE 'BAD SQLCODE FOR GET GMA MDSEAR'            42860000
                                     TO  PV-MESSAGE                     42870000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           42880000
                       PERFORM 9900-PROCESS-DB2-ERROR                   42890000
                       SET PS-STOP-REC-PROCESSING TO TRUE               42900000
               END-EVALUATE                                             42910000
           END-PERFORM.                                                 42920000
      *                                                                 42930000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               42940000
               MOVE 'MAX RETRIES EXCEEDED FOR GET GMA MDSEAR'           42950000
                                     TO  PV-MESSAGE                     42960000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   42970000
               PERFORM 9900-PROCESS-DB2-ERROR                           42980000
               SET PS-STOP-REC-PROCESSING TO TRUE                       42990000
           END-IF.                                                      43000000
                                                                        43010000
           IF SQLCODE = PC-ROW-NOT-FOUND                                43020000
               MOVE 'MDSEAR GMA ROW NOT FOUND FOR SELECT'               43030000
                                     TO PV-MESSAGE                      43040000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   43050000
               PERFORM 9900-PROCESS-DB2-ERROR                           43060000
               SET PS-STOP-REC-PROCESSING TO TRUE                       43070000
           END-IF.                                                      43080000
                                                                        43090000
      * ------------------------------------------------------------- * 43100000
      * GETS THE DEPARTMENT MERCHANDISE AREA INFO FROM TMDSEAR          43110000
      * ------------------------------------------------------------- * 43120000
       7810-GET-DEPT-MDSEAR-INFO.                                       43130000
      *                                                                 43140000
           MOVE '7810-GET-DEPT-MDSEAR-INFO' TO PV-PARAGRAPH.            43150000
      *                                                                 43160000
           PERFORM                                                      43170000
               WITH TEST AFTER                                          43180000
               VARYING PV-SQL-SUB                                       43190000
               FROM 1 BY 1                                              43200000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43210000
                  OR SQLCODE = ZERO                                     43220000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         43230000
                  OR PS-STOP-REC-PROCESSING                             43240000
      *                                                                 43250000
                 EXEC SQL                                               43260000
                     SELECT MDSEAR_DKEY,                                43270000
                            GMA_NBR,                                    43280000
                            DMA_NBR,                                    43290000
                            GEN_MDSE_TYP_CDE,                           43300000
                            MDSEAR_DESC,                                43310000
0102RM                      BYR_NBR                                     43320000
                     INTO  :MDSEAR-DKEY,                                43330000
                           :MDSEAR-GMA-NBR,                             43340000
                           :MDSEAR-DMA-NBR,                             43350000
                           :MDSEAR-GEN-MDSE-TYP-CDE,                    43360000
                           :MDSEAR-DESC,                                43370000
0102RM                     :MDSEAR-BYR-NBR                              43380000
                     FROM   TMDSEAR                                     43390000
                     WHERE  OPERCO_NBR    = :PC-OPER-CO        AND      43400000
                            DEPT_NBR      = :MDSEAR-DEPT-NBR   AND      43410000
                            MDSELV_CDE    = :PC-DPT-LEVEL-CD   AND      43420000
                            CURRENT DATE BETWEEN STRT_DTE AND END_DTE   43430000
                 END-EXEC                                               43440000
      *                                                                 43450000
               EVALUATE TRUE                                            43460000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              43470000
                   WHEN SQLCODE = PC-DEADLOCK                           43480000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      43490000
                   WHEN SQLCODE = ZERO                                  43500000
                        CONTINUE                                        43510000
                   WHEN SQLWARN0 NOT = SPACE                            43520000
                   WHEN SQLCODE NOT = ZERO                              43530000
                       MOVE 'BAD SQLCODE FOR GET DEPARTMENT MDSEAR'     43540000
                                     TO  PV-MESSAGE                     43550000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           43560000
                       PERFORM 9900-PROCESS-DB2-ERROR                   43570000
                       SET PS-STOP-REC-PROCESSING TO TRUE               43580000
               END-EVALUATE                                             43590000
           END-PERFORM.                                                 43600000
                                                                        43610000
0102RM* WR23223- REMOVED/UPDATED COLUMNS IN THE ABOVE SELECT            43620000
0102RM*                     BYR_NBR,                                    43630000
0102RM*                     COALESCE (PHY_INV_OH_VAR_PCT,0),            43640000
0102RM*                     COALESCE (PHY_INV_OH_VAR_QTY,0)             43650000
0102RM*                    :MDSEAR-BYR-NBR,                             43660000
0102RM*                    :MDSEAR-PHY-INV-OH-VAR-PCT :PV-PCT-NULL,     43670000
0102RM*                    :MDSEAR-PHY-INV-OH-VAR-QTY :PV-QTY-NULL      43680000
                                                                        43690000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               43700000
               MOVE 'MAX RETRIES EXCEEDED FOR GET DEPARTMENT MDSEAR'    43710000
                                     TO  PV-MESSAGE                     43720000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   43730000
               PERFORM 9900-PROCESS-DB2-ERROR                           43740000
               SET PS-STOP-REC-PROCESSING TO TRUE                       43750000
           END-IF.                                                      43760000
                                                                        43770000
           IF SQLCODE = PC-ROW-NOT-FOUND                                43780000
               MOVE 'MDSEAR DPT ROW NOT FOUND FOR SELECT'               43790000
                                     TO PV-MESSAGE                      43800000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   43810000
               PERFORM 9900-PROCESS-DB2-ERROR                           43820000
               SET PS-STOP-REC-PROCESSING TO TRUE                       43830000
           END-IF.                                                      43840000
                                                                        43850000
      * ------------------------------------------------------------- * 43860000
      * GETS THE MAXIMUM MERCHANDISE AREA DATA KEY FROM TMDSEAR         43870000
      * ------------------------------------------------------------- * 43880000
       7820-GET-MAX-MDSEAR-DKEY.                                        43890000
      *                                                                 43900000
           MOVE '7820-GET-MAX-MDSEAR-DKEY' TO PV-PARAGRAPH.             43910000
      *                                                                 43920000
           PERFORM                                                      43930000
               WITH TEST AFTER                                          43940000
               VARYING PV-SQL-SUB                                       43950000
               FROM 1 BY 1                                              43960000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43970000
                  OR SQLCODE = ZERO                                     43980000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         43990000
                  OR PS-STOP-REC-PROCESSING                             44000000
      *                                                                 44010000
                 EXEC SQL                                               44020000
                     SELECT MAX(MDSEAR_DKEY)                            44030000
                     INTO  :MDSEAR-DKEY                                 44040000
                     FROM   TMDSEAR                                     44050000
                 END-EXEC                                               44060000
      *                                                                 44070000
               EVALUATE TRUE                                            44080000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44090000
                   WHEN SQLCODE = PC-DEADLOCK                           44100000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      44110000
                   WHEN SQLCODE = ZERO                                  44120000
                        CONTINUE                                        44130000
                   WHEN SQLWARN0 NOT = SPACE                            44140000
                   WHEN SQLCODE NOT = ZERO                              44150000
                       MOVE 'BAD SQLCODE FOR GET MAX MDSEAR DKEY'       44160000
                                     TO  PV-MESSAGE                     44170000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           44180000
                       PERFORM 9900-PROCESS-DB2-ERROR                   44190000
                       SET PS-STOP-REC-PROCESSING TO TRUE               44200000
               END-EVALUATE                                             44210000
           END-PERFORM.                                                 44220000
      *                                                                 44230000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44240000
               MOVE 'MAX RETRIES EXCEEDED FOR GET MAX MDSEAR DKEY'      44250000
                                     TO  PV-MESSAGE                     44260000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   44270000
               PERFORM 9900-PROCESS-DB2-ERROR                           44280000
               SET PS-STOP-REC-PROCESSING TO TRUE                       44290000
           END-IF.                                                      44300000
                                                                        44310000
           IF SQLCODE = PC-ROW-NOT-FOUND                                44320000
               MOVE 'MDSEAR ROW NOT FOUND FOR SELECT'                   44330000
                                     TO PV-MESSAGE                      44340000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   44350000
               PERFORM 9900-PROCESS-DB2-ERROR                           44360000
               SET PS-STOP-REC-PROCESSING TO TRUE                       44370000
           END-IF.                                                      44380000
                                                                        44390000
      * ------------------------------------------------------------- * 44400000
      * GETS DMA MERCHANDISE AREA INFO FROM TMDSEAR                     44410000
      * ------------------------------------------------------------- * 44420000
       7830-GET-DMA-MDSEAR-INFO.                                        44430000
      *                                                                 44440000
           MOVE '7830-GET-DMA-MDSEAR-INFO' TO PV-PARAGRAPH.             44450000
      *                                                                 44460000
           PERFORM                                                      44470000
               WITH TEST AFTER                                          44480000
               VARYING PV-SQL-SUB                                       44490000
               FROM 1 BY 1                                              44500000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        44510000
                  OR SQLCODE = ZERO                                     44520000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         44530000
                  OR PS-STOP-REC-PROCESSING                             44540000
      *                                                                 44550000
                 EXEC SQL                                               44560000
                     SELECT MDSEAR_DKEY,                                44570000
                            GMA_NBR,                                    44580000
                            MDSEAR_DESC,                                44590000
                            BYR_NBR                                     44600000
                     INTO  :MDSEAR-DKEY,                                44610000
                           :MDSEAR-GMA-NBR,                             44620000
                           :MDSEAR-DESC,                                44630000
                           :MDSEAR-BYR-NBR                              44640000
                     FROM   TMDSEAR                                     44650000
                     WHERE  OPERCO_NBR    = :PC-OPER-CO        AND      44660000
                            DMA_NBR       = :MDSEAR-DMA-NBR    AND      44670000
                            MDSELV_CDE    = :PC-DMA-LEVEL-CD   AND      44680000
                            CURRENT DATE BETWEEN STRT_DTE AND END_DTE   44690000
                 END-EXEC                                               44700000
      *                                                                 44710000
               EVALUATE TRUE                                            44720000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44730000
                   WHEN SQLCODE = PC-DEADLOCK                           44740000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      44750000
                   WHEN SQLCODE = ZERO                                  44760000
                        CONTINUE                                        44770000
                   WHEN SQLWARN0 NOT = SPACE                            44780000
                   WHEN SQLCODE NOT = ZERO                              44790000
                       MOVE 'BAD SQLCODE FOR GET DMA MDSEAR'            44800000
                                     TO  PV-MESSAGE                     44810000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           44820000
                       PERFORM 9900-PROCESS-DB2-ERROR                   44830000
                       SET PS-STOP-REC-PROCESSING TO TRUE               44840000
               END-EVALUATE                                             44850000
           END-PERFORM.                                                 44860000
      *                                                                 44870000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44880000
               MOVE 'MAX RETRIES EXCEEDED FOR GET DMA MDSEAR'           44890000
                                     TO  PV-MESSAGE                     44900000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   44910000
               PERFORM 9900-PROCESS-DB2-ERROR                           44920000
               SET PS-STOP-REC-PROCESSING TO TRUE                       44930000
           END-IF.                                                      44940000
                                                                        44950000
           IF SQLCODE = PC-ROW-NOT-FOUND                                44960000
               MOVE 'MDSEAR DMA ROW NOT FOUND FOR SELECT'               44970000
                                     TO PV-MESSAGE                      44980000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   44990000
               PERFORM 9900-PROCESS-DB2-ERROR                           45000000
               SET PS-STOP-REC-PROCESSING TO TRUE                       45010000
           END-IF.                                                      45020000
                                                                        45030000
      * ------------------------------------------------------------- * 45040000
      * GETS THE CLASS MERCHANDISE AREA INFO FROM TMDSEAR               45050000
      * ------------------------------------------------------------- * 45060000
       7840-GET-CLASS-MDSEAR-INFO.                                      45070000
      *                                                                 45080000
           MOVE '7840-GET-CLASS-MDSEAR-INFO' TO PV-PARAGRAPH.           45090000
      *                                                                 45100000
           PERFORM                                                      45110000
               WITH TEST AFTER                                          45120000
               VARYING PV-SQL-SUB                                       45130000
               FROM 1 BY 1                                              45140000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        45150000
                  OR SQLCODE = ZERO                                     45160000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         45170000
                  OR PS-STOP-REC-PROCESSING                             45180000
      *                                                                 45190000
                 EXEC SQL                                               45200000
                     SELECT MDSEAR_DKEY,                                45210000
                            GMA_NBR,                                    45220000
                            DMA_NBR,                                    45230000
                            GEN_MDSE_TYP_CDE,                           45240000
                            MDSEAR_DESC,                                45250000
                            BYR_NBR                                     45260000
                     INTO  :MDSEAR-DKEY,                                45270000
                           :MDSEAR-GMA-NBR,                             45280000
                           :MDSEAR-DMA-NBR,                             45290000
                           :MDSEAR-GEN-MDSE-TYP-CDE,                    45300000
                           :MDSEAR-DESC,                                45310000
                           :MDSEAR-BYR-NBR                              45320000
                     FROM   TMDSEAR                                     45330000
                     WHERE  OPERCO_NBR    = :PC-OPER-CO        AND      45340000
                            DEPT_NBR      = :MDSEAR-DEPT-NBR   AND      45350000
                            MAJ_CL_NBR    = :MDSEAR-MAJ-CL-NBR AND      45360000
                            SUB_CL_NBR    = :MDSEAR-SUB-CL-NBR AND      45370000
                            MDSELV_CDE    = :PC-MCL-LEVEL-CD   AND      45380000
                            CURRENT DATE BETWEEN STRT_DTE AND END_DTE   45390000
                 END-EXEC                                               45400000
      *                                                                 45410000
               EVALUATE TRUE                                            45420000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              45430000
                   WHEN SQLCODE = PC-DEADLOCK                           45440000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      45450000
                   WHEN SQLCODE = ZERO                                  45460000
                        CONTINUE                                        45470000
                   WHEN SQLWARN0 NOT = SPACE                            45480000
                   WHEN SQLCODE NOT = ZERO                              45490000
                       MOVE 'BAD SQLCODE FOR GET CLASS MDSEAR'          45500000
                                     TO  PV-MESSAGE                     45510000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           45520000
                       PERFORM 9900-PROCESS-DB2-ERROR                   45530000
                       SET PS-STOP-REC-PROCESSING TO TRUE               45540000
               END-EVALUATE                                             45550000
           END-PERFORM.                                                 45560000
      *                                                                 45570000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               45580000
               MOVE 'MAX RETRIES EXCEEDED FOR GET CLASS MDSEAR'         45590000
                                     TO  PV-MESSAGE                     45600000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   45610000
               PERFORM 9900-PROCESS-DB2-ERROR                           45620000
               SET PS-STOP-REC-PROCESSING TO TRUE                       45630000
           END-IF.                                                      45640000
                                                                        45650000
           IF SQLCODE = PC-ROW-NOT-FOUND                                45660000
               MOVE 'MDSEAR CLASS ROW NOT FOUND FOR SELECT'             45670000
                                     TO PV-MESSAGE                      45680000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   45690000
               PERFORM 9900-PROCESS-DB2-ERROR                           45700000
               SET PS-STOP-REC-PROCESSING TO TRUE                       45710000
           END-IF.                                                      45720000
                                                                        45730000
      * ------------------------------------------------------------- * 45740000
      * GETS THE SUBCLASS MERCHANDISE AREA INFO FROM TMDSEAR            45750000
      * ------------------------------------------------------------- * 45760000
       7850-GET-SUBCLASS-MDSEAR-INFO.                                   45770000
      *                                                                 45780000
           MOVE '7850-GET-SUBCLASS-MDSEAR-INFO' TO PV-PARAGRAPH.        45790000
      *                                                                 45800000
           PERFORM                                                      45810000
               WITH TEST AFTER                                          45820000
               VARYING PV-SQL-SUB                                       45830000
               FROM 1 BY 1                                              45840000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        45850000
                  OR SQLCODE = ZERO                                     45860000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         45870000
                  OR PS-STOP-REC-PROCESSING                             45880000
      *                                                                 45890000
                 EXEC SQL                                               45900000
                     SELECT MDSEAR_DKEY,                                45910000
                            GMA_NBR,                                    45920000
                            DMA_NBR,                                    45930000
                            MDSEAR_DESC                                 45940000
                     INTO  :MDSEAR-DKEY,                                45950000
                           :MDSEAR-GMA-NBR,                             45960000
                           :MDSEAR-DMA-NBR,                             45970000
                           :MDSEAR-DESC                                 45980000
                     FROM   TMDSEAR                                     45990000
                     WHERE  OPERCO_NBR    = :PC-OPER-CO        AND      46000000
                            DEPT_NBR      = :MDSEAR-DEPT-NBR   AND      46010000
                            MAJ_CL_NBR    = :MDSEAR-MAJ-CL-NBR AND      46020000
                            SUB_CL_NBR    = :MDSEAR-SUB-CL-NBR AND      46030000
                            MDSELV_CDE    = :PC-SCL-LEVEL-CD   AND      46040000
                            CURRENT DATE BETWEEN STRT_DTE AND END_DTE   46050000
                 END-EXEC                                               46060000
      *                                                                 46070000
               EVALUATE TRUE                                            46080000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              46090000
                   WHEN SQLCODE = PC-DEADLOCK                           46100000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      46110000
                   WHEN SQLCODE = ZERO                                  46120000
                        CONTINUE                                        46130000
                   WHEN SQLWARN0 NOT = SPACE                            46140000
                   WHEN SQLCODE NOT = ZERO                              46150000
                       MOVE 'BAD SQLCODE FOR GET SUBCLASS MDSEAR'       46160000
                                     TO  PV-MESSAGE                     46170000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           46180000
                       PERFORM 9900-PROCESS-DB2-ERROR                   46190000
                       SET PS-STOP-REC-PROCESSING TO TRUE               46200000
               END-EVALUATE                                             46210000
           END-PERFORM.                                                 46220000
      *                                                                 46230000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               46240000
               MOVE 'MAX RETRIES EXCEEDED FOR GET SUBCLASS MDSEAR'      46250000
                                     TO  PV-MESSAGE                     46260000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   46270000
               PERFORM 9900-PROCESS-DB2-ERROR                           46280000
               SET PS-STOP-REC-PROCESSING TO TRUE                       46290000
           END-IF.                                                      46300000
                                                                        46310000
           IF SQLCODE = PC-ROW-NOT-FOUND                                46320000
               MOVE 'MDSEAR SUBCLASS ROW NOT FOUND FOR SELECT'          46330000
                                     TO PV-MESSAGE                      46340000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   46350000
               PERFORM 9900-PROCESS-DB2-ERROR                           46360000
               SET PS-STOP-REC-PROCESSING TO TRUE                       46370000
           END-IF.                                                      46380000
                                                                        46390000
0603RM* ------------------------------------------------------------- * 46400000
0603RM* GETS THE SUBCLASS MERCHANDISE AREA DATE INFO FROM TMDSEAR       46410000
0603RM* ------------------------------------------------------------- * 46420000
0603RM 7855-GET-SUBCLASS-MDSEAR-DATES.                                  46430000
0603RM*                                                                 46440000
0603RM     MOVE '7855-GET-SUBCLASS-MDSEAR-DATES' TO PV-PARAGRAPH.       46450000
**TEMP*    DISPLAY PV-PARAGRAPH.                                        46460000
0603RM*                                                                 46470000
0603RM     PERFORM                                                      46480000
0603RM         WITH TEST AFTER                                          46490000
0603RM         VARYING PV-SQL-SUB                                       46500000
0603RM         FROM 1 BY 1                                              46510000
0603RM         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        46520000
0603RM            OR SQLCODE = ZERO                                     46530000
0603RM            OR SQLCODE = PC-ROW-NOT-FOUND                         46540000
0603RM            OR PS-STOP-REC-PROCESSING                             46550000
0603RM*                                                                 46560000
0603RM           EXEC SQL                                               46570000
0603RM               SELECT MDSEAR_DKEY,                                46580000
0603RM                      GMA_NBR,                                    46590000
0603RM                      DMA_NBR,                                    46600000
0603RM                      MDSEAR_DESC,                                46610000
0603RM                      STRT_DTE,                                   46620000
0603RM                      END_DTE                                     46630000
0603RM               INTO  :MDSEAR-DKEY,                                46640000
0603RM                     :MDSEAR-GMA-NBR,                             46650000
0603RM                     :MDSEAR-DMA-NBR,                             46660000
0603RM                     :MDSEAR-DESC,                                46670000
0603RM                     :MDSEAR-STRT-DTE,                            46680000
0603RM                     :MDSEAR-END-DTE                              46690000
0603RM               FROM   TMDSEAR                                     46700000
0603RM               WHERE  OPERCO_NBR    = :PC-OPER-CO        AND      46710000
0603RM                      DEPT_NBR      = :MDSEAR-DEPT-NBR   AND      46720000
0603RM                      MAJ_CL_NBR    = :MDSEAR-MAJ-CL-NBR AND      46730000
0603RM                      SUB_CL_NBR    = :MDSEAR-SUB-CL-NBR AND      46740000
0603RM                      MDSELV_CDE    = :PC-SCL-LEVEL-CD            46750000
0603RM           END-EXEC                                               46760000
0603RM*                                                                 46770000
0603RM         EVALUATE TRUE                                            46780000
0603RM             WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              46790000
0603RM             WHEN SQLCODE = PC-DEADLOCK                           46800000
0603RM             WHEN SQLCODE = PC-ROW-NOT-FOUND                      46810000
0603RM             WHEN SQLCODE = ZERO                                  46820000
0603RM                  CONTINUE                                        46830000
0603RM             WHEN SQLWARN0 NOT = SPACE                            46840000
0603RM             WHEN SQLCODE NOT = ZERO                              46850000
0603RM                 MOVE 'BAD SQLCODE FOR GET SUBCLASS MDSEAR'       46860000
0603RM                               TO  PV-MESSAGE                     46870000
0603RM                 MOVE HMRD001-RECORD TO PV-INPUT-RECORD           46880000
0603RM                 PERFORM 9900-PROCESS-DB2-ERROR                   46890000
0603RM                 SET PS-STOP-REC-PROCESSING TO TRUE               46900000
0603RM         END-EVALUATE                                             46910000
0603RM     END-PERFORM.                                                 46920000
0603RM*                                                                 46930000
0603RM     IF PV-SQL-SUB > PC-MAX-RETRIES                               46940000
0603RM         MOVE 'MAX RETRIES EXCEEDED FOR GET SUBCLASS MDSEAR'      46950000
0603RM                               TO  PV-MESSAGE                     46960000
0603RM         MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   46970000
0603RM         PERFORM 9900-PROCESS-DB2-ERROR                           46980000
0603RM         SET PS-STOP-REC-PROCESSING TO TRUE                       46990000
0603RM     END-IF.                                                      47000000
0603RM                                                                  47010000
0603RM     IF SQLCODE = PC-ROW-NOT-FOUND                                47020000
0603RM         MOVE 'MDSEAR SUBCLASS ROW NOT FOUND FOR SELECT'          47030000
0603RM                               TO PV-MESSAGE                      47040000
0603RM         MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   47050000
0603RM         PERFORM 9900-PROCESS-DB2-ERROR                           47060000
0603RM         SET PS-STOP-REC-PROCESSING TO TRUE                       47070000
0603RM     END-IF.                                                      47080000
                                                                        47090000
      * ------------------------------------------------------------- * 47100000
      * GETS THE CORP MERCHANDISE AREA DATA KEY FROM TMDSEAR            47110000
      * ------------------------------------------------------------- * 47120000
       7860-GET-CORP-MDSEAR-DKEY.                                       47130000
      *                                                                 47140000
           MOVE '7860-GET-CORP-MDSEAR-DKEY' TO PV-PARAGRAPH.            47150000
      *                                                                 47160000
           PERFORM                                                      47170000
               WITH TEST AFTER                                          47180000
               VARYING PV-SQL-SUB                                       47190000
               FROM 1 BY 1                                              47200000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        47210000
                  OR SQLCODE = ZERO                                     47220000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         47230000
                  OR PS-STOP-REC-PROCESSING                             47240000
      *                                                                 47250000
                 EXEC SQL                                               47260000
                     SELECT MDSEAR_DKEY                                 47270000
                     INTO  :MDSEAR-DKEY                                 47280000
                     FROM   TMDSEAR                                     47290000
                     WHERE  OPERCO_NBR    = :PC-OPER-CO        AND      47300000
                            MDSELV_CDE    = :PC-CORP-LEVEL-CD  AND      47310000
                            CURRENT DATE BETWEEN STRT_DTE AND END_DTE   47320000
                 END-EXEC                                               47330000
      *                                                                 47340000
               EVALUATE TRUE                                            47350000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              47360000
                   WHEN SQLCODE = PC-DEADLOCK                           47370000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      47380000
                   WHEN SQLCODE = ZERO                                  47390000
                        CONTINUE                                        47400000
                   WHEN SQLWARN0 NOT = SPACE                            47410000
                   WHEN SQLCODE NOT = ZERO                              47420000
                       MOVE 'BAD SQLCODE FOR GET CORP MDSEAR'           47430000
                                     TO  PV-MESSAGE                     47440000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           47450000
                       PERFORM 9900-PROCESS-DB2-ERROR                   47460000
                       SET PS-STOP-REC-PROCESSING TO TRUE               47470000
               END-EVALUATE                                             47480000
           END-PERFORM.                                                 47490000
      *                                                                 47500000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               47510000
               MOVE 'MAX RETRIES EXCEEDED FOR GET CORP MDSEAR'          47520000
                                     TO  PV-MESSAGE                     47530000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   47540000
               PERFORM 9900-PROCESS-DB2-ERROR                           47550000
               SET PS-STOP-REC-PROCESSING TO TRUE                       47560000
           END-IF.                                                      47570000
                                                                        47580000
           IF SQLCODE = PC-ROW-NOT-FOUND                                47590000
               MOVE 'MDSEAR CORP ROW NOT FOUND FOR SELECT'              47600000
                                     TO PV-MESSAGE                      47610000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   47620000
               PERFORM 9900-PROCESS-DB2-ERROR                           47630000
               SET PS-STOP-REC-PROCESSING TO TRUE                       47640000
           END-IF.                                                      47650000
                                                                        47660000
      * ------------------------------------------------------------- * 47670000
      * GETS THE OPEN FISCAL MONTH CALENDAR YEAR BASED ON THE ROW IN    47680000
      * THE LEDGER CONTROL TABLE (TMLCNTL).                             47690000
      * ------------------------------------------------------------- * 47700000
       7860-GET-FISCAL-YR-NBR.                                          47710000
      *                                                                 47720000
           MOVE '7860-GET-FISCAL-YR-NBR' TO PV-PARAGRAPH.               47730000
      *                                                                 47740000
           PERFORM                                                      47750000
               WITH TEST AFTER                                          47760000
               VARYING PV-SQL-SUB                                       47770000
               FROM 1 BY 1                                              47780000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        47790000
                  OR SQLCODE = ZERO                                     47800000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         47810000
                  OR PS-STOP-REC-PROCESSING                             47820000
      *                                                                 47830000
                 EXEC SQL                                               47840000
                     SELECT B.FSCL_YR_NBR                               47850000
                     INTO  :DTATTR-FSCL-YR-NBR                          47860000
                     FROM   TMLCNTL A                                   47870000
                           ,TDTATTR B                                   47880000
                     WHERE  B.KY_DTE = A.OPN_FSCL_MN_DTE                47890000
                 END-EXEC                                               47900000
      *                                                                 47910000
               EVALUATE TRUE                                            47920000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              47930000
                   WHEN SQLCODE = PC-DEADLOCK                           47940000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      47950000
                   WHEN SQLCODE = ZERO                                  47960000
                        CONTINUE                                        47970000
                   WHEN SQLWARN0 NOT = SPACE                            47980000
                   WHEN SQLCODE NOT = ZERO                              47990000
                       MOVE 'BAD SQLCODE FOR GET TMLCNTL/TDTATTR'       48000000
                                     TO  PV-MESSAGE                     48010000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           48020000
                       PERFORM 9900-PROCESS-DB2-ERROR                   48030000
                       SET PS-STOP-REC-PROCESSING TO TRUE               48040000
               END-EVALUATE                                             48050000
           END-PERFORM.                                                 48060000
      *                                                                 48070000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               48080000
               MOVE 'MAX RETRIES EXCEEDED FOR GET TMLCNTL/TDTATTR'      48090000
                                     TO  PV-MESSAGE                     48100000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   48110000
               PERFORM 9900-PROCESS-DB2-ERROR                           48120000
               SET PS-STOP-REC-PROCESSING TO TRUE                       48130000
           END-IF.                                                      48140000
                                                                        48150000
           IF SQLCODE = PC-ROW-NOT-FOUND                                48160000
               MOVE 'TMLCNTL/TDTATTR ROW NOT FOUND FOR SELECT'          48170000
                                     TO PV-MESSAGE                      48180000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   48190000
               PERFORM 9900-PROCESS-DB2-ERROR                           48200000
               SET PS-STOP-REC-PROCESSING TO TRUE                       48210000
           END-IF.                                                      48220000
                                                                        48230000
      * ------------------------------------------------------------- * 48240000
      * OPEN CURSOR FOR APPLICATION AVAILABILITY TABLE                  48250000
      * ------------------------------------------------------------- * 48260000
       7870-OPEN-APLAVL-CURSOR.                                         48270000
      *                                                                 48280000
           MOVE '7870-OPEN-APLAVL-CURSOR' TO PV-PARAGRAPH.              48290000
      *                                                                 48300000
           PERFORM                                                      48310000
               WITH TEST AFTER                                          48320000
               VARYING PV-SQL-SUB                                       48330000
               FROM 1 BY 1                                              48340000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        48350000
                  OR SQLCODE = ZERO                                     48360000
                  OR PS-STOP-REC-PROCESSING                             48370000
      *                                                                 48380000
                 EXEC SQL                                               48390000
                     OPEN APLAVL_CUR                                    48400000
                 END-EXEC                                               48410000
      *                                                                 48420000
               EVALUATE TRUE                                            48430000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              48440000
                   WHEN SQLCODE = PC-DEADLOCK                           48450000
                   WHEN SQLCODE = ZERO                                  48460000
                        CONTINUE                                        48470000
                   WHEN SQLWARN0 NOT = SPACE                            48480000
                   WHEN SQLCODE NOT = ZERO                              48490000
                       MOVE 'BAD SQLCODE FOR OPEN TAPLAVL CURSOR'       48500000
                                     TO  PV-MESSAGE                     48510000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           48520000
                       PERFORM 9900-PROCESS-DB2-ERROR                   48530000
                       SET PS-STOP-REC-PROCESSING TO TRUE               48540000
               END-EVALUATE                                             48550000
           END-PERFORM.                                                 48560000
      *                                                                 48570000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               48580000
               MOVE 'MAX RETRIES EXCEEDED FOR OPEN TAPLAVL CURSOR'      48590000
                                     TO  PV-MESSAGE                     48600000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   48610000
               PERFORM 9900-PROCESS-DB2-ERROR                           48620000
               SET PS-STOP-REC-PROCESSING TO TRUE                       48630000
           END-IF.                                                      48640000
                                                                        48650000
      * ------------------------------------------------------------- * 48660000
      * FETCH A ROW FROM THE APPLICATION AVAILABILITY TABLE CURSOR      48670000
      * ------------------------------------------------------------- * 48680000
       7880-FETCH-APPL-AVAIL-ROW.                                       48690000
                                                                        48700000
           MOVE '7880-FETCH-APPL-AVAIL-ROW' TO PV-PARAGRAPH.            48710000
                                                                        48720000
           PERFORM                                                      48730000
               WITH TEST AFTER                                          48740000
               VARYING PV-SQL-SUB                                       48750000
               FROM 1 BY 1                                              48760000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        48770000
                  OR SQLCODE = ZERO                                     48780000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         48790000
                  OR PS-STOP-REC-PROCESSING                             48800000
                                                                        48810000
                 EXEC SQL                                               48820000
                     FETCH  APLAVL_CUR                                  48830000
                     INTO  :APLAVL-APLSYS-CDE,                          48840000
                           :APLAVL-MDSEAR-DKEY,                         48850000
                           :APLAVL-MDSEAR-STRT-DTE,                     48860000
                           :APLAVL-MDSEAR-END-DTE                       48870000
                 END-EXEC                                               48880000
      *                                                                 48890000
               EVALUATE TRUE                                            48900000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              48910000
                   WHEN SQLCODE = PC-DEADLOCK                           48920000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      48930000
                       SET PS-ROW-NOT-FOUND TO TRUE                     48940000
                   WHEN SQLCODE = ZERO                                  48950000
                        CONTINUE                                        48960000
                   WHEN SQLWARN0 NOT = SPACE                            48970000
                   WHEN SQLCODE NOT = ZERO                              48980000
                       MOVE 'BAD SQLCODE FOR FETCH TAPLAVL CURSOR'      48990000
                                     TO  PV-MESSAGE                     49000000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           49010000
                       PERFORM 9900-PROCESS-DB2-ERROR                   49020000
                       SET PS-STOP-REC-PROCESSING TO TRUE               49030000
               END-EVALUATE                                             49040000
           END-PERFORM.                                                 49050000
      *                                                                 49060000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               49070000
               MOVE 'MAX RETRIES EXCEEDED FOR FETCH TAPLAVL CURSOR'     49080000
                                     TO  PV-MESSAGE                     49090000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   49100000
               PERFORM 9900-PROCESS-DB2-ERROR                           49110000
               SET PS-STOP-REC-PROCESSING TO TRUE                       49120000
           END-IF.                                                      49130000
                                                                        49140000
      * ------------------------------------------------------------- * 49150000
      * CLOSE CURSOR FOR APPLICATION AVAILABILITY TABLE                 49160000
      * ------------------------------------------------------------- * 49170000
       7890-CLOSE-APLAVL-CURSOR.                                        49180000
      *                                                                 49190000
           MOVE '7890-CLOSE-APLAVL-CURSOR' TO PV-PARAGRAPH.             49200000
      *                                                                 49210000
           PERFORM                                                      49220000
               WITH TEST AFTER                                          49230000
               VARYING PV-SQL-SUB                                       49240000
               FROM 1 BY 1                                              49250000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        49260000
                  OR SQLCODE = ZERO                                     49270000
                  OR PS-STOP-REC-PROCESSING                             49280000
      *                                                                 49290000
                 EXEC SQL                                               49300000
                     CLOSE APLAVL_CUR                                   49310000
                 END-EXEC                                               49320000
      *                                                                 49330000
               EVALUATE TRUE                                            49340000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              49350000
                   WHEN SQLCODE = PC-DEADLOCK                           49360000
                   WHEN SQLCODE = ZERO                                  49370000
                        CONTINUE                                        49380000
                   WHEN SQLWARN0 NOT = SPACE                            49390000
                   WHEN SQLCODE NOT = ZERO                              49400000
                       MOVE 'BAD SQLCODE FOR CLOSE TAPLAVL CURSOR'      49410000
                                     TO  PV-MESSAGE                     49420000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           49430000
                       PERFORM 9900-PROCESS-DB2-ERROR                   49440000
                       SET PS-STOP-REC-PROCESSING TO TRUE               49450000
               END-EVALUATE                                             49460000
           END-PERFORM.                                                 49470000
      *                                                                 49480000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               49490000
               MOVE 'MAX RETRIES EXCEEDED FOR CLOSE TAPLAVL CURSOR'     49500000
                                     TO  PV-MESSAGE                     49510000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   49520000
               PERFORM 9900-PROCESS-DB2-ERROR                           49530000
               SET PS-STOP-REC-PROCESSING TO TRUE                       49540000
           END-IF.                                                      49550000
                                                                        49560000
      * ------------------------------------------------------------- * 49570000
      * INSERT THE DEPARTMENT SHRINK PERCENT ROWS                       49580000
      * ------------------------------------------------------------- * 49590000
       7900-INSERT-APLAVL-ROW.                                          49600000
                                                                        49610000
           MOVE '7900-INSERT-APLAVL-ROW' TO PV-PARAGRAPH.               49620000
           MOVE 'INSERT ROW '            TO PV-ACTION.                  49630000
                                                                        49640000
           PERFORM                                                      49650000
               WITH TEST AFTER                                          49660000
               VARYING PV-SQL-SUB                                       49670000
               FROM 1 BY 1                                              49680000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        49690000
                  OR SQLCODE = 0                                        49700000
                  OR SQLCODE = PC-ROW-ALREADY-EXISTS                    49710000
                  OR PS-STOP-REC-PROCESSING                             49720000
                                                                        49730000
                 EXEC SQL                                               49740000
                     INSERT INTO TAPLAVL                                49750000
                            (APLSYS_CDE                                 49760000
                           , MDSEAR_DKEY                                49770000
                           , MDSEAR_STRT_DTE                            49780000
                           , MDSEAR_END_DTE                             49790000
                           , OPERCO_NBR)                                49800000
                     VALUES (:APLAVL-APLSYS-CDE                         49810000
                           , :APLAVL-MDSEAR-DKEY                        49820000
                           , :APLAVL-MDSEAR-STRT-DTE                    49830000
                           , :APLAVL-MDSEAR-END-DTE                     49840000
                           , :APLAVL-OPERCO-NBR)                        49850000
                 END-EXEC                                               49860000
      *                                                                 49870000
      *                                                                 49880000
               EVALUATE TRUE                                            49890000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              49900000
                   WHEN SQLCODE = PC-DEADLOCK                           49910000
                   WHEN SQLCODE = PC-ROW-ALREADY-EXISTS                 49920000
                   WHEN SQLCODE = ZERO                                  49930000
                        CONTINUE                                        49940000
                   WHEN SQLWARN0 NOT = SPACE                            49950000
                   WHEN SQLCODE NOT =  ZERO                             49960000
                       MOVE 'BAD SQLCODE FOR TAPLAVL INSERT'            49970000
                                     TO  PV-MESSAGE                     49980000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           49990000
                       PERFORM 9900-PROCESS-DB2-ERROR                   50000000
                       SET PS-STOP-REC-PROCESSING TO TRUE               50010000
               END-EVALUATE                                             50020000
           END-PERFORM.                                                 50030000
      *                                                                 50040000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               50050000
               MOVE  'MAX RETRIES EXCEEDED FOR TAPLAVL INSERT'          50060000
                      TO PV-MESSAGE                                     50070000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   50080000
               PERFORM 9900-PROCESS-DB2-ERROR                           50090000
               SET PS-STOP-REC-PROCESSING TO TRUE                       50100000
           END-IF.                                                      50110000
      *                                                                 50120000
           IF SQLCODE = PC-ROW-ALREADY-EXISTS                           50130000
RMSRET*        MOVE 'TAPLAVL ROW ALREADY EXISTS FOR INSERT'             50140011
RMSRET*                              TO  PV-MESSAGE                     50150011
RMSRET*        MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   50160011
RMSRET*        PERFORM 9900-PROCESS-DB2-ERROR                           50170011
RMSRET*        SET PS-STOP-REC-PROCESSING TO TRUE                       50180011
RMSRET         ADD 1 TO PA-SKIPPED-ERRORS                               50190011
           END-IF.                                                      50200000
                                                                        50210000
0603RM* ------------------------------------------------------------- * 50220000
0603RM* UPDATE THE APPLIATION AVAILABLITY END DATE                      50230000
0603RM* ------------------------------------------------------------- * 50240000
0603RM 7905-UPD-TAPLAVL-DTE.                                            50250000
0603RM                                                                  50260000
0603RM     MOVE '7905-UPD-TAPLAVL-DTE ' TO PV-PARAGRAPH.                50270000
0603RM     MOVE 'INSERT ROW '           TO PV-ACTION.                   50280000
0603RM                                                                  50290000
0603RM     PERFORM                                                      50300000
0603RM         WITH TEST AFTER                                          50310000
0603RM         VARYING PV-SQL-SUB                                       50320000
0603RM         FROM 1 BY 1                                              50330000
0603RM         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        50340000
0603RM            OR SQLCODE = 0                                        50350000
0603RM            OR SQLCODE = PC-ROW-ALREADY-EXISTS                    50360000
0603RM            OR PS-STOP-REC-PROCESSING                             50370000
0603RM                                                                  50380000
0603RM           EXEC SQL                                               50390000
0603RM               UPDATE  TAPLAVL                                    50400000
0603RM               SET     MDSEAR_END_DTE = :PC-DEFAULT-DATE          50410000
0603RM               WHERE   MDSEAR_DKEY    = :APLAVL-MDSEAR-DKEY       50420000
0603RM           END-EXEC                                               50430000
0603RM*                                                                 50440000
0603RM         EVALUATE TRUE                                            50450000
0603RM             WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              50460000
0603RM             WHEN SQLCODE = PC-DEADLOCK                           50470000
0603RM             WHEN SQLCODE = ZERO                                  50480000
0603RM                  CONTINUE                                        50490000
0603RM             WHEN SQLWARN0 NOT = SPACE                            50500000
0603RM             WHEN SQLCODE NOT =  ZERO                             50510000
0603RM                 MOVE 'BAD SQLCODE FOR TAPLAVL UPDATE'            50520000
0603RM                               TO  PV-MESSAGE                     50530000
0603RM                 MOVE HMRD001-RECORD TO PV-INPUT-RECORD           50540000
0603RM                 PERFORM 9900-PROCESS-DB2-ERROR                   50550000
0603RM                 SET PS-STOP-REC-PROCESSING TO TRUE               50560000
0603RM         END-EVALUATE                                             50570000
0603RM     END-PERFORM.                                                 50580000
0603RM*                                                                 50590000
0603RM     IF PV-SQL-SUB > PC-MAX-RETRIES                               50600000
0603RM         MOVE  'MAX RETRIES EXCEEDED FOR TAPLAVL UPDATE'          50610000
0603RM                TO PV-MESSAGE                                     50620000
0603RM         MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   50630000
0603RM         PERFORM 9900-PROCESS-DB2-ERROR                           50640000
0603RM         SET PS-STOP-REC-PROCESSING TO TRUE                       50650000
0603RM     END-IF.                                                      50660000
0603RM*                                                                 50670000
      * ------------------------------------------------------------- * 50680000
      * GETS THE DEFAULT WORKER INFO FOR TRSPBAR INSERTS FROM THE       50690000
      * WORKER TABLE (TWORKER).                                         50700000
      * ------------------------------------------------------------- * 50710000
       7910-GET-WORKER-INF0.                                            50720000
      *                                                                 50730000
           MOVE '7910-GET-WORKER-INF0' TO PV-PARAGRAPH.                 50740000
      *                                                                 50750000
           PERFORM                                                      50760000
               WITH TEST AFTER                                          50770000
               VARYING PV-SQL-SUB                                       50780000
               FROM 1 BY 1                                              50790000
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        50800000
                  OR SQLCODE = ZERO                                     50810000
                  OR SQLCODE = PC-ROW-NOT-FOUND                         50820000
                  OR PS-STOP-REC-PROCESSING                             50830000
      *                                                                 50840000
                 EXEC SQL                                               50850000
                     SELECT WORKER_NBR,                                 50860000
                            LAST_NAME,                                  50870000
                            FIR_NAME                                    50880000
                     INTO  :WORKER-NBR,                                 50890000
                           :WORKER-LAST-NAME,                           50900000
                           :WORKER-FIR-NAME                             50910000
                     FROM   TWORKER                                     50920000
                     WHERE  UID_NBR = :WORKER-UID-NBR                   50930000
                       AND  OPERCO_NBR = '03'                           50940000
                 END-EXEC                                               50950000
      *                                                                 50960000
               EVALUATE TRUE                                            50970000
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              50980000
                   WHEN SQLCODE = PC-DEADLOCK                           50990000
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      51000000
                   WHEN SQLCODE = ZERO                                  51010000
                        CONTINUE                                        51020000
                   WHEN SQLWARN0 NOT = SPACE                            51030000
                   WHEN SQLCODE NOT = ZERO                              51040000
                       MOVE 'BAD SQLCODE FOR GET TWORKER'               51050000
                                     TO  PV-MESSAGE                     51060000
                       MOVE HMRD001-RECORD TO PV-INPUT-RECORD           51070000
                       PERFORM 9900-PROCESS-DB2-ERROR                   51080000
                       SET PS-STOP-REC-PROCESSING TO TRUE               51090000
               END-EVALUATE                                             51100000
           END-PERFORM.                                                 51110000
      *                                                                 51120000
           IF PV-SQL-SUB > PC-MAX-RETRIES                               51130000
               MOVE 'MAX RETRIES EXCEEDED FOR GET TWORKER'              51140000
                                     TO  PV-MESSAGE                     51150000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   51160000
               PERFORM 9900-PROCESS-DB2-ERROR                           51170000
               SET PS-STOP-REC-PROCESSING TO TRUE                       51180000
           END-IF.                                                      51190000
                                                                        51200000
           IF SQLCODE = PC-ROW-NOT-FOUND                                51210000
               MOVE 'TWORKER ROW NOT FOUND FOR SELECT'                  51220000
                                     TO PV-MESSAGE                      51230000
               MOVE HMRD001-RECORD TO PV-INPUT-RECORD                   51240000
               PERFORM 9900-PROCESS-DB2-ERROR                           51250000
               SET PS-STOP-REC-PROCESSING TO TRUE                       51260000
           END-IF.                                                      51270000
                                                                        51280000
      * ------------------------------------------------------------- * 51290000
      * READ CONTROL CARD 1 TO OBTAIN THE INPUT QUEUE MGR NAME          51300000
      * ------------------------------------------------------------- * 51310000
       8000-READ-CONTROL-CARD1.                                         51320000
            READ CONTROL-CARD-1 INTO CC-CONTROL-CARD-1                  51330000
                AT END                                                  51340000
                    SET PS-CONTROL-CARD-1-END   TO TRUE.                51350000
                                                                        51360000
      * ------------------------------------------------------------- * 51370000
      * READ CONTROL CARD 2 TO OBTAIN THE INPUT QUEUE NAME              51380000
      * ------------------------------------------------------------- * 51390000
       8010-READ-CONTROL-CARD2.                                         51400000
            READ CONTROL-CARD-2 INTO CC-CONTROL-CARD-2                  51410000
                AT END                                                  51420000
                    SET PS-CONTROL-CARD-2-END TO TRUE.                  51430000
                                                                        51440000
      *----------------------------------------------------------------*51450000
      *  WRITE AN ERROR RECORD, BUT DO NOT ABEND THE PROGARM           *51460000
      *----------------------------------------------------------------*51470000
       8100-WRITE-BACKUP-RECORD.                                        51480000
           WRITE BACKUP-RECORD FROM HMRD001-RECORD.                     51490000
                                                                        51500000
      *----------------------------------------------------------------*51510000
      *  WRITE AN ERROR RECORD, BUT DO NOT ABEND THE PROGARM           *51520000
      *----------------------------------------------------------------*51530000
       8150-WRITE-BUSGP-UPDTS-REC.                                      51540000
           WRITE BUSGP-UPDTS-RECORD FROM HMRD017-BUS-GRP-DESC-RECORD.   51550000
           ADD 1 TO PA-BUS-GRP-SHRT-DESC-UPDTS.                         51560000
                                                                        51570000
      * ------------------------------------------------------------- * 51580000
      * GET RMS MERCH HIERARCHY MESSAGES FROM MQ SERIES                 51590000
      * ------------------------------------------------------------- * 51600000
       8200-MQGET-MSG.                                                  51610000
                                                                        51620000
           INITIALIZE PS-MQGET-SUCCESSFUL-SW.                           51630000
           INITIALIZE PV-MSGBUFFER.                                     51640000
           MOVE MQMI-NONE              TO MQMD-MSGID.                   51650000
           MOVE MQCI-NONE              TO MQMD-CORRELID.                51660000
           MOVE CC-MERCH-HIER-QNAME    TO MQOD-OBJECTNAME.              51670000
0703RM     MOVE 60000                  TO MQGMO-WAITINTERVAL.           51680000
           COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +                   51690000
                                    MQGMO-CONVERT +                     51700000
                                    MQGMO-WAIT.                         51710000
                                                                        51720000
           CALL WS-MQGET USING PV-HCONN                                 51730000
                               PV-GQ-HANDLE                             51740000
                               MQM-MESSAGE-DESCRIPTOR                   51750000
                               MQM-GET-MESSAGE-OPTIONS                  51760000
                               PV-MSGLENGTH                             51770000
                               PV-MSGBUFFER                             51780000
                               PV-DATA-LENGTH                           51790000
                               PV-COMPLETION-CODE                       51800000
                               PV-REASON.                               51810000
                                                                        51820000
      *        IF GET FAILED THEN DISPLAY ERROR MESSAGE                 51830000
      *        AND BREAK OUT OF LOOP                                    51840000
                                                                        51850000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        51860000
              IF (PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)                51870000
                  MOVE PV-COMPLETION-CODE TO PH-COMPLETION-CODE         51880000
                  MOVE PV-REASON          TO PH-REASON                  51890000
                  PERFORM 8500-BACK-OUT-MQ                              51900000
                  PERFORM 1600-CLOSE-QUEUE                              51910000
                  PERFORM 1700-DISCONNECT-QMGR                          51920000
                  MOVE 'MQGET ERROR'      TO PV-ERROR-MESSAGE           51930000
                  MOVE PH-COMPLETION-CODE TO PV-COMPLETION-CODE         51940000
                  MOVE PH-REASON          TO PV-REASON                  51950000
                  PERFORM 9000-DISPLAY-MQ-ERROR                         51960000
              ELSE                                                      51970000
                  DISPLAY 'NO MORE MESSAGES AVAILABLE'                  51980000
              END-IF                                                    51990000
           ELSE                                                         52000000
              MOVE MQMD-REPLYTOQMGR TO PV-ISP-QMGR-NAME                 52010000
      *       DISPLAY "*** REPLY TO QUEUE MANAGER NAME OF MSG : ",      52020000
      *               MQMD-REPLYTOQMGR                                  52030000
              SET PS-MQGET-SUCCESSFUL TO TRUE                           52040000
              ADD 1 TO PA-MQGET                                         52050000
              MOVE PV-MSGBUFFER TO HMRD001-RECORD                       52060000
              INSPECT HM001-DIVISION-DATA REPLACING ALL '|' BY ' '      52070000
              INSPECT HM001-DIVISION-DATA REPLACING ALL '_' BY ' '      52080000
              PERFORM 8100-WRITE-BACKUP-RECORD                          52090000
           END-IF.                                                      52100000
                                                                        52110000
      ******************************************************************52120000
      *  COMMIT DB2 PROCESSING SINCE THE POINT OF THE LAST COMMIT      *52130000
      ******************************************************************52140000
                                                                        52150000
       8400-COMMIT-DB2.                                                 52160000
                                                                        52170000
           EXEC SQL                                                     52180000
              COMMIT                                                    52190000
           END-EXEC.                                                    52200000
                                                                        52210000
           IF SQLCODE NOT = +0                                          52220000
              SET PV-COMMIT-DB2-INSERTS TO TRUE                         52230000
              PERFORM 8500-BACK-OUT-MQ                                  52240000
              MOVE '8400-COMMIT-DB2'    TO PV-PARAGRAPH                 52250000
              PERFORM 9900-PROCESS-DB2-ERROR                            52260000
           END-IF.                                                      52270000
                                                                        52280000
                                                                        52290000
      ******************************************************************52300000
      *  ROLLBACK DB2 PROCESSING SINCE THE POINT OF THE LAST COMMIT    *52310000
      ******************************************************************52320000
                                                                        52330000
       8410-ROLLBACK-DB2.                                               52340000
                                                                        52350000
           EXEC SQL                                                     52360000
              ROLLBACK                                                  52370000
           END-EXEC.                                                    52380000
                                                                        52390000
           IF SQLCODE NOT = +0                                          52400000
              MOVE '8410-ROLLBACK-DB2'  TO PV-PARAGRAPH                 52410000
              MOVE 'ATTEMPT TO ROLLBACK UPDATES TO DB2 TABLES'          52420000
                                        TO PV-MESSAGE                   52430000
              PERFORM 8500-BACK-OUT-MQ                                  52440000
              PERFORM 9900-PROCESS-DB2-ERROR                            52450000
           END-IF.                                                      52460000
                                                                        52470000
                                                                        52480000
      ******************************************************************52490000
      *  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       *52500000
      ******************************************************************52510000
                                                                        52520000
       8450-COMMIT-MQ.                                                  52530000
                                                                        52540000
           CALL WS-MQCMIT USING PV-HCONN                                52550000
                                PV-COMPLETION-CODE                      52560000
                                PV-REASON.                              52570000
                                                                        52580000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        52590000
              MOVE '8450-COMMIT-MQ'  TO PV-PARAGRAPH                    52600000
              MOVE 'MQCMIT ERROR'    TO PV-ERROR-MESSAGE                52610000
              PERFORM 8500-BACK-OUT-MQ                                  52620000
              PERFORM 9000-DISPLAY-MQ-ERROR                             52630000
           END-IF.                                                      52640000
                                                                        52650000
      ******************************************************************52660000
      * BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT      *52670000
      ******************************************************************52680000
                                                                        52690000
       8500-BACK-OUT-MQ.                                                52700000
                                                                        52710000
           CALL WS-MQBACK USING PV-HCONN                                52720000
                                PV-COMPLETION-CODE                      52730000
                                PV-REASON.                              52740000
                                                                        52750000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   52760000
              MOVE '8500-BACK-OUT-MQ'  TO PV-PARAGRAPH                  52770000
              MOVE 'MQBACK ERROR'    TO PV-ERROR-MESSAGE                52780000
              PERFORM 9000-DISPLAY-MQ-ERROR                             52790000
           END-IF.                                                      52800000
                                                                        52810000
      * ------------------------------------------------------------- * 52820000
      * DISPLAY THE VALUES OF A FAILED MQ API COMMAND                   52830000
      * ------------------------------------------------------------- * 52840000
       9000-DISPLAY-MQ-ERROR.                                           52850000
                                                                        52860000
           DISPLAY '**** ABEND *************************************'   52870000
           DISPLAY '** MQSERIES ERROR **'                               52880000
           DISPLAY '** PROGRAM:    ', PC-PGM-NAME                       52890000
           DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH                      52900000
           DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE                  52910000
           DISPLAY '** COMP CODE:  ', PV-COMPLETION-CODE                52920000
           DISPLAY '** RSN CODE:   ', PV-REASON                         52930000
           DISPLAY '************************************************'   52940000
           SET AC-MQ-ERROR TO TRUE.                                     52950000
           CALL 'ILBOABN0' USING ABEND-CODE.                            52960000
                                                                        52970000
      *----------------------------------------------------------------*52980000
      *  FORMAT A DB2 ERROR MESSAGE                                    *52990000
      *----------------------------------------------------------------*53000000
                                                                        53010000
       9900-PROCESS-DB2-ERROR.                                          53020000
                                                                        53030000
           DISPLAY '***************************************************'53040000
           DISPLAY '**  ERROR     **'                                   53050000
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  53060000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH.                 53070000
           DISPLAY '**  MESSAGE   **  = ' PV-MESSAGE.                   53080000
           DISPLAY '**  INPUT REC **  = ' PV-INPUT-RECORD.              53090000
      *                                                                 53100000
      *  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     53110000
      *  THE CALLED MODULE DSNTIAR.                                     53120000
      *                                                                 53130000
           COPY DPPD004.                                                53140000
                                                                        53150000
           PERFORM 9910-WRITE-ERROR-RECORD.                             53160000
           SET PS-INPUT-REC-ERROR TO TRUE.                              53170000
                                                                        53180000
      *----------------------------------------------------------------*53190000
      *  WRITE AN ERROR RECORD, BUT DO NOT ABEND THE PROGARM           *53200000
      *----------------------------------------------------------------*53210000
                                                                        53220000
       9910-WRITE-ERROR-RECORD.                                         53230000
           WRITE ERROR-RECORD FROM HMRD001-RECORD.                      53240000
           ADD 1 TO PA-ERRORS.                                          53250000
                                                                        53260000
      *-- DO NOT BACK OUT MQ MESSAGE JUST WRITE TO OUTPUT FILE          53270000
      *    PERFORM 8500-BACK-OUT-MQ.                                    53280000
      *    CALL 'ILBOABN0' USING ABEND-CODE.                            53290000
