000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SVKRP036.                                00050001
000600 AUTHOR.                 DANIEL OKYERE.                           00060001
000700 INSTALLATION.           KOHLS.                                   00070001
000800 DATE-WRITTEN            JULY 2005.                               00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100***************************************************************** 00110001
001200* * * *>>>   THIS PROGRAM MUST BE COMPILED COBOL/390   <<<* * * * 00120001
001300***************************************************************** 00130001
001400*                                                                 00140001
001500*  THIS PROGRAM WILL CREATE WEEKLY STORED VALUE CARD AGING        00150001
001600*  REPORTS FROM AN INPUT FILE CONTAINING CARD ACTIVITY.           00160001
001700*                                                                 00170001
001800*  THE INPUT ACTIVITY FILE (INP01) CONTAINS CARD ACTIVITY DATA,   00180001
001900*  IN THE FORM OF ISSUE RECORDS AND TENDER RECORDS.  AN ISSUE     00190001
002000*  RECORD HOLDS ISSUE DATA SUCH AS ISSUE DATE AND ISSUE AMOUNT.   00200001
002100*  TENDER RECORDS HOLD TENDER DATA SUCH AS DATES TENDERED, AND    00210001
002200*  TENDERED AMOUNTS.  EACH CARD HAS ONE OR MANY ISSUE RECORD,     00220001
002300*  AND ZERO OR MANY TENDER RECORDS, DEPENDING ON HOW MANY TIMES   00230001
002400*  THE CARD WAS TENDERED.                                         00240001
002500*                                                                 00250001
002600*  THIS CARD ACTIVITY IS ACCUMULATED BY FISCAL PERIOD IN          00260001
002700*  WORKING STORAGE TABLES AND THEN PRINTED ON AN OUTPUT REPORT.   00270001
002800*  - SVKRP036-1  AGING REPORT IN DOLLARS (RPT01).                 00280001
002900*                                                                 00290001
003000*  THE REPORT IS BROKEN INTO KCK, KMRC, AND ALL OTHER CARDS       00300001
003100*                                                                 00310001
003200*  THE INPUT CARD DATE FILE (INP02) CONTAINS A FISCAL WEEK BEGIN  00320001
003300*  DATE, WHICH WILL BE USED TO DETERMINE THE FIRST FISCAL PERIOD  00330001
003400*  TO BE USED FOR THE REPORTS.                                    00340001
003410*                                                                 00341001
003420*  THE INPUT CARD DATE FILE (INP03) CONTAINS A FISCAL WEEK END    00342001
003430*  DATE, WHICH WILL BE USED TO DETERMINE THE LAST FISCAL PERIOD   00343001
003440*  TO BE USED FOR THE REPORTS.                                    00344001
003450*                                                                 00345001
003460******************************************************************00346001
003470*  12/16/10 - TDH  FIXED TABLE TRUNCATION ISSUE WITH KMRC CARDS.  00347001
003480*             CHANGES MARKED TDH02.                               00348001
003490******************************************************************00349001
003500 ENVIRONMENT DIVISION.                                            00350001
003600***************************************************************** 00360001
003700                                                                  00370001
003800 CONFIGURATION SECTION.                                           00380001
003900                                                                  00390001
004000 SOURCE-COMPUTER.        IBM-3090.                                00400001
004100 OBJECT-COMPUTER.        IBM-3090.                                00410001
004200                                                                  00420001
004300 INPUT-OUTPUT SECTION.                                            00430001
004400                                                                  00440001
004500 FILE-CONTROL.                                                    00450001
004600                                                                  00460001
004700     SELECT ACTIVITY-FILE                                         00470001
004800         ASSIGN TO INP01.                                         00480001
004900                                                                  00490001
005000     SELECT DATE-BEG-FILE                                         00500001
005100         ASSIGN TO INP02.                                         00510001
005200                                                                  00520001
005300     SELECT DATE-END-FILE                                         00530001
005400         ASSIGN TO INP03.                                         00540001
005500                                                                  00550001
005600     SELECT DOLLAR-REPORT-FILE                                    00560001
005700         ASSIGN TO RPT01.                                         00570001
005800                                                                  00580001
005900******************************************************************00590001
006000 DATA DIVISION.                                                   00600001
006100******************************************************************00610001
006200                                                                  00620001
006300 FILE SECTION.                                                    00630001
006400                                                                  00640001
006500 FD  ACTIVITY-FILE                                                00650001
006600     RECORDING MODE IS F                                          00660001
006700     LABEL RECORDS ARE STANDARD                                   00670001
006800     BLOCK CONTAINS 0 RECORDS.                                    00680001
006900                                                                  00690001
007000 01  ACTIVITY-RECORD                 PIC  X(125).                 00700001
007100                                                                  00710001
007200 FD  DATE-BEG-FILE                                                00720001
007300     RECORDING MODE IS F                                          00730001
007400     BLOCK CONTAINS 0 RECORDS                                     00740001
007500     LABEL RECORDS ARE STANDARD.                                  00750001
007600                                                                  00760001
007700 01  DATE-BEG-RECORD                 PIC X(80).                   00770001
007800                                                                  00780001
007900 FD  DATE-END-FILE                                                00790001
008000     RECORDING MODE IS F                                          00800001
008100     BLOCK CONTAINS 0 RECORDS                                     00810001
008200     LABEL RECORDS ARE STANDARD.                                  00820001
008300                                                                  00830001
008400 01  DATE-END-RECORD                 PIC X(80).                   00840001
008500                                                                  00850001
008600 FD  DOLLAR-REPORT-FILE                                           00860001
008700     RECORDING MODE IS F                                          00870001
008800     BLOCK CONTAINS 0  RECORDS.                                   00880001
008900                                                                  00890001
009000*01  DOLLAR-REPORT-RECORD            PIC  X(200).                 00900001
009100 01  DOLLAR-REPORT-RECORD            PIC  X(226).                 00910001
009200                                                                  00920001
009300******************************************************************00930001
009400 WORKING-STORAGE SECTION.                                         00940001
009500******************************************************************00950001
009600******************************************************************00960001
009700* RECORD LAYOUT FOR INPUT ACTIVITY FILE                           00970001
009800******************************************************************00980001
009900     COPY SVRD036.                                                00990001
010000******************************************************************01000001
010100* RECORD LAYOUT FOR INPUT DATE CARD                               01010001
010200******************************************************************01020001
010300  01  CC-CONTROL-CARD.                                            01030001
010400      05  FILLER                       PIC X(01)  VALUE SPACE.    01040001
010500      05  CC-MONTH-END-CCYY-MM-DD      PIC X(10)  VALUE SPACES.   01050001
010600      05  FILLER                       PIC X(69)  VALUE SPACES.   01060001
010700                                                                  01070001
010800******************************************************************01080001
010900*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01090001
011000******************************************************************01100001
011100     COPY DPWS500.                                                01110001
011200                                                                  01120001
011300 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01130001
011400                                                  COMP.           01140001
011500     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01150001
011600     88  AC-TABLE-OVERFLOW-ERROR                  VALUE +4004.    01160001
011700     88  AC-DATASET-DATA-ERROR                    VALUE +4008.    01170001
011800     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01180001
011900                                                                  01190001
012000 01  PS-PROGRAM-SWITCHES.                                         01200001
012100     05  PS-END-OF-ACTVY-FILE-SW       PIC X(01)  VALUE 'N'.      01210001
012200         88  PS-END-OF-ACTVY-FILE                 VALUE 'Y'.      01220001
012300     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      01230001
012400         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01240001
012500     05  PS-TABLE-2-DATE-FOUND-SW      PIC X(01)  VALUE 'N'.      01250001
012600         88  PS-TABLE-2-DATE-FOUND                VALUE 'Y'.      01260001
012700         88  PS-TABLE-2-DATE-NOT-FOUND            VALUE 'N'.      01270001
012800     05  PS-END-OF-FISCAL-DATE-CSR-SW  PIC X(01)  VALUE 'N'.      01280001
012900         88  PS-END-OF-FISCAL-DATE-CSR            VALUE 'Y'.      01290001
013000         88  PS-NOT-END-OF-FISCAL-DATE-CSR        VALUE 'N'.      01300001
013100                                                                  01310001
013200 01  PC-CONSTANTS.                                                01320001
013300     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +73.     01330001
013400     05  PC-TABLE-LIMIT              PIC S9(04)    VALUE +9999.   01340003
013500     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01350001
013600                                                   'SVKRP036'.    01360001
013700     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       01370001
013800     05  PC-GIFT-CARDS-DESC          PIC  X(36)    VALUE          01380001
013900         'ALL GIFT CARDS EXCEPT KCK'.                             01390001
014000     05  PC-KCK-CARD-DESC            PIC  X(36)    VALUE          01400001
014100         'KCK - KOHLS CARES FOR KIDS'.                            01410001
014200     05  PC-KMRC-CARD-DESC           PIC  X(36)    VALUE          01420001
014300         'KMRC - MERCHANDISE RETURN CREDIT'.                      01430001
014400     05  PC-H2-DESC-DOLLARS          PIC  X(07)    VALUE          01440001
014500         'DOLLARS'.                                               01450001
014600     05  PC-H4-DESC-2-DOLLARS        PIC  X(08)    VALUE          01460001
014700         ' DOLLARS'.                                              01470001
014800                                                                  01480001
014900 01  PV-MISC-COUNT-FIELDS.                                        01490001
015000     05  PV-SVKRP036-1-PAGE-CNT      PIC S9(04)    VALUE ZERO     01500001
015100                                                   COMP-3.        01510001
015200     05  PV-SVKRP036-1-LINE-CNT      PIC S9(04)    VALUE ZERO     01520001
015300                                                   COMP.          01530001
015400******************************************************************01540001
015500*  FIELDS TO HOLD TOTALS FOR PRINTING A REPORT TOTAL LINE.        01550001
015600******************************************************************01560001
015700 01  PV-TOT-ACCUM-FIELDS.                                         01570001
015800     05  PV-TOT-DLR-ISSUED           PIC S9(11)V99 COMP-3         01580001
015900                                                   VALUE ZERO.    01590001
016000     05  PV-TOT-WK-DATA              OCCURS 13 TIMES              01600001
016100                                     INDEXED BY PV-TOT-IDX.       01610001
016200         10  PV-TOT-DLR-WK-QTY       PIC S9(09)V99 COMP-3         01620001
016300                                                   VALUE ZERO.    01630001
016400                                                                  01640001
016500******************************************************************01650001
016600*  FIELDS TO HOLD GRAND TOTAL FOR ALL CARDS.                     *01660001
016700******************************************************************01670001
016800 01  PV-GT-TOT-ACCUM-FIELDS.                                      01680001
016900     05  PV-GT-TOT-DLR-ISSUED        PIC S9(11)V99 COMP-3         01690001
017000                                                   VALUE ZERO.    01700001
017100     05  PV-GT-TOT-WK-DATA           OCCURS 13 TIMES              01710001
017200                                     INDEXED BY PV-GT-TOT-IDX.    01720001
017300         10  PV-GT-TOT-DLR-WK        PIC S9(09)V99 COMP-3         01730001
017400                                                   VALUE ZERO.    01740001
017500                                                                  01750001
017600******************************************************************01760001
017700*  FIELDS USED TO DETERMINE CONTROL BREAKS.                       01770001
017800******************************************************************01780001
017900 01  PV-SAVE-FIELDS.                                              01790001
018000     05  PV-SAVE-ISSUE-DATE          PIC X(10)     VALUE SPACE.   01800001
018100     05  PV-SAVE-FST-DATE            PIC X(10)     VALUE SPACE.   01810001
018200     05  PV-SAVE-LST-DATE            PIC X(10)     VALUE SPACE.   01820001
018300     05  PV-SAVE-LST-ACTVY-DTE       PIC X(10)     VALUE SPACE.   01830001
018400                                                                  01840001
018500 01  PV-MISC-FIELDS.                                              01850001
018600*TDH 05  PV-PRINT-RECORD             PIC X(200)    VALUE SPACE.   01860001
018700     05  PV-PRINT-RECORD             PIC X(226)    VALUE SPACE.   01870001
018800     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     01880001
018900                                                   COMP.          01890001
019000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01900001
019100     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01910001
019200     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01920001
019300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACE.   01930001
019400     05  PV-TB2-IDX                  PIC S9(04)    VALUE ZERO     01940001
019500                                                   COMP.          01950001
019600                                                                  01960001
019700 01  PV-DATE-AND-TIME-FIELDS.                                     01970001
019800*****  REUSEABLE DATE WORK FIELD IN CCYY-MM-DD FORMAT.            01980001
019900     05  PV-WORK-CCYY-MM-DD          PIC X(10)     VALUE SPACE.   01990001
020000*****  FIELDS FOR REPORT HEADINGS.                                02000001
020100     05  PV-CURR-DATE-CCYYMMDD.                                   02010001
020200         10  PV-CURR-DATE-CCYY       PIC  9(04).                  02020001
020300         10  PV-CURR-DATE-MM         PIC  9(02).                  02030001
020400         10  PV-CURR-DATE-DD         PIC  9(02).                  02040001
020500     05  PV-CURR-TIME.                                            02050001
020600         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    02060001
020700         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    02070001
020800         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    02080001
020900     05  PV-BEG-DATE                 PIC  X(10)    VALUE SPACE.   02090001
021000     05  PV-END-DATE                 PIC  X(10)    VALUE SPACE.   02100001
021100     05  FILLER REDEFINES PV-END-DATE.                            02110001
021200         10  PV-END-CCYY             PIC  X(04).                  02120001
021300         10  FILLER                  PIC  X(01).                  02130001
021400         10  PV-END-MM               PIC  X(02).                  02140001
021500         10  FILLER                  PIC  X(01).                  02150001
021600         10  PV-END-DD               PIC  X(02).                  02160001
021700                                                                  02170001
021800******************************************************************02180001
021900*  TOP OF PAGE HEADING LINE FOR PRINTING A 200 CHARACTER REPORT.  02190001
022000******************************************************************02200001
022100     COPY DPWS200.                                                02210001
022200                                                                  02220001
022300******************************************************************02230001
022400*  HEADING LINES FOR THE STORED VALUE AGING REPORTS.              02240001
022500******************************************************************02250001
022600 01  H2-HEADING-LINE-2.                                           02260001
022700     05  FILLER                      PIC  X(68)   VALUE SPACE.    02270001
022800     05  FILLER                      PIC  X(40)   VALUE           02280001
022900        'STORED VALUE WEEKLY ACTIVITY REPORT FOR '.               02290001
023000     05  H2-MONTH                    PIC  X(09)   VALUE SPACE.    02300001
023100     05  FILLER                      PIC  X(01)   VALUE SPACE.    02310001
023200     05  H2-DAY                      PIC  X(02)   VALUE SPACE.    02320001
023300     05  FILLER                      PIC  X(01)   VALUE SPACE.    02330001
023400     05  H2-YEAR                     PIC  X(04)   VALUE SPACE.    02340001
023500*TDH 05  FILLER                      PIC  X(75)   VALUE SPACE.    02350001
023600     05  FILLER                      PIC  X(101)  VALUE SPACE.    02360001
023700                                                                  02370001
023800 01  H3-HEADING-LINE-3.                                           02380001
023900     05  FILLER                      PIC  X(18)    VALUE          02390001
024000        'CARD STOCK TYPE:  '.                                     02400001
024100     05  H3-CRD-STK-DESC             PIC  X(36)    VALUE SPACE.   02410001
024200*TDH 05  FILLER                      PIC  X(146)   VALUE SPACE.   02420001
024300     05  FILLER                      PIC  X(172)   VALUE SPACE.   02430001
024400                                                                  02440001
024500 01  H4-HEADING-LINE-4.                                           02450001
024600     05  FILLER                      PIC  X(16)    VALUE          02460001
024700        'MONTH/YR        '.                                       02470001
024800     05  H4-RPT-DESC-1               PIC  X(07)    VALUE SPACE.   02480001
024900     05  FILLER                      PIC  X(06)    VALUE SPACE.   02490001
025000     05  FILLER                      PIC  X(77)    VALUE ALL '-'. 02500001
025100     05  H4-RPT-DESC-2               PIC  X(08)    VALUE SPACE.   02510001
025200     05  FILLER                      PIC  X(10)    VALUE          02520001
025300        ' TENDERED '.                                             02530001
025400*TDH 05  FILLER                      PIC  X(76)    VALUE ALL '-'. 02540001
025500     05  FILLER                      PIC  X(102)   VALUE ALL '-'. 02550001
025600                                                                  02560001
025700 01  H5-HEADING-LINE-5.                                           02570001
025800*TDH 05  FILLER                      PIC  X(27)    VALUE          02580001
025900     05  FILLER                      PIC  X(26)    VALUE          02590001
026000        ' ISSUED          ISSUED   '.                             02600001
026100*TDH 05  H5-MO-DATA                  PIC  X(173)   VALUE SPACE.   02610001
026200     05  H5-MO-DATA                  PIC  X(200)   VALUE SPACE.   02620001
026300                                                                  02630001
026400******************************************************************02640001
026500*  DETAIL LINE FOR DOLLARS STORED VALUE AGING REPORT.             02650001
026600******************************************************************02660001
026700 01  DL1-DETAIL-LINE-1.                                           02670001
026800     05  DL1-MO-1                    PIC  X(03)    VALUE SPACE.   02680001
026900     05  FILLER                      PIC  X(01)    VALUE '0'.     02690001
027000     05  DL1-WK-1                    PIC  X(01)    VALUE SPACE.   02700001
027100     05  FILLER                      PIC  X(01)    VALUE '-'.     02710001
027200     05  DL1-YR-1                    PIC  X(04)    VALUE SPACE.   02720001
027300     05  FILLER                      PIC  X(01)    VALUE SPACE.   02730001
027400     05  DL1-ISSUED-QTY-1            PIC  Z,ZZZ,ZZZ,ZZ9.99        02740001
027500                                                   VALUE ZERO.    02750001
027600     05  FILLER                      PIC  X(01)    VALUE SPACE.   02760001
027700*TDH 05  DL1-WK-DATA-1               PIC  X(172)   VALUE SPACE.   02770001
027800     05  DL1-WK-DATA-1               PIC  X(198)   VALUE SPACE.   02780001
027900                                                                  02790001
028000******************************************************************02800001
028100*  TOTAL LINE FOR DOLLARS STORED VALUE AGING REPORT.              02810001
028200******************************************************************02820001
028300 01  TL1-TOTAL-LINE-1.                                            02830001
028400     05  TL1-TOT-DESC                PIC  X(11)    VALUE SPACE.   02840001
028500     05  TL1-ISSUED-QTY-1            PIC  Z,ZZZ,ZZZ,ZZ9.99        02850001
028600                                                   VALUE ZERO.    02860001
028700     05  FILLER                      PIC  X(01)    VALUE SPACE.   02870001
028800*TDH 05  TL1-WK-DATA-1               PIC  X(172)   VALUE SPACE.   02880001
028900     05  TL1-WK-DATA-1               PIC  X(198)   VALUE SPACE.   02890001
029000******************************************************************02900001
029100*  TABLE TO PRINT 13 DOLLAR COLUMNS OF WEEK DATA ON A DETAIL/     02910001
029200*  TOTAL LINE.                                                    02920001
029300******************************************************************02930001
029400*  REPORT WAS TRUNCATING.  ADD 1 LENGTH TO PL-WK-QTY AND REMOVE   02940001
029500*  TRAILING SPACE. INPUT FILE MAY ALSO NEED TO BE CHANGED.        02950001
029600******************************************************************02960001
029700 01  PL-PRINT-LINE-TABLE.                                         02970001
029800     05  PL-PRINT-LINE-ENTRY         OCCURS 13 TIMES              02980001
029900                                     INDEXED BY PL-IDX.           02990001
030000*TDH     10  PL-WK-QTY               PIC  Z,ZZZ,ZZ9.99            03000001
030100         10  PL-WK-QTY               PIC ZZ,ZZZ,ZZ9.99            03010001
030200                                                   VALUE ZERO.    03020001
030300*TDH     10  FILLER                  PIC  X(01)    VALUE SPACE.   03030001
030400         10  FILLER                  PIC  X(02)    VALUE SPACE.   03040001
030500                                                                  03050001
030600******************************************************************03060001
030700*  TABLE TO PRINT 13 COLUMNS OF WEEK HEADINGS ON A HEADING LINE.  03070001
030800******************************************************************03080001
030900 01  HL-HEADING-LINE-TABLE.                                       03090001
031000     05  HL-HEADING-LINE-ENTRY       OCCURS 13 TIMES              03100001
031100                                     INDEXED BY HL-IDX.           03110001
031200*TDH     10  FILLER                  PIC  X(03)    VALUE SPACE.   03120001
031300         10  FILLER                  PIC  X(05)    VALUE SPACE.   03130001
031400         10  HL-MO-ABBR              PIC  X(03)    VALUE SPACE.   03140001
031500         10  FILLER                  PIC  X(01)    VALUE '0'.     03150001
031600         10  HL-WK-NBR               PIC  X(01)    VALUE SPACE.   03160001
031700         10  FILLER                  PIC  X(01)    VALUE '-'.     03170001
031800         10  HL-CCYY                 PIC  X(04)    VALUE SPACE.   03180001
031900                                                                  03190001
032000******************************************************************03200001
032100*  UNDER LINES FOR DOLLAR STORED VALUE AGING REPORT.              03210001
032200******************************************************************03220001
032300*  CHANGED FILLER '-' FROM X(12) TO X(14)                         03230001
032400******************************************************************03240001
032500 01  UL-UNDER-LINE.                                               03250001
032600     05  FILLER                      PIC  X(11)    VALUE SPACE.   03260001
032700     05  FILLER                      PIC  X(16)    VALUE ALL '-'. 03270001
032800     05  FILLER                      PIC  X(01)    VALUE SPACE.   03280001
032900     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03290001
033000     05  FILLER                      PIC  X(02)    VALUE SPACE.   03300001
033100     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03310001
033200     05  FILLER                      PIC  X(02)    VALUE SPACE.   03320001
033300     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03330001
033400     05  FILLER                      PIC  X(02)    VALUE SPACE.   03340001
033500     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03350001
033600     05  FILLER                      PIC  X(02)    VALUE SPACE.   03360001
033700     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03370001
033800     05  FILLER                      PIC  X(02)    VALUE SPACE.   03380001
033900     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03390001
034000     05  FILLER                      PIC  X(02)    VALUE SPACE.   03400001
034100     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03410001
034200     05  FILLER                      PIC  X(02)    VALUE SPACE.   03420001
034300     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03430001
034400     05  FILLER                      PIC  X(02)    VALUE SPACE.   03440001
034500     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03450001
034600     05  FILLER                      PIC  X(02)    VALUE SPACE.   03460001
034700     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03470001
034800     05  FILLER                      PIC  X(02)    VALUE SPACE.   03480001
034900     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03490001
035000     05  FILLER                      PIC  X(02)    VALUE SPACE.   03500001
035100     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03510001
035200     05  FILLER                      PIC  X(02)    VALUE SPACE.   03520001
035300     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 03530001
035400     05  FILLER                      PIC  X(02)    VALUE SPACE.   03540001
035500                                                                  03550001
035600******************************************************************03560001
035700*  BLANK LINE FOR THE STORED VALUE AGING REPORTS.                 03570001
035800******************************************************************03580001
035900 01  BL-BLANK-LINE.                                               03590001
036000*TDH 05  FILLER                      PIC  X(200)   VALUE SPACE.   03600001
036100     05  FILLER                      PIC  X(226)   VALUE SPACE.   03610001
036200                                                                  03620001
036300******************************************************************03630001
036400*  COPYBOOK OF MERCHANDISE CARD CONSTANTS                         03640001
036500******************************************************************03650001
036600     COPY SVWS004.                                                03660001
036700******************************************************************03670001
036800* TABLE TO HOLD DATA FOR ALL CARDS EXCEPT KCK.                    03680001
036900******************************************************************03690001
037000 01  TB1-PART-1-TABLE.                                            03700001
037100     05  TB1-PART-1-ENTRY            OCCURS 9999 TIMES.           03710003
037200         10  TB1-FISCAL-CCYY     PIC 9(04).                       03720001
037300         10  TB1-FISCAL-PER-ABBR     PIC X(03)     VALUE SPACE.   03730001
037400         10  TB1-FISCAL-WEEK-NBR     PIC X(01)     VALUE SPACE.   03740001
037500         10  TB1-FISCAL-FST-DATE     PIC X(10)     VALUE SPACE.   03750001
037600         10  TB1-FISCAL-LST-DATE     PIC X(10)     VALUE SPACE.   03760001
037700         10  TB1-DLR-ISSUED          PIC S9(10)V99 COMP-3         03770001
037800                                                   VALUE ZERO.    03780001
037900         10  TB1-WK-DATA             OCCURS 13 TIMES              03790001
038000                                     INDEXED BY TB1-M-IDX.        03800001
038100*TDH         15  TB1-DLR-WK-QTY      PIC S9(07)V99 COMP-3         03810001
038200             15  TB1-DLR-WK-QTY      PIC S9(08)V99 COMP-3         03820001
038300                                                   VALUE ZERO.    03830001
038400******************************************************************03840001
038500* TABLE TO HOLD KCK DATA.                                         03850001
038600******************************************************************03860001
038700 01  TB2-PART-2-TABLE.                                            03870001
038800     05  TB2-PART-2-ENTRY            OCCURS 9999 TIMES.           03880003
038900         10  TB2-FISCAL-CCYY         PIC 9(04).                   03890001
039000         10  TB2-FISCAL-PER-ABBR     PIC X(03)     VALUE SPACE.   03900001
039100         10  TB2-FISCAL-WEEK-NBR     PIC X(01)     VALUE SPACE.   03910001
039200         10  TB2-FISCAL-FST-DATE     PIC X(10)     VALUE SPACE.   03920001
039300         10  TB2-FISCAL-LST-DATE     PIC X(10)     VALUE SPACE.   03930001
039400         10  TB2-DLR-ISSUED          PIC S9(10)V99 COMP-3         03940001
039500                                                   VALUE ZERO.    03950001
039600         10  TB2-WK-DATA             OCCURS 13 TIMES              03960001
039700                                     INDEXED BY TB2-M-IDX.        03970001
039800*TDH02       15  TB2-DLR-WK-QTY      PIC S9(07)V99 COMP-3         03980001
039900             15  TB2-DLR-WK-QTY      PIC S9(08)V99 COMP-3         03990001
040000                                                   VALUE ZERO.    04000001
040100******************************************************************04010001
040200* TABLE TO HOLD KMRC DATA.                                        04020001
040300******************************************************************04030001
040400 01  TB3-PART-3-TABLE.                                            04040001
040500     05  TB3-PART-3-ENTRY            OCCURS 9999 TIMES.           04050003
040600         10  TB3-FISCAL-CCYY     PIC 9(04).                       04060001
040700         10  TB3-FISCAL-PER-ABBR     PIC X(03)     VALUE SPACE.   04070001
040800         10  TB3-FISCAL-WEEK-NBR     PIC X(01)     VALUE SPACE.   04080001
040900         10  TB3-FISCAL-FST-DATE     PIC X(10)     VALUE SPACE.   04090001
041000         10  TB3-FISCAL-LST-DATE     PIC X(10)     VALUE SPACE.   04100001
041100         10  TB3-DLR-ISSUED          PIC S9(10)V99 COMP-3         04110001
041200                                                   VALUE ZERO.    04120001
041300         10  TB3-WK-DATA             OCCURS 13 TIMES              04130001
041400                                     INDEXED BY TB3-M-IDX.        04140001
041500*TDH02       15  TB3-DLR-WK-QTY      PIC S9(07)V99 COMP-3         04150001
041600             15  TB3-DLR-WK-QTY      PIC S9(08)V99 COMP-3         04160001
041700                                                   VALUE ZERO.    04170001
041800 01  TB2-TABLE-CONTROLS.                                          04180001
041900     05  TB2-NBR-ENTRIES             PIC S9(4)     VALUE ZERO     04190001
042000                                                   COMP.          04200001
042100******************************************************************04210001
042200* TABLE TO HOLD RANGE OF FISCAL DATES TO BE SHOWN ON REPORTS.     04220001
042300******************************************************************04230001
042400 01  TB3-FISCAL-DATE-TABLE.                                       04240001
042500     05  TB3-FISCAL-DATE-ENTRY       OCCURS 13 TIMES              04250001
042600                                     INDEXED BY TB3-IDX.          04260001
042700         10  TB3-FIRST-DATE          PIC X(10)     VALUE SPACE.   04270001
042800         10  TB3-LAST-DATE           PIC X(10)     VALUE SPACE.   04280001
042900                                                                  04290001
043000******************************************************************04300001
043100* STANDARD DB2 ERROR HANDLING AREA                                04310001
043200******************************************************************04320001
043300     COPY DPWS004.                                                04330001
043400                                                                  04340001
043500******************************************************************04350001
043600*    STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA             *04360001
043700******************************************************************04370001
043800     EXEC SQL                                                     04380001
043900          INCLUDE SQLCA                                           04390001
044000     END-EXEC.                                                    04400001
044100                                                                  04410001
044200******************************************************************04420001
044300*    DB2 TABLE DB2PDBA.TDTATTR                                   *04430001
044400*              - MAIN DATE TABLE (TDTATTR)                       *04440001
044500******************************************************************04450001
044600     EXEC SQL                                                     04460001
044700          INCLUDE TDTATTR                                         04470001
044800     END-EXEC.                                                    04480001
044900******************************************************************04490001
045000*    CURSOR TO EXTRACT ALL FISCAL WEEKS FOR THE DEFINES DATES    *04500001
045100******************************************************************04510001
045200     EXEC SQL                                                     04520001
045300        DECLARE FISCAL-DATE-CSR CURSOR FOR                        04530001
045400            SELECT DISTINCT FSCL_WK_BEG_DTE,                      04540001
045500                            FSCL_WK_END_DTE,                      04550001
045600                            FSCL_MN_NM,                           04560001
045700                            WK_IN_MN_NBR                          04570001
045800              FROM TDTATTR                                        04580001
045900             WHERE KY_DTE >= :PV-BEG-DATE                         04590001
046000               AND KY_DTE <= :PV-END-DATE                         04600001
046100              WITH UR                                             04610001
046200     END-EXEC.                                                    04620001
046300                                                                  04630001
046400***************************************************************** 04640001
046500* PROCEDURE DIVISION.                                           * 04650001
046600***************************************************************** 04660001
046700 PROCEDURE DIVISION.                                              04670001
046800                                                                  04680001
046900 0000-MAINLINE-PROCESSING.                                        04690001
047000                                                                  04700001
047100     PERFORM 1000-INITIALIZE-PROGRAM.                             04710001
047200     PERFORM 2000-PRODUCE-WEEKLY-REPORT.                          04720001
047300                                                                  04730001
047400     CLOSE ACTIVITY-FILE                                          04740001
047500           DOLLAR-REPORT-FILE.                                    04750001
047600                                                                  04760001
047700     STOP RUN.                                                    04770001
047800                                                                  04780001
047900******************************************************************04790001
048000* 1000-INITIALIZE-PROGRAM                                         04800001
048100* OPEN FILES, GET CONTROL CARD, FORMAT GLOBAL REPORT HEADINGS.    04810001
048200******************************************************************04820001
048300 1000-INITIALIZE-PROGRAM.                                         04830001
048400                                                                  04840001
048500     OPEN INPUT  DATE-BEG-FILE                                    04850001
048600                 DATE-END-FILE                                    04860001
048700                 ACTIVITY-FILE                                    04870001
048800          OUTPUT DOLLAR-REPORT-FILE.                              04880001
048900                                                                  04890001
049000     PERFORM 1100-PROCESS-CONTROL-CARD.                           04900001
049100     PERFORM 1200-GET-FISCAL-PERIOD-RANGE.                        04910001
049200     PERFORM 1300-FORMAT-FISCAL-HEADINGS.                         04920001
049300     PERFORM 1400-FORMAT-DATE-TIME-HEADING.                       04930001
049400                                                                  04940001
049500******************************************************************04950001
049600* 1100-PROCESS-CONTROL-CARD                                       04960001
049700* READ DATE CONTROL CARDS FOR FISCAL START AND END DATES.         04970001
049800******************************************************************04980001
049900 1100-PROCESS-CONTROL-CARD.                                       04990001
050000                                                                  05000001
050100     PERFORM 1110-READ-DATE-BEG-FILE.                             05010001
050200     CLOSE DATE-BEG-FILE.                                         05020001
050300     IF PS-END-OF-CARD-FILE                                       05030001
050400         MOVE '1110-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   05040001
050500         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  05050001
050600         SET AC-CONTROL-CARD-ERROR TO TRUE                        05060001
050700         PERFORM 9999-ABEND                                       05070001
050800     END-IF.                                                      05080001
050900                                                                  05090001
051000     MOVE CC-MONTH-END-CCYY-MM-DD TO PV-BEG-DATE.                 05100001
051100                                                                  05110001
051200     PERFORM 1120-READ-DATE-END-FILE.                             05120001
051300     CLOSE DATE-END-FILE.                                         05130001
051400     IF PS-END-OF-CARD-FILE                                       05140001
051500         MOVE '1120-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   05150001
051600         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  05160001
051700         SET AC-CONTROL-CARD-ERROR TO TRUE                        05170001
051800         PERFORM 9999-ABEND                                       05180001
051900     END-IF.                                                      05190001
052000                                                                  05200001
052100     MOVE CC-MONTH-END-CCYY-MM-DD TO PV-WORK-CCYY-MM-DD           05210001
052200                                     PV-END-DATE.                 05220001
052300                                                                  05230001
052400     DISPLAY 'SVKRP036 CONTROL CARD DATE = ' PV-WORK-CCYY-MM-DD.  05240001
052500     PERFORM 1500-GET-FISCAL-445-DATES.                           05250001
052600                                                                  05260001
052700     MOVE DPG56-FISCAL-YEAR-CCYY       TO H2-YEAR.                05270001
052800     MOVE DPG56-FISCAL-PERIOD-NAME     TO H2-MONTH.               05280001
052900     MOVE PV-END-DD                    TO H2-DAY.                 05290001
053000                                                                  05300001
053100******************************************************************05310001
053200* 1110-READ-DATE-BEG-FILE                                         05320001
053300* READ DATE CONTROL CARD.                                         05330001
053400******************************************************************05340001
053500 1110-READ-DATE-BEG-FILE.                                         05350001
053600     READ DATE-BEG-FILE INTO CC-CONTROL-CARD                      05360001
053700        AT END                                                    05370001
053800           SET PS-END-OF-CARD-FILE TO TRUE.                       05380001
053900                                                                  05390001
054000******************************************************************05400001
054100* 1120-READ-DATE-END-FILE                                         05410001
054200* READ DATE CONTROL CARD.                                         05420001
054300******************************************************************05430001
054400 1120-READ-DATE-END-FILE.                                         05440001
054500                                                                  05450001
054600     INITIALIZE CC-CONTROL-CARD.                                  05460001
054700     READ DATE-END-FILE INTO CC-CONTROL-CARD                      05470001
054800        AT END                                                    05480001
054900           SET PS-END-OF-CARD-FILE TO TRUE.                       05490001
055000                                                                  05500001
055100******************************************************************05510001
055200* 1200-GET-FISCAL-PERIOD-RANGE                                    05520001
055300* LOAD THE RANGE OF DATE KEYS INTO DATA TABLES.                   05530001
055400* THE RANGE BEGINS WITH THE FISCAL DATE DERIVED FROM THE          05540001
055500* INPUT CONTROL CARD (INP02) AND ENDS WITH THE FISCAL DATE DERIVED05550001
055600* FROM THE INPUT CONTROL CARD DATE (INP03).                       05560001
055700******************************************************************05570001
055800 1200-GET-FISCAL-PERIOD-RANGE.                                    05580001
055900                                                                  05590001
056000     PERFORM 1610-OPEN-FISCAL-DATE-CSR.                           05600001
056100     PERFORM 1650-FETCH-FISCAL-DATE-CSR.                          05610001
056200                                                                  05620001
056300     PERFORM 1210-LOAD-TABLE-2-ENTRY                              05630001
056400     VARYING PV-TB2-IDX FROM +1 BY +1                             05640001
056500       UNTIL PS-END-OF-FISCAL-DATE-CSR.                           05650001
056600                                                                  05660001
056700     PERFORM 1675-CLOSE-FISCAL-DATE-CSR.                          05670001
056800                                                                  05680001
056900******************************************************************05690001
057000* 1210-LOAD-TABLE-2-ENTRY                                         05700001
057100* TB2-NBR-ENTRIES HAS AN INITIAL VALUE OF +1.                     05710001
057200******************************************************************05720001
057300 1210-LOAD-TABLE-2-ENTRY.                                         05730001
057400                                                                  05740001
057500     ADD +1 TO TB2-NBR-ENTRIES.                                   05750001
057600                                                                  05760001
057700     IF TB2-NBR-ENTRIES > PC-TABLE-LIMIT                          05770001
               DISPLAY 'PV-TB2-IDX - ' PV-TB2-IDX                       05771004
057800         MOVE '1210-LOAD-TABLE-2-ENTRY ' TO PV-PARAGRAPH-NAME     05780001
057900         MOVE 'TABLE 2 EXCEEDED MAX NUMBER OF ENTRIES '           05790001
058000                                         TO PV-OPERATION-MSG-1    05800001
058100         SET AC-TABLE-OVERFLOW-ERROR     TO TRUE                  05810001
058200         PERFORM 9999-ABEND                                       05820001
058300     END-IF.                                                      05830001
058400                                                                  05840001
058500     MOVE DTATTR-FSCL-WK-END-DTE TO PV-WORK-CCYY-MM-DD.           05850001
058600     PERFORM 1500-GET-FISCAL-445-DATES.                           05860001
058700                                                                  05870001
058800     MOVE DPG56-FISCAL-YEAR-CCYY TO TB2-FISCAL-CCYY(PV-TB2-IDX)   05880001
058900                                    TB1-FISCAL-CCYY(PV-TB2-IDX)   05890001
059000                                    TB3-FISCAL-CCYY(PV-TB2-IDX).  05900001
059100     MOVE DTATTR-WK-IN-MN-NBR  TO TB2-FISCAL-WEEK-NBR(PV-TB2-IDX) 05910001
059200                                  TB1-FISCAL-WEEK-NBR(PV-TB2-IDX) 05920001
059300                                  TB3-FISCAL-WEEK-NBR(PV-TB2-IDX).05930001
059400     MOVE DTATTR-FSCL-MN-NM(1:3) TO                               05940001
059500                                 TB2-FISCAL-PER-ABBR(PV-TB2-IDX)  05950001
059600                                 TB1-FISCAL-PER-ABBR(PV-TB2-IDX)  05960001
059700                                 TB3-FISCAL-PER-ABBR(PV-TB2-IDX). 05970001
059800     MOVE DTATTR-FSCL-WK-BEG-DTE TO                               05980001
059900                                 TB2-FISCAL-FST-DATE(PV-TB2-IDX)  05990001
060000                                 TB1-FISCAL-FST-DATE(PV-TB2-IDX)  06000001
060100                                 TB3-FISCAL-FST-DATE(PV-TB2-IDX). 06010001
060200     MOVE DTATTR-FSCL-WK-END-DTE TO                               06020001
060300                                 TB2-FISCAL-LST-DATE(PV-TB2-IDX)  06030001
060400                                 TB1-FISCAL-LST-DATE(PV-TB2-IDX)  06040001
060500                                 TB3-FISCAL-LST-DATE(PV-TB2-IDX). 06050001
060600                                                                  06060001
060700                                                                  06070001
060800     PERFORM 1650-FETCH-FISCAL-DATE-CSR.                          06080001
060900                                                                  06090001
061000******************************************************************06100001
061100* 1300-FORMAT-FISCAL-HEADINGS                                     06110001
061200*    FORMAT H5-HEADING-LINE-5 WEEK AND YEAR DATA BY UNLOADING     06120001
061300*    FISCAL PERIOD ABBR AND FISCAL YEAR FROM THE LAST 13 TABLE 2  06130001
061400*    ENTRIES.                                                     06140001
061500******************************************************************06150001
061600 1300-FORMAT-FISCAL-HEADINGS.                                     06160001
061700                                                                  06170001
061800     MOVE TB2-NBR-ENTRIES TO PV-TB2-IDX.                          06180001
061900     PERFORM                                                      06190001
062000     VARYING HL-IDX FROM +13 BY -1                                06200001
062100       UNTIL HL-IDX < +1                                          06210001
062200         SET TB3-IDX    TO HL-IDX                                 06220001
062300         MOVE TB2-FISCAL-PER-ABBR(PV-TB2-IDX) TO                  06230001
062400                                              HL-MO-ABBR(HL-IDX)  06240001
062500         MOVE TB2-FISCAL-WEEK-NBR(PV-TB2-IDX) TO HL-WK-NBR(HL-IDX)06250001
062600         MOVE TB2-FISCAL-CCYY(PV-TB2-IDX)     TO HL-CCYY(HL-IDX)  06260001
062700         MOVE TB2-FISCAL-FST-DATE(PV-TB2-IDX) TO                  06270001
062800                                           TB3-FIRST-DATE(TB3-IDX)06280001
062900         MOVE TB2-FISCAL-LST-DATE(PV-TB2-IDX) TO                  06290001
063000                                           TB3-LAST-DATE(TB3-IDX) 06300001
063100         COMPUTE PV-TB2-IDX = PV-TB2-IDX - 1                      06310001
063200     END-PERFORM.                                                 06320001
063300     MOVE HL-HEADING-LINE-TABLE               TO H5-MO-DATA.      06330001
063400                                                                  06340001
063500******************************************************************06350001
063600* 1400-FORMAT-DATE-TIME-HEADING                                   06360001
063700*    GET CURRENT DATE AND TIME FROM SYSTEM.                       06370001
063800*    FORMAT DATE AND TIME FIELDS IN THE TOP PAGE HEADING LINE     06380001
063900*    (USED BY BOTH REPORTS).                                      06390001
064000******************************************************************06400001
064100 1400-FORMAT-DATE-TIME-HEADING.                                   06410001
064200                                                                  06420001
064300     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   06430001
064400     ACCEPT PV-CURR-TIME FROM TIME.                               06440001
064500                                                                  06450001
064600     MOVE PV-CURR-DATE-MM             TO DP200-RUN-MONTH.         06460001
064700     MOVE PV-CURR-DATE-DD             TO DP200-RUN-DAY.           06470001
064800     MOVE PV-CURR-DATE-CCYY           TO DP200-RUN-YEAR.          06480001
064900                                                                  06490001
065000     MOVE PV-CURR-TIME-HH             TO DP200-RUN-HOUR.          06500001
065100     MOVE PV-CURR-TIME-MM             TO DP200-RUN-MINUTE.        06510001
065200     MOVE PC-CURRENT-PROGRAM-NAME     TO DP200-PROGRAM-NAME.      06520001
065300                                                                  06530001
065400******************************************************************06540001
065500* 1500-GET-FISCAL-445-DATES                                       06550001
065600* CALL KOHLS CALENDAR ROUTINE TO TAKE A DATE IN DB2 ISO FORMAT    06560001
065700* (CCYY-MM-DD) AND RETURN 4-4-5 (JAN - DEC) FISCAL DATE FIELDS.   06570001
065800******************************************************************06580001
065900 1500-GET-FISCAL-445-DATES.                                       06590001
066000                                                                  06600001
066100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06610001
066200                                                                  06620001
066300     SET DPG51-FISCAL-JAN-DEC-F2       TO TRUE.                   06630001
066400     SET DPG51-DO-NOT-INCR-DECR-DATE   TO TRUE.                   06640001
066500     MOVE PV-WORK-CCYY-MM-DD           TO DPG52-LK-DATE-INPUT.    06650001
066600     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   06660001
066700                                                                  06670001
066800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06680001
066900                                             DPG54 DPG55 DPG56.   06690001
067000     EVALUATE TRUE                                                06700001
067100         WHEN DPG54-SEVERE-ERROR                                  06710001
067200         WHEN DPG54-DATE-INVALID                                  06720001
067300             MOVE '1500-GET-FISCAL-445-DATES'                     06730001
067400                                           TO PV-PARAGRAPH-NAME   06740001
067500             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  06750001
067600             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                06760001
067700             PERFORM 9999-ABEND                                   06770001
067800     END-EVALUATE.                                                06780001
067900                                                                  06790001
068000******************************************************************06800001
068100*    OPEN THE TDTATTR CURSOR                                     *06810001
068200******************************************************************06820001
068300 1610-OPEN-FISCAL-DATE-CSR.                                       06830001
068400     EXEC SQL                                                     06840001
068500         OPEN FISCAL-DATE-CSR                                     06850001
068600     END-EXEC.                                                    06860001
068700                                                                  06870001
068800     EVALUATE TRUE                                                06880001
068900        WHEN SQLCODE = ZERO                                       06890001
069000             CONTINUE                                             06900001
069100        WHEN OTHER                                                06910001
069200             MOVE '1610-OPEN-FISCAL-DATE-CSR'                     06920001
069300                               TO PV-PARAGRAPH-NAME               06930001
069400             MOVE 'OPEN FISCAL DATE CURSOR - '                    06940001
069500                               TO PV-DB2-OPERATION-ATTEMPTED      06950001
069600             PERFORM 9999-SQL-ABEND                               06960001
069700     END-EVALUATE.                                                06970001
069800                                                                  06980001
069900******************************************************************06990001
070000*      1650-FETCH-FISCAL-DATE-CSR                                *07000001
070100* ==>  PROCESSES:                                                *07010001
070200*      - FETCH FROM THE TDTATTR TABLE.                           *07020001
070300******************************************************************07030001
070400 1650-FETCH-FISCAL-DATE-CSR.                                      07040001
070500                                                                  07050001
070600     EXEC SQL                                                     07060001
070700         FETCH FISCAL-DATE-CSR                                    07070001
070800          INTO :DTATTR-FSCL-WK-BEG-DTE,                           07080001
070900               :DTATTR-FSCL-WK-END-DTE,                           07090001
071000               :DTATTR-FSCL-MN-NM,                                07100001
071100               :DTATTR-WK-IN-MN-NBR                               07110001
071200     END-EXEC.                                                    07120001
071300                                                                  07130001
071400     EVALUATE SQLCODE                                             07140001
071500         WHEN ZERO                                                07150001
071600             CONTINUE                                             07160001
071700         WHEN +100                                                07170001
071800             SET PS-END-OF-FISCAL-DATE-CSR TO TRUE                07180001
071900         WHEN OTHER                                               07190001
072000             MOVE '1650-FETCH-FISCAL-DATE-CSR'                    07200001
072100                                    TO PV-PARAGRAPH-NAME          07210001
072200             MOVE 'FETCH FISAL DATE CURSOR - '                    07220001
072300                                    TO PV-DB2-OPERATION-ATTEMPTED 07230001
072400             PERFORM 9999-SQL-ABEND                               07240001
072500     END-EVALUATE.                                                07250001
072600                                                                  07260001
072700******************************************************************07270001
072800*      1675-CLOSE-FISCAL-DATE-CSR                                *07280001
072900* ==>  PROCESSES:                                                *07290001
073000*      - CLOSE THE TDTATTR CURSOR                                *07300001
073100******************************************************************07310001
073200 1675-CLOSE-FISCAL-DATE-CSR.                                      07320001
073300                                                                  07330001
073400     EXEC SQL                                                     07340001
073500         CLOSE FISCAL-DATE-CSR                                    07350001
073600     END-EXEC.                                                    07360001
073700                                                                  07370001
073800     EVALUATE TRUE                                                07380001
073900         WHEN SQLCODE = ZERO                                      07390001
074000             CONTINUE                                             07400001
074100         WHEN OTHER                                               07410001
074200             MOVE '1675-CLOSE-FISCAL-DATE-CSR'                    07420001
074300                                TO PV-PARAGRAPH-NAME              07430001
074400             MOVE 'CLOSE FISCAL DATE CURSOR - '                   07440001
074500                                TO PV-DB2-OPERATION-ATTEMPTED     07450001
074600             PERFORM 9999-SQL-ABEND                               07460001
074700     END-EVALUATE.                                                07470001
074800                                                                  07480001
074900******************************************************************07490001
075000* 2000-PRODUCE-WEEKLY-REPORT                                      07500001
075100******************************************************************07510001
075200 2000-PRODUCE-WEEKLY-REPORT.                                      07520001
075300                                                                  07530001
075400     PERFORM 2100-PREPARE-FOR-WKLY-REPORT.                        07540001
075500     PERFORM 2200-PROCESS-ACTIVITY-RECS                           07550001
075600       UNTIL PS-END-OF-ACTVY-FILE.                                07560001
075700                                                                  07570001
075800     PERFORM 2700-PRINT-ALL-REPORTS.                              07580001
075900     PERFORM 4700-PRINT-RPT-TOTAL-LINE.                           07590001
076000                                                                  07600001
076100******************************************************************07610001
076200* 2100-PREPARE-FOR-WKLY-REPORT.                                   07620001
076300*   DO PRIME READ OF ACTIVITY FILE, SET UP CONTROL BREAK FIELDS.  07630001
076400*   FIND THE TABLE 2 ENTRY WITH THE FISCAL PERIOD THE FIRST INPUT 07640001
076500*   RECORD WAS ISSUED.  SET THE 1ST ENTRY IN TABLE 1 TO POINT TO  07650001
076600*   FISCAL PERIOD FOUND IN TABLE 2.                               07660001
076700******************************************************************07670001
076800 2100-PREPARE-FOR-WKLY-REPORT.                                    07680001
076900                                                                  07690001
077000     PERFORM 7000-READ-ACTIVITY-FILE.                             07700001
077100     IF PS-END-OF-ACTVY-FILE                                      07710001
077200         MOVE '2100-PREPARE-FOR-WKLY-REPORT' TO PV-PARAGRAPH-NAME 07720001
077300         MOVE 'NO INPUT DATA TO PROCESS'   TO PV-OPERATION-MSG-1  07730001
077400         SET AC-DATASET-DATA-ERROR TO TRUE                        07740001
077500         PERFORM 9999-ABEND                                       07750001
077600     END-IF.                                                      07760001
077700                                                                  07770001
077800     MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-SAVE-ISSUE-DATE.      07780001
077900                                                                  07790001
078000     MOVE +1                          TO PV-TB2-IDX.              07800001
078100     IF PV-SAVE-ISSUE-DATE >= PV-BEG-DATE AND                     07810001
078200        PV-SAVE-ISSUE-DATE <= PV-END-DATE                         07820001
078300         PERFORM 6000-FIND-FISCAL-PERIOD                          07830001
078400     END-IF.                                                      07840001
078500                                                                  07850001
078600******************************************************************07860001
078700* 2200-PROCESS-ACTIVITY-RECS.                                     07870001
078800*  PROCESS THE STORED VALUE CARD ACTIVITY FILE.                   07880001
078900*  INPUT FILE IS SORTED IN FOLLOWING ORDER:                       07890001
079000*     CARD STOCK TYPE ID, CARD NUMBER, ISSUE DATE                 07900001
079100******************************************************************07910001
079200 2200-PROCESS-ACTIVITY-RECS.                                      07920001
079300                                                                  07930001
079400     IF PV-SAVE-ISSUE-DATE >= PV-BEG-DATE AND                     07940001
079500        PV-SAVE-ISSUE-DATE <= PV-END-DATE                         07950001
079600         MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-WORK-CCYY-MM-DD   07960001
079700         IF PV-WORK-CCYY-MM-DD >= PV-SAVE-FST-DATE AND            07970001
079800            PV-WORK-CCYY-MM-DD <= PV-SAVE-LST-DATE                07980001
079900             CONTINUE                                             07990001
080000         ELSE                                                     08000001
080100             PERFORM 2400-PROCESS-BREAK-ON-DATE                   08010001
080200         END-IF                                                   08020001
080300         PERFORM 2600-ACCUM-TOTALS                                08030001
080400     END-IF.                                                      08040001
080500                                                                  08050001
080600     PERFORM 7000-READ-ACTIVITY-FILE.                             08060001
080700                                                                  08070001
080800******************************************************************08080001
080900* 2400-PROCESS-BREAK-ON-DATE                                      08090001
081000*  PROCESS CONTROL BREAK ON ISSUE DATE:                           08100001
081100******************************************************************08110001
081200 2400-PROCESS-BREAK-ON-DATE.                                      08120001
081300                                                                  08130001
081400     MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-SAVE-ISSUE-DATE.      08140001
081500                                                                  08150001
081600     MOVE +1                          TO PV-TB2-IDX.              08160001
081700     PERFORM 6000-FIND-FISCAL-PERIOD.                             08170001
081800                                                                  08180001
081900******************************************************************08190001
082000* 2600-ACCUM-TOTALS.                                              08200001
082100*  ADD AMOUNTS FROM CURRENT INPUT REC TO RUNNING DOLLAR TOTALS    08210001
082200******************************************************************08220001
082300 2600-ACCUM-TOTALS.                                               08230001
082400                                                                  08240001
082500     EVALUATE TRUE                                                08250001
082600         WHEN SV036-ACTVY-TYP-CDE = SV004-TENDER-ACT-TYP-N        08260001
082700             PERFORM 2610-ACCUM-TENDER-TOTALS                     08270001
082800         WHEN SV036-ACTVY-TYP-CDE = SV004-SRV-FEE-ACT-TYP-N       08280001
082900             CONTINUE                                             08290001
083000         WHEN OTHER                                               08300001
083100             PERFORM 2650-ACCUM-ISSUE-TOTALS                      08310001
083200     END-EVALUATE.                                                08320001
083300                                                                  08330001
083400******************************************************************08340001
083500* 2610-ACCUM-TENDER-TOTALS                                        08350001
083600*  ADD AMOUNTS FROM CURRENT INPUT REC TO RUNNING DOLLAR TOTALS    08360001
083700******************************************************************08370001
083800 2610-ACCUM-TENDER-TOTALS.                                        08380001
083900                                                                  08390001
084000     MOVE SV036-TENDER-TIMESTAMP(1:10) TO PV-SAVE-LST-ACTVY-DTE.  08400001
084100                                                                  08410001
084200     PERFORM                                                      08420001
084300     VARYING TB1-M-IDX FROM +1 BY +1                              08430001
084400       UNTIL TB1-M-IDX > +13                                      08440001
084500         SET TB2-M-IDX TO TB1-M-IDX                               08450001
084600         SET TB3-M-IDX TO TB1-M-IDX                               08460001
084700         SET TB3-IDX   TO TB1-M-IDX                               08470001
084800         IF  PV-SAVE-LST-ACTVY-DTE >= TB3-FIRST-DATE(TB3-IDX)     08480001
084900         AND PV-SAVE-LST-ACTVY-DTE <= TB3-LAST-DATE(TB3-IDX)      08490001
085000             PERFORM 2615-ACCUM-WEEKLY-TOTALS                     08500001
085100         END-IF                                                   08510001
085200     END-PERFORM.                                                 08520001
085300                                                                  08530001
085400******************************************************************08540001
085500* 2615-ACCUM-WEEKLY-TOTALS                                        08550001
085600*  ADD AMOUNTS FROM CURRENT INPUT REC TO TABLED WEEKLY TOTALS     08560001
085700******************************************************************08570001
085800 2615-ACCUM-WEEKLY-TOTALS.                                        08580001
085900                                                                  08590001
086000     IF SV036-ACTVY-TYP-CDE = SV004-SRV-FEE-ACT-TYP-N             08600001
086100         CONTINUE                                                 08610001
086200     ELSE                                                         08620001
086300         IF SV036-CRD-TYP-CDE = 2                                 08630001
086400             IF SV036-CRD-STK-TYP-ID = 'KCK'                      08640001
086500                 ADD SV036-APP-AUTH-AMT TO                        08650001
086600                            TB2-DLR-WK-QTY(PV-TB2-IDX, TB2-M-IDX) 08660001
086700             ELSE                                                 08670001
086800                 ADD SV036-APP-AUTH-AMT TO                        08680001
086900                            TB1-DLR-WK-QTY(PV-TB2-IDX, TB1-M-IDX) 08690001
087000             END-IF                                               08700001
087100         ELSE                                                     08710001
087200             ADD SV036-APP-AUTH-AMT TO                            08720001
087300                            TB3-DLR-WK-QTY(PV-TB2-IDX, TB3-M-IDX) 08730001
087400         END-IF                                                   08740001
087500     END-IF.                                                      08750001
087600                                                                  08760001
087700***************************************************************** 08770001
087800* 2650-ACCUM-ISSUE-TOTALS                                       * 08780001
087900* ACCUMULATE ISSUE TOTALS                                       * 08790001
088000***************************************************************** 08800001
088100 2650-ACCUM-ISSUE-TOTALS.                                         08810001
088200                                                                  08820001
088300     IF SV036-CRD-TYP-CDE = 2                                     08830001
088400         IF SV036-CRD-STK-TYP-ID = 'KCK'                          08840001
088500             ADD SV036-APP-AUTH-AMT TO TB2-DLR-ISSUED(PV-TB2-IDX) 08850001
088600         ELSE                                                     08860001
088700             ADD SV036-APP-AUTH-AMT TO TB1-DLR-ISSUED(PV-TB2-IDX) 08870001
088800         END-IF                                                   08880001
088900     ELSE                                                         08890001
089000         ADD SV036-APP-AUTH-AMT TO TB3-DLR-ISSUED(PV-TB2-IDX)     08900001
089100     END-IF.                                                      08910001
089200                                                                  08920001
089300***************************************************************** 08930001
089400* 2700-PRINT-ALL-REPORTS                                          08940001
089500****************************************************************  08950001
089600 2700-PRINT-ALL-REPORTS.                                          08960001
089700                                                                  08970001
089800     MOVE SPACES             TO H3-CRD-STK-DESC.                  08980001
089900     MOVE PC-GIFT-CARDS-DESC TO H3-CRD-STK-DESC.                  08990001
090000     PERFORM 4000-FORMAT-RPT-HEADINGS.                            09000001
090100     PERFORM 8000-PRINT-RPT-HEADINGS.                             09010001
090200                                                                  09020001
090300     PERFORM 3000-PRINT-REPORT-DETAIL-1                           09030001
090400         VARYING PV-TB2-IDX FROM +1 BY +1                         09040001
090500         UNTIL PV-TB2-IDX > TB2-NBR-ENTRIES.                      09050001
090600                                                                  09060001
090700     PERFORM 5000-PRINT-CARD-STOCK-TOTALS.                        09070001
090800                                                                  09080001
090900     MOVE SPACES             TO H3-CRD-STK-DESC.                  09090001
091000     MOVE PC-KCK-CARD-DESC   TO H3-CRD-STK-DESC.                  09100001
091100     PERFORM 4000-FORMAT-RPT-HEADINGS.                            09110001
091200     PERFORM 8000-PRINT-RPT-HEADINGS.                             09120001
091300                                                                  09130001
091400     PERFORM 3100-PRINT-REPORT-DETAIL-2                           09140001
091500         VARYING PV-TB2-IDX FROM +1 BY +1                         09150001
091600         UNTIL PV-TB2-IDX > TB2-NBR-ENTRIES.                      09160001
091700                                                                  09170001
091800     PERFORM 5000-PRINT-CARD-STOCK-TOTALS.                        09180001
091900                                                                  09190001
092000     MOVE SPACES             TO H3-CRD-STK-DESC.                  09200001
092100     MOVE PC-KMRC-CARD-DESC  TO H3-CRD-STK-DESC.                  09210001
092200     PERFORM 4000-FORMAT-RPT-HEADINGS.                            09220001
092300     PERFORM 8000-PRINT-RPT-HEADINGS.                             09230001
092400                                                                  09240001
092500     PERFORM 3200-PRINT-REPORT-DETAIL-3                           09250001
092600         VARYING PV-TB2-IDX FROM +1 BY +1                         09260001
092700         UNTIL PV-TB2-IDX > TB2-NBR-ENTRIES.                      09270001
092800                                                                  09280001
092900     PERFORM 5000-PRINT-CARD-STOCK-TOTALS.                        09290001
093000                                                                  09300001
093100******************************************************************09310001
093200* 3000-PRINT-REPORT-DETAIL-1                                      09320001
093300*  PRINT A DETAIL LINE FOR PART 1 OF THE REPORT                   09330001
093400******************************************************************09340001
093500 3000-PRINT-REPORT-DETAIL-1.                                      09350001
093600                                                                  09360001
093700     IF (PV-SVKRP036-1-LINE-CNT + 2) > PC-LINE-LIMIT              09370001
093800         PERFORM 8000-PRINT-RPT-HEADINGS                          09380001
093900     END-IF.                                                      09390001
094000                                                                  09400001
094100     MOVE BL-BLANK-LINE     TO PV-PRINT-RECORD.                   09410001
094200     MOVE +1                TO PV-LINE-SPACING.                   09420001
094300     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          09430001
094400                                                                  09440001
094500     MOVE TB1-FISCAL-PER-ABBR(PV-TB2-IDX) TO DL1-MO-1.            09450001
094600     MOVE TB1-FISCAL-WEEK-NBR(PV-TB2-IDX) TO DL1-WK-1.            09460001
094700     MOVE TB1-FISCAL-CCYY(PV-TB2-IDX)     TO DL1-YR-1.            09470001
094800                                                                  09480001
094900     PERFORM                                                      09490001
095000       VARYING TB1-M-IDX FROM +1 BY +1                            09500001
095100       UNTIL TB1-M-IDX > +13                                      09510001
095200         SET PL-IDX       TO TB1-M-IDX                            09520001
095300         SET PV-TOT-IDX   TO TB1-M-IDX                            09530001
095400         ADD  TB1-DLR-WK-QTY (PV-TB2-IDX, TB1-M-IDX)              09540001
095500                                 TO PV-TOT-DLR-WK-QTY(PV-TOT-IDX) 09550001
095600         MOVE TB1-DLR-WK-QTY (PV-TB2-IDX, TB1-M-IDX)              09560001
095700                                       TO  PL-WK-QTY(PL-IDX)      09570001
095800     END-PERFORM.                                                 09580001
095900     MOVE PL-PRINT-LINE-TABLE          TO  DL1-WK-DATA-1          09590001
096000                                                                  09600001
096100     ADD  TB1-DLR-ISSUED(PV-TB2-IDX)   TO  PV-TOT-DLR-ISSUED.     09610001
096200     MOVE TB1-DLR-ISSUED(PV-TB2-IDX)   TO  DL1-ISSUED-QTY-1.      09620001
096300                                                                  09630001
096400     MOVE DL1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                  09640001
096500     MOVE +1                TO  PV-LINE-SPACING.                  09650001
096600     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          09660001
096700                                                                  09670001
096800******************************************************************09680001
096900* 3100-PRINT-REPORT-DETAIL-2                                      09690001
097000*  PRINT A DETAIL LINE FOR PART 2 OF THE REPORT                   09700001
097100******************************************************************09710001
097200 3100-PRINT-REPORT-DETAIL-2.                                      09720001
097300                                                                  09730001
097400     IF (PV-SVKRP036-1-LINE-CNT + 2) > PC-LINE-LIMIT              09740001
097500         PERFORM 8000-PRINT-RPT-HEADINGS                          09750001
097600     END-IF.                                                      09760001
097700                                                                  09770001
097800     MOVE BL-BLANK-LINE     TO PV-PRINT-RECORD.                   09780001
097900     MOVE +1                TO PV-LINE-SPACING.                   09790001
098000     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          09800001
098100                                                                  09810001
098200     MOVE TB2-FISCAL-PER-ABBR(PV-TB2-IDX) TO DL1-MO-1.            09820001
098300     MOVE TB2-FISCAL-WEEK-NBR(PV-TB2-IDX) TO DL1-WK-1.            09830001
098400     MOVE TB2-FISCAL-CCYY(PV-TB2-IDX)     TO DL1-YR-1.            09840001
098500                                                                  09850001
098600     PERFORM                                                      09860001
098700       VARYING TB2-M-IDX FROM +1 BY +1                            09870001
098800       UNTIL TB2-M-IDX > +13                                      09880001
098900         SET PL-IDX       TO TB2-M-IDX                            09890001
099000         SET PV-TOT-IDX   TO TB2-M-IDX                            09900001
099100         ADD  TB2-DLR-WK-QTY (PV-TB2-IDX, TB2-M-IDX)              09910001
099200                                 TO PV-TOT-DLR-WK-QTY(PV-TOT-IDX) 09920001
099300         MOVE TB2-DLR-WK-QTY (PV-TB2-IDX, TB2-M-IDX)              09930001
099400                                       TO  PL-WK-QTY(PL-IDX)      09940001
099500     END-PERFORM.                                                 09950001
099600     MOVE PL-PRINT-LINE-TABLE          TO  DL1-WK-DATA-1          09960001
099700                                                                  09970001
099800     ADD  TB2-DLR-ISSUED(PV-TB2-IDX)   TO  PV-TOT-DLR-ISSUED.     09980001
099900     MOVE TB2-DLR-ISSUED(PV-TB2-IDX)   TO  DL1-ISSUED-QTY-1.      09990001
100000                                                                  10000001
100100     MOVE DL1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                  10010001
100200     MOVE +1                TO  PV-LINE-SPACING.                  10020001
100300     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          10030001
100400                                                                  10040001
100500******************************************************************10050001
100600* 3200-PRINT-REPORT-DETAIL-3                                      10060001
100700*  PRINT A DETAIL LINE FOR PART 3 OF THE REPORT                   10070001
100800******************************************************************10080001
100900 3200-PRINT-REPORT-DETAIL-3.                                      10090001
101000                                                                  10100001
101100     IF (PV-SVKRP036-1-LINE-CNT + 2) > PC-LINE-LIMIT              10110001
101200         PERFORM 8000-PRINT-RPT-HEADINGS                          10120001
101300     END-IF.                                                      10130001
101400                                                                  10140001
101500     MOVE BL-BLANK-LINE     TO PV-PRINT-RECORD.                   10150001
101600     MOVE +1                TO PV-LINE-SPACING.                   10160001
101700     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          10170001
101800                                                                  10180001
101900     MOVE TB3-FISCAL-PER-ABBR(PV-TB2-IDX) TO DL1-MO-1.            10190001
102000     MOVE TB3-FISCAL-WEEK-NBR(PV-TB2-IDX) TO DL1-WK-1.            10200001
102100     MOVE TB3-FISCAL-CCYY(PV-TB2-IDX)     TO DL1-YR-1.            10210001
102200                                                                  10220001
102300     PERFORM                                                      10230001
102400       VARYING TB3-M-IDX FROM +1 BY +1                            10240001
102500       UNTIL TB3-M-IDX > +13                                      10250001
102600         SET PL-IDX       TO TB3-M-IDX                            10260001
102700         SET PV-TOT-IDX   TO TB3-M-IDX                            10270001
102800         ADD  TB3-DLR-WK-QTY (PV-TB2-IDX, TB3-M-IDX)              10280001
102900                                 TO PV-TOT-DLR-WK-QTY(PV-TOT-IDX) 10290001
103000         MOVE TB3-DLR-WK-QTY (PV-TB2-IDX, TB3-M-IDX)              10300001
103100                                       TO  PL-WK-QTY(PL-IDX)      10310001
103200     END-PERFORM.                                                 10320001
103300     MOVE PL-PRINT-LINE-TABLE          TO  DL1-WK-DATA-1          10330001
103400                                                                  10340001
103500     ADD  TB3-DLR-ISSUED(PV-TB2-IDX)   TO  PV-TOT-DLR-ISSUED.     10350001
103600     MOVE TB3-DLR-ISSUED(PV-TB2-IDX)   TO  DL1-ISSUED-QTY-1.      10360001
103700                                                                  10370001
103800     MOVE DL1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                  10380001
103900     MOVE +1                TO  PV-LINE-SPACING.                  10390001
104000     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          10400001
104100                                                                  10410001
104200******************************************************************10420001
104300* 4000-FORMAT-RPT-HEADINGS                                        10430001
104400*  MOVE HEADING DESCRIPTIONS SPECIFIC TO THE DOLLARS REPORT.      10440001
104500******************************************************************10450001
104600 4000-FORMAT-RPT-HEADINGS.                                        10460001
104700                                                                  10470001
104800     MOVE PC-REPORT-NBR-1        TO  DP200-REPORT-NUMBER.         10480001
104900     MOVE PC-H2-DESC-DOLLARS     TO  H4-RPT-DESC-1.               10490001
105000     MOVE PC-H4-DESC-2-DOLLARS   TO  H4-RPT-DESC-2.               10500001
105100                                                                  10510001
105200******************************************************************10520001
105300* 4700-PRINT-RPT-TOTAL-LINE                                       10530001
105400*  THIS PARAGRAPH WILL PRINT A REPORT DOLLAR TOTAL LINE.          10540001
105500******************************************************************10550001
105600 4700-PRINT-RPT-TOTAL-LINE.                                       10560001
105700                                                                  10570001
105800     IF (PV-SVKRP036-1-LINE-CNT + 1) > PC-LINE-LIMIT              10580001
105900         PERFORM 8000-PRINT-RPT-HEADINGS                          10590001
106000     END-IF.                                                      10600001
106100                                                                  10610001
106200     MOVE 'GRAND TOT'             TO  TL1-TOT-DESC.               10620001
106300     MOVE PV-GT-TOT-DLR-ISSUED    TO  TL1-ISSUED-QTY-1.           10630001
106400                                                                  10640001
106500     PERFORM                                                      10650001
106600       VARYING PV-GT-TOT-IDX FROM +1 BY +1                        10660001
106700       UNTIL PV-GT-TOT-IDX > +13                                  10670001
106800         SET PL-IDX TO PV-GT-TOT-IDX                              10680001
106900         MOVE PV-GT-TOT-DLR-WK(PV-GT-TOT-IDX) TO PL-WK-QTY(PL-IDX)10690001
107000     END-PERFORM.                                                 10700001
107100                                                                  10710001
107200     MOVE PL-PRINT-LINE-TABLE               TO TL1-WK-DATA-1.     10720001
107300                                                                  10730001
107400     MOVE TL1-TOTAL-LINE-1        TO  PV-PRINT-RECORD.            10740001
107500     MOVE +1                      TO  PV-LINE-SPACING.            10750001
107600     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          10760001
107700                                                                  10770001
107800     MOVE DP200-CNFDL-HDR-200-COLS TO  PV-PRINT-RECORD.           10780001
107900     MOVE +2                       TO  PV-LINE-SPACING.           10790001
108000     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          10800001
108100                                                                  10810001
108200***************************************************************** 10820001
108300* 5000-PRINT-CARD-STOCK-TOTALS                                  * 10830001
108400*                                                               * 10840001
108500***************************************************************** 10850001
108600 5000-PRINT-CARD-STOCK-TOTALS.                                    10860001
108700                                                                  10870001
108800     PERFORM                                                      10880001
108900       VARYING PV-TOT-IDX FROM +1 BY +1                           10890001
109000       UNTIL PV-TOT-IDX > +13                                     10900001
109100         SET PL-IDX TO PV-TOT-IDX                                 10910001
109200         SET PV-GT-TOT-IDX TO PV-TOT-IDX                          10920001
109300         MOVE PV-TOT-DLR-WK-QTY(PV-TOT-IDX) TO PL-WK-QTY(PL-IDX)  10930001
109400         ADD PV-TOT-DLR-WK-QTY(PV-TOT-IDX)  TO                    10940001
109500                                  PV-GT-TOT-DLR-WK(PV-GT-TOT-IDX) 10950001
109600     END-PERFORM.                                                 10960001
109700     MOVE PL-PRINT-LINE-TABLE               TO TL1-WK-DATA-1.     10970001
109800                                                                  10980001
109900     MOVE 'TOTALS'                TO  TL1-TOT-DESC.               10990001
110000     ADD  PV-TOT-DLR-ISSUED       TO  PV-GT-TOT-DLR-ISSUED.       11000001
110100     MOVE PV-TOT-DLR-ISSUED       TO  TL1-ISSUED-QTY-1.           11010001
110200                                                                  11020001
110300     MOVE UL-UNDER-LINE           TO  PV-PRINT-RECORD.            11030001
110400     MOVE +1                      TO  PV-LINE-SPACING.            11040001
110500     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          11050001
110600                                                                  11060001
110700     MOVE TL1-TOTAL-LINE-1        TO  PV-PRINT-RECORD.            11070001
110800     MOVE +1                      TO  PV-LINE-SPACING.            11080001
110900     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          11090001
111000                                                                  11100001
111100     INITIALIZE TL1-TOTAL-LINE-1                                  11110001
111200                PV-TOT-ACCUM-FIELDS.                              11120001
111300                                                                  11130001
111400******************************************************************11140001
111500* 6000-FIND-FISCAL-PERIOD.                                        11150001
111600*  STARTING AT THE FIRST ENTRY IN TABLE 2, COMPARE THE INPUT ISSUE11160001
111700*  DATE WITH THE FIRST AND LAST DATES OF EACH ENTRY, UNTIL THE    11170001
111800*  TABLE ENTRY IS FOUND THAT HAS THE ISSUE DATE IN RANGE.         11180001
111900******************************************************************11190001
112000 6000-FIND-FISCAL-PERIOD.                                         11200001
112100                                                                  11210001
112200     SET PS-TABLE-2-DATE-NOT-FOUND TO TRUE.                       11220001
112300                                                                  11230001
112400     PERFORM                                                      11240001
112500       UNTIL PS-TABLE-2-DATE-FOUND                                11250001
112600         IF  PV-SAVE-ISSUE-DATE >= TB2-FISCAL-FST-DATE(PV-TB2-IDX)11260001
112700         AND PV-SAVE-ISSUE-DATE <= TB2-FISCAL-LST-DATE(PV-TB2-IDX)11270001
112800             SET PS-TABLE-2-DATE-FOUND TO TRUE                    11280001
112900             MOVE TB2-FISCAL-FST-DATE(PV-TB2-IDX)                 11290001
113000                                         TO PV-SAVE-FST-DATE      11300001
113100             MOVE TB2-FISCAL-LST-DATE(PV-TB2-IDX)                 11310001
113200                                         TO PV-SAVE-LST-DATE      11320001
113300         ELSE                                                     11330001
113400             PERFORM 6200-INCREMENT-TABLE-2                       11340001
113500         END-IF                                                   11350001
113600     END-PERFORM.                                                 11360001
113700                                                                  11370001
113800******************************************************************11380001
113900* 6200-INCREMENT-TABLE-2                                          11390001
114000*  INCREMENT PV-TB2-IDX TO POINT TO THE NEXT TABLE 2 ENTRY.       11400001
114100******************************************************************11410001
114200 6200-INCREMENT-TABLE-2.                                          11420001
114300                                                                  11430001
114400     COMPUTE PV-TB2-IDX = PV-TB2-IDX + 1.                         11440001
114500     IF PV-TB2-IDX > TB2-NBR-ENTRIES                              11450001
114600         MOVE '6200-INCREMENT-TABLE-2 '     TO PV-PARAGRAPH-NAME  11460001
114700         MOVE 'TABLE 2 INDEX EXCEEDED MAX ENTRIES  '              11470001
114800                                            TO PV-OPERATION-MSG-1 11480001
114900         SET AC-TABLE-OVERFLOW-ERROR        TO TRUE               11490001
115000         PERFORM 9999-ABEND                                       11500001
115100     END-IF.                                                      11510001
115200                                                                  11520001
115300******************************************************************11530001
115400* 7000-READ-ACTIVITY-FILE                                         11540001
115500*  READ THE CARD ACTIVITY RECORDS.                                11550001
115600******************************************************************11560001
115700 7000-READ-ACTIVITY-FILE.                                         11570001
115800                                                                  11580001
115900     READ ACTIVITY-FILE INTO SV036-RECORD                         11590001
116000         AT END                                                   11600001
116100           SET PS-END-OF-ACTVY-FILE TO TRUE.                      11610001
116200                                                                  11620001
116300     MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-SAVE-ISSUE-DATE.      11630001
116400                                                                  11640001
116500******************************************************************11650001
116600* 8000-PRINT-RPT-HEADINGS                                         11660001
116700*  PRINT THE HEADINGS FOR THE REPORT.                             11670001
116800******************************************************************11680001
116900 8000-PRINT-RPT-HEADINGS.                                         11690001
117000                                                                  11700001
117100     ADD +1                      TO PV-SVKRP036-1-PAGE-CNT.       11710001
117200     MOVE PV-SVKRP036-1-PAGE-CNT TO DP200-PAGE-NUMBER.            11720001
117300     MOVE DP200-STANDRD-HEADER-200-COLS                           11730001
117400                                 TO PV-PRINT-RECORD.              11740001
117500     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          11750001
117600                                                                  11760001
117700     MOVE H2-HEADING-LINE-2      TO PV-PRINT-RECORD.              11770001
117800     MOVE +1                     TO PV-LINE-SPACING.              11780001
117900     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          11790001
118000                                                                  11800001
118100     MOVE H3-HEADING-LINE-3      TO PV-PRINT-RECORD.              11810001
118200     MOVE +2                     TO PV-LINE-SPACING.              11820001
118300     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          11830001
118400                                                                  11840001
118500     MOVE H4-HEADING-LINE-4      TO PV-PRINT-RECORD.              11850001
118600     MOVE +2                     TO PV-LINE-SPACING.              11860001
118700     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          11870001
118800                                                                  11880001
118900     MOVE H5-HEADING-LINE-5      TO PV-PRINT-RECORD.              11890001
119000     MOVE +1                     TO PV-LINE-SPACING.              11900001
119100     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          11910001
119200                                                                  11920001
119300******************************************************************11930001
119400* 8100-WRITE-RPT-TOP-OF-PAGE                                      11940001
119500*  WRITE FIRST REPORT LINE AFTER PAGE BREAK.                      11950001
119600******************************************************************11960001
119700 8100-WRITE-RPT-TOP-OF-PAGE.                                      11970001
119800                                                                  11980001
119900     WRITE DOLLAR-REPORT-RECORD                                   11990001
120000       FROM PV-PRINT-RECORD                                       12000001
120100         AFTER ADVANCING PAGE.                                    12010001
120200     MOVE +1             TO PV-SVKRP036-1-LINE-CNT.               12020001
120300                                                                  12030001
120400******************************************************************12040001
120500* 8200-WRITE-RPT-REPORT-LINE                                      12050001
120600*  WRITE REPORT LINE AFTER ADVANCING LINE SPACING.                12060001
120700******************************************************************12070001
120800 8200-WRITE-RPT-REPORT-LINE.                                      12080001
120900                                                                  12090001
121000     WRITE DOLLAR-REPORT-RECORD                                   12100001
121100       FROM PV-PRINT-RECORD                                       12110001
121200         AFTER ADVANCING PV-LINE-SPACING.                         12120001
121300                                                                  12130001
121400     ADD PV-LINE-SPACING TO PV-SVKRP036-1-LINE-CNT.               12140001
121500                                                                  12150001
121600******************************************************************12160001
121700* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           12170001
121800******************************************************************12180001
121900 9999-ABEND.                                                      12190001
122000     DISPLAY '** ABEND           **'.                             12200001
122100     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  12210001
122200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        12220001
122300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       12230001
122400     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       12240001
122500     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12250001
122600                                                                  12260001
122700******************************************************************12270001
122800*     9999-SQL-ABEND                                             *12280001
122900* ==> PROCESSES:                                                 *12290001
123000*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *12300001
123100******************************************************************12310001
123200 9999-SQL-ABEND.                                                  12320001
123300                                                                  12330001
123400     DISPLAY '9999-SQL-ABEND'.                                    12340001
123500     DISPLAY '**  ABEND     **'.                                  12350001
123600     DISPLAY '**  PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.       12360001
123700     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             12370001
123800     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    12380001
123900******************************************************************12390001
124000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    12400001
124100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         12410001
124200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     12420001
124300* FORMAT.                                                         12430001
124400******************************************************************12440001
124500     COPY DPPD004.                                                12450001
124600                                                                  12460001
124700     MOVE +4013 TO AC-ABEND-CODE.                                 12470001
124800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         12480001
124900                                                                  12490001
