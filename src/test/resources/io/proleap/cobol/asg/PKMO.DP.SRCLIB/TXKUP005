000100* ------------------------------------------------------------- * 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300* ------------------------------------------------------------- * 00030000
000400 PROGRAM-ID.    TXKUP005.                                         00040041
000500 AUTHOR.        JILL ZIMBAL.                                      00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  04-28-2010.                                       00070000
000800                                                                  00080000
000900***************************************************************** 00090000
001000* THIS WILL INSERT A NEW SALES TAX CODE TO THE TTXRTLO TABLE.   * 00100000
001100* THIS WILL READ IN A PARAMETER WITH THE NEW SALES TAX CODE AND * 00110000
001200* INSERT IT IN FOR ALL OF THE STORES.  IT WILL INSERT THE INFO  * 00120000
001300* BASED ON AN EXISTING PARAMETER.                               * 00130000
001400***************************************************************** 00140000
001500*---------------------------------------------------------------- 00150000
001600* CHANGES:                                                        00160000
001700* 4/27/2010 JILL ZIMBAL                                           00170000
001800*     INITIAL PROGRAM.                                            00180000
003000**********************************************************        00300000
003100 ENVIRONMENT DIVISION.                                            00310000
003200**********************************************************        00320000
003300                                                                  00330000
003400 CONFIGURATION SECTION.                                           00340000
003500                                                                  00350000
003600 SOURCE-COMPUTER. IBM-3090.                                       00360000
003700 OBJECT-COMPUTER. IBM-3090.                                       00370000
003800                                                                  00380000
003900 INPUT-OUTPUT SECTION.                                            00390000
004000                                                                  00400000
004100  FILE-CONTROL.                                                   00410000
004200      SELECT PARM-CONTROL-FILE                                    00420008
004300          ASSIGN TO INP01.                                        00430000
004400                                                                  00440000
005000                                                                  00500000
005100*********************************************************         00510000
005200 DATA DIVISION.                                                   00520000
005300*********************************************************         00530000
005400 FILE SECTION.                                                    00540000
005500*----------------------------------------------------------       00550000
005600* DATE CONTROL FILE INP01                                         00560000
005700*----------------------------------------------------------       00570000
005800 FD  PARM-CONTROL-FILE                                            00580008
005900     RECORDING MODE IS F                                          00590000
006000     BLOCK CONTAINS 0 CHARACTERS                                  00600000
006100     LABEL RECORDS ARE STANDARD.                                  00610000
006200                                                                  00620000
006300 01 PARM-CONTROL-REC.                                             00630013
014500    05 CD-DATE.                                                   00632008
014600       10 CD-EFF-CC                 PIC  X(02).                   00633014
014700       10 CD-EFF-DATE.                                            00634008
014800          15 CD-EFF-YY              PIC  X(02).                   00635014
014900          15 CD-EFF-MM              PIC  X(02).                   00636014
015000          15 CD-EFF-DD              PIC  X(02).                   00637014
          05 CD-NEW-TAX-GP-ITM            PIC  9(04).                   00638014
          05 CD-COPY-THIS-TAX-GP          PIC  9(04).                   00639014
          05 CD-POS-ASG-TX-ID             PIC  X(01).                   00639139
015100    05 FILLER                       PIC  X(63).                   00639339
006400                                                                  00640000
008700**********************************************************        00860000
008800 WORKING-STORAGE SECTION.                                         00870000
008900**********************************************************        00880000
009000 01  PC-PROGRAM-CONSTANTS.                                        00890000
009100     05  PC-PROGRAM-NAME         PIC X(08)    VALUE 'TXKUP005'.   00900041
009200                                                                  00912000
009300 01  PV-PROGRAM-VARIABLES.                                        00913000
010700     05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.       00970000
013050     05  PV-MAX-TAX-TABLE-NBR    PIC 9(06)    VALUE ZERO.         00971024
010800     05  PV-DB2-OPERATION        PIC X(40)    VALUE SPACES.       00980000
012300     05  PV-OPERATION-MSG-1      PIC  X(45)   VALUE SPACE.        00990000
010900     05  PV-COMMIT-TIMESTAMP     PIC X(26)    VALUE SPACES.       01000000
011000     05  PV-CURRENT-TIMESTAMP    PIC X(26)    VALUE SPACES.       01010000
011100     05  PV-INPUT-DATE           PIC X(10)    VALUE SPACES.       01020000
023130     05  PV-INPUT-COPY           PIC 9(04)    VALUE ZERO.         01021000
023130     05  PV-INPUT-NEW-VALUE      PIC 9(04)    VALUE ZERO.         01022000
011200     05  PV-INDATE-MINUS-ONE     PIC X(10)    VALUE SPACES.       01030000
011300     05  PV-UPDATE-MESSAGE       PIC X(40)    VALUE SPACES.       01040000
011400        88 PV-UPDATE-REQUIRED                 VALUE               01050000
011500           'UPDATES WERE MADE IN PARAMETER FILE: '.               01060000
011600        88 PV-NO-UPDATE-REQUIRED              VALUE               01070000
011700           'NO UPDATES WERE MADE IN PARAMETER FILE:'.             01080000
013050     05  PV-WORKING-GROUP-NBR    PIC 9(01)    VALUE ZERO.         01090000
013050     05  PV-MAX-TAX-GROUP-NBR    PIC 9(01)    VALUE ZERO.         01100000
018500     05  PV-HOLD-PREV-STR-NBR    PIC S9(04)   VALUE ZEROES COMP.  01101005
                                                                        01102005
           05 PV-TX-GP-ITM-ID               PIC  S9(4) COMP.            01103005
           05 PV-STR-NBR                    PIC  S9(4) COMP.            01104005
           05 PV-TX-TYP-CDE                 PIC   X(2).                 01105005
           05 PV-EFF-BEG-DTE                PIC   X(10).                01106005
           05 PV-TX-RT-PCT                  PIC  S9(1)V9(5) COMP-3.     01107005
           05 PV-ABV-THRS-FTX-IND           PIC   X(1).                 01108005
           05 PV-THRS-DOL-AMT               PIC  S9(5)V9(2) COMP-3.     01109005
           05 PV-BLW-THRS-TX-RT-PCT         PIC  S9(1)V9(5) COMP-3.     01110005
           05 PV-BLW-THRS-FTX-IND           PIC   X(1).                 01110105
           05 PV-POS-ASG-TX-ID              PIC   X(1).                 01110205
           05 PV-LAST-UPD-TMST              PIC   X(26).                01110405
           05 PV-LAST-UPD-BY-USR-ID         PIC   X(8).                 01110505
           05 PV-THRS-TX-CDE                PIC   X(1).                 01110605
           05 PV-TX-HOL-IND                 PIC   X(1).                 01110705
                                                                        01110805
012900 01  NEW-TAX-RATE-TBL.                                            01110924
013000     05  NEW-TAX-RATE-INFO        OCCURS 3000 TIMES               01111024
013100                                  INDEXED BY TBL-IDX.             01112024
               10  TBL-EFF-BEG-DTE          PIC X(10)      VALUE SPACE. 01116124
               10  TBL-TX-GP-ITM-ID         PIC S9(4)  VALUE ZERO COMP. 01117024
               10  TBL-TX-RT-PCT            PIC S9(1)V9(5)              01118024
                                                 VALUE ZEROES COMP-3.   01118124
               10  TBL-ABV-THRS-FTX-IND     PIC X(01)      VALUE SPACE. 01119024
               10  TBL-THRS-DOL-AMT         PIC S9(5)V9(2)              01119124
                                                 VALUE ZEROES COMP-3.   01119224
               10  TBL-BLW-THRS-TX-RT-PCT   PIC S9(1)V9(5)              01119345
                                                 VALUE ZEROES COMP-3.   01119445
               10  TBL-BLW-THRS-FTX-IND     PIC X(01)      VALUE SPACE. 01119524
               10  TBL-POS-ASG-TX-ID        PIC X(01)      VALUE SPACE. 01119624
               10  TBL-LAST-UPD-TMST        PIC X(26)      VALUE SPACE. 01119724
               10  TBL-LAST-UPD-BY-USR-ID   PIC X(08)      VALUE SPACE. 01119824
               10  TBL-THRS-TX-CDE          PIC X(01)      VALUE SPACE. 01119924
               10  TBL-TX-HOL-IND           PIC X(01)      VALUE SPACE. 01120024
               10  TBL-STR-NBR              PIC S9(4)  VALUE ZERO COMP. 01120124
               10  TBL-TX-TYP-CDE           PIC X(02)      VALUE SPACE. 01120224
                                                                        01120324
                                                                        01120405
011900*--------------------------------------------------------         01121000
012000* TAX PARAMETER VARIABLES                                         01130000
012100*--------------------------------------------------------         01140000
012200     05  PV-PTAX-STORE-NBR       PIC 9(4)     VALUE ZERO.         01150000
012300     05  PV-PTAX-ROUNDING-MTHD   PIC X(1)     VALUE '1'.          01160000
012400     05  PV-PTAX-CODE-INDICATOR  PIC X(1)     VALUE '1'.          01170000
012500     05  PV-PTAX-RATE            PIC X(5)     VALUE '00000'.      01180000
012600     05  PV-PTAX-THRS-DOLLAR     PIC X(6)     VALUE '000000'.     01190000
012700     05  PV-PTAX-ALT-POINTER     PIC X(1)     VALUE SPACES.       01200000
012800     05  PV-PTAX-DISCOUNT-IND    PIC X(1)     VALUE '2'.          01210000
012900     05  PV-PARAM-TO-WRITE       PIC X(200)   VALUE SPACES.       01220000
013000     05  PV-TEMP-PARAMETER       PIC X(200)   VALUE SPACES.       01230000
013100                                                                  01240000
013200*--------------------------------------------------------         01250000
013300* END OF FILE CHARACTER HEX '3F' = CTRL-Z IN ASCII                01260000
013400*--------------------------------------------------------         01270000
013500     05  PV-EOF-HEX-3F           PIC X(1)     VALUE ''.          01280000
013600                                                                  01290000
013700                                                                  01300000
013800 01  NULL-IND-VARIABLES.                                          01310000
013900     05  IND-LAST-UPD-TMST       PIC S9(4) COMP.                  01320000
014100*----------------------------------------------------------       01330000
014200* CONTROL CARD DATE - SCHEDULED DATE                              01340000
014300*----------------------------------------------------------       01350000
015200                                                                  01440000
015300                                                                  01450000
013300                                                                  01615500
016200*---------------------------------------------------------        01615600
016300* PROGRAM SWITCHES                                                01615700
016400*---------------------------------------------------------        01615800
016500 01  PS-PROGRAM-SWITCHES.                                         01615900
016600     05  PS-EOF-TAX-RATE-CURSOR-SW    PIC X(01)  VALUE SPACES.    01616000
016700         88  PS-EOF-TAX-RATE-CURSOR              VALUE 'Y'.       01617000
016800     05  PS-COPY-TAX-SW               PIC X(01)  VALUE SPACES.    01620008
016900         88  PS-COPY-TAX-FOUND                   VALUE 'Y'.       01630008
017000         88  PS-COPY-TAX-NOT-FOUND               VALUE 'N'.       01640008
016800     05  PS-NEW-TAX-SW               PIC X(01)  VALUE SPACES.     01641008
016900         88  PS-NEW-TAX-FOUND                   VALUE 'Y'.        01642008
017000         88  PS-NEW-TAX-NOT-FOUND               VALUE 'N'.        01643008
017100     05  PS-END-OF-NEW-TAX-RATES-SW   PIC X(01)  VALUE SPACES.    01650000
017200         88  PS-END-OF-NEW-TAX-RATES             VALUE 'Y'.       01660000
017300*---------------------------------------------------------        01670000
017400* ABEND CODE                                                      01680000
017500*---------------------------------------------------------        01690000
017600 01  ABEND-CODE                       PIC S9(04) VALUE +0.        01700000
009000     88  AC-DATE-ERROR                           VALUE +4003.     01710000
009300     88  AC-TABLE-OVERFLOW-ERROR                 VALUE +4004.     01720000
009200     88  AC-DB2-ERROR                            VALUE +4013.     01730000
009100     88  AC-ALT-POINTER-ERROR                    VALUE +4014.     01740000
017700                                                                  01750000
017800*---------------------------------------------------------        01760000
017900*  PROGRAM ACCUMULATORS.                                          01770000
018000*---------------------------------------------------------        01780000
018100 01  PA-PROGRAM-ACCUMULATORS.                                     01790000
018200     05  PA-TX-RTE-CNT         PIC S9(4) COMP VALUE ZERO.         01800000
018300     05  PA-RECS-INSERTED      PIC S9(4) COMP VALUE ZERO.         01810008
018300     05  PA-MAX-UPDATED        PIC S9(4) COMP VALUE ZERO.         01811016
018400                                                                  01820000
018500*---------------------------------------------------------        01830012
018600*  DB2 TABLE DB2PDBA.TTXRTLO - TAX RATES FOR STORE TAX GROUPS     01840012
018700*---------------------------------------------------------        01850012
018800     EXEC SQL                                                     01860012
018900           INCLUDE TTXRTLO                                        01870012
019000     END-EXEC.                                                    01880012
019100*---------------------------------------------------------        01950012
019200*  DB2 TABLE DB2PDBA.XST_LOC - STORE TABLE                        01960012
019300*---------------------------------------------------------        01970012
019400     EXEC SQL                                                     01971012
019500           INCLUDE XST00001                                       01972012
019600     END-EXEC.                                                    01973012
019700*---------------------------------------------------------        01974012
019800*  DB2 TABLE DB2PDBA.TSTATE - STATE TAX RATE TABLE                01975012
019900*---------------------------------------------------------        01976012
020000     EXEC SQL                                                     01977012
020100           INCLUDE TSTATE                                         01978012
020200     END-EXEC.                                                    01979012
020400*---------------------------------------------------------        01980000
020500*  CURSOR USED TO GET ALL CURRENT TAX RATES FOR ALL STORES.       01990000
020600*---------------------------------------------------------        02000000
020700     EXEC SQL                                                     02010000
020800       DECLARE TAX-RATE-CURSOR CURSOR WITH HOLD FOR               02020000
020900         SELECT A.LOC_NBR                                         02030000
021000               ,A.OPN_DTE                                         02040000
                     ,T.STR_NBR                                         02041010
021100               ,T.TX_GP_ITM_ID                                    02050000
021200               ,T.TX_TYP_CDE                                      02060000
021300               ,T.EFF_BEG_DTE                                     02070000
039756               ,T.TX_GP_ITM_ID                                    02071010
021500               ,T.TX_RT_PCT                                       02080000
021600               ,T.ABV_THRS_FTX_IND                                02090000
021700               ,T.THRS_DOL_AMT                                    02100000
021800               ,T.BLW_THRS_TX_RT_PCT                              02110000
021900               ,T.BLW_THRS_FTX_IND                                02120000
022000               ,T.POS_ASG_TX_ID                                   02130000
022100               ,T.LAST_UPD_TMST                                   02140000
039736               ,T.THRS_TX_CDE                                     02141010
039738               ,T.TX_HOL_IND                                      02142010
022200               ,S.ST_TX_RND_MTHD_CDE                              02150000
022300          FROM XST_LOC A,                                         02160000
022400               TTXRTLO T,                                         02170000
022600               TSTATE S                                           02180000
022500         WHERE A.LOC_NBR = T.STR_NBR                              02190000
022700           AND S.STATE_CODE = A.ST_CDE                            02200000
023100           AND A.LOC_TYP_CDE = 'DS'                               02210000
022800           AND T.EFF_BEG_DTE = (SELECT MAX(R.EFF_BEG_DTE)         02220000
022900                                  FROM TTXRTLO R                  02230000
023000                                 WHERE R.STR_NBR = T.STR_NBR      02240000
023100                                   AND R.TX_GP_ITM_ID =           02250000
023110                                               T.TX_GP_ITM_ID)    02260004
023200         ORDER BY A.LOC_NBR, T.TX_GP_ITM_ID                       02290000
023250          WITH UR                                                 02300000
023300     END-EXEC.                                                    02310000
023400                                                                  02320000
023497                                                                  02347700
023500*---------------------------------------------------------        02347800
023600* STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA                  02347900
023700*---------------------------------------------------------        02348000
023800     EXEC SQL                                                     02349000
023900         INCLUDE SQLCA                                            02350000
024000     END-EXEC.                                                    02360000
024100                                                                  02370000
024200*----------------------------------------------------------------*02380000
024300*    STANDARD DB/2 DCLGEN FOR THE CHECKPOINT RESTART TABLE       *02390000
024400*----------------------------------------------------------------*02400000
024500     EXEC SQL                                                     02410000
024600         INCLUDE TCKRSTCN                                         02420000
024700     END-EXEC.                                                    02430000
024800                                                                  02440000
024900*---------------------------------------------------------        02450000
025000* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02460000
025100*---------------------------------------------------------        02470000
025200     COPY DPWS004.                                                02480000
025300                                                                  02490000
025400*----------------------------------------------------------       02500000
025500* WORKING STORAGE FOR DPKUT500 INTERFACE                          02510000
025600*----------------------------------------------------------       02520000
025700     COPY DPWS500.                                                02530000
025800                                                                  02540000
025900**********************************************************        02550000
026000 PROCEDURE DIVISION.                                              02560000
026100**********************************************************        02570000
026200***********************************************************       02580000
026300 0000-MAINLINE.                                                   02590000
026400***********************************************************       02600000
026500     PERFORM 1000-INITIALIZE.                                     02610000
026600                                                                  02620000
           MOVE XST00001-LOC-NBR      TO PV-HOLD-PREV-STR-NBR.          02621008
017000     SET  PS-COPY-TAX-NOT-FOUND TO TRUE.                          02621108
017000     SET  PS-NEW-TAX-NOT-FOUND  TO TRUE.                          02621208
                                                                        02622008
026700     PERFORM 2000-PROCESS-TAX-RATE                                02630000
026800       UNTIL (PS-EOF-TAX-RATE-CURSOR).                            02640030
026900                                                                  02650000
           DISPLAY 'PA MAX ' PA-MAX-UPDATED.                            02660035
                                                                        02670035
101900     PERFORM 4200-MOVE-VALUES                                     02673024
101910     VARYING TBL-IDX FROM 1 BY 1                                  02674024
102000       UNTIL TBL-IDX > PA-MAX-UPDATED.                            02675027
102200                                                                  02677024
027200     PERFORM 9000-FINISH.                                         02680000
027300                                                                  02690000
027400     GOBACK.                                                      02700000
027500                                                                  02710000
027600*000-EXIT.                                                        02720000
027700                                                                  02730000
027800***********************************************************       02740000
027900 1000-INITIALIZE.                                                 02750000
028000***********************************************************       02760000
028100     DISPLAY '******* MESSAGES FOR '                              02770000
028200              PC-PROGRAM-NAME ' *******'                          02780000
028300                                                                  02790000
028400     OPEN INPUT  PARM-CONTROL-FILE.                               02800008
028900                                                                  02850000
029000     PERFORM 8600-GET-COMMIT-TIMESTAMP.                           02860000
029100                                                                  02870000
029200     READ PARM-CONTROL-FILE                                       02880008
029300       AT END                                                     02890000
029400         DISPLAY ' '                                              02900000
029500         DISPLAY '** ABEND     **'                                02910000
029600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            02920000
029700         DISPLAY '** PARAGRAPH **'                                02930000
029800          '= 1000-INITIALIZE'                                     02940000
029900         DISPLAY '** DATE CONTROL RECORD IS MISSING'              02950000
030000         SET AC-DATE-ERROR TO TRUE                                02960000
030100         CALL 'ILBOABN0' USING ABEND-CODE                         02970000
030200     END-READ.                                                    02980000
030300                                                                  02990000
030600     DISPLAY PC-PROGRAM-NAME ' DATE CONTROL DATE: '               02991041
030700      CD-DATE.                                                    02992041
030800                                                                  02993041
           IF CD-DATE NOT = '99999999'                                  03000041
030500         PERFORM 1100-VERIFY-DATE                                 03010041
030900         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-INPUT-DATE             03010141
           ELSE                                                         03010241
               MOVE '9999999999'           TO PV-INPUT-DATE             03010341
           END-IF.                                                      03011041
                                                                        03012041
031000     DISPLAY  ' *** INPUT DATE: ' PV-INPUT-DATE.                  03060000
                                                                        03090041
031300     PERFORM 1300-OPEN-TAX-RATE-CSR.                              03120000
031400     PERFORM 1400-FETCH-TAX-RATE.                                 03130005
031560                                                                  03150000
031600*1000-EXIT                                                        03160000
031700                                                                  03170000
031800*----------------------------------------------------------       03180000
031900* 1100-VERIFY-DATE.                                               03190000
032000*----------------------------------------------------------       03200000
032100 1100-VERIFY-DATE.                                                03210000
032200                                                                  03220000
032300     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03230000
032400     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     03240000
032500     SET DPG52-LK-DTE-ISO            TO TRUE.                     03250000
032600     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     03260000
032700                                                                  03270000
032800     MOVE CD-DATE TO DPG52-DB2-ISO-DATE.                          03280000
032900                                                                  03290000
033000     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03300000
033100          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03310000
033200                                                                  03320000
033300     EVALUATE TRUE                                                03330000
033400         WHEN DPG54-NO-ERROR                                      03340000
033500             CONTINUE                                             03350000
033600         WHEN OTHER                                               03360000
033700             DISPLAY '** ABEND **'                                03370000
033800             DISPLAY PC-PROGRAM-NAME          ' - INVALID     '   03380000
033900                       'CONTROL CARD DATE'                        03390000
034000             DISPLAY ' DATE CONTROL DATE: '                       03400000
034100             CD-DATE                                              03410000
034200             SET AC-DATE-ERROR TO TRUE                            03420000
034300             CALL 'ILBOABN0' USING ABEND-CODE                     03430000
034400     END-EVALUATE.                                                03440000
034500                                                                  03450000
034600*1100-EXIT.                                                       03460000
037900                                                                  03790000
038000***********************************************************       03800000
038100 1300-OPEN-TAX-RATE-CSR.                                          03810000
038200***********************************************************       03820000
038300                                                                  03830000
038400     EXEC SQL                                                     03840000
038500         OPEN TAX-RATE-CURSOR                                     03850000
038600     END-EXEC.                                                    03860000
038700                                                                  03870000
038800     EVALUATE SQLCODE                                             03880000
038900         WHEN ZERO                                                03890000
039000             CONTINUE                                             03900000
039100         WHEN OTHER                                               03910000
039200             MOVE '1300-OPEN-TAXRT'     TO PV-PARAGRAPH-NAME      03920005
039300             MOVE 'OPEN TAX-RATE-CURSOR CURSOR'                   03930000
039400                                        TO PV-DB2-OPERATION       03940000
039500             PERFORM 9900-SQL-ABEND                               03950000
039600     END-EVALUATE.                                                03960000
039700                                                                  03970000
044400                                                                  04260000
039800***********************************************************       04260105
044500 1400-FETCH-TAX-RATE.                                             04260205
039800***********************************************************       04260305
044600                                                                  04260405
044700     MOVE ZERO TO IND-LAST-UPD-TMST.                              04260505
044900     MOVE SPACES TO TXRTLO-LAST-UPD-TMST.                         04260605
045100                                                                  04260705
045200     EXEC SQL                                                     04262505
045300       FETCH TAX-RATE-CURSOR                                      04262605
045400         INTO :XST00001-LOC-NBR                                   04262705
045500             ,:XST00001-OPN-DTE                                   04262805
                   ,:TXRTLO-STR-NBR                                     04262910
045600             ,:TXRTLO-TX-GP-ITM-ID                                04263005
045700             ,:TXRTLO-TX-TYP-CDE                                  04263105
045800             ,:TXRTLO-EFF-BEG-DTE                                 04263205
                   ,:TXRTLO-TX-GP-ITM-ID                                04263310
046000             ,:TXRTLO-TX-RT-PCT                                   04263405
046100             ,:TXRTLO-ABV-THRS-FTX-IND                            04263505
046200             ,:TXRTLO-THRS-DOL-AMT                                04263605
046300             ,:TXRTLO-BLW-THRS-TX-RT-PCT                          04263705
046400             ,:TXRTLO-BLW-THRS-FTX-IND                            04263805
046500             ,:TXRTLO-POS-ASG-TX-ID                               04263905
046600             ,:TXRTLO-LAST-UPD-TMST:IND-LAST-UPD-TMST             04264005
                   ,:TXRTLO-THRS-TX-CDE                                 04264110
                   ,:TXRTLO-TX-HOL-IND                                  04264210
046700             ,:TSTATE-ST-TX-RND-MTHD-CDE                          04264305
046800     END-EXEC.                                                    04264405
046900                                                                  04264505
047000     EVALUATE SQLCODE                                             04264605
047100       WHEN ZERO                                                  04264705
047200           ADD +1 TO PA-TX-RTE-CNT                                04264805
047300       WHEN +100                                                  04264905
047400           MOVE 'Y' TO PS-EOF-TAX-RATE-CURSOR-SW                  04265005
047500                                                                  04265105
047600*-------------------------------------------------------------*   04265205
047700* PROCESS SQL READ ERROR                                      *   04265305
047800*-------------------------------------------------------------*   04265405
047900       WHEN OTHER                                                 04265505
048000         MOVE '1400-FETCH-TAX-RATE'                               04265605
048100           TO PV-PARAGRAPH-NAME                                   04265705
048200         MOVE 'FETCH A TAX-RATE-CURSOR RECORD'                    04265805
048300           TO PV-DB2-OPERATION                                    04265905
048400         PERFORM 9900-SQL-ABEND                                   04266005
048500     END-EVALUATE.                                                04266105
048600                                                                  04266205
039800***********************************************************       04266305
039900 2000-PROCESS-TAX-RATE.                                           04266405
040000***********************************************************       04266505
040100                                                                  04266605
                                                                        04266708
092100     IF XST00001-LOC-NBR = PV-HOLD-PREV-STR-NBR                   04266808
                                                                        04266908
017000        IF PS-COPY-TAX-NOT-FOUND                                  04268020
092300            PERFORM 4000-STORE-VALUES                             04268120
017000        END-IF                                                    04268220
                                                                        04268320
039742        IF TXRTLO-TX-GP-ITM-ID =  CD-COPY-THIS-TAX-GP             04268522
017000             SET PS-COPY-TAX-FOUND  TO TRUE                       04268620
039742        END-IF                                                    04268720
092400                                                                  04268820
039742        IF TXRTLO-TX-GP-ITM-ID = CD-NEW-TAX-GP-ITM                04268922
017000           SET PS-NEW-TAX-FOUND   TO TRUE                         04269020
                  DISPLAY '***** EXISTING *****'                        04269144
                  DISPLAY 'NEW TAX GROUP EXISTS WILL NOT COPY'          04269244
                  DISPLAY 'STORE NUMBER EFFECTED:  ' PV-STR-NBR         04269444
                  DISPLAY '****************** '                         04269544
039742        END-IF                                                    04269620
092400                                                                  04269720
092100     ELSE                                                         04269820
092100     IF XST00001-LOC-NBR > PV-HOLD-PREV-STR-NBR                   04269920
                                                                        04270020
               IF PS-COPY-TAX-FOUND AND PS-NEW-TAX-NOT-FOUND            04270220
                  PERFORM 4100-TBL-VALUES                               04270324
               ELSE                                                     04270420
               IF PS-COPY-TAX-NOT-FOUND AND PS-NEW-TAX-NOT-FOUND        04270520
                  PERFORM 4100-TBL-VALUES                               04270624
                  DISPLAY '***** NOTICE ***** '                         04270743
                  DISPLAY 'TAX GROUP NOT BEING SET UP BY COPY'          04270843
                  DISPLAY 'USING LAST TAX GROUP AS A COPY'              04270943
                  DISPLAY 'STORE NUMBER EFFECTED:  ' PV-STR-NBR         04271043
                  DISPLAY '****************** '                         04272843
               END-IF                                                   04272920
               END-IF                                                   04273020
                                                                        04273120
017000         SET PS-COPY-TAX-NOT-FOUND  TO TRUE                       04273220
017000         SET PS-NEW-TAX-NOT-FOUND   TO TRUE                       04273320
                                                                        04273420
039742        IF TXRTLO-TX-GP-ITM-ID =  CD-COPY-THIS-TAX-GP             04273524
017000             SET PS-COPY-TAX-FOUND  TO TRUE                       04273624
039742        END-IF                                                    04273724
092400                                                                  04273824
039742        IF TXRTLO-TX-GP-ITM-ID = CD-NEW-TAX-GP-ITM                04273924
017000           SET PS-NEW-TAX-FOUND   TO TRUE                         04274024
039742        END-IF                                                    04274124
092400                                                                  04274224
092300        PERFORM 4000-STORE-VALUES                                 04274320
                                                                        04274420
092100     END-IF                                                       04274520
092100     END-IF.                                                      04274620
                                                                        04274720
           MOVE XST00001-LOC-NBR TO PV-HOLD-PREV-STR-NBR.               04274820
031400     PERFORM 1400-FETCH-TAX-RATE.                                 04274920
092400                                                                  04275020
026800     IF (PS-EOF-TAX-RATE-CURSOR)                                  04275132
               DISPLAY 'EOF '    XST00001-LOC-NBR                       04275233
016800         DISPLAY 'COPY TAX ' PS-COPY-TAX-SW                       04275334
016800         DISPLAY 'NEW TAX  ' PS-NEW-TAX-SW                        04275434
               IF PS-COPY-TAX-FOUND AND PS-NEW-TAX-NOT-FOUND            04275532
                  PERFORM 4100-TBL-VALUES                               04275632
               ELSE                                                     04275732
               IF PS-COPY-TAX-NOT-FOUND AND PS-NEW-TAX-NOT-FOUND        04275832
                  PERFORM 4100-TBL-VALUES                               04275932
                  DISPLAY '***** NOTICE ***** '                         04276043
                  DISPLAY 'TAX GROUP NOT BEING SET UP BY COPY'          04276143
                  DISPLAY 'USING LAST TAX GROUP AS A COPY'              04276243
                  DISPLAY 'STORE NUMBER EFFECTED:  ' PV-STR-NBR         04276343
                  DISPLAY '****************** '                         04276443
               END-IF                                                   04276532
               END-IF                                                   04276632
026800     END-IF.                                                      04276732
092400                                                                  04276832
044300*2000-EXIT.                                                       04276920
044400                                                                  04277020
039800********************************                                  04277120
039900 4000-STORE-VALUES.                                               04277220
040000***********************************************************       04277320
                                                                        04277420
           IF   PV-INPUT-DATE = '9999999999'                            04277541
              MOVE TXRTLO-EFF-BEG-DTE        TO PV-EFF-BEG-DTE          04277641
           ELSE                                                         04277741
              MOVE PV-INPUT-DATE             TO PV-EFF-BEG-DTE          04277842
           END-IF.                                                      04277941
                                                                        04278041
           MOVE CD-NEW-TAX-GP-ITM         TO PV-TX-GP-ITM-ID.           04278141
           MOVE TXRTLO-TX-RT-PCT          TO PV-TX-RT-PCT.              04278241
           MOVE TXRTLO-ABV-THRS-FTX-IND   TO PV-ABV-THRS-FTX-IND.       04278341
           MOVE TXRTLO-THRS-DOL-AMT       TO PV-THRS-DOL-AMT.           04278441
           MOVE TXRTLO-BLW-THRS-TX-RT-PCT TO PV-BLW-THRS-TX-RT-PCT.     04278545
           MOVE TXRTLO-BLW-THRS-FTX-IND   TO PV-BLW-THRS-FTX-IND.       04278641
           MOVE CD-POS-ASG-TX-ID          TO PV-POS-ASG-TX-ID.          04278741
           MOVE PV-COMMIT-TIMESTAMP       TO PV-LAST-UPD-TMST.          04278841
           MOVE PC-PROGRAM-NAME           TO PV-LAST-UPD-BY-USR-ID.     04278941
           MOVE TXRTLO-THRS-TX-CDE        TO PV-THRS-TX-CDE.            04279041
           MOVE TXRTLO-TX-HOL-IND         TO PV-TX-HOL-IND.             04279141
           MOVE XST00001-LOC-NBR          TO PV-STR-NBR.                04279241
           MOVE TXRTLO-TX-TYP-CDE         TO PV-TX-TYP-CDE.             04279341
                                                                        04279441
 44300*4000-EXIT.                                                       04279505
                                                                        04280005
039800***********************************************************       04290005
039900 4100-TBL-VALUES.                                                 04300024
040000***********************************************************       04310005
                                                                        04311007
                                                                        04313024
             DISPLAY 'PV-STR-NBR ' PV-STR-NBR                           04314034
                                                                        04315034
             MOVE PV-EFF-BEG-DTE                                        04320024
                                  TO TBL-EFF-BEG-DTE(TBL-IDX)           04320124
             MOVE PV-TX-GP-ITM-ID                                       04321024
                                  TO TBL-TX-GP-ITM-ID(TBL-IDX).         04321124
             MOVE PV-TX-RT-PCT                                          04322024
                                  TO TBL-TX-RT-PCT(TBL-IDX).            04322124
             MOVE PV-ABV-THRS-FTX-IND                                   04323024
                                  TO TBL-ABV-THRS-FTX-IND(TBL-IDX).     04323124
             MOVE PV-THRS-DOL-AMT                                       04324024
                                  TO TBL-THRS-DOL-AMT(TBL-IDX).         04324124
             MOVE PV-BLW-THRS-TX-RT-PCT                                 04325045
                                  TO TBL-BLW-THRS-TX-RT-PCT(TBL-IDX).   04325145
             MOVE PV-BLW-THRS-FTX-IND                                   04325245
                                  TO TBL-BLW-THRS-FTX-IND(TBL-IDX).     04325345
             MOVE PV-POS-ASG-TX-ID                                      04326024
                                  TO TBL-POS-ASG-TX-ID(TBL-IDX).        04326124
             MOVE PV-LAST-UPD-TMST                                      04327024
                                  TO TBL-LAST-UPD-TMST(TBL-IDX).        04327124
             MOVE PV-LAST-UPD-BY-USR-ID                                 04328015
                                  TO TBL-LAST-UPD-BY-USR-ID(TBL-IDX).   04328124
             MOVE PV-THRS-TX-CDE                                        04329024
                                  TO TBL-THRS-TX-CDE(TBL-IDX).          04329124
             MOVE PV-TX-HOL-IND                                         04329224
                                  TO TBL-TX-HOL-IND(TBL-IDX).           04329324
             MOVE PV-STR-NBR                                            04329424
                                  TO TBL-STR-NBR(TBL-IDX).              04329524
             MOVE PV-TX-TYP-CDE                                         04329624
                                  TO TBL-TX-TYP-CDE(TBL-IDX).           04329724
                                                                        04329924
             SET TBL-IDX UP BY +1.                                      04330036
             ADD +1 TO PA-MAX-UPDATED.                                  04330137
                                                                        04331024
 44300*4100-EXIT.                                                       04340005
                                                                        04341008
                                                                        04590008
039800***********************************************************       04600024
039900 4200-MOVE-VALUES.                                                04610024
040000***********************************************************       04620024
                                                                        04630024
                                                                        04631128
             DISPLAY 'TBL STORE ' TBL-STR-NBR(TBL-IDX)                  04631235
             IF TBL-STR-NBR(TBL-IDX)  > 0                               04631335
                MOVE TBL-EFF-BEG-DTE(TBL-IDX)                           04631435
                                       TO TXRTLO-EFF-BEG-DTE            04631535
                MOVE TBL-TX-GP-ITM-ID(TBL-IDX)                          04631635
                                       TO TXRTLO-TX-GP-ITM-ID           04631735
                MOVE TBL-TX-RT-PCT(TBL-IDX)                             04631835
                                       TO TXRTLO-TX-RT-PCT              04631935
                MOVE TBL-ABV-THRS-FTX-IND(TBL-IDX)                      04632035
                                       TO TXRTLO-ABV-THRS-FTX-IND       04632135
                MOVE TBL-THRS-DOL-AMT(TBL-IDX)                          04632235
                                       TO TXRTLO-THRS-DOL-AMT           04632335
                MOVE TBL-BLW-THRS-TX-RT-PCT(TBL-IDX)                    04632445
                                       TO TXRTLO-BLW-THRS-TX-RT-PCT     04632545
                MOVE TBL-BLW-THRS-FTX-IND(TBL-IDX)                      04632645
                                       TO TXRTLO-BLW-THRS-FTX-IND       04632745
                MOVE TBL-POS-ASG-TX-ID(TBL-IDX)                         04632845
                                       TO TXRTLO-POS-ASG-TX-ID          04632945
                MOVE TBL-LAST-UPD-TMST(TBL-IDX)                         04633045
                                       TO TXRTLO-LAST-UPD-TMST          04633145
                MOVE TBL-LAST-UPD-BY-USR-ID(TBL-IDX)                    04633245
                                       TO TXRTLO-LAST-UPD-BY-USR-ID     04633345
                MOVE TBL-THRS-TX-CDE(TBL-IDX)                           04633445
                                       TO TXRTLO-THRS-TX-CDE            04633545
                MOVE TBL-TX-HOL-IND(TBL-IDX)                            04633645
                                       TO TXRTLO-TX-HOL-IND             04633745
                MOVE TBL-STR-NBR(TBL-IDX)                               04633845
                                       TO TXRTLO-STR-NBR                04633945
                MOVE TBL-TX-TYP-CDE(TBL-IDX)                            04634045
                                       TO TXRTLO-TX-TYP-CDE             04634145
                                                                        04634245
               PERFORM 7000-INSERT-NEW-STORE-INFO                       04634345
                                                                        04634445
               PERFORM 8620-COMMIT                                      04634545
             END-IF.                                                    04634645
                                                                        04635026
                                                                        04820028
 44300*4200-EXIT.                                                       04830026
                                                                        04840024
                                                                        04850024
071810***************************************************************** 07110000
071820* 7000-INSERT-NEW-STORE-INFO.                                   * 07120000
071830* THIS RATE IS TO BE USED TO SET UP THE STORE REGISTER BEFORE   * 07130000
071840* STORE OPEN DATE. THE ACTUAL RATE FOR THE STORE WILL BE ADDED  * 07140000
071850* BY THE TAX DEPARTMENT WHEN THE TAX RATE IS KNOWN.             * 07150000
071860***************************************************************** 07160000
071870 7000-INSERT-NEW-STORE-INFO.                                      07170000
039742                                                                  07180000
039744     EXEC SQL                                                     07181000
039746         INSERT                                                   07182000
039748           INTO TTXRTLO                                           07183000
039756                (TX_GP_ITM_ID                                     07183145
039750                ,STR_NBR                                          07184045
039752                ,TX_TYP_CDE                                       07185000
039754                ,EFF_BEG_DTE                                      07186000
039758                ,TX_RT_PCT                                        07188000
039760                ,ABV_THRS_FTX_IND                                 07189000
039726                ,THRS_DOL_AMT                                     07189100
                      ,BLW_THRS_TX_RT_PCT                               07189245
039728                ,BLW_THRS_FTX_IND                                 07189300
039730                ,POS_ASG_TX_ID                                    07189400
039732                ,LAST_UPD_TMST                                    07189600
039734                ,LAST_UPD_BY_USR_ID                               07189700
039736                ,THRS_TX_CDE                                      07189800
039738                ,TX_HOL_IND)                                      07189900
039746         VALUES (:TXRTLO-TX-GP-ITM-ID                             07190045
039740                ,:TXRTLO-STR-NBR                                  07190145
039742                ,:TXRTLO-TX-TYP-CDE                               07190200
039744                ,:TXRTLO-EFF-BEG-DTE                              07190300
039748                ,:TXRTLO-TX-RT-PCT                                07190400
039750                ,:TXRTLO-ABV-THRS-FTX-IND                         07190500
039752                ,:TXRTLO-THRS-DOL-AMT                             07190600
                      ,:TXRTLO-BLW-THRS-TX-RT-PCT                       07190745
039754                ,:TXRTLO-BLW-THRS-FTX-IND                         07190800
039756                ,:TXRTLO-POS-ASG-TX-ID                            07190900
039758                ,:TXRTLO-LAST-UPD-TMST                            07191100
039760                ,:TXRTLO-LAST-UPD-BY-USR-ID                       07191200
039762                ,:TXRTLO-THRS-TX-CDE                              07191300
039764                ,:TXRTLO-TX-HOL-IND)                              07191400
039766     END-EXEC.                                                    07191500
039768                                                                  07191600
039770     EVALUATE SQLCODE                                             07191700
039772         WHEN ZERO                                                07191800
047200             ADD +1 TO PA-RECS-INSERTED                           07191908
039774             CONTINUE                                             07192000
039776         WHEN OTHER                                               07192100
039777             DISPLAY 'ABEND STORE: ' TXRTLO-STR-NBR               07192200
039778             MOVE '7000-INSERT-NEW-STORE-INFO' TO                 07192300
039780                                          PV-PARAGRAPH-NAME       07192400
039782             MOVE 'INSERT NEW STORE RATE INTO TTXRTLO' TO         07192500
039784                                          PV-DB2-OPERATION        07192600
039786             PERFORM 9900-SQL-ABEND                               07192700
039788     END-EVALUATE.                                                07192800
039790                                                                  07192900
071900******************************************************************07193000
072000*  GET THE TIMESTAMP THAT WILL BE USED TO DETERMINE COMMIT       *07193100
072100*  PROCESSING                                                    *07193200
072200******************************************************************07193300
072300 8600-GET-COMMIT-TIMESTAMP.                                       07193400
072400                                                                  07193500
020200     EXEC SQL                                                     07193618
020300         SET :PV-COMMIT-TIMESTAMP = CURRENT TIMESTAMP             07193718
020400     END-EXEC.                                                    07193818
074300                                                                  07320000
076800                                                                  07530000
076900***************************************************************** 07540000
077000* COMMIT DB2 CHANGES                                            * 07550000
077100***************************************************************** 07560000
077200 8620-COMMIT.                                                     07570000
077300                                                                  07580000
077400     EXEC SQL                                                     07590000
077500         COMMIT                                                   07600000
077600     END-EXEC.                                                    07610000
077700                                                                  07620000
077800     EVALUATE TRUE                                                07630000
077900         WHEN SQLCODE = ZERO                                      07640000
078000             CONTINUE                                             07650000
078100         WHEN SQLWARN0 NOT EQUAL SPACE                            07660000
078200         WHEN SQLCODE NOT = +0                                    07670000
078300           MOVE '8620-COMMIT'                                     07680000
078400             TO PV-PARAGRAPH-NAME                                 07690000
078500           MOVE 'COMMIT TTXRTLO UPDATE'                           07700000
078600             TO PV-DB2-OPERATION                                  07710000
078700           PERFORM 9900-SQL-ABEND                                 07720000
078800     END-EVALUATE.                                                07730000
078900                                                                  07740000
079000***********************************************************       07750000
079100 9000-FINISH.                                                     07760000
079200***********************************************************       07770000
079300                                                                  07780000
080500                                                                  07940000
080700     CLOSE PARM-CONTROL-FILE.                                     07960008
080800                                                                  07970000
080900                                                                  07980000
081000     EXEC SQL                                                     07990000
081100         CLOSE TAX-RATE-CURSOR                                    08000000
081200     END-EXEC.                                                    08010000
081300                                                                  08020000
081400     EVALUATE TRUE                                                08030000
081500       WHEN SQLCODE NOT = +0                                      08040000
081600         MOVE '9000-FINISH'                                       08050000
081700           TO PV-PARAGRAPH-NAME                                   08060000
081800         MOVE 'CLOSE TAX-RATE CURSOR'                             08070000
081900           TO PV-DB2-OPERATION                                    08080000
082000         PERFORM 9900-SQL-ABEND                                   08090000
082100     END-EVALUATE.                                                08100000
082200                                                                  08110000
082300     DISPLAY '**** TAX RATES SELECTED: ' PA-TX-RTE-CNT.           08120000
082400     DISPLAY '**** TAX RATES INSERTED: ' PA-RECS-INSERTED.        08130008
082500                                                                  08140000
082600*9000-EXIT.                                                       08150000
082700***********************************************************       08160000
082800 9900-SQL-ABEND.                                                  08170000
082900***********************************************************       08180000
083000     DISPLAY ' '.                                                 08190000
083100     DISPLAY '9900-SQL-ABEND'.                                    08200000
083200     DISPLAY '**  ABEND     **'.                                  08210000
083300     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               08220000
083400     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             08230000
083500     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION.              08240000
083600***********************************************************       08250000
083700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION   *       08260000
083800* STATEMENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND   *       08270000
083900* MODULE 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO *       08280000
084000* A READABLE FORMAT.                                      *       08290000
084100***********************************************************       08300000
084200     COPY DPPD004.                                                08310000
084300                                                                  08320000
084400     SET AC-DB2-ERROR TO TRUE.                                    08330000
084500     CALL 'ILBOABN0' USING ABEND-CODE.                            08340000
084600                                                                  08350000
055400******************************************************************08360000
055500* 9999-ABEND                                                      08370000
055600*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  08380000
055700******************************************************************08390000
055800 9999-ABEND.                                                      08400000
055900     DISPLAY '** ABEND           **'.                             08410000
056000     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          08420000
056100     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        08430000
056300     DISPLAY '** ERROR           ** = ' PV-OPERATION-MSG-1.       08440000
056400     CALL 'ILBOABN0' USING ABEND-CODE.                            08450000
084700******************** END OF SOURCE CODE *******************       08460000
