000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    TRKCS197.                                         00040000
000500 AUTHOR.        DIANE DARR.                                       00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  08-31-00.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Y197 - ADDITIONAL PO FUNCTION MENU PROGRAM                 * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM DISPLAYS A MENU. IT ALLOWS THE USER TO        * 00130000
001400*    TRANSFER CONTROL TO ONE OF TWO DIFFERENT SCREENS.          * 00140000
001500*                                                               * 00150000
001800*---------------------------------------------------------------* 00160000
CICS  * CHANGED  1/16/2023    BY JIM HUNTER      WR: CHG0278495         00161002
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00162002
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00163002
CICS  *-----------------------------------------------------------------00164002
001900 ENVIRONMENT DIVISION.                                            00170000
002000 DATA DIVISION.                                                   00180000
002100 WORKING-STORAGE SECTION.                                         00190000
002200*                                                                 00200000
002300 01  PC-PROGRAM-CONSTANTS.                                        00210000
002400     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'TR197A  '. 00220000
002500     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'TRKM197 '. 00230000
002600     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'TRKCS197'. 00240000
004000                                                                  00250000
004100 01  PS-PROGRAM-SWITCHES.                                         00260000
004200     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00270000
004300         88  PS-ERROR                          VALUE  'Y'.        00280000
004400         88  PS-NO-ERROR                       VALUE  'N'.        00290000
004500     05  PS-COMMAREA-SW            PIC  X(01)  VALUE  'N'.        00300000
004600         88  PS-COMMAREA-VALID                 VALUE  'Y'.        00310000
004700         88  PS-COMMAREA-NOT-VALID             VALUE  'N'.        00320000
004800     05  PS-LIST-END-SW            PIC X(01)   VALUE  'N'.        00330000
004900         88  PS-LIST-END                       VALUE  'Y'.        00340000
005000         88  PS-NO-LIST-END                    VALUE  'N'.        00350000
005100                                                                  00360000
005200 01  PV-PROGRAM-VARIABLES.                                        00370000
005500     05  PV-MESSAGE-TEXT           PIC X(75)   VALUE SPACES.      00380000
005700     05  PV-CICS-RESPONSE          PIC S9(04) VALUE +0            00390000
005800                                               COMP SYNC.         00400000
005900     05  PV-RETRY-COUNTER          PIC S9(04) VALUE +0            00410000
006000                                               COMP SYNC.         00420000
006100*----------------------------------------------------------------*00430000
006200*    MAP LAYOUT                                                  *00440000
006300*----------------------------------------------------------------*00450000
006400     COPY TRKM197.                                                00460000
006500     EJECT                                                        00470000
006600*----------------------------------------------------------------*00480000
006700*    ATTRIBUTE SETTINGS COPYBOOK.                                *00490000
006800*----------------------------------------------------------------*00500000
006900     COPY DPWS015.                                                00510000
007000 EJECT                                                            00520000
007100*----------------------------------------------------------------*00530000
007200*    FUNCTION KEYS COPYBOOK                                      *00540000
007300*----------------------------------------------------------------*00550000
007400     COPY DPWS016.                                                00560000
007500 EJECT                                                            00570000
008800******************************************************************00580000
008900** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **00590000
009000** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **00600000
009100******************************************************************00610000
009200     COPY DPWS030.                                                00620000
CICS       COPY DPWS930.                                                00621002
009300 EJECT                                                            00630000
009400***************************************************************** 00640000
009500*    STANDARD COMMAREA.                                           00650000
009600***************************************************************** 00660000
009700                                                                  00670000
009800     COPY DPWS020.                                                00680000
009900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00690000
010000                                                                  00700000
010100***************************************************************** 00710000
010200*    INTER-APPLICATION COMMAREA.                                  00720000
010300***************************************************************** 00730000
010400                                                                  00740000
010500         10  INTER-APPL-COMM-AREA PIC X(200).                     00750000
010800     COPY APWS300.                                                00760000
010900     COPY VLWS005.                                                00770000
011000***************************************************************** 00780000
011100*    SPECIFIC COMMMAREA FOR TRKCS197.                             00790000
011200***************************************************************** 00800000
011300         10  ASC-SPECIFIC-COMMAREA.                               00810000
012300             15  ASC-MSG-TEXT              PIC X(75).             00820000
012900 EJECT                                                            00830000
013000*----------------------------------------------------------------*00840000
013100*    ABEND PROCESSING COPYBOOK.                                  *00850000
013200*----------------------------------------------------------------*00860000
013300     COPY DPWS013.                                                00870000
013400                                                                  00880000
015900*---------------------------------------------------------------* 00890000
016000 EJECT                                                            00900000
016100 LINKAGE SECTION.                                                 00910000
016200                                                                  00920000
016300 01  DFHCOMMAREA.                                                 00930000
016400     05  FILLER                         OCCURS  1 TO 4072 TIMES   00940000
016500                                        DEPENDING ON EIBCALEN.    00950000
016600         10  FILLER                     PIC X.                    00960000
016700                                                                  00970000
016800 PROCEDURE DIVISION.                                              00980000
016900***************************************************************** 00990000
017000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01000000
017100** THE SETUP AND PERFORM OF PARAGRAPH 9000-CALL-CICS-ARCH-API  ** 01010000
017200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01020000
017300**                                                             ** 01030000
017400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01040000
017500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01050000
017600***************************************************************** 01060000
017700 0000-MAIN-MODULE.                                                01070000
017800     INITIALIZE DP030-CICS-API-FIELDS.                            01080000
017900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01090000
018000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01100000
018100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01110000
018200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01120000
018300     MOVE LENGTH OF TR197AI        TO DP030-MAP-LENGTH (1).       01130000
018400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01140000
018500     PERFORM 9000-CALL-CICS-ARCH-API.                             01150000
018600                                                                  01160000
018700     PERFORM 1000-CONTROL-PROCESSING                              01170000
018800                                                                  01180000
018900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01190000
019000     PERFORM 9000-CALL-CICS-ARCH-API.                             01200000
019100*----------------------------------------------------------------*01210000
019200*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01220000
019300*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01230000
019400*----------------------------------------------------------------*01240000
019500 1000-CONTROL-PROCESSING.                                         01250000
019600                                                                  01260000
019700     EVALUATE TRUE                                                01270000
019800         WHEN DP020-NEXT-ACT-INITIAL                              01280000
019900             INITIALIZE ASC-SPECIFIC-COMMAREA                     01290000
020200             PERFORM 4000-BUILD-INITIAL-PANEL                     01300000
020400                                                                  01310000
020500         WHEN DP020-NEXT-ACT-READ-MAP                             01320000
020600             PERFORM 2000-FKEY-PROCESSING                         01330000
020700                                                                  01340000
020800         WHEN DP020-NEXT-ACT-RETURN                               01350000
020900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01360000
021000                                                                  01370000
021100         WHEN OTHER                                               01380000
021200             SET DP013-LOGIC-ABEND                                01390000
021300                 DP013-NO-ROLLBACK TO TRUE                        01400000
021400             MOVE '1000-CONTROL-PROCESSING'                       01410000
021500                                   TO  DP013-PARAGRAPH            01420000
021600             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   01430000
021700                                   TO  DP013-MESSAGE-TEXT(1)      01440000
021800             MOVE DP020-NEXT-APPL-ACTIVITY                        01450000
021900                                   TO DP013-MESSAGE-TEXT(2)       01460000
022000             PERFORM DP013-0000-PROCESS-ABEND                     01470000
022100     END-EVALUATE.                                                01480000
038600*----------------------------------------------------------------*01490000
038700* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*01500000
038800* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*01510000
038900* EDITS.                                                         *01520000
039000*----------------------------------------------------------------*01530000
039100 2000-FKEY-PROCESSING.                                            01540000
039200                                                                  01550000
039300     EVALUATE TRUE                                                01560000
039400                                                                  01570000
039500         WHEN DP020-SRC-AID = DP016-CLEAR                         01580000
039600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01590000
039700                                                                  01600000
039800         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     01610000
039900             PERFORM 4000-BUILD-INITIAL-PANEL                     01620000
040000                                                                  01630000
043500         WHEN OTHER                                               01640000
043600             SET DP030-CONTINUE-GO TO TRUE                        01650000
043700             PERFORM 2100-CHECK-FUNCTION-KEY                      01660000
043800     END-EVALUATE.                                                01670000
043900******************************************************************01680000
044000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **01690000
044100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **01700000
044200** FROM THE CICS ARCHITECTURE API.                              **01710000
044300******************************************************************01720000
044400 2100-CHECK-FUNCTION-KEY.                                         01730000
044500     EVALUATE TRUE                                                01740000
045300         WHEN DP020-SRC-AID = DP016-ENTER                         01750000
045400             CONTINUE                                             01760000
045500                                                                  01770000
045600         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               01780000
045700             CONTINUE                                             01790000
045800                                                                  01800000
045900         WHEN OTHER                                               01810000
046000             SET DP013-NO-ROLLBACK                                01820000
046100                 DP013-XCTL-DISPLAY-RESTART                       01830000
046200                 DP013-CICS-ABEND  TO TRUE                        01840000
046300             MOVE '2100-CHECK-FUNCTION-KEY'                       01850000
046400                                   TO DP013-PARAGRAPH             01860000
046500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      01870000
046600                                   TO DP013-MESSAGE-TEXT (1)      01880000
046700             PERFORM DP013-0000-PROCESS-ABEND                     01890000
046800     END-EVALUATE.                                                01900000
054100*----------------------------------------------------------------*01910000
054200*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *01920000
054300*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *01930000
054400*  IT HERE.                                                      *01940000
054500*----------------------------------------------------------------*01950000
054600 4000-BUILD-INITIAL-PANEL.                                        01960000
054700                                                                  01970000
054800     MOVE ' YOUR FILE IS BEING CREATED ' TO ASC-MSG-TEXT.         01980001
055600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        01990000
059300*----------------------------------------------------------------*02000000
059400*    MOVE THE MESSAGE TEXT TO THE MAP OUTPUT FIELD.              *02010000
059500*----------------------------------------------------------------*02020000
059600 4400-MOVE-COMMAREA-TO-SCREEN.                                    02030000
059700     MOVE ASC-MSG-TEXT             TO AMSGTXTO.                   02040001
060100 EJECT                                                            02050000
060200*----------------------------------------------------------------*02060000
060300*    WRITE COMMAREA TO TRANSFER CONTROL TO ANOTHER PROGRAM       *02070000
060400*----------------------------------------------------------------*02080000
060500 9000-CALL-CICS-ARCH-API.                                         02090000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02100002
060700                                    DFHCOMMAREA                   02110002
060800                                    DP030-CICS-API-FIELDS         02120002
060900                                    DP020-STANDARD-COMMAREA       02130002
061000                                    TR197AI.                      02140002
061100     IF  DP030-RC-CALL-SUCCESSFUL                                 02150000
061200         CONTINUE                                                 02160000
061300     ELSE                                                         02170000
061400         SET DP013-NO-ROLLBACK                                    02180000
061500             DP013-XCTL-DISPLAY-RESTART                           02190000
061600             DP013-CICS-ABEND      TO TRUE                        02200000
061700         MOVE 'BEFORE 0000-MAIN-MODULE'                           02210000
061800                                   TO DP013-PARAGRAPH             02220000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02230002
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02240002
062100         MOVE DP030-RETURN-CODE                                   02250000
062200                                   TO DP013-MESSAGE-TEXT (3)      02260000
062300         PERFORM DP013-0000-PROCESS-ABEND                         02270000
062400     END-IF.                                                      02280000
062500 EJECT                                                            02290000
067300*----------------------------------------------------------------*02300000
067400*    ABEND PROCESSOR MODULE                                      *02310000
067500*----------------------------------------------------------------*02320000
067600     COPY DPPD013.                                                02330000
067700*----------------------------------------------------------------*02340000
