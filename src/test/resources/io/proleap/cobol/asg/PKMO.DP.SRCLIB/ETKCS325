000100*-----------------------*                                         00010016
000200 IDENTIFICATION DIVISION.                                         00020016
000300*-----------------------*                                         00030016
000400 PROGRAM-ID.    ETKCS325.                                         00040016
000500 AUTHOR.        TROY BIRK.                                        00050016
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060016
000700 DATE-WRITTEN.  JULY 1994.                                        00070016
000800 DATE-COMPILED.                                                   00080016
000900                                                                  00090016
001000******************************************************************00100016
001100* PROGRAM NUMBER: ETKCS325       SYSTEM: ET     LANGUAGE: COBOL II00110016
001200*                                                                 00120016
001300* TRANID:  E325   MNEMONIC:  ETLFAACK           MAP: ETKM325      00130016
001400*                                                                 00140016
001500* PROGRAM NAME : EDI DOCS NOT ACKNOWLEDGED LIST                   00150016
001600*                                                                 00160016
001700* ORIGINAL WORK REQUEST #: 2026                                   00170016
001800*                                                                 00180016
001900* PROGRAM OBJECTIVE:                                              00190016
002000*                                                                 00200016
002100*   TO LIST ALL DOCUMENTS THAT ARE NOT YET ACKNOWLEDGED.          00210016
002200*                                                                 00220016
002300* DATASETS USED:                                                  00230016
002400*  DSN                                 COPY USED  I/O  VSAM?  DB? 00240016
002500* --------------------------------    ----------- ---- -----  --- 00250016
002600*  TTRNSET                             TTRNSET     I     N    DB2 00260016
002700*  TFGTRST                             TFGTRST    I/O    N    DB2 00270016
002800*  TENTNME                             TENTNME     I     N    DB2 00280016
002900*                                                                 00290016
003000* PROGRAM NARRATIVE:                                              00300016
003100*                                                                 00310016
003200*   THIS SCREEN IS ACCESSED FROM THE ETMENU. A CUROSR IS OPENED   00320016
003300*   WHICH IS LOOKING FOR ROWS ON THE TFGTRST TABLE WITH A         00330016
003400*   VEND_ACK_IND = 'N' TO  POPULATE THE LIST.  FROM THE LIST,     00340016
003500*   THE USER CAN SELECT ITEMS AND EITHER HIT PF15 TO ACKNOWLEDGE  00350016
003600*   THE ITEM OR HIT F23 TO GO TO THE INTERCHANGE TRANMISSION LIST.00360016
003700*                                                                 00370016
003800*   IF THE USER HITS F15 TO ACKNOWLEDGE, A SECOND CURSOR IS       00380016
003900*   OPENED. FOR EVERY ROW RETURNED FROM THIS CURSOR, THE          00390016
004000*   VEND_ACK_IND IS SET TO 'M'.                                   00400016
004100*                                                                 00410016
004200* CONTROL CARD REQUIREMENTS: N/A                                  00420016
004300* JOBS PROGRAM IS FOUND IN:  N/A                                  00430016
004400* REPORTS PRODUCED:          N/A                                  00440016
004500*                                                                 00450016
004600***************************************************************** 00460016
004700* CHANGES:                                                        00470016
004800*   DATE 11/23/98                                                 00480016
004900*   REWROTE THE CURSOR_ONE CURSOR TO DECREASE THE WAIT TIME AND   00490016
005000*   TO ELIMINATE CURRENT DAY DOCUMENTS.                           00500016
005100*   MADE BY: PAUL KEBER - STRATAGEM  WR/IR #: __________________  00510016
005200*                                                                 00520016
005300*   DATE 4/12/2000                                                00530016
005400*   ADD A NEW COLUMN, PO-ACKNL-STAT-CDE, FOR TRACKING FOLLOWUP    00540016
005500*   864 DOCUMENTS ON PURCHASE ORDERS.                             00550016
005600*   MADE BY: ROD JANSSEN             WR/IR #: 20669               00560016
005601*---------------------------------------------------------------* 00560118
005610* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00561018
005620*            - CHANGE CALL OF DPKUT100 TO                       * 00562018
005630*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00563018
005640*              MAKING THE CALL DYNAMIC VS STATIC                * 00564018
005650*                                                               * 00565018
005660*---------------------------------------------------------------* 00566018
CICS  *  CHANGED 10/26/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00567020
CICS  *                                                               * 00568019
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00569019
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00569119
005650*                                                               * 00569219
005660*---------------------------------------------------------------* 00569319
005700***************************************************************** 00570016
005800 EJECT                                                            00580016
005900 ENVIRONMENT DIVISION.                                            00590016
006000                                                                  00600016
006100 DATA DIVISION.                                                   00610016
006200                                                                  00620016
006300 WORKING-STORAGE SECTION.                                         00630016
006400                                                                  00640016
006500 01  PC-PROGRAM-CONSTANTS.                                        00650016
006600     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00660016
006700                                                    COMP SYNC.    00670016
006800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00680016
006900                                                    'ET325A  '.   00690016
007000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00700016
007100                                                    'ETKM325 '.   00710016
007200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00720016
007300                                                    'ETKCS325'.   00730016
007400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00740016
007500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00750016
007600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00760016
007700                                                    COMP SYNC.    00770016
007800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00780016
007900                                                    COMP SYNC.    00790016
008000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00800016
008100                                                    +1000000      00810016
008200                                                    COMP-3.       00820016
008300     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00830016
008400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00840016
008500     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00850016
008600     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00860016
008700     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00870016
008800     05  PC-CALENDAR-ROUTINE       PIC  X(08)  VALUE  'DPKUT500'. 00880016
008900*                                                                 00890016
009000     05  PC-TSYMSG-NUMBERS.                                       00900016
009100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00910016
009200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00920016
009300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00930016
009400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00940016
009500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00950016
009600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00960016
009700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00970016
009800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00980016
009900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00990016
010000         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01000016
010100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01010016
010200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01020016
010300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01030016
010400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01040016
010500         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01050016
010600         10  PC-TSYMSG-00831            PIC  9(05)  VALUE 00831.  01060016
010700*                                                                 01070016
010800 01  PS-PROGRAM-SWITCHES.                                         01080016
010900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01090016
011000         88  PS-NO-ERROR                            VALUE 'Y'.    01100016
011100         88  PS-ERROR                               VALUE 'N'.    01110016
011200     05  PS-START-ITEM-ERROR-SW         PIC  X(01)  VALUE 'Y'.    01120016
011300         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    01130016
011400         88  PS-START-ITEM-ERROR                    VALUE 'N'.    01140016
011500     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01150016
011600         88  PS-DONE                                VALUE 'Y'.    01160016
011700         88  PS-NOT-DONE                            VALUE 'N'.    01170016
011800     05  PS-MORE-CURSOR-TWO-ROWS-SW     PIC  X(01)  VALUE 'N'.    01180016
011900         88  PS-MORE-CURSOR-TWO-ROWS                VALUE 'Y'.    01190016
012000         88  PS-NO-MORE-CURSOR-TWO-ROWS             VALUE 'N'.    01200016
012100*                                                                 01210016
012200 01  PV-PROGRAM-VARIABLES.                                        01220016
012300     05  PV-SUB                         PIC S9(04)  VALUE +0      01230016
012400                                                    COMP SYNC.    01240016
012500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01250016
012600                                                    COMP SYNC.    01260016
012700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01270016
012800                                                    COMP-3.       01280016
012900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01290016
013000                                                    COMP-3.       01300016
013100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01310016
013200                                                    COMP-3.       01320016
013300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01330016
013400                                                    COMP-3.       01340016
013500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01350016
013600                                                    COMP-3.       01360016
013700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01370016
013800                                                    COMP-3.       01380016
013900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01390016
014000                                                    COMP-3.       01400016
014100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01410016
014200                                                    COMP SYNC.    01420016
014300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01430016
014400                                                    COMP SYNC.    01440016
014500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01450016
014600                                                    COMP SYNC.    01460016
014700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01470016
014800                                                    COMP SYNC.    01480016
014900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01490016
015000                                                    COMP SYNC.    01500016
015100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01510016
015200                                                    COMP SYNC.    01520016
015300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01530016
015400                                                    COMP SYNC.    01540016
015500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01550016
015600                                                    COMP SYNC.    01560016
015700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01570016
015800                                                    COMP SYNC.    01580016
015900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01590016
016000                                                    COMP SYNC.    01600016
016100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01610016
016200                                                    COMP SYNC.    01620016
016300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01630016
016400                                                    COMP SYNC.    01640016
016500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01650016
016600                                                    COMP SYNC.    01660016
016700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01670016
016800                                                    COMP SYNC.    01680016
016900     05  PV-SUM-ITM-EXTD-AMT            PIC S9(7)V99              01690016
017000                                                    COMP-3.       01700016
017100     05  PV-TP-TMST-DATE                PIC X(10)   VALUE SPACE.  01710016
017200*                                                                 01720016
017300******************************************************************01730016
017400**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01740016
017500**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01750016
017600**  APPLICATION-SPECIFIC COMMAREA.                              **01760016
017700******************************************************************01770016
017800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01780016
017900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01790016
018000     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01800016
018100                                        INDEXED BY LQW-IDX.       01810016
018200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01820016
018300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01830016
018400         10  LQW-SELECTED-SW            PIC  X(01).               01840016
018500             88  LQW-SELECT                         VALUE 'S'.    01850016
018600             88  LQW-DESELECT                       VALUE ' '.    01860016
018700                                                                  01870016
018800         10  LQW-ACTION              PIC  X(03).                  01880016
018900         10  LQW-TP-DKEY            PIC  S9(9) COMP.              01890016
019000         10  LQW-TP-DKEY-TMST       PIC  X(26).                   01900016
019100         10  LQW-VENDOR-NAME        PIC X(30).                    01910016
019200         10  LQW-FG-CNTL-NUM        PIC X(09).                    01920016
019300         10  LQW-TRAN-SET           PIC X(03).                    01930016
019400         10  LQW-DAYS-UNACK         PIC X(03).                    01940016
019500         10  LQW-PO-ACK-STAT-CDE    PIC X(01).                    01950016
019600                                                                  01960016
019700     EJECT                                                        01970016
019800*---------------------------------------------------------------* 01980016
019900*  RECORD LAYOUT FOR THE SELECTION                                01990016
020000*  TEMP STORAGE QUEUE.                                          * 02000016
020100*---------------------------------------------------------------* 02010016
020200     COPY ETWS308.                                                02020016
020300                                                                  02030016
020400     EJECT                                                        02040016
020500*---------------------------------------------------------------* 02050016
020600*    MAP LAYOUT                                                 * 02060016
020700*---------------------------------------------------------------* 02070016
020800                                                                  02080016
020900     COPY ETKM325.                                                02090016
021000*                                                                 02100016
021100*                                                                 02110016
021200 01  MR-OCCURS-LAYOUT                   REDEFINES  ET325AO.       02120016
021300     05  FILLER                         PIC X(42).                02130016
021400     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02140016
021500         10  MR-SELECTL                 PIC S9(04) COMP.          02150016
021600         10  MR-SELECTA                 PIC  X(01).               02160016
021700         10  MR-SELECTC                 PIC  X(01).               02170016
021800         10  MR-SELECTH                 PIC  X(01).               02180016
021900         10  MR-SELECTI                 PIC  X(01).               02190016
022000                                                                  02200016
022100         10  MR-ACTIONL                 PIC S9(04) COMP.          02210016
022200         10  MR-ACTIONA                 PIC  X(01).               02220016
022300         10  MR-ACTIONC                 PIC  X(01).               02230016
022400         10  MR-ACTIONH                 PIC  X(01).               02240016
022500         10  MR-ACTION                  PIC  X(03).               02250016
022600                                                                  02260016
022700         10  MR-VENDOR-NAMEL            PIC S9(04) COMP.          02270016
022800         10  MR-VENDOR-NAMEA            PIC  X(01).               02280016
022900         10  MR-VENDOR-NAMEC            PIC  X(01).               02290016
023000         10  MR-VENDOR-NAMEH            PIC  X(01).               02300016
023100         10  MR-VENDOR-NAME             PIC  X(30).               02310016
023200                                                                  02320016
023300         10  MR-FG-CNTL-NUML            PIC S9(04) COMP.          02330016
023400         10  MR-FG-CNTL-NUMA            PIC  X(01).               02340016
023500         10  MR-FG-CNTL-NUMC            PIC  X(01).               02350016
023600         10  MR-FG-CNTL-NUMH            PIC  X(01).               02360016
023700         10  MR-FG-CNTL-NUM             PIC  X(09).               02370016
023800                                                                  02380016
023900         10  MR-TRAN-SETL               PIC S9(04) COMP.          02390016
024000         10  MR-TRAN-SETA               PIC  X(01).               02400016
024100         10  MR-TRAN-SETC               PIC  X(01).               02410016
024200         10  MR-TRAN-SETH               PIC  X(01).               02420016
024300         10  MR-TRAN-SET                PIC  X(03).               02430016
024400                                                                  02440016
024500         10  MR-DAYS-UNACKL             PIC S9(04) COMP.          02450016
024600         10  MR-DAYS-UNACKA             PIC  X(01).               02460016
024700         10  MR-DAYS-UNACKC             PIC  X(01).               02470016
024800         10  MR-DAYS-UNACKH             PIC  X(01).               02480016
024900         10  MR-DAYS-UNACK-X.                                     02490016
025000             15  MR-DAYS-UNACK          PIC  ZZ9.                 02500016
025100                                                                  02510016
025200         10  MR-PO-ACK-STAT-CDL         PIC S9(04) COMP.          02520016
025300         10  MR-PO-ACK-STAT-CDA         PIC  X(01).               02530016
025400         10  MR-PO-ACK-STAT-CDC         PIC  X(01).               02540016
025500         10  MR-PO-ACK-STAT-CDH         PIC  X(01).               02550016
025600         10  MR-PO-ACK-STAT-CD          PIC  X(01).               02560016
025700                                                                  02570016
025800     EJECT                                                        02580016
025900*---------------------------------------------------------------* 02590016
026000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02600016
026100*---------------------------------------------------------------* 02610016
026200                                                                  02620016
026300     COPY DPWS015.                                                02630016
026400                                                                  02640016
026500*---------------------------------------------------------------* 02650016
026600*    DATE / TIME COPYBOOK.                                      * 02660016
026700*---------------------------------------------------------------* 02670016
026800                                                                  02680016
026900     COPY DPWS017.                                                02690016
027000                                                                  02700016
027100*---------------------------------------------------------------* 02710016
027200*    FUNCTION KEYS COPYBOOK.                                    * 02720016
027300*---------------------------------------------------------------* 02730016
027400                                                                  02740016
027500     COPY DPWS016.                                                02750016
027600                                                                  02760016
027700*---------------------------------------------------------------* 02770016
027800*    NUMERIC EDIT LAYOUT.                                       * 02780016
027900*---------------------------------------------------------------* 02790016
028000                                                                  02800016
028100     COPY DPWS010I.                                               02810016
028200 EJECT                                                            02820016
028300*---------------------------------------------------------------* 02830016
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02840019
028500*---------------------------------------------------------------* 02850016
028600                                                                  02860016
028700     COPY DPWS030.                                                02870016
CICS       COPY DPWS930.                                                02871019
028800 EJECT                                                            02880016
028900*---------------------------------------------------------------* 02890016
029000*    STANDARD COMMAREA.                                         * 02900016
029100*---------------------------------------------------------------* 02910016
029200                                                                  02920016
029300     COPY DPWS020.                                                02930016
029400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02940016
029500                                                                  02950016
029600*---------------------------------------------------------------* 02960016
029700*  INTER-APPLICATION COMMAREA.                                    02970016
029800*---------------------------------------------------------------* 02980016
029900                                                                  02990016
030000         10  INTER-APPL-COMM-AREA       PIC X(200).               03000016
030100     COPY ETWS307.                                                03010016
030200*---------------------------------------------------------------* 03020016
030300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03030016
030400*---------------------------------------------------------------* 03040016
030500         10  ASC-SPECIFIC-COMMAREA.                               03050016
030600             15  ASC-TODAYS-DATE-YMD                 PIC 9(06).   03060016
030700             15  ASC-TODAYS-DATE-YYYYMMDD            PIC 9(08).   03070016
030800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03080016
030900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03090016
031000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03100016
031100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03110016
031200                                                                  03120016
031300                 20  ASC-ITEM-ARRAY.                              03130016
031400                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03140016
031500                         30  ASC-LIST-ITEM-NUMBER                 03150016
031600                                                     PIC S9(09)   03160016
031700                                                     COMP-3.      03170016
031800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03180016
031900                             88  ASC-VALID-SELECT    VALUE ' '    03190016
032000                                                           'S'    03200016
032100                                                           'B'    03210016
032200                                                           'E'.   03220016
032300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03230016
032400                             88  ASC-TEMP-SELECT     VALUE 'S'.   03240016
032500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03250016
032600                             88  ASC-TEMP-END        VALUE 'E'.   03260016
032700                         30  ASC-SELECTED-SW    PIC  X(01).       03270016
032800                             88  ASC-NO-SELECT       VALUE ' '.   03280016
032900                             88  ASC-SELECT          VALUE 'S'.   03290016
033000                             88  ASC-BEGIN           VALUE 'B'.   03300016
033100                             88  ASC-END             VALUE 'E'.   03310016
033200                         30  ASC-ACTION         PIC  X(03).       03320016
033300                         30  ASC-TP-DKEY        PIC  S9(9) COMP.  03330016
033400                         30  ASC-TP-DKEY-TMST   PIC  X(26).       03340016
033500                         30  ASC-VENDOR-NAME    PIC X(30).        03350016
033600                         30  ASC-FG-CNTL-NUM    PIC X(09).        03360016
033700                         30  ASC-TRAN-SET       PIC X(03).        03370016
033800                         30  ASC-DAYS-UNACK     PIC 9(03).        03380016
033900                         30  ASC-PO-ACK-STAT-CD PIC X(01).        03390016
034000                                                                  03400016
034100             15  ASC-BLK-SUB                         PIC S9(04)   03410016
034200                                                          COMP    03420016
034300                                                          SYNC.   03430016
034400             15  ASC-ITEM-SUB                        PIC S9(04)   03440016
034500                                                          COMP    03450016
034600                                                          SYNC.   03460016
034700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03470016
034800                                                          COMP-3. 03480016
034900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03490016
035000                                                          COMP-3. 03500016
035100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03510016
035200                                                          COMP-3. 03520016
035300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03530016
035400                                                          COMP-3. 03540016
035500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03550016
035600                                                          COMP-3. 03560016
035700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03570016
035800                                                          COMP    03580016
035900                                                          SYNC.   03590016
036000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03600016
036100                                                          COMP-3. 03610016
036200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03620016
036300                                                          COMP-3. 03630016
036400             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03640016
036500                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03650016
036600                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03660016
036700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03670016
036800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03680016
036900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03690016
037000             15  ASC-LIST-QUEUE-NAME.                             03700016
037100                 20  ASC-LIST-TERM-ID                PIC  X(04).  03710016
037200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03720016
037300                                                          COMP-3. 03730016
037400                 20  ASC-LIST-SEQ                    PIC  9(01).  03740016
037500             15  ASC-SEL-QUEUE-NAME.                              03750016
037600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03760016
037700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03770016
037800                                                          COMP-3. 03780016
037900                 20  ASC-SEL-SEQ                     PIC  9(01).  03790016
038000                                                                  03800016
038100             15  ASC-START-ITEM-REQUEST.                          03810016
038200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03820016
038300             15  ASC-SEL-SUB                 PIC S9(04) COMP.     03830016
038400             15  ASC-SEL-ITEM                PIC S9(04) COMP.     03840016
038500             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05) COMP-3.   03850016
038600**********   15  FILLER                              PIC X(400).  03860016
038700                                                                  03870016
038800*---------------------------------------------------------------* 03880016
038900*    CALENDAR ROUTINE                                             03890016
039000*---------------------------------------------------------------* 03900016
039100                                                                  03910016
039200     COPY DPWS500.                                                03920016
039300                                                                  03930016
039400*---------------------------------------------------------------* 03940016
039500*    ABEND PROCESSING COPYBOOK.                                 * 03950016
039600*---------------------------------------------------------------* 03960016
039700                                                                  03970016
039800     COPY DPWS013.                                                03980016
039900                                                                  03990016
040000 EJECT                                                            04000016
040100*---------------------------------------------------------------* 04010016
040200*    DCLGEN FOR EDI TRANSACTION SET DB                            04020016
040300*---------------------------------------------------------------* 04030016
040400     EXEC SQL                                                     04040016
040500          INCLUDE TENTNME                                         04050016
040600     END-EXEC.                                                    04060016
040700                                                                  04070016
040800*                                                                 04080016
040900*---------------------------------------------------------------* 04090016
041000*    DCLGEN FOR EDI TRADING PARTNERSHIP DB                        04100016
041100*---------------------------------------------------------------* 04110016
041200     EXEC SQL                                                     04120016
041300          INCLUDE TTRDPRT                                         04130016
041400     END-EXEC.                                                    04140016
041500*                                                                 04150016
041600*---------------------------------------------------------------* 04160016
041700*    DCLGEN FOR EDI FUNCTIONAL GROUP DB                           04170016
041800*---------------------------------------------------------------* 04180016
041900     EXEC SQL                                                     04190016
042000          INCLUDE TFGTRST                                         04200016
042100     END-EXEC.                                                    04210016
042200*                                                                 04220016
042300*---------------------------------------------------------------* 04230016
042400*    DB2 AREA FOR COMMUNICATIONS                                * 04240016
042500*---------------------------------------------------------------* 04250016
042600     EXEC SQL                                                     04260016
042700          INCLUDE SQLCA                                           04270016
042800     END-EXEC.                                                    04280016
042900                                                                  04290016
043000*---------------------------------------------------------------* 04300016
043100*  NOTE- THE VALUE 3 WAS HARDCODED INTO THE ORDER BY CLAUSE       04310016
043200*  BECAUSE DB2 DOES NOT ALLOW DATE(TIMESTAMP) TO BE SPECIFIED     04320016
043300*  IN THE ORDER BY CLUASE. THIS IS DONE TO KEEP THE TIME FROM     04330016
043400*  BEING INCLUDED IN THE ORDER BY. IF ADDITIONAL COLUMNS ARE      04340016
043500*  ADDED TO THIS CURSOR, THE FIRST ARGUMENT OF THE ORDER BY       04350016
043600*  MUST STILL POINT TO THE COLUMN DATE(A.TP_DKEY_TMST).           04360016
043700*---------------------------------------------------------------* 04370016
043800     EXEC SQL                                                     04380016
043900         DECLARE  CURSOR_ONE   CURSOR FOR                         04390016
044000         SELECT   TEMP.TP_DKEY,                                   04400016
044100                  TEMP.TP_DKEY_TMST,                              04410016
044200                  DATE (TEMP.TP_DKEY_TMST),                       04420016
044300                  TEMP.FUNC_CDE_CNTL_NBR,                         04430016
044400                  TEMP.TRN_SET_CDE,                               04440016
044500                  C.ENT_NAME_DESC,                                04450016
044600                  TEMP.PO_ACKNL_STAT_CDE                          04460016
044700         FROM    (SELECT DISTINCT                                 04470016
044800                          TP_DKEY,                                04480016
044900                          TP_DKEY_TMST,                           04490016
045000                          FUNC_CDE_CNTL_NBR,                      04500016
045100                          TRN_SET_CDE,                            04510016
045200                          PO_ACKNL_STAT_CDE                       04520016
045300                  FROM    TFGTRST                                 04530016
045400                  WHERE   (TRN_SET_CDE = '850' OR                 04540016
045500                           TRN_SET_CDE = '860')                   04550016
045600                    AND   VEND_ACK_IND = 'N'                      04560016
045700                    AND   DATE(TP_DKEY_TMST) <                    04570016
045800                                     (CURRENT DATE  - 1 DAYS))    04580016
045900                  AS TEMP,                                        04590016
046000                  TTRDPRT B,                                      04600016
046100                  TENTNME C                                       04610016
046200         WHERE                                                    04620016
046300                (TEMP.TP_DKEY = B.TP_DKEY)   AND                  04630016
046400                (B.ENT_ID  = C.ENT_ID)       AND                  04640016
046500                (C.TYPE_CDE = '01')                               04650016
046600         ORDER BY 3 ,                                             04660016
046700                  C.ENT_NAME_DESC                                 04670016
046800     END-EXEC.                                                    04680016
046900                                                                  04690016
047000*---------------------------------------------------------------* 04700016
047100*                                                                 04710016
047200*---------------------------------------------------------------* 04720016
047300     EXEC SQL                                                     04730016
047400         DECLARE  CURSOR_TWO   CURSOR FOR                         04740016
047500         SELECT                                                   04750016
047600                  FUNC_CDE_SEQ_NBR,                               04760016
047700                  TRN_SET_SEQ_NBR                                 04770016
047800         FROM     TFGTRST                                         04780016
047900         WHERE                                                    04790016
048000                (TP_DKEY      =  :FGTRST-TP-DKEY) AND             04800016
048100                (TP_DKEY_TMST =  :FGTRST-TP-DKEY-TMST)            04810016
048200     END-EXEC.                                                    04820016
048300                                                                  04830016
048400                                                                  04840016
048500 EJECT                                                            04850016
048600 LINKAGE SECTION.                                                 04860016
048700                                                                  04870016
048800 01  DFHCOMMAREA.                                                 04880016
048900     05  FILLER                         OCCURS  1 TO 4072 TIMES   04890016
049000                                        DEPENDING ON EIBCALEN.    04900016
049100         10  FILLER                     PIC X.                    04910016
049200                                                                  04920016
049300 EJECT                                                            04930016
049400 PROCEDURE DIVISION.                                              04940016
049500******************************************************************04950016
049600**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04960016
049700**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04970016
049800**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04980016
049900******************************************************************04990016
050000 0000-MAIN-MODULE.                                                05000016
050100     INITIALIZE DP030-CICS-API-FIELDS.                            05010016
050200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05020016
050300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05030016
050400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05040016
050500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05050016
050600     MOVE LENGTH OF ET325AI        TO DP030-MAP-LENGTH (1).       05060016
050700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05070016
050800     PERFORM 0001-CALL-CICS-ARCH-API.                             05080016
050900*                                                                 05090016
051000     PERFORM 1000-CONTROL-PROCESSING                              05100016
051100*                                                                 05110016
051200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05120016
051300     PERFORM 0001-CALL-CICS-ARCH-API.                             05130016
051400                                                                  05140016
051500******************************************************************05150016
051600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05160016
051700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05170016
051800******************************************************************05180016
051900 0001-CALL-CICS-ARCH-API.                                         05190016
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05200019
052100                                    DFHCOMMAREA                   05210019
052200                                    DP030-CICS-API-FIELDS         05220019
052300                                    DP020-STANDARD-COMMAREA       05230019
052400                                    ET325AI.                      05240019
052500*                                                                 05250016
052600     IF  DP030-RC-CALL-SUCCESSFUL                                 05260016
052700         CONTINUE                                                 05270016
052800     ELSE                                                         05280016
052900         SET DP013-NO-ROLLBACK                                    05290016
053000             DP013-XCTL-DISPLAY-RESTART                           05300016
053100             DP013-CICS-ABEND      TO TRUE                        05310016
053200         MOVE '0001-CALL-CICS-ARCH-API'                           05320016
053300                                   TO DP013-PARAGRAPH             05330016
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05340019
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05350019
053600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05360016
053700         PERFORM DP013-0000-PROCESS-ABEND                         05370016
053800     END-IF.                                                      05380016
053900*----------------------------------------------------------------*05390016
054000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05400016
054100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05410016
054200*                                                                *05420016
054300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05430016
054400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05440016
054500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05450016
054600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05460016
054700*----------------------------------------------------------------*05470016
054800                                                                  05480016
054900 1000-CONTROL-PROCESSING.                                         05490016
055000                                                                  05500016
055100     EVALUATE TRUE                                                05510016
055200         WHEN DP020-NEXT-ACT-INITIAL                              05520016
055300             INITIALIZE ASC-SPECIFIC-COMMAREA                     05530016
055400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05540016
055500                                      ASC-SEL-TERM-ID             05550016
055600             MOVE DP020-SRC-TASK-NUMBER                           05560016
055700                                   TO ASC-LIST-TASK-NUMBER        05570016
055800                                      ASC-SEL-TASK-NUMBER         05580016
055900             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               05590016
056000             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                05600016
056100             PERFORM 1100-GET-TODAYS-DATE                         05610016
056200             PERFORM 4000-BUILD-INITIAL-PANEL                     05620016
056300                                                                  05630016
056400         WHEN DP020-NEXT-ACT-READ-MAP                             05640016
056500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05650016
056600                                   TO PV-TOP-ITEM                 05660016
056700             PERFORM 2000-PROCESS-PANEL                           05670016
056800                                                                  05680016
056900         WHEN DP020-NEXT-ACT-RETURN                               05690016
057000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05700016
057100                                   TO PV-TOP-ITEM                 05710016
057200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05720016
057300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05730016
057400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05740016
057500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05750016
057600                                                                  05760016
057700         WHEN OTHER                                               05770016
057800             SET DP013-LOGIC-ABEND TO TRUE                        05780016
057900             SET DP013-NO-ROLLBACK TO TRUE                        05790016
058000             MOVE '1000-CONTROL-PROCESSING'                       05800016
058100                                   TO DP013-PARAGRAPH             05810016
058200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05820016
058300                                   TO DP013-MESSAGE-TEXT(1)       05830016
058400             PERFORM DP013-0000-PROCESS-ABEND                     05840016
058500     END-EVALUATE.                                                05850016
058600                                                                  05860016
058700 EJECT                                                            05870016
058800                                                                  05880016
058900*----------------------------------------------------------------*05890016
059000*----------------------------------------------------------------*05900016
059100                                                                  05910016
059200 1100-GET-TODAYS-DATE.                                            05920016
059300                                                                  05930016
059400     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       05940016
059500     MOVE DP017-CURRENT-DATE-YMD      TO ASC-TODAYS-DATE-YMD.     05950016
059600     MOVE DP017-CURRENT-DATE-YYYYMMDD TO ASC-TODAYS-DATE-YYYYMMDD.05960016
059700                                                                  05970016
059800*----------------------------------------------------------------*05980016
059900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05990016
060000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06000016
060100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06010016
060200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06020016
060300* FUNCTION KEYS CAN GET THIS FAR.                                *06030016
060400*----------------------------------------------------------------*06040016
060500                                                                  06050016
060600 2000-PROCESS-PANEL.                                              06060016
060700     EVALUATE TRUE                                                06070016
060800         WHEN DP020-SRC-AID = DP016-CLEAR                         06080016
060900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06090016
061000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06100016
061100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06110016
061200                                                                  06120016
061300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06130016
061400             PERFORM 2050-DELETE-LIST-QUEUE                       06140016
061500             PERFORM 4000-BUILD-INITIAL-PANEL                     06150016
061600                                                                  06160016
061700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06170016
061800             PERFORM 2140-DESELECT-ALL-ITEMS                      06180016
061900             PERFORM 3200-RESET-ATTRIBUTES                        06190016
062000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06200016
062100                                                                  06210016
062200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06220016
062300             PERFORM 2150-SELECT-ALL-ITEMS                        06230016
062400             PERFORM 3200-RESET-ATTRIBUTES                        06240016
062500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06250016
062600                                                                  06260016
062700         WHEN OTHER                                               06270016
062800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06280016
062900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06290016
063000             IF  PS-NO-ERROR                                      06300016
063100                 SET DP030-CONTINUE-GO TO TRUE                    06310016
063200                 PERFORM 2100-CHECK-FUNCTION-KEY                  06320016
063300             ELSE                                                 06330016
063400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06340016
063500                 SET DP030-OVERRIDE-GO TO TRUE                    06350016
063600             END-IF                                               06360016
063700     END-EVALUATE.                                                06370016
063800 EJECT                                                            06380016
063900*----------------------------------------------------------------*06390016
064000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06400016
064100*----------------------------------------------------------------*06410016
064200 2050-DELETE-LIST-QUEUE.                                          06420016
064300                                                                  06430016
064400     EXEC CICS                                                    06440016
064500         DELETEQ TS                                               06450016
064600             QUEUE (ASC-LIST-QUEUE-NAME)                          06460016
064700             RESP  (PV-CICS-RESP)                                 06470016
064800     END-EXEC.                                                    06480016
064900                                                                  06490016
065000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06500016
065100        (PV-CICS-RESP = DFHRESP(QIDERR))                          06510016
065200         CONTINUE                                                 06520016
065300     ELSE                                                         06530016
065400         SET DP013-CICS-ABEND      TO TRUE                        06540016
065500         SET DP013-NO-ROLLBACK     TO TRUE                        06550016
065600                                                                  06560016
065700         MOVE '2050-DELETE-LIST-QUEUE'                            06570016
065800                                   TO DP013-PARAGRAPH             06580016
065900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06590016
066000                                   TO DP013-MESSAGE-TEXT (1)      06600016
066100         PERFORM DP013-0000-PROCESS-ABEND                         06610016
066200     END-IF.                                                      06620016
066300                                                                  06630016
066400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06640016
066500 EJECT                                                            06650016
066600*----------------------------------------------------------------*06660016
066700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06670016
066800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06680016
066900* CICS ARCHITECTURE API.                                         *06690016
067000*----------------------------------------------------------------*06700016
067100 2100-CHECK-FUNCTION-KEY.                                         06710016
067200     EVALUATE TRUE                                                06720016
067300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06730016
067400             IF DP020-SRC-AID = DP016-PF15                        06740016
067500                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          06750016
067600                     PERFORM 5000-PREPARE-SEL-QUEUE               06760016
067700                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            06770016
067800                                TO ASC-NUMBER-OF-TS-ITEMS         06780016
067900                                                                  06790016
068000                     MOVE ET308-MAX-ITEMS TO ASC-SEL-SUB          06800016
068100                     MOVE ZERO TO ASC-SEL-ITEM                    06810016
068200                     PERFORM 2145-GET-NEXT-ITEM                   06820016
068300                         ASC-NUMBER-OF-SELECTED-ITEMS TIMES       06830016
068400                                                                  06840016
068500                     MOVE ZERO     TO ASC-ITEM-AT-TOP-OF-PANEL    06850016
068600                     PERFORM 6000-REFRESH-PANEL-FROM-TEMP         06860016
068700                     PERFORM 3000-EDIT-DATA-IN-COMMAREA           06870016
068800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06880016
068900                                                                  06890016
069000                     SET DP020-MSG-INFORMATIONAL TO TRUE          06900016
069100                     MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER    06910016
069200                 ELSE                                             06920016
069300                     SET DP030-OVERRIDE-GO                        06930016
069400                         DP020-MSG-WARNING TO TRUE                06940016
069500                     MOVE PC-TSYMSG-00057                         06950016
069600                                       TO DP020-MSG-NUMBER        06960016
069700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06970016
069800                 END-IF                                           06980016
069900             ELSE                                                 06990016
070000                 SET DP013-NO-ROLLBACK                            07000016
070100                     DP013-XCTL-DISPLAY-RESTART                   07010016
070200                     DP013-CICS-ABEND  TO TRUE                    07020016
070300                 MOVE '2100-CHECK-FUNCTION-KEY'                   07030016
070400                                       TO DP013-PARAGRAPH         07040016
070500                 MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'  07050016
070600                                       TO DP013-MESSAGE-TEXT (1)  07060016
070700                 PERFORM DP013-0000-PROCESS-ABEND                 07070016
070800             END-IF                                               07080016
070900                                                                  07090016
071000         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  07100016
071100             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07110016
071200                 INITIALIZE ET307-INTER-APPL-COMMAREA             07120016
071300                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07130016
071400                                TO ET307-NUMBER-OF-SELECTED-ITEMS 07140016
071500                 PERFORM 5000-PREPARE-SEL-QUEUE                   07150016
071600             ELSE                                                 07160016
071700                 SET DP030-OVERRIDE-GO                            07170016
071800                                   TO TRUE                        07180016
071900*                ---- A LIST ITEM MUST BE SELECTED ----           07190016
072000                 MOVE PC-TSYMSG-00057                             07200016
072100                                   TO DP020-MSG-NUMBER            07210016
072200                 SET DP020-MSG-WARNING                            07220016
072300                                   TO TRUE                        07230016
072400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07240016
072500             END-IF                                               07250016
072600                                                                  07260016
072700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07270016
072800             MOVE +1               TO PV-TOP-ITEM                 07280016
072900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07290016
073000                                                                  07300016
073100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07310016
073200             PERFORM 2110-BROWSE-BACKWARD                         07320016
073300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07330016
073400                                                                  07340016
073500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07350016
073600             PERFORM 2120-BROWSE-FORWARD                          07360016
073700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07370016
073800                                                                  07380016
073900         WHEN DP020-SRC-AID = DP016-ENTER                         07390016
074000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07400016
074100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07410016
074200                                                                  07420016
074300         WHEN OTHER                                               07430016
074400             SET DP013-NO-ROLLBACK                                07440016
074500                 DP013-XCTL-DISPLAY-RESTART                       07450016
074600                 DP013-CICS-ABEND  TO TRUE                        07460016
074700             MOVE '2100-CHECK-FUNCTION-KEY'                       07470016
074800                                   TO DP013-PARAGRAPH             07480016
074900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07490016
075000                                   TO DP013-MESSAGE-TEXT (1)      07500016
075100             PERFORM DP013-0000-PROCESS-ABEND                     07510016
075200     END-EVALUATE.                                                07520016
075300                                                                  07530016
075400*----------------------------------------------------------------*07540016
075500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07550016
075600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07560016
075700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07570016
075800*    MESSAGE.                                                    *07580016
075900*----------------------------------------------------------------*07590016
076000                                                                  07600016
076100 2110-BROWSE-BACKWARD.                                            07610016
076200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07620016
076300         GIVING PV-TOP-ITEM.                                      07630016
076400*                                                                 07640016
076500     IF  ((PV-TOP-ITEM < +1)                                      07650016
076600       OR (PV-TOP-ITEM = +1))                                     07660016
076700         MOVE +1                   TO PV-TOP-ITEM                 07670016
076800*        -- TOP OF LIST --                                        07680016
076900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07690016
077000         SET DP020-MSG-INFORMATIONAL TO TRUE                      07700016
077100     END-IF.                                                      07710016
077200                                                                  07720016
077300 EJECT                                                            07730016
077400*----------------------------------------------------------------*07740016
077500*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07750016
077600*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07760016
077700*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07770016
077800*----------------------------------------------------------------*07780016
077900                                                                  07790016
078000 2120-BROWSE-FORWARD.                                             07800016
078100                                                                  07810016
078200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07820016
078300         GIVING PV-TOP-ITEM.                                      07830016
078400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07840016
078500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07850016
078600                                   TO PV-TOP-ITEM                 07860016
078700*        -- BOTTOM OF LIST --                                     07870016
078800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07880016
078900         SET DP020-MSG-INFORMATIONAL                              07890016
079000                                   TO TRUE                        07900016
079100     ELSE                                                         07910016
079200         COMPUTE PV-BOTTOM-ITEM =                                 07920016
079300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07930016
079400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07940016
079500*            -- BOTTOM OF LIST --                                 07950016
079600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07960016
079700             SET DP020-MSG-INFORMATIONAL                          07970016
079800                                   TO TRUE                        07980016
079900         END-IF                                                   07990016
080000     END-IF.                                                      08000016
080100 EJECT                                                            08010016
080200*----------------------------------------------------------------*08020016
080300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08030016
080400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08040016
080500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08050016
080600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08060016
080700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08070016
080800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08080016
080900*----------------------------------------------------------------*08090016
081000                                                                  08100016
081100 2130-CHECK-FOR-JUMP-BROWSE.                                      08110016
081200     IF (ASC-START-ITEM-REQUEST = SPACE)                          08120016
081300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08130016
081400                                   TO PV-TOP-ITEM                 08140016
081500     ELSE                                                         08150016
081600         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    08160016
081700         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    08170016
081800         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  08180016
081900         SET DP010I-NEGATIVE-NOT-ALLOWED                          08190016
082000                                   TO TRUE                        08200016
082110         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08211017
082120                         USING DP010I-NUMERIC-EDIT-AREA           08212017
082200                                                                  08220016
082300         IF  NOT DP010I-ERROR-DETECTED                            08230016
082400             MOVE DP010I-NUMERIC-FIELD                            08240016
082500                                   TO  ASC-START-ITEM-REQUEST-N   08250016
082600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08260016
082700                 IF  ASC-START-ITEM-REQUEST-N >                   08270016
082800                                          ASC-NUMBER-OF-ITEMS-READ08280016
082900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08290016
083000                     COMPUTE PV-TOP-ITEM =                        08300016
083100                             ASC-NUMBER-OF-ITEMS-READ             08310016
083200                             - PC-ITEMS-PER-PANEL + 1             08320016
083300                     IF  PV-TOP-ITEM < +1                         08330016
083400                         MOVE +1   TO PV-TOP-ITEM                 08340016
083500*                        ---- BOTTOM OF LIST ----                 08350016
083600                         MOVE PC-TSYMSG-00070                     08360016
083700                                   TO DP020-MSG-NUMBER            08370016
083800                         SET DP020-MSG-INFORMATIONAL              08380016
083900                                   TO TRUE                        08390016
084000                     END-IF                                       08400016
084100                 ELSE                                             08410016
084200                     MOVE ASC-START-ITEM-REQUEST-N                08420016
084300                                   TO PV-TOP-ITEM                 08430016
084400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08440016
084500                     COMPUTE PV-BOTTOM-ITEM =                     08450016
084600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08460016
084700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08470016
084800*                        -- BOTTOM OF LIST --                     08480016
084900                         MOVE PC-TSYMSG-00070                     08490016
085000                                   TO DP020-MSG-NUMBER            08500016
085100                         SET DP020-MSG-INFORMATIONAL              08510016
085200                                   TO TRUE                        08520016
085300                     END-IF                                       08530016
085400                 END-IF                                           08540016
085500             ELSE                                                 08550016
085600*                --- VALUE OUT OF RANGE ----                      08560016
085700                 MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER     08570016
085800                 MOVE -1                  TO ASTRTITL             08580016
085900                 SET DP030-SET-CURSOR-APPL-1                      08590016
086000                                          TO TRUE                 08600016
086100                 MOVE DP015-REVERSE       TO ASTRTITH             08610016
086200                 MOVE DP015-RED           TO ASTRTITC             08620016
086300                 MOVE DP015-UNP-NUM-BRT-OFF                       08630016
086400                                          TO ASTRTITA             08640016
086500                 SET DP020-MSG-FATAL      TO TRUE                 08650016
086600                 SET PS-START-ITEM-ERROR TO TRUE                  08660016
086700             END-IF                                               08670016
086800                                                                  08680016
086900         ELSE                                                     08690016
087000*            ---- MUST BE NUMERIC ----                            08700016
087100             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      08710016
087200             MOVE -1                     TO ASTRTITL              08720016
087300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08730016
087400             MOVE DP015-REVERSE          TO ASTRTITH              08740016
087500             MOVE DP015-RED              TO ASTRTITC              08750016
087600             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              08760016
087700             SET DP020-MSG-FATAL         TO TRUE                  08770016
087800             SET PS-START-ITEM-ERROR     TO TRUE                  08780016
087900         END-IF                                                   08790016
088000     END-IF.                                                      08800016
088100 EJECT                                                            08810016
088200*----------------------------------------------------------------*08820016
088300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08830016
088400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08840016
088500*----------------------------------------------------------------*08850016
088600 2140-DESELECT-ALL-ITEMS.                                         08860016
088700     MOVE +1                       TO ASC-BLK-SUB.                08870016
088800                                                                  08880016
088900     PERFORM 2141-CLEAR-SELECTED-INDS                             08890016
089000         VARYING ASC-ITEM-SUB                                     08900016
089100         FROM 1 BY 1                                              08910016
089200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08920016
089300                                                                  08930016
089400     ADD +1                        TO ASC-BLK-SUB.                08940016
089500                                                                  08950016
089600     PERFORM 2141-CLEAR-SELECTED-INDS                             08960016
089700         VARYING ASC-ITEM-SUB                                     08970016
089800         FROM 1 BY 1                                              08980016
089900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08990016
090000                                                                  09000016
090100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09010016
090200                                   TO PV-LIST-ITEM-NUMBER.        09020016
090300                                                                  09030016
090400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09040016
090500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09050016
090600                                                                  09060016
090700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09070016
090800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09080016
090900         MOVE +1                   TO ASC-BLK-SUB                 09090016
091000                                                                  09100016
091100         PERFORM 5100-WRITE-TEMP-STORAGE                          09110016
091200                                                                  09120016
091300         MOVE +1                   TO PV-BLOCK-NUMBER             09130016
091400                                                                  09140016
091500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09150016
091600             PV-FIRST-BLOCK-IN-ARRAY - 1                          09160016
091700                                                                  09170016
091800         PERFORM                                                  09180016
091900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09190016
092000                                                                  09200016
092100             PERFORM 4410-READ-TEMP-STORAGE                       09210016
092200                                                                  09220016
092300             PERFORM 2141-CLEAR-SELECTED-INDS                     09230016
092400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09240016
092500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09250016
092600                                                                  09260016
092700             PERFORM 5100-WRITE-TEMP-STORAGE                      09270016
092800                                                                  09280016
092900             ADD +1                TO PV-BLOCK-NUMBER             09290016
093000                                                                  09300016
093100         END-PERFORM                                              09310016
093200                                                                  09320016
093300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09330016
093400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09340016
093500                                                                  09350016
093600         PERFORM                                                  09360016
093700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09370016
093800                   ASC-HIGHEST-BLOCK-WRITTEN                      09380016
093900                                                                  09390016
094000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09400016
094100                                   TO PV-BLOCK-NUMBER             09410016
094200                                                                  09420016
094300             PERFORM 4410-READ-TEMP-STORAGE                       09430016
094400                                                                  09440016
094500             PERFORM 2141-CLEAR-SELECTED-INDS                     09450016
094600                 VARYING ASC-ITEM-SUB                             09460016
094700                 FROM 1 BY 1                                      09470016
094800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09480016
094900                                                                  09490016
095000             PERFORM 5100-WRITE-TEMP-STORAGE                      09500016
095100                                                                  09510016
095200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09520016
095300                                                                  09530016
095400         END-PERFORM                                              09540016
095500                                                                  09550016
095600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09560016
095700                                   TO PV-BLOCK-NUMBER             09570016
095800                                                                  09580016
095900         PERFORM 4410-READ-TEMP-STORAGE                           09590016
096000     END-IF.                                                      09600016
096100                                                                  09610016
096200                                                                  09620016
096300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09630016
096400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09640016
096500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09650016
096600                                                                  09660016
096700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09670016
096800                                                                  09680016
096900 EJECT                                                            09690016
097000*----------------------------------------------------------------*09700016
097100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09710016
097200*----------------------------------------------------------------*09720016
097300                                                                  09730016
097400 2141-CLEAR-SELECTED-INDS.                                        09740016
097500                                                                  09750016
097600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09760016
097700             NOT EQUAL ZERO                                       09770016
097800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09780016
097900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09790016
098000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09800016
098100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09810016
098200                                   TO TRUE                        09820016
098300         END-IF                                                   09830016
098400     END-IF.                                                      09840016
098500                                                                  09850016
098600 EJECT                                                            09860016
098700                                                                  09870016
098800******************************************************************09880016
098900** GET THE NEXT ITEM THE LIST QUEUE.                              09890016
099000******************************************************************09900016
099100 2145-GET-NEXT-ITEM.                                              09910016
099200     ADD +1                       TO ASC-SEL-SUB.                 09920016
099300     IF  ASC-SEL-SUB > ET308-MAX-ITEMS                            09930016
099400         ADD +1                   TO ASC-SEL-ITEM                 09940016
099500         MOVE +1                  TO ASC-SEL-SUB                  09950016
099600     END-IF.                                                      09960016
099700     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 09970016
099800         PERFORM 9100-READ-SEL-QUEUE                              09980016
099900         IF  ET308-ITEM (ASC-SEL-SUB) > ZERO                      09990016
100000                                                                  10000016
100100             MOVE ET308-TP-DKEY (ASC-SEL-SUB)   TO FGTRST-TP-DKEY 10010016
100200             MOVE ET308-TP-DKEY-TMST  (ASC-SEL-SUB)               10020016
100300                                     TO FGTRST-TP-DKEY-TMST       10030016
100400             PERFORM 8000-UPDATE-ACK-IND                          10040016
100500             SET ET308-UPD (ASC-SEL-SUB) TO TRUE                  10050016
100600             PERFORM 9200-REWRITE-SEL-QUEUE                       10060016
100700         ELSE                                                     10070016
100800             SUBTRACT +1 FROM ASC-SEL-SUB                         10080016
100900*            ---- BOTTOM OF LIST ----                             10090016
101000             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             10100016
101100             SET DP020-MSG-INFORMATIONAL TO TRUE                  10110016
101200         END-IF                                                   10120016
101300     ELSE                                                         10130016
101400         SUBTRACT +1 FROM ASC-SEL-ITEM                            10140016
101500         MOVE ET308-MAX-ITEMS     TO ASC-SEL-SUB                  10150016
101600*        ---- BOTTOM OF LIST ----                                 10160016
101700         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             10170016
101800         SET DP020-MSG-INFORMATIONAL TO TRUE                      10180016
101900     END-IF.                                                      10190016
102000                                                                  10200016
102100*----------------------------------------------------------------*10210016
102200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10220016
102300*  FOR ALL ITEMS.                                                *10230016
102400*----------------------------------------------------------------*10240016
102500 2150-SELECT-ALL-ITEMS.                                           10250016
102600                                                                  10260016
102700     MOVE +1                       TO ASC-BLK-SUB.                10270016
102800                                                                  10280016
102900     PERFORM 2151-SET-SELECTED-INDS                               10290016
103000         VARYING ASC-ITEM-SUB                                     10300016
103100         FROM 1 BY 1                                              10310016
103200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10320016
103300                                                                  10330016
103400     ADD +1                        TO ASC-BLK-SUB.                10340016
103500                                                                  10350016
103600     PERFORM 2151-SET-SELECTED-INDS                               10360016
103700         VARYING ASC-ITEM-SUB                                     10370016
103800         FROM 1 BY 1                                              10380016
103900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10390016
104000                                                                  10400016
104100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10410016
104200                                   TO PV-LIST-ITEM-NUMBER.        10420016
104300                                                                  10430016
104400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10440016
104500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10450016
104600                                                                  10460016
104700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10470016
104800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10480016
104900         MOVE +1                   TO ASC-BLK-SUB                 10490016
105000                                                                  10500016
105100         PERFORM 5100-WRITE-TEMP-STORAGE                          10510016
105200                                                                  10520016
105300         MOVE +1                   TO PV-BLOCK-NUMBER             10530016
105400                                                                  10540016
105500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10550016
105600             PV-FIRST-BLOCK-IN-ARRAY - 1                          10560016
105700                                                                  10570016
105800         PERFORM                                                  10580016
105900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10590016
106000                                                                  10600016
106100             PERFORM 4410-READ-TEMP-STORAGE                       10610016
106200                                                                  10620016
106300             PERFORM 2151-SET-SELECTED-INDS                       10630016
106400                 VARYING ASC-ITEM-SUB                             10640016
106500                 FROM 1 BY 1                                      10650016
106600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10660016
106700                                                                  10670016
106800             PERFORM 5100-WRITE-TEMP-STORAGE                      10680016
106900                                                                  10690016
107000             ADD +1                TO PV-BLOCK-NUMBER             10700016
107100                                                                  10710016
107200         END-PERFORM                                              10720016
107300                                                                  10730016
107400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10740016
107500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10750016
107600                                                                  10760016
107700         PERFORM                                                  10770016
107800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10780016
107900                   ASC-HIGHEST-BLOCK-WRITTEN                      10790016
108000                                                                  10800016
108100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10810016
108200                                   TO PV-BLOCK-NUMBER             10820016
108300                                                                  10830016
108400             PERFORM 4410-READ-TEMP-STORAGE                       10840016
108500                                                                  10850016
108600             PERFORM 2151-SET-SELECTED-INDS                       10860016
108700                 VARYING ASC-ITEM-SUB                             10870016
108800                 FROM 1 BY 1                                      10880016
108900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10890016
109000                                                                  10900016
109100             PERFORM 5100-WRITE-TEMP-STORAGE                      10910016
109200                                                                  10920016
109300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10930016
109400                                                                  10940016
109500         END-PERFORM                                              10950016
109600                                                                  10960016
109700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10970016
109800                                   TO PV-BLOCK-NUMBER             10980016
109900                                                                  10990016
110000         PERFORM 4410-READ-TEMP-STORAGE                           11000016
110100     END-IF.                                                      11010016
110200                                                                  11020016
110300                                                                  11030016
110400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11040016
110500                       ASC-NUMBER-OF-SELECTED-ITEMS.              11050016
110600                                                                  11060016
110700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11070016
110800                                                                  11080016
110900 EJECT                                                            11090016
111000*----------------------------------------------------------------*11100016
111100*    MARK EACH ITEM AS BEING SELECTED.                           *11110016
111200*----------------------------------------------------------------*11120016
111300                                                                  11130016
111400 2151-SET-SELECTED-INDS.                                          11140016
111500                                                                  11150016
111600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11160016
111700             NOT EQUAL ZERO                                       11170016
111800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11180016
111900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11190016
112000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11200016
112100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11210016
112200                               TO  TRUE                           11220016
112300         END-IF                                                   11230016
112400     END-IF.                                                      11240016
112500                                                                  11250016
112600                                                                  11260016
112700******************************************************************11270016
112800** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11280016
112900** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **11290016
113000******************************************************************11300016
113100 2200-MOVE-SCREEN-TO-COMMAREA.                                    11310016
113200                                                                  11320016
113300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11330016
113400     MOVE +1                       TO PV-SUB.                     11340016
113500*                                                                 11350016
113600     PERFORM 3100-SET-SUBSCRIPTS.                                 11360016
113700     IF  ASTRTITL > ZERO                                          11370016
113800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11380016
113900     ELSE                                                         11390016
114000         IF ASTRTITF = DP015-ERASE-EOF                            11400016
114100             MOVE SPACE TO ASC-START-ITEM-REQUEST                 11410016
114200         END-IF.                                                  11420016
114300                                                                  11430016
114400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11440016
114500         VARYING PV-SUB                                           11450016
114600         FROM 1 BY 1                                              11460016
114700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11470016
114800******************************************************************11480016
114900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**11490016
115000******************************************************************11500016
115100 2210-MOVE-LINES-TO-COMMAREA.                                     11510016
115200     IF  MR-SELECTL (PV-SUB) > ZERO                               11520016
115300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11530016
115400         MOVE MR-SELECTI (PV-SUB)                                 11540016
115500                                   TO ASC-TEMP-SELECTED-SW        11550016
115600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11560016
115700     ELSE                                                         11570016
115800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11580016
115900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11590016
116000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11600016
116100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11610016
116200         END-IF                                                   11620016
116300     END-IF.                                                      11630016
116400     ADD +1                        TO ASC-ITEM-SUB.               11640016
116500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11650016
116600         ADD +1                    TO ASC-BLK-SUB                 11660016
116700         MOVE +1                   TO ASC-ITEM-SUB                11670016
116800     END-IF.                                                      11680016
116900******************************************************************11690016
117000** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **11700016
117100** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **11710016
117200******************************************************************11720016
117300 3000-EDIT-DATA-IN-COMMAREA.                                      11730016
117400     SET PS-NO-ERROR               TO TRUE.                       11740016
117500     PERFORM 3200-RESET-ATTRIBUTES.                               11750016
117600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11760016
117700**                                                                11770016
117800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11780016
117900* EDITTING IS DONE FROM THE BOTTOM UP.                            11790016
118000**                                                                11800016
118100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11810016
118200         ASC-ITEMS-DISPLAYED - 1.                                 11820016
118300     PERFORM 3100-SET-SUBSCRIPTS.                                 11830016
118400     PERFORM 3300-EDIT-SELECTIONS                                 11840016
118500         VARYING PV-SUB                                           11850016
118600         FROM PV-SUB BY -1                                        11860016
118700         UNTIL PV-SUB < +1                                        11870016
118800*                                                                 11880016
118900     IF  PS-NO-ERROR                                              11890016
119000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11900016
119100     END-IF.                                                      11910016
119200*                                                                 11920016
119300     IF  ((PS-NO-ERROR)                                           11930016
119400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11940016
119500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11950016
119600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11960016
119700     END-IF.                                                      11970016
119800 EJECT                                                            11980016
119900*----------------------------------------------------------------*11990016
120000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12000016
120100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12010016
120200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12020016
120300*                                                                *12030016
120400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12040016
120500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12050016
120600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12060016
120700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12070016
120800*----------------------------------------------------------------*12080016
120900                                                                  12090016
121000 3100-SET-SUBSCRIPTS.                                             12100016
121100                                                                  12110016
121200     COMPUTE ASC-ITEM-SUB =                                       12120016
121300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12130016
121400                                                                  12140016
121500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12150016
121600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12160016
121700                                                                  12170016
121800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12180016
121900     ELSE                                                         12190016
122000         MOVE +1                     TO ASC-BLK-SUB               12200016
122100     END-IF.                                                      12210016
122200******************************************************************12220016
122300** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12230016
122400******************************************************************12240016
122500                                                                  12250016
122600 3200-RESET-ATTRIBUTES.                                           12260016
122700     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   12270016
122800     MOVE DP015-GREEN              TO ASTRTITC.                   12280016
122900     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12290016
123000*                                                                 12300016
123100     PERFORM                                                      12310016
123200         VARYING PV-SUB                                           12320016
123300         FROM 1 BY 1                                              12330016
123400         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12340016
123500         MOVE DP015-UNP-ALP-NOR-OFF                               12350016
123600                                   TO MR-SELECTA (PV-SUB)         12360016
123700         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         12370016
123800         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         12380016
123900         MOVE DP015-BLUE           TO MR-ACTIONC (PV-SUB)         12390016
124000                                      MR-VENDOR-NAMEC (PV-SUB)    12400016
124100                                      MR-FG-CNTL-NUMC  (PV-SUB)   12410016
124200                                      MR-TRAN-SETC     (PV-SUB)   12420016
124300                                      MR-DAYS-UNACKC   (PV-SUB)   12430016
124400                                      MR-PO-ACK-STAT-CDC (PV-SUB) 12440016
124500     END-PERFORM.                                                 12450016
124600******************************************************************12460016
124700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12470016
124800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12480016
124900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12490016
125000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12500016
125100******************************************************************12510016
125200 3300-EDIT-SELECTIONS.                                            12520016
125300     EVALUATE TRUE                                                12530016
125400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12540016
125500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12550016
125600                 CONTINUE                                         12560016
125700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12570016
125800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12580016
125900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12590016
126000                 MOVE ASC-TEMP-SELECTED-SW                        12600016
126100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12610016
126200                                TO ASC-SELECTED-SW                12620016
126300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12630016
126400             END-IF                                               12640016
126500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12650016
126600                 = SPACE                                          12660016
126700             EVALUATE TRUE                                        12670016
126800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12680016
126900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12690016
127000                     MOVE SPACE TO ASC-SELECTED-SW                12700016
127100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12710016
127200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12720016
127300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12730016
127400                     MOVE SPACE TO ASC-SELECTED-SW                12740016
127500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12750016
127600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12760016
127700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12770016
127800                     MOVE SPACE TO ASC-SELECTED-SW                12780016
127900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12790016
128000             END-EVALUATE                                         12800016
128100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12810016
128200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12820016
128300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12830016
128400             END-IF                                               12840016
128500             PERFORM 3310-EDIT-RANGE                              12850016
128600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12860016
128700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12870016
128800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12880016
128900             END-IF                                               12890016
129000             PERFORM 3310-EDIT-RANGE                              12900016
129100         WHEN OTHER                                               12910016
129200*            ---- INVALID VALUE ----                              12920016
129300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           12930016
129400             SET DP020-MSG-FATAL    TO TRUE                       12940016
129500             MOVE -1                TO MR-SELECTL (PV-SUB)        12950016
129600             SET DP030-SET-CURSOR-APPL-1                          12960016
129700                                    TO TRUE                       12970016
129800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        12980016
129900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        12990016
130000             SET PS-ERROR TO TRUE                                 13000016
130100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13010016
130200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13020016
130300                 MOVE SPACE         TO ASC-SELECTED-SW            13030016
130400                                        (ASC-BLK-SUB ASC-ITEM-SUB)13040016
130500             END-IF                                               13050016
130600     END-EVALUATE.                                                13060016
130700                                                                  13070016
130800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13080016
130900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13090016
131000     IF  ASC-ITEM-SUB < 1                                         13100016
131100         SUBTRACT +1 FROM ASC-BLK-SUB                             13110016
131200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13120016
131300     END-IF.                                                      13130016
131400******************************************************************13140016
131500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13150016
131600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13160016
131700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13170016
131800** THE ENDING.                                                  **13180016
131900******************************************************************13190016
132000 3310-EDIT-RANGE.                                                 13200016
132100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13210016
132200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13220016
132300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13230016
132400                                   TO ASC-SELECTED-SW             13240016
132500                                        (ASC-BLK-SUB ASC-ITEM-SUB)13250016
132600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13260016
132700         ELSE                                                     13270016
132800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13280016
132900                 CONTINUE                                         13290016
133000             ELSE                                                 13300016
133100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13310016
133200                 MOVE PC-TSYMSG-00054                             13320016
133300                                   TO DP020-MSG-NUMBER            13330016
133400                 SET DP020-MSG-FATAL                              13340016
133500                                   TO TRUE                        13350016
133600                 MOVE -1           TO MR-SELECTL (PV-SUB)         13360016
133700                 SET DP030-SET-CURSOR-APPL-1                      13370016
133800                                   TO TRUE                        13380016
133900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13390016
134000                 MOVE DP015-UNDERLINE                             13400016
134100                                   TO MR-SELECTH (PV-SUB)         13410016
134200                 SET PS-ERROR      TO TRUE                        13420016
134300             END-IF                                               13430016
134400         END-IF                                                   13440016
134500     ELSE                                                         13450016
134600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13460016
134700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13470016
134800                                   TO ASC-SELECTED-SW             13480016
134900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13490016
135000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13500016
135100         ELSE                                                     13510016
135200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13520016
135300                 CONTINUE                                         13530016
135400             ELSE                                                 13540016
135500*                -- ONLY ONE END-OF-RANGE ALLOWED --              13550016
135600                 MOVE PC-TSYMSG-00055                             13560016
135700                                   TO DP020-MSG-NUMBER            13570016
135800                 SET DP020-MSG-FATAL                              13580016
135900                                   TO TRUE                        13590016
136000                 MOVE -1           TO MR-SELECTL (PV-SUB)         13600016
136100                 SET DP030-SET-CURSOR-APPL-1                      13610016
136200                                   TO TRUE                        13620016
136300                 SET PS-ERROR      TO TRUE                        13630016
136400             END-IF                                               13640016
136500         END-IF                                                   13650016
136600     END-IF.                                                      13660016
136700*                                                                 13670016
136800******************************************************************13680016
136900** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **13690016
137000** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **13700016
137100******************************************************************13710016
137200 3400-CHECK-RANGE-SEQUENCE.                                       13720016
137300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13730016
137400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13740016
137500       AND  ASC-START-OF-SELECTED-RANGE >                         13750016
137600                                         ASC-END-OF-SELECTED-RANGE13760016
137700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13770016
137800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13780016
137900         SET DP020-MSG-FATAL TO TRUE                              13790016
138000         SET PS-ERROR TO TRUE                                     13800016
138100         PERFORM 3410-POSITION-AT-ERROR                           13810016
138200     ELSE                                                         13820016
138300         MOVE -1 TO MR-SELECTL (1)                                13830016
138400     END-IF.                                                      13840016
138500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       13850016
138600                                                                  13860016
138700                                                                  13870016
138800******************************************************************13880016
138900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **13890016
139000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **13900016
139100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **13910016
139200******************************************************************13920016
139300 3410-POSITION-AT-ERROR.                                          13930016
139400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13940016
139500                    - PV-TOP-ITEM + 1.                            13950016
139600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13960016
139700         CONTINUE                                                 13970016
139800     ELSE                                                         13980016
139900         MOVE -1                   TO MR-SELECTL (PV-SUB)         13990016
140000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14000016
140100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14010016
140200     END-IF.                                                      14020016
140300*                                                                 14030016
140400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14040016
140500                    - PV-TOP-ITEM + 1.                            14050016
140600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14060016
140700         CONTINUE                                                 14070016
140800     ELSE                                                         14080016
140900         MOVE -1                   TO MR-SELECTL (PV-SUB)         14090016
141000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14100016
141100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14110016
141200     END-IF.                                                      14120016
141300 EJECT                                                            14130016
141400*----------------------------------------------------------------*14140016
141500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14150016
141600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14160016
141700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14170016
141800*----------------------------------------------------------------*14180016
141900                                                                  14190016
142000 3500-MARK-RANGE-AS-SELECTED.                                     14200016
142100     MOVE +1                       TO  ASC-BLK-SUB.               14210016
142200     PERFORM 3510-MARK-SELECTED-INDS                              14220016
142300         VARYING ASC-ITEM-SUB                                     14230016
142400         FROM 1 BY 1                                              14240016
142500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14250016
142600                                                                  14260016
142700     ADD +1                        TO ASC-BLK-SUB.                14270016
142800     PERFORM 3510-MARK-SELECTED-INDS                              14280016
142900         VARYING ASC-ITEM-SUB                                     14290016
143000         FROM 1 BY 1                                              14300016
143100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14310016
143200                                                                  14320016
143300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14330016
143400                                   TO  PV-LIST-ITEM-NUMBER.       14340016
143500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14350016
143600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14360016
143700               PC-ITEMS-PER-PANEL).                               14370016
143800                                                                  14380016
143900     MOVE ASC-START-OF-SELECTED-RANGE                             14390016
144000                                   TO PV-START-OF-SELECTED-RANGE. 14400016
144100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14410016
144200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14420016
144300               PC-ITEMS-PER-PANEL).                               14430016
144400                                                                  14440016
144500     MOVE ASC-END-OF-SELECTED-RANGE                               14450016
144600                                   TO  PV-END-OF-SELECTED-RANGE.  14460016
144700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14470016
144800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14480016
144900               PC-ITEMS-PER-PANEL).                               14490016
145000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14500016
145100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14510016
145200                                                                  14520016
145300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14530016
145400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14540016
145500         MOVE +1                   TO ASC-BLK-SUB                 14550016
145600         PERFORM 5100-WRITE-TEMP-STORAGE                          14560016
145700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14570016
145800             PV-FIRST-BLOCK-IN-ARRAY - 1                          14580016
145900                                                                  14590016
146000         PERFORM                                                  14600016
146100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14610016
146200                   PV-PREV-BLOCK-IN-ARRAY                         14620016
146300             MOVE PV-FIRST-BLOCK-IN-RANGE                         14630016
146400                                   TO PV-BLOCK-NUMBER             14640016
146500             PERFORM 4410-READ-TEMP-STORAGE                       14650016
146600             PERFORM 3510-MARK-SELECTED-INDS                      14660016
146700                 VARYING ASC-ITEM-SUB                             14670016
146800                 FROM 1 BY 1                                      14680016
146900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14690016
147000             PERFORM 5100-WRITE-TEMP-STORAGE                      14700016
147100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14710016
147200         END-PERFORM                                              14720016
147300                                                                  14730016
147400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14740016
147500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14750016
147600         PERFORM                                                  14760016
147700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14770016
147800                   PV-LAST-BLOCK-IN-RANGE                         14780016
147900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14790016
148000                                   TO PV-BLOCK-NUMBER             14800016
148100             PERFORM 4410-READ-TEMP-STORAGE                       14810016
148200             PERFORM 3510-MARK-SELECTED-INDS                      14820016
148300                 VARYING ASC-ITEM-SUB                             14830016
148400                 FROM 1 BY 1                                      14840016
148500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14850016
148600             PERFORM 5100-WRITE-TEMP-STORAGE                      14860016
148700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14870016
148800         END-PERFORM                                              14880016
148900                                                                  14890016
149000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14900016
149100                                   TO PV-BLOCK-NUMBER             14910016
149200         PERFORM 4410-READ-TEMP-STORAGE                           14920016
149300     END-IF.                                                      14930016
149400                                                                  14940016
149500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14950016
149600                                      ASC-END-OF-SELECTED-RANGE.  14960016
149700                                                                  14970016
149800 EJECT                                                            14980016
149900*----------------------------------------------------------------*14990016
150000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15000016
150100*----------------------------------------------------------------*15010016
150200                                                                  15020016
150300 3510-MARK-SELECTED-INDS.                                         15030016
150400                                                                  15040016
150500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15050016
150600                                ASC-ITEM-SUB) >                   15060016
150700         ASC-START-OF-SELECTED-RANGE)                             15070016
150800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15080016
150900                                ASC-ITEM-SUB) =                   15090016
151000         ASC-START-OF-SELECTED-RANGE)                             15100016
151100                                                                  15110016
151200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15120016
151300                                    ASC-ITEM-SUB) <               15130016
151400             ASC-END-OF-SELECTED-RANGE)                           15140016
151500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15150016
151600                                    ASC-ITEM-SUB) =               15160016
151700             ASC-END-OF-SELECTED-RANGE)                           15170016
151800                                                                  15180016
151900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15190016
152000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15200016
152100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15210016
152200                               TO TRUE                            15220016
152300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15230016
152400                               TO TRUE                            15240016
152500                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15250016
152600             END-IF                                               15260016
152700         END-IF                                                   15270016
152800     END-IF.                                                      15280016
152900                                                                  15290016
153000 EJECT                                                            15300016
153100*----------------------------------------------------------------*15310016
153200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15320016
153300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15330016
153400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15340016
153500*    DISPLAY THE PANEL TO USER.                                  *15350016
153600*----------------------------------------------------------------*15360016
153700                                                                  15370016
153800 4000-BUILD-INITIAL-PANEL.                                        15380016
153900                                                                  15390016
154000     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15400016
154100                                 ASC-BLOCK-ENTRIES (2).           15410016
154200     MOVE +1                 TO ASC-BLK-SUB.                      15420016
154300     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            15430016
154400                                                                  15440016
154500     MOVE +0                 TO ASC-ITEM-SUB                      15450016
154600                                ASC-NUMBER-OF-ITEMS-READ          15460016
154700                                ASC-NUMBER-OF-SELECTED-ITEMS      15470016
154800                                ASC-HIGHEST-BLOCK-WRITTEN         15480016
154900                                ASC-START-OF-SELECTED-RANGE       15490016
155000                                ASC-END-OF-SELECTED-RANGE         15500016
155100                                ASC-ITEM-AT-TOP-OF-PANEL.         15510016
155200                                                                  15520016
155300                                                                  15530016
155400                                                                  15540016
155500     PERFORM 4010-OPEN-CURSOR.                                    15550016
155600                                                                  15560016
155700     IF SQLCODE = ZERO                                            15570016
155800         PERFORM 4300-READ-ITEMS-FROM-DB                          15580016
155900                                                                  15590016
156000         PERFORM 4020-CLOSE-CURSOR                                15600016
156100                                                                  15610016
156200         MOVE +1                   TO  PV-TOP-ITEM                15620016
156300         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      15630016
156400             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                15640016
156500             SET DP020-MSG-FATAL   TO  TRUE                       15650016
156600*            ---- NO LIST ITEMS FOUND FOR CRITERIA ----           15660016
156700             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           15670016
156800         ELSE                                                     15680016
156900             MOVE -1               TO MR-SELECTL (1)              15690016
157000             SET DP030-SET-CURSOR-APPL-1                          15700016
157100                                   TO TRUE                        15710016
157200             PERFORM                                              15720016
157300                 VARYING PV-SUB                                   15730016
157400                 FROM 1 BY 1                                      15740016
157500                 UNTIL PV-SUB > PC-ITEMS-PER-PANEL                15750016
157600                 MOVE DP015-BLUE      TO MR-ACTIONC (PV-SUB)      15760016
157700                                      MR-VENDOR-NAMEC (PV-SUB)    15770016
157800                                      MR-FG-CNTL-NUMC  (PV-SUB)   15780016
157900                                      MR-TRAN-SETC     (PV-SUB)   15790016
158000                                      MR-DAYS-UNACKC   (PV-SUB)   15800016
158100                                      MR-PO-ACK-STAT-CDC (PV-SUB) 15810016
158200             END-PERFORM                                          15820016
158300                                                                  15830016
158400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15840016
158500         END-IF                                                   15850016
158600     ELSE                                                         15860016
158700         SET  DP020-NEXT-ACT-APPL-ERROR                           15870016
158800              DP020-MSG-WARNING         TO TRUE                   15880016
158900*        ---- WAIT 15 SECONDS, THEN RETRY ----                    15890016
159000         MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER               15900016
159100     END-IF.                                                      15910016
159200 EJECT                                                            15920016
159300*----------------------------------------------------------------*15930016
159400*   OPEN THE CURSOR.                                              15940016
159500*   IN THIS PARTICULAR APPLICATION ONE OF 5 DIFFERENT CURSORS    *15950016
159600*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *15960016
159700*   USER.                                                        *15970016
159800*----------------------------------------------------------------*15980016
159900 4010-OPEN-CURSOR.                                                15990016
160000                                                                  16000016
160100     MOVE 'CURSOR 1'                                              16010016
160200                  TO DP013-MESSAGE-TEXT (2)                       16020016
160300     EXEC SQL                                                     16030016
160400           OPEN CURSOR_ONE                                        16040016
160500     END-EXEC                                                     16050016
160600                                                                  16060016
160700     EVALUATE TRUE                                                16070016
160800         WHEN SQLCODE = ZERO                                      16080016
160900             CONTINUE                                             16090016
161000         WHEN SQLWARN0 NOT = SPACES                               16100016
161100         WHEN SQLCODE  NOT = ZERO                                 16110016
161200             MOVE '4010-OPEN-CURSOR'                              16120016
161300                               TO DP013-PARAGRAPH                 16130016
161400             MOVE 'OPEN CURSOR'                                   16140016
161500                               TO DP013-MESSAGE-TEXT (1)          16150016
161600             MOVE 'TFGTRST '   TO DP013-DB2-TABLE-NAME (1)        16160016
161700             MOVE SQLCA        TO DP013-SQLCA                     16170016
161800             SET DP013-DB2-ABEND                                  16180016
161900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16190016
162000             PERFORM DP013-0000-PROCESS-ABEND                     16200016
162100     END-EVALUATE.                                                16210016
162200 EJECT                                                            16220016
162300*----------------------------------------------------------------*16230016
162400* CLOSE THE CURSOR.                                               16240016
162500*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *16250016
162600*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16260016
162700*   USER.                                                        *16270016
162800*----------------------------------------------------------------*16280016
162900                                                                  16290016
163000 4020-CLOSE-CURSOR.                                               16300016
163100*                                                                 16310016
163200     MOVE 'CURSOR 1'     TO DP013-MESSAGE-TEXT (2).               16320016
163300                                                                  16330016
163400     EXEC SQL                                                     16340016
163500          CLOSE CURSOR_ONE                                        16350016
163600     END-EXEC.                                                    16360016
163700                                                                  16370016
163800     EVALUATE TRUE                                                16380016
163900         WHEN SQLCODE = ZERO                                      16390016
164000             CONTINUE                                             16400016
164100         WHEN SQLWARN0 NOT = SPACES                               16410016
164200         WHEN SQLCODE  NOT = ZERO                                 16420016
164300             MOVE '4020-CLOSE-CURSOR'                             16430016
164400                               TO DP013-PARAGRAPH                 16440016
164500             MOVE 'CLOSE CURSOR'                                  16450016
164600                               TO DP013-MESSAGE-TEXT (1)          16460016
164700             MOVE SQLCA        TO DP013-SQLCA                     16470016
164800             MOVE 'TFGTRST '   TO DP013-DB2-TABLE-NAME (1)        16480016
164900             SET DP013-DB2-ABEND                                  16490016
165000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16500016
165100             PERFORM DP013-0000-PROCESS-ABEND                     16510016
165200     END-EVALUATE.                                                16520016
165300 EJECT                                                            16530016
165400*----------------------------------------------------------------*16540016
165500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16550016
165600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16560016
165700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16570016
165800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16580016
165900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16590016
166000*                                                                *16600016
166100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16610016
166200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16620016
166300*    UPON INITIALIZATION.                                        *16630016
166400*----------------------------------------------------------------*16640016
166500                                                                  16650016
166600 4300-READ-ITEMS-FROM-DB.                                         16660016
166700                                                                  16670016
166800     PERFORM                                                      16680016
166900         VARYING PV-READ-COUNT                                    16690016
167000         FROM 1 BY 1                                              16700016
167100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16710016
167200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16720016
167300                                                                  16730016
167400         PERFORM 4310-FETCH                                       16740016
167500                                                                  16750016
167600         IF  ASC-ITEMS-LEFT-ON-DB                                 16760016
167700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16770016
167800                 ADD +1            TO ASC-ITEM-SUB                16780016
167900             ELSE                                                 16790016
168000                 ADD +1            TO ASC-BLK-SUB                 16800016
168100                 MOVE +1           TO ASC-ITEM-SUB                16810016
168200                                                                  16820016
168300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16830016
168400                     MOVE +1       TO ASC-BLK-SUB                 16840016
168500                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           16850016
168600                     PERFORM 5100-WRITE-TEMP-STORAGE              16860016
168700                     MOVE ASC-BLOCK-ENTRIES                       16870016
168800                                          (PC-MAX-BLOCKS-IN-ARRAY)16880016
168900                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)16890016
169000                     ADD +1        TO ASC-BLK-SUB                 16900016
169100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16910016
169200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16920016
169300                                                           TO TRUE16930016
169400                 END-IF                                           16940016
169500             END-IF                                               16950016
169600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16960016
169700             MOVE ASC-NUMBER-OF-ITEMS-READ                        16970016
169800                TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)16980016
169900*   -----------MOVE ITEMS FROM DB TO ASC COMMAREA ---------       16990016
170000            MOVE FGTRST-TP-DKEY            TO                     17000016
170100               ASC-TP-DKEY         (ASC-BLK-SUB ASC-ITEM-SUB)     17010016
170200            MOVE FGTRST-TP-DKEY-TMST       TO                     17020016
170300               ASC-TP-DKEY-TMST    (ASC-BLK-SUB ASC-ITEM-SUB)     17030016
170400            MOVE ENTNME-ENT-NAME-DESC      TO                     17040016
170500               ASC-VENDOR-NAME   (ASC-BLK-SUB ASC-ITEM-SUB)       17050016
170600            MOVE FGTRST-FUNC-CDE-CNTL-NBR  TO                     17060016
170700               ASC-FG-CNTL-NUM   (ASC-BLK-SUB ASC-ITEM-SUB)       17070016
170800            MOVE FGTRST-TRN-SET-CDE        TO                     17080016
170900               ASC-TRAN-SET      (ASC-BLK-SUB ASC-ITEM-SUB)       17090016
171000            MOVE FGTRST-PO-ACKNL-STAT-CDE  TO                     17100016
171100             ASC-PO-ACK-STAT-CD  (ASC-BLK-SUB ASC-ITEM-SUB)       17110016
171200                                                                  17120016
171300            MOVE ASC-TODAYS-DATE-YMD TO DPG51-SYSTEM-DATE         17130016
171400            SET DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE              17140016
171500            SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE              17150016
171600            SET  DPG52-LK-DTE-ISO            TO TRUE              17160016
171700            SET  DPG53-LK-CMPR-DTE-ISO-FMT   TO TRUE              17170016
171800                                                                  17180016
171900            MOVE PV-TP-TMST-DATE TO DPG53-LK-CMPR-DATE-INPUT      17190016
172000            MOVE ASC-TODAYS-DATE-YYYYMMDD TO DPG52-LK-DATE-INPUT  17200016
172100                                                                  17210016
172200            CALL PC-CALENDAR-ROUTINE USING DPG51                  17220016
172300                                            DPG52                 17230016
172400                                            DPG53                 17240016
172500                                            DPG54                 17250016
172600                                            DPG55                 17260016
172700                                            DPG56                 17270016
172800                                                                  17280016
172900            IF (DPG54-DATE-INVALID) OR                            17290016
173000               (DPG54-SEVERE-ERROR)                               17300016
173100                 MOVE '4300-READ-ITEMS-FROM-DB'                   17310016
173200                                   TO DP013-PARAGRAPH             17320016
173300                 MOVE 'DATE ERROR'                                17330016
173400                                   TO DP013-MESSAGE-TEXT (1)      17340016
173500                 SET DP013-DB2-ABEND                              17350016
173600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17360016
173700                 PERFORM DP013-0000-PROCESS-ABEND                 17370016
173800            ELSE                                                  17380016
173900               MOVE DPG55-DAYS-DIFFERENCE TO                      17390016
174000               ASC-DAYS-UNACK    (ASC-BLK-SUB ASC-ITEM-SUB)       17400016
174100            END-IF                                                17410016
174200                                                                  17420016
174300*   -----------MOVE ITEMS FROM DB TO ASC COMMAREA ---------       17430016
174400         END-IF                                                   17440016
174500     END-PERFORM.                                                 17450016
174600                                                                  17460016
174700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17470016
174800         MOVE +1               TO ASC-BLK-SUB                     17480016
174900         PERFORM 5100-WRITE-TEMP-STORAGE                          17490016
175000         ADD +1                TO ASC-BLK-SUB                     17500016
175100         PERFORM 5100-WRITE-TEMP-STORAGE                          17510016
175200                                                                  17520016
175300         MOVE 1                TO ASC-BLK-SUB                     17530016
175400                                  PV-BLOCK-NUMBER                 17540016
175500         PERFORM 4410-READ-TEMP-STORAGE                           17550016
175600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17560016
175700             MOVE 2            TO ASC-BLK-SUB                     17570016
175800                                  PV-BLOCK-NUMBER                 17580016
175900             PERFORM 4410-READ-TEMP-STORAGE                       17590016
176000         END-IF                                                   17600016
176100     END-IF.                                                      17610016
176200 EJECT                                                            17620016
176300*----------------------------------------------------------------*17630016
176400*    FETCH THE CURSOR.                                            17640016
176500*----------------------------------------------------------------*17650016
176600                                                                  17660016
176700 4310-FETCH.                                                      17670016
176800                                                                  17680016
176900                                                                  17690016
177000     MOVE 'CURSOR 1'                                              17700016
177100                  TO DP013-MESSAGE-TEXT (2).                      17710016
177200     EXEC SQL                                                     17720016
177300          FETCH CURSOR_ONE                                        17730016
177400          INTO  :FGTRST-TP-DKEY                                   17740016
177500              , :FGTRST-TP-DKEY-TMST                              17750016
177600              , :PV-TP-TMST-DATE                                  17760016
177700              , :FGTRST-FUNC-CDE-CNTL-NBR                         17770016
177800              , :FGTRST-TRN-SET-CDE                               17780016
177900              , :ENTNME-ENT-NAME-DESC                             17790016
178000              , :FGTRST-PO-ACKNL-STAT-CDE                         17800016
178100     END-EXEC.                                                    17810016
178200                                                                  17820016
178300                                                                  17830016
178400     EVALUATE TRUE                                                17840016
178500         WHEN SQLCODE = ZERO                                      17850016
178600         WHEN SQLCODE = +100                                      17860016
178700             IF  SQLCODE EQUAL +100                               17870016
178800                 SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE              17880016
178900             END-IF                                               17890016
179000         WHEN SQLWARN0 NOT = SPACE                                17900016
179100         WHEN SQLCODE  NOT = ZERO                                 17910016
179200              MOVE '4310-FETCH-CURSOR'                            17920016
179300                               TO DP013-PARAGRAPH                 17930016
179400              MOVE 'FETCH CURSOR'                                 17940016
179500                               TO DP013-MESSAGE-TEXT (1)          17950016
179600              MOVE SQLCA       TO DP013-SQLCA                     17960016
179700              SET DP013-DB2-ABEND                                 17970016
179800                               TO TRUE                            17980016
179900              PERFORM DP013-0000-PROCESS-ABEND                    17990016
180000     END-EVALUATE.                                                18000016
180100                                                                  18010016
180200                                                                  18020016
180300*----------------------------------------------------------------*18030016
180400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18040016
180500*----------------------------------------------------------------*18050016
180600                                                                  18060016
180700 4400-MOVE-COMMAREA-TO-SCREEN.                                    18070016
180800                                                                  18080016
180900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18090016
181000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18100016
181100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18110016
181200             MOVE +1    TO ASC-BLK-SUB                            18120016
181300             PERFORM 5100-WRITE-TEMP-STORAGE                      18130016
181400             ADD +1     TO ASC-BLK-SUB                            18140016
181500             PERFORM 5100-WRITE-TEMP-STORAGE                      18150016
181600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18160016
181700                 GIVING PV-BLOCK-NUMBER                           18170016
181800                 REMAINDER PV-REMAINDER                           18180016
181900             IF  PV-REMAINDER > ZERO                              18190016
182000                 ADD +1 TO PV-BLOCK-NUMBER                        18200016
182100             END-IF                                               18210016
182200             MOVE +1    TO ASC-BLK-SUB                            18220016
182300             PERFORM 4410-READ-TEMP-STORAGE                       18230016
182400             ADD +1     TO ASC-BLK-SUB                            18240016
182500                           PV-BLOCK-NUMBER                        18250016
182600             PERFORM 4410-READ-TEMP-STORAGE                       18260016
182700     END-IF.                                                      18270016
182800     MOVE +1            TO ASC-BLK-SUB.                           18280016
182900     COMPUTE ASC-ITEM-SUB =                                       18290016
183000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18300016
183100         + PC-ITEMS-PER-PANEL).                                   18310016
183200*                                                                 18320016
183300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18330016
183400         ADD +1         TO ASC-BLK-SUB                            18340016
183500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18350016
183600     END-IF.                                                      18360016
183700*                                                                 18370016
183800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18380016
183900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18390016
184000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18400016
184100     PERFORM 4420-FORMAT-LIST-LINES                               18410016
184200         VARYING PV-SUB                                           18420016
184300         FROM PC-ITEMS-PER-PANEL BY -1                            18430016
184400         UNTIL PV-SUB < +1.                                       18440016
184500*                                                                 18450016
184600     COMPUTE ASC-ITEMS-DISPLAYED =                                18460016
184700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18470016
184800     IF PS-NO-START-ITEM-ERROR                                    18480016
184900         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL18490016
185000                                          ASTRTITO                18500016
185100         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  18510016
185200     ELSE                                                         18520016
185300         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                18530016
185400     END-IF.                                                      18540016
185500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18550016
185600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18560016
185700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18570016
185800                                   TO ASELITO.                    18580016
185900*                                                                 18590016
186000     IF  DP020-MSG-NUMBER-X = SPACE                               18600016
186100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18610016
186200*            --- MORE ITEMS TO DISPLAY ----                       18620016
186300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18630016
186400             SET DP020-MSG-INFORMATIONAL TO TRUE                  18640016
186500         END-IF                                                   18650016
186600     END-IF.                                                      18660016
186700*----------------------------------------------------------------*18670016
186800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18680016
186900*----------------------------------------------------------------*18690016
187000                                                                  18700016
187100 4410-READ-TEMP-STORAGE.                                          18710016
187200                                                                  18720016
187300     EXEC CICS                                                    18730016
187400         READQ TS                                                 18740016
187500             QUEUE (ASC-LIST-QUEUE-NAME)                          18750016
187600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18760016
187700             ITEM  (PV-BLOCK-NUMBER)                              18770016
187800             RESP  (PV-CICS-RESP)                                 18780016
187900     END-EXEC.                                                    18790016
188000                                                                  18800016
188100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18810016
188200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18820016
188300         CONTINUE                                                 18830016
188400     ELSE                                                         18840016
188500         SET DP013-CICS-ABEND     TO TRUE                         18850016
188600         SET DP013-NO-ROLLBACK    TO TRUE                         18860016
188700         MOVE '4410-READ-TEMP-STORAGE'                            18870016
188800                                  TO DP013-PARAGRAPH              18880016
188900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18890016
189000                                  TO DP013-MESSAGE-TEXT(1)        18900016
189100         PERFORM DP013-0000-PROCESS-ABEND                         18910016
189200     END-IF.                                                      18920016
189300                                                                  18930016
189400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18940016
189500*                                                                 18950016
189600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18960016
189700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18970016
189800     END-IF.                                                      18980016
189900 EJECT                                                            18990016
190000*----------------------------------------------------------------*19000016
190100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19010016
190200*----------------------------------------------------------------*19020016
190300                                                                  19030016
190400 4420-FORMAT-LIST-LINES.                                          19040016
190500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19050016
190600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19060016
190700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19070016
190800         MOVE SPACE              TO MR-SELECTI (PV-SUB)           19080016
190900                                    MR-ACTION  (PV-SUB)           19090016
191000*----------------------INITIALIZE MAP FIELDS                      19100016
191100                                    MR-VENDOR-NAME   (PV-SUB)     19110016
191200                                    MR-FG-CNTL-NUM   (PV-SUB)     19120016
191300                                    MR-TRAN-SET      (PV-SUB)     19130016
191400                                    MR-DAYS-UNACK-X  (PV-SUB)     19140016
191500                                    MR-PO-ACK-STAT-CD (PV-SUB)    19150016
191600*----------------------END INITIALIZE                             19160016
191700     ELSE                                                         19170016
191800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19180016
191900                                                   > SPACE        19190016
192000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19200016
192100                                 TO MR-SELECTI (PV-SUB)           19210016
192200         ELSE                                                     19220016
192300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19230016
192400                                 TO MR-SELECTI (PV-SUB)           19240016
192500         END-IF                                                   19250016
192600*                                                                 19260016
192700         IF  DP030-SET-CURSOR-TRAILER                             19270016
192800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19280016
192900                 > SPACE)                                         19290016
193000               OR (PV-SUB = 1))                                   19300016
193100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19310016
193200                MOVE -1          TO MR-SELECTL (PV-SUB)           19320016
193300             END-IF                                               19330016
193400         END-IF                                                   19340016
193500*                                                                 19350016
193600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19360016
193700*---------------MOVE COMMAREA TO THE SCEEN----------------------- 19370016
193800             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           19380016
193900                              TO MR-ACTION (PV-SUB)               19390016
194000             MOVE  ASC-VENDOR-NAME   (ASC-BLK-SUB ASC-ITEM-SUB)   19400016
194100                              TO    MR-VENDOR-NAME   (PV-SUB)     19410016
194200             MOVE  ASC-FG-CNTL-NUM   (ASC-BLK-SUB ASC-ITEM-SUB)   19420016
194300                              TO    MR-FG-CNTL-NUM   (PV-SUB)     19430016
194400             MOVE  ASC-TRAN-SET      (ASC-BLK-SUB ASC-ITEM-SUB)   19440016
194500                              TO    MR-TRAN-SET      (PV-SUB)     19450016
194600             MOVE  ASC-DAYS-UNACK    (ASC-BLK-SUB ASC-ITEM-SUB)   19460016
194700                              TO    MR-DAYS-UNACK    (PV-SUB)     19470016
194800             MOVE ASC-PO-ACK-STAT-CD (ASC-BLK-SUB ASC-ITEM-SUB)   19480016
194900                              TO MR-PO-ACK-STAT-CD   (PV-SUB)     19490016
195000*---------------MOVE COMMAREA TO THE SCEEN----------------------- 19500016
195100         END-IF                                                   19510016
195200     END-IF.                                                      19520016
195300     SUBTRACT +1 FROM ASC-ITEM-SUB                                19530016
195400     IF  ASC-ITEM-SUB < + 1                                       19540016
195500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19550016
195600         MOVE +1                 TO ASC-BLK-SUB                   19560016
195700     END-IF.                                                      19570016
195800******************************************************************19580016
195900** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **19590016
196000** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **19600016
196100** ISSUE A WARNING.                                             **19610016
196200******************************************************************19620016
196300 4430-CHECK-FOR-BEGIN-AND-END.                                    19630016
196400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19640016
196500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19650016
196600*            -- NO END-OF-RANGE SPECFIED ---                      19660016
196700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19670016
196800             SET DP020-MSG-WARNING TO TRUE                        19680016
196900             PERFORM 4431-POSITION-AT-WARNING                     19690016
197000         END-IF                                                   19700016
197100     ELSE                                                         19710016
197200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19720016
197300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19730016
197400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19740016
197500             SET DP020-MSG-WARNING TO TRUE                        19750016
197600             PERFORM 4431-POSITION-AT-WARNING                     19760016
197700         END-IF                                                   19770016
197800     END-IF.                                                      19780016
197900******************************************************************19790016
198000** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **19800016
198100** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **19810016
198200** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **19820016
198300** POSITION THE CURSOR THERE.                                   **19830016
198400******************************************************************19840016
198500 4431-POSITION-AT-WARNING.                                        19850016
198600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19860016
198700                    - PV-TOP-ITEM + 1.                            19870016
198800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19880016
198900         CONTINUE                                                 19890016
199000     ELSE                                                         19900016
199100         SET DP030-SET-CURSOR-APPL-1                              19910016
199200                                   TO TRUE                        19920016
199300         MOVE -1                   TO MR-SELECTL (PV-SUB)         19930016
199400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19940016
199500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19950016
199600     END-IF.                                                      19960016
199700*                                                                 19970016
199800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19980016
199900                    - PV-TOP-ITEM + 1.                            19990016
200000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20000016
200100         CONTINUE                                                 20010016
200200     ELSE                                                         20020016
200300         SET DP030-SET-CURSOR-APPL-1                              20030016
200400                                   TO TRUE                        20040016
200500         MOVE -1                   TO MR-SELECTL (PV-SUB)         20050016
200600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20060016
200700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20070016
200800     END-IF.                                                      20080016
200900 EJECT                                                            20090016
201000*----------------------------------------------------------------*20100016
201100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20110016
201200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20120016
201300* FOR THE SELECTED ITEMS QUEUE.                                  *20130016
201400*                                                                *20140016
201500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20150016
201600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20160016
201700* THE ARRAY IS FULL.                                             *20170016
201800*----------------------------------------------------------------*20180016
201900                                                                  20190016
202000 5000-PREPARE-SEL-QUEUE.                                          20200016
202100                                                                  20210016
202200     MOVE +1                   TO  ASC-BLK-SUB.                   20220016
202300     PERFORM 5100-WRITE-TEMP-STORAGE.                             20230016
202400     ADD +1                    TO  ASC-BLK-SUB.                   20240016
202500     PERFORM 5100-WRITE-TEMP-STORAGE.                             20250016
202600                                                                  20260016
202700     MOVE ASC-SEL-QUEUE-NAME   TO  ET307-SEL-QUEUE-NAME.          20270016
202800     PERFORM 6010-DELETE-SEL-QUEUE.                               20280016
202900                                                                  20290016
203000     SET ASC-UPDATE-TSQ        TO  TRUE.                          20300016
203100                                                                  20310016
203200     SET ET308-IDX             TO  1.                             20320016
203300     MOVE ZERO                 TO ET307-NUMBER-OF-TS-ITEMS.       20330016
203400     INITIALIZE ET308-SELECTED-ITEM-ARRAY.                        20340016
203500                                                                  20350016
203600     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20360016
203700             VARYING PV-ITEM                                      20370016
203800             FROM 1 BY 1                                          20380016
203900             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           20390016
204000                                                                  20400016
204100     IF  ET308-IDX > 1                                            20410016
204200         PERFORM 5205-WRITE-SEL-QUEUE                             20420016
204300         ADD +1                TO ET307-NUMBER-OF-TS-ITEMS        20430016
204400     END-IF.                                                      20440016
204500 EJECT                                                            20450016
204600*----------------------------------------------------------------*20460016
204700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20470016
204800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20480016
204900*----------------------------------------------------------------*20490016
205000                                                                  20500016
205100 5100-WRITE-TEMP-STORAGE.                                         20510016
205200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20520016
205300                                   TO PV-LIST-ITEM-NUMBER.        20530016
205400     COMPUTE PV-BLOCK-NUMBER =                                    20540016
205500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20550016
205600                                                                  20560016
205700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20570016
205800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20580016
205900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20590016
206000             PERFORM 5105-REWRITE-ASC-LISTQ                       20600016
206100         END-IF                                                   20610016
206200     ELSE                                                         20620016
206300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20630016
206400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20640016
206500         PERFORM 5110-WRITE-ASC-LISTQ                             20650016
206600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20660016
206700     END-IF.                                                      20670016
206800                                                                  20680016
206900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20690016
207000******************************************************************20700016
207100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **20710016
207200** SPECIFIC COMMAREA.                                           **20720016
207300******************************************************************20730016
207400 5105-REWRITE-ASC-LISTQ.                                          20740016
207500     EXEC CICS                                                    20750016
207600         WRITEQ TS                                                20760016
207700             QUEUE (ASC-LIST-QUEUE-NAME)                          20770016
207800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20780016
207900             ITEM  (PV-BLOCK-NUMBER)                              20790016
208000             REWRITE                                              20800016
208100             RESP  (PV-CICS-RESP)                                 20810016
208200     END-EXEC.                                                    20820016
208300                                                                  20830016
208400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20840016
208500         CONTINUE                                                 20850016
208600     ELSE                                                         20860016
208700         SET DP013-CICS-ABEND            TO TRUE                  20870016
208800         SET DP013-NO-ROLLBACK           TO TRUE                  20880016
208900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20890016
209000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20900016
209100                                         TO DP013-MESSAGE-TEXT(1) 20910016
209200         PERFORM DP013-0000-PROCESS-ABEND                         20920016
209300     END-IF.                                                      20930016
209400                                                                  20940016
209500******************************************************************20950016
209600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20960016
209700** SPECIFIC COMMAREA.                                           **20970016
209800******************************************************************20980016
209900 5110-WRITE-ASC-LISTQ.                                            20990016
210000     EXEC CICS                                                    21000016
210100         WRITEQ TS                                                21010016
210200             QUEUE (ASC-LIST-QUEUE-NAME)                          21020016
210300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21030016
210400             ITEM  (PV-BLOCK-NUMBER)                              21040016
210500             RESP  (PV-CICS-RESP)                                 21050016
210600     END-EXEC.                                                    21060016
210700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21070016
210800         SET DP013-CICS-ABEND      TO TRUE                        21080016
210900         SET DP013-NO-ROLLBACK     TO TRUE                        21090016
211000         MOVE '5110-WRITE-ASC-LISTQ'                              21100016
211100                                   TO DP013-PARAGRAPH             21110016
211200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21120016
211300                                   TO DP013-MESSAGE-TEXT(1)       21130016
211400         PERFORM DP013-0000-PROCESS-ABEND                         21140016
211500     END-IF.                                                      21150016
211600 EJECT                                                            21160016
211700*----------------------------------------------------------------*21170016
211800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21180016
211900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21190016
212000*----------------------------------------------------------------*21200016
212100                                                                  21210016
212200 5200-FILL-SEL-QUEUE-RECORD.                                      21220016
212300                                                                  21230016
212400     PERFORM 6112-READ-LIST-QUEUE.                                21240016
212500                                                                  21250016
212600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21260016
212700         PERFORM                                                  21270016
212800         VARYING LQW-IDX                                          21280016
212900         FROM 1 BY 1                                              21290016
213000         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21300016
213100           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          21310016
213200                                                                  21320016
213300             IF  LQW-SELECT (LQW-IDX)                             21330016
213400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              21340016
213500                                   TO ET308-ITEM (ET308-IDX)      21350016
213600                                                                  21360016
213700                 MOVE LQW-TP-DKEY       (LQW-IDX)                 21370016
213800                       TO ET308-TP-DKEY     (ET308-IDX)           21380016
213900                 MOVE LQW-TP-DKEY-TMST  (LQW-IDX)                 21390016
214000                       TO ET308-TP-DKEY-TMST (ET308-IDX)          21400016
214100                 MOVE SPACE        TO ET308-ACTION-SW (ET308-IDX) 21410016
214200                 SET ET308-IDX UP BY 1                            21420016
214300                 IF  ET308-IDX > ET308-MAX-ITEMS                  21430016
214400                     PERFORM 5205-WRITE-SEL-QUEUE                 21440016
214500                     ADD +1        TO ET307-NUMBER-OF-TS-ITEMS    21450016
214600                     INITIALIZE ET308-SELECTED-ITEM-ARRAY         21460016
214700                     SET ET308-IDX TO  1                          21470016
214800                 END-IF                                           21480016
214900             END-IF                                               21490016
215000         END-PERFORM                                              21500016
215100     END-IF.                                                      21510016
215200                                                                  21520016
215300*----------------------------------------------------------------*21530016
215400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21540016
215500*----------------------------------------------------------------*21550016
215600                                                                  21560016
215700 5205-WRITE-SEL-QUEUE.                                            21570016
215800                                                                  21580016
215900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21590016
216000                                   TO ET308-SELECTED-ITEMS.       21600016
216100                                                                  21610016
216200     EXEC CICS                                                    21620016
216300          WRITEQ TS                                               21630016
216400              QUEUE (ASC-SEL-QUEUE-NAME)                          21640016
216500              FROM  (ET308-SELECTED-VNDRS)                        21650016
216600              ITEM  (PV-SEL-QUEUE-ITEM)                           21660016
216700              RESP  (PV-CICS-RESP)                                21670016
216800     END-EXEC.                                                    21680016
216900                                                                  21690016
217000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21700016
217100         CONTINUE                                                 21710016
217200     ELSE                                                         21720016
217300         SET DP013-CICS-ABEND      TO TRUE                        21730016
217400         SET DP013-NO-ROLLBACK     TO TRUE                        21740016
217500         MOVE '5205-WRITE-SEL-QUEUE'                              21750016
217600                                   TO DP013-PARAGRAPH             21760016
217700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21770016
217800                                   TO DP013-MESSAGE-TEXT(1)       21780016
217900         PERFORM DP013-0000-PROCESS-ABEND                         21790016
218000     END-IF.                                                      21800016
218100 EJECT                                                            21810016
218200******************************************************************21820016
218300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **21830016
218400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **21840016
218500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **21850016
218600** THE USER.                                                    **21860016
218700******************************************************************21870016
218800 6000-REFRESH-PANEL-FROM-TEMP.                                    21880016
218900     IF  ASC-UPDATE-TSQ                                           21890016
219000         SET ASC-NO-TSQ-UPDATE TO TRUE                            21900016
219100         MOVE ZERO                 TO PV-SAVE-ITEM                21910016
219200                                      PV-SEL-QUEUE-ITEM           21920016
219300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21930016
219400                                   TO PV-HOLD-SELECTED-ITEMS      21940016
219500         PERFORM 6100-UPDATE-TSQ                                  21950016
219600             UNTIL PV-ITEMS-PROCESSED >                           21960016
219700                                     PV-HOLD-SELECTED-ITEMS       21970016
219800         PERFORM 6010-DELETE-SEL-QUEUE                            21980016
219900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21990016
220000                    ASC-BLOCK-ENTRIES (2)                         22000016
220100                                                                  22010016
220200         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 22020016
220300                GIVING PV-BLOCK-NUMBER                            22030016
220400                REMAINDER PV-REMAINDER                            22040016
220500         IF  PV-REMAINDER > ZERO                                  22050016
220600             ADD +1     TO PV-BLOCK-NUMBER                        22060016
220700         END-IF                                                   22070016
220800         MOVE +1        TO ASC-BLK-SUB                            22080016
220900         PERFORM 4410-READ-TEMP-STORAGE                           22090016
221000         ADD +1         TO ASC-BLK-SUB                            22100016
221100                           PV-BLOCK-NUMBER                        22110016
221200         PERFORM 4410-READ-TEMP-STORAGE                           22120016
221300                                                                  22130016
221400     END-IF.                                                      22140016
221500                                                                  22150016
221600*----------------------------------------------------------------*22160016
221700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *22170016
221800*----------------------------------------------------------------*22180016
221900 6010-DELETE-SEL-QUEUE.                                           22190016
222000                                                                  22200016
222100     EXEC CICS                                                    22210016
222200         DELETEQ TS                                               22220016
222300             QUEUE (ASC-SEL-QUEUE-NAME)                           22230016
222400             RESP  (PV-CICS-RESP)                                 22240016
222500     END-EXEC.                                                    22250016
222600*                                                                 22260016
222700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22270016
222800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22280016
222900         CONTINUE                                                 22290016
223000     ELSE                                                         22300016
223100         SET DP013-CICS-ABEND TO TRUE                             22310016
223200         SET DP013-NO-ROLLBACK TO TRUE                            22320016
223300         MOVE '6010-DELETE-SEL-QUEUE'                             22330016
223400                        TO DP013-PARAGRAPH                        22340016
223500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22350016
223600                        TO DP013-MESSAGE-TEXT (1)                 22360016
223700         PERFORM DP013-0000-PROCESS-ABEND                         22370016
223800     END-IF.                                                      22380016
223900                                                                  22390016
224000*----------------------------------------------------------------*22400016
224100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22410016
224200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22420016
224300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22430016
224400*    THE TEMP QUEUE.                                             *22440016
224500*----------------------------------------------------------------*22450016
224600                                                                  22460016
224700 6100-UPDATE-TSQ.                                                 22470016
224800                                                                  22480016
224900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             22490016
225000     PERFORM 6105-READ-SEL-QUEUE.                                 22500016
225100     PERFORM                                                      22510016
225200         VARYING ET308-IDX                                        22520016
225300         FROM 1 BY 1                                              22530016
225400         UNTIL ((PV-ITEMS-PROCESSED >                             22540016
225500                              PV-HOLD-SELECTED-ITEMS)             22550016
225600         OR (ET308-IDX GREATER THAN ET308-MAX-ITEMS))             22560016
225700         IF  ET308-ACTION-SW (ET308-IDX) > SPACE                  22570016
225800             PERFORM 6110-PROCESS-ITEMS                           22580016
225900         END-IF                                                   22590016
226000         ADD +1                TO PV-ITEMS-PROCESSED              22600016
226100     END-PERFORM.                                                 22610016
226200     PERFORM 6111-WRITE-LIST-QUEUE.                               22620016
226300*----------------------------------------------------------------*22630016
226400*    READ THE LIST QUEUE RECORD.                                 *22640016
226500*----------------------------------------------------------------*22650016
226600                                                                  22660016
226700 6105-READ-SEL-QUEUE.                                             22670016
226800                                                                  22680016
226900     EXEC CICS                                                    22690016
227000          READQ TS                                                22700016
227100              QUEUE (ASC-SEL-QUEUE-NAME)                          22710016
227200              INTO  (ET308-SELECTED-VNDRS)                        22720016
227300              ITEM  (PV-SEL-QUEUE-ITEM)                           22730016
227400              RESP  (PV-CICS-RESP)                                22740016
227500     END-EXEC.                                                    22750016
227600*                                                                 22760016
227700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22770016
227800         CONTINUE                                                 22780016
227900     ELSE                                                         22790016
228000         SET DP013-CICS-ABEND      TO  TRUE                       22800016
228100         SET DP013-NO-ROLLBACK     TO  TRUE                       22810016
228200         MOVE '6105-READ-SEL-QUEUE'                               22820016
228300                                   TO  DP013-PARAGRAPH            22830016
228400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22840016
228500                                   TO  DP013-MESSAGE-TEXT(1)      22850016
228600         PERFORM DP013-0000-PROCESS-ABEND                         22860016
228700     END-IF.                                                      22870016
228800 EJECT                                                            22880016
228900*----------------------------------------------------------------*22890016
229000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22900016
229100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22910016
229200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22920016
229300*----------------------------------------------------------------*22930016
229400                                                                  22940016
229500 6110-PROCESS-ITEMS.                                              22950016
229600                                                                  22960016
229700     COMPUTE PV-ITEM = 1 + ((ET308-ITEM (ET308-IDX) - 1)          22970016
229800                     / PC-ITEMS-PER-PANEL).                       22980016
229900                                                                  22990016
230000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           23000016
230100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          23010016
230200             PERFORM 6111-WRITE-LIST-QUEUE                        23020016
230300         END-IF                                                   23030016
230400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    23040016
230500                                                                  23050016
230600         PERFORM 6112-READ-LIST-QUEUE                             23060016
230700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               23070016
230800             CONTINUE                                             23080016
230900         END-IF                                                   23090016
231000     END-IF.                                                      23100016
231100                                                                  23110016
231200     COMPUTE PV-SUB = (ET308-ITEM (ET308-IDX)                     23120016
231300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              23130016
231400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         23140016
231500     MOVE LQW-SELECTED-SW (PV-SUB)                                23150016
231600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  23160016
231700                                                                  23170016
231800     MOVE ET308-ACTION-SW (ET308-IDX)   TO LQW-ACTION (PV-SUB).   23180016
231900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23190016
232000                                                                  23200016
232100*----------------------------------------------------------------*23210016
232200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23220016
232300*----------------------------------------------------------------*23230016
232400                                                                  23240016
232500 6111-WRITE-LIST-QUEUE.                                           23250016
232600                                                                  23260016
232700     EXEC CICS                                                    23270016
232800         WRITEQ TS                                                23280016
232900             QUEUE (ASC-LIST-QUEUE-NAME)                          23290016
233000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23300016
233100             ITEM  (PV-SAVE-ITEM)                                 23310016
233200             REWRITE                                              23320016
233300             RESP  (PV-CICS-RESP)                                 23330016
233400     END-EXEC.                                                    23340016
233500*                                                                 23350016
233600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23360016
233700         CONTINUE                                                 23370016
233800     ELSE                                                         23380016
233900         SET DP013-CICS-ABEND  TO  TRUE                           23390016
234000         SET DP013-NO-ROLLBACK TO  TRUE                           23400016
234100         MOVE '6111-WRITE-LIST-QUEUE'                             23410016
234200                               TO  DP013-PARAGRAPH                23420016
234300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23430016
234400                               TO  DP013-MESSAGE-TEXT(1)          23440016
234500         PERFORM DP013-0000-PROCESS-ABEND                         23450016
234600     END-IF.                                                      23460016
234700                                                                  23470016
234800 EJECT                                                            23480016
234900*----------------------------------------------------------------*23490016
235000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23500016
235100*----------------------------------------------------------------*23510016
235200                                                                  23520016
235300 6112-READ-LIST-QUEUE.                                            23530016
235400                                                                  23540016
235500     EXEC CICS                                                    23550016
235600         READQ TS                                                 23560016
235700             QUEUE (ASC-LIST-QUEUE-NAME)                          23570016
235800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23580016
235900             ITEM  (PV-ITEM)                                      23590016
236000             RESP  (PV-CICS-RESP)                                 23600016
236100     END-EXEC.                                                    23610016
236200*                                                                 23620016
236300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23630016
236400         CONTINUE                                                 23640016
236500     ELSE                                                         23650016
236600         SET DP013-CICS-ABEND        TO TRUE                      23660016
236700         SET DP013-NO-ROLLBACK       TO TRUE                      23670016
236800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23680016
236900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23690016
237000                                     TO DP013-MESSAGE-TEXT(1)     23700016
237100         PERFORM DP013-0000-PROCESS-ABEND                         23710016
237200     END-IF.                                                      23720016
237300                                                                  23730016
237400*----------------------------------------------------------------*23740016
237500*    OPEN A CURSOR OF ALL ROWS WHICH MEET THE SPECIFIED CRITERIA  23750016
237600*    FOR EVERY ROW RETRUNED, UPDATE TO VEND_ACK_IND SWITCH TO BE  23760016
237700*    AN 'N'.                                                      23770016
237800*----------------------------------------------------------------*23780016
237900 8000-UPDATE-ACK-IND.                                             23790016
238000                                                                  23800016
238100     SET PS-MORE-CURSOR-TWO-ROWS TO TRUE.                         23810016
238200     PERFORM 8100-OPEN-CURSOR-TWO.                                23820016
238300     PERFORM 8200-FETCH-CURSOR-TWO-ROW.                           23830016
238400     PERFORM 8300-PROCESS-ROWS                                    23840016
238500         UNTIL PS-NO-MORE-CURSOR-TWO-ROWS.                        23850016
238600     PERFORM 8400-CLOSE-CURSOR-TWO.                               23860016
238700                                                                  23870016
238800*----------------------------------------------------------------*23880016
238900*   OPEN THE CURSOR.                                              23890016
239000*----------------------------------------------------------------*23900016
239100 8100-OPEN-CURSOR-TWO.                                            23910016
239200                                                                  23920016
239300     MOVE 'CURSOR 2'                                              23930016
239400                  TO DP013-MESSAGE-TEXT (2)                       23940016
239500     EXEC SQL                                                     23950016
239600           OPEN CURSOR_TWO                                        23960016
239700     END-EXEC                                                     23970016
239800                                                                  23980016
239900     EVALUATE TRUE                                                23990016
240000         WHEN SQLCODE = ZERO                                      24000016
240100             CONTINUE                                             24010016
240200         WHEN SQLWARN0 NOT = SPACES                               24020016
240300         WHEN SQLCODE  NOT = ZERO                                 24030016
240400             MOVE '8100-OPEN-CURSOR-TWO'                          24040016
240500                               TO DP013-PARAGRAPH                 24050016
240600             MOVE 'OPEN CURSOR'                                   24060016
240700                               TO DP013-MESSAGE-TEXT (1)          24070016
240800             MOVE 'TFGTRST '   TO DP013-DB2-TABLE-NAME (1)        24080016
240900             MOVE SQLCA        TO DP013-SQLCA                     24090016
241000             SET DP013-DB2-ABEND                                  24100016
241100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24110016
241200             PERFORM DP013-0000-PROCESS-ABEND                     24120016
241300     END-EVALUATE.                                                24130016
241400*                                                                 24140016
241500*----------------------------------------------------------------*24150016
241600*                                                                 24160016
241700*----------------------------------------------------------------*24170016
241800 8200-FETCH-CURSOR-TWO-ROW.                                       24180016
241900                                                                  24190016
242000     MOVE 'CURSOR 2'                                              24200016
242100                  TO DP013-MESSAGE-TEXT (2).                      24210016
242200     EXEC SQL                                                     24220016
242300          FETCH CURSOR_TWO                                        24230016
242400          INTO  :FGTRST-FUNC-CDE-SEQ-NBR                          24240016
242500              , :FGTRST-TRN-SET-SEQ-NBR                           24250016
242600     END-EXEC.                                                    24260016
242700                                                                  24270016
242800                                                                  24280016
242900     EVALUATE TRUE                                                24290016
243000         WHEN SQLCODE = ZERO                                      24300016
243100         WHEN SQLCODE = +100                                      24310016
243200             IF  SQLCODE EQUAL +100                               24320016
243300                 SET PS-NO-MORE-CURSOR-TWO-ROWS TO TRUE           24330016
243400             END-IF                                               24340016
243500         WHEN SQLWARN0 NOT = SPACE                                24350016
243600         WHEN SQLCODE  NOT = ZERO                                 24360016
243700              MOVE '8200-FETCH-CURSOR-TWO-ROW'                    24370016
243800                               TO DP013-PARAGRAPH                 24380016
243900              MOVE 'FETCH CURSOR'                                 24390016
244000                               TO DP013-MESSAGE-TEXT (1)          24400016
244100              MOVE SQLCA       TO DP013-SQLCA                     24410016
244200              SET DP013-DB2-ABEND                                 24420016
244300                               TO TRUE                            24430016
244400              PERFORM DP013-0000-PROCESS-ABEND                    24440016
244500     END-EVALUATE.                                                24450016
244600                                                                  24460016
244700*                                                                 24470016
244800*----------------------------------------------------------------*24480016
244900*                                                                 24490016
245000*----------------------------------------------------------------*24500016
245100 8300-PROCESS-ROWS.                                               24510016
245200                                                                  24520016
245300     PERFORM 8350-UPDATE-TFGTRST-ROW.                             24530016
245400     PERFORM 8200-FETCH-CURSOR-TWO-ROW.                           24540016
245500                                                                  24550016
245600*----------------------------------------------------------------*24560016
245700*                                                                 24570016
245800*----------------------------------------------------------------*24580016
245900 8350-UPDATE-TFGTRST-ROW.                                         24590016
246000                                                                  24600016
246100     EXEC SQL                                                     24610016
246200         UPDATE TFGTRST                                           24620016
246300             SET VEND_ACK_IND    =  'M'                           24630016
246400         WHERE                                                    24640016
246500              (TP_DKEY          = :FGTRST-TP-DKEY)          AND   24650016
246600              (TP_DKEY_TMST     = :FGTRST-TP-DKEY-TMST)     AND   24660016
246700              (FUNC_CDE_SEQ_NBR = :FGTRST-FUNC-CDE-SEQ-NBR) AND   24670016
246800              (TRN_SET_SEQ_NBR  = :FGTRST-TRN-SET-SEQ-NBR)        24680016
246900     END-EXEC.                                                    24690016
247000                                                                  24700016
247100     EVALUATE TRUE                                                24710016
247200         WHEN SQLCODE = ZERO                                      24720016
247300             CONTINUE                                             24730016
247400         WHEN SQLWARN0 NOT = SPACES                               24740016
247500         WHEN SQLCODE  NOT = ZERO                                 24750016
247600             MOVE '8350-UPDATE-TFGTRST-ROW'                       24760016
247700                               TO DP013-PARAGRAPH                 24770016
247800             MOVE 'UPDATE A ROW IN TFGTRST'                       24780016
247900                               TO DP013-MESSAGE-TEXT(1)           24790016
248000             MOVE SQLCA        TO DP013-SQLCA                     24800016
248100             MOVE 'TFGTRST'    TO DP013-DB2-TABLE-NAME (1)        24810016
248200             SET DP013-DB2-ABEND                                  24820016
248300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24830016
248400             PERFORM DP013-0000-PROCESS-ABEND                     24840016
248500     END-EVALUATE.                                                24850016
248600                                                                  24860016
248700                                                                  24870016
248800*----------------------------------------------------------------*24880016
248900* CLOSE THE CURSOR.                                               24890016
249000*----------------------------------------------------------------*24900016
249100                                                                  24910016
249200 8400-CLOSE-CURSOR-TWO.                                           24920016
249300*                                                                 24930016
249400     MOVE 'CURSOR 2'     TO DP013-MESSAGE-TEXT (2).               24940016
249500                                                                  24950016
249600     EXEC SQL                                                     24960016
249700          CLOSE CURSOR_TWO                                        24970016
249800     END-EXEC.                                                    24980016
249900                                                                  24990016
250000     EVALUATE TRUE                                                25000016
250100         WHEN SQLCODE = ZERO                                      25010016
250200             CONTINUE                                             25020016
250300         WHEN SQLWARN0 NOT = SPACES                               25030016
250400         WHEN SQLCODE  NOT = ZERO                                 25040016
250500             MOVE '8200-CLOSE-CURSOR-TWO'                         25050016
250600                               TO DP013-PARAGRAPH                 25060016
250700             MOVE 'CLOSE CURSOR'                                  25070016
250800                               TO DP013-MESSAGE-TEXT (1)          25080016
250900             MOVE SQLCA        TO DP013-SQLCA                     25090016
251000             MOVE 'TFGTRST '   TO DP013-DB2-TABLE-NAME (1)        25100016
251100             SET DP013-DB2-ABEND                                  25110016
251200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25120016
251300             PERFORM DP013-0000-PROCESS-ABEND                     25130016
251400     END-EVALUATE.                                                25140016
251500*----------------------------------------------------------------*25150016
251600*    READ THE SELECTION TEMPORARY STORAGE QUEUE                   25160016
251700*----------------------------------------------------------------*25170016
251800 9100-READ-SEL-QUEUE.                                             25180016
251900     EXEC CICS                                                    25190016
252000         READQ TS                                                 25200016
252100             QUEUE (ASC-SEL-QUEUE-NAME)                           25210016
252200             INTO  (ET308-SELECTED-VNDRS)                         25220016
252300             ITEM  (ASC-SEL-ITEM)                                 25230016
252400             RESP  (PV-CICS-RESP)                                 25240016
252500     END-EXEC.                                                    25250016
252600                                                                  25260016
252700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25270016
252800         CONTINUE                                                 25280016
252900     ELSE                                                         25290016
253000         SET DP013-LOGIC-ABEND                                    25300016
253100             DP013-NO-ROLLBACK     TO TRUE                        25310016
253200         MOVE '9100-READ-SEL-QUEUE'                               25320016
253300                                   TO DP013-PARAGRAPH             25330016
253400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   25340016
253500                                   TO DP013-MESSAGE-TEXT (1)      25350016
253600         PERFORM DP013-0000-PROCESS-ABEND                         25360016
253700     END-IF.                                                      25370016
253800*                                                                 25380016
253900******************************************************************25390016
254000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *25400016
254100******************************************************************25410016
254200 9200-REWRITE-SEL-QUEUE.                                          25420016
254300     EXEC CICS                                                    25430016
254400          WRITEQ TS                                               25440016
254500              QUEUE  (ASC-SEL-QUEUE-NAME)                         25450016
254600              FROM   (ET308-SELECTED-VNDRS)                       25460016
254700              ITEM   (ASC-SEL-ITEM)                               25470016
254800              RESP   (PV-CICS-RESP)                               25480016
254900              REWRITE                                             25490016
255000     END-EXEC.                                                    25500016
255100                                                                  25510016
255200     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   25520016
255300         SET DP013-CICS-ABEND                                     25530016
255400             DP013-NO-ROLLBACK     TO TRUE                        25540016
255500         MOVE '9200-REWRITE-SEL-QUEUE'                            25550016
255600                                   TO DP013-PARAGRAPH             25560016
255700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   25570016
255800                                   TO DP013-MESSAGE-TEXT (1)      25580016
255900         PERFORM DP013-0000-PROCESS-ABEND                         25590016
256000     END-IF.                                                      25600016
256100                                                                  25610016
256200 EJECT                                                            25620016
256300******************************************************************25630016
256400*    CURRENT SYSTEM DATE/TIME MODULE                              25640016
256500******************************************************************25650016
256600                                                                  25660016
256700     COPY DPPD017.                                                25670016
256800*----------------------------------------------------------------*25680016
256900*    ABEND PROCESSOR MODULE                                      *25690016
257000*----------------------------------------------------------------*25700016
257100                                                                  25710016
257200     COPY DPPD013.                                                25720016
