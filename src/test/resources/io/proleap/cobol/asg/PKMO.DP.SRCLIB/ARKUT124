000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKUT124.                                00050000
000600 AUTHOR.                 GERMAN BANDA.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            MARCH 2019.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*-----------------------------------------------------------------00110000
001200* THIS PROGRAM IS USED TO PRODUCE THE DAILY AR VOUCHER FILE THAT  00120000
001300* WILL BE SENT TO ORACLE ERP                                      00130000
001500*                                                                 00150000
003100*-----------------------------------------------------------------00310000
050222******************************************************************00311003
050222* DATE:        05/02/2022                                        *00312003
050222* WR/IR#:      CHG0269655                                        *00313004
050222* PROGRAMMER:  DAN PAYNTER                                       *00314003
050222* DESCRIPTION: ADD LATE AND CORRECTIONS CURSOR PROCESSING.       *00315003
003300******************************************************************00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500******************************************************************00350000
003600                                                                  00360000
003700 CONFIGURATION SECTION.                                           00370000
003800                                                                  00380000
003900 SOURCE-COMPUTER.        IBM-3090.                                00390000
004000 OBJECT-COMPUTER.        IBM-3090.                                00400000
004100                                                                  00410000
004200 INPUT-OUTPUT SECTION.                                            00420000
004300                                                                  00430000
004400 FILE-CONTROL.                                                    00440000
004500                                                                  00450000
004600      SELECT BATCH-DATE-IN          ASSIGN TO INP01.              00460000
004700      SELECT PO-VOUCHER-FILE        ASSIGN TO OUT01.              00470000
004800                                                                  00480000
004900******************************************************************00490000
005000 DATA DIVISION.                                                   00500000
005100******************************************************************00510000
005200                                                                  00520000
005300 FILE SECTION.                                                    00530000
005310 FD  BATCH-DATE-IN                                                00531000
005320     RECORDING MODE IS F                                          00532000
005330     LABEL RECORDS ARE STANDARD                                   00533000
005340     BLOCK CONTAINS 0 RECORDS.                                    00534000
005350                                                                  00535000
005360 01  BATCH-DATE-RECORD-IN               PIC  X(80).               00536000
005370                                                                  00537000
005400                                                                  00540000
005500 FD  PO-VOUCHER-FILE                                              00550000
005600     LABEL RECORDS ARE STANDARD                                   00560000
005700     BLOCK CONTAINS 0 RECORDS                                     00570000
005800     RECORDING MODE IS F                                          00580000
005900     RECORD CONTAINS 45 CHARACTERS                                00590000
006000     DATA RECORD IS PO-VOUCHER-RECORD.                            00600000
006100                                                                  00610000
006200 01  PO-VOUCHER-RECORD               PIC X(45).                   00620000
006300                                                                  00630000
007200*------------------------------------------------------*          00720000
007300 WORKING-STORAGE SECTION.                                         00730000
007400*------------------------------------------------------*          00740000
007500 01 PC-PROGRAM-CONSTANTS.                                         00750000
007600    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'ARKUT124'.  00760000
007900    05 PC-DATE-MODULE                PIC X(08) VALUE 'DPKUT500'.  00790000
008100                                                                  00810000
008200 01 DK-DATABASE-KEYS.                                             00820000
008400    05 DK-BATCH-PROCESS-DTE          PIC  X(10) VALUE SPACES.     00840000
008500                                                                  00850000
008600 01 PV-PROGRAM-VARIABLES.                                         00860000
010300    05 PV-LINE-COUNTER                PIC  9(04).                 01030000
010301    05 PV-NBR-RECORDS-FETCHED         PIC  9(04).                 01030100
050222    05 PV-LATE-COR-ROWS-FETCHED       PIC  9(04).                 01030202
010302    05 PV-NBR-RECORDS-WRITTEN         PIC  9(04).                 01030301
010303    05 PV-TRN-TOT-AMT-TAX             PIC S9(7)V9(2) USAGE COMP-3.01030401
010304    05 PV-TRN-TOT-AMT-NUM             PIC 9999999V99.             01030501
010315*                                                                 01031500
010320    05 PV-ABEND-CODE                 PIC S9(04)    VALUE +0.      01032000
010400    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   01040000
010500    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   01050000
010600    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   01060000
010700    05 PV-SQLCODE                    PIC Z(8)9-.                  01070000
010800    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   01080000
010900    05 PV-DATE-AREA                  PIC X(10)     VALUE SPACE.   01090000
011000    05 PV-START-CHECK-NUMBER         PIC S9(9) COMP VALUE ZEROES. 01100000
011100                                                                  01110000
011200 01 PS-PROGRAM-SWITCHES.                                          01120000
011210    05 PS-END-OF-CONTROL-SW          PIC  X(01)    VALUE 'N'.     01121000
011220       88  PS-END-OF-CONTROL                       VALUE 'Y'.     01122000
011230       88  PS-NOT-END-OF-CONTROL                   VALUE 'N'.     01123000
011240                                                                  01124000
011300    05 PS-END-OF-VOUCHER-SW          PIC X(01)     VALUE 'N'.     01130000
011400       88 PS-END-OF-VOUCHER                        VALUE 'Y'.     01140000
050222    05 PS-END-OF-LATE-COR-CSR-SW     PIC X(01)     VALUE 'N'.     01150002
050222       88 PS-END-OF-LATE-COR-CURSOR                VALUE 'Y'.     01160002
012000                                                                  01200000
012010 01  PV-INPUT-FILE.                                               01201000
012020     05  PIF-RUN-DATE                PIC  X(10)    VALUE SPACES.  01202000
012030     05  FILLER                      PIC  X(70)    VALUE SPACES.  01203000
012040 01  PV-HOLD-RECORD.                                              01204000
012050     05  PV-HOLD-STR-NBR             PIC  9(04)    VALUE ZEROS.   01205000
012060     05  PV-HOLD-CUST-ACCT-NBR       PIC  9(09)    VALUE ZEROS.   01206000
012080     05  PV-HOLD-SLS-DTE             PIC  X(10)    VALUE SPACES.  01208000
012090*                                                                 01209000
014010************************************************************      01401000
014020*  AR PO VOUCHER FILE LAYOUT                                      01402000
014030************************************************************      01403000
014040     COPY ARRD106.                                                01404000
014450******************************************************************01445000
014460*  DB2 FORMATTED MESSAGE AREA                                     01446000
014470******************************************************************01447000
014600     COPY DPWS004.                                                01460000
014700                                                                  01470000
014800     COPY DPWS500.                                                01480000
014900                                                                  01490000
015000     EXEC SQL                                                     01500000
015100          INCLUDE SQLCA                                           01510000
015200     END-EXEC.                                                    01520000
015300                                                                  01530000
015310******************************************************************01531000
015320*    COSA PARTITION TABLE                                        *01532000
015330******************************************************************01533000
015400     EXEC SQL                                                     01540000
015500          INCLUDE TEPPART                                         01550000
015600     END-EXEC.                                                    01560000
015610******************************************************************01561000
015620*    COSA TENDER TABLE                                           *01562000
015630******************************************************************01563000
015640     EXEC SQL                                                     01564000
015650          INCLUDE TEPTND                                          01565000
015660     END-EXEC.                                                    01566000
015700                                                                  01570000
015710******************************************************************01571000
015720*    COSA TRANSACTION TABLE                                      *01572000
015730******************************************************************01573000
015740     EXEC SQL                                                     01574000
015750          INCLUDE TEPTRN                                          01575000
015760     END-EXEC.                                                    01576000
015761******************************************************************01576100
015762*    COSA PO CUSTOMER TENDER TABLE   EPT_CUST_PO_TNDR            *01576200
015763******************************************************************01576300
015764     EXEC SQL                                                     01576400
015765          INCLUDE EPT00019                                        01576500
015767     END-EXEC.                                                    01576700
015770                                                                  01577000
015780******************************************************************01578000
015800     EXEC SQL                                                     01580000
015900          DECLARE VOUCHER-READ-CRS CURSOR FOR                     01590000
015910              SELECT  B.STR_NBR                                   01591000
015911                     ,B.RGST_ID                                   01591100
015920                     ,B.TRN_NBR                                   01592000
015921                     ,A.SLS_DTE                                   01592100
015922                     ,B.TNDR_AMT                                  01592200
015940                     ,D.QK_BK_AP_ACCT_NBR                         01594000
015950              FROM TEPPART A                                      01595000
015960                 , TEPTND B                                       01596000
015970                 , TEPTRN C                                       01597000
015980                 , EPT_CUST_PO_TNDR D                             01598000
015990              WHERE A.PARTN_NBR = B.PARTN_NBR                     01599000
015991                AND A.PARTN_NBR = C.PARTN_NBR                     01599100
015992                AND A.PARTN_NBR = D.PARTN_NBR                     01599200
015993                AND B.STR_NBR   = C.STR_NBR                       01599300
015994                AND B.STR_NBR   = D.STR_NBR                       01599400
015995                AND B.RGST_ID   = C.RGST_ID                       01599500
015996                AND B.RGST_ID   = D.RGST_ID                       01599600
015997                AND B.TRN_NBR   = C.TRN_NBR                       01599700
015998                AND B.TRN_NBR   = D.TRN_NBR                       01599800
050222                AND B.STRT_TM   = C.STRT_TM                       01599902
050222                AND B.STRT_TM   = D.STRT_TM                       01600002
050222                AND B.SLS_CORR_SEQ_NBR                            01600102
050222                                = C.SLS_CORR_SEQ_NBR              01600202
050222                AND B.SLS_CORR_SEQ_NBR                            01600302
050222                                = D.SLS_CORR_SEQ_NBR              01600402
015999                AND B.TNDR_TYP_CDE = '90'                         01600502
016000                AND B.TNDR_VOID_IND = 'N'                         01600602
016001                AND C.VOID_ABRT_CDE = 'N'                         01600702
016002                AND C.TRN_STAT_CDE  = 'Z'                         01600802
016003                AND A.SLS_DTE = :PIF-RUN-DATE                     01600902
050222          ORDER BY A.SLS_DTE,B.STR_NBR,D.QK_BK_AP_ACCT_NBR,       01601002
016005                  B.RGST_ID, B.TRN_NBR                            01602002
016900     END-EXEC.                                                    01690000
017000                                                                  01700000
050222******************************************************************01701002
050222*  CURSOR TO CONTROL THE RETRIEVAL OF THE LATE AND CORRECTION     01702002
050222*  TRANSACTIONS                                                   01703002
050222******************************************************************01704002
050222     EXEC SQL                                                     01705002
050222      DECLARE LATE-COR-CSR CURSOR FOR                             01706002
050222       SELECT B.STR_NBR                                           01707002
050222             ,B.RGST_ID                                           01708002
050222             ,B.TRN_NBR                                           01709002
050222             ,F.SLS_DTE                                           01709102
050222             ,B.TNDR_AMT                                          01709202
050222             ,E.QK_BK_AP_ACCT_NBR                                 01709302
050222      FROM TEPTRN A                                               01711502
050222          ,TEPTND B                                               01711602
050222          ,TEPDKEY D                                              01711702
050222          ,EPT_CUST_PO_TNDR E                                     01711802
050222          ,TEPPART F                                              01711902
050222      WHERE A.PARTN_NBR     = B.PARTN_NBR                         01712002
050222       AND A.STR_NBR       = B.STR_NBR                            01712102
050222       AND A.RGST_ID       = B.RGST_ID                            01712202
050222       AND A.TRN_NBR       = B.TRN_NBR                            01712302
050222       AND A.STRT_TM       = B.STRT_TM                            01712402
050222       AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR                01712502
050222       AND A.PARTN_NBR     = F.PARTN_NBR                          01712602
050222       AND D.SLS_DTE       = F.SLS_DTE                            01712702
050222       AND A.STR_NBR       = D.STR_NBR                            01712802
050222       AND A.RGST_ID       = D.RGST_ID                            01712902
050222       AND A.TRN_NBR       = D.TRN_NBR                            01713002
050222       AND A.STRT_TM       = D.STRT_TM                            01713102
050222       AND A.SLS_CORR_SEQ_NBR = D.SLS_CORR_SEQ_NBR                01713202
050222       AND B.PARTN_NBR     = E.PARTN_NBR                          01713302
050222       AND B.STR_NBR       = E.STR_NBR                            01713402
050222       AND B.RGST_ID       = E.RGST_ID                            01713502
050222       AND B.TRN_NBR       = E.TRN_NBR                            01713602
050222       AND B.STRT_TM       = E.STRT_TM                            01713702
050222       AND B.SLS_CORR_SEQ_NBR = E.SLS_CORR_SEQ_NBR                01713802
050222       AND D.PRCG_DTE      = :PIF-RUN-DATE                        01714002
050222       AND B.TNDR_TYP_CDE = '90'                                  01714102
050222       AND B.TNDR_VOID_IND = 'N'                                  01714202
050222       AND A.VOID_ABRT_CDE = 'N'                                  01714302
050222       AND A.TRN_STAT_CDE  IN ('V','L')                           01714402
050222      ORDER BY F.SLS_DTE,B.STR_NBR,E.QK_BK_AP_ACCT_NBR,           01721702
050222               B.RGST_ID, B.TRN_NBR                               01721802
050222      WITH UR                                                     01732802
050222     END-EXEC.                                                    01732902
050222                                                                  01733002
017100********************************************************          01733100
017200 PROCEDURE DIVISION.                                              01733200
017300********************************************************          01734000
017400 0000-MAIN.                                                       01740000
017500                                                                  01750000
017510     DISPLAY ' '.                                                 01751000
017520     DISPLAY '***** ARKUT124 STARTED *****'.                      01752000
017530                                                                  01753000
017600     PERFORM 1000-INITIALIZE.                                     01760000
017700                                                                  01770000
018000     PERFORM 3000-CREATE-PO-VOUCHER-FILE.                         01800000
018300                                                                  01830000
018400     PERFORM 5000-CLOSE.                                          01840000
018500                                                                  01850000
018510     DISPLAY ' '.                                                 01851000
018520     DISPLAY '***** ARKUT124 ENDED   *****'.                      01852000
018530     DISPLAY '***** RECORDS FETCHED  *****' PV-NBR-RECORDS-FETCHED01853000
050222     DISPLAY '* LATE CORR RECS FETCHED *' PV-LATE-COR-ROWS-FETCHED01853102
018540     DISPLAY '***** RECORDS WRITTEN  *****' PV-NBR-RECORDS-WRITTEN01854000
018550*                                                                 01855000
018600     GOBACK.                                                      01860000
018700                                                                  01870000
018800********************************************************          01880000
018900 1000-INITIALIZE.                                                 01890000
019000********************************************************          01900000
019100                                                                  01910000
019200     OPEN INPUT BATCH-DATE-IN                                     01920000
019300     OPEN OUTPUT PO-VOUCHER-FILE.                                 01930000
019400                                                                  01940000
019401     PERFORM 1200-READ-CONTROL-CARD.                              01940100
019410******************************************************************01941000
019420*  READ INPUT CONTROL CARD TO GET THE CURRENT BATCH PROCESSING    01942000
019430*  DATE.                                                          01943000
019440******************************************************************01944000
019450 1200-READ-CONTROL-CARD.                                          01945000
019460                                                                  01946000
019470     READ BATCH-DATE-IN                                           01947000
019480         INTO PV-INPUT-FILE                                       01948000
019490             AT END                                               01949000
019491                 MOVE 'Y' TO PS-END-OF-CONTROL-SW.                01949100
019492                                                                  01949200
019493     IF PS-END-OF-CONTROL                                         01949300
019494         DISPLAY ' '                                              01949400
019495         DISPLAY ' *** NO CONTROL CARD FOUND TO PROCESS ***'      01949500
019496         DISPLAY ' '                                              01949600
019497     ELSE                                                         01949700
019498         DISPLAY 'BATCH PROCESSING CONTROL CARD DATE  = '         01949800
019499                 PIF-RUN-DATE                                     01949900
019500     END-IF.                                                      01950000
019501                                                                  01950100
021100********************************************************          02110000
021200 3000-CREATE-PO-VOUCHER-FILE.                                     02120000
021300********************************************************          02130000
021400     MOVE +0   TO   PV-LINE-COUNTER.                              02140000
050222                                                                  02141002
050222     PERFORM 7300-OPEN-LATE-COR-CURSOR.                           02142002
050222     PERFORM 7400-FETCH-LATE-COR-CURSOR.                          02143002
050222                                                                  02144002
050222     PERFORM 3200-WRITE-LATE-SC-PO-VOUCHER                        02145002
050222        UNTIL PS-END-OF-LATE-COR-CURSOR.                          02146002
050222                                                                  02147002
050222     PERFORM 7500-CLOSE-LATE-COR-CURSOR.                          02148002
050222                                                                  02149002
021500     PERFORM 7000-OPEN-VOUCHER-CRSR.                              02150000
021600     PERFORM 7100-FETCH-VOUCHER-CRSR.                             02160000
021700                                                                  02170000
021800     PERFORM 3100-WRITE-PO-VOUCHER                                02180000
021900        UNTIL PS-END-OF-VOUCHER.                                  02190000
022000                                                                  02200000
022100     PERFORM 7200-CLOSE-VOUCHER-CRSR.                             02200101
022400                                                                  02240000
022500********************************************************          02250000
022600 3100-WRITE-PO-VOUCHER.                                           02260000
022700********************************************************          02270000
022900     IF EPTND-STR-NBR                  = PV-HOLD-STR-NBR          02290000
023000        AND EPT00019-QK-BK-AP-ACCT-NBR = PV-HOLD-CUST-ACCT-NBR    02300000
023010        AND EPPART-SLS-DTE             = PV-HOLD-SLS-DTE          02301000
023020           ADD +1 TO PV-LINE-COUNTER                              02302000
023100     ELSE                                                         02310000
023110        MOVE EPTND-STR-NBR        TO PV-HOLD-STR-NBR              02311000
023120        MOVE EPT00019-QK-BK-AP-ACCT-NBR                           02312000
023121                                  TO PV-HOLD-CUST-ACCT-NBR        02312100
023130        MOVE EPPART-SLS-DTE       TO PV-HOLD-SLS-DTE              02313000
023140        MOVE +1                   TO PV-LINE-COUNTER              02314000
023300     END-IF.                                                      02330000
023400                                                                  02340000
023600                                                                  02360000
023700     MOVE EPTND-STR-NBR              TO AR106-STR-NBR             02370000
023710     MOVE EPT00019-QK-BK-AP-ACCT-NBR TO AR106-CUST-ACCT-NBR       02371000
023720     MOVE PV-LINE-COUNTER            TO AR106-LINE-NBR            02372000
023800     MOVE EPTND-RGST-ID              TO AR106-RGST-NBR            02380000
023900     MOVE EPTND-TRN-NBR              TO AR106-TRN-NBR             02390000
024000     MOVE EPPART-SLS-DTE             TO AR106-SLS-DTE             02400000
024020                                                                  02402000
024100     MOVE EPTND-TNDR-AMT             TO PV-TRN-TOT-AMT-NUM        02410000
024126                                                                  02412600
024133     MOVE PV-TRN-TOT-AMT-NUM         TO AR106-AMT                 02413300
024134                                                                  02413400
024135     IF  EPTND-TNDR-AMT    < 0                                    02413500
024136         MOVE '-'                    TO AR106-AMT-SIGN            02413600
024137     ELSE                                                         02413700
024138         MOVE ' '                    TO AR106-AMT-SIGN            02413800
024140     END-IF                                                       02414000
025200                                                                  02520000
025300     WRITE PO-VOUCHER-RECORD                                      02530000
025400         FROM AR106-PO-VOUCHER-RECORD.                            02540000
025500     ADD +1 TO PV-NBR-RECORDS-WRITTEN.                            02550000
025600     PERFORM 7100-FETCH-VOUCHER-CRSR.                             02560001
025700                                                                  02570000
050222********************************************************          02570102
050222 3200-WRITE-LATE-SC-PO-VOUCHER.                                   02570202
050222********************************************************          02570302
050222     IF EPTND-STR-NBR                  = PV-HOLD-STR-NBR          02751002
050222        AND EPT00019-QK-BK-AP-ACCT-NBR = PV-HOLD-CUST-ACCT-NBR    02752002
050222        AND EPPART-SLS-DTE             = PV-HOLD-SLS-DTE          02753002
050222           ADD +1 TO PV-LINE-COUNTER                              02754002
050222     ELSE                                                         02755002
050222        MOVE EPTND-STR-NBR        TO PV-HOLD-STR-NBR              02756002
050222        MOVE EPT00019-QK-BK-AP-ACCT-NBR                           02757002
050222                                  TO PV-HOLD-CUST-ACCT-NBR        02758002
050222        MOVE EPPART-SLS-DTE       TO PV-HOLD-SLS-DTE              02759002
050222        MOVE +1                   TO PV-LINE-COUNTER              02759102
050222     END-IF.                                                      02759202
050222                                                                  02759302
050222                                                                  02759402
050222     MOVE EPTND-STR-NBR              TO AR106-STR-NBR             02759502
050222     MOVE EPT00019-QK-BK-AP-ACCT-NBR TO AR106-CUST-ACCT-NBR       02759602
050222     MOVE PV-LINE-COUNTER            TO AR106-LINE-NBR            02759702
050222     MOVE EPTND-RGST-ID              TO AR106-RGST-NBR            02759802
050222     MOVE EPTND-TRN-NBR              TO AR106-TRN-NBR             02759902
050222     MOVE EPPART-SLS-DTE             TO AR106-SLS-DTE             02760002
050222                                                                  02760102
050222     MOVE EPTND-TNDR-AMT             TO PV-TRN-TOT-AMT-NUM        02760202
050222                                                                  02760302
050222     MOVE PV-TRN-TOT-AMT-NUM         TO AR106-AMT                 02760402
050222                                                                  02760502
050222     IF  EPTND-TNDR-AMT    < 0                                    02760602
050222         MOVE '-'                    TO AR106-AMT-SIGN            02760702
050222     ELSE                                                         02760802
050222         MOVE ' '                    TO AR106-AMT-SIGN            02760902
050222     END-IF                                                       02761002
050222                                                                  02761102
050222     WRITE PO-VOUCHER-RECORD                                      02761202
050222         FROM AR106-PO-VOUCHER-RECORD.                            02761302
050222     ADD +1 TO PV-NBR-RECORDS-WRITTEN.                            02761402
050222     PERFORM 7400-FETCH-LATE-COR-CURSOR.                          02761502
050222                                                                  02770002
034200********************************************************          03420000
034300 5000-CLOSE.                                                      03430000
034400********************************************************          03440000
034500                                                                  03450000
034600       CLOSE BATCH-DATE-IN                                        03460000
034700             PO-VOUCHER-FILE.                                     03470000
034800********************************************************          03480000
034900 7000-OPEN-VOUCHER-CRSR.                                          03490000
035000********************************************************          03500000
035100       EXEC SQL                                                   03510000
035200            OPEN VOUCHER-READ-CRS                                 03520000
035300       END-EXEC.                                                  03530000
035400                                                                  03540000
035500       EVALUATE TRUE                                              03550000
035600          WHEN SQLCODE = ZERO                                     03560000
035700               CONTINUE                                           03570000
035800          WHEN OTHER                                              03580000
035900               MOVE '7000-OPEN-VOUCHER-CRSR' TO PV-ABEND-PARA-NAME03590000
036000               MOVE 'OPEN CURSOR'        TO PV-DB2-OPERATION-MSG-103600000
036100               MOVE 'TCRRFND'                TO PV-DB2-TABLE-NAME 03610000
036200               PERFORM 9998-SQL-ABEND                             03620000
036300       END-EVALUATE.                                              03630000
036400                                                                  03640000
036500********************************************************          03650000
036600 7100-FETCH-VOUCHER-CRSR.                                         03660000
036700********************************************************          03670000
036800       EXEC SQL                                                   03680000
036900           FETCH VOUCHER-READ-CRS                                 03690000
037000           INTO  :EPTND-STR-NBR                                   03700000
037100                ,:EPTND-RGST-ID                                   03710000
037200                ,:EPTND-TRN-NBR                                   03720000
037300                ,:EPPART-SLS-DTE                                  03730000
037400                ,:EPTND-TNDR-AMT                                  03740000
037410                ,:EPT00019-QK-BK-AP-ACCT-NBR                      03741000
037500       END-EXEC.                                                  03750000
037600                                                                  03760000
037700       EVALUATE TRUE                                              03770000
037800           WHEN SQLCODE = ZERO                                    03780000
037900               ADD +1 TO PV-NBR-RECORDS-FETCHED                   03790000
038000           WHEN SQLCODE = +100                                    03800000
038100               SET  PS-END-OF-VOUCHER TO TRUE                     03810000
038200           WHEN OTHER                                             03820000
038300               MOVE '7100-FETCH-PROCESS-ROW' TO PV-ABEND-PARA-NAME03830000
038400               MOVE 'FETCH VOUCHER-CRS'  TO PV-DB2-OPERATION-MSG-103840000
038500               MOVE 'TEPTND '           TO PV-DB2-TABLE-NAME      03850000
038600               PERFORM 9998-SQL-ABEND                             03860000
038700       END-EVALUATE.                                              03870000
038800                                                                  03880000
038900********************************************************          03890000
039000 7200-CLOSE-VOUCHER-CRSR.                                         03900000
039100********************************************************          03910000
039200       EXEC SQL                                                   03920000
039300           CLOSE VOUCHER-READ-CRS                                 03930000
039400       END-EXEC.                                                  03940000
039500                                                                  03950000
050222***************************************************************** 03951002
050222*  OPEN THE LATE / CORRECTIONS CURSOR                             03952002
050222***************************************************************** 03953002
050222 7300-OPEN-LATE-COR-CURSOR.                                       03954002
050222                                                                  03955002
050222     EXEC SQL                                                     03956002
050222         OPEN LATE-COR-CSR                                        03957002
050222     END-EXEC.                                                    03958002
050222                                                                  03959002
050222     EVALUATE TRUE                                                03959102
050222         WHEN SQLCODE = ZERO                                      03959202
050222             CONTINUE                                             03959302
050222         WHEN SQLWARN0 NOT EQUAL SPACE                            03959402
050222         WHEN SQLCODE NOT EQUAL ZERO                              03959502
050222             MOVE '7300-OPEN-LATE-COR-CURSOR'                     03959602
050222                                      TO PV-ABEND-PARA-NAME       03960102
050222             MOVE 'OPEN LATE-COR-CRS' TO PV-DB2-OPERATION-MSG-1   03960202
050222             MOVE 'TEPTND '           TO PV-DB2-TABLE-NAME        03960302
050222             PERFORM 9998-SQL-ABEND                               03960402
050222     END-EVALUATE.                                                03960502
050222                                                                  03960602
050222******************************************************************03960702
050222*  FETCH THE LATE AND SALES CORRECTION CURSOR                     03960802
050222******************************************************************03960902
050222 7400-FETCH-LATE-COR-CURSOR.                                      03961002
050222                                                                  03961102
050222     EXEC SQL                                                     03961202
050222         FETCH LATE-COR-CSR                                       03961302
050222         INTO  :EPTND-STR-NBR                                     03961402
050222              ,:EPTND-RGST-ID                                     03961502
050222              ,:EPTND-TRN-NBR                                     03961602
050222              ,:EPPART-SLS-DTE                                    03961702
050222              ,:EPTND-TNDR-AMT                                    03961802
050222              ,:EPT00019-QK-BK-AP-ACCT-NBR                        03961902
050222     END-EXEC.                                                    03964502
050222                                                                  03964602
050222     EVALUATE TRUE                                                03964702
050222         WHEN SQLCODE = ZERO                                      03964802
050222             ADD +1 TO PV-LATE-COR-ROWS-FETCHED                   03964902
050222         WHEN SQLCODE = +100                                      03965402
050222             SET PS-END-OF-LATE-COR-CURSOR                        03965502
050222                                   TO TRUE                        03965602
050222         WHEN SQLWARN0 NOT EQUAL SPACE                            03965702
050222         WHEN SQLCODE NOT EQUAL ZERO                              03965802
050222             MOVE '7400-FETCH-LATE-COR-CURSOR'                    03966402
050222                                      TO PV-ABEND-PARA-NAME       03966502
050222             MOVE 'FETCH LATE-COR-CR' TO PV-DB2-OPERATION-MSG-1   03966602
050222             MOVE 'TEPTND '           TO PV-DB2-TABLE-NAME        03966702
050222             PERFORM 9998-SQL-ABEND                               03966802
050222     END-EVALUATE.                                                03966902
050222                                                                  03967002
050222***************************************************************** 03967102
050222*  CLOSE THE LATE COR CURSOR                                      03967202
050222***************************************************************** 03967302
050222 7500-CLOSE-LATE-COR-CURSOR.                                      03967402
050222                                                                  03967502
050222     EXEC SQL                                                     03967602
050222         CLOSE LATE-COR-CSR                                       03967702
050222     END-EXEC.                                                    03967802
050222                                                                  03967902
050222     EVALUATE TRUE                                                03968002
050222         WHEN SQLCODE = ZERO                                      03968102
050222             CONTINUE                                             03968202
050222         WHEN SQLWARN0 NOT EQUAL SPACE                            03968302
050222         WHEN SQLCODE NOT EQUAL ZERO                              03968402
050222             MOVE '7500-CLOSE-LATE-COR-CURSOR'                    03968502
050222                                      TO PV-ABEND-PARA-NAME       03969002
050222             MOVE 'CLOSE LATE-COR-CR' TO PV-DB2-OPERATION-MSG-1   03969102
050222             MOVE 'TEPTND '           TO PV-DB2-TABLE-NAME        03969202
050222             PERFORM 9998-SQL-ABEND                               03969302
050222     END-EVALUATE.                                                03969402
050222                                                                  03969502
039600********************************************************          03969601
039700 9998-SQL-ABEND.                                                  03970000
039800********************************************************          03980000
039900     MOVE SQLCODE     TO PV-SQLCODE.                              03990000
040000     DISPLAY '** ABEND           ** = SQLABEND'.                  04000000
040100     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          04010000
040200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        04020000
040300     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        04030000
040400     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   04040000
040500     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               04050000
040600     COPY DPPD004.                                                04060000
040700                                                                  04070000
040800     EXEC SQL                                                     04080000
040900          ROLLBACK                                                04090000
041000     END-EXEC.                                                    04100000
041100                                                                  04110000
041200     MOVE +4013                  TO PV-ABEND-CODE.                04120000
041300     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       04130000
