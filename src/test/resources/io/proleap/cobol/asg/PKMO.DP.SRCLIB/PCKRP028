000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.             PCKRP028.                                00020000
000300 AUTHOR.                 AL PETERS.                               00030000
000400 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00040000
000500 DATE-WRITTEN.           FEB, 2008.                               00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800* THIS WILL PRODUCE THE 'INVENTORY SUSPENSE REPORT' WITH          00080000
000900* UNBALANCED STORE EXPECTED AFTER INVENTORY REVERSAL PROCESS.     00090000
001000                                                                  00100000
001100 ENVIRONMENT DIVISION.                                            00110000
001200 CONFIGURATION SECTION.                                           00120000
001300 SOURCE-COMPUTER.                        IBM-3090.                00130000
001400 OBJECT-COMPUTER.                        IBM-3090.                00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600 FILE-CONTROL.                                                    00160000
001700                                                                  00170000
001800     SELECT EXTRACT-FILE                                          00180000
001900         ASSIGN TO INP01.                                         00190000
002000                                                                  00200000
002100     SELECT  REPORT-FILE                                          00210000
002200         ASSIGN TO RPT01.                                         00220000
002300                                                                  00230000
002400 DATA DIVISION.                                                   00240000
002500 FILE SECTION.                                                    00250000
002600                                                                  00260000
002700 FD  EXTRACT-FILE                                                 00270000
002800     RECORDING MODE IS F                                          00280000
002900     LABEL RECORDS ARE STANDARD                                   00290000
003000     BLOCK CONTAINS 0 RECORDS.                                    00300000
003100 01  ERROR-RECORD                     PIC X(150).                 00310000
003200                                                                  00320000
003300 FD  REPORT-FILE                                                  00330000
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700 01  REPORT-RECORD                    PIC X(160).                 00370000
003800/                                                                 00380000
003900 WORKING-STORAGE SECTION.                                         00390000
004000 01  PS-SWITCHES.                                                 00400000
004100     05  PS-EOF-ERROR-SWITCH          PIC X(01) VALUE 'N'.        00410000
004200         88  PS-EOF-ERROR-FILE                  VALUE 'Y'.        00420000
004300                                                                  00430000
007000     05  PS-CARTON-CSR-SW         PIC  X(01)  VALUE  'N'.         00440000
007100         88  PS-NOT-END-OF-CARTON-CSR         VALUE  'N'.         00450000
007200         88  PS-END-OF-CARTON-CSR             VALUE  'Y'.         00460000
                                                                        00470000
004400 01  DK-DB-KEYS.                                                  00480000
004500     05  DK-STORE-NBR                 PIC S9(04) COMP VALUE ZERO. 00490000
004600     05  DK-LINE-NBR                  PIC S9(09) COMP VALUE ZERO. 00500000
004700                                                                  00510000
004800 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00520000
004900                                                 COMP SYNC.       00530000
005000     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00540000
005100                                                                  00550000
005200 01  SD-SYSTEM-DATE.                                              00560000
005300     05  SD-SYSTEM-DATE-YY          PIC  9(02)   VALUE ZERO.      00570000
005400     05  SD-SYSTEM-DATE-MM          PIC  9(02)   VALUE ZERO.      00580000
005500     05  SD-SYSTEM-DATE-DD          PIC  9(02)   VALUE ZERO.      00590000
005600                                                                  00600000
005700 01  ST-SYSTEM-TIME.                                              00610000
005800     05  ST-SYSTEM-HOUR             PIC  9(02)   VALUE ZERO.      00620000
005900     05  ST-SYSTEM-MINUTE           PIC  9(02)   VALUE ZERO.      00630000
006000     05  FILLER                     PIC  9(04)   VALUE ZERO.      00640000
006100                                                                  00650000
006200 01  PV-VARIABLES.                                                00660000
006300     05  PV-TMST                      PIC X(26) VALUE SPACES.     00670000
006300     05  PV-DIVERT-TMST               PIC X(26) VALUE SPACES.     00680000
006300     05  PV-DIVERT-DATE-TIME          PIC X(17) VALUE SPACES.     00690000
006400     05  PV-READ-COUNT                PIC S9(7) COMP-3            00700000
006500                                                VALUE ZERO.       00710000
0618       05  PV-BOSS-COUNT                PIC S9(7) COMP-3            00720008
0618                                                  VALUE ZERO.       00730008
006510*    05  PV-UT713-COUNT               PIC S9(7) COMP-3            00740000
006520*                                               VALUE ZERO.       00750000
006600     05  PV-WRITE-COUNT               PIC S9(7) COMP-3            00760000
006700                                                VALUE ZERO.       00770000
006800     05  PV-PAGE-COUNT                PIC S9(7) COMP-3            00780000
006900                                                VALUE ZERO.       00790000
007000     05  PV-LINES-USED                PIC S9(4) COMP-3            00800000
007100                                                VALUE ZERO.       00810000
007200     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       00820000
007300                                                 COMP SYNC.       00830000
007400     05  PV-DB2-FUNCTION              PIC X(30) VALUE SPACES.     00840000
007500     05  PV-PARAGRAPH                 PIC X(30) VALUE SPACES.     00850000
007600     05  PV-DISP-NUMBER               PIC Z,ZZZ,ZZ9.              00860000
007610     05  PV-DISP-LOC                  PIC ZZZ9.                   00870000
007700     05  PV-DISP-COUNT                PIC Z,ZZZ,ZZZ,ZZ9.          00880000
007800     05  PV-PREV-OPER                 PIC 9(05).                  00890000
007900     05  PV-PREV-LOC                  PIC 9(04) COMP VALUE ZEROES.00900000
008000     05  PV-PREV-PO                   PIC S9(09) COMP VALUE +0.   00910000
008100     05  PV-PREV-RCVR                 PIC S9(09) COMP VALUE +0.   00920000
008200     05  PV-PREV-TRIP                 PIC S9(09) COMP VALUE +0.   00930000
008300     05  PV-PREV-CARTON               PIC S9(18)V     VALUE +0.   00940000
008400     05  PV-PREV-LINE                 PIC  9(04) VALUE ZEROES.    00950000
008500     05  PV-PREV-LINE-X REDEFINES PV-PREV-LINE                    00960000
008600                                      PIC  X(04).                 00970000
008700     05  PV-CLEAN4-DAYS               PIC S9(09) COMP.            00980000
008800     05  PV-TRIP                      PIC Z(10).                  00990000
008810     05  PV-PREV-CARTON-ID            PIC S9(18)V VALUE ZEROES.   01000000
008820     05  PV-PREV-STATUS               PIC X(58)   VALUE SPACES.   01010000
008900     05  PV-CARTON                    PIC Z(18).                  01020000
008900     05  PV-CARTON-ID                 PIC S9(18)V COMP-3          01030000
009000                                                  VALUE ZEROES.   01040000
0518       05  PV-BOSS-PARM-RECV            PIC S9(09)  COMP.           01050002
0618       05  PV-BOSS-PARM-DISP            PIC -9(04).                 01060006
009100     05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.     01070000
009200     05  PV-SAVE-START-DATE           PIC X(10) VALUE SPACES.     01080000
009210*    05  PV-TALLY                     PIC S9(09) COMP.            01090000
009220     05  PV-DB2-DATE.                                             01100000
009230         10  PV-DB2-CC                  PIC X(02).                01110000
009240         10  PV-DB2-YY                  PIC X(02).                01120000
009250         10  FILLER                     PIC X(01).                01130000
009260         10  PV-DB2-MM                  PIC X(02).                01140000
009270         10  FILLER                     PIC X(01).                01150000
009280         10  PV-DB2-DD                  PIC X(02).                01160000
009290         10  FILLER                     PIC X(01).                01170000
009300         10  PV-DB2-HH                  PIC X(02).                01180000
009400         10  FILLER                     PIC X(01).                01190000
009500         10  PV-DB2-MN                  PIC X(02).                01200000
009600         10  FILLER                     PIC X(01).                01210000
009700         10  PV-DB2-SS                  PIC X(09).                01220000
009800     05  PV-KEY-DATE.                                             01230000
009900         10  PV-KEY-MM               PIC X(02).                   01240000
010000         10  PV-KEY-SLASH-1          PIC X(01) VALUE '/'.         01250000
010100         10  PV-KEY-DD               PIC X(02).                   01260000
010200         10  PV-KEY-SLASH-2          PIC X(01) VALUE '/'.         01270000
010300         10  PV-KEY-YY               PIC X(02).                   01280000
010400                                                                  01290000
010500     05  PV-KEY-INTR-DATE.                                        01300000
010600         10  PV-KEY-INTR-MM          PIC X(02).                   01310000
010700         10  FILLER                  PIC X(01) VALUE '/'.         01320000
010800         10  PV-KEY-INTR-DD          PIC X(02).                   01330000
010900         10  FILLER                  PIC X(01) VALUE '/'.         01340000
011000         10  PV-KEY-INTR-YY          PIC X(02).                   01350000
011100                                                                  01360000
011200     05  PV-INTR-TRN-DTE.                                         01370000
011300         10  PV-INTR-CC                 PIC X(02).                01380000
011400         10  PV-INTR-YY                 PIC X(02).                01390000
011500         10  FILLER                     PIC X(01).                01400000
011600         10  PV-INTR-MM                 PIC X(02).                01410000
011700         10  FILLER                     PIC X(01).                01420000
011800         10  PV-INTR-DD                 PIC X(02).                01430000
011900                                                                  01440000
012000     05  PV-SHPD-UNT-QTY                PIC S9(09)V  COMP-3.      01450000
012001                                                                  01460000
012002 01  PC-CONSTANTS.                                                01470000
012003     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRP028'. 01480000
012004     05  PC-END-OF-PAGE               PIC S9(3) COMP-3 VALUE +60. 01490000
012005     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3  COMP.  01500000
012006                                                                  01510000
012007***  STANDARD REPORT HEADER FOR 150 COLUMN REPORT                 01520000
012008     COPY DPWS150O.                                               01530000
012009                                                                  01540000
012100*    ERROR EXTRACT                                                01550000
012200     COPY PCRD038.                                                01560000
012300                                                                  01570000
012400*COPYBOOK FOR CARTON STATUS MODULE - PCKUT713                     01580000
012500     COPY PCWS046.                                                01590000
012600                                                                  01600000
012700 01  HL-HEADING-LINE-1.                                           01610000
012800     05  FILLER                      PIC  X(62)  VALUE SPACES.    01620000
012900     05  FILLER                      PIC  X(25)  VALUE            01630000
013000      'INVENTORY SUSPENSE REPORT'.                                01640000
013200                                                                  01650000
013300 01  HL-HEADING-LINE-1A.                                          01660000
013400     05  FILLER                      PIC  X(51)  VALUE SPACES.    01670000
013500     05  FILLER                      PIC  X(46)  VALUE            01680000
013600      'UNBALANCED SE AFTER INVENTORY REVERSAL PROCESS'.           01690000
014000                                                                  01700000
014100 01  HL-HEADING-LINE-2A.                                          01710000
014200     05  FILLER                      PIC  X(06) VALUE  SPACES.    01720000
014300     05  FILLER                      PIC  X(03) VALUE             01730000
014400         'DPT'.                                                   01740000
014500     05  FILLER                      PIC  X(01) VALUE  SPACES.    01750000
014600     05  FILLER                      PIC  X(03) VALUE             01760000
014700         'SUB'.                                                   01770000
014800     05  FILLER                      PIC  X(10) VALUE  SPACES.    01780000
014900     05  FILLER                      PIC  X(04) VALUE             01790000
015000         'LINE'.                                                  01800000
015001     05  FILLER                      PIC  X(28) VALUE  SPACES.    01810000
015002     05  FILLER                      PIC  X(03) VALUE             01820000
015003         'REC'.                                                   01830000
015004     05  FILLER                      PIC  X(02) VALUE  SPACES.    01840000
015005     05  FILLER                      PIC  X(04) VALUE             01850000
015006         'ORIG'.                                                  01860000
015100     05  FILLER                      PIC  X(03) VALUE  SPACES.    01870000
015200     05  FILLER                      PIC  X(04) VALUE             01880000
015300         'LAST'.                                                  01890000
015400     05  FILLER                      PIC  X(05) VALUE  SPACES.    01900000
015500     05  FILLER                      PIC  X(02) VALUE             01910000
015600         'UN'.                                                    01920000
015601     05  FILLER                      PIC  X(01) VALUE  SPACES.    01930000
015602     05  FILLER                      PIC  X(02) VALUE             01940000
015603         'SE'.                                                    01950000
015604     05  FILLER                      PIC  X(01) VALUE  SPACES.    01960000
015605     05  FILLER                      PIC  X(02) VALUE             01970000
015606         'UN'.                                                    01980000
015607     05  FILLER                      PIC  X(01) VALUE  SPACES.    01990000
015608     05  FILLER                      PIC  X(02) VALUE             02000000
015609         'IT'.                                                    02010000
015610     05  FILLER                      PIC  X(01) VALUE  SPACES.    02020000
015611     05  FILLER                      PIC  X(05) VALUE             02030000
015612         'CLEAN'.                                                 02040000
015613     05  FILLER                      PIC  X(03) VALUE  SPACES.    02050000
015614     05  FILLER                      PIC  X(04) VALUE             02060000
015615         'CRTN'.                                                  02070000
015800                                                                  02080000
015900 01  HL-HEADING-LINE-2.                                           02090000
016000     05  FILLER                      PIC  X(01) VALUE  SPACES.    02100000
016100     05  FILLER                      PIC  X(04) VALUE             02110000
016200         'STOR'.                                                  02120000
016300     05  FILLER                      PIC  X(01) VALUE  SPACES.    02130000
016400     05  FILLER                      PIC  X(03) VALUE             02140000
016500         'NBR'.                                                   02150000
016501     05  FILLER                      PIC  X(01) VALUE  SPACES.    02160000
016502     05  FILLER                      PIC  X(03) VALUE             02170000
016503         'CLS'.                                                   02180000
016504     05  FILLER                      PIC  X(03) VALUE  SPACES.    02190000
016505     05  FILLER                      PIC  X(03) VALUE             02200000
016506         'SKU'.                                                   02210000
016507     05  FILLER                      PIC  X(04) VALUE  SPACES.    02220000
016508     05  FILLER                      PIC  X(03) VALUE             02230000
016509         'NBR'.                                                   02240000
016510     05  FILLER                      PIC  X(03) VALUE  SPACES.    02250000
016511     05  FILLER                      PIC  X(02) VALUE             02260000
016512         'DC'.                                                    02270000
016600     05  FILLER                      PIC  X(02) VALUE  SPACES.    02280000
016700     05  FILLER                      PIC  X(11) VALUE             02290000
016800         'PO/RECEIVER'.                                           02300000
016900     05  FILLER                      PIC  X(02) VALUE  SPACES.    02310000
017000     05  FILLER                      PIC  X(08) VALUE             02320000
017100         'VRFD DTE'.                                              02330000
017200     05  FILLER                      PIC  X(01) VALUE  SPACES.    02340000
017300     05  FILLER                      PIC  X(03) VALUE             02350000
017400         'TYP'.                                                   02360000
017500     05  FILLER                      PIC  X(01) VALUE  SPACES.    02370000
017600     05  FILLER                      PIC  X(05) VALUE             02380000
017700         'UNITS'.                                                 02390000
017800     05  FILLER                      PIC  X(01) VALUE  SPACES.    02400000
017900     05  FILLER                      PIC  X(08) VALUE             02410000
018000         'ACT DATE'.                                              02420000
018100     05  FILLER                      PIC  X(01) VALUE  SPACES.    02430000
018200     05  FILLER                      PIC  X(01) VALUE             02440000
018300         'R'.                                                     02450000
018400     05  FILLER                      PIC  X(02) VALUE  SPACES.    02460000
018500     05  FILLER                      PIC  X(03) VALUE             02470000
018600         'QTY'.                                                   02480000
018700     05  FILLER                      PIC  X(03) VALUE  SPACES.    02490000
018800     05  FILLER                      PIC  X(03) VALUE             02500000
018900         'QTY'.                                                   02510000
018901     05  FILLER                      PIC  X(03) VALUE  SPACES.    02520000
018902     05  FILLER                      PIC  X(03) VALUE             02530000
018903         'QTY'.                                                   02540000
018904     05  FILLER                      PIC  X(02) VALUE  SPACES.    02550000
018905     05  FILLER                      PIC  X(01) VALUE             02560000
018906         'C'.                                                     02570000
019000     05  FILLER                      PIC  X(01) VALUE  SPACES.    02580000
019100     05  FILLER                      PIC  X(04) VALUE             02590000
019200         'UNTS'.                                                  02600000
019300     05  FILLER                      PIC  X(01) VALUE  SPACES.    02610000
019400     05  FILLER                      PIC  X(55) VALUE             02620000
019500     'CARTON LOCATION/OUTBOUND TRIP STATUS & DIVERT DATE,TIME'.   02630000
019700                                                                  02640000
019800 01  HL-HEADING-LINE-3.                                           02650000
019900     05  FILLER                      PIC  X(01) VALUE  SPACES.    02660000
020000     05  FILLER                      PIC  X(04) VALUE             02670000
020100         '----'.                                                  02680000
020200     05  FILLER                      PIC  X(01) VALUE  SPACES.    02690000
020300     05  FILLER                      PIC  X(03) VALUE             02700000
020400         '---'.                                                   02710000
020500     05  FILLER                      PIC  X(01) VALUE  SPACES.    02720000
020600     05  FILLER                      PIC  X(03) VALUE             02730000
020700         '---'.                                                   02740000
020800     05  FILLER                      PIC  X(01) VALUE  SPACES.    02750000
020900     05  FILLER                      PIC  X(08) VALUE             02760000
021000         '--------'.                                              02770000
021100     05  FILLER                      PIC  X(01) VALUE  SPACES.    02780000
021200     05  FILLER                      PIC  X(04) VALUE             02790000
021300         '----'.                                                  02800000
021400     05  FILLER                      PIC  X(01) VALUE  SPACES.    02810000
021500     05  FILLER                      PIC  X(04) VALUE             02820000
021600         '----'.                                                  02830000
021700     05  FILLER                      PIC  X(01) VALUE  SPACES.    02840000
021800     05  FILLER                      PIC  X(12) VALUE             02850000
021900         '------------'.                                          02860000
022000     05  FILLER                      PIC  X(01) VALUE  SPACES.    02870000
022100     05  FILLER                      PIC  X(08) VALUE             02880000
022200         '--------'.                                              02890000
022300     05  FILLER                      PIC  X(01) VALUE  SPACES.    02900000
022400     05  FILLER                      PIC  X(03) VALUE             02910000
022500         '---'.                                                   02920000
022600     05  FILLER                      PIC  X(01) VALUE  SPACES.    02930000
022700     05  FILLER                      PIC  X(05) VALUE             02940000
022800         '-----'.                                                 02950000
022900     05  FILLER                      PIC  X(01) VALUE  SPACES.    02960000
023000     05  FILLER                      PIC  X(08) VALUE             02970000
023100         '--------'.                                              02980000
023101     05  FILLER                      PIC  X(01) VALUE  SPACES.    02990000
023102     05  FILLER                      PIC  X(01) VALUE             03000000
023103         '-'.                                                     03010000
023200     05  FILLER                      PIC  X(01) VALUE  SPACES.    03020000
023300     05  FILLER                      PIC  X(05) VALUE             03030000
023400         '-----'.                                                 03040000
023401     05  FILLER                      PIC  X(01) VALUE  SPACES.    03050000
023402     05  FILLER                      PIC  X(05) VALUE             03060000
023403         '-----'.                                                 03070000
023404     05  FILLER                      PIC  X(01) VALUE  SPACES.    03080000
023405     05  FILLER                      PIC  X(05) VALUE             03090000
023406         '-----'.                                                 03100000
023407     05  FILLER                      PIC  X(01) VALUE  SPACES.    03110000
023408     05  FILLER                      PIC  X(01) VALUE             03120000
023409         '-'.                                                     03130000
023410     05  FILLER                      PIC  X(01) VALUE  SPACES.    03140000
023411     05  FILLER                      PIC  X(04) VALUE             03150000
023412         '----'.                                                  03160000
023413     05  FILLER                      PIC  X(01) VALUE  SPACES.    03170000
023414     05  FILLER                      PIC  X(48) VALUE             03180000
023415         '------------------------------------------------'.      03190000
023414     05  FILLER                      PIC  X(07) VALUE             03200000
023415         '-------'.                                               03210000
023600                                                                  03220000
023700 01  DL-DETAIL-LINE-1.                                            03230000
024200     05  FILLER                      PIC  X(01) VALUE  SPACES.    03240000
024201     05  DL-STORE-NBR                PIC  ZZZ9  VALUE ZERO.       03250000
024202     05  FILLER                      PIC  X(01) VALUE  SPACES.    03260000
024203     05  DL-DEPT-NBR                 PIC  ZZ9   VALUE ZERO.       03270000
024204     05  FILLER                      PIC  X(01) VALUE  SPACES.    03280000
024205     05  DL-SUB-CL                   PIC  ZZ9   VALUE ZERO.       03290000
024206     05  FILLER                      PIC  X(01) VALUE  SPACES.    03300000
024207     05  DL-SKU-NBR                  PIC  ZZZZZZZ9  VALUE ZERO.   03310000
025500     05  FILLER                      PIC  X(01) VALUE  SPACES.    03320000
025600     05  DL-APP-PO-LNE-NBR           PIC  ZZZ9.                   03330000
025700     05  DL-APP-PO-LNE-NBR-X REDEFINES DL-APP-PO-LNE-NBR          03340000
025800                                     PIC  X(04).                  03350000
025801     05  FILLER                      PIC  X(01) VALUE  SPACES.    03360000
025802     05  DL-OPER-UNT-ID              PIC  ZZ9  VALUE ZERO.        03370005
025801     05  FILLER                      PIC  X(01) VALUE  SPACES.    03380005
025804     05  DL-PO-RCVR.                                              03390000
0518           10  DL-PO                   PIC  ZZZZZZZZ9  VALUE ZERO.  03400004
025806         10  DL-DASH                 PIC  X(01) VALUE  '-'.       03410000
025807         10  DL-RCVR                 PIC  9(03) VALUE  ZEROES.    03420000
0518           10  DL-RCVR-X  REDEFINES    DL-RCVR                      03430002
0518                                       PIC  X(03).                  03440002
025808     05  FILLER                      PIC  X(01) VALUE  SPACES.    03450000
025809     05  DL-VRFD-DATE                PIC  X(08) VALUE SPACES.     03460000
025810     05  FILLER                      PIC  X(01) VALUE  SPACES.    03470000
025811     05  DL-REC-TYP                  PIC  X(03) VALUE SPACES.     03480000
025812     05  FILLER                      PIC  X(01) VALUE  SPACES.    03490000
025813     05  DL-ORIG-UNITS               PIC  ZZZ9-.                  03500000
025814     05  FILLER                      PIC  X(01) VALUE SPACES.     03510000
026200     05  DL-LAST-ACT-DATE            PIC  X(08) VALUE  ZEROES.    03520000
026201     05  FILLER                      PIC  X(01) VALUE  SPACES.    03530000
026202     05  DL-REVERSE-CDE              PIC  X(01) VALUE  ZEROES.    03540000
026203     05  FILLER                      PIC  X(01) VALUE  SPACES.    03550000
026204     05  DL-STORE-EXP-UNITS          PIC  ZZZ9-.                  03560000
026205     05  FILLER                      PIC  X(01) VALUE  SPACES.    03570000
026400     05  DL-IN-TRNS-UNITS            PIC  ZZZ9-.                  03580000
026401     05  FILLER                      PIC  X(01) VALUE  SPACES.    03590000
026402     05  DL-CLEAN-UNITS              PIC  ZZZ9-.                  03600000
026403     05  FILLER                      PIC  X(01) VALUE  SPACES.    03610000
026404     05  DL-CLEAN-CODE               PIC  X(01) VALUE SPACES.     03620000
026500     05  FILLER                      PIC  X(01) VALUE  SPACES.    03630000
026600     05  DL-CTN-UNITS                PIC  ZZZ9.                   03640000
026601     05  FILLER                      PIC  X(01) VALUE  SPACES.    03650000
026602     05  DL-STATUS                   PIC  X(58) VALUE  SPACES.    03660000
026700                                                                  03670000
028100                                                                  03680000
028200 01  EP-EMPTY-REPORT-LINE.                                        03690000
028300     05  FILLER                       PIC X(54)  VALUE SPACES.    03700000
028400     05  FILLER                       PIC X(25)  VALUE            03710000
028500         '******* NO DATA *********'.                             03720000
028600     05  FILLER                       PIC X(54)  VALUE SPACES.    03730000
028700 01  DL-BLANK-LINE                    PIC X(150) VALUE SPACES.    03740000
028800                                                                  03750000
028900 01  END-OF-REPORT-LINE.                                          03760000
029000     05  FILLER                  PIC  X(44)    VALUE SPACES.      03770000
029100     05  FILLER                  PIC  X(45)    VALUE              03780000
029200          '*******   E N D   O F   R E P O R T   *******'.        03790000
029300     05  FILLER                  PIC  X(43)    VALUE SPACES.      03800000
029400/                                                                 03810000
029500******************************************************************03820000
029600     COPY SQLCA2.                                                 03830000
029700                                                                  03840000
029800     EXEC SQL                                                     03850000
029900         INCLUDE SQLCA                                            03860000
030000     END-EXEC.                                                    03870000
030100*----------------------------------------------------------------*03880000
030200*    DB2 DCLGEN FOR TRECEIV TABLE                                 03890000
030300*----------------------------------------------------------------*03900000
030400     EXEC SQL                                                     03910000
030500          INCLUDE TRECEIV                                         03920000
030600     END-EXEC.                                                    03930000
030700                                                                  03940000
030800*---------------------------------------------------------------* 03950000
030900*    SUT_OTBND_CART OUTBOUND CARTON TABLE                         03960000
031000*---------------------------------------------------------------* 03970000
031100     EXEC SQL                                                     03980000
031200          INCLUDE SUT00024                                        03990000
031300     END-EXEC.                                                    04000000
031400                                                                  04010000
031500*---------------------------------------------------------------* 04020000
031600*    SUT_OTBND_UPC UPC TABLE                                      04030000
031700*---------------------------------------------------------------* 04040000
031800     EXEC SQL                                                     04050000
031900          INCLUDE SUT00028                                        04060000
032000     END-EXEC.                                                    04070000
032100                                                                  04080000
032200*---------------------------------------------------------------* 04090000
032300*    SUT_OTBND_VND                                                04100000
032400*---------------------------------------------------------------* 04110000
032500     EXEC SQL                                                     04120000
032600          INCLUDE SUT00026                                        04130000
032700     END-EXEC.                                                    04140000
032800                                                                  04150000
032900*---------------------------------------------------------------* 04160000
033000*    TPKSLIP                                                      04170000
033100*---------------------------------------------------------------* 04180000
033200     EXEC SQL                                                     04190000
033300          INCLUDE TPKSLIP                                         04200000
033400     END-EXEC.                                                    04210000
033500                                                                  04220000
032900*---------------------------------------------------------------* 04230000
033000*    TSUCRDV                                                      04240000
033100*---------------------------------------------------------------* 04250000
033200     EXEC SQL                                                     04260000
033300          INCLUDE TSUCRDV                                         04270000
033400     END-EXEC.                                                    04280000
033500                                                                  04290000
032900*---------------------------------------------------------------* 04300001
033000*    TKRPRPM                                                      04310001
033100*---------------------------------------------------------------* 04320001
033200     EXEC SQL                                                     04330001
033300          INCLUDE TKRPRPM                                         04340001
033400     END-EXEC.                                                    04350001
033500                                                                  04360001
033600*----------------------------------------------------------------*04370000
033700*    CURSOR TO RETRIEVE CARTONS BY PO/RCVR/LINE/STORE             04380000
033800*----------------------------------------------------------------*04390000
033900     EXEC SQL                                                     04400000
034000          DECLARE CARTON-CSR CURSOR FOR                           04410000
034100        SELECT  DISTINCT (A.SHIPT_UNT_ID)                         04420000
034110               ,SUM(A.SHPD_UNT_QTY)                               04430000
034200          FROM  SUT_OTBND_UPC A                                   04440000
034300               ,SUT_OTBND_CART B                                  04450000
034400         WHERE  A.TRN_NBR           = :PC038-PO-NBR               04460000
034500           AND  A.RCVR_SEQ_NBR      = :PC038-RCVR-SEQ-NBR         04470000
034600           AND  A.TRN_LNE_NBR       = :DK-LINE-NBR                04480000
034700           AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID              04490000
034800           AND  B.ACTV_IND          = 'Y'                         04500000
034900           AND  B.DEST_LOC_NBR      = :DK-STORE-NBR               04510000
035000         GROUP BY A.SHIPT_UNT_ID                                  04520000
036800     END-EXEC.                                                    04530000
036900                                                                  04540000
037000****************************************************************  04550000
037100 PROCEDURE DIVISION.                                              04560000
037200****************************************************************  04570000
037300 0000-MAINLINE.                                                   04580000
037400                                                                  04590000
037500     PERFORM 1000-INITIALIZE                                      04600000
037600                                                                  04610000
037700     PERFORM 2000-PROCESS UNTIL PS-EOF-ERROR-FILE                 04620000
037800                                                                  04630000
037900     PERFORM 9000-EOJ.                                            04640000
038000                                                                  04650000
038100 THE-DUMPER.                                                      04660000
038200     GOBACK.                                                      04670000
038300                                                                  04680000
038400 1000-INITIALIZE.                                                 04690000
038500                                                                  04700000
038600     DISPLAY ' PCKRP028 STARTED'                                  04710000
038700     EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC           04720000
038800                                                                  04730000
038900     OPEN OUTPUT REPORT-FILE                                      04740000
039000* LOAD SYSTEM DATE INTO HEADINGS                                  04750000
039100     ACCEPT SD-SYSTEM-DATE FROM DATE.                             04760000
039200     ACCEPT ST-SYSTEM-TIME FROM TIME.                             04770000
039300                                                                  04780000
039400     MOVE SD-SYSTEM-DATE-YY      TO DP150O-RUN-YEAR.              04790000
039500     MOVE SD-SYSTEM-DATE-MM      TO DP150O-RUN-MONTH.             04800000
039600     MOVE SD-SYSTEM-DATE-DD      TO DP150O-RUN-DAY.               04810000
039700     MOVE ST-SYSTEM-HOUR         TO DP150O-RUN-HOUR.              04820000
039800     MOVE ST-SYSTEM-MINUTE       TO DP150O-RUN-MINUTE.            04830000
039900                                                                  04840000
040000     MOVE PC-CURRENT-PROGRAM-NAME                                 04850000
040100                                 TO DP150O-PROGRAM-NAME.          04860000
040200     MOVE 1                      TO DP150O-REPORT-NUMBER          04870000
040300                                    DP150O-PAGE-NUMBER            04880000
040400                                                                  04890000
040500     PERFORM 8100-WRITE-MAIN-HEADINGS                             04900000
040600                                                                  04910000
040700     OPEN INPUT EXTRACT-FILE                                      04920000
040800     PERFORM 8000-READ-EXTRACT                                    04930000
040900                                                                  04940000
041000     MOVE PC038-OPER-UNT-ID    TO PV-PREV-OPER.                   04950000
041010     MOVE PC038-LOC-NBR        TO PV-PREV-LOC.                    04960000
041100                                                                  04970000
041200     IF PS-EOF-ERROR-FILE                                         04980000
041300         DISPLAY ' -- NO UNBALANCED STR EXP -- '                  04990000
041400         WRITE REPORT-RECORD FROM EP-EMPTY-REPORT-LINE            05000000
041500             AFTER ADVANCING 3 LINES                              05010000
041501     ELSE                                                         05020000
041510         MOVE PC038-LOC-NBR           TO PV-PREV-LOC              05030000
041520                                         PV-DISP-LOC              05040000
041530         MOVE PV-READ-COUNT           TO PV-DISP-COUNT            05050000
041540         EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC       05060000
041550         DISPLAY PV-TMST ' '                                      05070000
041560                 ' LOC = ' PV-DISP-LOC                            05080000
041570                 ' REC COUNT = ' PV-DISP-COUNT                    05090000
0618           PERFORM 2500-GET-BOSS-PARM-RCVR                          05100006
041600     END-IF.                                                      05110000
041700******************************************************************05120000
041800 2000-PROCESS.                                                    05130000
041900******************************************************************05140000
042000     INITIALIZE DL-DETAIL-LINE-1.                                 05150000
042100                                                                  05160000
042200     IF PC038-OPER-UNT-ID = PV-PREV-OPER                          05170000
042300         MOVE PC038-OPER-UNT-ID       TO DL-OPER-UNT-ID           05180000
042400     ELSE                                                         05190000
042500         WRITE REPORT-RECORD FROM DL-BLANK-LINE                   05200000
042600               AFTER ADVANCING 1 LINES                            05210000
042700         ADD 1                   TO PV-LINES-USED                 05220000
042800         IF PV-LINES-USED > PC-END-OF-PAGE                        05230000
042900             PERFORM 8100-WRITE-MAIN-HEADINGS                     05240000
043000         END-IF                                                   05250000
043100         MOVE PC038-OPER-UNT-ID       TO DL-OPER-UNT-ID           05260000
043200         MOVE PC038-OPER-UNT-ID       TO PV-PREV-OPER             05270000
043300     END-IF.                                                      05280000
043400                                                                  05290000
043410     IF PC038-LOC-NBR = PV-PREV-LOC                               05300000
043420         CONTINUE                                                 05310000
043430     ELSE                                                         05320000
043491         MOVE PC038-LOC-NBR           TO PV-PREV-LOC              05330000
043492                                         PV-DISP-LOC              05340000
043493         MOVE PV-READ-COUNT           TO PV-DISP-COUNT            05350000
043494         EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC       05360000
043495         DISPLAY PV-TMST ' '                                      05370000
043496                 ' LOC = ' PV-DISP-LOC                            05380000
043497                 ' REC COUNT = ' PV-DISP-COUNT                    05390000
043498     END-IF.                                                      05400000
043499                                                                  05410000
043500     MOVE PC038-LOC-NBR               TO DL-STORE-NBR.            05420000
043600     IF PC038-APP-PO-LNE-NBR-X NUMERIC                            05430000
043700          MOVE PC038-APP-PO-LNE-NBR   TO DL-APP-PO-LNE-NBR        05440000
043800     ELSE                                                         05450000
043900          MOVE PC038-APP-PO-LNE-NBR-X TO DL-APP-PO-LNE-NBR-X      05460000
044000     END-IF.                                                      05470000
044100                                                                  05480000
044200     MOVE PC038-PO-NBR                TO DL-PO                    05490000
044300     MOVE '-'                         TO DL-DASH.                 05500000
0518                                                                    05510002
0518       IF PC038-RCVR-SEQ-NBR = PV-BOSS-PARM-RECV                    05520002
0518          MOVE 'BSS'                    TO DL-RCVR-X                05530002
0618          ADD 1                         TO PV-BOSS-COUNT            05540007
0518       ELSE                                                         05550002
044400        MOVE PC038-RCVR-SEQ-NBR       TO DL-RCVR                  05560001
0518       END-IF.                                                      05570002
0518                                                                    05580002
044500     MOVE PC038-REC-TYP-CDE           TO DL-REC-TYP.              05590000
044600     MOVE PC038-DEPT-NBR              TO DL-DEPT-NBR.             05600000
044610     MOVE PC038-SUB-CL-NBR            TO DL-SUB-CL.               05610000
044700     MOVE PC038-SKU-9                 TO DL-SKU-NBR.              05620000
044800     MOVE PC038-STR-EXPECTED-UNITS    TO DL-ORIG-UNITS.           05630000
044900     MOVE PC038-INTRNST-TRN-DTE       TO PV-INTR-TRN-DTE.         05640000
044910     MOVE PC038-POST-INV-REVERSE-CDE  TO DL-REVERSE-CDE.          05650000
045000     MOVE PV-INTR-YY                  TO PV-KEY-INTR-YY.          05660000
045100     MOVE PV-INTR-MM                  TO PV-KEY-INTR-MM.          05670000
045200     MOVE PV-INTR-DD                  TO PV-KEY-INTR-DD.          05680000
045300     MOVE PV-KEY-INTR-DATE            TO DL-LAST-ACT-DATE.        05690000
045400     MOVE PC038-AFT-REV-STR-EXP-UNITS TO DL-STORE-EXP-UNITS.      05700000
045500     MOVE PC038-AFT-REV-IN-TRNS-UNITS TO DL-IN-TRNS-UNITS.        05710000
045600     MOVE PC038-AFT-REV-CLEAN-UNITS   TO DL-CLEAN-UNITS.          05720000
045601     MOVE PC038-AFT-REV-CLEAN-CDE     TO DL-CLEAN-CODE.           05730000
045602                                                                  05740000
045603     IF PC038-RCVR-SEQ-NBR  =  ZEROES                             05750000
045700         MOVE SPACES      TO DL-VRFD-DATE                         05760000
045800     ELSE                                                         05770000
045900         IF PC038-PO-NBR   =     PV-PREV-PO                       05780000
046000             IF PC038-RCVR-SEQ-NBR  =     PV-PREV-RCVR            05790000
046100                 MOVE PV-KEY-DATE TO DL-VRFD-DATE                 05800000
046200             ELSE                                                 05810000
046300                 IF PC038-RCVR-SEQ-NBR  NOT = ZEROES              05820000
046400                     PERFORM 2400-GET-TRECEIV-VFYD-DATE           05830000
046420                     MOVE PC038-RCVR-SEQ-NBR    TO PV-PREV-RCVR   05840000
046500                 END-IF                                           05850000
046600             END-IF                                               05860000
046700          ELSE                                                    05870000
046800             PERFORM 2400-GET-TRECEIV-VFYD-DATE                   05880000
046810             MOVE PC038-PO-NBR          TO PV-PREV-PO             05890000
046820             MOVE PC038-RCVR-SEQ-NBR    TO PV-PREV-RCVR           05900000
046900         END-IF                                                   05910000
047000     END-IF.                                                      05920000
047100                                                                  05930000
047200     INITIALIZE PC046-COMMAREA-REC.                               05940000
047300     PERFORM 5000-RETRIEVE-CARTONS                                05950000
047400     IF PC046-OTBD-TRIP-ID = ZEROES                               05960000
047500         IF PC046-CARTON-ID    = ZEROES                           05970000
047600             WRITE REPORT-RECORD FROM DL-DETAIL-LINE-1            05980000
047700               AFTER ADVANCING 1 LINES                            05990000
047800             ADD 1                        TO PV-LINES-USED        06000000
047900             IF PV-LINES-USED > PC-END-OF-PAGE                    06010000
048000                 PERFORM 8100-WRITE-MAIN-HEADINGS                 06020000
048100             END-IF                                               06030000
048200         END-IF                                                   06040000
048300     END-IF.                                                      06050000
048400     PERFORM 8000-READ-EXTRACT.                                   06060000
048500                                                                  06070000
048600******************************************************************06080000
048700 2400-GET-TRECEIV-VFYD-DATE.                                      06090000
048800******************************************************************06100000
048900     MOVE '2400-GET-TRECEIV-VFYD-DATE'    TO PV-PARAGRAPH.        06110000
049000                                                                  06120000
049100     INITIALIZE RECEIV-VERFYD-TMST.                               06130000
049200                                                                  06140000
049300     PERFORM                                                      06150000
049400         WITH TEST AFTER                                          06160000
049500         VARYING PV-RETRY-COUNTER                                 06170000
049600         FROM 1 BY 1                                              06180000
049700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06190000
049800            OR  (SQLCODE = +100)                                  06200000
049900            OR  (SQLCODE = +0))                                   06210000
050000                                                                  06220000
050100         EXEC SQL                                                 06230000
050200             SELECT VERFYD_TMST                                   06240000
050300              INTO :RECEIV-VERFYD-TMST                            06250000
050400              FROM  TRECEIV                                       06260000
050500             WHERE  ORD_NBR     = :PC038-PO-NBR                   06270000
050600               AND  REC_SEQ_NBR = :PC038-RCVR-SEQ-NBR             06280000
050700         WITH UR                                                  06290000
050800         END-EXEC                                                 06300000
050900                                                                  06310000
051000         EVALUATE TRUE                                            06320000
051100             WHEN SQLCODE = ZERO                                  06330000
051200                 IF RECEIV-VERFYD-TMST NOT =                      06340000
051300                                     '9999-09-09-09.09.09.999999' 06350000
051400                     MOVE RECEIV-VERFYD-TMST TO PV-DB2-DATE       06360000
051500                     MOVE PV-DB2-YY   TO PV-KEY-YY                06370000
051600                     MOVE PV-DB2-MM   TO PV-KEY-MM                06380000
051700                     MOVE PV-DB2-DD   TO PV-KEY-DD                06390000
                           MOVE '/'         TO PV-KEY-SLASH-1           06400000
                                               PV-KEY-SLASH-2           06410000
051800                     MOVE PV-KEY-DATE TO DL-VRFD-DATE             06420000
051900                 ELSE                                             06430000
052000                     MOVE SPACES TO   DL-VRFD-DATE                06440000
052010                                      PV-KEY-DATE                 06450000
052100                 END-IF                                           06460000
052200             WHEN SQLCODE = +100                                  06470000
052300                 MOVE SPACES TO   DL-VRFD-DATE                    06480000
052400             WHEN SQLCODE = -904                                  06490000
052500             WHEN SQLCODE = -911                                  06500000
052600             WHEN SQLCODE = -913                                  06510000
052700                  CONTINUE                                        06520000
052800                                                                  06530000
052900             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06540000
053000                 DISPLAY '**************************************' 06550000
053100                 DISPLAY 'WARNING ISSUED '                        06560000
053200                 DISPLAY 'SELECT TRECEIV                        ' 06570000
053300                 DISPLAY '**************************************' 06580000
053400                 PERFORM 9300-SQL-WARNING                         06590000
053500                                                                  06600000
053600             WHEN SQLCODE < ZERO                                  06610000
053700                 DISPLAY '**************************************' 06620000
053800                 DISPLAY 'ERROR ISSUED ON                       ' 06630000
053900                 DISPLAY 'SELECT TRECEIV                        ' 06640000
054000                 DISPLAY '**************************************' 06650000
054100                 PERFORM 9200-SQL-ERROR                           06660000
054200                                                                  06670000
054300         END-EVALUATE                                             06680000
054400     END-PERFORM.                                                 06690000
054500                                                                  06700000
054600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06710000
054700         SQLCODE NOT = ZERO                                       06720000
054800         DISPLAY '**************************************'         06730000
054900         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06740000
055000         DISPLAY 'SELECT TRECEIV         '                        06750000
055100         DISPLAY '**************************************'         06760000
055200         PERFORM 9200-SQL-ERROR                                   06770000
055300     END-IF.                                                      06780000
055400                                                                  06790000
0518  ******************************************************************06800003
0518  *- READ TKRPRPM TO RETRIEVE THE BOSS RECEIVER PARM                06810003
0518  ******************************************************************06820003
0518   2500-GET-BOSS-PARM-RCVR.                                         06830002
0518                                                                    06840002
0518       EXEC SQL                                                     06850002
0518           SELECT FUNC_QTY                                          06860002
0518             INTO :PV-BOSS-PARM-RECV                                06870002
0518             FROM TKRPRPM                                           06880002
0518            WHERE LOC_ID            = 90                            06890002
0518              AND INTFC_SYS_CDE     = 'GIV'                         06900002
0518              AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                      06910002
0518              AND FUNC_PRC_STAT_CDE = 'AC'                          06920002
0518            WITH UR                                                 06930002
0518       END-EXEC.                                                    06940002
0518                                                                    06950002
0518       EVALUATE TRUE                                                06960002
0518            WHEN SQLCODE = +0                                       06970002
0618                MOVE PV-BOSS-PARM-RECV     TO PV-BOSS-PARM-DISP     06980006
0518                DISPLAY ' BOSS PARM RECEIVER  = '                   06990006
0618                                              PV-BOSS-PARM-DISP     07000006
0518                                                                    07010002
0518            WHEN SQLCODE = +100                                     07020002
0518                MOVE ZEROES                TO PV-BOSS-PARM-RECV     07030002
0518                                                                    07040002
0518            WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                 07050002
0518                DISPLAY '**************************************'    07060002
0518                DISPLAY '2500-GET-BOSS-PARM-RCVR               '    07070002
0518                DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        '    07080002
0518                DISPLAY '**************************************'    07090002
0518                PERFORM 9300-SQL-WARNING                            07100002
0518                                                                    07110002
0518            WHEN SQLCODE < ZERO                                     07120002
0518                DISPLAY '**************************************'    07130002
0518                DISPLAY '2500-GET-BOSS-PARM-RCVR               '    07140002
0518                DISPLAY 'ERROR ISSUED ON                       '    07150002
0518                DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        '    07160002
0518                DISPLAY '**************************************'    07170002
0518                PERFORM 9200-SQL-ERROR                              07180002
0518                                                                    07190002
0518        END-EVALUATE.                                               07200002
0518                                                                    07210002
055500*----------------------------------------------------------------*07220000
055600 5000-RETRIEVE-CARTONS.                                           07230000
055700     MOVE '5000-RETRIEVE-CARTONS '    TO PV-PARAGRAPH.            07240000
055800                                                                  07250000
055900     MOVE PC038-APP-PO-LNE-NBR  TO DK-LINE-NBR.                   07260000
056000     MOVE PC038-LOC-NBR         TO DK-STORE-NBR.                  07270000
           SET PS-NOT-END-OF-CARTON-CSR     TO TRUE.                    07280000
056100     PERFORM 5100-OPEN-CURSOR.                                    07290000
056200     PERFORM 5200-FETCH UNTIL PS-END-OF-CARTON-CSR.               07300000
056300     PERFORM 5300-CLOSE-CURSOR.                                   07310000
056400                                                                  07320000
056500*----------------------------------------------------------------*07330000
056600* OPEN THE CURSOR                                                 07340000
056700*----------------------------------------------------------------*07350000
056800 5100-OPEN-CURSOR.                                                07360000
056900         EXEC SQL                                                 07370000
057000              OPEN CARTON-CSR                                     07380000
057100         END-EXEC                                                 07390000
057200                                                                  07400000
057300         EVALUATE TRUE                                            07410000
057400             WHEN SQLCODE = ZERO                                  07420000
057500             WHEN SQLCODE = -904                                  07430000
057600             WHEN SQLCODE = -913                                  07440000
057700                 CONTINUE                                         07450000
057800             WHEN SQLWARN0 NOT = SPACES                           07460000
057900             WHEN SQLCODE < ZERO                                  07470000
058000             WHEN SQLCODE > ZERO                                  07480000
058100                 CONTINUE                                         07490000
058200         END-EVALUATE.                                            07500000
058300*                                                                 07510000
058400*----------------------------------------------------------------*07520000
058500*    FETCH THE CURSOR                                             07530000
058600*----------------------------------------------------------------*07540000
058700 5200-FETCH.                                                      07550000
058800                                                                  07560000
058900     EXEC SQL                                                     07570000
059000         FETCH CARTON-CSR                                         07580000
059100         INTO  :SUT00028-SHIPT-UNT-ID                             07590000
059110              ,:SUT00028-SHPD-UNT-QTY                             07600000
059200     END-EXEC.                                                    07610000
059300                                                                  07620000
059400     EVALUATE TRUE                                                07630000
059500         WHEN SQLCODE = ZEROS                                     07640000
059510              INITIALIZE PC046-COMMAREA-REC                       07650000
059600              MOVE SUT00028-SHIPT-UNT-ID TO  PC046-CARTON-ID      07660000
059610              MOVE SUT00028-SHPD-UNT-QTY TO  DL-CTN-UNITS         07670000
059700              PERFORM 6000-CALL-CRTN-STATUS-PGM                   07680000
059800         WHEN SQLCODE = +100                                      07690000
059900              SET PS-END-OF-CARTON-CSR   TO TRUE                  07700000
060000         WHEN OTHER                                               07710000
060100              CONTINUE                                            07720000
060200     END-EVALUATE.                                                07730000
060300                                                                  07740000
060400*----------------------------------------------------------------*07750000
060500* CLOSE THE CURSOR.                                               07760000
060600*----------------------------------------------------------------*07770000
060700 5300-CLOSE-CURSOR.                                               07780000
060800                                                                  07790000
060900     EXEC SQL                                                     07800000
061000          CLOSE CARTON-CSR                                        07810000
061100     END-EXEC.                                                    07820000
061200                                                                  07830000
061300     EVALUATE TRUE                                                07840000
061400         WHEN SQLCODE = ZERO                                      07850000
061500         WHEN SQLCODE = +100                                      07860000
061600             CONTINUE                                             07870000
061700         WHEN SQLWARN0 NOT = SPACES                               07880000
061800         WHEN SQLCODE < ZERO                                      07890000
061900         WHEN SQLCODE > ZERO                                      07900000
062000             CONTINUE                                             07910000
062100     END-EVALUATE.                                                07920000
062200                                                                  07930000
062300**************************************************************    07940000
062400* DETERMINE LAST ACTIVITY FOR CARTON (CHECK IN REVERSE ORDER)     07950000
062500* THIS WILL CALL PCKUT713 WHICH BRINGS BACK ALL INFORMATION ON    07960000
062600* THE CARTON ENTERED.                                             07970000
062700**************************************************************    07980000
062800 6000-CALL-CRTN-STATUS-PGM.                                       07990000
062900                                                                  08000000
063000     MOVE '6000-CALL-CRTN-STATUS-PGM '    TO PV-PARAGRAPH.        08010000
063100                                                                  08020000
063110     IF  PC046-CARTON-ID = PV-PREV-CARTON-ID                      08030000
063120         MOVE PV-PREV-STATUS TO DL-STATUS                         08040000
063130     ELSE                                                         08050000
063140         MOVE SPACES TO PV-PREV-STATUS                            08060000
063150         MOVE PC046-CARTON-ID TO PV-PREV-CARTON-ID                08070000
063200         CALL PC046-CARTON-STATUS-MODULE                          08080000
063300                   USING PC046-COMMAREA-REC                       08090000
063301*        ADD +1 TO PV-UT713-COUNT                                 08100000
063302         PERFORM 6005-VALIDATE-STATUS-CALL                        08110000
063310     END-IF.                                                      08120000
063400                                                                  08130000
063600                                                                  08140000
068000*    IF PC046-TRIP-STATUS = 'SU' AND PC046-OTBD-TRIP-ID > ZERO    08150000
068100*        CONTINUE                                                 08160000
068200*    ELSE                                                         08170000
068201                                                                  08180000
068202         WRITE REPORT-RECORD FROM DL-DETAIL-LINE-1                08190000
068203              AFTER ADVANCING 1 LINES                             08200000
068204         ADD 1  TO PV-LINES-USED                                  08210000
068205         IF PV-LINES-USED > PC-END-OF-PAGE                        08220000
068206             PERFORM 8100-WRITE-MAIN-HEADINGS                     08230000
068207         END-IF.                                                  08240000
068208*    END-IF.                                                      08250000
068209                                                                  08260000
068210                                                                  08270000
068211                                                                  08280000
068212**************************************************************    08290000
068213* CHECK RETURN CODE FROM CRTN STATUS PROGRAM TO SEE IF SUCCESSFUL 08300000
068214**************************************************************    08310000
068215 6005-VALIDATE-STATUS-CALL.                                       08320000
068216                                                                  08330000
068217     IF PC046-SUCCESSFUL                                          08340000
068218         MOVE SPACES TO DL-STATUS                                 08350000
068240         MOVE PC046-CARTON-ID    TO PV-CARTON-ID                  08360000
               PERFORM 6010-GET-DIVERT-TIME                             08370000
068219         IF PC046-OTBD-TRIP-ID > 0                                08380000
068220             MOVE PC046-OTBD-TRIP-ID TO PV-TRIP                   08390000
068230                                        PV-PREV-TRIP              08400000
068240             MOVE PC046-CARTON-ID    TO PV-CARTON                 08410000
068300             STRING PV-CARTON           DELIMITED BY SIZE         08420000
068400                ' '                     DELIMITED BY SIZE         08430000
068500                PV-TRIP                 DELIMITED BY SIZE         08440000
068600                ' '                     DELIMITED BY SIZE         08450000
068601                PC046-TRIP-STATUS       DELIMITED BY SIZE         08460000
068600                ' '                     DELIMITED BY SIZE         08470000
068500                PV-DIVERT-DATE-TIME     DELIMITED BY SIZE         08480000
068602                                           INTO DL-STATUS         08490000
068603             MOVE DL-STATUS TO PV-PREV-STATUS                     08500000
068700         ELSE                                                     08510000
068800             MOVE PC046-CARTON-ID TO PV-CARTON                    08520000
068900                                     PV-PREV-CARTON               08530000
069000             STRING PV-CARTON             DELIMITED BY SIZE       08540000
069100                   ' '                    DELIMITED BY SIZE       08550000
069200                  PC046-CRTN-STAT-DESC    DELIMITED BY SIZE       08560000
069100                   ' '                    DELIMITED BY SIZE       08570000
068500                  PV-DIVERT-DATE-TIME     DELIMITED BY SIZE       08580000
069300                                           INTO DL-STATUS         08590000
069301             MOVE DL-STATUS TO PV-PREV-STATUS                     08600000
069400         END-IF                                                   08610000
069500     ELSE                                                         08620000
069600         IF PC046-ERROR                                           08630000
069700             DISPLAY '** ABEND - PROGRAM '                        08640000
069800                     PC-CURRENT-PROGRAM-NAME ' **'                08650000
069900             DISPLAY '** BAD CALL TO CRTN STATUS PGM PCKUT713'    08660000
070000             DISPLAY PC046-CRA-RET-MSG                            08670000
070100             MOVE +4019 TO ABEND-CODE                             08680000
070200             CALL 'ILBOABN0' USING ABEND-CODE                     08690000
070300             MOVE '6005-'                TO PC046-CRA-REQ-ID      08700000
070400         ELSE                                                     08710000
070500             MOVE SPACES TO DL-STATUS                             08720000
070510                            PV-PREV-STATUS                        08730000
070600         END-IF                                                   08740000
070700     END-IF.                                                      08750000
070800                                                                  08760000
078400*-----------------------------------------------------------------08770000
078500* CHECK IF SCANNED OFF - FROM CONVEYOR SYSTEM                     08780000
078600*-----------------------------------------------------------------08790000
078700 6010-GET-DIVERT-TIME.                                            08800000
078800     MOVE ' 6010-GET-DIVERT-TIME' TO PV-PARAGRAPH                 08810000
078900                                                                  08820000
079000     EXEC SQL                                                     08830000
079100          SELECT  A.DIVERT_TMST                                   08840000
079200                 ,A.ACTV_CDE                                      08850000
079300                 ,A.DOOR_ID                                       08860000
079400            INTO :SUCRDV-DIVERT-TMST                              08870000
079500                ,:SUCRDV-ACTV-CDE                                 08880000
079600                ,:SUCRDV-DOOR-ID                                  08890000
079700            FROM  TSUCRDV A                                       08900000
079800           WHERE  A.SHIPT_UNT_ID = :PV-CARTON-ID                  08910000
079900             AND  A.ACTV_CDE     = 'A'                            08920000
080000             AND  A.DIVERT_TMST  =                                08930000
080100                  (SELECT  MAX(B.DIVERT_TMST)                     08940000
080200                     FROM  TSUCRDV B                              08950000
080300                    WHERE  B.SHIPT_UNT_ID = :PV-CARTON-ID)        08960000
080400     END-EXEC.                                                    08970000
080500                                                                  08980000
080600     EVALUATE TRUE                                                08990000
080700         WHEN SQLCODE = ZERO                                      09000000
081000            MOVE SUCRDV-DIVERT-TMST   TO PV-DIVERT-TMST           09010000
081200            MOVE PV-DIVERT-TMST(6:6)  TO PV-DIVERT-DATE-TIME(1:6) 09020000
081200            MOVE PV-DIVERT-TMST(3:2)  TO PV-DIVERT-DATE-TIME(7:2) 09030000
081200            MOVE PV-DIVERT-TMST(12:8) TO PV-DIVERT-DATE-TIME(10:8)09040000
081300         WHEN SQLCODE = +100                                      09050000
081400              MOVE SPACES             TO PV-DIVERT-DATE-TIME      09060000
081500                                                                  09070000
052900         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  09080000
053000                 DISPLAY '**************************************' 09090000
053100                 DISPLAY 'WARNING ISSUED '                        09100000
053200                 DISPLAY 'SELECT TSUCRDV                        ' 09110000
053300                 DISPLAY '**************************************' 09120000
053400                 PERFORM 9300-SQL-WARNING                         09130000
053500                                                                  09140000
053600         WHEN SQLCODE < ZERO                                      09150000
053700                 DISPLAY '**************************************' 09160000
053800                 DISPLAY 'ERROR ISSUED ON                       ' 09170000
053900                 DISPLAY 'SELECT TSUCRDV                        ' 09180000
                       MOVE PV-CARTON-ID  TO PV-CARTON                  09190000
053900                 DISPLAY 'CARTON ID : ' PV-CARTON                 09200000
                       INITIALIZE PV-CARTON                             09210000
054000                 DISPLAY '**************************************' 09220000
054100                 PERFORM 9200-SQL-ERROR                           09230000
083500     END-EVALUATE.                                                09240000
083600                                                                  09250000
070900 8000-READ-EXTRACT.                                               09260000
071000     READ EXTRACT-FILE                                            09270000
071100         INTO PC038-SE-UNBALANCED-RPT-REC                         09280000
071200     AT END                                                       09290000
071300         SET PS-EOF-ERROR-FILE        TO TRUE                     09300000
071400     NOT AT END                                                   09310000
071500         ADD 1                        TO PV-READ-COUNT            09320000
071600     END-READ.                                                    09330000
071700                                                                  09340000
071701*    IF PC038-PO-NBR   = 4562481                                  09350000
071702*           AND PC038-RCVR-SEQ-NBR  = 4                           09360000
071703*        DISPLAY 'TRAP1'                                          09370000
071704*    END-IF.                                                      09380000
071705                                                                  09390000
071706                                                                  09400000
071800 8100-WRITE-MAIN-HEADINGS.                                        09410000
071900                                                                  09420000
072000     ADD 1                            TO PV-PAGE-COUNT.           09430000
072100     MOVE PV-PAGE-COUNT               TO DP150O-PAGE-NUMBER.      09440000
072200     MOVE ZERO                        TO PV-LINES-USED            09450000
072300                                                                  09460000
072400     WRITE REPORT-RECORD FROM DP150O-STANDRD-HEADER-150-COLS      09470000
072500                 AFTER ADVANCING PAGE                             09480000
072600                                                                  09490000
072700     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1                   09500000
072800        AFTER ADVANCING 2 LINES.                                  09510000
072900     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1A                  09520000
073000        AFTER ADVANCING 1 LINES.                                  09530000
073100     WRITE REPORT-RECORD FROM DL-BLANK-LINE                       09540000
073200        AFTER ADVANCING 1 LINES.                                  09550000
073300     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2A                  09560000
073400        AFTER ADVANCING 1 LINES.                                  09570000
073500     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2                   09580000
073600        AFTER ADVANCING 1 LINES.                                  09590000
073700     ADD 6                            TO PV-LINES-USED.           09600000
073800                                                                  09610000
073900     WRITE REPORT-RECORD FROM HL-HEADING-LINE-3                   09620000
074000        AFTER ADVANCING 2 LINES.                                  09630000
074100                                                                  09640000
074200*    WRITE REPORT-RECORD FROM DL-BLANK-LINE                       09650000
074300*       AFTER ADVANCING 1 LINES.                                  09660000
074400                                                                  09670000
074500     INITIALIZE DP150O-LASER-NEW-PAGE-INDICATR.                   09680000
074600     ADD  3                           TO PV-LINES-USED.           09690000
074700/                                                                 09700000
074800 9000-EOJ.                                                        09710000
074900                                                                  09720000
075000     WRITE REPORT-RECORD                                          09730000
075100       FROM END-OF-REPORT-LINE                                    09740000
075200         AFTER ADVANCING 2 LINES.                                 09750000
075300                                                                  09760000
075400     CLOSE REPORT-FILE                                            09770000
075500           EXTRACT-FILE.                                          09780000
075600     MOVE PV-READ-COUNT               TO PV-DISP-COUNT            09790000
075700     DISPLAY ' RECORDS READ       = ' PV-DISP-COUNT.              09800007
0618                                                                    09810007
0618       MOVE PV-BOSS-COUNT               TO PV-DISP-COUNT            09820007
0618       DISPLAY ' BOSS RECORDS READ  = ' PV-DISP-COUNT.              09830007
075710                                                                  09840007
075720*    MOVE PV-UT713-COUNT              TO PV-DISP-COUNT            09850000
075730*    DISPLAY ' CALLS TO 713  = ' PV-DISP-COUNT.                   09860000
075800/                                                                 09870000
075900 9100-ABEND.                                                      09880000
076000                                                                  09890000
076100     CLOSE EXTRACT-FILE                                           09900000
076200           REPORT-FILE                                            09910000
076300                                                                  09920000
076400     MOVE +4013                       TO ABEND-CODE.              09930000
076500     CALL 'ILBOABN0' USING ABEND-CODE.                            09940000
076600                                                                  09950000
076700 9200-SQL-ERROR.                                                  09960000
076800                                                                  09970000
076900     MOVE SQLCODE                     TO SQLCODE2.                09980000
077000     MOVE SQLERRD(3)                  TO SQLERRD3.                09990000
077100                                                                  10000000
077200     DISPLAY '** ABEND **         ** = SQLERROR'.                 10010000
077300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10020000
077400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   10030000
077500     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                10040000
077600                                                                  10050000
077700     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                10060000
077800     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                10070000
077900     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 10080000
078000     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                10090000
078100                                                                  10100000
078200                                                                  10110000
078300     MOVE +4013                       TO ABEND-CODE.              10120000
078400     CALL 'ILBOABN0' USING ABEND-CODE.                            10130000
078500                                                                  10140000
078600 9300-SQL-WARNING.                                                10150000
078700                                                                  10160000
078800     DISPLAY '9300-SQL-WARNING'.                                  10170000
078900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10180000
079000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   10190000
079100     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                10200000
079200                                                                  10210000
079300     MOVE SQLCODE                     TO SQLCODE2.                10220000
079400     MOVE SQLERRD(3)                  TO SQLERRD3.                10230000
079500     DISPLAY '** ABEND **       ** = SQLWARNING'.                 10240000
079600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  10250000
079700     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  10260000
079800     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  10270000
079900     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  10280000
080000     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  10290000
080100     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  10300000
080200     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  10310000
080300     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  10320000
080400     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  10330000
080500     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  10340000
080600                                                                  10350000
080700     MOVE +4013                       TO ABEND-CODE.              10360000
080800     CALL 'ILBOABN0' USING ABEND-CODE.                            10370000
080900                                                                  10380000
