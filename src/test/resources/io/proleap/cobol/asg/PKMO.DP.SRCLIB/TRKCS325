000100*-----------------------*                                                 
000200 IDENTIFICATION DIVISION.                                                 
000300*-----------------------*                                                 
000400 PROGRAM-ID.    TRKCS325.                                                 
000500 AUTHOR.        MARGARET MORRISON.                                        
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000700 DATE-WRITTEN.  AUGUST, 2004.                                             
000800 DATE-COMPILED.                                                           
000900                                                                          
000910*---------------------------------------------------------------*         
000920*    Y325 - DECONSOLIDATOR CONTROL PANEL ERROR LIST             *         
000930*                                                               *         
000940*    THIS PROGRAM GENERATES A LIST OF ERRORS THAT OCCURED IN    *         
000950*    THE DECONSOLIDATOR CONTROL PANEL MAINTENANCE PROCESSING.   *         
000960*---------------------------------------------------------------*         
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED 02/03/2023    BY JIM HUNTER      WR: CHG0282210                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
000970                                                                          
002000 ENVIRONMENT DIVISION.                                                    
002100                                                                          
002200 DATA DIVISION.                                                           
002300                                                                          
002400 WORKING-STORAGE SECTION.                                                 
002500                                                                          
002600 01  PC-PROGRAM-CONSTANTS.                                                
002700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
002800                                                    'TR325A  '.           
002900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
003000                                                    'TRKM325 '.           
003100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
003200                                                    'TRKCS325'.           
003300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
003400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.              
003500     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.              
003600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.            
003700     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.            
003800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12             
003900                                                    COMP SYNC.            
004000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
004100                                                    COMP SYNC.            
004200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
004300                                                    +1000000              
004400                                                    COMP-3.               
004500     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5              
004600                                                    COMP SYNC.            
004700     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3              
004800                                                     COMP-3.              
004900                                                                          
005000 01  PC-TSYMSG-NUMBERS.                                                   
005100     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.          
005200     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.          
005300     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.          
005400     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.          
005500     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.          
005600     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.          
005700     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.          
005800     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.          
005810     05  PC-TSYMSG-03309                PIC 9(05)   VALUE 03309.          
005820*        - PO(S) ASSIGNED TO MULTIPLE DECONSOLIDATORS                     
005830     05  PC-TSYMSG-03317                PIC 9(05)   VALUE 3317.           
005840*        - VESSEL ASSIGNED TO MULTIPLE DECONSOLIDATORS                    
005900                                                                          
006000 01  PS-PROGRAM-SUBSCRIPTS.                                               
006100     05  PS-SUB                         PIC S9(04)   VALUE +0             
006200                                                     COMP SYNC.           
006300                                                                          
006400 01  PS-PROGRAM-SWITCHES.                                                 
006500     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.           
006600         88  PS-NO-ERROR                             VALUE 'Y'.           
006700         88  PS-ERROR                                VALUE 'N'.           
006800     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.           
006900         88  PS-COMMAREA-VALID                       VALUE 'Y'.           
007000         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.           
007100     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.           
007200         88  PS-LIST-END                             VALUE 'Y'.           
007300         88  PS-NO-LIST-END                          VALUE 'N'.           
007100     05  PS-WRITE-PO-SW                 PIC X(01)    VALUE 'N'.           
007200         88  PS-WRITE-PO                             VALUE 'Y'.           
007300         88  PS-WRITE-PO-NO                          VALUE 'N'.           
007100     05  PS-WRITE-VSL-SW                PIC X(01)    VALUE 'N'.           
007200         88  PS-WRITE-VSL                            VALUE 'Y'.           
007300         88  PS-WRITE-VSL-NO                         VALUE 'N'.           
007400     EJECT                                                                
007500 01  PV-PROGRAM-VARIABLES.                                                
007600     05  PV-REMAINDER                   PIC S9(04)   VALUE +0             
007700                                                     COMP SYNC.           
007800     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0             
007900                                                     COMP-3.              
033819     05  PV-ITEMS-PROCESSED             PIC S9(09)   VALUE +0     DPKCS036
033820                                                     COMP-3.      DPKCS036
033821     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)   VALUE +0     DPKCS036
033822                                                     COMP-3.      DPKCS036
033823     05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0     DPKCS036
033824                                                     COMP-3.      DPKCS036
008000     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0             
008100                                                     COMP-3.              
008200     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0             
008300                                                     COMP-3.              
008400     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0             
008500                                                     COMP SYNC.           
008600     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0             
008700                                                     COMP SYNC.           
008800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0             
008900                                                     COMP SYNC.           
009000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0             
009100                                                     COMP SYNC.           
009200     05  PV-SQL-SUB                     PIC S9(4)    COMP.                
009210     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
009220                                                    COMP SYNC.            
097981     05  PV-TABLE-STORE-COUNT           PIC S9(05)  VALUE ZERO            
097982                                                    COMP-3.               
097981     05  PV-WRITTEN-PO-COUNT            PIC S9(05)  VALUE ZERO            
097982                                                    COMP-3.               
097981     05  PV-WRITTEN-VSL-COUNT           PIC S9(05)  VALUE ZERO            
097982                                                    COMP-3.               
           05  PV-VSL-NAME                    PIC  X(30) VALUE SPACES.          
           05  PV-CONTNR-ID                   PIC  X(12) VALUE SPACES.          
           05  PV-PO-NBR                      PIC  S9(9) COMP VALUE 0.          
           05  PV-ETA                         PIC  X(30) VALUE SPACES.          
           05  PV-SEQ                         PIC  X(30) VALUE SPACES.          
           05  PV-DCNSL-SCAC                  PIC  X(04) VALUE SPACES.          
           05  PV-PO-SPLIT-TYP                PIC  X(03) VALUE SPACES.          
           05  PV-ERROR-MESSAGE               PIC  X(35) VALUE SPACES.          
           05  PV-VOY-NBR                     PIC  X(30) VALUE SPACES.          
013610     05  PV-HOLD-BLK-SUB                PIC S9(04) COMP SYNC.             
013900     05  PV-HOLD-ITEM-SUB               PIC S9(04) COMP SYNC.             
                                                                                
       01  PV-HOLD-ERROR-TABLE.                                                 
           05  PV-HOLD-VSL-NAME               PIC  X(30) VALUE SPACES.          
           05  PV-HOLD-CONTNR-ID              PIC  X(12) VALUE SPACES.          
           05  PV-HOLD-PO-NBR                 PIC  S9(9) COMP VALUE 0.          
           05  PV-HOLD-ETA                    PIC  X(30) VALUE SPACES.          
           05  PV-HOLD-SEQ                    PIC  X(30) VALUE SPACES.          
           05  PV-HOLD-DCNSL-SCAC             PIC  X(04) VALUE SPACES.          
           05  PV-HOLD-PO-SPLIT-TYP           PIC  X(03) VALUE SPACES.          
           05  PV-HOLD-ERROR-MESSAGE          PIC  X(35) VALUE SPACES.          
           05  PV-WRITTEN-PO-NBR              PIC  S9(9) COMP VALUE 0.          
           05  PV-WRITTEN-VSL-NAME            PIC  X(30) VALUE SPACES.          
           05  PV-WRITTEN-SCAC                PIC  X(04) VALUE SPACES.          
009300                                                                          
009310 01  PV-SAVE-INT-APPL-COM.                                                
009320     05  PV-VIEW                        PIC  X(08).                       
009330     05  PV-RUL-TYP                     PIC  X(03).                       
009340     05  PV-POE-CDE                     PIC  X(03).                       
009370                                                                          
009372     05  PV-WEEK-FROM-DTE.                                                
009373         10  PV-WEEK-FROM-DTE-MM  PIC X(02)   VALUE SPACES.               
009374         10  FILLER               PIC X(01)   VALUE '/'.                  
009375         10  PV-WEEK-FROM-DTE-DD  PIC X(02)   VALUE SPACES.               
009376         10  FILLER               PIC X(01)   VALUE '/'.                  
009377         10  PV-WEEK-FROM-DTE-CC  PIC X(02)   VALUE SPACES.               
009378         10  PV-WEEK-FROM-DTE-YY  PIC X(02)   VALUE SPACES.               
009379                                                                          
009380     05  PV-WEEK-TO-DTE.                                                  
009381         10  PV-WEEK-TO-DTE-MM    PIC X(02)   VALUE SPACES.               
009382         10  FILLER               PIC X(01)   VALUE '/'.                  
009383         10  PV-WEEK-TO-DTE-DD    PIC X(02)   VALUE SPACES.               
009384         10  FILLER               PIC X(01)   VALUE '/'.                  
009385         10  PV-WEEK-TO-DTE-CC    PIC X(02)   VALUE SPACES.               
009386         10  PV-WEEK-TO-DTE-YY    PIC X(02)   VALUE SPACES.               
009387                                                                          
009388     05  PV-CONT-CUR-RESULTS.                                             
009390         10 PV-CONT-CUR-RUL-ID          PIC  S9(9) COMP VALUE 0.          
009391         10 PV-CONT-CUR-CONTNR-ID       PIC  X(12) VALUE SPACES.          
009392                                                                          
009400 01  PV-DB2-CRITERIA-AREA.                                                
009500     15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO            
009600                                                    COMP-3.               
098738 01  ERROR-TABLE.                                                         
098739     05  ERROR-ROWS                OCCURS 30000 TIMES                     
098740                                      DEPENDING ON                        
098741                                      PV-TABLE-STORE-COUNT                
098742                                      ASCENDING KEY IS VSL-NAME           
098743                                      INDEXED BY ERR-IDX.                 
098744         10  VSL-NAME                        PIC  X(30).                  
098745         10  CONTNR-ID                       PIC  X(30).                  
098746         10  PO-NBR                          PIC  S9(9) COMP.             
098747         10  ETA-DATE                        PIC  X(10).                  
098748         10  DCNSL-SCAC                      PIC  X(04).                  
098749         10  PO-SPLIT-TYP                    PIC  X(03).                  
098749         10  ERROR-MESSAGE                   PIC  X(35).                  
009700                                                                          
009800 EJECT                                                                    
009900*---------------------------------------------------------------*         
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
010100*---------------------------------------------------------------*         
010200                                                                          
010300     COPY DPWS030.                                                        
CICS       COPY DPWS930.                                                        
010400 EJECT                                                                    
010500*---------------------------------------------------------------*         
010600*    STANDARD COMMAREA.                                         *         
010700*---------------------------------------------------------------*         
010800                                                                          
010900     COPY DPWS020.                                                        
011000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
011100                                                                          
011200*---------------------------------------------------------------*         
011300*    INTER-APPLICATION COMMAREA.                                *         
011400*---------------------------------------------------------------*         
011500                                                                          
011600         10  INTER-APPL-COMM-AREA       PIC X(200).                       
011700     COPY TRWS320.                                                        
011900*---------------------------------------------------------------*         
012000*    SPECIFIC COMMMAREA FOR TRKCS325.                           *         
012100*---------------------------------------------------------------*         
012200         10  ASC-SPECIFIC-COMMAREA.                                       
012300             15  ASC-LIST-KEYS.                                           
012400                 20  ASC-VIEW                        PIC X(08).           
012600                 20  ASC-POE-CDE                     PIC X(03).           
012700                 20  ASC-WEEK-FROM-DTE               PIC X(10).           
012710                 20  ASC-WEEK-TO-DTE                 PIC X(10).           
012800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
323997                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  DPKCS036
323998                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   DPKCS036
323999                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   DPKCS036
324000                                                                  DPKCS036
012900                 20  ASC-ITEM-ARRAY.                                      
013100                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.                
013510                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)           
013511                                                     COMP-3.              
013520                         30  ASC-ACTION-SW           PIC  X(01).          
013530                             88  ASC-INQ             VALUE 'I'.           
013540                             88  ASC-UPD             VALUE 'U'.           
013550                             88  ASC-DEL             VALUE 'D'.           
013560                             88  ASC-ERR             VALUE 'E'.           
013570                         30  ASC-VESSEL              PIC  X(10).          
013580                         30  ASC-CONTNR-ID           PIC  X(12).          
013590                         30  ASC-CONTNR-SEQ-NBR      PIC  9(06).          
013591** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                          
013591                         30  ASC-PO-NBR              PIC  S9(8)           
                                                           COMP.                
013592                         30  ASC-ETA-DATE            PIC  X(10).          
013593                         30  ASC-DECNSL-SCAC         PIC  X(04).          
013594                         30  ASC-MESSAGE             PIC  X(32).          
013595                         30  ASC-RUL-ID-DEFLT        PIC  S9(9)           
013596                                                     COMP.                
013597                         30  ASC-RUL-ID-USED         PIC  S9(9)           
013598                                                     COMP.                
013599                         30  ASC-RUL-CDE-USED        PIC  X(04).          
013600                         30  ASC-RUL-TYP-CDE-USED    PIC  X(03).          
013610             15  ASC-BLK-SUB                         PIC S9(04)           
013700                                                         COMP             
013800                                                         SYNC.            
013900             15  ASC-ITEM-SUB                        PIC S9(04)           
014000                                                         COMP             
014100                                                         SYNC.            
014200             15  ASC-SEL-SUB                         PIC S9(04)           
014300                                                         COMP.            
014400             15  ASC-SEL-ITEM                        PIC S9(04)           
014500                                                         COMP.            
014600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
014700                                                         COMP-3.          
014800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)           
014900                                                         COMP-3.          
015000             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)           
015100                                                         COMP-3.          
015200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
015300                                                         COMP-3.          
015400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
015500                                                         COMP-3.          
015600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
015700                                                         COMP-3.          
015800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
015900                                                         COMP             
016000                                                         SYNC.            
016100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)           
016200                                                         COMP-3.          
016300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)           
016400                                                         COMP-3.          
016500             15  ASC-PO-DATA-LEFT-INDICATOR          PIC  X(01).          
016600                 88  ASC-PO-DATA-LEFT-ON-DB             VALUE 'Y'.        
016700                 88  ASC-NO-PO-DATA-LEFT-ON-DB          VALUE 'N'.        
016500             15  ASC-VSL-DATA-LEFT-INDICATOR         PIC  X(01).          
016600                 88  ASC-VSL-DATA-LEFT-ON-DB            VALUE 'Y'.        
016700                 88  ASC-NO-VSL-DATA-LEFT-ON-DB         VALUE 'N'.        
324036             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  DPKCS036
324037                 88  ASC-ITEMS-LEFT-ON-TABLE            VALUE 'Y'.DPKCS036
324038                 88  ASC-NO-ITEMS-LEFT-ON-TABLE         VALUE 'N'.DPKCS036
017400             15  ASC-LIST-QUEUE-NAME.                                     
017500                 20  ASC-LIST-TERM-ID                PIC  X(04).          
017600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
017700                                                         COMP-3.          
017800                 20  ASC-LIST-SEQ                    PIC  9(01).          
017900             15  ASC-SEL-QUEUE-NAME.                                      
018000                 20  ASC-SEL-TERM-ID                 PIC  X(04).          
018100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)           
018200                                                          COMP-3.         
018300                 20  ASC-SEL-SEQ                     PIC  9(01).          
018400             15  ASC-DTL-QUEUE-NAME.                                      
018500                 20  ASC-DTL-TERM-ID                 PIC  X(04).          
018600                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)           
018700                                                         COMP-3.          
018800                 20  ASC-DTL-SEQ                     PIC  9(01).          
018900                                                                          
019000             15  ASC-START-ITEM-REQUEST.                                  
019100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).          
019200                                                                          
019300     EJECT                                                                
019400*---------------------------------------------------------------*         
019500*    TEMP STORAGE QUEUE RECORD LAYOUT                           *         
019600*---------------------------------------------------------------*         
019700                                                                          
019800     COPY TRWS325.                                                        
019900                                                                          
020000     EJECT                                                                
020100*---------------------------------------------------------------*         
020200*    ABEND PROCESSING COPYBOOK.                                 *         
020300*---------------------------------------------------------------*         
020400                                                                          
020500     COPY DPWS013.                                                        
020600                                                                          
020700     EJECT                                                                
020800*---------------------------------------------------------------*         
020900*    ATTRIBUTE SETTINGS COPYBOOK.                               *         
021000*---------------------------------------------------------------*         
021100                                                                          
021200     COPY DPWS015.                                                        
021300                                                                          
021400*---------------------------------------------------------------*         
021500*    FUNCTION KEYS COPYBOOK.                                    *         
021600*---------------------------------------------------------------*         
021700                                                                          
021800     COPY DPWS016.                                                        
021900                                                                          
022000*---------------------------------------------------------------*         
022100*    NUMERIC EDIT LAYOUT.                                       *         
022200*---------------------------------------------------------------*         
022300                                                                          
022400     COPY DPWS010I.                                                       
022500                                                                          
022600*---------------------------------------------------------------*         
022700*    MAP LAYOUT                                                 *         
022800*---------------------------------------------------------------*         
022900                                                                          
023000     COPY TRKM325.                                                        
023100                                                                          
024011 01  MR-OCCURS-LAYOUT                    REDEFINES  TR325AO.              
024012     05  FILLER                          PIC X(63).                       
024014     05  MR-SCROLL-AREA                  OCCURS 12 TIMES.                 
024020         10  MR-VESSELL                  PIC S9(04) COMP.                 
024030         10  MR-VESSELA                  PIC  X(01).                      
024040         10  MR-VESSELC                  PIC  X(01).                      
024050         10  MR-VESSELH                  PIC  X(01).                      
024060         10  MR-VESSEL                   PIC  X(10).                      
024070                                                                          
024080         10  MR-CONTNRL                  PIC S9(04) COMP.                 
024090         10  MR-CONTNRA                  PIC  X(01).                      
024091         10  MR-CONTNRC                  PIC  X(01).                      
024092         10  MR-CONTNRH                  PIC  X(01).                      
024093         10  MR-CONTNR                   PIC  X(12).                      
024094                                                                          
024095         10  MR-PO-NBRL                  PIC S9(04) COMP.                 
024096         10  MR-PO-NBRA                  PIC  X(01).                      
024097         10  MR-PO-NBRC                  PIC  X(01).                      
024098         10  MR-PO-NBRH                  PIC  X(01).                      
024099** CHG0094517 CHANGED PO-NBR LENGTH FROM 7 TO 8                           
024099         10  MR-PO-NBR                  PIC  ZZZZZZZ9.                    
024100         10  MR-PO-NBR-X REDEFINES MR-PO-NBR                              
024101                                        PIC  X(08).                       
024102                                                                          
024103         10  MR-ETAL                     PIC S9(04) COMP.                 
024104         10  MR-ETAA                     PIC  X(01).                      
024105         10  MR-ETAC                     PIC  X(01).                      
024106         10  MR-ETAH                     PIC  X(01).                      
024107         10  MR-ETA                      PIC  X(05).                      
024108                                                                          
024109         10  MR-SCACL                    PIC S9(04) COMP.                 
024110         10  MR-SCACA                    PIC  X(01).                      
024111         10  MR-SCACC                    PIC  X(01).                      
024112         10  MR-SCACH                    PIC  X(01).                      
024113         10  MR-SCAC                     PIC  X(04).                      
024114                                                                          
024115         10  MR-ERRMSGL                  PIC S9(04) COMP.                 
024116         10  MR-ERRMSGA                  PIC  X(01).                      
024117         10  MR-ERRMSGC                  PIC  X(01).                      
024118         10  MR-ERRMSGH                  PIC  X(01).                      
024119         10  MR-ERRMSG                   PIC  X(32).                      
024120                                                                          
024130 EJECT                                                                    
024200*---------------------------------------------------------------*         
024300*    DB2 AREA FOR TMESSAGE                                      *         
024400*---------------------------------------------------------------*         
024500     EXEC SQL                                                             
024600          INCLUDE TSYMSG                                                  
024700     END-EXEC.                                                            
024800*---------------------------------------------------------------*         
024900*    DB2 AREA FOR MESSAGE TEXT AND CORRECTIVE ACTION            *         
025000*---------------------------------------------------------------*         
025100     EXEC SQL                                                             
025200          INCLUDE TSYMSGT                                                 
025300     END-EXEC.                                                            
025310*---------------------------------------------------------------*         
025320*    DB2 AREA FOR DECONSOLIDATOR CONTROL PANEL RULE TABLE       *         
025330*---------------------------------------------------------------*         
025340     EXEC SQL                                                             
025350          INCLUDE TRT00014                                                
025360     END-EXEC.                                                            
025370*---------------------------------------------------------------*         
025380*    DB2 AREA FOR DECONSOLIDATOR CONTROL PANEL RULE CONSTRAINT  *         
025381*    TABLE                                                      *         
025390*---------------------------------------------------------------*         
025391     EXEC SQL                                                             
025392          INCLUDE TRT00015                                                
025393     END-EXEC.                                                            
025370*---------------------------------------------------------------*         
025320*    DB2 AREA FOR PURCHASE ORDER TABEL                                    
025390*---------------------------------------------------------------*         
041400     EXEC SQL                                                             
041500          INCLUDE TPURCHS                                                 
041600     END-EXEC.                                                            
025400*---------------------------------------------------------------*         
039300*    DB2 AREA FOR IMPORTS CONTAINER PO TABLE                     *        
025400*---------------------------------------------------------------*         
039500     EXEC SQL                                                             
039600          INCLUDE TIMCNPO                                                 
039700     END-EXEC.                                                            
025400*---------------------------------------------------------------*         
025500*    DB2 AREA FOR COMMUNICATIONS                                *         
025600*---------------------------------------------------------------*         
025700     EXEC SQL                                                             
025800          INCLUDE SQLCA                                                   
025900     END-EXEC.                                                            
026000                                                                          
053100*---------------------------------------------------------------*         
053200*    CURSOR TO PULL PURCHASE ORDERS FOR EACH CONTAINER.         *         
053300*---------------------------------------------------------------*         
053400                                                                          
053500     EXEC SQL                                                             
053600        DECLARE PO_CUR CURSOR                                             
053700          FOR                                                             
053800***                                                                       
053900***   CON POS                                                             
054000***                                                                       
054100           SELECT PO.PO_NBR                                               
054200                 ,CONT.RUL_CNSTR_VAL_TXT                                  
                       ,ETA.RUL_CNSTR_VAL_TXT                                   
                       ,'SEQ'                                                   
                       ,VSL.RUL_CNSTR_VAL_TXT                                   
                       ,'VOY'                                                   
054300                 ,'CON'                                                   
                       ,'PO ASSIGNED TO MULTIPLE DECONS'                        
054400            FROM  TRT_RUL_CNSTR CONPO                                     
054500                 ,TRT_RUL_CNSTR CONT                                      
054500                 ,TRT_RUL_CNSTR ETA                                       
054500                 ,TRT_RUL_CNSTR VSL                                       
054600                 ,TPURCHS PO                                              
                       ,(SELECT A.RUL_ID                                        
                         FROM   TRT_RUL_CNSTR A                                 
                               ,TRT_RUL_CNSTR B                                 
                               ,TRT_RUL       C                                 
                         WHERE  A.RUL_ID            = B.RUL_ID                  
                           AND  A.RUL_ID            = C.RUL_ID                  
                           AND  A.RUL_CNSTR_TYP_CDE = 'CONT'                    
                           AND  B.RUL_CNSTR_TYP_CDE = 'POE'                     
                           AND  B.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE              
                           AND  C.RUL_CDE       = 'CONT'                        
                           AND  C.RUL_TYP_CDE   = 'DEF'                         
                           AND  C.RUL_BEG_DTE   = :ASC-WEEK-FROM-DTE            
                           AND  C.RUL_END_DTE   = :ASC-WEEK-TO-DTE) RUL         
054700           WHERE CONPO.RUL_ID             = RUL.RUL_ID                    
054800             AND CONPO.RUL_ID             = CONT.RUL_ID                   
054800             AND CONPO.RUL_ID             = ETA.RUL_ID                    
054800             AND CONPO.RUL_ID             = VSL.RUL_ID                    
054900             AND CONPO.RUL_CNSTR_TYP_CDE  = 'CONPO'                       
055000             AND CONT.RUL_CNSTR_TYP_CDE   = 'CONT'                        
055000             AND ETA.RUL_CNSTR_TYP_CDE    = 'ETA'                         
055000             AND VSL.RUL_CNSTR_TYP_CDE    = 'VSL'                         
055100             AND INTEGER(SUBSTR(CONPO.RUL_CNSTR_VAL_TXT,1,9))             
                                                = PO.PO_NBR                     
                   AND PO.PO_TYP_CDE            IN ('IM','IE','IF','LD',        
181356                                              'LE')                       
                   AND PO.VER_STATUS_CDE        = 'A'                           
                   AND PO.STATUS_CDE            IN ('AC','AP','CA','CM')        
055200    UNION ALL                                                             
055300*--                                                                       
055400*--  CMNS                                                                 
055500*--                                                                       
055600           SELECT CNPO.PO_NBR                                             
055700                 ,CNPO.CONTNR_ID                                          
                       ,ETA.RUL_CNSTR_VAL_TXT                                   
                       ,SEQ.RUL_CNSTR_VAL_TXT                                   
                       ,VSL.RUL_CNSTR_VAL_TXT                                   
                       ,VOY.RUL_CNSTR_VAL_TXT                                   
                       ,'CMN'                                                   
                       ,'PO ASSIGNED TO MULTIPLE DECONS'                        
                 FROM   TIMCNPO CNPO                                            
                       ,TPURCHS PO                                              
                       ,TRT_RUL_CNSTR CONT                                      
                       ,TRT_RUL_CNSTR SEQ                                       
                       ,TRT_RUL_CNSTR VSL                                       
                       ,TRT_RUL_CNSTR VOY                                       
                       ,TRT_RUL_CNSTR ETA                                       
                       ,(SELECT A.RUL_ID                                        
                         FROM   TRT_RUL_CNSTR A                                 
                               ,TRT_RUL_CNSTR B                                 
                               ,TRT_RUL       C                                 
                         WHERE  A.RUL_ID            = B.RUL_ID                  
                           AND  A.RUL_ID            = C.RUL_ID                  
                           AND  A.RUL_CNSTR_TYP_CDE = 'CONT'                    
                           AND  B.RUL_CNSTR_TYP_CDE = 'POE'                     
                           AND  B.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE              
                           AND  C.RUL_CDE           = 'CONT'                    
                           AND  C.RUL_TYP_CDE       = 'DEF'                     
                           AND  C.RUL_BEG_DTE   = :ASC-WEEK-FROM-DTE            
                           AND  C.RUL_END_DTE   = :ASC-WEEK-TO-DTE) RUL         
056000            WHERE CONT.RUL_ID            = RUL.RUL_ID                     
056100              AND CONT.RUL_ID            = SEQ.RUL_ID                     
056100              AND CONT.RUL_ID            = VSL.RUL_ID                     
056100              AND CONT.RUL_ID            = VOY.RUL_ID                     
056100              AND CONT.RUL_ID            = ETA.RUL_ID                     
056200              AND CONT.RUL_CNSTR_TYP_CDE = 'CONT'                         
056300              AND SEQ.RUL_CNSTR_TYP_CDE  = 'SEQ'                          
056300              AND VSL.RUL_CNSTR_TYP_CDE  = 'VSL'                          
056300              AND VOY.RUL_CNSTR_TYP_CDE  = 'VOY'                          
056300              AND ETA.RUL_CNSTR_TYP_CDE  = 'ETA'                          
056400              AND CNPO.CONTNR_ID         = CONT.RUL_CNSTR_VAL_TXT         
056500              AND CNPO.CONTNR_SEQ_NBR    =                                
                                          INT(SEQ.RUL_CNSTR_VAL_TXT)            
                    AND CNPO.PO_NBR            = PO.PO_NBR                      
                    AND PO.PO_TYP_CDE          IN ('IM','IE','IF','LD',         
181356                                             'LE')                        
                    AND PO.VER_STATUS_CDE      = 'A'                            
                    AND PO.STATUS_CDE          IN ('AC','AP','CA','CM')         
056600**          ELIMINATE PO OVERIDES                                         
056700              AND NOT EXISTS                                              
056800                (SELECT *                                                 
056900                   FROM TRT_RUL_CNSTR CT                                  
057000                  WHERE CT.RUL_ID = CONT.RUL_ID                           
057100                    AND CT.RUL_CNSTR_TYP_CDE = 'CONPO')                   
                  ORDER BY 1                                                    
057200     END-EXEC.                                                            
                                                                                
053100*---------------------------------------------------------------*         
053200*    CURSOR TO PULL PURCHASE ORDERS FOR EACH CONTAINER.         *         
053300*---------------------------------------------------------------*         
053400                                                                          
053500     EXEC SQL                                                             
053600        DECLARE VSL_CUR CURSOR                                            
053700          FOR                                                             
053800***                                                                       
053900***   CON POS                                                             
054000***                                                                       
054100           SELECT PO.PO_NBR                                               
054200                 ,CONT.RUL_CNSTR_VAL_TXT                                  
                       ,ETA.RUL_CNSTR_VAL_TXT                                   
                       ,'SEQ'                                                   
                       ,VSL.RUL_CNSTR_VAL_TXT                                   
                       ,'VOY'                                                   
054300                 ,'CON'                                                   
                       ,'VESSEL ASSIGNED TO MULTIPLE DECONS'                    
054400            FROM  TRT_RUL_CNSTR CONPO                                     
054500                 ,TRT_RUL_CNSTR CONT                                      
054500                 ,TRT_RUL_CNSTR ETA                                       
054500                 ,TRT_RUL_CNSTR VSL                                       
054600                 ,TPURCHS PO                                              
                       ,(SELECT A.RUL_ID                                        
                         FROM   TRT_RUL_CNSTR A                                 
                               ,TRT_RUL_CNSTR B                                 
                               ,TRT_RUL       C                                 
                         WHERE  A.RUL_ID            = B.RUL_ID                  
                           AND  A.RUL_ID            = C.RUL_ID                  
                           AND  A.RUL_CNSTR_TYP_CDE = 'CONT'                    
                           AND  B.RUL_CNSTR_TYP_CDE = 'POE'                     
                           AND  B.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE              
                           AND  C.RUL_CDE       = 'CONT'                        
                           AND  C.RUL_TYP_CDE   = 'DEF'                         
                           AND  C.RUL_BEG_DTE   = :ASC-WEEK-FROM-DTE            
                           AND  C.RUL_END_DTE   = :ASC-WEEK-TO-DTE) RUL         
054700           WHERE CONPO.RUL_ID             = RUL.RUL_ID                    
054800             AND CONPO.RUL_ID             = CONT.RUL_ID                   
054800             AND CONPO.RUL_ID             = ETA.RUL_ID                    
054800             AND CONPO.RUL_ID             = VSL.RUL_ID                    
054900             AND CONPO.RUL_CNSTR_TYP_CDE  = 'CONPO'                       
055000             AND CONT.RUL_CNSTR_TYP_CDE   = 'CONT'                        
055000             AND ETA.RUL_CNSTR_TYP_CDE    = 'ETA'                         
055000             AND VSL.RUL_CNSTR_TYP_CDE    = 'VSL'                         
055100             AND INTEGER(SUBSTR(CONPO.RUL_CNSTR_VAL_TXT,1,9))             
                                                = PO.PO_NBR                     
                   AND PO.PO_TYP_CDE            IN ('IM','IE','IF','LD',        
181356                                              'LE')                       
                   AND PO.VER_STATUS_CDE        = 'A'                           
                   AND PO.STATUS_CDE            IN ('AC','AP','CA','CM')        
055200    UNION ALL                                                             
055300*--                                                                       
055400*--  CMNS                                                                 
055500*--                                                                       
055600           SELECT CNPO.PO_NBR                                             
055700                 ,CNPO.CONTNR_ID                                          
                       ,ETA.RUL_CNSTR_VAL_TXT                                   
                       ,SEQ.RUL_CNSTR_VAL_TXT                                   
                       ,VSL.RUL_CNSTR_VAL_TXT                                   
                       ,VOY.RUL_CNSTR_VAL_TXT                                   
                       ,'CMN'                                                   
                       ,'VESSEL ASSIGNED TO MULTIPLE DECONS'                    
                 FROM   TIMCNPO CNPO                                            
                       ,TPURCHS PO                                              
                       ,TRT_RUL_CNSTR CONT                                      
                       ,TRT_RUL_CNSTR SEQ                                       
                       ,TRT_RUL_CNSTR VSL                                       
                       ,TRT_RUL_CNSTR VOY                                       
                       ,TRT_RUL_CNSTR ETA                                       
                       ,(SELECT A.RUL_ID                                        
                         FROM   TRT_RUL_CNSTR A                                 
                               ,TRT_RUL_CNSTR B                                 
                               ,TRT_RUL       C                                 
                         WHERE  A.RUL_ID            = B.RUL_ID                  
                           AND  A.RUL_ID            = C.RUL_ID                  
                           AND  A.RUL_CNSTR_TYP_CDE = 'CONT'                    
                           AND  B.RUL_CNSTR_TYP_CDE = 'POE'                     
                           AND  B.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE              
                           AND  C.RUL_CDE           = 'CONT'                    
                           AND  C.RUL_TYP_CDE       = 'DEF'                     
                           AND  C.RUL_BEG_DTE   = :ASC-WEEK-FROM-DTE            
                           AND  C.RUL_END_DTE   = :ASC-WEEK-TO-DTE) RUL         
056000            WHERE CONT.RUL_ID            = RUL.RUL_ID                     
056100              AND CONT.RUL_ID            = SEQ.RUL_ID                     
056100              AND CONT.RUL_ID            = VSL.RUL_ID                     
056100              AND CONT.RUL_ID            = VOY.RUL_ID                     
056100              AND CONT.RUL_ID            = ETA.RUL_ID                     
056200              AND CONT.RUL_CNSTR_TYP_CDE = 'CONT'                         
056300              AND SEQ.RUL_CNSTR_TYP_CDE  = 'SEQ'                          
056300              AND VSL.RUL_CNSTR_TYP_CDE  = 'VSL'                          
056300              AND VOY.RUL_CNSTR_TYP_CDE  = 'VOY'                          
056300              AND ETA.RUL_CNSTR_TYP_CDE  = 'ETA'                          
056400              AND CNPO.CONTNR_ID         = CONT.RUL_CNSTR_VAL_TXT         
056500              AND CNPO.CONTNR_SEQ_NBR    =                                
                                          INT(SEQ.RUL_CNSTR_VAL_TXT)            
                    AND CNPO.PO_NBR            = PO.PO_NBR                      
                    AND PO.PO_TYP_CDE          IN ('IM','IE','IF','LD',         
181356                                             'LE')                        
                    AND PO.VER_STATUS_CDE      = 'A'                            
                    AND PO.STATUS_CDE          IN ('AC','AP','CA','CM')         
056600**          ELIMINATE PO OVERIDES                                         
056700              AND NOT EXISTS                                              
056800                (SELECT *                                                 
056900                   FROM TRT_RUL_CNSTR CT                                  
057000                  WHERE CT.RUL_ID = CONT.RUL_ID                           
057100                    AND CT.RUL_CNSTR_TYP_CDE = 'CONPO')                   
                  ORDER BY 5                                                    
057200     END-EXEC.                                                            
057300                                                                          
027900                                                                          
028000 EJECT                                                                    
028100 LINKAGE SECTION.                                                         
028200                                                                          
028300 01  DFHCOMMAREA.                                                         
028400     05  FILLER                         OCCURS  1 TO 4072 TIMES           
028500                                        DEPENDING ON EIBCALEN.            
028600         10  FILLER                     PIC X.                            
028700                                                                          
028800 EJECT                                                                    
028900 PROCEDURE DIVISION.                                                      
029000                                                                          
029100 0000-MAIN-MODULE.                                                        
029200                                                                          
029300     INITIALIZE DP030-CICS-API-FIELDS.                                    
029400     MOVE +1                      TO DP030-NUMBER-OF-MAPS.                
029500     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.                   
029600     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).                  
029700     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                                
029800     MOVE LENGTH OF TR325AI       TO DP030-MAP-LENGTH (1).                
029900     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).              
030000     PERFORM 0001-CALL-CICS-ARCH-API.                                     
030100                                                                          
030200     PERFORM 1000-CONTROL-PROCESSING.                                     
030300                                                                          
030400     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).              
030500     PERFORM 0001-CALL-CICS-ARCH-API.                                     
030600                                                                          
030700*----------------------------------------------------------------*        
030800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *        
030900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *        
031000*----------------------------------------------------------------*        
031100                                                                          
031200 0001-CALL-CICS-ARCH-API.                                                 
031300                                                                          
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
031500                                    DFHCOMMAREA                           
031600                                    DP030-CICS-API-FIELDS                 
031700                                    DP020-STANDARD-COMMAREA               
031800                                    TR325AI.                              
031900                                                                          
032000     IF  DP030-RC-CALL-SUCCESSFUL                                         
032100         CONTINUE                                                         
032200     ELSE                                                                 
032300         SET DP013-NO-ROLLBACK TO TRUE                                    
032400         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                           
032500         SET DP013-CICS-ABEND TO TRUE                                     
032600         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH                
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
032900         MOVE DP030-RETURN-CODE                                           
033000                               TO DP013-MESSAGE-TEXT (3)                  
033100         PERFORM DP013-0000-PROCESS-ABEND                                 
033200     END-IF.                                                              
033300                                                                          
033400*----------------------------------------------------------------*        
033500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *        
033600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *        
033700*                                                                *        
033800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *        
033900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *        
034000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *        
034100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *        
034200*----------------------------------------------------------------*        
034300                                                                          
034400 1000-CONTROL-PROCESSING.                                                 
034500                                                                          
034600     EVALUATE TRUE                                                        
034700         WHEN DP020-NEXT-ACT-INITIAL                                      
034800             MOVE EIBTRMID          TO ASC-DTL-TERM-ID                    
034900             MOVE DP020-SRC-TASK-NUMBER                                   
035000                                    TO ASC-DTL-TASK-NUMBER                
035100             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                        
035200             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
035300***-----$TEMPLATE NOTE$-------------------------------------------        
035400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,        
035500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO          
035600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.        
035700***---------------------------------------------------------------        
035800             IF  PS-COMMAREA-NOT-VALID                                    
036300                 SET DP020-NEXT-ACT-APPL-ERROR                            
036400                               TO  TRUE                                   
036500             ELSE                                                         
048100                 PERFORM 2050-DELETE-LIST-QUEUE                           
036700                 PERFORM 4000-BUILD-INITIAL-PANEL                         
036800             END-IF                                                       
036900                                                                          
037000         WHEN DP020-NEXT-ACT-READ-MAP                                     
037100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
037200                               TO PV-TOP-ITEM                             
037300             PERFORM 2000-PROCESS-PANEL                                   
037400                                                                          
037500         WHEN DP020-NEXT-ACT-RETURN                                       
037600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
037700                               TO PV-TOP-ITEM                             
037800             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL                
037900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
038000                                                                          
038100         WHEN OTHER                                                       
038200             SET DP013-LOGIC-ABEND TO TRUE                                
038300             SET DP013-NO-ROLLBACK TO TRUE                                
038400             MOVE '1000-CONTROL-PROCESSING'                               
038500                               TO  DP013-PARAGRAPH                        
038600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
038700                               TO  DP013-MESSAGE-TEXT(1)                  
038800             PERFORM DP013-0000-PROCESS-ABEND                             
038900     END-EVALUATE.                                                        
039000                                                                          
039100 EJECT                                                                    
039200*----------------------------------------------------------------*        
039300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *        
039400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *        
039500*----------------------------------------------------------------*        
039600                                                                          
039700 1100-PROCESS-INTER-APPL-COMM.                                            
039800                                                                          
039900     SET PS-COMMAREA-VALID     TO TRUE.                                   
040000     INITIALIZE ASC-SPECIFIC-COMMAREA.                                    
040100     MOVE SPACE                TO ASC-START-ITEM-REQUEST.                 
                                                                                
040110     MOVE 'DEFAULT'            TO ASC-VIEW.                               
040130     MOVE TR320-POE-CDE        TO ASC-POE-CDE.                            
040160     MOVE TR320-WEEK-FROM-DTE  TO ASC-WEEK-FROM-DTE.                      
040180     MOVE TR320-WEEK-TO-DTE    TO ASC-WEEK-TO-DTE.                        
040193                                                                          
046500*----------------------------------------------------------------*        
046600*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *        
046700*    ON WHAT FUNCTION KEY WAS SELECTED.                          *        
046800*----------------------------------------------------------------*        
047000 2000-PROCESS-PANEL.                                                      
047100                                                                          
047200     EVALUATE TRUE                                                        
047300         WHEN DP020-SRC-AID = DP016-CLEAR                                 
889740             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
889741             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
889742             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
047700                                                                          
047800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
048100             PERFORM 2050-DELETE-LIST-QUEUE                               
048200             PERFORM 4000-BUILD-INITIAL-PANEL                             
048400                                                                          
054200                                                                          
054300         WHEN OTHER                                                       
054310*            PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
054320*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
054330             IF  PS-NO-ERROR                                              
054340                 SET DP030-CONTINUE-GO                                    
054350                                 TO TRUE                                  
054360                 PERFORM 2100-CHECK-FUNCTION-KEY                          
054370             ELSE                                                         
054380                 SET DP030-OVERRIDE-GO                                    
054390                                 TO TRUE                                  
054391             END-IF                                                       
055100                                                                          
055200     END-EVALUATE.                                                        
055294                                                                          
055300 EJECT                                                                    
055400*----------------------------------------------------------------*        
055500*    DELETE THE TEMPORARY STORAGE QUEUE.                         *        
055600*----------------------------------------------------------------*        
055700                                                                          
055800 2050-DELETE-LIST-QUEUE.                                                  
055900                                                                          
056000     EXEC CICS                                                            
056100         DELETEQ TS                                                       
056200             QUEUE (ASC-DTL-QUEUE-NAME)                                   
056300             RESP  (PV-CICS-RESP)                                         
056400     END-EXEC.                                                            
056500                                                                          
056600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
056700        (PV-CICS-RESP = DFHRESP(QIDERR))                                  
056800         CONTINUE                                                         
056900     ELSE                                                                 
057000         SET DP013-CICS-ABEND TO TRUE                                     
057100         SET DP013-NO-ROLLBACK TO TRUE                                    
057200                                                                          
057300         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH                 
057400         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'          
057500                        TO DP013-MESSAGE-TEXT (1)                         
057600         PERFORM DP013-0000-PROCESS-ABEND                                 
057700     END-IF.                                                              
057800                                                                          
057900     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                                
058000 EJECT                                                                    
058001*----------------------------------------------------------------*        
058002* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
058003* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
058004* CICS ARCHITECTURE API.                                         *        
058005*----------------------------------------------------------------*        
058006 2100-CHECK-FUNCTION-KEY.                                                 
058007                                                                          
058008     EVALUATE TRUE                                                        
058010*        ***** SWITCH TO DEFAULT VIEW                                     
058020         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)                      
058030             MOVE 'DEFAULT'            TO ASC-VIEW                        
058040*                                         PV-VIEW                         
058050             MOVE 'DEF'                TO PV-RUL-TYP                      
058060*                                         ASC-RUL-TYP                     
058070             MOVE ASC-POE-CDE          TO PV-POE-CDE                      
058080*            MOVE ASC-WEEK-FROM-DTE    TO PV-WEEK-FROM-DTE                
058090*            MOVE ASC-WEEK-TO-DTE      TO PV-WEEK-TO-DTE                  
058093             PERFORM 2050-DELETE-LIST-QUEUE                               
058094             PERFORM 4000-BUILD-INITIAL-PANEL                             
058095                                                                          
058096*        ***** SWITCH TO WORKING VIEW                                     
058097         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)                      
058098            MOVE 'WORKING'                TO ASC-VIEW                     
058099                                             PV-VIEW                      
058100            MOVE 'WKG'                    TO PV-RUL-TYP                   
058101*                                            ASC-RUL-TYP                  
058102            MOVE ASC-POE-CDE              TO PV-POE-CDE                   
058103*           MOVE ASC-WEEK-FROM-DTE        TO PV-WEEK-FROM-DTE             
058104*           MOVE ASC-WEEK-TO-DTE          TO PV-WEEK-TO-DTE               
058105            PERFORM 2050-DELETE-LIST-QUEUE                                
058106            PERFORM 4000-BUILD-INITIAL-PANEL                              
058107                                                                          
058108*           ***** SWITCH TO ADJUSTED VIEW                                 
058109         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)                      
058110            MOVE 'ADJUSTED'               TO ASC-VIEW                     
058111                                             PV-VIEW                      
058112            MOVE 'ADJ'                    TO PV-RUL-TYP                   
058113*                                            ASC-RUL-TYP                  
058114            MOVE ASC-POE-CDE              TO PV-POE-CDE                   
058115*           MOVE ASC-WEEK-FROM-DTE        TO PV-WEEK-FROM-DTE             
058116*           MOVE ASC-WEEK-TO-DTE          TO PV-WEEK-TO-DTE               
058117            PERFORM 2050-DELETE-LIST-QUEUE                                
058118            PERFORM 4000-BUILD-INITIAL-PANEL                              
058119                                                                          
051900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
052000             MOVE +1 TO PV-TOP-ITEM                                       
052100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
052200*            PERFORM 3200-RESET-ATTRIBUTES                                
052300                                                                          
052400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
052500             PERFORM 2110-BROWSE-BACKWARD                                 
052600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
052700*            PERFORM 3200-RESET-ATTRIBUTES                                
052800                                                                          
052900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
053000             PERFORM 2120-BROWSE-FORWARD                                  
053100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
053200*            PERFORM 3200-RESET-ATTRIBUTES                                
053300                                                                          
053400         WHEN DP020-SRC-AID = DP016-ENTER                                 
053500*            PERFORM 2130-CHECK-FOR-JUMP-BROWSE                           
053600*            IF  PS-ERROR                                                 
053700*                CONTINUE                                                 
053800*            ELSE                                                         
053900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
054000*                PERFORM 3200-RESET-ATTRIBUTES                            
054100*            END-IF                                                       
                                                                                
058120         WHEN OTHER                                                       
058121             SET DP013-NO-ROLLBACK                                        
058122                 DP013-XCTL-DISPLAY-RESTART                               
058123                 DP013-CICS-ABEND  TO TRUE                                
058124             MOVE '2100-CHECK-FUNCTION-KEY'                               
058125                                   TO DP013-PARAGRAPH                     
058126             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
058127                                   TO DP013-MESSAGE-TEXT (1)              
058128             PERFORM DP013-0000-PROCESS-ABEND                             
058129     END-EVALUATE.                                                        
058130                                                                          
058140*----------------------------------------------------------------*        
058200*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
058300*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
058400*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
058500*    MESSAGE.                                                    *        
058600*----------------------------------------------------------------*        
058700                                                                          
058800 2110-BROWSE-BACKWARD.                                                    
058900                                                                          
059000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
059100         GIVING PV-TOP-ITEM.                                              
059200                                                                          
059300     IF  PV-TOP-ITEM < +1                                                 
059400         MOVE +1              TO PV-TOP-ITEM                              
059500*        -- TOP OF LIST --                                                
059600         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                         
059700         SET DP020-MSG-INFORMATIONAL TO TRUE                              
059800     END-IF.                                                              
059900                                                                          
060000 EJECT                                                                    
060100                                                                          
060200*----------------------------------------------------------------*        
060300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
060400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
060500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
060600*----------------------------------------------------------------*        
060700                                                                          
060800 2120-BROWSE-FORWARD.                                                     
060900                                                                          
061000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
061100         GIVING PV-TOP-ITEM.                                              
061200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
061300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
061400                                   TO PV-TOP-ITEM                         
061500*        -- BOTTOM OF LIST --                                             
061600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
061700         SET DP020-MSG-INFORMATIONAL                                      
061800                                   TO TRUE                                
061900     ELSE                                                                 
062000         COMPUTE PV-BOTTOM-ITEM =                                         
062100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
062200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
062300*            -- BOTTOM OF LIST --                                         
062400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
062500             SET DP020-MSG-INFORMATIONAL                                  
062600                                   TO TRUE                                
062700         END-IF                                                           
062800     END-IF.                                                              
062900 EJECT                                                                    
063000*----------------------------------------------------------------*        
063100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *        
063200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *        
063300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *        
063400*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *        
063500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *        
063600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *        
063700*----------------------------------------------------------------*        
063800*                                                                         
063900*2130-CHECK-FOR-JUMP-BROWSE.                                              
064000*                                                                         
064100*    IF ASTRTITL > ZERO                                                   
064200*        MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST              
064300*    ELSE                                                                 
064400*        IF ASTRTITF = DP015-ERASE-EOF                                    
064500*            INITIALIZE ASC-START-ITEM-REQUEST                            
064600*        END-IF                                                           
064700*    END-IF.                                                              
064800*                                                                         
064900*    SET PS-NO-ERROR               TO TRUE.                               
065000*    IF (ASC-START-ITEM-REQUEST = SPACE)                                  
065100*        MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
065200*                                  TO PV-TOP-ITEM                         
065300*    ELSE                                                                 
065400*        MOVE ASC-START-ITEM-REQUEST                                      
065500*                                  TO DP010I-UNEDITED-FIELD               
065600*        MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS               
065700*        MOVE +0                   TO DP010I-MAXIMUM-DECIMALS             
065800*        SET DP010I-NEGATIVE-NOT-ALLOWED                                  
065900*                                  TO TRUE                                
263697*        CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697*             USING DP010I-NUMERIC-EDIT-AREA                              
066100*                                                                         
066200*        IF  NOT DP010I-ERROR-DETECTED                                    
066300*            MOVE DP010I-NUMERIC-FIELD                                    
066400*                                  TO  ASC-START-ITEM-REQUEST-N           
066500*            IF  ASC-START-ITEM-REQUEST-N > ZERO                          
066600*                IF  ASC-START-ITEM-REQUEST-N >                           
066700*                                         ASC-NUMBER-OF-ITEMS-READ        
066800*                    MOVE SPACE TO ASC-START-ITEM-REQUEST                 
066900*                    COMPUTE PV-TOP-ITEM =                                
067000*                            ASC-NUMBER-OF-ITEMS-READ                     
067100*                            - PC-ITEMS-PER-PANEL + 1                     
067200*                    IF  PV-TOP-ITEM < +1                                 
067300*                        MOVE +1   TO PV-TOP-ITEM                         
067400*                        MOVE PC-TSYMSG-00070                             
067500*                                  TO DP020-MSG-NUMBER                    
067600*                        SET DP020-MSG-INFORMATIONAL                      
067700*                                  TO TRUE                                
067800*                    END-IF                                               
067900*                ELSE                                                     
068000*                    MOVE ASC-START-ITEM-REQUEST-N                        
068100*                                  TO PV-TOP-ITEM                         
068200*                    MOVE SPACE    TO ASC-START-ITEM-REQUEST              
068300*                    COMPUTE PV-BOTTOM-ITEM =                             
068400*                        PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             
068500*                    IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        
068600*                        -- BOTTOM OF LIST --                             
068700*                        MOVE PC-TSYMSG-00070                             
068800*                                  TO DP020-MSG-NUMBER                    
068900*                        SET DP020-MSG-INFORMATIONAL                      
069000*                                  TO TRUE                                
069100*                    END-IF                                               
069200*                END-IF                                                   
069300*            ELSE                                                         
069400*                --- VALUE OUT OF RANGE ----                              
069500*                MOVE PC-TSYMSG-00101                                     
069600*                                  TO DP020-MSG-NUMBER                    
069700*                MOVE -1           TO ASTRTITL                            
069800*                SET DP030-SET-CURSOR-APPL-1                              
069900*                                  TO TRUE                                
070000*                MOVE DP015-REVERSE                                       
070100*                                  TO ASTRTITH                            
070200*                MOVE DP015-RED    TO ASTRTITC                            
070300*                MOVE DP015-UNP-NUM-BRT-MDT                               
070400*                                  TO ASTRTITA                            
070500*                SET DP020-MSG-FATAL                                      
070600*                                  TO TRUE                                
070700*                SET PS-ERROR      TO TRUE                                
070800*            END-IF                                                       
070900*                                                                         
071000*        ELSE                                                             
071100*            MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                    
071200*            MOVE -1               TO ASTRTITL                            
071300*            SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
071400*            MOVE DP015-REVERSE    TO ASTRTITH                            
071500*            MOVE DP015-RED        TO ASTRTITC                            
071600*            MOVE DP015-UNP-NUM-BRT-MDT                                   
071700*                                  TO ASTRTITA                            
071800*            SET DP020-MSG-FATAL   TO TRUE                                
071900*            SET PS-ERROR          TO TRUE                                
072000*        END-IF                                                           
072100*    END-IF.                                                              
072200*EJECT                                                                    
072300*                                                                         
891123**--------------------------------------------------------------**DPKCS036
891124** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **DPKCS036
891125** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **DPKCS036
891126**--------------------------------------------------------------**DPKCS036
891127 3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
891128                                                                  DPKCS036
891129     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
891130     MOVE ASC-ITEMS-DISPLAYED      TO PS-SUB.                     DPKCS036
891131**                                                                DPKCS036
891132* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              DPKCS036
891133* EDITTING IS DONE FROM THE BOTTOM UP.                            DPKCS036
891134**                                                                DPKCS036
891135     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
891136         ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
891137     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
891138 EJECT                                                            DPKCS036
891139*----------------------------------------------------------------*DPKCS036
891140*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *DPKCS036
891141*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*DPKCS036
891142*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *DPKCS036
891143*                                                                *DPKCS036
891144*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *DPKCS036
891145*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *DPKCS036
891146*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *DPKCS036
891147*    US IN THE 2ND BLOCK OF THE ARRAY.                           *DPKCS036
891148*----------------------------------------------------------------*DPKCS036
891149 3100-SET-SUBSCRIPTS.                                             DPKCS036
891150                                                                  DPKCS036
891151     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
891152         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        DPKCS036
891153                                                                  DPKCS036
891154     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         DPKCS036
891155         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
891156                                                                  DPKCS036
891157         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               DPKCS036
891158     ELSE                                                         DPKCS036
891159         MOVE +1                     TO ASC-BLK-SUB               DPKCS036
891160     END-IF.                                                      DPKCS036
891161                                                                  DPKCS036
891162 EJECT                                                            DPKCS036
076200                                                                          
078500*----------------------------------------------------------------*        
078600*    RESET ATTRIBUTES.                                           *        
078700*----------------------------------------------------------------*        
078800                                                                          
078900*3200-RESET-ATTRIBUTES.                                                   
079000                                                                          
079100*    MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                           
079200*    MOVE DP015-GREEN              TO ASTRTITC.                           
079300*    MOVE DP015-UNDERLINE          TO ASTRTITH.                           
079400*    MOVE -1                       TO ASTRTITL.                           
079500*    SET DP030-SET-CURSOR-APPL-1   TO TRUE.                               
079600                                                                          
079700 EJECT                                                                    
079800                                                                          
079900*----------------------------------------------------------------*        
080000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
080100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
080200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
080300*    DISPLAY THE PANEL TO USER.                                  *        
080400*----------------------------------------------------------------*        
080500                                                                          
080600 4000-BUILD-INITIAL-PANEL.                                                
080700                                                                          
      *    LOAD PO ERRORS TO ERROR TABLE                                        
           SET ASC-PO-DATA-LEFT-ON-DB TO TRUE.                                  
           MOVE +1                    TO PV-WRITTEN-PO-NBR.                     
082500     PERFORM 4110-OPEN-PO-CURSOR.                                         
           PERFORM 4120-READ-PO-DATA-FROM-DB                                    
              UNTIL ASC-NO-PO-DATA-LEFT-ON-DB.                                  
082900     PERFORM 4130-CLOSE-PO-CURSOR.                                        
                                                                                
      *    VERIFY THAT ERROR WERE FOUND                                         
           IF PV-TABLE-STORE-COUNT = 1                                          
           AND PO-NBR(ERR-IDX) EQUAL ZERO                                       
              MOVE ZERO TO PV-TABLE-STORE-COUNT                                 
              SET ERR-IDX DOWN BY +1                                            
           END-IF.                                                              
                                                                                
      *    LOAD VSL ERRORS TO ERROR TABLE                                       
           INITIALIZE PV-HOLD-ERROR-TABLE.                                      
           SET ASC-VSL-DATA-LEFT-ON-DB TO TRUE.                                 
           MOVE +1                     TO PV-WRITTEN-VSL-NAME.                  
082500     PERFORM 4140-OPEN-VSL-CURSOR.                                        
           PERFORM 4150-READ-VSL-DATA-FROM-DB                                   
              UNTIL ASC-NO-VSL-DATA-LEFT-ON-DB.                                 
082900     PERFORM 4160-CLOSE-VSL-CURSOR.                                       
                                                                                
      *    VERIFY THAT ERROR WERE FOUND                                         
           IF PV-TABLE-STORE-COUNT = 1                                          
           AND PO-NBR(ERR-IDX) EQUAL ZERO                                       
              MOVE ZERO TO PV-TABLE-STORE-COUNT                                 
              SET ERR-IDX DOWN BY +1                                            
           END-IF.                                                              
                                                                                
080800     INITIALIZE                  ASC-BLOCK-ENTRIES (1)                    
080900                                 ASC-BLOCK-ENTRIES (2).                   
081000     MOVE +1                 TO  ASC-BLK-SUB.                             
081300                                                                          
081400     MOVE +0                  TO  ASC-ITEM-SUB                            
081500                                  ASC-NUMBER-OF-ITEMS-READ                
081600                                  ASC-NUMBER-OF-SELECTED-ITEMS            
081700                                  ASC-HIGHEST-BLOCK-WRITTEN               
081800                                  ASC-START-OF-SELECTED-RANGE             
081900                                  ASC-END-OF-SELECTED-RANGE               
082000                                  ASC-ITEM-AT-TOP-OF-PANEL.               
082100                                                                          
           PERFORM 4300-READ-ERROR-TABLE                                        
083000                                                                          
083100     MOVE +1                 TO  PV-TOP-ITEM.                             
083200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
083300*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                            
083400         SET DP020-MSG-FATAL   TO  TRUE                                   
083500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                       
083900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
083600     ELSE                                                                 
083700*        MOVE -1             TO ASTRTITL                                  
083800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
083900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
084000     END-IF.                                                              
084100 EJECT                                                                    
084200*----------------------------------------------------------------*        
084300* OPEN THE CURSOR.                                               *        
084400*----------------------------------------------------------------*        
084500                                                                          
084600 4110-OPEN-PO-CURSOR.                                                     
084700                                                                          
084800     EXEC SQL                                                             
084900          OPEN PO_CUR                                                     
085000     END-EXEC.                                                            
085100                                                                          
085200     EVALUATE TRUE                                                        
085300         WHEN SQLCODE = ZERO                                              
085400              CONTINUE                                                    
085500         WHEN SQLWARN0 NOT EQUAL SPACE                                    
085600         WHEN SQLCODE NOT EQUAL ZERO                                      
085700              MOVE '4110-OPEN-PO-CURSOR'                                  
085800                           TO  DP013-PARAGRAPH                            
085900              MOVE 'OPEN RULES CURSOR'                                    
086000                           TO  DP013-MESSAGE-TEXT (1)                     
086100              MOVE SQLCA   TO  DP013-SQLCA                                
086200              SET DP013-DB2-ABEND                                         
086300                           TO  TRUE                                       
086400              PERFORM DP013-0000-PROCESS-ABEND                            
086500     END-EVALUATE.                                                        
086600                                                                          
086700 EJECT                                                                    
086800*----------------------------------------------------------------*        
086900* CLOSE THE CURSOR.                                              *        
087000*----------------------------------------------------------------*        
087200 4120-READ-PO-DATA-FROM-DB.                                               
                                                                                
           PERFORM 4121-FETCH-PO-CURSOR                                         
                                                                                
           PERFORM 6000-SELECT-SCAC                                             
                                                                                
           EVALUATE TRUE                                                        
              WHEN PV-PO-NBR = PV-HOLD-PO-NBR                                   
                 MOVE PV-HOLD-VSL-NAME      TO VSL-NAME(ERR-IDX)                
                 MOVE PV-HOLD-CONTNR-ID     TO CONTNR-ID(ERR-IDX)               
                 MOVE PV-HOLD-PO-NBR        TO PO-NBR(ERR-IDX)                  
                 MOVE PV-HOLD-ETA           TO ETA-DATE(ERR-IDX)                
                 MOVE PV-HOLD-DCNSL-SCAC    TO DCNSL-SCAC(ERR-IDX)              
                 MOVE PV-HOLD-PO-SPLIT-TYP  TO PO-SPLIT-TYP(ERR-IDX)            
                 MOVE PV-HOLD-ERROR-MESSAGE TO ERROR-MESSAGE(ERR-IDX)           
                 MOVE PV-HOLD-PO-NBR        TO PV-WRITTEN-PO-NBR                
                 MOVE PV-HOLD-DCNSL-SCAC    TO PV-WRITTEN-SCAC                  
                 ADD +1 TO PV-TABLE-STORE-COUNT                                 
                 SET ERR-IDX UP BY +1                                           
                                                                                
                 IF PV-HOLD-DCNSL-SCAC = PV-DCNSL-SCAC                          
                   ADD +1 TO PV-WRITTEN-PO-COUNT                                
                 ELSE                                                           
                   SET PS-WRITE-PO TO TRUE                                      
                 END-IF                                                         
                                                                                
              WHEN PV-HOLD-PO-NBR = PV-WRITTEN-PO-NBR                           
                 MOVE PV-HOLD-VSL-NAME      TO VSL-NAME(ERR-IDX)                
                 MOVE PV-HOLD-CONTNR-ID     TO CONTNR-ID(ERR-IDX)               
                 MOVE PV-HOLD-PO-NBR        TO PO-NBR(ERR-IDX)                  
                 MOVE PV-HOLD-ETA           TO ETA-DATE(ERR-IDX)                
                 MOVE PV-HOLD-DCNSL-SCAC    TO DCNSL-SCAC(ERR-IDX)              
                 MOVE PV-HOLD-PO-SPLIT-TYP  TO PO-SPLIT-TYP(ERR-IDX)            
                 MOVE PV-HOLD-ERROR-MESSAGE TO ERROR-MESSAGE(ERR-IDX)           
                 MOVE PV-HOLD-PO-NBR        TO PV-WRITTEN-PO-NBR                
                 MOVE PV-HOLD-DCNSL-SCAC    TO PV-WRITTEN-SCAC                  
                 ADD +1 TO PV-TABLE-STORE-COUNT                                 
                 SET ERR-IDX UP BY +1                                           
                                                                                
                 IF  PV-HOLD-DCNSL-SCAC = PV-WRITTEN-SCAC                       
                 AND PS-WRITE-PO-NO                                             
                   ADD +1 TO PV-WRITTEN-PO-COUNT                                
                    SUBTRACT PV-WRITTEN-PO-COUNT                                
                        FROM PV-TABLE-STORE-COUNT                               
                    SET ERR-IDX DOWN BY PV-WRITTEN-PO-COUNT                     
                 END-IF                                                         
                 SET PS-WRITE-PO-NO TO TRUE                                     
                 MOVE ZEROES TO PV-WRITTEN-PO-COUNT                             
                                                                                
              WHEN OTHER                                                        
                 IF PV-WRITTEN-PO-COUNT GREATER THAN ZERO                       
                 AND PS-WRITE-PO-NO                                             
                    SUBTRACT PV-WRITTEN-PO-COUNT                                
                        FROM PV-TABLE-STORE-COUNT                               
                    SET ERR-IDX DOWN BY PV-WRITTEN-PO-COUNT                     
                 END-IF                                                         
                 SET PS-WRITE-PO-NO TO TRUE                                     
                 MOVE ZEROES TO PV-WRITTEN-PO-COUNT                             
                                                                                
           END-EVALUATE.                                                        
           MOVE PV-VSL-NAME      TO PV-HOLD-VSL-NAME                            
           MOVE PV-CONTNR-ID     TO PV-HOLD-CONTNR-ID                           
           MOVE PV-PO-NBR        TO PV-HOLD-PO-NBR                              
           MOVE PV-ETA           TO PV-HOLD-ETA                                 
           MOVE PV-DCNSL-SCAC    TO PV-HOLD-DCNSL-SCAC                          
           MOVE PV-PO-SPLIT-TYP  TO PV-HOLD-PO-SPLIT-TYP.                       
           MOVE PV-ERROR-MESSAGE TO PV-HOLD-ERROR-MESSAGE.                      
                                                                                
086800*----------------------------------------------------------------*        
086900* CLOSE THE CURSOR.                                              *        
087000*----------------------------------------------------------------*        
087200 4130-CLOSE-PO-CURSOR.                                                    
087300                                                                          
087400     EXEC SQL                                                             
087500         CLOSE PO_CUR                                                     
087600     END-EXEC.                                                            
087700                                                                          
087800     EVALUATE TRUE                                                        
087900         WHEN SQLCODE = ZERO                                              
088000              CONTINUE                                                    
088100         WHEN SQLWARN0 NOT EQUAL SPACE                                    
088200         WHEN SQLCODE NOT EQUAL ZERO                                      
088300              MOVE '4130-CLOSE-PO-CURSOR'                                 
088400                           TO  DP013-PARAGRAPH                            
088500              MOVE 'CLOSE CONTAINER CURSOR'                               
088600                           TO  DP013-MESSAGE-TEXT (1)                     
088700              MOVE SQLCA   TO  DP013-SQLCA                                
088800              SET DP013-DB2-ABEND                                         
088900                           TO  TRUE                                       
089000              PERFORM DP013-0000-PROCESS-ABEND                            
089100     END-EVALUATE.                                                        
089200                                                                          
089300 EJECT                                                                    
084200*----------------------------------------------------------------*        
084300* OPEN THE CURSOR.                                               *        
084400*----------------------------------------------------------------*        
084500                                                                          
084600 4140-OPEN-VSL-CURSOR.                                                    
084700                                                                          
084800     EXEC SQL                                                             
084900          OPEN VSL_CUR                                                    
085000     END-EXEC.                                                            
085100                                                                          
085200     EVALUATE TRUE                                                        
085300         WHEN SQLCODE = ZERO                                              
085400              CONTINUE                                                    
085500         WHEN SQLWARN0 NOT EQUAL SPACE                                    
085600         WHEN SQLCODE NOT EQUAL ZERO                                      
085700              MOVE '4140-OPEN-VSL-CURSOR'                                 
085800                           TO  DP013-PARAGRAPH                            
085900              MOVE 'OPEN RULES CURSOR'                                    
086000                           TO  DP013-MESSAGE-TEXT (1)                     
086100              MOVE SQLCA   TO  DP013-SQLCA                                
086200              SET DP013-DB2-ABEND                                         
086300                           TO  TRUE                                       
086400              PERFORM DP013-0000-PROCESS-ABEND                            
086500     END-EVALUATE.                                                        
086600                                                                          
086700 EJECT                                                                    
086800*----------------------------------------------------------------*        
086900* CLOSE THE CURSOR.                                              *        
087000*----------------------------------------------------------------*        
087200 4150-READ-VSL-DATA-FROM-DB.                                              
                                                                                
           PERFORM 4122-FETCH-VSL-CURSOR                                        
                                                                                
           PERFORM 6000-SELECT-SCAC                                             
                                                                                
           EVALUATE TRUE                                                        
              WHEN PV-VSL-NAME = PV-HOLD-VSL-NAME                               
                 MOVE PV-HOLD-VSL-NAME      TO VSL-NAME(ERR-IDX)                
                 MOVE PV-HOLD-CONTNR-ID     TO CONTNR-ID(ERR-IDX)               
                 MOVE PV-HOLD-PO-NBR        TO PO-NBR(ERR-IDX)                  
                 MOVE PV-HOLD-ETA           TO ETA-DATE(ERR-IDX)                
                 MOVE PV-HOLD-DCNSL-SCAC    TO DCNSL-SCAC(ERR-IDX)              
                 MOVE PV-HOLD-PO-SPLIT-TYP  TO PO-SPLIT-TYP(ERR-IDX)            
                 MOVE PV-HOLD-ERROR-MESSAGE TO ERROR-MESSAGE(ERR-IDX)           
                 MOVE PV-HOLD-VSL-NAME      TO PV-WRITTEN-VSL-NAME              
                 MOVE PV-HOLD-DCNSL-SCAC    TO PV-WRITTEN-SCAC                  
                 ADD +1 TO PV-TABLE-STORE-COUNT                                 
                 SET ERR-IDX UP BY +1                                           
                                                                                
                 IF PV-HOLD-DCNSL-SCAC = PV-DCNSL-SCAC                          
                   ADD +1 TO PV-WRITTEN-VSL-COUNT                               
                 ELSE                                                           
                   SET PS-WRITE-VSL TO TRUE                                     
                 END-IF                                                         
                                                                                
              WHEN PV-HOLD-VSL-NAME = PV-WRITTEN-VSL-NAME                       
                 MOVE PV-HOLD-VSL-NAME      TO VSL-NAME(ERR-IDX)                
                 MOVE PV-HOLD-CONTNR-ID     TO CONTNR-ID(ERR-IDX)               
                 MOVE PV-HOLD-PO-NBR        TO PO-NBR(ERR-IDX)                  
                 MOVE PV-HOLD-ETA           TO ETA-DATE(ERR-IDX)                
                 MOVE PV-HOLD-DCNSL-SCAC    TO DCNSL-SCAC(ERR-IDX)              
                 MOVE PV-HOLD-PO-SPLIT-TYP  TO PO-SPLIT-TYP(ERR-IDX)            
                 MOVE PV-HOLD-ERROR-MESSAGE TO ERROR-MESSAGE(ERR-IDX)           
                 MOVE PV-HOLD-VSL-NAME      TO PV-WRITTEN-VSL-NAME              
                 MOVE PV-HOLD-DCNSL-SCAC    TO PV-WRITTEN-SCAC                  
                 ADD +1 TO PV-TABLE-STORE-COUNT                                 
                 SET ERR-IDX UP BY +1                                           
                                                                                
                 IF  PV-HOLD-DCNSL-SCAC = PV-WRITTEN-SCAC                       
                 AND PS-WRITE-VSL-NO                                            
                   ADD +1 TO PV-WRITTEN-VSL-COUNT                               
                    SUBTRACT PV-WRITTEN-VSL-COUNT                               
                        FROM PV-TABLE-STORE-COUNT                               
                    SET ERR-IDX DOWN BY PV-WRITTEN-VSL-COUNT                    
                 END-IF                                                         
                 SET PS-WRITE-VSL-NO TO TRUE                                    
                 MOVE ZEROES TO PV-WRITTEN-VSL-COUNT                            
                                                                                
              WHEN OTHER                                                        
                 IF PV-WRITTEN-VSL-COUNT GREATER THAN ZERO                      
                 AND PS-WRITE-VSL-NO                                            
                    SUBTRACT PV-WRITTEN-VSL-COUNT                               
                        FROM PV-TABLE-STORE-COUNT                               
                    SET ERR-IDX DOWN BY PV-WRITTEN-VSL-COUNT                    
                 END-IF                                                         
                 SET PS-WRITE-VSL-NO TO TRUE                                    
                 MOVE ZEROES TO PV-WRITTEN-VSL-COUNT                            
                                                                                
           END-EVALUATE.                                                        
           MOVE PV-VSL-NAME      TO PV-HOLD-VSL-NAME                            
           MOVE PV-CONTNR-ID     TO PV-HOLD-CONTNR-ID                           
           MOVE PV-PO-NBR        TO PV-HOLD-PO-NBR                              
           MOVE PV-ETA           TO PV-HOLD-ETA                                 
           MOVE PV-DCNSL-SCAC    TO PV-HOLD-DCNSL-SCAC                          
           MOVE PV-PO-SPLIT-TYP  TO PV-HOLD-PO-SPLIT-TYP.                       
           MOVE PV-ERROR-MESSAGE TO PV-HOLD-ERROR-MESSAGE.                      
                                                                                
086800*----------------------------------------------------------------*        
086900* CLOSE THE CURSOR.                                              *        
087000*----------------------------------------------------------------*        
087200 4160-CLOSE-VSL-CURSOR.                                                   
087300                                                                          
087400     EXEC SQL                                                             
087500         CLOSE VSL_CUR                                                    
087600     END-EXEC.                                                            
087700                                                                          
087800     EVALUATE TRUE                                                        
087900         WHEN SQLCODE = ZERO                                              
088000              CONTINUE                                                    
088100         WHEN SQLWARN0 NOT EQUAL SPACE                                    
088200         WHEN SQLCODE NOT EQUAL ZERO                                      
088300              MOVE '4160-CLOSE-VSL-CURSOR'                                
088400                           TO  DP013-PARAGRAPH                            
088500              MOVE 'CLOSE CONTAINER CURSOR'                               
088600                           TO  DP013-MESSAGE-TEXT (1)                     
088700              MOVE SQLCA   TO  DP013-SQLCA                                
088800              SET DP013-DB2-ABEND                                         
088900                           TO  TRUE                                       
089000              PERFORM DP013-0000-PROCESS-ABEND                            
089100     END-EVALUATE.                                                        
089200                                                                          
089300 EJECT                                                                    
089400*----------------------------------------------------------------*        
089500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *        
089600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
089700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
089800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
089900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
090000*                                                                *        
090100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
090200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
090300*    UPON INITIALIZATION.                                        *        
090400*----------------------------------------------------------------*        
090500                                                                          
090600 4300-READ-ERROR-TABLE.                                                   
090700                                                                          
           SET ASC-ITEMS-LEFT-ON-TABLE TO TRUE.                                 
                                                                                
090800     PERFORM WITH TEST AFTER                                              
           VARYING ERR-IDX FROM 1 BY 1                                          
           UNTIL ASC-NO-ITEMS-LEFT-ON-TABLE                                     
091000                                                                          
               IF ERR-IDX > PV-TABLE-STORE-COUNT                                
                   SET ASC-NO-ITEMS-LEFT-ON-TABLE TO TRUE                       
               END-IF                                                           
091200                                                                          
091300         IF ASC-ITEMS-LEFT-ON-TABLE                                       
891368             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
891369                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
891370             ELSE                                                 DPKCS036
891371                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
891372                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
891373                                                                  DPKCS036
891374                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
891375                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
891376                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
891377                                   TO TRUE                        DPKCS036
891378                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
891379                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
891380                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
891381                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
891382                     ADD +1          TO ASC-BLK-SUB               DPKCS036
891383                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
891384                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
891385                                     TO TRUE                      DPKCS036
891386                 END-IF                                           DPKCS036
891387             END-IF                                               DPKCS036
891388             ADD +1                  TO ASC-NUMBER-OF-ITEMS-READ  DPKCS036
891389             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
891390                                     TO ASC-LIST-ITEM-NUMBER      DPKCS036
891391                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891392                                                                          
891394             MOVE VSL-NAME(ERR-IDX)     TO ASC-VESSEL                     
891395                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
891397             MOVE CONTNR-ID(ERR-IDX)    TO ASC-CONTNR-ID          DPKCS036
891398                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
891399             MOVE PO-NBR(ERR-IDX)       TO ASC-PO-NBR             DPKCS036
891400                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
                   STRING ETA-DATE(ERR-IDX)(6:2) '/'                            
                          ETA-DATE(ERR-IDX)(9:2)                                
891401             DELIMITED BY SIZE        INTO ASC-ETA-DATE           DPKCS036
891402                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
891403             MOVE DCNSL-SCAC(ERR-IDX)   TO ASC-DECNSL-SCAC        DPKCS036
891404                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
891403             MOVE ERROR-MESSAGE(ERR-IDX) TO ASC-MESSAGE                   
891404                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
092020         END-IF                                                           
092021     END-PERFORM.                                                         
092022                                                                          
092023     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
092024         MOVE +1               TO ASC-BLK-SUB                             
092025         PERFORM 5100-WRITE-TEMP-STORAGE                                  
092026         ADD +1                TO ASC-BLK-SUB                             
092027         PERFORM 5100-WRITE-TEMP-STORAGE                                  
092028                                                                          
092029         MOVE 1                TO ASC-BLK-SUB                             
092030                                  PV-BLOCK-NUMBER                         
092031         PERFORM 4410-READ-TEMP-STORAGE                                   
092032         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
092033             MOVE 2            TO ASC-BLK-SUB                             
092034                                  PV-BLOCK-NUMBER                         
092035             PERFORM 4410-READ-TEMP-STORAGE                               
092036         END-IF                                                           
092037     END-IF.                                                              
092038                                                                          
092039 EJECT                                                                    
098600                                                                          
103902**************************************************************            
103910 4121-FETCH-PO-CURSOR.                                                    
103920                                                                          
103930     EXEC SQL                                                             
103940         FETCH PO_CUR                                                     
103950         INTO :PV-PO-NBR                                                  
                   ,:PV-CONTNR-ID                                               
                   ,:PV-ETA                                                     
                   ,:PV-SEQ                                                     
                   ,:PV-VSL-NAME                                                
                   ,:PV-VOY-NBR                                                 
103960             ,:PV-PO-SPLIT-TYP                                            
                   ,:PV-ERROR-MESSAGE                                           
103970     END-EXEC.                                                            
103980                                                                          
103990*                                                                         
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
                  CONTINUE                                                      
103993         WHEN SQLCODE = +100                                              
104008            SET ASC-NO-PO-DATA-LEFT-ON-DB TO TRUE                         
                  MOVE ZEROES TO PV-PO-NBR                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '4121-FETCH-PO-CURSOR'                                 
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'FETCH CONTNR CURSOR'                                  
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
103902**************************************************************            
103910 4122-FETCH-VSL-CURSOR.                                                   
103920                                                                          
103930     EXEC SQL                                                             
103940         FETCH VSL_CUR                                                    
103950         INTO :PV-PO-NBR                                                  
                   ,:PV-CONTNR-ID                                               
                   ,:PV-ETA                                                     
                   ,:PV-SEQ                                                     
                   ,:PV-VSL-NAME                                                
                   ,:PV-VOY-NBR                                                 
103960             ,:PV-PO-SPLIT-TYP                                            
                   ,:PV-ERROR-MESSAGE                                           
103970     END-EXEC.                                                            
103980                                                                          
103990*                                                                         
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
                  CONTINUE                                                      
103993         WHEN SQLCODE = +100                                              
104008            SET ASC-NO-VSL-DATA-LEFT-ON-DB TO TRUE                        
                  MOVE SPACES                    TO PV-VSL-NAME                 
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '4122-FETCH-VSL-CURSOR'                                
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'FETCH CONTNR CURSOR'                                  
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
104012 EJECT                                                                    
106800*----------------------------------------------------------------*        
106900*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *        
107000*----------------------------------------------------------------*        
107100                                                                          
107200 4400-MOVE-COMMAREA-TO-SCREEN.                                            
107300                                                                          
107800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
107900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
108000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
108010             MOVE +1    TO ASC-BLK-SUB                                    
108020             PERFORM 5100-WRITE-TEMP-STORAGE                              
108030             ADD +1     TO ASC-BLK-SUB                                    
108040             PERFORM 5100-WRITE-TEMP-STORAGE                              
108100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
108200                 GIVING PV-BLOCK-NUMBER                                   
108300                 REMAINDER PV-REMAINDER                                   
108400             IF  PV-REMAINDER > ZERO                                      
108500                 ADD +1 TO PV-BLOCK-NUMBER                                
108600             END-IF                                                       
108700             MOVE +1    TO ASC-BLK-SUB                                    
108800             PERFORM 4410-READ-TEMP-STORAGE                               
108900             ADD +1     TO ASC-BLK-SUB                                    
109000                           PV-BLOCK-NUMBER                                
109100             PERFORM 4410-READ-TEMP-STORAGE                               
109200     END-IF.                                                              
109210                                                                          
109300     MOVE +1                       TO ASC-BLK-SUB.                        
           IF ASC-LIST-ITEM-NUMBER (1 1) NOT NUMERIC                            
              MOVE ZEROES TO ASC-LIST-ITEM-NUMBER (1 1)                         
           END-IF.                                                              
109400     COMPUTE ASC-ITEM-SUB =                                               
109500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
109600         + PC-ITEMS-PER-PANEL).                                           
109700                                                                          
109800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
109900         ADD +1   TO ASC-BLK-SUB                                          
110000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
110100     END-IF.                                                              
110200                                                                          
110300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
110400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
110500     PERFORM 4420-FORMAT-LIST-LINES                                       
110600         VARYING PS-SUB                                                   
110700         FROM PC-ITEMS-PER-PANEL BY -1                                    
110800         UNTIL PS-SUB < +1.                                               
110900                                                                          
111000     COMPUTE ASC-ITEMS-DISPLAYED =                                        
111100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
111110                                                                          
111200     MOVE PV-TOP-ITEM TO ASC-ITEM-AT-TOP-OF-PANEL.                        
111300*                                     ASTRTITO.                           
111400*    MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                            
111500*    MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                            
111600                                                                          
111610*    MOVE ASC-KEY-MESSAGE-NUMBER TO AMSGNBRO.                             
111620*    MOVE ASC-KEY-SYSTEM-ID      TO ASYSIDO.                              
111630*    MOVE ASC-KEY-MESSAGE-TEXT   TO ASHMSGO.                              
111640                                                                          
111650     MOVE ASC-VIEW          TO AVIEWO.                                    
111660     MOVE ASC-POE-CDE       TO APOECDEO.                                  
111670                                                                          
111680     MOVE ASC-WEEK-FROM-DTE (6:2)  TO PV-WEEK-FROM-DTE-MM.                
111690     MOVE ASC-WEEK-FROM-DTE (9:2)  TO PV-WEEK-FROM-DTE-DD.                
111691     MOVE ASC-WEEK-FROM-DTE (1:2)  TO PV-WEEK-FROM-DTE-CC.                
111692     MOVE ASC-WEEK-FROM-DTE (3:2)  TO PV-WEEK-FROM-DTE-YY.                
111693     MOVE PV-WEEK-FROM-DTE         TO AFRMDTEO.                           
111694                                                                          
111695     MOVE ASC-WEEK-TO-DTE (6:2)  TO PV-WEEK-TO-DTE-MM.                    
111696     MOVE ASC-WEEK-TO-DTE (9:2)  TO PV-WEEK-TO-DTE-DD.                    
111697     MOVE ASC-WEEK-TO-DTE (1:2)  TO PV-WEEK-TO-DTE-CC.                    
111698     MOVE ASC-WEEK-TO-DTE (3:2)  TO PV-WEEK-TO-DTE-YY.                    
111699     MOVE PV-WEEK-TO-DTE         TO ATODTEO.                              
111700                                                                          
111710     IF  DP020-MSG-NUMBER-X = SPACE                                       
111800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
111900*            --- MORE ITEMS TO DISPLAY ----                               
112000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
112100             SET DP020-MSG-INFORMATIONAL TO TRUE                          
112200         END-IF                                                           
112300     END-IF.                                                              
112400                                                                          
112500*----------------------------------------------------------------*        
112600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
112700*----------------------------------------------------------------*        
112800                                                                          
112900 4410-READ-TEMP-STORAGE.                                                  
113000                                                                          
113100     EXEC CICS                                                            
113200         READQ TS                                                         
113300             QUEUE (ASC-DTL-QUEUE-NAME)                                   
113400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
113500             ITEM  (PV-BLOCK-NUMBER)                                      
113600             RESP  (PV-CICS-RESP)                                         
113700     END-EXEC.                                                            
113800                                                                          
113900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
114000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
114100         CONTINUE                                                         
114200     ELSE                                                                 
114300         SET DP013-CICS-ABEND TO  TRUE                                    
114400         SET DP013-NO-ROLLBACK TO  TRUE                                   
114500         MOVE '4410-READ-TEMP-STORAGE'                                    
114600                               TO  DP013-PARAGRAPH                        
114700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
114800                               TO  DP013-MESSAGE-TEXT(1)                  
114900         PERFORM DP013-0000-PROCESS-ABEND                                 
115000     END-IF.                                                              
115100                                                                          
115200*    SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
115300                                                                          
115400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
115500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
115600     END-IF.                                                              
115700 EJECT                                                                    
115800*----------------------------------------------------------------*        
115900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
116000*----------------------------------------------------------------*        
116100                                                                          
116200 4420-FORMAT-LIST-LINES.                                                  
116300                                                                          
116400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
116500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
116600         MOVE SPACE              TO MR-VESSEL (PS-SUB)                    
116610                                    MR-CONTNR (PS-SUB)                    
116620                                    MR-ETA (PS-SUB)                       
116630                                    MR-SCAC (PS-SUB)                      
116640                                    MR-ERRMSG (PS-SUB)                    
116641                                    MR-PO-NBR-X (PS-SUB)                  
116700     ELSE                                                                 
116800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
116900             MOVE ASC-VESSEL (ASC-BLK-SUB ASC-ITEM-SUB)                   
117000                                 TO MR-VESSEL (PS-SUB)                    
117020             MOVE ASC-CONTNR-ID (ASC-BLK-SUB ASC-ITEM-SUB)                
117021                                 TO MR-CONTNR (PS-SUB)                    
117040             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                   
117041                                 TO MR-PO-NBR (PS-SUB)                    
117050             MOVE ASC-ETA-DATE (ASC-BLK-SUB ASC-ITEM-SUB)                 
117051                                 TO MR-ETA (PS-SUB)                       
117060             MOVE ASC-DECNSL-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)              
117061                                 TO MR-SCAC (PS-SUB)                      
117070             MOVE ASC-MESSAGE (ASC-BLK-SUB ASC-ITEM-SUB)                  
117080                                 TO MR-ERRMSG (PS-SUB)                    
117100         END-IF                                                           
117200     END-IF.                                                              
117300     SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
117400     IF  ASC-ITEM-SUB < + 1                                               
117500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
117600         MOVE +1                 TO ASC-BLK-SUB                           
117700     END-IF.                                                              
117800                                                                          
117900*----------------------------------------------------------------*        
118000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *        
118100*----------------------------------------------------------------*        
118200                                                                          
118300 5100-WRITE-TEMP-STORAGE.                                                 
118400                                                                          
118500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                             
118600                               TO  PV-LIST-ITEM-NUMBER.                   
118700     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                                   
118800         ASC-HIGHEST-BLOCK-WRITTEN + 1.                                   
118900                                                                          
119000     EXEC CICS                                                            
119100         WRITEQ TS                                                        
119200             QUEUE (ASC-DTL-QUEUE-NAME)                                   
119300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
119400             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                             
119500             RESP  (PV-CICS-RESP)                                         
119600     END-EXEC.                                                            
119700                                                                          
119800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                              
119900         SET DP013-CICS-ABEND                                             
120000                       TO  TRUE                                           
120100         SET DP013-NO-ROLLBACK                                            
120200                       TO  TRUE                                           
120300         MOVE '5100-WRITE-TEMP-STORAGE'                                   
120400                       TO  DP013-PARAGRAPH                                
120500         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'               
120600                       TO  DP013-MESSAGE-TEXT(1)                          
120700         PERFORM DP013-0000-PROCESS-ABEND                                 
120800     END-IF.                                                              
120900     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.                     
121000                                                                          
121100 EJECT                                                                    
084200*----------------------------------------------------------------*        
084300* DETERMIN WHAT THE SCAC IS FOR THE PURCHASE ORDER AND CONTAINER          
084400*----------------------------------------------------------------*        
       6000-SELECT-SCAC.                                                        
                                                                                
           MOVE SPACES TO PV-DCNSL-SCAC.                                        
                                                                                
      *    DETERMIN DECON SCAC USING RULE TABLES FOR CON                        
           IF PV-PO-SPLIT-TYP = 'CON'                                           
              IF ASC-VIEW = 'WORKING'                                           
                 PERFORM 6100-DECON-SCAC-CONT-WKG                               
                 IF PV-DCNSL-SCAC EQUAL SPACES                                  
                    PERFORM 6200-DECON-SCAC-VSL-WKG                             
                 END-IF                                                         
              END-IF                                                            
              IF  ASC-VIEW = 'WORKING'                                          
              AND PV-DCNSL-SCAC > SPACES                                        
                 CONTINUE                                                       
              ELSE                                                              
                 PERFORM 6300-DECON-SCAC-CONT-ADJ                               
              END-IF                                                            
              IF PV-DCNSL-SCAC EQUAL SPACES                                     
                 PERFORM 6400-DECON-SCAC-VSL-ADJ                                
              END-IF                                                            
              IF PV-DCNSL-SCAC EQUAL SPACES                                     
              OR ASC-VIEW = 'DEFAULT'                                           
                 PERFORM 6500-DECON-SCAC-CONT-DEF                               
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *    DETERMIN DECON SCAC USING RULE TABLES FOR CMN                        
           IF PV-PO-SPLIT-TYP = 'CMN'                                           
              IF ASC-VIEW = 'WORKING'                                           
                 PERFORM 6600-DECON-SCAC-CONT-WKG                               
                 IF PV-DCNSL-SCAC EQUAL SPACES                                  
                    PERFORM 6700-DECON-SCAC-VSL-WKG                             
                 END-IF                                                         
              END-IF                                                            
              IF  ASC-VIEW = 'WORKING'                                          
              AND PV-DCNSL-SCAC > SPACES                                        
                 CONTINUE                                                       
              ELSE                                                              
                 PERFORM 6800-DECON-SCAC-CONT-ADJ                               
              END-IF                                                            
              IF PV-DCNSL-SCAC EQUAL SPACES                                     
                 PERFORM 6900-DECON-SCAC-VSL-ADJ                                
              END-IF                                                            
              IF PV-DCNSL-SCAC EQUAL SPACES                                     
              OR ASC-VIEW = 'DEFAULT'                                           
                 PERFORM 7000-DECON-SCAC-CONT-DEF                               
              END-IF                                                            
           END-IF.                                                              
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6100-DECON-SCAC-CONT-WKG.                                                
823978                                                                  05210000
           EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR CON                                          
                    ,TRT_RUL_CNSTR ETA                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = CON.RUL_ID                          
                AND DEC.RUL_ID            = ETA.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND CON.RUL_CNSTR_TYP_CDE = 'CONT'                              
                AND ETA.RUL_CNSTR_TYP_CDE = 'ETA'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND CON.RUL_CNSTR_VAL_TXT = :PV-CONTNR-ID                       
                AND ETA.RUL_CNSTR_VAL_TXT = :PV-ETA                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'CONT'                              
                AND TR.RUL_TYP_CDE        = 'WKG'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6100-DECON-SCAC-CONT-WKG'                             
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT WKG CONT RULE'                                 
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6200-DECON-SCAC-VSL-WKG.                                                 
823978                                                                  05210000
823979     EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR VSL                                          
                    ,TRT_RUL_CNSTR ETA                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = VSL.RUL_ID                          
                AND DEC.RUL_ID            = ETA.RUL_ID                          
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND VSL.RUL_CNSTR_TYP_CDE = 'VSL'                               
                AND ETA.RUL_CNSTR_TYP_CDE = 'ETA'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND VSL.RUL_CNSTR_VAL_TXT = :PV-VSL-NAME                        
                AND ETA.RUL_CNSTR_VAL_TXT = :PV-ETA                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'VSL'                               
                AND TR.RUL_TYP_CDE        = 'WKG'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6200-DECON-SCAC-VSL-WKG'                              
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT WKG VSL RULE'                                  
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6300-DECON-SCAC-CONT-ADJ.                                                
823978                                                                  05210000
           EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR CON                                          
                    ,TRT_RUL_CNSTR ETA                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = CON.RUL_ID                          
                AND DEC.RUL_ID            = ETA.RUL_ID                          
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND CON.RUL_CNSTR_TYP_CDE = 'CONT'                              
                AND ETA.RUL_CNSTR_TYP_CDE = 'ETA'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND CON.RUL_CNSTR_VAL_TXT = :PV-CONTNR-ID                       
                AND ETA.RUL_CNSTR_VAL_TXT = :PV-ETA                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'CONT'                              
                AND TR.RUL_TYP_CDE        = 'ADJ'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6300-DECON-SCAC-CONT-ADJ'                             
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT ADJ CONT RULE'                                 
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6400-DECON-SCAC-VSL-ADJ.                                                 
823978                                                                  05210000
823979     EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR VSL                                          
                    ,TRT_RUL_CNSTR ETA                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = VSL.RUL_ID                          
                AND DEC.RUL_ID            = ETA.RUL_ID                          
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND VSL.RUL_CNSTR_TYP_CDE = 'VSL'                               
                AND ETA.RUL_CNSTR_TYP_CDE = 'ETA'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND VSL.RUL_CNSTR_VAL_TXT = :PV-VSL-NAME                        
                AND ETA.RUL_CNSTR_VAL_TXT = :PV-ETA                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'VSL'                               
                AND TR.RUL_TYP_CDE        = 'ADJ'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6400-DECON-SCAC-VSL-ADJ'                              
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT ADJ VSL RULE'                                  
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6500-DECON-SCAC-CONT-DEF.                                                
823978                                                                  05210000
823979     EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR CON                                          
                    ,TRT_RUL_CNSTR ETA                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = CON.RUL_ID                          
                AND DEC.RUL_ID            = ETA.RUL_ID                          
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND CON.RUL_CNSTR_TYP_CDE = 'CONT'                              
                AND ETA.RUL_CNSTR_TYP_CDE = 'ETA'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND CON.RUL_CNSTR_VAL_TXT = :PV-CONTNR-ID                       
                AND ETA.RUL_CNSTR_VAL_TXT = :PV-ETA                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'CONT'                              
                AND TR.RUL_TYP_CDE        = 'DEF'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6500-DECON-SCAC-CONT-DEF'                             
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT DEF CONT RULE'                                 
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6600-DECON-SCAC-CONT-WKG.                                                
823978                                                                  05210000
           EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR CON                                          
                    ,TRT_RUL_CNSTR SEQ                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = CON.RUL_ID                          
                AND DEC.RUL_ID            = SEQ.RUL_ID                          
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND CON.RUL_CNSTR_TYP_CDE = 'CONT'                              
                AND SEQ.RUL_CNSTR_TYP_CDE = 'SEQ'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND CON.RUL_CNSTR_VAL_TXT = :PV-CONTNR-ID                       
                AND SEQ.RUL_CNSTR_VAL_TXT = :PV-SEQ                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'CONT'                              
                AND TR.RUL_TYP_CDE        = 'WKG'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6600-DECON-SCAC-CONT-WKG'                             
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT WKG CONT RULE'                                 
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6700-DECON-SCAC-VSL-WKG.                                                 
823978                                                                  05210000
823979     EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR VSL                                          
                    ,TRT_RUL_CNSTR VOY                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID = VSL.RUL_ID                                     
                AND DEC.RUL_ID = VOY.RUL_ID                                     
                AND DEC.RUL_ID = POE.RUL_ID                                     
                AND DEC.RUL_ID = TR.RUL_ID                                      
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND VSL.RUL_CNSTR_TYP_CDE = 'VSL'                               
                AND VOY.RUL_CNSTR_TYP_CDE = 'VOY'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND VSL.RUL_CNSTR_VAL_TXT = :PV-VSL-NAME                        
                AND VOY.RUL_CNSTR_VAL_TXT = :PV-VOY-NBR                         
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'VSL'                               
                AND TR.RUL_TYP_CDE        = 'WKG'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6700-DECON-SCAC-VSL-WKG'                              
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT WKG VSL RULE'                                  
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823973                                                                          
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6800-DECON-SCAC-CONT-ADJ.                                                
823978                                                                  05210000
           EXEC SQL                                                             
181356*       SELECT DEC.RUL_CNSTR_VAL_TXT                                      
181356        SELECT DISTINCT DEC.RUL_CNSTR_VAL_TXT                             
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR CON                                          
                    ,TRT_RUL_CNSTR SEQ                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = CON.RUL_ID                          
                AND DEC.RUL_ID            = SEQ.RUL_ID                          
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND CON.RUL_CNSTR_TYP_CDE = 'CONT'                              
                AND SEQ.RUL_CNSTR_TYP_CDE = 'SEQ'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND CON.RUL_CNSTR_VAL_TXT = :PV-CONTNR-ID                       
                AND SEQ.RUL_CNSTR_VAL_TXT = :PV-SEQ                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'CONT'                              
                AND TR.RUL_TYP_CDE        = 'ADJ'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6800-DECON-SCAC-CONT-ADJ'                             
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT ADJ CONT RULE'                                 
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 6900-DECON-SCAC-VSL-ADJ.                                                 
823978                                                                  05210000
823979     EXEC SQL                                                             
              SELECT DEC.RUL_CNSTR_VAL_TXT                                      
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR VSL                                          
                    ,TRT_RUL_CNSTR VOY                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID = VSL.RUL_ID                                     
                AND DEC.RUL_ID = VOY.RUL_ID                                     
                AND DEC.RUL_ID = POE.RUL_ID                                     
                AND DEC.RUL_ID = TR.RUL_ID                                      
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND VSL.RUL_CNSTR_TYP_CDE = 'VSL'                               
                AND VOY.RUL_CNSTR_TYP_CDE = 'VOY'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND VSL.RUL_CNSTR_VAL_TXT = :PV-VSL-NAME                        
                AND VOY.RUL_CNSTR_VAL_TXT = :PV-VOY-NBR                         
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'VSL'                               
                AND TR.RUL_TYP_CDE        = 'ADJ'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '6900-DECON-SCAC-VSL-ADJ'                              
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT ADJ VSL RULE'                                  
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
823974******************************************************************06085900
823975* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
823976******************************************************************06086100
823977 7000-DECON-SCAC-CONT-DEF.                                                
823978                                                                  05210000
823979     EXEC SQL                                                             
181356*       SELECT DEC.RUL_CNSTR_VAL_TXT                                      
181356        SELECT DISTINCT DEC.RUL_CNSTR_VAL_TXT                             
              INTO   :PV-DCNSL-SCAC                                             
              FROM   TRT_RUL_CNSTR DEC                                          
                    ,TRT_RUL_CNSTR CON                                          
                    ,TRT_RUL_CNSTR SEQ                                          
                    ,TRT_RUL_CNSTR POE                                          
                    ,TRT_RUL       TR                                           
              WHERE DEC.RUL_ID            = CON.RUL_ID                          
                AND DEC.RUL_ID            = SEQ.RUL_ID                          
                AND DEC.RUL_ID            = POE.RUL_ID                          
                AND DEC.RUL_ID            = TR.RUL_ID                           
                AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
                AND CON.RUL_CNSTR_TYP_CDE = 'CONT'                              
                AND SEQ.RUL_CNSTR_TYP_CDE = 'SEQ'                               
                AND POE.RUL_CNSTR_TYP_CDE = 'POE'                               
                AND CON.RUL_CNSTR_VAL_TXT = :PV-CONTNR-ID                       
                AND SEQ.RUL_CNSTR_VAL_TXT = :PV-SEQ                             
                AND POE.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
                AND TR.RUL_CDE            = 'CONT'                              
                AND TR.RUL_TYP_CDE        = 'DEF'                               
                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
824700     END-EXEC                                                             
824800                                                                          
103991     EVALUATE TRUE                                                        
103992         WHEN SQLCODE = ZERO                                              
103993         WHEN SQLCODE = +100                                              
                  CONTINUE                                                      
103995         WHEN SQLWARN0 NOT = SPACE                                        
103996         WHEN SQLCODE NOT = ZERO                                          
103997              MOVE '7000-DECON-SCAC-CONT-DEF'                             
103998                               TO DP013-PARAGRAPH                         
103999              MOVE 'SELECT DEF CONT RULE'                                 
104000                               TO DP013-MESSAGE-TEXT (1)                  
104001              MOVE SQLCA       TO DP013-SQLCA                             
104002              SET DP013-DB2-ABEND                                         
104003                               TO TRUE                                    
104004              PERFORM DP013-0000-PROCESS-ABEND                            
104005     END-EVALUATE.                                                        
                                                                                
121200*----------------------------------------------------------------*        
121300* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *        
121400*----------------------------------------------------------------*        
121500                                                                          
121600 9100-READ-SEL-QUEUE.                                                     
121700     EXEC CICS                                                            
121800         READQ TS                                                         
121900             QUEUE (ASC-SEL-QUEUE-NAME)                                   
122000             INTO  (TR325-TEMP-SEL-AREA)                                  
122100             ITEM  (ASC-SEL-ITEM)                                         
122200             RESP  (PV-CICS-RESP)                                         
122300     END-EXEC.                                                            
122400                                                                          
122500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                               
122600         CONTINUE                                                         
122700     ELSE                                                                 
122800         SET DP013-LOGIC-ABEND                                            
122900             DP013-NO-ROLLBACK     TO TRUE                                
123000         MOVE '9100-READ-SEL-QUEUE'                                       
123100                                   TO DP013-PARAGRAPH                     
123200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'           
123300                                   TO DP013-MESSAGE-TEXT (1)              
123400         PERFORM DP013-0000-PROCESS-ABEND                                 
123500     END-IF.                                                              
123600*----------------------------------------------------------------*        
123700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *        
123800*----------------------------------------------------------------*        
123900 9200-REWRITE-SEL-QUEUE.                                                  
124000     EXEC CICS                                                            
124100          WRITEQ TS                                                       
124200              QUEUE  (ASC-SEL-QUEUE-NAME)                                 
124300              FROM   (TR325-TEMP-SEL-AREA)                                
124400              ITEM   (ASC-SEL-ITEM)                                       
124500              RESP   (PV-CICS-RESP)                                       
124600              REWRITE                                                     
124700     END-EXEC.                                                            
124800                                                                          
124900     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                           
125000         SET DP013-CICS-ABEND                                             
125100             DP013-NO-ROLLBACK     TO TRUE                                
125200         MOVE '9200-REWRITE-SEL-QUEUE'                                    
125300                                   TO DP013-PARAGRAPH                     
125400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'           
125500                                   TO DP013-MESSAGE-TEXT (1)              
125600         PERFORM DP013-0000-PROCESS-ABEND                                 
125700     END-IF.                                                              
125800                                                                          
125900 EJECT                                                                    
126000*----------------------------------------------------------------*        
126100*    ABEND PROCESSOR MODULE                                      *        
126200*----------------------------------------------------------------*        
126300                                                                          
126400     COPY DPPD013.                                                        
