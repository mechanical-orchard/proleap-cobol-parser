000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKCS110.                                         00020000
000300 AUTHOR.        SAUD AHMED.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  11-29-99.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    W110 - PO SELECTION LIST                                   * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM GENERATES A LIST OF PO'S BASED ON CRITERIA    * 00110000
001200*    PASSED FROM THE SET LIST SCREEN.                           * 00120000
001300*                                                               * 00130000
001400*---------------------------------------------------------------* 00140000
C98147* 11/07/14  TKMA394    EXPANDED PO NUMBER TO 9 DIGITS IN MAP      00150003
C98147*                      AND COMMAREA.                              00160002
C98147*           CHANGE TAG : C98147  CR NO : CHG0098147               00170002
C98147*---------------------------------------------------------------* 00180002
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485        00181009
CICS  *                                                                 00182008
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00183008
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00184008
C98147*---------------------------------------------------------------* 00185008
001500 EJECT                                                            00190000
001600 ENVIRONMENT DIVISION.                                            00200000
001700                                                                  00210000
001800 DATA DIVISION.                                                   00220000
001900                                                                  00230000
002000 WORKING-STORAGE SECTION.                                         00240000
002100                                                                  00250000
002200 01  DK-DB2-KEYS.                                                 00260000
002300     05  DK-DEPT-NBR                    PIC X(03)   VALUE SPACES. 00270000
002400     05  DK-DMA-NBR                     PIC X(02)   VALUE SPACES. 00280000
002500     05  DK-GMA-NBR                     PIC X(02)   VALUE SPACES. 00290000
002600                                                                  00300000
002700 01  PC-PROGRAM-CONSTANTS.                                        00310000
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00320000
002900                                                    'PO110A  '.   00330000
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00340000
003100                                                    'POKM110 '.   00350000
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00360000
003300                                                    'POKCS110'.   00370000
003400     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00380000
003500                                                    COMP.         00390000
003600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00400000
003700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00410000
003800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00420000
003900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00430000
004000                                                    COMP SYNC.    00440000
004100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00450000
004200                                                    COMP SYNC.    00460000
004300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00470000
004400                                                    +1000000      00480000
004500                                                    COMP-3.       00490000
004600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00500000
004700                                                    COMP SYNC.    00510000
004800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00520000
004900                                                    COMP-3.       00530000
005000     05  PC-CNT-MINUS-2                 PIC S9(04)  VALUE -2      00540000
005100                                                    COMP SYNC.    00550000
005200     05  PC-CNT-6                       PIC S9(04)  VALUE +6      00560000
005300                                                    COMP SYNC.    00570000
005400     05  PC-CNT-7                       PIC S9(04)  VALUE +7      00580000
005500                                                    COMP SYNC.    00590000
005600     05  PC-QUOTE                       PIC  X(01)  VALUE X'7D'.  00600000
005700     05  PC-INTER-APPL-CODES.                                     00610000
005800         10  PC-INTER-APPL-CRIT       PIC X(01)  VALUE ' '.       00620000
005900         10  PC-INTER-APPL-LIST       PIC X(01)  VALUE '1'.       00630000
006000                                                                  00640000
006100     05  PC-TSYMSG-NUMBERS.                                       00650000
006200         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00660000
006300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00670000
006400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00680000
006500         10  PC-TSYMSG-00014            PIC  9(05)  VALUE 00014.  00690000
006600         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  00700000
006700         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  00710000
006800         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00720000
006900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00730000
007000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00740000
007100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00750000
007200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00760000
007300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00770000
007400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00780000
007500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00790000
007600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00800000
007700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00810000
007800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00820000
007900         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  00830000
008000         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  00840000
008100         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00850000
008200         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  00860000
008300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00870000
008400         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  00880000
008500         10  PC-TSYMSG-00317            PIC  9(05)  VALUE 00317.  00890000
008600         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  00900000
008700         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  00910000
008800         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  00920000
008900         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  00930000
009000         10  PC-TSYMSG-00621            PIC  9(05)  VALUE 00621.  00940000
009100         10  PC-TSYMSG-02044            PIC  9(05)  VALUE 02044.  00950000
009200                                                                  00960000
009300 01  PS-PROGRAM-SWITCHES.                                         00970000
009400     05  PS-PURITM-SW                   PIC  X(01)  VALUE 'Y'.    00980000
009500         88  PS-206-PURITM                          VALUE 'Y'.    00990000
009600         88  PS-000-PURITM                          VALUE 'N'.    01000000
009700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01010000
009800         88  PS-NO-ERROR                            VALUE 'Y'.    01020000
009900         88  PS-ERROR                               VALUE 'N'.    01030000
010000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01040000
010100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01050000
010200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01060000
010300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01070000
010400         88  PS-DONE                                VALUE 'Y'.    01080000
010500         88  PS-NOT-DONE                            VALUE 'N'.    01090000
010600                                                                  01100000
010700 01  PV-PROGRAM-VARIABLES.                                        01110000
010800     05  PV-HOLD-CC                     PIC X(02).                01120000
010900     05  PV-SUB                         PIC S9(04)  VALUE +0      01130000
011000                                                    COMP SYNC.    01140000
011100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01150000
011200                                                    COMP SYNC.    01160000
011300     05  PV-SELECT-BYTES                PIC S9(04)  VALUE +78     01170000
011400                                                    COMP SYNC.    01180000
011500     05  PV-STRING-POINTER-FROM         PIC S9(04)  VALUE +0      01190000
011600                                                    COMP   SYNC.  01200000
011700     05  PV-STRING-POINTER-WHERE        PIC S9(04)  VALUE +0      01210000
011800                                                    COMP   SYNC.  01220000
011900     05  PV-TALLY-1                     PIC S9(04)  VALUE +0      01230000
012000                                                    COMP   SYNC.  01240000
012100     05  PV-TALLY-2                     PIC S9(04)  VALUE +0      01250000
012200                                                    COMP   SYNC.  01260000
012300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01270000
012400                                                    COMP-3.       01280000
012500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01290000
012600                                                    COMP-3.       01300000
012700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01310000
012800                                                    COMP-3.       01320000
012900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01330000
013000                                                    COMP-3.       01340000
013100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01350000
013200                                                    COMP-3.       01360000
013300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01370000
013400                                                    COMP-3.       01380000
013500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01390000
013600                                                    COMP-3.       01400000
013700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01410000
013800                                                    COMP SYNC.    01420000
013900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01430000
014000                                                    COMP SYNC.    01440000
014100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01450000
014200                                                    COMP SYNC.    01460000
014300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01470000
014400                                                    COMP SYNC.    01480000
014500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01490000
014600                                                    COMP SYNC.    01500000
014700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01510000
014800                                                    COMP SYNC.    01520000
014900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01530000
015000                                                    COMP SYNC.    01540000
015100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01550000
015200                                                    COMP SYNC.    01560000
015300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01570000
015400                                                    COMP SYNC.    01580000
015500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01590000
015600                                                    COMP SYNC.    01600000
015700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01610000
015800                                                    COMP SYNC.    01620000
015900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01630000
016000                                                    COMP SYNC.    01640000
016100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01650000
016200                                                    COMP SYNC.    01660000
016300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01670000
016400                                                    COMP SYNC.    01680000
016500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01690000
016600                                                    COMP SYNC.    01700000
016700                                                                  01710000
016800     05  PV-NULL-IND                    PIC S9(04)  VALUE +0 COMP.01720000
016900                                                                  01730000
017000     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01740000
017100                                                    COMP-3.       01750000
017200     05  PV-DB2-COUNT2                  PIC S9(09)  VALUE +0      01760000
017300                                                    COMP-3.       01770000
017400     05  PV-SCREEN-TITLE.                                         01780000
017500         10  PV-SCREEN-SHRT-NME         PIC  X(05).               01790000
017600         10  FILLER                     PIC  X(01)  VALUE SPACES. 01800000
017700         10  PV-SCREEN-YEAR             PIC  X(04).               01810000
017800         10  PV-SCREEN-HEADING          PIC  X(20)  VALUE         01820000
017900             ' SET PO LIST        '.                              01830000
018000     05  PV-DB2-DATE                    PIC  X(10).               01840000
018100     05  FILLER  REDEFINES PV-DB2-DATE.                           01850000
018200         10  PV-DB2-DATE-CC             PIC  X(02).               01860000
018300         10  PV-DB2-DATE-YY             PIC  X(02).               01870000
018400         10  FILLER                     PIC  X(01).               01880000
018500         10  PV-DB2-DATE-MM             PIC  X(02).               01890000
018600         10  FILLER                     PIC  X(01).               01900000
018700         10  PV-DB2-DATE-DD             PIC  X(02).               01910000
018800     05  PV-DISPLAY-DATE.                                         01920000
018900         10  PV-DISPLAY-DATE-MM         PIC  X(02).               01930000
019000         10  FILLER                     PIC  X(01)  VALUE '/'.    01940000
019100         10  PV-DISPLAY-DATE-DD         PIC  X(02).               01950000
019200         10  FILLER                     PIC  X(01)  VALUE '/'.    01960000
019300         10  PV-DISPLAY-DATE-YY         PIC  X(02).               01970000
019400     05  PV-DONT-SHIP-BEF-DTE           PIC  X(08).               01980000
019500     05  PV-CAN-IFNOT-SHIP-DTE          PIC  X(08).               01990000
019600                                                                  02000000
019700*---------------------------------------------------------------* 02010000
019800*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02020000
019900*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02030000
020000*   APPLICATION-SPECIFIC COMMAREA.                              * 02040000
020100*---------------------------------------------------------------* 02050000
020200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02060000
020300     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  02070000
020400     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02080000
020500                                        INDEXED BY LQW-IDX.       02090000
020600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02100000
020700         10  LQW-TEMP-SELECTED-SW       PIC X(01).                02110000
020800         10  LQW-SELECTED-SW            PIC X(01).                02120000
020900             88  LQW-SELECT                         VALUE 'S'.    02130000
021000             88  LQW-DESELECT                       VALUE ' '.    02140000
C98147         10  LQW-PO-NBR                 PIC 9(09).                02150003
021200         10  LQW-DEPT-NBR               PIC X(03).                02160000
021300         10  LQW-VENDOR-NAME            PIC X(10).                02170000
021400         10  LQW-STATUS                 PIC X(02).                02180000
021500         10  LQW-OTB                    PIC X(04).                02190000
021600         10  LQW-SHIP-DATE              PIC X(08).                02200000
021700         10  LQW-CANCEL-DATE            PIC X(08).                02210000
021800         10  LQW-TOT-UNIT-ORDERED       PIC 9(07).                02220000
021900*        10  LQW-IP-IND                 PIC X(01).                02230000
022000                                                                  02240000
022100 EJECT                                                            02250000
022200*----------------------------------------------------------------*02260000
022300*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *02270000
022400*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *02280000
022500*----------------------------------------------------------------*02290000
022600                                                                  02300000
022700     COPY POWS077.                                                02310000
022800                                                                  02320000
022900*---------------------------------------------------------------* 02330000
023000*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02340000
023100*---------------------------------------------------------------* 02350000
023200                                                                  02360000
023300     COPY POWS012.                                                02370001
023400                                                                  02380000
023500 EJECT                                                            02390000
023600*---------------------------------------------------------------* 02400000
023700*    MAP LAYOUT                                                 * 02410000
023800*---------------------------------------------------------------* 02420000
023900                                                                  02430000
024000     COPY POKM110.                                                02440000
024100                                                                  02450000
024200 01  MR-OCCURS-LAYOUT                   REDEFINES  PO110AO.       02460000
024300     05  FILLER                         PIC X(48).                02470000
024400                                                                  02480000
024500     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02490000
024600         10  MR-SELECTL                 PIC S9(04) COMP.          02500000
024700         10  MR-SELECTA                 PIC X(01).                02510000
024800         10  MR-SELECTC                 PIC X(01).                02520000
024900         10  MR-SELECTH                 PIC X(01).                02530000
025000         10  MR-SELECT                  PIC X(01).                02540000
025100                                                                  02550000
025200         10  MR-PO-NBRL                 PIC S9(04) COMP.          02560000
025300         10  MR-PO-NBRA                 PIC X(01).                02570000
025400         10  MR-PO-NBRC                 PIC X(01).                02580000
025500         10  MR-PO-NBRH                 PIC X(01).                02590000
025600         10  MR-PO-NBR-X.                                         02600000
C98147             15  MR-PO-NBR              PIC ZZZZZZZZZ.            02610003
025800                                                                  02620000
025900         10  FILLER                     PIC X(05).                02630000
026000         10  MR-DEPT-NBR                PIC X(03).                02640000
026100                                                                  02650000
026200         10  FILLER                     PIC X(05).                02660000
026300         10  MR-VENDOR-NAME             PIC X(10).                02670000
026400                                                                  02680000
026500         10  FILLER                     PIC X(05).                02690000
026600         10  MR-STATUS                  PIC X(02).                02700000
026700                                                                  02710000
026800         10  FILLER                     PIC X(05).                02720000
026900         10  MR-OTB                     PIC X(04).                02730000
027000                                                                  02740000
027100         10  FILLER                     PIC X(05).                02750000
027200         10  MR-SHIP-DATE               PIC X(08).                02760000
027300                                                                  02770000
027400         10  FILLER                     PIC X(05).                02780000
027500         10  MR-CANCEL-DATE             PIC X(08).                02790000
027600                                                                  02800000
027700         10  FILLER                     PIC X(05).                02810000
027800         10  MR-UNITS-ORDERED-X.                                  02820000
027900             15  MR-UNITS-ORDERED       PIC ZZZZZZ9.              02830000
028000                                                                  02840000
028100     05  FILLER                         PIC X(05).                02850000
028200     05  MR-UNITS-ORDERED-TOT           PIC ZZZZZZZ9.             02860007
028300                                                                  02870000
028400                                                                  02880000
028500 EJECT                                                            02890000
028600*---------------------------------------------------------------* 02900000
028700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02910000
028800*---------------------------------------------------------------* 02920000
028900                                                                  02930000
029000     COPY DPWS015.                                                02940000
029100                                                                  02950000
029200*---------------------------------------------------------------* 02960000
029300*    FUNCTION KEYS COPYBOOK.                                    * 02970000
029400*---------------------------------------------------------------* 02980000
029500                                                                  02990000
029600     COPY DPWS016.                                                03000000
029700                                                                  03010000
029800*---------------------------------------------------------------* 03020000
029900*    NUMERIC EDIT LAYOUT.                                       * 03030000
030000*---------------------------------------------------------------* 03040000
030100                                                                  03050000
030200     COPY DPWS010I.                                               03060000
030300                                                                  03070000
030400 EJECT                                                            03080000
030500*---------------------------------------------------------------* 03090000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03100008
030700*---------------------------------------------------------------* 03110000
030800                                                                  03120000
030900     COPY DPWS030.                                                03130000
CICS       COPY DPWS930.                                                03131008
031000                                                                  03140000
031100 EJECT                                                            03150000
031200*---------------------------------------------------------------* 03160000
031300*    STANDARD COMMAREA.                                         * 03170000
031400*---------------------------------------------------------------* 03180000
031500                                                                  03190000
031600     COPY DPWS020.                                                03200000
031700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03210000
031800                                                                  03220000
031900*---------------------------------------------------------------* 03230000
032000* INTER-APPLICATION COMMAREA.                                   * 03240000
032100*   POWS078 - COMMAREA PASSED FROM POKCS099                     * 03250000
032200*   POWS079 - COMMAREA PASSED TO POKCS103                       * 03260000
032300*---------------------------------------------------------------* 03270000
032400         10  INTER-APPL-COMM-AREA       PIC X(200).               03280000
032500                                                                  03290000
032600     COPY POWS078.                                                03300002
032700     COPY POWS079.                                                03310002
           COPY POWS013.                                                03320002
032800*---------------------------------------------------------------* 03330000
032900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03340000
033000*---------------------------------------------------------------* 03350000
033100         10  ASC-SPECIFIC-COMMAREA.                               03360000
033200             15  ASC-CLASS-RANGE-SW       PIC X(01).              03370000
033300                 88  ASC-CLASS-RANGE      VALUE 'Y'.              03380000
033400             15  ASC-LIST-KEYS.                                   03390000
033500                 20  ASC-KEY-SHORT-NME    PIC X(05).              03400000
033600                 20  ASC-KEY-YEAR         PIC X(04).              03410000
033700             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03420000
033800                 20  ASC-BLOCK-MODIFIED-SW                        03430000
033900                                        PIC X(01).                03440000
034000                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03450000
034100                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03460000
034200                                                                  03470000
034300                 20  ASC-ITEM-ARRAY.                              03480000
034400                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03490000
034500                         30  ASC-LIST-ITEM-NUMBER                 03500000
034600                                        PIC S9(09) COMP-3.        03510000
034700                         30  ASC-TEMP-SELECTED-SW                 03520000
034800                                        PIC X(01).                03530000
034900                             88  ASC-VALID-SELECT  VALUE ' '      03540000
035000                                                         'S'      03550000
035100                                                         'B'      03560000
035200                                                         'E'.     03570000
035300                             88  ASC-TEMP-NO-SELECT               03580000
035400                                                   VALUE ' '.     03590000
035500                             88  ASC-TEMP-SELECT   VALUE 'S'.     03600000
035600                             88  ASC-TEMP-BEGIN    VALUE 'B'.     03610000
035700                             88  ASC-TEMP-END      VALUE 'E'.     03620000
035800                         30  ASC-SELECTED-SW                      03630000
035900                                        PIC X(01).                03640000
036000                             88  ASC-NO-SELECT     VALUE ' '.     03650000
036100                             88  ASC-SELECT        VALUE 'S'.     03660000
036200                             88  ASC-BEGIN         VALUE 'B'.     03670000
036300                             88  ASC-END           VALUE 'E'.     03680000
C98147                         30  ASC-PO-NBR            PIC 9(09).     03690003
036500                         30  ASC-DEPT-NBR          PIC X(03).     03700000
036600                         30  ASC-VENDOR-NAME       PIC X(10).     03710000
036700                         30  ASC-STATUS            PIC X(02).     03720000
036800                         30  ASC-OTB               PIC X(04).     03730000
036900                         30  ASC-SHIP-DATE         PIC X(08).     03740000
037000                         30  ASC-CANCEL-DATE       PIC X(08).     03750000
037100                         30  ASC-TOT-UNIT-ORDERED  PIC 9(07).     03760000
037200                                                                  03770000
037300             15  ASC-NUMBER-OF-TS-ITEMS                           03780000
037400                                       PIC S9(05) COMP-3.         03790000
037500             15  ASC-SEL-SUB           PIC  S9(04) COMP.          03800000
037600             15  ASC-SEL-ITEM          PIC  S9(04) COMP.          03810000
037700                                                                  03820000
037800             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03830000
037900             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03840000
038000             15  ASC-NUMBER-OF-ITEMS-READ                         03850000
038100                                        PIC S9(09) COMP-3.        03860000
038200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03870000
038300                                        PIC S9(09) COMP-3.        03880000
038400             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03890000
038500             15  ASC-ITEM-AT-TOP-OF-PANEL                         03900000
038600                                        PIC S9(09) COMP-3.        03910000
038700             15  ASC-ITEM-AT-BOT-OF-PANEL                         03920000
038800                                        PIC S9(09) COMP-3.        03930000
038900             15  ASC-HIGHEST-BLOCK-WRITTEN                        03940000
039000                                        PIC S9(04) COMP SYNC.     03950000
039100             15  ASC-START-OF-SELECTED-RANGE                      03960000
039200                                        PIC S9(09) COMP-3.        03970000
039300             15  ASC-END-OF-SELECTED-RANGE                        03980000
039400                                        PIC S9(09) COMP-3.        03990000
039500             15  ASC-ITEMS-LEFT-INDICATOR                         04000000
039600                                        PIC X(01).                04010000
039700                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04020000
039800                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04030000
039900*            15  ASC-CONFIRM-SW         PIC X(01).                04040000
040000*                88  ASC-CONFIRM-DELETE            VALUE 'Y'.     04050000
040100*                88  ASC-CONFIRM-NO-DELETE         VALUE 'N'.     04060000
040200             15  ASC-TEMP-QUEUE-UPDATE-SW                         04070000
040300                                        PIC X(01).                04080000
040400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04090000
040500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04100000
040600             15  ASC-LIST-QUEUE-NAME.                             04110000
040700                 20  ASC-LIST-TERM-ID   PIC X(04).                04120000
040800                 20  ASC-LIST-TASK-NUMBER                         04130000
040900                                        PIC S9(05) COMP-3.        04140000
041000                 20  ASC-LIST-SEQ       PIC 9(01).                04150000
041600                                                                  04160000
041100             15  ASC-SEL-QUEUE-NAME.                              04170000
041200                 20  ASC-SEL-TERM-ID PIC X(04).                   04180000
041300                 20  ASC-SEL-TASK-NUMBER                          04190000
041400                                        PIC S9(05) COMP-3.        04200000
041500                 20  ASC-SEL-SEQ        PIC 9(01).                04210000
041100             15  ASC-SEL-QUEUE-NAME-IN.                           04220000
041200                 20  ASC-SEL-TERM-ID-IN PIC X(04).                04230000
041300                 20  ASC-SEL-TASK-NUMBER-IN                       04240000
041400                                        PIC S9(05) COMP-3.        04250000
041500                 20  ASC-SEL-SEQ-IN     PIC 9(01).                04260000
041600                                                                  04270000
041700             15  ASC-START-ITEM-REQUEST.                          04280000
041800                 20  ASC-START-ITEM-REQUEST-N                     04290000
041900                                        PIC 9(07).                04300000
042000             15  ASC-UNIT-ORD-TOT       PIC S9(08).               04310000
042100 EJECT                                                            04320000
042200*---------------------------------------------------------------* 04330000
042300*    ABEND PROCESSING COPYBOOK.                                 * 04340000
042400*---------------------------------------------------------------* 04350000
042500                                                                  04360000
042600     COPY DPWS013.                                                04370000
042700                                                                  04380000
042800 EJECT                                                            04390000
042900*---------------------------------------------------------------* 04400000
043000*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 04410000
043100*---------------------------------------------------------------* 04420000
043200     EXEC SQL                                                     04430000
043300          INCLUDE TPURCHS                                         04440000
043400     END-EXEC.                                                    04450000
043500                                                                  04460000
043600 EJECT                                                            04470000
043700*---------------------------------------------------------------* 04480000
043800*    DB2 AREA FOR THE PLANNED SHIPMENTS TABLE                   * 04490000
043900*---------------------------------------------------------------* 04500000
044000     EXEC SQL                                                     04510000
044100          INCLUDE TPLNSHP                                         04520000
044200     END-EXEC.                                                    04530000
044300                                                                  04540000
044400 EJECT                                                            04550000
044500*---------------------------------------------------------------* 04560000
044600*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 04570000
044700*---------------------------------------------------------------* 04580000
044800     EXEC SQL                                                     04590000
044900          INCLUDE TENTNME                                         04600000
045000     END-EXEC.                                                    04610000
045100                                                                  04620000
045200 EJECT                                                            04630000
045300*---------------------------------------------------------------* 04640000
045400*    DB2 AREA FOR THE RECEIVING TABLE                           * 04650000
045500*---------------------------------------------------------------* 04660000
045600                                                                  04670000
045700     EXEC SQL                                                     04680000
045800         INCLUDE TRECEIV                                          04690000
045900     END-EXEC.                                                    04700000
046000                                                                  04710000
046100 EJECT                                                            04720000
046200*---------------------------------------------------------------* 04730000
046300*    DB2 AREA FOR THE MERCHANDISE AREA TABLE                    * 04740000
046400*---------------------------------------------------------------* 04750000
046500                                                                  04760000
046600     EXEC SQL                                                     04770000
046700         INCLUDE TMDSEAR                                          04780000
046800     END-EXEC.                                                    04790000
046900                                                                  04800000
047000 EJECT                                                            04810000
047100*---------------------------------------------------------------* 04820000
047200*    DB2 AREA FOR THE RESPONSIBILITY AREA TABLE                 * 04830000
047300*---------------------------------------------------------------* 04840000
047400                                                                  04850000
047500     EXEC SQL                                                     04860000
047600         INCLUDE TRSPBAR                                          04870000
047700     END-EXEC.                                                    04880000
047800                                                                  04890000
047900 EJECT                                                            04900000
048000*---------------------------------------------------------------* 04910000
048100*    DB2 AREA FOR THE WORKER TABLE                              * 04920000
048200*---------------------------------------------------------------* 04930000
048300                                                                  04940000
048400     EXEC SQL                                                     04950000
048500         INCLUDE TWORKER                                          04960000
048600     END-EXEC.                                                    04970000
048700                                                                  04980000
048800 EJECT                                                            04990000
048900*---------------------------------------------------------------* 05000000
049000*    DB2 AREA FOR COMMUNICATIONS                                * 05010000
049100*---------------------------------------------------------------* 05020000
049200     EXEC SQL                                                     05030000
049300          INCLUDE SQLCA                                           05040000
049400     END-EXEC.                                                    05050000
049500                                                                  05060000
049600 EJECT                                                            05070000
049700*---------------------------------------------------------------* 05080000
049800*    DECLARE PO CURSOR                                          * 05090000
049900*---------------------------------------------------------------* 05100000
050000     EXEC SQL                                                     05110000
050100         DECLARE PO-CSR CURSOR FOR                                05120000
050200          SELECT                                                  05130000
050300        DISTINCT A.PO_NBR                                         05140000
050400                ,A.OTB_PER_NBR                                    05150000
050500                ,A.DEPT_NBR                                       05160000
050600                ,A.ENT_ID                                         05170000
050700                ,C.DONT_SHIP_BEF_DTE                              05180000
050800            FROM TPURCHS A                                        05190000
050900                ,TPLNSHP C                                        05200000
051000           WHERE A.SEASET_SHRT_NM     =  :ASC-KEY-SHORT-NME       05210000
051100             AND A.SEASET_YR          =  :ASC-KEY-YEAR            05220000
051200             AND A.OTB_PER_NBR        >  '199906' CONCAT ' '      05230000
051300             AND A.VER_STATUS_CDE     =  'A'                      05240000
051400             AND C.VER_STATUS_CDE     =  'A'                      05250000
051500             AND A.PO_NBR             = C.PO_NBR                  05260000
051600        ORDER BY A.DEPT_NBR                                       05270000
051700                ,A.PO_NBR                                         05280000
051800     END-EXEC.                                                    05290000
051900                                                                  05300000
052000 EJECT                                                            05310000
052100 LINKAGE SECTION.                                                 05320000
052200                                                                  05330000
052300 01  DFHCOMMAREA.                                                 05340000
052400     05  FILLER                         OCCURS  1 TO 4072 TIMES   05350000
052500                                        DEPENDING ON EIBCALEN.    05360000
052600         10  FILLER                     PIC X.                    05370000
052700                                                                  05380000
052800 EJECT                                                            05390000
052900 PROCEDURE DIVISION.                                              05400000
053000*---------------------------------------------------------------* 05410000
053100*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 05420000
053200*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 05430000
053300*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 05440000
053400*---------------------------------------------------------------* 05450000
053500 0000-MAIN-MODULE.                                                05460000
                                                                        05470000
053700     INITIALIZE DP030-CICS-API-FIELDS.                            05480000
                                                                        05490000
053800                                                                  05500000
053900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05510000
054000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05520000
054100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05530000
054200                                                                  05540000
054300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05550000
054400                                                                  05560000
054500     MOVE LENGTH OF PO110AI        TO DP030-MAP-LENGTH (1).       05570000
054600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05580000
054700                                                                  05590000
054800     PERFORM 0001-CALL-CICS-ARCH-API.                             05600000
054900     PERFORM 1000-CONTROL-PROCESSING                              05610000
055000                                                                  05620000
055100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05630000
055200     PERFORM 0001-CALL-CICS-ARCH-API.                             05640000
055300                                                                  05650000
055400*---------------------------------------------------------------* 05660000
055500*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05670000
055600*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05680000
055700*---------------------------------------------------------------* 05690000
055800 0001-CALL-CICS-ARCH-API.                                         05700000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05710008
056000                                    DFHCOMMAREA                   05720008
056100                                    DP030-CICS-API-FIELDS         05730008
056200                                    DP020-STANDARD-COMMAREA       05740008
056300                                    PO110AI.                      05750008
056400                                                                  05760000
056500     IF  DP030-RC-CALL-SUCCESSFUL                                 05770000
056600         CONTINUE                                                 05780000
056700     ELSE                                                         05790000
056800         SET DP013-NO-ROLLBACK                                    05800000
056900             DP013-XCTL-DISPLAY-RESTART                           05810000
057000             DP013-CICS-ABEND      TO TRUE                        05820000
057100         MOVE '0001-CALL-CICS-ARCH-API'                           05830000
057200                                   TO DP013-PARAGRAPH             05840000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05850008
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05860008
057500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05870000
057600         PERFORM DP013-0000-PROCESS-ABEND                         05880000
057700     END-IF.                                                      05890000
057800                                                                  05900000
057900*----------------------------------------------------------------*05910000
058000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05920000
058100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05930000
058200*                                                                *05940000
058300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05950000
058400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05960000
058500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05970000
058600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05980000
058700*----------------------------------------------------------------*05990000
058800                                                                  06000000
058900 1000-CONTROL-PROCESSING.                                         06010000
059000                                                                  06020000
059100     EVALUATE TRUE                                                06030000
059200         WHEN DP020-NEXT-ACT-INITIAL                              06040000
059300             INITIALIZE ASC-SPECIFIC-COMMAREA                     06050000
059400                                                                  06060000
059500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06070000
059600                                      ASC-SEL-TERM-ID             06080000
059700             MOVE DP020-SRC-TASK-NUMBER                           06090000
059800                                   TO ASC-LIST-TASK-NUMBER        06100000
059900                                      ASC-SEL-TASK-NUMBER         06110000
060000             MOVE PC-LIST-QUEUE-SEQ                               06120000
060100                                   TO ASC-LIST-SEQ                06130000
060200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06140000
060300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06150000
060400             IF  PS-COMMAREA-NOT-VALID                            06160000
060500                 SET DP020-NEXT-ACT-APPL-ERROR                    06170000
060600                                   TO TRUE                        06180000
060700             ELSE                                                 06190000
060800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06200000
060900                 MOVE ASC-KEY-SHORT-NME                           06210000
061000                                   TO PV-SCREEN-SHRT-NME          06220000
061100                 MOVE ASC-KEY-YEAR TO PV-SCREEN-YEAR              06230000
061200                 MOVE PV-SCREEN-TITLE                             06240000
061300                                   TO DP020-PANEL-TITLE           06250000
061400             END-IF                                               06260000
061500                                                                  06270000
061600         WHEN DP020-NEXT-ACT-READ-MAP                             06280000
061700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06290000
061800                                   TO PV-TOP-ITEM                 06300000
061900             PERFORM 2000-PROCESS-PANEL                           06310000
062000                                                                  06320000
062100         WHEN DP020-NEXT-ACT-RETURN                               06330000
062200             MOVE ASC-KEY-SHORT-NME                               06340000
062300                                   TO PV-SCREEN-SHRT-NME          06350000
062400             MOVE ASC-KEY-YEAR     TO PV-SCREEN-YEAR              06360000
062500             MOVE PV-SCREEN-TITLE  TO DP020-PANEL-TITLE           06370000
062600             IF PO079-W102-REFRESH                                06380000
062700                 PERFORM 2050-DELETE-LIST-QUEUE                   06390000
062800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06400000
062900             ELSE                                                 06410000
063000                 IF ASC-NUMBER-OF-ITEMS-READ > ZERO               06420000
063100                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                06430000
063200                                   TO PV-TOP-ITEM                 06440000
063300                     MOVE ZERO     TO ASC-ITEM-AT-TOP-OF-PANEL    06450000
063400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         06460000
063500                 ELSE                                             06470000
063600                     PERFORM 4100-FORMAT-EMPTY-SCREEN             06480000
063700                         VARYING PV-SUB FROM +1 BY +1             06490000
063800                             UNTIL PV-SUB > PC-ITEMS-PER-PANEL    06500000
063900                 END-IF                                           06510000
064000             END-IF                                               06520000
064100                                                                  06530000
064200         WHEN OTHER                                               06540000
064300             SET DP013-LOGIC-ABEND TO TRUE                        06550000
064400             SET DP013-NO-ROLLBACK TO TRUE                        06560000
064500             MOVE '1000-CONTROL-PROCESSING'                       06570000
064600                                   TO DP013-PARAGRAPH             06580000
064700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06590000
064800                                   TO DP013-MESSAGE-TEXT(1)       06600000
064900             PERFORM DP013-0000-PROCESS-ABEND                     06610000
065000     END-EVALUATE.                                                06620000
065100                                                                  06630000
065200 EJECT                                                            06640000
065300*----------------------------------------------------------------*06650000
065400* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *06660000
065500*----------------------------------------------------------------*06670000
065600                                                                  06680000
065700 1100-PROCESS-INTER-APPL-COMM.                                    06690000
065800                                                                  06700000
065900     SET PS-COMMAREA-VALID         TO TRUE.                       06710000
066000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06720000
066100                                                                  06730000
066200     EVALUATE DP020-INT-APPL-FORMAT-IND                           06740000
066300                                                                  06750000
066400         WHEN PC-INTER-APPL-LIST                                  06760000
066500             MOVE PO078-NUMBER-OF-SELECTED-ITEMS                  06770000
066600                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  06780000
066700             MOVE PO078-NUMBER-OF-TS-ITEMS                        06790000
066800                                 TO ASC-NUMBER-OF-TS-ITEMS        06800000
066900             MOVE PO078-SEL-QUEUE-NAME                            06810000
067000                                 TO ASC-SEL-QUEUE-NAME-IN         06820000
067100             PERFORM 1120-PREPARE-LIST-ENTRY                      06830000
067200                                                                  06840000
067300         WHEN OTHER                                               06850000
067400             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            06860000
067500             SET PS-ERROR                                         06870000
067600                 PS-COMMAREA-NOT-VALID                            06880000
067700                 DP020-MSG-FATAL                                  06890000
067800                 DP020-NEXT-ACT-APPL-ERROR                        06900000
067900                                   TO TRUE                        06910000
068000                                                                  06920000
068100     END-EVALUATE.                                                06930000
068200                                                                  06940000
068300 EJECT                                                            06950000
068400*----------------------------------------------------------------*06960000
068500*    ENTRY IS FROM A LIST.  GET THE SET YEAR AND NAME FROM THE   *06970000
068600*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *06980000
068700*----------------------------------------------------------------*06990000
068800 1120-PREPARE-LIST-ENTRY.                                         07000000
068900                                                                  07010000
069000     MOVE PO077-MAX-ITEMS          TO ASC-SEL-SUB.                07020000
069100     MOVE ZERO                     TO ASC-SEL-ITEM.               07030000
069200     PERFORM 2310-GET-NEXT-SET.                                   07040000
069300                                                                  07050000
069400 EJECT                                                            07060000
069500*----------------------------------------------------------------*07070000
069600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07080000
069700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07090000
069800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07100000
069900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07110000
070000* FUNCTION KEYS CAN GET THIS FAR.                                *07120000
070100*----------------------------------------------------------------*07130000
070200                                                                  07140000
070300 2000-PROCESS-PANEL.                                              07150000
070400     EVALUATE TRUE                                                07160000
070500         WHEN DP020-SRC-AID = DP016-CLEAR                         07170000
070600             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   07180000
070700                 MOVE ZERO        TO ASC-ITEM-AT-TOP-OF-PANEL     07190000
070800                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07200000
070900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07210000
071000             ELSE                                                 07220000
071100                 MOVE +0           TO PV-SUB                      07230000
071200                 PERFORM                                          07240000
071300                     UNTIL PV-SUB > PC-ITEMS-PER-PANEL            07250000
071400                     MOVE DP015-ASK-DRK-OFF                       07260000
071500                                    TO MR-SELECTA (PV-SUB)        07270000
071600                     ADD +1         TO PV-SUB                     07280000
071700                 END-PERFORM                                      07290000
071800             END-IF                                               07300000
071900                                                                  07310000
072000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07320000
072100             PERFORM 2050-DELETE-LIST-QUEUE                       07330000
072200             PERFORM 4000-BUILD-INITIAL-PANEL                     07340000
072300                                                                  07350000
072400         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   07360000
072500             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   07370000
072600                 PERFORM 2140-DESELECT-ALL-ITEMS                  07380000
072700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07390000
072800             END-IF                                               07400000
072900                                                                  07410000
073000         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 07420000
073100             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   07430000
073200                  PERFORM 2150-SELECT-ALL-ITEMS                   07440000
073300                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            07450000
073400             END-IF                                               07460000
073500                                                                  07470000
073600         WHEN OTHER                                               07480000
073700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07490000
073800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07500000
073900             IF  PS-NO-ERROR                                      07510000
074000                 SET DP030-CONTINUE-GO TO TRUE                    07520000
074100                 PERFORM 2100-CHECK-FUNCTION-KEY                  07530000
074200             ELSE                                                 07540000
074300                 SET DP030-OVERRIDE-GO TO TRUE                    07550000
074400             END-IF                                               07560000
074500     END-EVALUATE.                                                07570000
074600                                                                  07580000
074700 EJECT                                                            07590000
074800*----------------------------------------------------------------*07600000
074900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07610000
075000*----------------------------------------------------------------*07620000
075100 2050-DELETE-LIST-QUEUE.                                          07630000
075200                                                                  07640000
075300     EXEC CICS                                                    07650000
075400         DELETEQ TS                                               07660000
075500           QUEUE (ASC-LIST-QUEUE-NAME)                            07670000
075600            RESP (PV-CICS-RESP)                                   07680000
075700     END-EXEC.                                                    07690000
075800                                                                  07700000
075900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07710000
076000        (PV-CICS-RESP = DFHRESP(QIDERR))                          07720000
076100         CONTINUE                                                 07730000
076200     ELSE                                                         07740000
076300         SET DP013-CICS-ABEND      TO TRUE                        07750000
076400         SET DP013-NO-ROLLBACK     TO TRUE                        07760000
076500                                                                  07770000
076600         MOVE '2050-DELETE-LIST-QUEUE'                            07780000
076700                                   TO DP013-PARAGRAPH             07790000
076800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07800000
076900                                   TO DP013-MESSAGE-TEXT (1)      07810000
077000         PERFORM DP013-0000-PROCESS-ABEND                         07820000
077100     END-IF.                                                      07830000
077200                                                                  07840000
077300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07850000
077400                                                                  07860000
077500 EJECT                                                            07870000
077600*----------------------------------------------------------------*07880000
077700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07890000
077800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07900000
077900* CICS ARCHITECTURE API.                                         *07910000
078000*----------------------------------------------------------------*07920000
078100 2100-CHECK-FUNCTION-KEY.                                         07930000
078200                                                                  07940000
078300     EVALUATE TRUE                                                07950000
078400                                                                  07960000
095700         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               07970000
128500              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             07980000
128600                  INITIALIZE PO013-INTER-APPL-COMMAREA            07990000
128700                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               08000000
128800                                TO PO013-NUMBER-OF-SELECTED-ITEMS 08010000
128900                                                                  08020000
129000                  PERFORM 5000-PREPARE-SEL-QUEUE                  08030000
129100              ELSE                                                08040000
129200                  SET DP030-OVERRIDE-GO                           08050000
129300                      DP020-MSG-WARNING                           08060000
129400                                TO TRUE                           08070000
129500                  MOVE PC-TSYMSG-00057                            08080000
129600                                TO DP020-MSG-NUMBER               08090000
129700              END-IF                                              08100000
129800                                                                  08110000
078500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08120000
078600             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08130000
078700                 MOVE +1               TO PV-TOP-ITEM             08140000
078800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08150000
078900                 PERFORM 3200-RESET-ATTRIBUTES                    08160000
079000             END-IF                                               08170000
079100                                                                  08180000
079200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08190000
079300             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08200000
079400                 PERFORM 2110-BROWSE-BACKWARD                     08210000
079500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08220000
079600                 PERFORM 3200-RESET-ATTRIBUTES                    08230000
079700             END-IF                                               08240000
079800                                                                  08250000
079900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08260000
080000             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08270000
080100                 PERFORM 2120-BROWSE-FORWARD                      08280000
080200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08290000
080300                 PERFORM 3200-RESET-ATTRIBUTES                    08300000
080400             END-IF                                               08310000
080500                                                                  08320000
080600         WHEN DP020-SRC-AID = DP016-ENTER                         08330000
080700             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   08340000
080800                 PERFORM 2130-CHECK-FOR-JUMP-BROWSE               08350000
080900                 IF  PS-ERROR                                     08360000
081000                     CONTINUE                                     08370000
081100                 ELSE                                             08380000
081200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08390000
081300                     PERFORM 3200-RESET-ATTRIBUTES                08400000
081400                 END-IF                                           08410000
081500             END-IF                                               08420000
081600                                                                  08430000
081700         WHEN OTHER                                               08440000
081800             SET DP013-NO-ROLLBACK                                08450000
081900                 DP013-XCTL-DISPLAY-RESTART                       08460000
082000                 DP013-CICS-ABEND  TO TRUE                        08470000
082100             MOVE '2100-CHECK-FUNCTION-KEY'                       08480000
082200                                   TO DP013-PARAGRAPH             08490000
082300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08500000
082400                                   TO DP013-MESSAGE-TEXT (1)      08510000
082500             PERFORM DP013-0000-PROCESS-ABEND                     08520000
082600     END-EVALUATE.                                                08530000
082700                                                                  08540000
082800 EJECT                                                            08550000
082900*----------------------------------------------------------------*08560000
083000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08570000
083100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08580000
083200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08590000
083300*    MESSAGE.                                                    *08600000
083400*----------------------------------------------------------------*08610000
083500                                                                  08620000
083600 2110-BROWSE-BACKWARD.                                            08630000
083700                                                                  08640000
083800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08650000
083900         GIVING PV-TOP-ITEM.                                      08660000
084000                                                                  08670000
084100     IF  ((PV-TOP-ITEM < +1)                                      08680000
084200       OR (PV-TOP-ITEM = +1))                                     08690000
084300         MOVE +1                   TO PV-TOP-ITEM                 08700000
084400*        -- TOP OF LIST --                                        08710000
084500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08720000
084600         SET DP020-MSG-INFORMATIONAL                              08730000
084700                                   TO TRUE                        08740000
084800     END-IF.                                                      08750000
084900                                                                  08760000
085000 EJECT                                                            08770000
085100*----------------------------------------------------------------*08780000
085200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08790000
085300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08800000
085400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08810000
085500*----------------------------------------------------------------*08820000
085600                                                                  08830000
085700 2120-BROWSE-FORWARD.                                             08840000
085800                                                                  08850000
085900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08860000
086000         GIVING PV-TOP-ITEM.                                      08870000
086100                                                                  08880000
086200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08890000
086300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08900000
086400                                   TO PV-TOP-ITEM                 08910000
086500*        -- BOTTOM OF LIST --                                     08920000
086600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08930000
086700         SET DP020-MSG-INFORMATIONAL                              08940000
086800                                   TO TRUE                        08950000
086900     ELSE                                                         08960000
087000         COMPUTE PV-BOTTOM-ITEM =                                 08970000
087100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08980000
087200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08990000
087300*            -- BOTTOM OF LIST --                                 09000000
087400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09010000
087500             SET DP020-MSG-INFORMATIONAL                          09020000
087600                                   TO TRUE                        09030000
087700         END-IF                                                   09040000
087800     END-IF.                                                      09050000
087900                                                                  09060000
088000 EJECT                                                            09070000
088100*----------------------------------------------------------------*09080000
088200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09090000
088300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09100000
088400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09110000
088500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09120000
088600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09130000
088700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09140000
088800*----------------------------------------------------------------*09150000
088900                                                                  09160000
089000 2130-CHECK-FOR-JUMP-BROWSE.                                      09170000
089100                                                                  09180000
089200     SET PS-NO-ERROR               TO TRUE.                       09190000
089300     IF (ASC-START-ITEM-REQUEST = SPACE)                          09200000
089400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09210000
089500                                   TO PV-TOP-ITEM                 09220000
089600     ELSE                                                         09230000
089700         MOVE ASC-START-ITEM-REQUEST                              09240000
089800                                   TO DP010I-UNEDITED-FIELD       09250000
089900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09260000
090000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09270000
090100         SET DP010I-NEGATIVE-NOT-ALLOWED                          09280000
090200                                   TO TRUE                        09290000
090300         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09300000
090400              USING DP010I-NUMERIC-EDIT-AREA                      09310000
090500                                                                  09320000
090600         IF  NOT DP010I-ERROR-DETECTED                            09330000
090700             MOVE DP010I-NUMERIC-FIELD                            09340000
090800                                   TO ASC-START-ITEM-REQUEST-N    09350000
090900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09360000
091000                 IF  ASC-START-ITEM-REQUEST-N >                   09370000
091100                                          ASC-NUMBER-OF-ITEMS-READ09380000
091200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09390000
091300                     COMPUTE PV-TOP-ITEM =                        09400000
091400                             ASC-NUMBER-OF-ITEMS-READ             09410000
091500                             - PC-ITEMS-PER-PANEL + 1             09420000
091600                     IF  PV-TOP-ITEM < +1                         09430000
091700                         MOVE +1   TO PV-TOP-ITEM                 09440000
091800                         MOVE PC-TSYMSG-00070                     09450000
091900                                   TO DP020-MSG-NUMBER            09460000
092000                         SET DP020-MSG-INFORMATIONAL              09470000
092100                                   TO TRUE                        09480000
092200                     END-IF                                       09490000
092300                 ELSE                                             09500000
092400                     MOVE ASC-START-ITEM-REQUEST-N                09510000
092500                                   TO PV-TOP-ITEM                 09520000
092600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09530000
092700                     COMPUTE PV-BOTTOM-ITEM =                     09540000
092800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09550000
092900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09560000
093000*                        -- BOTTOM OF LIST --                     09570000
093100                         MOVE PC-TSYMSG-00070                     09580000
093200                                   TO DP020-MSG-NUMBER            09590000
093300                         SET DP020-MSG-INFORMATIONAL              09600000
093400                                   TO TRUE                        09610000
093500                     END-IF                                       09620000
093600                 END-IF                                           09630000
093700             ELSE                                                 09640000
093800*                --- VALUE OUT OF RANGE ----                      09650000
093900                 MOVE PC-TSYMSG-00101                             09660000
094000                                   TO DP020-MSG-NUMBER            09670000
094100                 MOVE -1           TO ASTRTITL                    09680000
094200                 SET DP030-SET-CURSOR-APPL-1                      09690000
094300                                   TO TRUE                        09700000
094400                 MOVE DP015-REVERSE                               09710000
094500                                   TO ASTRTITH                    09720000
094600                 MOVE DP015-RED    TO ASTRTITC                    09730000
094700                 MOVE DP015-UNP-NUM-BRT-MDT                       09740000
094800                                   TO ASTRTITA                    09750000
094900                 SET DP020-MSG-FATAL                              09760000
095000                                   TO TRUE                        09770000
095100                 SET PS-ERROR      TO TRUE                        09780000
095200             END-IF                                               09790000
095300                                                                  09800000
095400         ELSE                                                     09810000
095500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09820000
095600             MOVE -1               TO ASTRTITL                    09830000
095700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09840000
095800             MOVE DP015-REVERSE    TO ASTRTITH                    09850000
095900             MOVE DP015-RED        TO ASTRTITC                    09860000
096000             MOVE DP015-UNP-NUM-BRT-MDT                           09870000
096100                                   TO ASTRTITA                    09880000
096200             SET DP020-MSG-FATAL   TO TRUE                        09890000
096300             SET PS-ERROR          TO TRUE                        09900000
096400         END-IF                                                   09910000
096500     END-IF.                                                      09920000
096600                                                                  09930000
096700 EJECT                                                            09940000
096800*----------------------------------------------------------------*09950000
096900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09960000
097000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09970000
097100*----------------------------------------------------------------*09980000
097200 2140-DESELECT-ALL-ITEMS.                                         09990000
097300                                                                  10000000
097400     MOVE +1                       TO ASC-BLK-SUB.                10010000
097500                                                                  10020000
097600     PERFORM 2141-CLEAR-SELECTED-INDS                             10030000
097700         VARYING ASC-ITEM-SUB                                     10040000
097800         FROM 1 BY 1                                              10050000
097900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10060000
098000                                                                  10070000
098100     ADD +1                        TO ASC-BLK-SUB.                10080000
098200                                                                  10090000
098300     PERFORM 2141-CLEAR-SELECTED-INDS                             10100000
098400         VARYING ASC-ITEM-SUB                                     10110000
098500         FROM 1 BY 1                                              10120000
098600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10130000
098700                                                                  10140000
098800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10150000
098900                                   TO PV-LIST-ITEM-NUMBER.        10160000
099000                                                                  10170000
099100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10180000
099200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10190000
099300                                                                  10200000
099400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10210000
099500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10220000
099600         MOVE +1                   TO ASC-BLK-SUB                 10230000
099700                                                                  10240000
099800         PERFORM 5100-WRITE-TEMP-STORAGE                          10250000
099900                                                                  10260000
100000         MOVE +1                   TO PV-BLOCK-NUMBER             10270000
100100                                                                  10280000
100200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10290000
100300             PV-FIRST-BLOCK-IN-ARRAY - 1                          10300000
100400                                                                  10310000
100500         PERFORM                                                  10320000
100600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10330000
100700                                                                  10340000
100800             PERFORM 4410-READ-TEMP-STORAGE                       10350000
100900                                                                  10360000
101000             PERFORM 2141-CLEAR-SELECTED-INDS                     10370000
101100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10380000
101200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10390000
101300                                                                  10400000
101400             PERFORM 5100-WRITE-TEMP-STORAGE                      10410000
101500                                                                  10420000
101600             ADD +1                TO PV-BLOCK-NUMBER             10430000
101700                                                                  10440000
101800         END-PERFORM                                              10450000
101900                                                                  10460000
102000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10470000
102100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10480000
102200                                                                  10490000
102300         PERFORM                                                  10500000
102400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10510000
102500                   ASC-HIGHEST-BLOCK-WRITTEN                      10520000
102600                                                                  10530000
102700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10540000
102800                                   TO PV-BLOCK-NUMBER             10550000
102900                                                                  10560000
103000             PERFORM 4410-READ-TEMP-STORAGE                       10570000
103100                                                                  10580000
103200             PERFORM 2141-CLEAR-SELECTED-INDS                     10590000
103300                 VARYING ASC-ITEM-SUB                             10600000
103400                 FROM 1 BY 1                                      10610000
103500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10620000
103600                                                                  10630000
103700             PERFORM 5100-WRITE-TEMP-STORAGE                      10640000
103800                                                                  10650000
103900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10660000
104000                                                                  10670000
104100         END-PERFORM                                              10680000
104200                                                                  10690000
104300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10700000
104400                                   TO PV-BLOCK-NUMBER             10710000
104500                                                                  10720000
104600         PERFORM 4410-READ-TEMP-STORAGE                           10730000
104700     END-IF.                                                      10740000
104800                                                                  10750000
104900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS10760000
105000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10770000
105100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10780000
105200                                                                  10790000
105300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10800000
105400                                                                  10810000
105500 EJECT                                                            10820000
105600*----------------------------------------------------------------*10830000
105700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10840000
105800*----------------------------------------------------------------*10850000
105900                                                                  10860000
106000 2141-CLEAR-SELECTED-INDS.                                        10870000
106100                                                                  10880000
106200     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          10890000
106300             NOT EQUAL ZERO                                       10900000
106400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10910000
106500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10920000
106600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10930000
106700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10940000
106800                                   TO TRUE                        10950000
106900         END-IF                                                   10960000
107000     END-IF.                                                      10970000
107100                                                                  10980000
107200 EJECT                                                            10990000
107300*----------------------------------------------------------------*11000000
107400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11010000
107500*  FOR ALL ITEMS.                                                *11020000
107600*----------------------------------------------------------------*11030000
107700                                                                  11040000
107800 2150-SELECT-ALL-ITEMS.                                           11050000
107900                                                                  11060000
108000     MOVE +1                       TO ASC-BLK-SUB.                11070000
108100                                                                  11080000
108200     PERFORM 2151-SET-SELECTED-INDS                               11090000
108300         VARYING ASC-ITEM-SUB                                     11100000
108400         FROM 1 BY 1                                              11110000
108500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11120000
108600                                                                  11130000
108700     ADD +1                        TO ASC-BLK-SUB.                11140000
108800                                                                  11150000
108900     PERFORM 2151-SET-SELECTED-INDS                               11160000
109000         VARYING ASC-ITEM-SUB                                     11170000
109100         FROM 1 BY 1                                              11180000
109200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11190000
109300                                                                  11200000
109400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11210000
109500                                   TO PV-LIST-ITEM-NUMBER.        11220000
109600                                                                  11230000
109700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11240000
109800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11250000
109900                                                                  11260000
110000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11270000
110100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11280000
110200         MOVE +1                   TO ASC-BLK-SUB                 11290000
110300                                                                  11300000
110400         PERFORM 5100-WRITE-TEMP-STORAGE                          11310000
110500                                                                  11320000
110600         MOVE +1                   TO PV-BLOCK-NUMBER             11330000
110700                                                                  11340000
110800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11350000
110900             PV-FIRST-BLOCK-IN-ARRAY - 1                          11360000
111000                                                                  11370000
111100         PERFORM                                                  11380000
111200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11390000
111300                                                                  11400000
111400             PERFORM 4410-READ-TEMP-STORAGE                       11410000
111500                                                                  11420000
111600             PERFORM 2151-SET-SELECTED-INDS                       11430000
111700                 VARYING ASC-ITEM-SUB                             11440000
111800                 FROM 1 BY 1                                      11450000
111900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11460000
112000                                                                  11470000
112100             PERFORM 5100-WRITE-TEMP-STORAGE                      11480000
112200                                                                  11490000
112300             ADD +1                TO PV-BLOCK-NUMBER             11500000
112400         END-PERFORM                                              11510000
112500                                                                  11520000
112600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11530000
112700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11540000
112800                                                                  11550000
112900         PERFORM                                                  11560000
113000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11570000
113100                   ASC-HIGHEST-BLOCK-WRITTEN                      11580000
113200                                                                  11590000
113300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11600000
113400                                   TO PV-BLOCK-NUMBER             11610000
113500                                                                  11620000
113600             PERFORM 4410-READ-TEMP-STORAGE                       11630000
113700                                                                  11640000
113800             PERFORM 2151-SET-SELECTED-INDS                       11650000
113900                 VARYING ASC-ITEM-SUB                             11660000
114000                 FROM 1 BY 1                                      11670000
114100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11680000
114200                                                                  11690000
114300             PERFORM 5100-WRITE-TEMP-STORAGE                      11700000
114400                                                                  11710000
114500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11720000
114600         END-PERFORM                                              11730000
114700                                                                  11740000
114800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11750000
114900                                   TO PV-BLOCK-NUMBER             11760000
115000                                                                  11770000
115100         PERFORM 4410-READ-TEMP-STORAGE                           11780000
115200     END-IF.                                                      11790000
115300                                                                  11800000
115400     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11810000
115500          ASC-NUMBER-OF-SELECTED-ITEMS.                           11820000
115600                                                                  11830000
115700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11840000
115800                                                                  11850000
115900 EJECT                                                            11860000
116000*----------------------------------------------------------------*11870000
116100*    MARK EACH ITEM AS BEING SELECTED.                           *11880000
116200*----------------------------------------------------------------*11890000
116300                                                                  11900000
116400 2151-SET-SELECTED-INDS.                                          11910000
116500                                                                  11920000
116600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11930000
116700             NOT EQUAL ZERO                                       11940000
116800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11950000
116900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11960000
117000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11970000
117100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11980000
117200                                   TO TRUE                        11990000
117300         END-IF                                                   12000000
117400     END-IF.                                                      12010000
117500                                                                  12020000
117600 EJECT                                                            12030000
117700*----------------------------------------------------------------*12040000
117800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *12050000
117900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *12060000
118000*----------------------------------------------------------------*12070000
118100 2200-MOVE-SCREEN-TO-COMMAREA.                                    12080000
118200                                                                  12090000
118300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12100000
118400     MOVE +1                       TO PV-SUB.                     12110000
118500                                                                  12120000
118600     PERFORM 3100-SET-SUBSCRIPTS.                                 12130000
118700                                                                  12140000
118800     IF  ASTRTITL > ZERO                                          12150000
118900             IF ASC-NUMBER-OF-ITEMS-READ > ZERO                   12160000
119000                 MOVE ASTRTITI        TO ASC-START-ITEM-REQUEST   12170000
119100             ELSE                                                 12180000
119200                 MOVE ZEROS           TO ASTRTITO                 12190000
119300             END-IF                                               12200000
119400     ELSE                                                         12210000
119500         IF  ASTRTITF = DP015-ERASE-EOF                           12220000
119600             INITIALIZE ASC-START-ITEM-REQUEST                    12230000
119700         END-IF                                                   12240000
119800     END-IF.                                                      12250000
119900                                                                  12260000
120000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12270000
120100         VARYING PV-SUB                                           12280000
120200         FROM 1 BY 1                                              12290000
120300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12300000
120400                                                                  12310000
120500 EJECT                                                            12320000
120600*----------------------------------------------------------------*12330000
120700*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *12340000
120800*----------------------------------------------------------------*12350000
120900 2210-MOVE-LINES-TO-COMMAREA.                                     12360000
121000                                                                  12370000
121100     IF  MR-SELECTL (PV-SUB) > ZERO                               12380000
121200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     12390000
121300                                   TO TRUE                        12400000
121400         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        12410000
121500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12420000
121600     ELSE                                                         12430000
121700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12440000
121800             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         12450000
121900             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        12460000
122000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12470000
122100         END-IF                                                   12480000
122200     END-IF.                                                      12490000
122300                                                                  12500000
122400     ADD +1                        TO ASC-ITEM-SUB.               12510000
122500                                                                  12520000
122600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12530000
122700         ADD +1                    TO ASC-BLK-SUB                 12540000
122800         MOVE +1                   TO ASC-ITEM-SUB                12550000
122900     END-IF.                                                      12560000
123000                                                                  12570000
123100 EJECT                                                            12580000
123200*----------------------------------------------------------------*12590000
123300*    GET THE SET INFO (KEY) OF THE NEXT SELECTED OBJECT          *12600000
123400*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *12610000
123500*----------------------------------------------------------------*12620000
123600 2310-GET-NEXT-SET.                                               12630000
123700                                                                  12640000
123800     ADD +1                        TO ASC-SEL-SUB.                12650000
123900     IF  ASC-SEL-SUB > PO077-MAX-ITEMS                            12660000
124000         ADD +1                    TO ASC-SEL-ITEM                12670000
124100         MOVE +1                   TO ASC-SEL-SUB                 12680000
124200     END-IF.                                                      12690000
124300                                                                  12700000
124400     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12710000
124500         PERFORM 9100-READ-SEL-QUEUE                              12720000
124600         IF  PO077-ITEM (ASC-SEL-SUB) > ZERO                      12730000
124700             MOVE PO077-SHORT-NME (ASC-SEL-SUB)                   12740000
124800                                   TO ASC-KEY-SHORT-NME           12750000
124900             MOVE PO077-YEAR (ASC-SEL-SUB)                        12760000
125000                                   TO ASC-KEY-YEAR                12770000
125100             SET PO077-INQ (ASC-SEL-SUB)                          12780000
125200                                   TO TRUE                        12790000
125300             PERFORM 9200-REWRITE-SEL-QUEUE                       12800000
125400         ELSE                                                     12810000
125500             SUBTRACT +1 FROM ASC-SEL-SUB                         12820000
125600*            --- BOTTOM OF LIST ---                               12830000
125700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12840000
125800             SET DP020-MSG-INFORMATIONAL                          12850000
125900                                   TO TRUE                        12860000
126000         END-IF                                                   12870000
126100     ELSE                                                         12880000
126200         SUBTRACT +1 FROM ASC-SEL-ITEM                            12890000
126300         MOVE PO077-MAX-ITEMS      TO ASC-SEL-SUB                 12900000
126400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12910000
126500         SET DP020-MSG-INFORMATIONAL                              12920000
126600                                   TO TRUE                        12930000
126700     END-IF.                                                      12940000
126800                                                                  12950000
126900 EJECT                                                            12960000
127000*----------------------------------------------------------------*12970000
127100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12980000
127200*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12990000
127300*----------------------------------------------------------------*13000000
127400 3000-EDIT-DATA-IN-COMMAREA.                                      13010000
127500                                                                  13020000
127600     SET PS-NO-ERROR               TO TRUE.                       13030000
127700                                                                  13040000
127800     PERFORM 3200-RESET-ATTRIBUTES.                               13050000
127900                                                                  13060000
128000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13070000
128100**                                                                13080000
128200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13090000
128300* EDITTING IS DONE FROM THE BOTTOM UP.                            13100000
128400**                                                                13110000
128500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13120000
128600         ASC-ITEMS-DISPLAYED - 1.                                 13130000
128700                                                                  13140000
128800     PERFORM 3100-SET-SUBSCRIPTS.                                 13150000
128900     PERFORM 3300-EDIT-SELECTIONS                                 13160000
129000         VARYING PV-SUB                                           13170000
129100         FROM PV-SUB BY -1                                        13180000
129200         UNTIL PV-SUB < +1                                        13190000
129300                                                                  13200000
129400     IF  PS-NO-ERROR                                              13210000
129500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13220000
129600     END-IF.                                                      13230000
129700                                                                  13240000
129800     IF  ((PS-NO-ERROR)                                           13250000
129900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13260000
130000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13270000
130100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13280000
130200     END-IF.                                                      13290000
130300                                                                  13300000
130400 EJECT                                                            13310000
130500*----------------------------------------------------------------*13320000
130600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13330000
130700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13340000
130800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13350000
130900*                                                                *13360000
131000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13370000
131100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13380000
131200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13390000
131300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13400000
131400*----------------------------------------------------------------*13410000
131500                                                                  13420000
131600 3100-SET-SUBSCRIPTS.                                             13430000
131700                                                                  13440000
131800     COMPUTE ASC-ITEM-SUB =                                       13450000
131900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13460000
132000                                                                  13470000
132100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13480000
132200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13490000
132300                                                                  13500000
132400         MOVE PC-MAX-BLOCKS-IN-ARRAY                              13510000
132500                                   TO ASC-BLK-SUB                 13520000
132600     ELSE                                                         13530000
132700         MOVE +1                   TO ASC-BLK-SUB                 13540000
132800     END-IF.                                                      13550000
132900                                                                  13560000
133000*----------------------------------------------------------------*13570000
133100*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *13580000
133200*----------------------------------------------------------------*13590000
133300                                                                  13600000
133400 3200-RESET-ATTRIBUTES.                                           13610000
133500                                                                  13620000
133600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13630000
133700     MOVE DP015-GREEN              TO ASTRTITC.                   13640000
133800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13650000
133900                                                                  13660000
134000     IF DP020-NEXT-ACT-RETURN                                     13670000
134100     OR DP020-NEXT-ACT-READ-MAP                                   13680000
134200        PERFORM                                                   13690000
134300            VARYING PV-SUB                                        13700000
134400            FROM 1 BY 1                                           13710000
134500            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    13720000
134600            MOVE DP015-UNP-ALP-NOR-OFF                            13730000
134700                                      TO MR-SELECTA (PV-SUB)      13740000
134800            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13750000
134900            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13760000
135000        END-PERFORM                                               13770000
135100     ELSE                                                         13780000
135200        PERFORM                                                   13790000
135300            VARYING PV-SUB                                        13800000
135400            FROM 1 BY 1                                           13810000
135500            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     13820000
135600            MOVE DP015-UNP-ALP-NOR-OFF                            13830000
135700                                      TO MR-SELECTA (PV-SUB)      13840000
135800            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13850000
135900            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13860000
136000        END-PERFORM                                               13870000
136100     END-IF.                                                      13880000
136200                                                                  13890000
136300 EJECT                                                            13900000
136400*----------------------------------------------------------------*13910000
136500*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *13920000
136600*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13930000
136700*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13940000
136800*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13950000
136900*----------------------------------------------------------------*13960000
137000 3300-EDIT-SELECTIONS.                                            13970000
137100                                                                  13980000
137200     EVALUATE TRUE                                                13990000
137300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14000000
137400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14010000
137500                 CONTINUE                                         14020000
137600                                                                  14030000
137700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14040000
137800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14050000
137900                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS14060000
138000                 MOVE ASC-TEMP-SELECTED-SW                        14070000
138100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14080000
138200                                   TO ASC-SELECTED-SW             14090000
138300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14100000
138400             END-IF                                               14110000
138500                                                                  14120000
138600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14130000
138700                 = SPACE                                          14140000
138800             EVALUATE TRUE                                        14150000
138900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14160000
139000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14170000
139100                     MOVE SPACE    TO ASC-SELECTED-SW             14180000
139200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14190000
139300                                                                  14200000
139400                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14210000
139500                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 14220000
139600                     MOVE SPACE    TO ASC-SELECTED-SW             14230000
139700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14240000
139800                                                                  14250000
139900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14260000
140000                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   14270000
140100                     MOVE SPACE    TO ASC-SELECTED-SW             14280000
140200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14290000
140300             END-EVALUATE                                         14300000
140400                                                                  14310000
140500         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14320000
140600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14330000
140700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14340000
140800             END-IF                                               14350000
140900             PERFORM 3310-EDIT-RANGE                              14360000
141000                                                                  14370000
141100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14380000
141200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14390000
141300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14400000
141400             END-IF                                               14410000
141500             PERFORM 3310-EDIT-RANGE                              14420000
141600                                                                  14430000
141700         WHEN OTHER                                               14440000
141800             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            14450000
141900             SET DP020-MSG-FATAL   TO TRUE                        14460000
142000             MOVE -1               TO MR-SELECTL (PV-SUB)         14470000
142100             SET DP030-SET-CURSOR-APPL-1                          14480000
142200                                   TO TRUE                        14490000
142300             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         14500000
142400             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         14510000
142500             SET PS-ERROR          TO TRUE                        14520000
142600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14530000
142700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14540000
142800                 MOVE SPACE        TO ASC-SELECTED-SW             14550000
142900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14560000
143000             END-IF                                               14570000
143100     END-EVALUATE.                                                14580000
143200                                                                  14590000
143300     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             14600000
143400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14610000
143500                                                                  14620000
143600     IF  ASC-ITEM-SUB < 1                                         14630000
143700         SUBTRACT +1 FROM ASC-BLK-SUB                             14640000
143800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14650000
143900     END-IF.                                                      14660000
144000                                                                  14670000
144100*----------------------------------------------------------------*14680000
144200*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *14690000
144300*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *14700000
144400*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *14710000
144500*  THE ENDING.                                                   *14720000
144600*----------------------------------------------------------------*14730000
144700 3310-EDIT-RANGE.                                                 14740000
144800                                                                  14750000
144900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14760000
145000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14770000
145100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14780000
145200                                   TO ASC-SELECTED-SW             14790000
145300                                        (ASC-BLK-SUB ASC-ITEM-SUB)14800000
145400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14810000
145500         ELSE                                                     14820000
145600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14830000
145700                 CONTINUE                                         14840000
145800             ELSE                                                 14850000
145900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14860000
146000                 MOVE PC-TSYMSG-00054                             14870000
146100                                   TO DP020-MSG-NUMBER            14880000
146200                 SET DP020-MSG-FATAL                              14890000
146300                                   TO TRUE                        14900000
146400                 MOVE -1           TO MR-SELECTL (PV-SUB)         14910000
146500                 SET DP030-SET-CURSOR-APPL-1                      14920000
146600                                   TO TRUE                        14930000
146700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14940000
146800                 MOVE DP015-UNDERLINE                             14950000
146900                                   TO MR-SELECTH (PV-SUB)         14960000
147000                 SET PS-ERROR      TO TRUE                        14970000
147100             END-IF                                               14980000
147200         END-IF                                                   14990000
147300     ELSE                                                         15000000
147400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15010000
147500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15020000
147600                                   TO ASC-SELECTED-SW             15030000
147700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15040000
147800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15050000
147900         ELSE                                                     15060000
148000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15070000
148100                 CONTINUE                                         15080000
148200             ELSE                                                 15090000
148300*                -- ONLY ONE END-OF-RANGE ALLOWED --              15100000
148400                 MOVE PC-TSYMSG-00055                             15110000
148500                                   TO DP020-MSG-NUMBER            15120000
148600                 SET DP020-MSG-FATAL                              15130000
148700                                   TO TRUE                        15140000
148800                 MOVE -1           TO MR-SELECTL (PV-SUB)         15150000
148900                 SET DP030-SET-CURSOR-APPL-1                      15160000
149000                                   TO TRUE                        15170000
149100                 SET PS-ERROR      TO TRUE                        15180000
149200             END-IF                                               15190000
149300         END-IF                                                   15200000
149400     END-IF.                                                      15210000
149500                                                                  15220000
149600*----------------------------------------------------------------*15230000
149700*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *15240000
149800*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *15250000
149900*----------------------------------------------------------------*15260000
150000 3400-CHECK-RANGE-SEQUENCE.                                       15270000
150100                                                                  15280000
150200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15290000
150300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15300000
150400       AND  ASC-START-OF-SELECTED-RANGE >                         15310000
150500                                         ASC-END-OF-SELECTED-RANGE15320000
150600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15330000
150700         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            15340000
150800         SET DP020-MSG-FATAL       TO TRUE                        15350000
150900         SET PS-ERROR              TO TRUE                        15360000
151000         PERFORM 3410-POSITION-AT-ERROR                           15370000
151100     END-IF.                                                      15380000
151200                                                                  15390000
151300*----------------------------------------------------------------*15400000
151400*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *15410000
151500*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *15420000
151600*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *15430000
151700*----------------------------------------------------------------*15440000
151800 3410-POSITION-AT-ERROR.                                          15450000
151900                                                                  15460000
152000     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       15470000
152100                                                                  15480000
152200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15490000
152300                    - PV-TOP-ITEM + 1.                            15500000
152400                                                                  15510000
152500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15520000
152600         CONTINUE                                                 15530000
152700     ELSE                                                         15540000
152800         MOVE -1                   TO MR-SELECTL (PV-SUB)         15550000
152900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15560000
153000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15570000
153100     END-IF.                                                      15580000
153200                                                                  15590000
153300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15600000
153400                    - PV-TOP-ITEM + 1.                            15610000
153500                                                                  15620000
153600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15630000
153700         CONTINUE                                                 15640000
153800     ELSE                                                         15650000
153900         MOVE -1                   TO MR-SELECTL (PV-SUB)         15660000
154000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15670000
154100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15680000
154200     END-IF.                                                      15690000
154300                                                                  15700000
154400 EJECT                                                            15710000
154500*----------------------------------------------------------------*15720000
154600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15730000
154700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15740000
154800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15750000
154900*----------------------------------------------------------------*15760000
155000                                                                  15770000
155100 3500-MARK-RANGE-AS-SELECTED.                                     15780000
155200                                                                  15790000
155300     MOVE +1                       TO ASC-BLK-SUB.                15800000
155400                                                                  15810000
155500     PERFORM 3510-MARK-SELECTED-INDS                              15820000
155600         VARYING ASC-ITEM-SUB                                     15830000
155700         FROM 1 BY 1                                              15840000
155800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15850000
155900                                                                  15860000
156000     ADD +1                        TO ASC-BLK-SUB.                15870000
156100                                                                  15880000
156200     PERFORM 3510-MARK-SELECTED-INDS                              15890000
156300         VARYING ASC-ITEM-SUB                                     15900000
156400         FROM 1 BY 1                                              15910000
156500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15920000
156600                                                                  15930000
156700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15940000
156800                                   TO PV-LIST-ITEM-NUMBER.        15950000
156900                                                                  15960000
157000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15970000
157100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15980000
157200               PC-ITEMS-PER-PANEL).                               15990000
157300                                                                  16000000
157400     MOVE ASC-START-OF-SELECTED-RANGE                             16010000
157500                                   TO PV-START-OF-SELECTED-RANGE. 16020000
157600                                                                  16030000
157700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16040000
157800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16050000
157900               PC-ITEMS-PER-PANEL).                               16060000
158000                                                                  16070000
158100     MOVE ASC-END-OF-SELECTED-RANGE                               16080000
158200                                   TO PV-END-OF-SELECTED-RANGE.   16090000
158300                                                                  16100000
158400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16110000
158500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16120000
158600               PC-ITEMS-PER-PANEL).                               16130000
158700                                                                  16140000
158800     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16150000
158900         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16160000
159000                                                                  16170000
159100     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16180000
159200        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16190000
159300         MOVE +1                   TO ASC-BLK-SUB                 16200000
159400         PERFORM 5100-WRITE-TEMP-STORAGE                          16210000
159500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16220000
159600             PV-FIRST-BLOCK-IN-ARRAY - 1                          16230000
159700                                                                  16240000
159800         PERFORM                                                  16250000
159900             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16260000
160000                   PV-PREV-BLOCK-IN-ARRAY                         16270000
160100             MOVE PV-FIRST-BLOCK-IN-RANGE                         16280000
160200                                   TO PV-BLOCK-NUMBER             16290000
160300             PERFORM 4410-READ-TEMP-STORAGE                       16300000
160400             PERFORM 3510-MARK-SELECTED-INDS                      16310000
160500                 VARYING ASC-ITEM-SUB                             16320000
160600                 FROM 1 BY 1                                      16330000
160700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16340000
160800             PERFORM 5100-WRITE-TEMP-STORAGE                      16350000
160900             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16360000
161000         END-PERFORM                                              16370000
161100                                                                  16380000
161200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16390000
161300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16400000
161400         PERFORM                                                  16410000
161500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16420000
161600                   PV-LAST-BLOCK-IN-RANGE                         16430000
161700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16440000
161800                                   TO PV-BLOCK-NUMBER             16450000
161900             PERFORM 4410-READ-TEMP-STORAGE                       16460000
162000             PERFORM 3510-MARK-SELECTED-INDS                      16470000
162100                 VARYING ASC-ITEM-SUB                             16480000
162200                 FROM 1 BY 1                                      16490000
162300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16500000
162400             PERFORM 5100-WRITE-TEMP-STORAGE                      16510000
162500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16520000
162600         END-PERFORM                                              16530000
162700                                                                  16540000
162800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16550000
162900                                   TO PV-BLOCK-NUMBER             16560000
163000         PERFORM 4410-READ-TEMP-STORAGE                           16570000
163100     END-IF.                                                      16580000
163200                                                                  16590000
163300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16600000
163400                                      ASC-END-OF-SELECTED-RANGE.  16610000
163500                                                                  16620000
163600 EJECT                                                            16630000
163700*----------------------------------------------------------------*16640000
163800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16650000
163900*----------------------------------------------------------------*16660000
164000                                                                  16670000
164100 3510-MARK-SELECTED-INDS.                                         16680000
164200                                                                  16690000
164300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         16700000
164400         ASC-START-OF-SELECTED-RANGE)                             16710000
164500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         16720000
164600         ASC-START-OF-SELECTED-RANGE)                             16730000
164700                                                                  16740000
164800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     16750000
164900             ASC-END-OF-SELECTED-RANGE)                           16760000
165000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     16770000
165100             ASC-END-OF-SELECTED-RANGE)                           16780000
165200                                                                  16790000
165300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16800000
165400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16810000
165500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16820000
165600                                   TO TRUE                        16830000
165700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16840000
165800                                   TO TRUE                        16850000
165900                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS16860000
166000             END-IF                                               16870000
166100         END-IF                                                   16880000
166200     END-IF.                                                      16890000
166300                                                                  16900000
166400 EJECT                                                            16910000
166500*----------------------------------------------------------------*16920000
166600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16930000
166700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16940000
166800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16950000
166900*    DISPLAY THE PANEL TO USER.                                  *16960000
167000*----------------------------------------------------------------*16970000
167100                                                                  16980000
167200 4000-BUILD-INITIAL-PANEL.                                        16990000
167300                                                                  17000000
167400     INITIALIZE ASC-BLOCK-ENTRIES (1)                             17010000
167500                ASC-BLOCK-ENTRIES (2).                            17020000
167600                                                                  17030000
167700     MOVE +1                       TO ASC-BLK-SUB                 17040000
167800                                      PV-STRING-POINTER-FROM      17050000
167900                                      PV-STRING-POINTER-WHERE.    17060000
168000                                                                  17070000
168100     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       17080000
168200                                                                  17090000
168300     MOVE +0                       TO ASC-ITEM-SUB                17100000
168400                                      ASC-NUMBER-OF-ITEMS-READ    17110000
168500                                      ASC-NUMBER-OF-SELECTED-ITEMS17120000
168600                                      ASC-HIGHEST-BLOCK-WRITTEN   17130000
168700                                      ASC-START-OF-SELECTED-RANGE 17140000
168800                                      ASC-END-OF-SELECTED-RANGE   17150000
168900                                      ASC-ITEM-AT-TOP-OF-PANEL    17160000
169000                                      ASC-ITEMS-DISPLAYED         17170000
169100                                      ASC-UNIT-ORD-TOT.           17180000
169200                                                                  17190000
169300     PERFORM 4030-OPEN-CURSOR.                                    17200000
169400     PERFORM 4300-READ-ITEMS-FROM-DB.                             17210000
169500     PERFORM 4040-CLOSE-CURSOR.                                   17220000
169600                                                                  17230000
169700     MOVE +1                       TO PV-TOP-ITEM.                17240000
169800                                                                  17250000
169900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17260000
170000         SET DP020-MSG-WARNING     TO TRUE                        17270000
170100         MOVE PC-TSYMSG-02044      TO DP020-MSG-NUMBER            17280000
170200         PERFORM 4100-FORMAT-EMPTY-SCREEN                         17290000
170300             VARYING PV-SUB FROM +1 BY +1                         17300000
170400                 UNTIL PV-SUB > PC-ITEMS-PER-PANEL                17310000
170500     ELSE                                                         17320000
170600         MOVE -1                   TO MR-SELECTL (1)              17330000
170700         SET DP030-SET-CURSOR-APPL-1                              17340000
170800                                   TO TRUE                        17350000
170900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17360000
171000     END-IF.                                                      17370000
171100                                                                  17380000
171200 EJECT                                                            17390000
171300*----------------------------------------------------------------*17400000
171400* OPEN THE PO CURSOR                                             *17410000
171500*----------------------------------------------------------------*17420000
171600                                                                  17430000
171700 4030-OPEN-CURSOR.                                                17440000
171800                                                                  17450000
171900     PERFORM                                                      17460000
172000         WITH TEST AFTER                                          17470000
172100         VARYING PV-RETRY-COUNTER                                 17480000
172200         FROM 1 BY 1                                              17490000
172300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17500000
172400            OR (SQLCODE = +0))                                    17510000
172500                                                                  17520000
172600         EXEC SQL                                                 17530000
172700             OPEN PO-CSR                                          17540000
172800         END-EXEC                                                 17550000
172900                                                                  17560000
173000         EVALUATE TRUE                                            17570000
173100             WHEN SQLCODE = +0                                    17580000
173200                  CONTINUE                                        17590000
173300             WHEN SQLCODE = -904                                  17600000
173400             WHEN SQLCODE = -913                                  17610000
173500                  CONTINUE                                        17620000
173600             WHEN SQLWARN0 NOT = SPACE                            17630000
173700             WHEN SQLCODE  NOT = +0                               17640000
173800                  MOVE '4030-OPEN-CURSOR'                         17650000
173900                                   TO DP013-PARAGRAPH             17660000
174000                  MOVE 'OPEN PO-CSR CURSOR'                       17670000
174100                                   TO DP013-MESSAGE-TEXT (1)      17680000
174200                  MOVE SQLCA       TO DP013-SQLCA                 17690000
174300                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    17700000
174400                  MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (2)    17710000
174500                  SET DP013-DB2-ABEND                             17720000
174600                                   TO TRUE                        17730000
174700                  PERFORM DP013-0000-PROCESS-ABEND                17740000
174800         END-EVALUATE                                             17750000
174900     END-PERFORM.                                                 17760000
175000                                                                  17770000
175100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17780000
175200         MOVE '4030-OPEN-CURSOR'   TO DP013-PARAGRAPH             17790000
175300         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              17800000
175400                                   TO DP013-MESSAGE-TEXT (1)      17810000
175500         MOVE SQLCA                TO DP013-SQLCA                 17820000
175600         MOVE 'TPURCHS'            TO DP013-DB2-TABLE-NAME (1)    17830000
175700         MOVE 'TPLNSHP'            TO DP013-DB2-TABLE-NAME (2)    17840000
175800         SET DP013-DB2-ABEND       TO TRUE                        17850000
175900         PERFORM DP013-0000-PROCESS-ABEND                         17860000
176000     END-IF.                                                      17870000
176100                                                                  17880000
176200 EJECT                                                            17890000
176300*----------------------------------------------------------------*17900000
176400* CLOSE THE PO CURSOR                                            *17910000
176500*----------------------------------------------------------------*17920000
176600                                                                  17930000
176700 4040-CLOSE-CURSOR.                                               17940000
176800                                                                  17950000
176900     EXEC SQL                                                     17960000
177000         CLOSE PO-CSR                                             17970000
177100     END-EXEC.                                                    17980000
177200                                                                  17990000
177300     EVALUATE TRUE                                                18000000
177400         WHEN SQLCODE = +0                                        18010000
177500              CONTINUE                                            18020000
177600         WHEN SQLWARN0 NOT = SPACE                                18030000
177700         WHEN SQLCODE  NOT = +0                                   18040000
177800              MOVE '4040-CLOSE-CURSOR'                            18050000
177900                                   TO DP013-PARAGRAPH             18060000
178000              MOVE 'CLOSE PO-CSR CURSOR'                          18070000
178100                                   TO DP013-MESSAGE-TEXT (1)      18080000
178200              MOVE SQLCA           TO DP013-SQLCA                 18090000
178300              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    18100000
178400              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (2)    18110000
178500              SET DP013-DB2-ABEND  TO TRUE                        18120000
178600              PERFORM DP013-0000-PROCESS-ABEND                    18130000
178700     END-EVALUATE.                                                18140000
178800                                                                  18150000
178900 EJECT                                                            18160000
179000                                                                  18170000
179100*----------------------------------------------------------------*18180000
179200* FORMAT EMPTY SCREEN WHEN NO DATA EXIST FOR PO SET.             *18190000
179300*----------------------------------------------------------------*18200000
179400 4100-FORMAT-EMPTY-SCREEN.                                        18210000
179500                                                                  18220000
179600     MOVE DP015-PRO-DRK-OFF      TO MR-SELECTA (PV-SUB).          18230000
179700     MOVE SPACES                 TO MR-SELECT  (PV-SUB)           18240000
179800                                    MR-PO-NBR-X (PV-SUB)          18250000
179900                                    MR-DEPT-NBR (PV-SUB)          18260000
180000                                    MR-VENDOR-NAME (PV-SUB)       18270000
180100                                    MR-STATUS (PV-SUB)            18280000
180200                                    MR-OTB (PV-SUB)               18290000
180300                                    MR-SHIP-DATE (PV-SUB)         18300000
180400                                    MR-CANCEL-DATE (PV-SUB)       18310000
180500                                    MR-UNITS-ORDERED-X (PV-SUB).  18320000
180600                                                                  18330000
180700 EJECT                                                            18340000
180800*----------------------------------------------------------------*18350000
180900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18360000
181000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18370000
181100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18380000
181200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18390000
181300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18400000
181400*                                                                *18410000
181500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18420000
181600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18430000
181700*    UPON INITIALIZATION.                                        *18440000
181800*----------------------------------------------------------------*18450000
181900                                                                  18460000
182000 4300-READ-ITEMS-FROM-DB.                                         18470000
182100                                                                  18480000
182200     PERFORM                                                      18490000
182300         VARYING PV-READ-COUNT                                    18500000
182400         FROM 1 BY 1                                              18510000
182500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18520000
182600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18530000
182700                                                                  18540000
182800         PERFORM 4310-FETCH                                       18550000
182900                                                                  18560000
183000         IF  ASC-ITEMS-LEFT-ON-DB                                 18570000
183100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18580000
183200                 ADD +1            TO ASC-ITEM-SUB                18590000
183300             ELSE                                                 18600000
183400                 ADD +1            TO ASC-BLK-SUB                 18610000
183500                 MOVE +1           TO ASC-ITEM-SUB                18620000
183600                                                                  18630000
183700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18640000
183800                     MOVE +1       TO ASC-BLK-SUB                 18650000
183900                     SET ASC-BLOCK-MODIFIED (1)                   18660000
184000                                   TO TRUE                        18670000
184100                     PERFORM 5100-WRITE-TEMP-STORAGE              18680000
184200                     MOVE ASC-BLOCK-ENTRIES                       18690000
184300                               (PC-MAX-BLOCKS-IN-ARRAY)           18700000
184400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18710000
184500                     ADD +1        TO ASC-BLK-SUB                 18720000
184600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18730000
184700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18740000
184800                                   TO TRUE                        18750000
184900                 END-IF                                           18760000
185000             END-IF                                               18770000
185100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18780000
185200             MOVE ASC-NUMBER-OF-ITEMS-READ                        18790000
185300                                   TO ASC-LIST-ITEM-NUMBER        18800000
185400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18810000
185500             MOVE PURCHS-PO-NBR    TO ASC-PO-NBR                  18820000
185600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18830000
185700             PERFORM 4320-GET-PO-INFO                             18840000
185800             IF ENTNME-ENT-ID NOT = PURCHS-ENT-ID                 18850000
185900                PERFORM 4330-GET-VENDOR-SHORT-NAME                18860000
186000                IF  SQLCODE = +100                                18870000
186100                    PERFORM 4335-GET-VENDOR-PRIMARY-NAME          18880000
186200                END-IF                                            18890000
186300             END-IF                                               18900000
186400             PERFORM 4340-GET-SHIPMENT-INFO                       18910000
186500                                                                  18920000
186600             MOVE PURCHS-DEPT-NBR  TO ASC-DEPT-NBR                18930000
186700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18940000
186800             MOVE ENTNME-ENT-NAME-DESC                            18950000
186900                                   TO ASC-VENDOR-NAME             18960000
187000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18970000
187100             MOVE PURCHS-STATUS-CDE                               18980000
187200                                   TO ASC-STATUS                  18990000
187300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19000000
187400             STRING PURCHS-OTB-PER-NBR(5:2) DELIMITED BY SIZE     19010000
187500                    PURCHS-OTB-PER-NBR(3:2) DELIMITED BY SIZE     19020000
187600                                 INTO ASC-OTB                     19030000
187700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19040000
187800             MOVE PV-DONT-SHIP-BEF-DTE                            19050000
187900                                   TO ASC-SHIP-DATE               19060000
188000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19070000
188100             MOVE PV-CAN-IFNOT-SHIP-DTE                           19080000
188200                                   TO ASC-CANCEL-DATE             19090000
188300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19100000
188400             MOVE PURCHS-TOT-UNT-QTY                              19110000
188500                                   TO ASC-TOT-UNIT-ORDERED        19120000
188600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19130000
188700                                                                  19140000
188800                                                                  19150000
188900                                                                  19160000
189000             COMPUTE ASC-UNIT-ORD-TOT = ASC-UNIT-ORD-TOT +        19170000
189100                   ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)19180000
189200                                                                  19190000
189300         END-IF                                                   19200000
189400     END-PERFORM.                                                 19210000
189500                                                                  19220000
189600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19230000
189700         MOVE +1                   TO ASC-BLK-SUB                 19240000
189800         PERFORM 5100-WRITE-TEMP-STORAGE                          19250000
189900         ADD +1                    TO ASC-BLK-SUB                 19260000
190000         PERFORM 5100-WRITE-TEMP-STORAGE                          19270000
190100                                                                  19280000
190200         MOVE 1                    TO ASC-BLK-SUB                 19290000
190300                                      PV-BLOCK-NUMBER             19300000
190400         PERFORM 4410-READ-TEMP-STORAGE                           19310000
190500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19320000
190600             MOVE 2                TO ASC-BLK-SUB                 19330000
190700                                      PV-BLOCK-NUMBER             19340000
190800             PERFORM 4410-READ-TEMP-STORAGE                       19350000
190900         END-IF                                                   19360000
191000     END-IF.                                                      19370000
191100                                                                  19380000
191200 EJECT                                                            19390000
191300*----------------------------------------------------------------*19400000
191400*    FETCH A VENDOR ROW                                          *19410000
191500*----------------------------------------------------------------*19420000
191600                                                                  19430000
191700 4310-FETCH.                                                      19440000
191800                                                                  19450000
191900     EXEC SQL                                                     19460000
192000         FETCH PO-CSR                                             19470000
192100          INTO :PURCHS-PO-NBR,                                    19480000
192200               :PURCHS-OTB-PER-NBR,                               19490000
192300               :PURCHS-DEPT-NBR,                                  19500000
192400               :PURCHS-ENT-ID,                                    19510000
192500               :PLNSHP-DONT-SHIP-BEF-DTE                          19520000
192600     END-EXEC.                                                    19530000
192700                                                                  19540000
192800     EVALUATE TRUE                                                19550000
192900         WHEN SQLCODE = +0                                        19560000
193000              CONTINUE                                            19570000
193100         WHEN SQLCODE = +100                                      19580000
193200              SET ASC-NO-ITEMS-LEFT-ON-DB                         19590000
193300                                   TO TRUE                        19600000
193400         WHEN SQLWARN0 NOT = SPACE                                19610000
193500         WHEN SQLCODE < +0                                        19620000
193600         WHEN SQLCODE > +0                                        19630000
193700              MOVE '4310-FETCH-CURSOR'                            19640000
193800                                   TO DP013-PARAGRAPH             19650000
193900              MOVE 'FETCH PO CURSOR'                              19660000
194000                                   TO DP013-MESSAGE-TEXT (1)      19670000
194100              MOVE SQLCA           TO DP013-SQLCA                 19680000
194200              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    19690000
194300              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (2)    19700000
194400              SET DP013-DB2-ABEND  TO TRUE                        19710000
194500              PERFORM DP013-0000-PROCESS-ABEND                    19720000
194600     END-EVALUATE.                                                19730000
194700                                                                  19740000
194800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19750000
194900         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             19760000
195000         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             19770000
195100                                   TO DP013-MESSAGE-TEXT (1)      19780000
195200         MOVE SQLCA                TO DP013-SQLCA                 19790000
195300         SET DP013-DB2-ABEND                                      19800000
195400             DP013-XCTL-DISPLAY-RESTART                           19810000
195500                                   TO TRUE                        19820000
195600         PERFORM DP013-0000-PROCESS-ABEND                         19830000
195700     END-IF.                                                      19840000
195800                                                                  19850000
195900 EJECT                                                            19860000
196000*----------------------------------------------------------------*19870000
196100* GET PO INFORMATION                                             *19880000
196200*----------------------------------------------------------------*19890000
196300                                                                  19900000
196400 4320-GET-PO-INFO.                                                19910000
196500                                                                  19920000
196600     EXEC SQL                                                     19930000
196700         SELECT DEPT_NBR                                          19940000
196800               ,OTB_PER_NBR                                       19950000
196900               ,STATUS_CDE                                        19960000
197000               ,TOT_VAL_RTL_AMT                                   19970000
197100               ,TOT_UNT_QTY                                       19980000
197200               ,ENT_ID                                            19990000
197300          INTO  :PURCHS-DEPT-NBR                                  20000000
197400               ,:PURCHS-OTB-PER-NBR                               20010000
197500               ,:PURCHS-STATUS-CDE                                20020000
197600               ,:PURCHS-TOT-VAL-RTL-AMT                           20030000
197700               ,:PURCHS-TOT-UNT-QTY                               20040000
197800               ,:PURCHS-ENT-ID                                    20050000
197900          FROM  TPURCHS                                           20060000
198000          WHERE PO_NBR         = :PURCHS-PO-NBR                   20070000
198100            AND VER_STATUS_CDE = 'A'                              20080000
198200            AND PO_CATEG_CDE   = 'MR'                             20090000
198300     END-EXEC.                                                    20100000
198400                                                                  20110000
198500     EVALUATE TRUE                                                20120000
198600         WHEN SQLCODE = +0                                        20130000
198700         WHEN SQLCODE = -904                                      20140000
198800         WHEN SQLCODE = -913                                      20150000
198900             CONTINUE                                             20160000
199000         WHEN SQLWARN0 NOT = SPACE                                20170000
199100         WHEN SQLCODE < +0                                        20180000
199200         WHEN SQLCODE > +0                                        20190000
199300             MOVE '4320-GET-PO-INFO'                              20200000
199400                                 TO DP013-PARAGRAPH               20210000
199500             MOVE 'SELECT ON PURCHASE HEADER TABLE'               20220000
199600                                 TO DP013-MESSAGE-TEXT (1)        20230000
199700             MOVE SQLCA          TO DP013-SQLCA                   20240000
199800             MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)      20250000
199900                 SET DP013-DB2-ABEND                              20260000
200000                     DP013-XCTL-DISPLAY-RESTART                   20270000
200100                                 TO TRUE                          20280000
200200             PERFORM DP013-0000-PROCESS-ABEND                     20290000
200300     END-EVALUATE.                                                20300000
200400                                                                  20310000
200500 EJECT                                                            20320000
200600*----------------------------------------------------------------*20330000
200700* GET THE VENDOR SHORT NAME                                      *20340000
200800*----------------------------------------------------------------*20350000
200900                                                                  20360000
201000 4330-GET-VENDOR-SHORT-NAME.                                      20370000
201100                                                                  20380000
201200     EXEC SQL                                                     20390000
201300         SELECT ENT_NAME_DESC                                     20400000
201400              , ENT_ID                                            20410000
201500          INTO  :ENTNME-ENT-NAME-DESC                             20420000
201600              , :ENTNME-ENT-ID                                    20430000
201700          FROM  TENTNME                                           20440000
201800          WHERE ENT_ID   = :PURCHS-ENT-ID                         20450000
201900            AND TYPE_CDE = '04'                                   20460000
202000     END-EXEC.                                                    20470000
202100                                                                  20480000
202200     EVALUATE TRUE                                                20490000
202300         WHEN SQLCODE = +0                                        20500000
202400         WHEN SQLCODE = +100                                      20510000
202500         WHEN SQLCODE = -904                                      20520000
202600         WHEN SQLCODE = -913                                      20530000
202700             CONTINUE                                             20540000
202800         WHEN SQLWARN0 NOT = SPACE                                20550000
202900         WHEN SQLCODE < +0                                        20560000
203000         WHEN SQLCODE > +0                                        20570000
203100             MOVE '4330-GET-VENDOR-SHORT-NAME'                    20580000
203200                                 TO DP013-PARAGRAPH               20590000
203300             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               20600000
203400                                 TO DP013-MESSAGE-TEXT (1)        20610000
203500             MOVE SQLCA          TO DP013-SQLCA                   20620000
203600             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      20630000
203700                 SET DP013-DB2-ABEND                              20640000
203800                     DP013-XCTL-DISPLAY-RESTART                   20650000
203900                                 TO TRUE                          20660000
204000             PERFORM DP013-0000-PROCESS-ABEND                     20670000
204100     END-EVALUATE.                                                20680000
204200                                                                  20690000
204300 EJECT                                                            20700000
204400*----------------------------------------------------------------*20710000
204500* GET THE VENDOR PRIMARY NAME                                    *20720000
204600*----------------------------------------------------------------*20730000
204700                                                                  20740000
204800 4335-GET-VENDOR-PRIMARY-NAME.                                    20750000
204900                                                                  20760000
205000     EXEC SQL                                                     20770000
205100         SELECT ENT_NAME_DESC                                     20780000
205200              , ENT_ID                                            20790000
205300          INTO  :ENTNME-ENT-NAME-DESC                             20800000
205400              , :ENTNME-ENT-ID                                    20810000
205500          FROM  TENTNME                                           20820000
205600          WHERE ENT_ID   = :PURCHS-ENT-ID                         20830000
205700            AND TYPE_CDE = '01'                                   20840000
205800     END-EXEC.                                                    20850000
205900                                                                  20860000
206000     EVALUATE TRUE                                                20870000
206100         WHEN SQLCODE = +0                                        20880000
206200         WHEN SQLCODE = -904                                      20890000
206300         WHEN SQLCODE = -913                                      20900000
206400             CONTINUE                                             20910000
206500         WHEN SQLWARN0 NOT = SPACE                                20920000
206600         WHEN SQLCODE < +0                                        20930000
206700         WHEN SQLCODE > +0                                        20940000
206800             MOVE '4335-GET-VENDOR-PRIMARY-NAME'                  20950000
206900                                 TO DP013-PARAGRAPH               20960000
207000             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               20970000
207100                                 TO DP013-MESSAGE-TEXT (1)        20980000
207200             MOVE SQLCA          TO DP013-SQLCA                   20990000
207300             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      21000000
207400                 SET DP013-DB2-ABEND                              21010000
207500                     DP013-XCTL-DISPLAY-RESTART                   21020000
207600                                 TO TRUE                          21030000
207700             PERFORM DP013-0000-PROCESS-ABEND                     21040000
207800     END-EVALUATE.                                                21050000
207900                                                                  21060000
208000 EJECT                                                            21070000
208100*----------------------------------------------------------------*21080000
208200* GET PLANNED SHIPMENT INFO                                      *21090000
208300*----------------------------------------------------------------*21100000
208400                                                                  21110000
208500 4340-GET-SHIPMENT-INFO.                                          21120000
208600                                                                  21130000
208700     EXEC SQL                                                     21140000
208800         SELECT DONT_SHIP_BEF_DTE                                 21150000
208900               ,CAN_IFNOT_SHIP_DTE                                21160000
209000          INTO  :PLNSHP-DONT-SHIP-BEF-DTE                         21170000
209100               ,:PLNSHP-CAN-IFNOT-SHIP-DTE                        21180000
209200          FROM  TPLNSHP                                           21190000
209300          WHERE PO_NBR          = :PURCHS-PO-NBR                  21200000
209400            AND VER_STATUS_CDE  = 'A'                             21210000
209500     END-EXEC.                                                    21220000
209600                                                                  21230000
209700     EVALUATE TRUE                                                21240000
209800         WHEN SQLCODE = +0                                        21250000
209900              IF  PLNSHP-DONT-SHIP-BEF-DTE > SPACES               21260000
210000              AND PLNSHP-DONT-SHIP-BEF-DTE NOT = '0001-01-01'     21270000
210100                  MOVE PLNSHP-DONT-SHIP-BEF-DTE                   21280000
210200                                       TO PV-DB2-DATE             21290000
210300                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      21300000
210400                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      21310000
210500                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      21320000
210600                  MOVE PV-DISPLAY-DATE TO PV-DONT-SHIP-BEF-DTE    21330000
210700              ELSE                                                21340000
210800                  MOVE SPACES          TO PV-DONT-SHIP-BEF-DTE    21350000
210900              END-IF                                              21360000
211000              IF  PLNSHP-CAN-IFNOT-SHIP-DTE > SPACES              21370000
211100              AND PLNSHP-CAN-IFNOT-SHIP-DTE NOT = '0001-01-01'    21380000
211200                  MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                  21390000
211300                                       TO PV-DB2-DATE             21400000
211400                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      21410000
211500                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      21420000
211600                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      21430000
211700                  MOVE PV-DISPLAY-DATE TO PV-CAN-IFNOT-SHIP-DTE   21440000
211800              ELSE                                                21450000
211900                  MOVE SPACES          TO PV-CAN-IFNOT-SHIP-DTE   21460000
212000              END-IF                                              21470000
212100                                                                  21480000
212200         WHEN SQLCODE = -904                                      21490000
212300         WHEN SQLCODE = -913                                      21500000
212400             CONTINUE                                             21510000
212500         WHEN SQLWARN0 NOT = SPACE                                21520000
212600         WHEN SQLCODE < +0                                        21530000
212700         WHEN SQLCODE > +0                                        21540000
212800             MOVE '4340-GET-SHIPMENT-INFO'                        21550000
212900                                 TO DP013-PARAGRAPH               21560000
213000             MOVE 'SELECT ON PLANNED SHIPMENTS'                   21570000
213100                                 TO DP013-MESSAGE-TEXT (1)        21580000
213200             MOVE SQLCA          TO DP013-SQLCA                   21590000
213300             MOVE 'TPLNSHP'      TO DP013-DB2-TABLE-NAME (1)      21600000
213400                 SET DP013-DB2-ABEND                              21610000
213500                     DP013-XCTL-DISPLAY-RESTART                   21620000
213600                                 TO TRUE                          21630000
213700             PERFORM DP013-0000-PROCESS-ABEND                     21640000
213800     END-EVALUATE.                                                21650000
213900                                                                  21660000
214000 EJECT                                                            21670000
214100*----------------------------------------------------------------*21680000
214200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21690000
214300*----------------------------------------------------------------*21700000
214400                                                                  21710000
214500 4400-MOVE-COMMAREA-TO-SCREEN.                                    21720000
214600                                                                  21730000
214700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21740000
214800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21750000
214900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21760000
215000             MOVE +1               TO ASC-BLK-SUB                 21770000
215100             PERFORM 5100-WRITE-TEMP-STORAGE                      21780000
215200             ADD +1                TO ASC-BLK-SUB                 21790000
215300             PERFORM 5100-WRITE-TEMP-STORAGE                      21800000
215400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21810000
215500                 GIVING PV-BLOCK-NUMBER                           21820000
215600                 REMAINDER PV-REMAINDER                           21830000
215700             IF  PV-REMAINDER > ZERO                              21840000
215800                 ADD +1            TO PV-BLOCK-NUMBER             21850000
215900             END-IF                                               21860000
216000             MOVE +1               TO ASC-BLK-SUB                 21870000
216100             PERFORM 4410-READ-TEMP-STORAGE                       21880000
216200             ADD +1                TO ASC-BLK-SUB                 21890000
216300                                      PV-BLOCK-NUMBER             21900000
216400             PERFORM 4410-READ-TEMP-STORAGE                       21910000
216500     END-IF.                                                      21920000
216600                                                                  21930000
216700     MOVE +1                       TO ASC-BLK-SUB.                21940000
216800                                                                  21950000
216900     COMPUTE ASC-ITEM-SUB =                                       21960000
217000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21970000
217100         + PC-ITEMS-PER-PANEL).                                   21980000
217200                                                                  21990000
217300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22000000
217400         ADD +1                    TO ASC-BLK-SUB                 22010000
217500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22020000
217600     END-IF.                                                      22030000
217700                                                                  22040000
217800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22050000
217900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22060000
218000                                                                  22070000
218100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22080000
218200     PERFORM 4420-FORMAT-LIST-LINES                               22090000
218300         VARYING PV-SUB                                           22100000
218400         FROM PC-ITEMS-PER-PANEL BY -1                            22110000
218500         UNTIL PV-SUB < +1.                                       22120000
218600                                                                  22130000
218700     COMPUTE ASC-ITEMS-DISPLAYED =                                22140000
218800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22150000
218900                                                                  22160000
219000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22170000
219100                                      ASTRTITO.                   22180000
219200                                                                  22190000
219300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22200000
219400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22210000
219500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22220000
219600                                   TO ASELITO.                    22230000
219700                                                                  22240000
219800     MOVE ASC-UNIT-ORD-TOT         TO MR-UNITS-ORDERED-TOT        22250000
219900                                                                  22260000
220000     IF  DP020-MSG-NUMBER-X = SPACE                               22270000
220100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22280000
220200*            --- MORE ITEMS TO DISPLAY ----                       22290000
220300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22300000
220400             SET DP020-MSG-INFORMATIONAL                          22310000
220500                                   TO TRUE                        22320000
220600         END-IF                                                   22330000
220700     END-IF.                                                      22340000
220800                                                                  22350000
220900*----------------------------------------------------------------*22360000
221000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22370000
221100*----------------------------------------------------------------*22380000
221200                                                                  22390000
221300 4410-READ-TEMP-STORAGE.                                          22400000
221400                                                                  22410000
221500     EXEC CICS                                                    22420000
221600         READQ TS                                                 22430000
221700             QUEUE (ASC-LIST-QUEUE-NAME)                          22440000
221800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22450000
221900             ITEM  (PV-BLOCK-NUMBER)                              22460000
222000             RESP  (PV-CICS-RESP)                                 22470000
222100     END-EXEC.                                                    22480000
222200                                                                  22490000
222300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       22500000
222400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     22510000
222500         CONTINUE                                                 22520000
222600     ELSE                                                         22530000
222700         SET DP013-CICS-ABEND      TO TRUE                        22540000
222800         SET DP013-NO-ROLLBACK     TO TRUE                        22550000
222900         MOVE '4410-READ-TEMP-STORAGE'                            22560000
223000                                   TO DP013-PARAGRAPH             22570000
223100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22580000
223200                                   TO DP013-MESSAGE-TEXT(1)       22590000
223300         PERFORM DP013-0000-PROCESS-ABEND                         22600000
223400     END-IF.                                                      22610000
223500                                                                  22620000
223600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      22630000
223700                                   TO TRUE.                       22640000
223800                                                                  22650000
223900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22660000
224000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22670000
224100     END-IF.                                                      22680000
224200 EJECT                                                            22690000
224300*----------------------------------------------------------------*22700000
224400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22710000
224500*----------------------------------------------------------------*22720000
224600                                                                  22730000
224700 4420-FORMAT-LIST-LINES.                                          22740000
224800                                                                  22750000
224900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22760000
225000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22770000
225100         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         22780000
225200         MOVE SPACES               TO MR-SELECT  (PV-SUB)         22790000
225300                                      MR-PO-NBR-X (PV-SUB)        22800000
225400                                      MR-DEPT-NBR (PV-SUB)        22810000
225500                                      MR-VENDOR-NAME (PV-SUB)     22820000
225600                                      MR-STATUS (PV-SUB)          22830000
225700                                      MR-OTB (PV-SUB)             22840000
225800                                      MR-SHIP-DATE (PV-SUB)       22850000
225900                                      MR-CANCEL-DATE (PV-SUB)     22860000
226000                                      MR-UNITS-ORDERED-X (PV-SUB) 22870000
226100     ELSE                                                         22880000
226200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22890000
226300                                                   > SPACE        22900000
226400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22910000
226500                                   TO MR-SELECT (PV-SUB)          22920000
226600         ELSE                                                     22930000
226700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22940000
226800                                   TO MR-SELECT (PV-SUB)          22950000
226900         END-IF                                                   22960000
227000                                                                  22970000
227100         IF  DP030-SET-CURSOR-TRAILER                             22980000
227200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22990000
227300                 > SPACE)                                         23000000
227400               OR (PV-SUB = 1))                                   23010000
227500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23020000
227600                MOVE -1            TO MR-SELECTL (PV-SUB)         23030000
227700             END-IF                                               23040000
227800         END-IF                                                   23050000
227900                                                                  23060000
228000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23070000
228100             MOVE DP015-UNP-ALP-NOR-OFF                           23080000
228200                                      TO MR-SELECTA (PV-SUB)      23090000
228300             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           23100000
228400                                   TO MR-PO-NBR (PV-SUB)          23110000
228500             MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         23120000
228600                                   TO MR-DEPT-NBR (PV-SUB)        23130000
228700             MOVE ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)      23140000
228800                                   TO MR-VENDOR-NAME (PV-SUB)     23150000
228900             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           23160000
229000                                   TO MR-STATUS (PV-SUB)          23170000
229100             MOVE ASC-OTB (ASC-BLK-SUB ASC-ITEM-SUB)              23180000
229200                                   TO MR-OTB (PV-SUB)             23190000
229300             MOVE ASC-SHIP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)        23200000
229400                                   TO MR-SHIP-DATE (PV-SUB)       23210000
229500             MOVE ASC-CANCEL-DATE (ASC-BLK-SUB ASC-ITEM-SUB)      23220000
229600                                   TO MR-CANCEL-DATE (PV-SUB)     23230000
229700         END-IF                                                   23240000
229800                                                                  23250000
229900         MOVE ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)     23260000
230000                                   TO MR-UNITS-ORDERED (PV-SUB)   23270000
230100     END-IF.                                                      23280000
230200                                                                  23290000
230300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               23300000
230400                                                                  23310000
230500     IF  ASC-ITEM-SUB < + 1                                       23320000
230600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                23330000
230700         MOVE +1                   TO ASC-BLK-SUB                 23340000
230800     END-IF.                                                      23350000
230900                                                                  23360000
231000                                                                  23370000
231100*----------------------------------------------------------------*23380000
231200*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *23390000
231300*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *23400000
231400*  ISSUE A WARNING.                                              *23410000
231500*----------------------------------------------------------------*23420000
231600 4430-CHECK-FOR-BEGIN-AND-END.                                    23430000
231700                                                                  23440000
231800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23450000
231900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23460000
232000*            -- NO END-OF-RANGE SPECFIED ---                      23470000
232100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23480000
232200             SET DP020-MSG-WARNING TO TRUE                        23490000
232300             PERFORM 4431-POSITION-AT-WARNING                     23500000
232400         END-IF                                                   23510000
232500     ELSE                                                         23520000
232600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23530000
232700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23540000
232800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23550000
232900             SET DP020-MSG-WARNING TO TRUE                        23560000
233000             PERFORM 4431-POSITION-AT-WARNING                     23570000
233100         END-IF                                                   23580000
233200     END-IF.                                                      23590000
233300                                                                  23600000
233400*----------------------------------------------------------------*23610000
233500*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *23620000
233600*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *23630000
233700*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *23640000
233800*  POSITION THE CURSOR THERE.                                    *23650000
233900*----------------------------------------------------------------*23660000
234000 4431-POSITION-AT-WARNING.                                        23670000
234100                                                                  23680000
234200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23690000
234300                    - PV-TOP-ITEM + 1.                            23700000
234400                                                                  23710000
234500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23720000
234600         CONTINUE                                                 23730000
234700     ELSE                                                         23740000
234800         SET DP030-SET-CURSOR-APPL-1                              23750000
234900                                   TO TRUE                        23760000
235000         MOVE -1                   TO MR-SELECTL (PV-SUB)         23770000
235100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23780000
235200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23790000
235300     END-IF.                                                      23800000
235400                                                                  23810000
235500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23820000
235600                    - PV-TOP-ITEM + 1.                            23830000
235700                                                                  23840000
235800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23850000
235900         CONTINUE                                                 23860000
236000     ELSE                                                         23870000
236100         SET DP030-SET-CURSOR-APPL-1                              23880000
236200                                   TO TRUE                        23890000
236300         MOVE -1                   TO MR-SELECTL (PV-SUB)         23900000
236400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23910000
236500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23920000
236600     END-IF.                                                      23930000
236700                                                                  23940000
236800 EJECT                                                            23950000
      *********************************************************         23960000
      *********************************************************         23970000
423900 5000-PREPARE-SEL-QUEUE.                                          23980000
424000                                                                  23990000
424100     MOVE +1                       TO ASC-BLK-SUB.                24000000
424200     PERFORM 5100-WRITE-TEMP-STORAGE.                             24010000
424300     ADD +1                        TO ASC-BLK-SUB.                24020000
424400     PERFORM 5100-WRITE-TEMP-STORAGE.                             24030000
424500                                                                  24040000
424600     MOVE ASC-SEL-QUEUE-NAME       TO PO013-SEL-QUEUE-NAME.       24050000
424700     PERFORM 6010-DELETE-SEL-QUEUE.                               24060000
424800                                                                  24070000
424900     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      24080000
425000         SET ASC-UPDATE-TSQ        TO TRUE                        24090000
425100     END-IF.                                                      24100000
425200                                                                  24110000
425300     SET PO012-IDX                 TO 1.                          24120001
425400     MOVE ZERO                     TO PO013-NUMBER-OF-TS-ITEMS.   24130000
425500     INITIALIZE PO012-SELECTED-ITEM-ARRAY.                        24140001
425600                                                                  24150000
425700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24160000
425800             VARYING PV-ITEM                                      24170000
425900             FROM 1 BY 1                                          24180000
426000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24190000
426100                                                                  24200000
426200     IF  PO012-IDX > 1                                            24210001
426300         PERFORM 5205-WRITE-SEL-QUEUE                             24220000
426400         ADD +1                    TO PO013-NUMBER-OF-TS-ITEMS    24230000
426500     END-IF.                                                      24240000
426600                                                                  24250000
426700/                                                                 24260000
236900*----------------------------------------------------------------*24270000
237000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *24280000
237100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *24290000
237200*----------------------------------------------------------------*24300000
237300                                                                  24310000
237400 5100-WRITE-TEMP-STORAGE.                                         24320000
237500                                                                  24330000
237600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     24340000
237700                                   TO PV-LIST-ITEM-NUMBER.        24350000
237800     COMPUTE PV-BLOCK-NUMBER =                                    24360000
237900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24370000
238000                                                                  24380000
238100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24390000
238200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24400000
238300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24410000
238400             PERFORM 5105-REWRITE-ASC-LISTQ                       24420000
238500         END-IF                                                   24430000
238600     ELSE                                                         24440000
238700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       24450000
238800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            24460000
238900         PERFORM 5110-WRITE-ASC-LISTQ                             24470000
239000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   24480000
239100     END-IF.                                                      24490000
239200                                                                  24500000
239300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      24510000
239400                                   TO TRUE.                       24520000
239500 EJECT                                                            24530000
239600*----------------------------------------------------------------*24540000
239700*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *24550000
239800*  SPECIFIC COMMAREA.                                            *24560000
239900*----------------------------------------------------------------*24570000
240000 5105-REWRITE-ASC-LISTQ.                                          24580000
240100                                                                  24590000
240200     EXEC CICS                                                    24600000
240300         WRITEQ TS                                                24610000
240400             QUEUE (ASC-LIST-QUEUE-NAME)                          24620000
240500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24630000
240600             ITEM  (PV-BLOCK-NUMBER)                              24640000
240700             REWRITE                                              24650000
240800             RESP  (PV-CICS-RESP)                                 24660000
240900     END-EXEC.                                                    24670000
241000                                                                  24680000
241100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24690000
241200         CONTINUE                                                 24700000
241300     ELSE                                                         24710000
241400         SET DP013-CICS-ABEND      TO TRUE                        24720000
241500         SET DP013-NO-ROLLBACK     TO TRUE                        24730000
241600         MOVE '5105-REWRITE-ASC-LISTQ'                            24740000
241700                                   TO DP013-PARAGRAPH             24750000
241800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24760000
241900                                   TO DP013-MESSAGE-TEXT(1)       24770000
242000         PERFORM DP013-0000-PROCESS-ABEND                         24780000
242100     END-IF.                                                      24790000
242200                                                                  24800000
242300 EJECT                                                            24810000
242400*----------------------------------------------------------------*24820000
242500*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *24830000
242600*  SPECIFIC COMMAREA.                                            *24840000
242700*----------------------------------------------------------------*24850000
242800 5110-WRITE-ASC-LISTQ.                                            24860000
242900                                                                  24870000
243000     EXEC CICS                                                    24880000
243100         WRITEQ TS                                                24890000
243200             QUEUE (ASC-LIST-QUEUE-NAME)                          24900000
243300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24910000
243400             ITEM  (PV-BLOCK-NUMBER)                              24920000
243500             RESP  (PV-CICS-RESP)                                 24930000
243600     END-EXEC.                                                    24940000
243700                                                                  24950000
243800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24960000
243900         SET DP013-CICS-ABEND      TO TRUE                        24970000
244000         SET DP013-NO-ROLLBACK     TO TRUE                        24980000
244100         MOVE '5110-WRITE-ASC-LISTQ'                              24990000
244200                                   TO DP013-PARAGRAPH             25000000
244300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25010000
244400                                   TO DP013-MESSAGE-TEXT(1)       25020000
244500         PERFORM DP013-0000-PROCESS-ABEND                         25030000
244600     END-IF.                                                      25040000
244700                                                                  25050000
244800 EJECT                                                            25060000
434900*----------------------------------------------------------------*25070000
435000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25080000
435100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25090000
435200*----------------------------------------------------------------*25100000
435300                                                                  25110000
435400 5200-FILL-SEL-QUEUE-RECORD.                                      25120000
435500                                                                  25130000
435600     PERFORM 6112-READ-LIST-QUEUE.                                25140000
435700                                                                  25150000
435800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25160000
435900         PERFORM                                                  25170000
436000         VARYING LQW-IDX                                          25180000
436100         FROM 1 BY 1                                              25190000
436200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25200000
436300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25210000
436400                                                                  25220000
436500             IF  LQW-SELECT (LQW-IDX)                             25230000
436600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25240000
436700                                   TO PO012-ITEM (PO012-IDX)      25250001
436800                 MOVE LQW-PO-NBR (LQW-IDX)                        25260000
436900                           TO PO012-PO-NBR (PO012-IDX)            25270001
437000                 MOVE SPACE      TO PO012-ACTION-SW (PO012-IDX)   25280001
437100                 SET PO012-IDX UP BY 1                            25290001
437200                 IF  PO012-IDX > PO012-MAX-ITEMS                  25300001
437300                     PERFORM 5205-WRITE-SEL-QUEUE                 25310000
437400                     ADD +1        TO PO013-NUMBER-OF-TS-ITEMS    25320000
437500                     INITIALIZE PO012-SELECTED-ITEM-ARRAY         25330001
437600                     SET PO012-IDX TO 1                           25340001
437700                 END-IF                                           25350000
437800             END-IF                                               25360000
437900         END-PERFORM                                              25370000
438000     END-IF.                                                      25380000
438100                                                                  25390000
438200/                                                                 25400000
438300*----------------------------------------------------------------*25410000
438400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *25420000
438500*----------------------------------------------------------------*25430000
438600                                                                  25440000
438700 5205-WRITE-SEL-QUEUE.                                            25450000
438800                                                                  25460000
438900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25470000
439000                                   TO PO012-SELECTED-ITEMS.       25480001
439100                                                                  25490000
439200     EXEC CICS                                                    25500000
439300          WRITEQ TS                                               25510000
439400              QUEUE (ASC-SEL-QUEUE-NAME)                          25520000
439500              FROM  (PO012-PO-SELECT-RECORD)                      25530001
439600              ITEM  (PV-SEL-QUEUE-ITEM)                           25540000
439700              RESP  (PV-CICS-RESP)                                25550000
439800     END-EXEC.                                                    25560000
439900                                                                  25570000
440000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25580000
440100         CONTINUE                                                 25590000
440200     ELSE                                                         25600000
440300         SET DP013-CICS-ABEND      TO TRUE                        25610000
440400         SET DP013-NO-ROLLBACK     TO TRUE                        25620000
440500         MOVE '5205-WRITE-SEL-QUEUE'                              25630000
440600                                   TO DP013-PARAGRAPH             25640000
440700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25650000
440800                                   TO DP013-MESSAGE-TEXT(1)       25660000
440900         PERFORM DP013-0000-PROCESS-ABEND                         25670000
441000     END-IF.                                                      25680000
441100                                                                  25690000
441200/                                                                 25700000
441300*----------------------------------------------------------------*25710000
441400*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *25720000
441500*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *25730000
441600*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *25740000
441700*  THE USER.                                                     *25750000
441800*----------------------------------------------------------------*25760000
441900 6000-REFRESH-PANEL-FROM-TEMP.                                    25770000
442000                                                                  25780000
442100     IF  ASC-UPDATE-TSQ                                           25790000
442200         SET ASC-NO-TSQ-UPDATE     TO TRUE                        25800000
442300         MOVE ZERO                 TO PV-SAVE-ITEM                25810000
442400                                      PV-SEL-QUEUE-ITEM           25820000
442500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25830000
442600                                   TO PV-HOLD-SELECTED-ITEMS      25840000
442700                                                                  25850000
442800         PERFORM 6100-UPDATE-TSQ                                  25860000
442900             UNTIL PV-ITEMS-PROCESSED >                           25870000
443000                                     ASC-NUMBER-OF-SELECTED-ITEMS 25880000
443100         PERFORM 6010-DELETE-SEL-QUEUE                            25890000
443200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25900000
443300                    ASC-BLOCK-ENTRIES (2)                         25910000
443400     END-IF.                                                      25920000
443500                                                                  25930000
443600/                                                                 25940000
443700*----------------------------------------------------------------*25950000
443800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25960000
443900*----------------------------------------------------------------*25970000
444000 6010-DELETE-SEL-QUEUE.                                           25980000
444100                                                                  25990000
444200     EXEC CICS                                                    26000000
444300         DELETEQ TS                                               26010000
444400             QUEUE (ASC-SEL-QUEUE-NAME)                           26020000
444500             RESP  (PV-CICS-RESP)                                 26030000
444600     END-EXEC.                                                    26040000
444700                                                                  26050000
444800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26060000
444900         (PV-CICS-RESP = DFHRESP(QIDERR)))                        26070000
445000         CONTINUE                                                 26080000
445100     ELSE                                                         26090000
445200         SET DP013-CICS-ABEND      TO TRUE                        26100000
445300         SET DP013-NO-ROLLBACK     TO TRUE                        26110000
445400         MOVE '6010-DELETE-SEL-QUEUE'                             26120000
445500                                   TO DP013-PARAGRAPH             26130000
445600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26140000
445700                                   TO DP013-MESSAGE-TEXT (1)      26150000
445800         PERFORM DP013-0000-PROCESS-ABEND                         26160000
445900     END-IF.                                                      26170000
446000                                                                  26180000
446100/                                                                 26190000
446200*----------------------------------------------------------------*26200000
446300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *26210000
446400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *26220000
446500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *26230000
446600*    THE TEMP QUEUE.                                             *26240000
446700*----------------------------------------------------------------*26250000
446800                                                                  26260000
446900 6100-UPDATE-TSQ.                                                 26270000
447000                                                                  26280000
447100     ADD 1                         TO PV-SEL-QUEUE-ITEM.          26290000
447200     PERFORM 6105-READ-SEL-QUEUE.                                 26300000
447300                                                                  26310000
447400     PERFORM                                                      26320000
447500         VARYING PO012-IDX                                        26330001
447600         FROM 1 BY 1                                              26340000
447700         UNTIL ((PV-ITEMS-PROCESSED >                             26350000
447800                              PV-HOLD-SELECTED-ITEMS)             26360000
447900         OR (PO012-IDX GREATER THAN PO012-MAX-ITEMS))             26370001
448000         IF  PO012-ACTION-SW (PO012-IDX) > SPACE                  26380001
448100             PERFORM 6110-PROCESS-ITEMS                           26390000
448200         END-IF                                                   26400000
448300         ADD +1                    TO PV-ITEMS-PROCESSED          26410000
448400     END-PERFORM.                                                 26420000
448500                                                                  26430000
448600     PERFORM 6111-WRITE-LIST-QUEUE.                               26440000
448700                                                                  26450000
448800/                                                                 26460000
448900*----------------------------------------------------------------*26470000
449000*    READ THE LIST QUEUE RECORD.                                 *26480000
449100*----------------------------------------------------------------*26490000
449200                                                                  26500000
449300 6105-READ-SEL-QUEUE.                                             26510000
449400                                                                  26520000
449500     EXEC CICS                                                    26530000
449600          READQ TS                                                26540000
449700              QUEUE (ASC-SEL-QUEUE-NAME)                          26550000
449800              INTO  (PO012-PO-SELECT-RECORD)                      26560001
449900              ITEM  (PV-SEL-QUEUE-ITEM)                           26570000
450000              RESP  (PV-CICS-RESP)                                26580000
450100     END-EXEC.                                                    26590000
450200                                                                  26600000
450300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26610000
450400         CONTINUE                                                 26620000
450500     ELSE                                                         26630000
450600         SET DP013-CICS-ABEND      TO TRUE                        26640000
450700         SET DP013-NO-ROLLBACK     TO TRUE                        26650000
450800         MOVE '6105-READ-SEL-QUEUE'                               26660000
450900                                   TO DP013-PARAGRAPH             26670000
451000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26680000
451100                                   TO DP013-MESSAGE-TEXT(1)       26690000
451200         PERFORM DP013-0000-PROCESS-ABEND                         26700000
451300     END-IF.                                                      26710000
451400                                                                  26720000
451500/                                                                 26730000
451600*----------------------------------------------------------------*26740000
451700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26750000
451800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26760000
451900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26770000
452000*----------------------------------------------------------------*26780000
452100                                                                  26790000
452200 6110-PROCESS-ITEMS.                                              26800000
452300                                                                  26810000
452400     COMPUTE PV-ITEM = 1 + ((PO012-ITEM (PO012-IDX) - 1)          26820001
452500                     / PC-ITEMS-PER-PANEL).                       26830000
452600                                                                  26840000
452700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26850000
452800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26860000
452900             PERFORM 6111-WRITE-LIST-QUEUE                        26870000
453000         END-IF                                                   26880000
453100         MOVE PV-ITEM              TO PV-SAVE-ITEM                26890000
453200                                                                  26900000
453300         PERFORM 6112-READ-LIST-QUEUE                             26910000
453400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26920000
453500             CONTINUE                                             26930000
453600         END-IF                                                   26940000
453700     END-IF.                                                      26950000
453800                                                                  26960000
453900     COMPUTE PV-SUB = (PO012-ITEM (PO012-IDX)                     26970001
454000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26980000
454100                                                                  26990000
454200     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       27000000
454300     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        27010000
454400                                     (PV-SUB).                    27020000
454500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27030000
454600                                                                  27040000
454700/                                                                 27050000
454800*----------------------------------------------------------------*27060000
454900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *27070000
455000*----------------------------------------------------------------*27080000
455100                                                                  27090000
455200 6111-WRITE-LIST-QUEUE.                                           27100000
455300                                                                  27110000
455400     EXEC CICS                                                    27120000
455500         WRITEQ TS                                                27130000
455600             QUEUE (ASC-LIST-QUEUE-NAME)                          27140000
455700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27150000
455800             ITEM  (PV-SAVE-ITEM)                                 27160000
455900             REWRITE                                              27170000
456000             RESP  (PV-CICS-RESP)                                 27180000
456100     END-EXEC.                                                    27190000
456200                                                                  27200000
456300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27210000
456400         CONTINUE                                                 27220000
456500     ELSE                                                         27230000
456600         SET DP013-CICS-ABEND      TO TRUE                        27240000
456700         SET DP013-NO-ROLLBACK     TO TRUE                        27250000
456800         MOVE '6111-WRITE-LIST-QUEUE'                             27260000
456900                                   TO DP013-PARAGRAPH             27270000
457000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27280000
457100                                   TO DP013-MESSAGE-TEXT(1)       27290000
457200         PERFORM DP013-0000-PROCESS-ABEND                         27300000
457300     END-IF.                                                      27310000
457400                                                                  27320000
457500/                                                                 27330000
244900*----------------------------------------------------------------*27340000
245000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*27350000
245100*----------------------------------------------------------------*27360000
245200                                                                  27370000
245300 6112-READ-LIST-QUEUE.                                            27380000
245400                                                                  27390000
245500     EXEC CICS                                                    27400000
245600         READQ TS                                                 27410000
245700             QUEUE (ASC-LIST-QUEUE-NAME)                          27420000
245800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     27430000
245900             ITEM  (PV-ITEM)                                      27440000
246000             RESP  (PV-CICS-RESP)                                 27450000
246100     END-EXEC.                                                    27460000
246200                                                                  27470000
246300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27480000
246400         CONTINUE                                                 27490000
246500     ELSE                                                         27500000
246600         SET DP013-CICS-ABEND      TO TRUE                        27510000
246700         SET DP013-NO-ROLLBACK     TO TRUE                        27520000
246800         MOVE '6112-READ-LIST-QUEUE'                              27530000
246900                                   TO DP013-PARAGRAPH             27540000
247000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27550000
247100                                   TO DP013-MESSAGE-TEXT(1)       27560000
247200         PERFORM DP013-0000-PROCESS-ABEND                         27570000
247300     END-IF.                                                      27580000
247400                                                                  27590000
247500 EJECT                                                            27600000
247600*----------------------------------------------------------------*27610000
247700*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *27620000
247800*----------------------------------------------------------------*27630000
247900                                                                  27640000
248000 9100-READ-SEL-QUEUE.                                             27650000
248100     EXEC CICS                                                    27660000
248200         READQ TS                                                 27670000
248300             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        27680000
248400             INTO  (PO077-SET-SEL-REC)                            27690000
248500             ITEM  (ASC-SEL-ITEM)                                 27700000
248600             RESP  (PV-CICS-RESP)                                 27710000
248700     END-EXEC.                                                    27720000
248800                                                                  27730000
248900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       27740000
249000         CONTINUE                                                 27750000
249100     ELSE                                                         27760000
249200         SET DP013-LOGIC-ABEND                                    27770000
249300             DP013-NO-ROLLBACK     TO TRUE                        27780000
249400         MOVE '9100-READ-SEL-QUEUE'                               27790000
249500                                   TO DP013-PARAGRAPH             27800000
249600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   27810000
249700                                   TO DP013-MESSAGE-TEXT (1)      27820000
249800         PERFORM DP013-0000-PROCESS-ABEND                         27830000
249900     END-IF.                                                      27840000
250000                                                                  27850000
250100 EJECT                                                            27860000
250200*----------------------------------------------------------------*27870000
250300*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *27880000
250400*----------------------------------------------------------------*27890000
250500 9200-REWRITE-SEL-QUEUE.                                          27900000
250600     EXEC CICS                                                    27910000
250700          WRITEQ TS                                               27920000
250800              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      27930000
250900              FROM   (PO077-SET-SEL-REC)                          27940000
251000              ITEM   (ASC-SEL-ITEM)                               27950000
251100              RESP   (PV-CICS-RESP)                               27960000
251200              REWRITE                                             27970000
251300     END-EXEC.                                                    27980000
251400                                                                  27990000
251500     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   28000000
251600         SET DP013-CICS-ABEND                                     28010000
251700             DP013-NO-ROLLBACK     TO TRUE                        28020000
251800         MOVE '9200-REWRITE-SEL-QUEUE'                            28030000
251900                                   TO DP013-PARAGRAPH             28040000
252000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   28050000
252100                                   TO DP013-MESSAGE-TEXT (1)      28060000
252200         PERFORM DP013-0000-PROCESS-ABEND                         28070000
252300     END-IF.                                                      28080000
252400                                                                  28090000
252500 EJECT                                                            28100000
252600*----------------------------------------------------------------*28110000
252700*    ABEND PROCESSOR MODULE                                      *28120000
252800*----------------------------------------------------------------*28130000
252900                                                                  28140000
253000     COPY DPPD013.                                                28150000
