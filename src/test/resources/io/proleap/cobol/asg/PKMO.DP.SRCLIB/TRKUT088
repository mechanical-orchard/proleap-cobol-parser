000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              TRKUT088.                               00020000
000300 AUTHOR.                  DENISE HAHN.                            00030000
000400 DATE-WRITTEN.            JUNE 2018.                              00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM RETRIEVES ALL ALL EFC SHIPMENTS THAT ARE MARKED   *00080000
000900* AS BEING NOT DOWNLOADED, BUT THE INBOUND TRIP IS MARKED AS     *00090000
000910* ET - END TRIP - THESE CAUSE THE SWEEPER TO ABEND.              *00091000
000911* THE FILE WILL BE USED BY TRKUP088 TO UPDATE THE SHIPMENT TO BE *00091100
000912* COMPLETE                                                       *00091200
000913******************************************************************00091300
000914 ENVIRONMENT DIVISION.                                            00091400
000915 CONFIGURATION SECTION.                                           00091500
000916                                                                  00091600
000917 INPUT-OUTPUT SECTION.                                            00091700
000918 FILE-CONTROL.                                                    00091800
000919                                                                  00091900
000920     SELECT OUTPUT-FILE                                           00092000
000930        ASSIGN TO OUT01.                                          00093000
000940                                                                  00094000
000950 DATA DIVISION.                                                   00095000
000960 FILE SECTION.                                                    00096000
000970                                                                  00097000
000980 FD  OUTPUT-FILE                                                  00098000
000990     RECORDING MODE IS F                                          00099000
001000     LABEL RECORDS ARE STANDARD                                   00100000
001100     RECORD CONTAINS 100 CHARACTERS                               00110004
001200     DATA RECORD IS OUTPUT-RECORD.                                00120000
001300                                                                  00130000
001400 01  OUTPUT-RECORD               PIC X(100).                      00140000
001500                                                                  00150000
001600                                                                  00160000
001700 WORKING-STORAGE SECTION.                                         00170000
001800                                                                  00180000
001900 01  PROGRAM-SWITCHES.                                            00190000
002000     05  PS-END-OF-NO-TMST-SW        PIC X(01)   VALUE 'N'.       00200000
002100         88  PS-END-OF-NO-TMST                   VALUE 'Y'.       00210000
002200         88  PS-NOT-END-OF-NO-TMST               VALUE 'N'.       00220000
002210     05  PS-END-OF-TMST-SW           PIC X(01)   VALUE 'N'.       00221000
002220         88  PS-END-OF-TMST                      VALUE 'Y'.       00222000
002230         88  PS-NOT-END-OF-TMST                  VALUE 'N'.       00223000
002300     05  PS-ERROR-SW                 PIC  X(01)  VALUE 'N'.       00230000
002400         88  PS-ERROR                            VALUE 'Y'.       00240000
002500         88  PS-ERROR-NO                         VALUE 'N'.       00250000
002600                                                                  00260000
002700 01  PROGRAM-VARIABLES.                                           00270000
002800                                                                  00280000
002900     05  PV-PARAGRAPH                PIC X(30).                   00290000
003000     05  PV-DB2-FUNCTION             PIC X(30).                   00300000
003100                                                                  00310000
003200     05  PV-UPDATE-TIME              PIC  S9(09) COMP.            00320001
003201     05  PV-INPUT-COUNT              PIC  9(09) VALUE ZEROES.     00320101
003210     05  PV-INPUT-COUNT-NO-TMST      PIC  9(09) VALUE ZEROES.     00321001
003220     05  PV-INPUT-COUNT-TMST         PIC  9(09) VALUE ZEROES.     00322001
003300     05  PV-OUTPUT-COUNT             PIC  9(09) VALUE ZEROES.     00330000
003400                                                                  00340000
004000     05  PV-DISP-COUNT               PIC  ZZZ,ZZZ,ZZ9.            00400000
004010     05  PV-DISP-TRIP                PIC  Z(10).                  00401005
004020     05  PV-DISP-DEST                PIC  Z(04).                  00402005
004100                                                                  00410000
004200 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00420000
004300     88 ABEND-4013                         VALUE +4013.           00430000
004400                                                                  00440000
004500***************************************************************** 00450000
004600*    OUTPUT FILE LAYOUT.                                        * 00460000
004700***************************************************************** 00470000
004800     COPY TRRD072.                                                00480002
004900                                                                  00490000
005000***************************************************************** 00500000
005100*    SQL ABEND ROUTINE WORKING STORAGE                          * 00510000
005200***************************************************************** 00520000
005300     COPY DPWS004.                                                00530000
005400                                                                  00540000
005410***************************************************************** 00541001
005420*    WST_SHPMT_XREF_HDR                                         * 00542001
005430***************************************************************** 00543001
005500     EXEC SQL                                                     00550000
005600        INCLUDE WST00001                                          00560001
005700     END-EXEC.                                                    00570000
005800                                                                  00580000
005810***************************************************************** 00581001
005820*    TTRIPST                                                    * 00582001
005830***************************************************************** 00583001
005900     EXEC SQL                                                     00590000
006000        INCLUDE TTRIPST                                           00600001
006100     END-EXEC.                                                    00610000
006200                                                                  00620000
006210***************************************************************** 00621001
006220*    WST_INTGRTN_TYP                                            * 00622001
006230***************************************************************** 00623001
006240     EXEC SQL                                                     00624001
006250        INCLUDE WST00008                                          00625001
006260     END-EXEC.                                                    00626001
006270                                                                  00627001
006280***************************************************************** 00628001
006290*    WST_ATTR_DEFN                                              * 00629001
006291***************************************************************** 00629101
006292     EXEC SQL                                                     00629201
006293        INCLUDE WST00009                                          00629301
006294     END-EXEC.                                                    00629401
006295                                                                  00629501
006296***************************************************************** 00629601
006297*    WST_ATTR_ELEM                                              * 00629701
006298***************************************************************** 00629801
006299     EXEC SQL                                                     00629901
006300        INCLUDE WST00010                                          00630001
006301     END-EXEC.                                                    00630101
006302                                                                  00630201
006303***************************************************************** 00630305
006304*                                                               * 00630405
006305***************************************************************** 00630505
006306     EXEC SQL                                                     00630605
006307        INCLUDE SQLCA                                             00630705
006308     END-EXEC.                                                    00630805
006309                                                                  00630905
006310***************************************************************** 00631001
006400* ACTIVE SHIPMENTS - ATTACHED TO TRIPS THAT ARE END TRIP P      * 00640001
006410* FIRST CURSOR IS FOR SHIPMENTS THAT DO NOT HAVE A DOWNLOAD     * 00641001
006420* TIMESTAMP                                                     * 00642001
006500***************************************************************** 00650001
007800                                                                  00780000
007900     EXEC SQL                                                     00790000
008000        DECLARE SHPMT_NO_TMST CURSOR FOR                          00800001
008100         SELECT  DISTINCT                                         00810001
008200                  A.INTR_TRIP_ID                                  00820001
008300                 ,A.EXT_SHP_ID                                    00830001
008400                 ,A.DWNLD_TMST                                    00840001
008500                 ,A.DEST_LOC_NBR                                  00850001
008600                 ,A.DWNLD_CDE                                     00860001
008700                 ,B.TRIP_STATUS_CDE                               00870001
008800                 ,B.STATUS_DTE                                    00880001
008900                 ,B.STATUS_TME                                    00890001
009000             FROM WST_SHPMT_XREF_HDR A                            00900001
009100                , TTRIPST B                                       00910001
009200           WHERE A.DWNLD_CDE      IN ('N','P')                    00920001
009300             AND A.LAST_PRCG_TMST  <                              00930001
009400                   (CURRENT TIMESTAMP - :PV-UPDATE-TIME SECONDS)  00940001
009500             AND A.INTR_TRIP_ID  =  B.TRIP_ID                     00950001
009600           AND A.SOR_CDE       = 'RC'                             00960001
009700           AND B.STATUS_DTE IN                                    00970001
009800               (SELECT MAX(C.STATUS_DTE)                          00980001
009900                  FROM TTRIPST C                                  00990001
010000                 WHERE B.TRIP_ID =  C.TRIP_ID)                    01000001
010100           AND B.STATUS_TME IN                                    01010001
010200               (SELECT MAX(D.STATUS_TME)                          01020001
010300                  FROM TTRIPST D                                  01030001
010400                 WHERE B.TRIP_ID  =  D.TRIP_ID                    01040001
010500                   AND D.STATUS_DTE IN                            01050001
010600                       (SELECT MAX(E.STATUS_DTE)                  01060001
010700                          FROM TTRIPST E                          01070001
010800                         WHERE D.TRIP_ID  =  E.TRIP_ID)           01080001
010900                )                                                 01090001
011000           AND B.TRIP_STATUS_CDE  = 'ET'                          01100001
011010           AND A.DWNLD_TMST  =  '9999-09-09-09.09.09.999999'      01101001
011100         ORDER BY                                                 01110001
011200               A.INTR_TRIP_ID                                     01120001
011300             , A.EXT_SHP_ID                                       01130001
012600         WITH UR                                                  01260000
012700     END-EXEC.                                                    01270000
012710***************************************************************** 01271001
012720* ACTIVE SHIPMENTS - ATTACHED TO TRIPS THAT ARE END TRIP P      * 01272001
012730* FIRST CURSOR IS FOR SHIPMENTS THAT DO NOT HAVE A DOWNLOAD     * 01273001
012740* TIMESTAMP                                                     * 01274001
012750***************************************************************** 01275001
012760                                                                  01276001
012770     EXEC SQL                                                     01277001
012780        DECLARE SHPMT_TMST CURSOR FOR                             01278001
012790         SELECT  DISTINCT                                         01279001
012791                  A.INTR_TRIP_ID                                  01279101
012792                 ,A.EXT_SHP_ID                                    01279201
012793                 ,A.DWNLD_TMST                                    01279301
012794                 ,A.DEST_LOC_NBR                                  01279401
012795                 ,A.DWNLD_CDE                                     01279501
012796                 ,B.TRIP_STATUS_CDE                               01279601
012797                 ,B.STATUS_DTE                                    01279701
012798                 ,B.STATUS_TME                                    01279801
012799             FROM WST_SHPMT_XREF_HDR A                            01279901
012800                , TTRIPST B                                       01280001
012801           WHERE A.DWNLD_CDE      IN ('N','P')                    01280101
012802             AND A.LAST_PRCG_TMST  <                              01280201
012803                   (CURRENT TIMESTAMP - :PV-UPDATE-TIME SECONDS)  01280301
012804             AND A.INTR_TRIP_ID  =  B.TRIP_ID                     01280401
012805           AND A.SOR_CDE       = 'RC'                             01280501
012806           AND B.STATUS_DTE IN                                    01280601
012807               (SELECT MAX(C.STATUS_DTE)                          01280701
012808                  FROM TTRIPST C                                  01280801
012809                 WHERE B.TRIP_ID =  C.TRIP_ID)                    01280901
012810           AND B.STATUS_TME IN                                    01281001
012811               (SELECT MAX(D.STATUS_TME)                          01281101
012812                  FROM TTRIPST D                                  01281201
012813                 WHERE B.TRIP_ID  =  D.TRIP_ID                    01281301
012814                   AND D.STATUS_DTE IN                            01281401
012815                       (SELECT MAX(E.STATUS_DTE)                  01281501
012816                          FROM TTRIPST E                          01281601
012817                         WHERE D.TRIP_ID  =  E.TRIP_ID)           01281701
012818                )                                                 01281801
012819           AND B.TRIP_STATUS_CDE  = 'ET'                          01281901
012820           AND NOT A.DWNLD_TMST = '9999-09-09-09.09.09.999999'    01282001
012821         ORDER BY                                                 01282101
012822               A.INTR_TRIP_ID                                     01282201
012823             , A.EXT_SHP_ID                                       01282301
012824         WITH UR                                                  01282401
012825     END-EXEC.                                                    01282501
012830                                                                  01283000
012840                                                                  01284001
012900***********************************************************       01290000
013000 PROCEDURE DIVISION.                                              01300000
013100***********************************************************       01310000
013110 0000-PROGRAM-MAINLINE.                                           01311001
013120                                                                  01312001
013200     OPEN OUTPUT OUTPUT-FILE.                                     01320000
013300                                                                  01330000
013400     SET  PS-NOT-END-OF-NO-TMST                                   01340005
013410          PS-NOT-END-OF-TMST                                      01341005
013500          PS-ERROR-NO          TO  TRUE.                          01350000
013610                                                                  01361001
013611     PERFORM 0100-GET-SECONDS.                                    01361101
013620                                                                  01362001
013700     PERFORM 7000-OPEN-NO-TMST-CURSOR.                            01370001
013800                                                                  01380000
013900     PERFORM 7010-FETCH-NO-TMST-CURSOR.                           01390001
014000                                                                  01400000
014100     PERFORM 2000-PROCESS-NO-TMST-CSR                             01410002
014200       UNTIL PS-END-OF-NO-TMST                                    01420001
014300          OR PS-ERROR.                                            01430000
014310                                                                  01431000
014320     PERFORM 7030-CLOSE-NO-TMST-CURSOR.                           01432001
014330                                                                  01433000
014340                                                                  01434000
014341     PERFORM 7040-OPEN-TMST-CURSOR.                               01434101
014342                                                                  01434201
014343     PERFORM 7050-FETCH-TMST-CURSOR.                              01434301
014344                                                                  01434401
014345     PERFORM 2100-PROCESS-TMST-CSR                                01434501
014346       UNTIL PS-END-OF-TMST                                       01434601
014347          OR PS-ERROR.                                            01434701
014348                                                                  01434801
014349     PERFORM 7060-CLOSE-TMST-CURSOR.                              01434901
014350                                                                  01435001
014351                                                                  01435101
014352     DISPLAY '************************************************'   01435200
014360     DISPLAY '** TRKUT088 - SUSPENDED NOPRO EXTRACT          *'   01436000
014370     DISPLAY '************************************************'   01437000
014380     DISPLAY '*                                              *'   01438000
014390     MOVE PV-INPUT-COUNT    TO  PV-DISP-COUNT.                    01439000
014400     DISPLAY '* INPUT COUNT:  ' PV-DISP-COUNT.                    01440000
014500     DISPLAY '*                                              *'   01450000
014510     MOVE PV-INPUT-COUNT-NO-TMST TO PV-DISP-COUNT.                01451002
014520     DISPLAY '* NO TMST CNT:  ' PV-DISP-COUNT.                    01452002
014530     DISPLAY '*                                              *'   01453002
014540     MOVE PV-INPUT-COUNT-TMST TO PV-DISP-COUNT.                   01454002
014550     DISPLAY '* TMST COUNT :  ' PV-DISP-COUNT.                    01455002
014560     DISPLAY '*                                              *'   01456002
014600     MOVE PV-OUTPUT-COUNT   TO  PV-DISP-COUNT                     01460000
014700     DISPLAY '* OUTPUT COUNT: ' PV-DISP-COUNT.                    01470000
014800     DISPLAY '*                                              *'   01480000
014900     DISPLAY '************************************************'   01490000
015000                                                                  01500000
015100     CLOSE OUTPUT-FILE.                                           01510000
015200                                                                  01520000
015300     STOP RUN.                                                    01530000
015400                                                                  01540000
015500                                                                  01550000
015510 0100-GET-SECONDS.                                                01551001
015512                                                                  01551201
015513     EXEC SQL                                                     01551301
015514          SELECT INT(C.ATTR_ELEM_NBR)                             01551401
015515            INTO :PV-UPDATE-TIME                                  01551501
015516            FROM WST_INTGRTN_TYP   A                              01551601
015517               , WST_ATTR_DEFN   B                                01551701
015518               , WST_ATTR_ELEM   C                                01551801
015519           WHERE A.APPL_FUNC_DESC     =  'ASNTRCKNG'              01551901
015520             AND A.INTGRTN_TYP_CDE    =  'ASNTRIGGER'             01552001
015521             AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE        01552101
015522             AND B.ATTR_DEFN_SEQ_NBR  =  1                        01552201
015523             AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE        01552301
015524             AND C.ATTR_DEFN_SEQ_NBR  =  1                        01552401
015525     END-EXEC                                                     01552501
015526                                                                  01552601
015527     EVALUATE TRUE                                                01552701
015528        WHEN SQLCODE = ZERO                                       01552801
015531           CONTINUE                                               01553101
015532                                                                  01553201
015533        WHEN SQLCODE = -904                                       01553301
015534        WHEN SQLCODE = -913                                       01553401
015535        WHEN SQLCODE = -911                                       01553501
015536           CONTINUE                                               01553601
015537                                                                  01553701
015538      WHEN OTHER                                                  01553801
015539             MOVE '7010-FETCH-NO-TMST-CURSOR'                     01553905
015540                                    TO PV-PARAGRAPH               01554005
015541             MOVE 'ERROR SELECTING SECONDS FOR CSR '              01554105
015542                                    TO PV-DB2-FUNCTION            01554205
015543             PERFORM 9900-DB2-ABEND                               01554305
015558     END-EVALUATE.                                                01555801
015559                                                                  01555901
015560                                                                  01556001
015600 2000-PROCESS-NO-TMST-CSR.                                        01560001
015700                                                                  01570000
015800     MOVE WST00001-INTR-TRIP-ID  TO TR072-INTR-TRIP-ID            01580003
015810                                    PV-DISP-TRIP.                 01581003
015900     MOVE WST00001-EXT-SHP-ID    TO TR072-EXT-SHP-ID.             01590002
016000     MOVE WST00001-DWNLD-TMST    TO TR072-DWNLD-TMST.             01600002
016100     MOVE WST00001-DEST-LOC-NBR  TO TR072-DEST-LOC-NBR            01610003
016110                                    PV-DISP-DEST.                 01611003
016200     MOVE WST00001-DWNLD-CDE     TO TR072-DWNLD-CDE.              01620002
016300     MOVE TRIPST-TRIP-STATUS-CDE TO TR072-TRIP-STATUS-CDE.        01630002
016400     MOVE TRIPST-STATUS-DTE      TO TR072-STATUS-DTE.             01640002
016500     MOVE TRIPST-STATUS-TME      TO TR072-STATUS-TME.             01650002
016600     MOVE 'N'                    TO TR072-TMST-SW.                01660005
016800                                                                  01680000
016810     DISPLAY 'TRIP:'        PV-DISP-TRIP                          01681003
016820             '  SHPMT:'     TR072-EXT-SHP-ID                      01682003
016830             '  DWNLD:'     TR072-DWNLD-TMST                      01683003
016840             '  DEST:'      PV-DISP-DEST                          01684003
016850             '  CDE:'       TR072-DWNLD-CDE                       01685003
016860             '  ST:'        TR072-TRIP-STATUS-CDE                 01686003
016870             ' '            TR072-STATUS-DTE                      01687003
016880             ' '            TR072-STATUS-TME                      01688003
016890             '  NO TMST'.                                         01689003
016891                                                                  01689103
016900     PERFORM 3000-WRITE-EXTRACT.                                  01690000
017000                                                                  01700000
017100     PERFORM 7010-FETCH-NO-TMST-CURSOR.                           01710001
017200                                                                  01720000
017300                                                                  01730000
017310 2100-PROCESS-TMST-CSR.                                           01731005
017320                                                                  01732003
017330     MOVE WST00001-INTR-TRIP-ID  TO TR072-INTR-TRIP-ID            01733003
017331                                    PV-DISP-TRIP.                 01733103
017340     MOVE WST00001-EXT-SHP-ID    TO TR072-EXT-SHP-ID.             01734003
017350     MOVE WST00001-DWNLD-TMST    TO TR072-DWNLD-TMST.             01735003
017360     MOVE WST00001-DEST-LOC-NBR  TO TR072-DEST-LOC-NBR            01736003
017361                                    PV-DISP-DEST.                 01736103
017370     MOVE WST00001-DWNLD-CDE     TO TR072-DWNLD-CDE.              01737003
017380     MOVE TRIPST-TRIP-STATUS-CDE TO TR072-TRIP-STATUS-CDE.        01738003
017390     MOVE TRIPST-STATUS-DTE      TO TR072-STATUS-DTE.             01739003
017391     MOVE TRIPST-STATUS-TME      TO TR072-STATUS-TME.             01739103
017392     MOVE 'Y'                    TO TR072-TMST-SW.                01739205
017393                                                                  01739303
017394     DISPLAY 'TRIP:'        PV-DISP-TRIP                          01739403
017395             '  SHPMT:'     TR072-EXT-SHP-ID                      01739503
017396             '  DWNLD:'     TR072-DWNLD-TMST                      01739603
017397             '  DEST:'      PV-DISP-DEST                          01739703
017398             '  CDE:'       TR072-DWNLD-CDE                       01739803
017399             '  ST:'        TR072-TRIP-STATUS-CDE                 01739903
017400             ' '            TR072-STATUS-DTE                      01740003
017401             ' '            TR072-STATUS-TME                      01740103
017402             '  TMST'.                                            01740203
017403                                                                  01740303
017404     PERFORM 3000-WRITE-EXTRACT.                                  01740403
017405                                                                  01740503
017406     PERFORM 7050-FETCH-TMST-CURSOR.                              01740606
017407                                                                  01740703
017408                                                                  01740803
017410 3000-WRITE-EXTRACT.                                              01741000
017500                                                                  01750000
017600     ADD +1                    TO PV-OUTPUT-COUNT                 01760000
017700                                                                  01770000
017800     WRITE OUTPUT-RECORD                                          01780000
017900      FROM TR072-DATA-RECORD.                                     01790002
018000                                                                  01800000
018100                                                                  01810000
018200 7000-OPEN-NO-TMST-CURSOR.                                        01820001
018300     EXEC SQL                                                     01830000
018400         OPEN SHPMT_NO_TMST                                       01840002
018500     END-EXEC.                                                    01850000
018600                                                                  01860000
018700     EVALUATE TRUE                                                01870000
018800         WHEN SQLCODE = +0                                        01880000
018900             CONTINUE                                             01890000
019000         WHEN OTHER                                               01900000
019100             MOVE '7000-OPEN-NO-TMST-CURSOR'                      01910001
019200                                    TO PV-PARAGRAPH               01920000
019300             MOVE 'OPEN CURSOR     '                              01930000
019400                                    TO PV-DB2-FUNCTION            01940000
019500             PERFORM 9900-DB2-ABEND                               01950000
019600     END-EVALUATE.                                                01960000
019700                                                                  01970000
019800                                                                  01980000
019900 7010-FETCH-NO-TMST-CURSOR.                                       01990001
020000                                                                  02000000
020100     EXEC SQL                                                     02010000
020200         FETCH SHPMT_NO_TMST                                      02020002
020300         INTO  :WST00001-INTR-TRIP-ID                             02030002
020400              ,:WST00001-EXT-SHP-ID                               02040002
020500              ,:WST00001-DWNLD-TMST                               02050003
020600              ,:WST00001-DEST-LOC-NBR                             02060003
020700              ,:WST00001-DWNLD-CDE                                02070005
020800              ,:TRIPST-TRIP-STATUS-CDE                            02080002
020900              ,:TRIPST-STATUS-DTE                                 02090002
021000              ,:TRIPST-STATUS-TME                                 02100002
021300     END-EXEC.                                                    02130000
021400                                                                  02140000
021500     EVALUATE TRUE                                                02150000
021600         WHEN SQLCODE = +0                                        02160000
021700             ADD +1 TO PV-INPUT-COUNT                             02170000
021710             ADD +1 TO PV-INPUT-COUNT-NO-TMST                     02171002
021800         WHEN SQLCODE = +100                                      02180000
021900             SET PS-END-OF-NO-TMST TO TRUE                        02190001
022000         WHEN OTHER                                               02200000
022100             MOVE '7010-FETCH-NO-TMST-CURSOR'                     02210001
022200                                    TO PV-PARAGRAPH               02220000
022300             MOVE 'FETCH CURSOR    '                              02230000
022400                                    TO PV-DB2-FUNCTION            02240000
022500             PERFORM 9900-DB2-ABEND                               02250000
022600     END-EVALUATE.                                                02260000
022700                                                                  02270000
022800                                                                  02280000
022900 7030-CLOSE-NO-TMST-CURSOR.                                       02290001
023000                                                                  02300000
023100     EXEC SQL                                                     02310000
023200         CLOSE SHPMT_NO_TMST                                      02320002
023300     END-EXEC.                                                    02330000
023400                                                                  02340000
023500     EVALUATE TRUE                                                02350000
023600         WHEN SQLCODE = +0                                        02360000
023700             CONTINUE                                             02370000
023800         WHEN OTHER                                               02380000
023900             MOVE '7030-CLOSE-NO-TMST-CURSOR '                    02390001
024000                                    TO PV-PARAGRAPH               02400000
024100             MOVE 'CLOSE CURSOR    '                              02410000
024200                                    TO PV-DB2-FUNCTION            02420000
024300             PERFORM 9900-DB2-ABEND                               02430000
024400     END-EVALUATE.                                                02440000
024500                                                                  02450000
024600                                                                  02460000
024610 7040-OPEN-TMST-CURSOR.                                           02461002
024620     EXEC SQL                                                     02462002
024630         OPEN SHPMT_TMST                                          02463002
024640     END-EXEC.                                                    02464002
024650                                                                  02465002
024660     EVALUATE TRUE                                                02466002
024670         WHEN SQLCODE = +0                                        02467002
024680             CONTINUE                                             02468002
024690         WHEN OTHER                                               02469002
024691             MOVE '7000-OPEN-TMST-CURSOR'                         02469102
024692                                    TO PV-PARAGRAPH               02469202
024693             MOVE 'OPEN CURSOR     '                              02469302
024694                                    TO PV-DB2-FUNCTION            02469402
024695             PERFORM 9900-DB2-ABEND                               02469502
024696     END-EVALUATE.                                                02469602
024697                                                                  02469702
024698                                                                  02469802
024699 7050-FETCH-TMST-CURSOR.                                          02469902
024700                                                                  02470002
024701     EXEC SQL                                                     02470102
024702         FETCH SHPMT_TMST                                         02470202
024703         INTO  :WST00001-INTR-TRIP-ID                             02470302
024704              ,:WST00001-EXT-SHP-ID                               02470402
024705              ,:WST00001-DWNLD-TMST                               02470503
024706              ,:WST00001-DEST-LOC-NBR                             02470603
024707              ,:WST00001-DWNLD-CDE                                02470703
024708              ,:TRIPST-TRIP-STATUS-CDE                            02470802
024709              ,:TRIPST-STATUS-DTE                                 02470902
024710              ,:TRIPST-STATUS-TME                                 02471002
024713     END-EXEC.                                                    02471302
024714                                                                  02471402
024715     EVALUATE TRUE                                                02471502
024716         WHEN SQLCODE = +0                                        02471602
024717             ADD +1 TO PV-INPUT-COUNT                             02471702
024718             ADD +1 TO PV-INPUT-COUNT-TMST                        02471802
024719         WHEN SQLCODE = +100                                      02471902
024720             SET PS-END-OF-TMST TO TRUE                           02472002
024721         WHEN OTHER                                               02472102
024722             MOVE '7050-FETCH-TMST-CURSOR'                        02472202
024723                                    TO PV-PARAGRAPH               02472302
024724             MOVE 'FETCH CURSOR    '                              02472402
024725                                    TO PV-DB2-FUNCTION            02472502
024726             PERFORM 9900-DB2-ABEND                               02472602
024727     END-EVALUATE.                                                02472702
024728                                                                  02472802
024729                                                                  02472902
024730 7060-CLOSE-TMST-CURSOR.                                          02473002
024731                                                                  02473102
024732     EXEC SQL                                                     02473202
024733         CLOSE SHPMT_TMST                                         02473302
024734     END-EXEC.                                                    02473402
024735                                                                  02473502
024736     EVALUATE TRUE                                                02473602
024737         WHEN SQLCODE = +0                                        02473702
024738             CONTINUE                                             02473802
024739         WHEN OTHER                                               02473902
024740             MOVE '7060-CLOSE-TMST-CURSOR '                       02474002
024741                                    TO PV-PARAGRAPH               02474102
024742             MOVE 'CLOSE CURSOR    '                              02474202
024743                                    TO PV-DB2-FUNCTION            02474302
024744             PERFORM 9900-DB2-ABEND                               02474402
024745     END-EVALUATE.                                                02474502
024746                                                                  02474602
024747                                                                  02474702
024750******************************************************************02475000
024800 9900-DB2-ABEND.                                                  02480000
024900                                                                  02490000
025000     DISPLAY '** ABEND **'.                                       02500000
025100     DISPLAY '** PROGRAM   ** = TRKUT088'                         02510000
025200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   02520000
025300     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                02530000
025400                                                                  02540000
025500* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     02550000
025600     COPY DPPD004.                                                02560000
025700                                                                  02570000
025800     EXEC SQL                                                     02580000
025900         ROLLBACK                                                 02590000
026000     END-EXEC.                                                    02600000
026100                                                                  02610000
026200     SET ABEND-4013           TO TRUE.                            02620000
026300     CALL 'ILBOABN0' USING ABEND-CODE.                            02630000
026400                                                                  02640000
026500                                                                  02650000
