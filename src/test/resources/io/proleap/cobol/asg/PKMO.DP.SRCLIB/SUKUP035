000200 IDENTIFICATION DIVISION.                                         00010012
000300 PROGRAM-ID.    SUKUP035.                                         00020012
000400 AUTHOR.        JIM ARENDT.                                       00030012
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040012
000600 DATE-WRITTEN   MARCH 2017.                                       00050012
000700 DATE-COMPILED.                                                   00060012
000800 ENVIRONMENT DIVISION.                                            00070012
000900 CONFIGURATION SECTION.                                           00080012
001000 SOURCE-COMPUTER.        IBM-3090.                                00090012
001100 OBJECT-COMPUTER.        IBM-3090.                                00100012
001200                                                                  00110012
002000******************************************************************00120012
001300 INPUT-OUTPUT SECTION.                                            00130012
001400 FILE-CONTROL.                                                    00140012
001500                                                                  00150012
001600     SELECT INPUT-FILE                                            00160012
001700         ASSIGN TO INP01.                                         00170012
001800                                                                  00180012
002000******************************************************************00190012
002100 DATA DIVISION.                                                   00200012
002200 FILE SECTION.                                                    00210012
002300                                                                  00220012
002400 FD  INPUT-FILE                                                   00230012
002500     RECORDING MODE IS F                                          00240012
002600     LABEL RECORDS ARE STANDARD                                   00250012
002700     BLOCK CONTAINS 0 RECORDS.                                    00260012
002800                                                                  00270012
003000 01  INPUT-REC                       PIC  X(100).                 00280013
003100                                                                  00290012
002000******************************************************************00300012
003200 WORKING-STORAGE SECTION.                                         00310012
005400 01  PC-PROGRAM-CONSTANTS.                                        00320012
005500     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00330018
005500                                                   'SUKUP035'.    00340018
005500     05  PC-YES                      PIC  X(01)    VALUE 'Y'.     00350018
005500     05  PC-NO                       PIC  X(01)    VALUE 'N'.     00360018
008600     05  PC-COMMIT-HOLD              PIC  9(03)    VALUE 200.     00370019
004500                                                                  00380012
006000 01  PV-PROGRAM-VARIABLES.                                        00390012
006200     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00400012
006300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00410012
006400     05  PV-READ-COUNTER             PIC  9(09)    VALUE ZERO.    00420012
006400     05  PV-INSERT-COUNTER           PIC  9(09)    VALUE ZERO.    00430012
006400     05  PV-BYPASS-COUNTER           PIC  9(09)    VALUE ZERO.    00440016
010500     05  PV-COMMIT-COUNTER           PIC  9(03)    VALUE ZERO.    00450013
010300     05  PV-COMMIT-COUNT             PIC S9(09)    VALUE +0       00460013
010400                                                   COMP SYNC.     00470013
006400     05  PV-DISP-UNT-ID              PIC  9(18)    VALUE ZERO.    00480012
006400     05  PV-DISP-TRIP-ID             PIC  9(09)    VALUE ZERO.    00490012
006800     05  PV-DISPLAY-SQLCODE          PIC  999-     VALUE ZEROES.  00500012
006800     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00510012
004800                                                                  00520012
004900 01  PS-PROGRAM-SWITCHES.                                         00530012
005000     05  PS-EOF-FILE-SW              PIC  X(01)    VALUE 'N'.     00540016
005100         88  PS-EOF-YES                            VALUE 'Y'.     00550012
005200         88  PS-EOF-NO                             VALUE 'N'.     00560012
005000     05  PS-BYPASS-SW                PIC  X(01)    VALUE 'N'.     00570016
005100         88  PS-BYPASS-YES                         VALUE 'Y'.     00580016
005200         88  PS-BYPASS-NO                          VALUE 'N'.     00590016
007000                                                                  00600012
004600 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00610012
004700                                                   COMP SYNC.     00620012
005600                                                                  00630012
002000******************************************************************00640012
003400     COPY SURD153.                                                00650012
003500                                                                  00660012
003600     COPY DPWS004.                                                00670012
003300                                                                  00680012
002000******************************************************************00690012
003700* DCLGEN TABLE(SUT_OTBND_STR_SCN)                                 00700012
002000******************************************************************00710012
003800     EXEC SQL                                                     00720012
003900         INCLUDE SUT00121                                         00730012
004000     END-EXEC.                                                    00740012
004100                                                                  00750012
004200     EXEC SQL                                                     00760012
004300          INCLUDE SQLCA                                           00770012
004400     END-EXEC.                                                    00780012
005300                                                                  00790012
002000******************************************************************00800012
007100 PROCEDURE DIVISION.                                              00810012
007200                                                                  00820012
007300     PERFORM 1000-INITIALIZE.                                     00830012
007400                                                                  00840012
007500     PERFORM 2000-PROCESS                                         00850012
007600        UNTIL PS-EOF-YES.                                         00860012
007700                                                                  00870012
007800     PERFORM 9000-EOJ-ROUTINE.                                    00880012
007900                                                                  00890012
008000     GOBACK.                                                      00900012
007900                                                                  00910012
002000******************************************************************00920012
008200 1000-INITIALIZE.                                                 00930012
008300                                                                  00940012
008400     DISPLAY ' '.                                                 00950012
008400     DISPLAY '* * * * * * * * * * * '.                            00960012
008500     DISPLAY ' PROGRAM ' PC-CURRENT-PROGRAM-NAME.                 00970012
008400     DISPLAY ' '.                                                 00980012
008600                                                                  00990012
008700     OPEN INPUT INPUT-FILE.                                       01000012
008600                                                                  01010012
008800     PERFORM 8000-READ-INPUT-REC.                                 01020012
008900                                                                  01030012
015300     IF PS-EOF-YES                                                01040012
015300        DISPLAY ' '                                               01050012
015300        DISPLAY '** EMPTY INPUT FILE **'                          01060012
015300        DISPLAY ' '                                               01070012
015300     END-IF.                                                      01080012
015300                                                                  01090012
002000******************************************************************01100012
009000 2000-PROCESS.                                                    01110012
009100                                                                  01120012
009200     PERFORM 3000-CHECK-FOR-EXISTANCE.                            01130016
009100                                                                  01140016
005100     IF PS-BYPASS-YES                                             01150016
006400        ADD 1                        TO PV-BYPASS-COUNTER         01160016
005100     ELSE                                                         01170016
009200        PERFORM 4000-INSERT-RTN                                   01180016
013700        ADD +1                       TO PV-COMMIT-COUNTER         01190016
013800                                                                  01200013
013900        IF PV-COMMIT-COUNTER > PC-COMMIT-HOLD                     01210016
014000            EXEC SQL                                              01220016
014100               COMMIT                                             01230016
014200            END-EXEC                                              01240016
014300                                                                  01250013
014400            IF SQLCODE NOT = +0                                   01260016
014500                DISPLAY '### COMMIT FAILED ! ###'                 01270016
017800                MOVE '2000-PROCESS'  TO PV-PARAGRAPH-NAME         01280016
017900                MOVE 'COMMIT'        TO PV-DB2-OPERATION-ATTEMPTED01290016
014600                PERFORM 9100-SQL-ABEND                            01300016
014700            END-IF                                                01310016
014800                                                                  01320013
014900            ADD  +1                  TO PV-COMMIT-COUNT           01330016
015000            MOVE +0                  TO PV-COMMIT-COUNTER         01340016
015100        END-IF                                                    01350016
009200     END-IF.                                                      01360016
009100                                                                  01370012
009800     PERFORM 8000-READ-INPUT-REC.                                 01380012
009900                                                                  01390012
002000******************************************************************01400016
002000* CHECK TO SEE IF THE ROW EXISTS ON THE TABLE                     01410018
002000******************************************************************01420018
009200 3000-CHECK-FOR-EXISTANCE.                                        01430016
052088                                                                  01440016
120800     EXEC SQL                                                     01450016
077200        SELECT PRCD_IND                                           01460016
077200          INTO :SUT00121-PRCD-IND                                 01470016
077200          FROM SUT_OTBND_STR_SCN                                  01480017
077200         WHERE SHIPT_UNT_ID       = :SU153-SHIPT-UNT-ID           01490016
077205           AND SCN_TYP_CDE        = :SU153-SCN-TYPE-CDE           01500016
077203           AND SCN_OTBND_TRIP_ID  = :SU153-OTBND-TRIP-ID          01510016
077206         FETCH FIRST 1 ROW ONLY                                   01520018
077206        WITH UR                                                   01530018
121400     END-EXEC.                                                    01540016
121500                                                                  01550016
121600     EVALUATE TRUE                                                01560016
121700         WHEN SQLCODE = +0                                        01570016
121700         WHEN SQLCODE = -811                                      01580016
005200             SET PS-BYPASS-YES        TO TRUE                     01590016
121500                                                                  01600016
121700         WHEN SQLCODE = +100                                      01610016
005200             SET PS-BYPASS-NO         TO TRUE                     01620016
121500                                                                  01630016
121900         WHEN OTHER                                               01640016
017800             MOVE '4000-INSERT-RTN'   TO PV-PARAGRAPH-NAME        01650016
017900             MOVE 'INSERT ROUTINE'    TO                          01660016
017900                                      PV-DB2-OPERATION-ATTEMPTED  01670016
122500             DISPLAY '-- ERROR FIELDS --'                         01680016
122400             MOVE SU153-SHIPT-UNT-ID  TO PV-DISP-UNT-ID           01690016
122500             DISPLAY 'SHIPT-UNT-ID   = ' PV-DISP-UNT-ID           01700016
122700             DISPLAY 'SCN-LOC-NBR    = ' SU153-SCN-LOC-NBR        01710016
122400             MOVE SU153-OTBND-TRIP-ID TO PV-DISP-TRIP-ID          01720016
122500             DISPLAY 'OTBND-TRIP-ID  = ' PV-DISP-TRIP-ID          01730016
122700             DISPLAY 'SCN-TYPE-CDE   = ' SU153-SCN-TYPE-CDE       01740016
122700             DISPLAY 'CARTN-SCAN-TMST= ' SU153-CRTN-SCAN-TMST     01750016
122800             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       01760016
122800             DISPLAY 'SQLCODE = '        PV-DISPLAY-SQLCODE       01770016
122800             DISPLAY ' '                                          01780016
017400             PERFORM 9100-SQL-ABEND                               01790016
121600     END-EVALUATE.                                                01800016
124900                                                                  01810016
002000******************************************************************01820012
009200 4000-INSERT-RTN.                                                 01830012
052088                                                                  01840012
120800     EXEC SQL                                                     01850012
077200        INSERT INTO SUT_OTBND_STR_SCN                             01860012
077201           ( SHIPT_UNT_ID                                         01870012
077202            ,CRE_TMST                                             01880012
077203            ,SCN_OTBND_TRIP_ID                                    01890012
077204            ,SCN_LOC_NBR                                          01900012
077205            ,SCN_TYP_CDE                                          01910012
077206            ,CRE_BY_USR_ID                                        01920012
077307            ,ACTV_IND                                             01930012
077308            ,ORIG_OTBND_TRIP_ID                                   01940012
077309            ,SCN_FR_MSTR_IND                                      01950012
077301            ,PRCD_IND)                                            01960012
079600        VALUES                                                    01970012
079600            (:SU153-SHIPT-UNT-ID                                  01980012
121300            , CURRENT TIMESTAMP                                   01990012
001210            ,:SU153-OTBND-TRIP-ID                                 02000012
001209            ,:SU153-SCN-LOC-NBR                                   02010012
121300            ,:SU153-SCN-TYPE-CDE                                  02020012
121300            ,:PC-CURRENT-PROGRAM-NAME                             02030012
121300            ,:PC-YES                                              02040012
121300            , NULL                                                02050012
121300            ,:PC-NO                                               02060012
121300            ,:PC-NO)                                              02070012
121400     END-EXEC.                                                    02080012
121500                                                                  02090012
121600     EVALUATE TRUE                                                02100012
121700         WHEN SQLCODE = +0                                        02110012
006400             ADD 1                    TO PV-INSERT-COUNTER        02120012
121500                                                                  02130012
121900         WHEN OTHER                                               02140012
017800             MOVE '4000-INSERT-RTN'   TO PV-PARAGRAPH-NAME        02150012
017900             MOVE 'INSERT ROUTINE'    TO                          02160012
017900                                      PV-DB2-OPERATION-ATTEMPTED  02170012
122500             DISPLAY '-- ERROR FIELDS --'                         02180012
122400             MOVE SU153-SHIPT-UNT-ID  TO PV-DISP-UNT-ID           02190012
122500             DISPLAY 'SHIPT-UNT-ID   = ' PV-DISP-UNT-ID           02200012
122700             DISPLAY 'SCN-LOC-NBR    = ' SU153-SCN-LOC-NBR        02210012
122400             MOVE SU153-OTBND-TRIP-ID TO PV-DISP-TRIP-ID          02220012
122500             DISPLAY 'OTBND-TRIP-ID  = ' PV-DISP-TRIP-ID          02230012
122700             DISPLAY 'SCN-TYPE-CDE   = ' SU153-SCN-TYPE-CDE       02240012
122700             DISPLAY 'CARTN-SCAN-TMST= ' SU153-CRTN-SCAN-TMST     02250012
122800             MOVE  SQLCODE            TO PV-DISPLAY-SQLCODE       02260012
122800             DISPLAY 'SQLCODE = '        PV-DISPLAY-SQLCODE       02270012
122800             DISPLAY ' '                                          02280012
017400             PERFORM 9100-SQL-ABEND                               02290012
121600     END-EVALUATE.                                                02300012
124900                                                                  02310012
002000******************************************************************02320012
014900 8000-READ-INPUT-REC.                                             02330012
014900                                                                  02340012
015000     READ INPUT-FILE INTO                                         02350012
015100         SU153-EXTRACT-RECORD                                     02360012
015200     AT END                                                       02370012
015300         SET PS-EOF-YES               TO TRUE                     02380012
015400     NOT AT END                                                   02390012
015500         ADD +1                       TO PV-READ-COUNTER          02400012
015600     END-READ.                                                    02410012
015700                                                                  02420012
002000******************************************************************02430012
015800 9000-EOJ-ROUTINE.                                                02440012
015900                                                                  02450012
016000     CLOSE INPUT-FILE.                                            02460012
016100                                                                  02470012
016200     DISPLAY '-- PROGRAM TOTALS --'.                              02480012
016200     MOVE PV-READ-COUNTER              TO PV-DISPLAY-COUNT.       02490012
016300     DISPLAY 'TOTAL RECORDS READ     = '  PV-DISPLAY-COUNT.       02500012
016400                                                                  02510012
016200     MOVE PV-INSERT-COUNTER            TO PV-DISPLAY-COUNT.       02520012
016300     DISPLAY 'TOTAL RECORDS INSERTED = '  PV-DISPLAY-COUNT.       02530012
016400                                                                  02540016
016200     MOVE PV-BYPASS-COUNTER            TO PV-DISPLAY-COUNT.       02550016
016300     DISPLAY 'TOTAL RECORDS BYPASSED = '  PV-DISPLAY-COUNT.       02560016
016400                                                                  02570012
020500     MOVE PV-COMMIT-COUNT              TO PV-DISPLAY-COUNT.       02580013
020600     DISPLAY 'TOTAL COMMITS TAKEN    = '  PV-DISPLAY-COUNT.       02590013
016400                                                                  02600013
017200     DISPLAY ' '.                                                 02610012
017200     DISPLAY '* * * * * * * * * * * '.                            02620012
017200     DISPLAY ' '.                                                 02630012
017300                                                                  02640012
002000******************************************************************02650012
017400 9100-SQL-ABEND.                                                  02660012
017300                                                                  02670012
017600     DISPLAY '** ABEND     **'.                                   02680012
017700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02690012
017800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02700012
017900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     02710012
018000                                                                  02720012
018100     COPY DPPD004.                                                02730012
018200                                                                  02740012
018300     MOVE +4013                  TO ABEND-CODE.                   02750012
018400     CALL 'ILBOABN0' USING ABEND-CODE.                            02760012
018500                                                                  02770012
