000100*----------------------------------------------------------       00000100
000200 IDENTIFICATION DIVISION.                                         00000200
000300*----------------------------------------------------------       00000300
000400 PROGRAM-ID.    XSKUT029.                                         00000400
000500 AUTHOR.        JOSEPH MENYAH.                                    00000500
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00000600
000700                                                                  00000700
000800*----------------------------------------------------------       00000800
000900*            PRICING BUSINESS EVENT EXTRACT                       00000900
001000*----------------------------------------------------------       00001000
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00002000
001020* EXTRACT FOR THE PRICING BUSINESS EVENT.                         00003000
001124*                                                                 00004000
001125*----------------------------------------------------------       00005000
001126* HISTORY LOG:                                                    00006000
001127*                                                                 00007000
001128*----------------------------------------------------------       00008000
062810* DATE:        MAY 6, 2010                                        00009000
062810* WR/IR#:      WR# 38173                                          00010000
062810* PROGRAMMER:  CHERI PARMLEY                                      00020000
062810* DESCRIPTION: ADD 'RBO' TO THE PV-SIMPLE-PRICE 88 LEVEL FOR      00030000
062810*              REBATES.                                           00031000
062810* DATE:        AUG 12, 2010                                       00032102
062810* WR/IR#:      WR# 38172                                          00032202
062810* PROGRAMMER:  CHERI PARMLEY                                      00032302
062810* DESCRIPTION: EXCLUDE 'RB' PROMO_TYP_CDE FROM CURSOR. REMOVE     00032402
062810*              RBO 88 LEVEL. MAKE CONSISTENT FOR PM COMPARISON.   00032502
001160*----------------------------------------------------------       00033000
001170 ENVIRONMENT DIVISION.                                            00034000
001180*----------------------------------------------------------       00035000
001190 CONFIGURATION SECTION.                                           00036000
001200 SOURCE-COMPUTER. IBM-3090.                                       00037000
001300 OBJECT-COMPUTER. IBM-3090.                                       00038000
001400                                                                  00039000
001500 INPUT-OUTPUT SECTION.                                            00040000
001600                                                                  00050000
001700 FILE-CONTROL.                                                    00060000
001800                                                                  00070000
004900     SELECT DATE-RANGE-FILE                                       00080000
005000         ASSIGN TO INP01.                                         00090000
                                                                        00100000
004900     SELECT TMST-FILE                                             00110000
005000         ASSIGN TO INP02.                                         00120000
                                                                        00130000
004900     SELECT EXTRACT-FILE                                          00140000
005000         ASSIGN TO OUT01.                                         00150000
001900*----------------------------------------------------------       00160000
002000 DATA DIVISION.                                                   00170000
002100*----------------------------------------------------------       00180000
002200 FILE SECTION.                                                    00190000
002300                                                                  00191000
008000 FD  EXTRACT-FILE                                                 00192000
008100     RECORDING MODE IS F                                          00193000
008200     LABEL RECORDS ARE OMITTED                                    00194000
008300     RECORD CONTAINS 258 CHARACTERS                               00195000
008400     DATA RECORD IS PRICING-REC.                                  00196000
008500 01  PRICING-REC           PIC X(258).                            00197000
005800 FD  DATE-RANGE-FILE                                              00198000
005900     RECORDING MODE IS F                                          00199000
006000     LABEL RECORDS ARE OMITTED                                    00200000
006100     RECORD CONTAINS 80 CHARACTERS                                00210000
006200     BLOCK CONTAINS 0 RECORDS.                                    00220000
       01  DATE-RANGE-LINE             PIC  X(80).                      00230000
006500                                                                  00240000
005800 FD  TMST-FILE                                                    00250000
005900     RECORDING MODE IS F                                          00260000
006000     LABEL RECORDS ARE OMITTED                                    00270000
006100     RECORD CONTAINS 80 CHARACTERS                                00280000
006200     BLOCK CONTAINS 0 RECORDS.                                    00290000
       01  TMST-LINE                        PIC  X(80).                 00300000
008600                                                                  00310000
006500                                                                  00320000
002500*---------------------------------------------------------        00330000
002600                                                                  00331000
002700 WORKING-STORAGE SECTION.                                         00332000
002800*---------------------------------------------------------        00333000
003500* PC- PROGRAM CONSTANTS                                           00334000
003600*----------------------------------------------------------       00335000
003700 01  PC-PROGRAM-CONSTANTS.                                        00336000
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT029'. 00337000
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00338000
004000                                                                  00339000
004100*----------------------------------------------------------       00340000
004200* PS- PROGRAM SWITCHES                                            00350000
004300*----------------------------------------------------------       00360000
004400 01  PS-PROGRAM-SWITCHES.                                         00370000
004500     05  PS-EOF-EXTRACT-SW           PIC X(01)  VALUE SPACE.      00380000
004600         88  PS-EOF-EXTRACT                      VALUE 'Y'.       00390000
004600         88  PS-NOT-EOF-EXTRACT                  VALUE 'N'.       00400000
004500     05  PS-EOF-TIERED-SW            PIC X(01)  VALUE SPACE.      00410000
004600         88  PS-EOF-TIERED                       VALUE 'Y'.       00420000
004600         88  PS-NOT-EOF-TIERED                   VALUE 'N'.       00430000
           05  PS-DATE-RANGE-FILE-SW        PIC  X(01)  VALUE 'N'.      00440000
               88  PS-DATE-RANGE-FILE-END               VALUE 'Y'.      00450000
               88  PS-DATE-RANGE-FILE-START             VALUE 'N'.      00460000
           05  PS-TMST-FILE-SW              PIC  X(01)  VALUE 'N'.      00470000
               88  PS-TMST-FILE-END                     VALUE 'Y'.      00480000
               88  PS-TMST-FILE-START                   VALUE 'N'.      00490000
004800                                                                  00500000
004900*----------------------------------------------------------       00510000
005000* PV- PROGRAM VARIABLES                                           00520000
005100*----------------------------------------------------------       00530000
       01  CC-DATE-RANGE-FILE.                                          00540000
           05  CC-START-DATE                PIC X(10).                  00550000
           05  FILLER                       PIC X(01).                  00560000
           05  CC-END-DATE                  PIC X(10).                  00570000
                                                                        00580000
       01  CC-TMST-FILE.                                                00590000
           05  CC-LAST-UPD-TMST             PIC X(19).                  00600000
                                                                        00610000
004280 01  PV-PRICG-TBL-NEEDED           PIC X(03).                     00620000
004300        88  PV-SIMPLE-PRICE                      VALUES 'SPO',    00630000
004301                                          'SRP', 'SPP', 'SAO',    00630100
004310                                          'CPO', 'CPP', 'CAO',    00630200
004320                                          'GAO', 'GPO', 'APO',    00630300
                                                'GBL', 'GBD', 'GBP'.    00630402
                                                                        00630502
004322     88  PV-BWP-BUY-PRICE                     VALUES 'GBQ',       00630700
004323                                       'GBA', 'PBQ', 'PBA'.       00630800
                                                                        00630900
004324     88  PV-TIERED-PRICE                      VALUES 'TAP',       00631000
004325                                       'TAA', 'TQP', 'TQA'.       00632000
005200 01 PV-PROGRAM-VARIABLES.                                         00632100
006000    05  PV-RECORD-COUNT               PIC 9(10) VALUE ZEROS.      00632200
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00632300
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00632400
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00632500
005700    05  PV-LAST-UPD-TMST              PIC X(26)  VALUE SPACES.    00632600
005710    05  PV-AD-EVNT-ID                 PIC S9(09) VALUE +0.        00632700
                                                                        00632800
007100    05  PV-STRT-PARM.                                             00632900
007200        10  PV-STRT-DTE-CC            PIC X(02).                  00633000
007200        10  PV-STRT-DTE-YY            PIC X(02).                  00634000
007400        10  PV-STRT-DTE-MM            PIC X(02).                  00635000
007600        10  PV-STRT-DTE-DD            PIC X(02).                  00636000
007400        10  FILLER                    PIC X.                      00637000
007400        10  PV-DECREMENT              PIC X(02).                  00638000
007400        10  FILLER                    PIC X(69).                  00639000
007700                                                                  00640000
007100    05  PV-EVNT-STRT-DTE              PIC X(10).                  00650000
                                                                        00660000
008500                                                                  00670000
008600    05  PV-EVNT-END-DTE-TM.                                       00680000
008700        10  PV-EVNT-END-DTE.                                      00690000
008800            15  PV-EVNT-DTE-TM2-CCYY      PIC X(04).              00700000
008900            15  FILLER                    PIC X(01).              00710000
009000            15  PV-EVNT-DTE-TM2-MM        PIC X(02).              00720000
009100            15  FILLER                    PIC X(01).              00730000
009200            15  PV-EVNT-DTE-TM2-DD        PIC X(02).              00740000
009300        10  PV-EVNT-END-TM                PIC X(16).              00750000
009400                                                                  00760000
004310    05  PV-NULLS-INDICATORS.                                      00770000
004320        10  PV-PROMO-ITEM-ID-IND      PIC S9(4) VALUE +0 COMP.    00780000
004321        10  PV-DEPT-NBR-IND           PIC S9(4) VALUE +0 COMP.    00790000
004321        10  PV-MAJ-CL-NBR-IND         PIC S9(4) VALUE +0 COMP.    00800000
004322        10  PV-SUB-CL-NBR-IND         PIC S9(4) VALUE +0 COMP.    00810000
004323        10  PV-STYL-ID-IND            PIC S9(4) VALUE +0 COMP.    00820000
004324        10  PV-SKU-NBR-IND            PIC S9(4) VALUE +0 COMP.    00830000
              10  PV-TKT-CLOR-CODE-IND      PIC S9(4) VALUE +0 COMP.    00840000
              10  PV-RCPT-CMMT-TXT-IND      PIC S9(4) VALUE +0 COMP.    00850000
              10  PV-MDSE-LNE-ID-IND        PIC S9(4) VALUE +0 COMP.    00860000
              10  PV-THRS-QTY-IND           PIC S9(4) VALUE +0 COMP.    00870000
              10  PV-THRS-AMT-IND           PIC S9(4) VALUE +0 COMP.    00880000
              10  PV-DISC-AMT-IND           PIC S9(4) VALUE +0 COMP.    00890000
              10  PV-DISC-PCT-IND           PIC S9(4) VALUE +0 COMP.    00900000
              10  PV-ASSN-LVL-IND           PIC S9(4) VALUE +0 COMP.    00910000
              10  PV-DISC-GP-IND            PIC S9(4) VALUE +0 COMP.    00920000
              10  PV-ADV-CDE-IND            PIC S9(4) VALUE +0 COMP.    00921000
              10  PV-ESL-TOPR-TYP-IND       PIC S9(4) VALUE +0 COMP.    00922000
                                                                        00923000
          05  PV-NULL                      PIC  S9(4)  VALUE -1.        00924000
          05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.    00925000
          05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.    00926000
                                                                        00927000
       01 PV-THRS-AMT                      PIC 9(7).99 VALUE ZEROS.     00928000
       01 PV-DISC-AMT                      PIC 9(7).99 VALUE ZEROS.     00929000
       01 PV-DISC-PCT                      PIC 9(3).9(3) VALUE ZEROS.   00929100
       01 PV-TOTAL-RECORD.                                              00929200
          05 PV-BUSINESS-EVNT-ID              PIC 9(03) VALUE ZERO.     00929300
          05 PV-ACTION-CDE                    PIC X(01) VALUE 'T'.      00929400
          05 PV-TOTAL-NBR-OF-RECS             PIC 9(11) VALUE ZERO.     00929500
004600*----------------------------------------------------------       00929600
004700* PRICING BUSINESS EVENT RECORD LAYOUT                            00929700
004800*----------------------------------------------------------       00929800
004900     COPY XSRD019.                                                00929900
005000                                                                  00930000
006800*---------------------------------------------                    00930100
006900*  DB2 TABLE XST00026(XST_PROMO) - PROMOTION TABLE                00930200
007000*---------------------------------------------                    00930300
007100     EXEC SQL                                                     00930400
007200          INCLUDE XST00026                                        00930500
007300     END-EXEC.                                                    00930600
007400                                                                  00930700
007500*---------------------------------------------                    00930800
007600*  DB2 TABLE XST00028(XST_MDSE_LNE_SELN) -                        00930900
007700*---------------------------------------------                    00931000
007800     EXEC SQL                                                     00931100
007900          INCLUDE XST00028                                        00931200
008000     END-EXEC.                                                    00931300
008100                                                                  00931400
008200*---------------------------------------------                    00931500
008300*  DB2 TABLE XST00030(XST_SMP_PRICG) - SIMPLE PRICING TABLE       00931600
008400*---------------------------------------------                    00931700
008500     EXEC SQL                                                     00931800
008600          INCLUDE XST00030                                        00931900
008700     END-EXEC.                                                    00932000
008800                                                                  00933000
008900*---------------------------------------------                    00934000
009000*  DB2 TABLE XST00035(XST_TIER_PRICG) - TIERED PRICING TABLE      00935000
009100*---------------------------------------------                    00936000
009110     EXEC SQL                                                     00937000
009120          INCLUDE XST00035                                        00938000
009130     END-EXEC.                                                    00939000
009140                                                                  00940000
011400*----------------------------------------------------------       00950000
011500* DATE ROUTINE COPY MEMBERS                                       00960000
011600*----------------------------------------------------------       00970000
011700     COPY DPWS500.                                                00980000
011800                                                                  00980100
011900*----------------------------------------------------------       00980200
012000* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00980300
012100*----------------------------------------------------------       00980400
012200     COPY DPWS004.                                                00980500
012300                                                                  00980600
030160*---------------------------------------------                    00980700
030170*  DB2 COMMUNICATION AREA.                                        00980800
030180*---------------------------------------------                    00980900
030190     EXEC SQL                                                     00981000
030191          INCLUDE SQLCA                                           00981100
030192     END-EXEC.                                                    00981200
030193                                                                  00981300
023000     COPY SQLCA2.                                                 00981400
030194*---------------------------------------------                    00981500
023300*   TIERED  CURSOR  DB2 SELECT                                    00981600
030194*---------------------------------------------                    00981700
023400     EXEC SQL                                                     00981800
023500       DECLARE TIERED CURSOR FOR                                  00981900
               SELECT THRS_QTY,                                         00982000
                      THRS_AMT,                                         00983000
                      DISC_AMT,                                         00984000
                      PROMO_INTFC_SUB_ID,                               00985000
                      DISC_PCT,                                         00986000
                      STAT_CDE                                          00987000
               FROM  XST_TIER_PRICG                                     00988000
               WHERE  PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID         00989000
               AND  MDSE_LNE_ID      = :XST00028-MDSE-LNE-ID            00990000
               WITH UR                                                  01000000
024400     END-EXEC.                                                    01010000
030194*---------------------------------------------                    01020000
023300*   EXTRACT CURSOR  DB2 SELECT                                    01030000
030194*---------------------------------------------                    01040000
023400     EXEC SQL                                                     01050000
023500       DECLARE EXTRACT CURSOR FOR                                 01060000
              SELECT A.PROMO_INTFC_ID,                                  01070000
                     A.MDSE_LNE_ID,                                     01080000
                     A.PROMO_ITM_ID,                                    01090000
                     A.PROMO_ID,                                        01100000
                     A.DEPT_NBR,                                        01110000
                     A.MAJ_CL_NBR,                                      01120000
                     A.SUB_CL_NBR,                                      01130000
                     A.STYL_ID,                                         01140000
                     A.SKU_NBR,                                         01150000
                     A.MDSE_HIER_CDE,                                   01160000
                     A.STAT_CDE,                                        01170000
                     A.TKT_CLOR_CDE,                                    01180000
                     A.RCPT_CMMT_TXT,                                   01190000
                     A.PRICG_TYP_CDE,                                   01200000
                     A.ADV_CDE,                                         01210000
                     A.ESL_TOPR_TYP_CDE,                                01220000
                     A.SOR_LAST_UPD_TMST                                01230000
024100        FROM XST_MDSE_LNE_SELN A,                                 01240000
02410              XST_PROMO B                                          01250000
024200        WHERE  A.PROMO_ID       = B.PROMO_ID                      01260000
              AND    DATE(B.DFLT_END_TMST)                              01270000
                          >= :CC-START-DATE                             01280000
              AND    DATE(B.DFLT_STRT_TMST)                             01281000
                          <= :CC-END-DATE                               01282000
              AND B.PROMO_TYP_CDE <> 'RB'                               01282101
              AND A.SOR_LAST_UPD_TMST <=                                01283000
                     :CC-LAST-UPD-TMST                                  01284000
               WITH UR                                                  01285000
024400     END-EXEC.                                                    01285100
030310                                                                  01285200
031400*----------------------------------------------------------       01285300
031500 PROCEDURE DIVISION.                                              01285400
032100*----------------------------------------------------------       01285500
032200 0000-MAINLINE.                                                   01285600
032300                                                                  01285700
032400     PERFORM 1000-INITIALIZATION.                                 01285800
032500                                                                  01285900
032600     PERFORM 2000-EXTRACT-DATA                                    01286000
032700             UNTIL PS-EOF-EXTRACT.                                01287000
035000                                                                  01288000
035100     PERFORM 9990-WRITE-RECORD-CNT.                               01289000
                                                                        01290000
035100     PERFORM 9999-WRAPUP.                                         01300000
035200                                                                  01301000
035500     GOBACK.                                                      01302000
035700                                                                  01303000
035701*0000-EXIT.                                                       01304000
035702 EJECT.                                                           01305000
035703                                                                  01306000
035800*----------------------------------------------------------       01307000
035900* 1000-INITIALIZATION.                                            01308000
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01309000
036100*     UPDATE OR INSERT A RECORD.                                  01310000
036200*----------------------------------------------------------       01320000
036300 1000-INITIALIZATION.                                             01330000
                                                                        01340000
           SET PS-NOT-EOF-EXTRACT TO TRUE.                              01350000
                                                                        01360000
026600     OPEN INPUT DATE-RANGE-FILE                                   01370000
026600                TMST-FILE                                         01380000
026600          OUTPUT EXTRACT-FILE.                                    01390000
                                                                        01400000
051100     PERFORM 2010-COMPUTE-STRT-DTE                                01410000
051200        THRU 2010-EXIT.                                           01420000
038000                                                                  01430000
027900     EXEC SQL                                                     01440000
028000         OPEN EXTRACT                                             01450000
028100     END-EXEC.                                                    01460000
                                                                        01470000
055500     IF SQLCODE < 0                                               01480000
055600        DISPLAY 'OPEN  FAILED FOR CURSOR EXTRACT'                 01490000
055700         PERFORM U9980-SQL-ERROR                                  01500000
055800            THRU U9980-EXIT.                                      01510000
055900                                                                  01520000
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01530000
056100           SQLWARN0 = 'W'                                         01540000
056200         DISPLAY 'FETCH WARNING FOR CURSOR EXTRACT'               01550000
056300         PERFORM U9990-SQL-WARNING                                01560000
056400            THRU U9990-EXIT.                                      01570000
056500                                                                  01580000
036400                                                                  01590000
                                                                        01600000
036410     INITIALIZE DCLXST00028.                                      01610000
036410     INITIALIZE DCLXST00030.                                      01620000
036410     INITIALIZE DCLXST00035.                                      01630000
036515                                                                  01640000
037240*1100-EXIT.                                                       01650000
037250 EJECT.                                                           01660000
037251                                                                  01670000
037260*----------------------------------------------------------       01680000
037300* 2000-EXTRACT-DATA.                                              01690000
037400*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01700000
037500*     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      01710000
037600*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          01720000
037700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01730000
037800*----------------------------------------------------------       01740000
037900 2000-EXTRACT-DATA.                                               01750000
                                                                        01760000
051100     PERFORM 2100-FETCH-EXTRACT                                   01770000
051200        THRU 2100-EXIT.                                           01780000
038000                                                                  01790000
           IF PS-NOT-EOF-EXTRACT                                        01800000
051100         PERFORM 2200-FORMAT-EXTRACT-FILE                         01810000
051200            THRU 2200-EXIT                                        01820000
                                                                        01830000
                                                                        01840000
           END-IF.                                                      01850000
038000                                                                  01860000
038110*2000-EXIT.                                                       01870000
038200 EJECT.                                                           01880000
030000 2010-COMPUTE-STRT-DTE.                                           01890000
030100                                                                  01900000
030100                                                                  01910000
           READ DATE-RANGE-FILE INTO CC-DATE-RANGE-FILE                 01920000
              AT END                                                    01930000
                 SET PS-DATE-RANGE-FILE-END TO TRUE                     01931000
           END-READ.                                                    01932000
                                                                        01933000
           IF PS-DATE-RANGE-FILE-END                                    01934000
               MOVE 'NO DATE RANGE FILE TO PROCESS'                     01935000
                                                 TO PV-OPERATION-MSG-1  01936000
               PERFORM Z910-ABEND                                       01937000
           ELSE                                                         01938000
               DISPLAY 'CC-START-DATE = ' CC-START-DATE                 01939000
               DISPLAY 'CC-END-DATE   = ' CC-END-DATE                   01940000
           END-IF.                                                      01950000
                                                                        01960000
           READ TMST-FILE INTO CC-TMST-FILE                             01970000
              AT END                                                    01980000
                 SET PS-TMST-FILE-END TO TRUE                           01990000
           END-READ.                                                    02000000
                                                                        02010000
           IF PS-TMST-FILE-END                                          02020000
               MOVE 'NO TMST FILE TO PROCESS'                           02030000
                                                 TO PV-OPERATION-MSG-1  02031000
               PERFORM Z910-ABEND                                       02032000
           ELSE                                                         02033000
               DISPLAY 'CC-LAST-UPD-TMST = ' CC-LAST-UPD-TMST           02034000
           END-IF.                                                      02035000
 35100                                                                  02036000
038110 2010-EXIT.                                                       02037000
           EXIT.                                                        02038000
038200 EJECT.                                                           02039000
038300*------------------------------------------------------           02039100
038400* 2100-FETCH-EXTRACT                                              02039200
038500*     EXTRACTS THE AD EVENT RECORD.                               02039300
038600*------------------------------------------------------           02039400
038210                                                                  02039500
054400 2100-FETCH-EXTRACT.                                              02039600
054500                                                                  02039700
054600     EXEC SQL                                                     02039800
054700         FETCH EXTRACT                                            02039900
                   INTO :XST00028-PROMO-INTFC-ID,                       02040000
                        :XST00028-MDSE-LNE-ID:PV-MDSE-LNE-ID-IND,       02041000
                        :XST00028-PROMO-ITM-ID:PV-PROMO-ITEM-ID-IND,    02042000
                        :XST00028-PROMO-ID,                             02043000
                        :XST00028-DEPT-NBR:PV-DEPT-NBR-IND,             02044000
                        :XST00028-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND,         02045000
                        :XST00028-SUB-CL-NBR:PV-SUB-CL-NBR-IND,         02046000
                        :XST00028-STYL-ID:PV-STYL-ID-IND,               02047000
                        :XST00028-SKU-NBR:PV-SKU-NBR-IND,               02048000
                        :XST00028-MDSE-HIER-CDE,                        02049000
                        :XST00028-STAT-CDE,                             02050000
                        :XST00028-TKT-CLOR-CDE:PV-TKT-CLOR-CODE-IND,    02060000
                        :XST00028-RCPT-CMMT-TXT:PV-RCPT-CMMT-TXT-IND,   02070000
                        :XST00028-PRICG-TYP-CDE,                        02080000
                        :XST00028-ADV-CDE:PV-ADV-CDE-IND,               02090000
                        :XST00028-ESL-TOPR-TYP-CDE:PV-ESL-TOPR-TYP-IND, 02100000
                        :XST00028-LAST-UPD-TMST                         02110000
055300     END-EXEC.                                                    02120000
055400                                                                  02130000
055500     IF SQLCODE < 0                                               02140000
055600         DISPLAY 'FETCH FAILED FOR CURSOR EXTRACT'                02150000
055700         PERFORM U9980-SQL-ERROR                                  02160000
055800            THRU U9980-EXIT.                                      02170000
055900                                                                  02180000
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02190000
056100           SQLWARN0 = 'W'                                         02200000
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_PROMO_ADHC_STR'     02210000
056300         PERFORM U9990-SQL-WARNING                                02211000
056400            THRU U9990-EXIT.                                      02212000
056500                                                                  02213000
056600     IF SQLCODE = +100                                            02214000
056700         MOVE 'Y' TO PS-EOF-EXTRACT-SW.                           02215000
056800                                                                  02216000
                                                                        02217000
056900 2100-EXIT.                                                       02218000
057000     EXIT.                                                        02219000
038300*------------------------------------------------------           02220000
038400* 2200-FORMAT-EXTRACT-FILE                                        02230000
038500*     FORMATS THE PRICING COPY BOOK.                              02240000
038600*------------------------------------------------------           02250000
038700 2200-FORMAT-EXTRACT-FILE.                                        02260000
           INITIALIZE XS019-PRICING-RECORD.                             02270000
004600     SET PS-NOT-EOF-TIERED TO TRUE                                02280000
                                                                        02290000
016370     MOVE XST00028-MDSE-HIER-CDE TO XS019-MDSE-HIER-CDE.          02300000
                                                                        02310000
           IF PV-ADV-CDE-IND      = PV-NULL                             02320000
016380        MOVE SPACES                 TO XS019-ADV-IND              02330000
           ELSE                                                         02340000
016380        MOVE XST00028-ADV-CDE       TO XS019-ADV-IND              02350000
           END-IF.                                                      02360000
                                                                        02370000
016380*    MOVE XST00028-STAT-CDE      TO XS019-STAT-CDE.               02380000
                                                                        02390000
           IF PV-ESL-TOPR-TYP-IND = PV-NULL                             02400000
              MOVE SPACES                    TO XS019-ESL-TOPR-TYP      02410000
           ELSE                                                         02420000
              MOVE XST00028-ESL-TOPR-TYP-CDE TO XS019-ESL-TOPR-TYP      02430000
           END-IF.                                                      02440000
                                                                        02450000
           IF PV-TKT-CLOR-CODE-IND = PV-NULL                            02460000
016390        MOVE SPACES                 TO XS019-CLRNC-TYP-CDE        02470000
           ELSE                                                         02480000
016390        MOVE XST00028-TKT-CLOR-CDE  TO XS019-CLRNC-TYP-CDE        02490000
           END-IF.                                                      02500000
                                                                        02510000
           IF PV-RCPT-CMMT-TXT-IND = PV-NULL                            02520000
016391        MOVE SPACES                 TO XS019-RCPT-CMMT-TXT        02530000
           ELSE                                                         02540000
016391        MOVE XST00028-RCPT-CMMT-TXT TO XS019-RCPT-CMMT-TXT        02550000
           END-IF.                                                      02560000
                                                                        02570000
016392     MOVE XST00028-PRICG-TYP-CDE TO XS019-PRICG-TYP-CDE.          02571000
016393     MOVE XST00028-LAST-UPD-TMST TO XS019-LAST-UPD-TMST.          02571100
           IF PV-SKU-NBR-IND = PV-NULL                                  02571200
              MOVE ZEROS TO XS019-SKU-NBR                               02571300
           ELSE                                                         02571400
              MOVE XST00028-SKU-NBR       TO XS019-SKU-NBR              02571500
           END-IF.                                                      02571600
                                                                        02571700
016393     MOVE XST00028-PROMO-ID   TO XS019-PROMO-ID                   02571800
                                                                        02571900
           IF PV-PROMO-ITEM-ID-IND = PV-NULL                            02572000
016393        MOVE ZEROS                  TO XS019-PROMO-ITM-ID         02572100
           ELSE                                                         02572200
016393        MOVE XST00028-PROMO-ITM-ID  TO XS019-PROMO-ITM-ID         02572300
           END-IF.                                                      02572400
                                                                        02572500
036788     MOVE XST00028-PROMO-INTFC-ID                                 02572600
                                       TO  XS019-PROMO-INTFC-ID.        02572700
           IF PV-MDSE-LNE-ID-IND = PV-NULL                              02572800
016393        MOVE ZEROS               TO XS019-MDSE-LNE-ID             02572900
           ELSE                                                         02573000
016393        MOVE XST00028-MDSE-LNE-ID TO XS019-MDSE-LNE-ID            02573100
           END-IF.                                                      02573200
                                                                        02573300
           IF PV-DEPT-NBR-IND = PV-NULL                                 02573400
              MOVE ZEROS                  TO XS019-DEPT-NBR             02573500
           ELSE                                                         02573600
016393        MOVE XST00028-DEPT-NBR      TO XS019-DEPT-NBR             02573700
           END-IF.                                                      02573800
                                                                        02573900
           IF PV-MAJ-CL-NBR-IND = PV-NULL                               02574000
              MOVE ZEROS               TO XS019-MAJ-CL-NBR              02574100
           ELSE                                                         02574200
016393        MOVE XST00028-MAJ-CL-NBR TO XS019-MAJ-CL-NBR              02574300
           END-IF.                                                      02574400
                                                                        02574500
           IF PV-SUB-CL-NBR-IND = PV-NULL                               02574600
              MOVE ZEROS               TO XS019-SUB-CL-NBR              02574700
           ELSE                                                         02574800
016393        MOVE XST00028-SUB-CL-NBR TO XS019-SUB-CL-NBR              02574900
           END-IF.                                                      02575000
                                                                        02575100
           IF PV-STYL-ID-IND = PV-NULL                                  02575200
              MOVE ZEROS               TO XS019-STYLE-ID                02575300
           ELSE                                                         02575400
016393        MOVE XST00028-STYL-ID    TO XS019-STYLE-ID                02575500
           END-IF.                                                      02575600
                                                                        02575700
013000     MOVE XS019-PRICG-TYP-CDE  TO PV-PRICG-TBL-NEEDED.            02575800
           MOVE 090                    TO XS019-BUSINESS-EVNT-ID.       02575900
           MOVE 'U'                    TO XS019-ACTION-CDE.             02576000
                                                                        02576100
036695     EVALUATE TRUE                                                02576200
036696        WHEN PV-SIMPLE-PRICE                                      02576300
036697             PERFORM 2310-FORMAT-SMPL-PRICING                     02576400
                                                                        02576500
036704        WHEN PV-TIERED-PRICE                                      02576600
027900             EXEC SQL                                             02576700
028000                 OPEN TIERED                                      02576800
028100             END-EXEC                                             02576900
055500             IF SQLCODE < 0                                       02577000
055600                DISPLAY 'OPEN  FAILED FOR CURSOR TIERED'          02577100
055700                 PERFORM U9980-SQL-ERROR                          02577200
055800                    THRU U9980-EXIT                               02577300
                   END-IF                                               02577400
                                                                        02577500
056000             IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR       02577600
056100                  SQLWARN0 = 'W'                                  02577700
056200                DISPLAY 'FETCH WARNING FOR CURSOR TIERED'         02577800
056300                PERFORM U9990-SQL-WARNING                         02577900
056400                   THRU U9990-EXIT                                02578000
                   END-IF                                               02579000
                                                                        02579100
036705             PERFORM 2330-FORMAT-TIERED-PRICING                   02579200
                   UNTIL PS-EOF-TIERED                                  02579300
                                                                        02579400
027900             EXEC SQL                                             02579500
028000                 CLOSE TIERED                                     02579600
028100             END-EXEC                                             02579700
           END-EVALUATE.                                                02579800
038800                                                                  02579900
043510 2200-EXIT.                                                       02580000
           EXIT.                                                        02580100
043600 EJECT.                                                           02580200
043610                                                                  02580300
036716*----------------------------------------------------------       02580400
036717* 2310-FORMAT-SMPL-PRICING.                                       02580500
036718*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            02580600
036719*     UPDATE OR INSERT A RECORD.                                  02580700
036720*----------------------------------------------------------       02580800
036721 2310-FORMAT-SMPL-PRICING.                                        02580900
           EXEC SQL                                                     02581000
               SELECT ASSN_LVL_CDE,                                     02581100
                      DISC_GP_QTY,                                      02581200
                      DISC_PRCG_AMT,                                    02581300
                      STAT_CDE                                          02581400
                 INTO :XST00030-ASSN-LVL-CDE:PV-ASSN-LVL-IND,           02581500
                      :XST00030-DISC-GP-QTY:PV-DISC-GP-IND,             02581600
                      :XST00030-DISC-PRCG-AMT,                          02581700
                      :XST00030-STAT-CDE                                02581800
                 FROM  XST_SMP_PRICG                                    02581900
               WHERE  PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID         02582000
                 AND  MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID            02582100
           END-EXEC.                                                    02582200
055500     IF SQLCODE < 0                                               02582300
055600         DISPLAY 'SELECT FAILED FOR SMPL PRICING'                 02582400
055700         PERFORM U9980-SQL-ERROR                                  02582500
055800            THRU U9980-EXIT.                                      02582600
021690     EVALUATE TRUE                                                02582700
022100       WHEN SQLCODE = 0                                           02582800
036725          MOVE XST00030-STAT-CDE   TO XS019-STAT-CDE              02582900
036725          MOVE ZEROS               TO XS019-PROMO-INTFC-SUB-ID    02583000
036725          MOVE ZEROS               TO XS019-THRS-QTY              02583100
                IF PV-ASSN-LVL-IND = PV-NULL                            02583200
036725             MOVE SPACES              TO XS019-ASSN-LVL-CDE       02583300
                ELSE                                                    02583400
036725             MOVE XST00030-ASSN-LVL-CDE TO XS019-ASSN-LVL-CDE     02583500
                END-IF                                                  02583600
                                                                        02583700
                IF PV-DISC-GP-IND = PV-NULL                             02583800
036727             MOVE ZEROS                  TO XS019-GP-QTY          02583900
                ELSE                                                    02584000
036727             MOVE XST00030-DISC-GP-QTY   TO XS019-GP-QTY          02584100
                END-IF                                                  02584200
                                                                        02584300
                IF XST00028-PRICG-TYP-CDE = 'GAO' OR 'GPO' OR           02584400
                                            'GBL' OR 'GBG' OR           02584500
                                            'GBD' OR 'GBP'              02584600
036741             MOVE XST00030-DISC-PRCG-AMT TO XS019-GP-AMT          02584700
036741             MOVE ZEROS                  TO XS019-PRICG-AMT       02584800
                ELSE                                                    02584900
                   MOVE ZEROS TO PV-DISC-PCT                            02585000
                   MOVE PV-DISC-PCT TO XS019-DISC-PCT                   02585100
                   MOVE ZEROS TO PV-DISC-AMT                            02585200
                   MOVE PV-DISC-AMT TO XS019-DISC-AMT                   02585300
                   MOVE ZEROS TO PV-THRS-AMT                            02585400
                   MOVE ZEROS TO XS019-GP-AMT                           02585500
                   MOVE PV-THRS-AMT TO XS019-THRS-AMT                   02585600
036741             MOVE XST00030-DISC-PRCG-AMT TO XS019-PRICG-AMT       02585700
                END-IF                                                  02585800
051100          PERFORM 3000-WRITE-PRICING-EXTRCT                       02585900
051200             THRU 3000-EXIT                                       02586000
036747     END-EVALUATE.                                                02586100
036748*2310-EXIT.                                                       02586200
                                                                        02586300
036777*----------------------------------------------------------       02586400
036778* 2330-FORMAT-TIERED-PRICING.                                     02586500
036779*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            02586600
036780*     UPDATE OR INSERT A RECORD.                                  02586700
036781*----------------------------------------------------------       02586800
036782 2330-FORMAT-TIERED-PRICING.                                      02586900
054500                                                                  02587000
054600     EXEC SQL                                                     02587100
054700         FETCH TIERED                                             02587200
                 INTO :XST00035-THRS-QTY:PV-THRS-QTY-IND,               02587300
                      :XST00035-THRS-AMT:PV-THRS-AMT-IND,               02587400
                      :XST00035-DISC-AMT:PV-DISC-AMT-IND,               02587500
                      :XST00035-PROMO-INTFC-SUB-ID,                     02587600
                      :XST00035-DISC-PCT:PV-DISC-PCT-IND,               02587700
                      :XST00035-STAT-CDE                                02587800
           END-EXEC.                                                    02587900
055500     IF SQLCODE < 0                                               02588000
055600         DISPLAY 'FETCH  FAILED FOR TIERED PRICING'               02588100
055700         PERFORM U9980-SQL-ERROR                                  02588200
055800            THRU U9980-EXIT.                                      02588300
                                                                        02588400
056600     IF SQLCODE = +100                                            02588500
056700         MOVE 'Y' TO PS-EOF-TIERED-SW.                            02588600
                                                                        02588700
021690     EVALUATE TRUE                                                02588800
022100       WHEN SQLCODE = 0                                           02588900
036784           MOVE XST00035-STAT-CDE   TO XS019-STAT-CDE             02589000
                 IF PV-THRS-QTY-IND = PV-NULL                           02589100
036784              MOVE ZEROS               TO XS019-THRS-QTY          02589200
                 ELSE                                                   02589300
036784              MOVE XST00035-THRS-QTY   TO XS019-THRS-QTY          02589400
                 END-IF                                                 02589500
                 IF PV-THRS-AMT-IND = PV-NULL                           02589600
036794              MOVE ZEROS                  TO XS019-THRS-AMT       02589700
                 ELSE                                                   02589800
036794              MOVE XST00035-THRS-AMT      TO XS019-THRS-AMT       02589900
                 END-IF                                                 02590000
                                                                        02590100
                 IF PV-DISC-AMT-IND = PV-NULL                           02590200
                    MOVE ZEROS TO PV-DISC-AMT                           02590300
                    MOVE PV-DISC-AMT          TO XS019-DISC-AMT         02590400
                 ELSE                                                   02590500
036795              MOVE XST00035-DISC-AMT   TO XS019-DISC-AMT          02590600
                 END-IF                                                 02590700
                                                                        02590800
                 IF PV-DISC-PCT-IND = PV-NULL                           02590900
036796              MOVE ZEROS                  TO XS019-DISC-PCT       02591000
                 ELSE                                                   02591100
036796              MOVE XST00035-DISC-PCT      TO XS019-DISC-PCT       02591200
                 END-IF                                                 02591300
                                                                        02591400
036790           MOVE XST00035-PROMO-INTFC-SUB-ID                       02591500
036791                                    TO XS019-PROMO-INTFC-SUB-ID   02591600
036727           MOVE ZEROS               TO XS019-GP-QTY               02591700
                 MOVE ZEROS               TO XS019-GP-AMT               02591800
036725           MOVE SPACES              TO XS019-ASSN-LVL-CDE         02591900
051100           PERFORM 3000-WRITE-PRICING-EXTRCT                      02592000
           END-EVALUATE.                                                02592100
036799*2330-EXIT.                                                       02592200
036800 EJECT.                                                           02592300
036801                                                                  02592400
043700*------------------------------------------------------           02592500
043800* 3000-WRITE-PRICING-EXTRCT                                       02592600
043900*     WRITE EXTRACT FILE.                                         02592700
044000*------------------------------------------------------           02592800
044100 3000-WRITE-PRICING-EXTRCT.                                       02592900
           ADD 1 TO PV-RECORD-COUNT.                                    02593000
062300     WRITE PRICING-REC FROM XS019-PRICING-RECORD.                 02593100
                                                                        02593200
047710 3000-EXIT.                                                       02593300
           EXIT.                                                        02593400
047800 EJECT.                                                           02593500
047810                                                                  02593600
056020                                                                  02593700
059800*----------------------------------------------------------       02593800
073900 U9980-SQL-ERROR.                                                 02593900
059800*----------------------------------------------------------       02594000
074000                                                                  02594100
074100     MOVE SQLCODE    TO SQLCODE2.                                 02594200
074200     MOVE SQLERRD(3) TO SQLERRD3.                                 02594300
074300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02594400
074400     DISPLAY '** PROGRAM        ** = XSKUT029'.                   02594500
074500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02594600
074600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02594700
074700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02594800
074800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02594900
      ******************************************************************02595000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02595100
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02595200
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02595300
      * FORMAT.                                                         02595400
      ******************************************************************02595500
           COPY DPPD004.                                                02595600
           MOVE +4013 TO ABEND-CODE.                                    02595700
           CALL 'ILBOABN0' USING ABEND-CODE.                            02595800
075200                                                                  02595900
075300 U9980-EXIT.                                                      02596000
075400     EXIT.                                                        02597000
                                                                        02598000
059800*----------------------------------------------------------       02599000
075600 U9990-SQL-WARNING.                                               02600000
059800*----------------------------------------------------------       02610000
075700                                                                  02620000
075800     MOVE SQLCODE    TO SQLCODE2.                                 02630000
075900     MOVE SQLERRD(3) TO SQLERRD3.                                 02640000
076000     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02650000
076100     DISPLAY '** PROGRAM        ** = XSKUT029'.                   02660000
      ******************************************************************02670000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02680000
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02690000
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02700000
      * FORMAT.                                                         02710000
      ******************************************************************02720000
           COPY DPPD004.                                                02730000
           MOVE +4013 TO ABEND-CODE.                                    02740000
           CALL 'ILBOABN0' USING ABEND-CODE.                            02750000
077500                                                                  02760000
077600 U9990-EXIT.                                                      02770000
077700     EXIT.                                                        02780000
                                                                        02790000
060100 9990-WRITE-RECORD-CNT.                                           02800000
           INITIALIZE XS019-PRICING-RECORD.                             02810000
           MOVE 090 TO XS019-BUSINESS-EVNT-ID.                          02820000
           MOVE PV-RECORD-COUNT TO XS019-PROMO-INTFC-ID.                02830000
           MOVE 'T' TO XS019-ACTION-CDE.                                02840000
051100     PERFORM 3000-WRITE-PRICING-EXTRCT                            02850000
051200        THRU 3000-EXIT.                                           02860000
060710*9990-EXIT.                                                       02870000
                                                                        02880000
059800*----------------------------------------------------------       02881000
059900* 9999-WRAPUP.                                                    02882000
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           02883000
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           02884000
059930*     PROGRAM.                                                    02885000
060000*----------------------------------------------------------       02886000
*                                                                       02887000
060100 9999-WRAPUP.                                                     02888000
           CLOSE DATE-RANGE-FILE                                        02889000
                 TMST-FILE                                              02890000
                 EXTRACT-FILE.                                          02900000
                                                                        02910000
072200     EXEC SQL                                                     02920000
072300         CLOSE EXTRACT                                            02930000
072400     END-EXEC.                                                    02940000
060200                                                                  02950000
060500                                                                  02960000
060710*9999-EXIT.                                                       02970000
060800 EJECT.                                                           02980000
060900                                                                  02990000
      ******************************************************************03000000
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *03010000
      ******************************************************************03020000
       Z910-ABEND.                                                      03030000
                                                                        03040000
           DISPLAY '** ABEND           **'.                             03050000
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         03060000
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       03070000
                                                                        03080000
           CALL 'ILBOABN0' USING ABEND-CODE.                            03090000
