      ******************************************************************00010002
       IDENTIFICATION DIVISION.                                         00020002
      ******************************************************************00030002
       PROGRAM-ID.             PCKUP759.                                00040015
       AUTHOR.                 JIM HUNTER.                              00050002
       INSTALLATION.           KOHLS DEPARTMENT STORE.                  00060002
       DATE-WRITTEN            MARCH, 2016.                             00070002
       DATE-COMPILED.                                                   00080002
      ******************************************************************00090002
      * THIS PROGRAM IS A MODULE WHICH WILL CREATE ROWS IN              00100002
      * THE REPOSITORY TABLES  (WFT_LOD_CNTL AND WFT_LOD_XFER) FOR      00110002
      * RECEIPTS WHICH WILL BE SENT TO RMS THROUGH MQ SERIES.           00120002
      *                                                                 00130002
      * IT IS A BATCH VERSION OF PCKCS759.                              00140002
      * INITIALLY, IT WILL BE CALLED BY RCKUP065 FOR THE OUTLET STORES. 00150002
      *                                                                 00160002
      * ADJUSTMENT LOGIC HAS BEEN COPIED FROM THE ONLINE VERSION,       00170002
      * HOWEVER, THE ONLINE VERSION READS A QUEUE WRITTEN TO BY OTHER   00180002
      * SCREENS WHICH WILL NOT BE AVAILABLE IN THE BATCH VERSION.       00190002
      * IF BATCH ADJUSTMENTS ARE REQUIRED IN THE FUTURE, A NEW          00200002
      * COPYBOOK WOULD HAVE TO BE PASSED FROM THE CALLING PROGRAM TO    00210002
      * THIS ONE WHICH WOULD BE SIMILAR TO THE CURRENT PCWS241          00220002
      * COPYBOOK BUT WITH AN OCCURS SO THAT MULTIPLE STORES COULD BE    00230002
      * ADJUSTED IN A SINGLE PASS.                                      00240002
      * EXECUTION OF PARAGRAPHS 2000- AND 2200- HAVE BEEN COMMENTED     00250002
      * OUT AT THIS TIME AND 9100- HAS BEEN RENOVED WITH ALL OTHER      00260002
      * CICS CODE.                                                      00270002
      *                                                                 00280016
      * CHG0140332                                                      00290016
      ******************************************************************00300020
      * CHG0142526 05/24/2016 - REMOVED DISPLAYS USED FOR VERIFICATION  00310020
      * AFTER INITIAL DEPOYMENT THAT ARE NO LONGER NEEDED.              00320020
      ******************************************************************00330002
       ENVIRONMENT DIVISION.                                            00340002
       CONFIGURATION SECTION.                                           00350002
                                                                        00360002
       SOURCE-COMPUTER. IBM-3090.                                       00370002
       OBJECT-COMPUTER. IBM-3090.                                       00380002
                                                                        00390002
       INPUT-OUTPUT SECTION.                                            00400002
       FILE-CONTROL.                                                    00410002
                                                                        00420002
       DATA DIVISION.                                                   00430002
                                                                        00440002
       FILE SECTION.                                                    00450002
                                                                        00460002
      ******************************************************************00470002
       WORKING-STORAGE SECTION.                                         00480002
                                                                        00490002
       01  DK-DB2-KEYS.                                                 00500002
           05  DK-PO-NBR                PIC S9(09)  COMP.               00510002
           05  DK-PO-LINE-NBR           PIC S9(09)  COMP.               00520002
           05  DK-OPER-UNT-ID           PIC S9(04)  COMP.               00530002
           05  DK-RCVR-SEQ-NBR          PIC S9(09)  COMP.               00540002
                                                                        00550002
                                                                        00560002
      ******************************************************************00570002
      * TEMPORARY STORAGE QUEUE LAYOUT FOR ADJUSTMENTS                  00580002
           COPY PCWS241.                                                00590019
                                                                        00600002
      ******************************************************************00610002
      * REPOSITORY LAYOUT                                               00620002
      ******************************************************************00630002
           COPY XLRD024.                                                00640002
                                                                        00650002
      ******************************************************************00660013
      *PA - PROGRAM ACCUMULATORS                                        00670013
      ******************************************************************00680013
       01  PROGRAM-ACCUMULATORS.                                        00690013
           05  PA-WFT-LOD-CNTL-INSERTS   PIC S9(7) VALUE +0  COMP-3.    00700013
           05  PA-WFT-LOD-XFER-INSERTS   PIC S9(7) VALUE +0  COMP-3.    00710013
                                                                        00720002
      *----------------------------------------------------------------*00730002
      *  PROGRAM CONSTANTS                                             *00740002
      *----------------------------------------------------------------*00750002
       01  PC-PROGRAM-CONSTANTS.                                        00760002
           05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE 'PCKUP759'.   00770003
                                                                        00780002
           05  PC-V                     PIC  X(01)  VALUE 'V'.          00790002
           05  PC-X                     PIC  X(01)  VALUE 'X'.          00800002
           05  PC-B                     PIC  X(01)  VALUE 'B'.          00810002
           05  PC-D                     PIC  X(01)  VALUE 'D'.          00820002
           05  PC-Q                     PIC  X(01)  VALUE 'Q'.          00830002
           05  PC-W                     PIC  X(01)  VALUE 'W'.          00840002
                                                                        00850002
           05  PC-PCKADJ                PIC  X(06)  VALUE 'PCKADJ'.     00860002
           05  PC-SKUADJ                PIC  X(06)  VALUE 'SKUADJ'.     00870002
           05  PC-SKUVER                PIC  X(06)  VALUE 'SKUVER'.     00880002
           05  PC-PCKVER                PIC  X(06)  VALUE 'PCKVER'.     00890002
           05  PC-READY                 PIC  X(06)  VALUE 'READY '.     00900002
           05  PC-REPOSITORY-DEF-TMST   PIC  X(26)  VALUE               00910002
                                        '0001-01-01-00.00.00.000000'.   00920002
                                                                        00930002
           05  PC-999                   PIC  S9(4) COMP  VALUE 999.     00940002
           05  PC-DEFAULT-DATE          PIC  X(26)  VALUE               00950002
                                        '9999-09-09-09.09.09.999999'.   00960002
           05  PC-END-TM                PIC  X(08) VALUE '24.00.00'.    00970002
           05  PC-VERIFY-ADJUST-PGM     PIC  X(08) VALUE 'PCKUP759'.    00980003
                                                                        00990002
      *----------------------------------------------------------------*01000002
      *  PROGRAM SWITCHES                                              *01010002
      *----------------------------------------------------------------*01020002
       01  PS-PROGRAM-SWITCHES.                                         01030002
           05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   01040002
               88  PS-ERROR                                VALUE 'Y'.   01050002
               88  PS-ERROR-NO                             VALUE 'N'.   01060002
           05  PS-FIRST-FETCH-SW               PIC  X(01)  VALUE 'Y'.   01070002
               88  PS-FIRST-FETCH                          VALUE 'Y'.   01080002
               88  PS-NOT-FIRST-FETCH                      VALUE 'N'.   01090002
           05  PS-END-ADJUSTMENTS-TSQ-SW       PIC  X(01)  VALUE 'N'.   01100002
               88  PS-END-ADJUSTMENTS-TSQ                  VALUE 'Y'.   01110002
               88  PS-NOT-END-ADJUSTMENTS-TSQ              VALUE 'N'.   01120002
           05  PS-SHOW-DEBUG-SW                PIC  X(01)  VALUE 'N'.   01130002
               88  PS-DONT-SHOW-DEBUG-INFO                 VALUE 'N'.   01140002
               88  PS-SHOW-DEBUG-INFO                      VALUE 'Y'.   01150002
           05  PS-PREPK-PO-FOUND-SW            PIC  X(01)  VALUE 'N'.   01160002
               88  PS-PREPK-PO-FOUND                       VALUE 'Y'.   01170002
               88  PS-PREPK-PO-NOT-FOUND                   VALUE 'N'.   01180002
           05  PS-END-OF-LINE-STORE-CSR-SW     PIC  X(01)  VALUE 'N'.   01190002
               88  PS-NOT-END-OF-LINE-STORE-CSR            VALUE 'N'.   01200002
               88  PS-END-OF-LINE-STORE-CSR                VALUE 'Y'.   01210002
           05  PS-END-OF-PREPK-LINE-CSR-SW     PIC  X(01)  VALUE 'N'.   01220002
               88  PS-NOT-END-OF-PREPK-LINE-CSR            VALUE 'N'.   01230002
               88  PS-END-OF-PREPK-LINE-CSR                VALUE 'Y'.   01240002
           05  PS-NEW-LINE-FOUND-SW            PIC  X(01)  VALUE 'N'.   01250002
               88  PS-NEW-LINE-FOUND                       VALUE 'Y'.   01260002
               88  PS-NO-NEW-LINE-FOUND                    VALUE 'N'.   01270002
           05  PS-END-OF-PREPK-STORE-SW        PIC  X(01)  VALUE 'N'.   01280002
               88  PS-END-OF-PREPK-STORE                   VALUE 'Y'.   01290002
               88  PS-NOT-END-OF-PREPK-STORE               VALUE 'N'.   01300002
           05  PS-END-OF-ODD-UNITS-CSR-SW      PIC  X(01)  VALUE 'N'.   01310002
               88  PS-END-OF-ODD-UNITS-CSR                 VALUE 'Y'.   01320002
               88  PS-NOT-END-OF-ODD-UNITS-CSR             VALUE 'N'.   01330002
           05  PS-AT-LEAST-ONE-STORE           PIC  X(01)  VALUE 'N'.   01340002
               88  AT-LEAST-ONE-STORE                      VALUE 'Y'.   01350002
           05  PS-END-OF-TABLE-SW              PIC X(01)   VALUE 'N'.   01360002
               88  PS-END-OF-TABLE                         VALUE 'Y'.   01370002
               88  PS-NOT-END-OF-TABLE                     VALUE 'N'.   01380002
           05  PS-ODD-UNITS-TRANS-SW           PIC X(01)   VALUE 'N'.   01390002
               88  PS-ODD-UNITS-TRANSACTION                VALUE 'Y'.   01400002
               88  PS-ODD-UNITS-TRANSACTION-NO             VALUE 'N'.   01410002
           05  PS-END-OF-PREPK-RATIO-CSR-SW    PIC X(01)   VALUE 'N'.   01420002
               88  PS-END-OF-PREPK-RATIO-CSR               VALUE 'Y'.   01430002
               88  PS-NOT-END-OF-PREPK-RATIO-CSR           VALUE 'N'.   01440002
           05  PS-RATO-QTY-MISMATCH-SW         PIC X(01)   VALUE 'N'.   01450002
               88  PS-RATO-QTY-MISMATCH                    VALUE 'Y'.   01460002
               88  PS-NO-RATO-QTY-MISMATCH                 VALUE 'N'.   01470002
           05  PS-END-OF-PREPK-BY-LNE-SW       PIC X(01)   VALUE 'N'.   01480002
               88  PS-END-OF-PREPK-BY-LNE                  VALUE 'Y'.   01490002
               88  PS-NOT-END-OF-PREPK-BY-LNE              VALUE 'N'.   01500002
      * RPK - ADDED CODE FOR PRB42963 - START                           01510002
      *       SWITCH ADDED TO KNOW IF A WRITE HAS BEEN DONE ONLY TO     01520002
      *       THE WFT_LOD_XFER TABLE AND NOT THE WFT_LOD_CNTL TABLE     01530002
      *       DUE TO THEIR BEING 100 STORES WITH VERIFIED UNITS BUT     01540002
      *       NO MORE STORES TO FOLLOW.                                 01550002
           05  PS-WROTE-TO-XFER-ONLY-SW        PIC X(01)   VALUE 'N'.   01560002
               88  PS-WROTE-TO-XFER-ONLY                   VALUE 'Y'.   01570002
               88  PS-DID-NOT-WRITE-TO-XFER-ONLY           VALUE 'N'.   01580002
                                                                        01590002
      *----------------------------------------------------------------*01600002
      *  PROGRAM VARIABLES                                             *01610002
      *----------------------------------------------------------------*01620002
       01  PV-PROGRAM-VARIABLES.                                        01630002
                                                                        01640002
           05  PV-DISPLAY-PO-NBR               PIC 999999999-.          01650002
           05  PV-DISPLAY-PO-LINE-NBR          PIC 999999999-.          01660002
           05  PV-DISPLAY-PREPK-ID             PIC 9999-.               01670002
           05  PV-DISPLAY-OPER-UNT-ID          PIC 9999-.               01680002
           05  PV-DISPLAY-INBND-TRIP-ID        PIC 999999999-.          01690002
           05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 999999999-.          01700002
           05  PV-DISPLAY-SHIPT-UNT-ID         PIC 999999999999999999-. 01710002
           05  PV-DISPLAY-ITEM-NBR             PIC 999999999999999999-. 01720002
           05  PV-DISPLAY-STR-NBR              PIC 9(4)   VALUE ZEROS.  01730002
                                                                        01740002
           05  PV-LOD-DAT-TXT-LEN              PIC S9(4)  COMP.         01750002
                                                                        01760002
           05  PV-MAX-ITEMS                    PIC S9(4)  VALUE +0      01770002
                                                          COMP.         01780002
           05  PV-INDEX-COUNTER                PIC S9(4)  VALUE +0      01790002
                                                          COMP.         01800002
           05  PV-SEL-ITEM                     PIC S9(4) COMP.          01810002
           05  PV-VALID-IDX                   PIC S9(04)  VALUE +0      01820002
                                                          COMP SYNC.    01830002
           05  PV-PACK-QTY                     PIC S9(7).               01840002
           05  PV-SKU-NBR                      PIC  9(8).               01850002
                                                                        01860002
           05  PV-KEY-DATE                     PIC  X(10) VALUE SPACES. 01870002
           05  PV-KEY-DATE-R REDEFINES PV-KEY-DATE.                     01880002
               10  PV-KEY-CC                   PIC  9(02).              01890002
               10  PV-KEY-YY                   PIC  9(02).              01900002
               10  PV-DASH-1                   PIC  X(01).              01910002
               10  PV-KEY-MM                   PIC  9(02).              01920002
               10  PV-DASH-2                   PIC  X(01).              01930002
               10  PV-KEY-DD                   PIC  9(02).              01940002
                                                                        01950002
           05  PV-BTCH-LOD-SEQ-ID              PIC S9(09) COMP.         01960002
           05  PV-LIMIT-DAYS                   PIC S9(09) COMP.         01970002
           05  PV-SHPD-QTY-SUM                 PIC S9(09) COMP-3.       01980002
           05  PV-CARTON-COUNT                 PIC S9(09) COMP.         01990002
           05  PV-STORE-COUNT                  PIC S9(4)  COMP.         02000002
           05  PV-LINE-COUNT                   PIC S9(4)  COMP.         02010002
           05  PV-PREPK-LNE                    PIC S9(09) COMP.         02020002
           05  PV-PREPK-RATO-QTY               PIC S9(04) COMP.         02030002
           05  PV-STR-ADJ-QTY                  PIC S9(07).              02040002
           05  PV-PO-LNE-HOLD                  PIC S9(09) COMP.         02050002
           05  PV-HOLD-STORE                   PIC S9(04) COMP.         02060002
           05  PV-UNION-TYPE                   PIC  X(01).              02070002
           05  PV-PREV-UNION-TYPE              PIC  X(01).              02080002
           05  PV-PREV-PREPK-RATO-QTY          PIC  S9(4) COMP.         02090002
           05  PV-PREV-SEQUENCE                PIC S9(05) COMP-3        02100002
                                                           VALUE ZERO.  02110002
           05  PV-NEXT-SEQUENCE                PIC S9(05) COMP-3        02120002
                                                           VALUE ZERO.  02130002
           05  PV-DISP-SQLCODE                 PIC -9(09)  VALUE ZERO.  02140002
           05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 02150002
           05  PV-DB2-OPER-ATTEMPTED           PIC  X(30)  VALUE SPACE. 02160002
                                                                        02170002
           05  PV-CURRENT-TMST                 PIC  X(26)  VALUE SPACES.02180002
           05  PV-CURRENT-TMST-R REDEFINES PV-CURRENT-TMST.             02190002
               10  PV-CURR-YYYY                PIC  9(04).              02200002
               10  FILLER                      PIC  X(01).              02210002
               10  PV-CURR-MM                  PIC  9(02).              02220002
               10  FILLER                      PIC  X(01).              02230002
               10  PV-CURR-DD                  PIC  9(02).              02240002
               10  FILLER                      PIC  X(01).              02250002
               10  PV-CURR-HH                  PIC  9(02).              02260002
               10  FILLER                      PIC  X(01).              02270002
               10  PV-CURR-MN                  PIC  9(02).              02280002
               10  FILLER                      PIC  X(01).              02290002
               10  PV-CURR-SS                  PIC  9(02).              02300002
               10  FILLER                      PIC  X(07).              02310002
           05  PV-VERFIED-TMST.                                         02320002
               10  PV-CURR-YYYY-VRFD           PIC  9(04).              02330002
               10  PV-CURR-MM-VRFD             PIC  9(02).              02340002
               10  PV-CURR-DD-VRFD             PIC  9(02).              02350002
               10  PV-CURR-HH-VRFD             PIC  9(02).              02360002
               10  PV-CURR-MN-VRFD             PIC  9(02).              02370002
               10  PV-CURR-SS-VRFD             PIC  9(02).              02380002
           05  PV-PRC-CNTL-TMST                PIC  X(26)  VALUE SPACES.02390002
                                                                        02400002
      ******************************************************************02410002
      *    STANDARD DB2 ERROR HANDLING AREA                            *02420002
      ******************************************************************02430002
           COPY DPWS004.                                                02440002
                                                                        02450002
       01  ABEND-CODE                         PIC S9(04) VALUE +0 COMP. 02460002
                                                                        02470002
                                                                        02480002
      *---------------------------------------------------------------* 02490002
      *    DB2 AREA FOR THE PURCHASE ITEM TABLE                       * 02500002
      *---------------------------------------------------------------* 02510002
           EXEC SQL                                                     02520002
                INCLUDE TPURITM                                         02530002
           END-EXEC.                                                    02540002
                                                                        02550002
      *---------------------------------------------------------------* 02560002
      *    DB2 AREA FOR THE RECEIVER DISTRO TABLE                     * 02570002
      *---------------------------------------------------------------* 02580002
           EXEC SQL                                                     02590002
                INCLUDE TRECDIS                                         02600002
           END-EXEC.                                                    02610002
                                                                        02620002
      *---------------------------------------------------------------* 02630002
      *    DB2 AREA FOR RECEIVER ITEM TABLE                           * 02640002
      *---------------------------------------------------------------* 02650002
           EXEC SQL                                                     02660002
                INCLUDE TRECITM                                         02670002
           END-EXEC.                                                    02680002
                                                                        02690002
      *---------------------------------------------------------------* 02700002
      *  DB2 AREA FOR THE PO PREPK TABLE                                02710002
      *---------------------------------------------------------------* 02720002
           EXEC SQL                                                     02730002
               INCLUDE TPOPRPK                                          02740002
           END-EXEC.                                                    02750002
                                                                        02760002
      *---------------------------------------------------------------* 02770002
      *    DB2 AREA FOR RECEIPT HEADER TABLE                          * 02780002
      *---------------------------------------------------------------* 02790002
           EXEC SQL                                                     02800002
                INCLUDE TRECEIV                                         02810002
           END-EXEC.                                                    02820002
                                                                        02830002
      *---------------------------------------------------------------* 02840002
      *  DB2 AREA FOR (WFT_LOD_CNTL)                                    02850002
      *---------------------------------------------------------------* 02860002
           EXEC SQL                                                     02870002
               INCLUDE WFT00001                                         02880002
           END-EXEC.                                                    02890002
                                                                        02900002
      *---------------------------------------------------------------* 02910002
      *  DB2 AREA FOR (WFT_LOD_XFER)                                    02920002
      *---------------------------------------------------------------* 02930002
           EXEC SQL                                                     02940002
               INCLUDE WFT00002                                         02950002
           END-EXEC.                                                    02960002
                                                                        02970002
      *---------------------------------------------------------------* 02980002
      *  DB2 AREA FOR (XLT_SKU)                                         02990002
      *---------------------------------------------------------------* 03000002
           EXEC SQL                                                     03010002
               INCLUDE XLT00003                                         03020002
           END-EXEC.                                                    03030002
                                                                        03040002
      *---------------------------------------------------------------* 03050002
      *  DB2 AREA FOR (RCT_VRFD_ODD_UNT)                                03060002
      *---------------------------------------------------------------* 03070002
           EXEC SQL                                                     03080002
               INCLUDE RCT00009                                         03090002
           END-EXEC.                                                    03100002
                                                                        03110002
      *---------------------------------------------------------------* 03120002
      *  DB2 RECVG SYSTEMS PARM TABLE                                   03130002
      *---------------------------------------------------------------* 03140002
           EXEC SQL                                                     03150002
               INCLUDE TKRPRPM                                          03160002
           END-EXEC.                                                    03170002
                                                                        03180002
      *----------------------------------------------------------------*03190002
      *  COMMUNICATIONS AREA FOR DB2                                   *03200002
      *----------------------------------------------------------------*03210002
           EXEC SQL                                                     03220002
               INCLUDE SQLCA                                            03230002
           END-EXEC.                                                    03240002
                                                                        03250002
      ***************************************************************** 03260002
      *  LINE STORE CURSOR                                              03270002
      ***************************************************************** 03280002
           EXEC SQL                                                     03290002
             DECLARE LINE-STORE-CSR CURSOR FOR                          03300002
               SELECT A.ORD_LNE_NBR                                     03310002
                    , B.STR_NBR                                         03320002
                    , B.AP_VERIFY_ITM_QTY                               03330002
                    , B.VERIFY_ITM_QTY                                  03340002
                    , A.ITM_NBR                                         03350002
                    , A.VERFYD_TMST                                     03360002
                FROM    TRECITM A                                       03370002
                      , TRECDIS B                                       03380002
                WHERE     A.ORD_NBR        = :DK-PO-NBR                 03390002
                   AND    A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR           03400002
                   AND    A.ORD_LNE_NBR    = :DK-PO-LINE-NBR            03410002
                   AND    A.ORD_NBR        =  B.ORD_NBR                 03420002
                   AND    A.ORD_LNE_NBR    =  B.ORD_LNE_NBR             03430002
                   AND    A.REC_SEQ_NBR    =  B.REC_SEQ_NBR             03440002
                   AND    A.VER_STATUS_CDE = 'A'                        03450002
                ORDER BY A.ORD_LNE_NBR,B.STR_NBR                        03460002
           END-EXEC                                                     03470002
                                                                        03480002
      ***************************************************************** 03490002
      *  PREPACK LINE CURSOR                                            03500002
      ***************************************************************** 03510002
           EXEC SQL                                                     03520002
             DECLARE PREPK-LINE-CSR CURSOR FOR                          03530002
                SELECT DISTINCT                                         03540002
                       T1.STR_NBR                                       03550002
                     , T1.PREPK_RATO_QTY                                03560002
                     , T1.AP_VERIFY_ITM_QTY                             03570002
                     , T1.VERIFY_ITM_QTY                                03580002
                     , T1.VERFYD_TMST                                   03590002
                     , COALESCE(T2.DC_VRFY_ODU_QTY,0)                   03600002
                     , COALESCE(T2.AP_VRFY_ODU_QTY,0)                   03610002
                FROM                                                    03620002
                ( SELECT DISTINCT                                       03630002
                         A.STR_NBR                                      03640002
                       , A.AP_VERIFY_ITM_QTY                            03650002
                       , A.VERIFY_ITM_QTY                               03660002
                       , B.ORD_LNE_NBR                                  03670002
                       , B.PREPK_RATO_QTY                               03680002
                       , B.PREPK_ID                                     03690002
                       , B.VERFYD_TMST                                  03700002
                    FROM TRECDIS A                                      03710002
                       , TRECITM B                                      03720002
                   WHERE B.ORD_NBR      = :DK-PO-NBR                    03730002
                     AND B.REC_SEQ_NBR  = :DK-RCVR-SEQ-NBR              03740002
                     AND B.PREPK_ID     = :RECITM-PREPK-ID              03750002
                     AND A.ORD_NBR      = B.ORD_NBR                     03760002
                     AND A.ORD_LNE_NBR  = B.ORD_LNE_NBR                 03770002
                     AND A.REC_SEQ_NBR  = B.REC_SEQ_NBR                 03780002
                     AND B.VER_STATUS_CDE = 'A'                         03790002
                     AND B.PREPK_DRV_LNE_CDE = 'A') AS T1               03800002
               LEFT OUTER JOIN                                          03810002
                                                                        03820002
                 (SELECT A.STR_NBR                                      03830002
                       , PO_LNE_NBR                                     03840002
                       , DC_VRFY_ODU_QTY                                03850002
                       , AP_VRFY_ODU_QTY                                03860002
                   FROM  RCT_VRFD_ODD_UNT A                             03870002
                   WHERE PO_NBR         = :DK-PO-NBR                    03880002
                     AND RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR) AS T2       03890002
               ON  T1.STR_NBR    = T2.STR_NBR                           03900002
                AND T1.ORD_LNE_NBR   =   T2.PO_LNE_NBR                  03910002
               ORDER BY T1.STR_NBR                                      03920002
           END-EXEC                                                     03930002
                                                                        03940002
      ***************************************************************** 03950002
      *  ODD UNITS CURSOR                                               03960002
      ***************************************************************** 03970002
           EXEC SQL                                                     03980002
             DECLARE ODD-UNITS-CSR CURSOR FOR                           03990002
                SELECT DISTINCT                                         04000002
                       STR_NBR                                          04010002
                     , PO_LNE_NBR                                       04020002
                     , DC_VRFY_ODU_QTY                                  04030002
                     , AP_VRFY_ODU_QTY                                  04040002
                 FROM RCT_VRFD_ODD_UNT A                                04050002
                    , TRECITM B                                         04060002
                 WHERE A.PO_NBR         = :DK-PO-NBR                    04070002
                   AND A.RCVR_SEQ_NBR   = :DK-RCVR-SEQ-NBR              04080002
                   AND A.PO_NBR         = B.ORD_NBR                     04090002
                   AND A.RCVR_SEQ_NBR   = B.REC_SEQ_NBR                 04100002
                   AND B.PREPK_ID       = :RECITM-PREPK-ID              04110002
                   AND A.PO_LNE_NBR     = B.ORD_LNE_NBR                 04120002
               ORDER BY PO_LNE_NBR,STR_NBR                              04130002
           END-EXEC                                                     04140002
                                                                        04150002
      ******************************************************************04160002
      *  CURSOR TO COMPARE PURITM AND RECITM FOR PREPACKS               04170002
      ***************************************************************** 04180002
           EXEC SQL                                                     04190002
             DECLARE PREPK-RATIO-CSR CURSOR FOR                         04200002
                  SELECT 'A'                                            04210002
                      ,  A.PREPK_RATO_QTY                               04220002
                      ,  A.ORD_LNE_NBR                                  04230002
                    FROM TRECITM A                                      04240002
                   WHERE A.ORD_NBR           = :DK-PO-NBR               04250002
                     AND A.REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR         04260002
                     AND A.PREPK_ID          = :RECITM-PREPK-ID         04270002
                     AND A.VER_STATUS_CDE    = 'A'                      04280002
                  UNION                                                 04290002
                    SELECT 'B'                                          04300002
                        ,  C.PREPK_RATO_QTY                             04310002
                        ,  C.APP_PO_LNE_NBR                             04320002
                      FROM TPURITM C                                    04330002
                     WHERE C.PO_NBR            = :DK-PO-NBR             04340002
                       AND C.PO_PREPK_ID       = :RECITM-PREPK-ID       04350002
                       AND C.VER_STATUS_CDE    = 'A'                    04360002
                 ORDER BY 3                                             04370002
           END-EXEC                                                     04380002
                                                                        04390002
      ******************************************************************04400002
      *  RETURN ALL THE LINES OF A PREPACK                              04410002
      ***************************************************************** 04420002
           EXEC SQL                                                     04430002
             DECLARE PREPK-BY-LNE-CSR CURSOR FOR                        04440002
                SELECT DISTINCT                                         04450002
                       B.ORD_LNE_NBR                                    04460002
                     , B.PREPK_RATO_QTY                                 04470002
                     , B.ITM_NBR                                        04480002
                  FROM TRECDIS A                                        04490002
                     , TRECITM B                                        04500002
                 WHERE B.ORD_NBR      = :DK-PO-NBR                      04510002
                   AND B.REC_SEQ_NBR  = :DK-RCVR-SEQ-NBR                04520002
                   AND B.PREPK_ID     = :RECITM-PREPK-ID                04530002
                   AND A.ORD_NBR      = B.ORD_NBR                       04540002
                   AND A.ORD_LNE_NBR  = B.ORD_LNE_NBR                   04550002
                   AND A.REC_SEQ_NBR  = B.REC_SEQ_NBR                   04560002
                   AND B.VER_STATUS_CDE = 'A'                           04570002
               ORDER BY ORD_LNE_NBR                                     04580002
           END-EXEC                                                     04590002
                                                                        04600002
      ******************************************************************04610002
       LINKAGE SECTION.                                                 04620002
      ******************************************************************04630002
           COPY PCWS238.                                                04640011
                                                                        04650002
      ******************************************************************04660002
       PROCEDURE DIVISION USING PC238-COMM-AREA.                        04670002
      ******************************************************************04680002
       0000-PROGRAM-MAINLINE.                                           04690002
                                                                        04700002
           SET  PC238-MOD-SUCCESSFUL   TO TRUE.                         04710002
           MOVE PC238-PO-NBR           TO DK-PO-NBR.                    04720002
           MOVE PC238-RCVR-SEQ-NBR     TO DK-RCVR-SEQ-NBR.              04730002
           MOVE PC238-PO-LNE-NBR       TO DK-PO-LINE-NBR.               04740002
                                                                        04750002
           PERFORM 0100-INITIALIZE.                                     04760011
           PERFORM 1000-SELECT-CONTROL-TMST.                            04770002
                                                                        04780002
           EVALUATE TRUE                                                04790002
               WHEN PC238-TRANS-TYPE-CDE = PC-B                         04800002
               WHEN PC238-TRANS-TYPE-CDE = PC-D                         04810002
               WHEN PC238-TRANS-TYPE-CDE = PC-Q                         04820002
                   SET PS-NO-RATO-QTY-MISMATCH TO TRUE                  04830002
                   PERFORM 6000-GET-RECITM                              04840002
                   PERFORM 6100-GET-SKU                                 04850002
                   IF PS-RATO-QTY-MISMATCH                              04860005
                      MOVE SPACE TO PC238-VRFY-ADJ-DRIVE-LNE            04870005
                      PERFORM 4500-PROCESS-PREPK-BY-LNE                 04880005
      ***          ELSE                                                 04890005
      ***             PERFORM 2000-PROCESS-ADJUSTMENTS                  04900005
                   END-IF                                               04910002
               WHEN PC238-TRANS-TYPE-CDE = PC-V                         04920002
               WHEN PC238-TRANS-TYPE-CDE = PC-X                         04930002
                   PERFORM 6400-CHECK-FOR-PREPK                         04940002
                   IF PS-PREPK-PO-FOUND                                 04950005
                      PERFORM 4000-CHECK-PREPK-RATIO                    04960005
                                                                        04970005
                      IF PS-RATO-QTY-MISMATCH                           04980005
                         MOVE SPACES TO PC238-VRFY-ADJ-DRIVE-LNE        04990005
                         PERFORM 4500-PROCESS-PREPK-BY-LNE              05000005
                      ELSE                                              05010005
                         SET PS-ODD-UNITS-TRANSACTION-NO TO TRUE        05020005
                         PERFORM 8290-PROCESS-PREPK-LINE-CSR            05030005
                         PERFORM 8610-PROCESS-ODD-UNT-LINES             05040005
                      END-IF                                            05050005
                   ELSE                                                 05060005
                      PERFORM 7800-PROCESS-VERIFY-LINES                 05070005
                   END-IF                                               05080005
           END-EVALUATE.                                                05090002
                                                                        05100002
           PERFORM 0500-RETURN-TO-CALLING-PROGRAM.                      05110005
                                                                        05120005
                                                                        05130011
      *----------------------------------------------------------------*05140011
      * 0100-INITIALIZE.                                               *05150011
      * INITIALIZE FIELDS EACH TIME THIS PROGRAM IS CALLED.            *05160011
      *----------------------------------------------------------------*05170011
       0100-INITIALIZE.                                                 05180011
           MOVE 'Y'                TO PS-FIRST-FETCH-SW.                05190011
           MOVE 'N'                TO PS-ERROR-SW                       05200011
                                      PS-END-ADJUSTMENTS-TSQ-SW         05210011
                                      PS-SHOW-DEBUG-SW                  05220011
                                      PS-PREPK-PO-FOUND-SW              05230011
                                      PS-END-OF-LINE-STORE-CSR-SW       05240011
                                      PS-END-OF-PREPK-LINE-CSR-SW       05250011
                                      PS-NEW-LINE-FOUND-SW              05260011
                                      PS-END-OF-PREPK-STORE-SW          05270011
                                      PS-END-OF-ODD-UNITS-CSR-SW        05280011
                                      PS-AT-LEAST-ONE-STORE             05290011
                                      PS-END-OF-TABLE-SW                05300011
                                      PS-ODD-UNITS-TRANS-SW             05310011
                                      PS-END-OF-PREPK-RATIO-CSR-SW      05320011
                                      PS-RATO-QTY-MISMATCH-SW           05330011
                                      PS-END-OF-PREPK-BY-LNE-SW         05340011
                                      PS-WROTE-TO-XFER-ONLY-SW.         05350011
                                                                        05360011
           MOVE ZEROES             TO PV-LOD-DAT-TXT-LEN                05370011
                                      PV-MAX-ITEMS                      05380011
                                      PV-INDEX-COUNTER                  05390011
                                      PV-SEL-ITEM                       05400011
                                      PV-VALID-IDX                      05410011
                                      PV-PACK-QTY                       05420011
                                      PV-SKU-NBR                        05430011
                                      PV-BTCH-LOD-SEQ-ID                05440011
                                      PV-LIMIT-DAYS                     05450011
                                      PV-SHPD-QTY-SUM                   05460011
                                      PV-CARTON-COUNT                   05470011
                                      PV-STORE-COUNT                    05480011
                                      PV-LINE-COUNT                     05490011
                                      PV-PREPK-LNE                      05500011
                                      PV-PREPK-RATO-QTY                 05510011
                                      PV-STR-ADJ-QTY                    05520011
                                      PV-PO-LNE-HOLD                    05530011
                                      PV-HOLD-STORE                     05540011
                                      PV-PREV-PREPK-RATO-QTY            05550011
                                      PV-PREV-SEQUENCE                  05560011
                                      PV-NEXT-SEQUENCE                  05570011
                                      PV-DISP-SQLCODE                   05580011
                                      ABEND-CODE                        05590011
                                      PV-VERFIED-TMST                   05600014
                                      PA-WFT-LOD-CNTL-INSERTS           05610014
                                      PA-WFT-LOD-XFER-INSERTS.          05620014
                                                                        05630011
           MOVE SPACES             TO PV-UNION-TYPE                     05640011
                                      PV-PREV-UNION-TYPE                05650011
                                      PV-PARAGRAPH-NAME                 05660011
                                      PV-DB2-OPER-ATTEMPTED             05670011
                                      PV-CURRENT-TMST                   05680011
                                      PV-PRC-CNTL-TMST.                 05690011
                                                                        05700011
           INITIALIZE                 PC241-KEY-FIELDS                  05710011
                                      RD024-HEADER-DATA.                05720011
                                                                        05730011
           PERFORM VARYING RD024-IDX FROM 1 BY 1                        05740011
               UNTIL RD024-IDX   > 100                                  05750011
                 MOVE ZEROES   TO RD024-STORE (RD024-IDX)               05760011
                                  RD024-STORE-QTY (RD024-IDX)           05770011
                 MOVE SPACES   TO RD024-STORE-QTY-SIGN (RD024-IDX)      05780011
           END-PERFORM.                                                 05790011
                                                                        05800005
       0500-RETURN-TO-CALLING-PROGRAM.                                  05810005
142526**   DISPLAY 'PCKUP759 PROCESSED PO ' PC238-PO-NBR                05820020
142526**           ' / LINE ' PC238-PO-LNE-NBR                          05830020
142526**           ' / RECV SEQ ' PC238-RCVR-SEQ-NBR                    05840020
           GOBACK.                                                      05850002
                                                                        05860017
                                                                        05870002
       1000-SELECT-CONTROL-TMST.                                        05880002
           EXEC SQL                                                     05890002
                SET :PV-PRC-CNTL-TMST  = CURRENT TIMESTAMP              05900002
           END-EXEC.                                                    05910002
                                                                        05920002
           EVALUATE TRUE                                                05930002
               WHEN SQLCODE = ZERO                                      05940002
                   CONTINUE                                             05950002
               WHEN OTHER                                               05960002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       05970002
                   MOVE '1000-SELECT-CONTROL-TMST'                      05980002
                                               TO PV-PARAGRAPH-NAME     05990002
                   MOVE 'CURRENT TIMESTAMP'    TO PV-DB2-OPER-ATTEMPTED 06000002
                   SET PC238-DB2-FUNCTION-SELECT TO TRUE                06010004
                   PERFORM Z900-SQL-ABEND                               06020002
           END-EVALUATE.                                                06030002
                                                                        06040002
                                                                        06050002
       2000-PROCESS-ADJUSTMENTS.                                        06060002
           SET PS-NOT-END-ADJUSTMENTS-TSQ   TO TRUE.                    06070005
           MOVE +100                        TO PV-MAX-ITEMS.            06080005
           MOVE +1                          TO PV-SEL-ITEM.             06090005
           SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE.                   06100005
           PERFORM 2200-READ-TS-QUEUE                                   06110005
              UNTIL PS-END-ADJUSTMENTS-TSQ.                             06120005
                                                                        06130002
      ******************************************************************06140002
       2200-READ-TS-QUEUE.                                              06150002
      ***  PERFORM 9100-READ-ADJUST-QUEUE.                              06160005
                                                                        06170002
      ****LOAD AND INSERT 100 STORES AT A TIME                          06180002
           PERFORM VARYING RD024-IDX FROM 1 BY 1                        06190005
                        UNTIL PS-END-ADJUSTMENTS-TSQ OR                 06200005
                        RD024-IDX   > PV-MAX-ITEMS                      06210005
               MOVE PC241-STR-NBR           TO RD024-STORE              06220005
                                              (RD024-IDX)               06230005
               IF PS-RATO-QTY-MISMATCH                                  06240005
                   MOVE PC241-STR-ADJ-QTY       TO PV-STR-ADJ-QTY       06250005
                   COMPUTE PV-STR-ADJ-QTY =                             06260005
                              (PV-PREPK-RATO-QTY * PV-STR-ADJ-QTY )     06270005
                   MOVE PV-STR-ADJ-QTY          TO RD024-STORE-QTY      06280005
                                                   (RD024-IDX)          06290005
               ELSE                                                     06300005
                   MOVE PC241-STR-ADJ-QTY       TO RD024-STORE-QTY      06310005
                                                   (RD024-IDX)          06320005
               END-IF                                                   06330005
                                                                        06340005
               IF PC241-STR-ADJ-QTY > 0                                 06350005
                  MOVE   'P'   TO RD024-STORE-QTY-SIGN                  06360005
                                              (RD024-IDX)               06370005
               ELSE                                                     06380005
                  MOVE   'N'   TO RD024-STORE-QTY-SIGN                  06390005
                                              (RD024-IDX)               06400005
               END-IF                                                   06410005
                                                                        06420005
               IF RD024-STORE-QTY (RD024-IDX) = 0                       06430005
                   SET RD024-IDX DOWN BY 1                              06440005
                   SUBTRACT +1 FROM PV-STORE-COUNT                      06450005
               ELSE                                                     06460005
                   MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                    06470005
               END-IF                                                   06480005
               ADD +1                       TO PV-SEL-ITEM              06490005
                                               PV-STORE-COUNT           06500005
    ***        PERFORM 9100-READ-ADJUST-QUEUE                           06510005
           END-PERFORM.                                                 06520005
                                                                        06530002
           IF AT-LEAST-ONE-STORE                                        06540005
             IF PS-END-ADJUSTMENTS-TSQ                                  06550005
                PERFORM 3200-LOAD-WFT-LOD-XFER                          06560005
                PERFORM 3300-INSERT-WFT-LOD-XFER                        06570005
                PERFORM 3000-LOAD-WFT-LOD-CNTL                          06580005
                PERFORM 3100-INSERT-WFT-LOD-CNTL                        06590005
             ELSE                                                       06600005
                SET PS-WROTE-TO-XFER-ONLY TO TRUE                       06610005
                PERFORM 3200-LOAD-WFT-LOD-XFER                          06620005
                PERFORM 3300-INSERT-WFT-LOD-XFER                        06630005
             END-IF                                                     06640005
             MOVE +0 TO PV-STORE-COUNT                                  06650005
           ELSE                                                         06660005
             IF PS-WROTE-TO-XFER-ONLY                                   06670005
                PERFORM 3000-LOAD-WFT-LOD-CNTL                          06680005
                PERFORM 3100-INSERT-WFT-LOD-CNTL                        06690005
                SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE               06700005
             END-IF                                                     06710005
           END-IF.                                                      06720002
                                                                        06730002
                                                                        06740002
       3000-LOAD-WFT-LOD-CNTL.                                          06750002
            MOVE PV-PRC-CNTL-TMST         TO WFT00001-PRC-CNTL-TMST     06760002
            EVALUATE TRUE                                               06770002
                WHEN PC238-TRANS-TYPE-CDE = PC-B                        06780002
                WHEN PC238-TRANS-TYPE-CDE = PC-D                        06790002
                WHEN PC238-TRANS-TYPE-CDE = PC-Q                        06800002
                  IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     06810002
                     MOVE PC-PCKADJ             TO WFT00001-TRN-TYP-CDE 06820002
                  ELSE                                                  06830002
                     MOVE PC-SKUADJ             TO WFT00001-TRN-TYP-CDE 06840002
                  END-IF                                                06850002
                WHEN PC238-TRANS-TYPE-CDE = PC-V                        06860002
                WHEN PC238-TRANS-TYPE-CDE = PC-X                        06870002
                  IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     06880002
                     IF PS-ODD-UNITS-TRANSACTION                        06890002
                        MOVE PC-SKUVER  TO WFT00001-TRN-TYP-CDE         06900002
                     ELSE                                               06910002
                        MOVE PC-PCKVER  TO WFT00001-TRN-TYP-CDE         06920002
                     END-IF                                             06930002
                  ELSE                                                  06940002
                     MOVE PC-SKUVER     TO WFT00001-TRN-TYP-CDE         06950012
                  END-IF                                                06960002
            END-EVALUATE                                                06970002
                                                                        06980002
            MOVE PC-READY                 TO WFT00001-STAT-CDE          06990002
            MOVE PC-REPOSITORY-DEF-TMST   TO WFT00001-INIT-PRCG-BEG-TMST07000002
                                             WFT00001-END-TMST          07010002
            MOVE SPACES                   TO WFT00001-ARCH-DAT-IND      07020002
            MOVE ZEROES                   TO WFT00001-DAT-LOD-VER-NBR   07030002
            MOVE PC-999                   TO WFT00001-STR-NBR.          07040002
                                                                        07050002
                                                                        07060002
       3100-INSERT-WFT-LOD-CNTL.                                        07070002
           EXEC SQL                                                     07080002
              INSERT INTO WFT_LOD_CNTL                                  07090002
                     ( PRC_CNTL_TMST                                    07100002
                      ,TRN_TYP_CDE                                      07110002
                      ,STAT_CDE                                         07120002
                      ,INIT_PRCG_BEG_TMST                               07130002
                      ,END_TMST                                         07140002
                      ,ARCH_DAT_IND                                     07150002
                      ,DAT_LOD_VER_NBR                                  07160002
                      ,STR_NBR)                                         07170002
              VALUES (:WFT00001-PRC-CNTL-TMST                           07180002
                    , :WFT00001-TRN-TYP-CDE                             07190002
                    , :WFT00001-STAT-CDE                                07200002
                    , :WFT00001-INIT-PRCG-BEG-TMST                      07210002
                    , :WFT00001-END-TMST                                07220002
                    , :WFT00001-ARCH-DAT-IND                            07230002
                    , :WFT00001-DAT-LOD-VER-NBR                         07240002
                    , :WFT00001-STR-NBR)                                07250002
           END-EXEC.                                                    07260002
                                                                        07270002
           EVALUATE TRUE                                                07280002
               WHEN SQLCODE = ZERO                                      07290002
                   ADD 1      TO PA-WFT-LOD-CNTL-INSERTS                07300013
               WHEN OTHER                                               07310002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       07320002
                   MOVE '3100-INSERT-WFT-LOD-CNTL'                      07330002
                                               TO PV-PARAGRAPH-NAME     07340002
                   MOVE 'WFT00001        '     TO PV-DB2-OPER-ATTEMPTED 07350002
                   MOVE WFT00001-STR-NBR       TO PV-DISPLAY-STR-NBR    07360002
                   DISPLAY 'STR-NBR = '           PV-DISPLAY-STR-NBR    07370002
                   SET PC238-DB2-FUNCTION-INSERT TO TRUE                07380004
                   PERFORM Z900-SQL-ABEND                               07390002
           END-EVALUATE.                                                07400002
                                                                        07410002
                                                                        07420002
       3200-LOAD-WFT-LOD-XFER.                                          07430002
            MOVE PV-PRC-CNTL-TMST         TO WFT00002-PRC-CNTL-TMST     07440002
            EVALUATE TRUE                                               07450002
                WHEN PC238-TRANS-TYPE-CDE = PC-B                        07460002
                WHEN PC238-TRANS-TYPE-CDE = PC-D                        07470002
                WHEN PC238-TRANS-TYPE-CDE = PC-Q                        07480002
                  IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     07490002
                     MOVE PC-PCKADJ             TO WFT00002-TRN-TYP-CDE 07500002
                  ELSE                                                  07510002
                     MOVE PC-SKUADJ             TO WFT00002-TRN-TYP-CDE 07520002
                  END-IF                                                07530002
                WHEN PC238-TRANS-TYPE-CDE = PC-V                        07540002
                WHEN PC238-TRANS-TYPE-CDE = PC-X                        07550002
                  IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                     07560002
                     IF PS-ODD-UNITS-TRANSACTION                        07570002
                        MOVE PC-SKUVER  TO WFT00002-TRN-TYP-CDE         07580002
                     ELSE                                               07590002
                        MOVE PC-PCKVER  TO WFT00002-TRN-TYP-CDE         07600002
                     END-IF                                             07610002
                  ELSE                                                  07620002
                     MOVE PC-SKUVER     TO WFT00002-TRN-TYP-CDE         07630011
                  END-IF                                                07640002
            END-EVALUATE                                                07650002
               MOVE PV-PRC-CNTL-TMST  TO PV-CURRENT-TMST                07660002
               MOVE PV-CURR-YYYY      TO PV-CURR-YYYY-VRFD              07670002
               MOVE PV-CURR-MM        TO PV-CURR-MM-VRFD                07680002
               MOVE PV-CURR-DD        TO PV-CURR-DD-VRFD                07690002
               MOVE PV-CURR-HH        TO PV-CURR-HH-VRFD                07700002
               MOVE PV-CURR-MN        TO PV-CURR-MN-VRFD                07710002
               MOVE PV-CURR-SS        TO PV-CURR-SS-VRFD                07720002
                                                                        07730002
               MOVE PV-VERFIED-TMST   TO RD024-VRFY-DATE                07740002
                                                                        07750002
            MOVE PC238-PO-NBR             TO RD024-ORDER-NUMBER         07760002
            MOVE PC238-RCVR-SEQ-NBR       TO RD024-RCVR-ID              07770002
            IF PC238-DIRECT-STORE-YES                                   07780002
                IF PC238-TRANS-TYPE-CDE = PC-B OR PC-D OR PC-Q          07790002
                    MOVE PC241-STR-NBR        TO RD024-DC               07800002
                ELSE                                                    07810002
                    MOVE RECDIS-STR-NBR       TO RD024-DC               07820002
            ELSE                                                        07830002
      *         MOVE PC238-WRKD-OPER-UNT-ID   TO RD024-DC               07840002
                PERFORM 9300-GET-TRECEIV-OPER-UNT-ID                    07850002
                MOVE RECEIV-OPER-UNT-ID       TO RD024-DC               07860002
            END-IF                                                      07870002
            MOVE PV-SKU-NBR               TO RD024-SKU                  07880002
            MOVE PV-STORE-COUNT           TO RD024-STORE-COUNT          07890002
                                                                        07900002
            ADD +1                        TO PV-BTCH-LOD-SEQ-ID.        07910002
            MOVE PV-BTCH-LOD-SEQ-ID       TO WFT00002-BTCH-LOD-SEQ-ID.  07920002
                                                                        07930002
            COMPUTE PV-LOD-DAT-TXT-LEN = (100 + (14 * PV-STORE-COUNT)). 07940002
            MOVE PV-LOD-DAT-TXT-LEN TO WFT00002-LOD-DAT-TXT-LEN.        07950002
                                                                        07960002
            MOVE RD024-RECEIPT-ADJUSTMENT-REC                           07970002
                                      TO WFT00002-LOD-DAT-TXT-TEXT.     07980002
                                                                        07990002
                                                                        08000002
       3300-INSERT-WFT-LOD-XFER.                                        08010002
           EXEC SQL                                                     08020002
              INSERT INTO WFT_LOD_XFER                                  08030002
                     ( PRC_CNTL_TMST                                    08040002
                      ,TRN_TYP_CDE                                      08050002
                      ,BTCH_LOD_SEQ_ID                                  08060002
                      ,LOD_DAT_TXT )                                    08070002
              VALUES (:WFT00002-PRC-CNTL-TMST                           08080002
                     ,:WFT00002-TRN-TYP-CDE                             08090002
                     ,:WFT00002-BTCH-LOD-SEQ-ID                         08100002
                     ,:WFT00002-LOD-DAT-TXT)                            08110002
           END-EXEC.                                                    08120002
                                                                        08130002
           EVALUATE TRUE                                                08140002
               WHEN SQLCODE = ZERO                                      08150002
                   ADD 1      TO PA-WFT-LOD-XFER-INSERTS                08160013
               WHEN OTHER                                               08170002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       08180002
                   MOVE '3300-INSERT-WFT-LOD-XFER'                      08190002
                                               TO PV-PARAGRAPH-NAME     08200002
                   MOVE 'WFT00002        '     TO PV-DB2-OPER-ATTEMPTED 08210002
                   DISPLAY 'TRN-TYP-CDE = '   WFT00002-TRN-TYP-CDE      08220002
                   MOVE RD024-DC               TO PV-DISPLAY-STR-NBR    08230002
                   DISPLAY 'STR-NBR = '           PV-DISPLAY-STR-NBR    08240002
                   SET PC238-DB2-FUNCTION-INSERT TO TRUE                08250004
                   PERFORM Z900-SQL-ABEND                               08260002
           END-EVALUATE.                                                08270002
                                                                        08280002
       4000-CHECK-PREPK-RATIO.                                          08290002
           SET PS-NOT-END-OF-PREPK-RATIO-CSR                            08300002
               PS-NO-RATO-QTY-MISMATCH       TO TRUE.                   08310002
           PERFORM 4100-OPEN-PREPK-RATIO-CSR                            08320002
           PERFORM 4200-FETCH-PREPK-RATIO-CSR                           08330002
                   UNTIL PS-END-OF-PREPK-RATIO-CSR OR                   08340002
                         PS-RATO-QTY-MISMATCH                           08350005
           PERFORM 4300-CLOSE-PREPK-RATIO-CSR.                          08360002
                                                                        08370002
                                                                        08380002
       4100-OPEN-PREPK-RATIO-CSR.                                       08390002
                                                                        08400002
           EXEC SQL                                                     08410002
                OPEN PREPK-RATIO-CSR                                    08420002
           END-EXEC.                                                    08430002
                                                                        08440002
           EVALUATE TRUE                                                08450002
               WHEN SQLCODE = ZERO                                      08460002
                    CONTINUE                                            08470002
               WHEN OTHER                                               08480002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       08490002
                   MOVE '4100-OPEN-PREPK-RATIO-CSR'                     08500002
                                               TO PV-PARAGRAPH-NAME     08510002
                   MOVE 'TRECITM, TPURITEM'    TO PV-DB2-OPER-ATTEMPTED 08520002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   08530002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   08540002
                   SET PC238-DB2-FUNCTION-OPEN TO TRUE                  08550004
                   PERFORM Z900-SQL-ABEND                               08560002
           END-EVALUATE.                                                08570002
                                                                        08580002
                                                                        08590002
       4200-FETCH-PREPK-RATIO-CSR.                                      08600002
                                                                        08610002
           EXEC SQL                                                     08620002
                FETCH PREPK-RATIO-CSR                                   08630002
                 INTO :PV-UNION-TYPE                                    08640002
                   ,  :PURITM-PREPK-RATO-QTY                            08650002
                   ,  :PURITM-APP-PO-LNE-NBR                            08660002
           END-EXEC.                                                    08670002
                                                                        08680002
           EVALUATE TRUE                                                08690002
               WHEN SQLCODE = ZERO                                      08700002
                  IF PS-FIRST-FETCH                                     08710002
      * FIRST LINE CANNOT BE A 'B'                                      08720002
                     IF PV-UNION-TYPE = 'B'                             08730002
                        SET PS-RATO-QTY-MISMATCH  TO TRUE               08740002
                     ELSE                                               08750002
                        MOVE PURITM-PREPK-RATO-QTY TO                   08760002
                                 PV-PREV-PREPK-RATO-QTY                 08770002
                        MOVE PV-UNION-TYPE TO PV-PREV-UNION-TYPE        08780002
                        SET PS-NOT-FIRST-FETCH TO TRUE                  08790002
                     END-IF                                             08800002
                  ELSE                                                  08810002
                    IF PV-UNION-TYPE = PV-PREV-UNION-TYPE               08820002
                        SET PS-RATO-QTY-MISMATCH  TO TRUE               08830002
                    ELSE                                                08840002
                      IF PV-UNION-TYPE = 'B'                            08850002
                        IF PURITM-PREPK-RATO-QTY  =                     08860002
                                            PV-PREV-PREPK-RATO-QTY      08870002
                            MOVE PV-UNION-TYPE  TO PV-PREV-UNION-TYPE   08880002
                        ELSE                                            08890002
                            SET PS-RATO-QTY-MISMATCH  TO TRUE           08900002
                        END-IF                                          08910002
                      ELSE                                              08920002
                        MOVE PV-UNION-TYPE  TO PV-PREV-UNION-TYPE       08930002
                        MOVE PURITM-PREPK-RATO-QTY TO                   08940002
                                                PV-PREV-PREPK-RATO-QTY  08950002
                      END-IF                                            08960002
                    END-IF                                              08970002
                  END-IF                                                08980002
                                                                        08990002
               WHEN SQLCODE = +100                                      09000002
                   IF PV-PREV-UNION-TYPE  = 'A'                         09010002
                      SET PS-RATO-QTY-MISMATCH  TO TRUE                 09020002
                   END-IF                                               09030002
                   SET PS-END-OF-PREPK-RATIO-CSR TO TRUE                09040002
               WHEN OTHER                                               09050002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       09060002
                   MOVE '4200-FETCH-PREPK-RATIO-CSR'                    09070002
                                               TO PV-PARAGRAPH-NAME     09080002
                   MOVE 'TRECITM, TPURITEM'    TO PV-DB2-OPER-ATTEMPTED 09090002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   09100002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   09110002
                   SET PC238-DB2-FUNCTION-FETCH TO TRUE                 09120004
                   PERFORM Z900-SQL-ABEND                               09130002
           END-EVALUATE.                                                09140002
                                                                        09150002
                                                                        09160002
      *----------------------------------------------------------------*09170002
      * CLOSE THE LINE STORE CURSOR                                  *  09180002
      *----------------------------------------------------------------*09190002
       4300-CLOSE-PREPK-RATIO-CSR.                                      09200002
                                                                        09210002
           EXEC SQL                                                     09220002
                CLOSE PREPK-RATIO-CSR                                   09230002
           END-EXEC.                                                    09240002
                                                                        09250002
           EVALUATE TRUE                                                09260002
               WHEN SQLCODE = ZERO                                      09270002
                    CONTINUE                                            09280002
               WHEN OTHER                                               09290002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       09300002
                   MOVE '4300-CLOSE-PREPK-RATIO-CSR'                    09310002
                                               TO PV-PARAGRAPH-NAME     09320002
                   MOVE 'TRECITM, TPURITEM'    TO PV-DB2-OPER-ATTEMPTED 09330002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   09340002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   09350002
                   SET PC238-DB2-FUNCTION-CLOSE TO TRUE                 09360004
                   PERFORM Z900-SQL-ABEND                               09370002
           END-EVALUATE.                                                09380002
                                                                        09390002
                                                                        09400002
       4500-PROCESS-PREPK-BY-LNE.                                       09410002
           SET PS-NOT-END-OF-PREPK-BY-LNE TO TRUE                       09420002
           PERFORM 4600-OPEN-PREPK-BY-LNE                               09430002
           PERFORM 4700-FETCH-PREPK-BY-LNE                              09440002
                   UNTIL PS-END-OF-PREPK-BY-LNE                         09450005
           PERFORM 4800-CLOSE-PREPK-BY-LNE.                             09460002
                                                                        09470002
                                                                        09480002
       4600-OPEN-PREPK-BY-LNE.                                          09490002
                                                                        09500002
           EXEC SQL                                                     09510002
                OPEN PREPK-BY-LNE-CSR                                   09520002
           END-EXEC.                                                    09530002
                                                                        09540002
           EVALUATE TRUE                                                09550002
               WHEN SQLCODE = ZERO                                      09560002
                    CONTINUE                                            09570002
               WHEN OTHER                                               09580002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       09590002
                   MOVE '4600-OPEN-PREPK-BY-LNE'                        09600002
                                               TO PV-PARAGRAPH-NAME     09610002
                   MOVE 'TRECDIS, TRECITM'     TO PV-DB2-OPER-ATTEMPTED 09620002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   09630002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   09640002
                   SET PC238-DB2-FUNCTION-OPEN TO TRUE                  09650004
                   PERFORM Z900-SQL-ABEND                               09660002
           END-EVALUATE.                                                09670002
                                                                        09680002
                                                                        09690002
       4700-FETCH-PREPK-BY-LNE.                                         09700002
                                                                        09710002
           EXEC SQL                                                     09720002
                FETCH PREPK-BY-LNE-CSR                                  09730002
                 INTO :PV-PREPK-LNE                                     09740002
                    , :PV-PREPK-RATO-QTY                                09750002
                    , :RECITM-ITM-NBR                                   09760002
           END-EXEC.                                                    09770002
                                                                        09780002
           EVALUATE TRUE                                                09790002
               WHEN SQLCODE = ZERO                                      09800002
                    MOVE PV-PREPK-LNE TO DK-PO-LINE-NBR                 09810002
                    IF PC238-TRANS-TYPE-CDE = (PC-V OR PC-X)            09820002
                       PERFORM 7800-PROCESS-VERIFY-LINES                09830002
                    ELSE                                                09840002
                       MOVE +0 TO PV-BTCH-LOD-SEQ-ID                    09850002
                       PERFORM 1000-SELECT-CONTROL-TMST                 09860002
                       PERFORM 6300-SELECT-XLT-SKU                      09870002
      ***              PERFORM 2000-PROCESS-ADJUSTMENTS                 09880002
                    END-IF                                              09890002
               WHEN SQLCODE = +100                                      09900002
                   SET PS-END-OF-PREPK-BY-LNE TO TRUE                   09910002
               WHEN OTHER                                               09920002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       09930002
                   MOVE '4700-FETCH-PREPK-BY-LNE'                       09940002
                                               TO PV-PARAGRAPH-NAME     09950002
                   MOVE 'TRECDIS, TRECITM'     TO PV-DB2-OPER-ATTEMPTED 09960002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   09970002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   09980002
                   SET PC238-DB2-FUNCTION-FETCH TO TRUE                 09990004
                   PERFORM Z900-SQL-ABEND                               10000002
           END-EVALUATE.                                                10010002
                                                                        10020002
      *----------------------------------------------------------------*10030002
      * CLOSE THE LINE STORE CURSOR                                  *  10040002
      *----------------------------------------------------------------*10050002
       4800-CLOSE-PREPK-BY-LNE.                                         10060002
                                                                        10070002
           EXEC SQL                                                     10080002
                CLOSE PREPK-BY-LNE-CSR                                  10090002
           END-EXEC.                                                    10100002
                                                                        10110002
           EVALUATE TRUE                                                10120002
               WHEN SQLCODE = ZERO                                      10130002
                    CONTINUE                                            10140002
               WHEN OTHER                                               10150002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       10160002
                   MOVE '4800-CLOSE-PREPK-BY-LNE'                       10170002
                                               TO PV-PARAGRAPH-NAME     10180002
                   MOVE 'TRECDIS, TRECITM'     TO PV-DB2-OPER-ATTEMPTED 10190002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   10200002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   10210002
                   SET PC238-DB2-FUNCTION-CLOSE TO TRUE                 10220004
                   PERFORM Z900-SQL-ABEND                               10230002
           END-EVALUATE.                                                10240002
                                                                        10250002
                                                                        10260002
       6000-GET-RECITM.                                                 10270002
                                                                        10280002
           MOVE PC238-PO-NBR        TO DK-PO-NBR                        10290002
           MOVE PC238-RCVR-SEQ-NBR  TO DK-RCVR-SEQ-NBR                  10300002
           MOVE PC238-PO-LNE-NBR    TO DK-PO-LINE-NBR                   10310002
                                                                        10320002
           EXEC SQL                                                     10330002
                SELECT PREPK_ID                                         10340002
                      ,ITM_NBR                                          10350002
                      ,PREPK_DRV_LNE_CDE                                10360002
                 INTO  :RECITM-PREPK-ID                                 10370002
                      ,:RECITM-ITM-NBR                                  10380002
                      ,:RECITM-PREPK-DRV-LNE-CDE                        10390002
                  FROM TRECITM                                          10400002
                 WHERE ORD_NBR             = :DK-PO-NBR                 10410002
                   AND REC_SEQ_NBR         = :DK-RCVR-SEQ-NBR           10420002
                   AND ORD_LNE_NBR         = :DK-PO-LINE-NBR            10430002
           END-EXEC.                                                    10440002
                                                                        10450002
           EVALUATE TRUE                                                10460002
               WHEN SQLCODE = ZERO                                      10470002
                   CONTINUE                                             10480002
               WHEN OTHER                                               10490002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       10500002
                   MOVE '6000-GET-RECITM'      TO PV-PARAGRAPH-NAME     10510002
                   MOVE 'TRECITM   '           TO PV-DB2-OPER-ATTEMPTED 10520002
                   SET PC238-DB2-FUNCTION-SELECT TO TRUE                10530004
                   PERFORM Z900-SQL-ABEND                               10540002
           END-EVALUATE.                                                10550002
                                                                        10560002
       6100-GET-SKU.                                                    10570002
                                                                        10580002
            IF PC238-VRFY-ADJ-DRIVE-LNE = 'A'                           10590002
               PERFORM 4000-CHECK-PREPK-RATIO                           10600002
               IF PS-RATO-QTY-MISMATCH                                  10610002
                  CONTINUE                                              10620002
               ELSE                                                     10630002
                  PERFORM 6200-SELECT-TPOPRPK                           10640002
               END-IF                                                   10650002
            ELSE                                                        10660002
               PERFORM 6300-SELECT-XLT-SKU                              10670002
            END-IF.                                                     10680002
                                                                        10690002
                                                                        10700002
       6200-SELECT-TPOPRPK.                                             10710002
                                                                        10720002
           EXEC SQL                                                     10730002
                SELECT PK_SKU_NBR                                       10740002
                 INTO  :POPRPK-PK-SKU-NBR                               10750002
                  FROM TPOPRPK                                          10760002
                 WHERE PO_NBR              = :DK-PO-NBR                 10770002
                   AND PO_PREPK_ID         = :RECITM-PREPK-ID           10780002
           END-EXEC.                                                    10790002
                                                                        10800002
           EVALUATE TRUE                                                10810002
               WHEN SQLCODE = ZERO                                      10820002
                   MOVE POPRPK-PK-SKU-NBR  TO PV-SKU-NBR                10830002
               WHEN OTHER                                               10840002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       10850002
                   MOVE '6200-SELECT-TPOPRPK'  TO PV-PARAGRAPH-NAME     10860002
                   MOVE 'TPOPRPK         '     TO PV-DB2-OPER-ATTEMPTED 10870002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   10880002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   10890002
                   SET PC238-DB2-FUNCTION-SELECT TO TRUE                10900004
                   PERFORM Z900-SQL-ABEND                               10910002
           END-EVALUATE.                                                10920002
                                                                        10930002
                                                                        10940002
       6300-SELECT-XLT-SKU.                                             10950002
                                                                        10960002
           EXEC SQL                                                     10970002
                SELECT SKU_NBR                                          10980002
                 INTO  :XLT00003-SKU-NBR                                10990002
                  FROM XLT_SKU                                          11000002
                 WHERE ITM_NBR             = :RECITM-ITM-NBR            11010002
           END-EXEC.                                                    11020002
                                                                        11030002
           EVALUATE TRUE                                                11040002
               WHEN SQLCODE = ZERO                                      11050002
                   MOVE XLT00003-SKU-NBR  TO PV-SKU-NBR                 11060002
               WHEN OTHER                                               11070002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       11080002
                   MOVE '6300-SELECT-XLT-SKU'  TO PV-PARAGRAPH-NAME     11090002
                   MOVE 'XLT_SKU  '            TO PV-DB2-OPER-ATTEMPTED 11100002
                   DISPLAY 'ITM-NBR = '           RECITM-ITM-NBR        11110007
                   SET PC238-DB2-FUNCTION-SELECT TO TRUE                11120004
                   PERFORM Z900-SQL-ABEND                               11130002
           END-EVALUATE.                                                11140002
                                                                        11150002
                                                                        11160002
       6350-SELECT-LINE-SKU.                                            11170002
                                                                        11180002
           EXEC SQL                                                     11190002
                SELECT SKU_NBR                                          11200002
                 INTO  :XLT00003-SKU-NBR                                11210002
                 FROM  TRECITM A                                        11220002
                    ,  XLT_SKU C                                        11230002
                 WHERE A.ORD_NBR        = :DK-PO-NBR                    11240002
                   AND A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              11250002
                   AND A.ORD_LNE_NBR    = :DK-PO-LINE-NBR               11260002
                   AND A.ITM_NBR        = C.ITM_NBR                     11270002
           END-EXEC                                                     11280002
                                                                        11290002
           EVALUATE TRUE                                                11300002
               WHEN SQLCODE = ZERO                                      11310002
                   MOVE XLT00003-SKU-NBR  TO PV-SKU-NBR                 11320002
               WHEN OTHER                                               11330002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       11340002
                   MOVE '6350-SELECT-LINE-SKU' TO PV-PARAGRAPH-NAME     11350002
                   MOVE 'TRECITM, XLT_SKU  '   TO PV-DB2-OPER-ATTEMPTED 11360002
                   SET PC238-DB2-FUNCTION-SELECT TO TRUE                11370004
                   PERFORM Z900-SQL-ABEND                               11380002
           END-EVALUATE.                                                11390002
                                                                        11400002
                                                                        11410002
       6400-CHECK-FOR-PREPK.                                            11420002
                                                                        11430002
           EXEC SQL                                                     11440002
              SELECT A.PREPK_ID                                         11450002
              INTO   :RECITM-PREPK-ID                                   11460002
              FROM   TRECITM A                                          11470002
                  ,  TPURITM B                                          11480002
               WHERE A.ORD_NBR     = :DK-PO-NBR                         11490002
                 AND A.REC_SEQ_NBR = :DK-RCVR-SEQ-NBR                   11500002
                 AND A.ORD_LNE_NBR = :DK-PO-LINE-NBR                    11510002
                 AND A.ORD_NBR     = B.PO_NBR                           11520002
                 AND A.ORD_LNE_NBR = B.APP_PO_LNE_NBR                   11530002
                 AND A.PO_VER_NBR  = B.VER_NBR                          11540002
                 AND A.VER_STATUS_CDE = 'A'                             11550002
           END-EXEC.                                                    11560002
                                                                        11570002
           EVALUATE TRUE                                                11580002
               WHEN SQLCODE = ZERO                                      11590002
               WHEN SQLCODE = -811                                      11600002
                    IF RECITM-PREPK-ID > 0                              11610002
                       SET PS-PREPK-PO-FOUND TO TRUE                    11620002
                    ELSE                                                11630002
                       SET PS-PREPK-PO-NOT-FOUND TO TRUE                11640002
                    END-IF                                              11650002
               WHEN OTHER                                               11660002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       11670002
                   MOVE '6400-CHECK-FOR-PREPK' TO PV-PARAGRAPH-NAME     11680002
                   MOVE 'TRECITM, TPURITM  '   TO PV-DB2-OPER-ATTEMPTED 11690002
                   SET PC238-DB2-FUNCTION-SELECT TO TRUE                11700004
                   PERFORM Z900-SQL-ABEND                               11710002
           END-EVALUATE.                                                11720002
                                                                        11730002
                                                                        11740002
       7800-PROCESS-VERIFY-LINES.                                       11750002
           SET PS-NOT-END-OF-LINE-STORE-CSR                             11760002
               PS-FIRST-FETCH                TO TRUE                    11770002
           SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE                    11780002
           PERFORM 7900-OPEN-LINE-STORE-CSR                             11790002
           PERFORM 8000-FETCH-LINE-STORE-CSR                            11800002
           PERFORM 8200-LOAD-VERIFIED-RECEIPTS                          11810002
                   UNTIL PS-END-OF-LINE-STORE-CSR                       11820005
           PERFORM 8100-CLOSE-LINE-STORE-CSR.                           11830002
                                                                        11840002
                                                                        11850002
                                                                        11860002
       7900-OPEN-LINE-STORE-CSR.                                        11870002
                                                                        11880002
           EXEC SQL                                                     11890002
                OPEN LINE-STORE-CSR                                     11900002
           END-EXEC.                                                    11910002
                                                                        11920002
           EVALUATE TRUE                                                11930002
               WHEN SQLCODE = ZERO                                      11940002
                    CONTINUE                                            11950002
               WHEN OTHER                                               11960002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       11970002
                   MOVE '7900-OPEN-LINE-STORE-CSR'                      11980002
                                               TO PV-PARAGRAPH-NAME     11990002
                   MOVE 'TRECITM, TRECDIS'     TO PV-DB2-OPER-ATTEMPTED 12000002
                   SET PC238-DB2-FUNCTION-OPEN TO TRUE                  12010004
                   PERFORM Z900-SQL-ABEND                               12020002
           END-EVALUATE.                                                12030002
                                                                        12040002
                                                                        12050002
       8000-FETCH-LINE-STORE-CSR.                                       12060002
                                                                        12070002
           EXEC SQL                                                     12080002
                FETCH LINE-STORE-CSR                                    12090002
                 INTO :RECITM-ORD-LNE-NBR                               12100002
                   ,  :RECDIS-STR-NBR                                   12110002
                   ,  :RECDIS-AP-VERIFY-ITM-QTY                         12120002
                   ,  :RECDIS-VERIFY-ITM-QTY                            12130002
                   ,  :RECITM-ITM-NBR                                   12140002
                   ,  :RECITM-VERFYD-TMST                               12150002
           END-EXEC.                                                    12160002
                                                                        12170002
           EVALUATE TRUE                                                12180002
               WHEN SQLCODE = ZERO                                      12190002
                   IF PS-FIRST-FETCH                                    12200002
                      SET PS-NOT-FIRST-FETCH TO TRUE                    12210002
                      MOVE RECITM-ORD-LNE-NBR TO PV-PO-LNE-HOLD         12220002
                      MOVE RECITM-VERFYD-TMST  TO PV-CURRENT-TMST       12230002
                      PERFORM 1000-SELECT-CONTROL-TMST                  12240002
                      PERFORM 6300-SELECT-XLT-SKU                       12250002
                   END-IF                                               12260002
               WHEN SQLCODE = +100                                      12270002
                   SET PS-END-OF-LINE-STORE-CSR TO TRUE                 12280002
                   IF PS-NOT-FIRST-FETCH                                12290002
                      MOVE ZEROES TO PV-PO-LNE-HOLD                     12300002
                   END-IF                                               12310002
               WHEN OTHER                                               12320002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       12330002
                   MOVE '8000-FETCH-LINE-STORE-CSR'                     12340002
                                               TO PV-PARAGRAPH-NAME     12350002
                   MOVE 'TRECITM, TRECDIS'     TO PV-DB2-OPER-ATTEMPTED 12360002
                   SET PC238-DB2-FUNCTION-FETCH TO TRUE                 12370004
                   PERFORM Z900-SQL-ABEND                               12380002
           END-EVALUATE.                                                12390002
                                                                        12400002
      *----------------------------------------------------------------*12410002
      * CLOSE THE LINE STORE CURSOR                                  *  12420002
      *----------------------------------------------------------------*12430002
       8100-CLOSE-LINE-STORE-CSR.                                       12440002
                                                                        12450002
           EXEC SQL                                                     12460002
                CLOSE LINE-STORE-CSR                                    12470002
           END-EXEC.                                                    12480002
                                                                        12490002
           EVALUATE TRUE                                                12500002
               WHEN SQLCODE = ZERO                                      12510002
                    CONTINUE                                            12520002
               WHEN OTHER                                               12530002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       12540002
                   MOVE '8100-CLOSE-LINE-STORE-CSR'                     12550002
                                               TO PV-PARAGRAPH-NAME     12560002
                   MOVE 'TRECITM, TRECDIS'     TO PV-DB2-OPER-ATTEMPTED 12570002
                   SET PC238-DB2-FUNCTION-CLOSE TO TRUE                 12580004
                   PERFORM Z900-SQL-ABEND                               12590002
           END-EVALUATE.                                                12600002
                                                                        12610002
                                                                        12620002
       8200-LOAD-VERIFIED-RECEIPTS.                                     12630002
             MOVE +100 TO PV-MAX-ITEMS                                  12640002
             PERFORM VARYING RD024-IDX FROM 1 BY 1                      12650002
                          UNTIL RD024-IDX > PV-MAX-ITEMS OR             12660002
                          PS-NEW-LINE-FOUND                             12670002
                 MOVE RECDIS-STR-NBR  TO       RD024-STORE              12680002
                                                (RD024-IDX)             12690002
                 IF PC238-TRANS-LINE-VERIFY                             12700002
                     MOVE RECDIS-AP-VERIFY-ITM-QTY TO RD024-STORE-QTY   12710002
                                                (RD024-IDX)             12720002
                    MOVE   'P'   TO RD024-STORE-QTY-SIGN                12730002
                                                (RD024-IDX)             12740002
                 ELSE                                                   12750002
                     MOVE RECDIS-VERIFY-ITM-QTY TO RD024-STORE-QTY      12760002
                                                (RD024-IDX)             12770002
                    MOVE   'N'   TO RD024-STORE-QTY-SIGN                12780002
                                                (RD024-IDX)             12790002
                 END-IF                                                 12800002
                 IF RD024-STORE-QTY (RD024-IDX) = 0                     12810002
                     SET RD024-IDX DOWN BY 1                            12820002
                     SUBTRACT +1 FROM PV-STORE-COUNT                    12830002
                 ELSE                                                   12840002
                     MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                  12850002
                 END-IF                                                 12860002
                 PERFORM 8000-FETCH-LINE-STORE-CSR                      12870002
                 IF RECITM-ORD-LNE-NBR  > PV-PO-LNE-HOLD                12880002
                    SET PS-NEW-LINE-FOUND TO TRUE                       12890002
                 END-IF                                                 12900002
                 ADD +1    TO PV-STORE-COUNT                            12910002
             END-PERFORM.                                               12920002
                                                                        12930002
           IF AT-LEAST-ONE-STORE                                        12940002
             IF PS-NEW-LINE-FOUND                                       12950002
                PERFORM 3200-LOAD-WFT-LOD-XFER                          12960002
                PERFORM 3300-INSERT-WFT-LOD-XFER                        12970002
                PERFORM 3000-LOAD-WFT-LOD-CNTL                          12980002
                PERFORM 3100-INSERT-WFT-LOD-CNTL                        12990002
                                                                        13000002
                MOVE +0 TO PV-BTCH-LOD-SEQ-ID                           13010002
                PERFORM 1000-SELECT-CONTROL-TMST                        13020002
                PERFORM 6300-SELECT-XLT-SKU                             13030002
                SET PS-NO-NEW-LINE-FOUND TO TRUE                        13040002
                MOVE RECITM-ORD-LNE-NBR TO PV-PO-LNE-HOLD               13050002
             ELSE                                                       13060002
                SET PS-WROTE-TO-XFER-ONLY TO TRUE                       13070002
                PERFORM 3200-LOAD-WFT-LOD-XFER                          13080002
                PERFORM 3300-INSERT-WFT-LOD-XFER                        13090002
             END-IF                                                     13100002
                                                                        13110002
             MOVE +0    TO PV-STORE-COUNT                               13120002
             SET RD024-IDX  TO +1                                       13130002
             MOVE 'N' TO PS-AT-LEAST-ONE-STORE                          13140002
           ELSE                                                         13150002
             IF PS-NEW-LINE-FOUND                                       13160002
                SET PS-NO-NEW-LINE-FOUND TO TRUE                        13170002
                IF PS-WROTE-TO-XFER-ONLY                                13180002
                   PERFORM 3000-LOAD-WFT-LOD-CNTL                       13190002
                   PERFORM 3100-INSERT-WFT-LOD-CNTL                     13200002
                   SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE            13210002
                END-IF                                                  13220002
             END-IF                                                     13230002
           END-IF.                                                      13240002
                                                                        13250002
       8290-PROCESS-PREPK-LINE-CSR.                                     13260002
           SET PS-NOT-END-OF-PREPK-LINE-CSR                             13270002
               PS-FIRST-FETCH               TO TRUE                     13280002
           MOVE 'N' TO PS-AT-LEAST-ONE-STORE                            13290002
           PERFORM 8300-OPEN-PREPK-LINE-CSR                             13300002
           PERFORM 8400-FETCH-PREPK-LINE-CSR                            13310002
                   UNTIL PS-END-OF-PREPK-LINE-CSR                       13320005
           PERFORM 8500-CLOSE-PREPK-LINE-CSR.                           13330002
                                                                        13340002
                                                                        13350002
       8300-OPEN-PREPK-LINE-CSR.                                        13360002
                                                                        13370002
           EXEC SQL                                                     13380002
                OPEN PREPK-LINE-CSR                                     13390002
           END-EXEC.                                                    13400002
                                                                        13410002
           EVALUATE TRUE                                                13420002
               WHEN SQLCODE = ZERO                                      13430002
                    CONTINUE                                            13440002
               WHEN OTHER                                               13450002
                   MOVE SQLCODE                    TO PV-DISP-SQLCODE   13460002
                   MOVE '8300-OPEN-PREPK-LINE-CSR' TO PV-PARAGRAPH-NAME 13470002
                   MOVE 'CURSOR OPEN FAILED '  TO PV-DB2-OPER-ATTEMPTED 13480002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   13490002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   13500002
                   SET PC238-DB2-FUNCTION-OPEN TO TRUE                  13510004
                   PERFORM Z900-SQL-ABEND                               13520002
           END-EVALUATE.                                                13530002
                                                                        13540002
                                                                        13550002
       8400-FETCH-PREPK-LINE-CSR.                                       13560002
                                                                        13570002
           EXEC SQL                                                     13580002
                FETCH PREPK-LINE-CSR                                    13590002
                 INTO :RECDIS-STR-NBR                                   13600002
                    , :RECITM-PREPK-RATO-QTY                            13610002
                    , :RECDIS-AP-VERIFY-ITM-QTY                         13620002
                    , :RECDIS-VERIFY-ITM-QTY                            13630002
                    , :RECITM-VERFYD-TMST                               13640002
                    , :RCT00009-DC-VRFY-ODU-QTY                         13650002
                    , :RCT00009-AP-VRFY-ODU-QTY                         13660002
           END-EXEC.                                                    13670002
                                                                        13680002
           EVALUATE TRUE                                                13690002
               WHEN SQLCODE = ZERO                                      13700002
                   IF PS-FIRST-FETCH                                    13710002
                      SET PS-NOT-FIRST-FETCH TO TRUE                    13720002
                      MOVE +1 TO PV-INDEX-COUNTER                       13730002
                      MOVE RECITM-VERFYD-TMST  TO PV-CURRENT-TMST       13740002
                      SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE         13750002
                      PERFORM 1000-SELECT-CONTROL-TMST                  13760002
                      PERFORM 6200-SELECT-TPOPRPK                       13770002
                   END-IF                                               13780002
                   PERFORM 8580-PROCESS-VALIDATION-RES                  13790002
               WHEN SQLCODE = +100                                      13800002
                    SET PS-END-OF-PREPK-LINE-CSR  TO TRUE               13810002
                    SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE           13820002
                    PERFORM 8580-PROCESS-VALIDATION-RES                 13830002
               WHEN OTHER                                               13840002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       13850002
                   MOVE '8400-FETCH-PREPK-LINE-CSR'                     13860002
                                               TO PV-PARAGRAPH-NAME     13870002
                   MOVE 'READING TRECITM    '  TO PV-DB2-OPER-ATTEMPTED 13880002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   13890002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   13900002
                   SET PC238-DB2-FUNCTION-FETCH TO TRUE                 13910004
                   PERFORM Z900-SQL-ABEND                               13920002
           END-EVALUATE.                                                13930002
                                                                        13940002
                                                                        13950002
      *----------------------------------------------------------------*13960002
      * CLOSE THE LINE STORE CURSOR                                  *  13970002
      *----------------------------------------------------------------*13980002
       8500-CLOSE-PREPK-LINE-CSR.                                       13990002
                                                                        14000002
           EXEC SQL                                                     14010002
                CLOSE PREPK-LINE-CSR                                    14020002
           END-EXEC.                                                    14030002
                                                                        14040002
           EVALUATE TRUE                                                14050002
               WHEN SQLCODE = ZERO                                      14060002
                    CONTINUE                                            14070002
               WHEN OTHER                                               14080002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       14090002
                   MOVE '8500-CLOSE-PREPK-LINE-CSR'                     14100002
                                               TO PV-PARAGRAPH-NAME     14110002
                   MOVE 'CURSOR CLOSE FAILED ' TO PV-DB2-OPER-ATTEMPTED 14120002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   14130002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   14140002
                   SET PC238-DB2-FUNCTION-CLOSE TO TRUE                 14150004
                   PERFORM Z900-SQL-ABEND                               14160002
           END-EVALUATE.                                                14170002
                                                                        14180002
                                                                        14190002
       8580-PROCESS-VALIDATION-RES.                                     14200002
                                                                        14210002
              SET PS-NOT-END-OF-PREPK-STORE TO TRUE                     14220002
              MOVE +100 TO PV-MAX-ITEMS                                 14230002
              PERFORM VARYING RD024-IDX FROM PV-INDEX-COUNTER BY 1      14240002
                           UNTIL RD024-IDX > PV-MAX-ITEMS OR            14250002
                           PS-END-OF-PREPK-STORE OR                     14260002
                           PS-END-OF-PREPK-LINE-CSR                     14270002
                  MOVE RECDIS-STR-NBR  TO       RD024-STORE             14280002
                                                 (RD024-IDX)            14290002
                  IF PC238-TRANS-LINE-VERIFY                            14300002
                     MOVE   'P'   TO RD024-STORE-QTY-SIGN               14310002
                                                 (RD024-IDX)            14320002
                     COMPUTE PV-PACK-QTY =                              14330002
                                (RECDIS-AP-VERIFY-ITM-QTY -             14340002
                                 RCT00009-AP-VRFY-ODU-QTY) /            14350002
                                 RECITM-PREPK-RATO-QTY                  14360002
                  ELSE                                                  14370002
                     MOVE   'N'   TO RD024-STORE-QTY-SIGN               14380002
                                                 (RD024-IDX)            14390002
                     COMPUTE PV-PACK-QTY =                              14400002
                                (RECDIS-VERIFY-ITM-QTY    -             14410002
                                 RCT00009-DC-VRFY-ODU-QTY) /            14420002
                                 RECITM-PREPK-RATO-QTY                  14430002
                  END-IF                                                14440002
                  MOVE PV-PACK-QTY     TO RD024-STORE-QTY               14450002
                                                 (RD024-IDX)            14460002
                  IF RD024-STORE-QTY (RD024-IDX) = 0                    14470002
                      SET RD024-IDX DOWN BY 1                           14480002
                      SUBTRACT +1 FROM PV-STORE-COUNT                   14490002
                      SUBTRACT +1 FROM PV-INDEX-COUNTER                 14500002
                  ELSE                                                  14510002
                      MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                 14520002
                  END-IF                                                14530002
                  ADD +1    TO PV-STORE-COUNT                           14540002
                               PV-INDEX-COUNTER                         14550002
                  SET PS-END-OF-PREPK-STORE TO TRUE                     14560002
            END-PERFORM                                                 14570002
                                                                        14580002
            IF AT-LEAST-ONE-STORE                                       14590002
                IF RD024-IDX > PV-MAX-ITEMS                             14600002
                   PERFORM 3200-LOAD-WFT-LOD-XFER                       14610002
                   PERFORM 3300-INSERT-WFT-LOD-XFER                     14620002
                   SET PS-WROTE-TO-XFER-ONLY TO TRUE                    14630002
                   SET RD024-IDX TO +1                                  14640002
                   SET PS-END-OF-PREPK-STORE TO TRUE                    14650002
                   MOVE +0  TO  PV-STORE-COUNT                          14660002
                   MOVE +1 TO PV-INDEX-COUNTER                          14670002
                ELSE                                                    14680002
                IF PS-END-OF-PREPK-LINE-CSR                             14690002
                   PERFORM 3200-LOAD-WFT-LOD-XFER                       14700002
                   PERFORM 3300-INSERT-WFT-LOD-XFER                     14710002
                   PERFORM 3000-LOAD-WFT-LOD-CNTL                       14720002
                   PERFORM 3100-INSERT-WFT-LOD-CNTL                     14730002
                END-IF                                                  14740002
              END-IF                                                    14750002
            ELSE                                                        14760002
              IF PS-WROTE-TO-XFER-ONLY                                  14770002
                 PERFORM 3000-LOAD-WFT-LOD-CNTL                         14780002
                 PERFORM 3100-INSERT-WFT-LOD-CNTL                       14790002
                 SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE              14800002
              END-IF                                                    14810002
            END-IF.                                                     14820002
                                                                        14830002
                                                                        14840002
       8610-PROCESS-ODD-UNT-LINES.                                      14850002
           SET PS-NOT-END-OF-ODD-UNITS-CSR                              14860002
               PS-FIRST-FETCH           TO TRUE.                        14870005
           MOVE 'N'                     TO PS-AT-LEAST-ONE-STORE.       14880005
           SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE.                   14890005
           PERFORM 8620-OPEN-ODD-UNITS-CSR.                             14900005
           PERFORM 8630-FETCH-ODD-UNITS-CSR.                            14910005
           PERFORM 8650-LOAD-VERIFIED-RECEIPTS                          14920002
                   UNTIL PS-END-OF-ODD-UNITS-CSR.                       14930005
           PERFORM 8700-CLOSE-ODD-UNITS-CSR.                            14940002
                                                                        14950002
                                                                        14960002
                                                                        14970002
       8620-OPEN-ODD-UNITS-CSR.                                         14980002
                                                                        14990002
           EXEC SQL                                                     15000002
                OPEN ODD-UNITS-CSR                                      15010002
           END-EXEC.                                                    15020002
                                                                        15030002
           EVALUATE TRUE                                                15040002
               WHEN SQLCODE = ZERO                                      15050002
                    CONTINUE                                            15060002
               WHEN OTHER                                               15070002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       15080002
                   MOVE '8620-OPEN-ODD-UNITS-CSR'                       15090002
                                               TO PV-PARAGRAPH-NAME     15100002
                   MOVE 'RCT_VRFD_ODD_UNT, TRECITM'                     15110002
                                               TO PV-DB2-OPER-ATTEMPTED 15120002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   15130002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   15140002
                   SET PC238-DB2-FUNCTION-OPEN TO TRUE                  15150004
                   PERFORM Z900-SQL-ABEND                               15160002
           END-EVALUATE.                                                15170002
                                                                        15180002
                                                                        15190002
       8630-FETCH-ODD-UNITS-CSR.                                        15200002
                                                                        15210002
           EXEC SQL                                                     15220002
                FETCH ODD-UNITS-CSR                                     15230002
                 INTO :RCT00009-STR-NBR                                 15240002
                   ,  :RCT00009-PO-LNE-NBR                              15250002
                   ,  :RCT00009-DC-VRFY-ODU-QTY                         15260002
                   ,  :RCT00009-AP-VRFY-ODU-QTY                         15270002
           END-EXEC.                                                    15280002
                                                                        15290002
           EVALUATE TRUE                                                15300002
               WHEN SQLCODE = ZERO                                      15310002
                   IF PS-FIRST-FETCH                                    15320002
                      SET PS-ODD-UNITS-TRANSACTION TO TRUE              15330002
                      MOVE +0  TO PV-STORE-COUNT                        15340002
                                  PV-BTCH-LOD-SEQ-ID                    15350002
                      SET PS-NOT-FIRST-FETCH TO TRUE                    15360002
                      PERFORM 1000-SELECT-CONTROL-TMST                  15370002
                      MOVE RCT00009-PO-LNE-NBR TO PV-PO-LNE-HOLD        15380002
                                                  DK-PO-LINE-NBR        15390002
                      PERFORM 6350-SELECT-LINE-SKU                      15400002
                   END-IF                                               15410002
               WHEN SQLCODE = +100                                      15420002
                   SET PS-END-OF-ODD-UNITS-CSR TO TRUE                  15430002
                   IF PS-NOT-FIRST-FETCH                                15440002
                      MOVE ZEROES TO PV-PO-LNE-HOLD                     15450002
                   END-IF                                               15460002
               WHEN OTHER                                               15470002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       15480002
                   MOVE '8630-FETCH-ODD-UNITS-CSR'                      15490002
                                               TO PV-PARAGRAPH-NAME     15500002
                   MOVE 'RCT_VRFD_ODD_UNT, TRECITM'                     15510002
                                               TO PV-DB2-OPER-ATTEMPTED 15520002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   15530002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   15540002
                   SET PC238-DB2-FUNCTION-FETCH TO TRUE                 15550004
                   PERFORM Z900-SQL-ABEND                               15560002
           END-EVALUATE.                                                15570002
                                                                        15580002
                                                                        15590002
       8650-LOAD-VERIFIED-RECEIPTS.                                     15600002
             MOVE +100 TO PV-MAX-ITEMS                                  15610002
             PERFORM VARYING RD024-IDX FROM 1 BY 1                      15620002
                          UNTIL RD024-IDX > PV-MAX-ITEMS OR             15630002
                          PS-NEW-LINE-FOUND                             15640002
                 MOVE RCT00009-STR-NBR TO      RD024-STORE              15650002
                                                (RD024-IDX)             15660002
                 IF PC238-TRANS-LINE-VERIFY                             15670002
                    MOVE   'P'   TO RD024-STORE-QTY-SIGN                15680002
                                                (RD024-IDX)             15690002
                 ELSE                                                   15700002
                    MOVE   'N'   TO RD024-STORE-QTY-SIGN                15710002
                                                (RD024-IDX)             15720002
                 END-IF                                                 15730002
                 MOVE RCT00009-DC-VRFY-ODU-QTY TO RD024-STORE-QTY       15740002
                                                (RD024-IDX)             15750002
                 IF RD024-STORE-QTY (RD024-IDX) = 0                     15760002
                     SET RD024-IDX DOWN BY 1                            15770002
                     SUBTRACT +1 FROM PV-STORE-COUNT                    15780002
                 ELSE                                                   15790002
                     MOVE 'Y' TO PS-AT-LEAST-ONE-STORE                  15800002
                 END-IF                                                 15810002
                 PERFORM 8630-FETCH-ODD-UNITS-CSR                       15820002
                 IF RCT00009-PO-LNE-NBR > PV-PO-LNE-HOLD                15830002
                    SET PS-NEW-LINE-FOUND TO TRUE                       15840002
                 END-IF                                                 15850002
                 ADD +1    TO PV-STORE-COUNT                            15860002
             END-PERFORM.                                               15870002
                                                                        15880002
           IF AT-LEAST-ONE-STORE                                        15890002
             IF PS-NEW-LINE-FOUND                                       15900002
                PERFORM 3200-LOAD-WFT-LOD-XFER                          15910002
                PERFORM 3300-INSERT-WFT-LOD-XFER                        15920002
                PERFORM 3000-LOAD-WFT-LOD-CNTL                          15930002
                PERFORM 3100-INSERT-WFT-LOD-CNTL                        15940002
                                                                        15950002
                PERFORM 1000-SELECT-CONTROL-TMST                        15960002
                MOVE +0 TO PV-BTCH-LOD-SEQ-ID                           15970002
                SET PS-NO-NEW-LINE-FOUND TO TRUE                        15980002
                MOVE 'N' TO PS-AT-LEAST-ONE-STORE                       15990002
                MOVE RCT00009-PO-LNE-NBR TO PV-PO-LNE-HOLD              16000002
                                            DK-PO-LINE-NBR              16010002
                PERFORM 6350-SELECT-LINE-SKU                            16020002
             ELSE                                                       16030002
                SET PS-WROTE-TO-XFER-ONLY TO TRUE                       16040002
                PERFORM 3200-LOAD-WFT-LOD-XFER                          16050002
                PERFORM 3300-INSERT-WFT-LOD-XFER                        16060002
             END-IF                                                     16070002
                                                                        16080002
             MOVE +0    TO PV-STORE-COUNT                               16090002
             SET RD024-IDX  TO +1                                       16100002
           ELSE                                                         16110002
             IF PS-NEW-LINE-FOUND                                       16120002
                SET PS-NO-NEW-LINE-FOUND TO TRUE                        16130002
                MOVE RCT00009-PO-LNE-NBR TO PV-PO-LNE-HOLD              16140002
                                            DK-PO-LINE-NBR              16150002
             END-IF                                                     16160002
             IF PS-WROTE-TO-XFER-ONLY                                   16170002
                PERFORM 3000-LOAD-WFT-LOD-CNTL                          16180002
                PERFORM 3100-INSERT-WFT-LOD-CNTL                        16190002
                SET PS-DID-NOT-WRITE-TO-XFER-ONLY TO TRUE               16200002
             END-IF                                                     16210002
           END-IF.                                                      16220002
                                                                        16230002
                                                                        16240002
      *----------------------------------------------------------------*16250002
      * CLOSE THE LINE STORE CURSOR                                  *  16260002
      *----------------------------------------------------------------*16270002
       8700-CLOSE-ODD-UNITS-CSR.                                        16280002
                                                                        16290002
           EXEC SQL                                                     16300002
                CLOSE ODD-UNITS-CSR                                     16310002
           END-EXEC.                                                    16320002
                                                                        16330002
           EVALUATE TRUE                                                16340002
               WHEN SQLCODE = ZERO                                      16350002
                    CONTINUE                                            16360002
               WHEN OTHER                                               16370002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       16380002
                   MOVE '8700-CLOSE-ODD-UNITS-CSR'                      16390002
                                               TO PV-PARAGRAPH-NAME     16400002
                   MOVE 'RCT_VRFD_ODD_UNT, TRECITM'                     16410002
                                               TO PV-DB2-OPER-ATTEMPTED 16420002
                   MOVE RECITM-PREPK-ID        TO PV-DISPLAY-PREPK-ID   16430002
                   DISPLAY 'PREPK-ID = '          PV-DISPLAY-PREPK-ID   16440002
                   SET PC238-DB2-FUNCTION-CLOSE TO TRUE                 16450004
                   PERFORM Z900-SQL-ABEND                               16460002
           END-EVALUATE.                                                16470002
                                                                        16480002
      ***************************************************************** 16490002
                                                                        16500002
       9300-GET-TRECEIV-OPER-UNT-ID.                                    16510002
           INITIALIZE DCLTRECEIV.                                       16520002
                                                                        16530002
               EXEC SQL                                                 16540002
                    SELECT                                              16550002
                       OPER_UNT_ID                                      16560002
                  INTO                                                  16570002
                       :RECEIV-OPER-UNT-ID                              16580002
                    FROM  TRECEIV                                       16590002
                    WHERE                                               16600002
                           ORD_NBR          =  :DK-PO-NBR               16610002
                    AND    REC_SEQ_NBR      =  :DK-RCVR-SEQ-NBR         16620002
                    AND    VER_STATUS_CDE   =  'A'                      16630002
                    WITH UR                                             16640002
               END-EXEC.                                                16650002
                                                                        16660002
           EVALUATE TRUE                                                16670002
               WHEN SQLCODE = ZERO                                      16680002
                   CONTINUE                                             16690002
               WHEN OTHER                                               16700002
                   MOVE SQLCODE                TO PV-DISP-SQLCODE       16710002
                   MOVE '9300-GET-TRECEIV-OPER-UNT-ID'                  16720002
                                               TO PV-PARAGRAPH-NAME     16730002
                   MOVE 'TRECEIV    '                                   16740002
                                               TO PV-DB2-OPER-ATTEMPTED 16750002
                   SET PC238-DB2-FUNCTION-SELECT TO TRUE                16760004
                   PERFORM Z900-SQL-ABEND                               16770002
           END-EVALUATE.                                                16780002
                                                                        16790002
                                                                        16800002
      ******************************************************************16810002
      *   Z900-SQL-ABEND                                               *16820002
      ******************************************************************16830002
      * - ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING   *16840002
      *   CODE OCCURS.                                                 *16850002
      ******************************************************************16860002
       Z900-SQL-ABEND.                                                  16870002
                                                                        16880002
           SET PC238-MOD-UNSUCCESSFUL    TO TRUE.                       16890004
           MOVE SQLCODE                  TO PC238-BAD-SQL-CDE.          16900004
           MOVE PV-DB2-OPER-ATTEMPTED    TO PC238-BAD-TABLE-NAME.       16910004
           DISPLAY '**********************************************'.    16920002
           DISPLAY '** RETURNING TO CALLING MODULE   **'.               16930008
           DISPLAY '** PROGRAM     ** = ' PC-CURRENT-PROGRAM-NAME.      16940002
           DISPLAY '** PARAGRAPH   ** = ' PV-PARAGRAPH-NAME.            16950002
           DISPLAY '** OPERATION   ** = ' PV-DB2-OPER-ATTEMPTED.        16960002
           DISPLAY '** SQLCODE     ** = ' PV-DISP-SQLCODE.              16970002
           DISPLAY '**********************************************'.    16980002
           DISPLAY '** PO NBR      ** = ' DK-PO-NBR.                    16990002
           DISPLAY '** PO LINE NBR ** = ' DK-PO-LINE-NBR.               17000002
           DISPLAY '** RECV SEQ    ** = ' DK-RCVR-SEQ-NBR.              17010002
           DISPLAY '**********************************************'.    17020002
                                                                        17030002
                                                                        17040002
      ***************************************************************** 17050002
      * COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     17060002
      * TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      17070002
      * DO NOT ABEND IN THIS PROGRAM - LET THE CALLING PROGRAM ABEND.   17080004
      ***************************************************************** 17090002
           COPY DPPD004.                                                17100002
                                                                        17110002
           PERFORM 0500-RETURN-TO-CALLING-PROGRAM.                      17120005
                                                                        17130005
      **   MOVE +4013 TO ABEND-CODE.                                    17140004
      **   CALL 'ILBOABN0' USING ABEND-CODE.                            17150004
                                                                        17160002
