000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT691.                                         00020000
000300 AUTHOR.        BUDDY BARNES.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   JUN, 2011.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*  AHKUT691.   "ARCHIVE HISTORY" PROJECT. DATA OFFLOAD.          *00090000
001000*                                                                *00100000
001000*                                                                *00101000
001100*  PURPOSE:                                                      *00102000
001200*  THIS PROGRAM TAKES A DRIVER FILE OF ROWS EXTRACTED FROM       *00103000
001300*  TAUCNPO IN ORDER TO CREATE AN ARCHIVE FILE OF TAUBKPO         *00104000
001300*  WHICH WILL THEN BE USED TO DELETE ROWS FROM TAUBKPO           *00105000
001600*                                                                *00106000
001700*  PROCESSING OVERVIEW:                                          *00107000
001800*  THIS PROGRAM ACCESSES TAUBKPO AND USING A DRIVER FILE         *00108000
001900*  OF TAUCNPO ROWS CREATING AN OUTPUT FILE OF RECORDS CONTAINING:*00109000
002100*  1) THE FULL ROW OF DATA FROM TAUBKPO                          *00110000
002200*  THESE RECORDS ARE SORTED FOR EASE                             *00120000
002300*  AND EFFICIENCY OF SUBSEQUENT PROCESSING.                      *00130000
002400*                                                                *00140000
002500*  FOR EACH PO           RETURNED THE FULL ROW OF DATA IS WRITTEN*00150000
002600*  TO THE EXTRACT FILE TO BE USED FOR ARCHIVING AND DELETING.    *00160000
003000******************************************************************00170000
006020******************************************************************00180000
006030 ENVIRONMENT DIVISION.                                            00190000
006040 CONFIGURATION SECTION.                                           00200000
006050 SOURCE-COMPUTER.        IBM-3090.                                00210000
006060 OBJECT-COMPUTER.        IBM-3090.                                00220000
006070                                                                  00230000
006080 INPUT-OUTPUT SECTION.                                            00240000
006090 FILE-CONTROL.                                                    00250000
006100                                                                  00260000
006200     SELECT  IN-DRIVER-FILE               ASSIGN TO INP01.        00270000
006200     SELECT  OUT-ARCHIVE-FILE             ASSIGN TO OUT01.        00280000
006300                                                                  00290000
006400 DATA DIVISION.                                                   00300000
006500 FILE SECTION.                                                    00310000
006600                                                                  00320000
006700 FD  IN-DRIVER-FILE                                               00330000
006800     RECORDING MODE IS F                                          00340000
006900     LABEL RECORDS ARE STANDARD                                   00350000
007000     BLOCK CONTAINS 0 RECORDS.                                    00360000
007100 01  IN-DRIVER-RECORD                PIC  X(259).                 00370000
006600                                                                  00380000
006700 FD  OUT-ARCHIVE-FILE                                             00390000
006800     RECORDING MODE IS F                                          00391000
006900     LABEL RECORDS ARE STANDARD                                   00392000
007000     BLOCK CONTAINS 0 RECORDS.                                    00393000
007100 01  OUT-ARCHIVE-RECORD              PIC  X(453).                 00394000
007200                                                                  00395000
007300 WORKING-STORAGE SECTION.                                         00396000
007400                                                                  00397000
007500 01  PC-PROGRAM-CONSTANTS.                                        00398000
007600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT691'.  00399000
007700     05  PC-PGM-PROGRESS-DESC.                                    00400000
007800         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00410000
007800         10  PC-CONTINUING           PIC X(10) VALUE 'CONTINUING'.00420000
008500         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00430000
008600         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00440000
008700     05  PC-ABEND-INFO.                                           00450000
008800         10  PC-ABEND                PIC X(11) VALUE              00460000
008900                                               '** ABEND **'.     00470000
009000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00480000
009100                                               '- PARA       : '. 00490000
009200         10  PC-ABEND-MSG-DISPLAY-PARA                            00500000
009300                                     PIC X(15) VALUE              00510000
009400                                               '  CALLED PARA: '. 00520000
009500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00530000
009600                                               '  FOR ABEND# : '. 00540000
009700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00550000
009800                                               '- ERROR IS   : '. 00560000
009900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00570000
010000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00580000
010100                                               '- ACTION     : '. 00590000
010200     05  PC-TEST-AND-SET-NULL-IND.                                00600000
010300         10  PC-NOT-NULL             PIC S9(4) COMP               00610000
010400                                               VALUE ZERO.        00620000
010500         10  PC-NULL                 PIC S9(4) COMP               00630000
010600                                               VALUE -1.          00640000
010700         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00650000
010800                                               VALUE -2.          00660000
010900         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00670000
011000                                                                  00680000
011100     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 010000.      00690000
011200                                                                  00700000
011300 01  PS-PROGRAM-SWITCHES.                                         00710000
011400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00720000
011500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00730000
011600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00740000
008900     05  PS-DRIVER-FILE-SW        PIC  X(01)    VALUE 'Y'.        00750000
009000         88  MORE-DRIVER                        VALUE 'Y'.        00760000
009100         88  END-OF-DRIVER                      VALUE 'N'.        00770000
012000                                                                  00780000
012100 01  PV-PROGRAM-VARIABLES.                                        00790000
012400     05  DISPLAY-PO-NBR              PIC  9(09) VALUE ZEROS.      00800000
012500     05  PV-PRG-TMST                 PIC X(26) VALUE SPACES.      00810000
012600     05  PV-PRG-TMST-DETAIL REDEFINES PV-PRG-TMST.                00820000
012700         10  PV-PRG-DATE             PIC X(10).                   00830000
012800         10  PV-PRG-TIME             PIC X(16).                   00840000
013000     05  PV-TABLE-ROW-FETCHED-CNT    PIC  9(9) VALUE 0.           00850000
013100     05  PV-ARCHIVE-WRITTEN-CNT       PIC  9(9) VALUE 0.          00860000
006800     05  PV-TAUCNPO-INPUT-COUNT   PIC 9(09)     VALUE ZERO        00870000
006900                                                COMP-3.           00871000
013800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00872000
013900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00873000
014000     05  PV-DB2-TABLE-NAME-1         PIC X(18) VALUE SPACES.      00874000
014100     05  PV-DB2-TABLE-NAME-2         PIC X(18) VALUE SPACES.      00875000
014200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           00876000
014300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           00877000
014400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        00878000
014500                                                                  00879000
014600     05  PV-TMST                     PIC X(26) VALUE SPACES.      00880000
014700     05  PV-TIMESTAMP-DETAIL                                      00890000
014800         REDEFINES                                                00900000
014900         PV-TMST.                                                 00910000
015000         10  PV-TIMESTAMP-19.                                     00920000
015100             15  PV-TMS-DATE.                                     00930000
015200                 20  PV-TMS-YEAR.                                 00940000
015300                     25  PV-TMS-CC   PIC X(02).                   00941000
015400                     25  PV-TMS-YY   PIC X(02).                   00942000
015500                 20  FILLER          PIC X(01).                   00943000
015600                 20  PV-TMS-MONTH    PIC X(02).                   00944000
015700                 20  FILLER          PIC X(01).                   00945000
015800                 20  PV-TMS-DAY      PIC X(02).                   00946000
015900             15  FILLER              PIC X(01).                   00947000
016000             15  PV-TMS-HOUR         PIC X(02).                   00948000
016100             15  FILLER              PIC X(01).                   00949000
016200             15  PV-TMS-MINUTE       PIC X(02).                   00949100
016300             15  FILLER              PIC X(01).                   00949200
016400             15  PV-TMS-SECOND       PIC X(02).                   00949300
016500         10  FILLER                  PIC X(01).                   00949400
016600         10  PV-TMS-MSECOND          PIC X(06).                   00949500
014500                                                                  00949600
018200*---------------------------------------------------------------* 00949700
018300*  RECORD LAYOUT FOR DRIVER FILE.                               * 00949800
018400*---------------------------------------------------------------* 00949900
018500     COPY AHRD021.                                                00950000
018700                                                                  00960000
018200*---------------------------------------------------------------* 00970000
018300*  RECORD LAYOUT FOR ARCHIVE FILE.                              * 00980000
018400*---------------------------------------------------------------* 00990000
018500     COPY AHRD031.                                                01000000
018700                                                                  01010000
018800 01  DM-DISPLAY-MESSAGE.                                          01020000
018900     05  DM-01-10.                                                01030000
019000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01040000
019100         10  FILLER                  PIC X(02) VALUE ': '.        01050000
019200     05  DM-11-80.                                                01060000
019300         10  FILLER                  PIC X(27) VALUE              01070000
019400                                    'BEGIN DRIVER FILE CREATION.'.01080000
019500         10  FILLER                  PIC X(01) VALUE SPACE.       01090000
019600         10  FILLER                  PIC X(42) VALUE ALL '*'.     01100000
019700     05  DM-81-120.                                               01110000
019800         10  FILLER                  PIC X(40) VALUE ALL '*'.     01120000
019900                                                                  01130000
020000 01  DP-DISPLAY-PROGRESS-MSG.                                     01140000
020100     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01150000
020200     05  FILLER                      PIC X(02) VALUE SPACE.       01160000
020300     05  DP-STATUS-DESCRIPTION       PIC X(13) VALUE SPACE.       01170000
020400     05  FILLER                      PIC X(04) VALUE ' AT '.      01180000
020500     05  DP-TIMESTAMP                PIC X(26) VALUE SPACE.       01190000
020600     05  FILLER                      PIC X(03) VALUE '.  '.       01200000
020700     05  FILLER                      PIC X(09) VALUE 'FETCHES: '. 01210000
020800     05  DP-TABLE-ROW-FETCHED-CNT    PIC ZZZ,ZZZ,ZZ9              01220000
020900                                               VALUE ZERO.        01230000
021000     05  FILLER                      PIC X(02) VALUE ', '.        01240000
021100     05  FILLER                      PIC X(09) VALUE 'WRITTEN: '. 01250000
021200     05  DP-DRIVER-WRITTEN-CNT       PIC ZZZ,ZZZ,ZZ9              01260000
021300                                               VALUE ZERO.        01270000
021400     05  FILLER                      PIC X(01) VALUE '.'.         01280000
021500                                                                  01290000
021600 01  ABEND-CODE                      PIC S9(04)                   01300000
021700                                               VALUE ZEROES       01310000
021800                                               COMP SYNC.         01320000
021900                                                                  01330000
022000*---------------------------------------------------------------* 01340000
022100*  DB2 FORMATTED MESSAGE AREA                                     01350000
022200*---------------------------------------------------------------* 01360000
022300     COPY DPWS004.                                                01370000
022400                                                                  01380000
022500*---------------------------------------------------------------* 01390000
022600*    DB2 AREA FOR TAUBKPO                                       * 01400000
022700*---------------------------------------------------------------* 01410000
022800     EXEC SQL                                                     01420000
022900          INCLUDE TAUBKPO                                         01430000
023000     END-EXEC.                                                    01440000
023100                                                                  01450000
023200*---------------------------------------------------------------* 01460000
023300*    DB2 AREA FOR SYSDUMMY                                      * 01470000
023400*---------------------------------------------------------------* 01480000
023500     EXEC SQL                                                     01490000
023600          INCLUDE SYSDUMMY                                        01500000
023700     END-EXEC.                                                    01510000
023800                                                                  01520000
023900*---------------------------------------------------------------* 01530000
024000*    DB2 AREA FOR COMMUNICATIONS                                * 01540000
024100*---------------------------------------------------------------* 01550000
024200     EXEC SQL                                                     01560000
024300          INCLUDE SQLCA                                           01570000
024400     END-EXEC.                                                    01580000
024500                                                                  01590000
024600*---------------------------------------------------------------* 01600000
024700*    DEFINE CURSOR FOR ACCESSING TAUBKPO                        * 01610000
024800*---------------------------------------------------------------* 01620000
024900     EXEC SQL                                                     01630000
025000         DECLARE TABLE-CURSOR CURSOR FOR                          01640000
025100           SELECT                                                 01650000
025200              PO_NBR                                              01660000
025300             ,PO_BKG_SEQ_NBR                                      01670000
025400             ,PO_BKG_DELY_TMST                                    01680000
025500             ,EXTL_REF_NBR                                        01690000
025600             ,ORGN_SHPD_FR_CDE                                    01700000
025700             ,CONSLR_SCAC_ID                                      01710000
025800             ,IMPRT_TRIP_ID                                       01720000
025800             ,DPRTR_TMST                                          01730000
025800             ,POE_DELY_TMST                                       01740000
025800             ,CARR_SCAC_ID                                        01750000
025800             ,FOB_CDE                                             01760000
025800             ,IMPRT_VEH_NM                                        01761000
025800             ,TRIP_TYP_CDE                                        01762000
025800             ,DEST_POE_CDE                                        01763000
025800             ,C_O_PROD_CDE                                        01764000
025800             ,PROD_FCTRY_NM                                       01765000
025800             ,PO_CART_CNT                                         01765100
025800             ,PO_CBMT_QTY                                         01765200
025800             ,PO_WT_KGRM_QTY                                      01765300
025800             ,PO_UNT_QTY                                          01765400
025800             ,PO_EXC_APVL_CDE                                     01765500
025800             ,PO_EXC_APVL_USR_ID                                  01765600
025800             ,PO_EXC_APVL_TMST                                    01765700
025800             ,PO_EXC_RSN_DESC                                     01765800
025800             ,EST_LBD_NM                                          01765900
025800             ,EST_LBD_TMST                                        01766000
025800             ,SHIPT_BKG_TMST                                      01766100
025800             ,VOY_CHG_RSN_DESC                                    01766200
025800             ,DAT_SRC_ENT_ID                                      01766300
025800             ,LAST_UPD_BY_USR_ID                                  01766600
025800             ,LAST_UPD_TMST                                       01766700
025800             ,AUD_FUNC_CDE                                        01766800
025800             ,AUD_TMST                                            01766900
027900             FROM TAUBKPO                                         01767000
028100            WHERE PO_NBR       = :AH021-PO-NBR                    01767100
028500         FOR FETCH ONLY                                           01767200
028600         WITH UR                                                  01768000
028700         OPTIMIZE FOR 1 ROW                                       01769000
028800     END-EXEC.                                                    01770000
029000                                                                  01780000
029100 PROCEDURE DIVISION.                                              01790000
029200                                                                  01800000
029300 0000-PROGRAM-MAINLINE.                                           01810000
029400                                                                  01820000
029500     PERFORM 1000-INITIALIZE.                                     01830000
029600                                                                  01840000
029700     PERFORM 1500-READ-DRIVER-RECORD                              01850000
029800         UNTIL END-OF-DRIVER.                                     01860000
029900                                                                  01870000
030000     PERFORM 6000-EOJ-ROUTINE.                                    01880000
030100     STOP RUN.                                                    01890000
030200                                                                  01900000
030400******************************************************************01910000
030500*  INITIALIZATIONS                                               *01920000
030600******************************************************************01930000
030700 1000-INITIALIZE.                                                 01940000
030800                                                                  01950000
030900     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  01960000
031000     DISPLAY DM-DISPLAY-MESSAGE.                                  01970000
031400                                                                  01980000
031500     OPEN INPUT  IN-DRIVER-FILE.                                  01990000
031500     OPEN OUTPUT OUT-ARCHIVE-FILE.                                02000000
031200     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02010000
032500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02020000
033100     INITIALIZE DCLTAUBKPO                                        02030000
033200                AH021-ARCHIVE-RECORD-LAYOUT.                      02040000
033800                                                                  02050000
031200 1500-READ-DRIVER-RECORD.                                         02060000
031400     READ IN-DRIVER-FILE INTO AH021-ARCHIVE-RECORD-LAYOUT         02070000
031600          AT END SET END-OF-DRIVER  TO TRUE.                      02080000
031700                                                                  02090000
031800     IF MORE-DRIVER                                               02100000
031900         ADD 1 TO PV-TAUCNPO-INPUT-COUNT                          02110000
029600                                                                  02120000
032600         SET PS-TABLE-LOOP-NOT-DONE TO TRUE                       02130000
032700         PERFORM 9100-OPEN-TABLE-CURSOR                           02140000
033000                                                                  02150000
029700         PERFORM 2000-GET-NEXT-FROM-CURSOR                        02160000
029800             UNTIL PS-TABLE-LOOP-DONE                             02170000
                                                                        02180000
032700         PERFORM 9130-CLOSE-TABLE-CURSOR                          02190000
032000     END-IF.                                                      02200000
                                                                        02210000
033900******************************************************************02220000
034000*  FETCH NEXT FROM CURSOR & WRITE OUTPUT DRIVER FILE RECORD.     *02230000
034100******************************************************************02240000
034200 2000-GET-NEXT-FROM-CURSOR.                                       02250000
034300                                                                  02260000
036900     PERFORM 9110-FETCH-TABLE-CURSOR.                             02270000
           IF SQLCODE = 0                                               02280000
034400         MOVE  AUBKPO-PO-NBR       TO DISPLAY-PO-NBR              02290000
034410*        DISPLAY 'FETCHED BOOKING PONBR = ' DISPLAY-PO-NBR        02300000
034610                                                                  02310000
036100         PERFORM 2010-POPULATE-ARCHIVE-RECORD                     02320000
036200         PERFORM 9650-WRITE-ARCHIVE-RECORD                        02330000
036300         PERFORM 2100-CHECK-PGM-PROGRESS                          02340000
036600     END-IF.                                                      02350000
037100******************************************************************02360000
037200*  MOVE COLUMNS FROM TABLES TO FIELDS IN ARCHIVE FILE RECORD.    *02370000
037300******************************************************************02380000
037400 2010-POPULATE-ARCHIVE-RECORD.                                    02390000
037500                                                                  02400000
           MOVE AUBKPO-PO-NBR             TO AH031-PO-NBR.              02410000
           MOVE AUBKPO-PO-BKG-SEQ-NBR     TO AH031-PO-BKG-SEQ-NBR.      02420000
           MOVE AUBKPO-PO-BKG-DELY-TMST   TO AH031-PO-BKG-DELY-TMST.    02430000
           MOVE AUBKPO-EXTL-REF-NBR       TO AH031-EXTL-REF-NBR.        02440000
           MOVE AUBKPO-ORGN-SHPD-FR-CDE   TO AH031-ORGN-SHPD-FR-CDE.    02450000
           MOVE AUBKPO-CONSLR-SCAC-ID     TO AH031-CONSLR-SCAC-ID.      02460000
           MOVE AUBKPO-IMPRT-TRIP-ID      TO AH031-IMPRT-TRIP-ID.       02470000
           MOVE AUBKPO-DPRTR-TMST         TO AH031-DPRTR-TMST.          02480000
           MOVE AUBKPO-POE-DELY-TMST      TO AH031-POE-DELY-TMST.       02490000
           MOVE AUBKPO-CARR-SCAC-ID       TO AH031-CARR-SCAC-ID.        02500000
           MOVE AUBKPO-FOB-CDE            TO AH031-FOB-CDE.             02510000
           MOVE AUBKPO-IMPRT-VEH-NM       TO AH031-IMPRT-VEH-NM.        02520000
           MOVE AUBKPO-TRIP-TYP-CDE       TO AH031-TRIP-TYP-CDE.        02530000
           MOVE AUBKPO-DEST-POE-CDE       TO AH031-DEST-POE-CDE.        02540000
           MOVE AUBKPO-C-O-PROD-CDE       TO AH031-C-O-PROD-CDE.        02550000
           MOVE AUBKPO-PROD-FCTRY-NM      TO AH031-PROD-FCTRY-NM.       02560000
           MOVE AUBKPO-PO-CART-CNT        TO AH031-PO-CART-CNT.         02561000
           MOVE AUBKPO-PO-CBMT-QTY        TO AH031-PO-CBMT-QTY.         02562000
           MOVE AUBKPO-PO-WT-KGRM-QTY     TO AH031-PO-WT-KGRM-QTY.      02562100
           MOVE AUBKPO-PO-UNT-QTY         TO AH031-PO-UNT-QTY.          02562200
           MOVE AUBKPO-PO-EXC-APVL-CDE    TO AH031-PO-EXC-APVL-CDE.     02562300
           MOVE AUBKPO-PO-EXC-APVL-USR-ID TO AH031-PO-EXC-APVL-USR-ID.  02562400
           MOVE AUBKPO-PO-EXC-APVL-TMST   TO AH031-PO-EXC-APVL-TMST.    02562500
           MOVE AUBKPO-PO-EXC-RSN-DESC    TO AH031-PO-EXC-RSN-DESC.     02562600
           MOVE AUBKPO-EST-LBD-NM         TO AH031-EST-LBD-NM.          02562700
           MOVE AUBKPO-EST-LBD-TMST       TO AH031-EST-LBD-TMST.        02562800
           MOVE AUBKPO-SHIPT-BKG-TMST     TO AH031-SHIPT-BKG-TMST.      02562900
           MOVE AUBKPO-VOY-CHG-RSN-DESC   TO AH031-VOY-CHG-RSN-DESC.    02563000
           MOVE AUBKPO-DAT-SRC-ENT-ID     TO AH031-DAT-SRC-ENT-ID.      02563100
           MOVE AUBKPO-LAST-UPD-BY-USR-ID TO AH031-LAST-UPD-BY-USR-ID.  02563400
           MOVE AUBKPO-LAST-UPD-TMST      TO AH031-LAST-UPD-TMST.       02563500
           MOVE AUBKPO-AUD-FUNC-CDE       TO AH031-AUD-FUNC-CDE.        02563600
           MOVE AUBKPO-AUD-TMST           TO AH031-AUD-TMST.            02563701
042200                                                                  02563800
040700******************************************************************02563900
040800*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02564000
040900*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02564100
041000*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02564200
041100******************************************************************02565000
041200 2100-CHECK-PGM-PROGRESS.                                         02566000
041300     DIVIDE    PV-ARCHIVE-WRITTEN-CNT                             02567000
041400         BY        PC-HOW-OFTEN-TO-DISPLAY                        02568000
041500         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02569000
041600         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02570000
041700                                                                  02580000
041800     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02590000
041900         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02600000
042000         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02610000
042100     END-IF.                                                      02620000
042200                                                                  02630000
046400******************************************************************02640000
046500*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *02650000
046600******************************************************************02660000
046700 6000-EOJ-ROUTINE.                                                02670000
046800                                                                  02680000
047100     CLOSE IN-DRIVER-FILE.                                        02690000
047100     CLOSE OUT-ARCHIVE-FILE.                                      02700000
047200                                                                  02710000
046900     MOVE PC-ENDING  TO  DP-STATUS-DESCRIPTION.                   02720000
047500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02730000
047600                                                                  02740000
047700     DISPLAY 'TOTAL PO TRACKING BOOKINGS      = '                 02750000
047700                                  PV-ARCHIVE-WRITTEN-CNT.         02760000
047900                                                                  02770000
048000******************************************************************02780000
048100*  DISPLAY PROGRAM PROGRESS.                                     *02790000
048200******************************************************************02800000
048300 6200-DISPLAY-PGM-PROGRESS.                                       02810000
048400                                                                  02820000
048500     EXEC SQL                                                     02830000
048600          SET :PV-TMST = CURRENT TIMESTAMP                        02840000
048700     END-EXEC.                                                    02850000
048800                                                                  02860000
048900     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                02870000
049000     MOVE PV-TMST                   TO DP-TIMESTAMP.              02880000
049100     MOVE PV-TABLE-ROW-FETCHED-CNT  TO DP-TABLE-ROW-FETCHED-CNT.  02890000
049200     MOVE PV-ARCHIVE-WRITTEN-CNT     TO DP-DRIVER-WRITTEN-CNT.    02900000
049300                                                                  02910000
049400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             02920000
049600                                                                  02930000
049700******************************************************************02940000
049800*  OPEN   TABLE CURSOR                                           *02950000
049900******************************************************************02960000
050000 9100-OPEN-TABLE-CURSOR.                                          02970000
050100     EXEC SQL                                                     02980000
050200          OPEN TABLE-CURSOR                                       02990000
050300     END-EXEC.                                                    03000000
050400                                                                  03010000
050500     EVALUATE TRUE                                                03020000
050600         WHEN SQLCODE = ZERO                                      03030000
050700              CONTINUE                                            03040000
050800         WHEN SQLCODE = +100                                      03050000
050900              SET PS-TABLE-LOOP-DONE TO TRUE                      03060000
051000              MOVE '9100-OPEN-TABLE-CURSOR'                       03070000
051100                                 TO PV-PARAGRAPH-NAME             03080000
051200              MOVE 'OPEN TABLE CURSOR - NO ROWS SELECTED'         03090000
051300                                 TO PV-DB2-OPERATION-MSG-1        03100000
051400              MOVE 'TAUBKPO' TO PV-DB2-TABLE-NAME-1               03110000
051500              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03120000
051600              PERFORM 9999-DB2-ABEND                              03130000
051700         WHEN SQLWARN0 NOT EQUAL SPACE                            03140000
051800         WHEN SQLCODE  NOT EQUAL ZERO                             03150000
051900              MOVE '9100-OPEN-TABLE-CURSOR'                       03160000
052000                                 TO PV-PARAGRAPH-NAME             03170000
052100              MOVE 'OPEN TABLE CURSOR'                            03180000
052200                                 TO PV-DB2-OPERATION-MSG-1        03190000
052300              MOVE 'TAUBKPO' TO PV-DB2-TABLE-NAME-1               03200000
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03210000
052500              PERFORM 9999-DB2-ABEND                              03220000
052600     END-EVALUATE.                                                03230000
052700                                                                  03240000
052900******************************************************************03250000
053000*  FETCH TABLE CURSOR                                            *03260000
053100******************************************************************03270000
053200 9110-FETCH-TABLE-CURSOR.                                         03280000
053300     EXEC SQL                                                     03290000
053400         FETCH TABLE-CURSOR                                       03300000
053500          INTO  :AUBKPO-PO-NBR                                    03310000
053600               ,:AUBKPO-PO-BKG-SEQ-NBR                            03320000
053700               ,:AUBKPO-PO-BKG-DELY-TMST                          03330000
053800               ,:AUBKPO-EXTL-REF-NBR                              03340000
053900               ,:AUBKPO-ORGN-SHPD-FR-CDE                          03350000
054000               ,:AUBKPO-CONSLR-SCAC-ID                            03360000
054100               ,:AUBKPO-IMPRT-TRIP-ID                             03370000
054100               ,:AUBKPO-DPRTR-TMST                                03380000
054100               ,:AUBKPO-POE-DELY-TMST                             03390000
054100               ,:AUBKPO-CARR-SCAC-ID                              03400000
054100               ,:AUBKPO-FOB-CDE                                   03410000
054100               ,:AUBKPO-IMPRT-VEH-NM                              03420000
054100               ,:AUBKPO-TRIP-TYP-CDE                              03430000
054100               ,:AUBKPO-DEST-POE-CDE                              03440000
054100               ,:AUBKPO-C-O-PROD-CDE                              03450000
054100               ,:AUBKPO-PROD-FCTRY-NM                             03460000
054100               ,:AUBKPO-PO-CART-CNT                               03470000
054100               ,:AUBKPO-PO-CBMT-QTY                               03480000
054100               ,:AUBKPO-PO-WT-KGRM-QTY                            03490000
054100               ,:AUBKPO-PO-UNT-QTY                                03491000
054100               ,:AUBKPO-PO-EXC-APVL-CDE                           03492000
054100               ,:AUBKPO-PO-EXC-APVL-USR-ID                        03493000
054100               ,:AUBKPO-PO-EXC-APVL-TMST                          03494000
054100               ,:AUBKPO-PO-EXC-RSN-DESC                           03495000
054100               ,:AUBKPO-EST-LBD-NM                                03496000
054100               ,:AUBKPO-EST-LBD-TMST                              03497000
054100               ,:AUBKPO-SHIPT-BKG-TMST                            03498000
054100               ,:AUBKPO-VOY-CHG-RSN-DESC                          03499000
054100               ,:AUBKPO-DAT-SRC-ENT-ID                            03499100
054100               ,:AUBKPO-LAST-UPD-BY-USR-ID                        03499400
054100               ,:AUBKPO-LAST-UPD-TMST                             03499500
054100               ,:AUBKPO-AUD-FUNC-CDE                              03499600
054100               ,:AUBKPO-AUD-TMST                                  03499700
056300     END-EXEC.                                                    03499800
056400                                                                  03499900
056500     EVALUATE TRUE                                                03500000
056600         WHEN SQLCODE = ZERO                                      03500100
056700              ADD +1                 TO PV-TABLE-ROW-FETCHED-CNT  03501000
056800         WHEN SQLCODE = +100                                      03510000
056900              SET PS-TABLE-LOOP-DONE TO TRUE                      03520000
057000         WHEN SQLWARN0 NOT EQUAL SPACE                            03530000
057100         WHEN SQLCODE NOT EQUAL ZERO                              03540000
057200              MOVE '9110-FETCH-TABLE-CURSOR'                      03550000
057300                                 TO PV-PARAGRAPH-NAME             03560000
057400              MOVE 'FETCH TABLE CURSOR'                           03570000
057500                                 TO PV-DB2-OPERATION-MSG-1        03580000
057600              MOVE 'TAUBKPO' TO PV-DB2-TABLE-NAME-1               03590000
057700              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03600000
057800              PERFORM 9999-DB2-ABEND                              03610000
057900     END-EVALUATE.                                                03620000
058100                                                                  03630000
058200******************************************************************03640000
058300*  CLOSE TABLE CURSOR                                            *03650000
058400******************************************************************03660000
058500 9130-CLOSE-TABLE-CURSOR.                                         03670000
058600     EXEC SQL                                                     03680000
058700          CLOSE TABLE-CURSOR                                      03690000
058800     END-EXEC.                                                    03700000
058900                                                                  03710000
059000     EVALUATE TRUE                                                03720000
059100         WHEN SQLCODE = ZERO                                      03730000
059200              CONTINUE                                            03740000
059300         WHEN SQLWARN0 NOT EQUAL SPACE                            03750000
059400         WHEN SQLCODE NOT EQUAL ZERO                              03760000
059500              MOVE '9130-CLOSE-TABLE-CURSOR'                      03770000
059600                                 TO PV-PARAGRAPH-NAME             03780000
059700              MOVE 'CLOSE TABLE CURSOR'                           03790000
059800                                 TO PV-DB2-OPERATION-MSG-1        03800000
059900              MOVE 'TAUBKPO' TO PV-DB2-TABLE-NAME-1               03810000
060000              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03820000
060100              PERFORM 9999-DB2-ABEND                              03830000
060200     END-EVALUATE.                                                03840000
060600                                                                  03850000
060700******************************************************************03860000
060800*  WRITE A RECORD TO THE ARCHIVE FILE                            *03870000
060900******************************************************************03880000
061000 9650-WRITE-ARCHIVE-RECORD.                                       03890000
061100     WRITE  OUT-ARCHIVE-RECORD  FROM  AH031-ARCHIVE-RECORD-LAYOUT.03900000
061200     ADD +1 TO PV-ARCHIVE-WRITTEN-CNT.                            03910000
061400                                                                  03920000
061700******************************************************************03930000
061800*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *03940000
061900*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *03950000
062000*  SQL ERROR OR WARNING CODE OCCURS.                             *03960000
062100******************************************************************03970000
062200 9999-DB2-ABEND.                                                  03980000
062300     DISPLAY PC-CURRENT-PROGRAM-NAME                              03990000
062400             ' 9999-DB2-ABEND'.                                   04000000
062500     DISPLAY PC-CURRENT-PROGRAM-NAME                              04010000
062600             ' ** ABEND           **'.                            04020000
062700     DISPLAY PC-CURRENT-PROGRAM-NAME                              04030000
062800             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04040000
062900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04050000
063000             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.     04060000
063100     DISPLAY PC-CURRENT-PROGRAM-NAME                              04070000
063200             ' **                 ** = ' PV-DB2-TABLE-NAME-2.     04080000
063300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04090000
063400             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04100000
063500                                                                  04110000
063600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04120000
063700             ' ** SQLCODE         ** = ' SQLCODE.                 04130000
063800     MOVE SQLCODE TO PV-SQLCODE.                                  04140000
063900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04150000
064000             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04160000
064100                                                                  04170000
064200     DISPLAY PC-CURRENT-PROGRAM-NAME                              04180000
064300             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04190000
064400                                                                  04200000
064600*----------------------------------------------------------------*04210000
064700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04220000
064800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04230000
064900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04240000
065000* FORMAT.                                                        *04250000
065100*----------------------------------------------------------------*04260000
065200     COPY DPPD004.                                                04270000
065300                                                                  04280000
065400     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04290000
065500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04300000
065700                                                                  04310000
065800*----------------------------------------------------------------*04320000
065900* CALL ABEND                                                     *04330000
066000*----------------------------------------------------------------*04340000
066100     MOVE +4013                  TO ABEND-CODE.                   04350000
066200     CALL 'ILBOABN0' USING ABEND-CODE.                            04360000
