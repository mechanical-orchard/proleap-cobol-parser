000100 IDENTIFICATION DIVISION.                                         00010044
000200                                                                  00020044
000300 PROGRAM-ID.      XSKUP073.                                       00030044
000400 AUTHOR.          ANKITA HALDER                                   00040044
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050044
000600 DATE-WRITTEN.    06/05/2014.                                     00060044
000700 DATE-COMPILED.                                                   00070044
000701                                                                  00070144
000702******************************************************************00070244
000703*  MODULE TYPE:   COBOL2 DB2 BATCH.                               00070344
000704*                                                                 00070444
000705*  DESCRIPTION: PROGRAM PURGES THE PROMO DATA                     00070544
000706*                                                                 00070644
000707*      THE FOLLOWING TABLES WILL BE PURGED:                       00070744
000708*          XST_REBT_FM                        XST00130            00070846
000709*          XST_REBT_FM_TXT                    XST00131            00070946
000710*          XST_PROMO_ADHC_RLT                 XST00031            00071046
000720*          XST_PROMO_ADHC_STR                 XST00033            00072046
000730*          XST_ADHC_STR_GP                    XST00036            00073046
000740*          XST_MDSE_LNE_SELN                  XST00028            00074046
000750*        (A CASCADE RELATIONSHIP HAS BEEN ESTABLISHED             00075044
000760*         WHERE THE FOLLOWING TABLES HAVE ROWS DELETED            00076044
000770*         WHEN RELATED ROWS IN THE XST_MDSE_LNE_SELN HAS          00077044
000780*         BEEN DELETED)                                           00078044
000790*             XST_SMP_PRICG                   XST00030            00079046
000791*             XST_TIER_PRICG                  XST00035            00079146
000792*             XST_EXCL_MDSE                   XST00034            00079246
000793*             XST_PROMO_STR_GP                XST00029            00079346
000794*          XST_PROMO_PRIC_VER                 XST00032            00079446
000795*          XST_PROMO                          XST00026            00079546
000796*          XST_AD_EVNT                        XST00027            00079646
000797******************************************************************00079744
000798*-----------------------------------------------------------      00079844
000799* HISTORY LOG:                                                    00079944
000800*-----------------------------------------------------------      00080044
000900* DATE:  FEBRUARY 2015                                            00090044
001000* WR/IR#: PRB0051962                                              00100044
001100* PROGRAMMER: COGNIZANT                                           00110044
001200* DESCRIPTION: WHEN THERE IS NO PROMO DATA TO PURGE XSK115        00120044
001300*              STILL RUNS FOR APPROXIMATELY 30 MINUTES. HENCE     00130044
001400*              CHECKING THE PROMO COUNT . IF IT IS ZERO           00140044
001500*              THEN THE PROGRAM WILL TERMINATE GIVING A MESSAGE   00150044
001501*-----------------------------------------------------------      00150144
001502* DATE:  APRIL 2017                                               00150251
001503* WR/IR#: CHG0166175                                              00150352
001504* PROGRAMMER: COGNIZANT                                           00150452
001505* DESCRIPTION: INCLUDED ORDER BY IN MDSE_LNE_CSR. ADDED COMMIT    00150552
001506*              FREQUENCY CHECK IN  D500-DELETE-XST00028 PARA      00150652
001507*              TO REDUCE CPU TIME.                                00150752
001508*-----------------------------------------------------------      00150848
001509 ENVIRONMENT DIVISION.                                            00150900
001510 CONFIGURATION SECTION.                                           00151000
001511                                                                  00151100
001512 SOURCE-COMPUTER.    IBM-3090.                                    00151200
001513 OBJECT-COMPUTER.    IBM-3090.                                    00151300
001514                                                                  00151400
001515 INPUT-OUTPUT SECTION.                                            00151500
001516 FILE-CONTROL.                                                    00151600
001520                                                                  00152044
001530     SELECT TODAYS-DATE-CC    ASSIGN TO INP01.                    00153044
001540     SELECT DAYS-TO-RETAIN-CC ASSIGN TO INP02.                    00154044
001550                                                                  00155044
001560 DATA DIVISION.                                                   00156044
001570 FILE SECTION.                                                    00157044
001580                                                                  00158044
001590 FD  TODAYS-DATE-CC                                               00159044
001600     RECORDING MODE IS F                                          00160044
001700     LABEL RECORDS ARE STANDARD                                   00170044
001800     RECORD CONTAINS 80 CHARACTERS                                00180044
001900     BLOCK CONTAINS 0 RECORDS                                     00190044
002000     DATA RECORD IS TODAYS-DATE-RECORD.                           00200044
002100                                                                  00210044
002200 01  TODAYS-DATE-RECORD               PIC  X(80).                 00220044
002300                                                                  00230044
002400 FD  DAYS-TO-RETAIN-CC                                            00240044
002500     RECORDING MODE IS F                                          00250044
002600     LABEL RECORDS ARE STANDARD                                   00260044
002700     RECORD CONTAINS 80 CHARACTERS                                00270044
002800     BLOCK CONTAINS 0 RECORDS                                     00280044
002900     DATA RECORD IS DAYS-TO-RETAIN-RECORD.                        00290044
003000                                                                  00300044
003100 01  DAYS-TO-RETAIN-RECORD            PIC  X(80).                 00310044
003200                                                                  00320044
003300 WORKING-STORAGE SECTION.                                         00330044
003400                                                                  00340044
003500***************************************************************** 00350044
003600*                         SWITCHES                                00360044
003700***************************************************************** 00370044
003800 01  PROGRAM-SWITCHES.                                            00380044
003900     05  PS-EOF-PROMO-SW              PIC  X(01) VALUE SPACE.     00390044
004000         88  PS-EOF-PROMO                        VALUE 'Y'.       00400044
004100         88  PS-NOT-EOF-PROMO                    VALUE 'N'.       00410044
004200                                                                  00420044
004300     05  PS-EOF-MDSE-SW               PIC  X(01) VALUE SPACE.     00430044
004400         88  PS-EOF-MDSE                         VALUE 'Y'.       00440044
004500         88  PS-NOT-EOF-MDSE                     VALUE 'N'.       00450044
004600                                                                  00460044
004700     05  PS-END-OF-TODAYS-DATE-SW     PIC  X(01) VALUE 'N'.       00470044
004800         88  PS-END-OF-TODAYS-DATE-FILE          VALUE 'Y'.       00480044
004900                                                                  00490044
005000     05  PS-END-OF-DAYS-TO-RETAIN-SW  PIC  X(01) VALUE 'N'.       00500044
005100         88  PS-END-OF-DAYS-TO-RETAIN-FILE       VALUE 'Y'.       00510044
005200                                                                  00520044
005300     05  PS-EOF-ADHC-SW               PIC  X(01) VALUE SPACE.     00530044
005400         88  PS-EOF-ADHC                         VALUE 'Y'.       00540044
005500         88  PS-NOT-EOF-ADHC                     VALUE 'N'.       00550044
005600                                                                  00560044
005700     05  PS-INTEGRITY-ERR-SW          PIC  X(01) VALUE SPACE.     00570044
005800         88  PS-YES-INTEGRITY-ERR                VALUE 'Y'.       00580044
005900         88  PS-NO-INTEGRITY-ERR                 VALUE 'N'.       00590044
006000                                                                  00600044
006100     05  PS-DELETE-XST00036           PIC  X(01) VALUE 'N'.       00610044
006200         88  PS-DELETE-XST00036-YES              VALUE 'Y'.       00620044
006300                                                                  00630044
006400     05  PS-PROCESS-COMPLETE-SW       PIC  X(01) VALUE 'Y'.       00640044
006500         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       00650044
006600         88  PS-PROCESS-COMPLETE                 VALUE 'N'.       00660044
006700         88  PS-PROCESS-STOP                     VALUE 'S'.       00670044
006800                                                                  00680044
006900     05  PS-IS-ROW-FOUND              PIC  X(01) VALUE 'N'.       00690044
007000         88  PS-ROW-FOUND                        VALUE 'Y'.       00700044
007100         88  PS-ROW-NOT-FOUND                    VALUE 'N'.       00710044
007200                                                                  00720044
007300     05  PS-REBATE-DELETE             PIC  X(01) VALUE 'N'.       00730044
007400         88 PS-REBATE-DELETE-YES                 VALUE 'Y'.       00740044
007500         88 PS-REBATE-DELETE-NO                  VALUE 'N'.       00750044
007600                                                                  00760044
007700     05  PS-REBATE-ID-PROCESS         PIC  X(01) VALUE 'N'.       00770044
007800         88 PS-REBATE-ID-NO-MORE                 VALUE 'N'.       00780044
007900         88 PS-REBATE-ID-FOUND                   VALUE 'Y'.       00790044
008000                                                                  00800044
008100     05  PS-PROMO-DATA                PIC  X(01) VALUE 'Y'.       00810044
008200         88 PS-PROMO-DATA-FOUND                  VALUE 'Y'.       00820044
008300         88 PS-PROMO-DATA-NOT-FOUND              VALUE 'N'.       00830044
008400                                                                  00840044
008500******************************************************************00850044
008600*                       ACCUMULATORS                              00860044
008700******************************************************************00870044
008800 01  PROGRAM-ACCUM.                                               00880044
008900     05  PA-READ                      PIC  9(11) VALUE ZERO.      00890044
009000     05  PV-PROMO-READ                PIC  9(08) VALUE ZERO.      00900044
009100     05  PV-HOLD-AD-EVNT-ID           PIC S9(10)V COMP-3.         00910044
009200     05  PV-HOLD-PROMO-ID             PIC S9(10)V COMP-3.         00920044
009300     05  PV-HOLD-START-DATE           PIC  X(10) VALUE SPACES.    00930044
009400     05  PV-HOLD-END-DATE             PIC  X(10) VALUE SPACES.    00940044
009500                                                                  00950044
009600     05  PV-XST00026-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      00960044
009700     05  PV-XST00027-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      00970044
009800     05  PV-XST00028-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      00980044
009900     05  PV-XST00029-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      00990044
010000     05  PV-XST00030-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01000044
010100     05  PV-XST00031-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01010044
010200     05  PV-XST00032-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01020044
010300     05  PV-XST00033-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01030044
010400     05  PV-XST00034-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01040044
010500*    05  PV-XST00035-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01050046
010600     05  PV-XST00036-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01060044
010700     05  PV-XST00130-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01070044
010800     05  PV-XST00131-ROW-DELETE-CNTR  PIC  9(11) VALUE ZERO.      01080044
010900                                                                  01090044
011000                                                                  01100044
011100******************************************************************01110044
011200*                           CONSTANTS                             01120044
011300******************************************************************01130044
011400 01  PROGRAM-CONSTANTS.                                           01140044
011500                                                                  01150044
011600     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XSKUP073'.01160044
011700                                                                  01170044
011800     05  PC-MINUS-ONE                 PIC S9(01) VALUE -1.        01180044
011900     05  PC-SYSTEM                    PIC  X(08) VALUE 'SYSTEM  '.01190044
012000                                                                  01200044
012100     05  PC-ROW-FOUND                 PIC S9(04) VALUE +0         01210044
012200                                                 COMP SYNC.       01220044
012300     05  PC-ROW-NOT-FOUND             PIC S9(04) VALUE +100       01230044
012400                                                 COMP SYNC.       01240044
012500     05  PC-MAXIMUM-RETRY-COUNT       PIC S9(04) VALUE +3         01250044
012600                                                 COMP SYNC.       01260044
012610     05  PC-COMMIT-LIMIT              PIC S9(04) VALUE +5000.     01261049
012700                                                                  01270044
012800******************************************************************01280044
012900*                          VARIABLES                              01290044
013000******************************************************************01300044
013100 01  PROGRAM-VARIABLES.                                           01310044
013200     05  PV-SQL-SUB                   PIC  9(03) VALUE ZERO.      01320044
013300     05  PV-DEADLOCK-COUNTER          PIC  9(03) VALUE ZERO.      01330044
013400     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     01340044
013500     05  PV-OPERATION-MSG             PIC  X(35) VALUE SPACE.     01350044
013600     05  PV-DB2-OPERATION             PIC  X(50) VALUE SPACE.     01360044
013700     05  PV-RET-CODE                  PIC  9(04) VALUE ZERO.      01370044
013800     05  PV-IN-DAYS                   PIC  S9(09) COMP.           01380044
013900     05  PV-AD-EVNT-ID                PIC S9(10)V VALUE ZERO      01390044
014000                                                  COMP-3.         01400044
014100     05  PV-PROMO-ID                  PIC S9(10)V VALUE ZERO      01410044
014200                                                  COMP-3.         01420044
014300     05  PV-PROMO-COUNT               PIC S9(10)V VALUE ZERO      01430044
014400                                                  COMP-3.         01440044
014500     05  PV-PROMO-INTFC-ID            PIC S9(10)V VALUE ZERO      01450044
014600                                                  COMP-3.         01460044
014700     05  PV-MDSE-LNE-ID               PIC S9(10)V VALUE ZERO      01470044
014800                                                  COMP-3.         01480044
014900     05  PV-ADHC-STR-GP-ID            PIC S9(10)V VALUE ZERO      01490044
015000                                                  COMP-3.         01500044
015100     05  PV-REBT-FM-ID                PIC S9(10)V VALUE ZERO      01510044
015200                                                  COMP-3.         01520044
015300     05  PV-RUSBL-IND                 PIC  X(01).                 01530044
015400     05  PV-START-DATE                PIC  X(10) VALUE SPACES.    01540044
015500     05  PV-END-DATE                  PIC  X(10) VALUE SPACES.    01550044
015600     05  PV-NULL-IND                  PIC S9(04)  COMP.           01560044
015700     05  PV-PRINT-RECORD              PIC  X(200) VALUE SPACE.    01570044
015800     05  PV-NUMBER-OF-RETRIES         PIC  9(09) VALUE ZERO.      01580044
015900     05  PV-LINE-SPACING              PIC S9(04) VALUE ZERO       01590044
016000                                                 COMP SYNC.       01600044
016100     05  PV-PURGE-LINE-CNT            PIC S9(04) VALUE ZERO       01610044
016200                                                 COMP SYNC.       01620044
016300     05  PV-SQL-DELETE-COUNT          PIC S9(11) VALUE ZERO       01630044
016400                                                 COMP-3.          01640044
016500     05  PV-SQLERRD3                  PIC S9(09) VALUE ZERO       01650044
016600                                                 COMP-3.          01660044
016700     05  PV-RETRY-COUNT               PIC S9(04) VALUE ZERO       01670044
016800                                                 COMP SYNC.       01680044
016900     05  PV-PROMO-CNT                 PIC S9(04) VALUE ZERO       01690044
017000                                                 COMP-3.          01700044
017010     05  PV-MDSE-LNE-COMMITS          PIC S9(04) VALUE ZERO.      01701049
017100******************************************************************01710044
017200*                          TIMESTAMPS                             01720044
017300******************************************************************01730044
017400 01  PV-CURRENT-TIMESTAMP             PIC  X(26) VALUE SPACE.     01740044
017500                                                                  01750044
017600 01  PV-END-PGM-TMST.                                             01760044
017700     05  PV-END-PGM-DATE              PIC  X(10) VALUE SPACE.     01770044
017800     05  PV-END-PGM-TIME              PIC  X(16) VALUE SPACE.     01780044
017900 01  PV-BEGIN-PURGE-DATE              PIC  X(10) VALUE SPACE.     01790044
018000                                                                  01800044
018100 01  PV-BEGIN-PURGE-DATE-TIMESTAMP.                               01810044
018200     05  PV-PURGE-DATE                PIC  X(10) VALUE SPACE.     01820044
018300     05  PV-PURGE-TIMESTAMP           PIC  X(16) VALUE SPACE.     01830044
018400                                                                  01840044
018500 01  PV-BEGIN-PURGE-TIMESTAMP         PIC  X(26) VALUE SPACE.     01850044
018600                                                                  01860044
018700******************************************************************01870044
018800*               SYSTEM TIME AND DATE VARIABLES                    01880044
018900******************************************************************01890044
019000                                                                  01900044
019100 01  SYS-DATE-TIME.                                               01910044
019200     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01920044
019300     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01930044
019400                                                                  01940044
019900                                                                  01990044
019910 01  ST-BEG-TIME.                                                 01991045
019920     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01992045
019930     05  FILLER                       PIC  X(01) VALUE ':'.       01993045
019940     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01994045
019950                                                                  01995045
020000 01  ST-END-TIME.                                                 02000044
020100     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     02010044
020200     05  FILLER                       PIC  X(01) VALUE ':'.       02020044
020300     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     02030044
020400                                                                  02040044
020500 01  SD-EDIT-DATE.                                                02050044
020600     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     02060044
020700     05  FILLER                       PIC  X(01) VALUE '-'.       02070044
020800     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     02080044
020900     05  FILLER                       PIC  X(01) VALUE '-'.       02090044
021000     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     02100044
021100     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     02110044
021200                                                                  02120044
021300******************************************************************02130044
021400*                        ERROR HANDLING                           02140044
021500******************************************************************02150044
021600 01  ABEND-CODE                       PIC S9(04) VALUE ZEROS      02160044
021700                                                 COMP SYNC.       02170044
021800     88  ABEND-4002-READ-ERROR                   VALUE +4002.     02180044
021900     88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.     02190044
022000     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     02200044
022100     88  ABEND-4019-CAL-SUB-ERROR                VALUE +4019.     02210044
022200                                                                  02220044
022300                                                                  02230044
022400******************************************************************02240044
022500* THE DATE TO BEGIN TABLE PURGE CALCULATION FROM                  02250044
022600******************************************************************02260044
022700     COPY EPWS170.                                                02270044
022800                                                                  02280044
022900******************************************************************02290044
023000* THE NUMBER OF DAYS TO RETAIN ON THE XS TABLE                    02300044
023100******************************************************************02310044
023200     COPY EPWS171.                                                02320044
023300                                                                  02330044
023400******************************************************************02340044
023500* DATE ROUTINE COPY MEMBERS                                       02350044
023600******************************************************************02360044
023700     COPY DPWS500.                                                02370044
023800                                                                  02380044
023900******************************************************************02390044
024000*  DB2 FORMATTED ERROR MESSAGE                                    02400044
024100******************************************************************02410044
024200     COPY DPWS004.                                                02420044
024300                                                                  02430044
024400******************************************************************02440044
024500*  SQL COMMUNICATIONS WORK AREA                                   02450044
024600******************************************************************02460044
024700     COPY SQLCA2.                                                 02470044
024800                                                                  02480044
024900******************************************************************02490044
025000*  COMMUNICATIONS AREA FOR DB2                                    02500044
025100******************************************************************02510044
025200     EXEC SQL                                                     02520044
025300         INCLUDE SQLCA                                            02530044
025400     END-EXEC.                                                    02540044
025500                                                                  02550044
025600******************************************************************02560044
025700*  DB2 TABLE XST00026(XST_PROMO) - PROMO TABLE                    02570044
025800******************************************************************02580044
025900     EXEC SQL                                                     02590044
026000          INCLUDE XST00026                                        02600044
026100     END-EXEC.                                                    02610044
026200                                                                  02620044
026300******************************************************************02630044
026400*  DB2 TABLE XST00027(XST_AD_EVNT) - AD EVENT TABLE               02640044
026500******************************************************************02650044
026600     EXEC SQL                                                     02660044
026700          INCLUDE XST00027                                        02670044
026800     END-EXEC.                                                    02680044
026900                                                                  02690044
027000******************************************************************02700044
027100*  DB2 TABLE XST00028(XST_MDSE_LNE_SELN)                          02710044
027200******************************************************************02720044
027300     EXEC SQL                                                     02730044
027400          INCLUDE XST00028                                        02740044
027500     END-EXEC.                                                    02750044
027600                                                                  02760044
027700******************************************************************02770044
027800*  DB2 TABLE XST00029(XST_PROMO_STR_GP)                           02780044
027900******************************************************************02790044
028000*    EXEC SQL                                                     02800046
028100*         INCLUDE XST00029                                        02810046
028200*    END-EXEC.                                                    02820046
028300*                                                                 02830046
028400******************************************************************02840044
028500*  DB2 TABLE XST00030(XST_SMP_PRICG)                              02850044
028600******************************************************************02860044
028700*    EXEC SQL                                                     02870046
028800*         INCLUDE XST00030                                        02880046
028900*    END-EXEC.                                                    02890046
029000*                                                                 02900046
029100******************************************************************02910044
029200*  DB2 TABLE XST00031(XST_PROMO_ADHC_RLT)                         02920044
029300******************************************************************02930044
029400     EXEC SQL                                                     02940044
029500          INCLUDE XST00031                                        02950044
029600     END-EXEC.                                                    02960044
029700                                                                  02970044
029800******************************************************************02980044
029900*  DB2 TABLE XST00032(XST_PROMO_PRIC_VER)                         02990044
030000******************************************************************03000044
030100     EXEC SQL                                                     03010044
030200          INCLUDE XST00032                                        03020044
030300     END-EXEC.                                                    03030044
030400                                                                  03040044
030500******************************************************************03050044
030600*  DB2 TABLE XST00033(XST_PROMO_ADHC_STR)                         03060044
030700******************************************************************03070044
030800     EXEC SQL                                                     03080044
030900          INCLUDE XST00033                                        03090044
031000     END-EXEC.                                                    03100044
031100                                                                  03110044
031200******************************************************************03120044
031300*  DB2 TABLE XST00034(XST_EXCL_MDSE)                              03130044
031400******************************************************************03140044
031500*    EXEC SQL                                                     03150046
031600*         INCLUDE XST00034                                        03160046
031700*    END-EXEC.                                                    03170046
031800*                                                                 03180046
031900******************************************************************03190044
032000*  DB2 TABLE XST00035(XST_TIER_PRICG)                             03200044
032100******************************************************************03210044
032200*    EXEC SQL                                                     03220046
032300*         INCLUDE XST00035                                        03230046
032400*    END-EXEC.                                                    03240046
032500*                                                                 03250046
032600******************************************************************03260044
032700*  DB2 TABLE XST00036(XST_ADHC_STR_GP)                            03270044
032800******************************************************************03280044
032900     EXEC SQL                                                     03290044
033000          INCLUDE XST00036                                        03300044
033100     END-EXEC.                                                    03310044
033200                                                                  03320044
033300******************************************************************03330044
033400*  DB2 TABLE XST00130(XST_REBT_FM)                                03340044
033500******************************************************************03350044
033600     EXEC SQL                                                     03360044
033700          INCLUDE XST00130                                        03370044
033800     END-EXEC.                                                    03380044
033900                                                                  03390044
034000******************************************************************03400044
034100*  DB2 TABLE XST00131(XST_REBT_FM_TXT)                            03410044
034200******************************************************************03420044
034300     EXEC SQL                                                     03430044
034400          INCLUDE XST00131                                        03440044
034500     END-EXEC.                                                    03450044
034600                                                                  03460044
034700******************************************************************03470044
034800*  PROMO TABLE CURSOR  (MAIN CURSOR)                              03480044
034900******************************************************************03490044
035000     EXEC SQL                                                     03500044
035100       DECLARE PROMO-TABLE-CSR CURSOR WITH HOLD FOR               03510044
035200        SELECT PROMO_ID                                           03520044
035300              ,AD_EVNT_ID                                         03530044
035400        FROM XST_PROMO                                            03540044
035500        WHERE                                                     03550044
035600          (ACTL_END_TMST <=                                       03560044
035700          (CURRENT TIMESTAMP - :PV-IN-DAYS DAYS)                  03570044
035800           AND STAT_CDE = 'S')                                    03580044
035900           OR  STAT_CDE = 'D'                                     03590044
036000           OR  STAT_CDE = 'C'                                     03600044
036100        ORDER BY 1,2                                              03610044
036200        WITH UR                                                   03620044
036300     END-EXEC.                                                    03630044
036400                                                                  03640044
036500******************************************************************03650044
036600*   MDSE LINE CURSOR                                              03660044
036700******************************************************************03670044
036800     EXEC SQL                                                     03680044
036900       DECLARE MDSE-LINE-CSR CURSOR WITH HOLD FOR                 03690044
037000        SELECT PROMO_INTFC_ID                                     03700044
037100              ,MDSE_LNE_ID                                        03710044
037200        FROM XST_MDSE_LNE_SELN                                    03720044
037300        WHERE PROMO_ID = :XST00026-PROMO-ID                       03730044
037310        ORDER BY 1,2                                              03731049
037400        WITH UR                                                   03740044
037500     END-EXEC.                                                    03750044
037600                                                                  03760044
037700******************************************************************03770044
037800*   ADHC STORE GROUP CURSOR                                       03780044
037900******************************************************************03790044
038000     EXEC SQL                                                     03800044
038100       DECLARE ADHC-STR-GP-CSR CURSOR WITH HOLD FOR               03810044
038200       SELECT DISTINCT PAR.ADHC_STR_GP_ID                         03820044
038300       FROM  XST_PROMO_ADHC_RLT       PAR                         03830044
038400            ,XST_ADHC_STR_GP          ASG                         03840044
038500            ,XST_PROMO                PROMO                       03850044
038600            ,XST_MDSE_LNE_SELN        MLS                         03860044
038700       WHERE ((PROMO.ACTL_END_TMST <=                             03870044
038800                 (CURRENT TIMESTAMP - :PV-IN-DAYS DAYS)           03880044
038900          AND  PROMO.STAT_CDE = 'S')                              03890044
039000           OR  PROMO.STAT_CDE = 'D'                               03900044
039100           OR  PROMO.STAT_CDE = 'C')                              03910044
039200          AND  PROMO.PROMO_ID     = MLS.PROMO_ID                  03920044
039300          AND  MLS.PROMO_INTFC_ID = PAR.PROMO_INTFC_ID            03930044
039400          AND  MLS.MDSE_LNE_ID    = PAR.MDSE_LNE_ID               03940044
039500          AND  PAR.ADHC_STR_GP_ID = ASG.ADHC_STR_GP_ID            03950044
039600          AND  ASG.RUSBL_IND      = 'N'                           03960044
039700          WITH UR                                                 03970044
039800     END-EXEC.                                                    03980044
039900                                                                  03990044
040000******************************************************************04000044
040100*   REBATE - CURSOR                                               04010044
040200******************************************************************04020044
040300     EXEC SQL                                                     04030044
040400       DECLARE REBATE-CSR CURSOR FOR                              04040044
040500       SELECT DISTINCT  RF.REBT_FM_ID                             04050044
040600       FROM XST_PROMO           PROMO                             04060044
040700           ,XST_MDSE_LNE_SELN   MLS                               04070044
040800           ,XST_REBT_FM         RF                                04080044
040900       WHERE ((PROMO.ACTL_END_TMST <=                             04090044
041000                 (CURRENT TIMESTAMP - :PV-IN-DAYS DAYS)           04100044
041100         AND  PROMO.STAT_CDE = 'S')                               04110044
041200          OR  PROMO.STAT_CDE = 'D'                                04120044
041300          OR  PROMO.STAT_CDE = 'C')                               04130044
041400         AND  PROMO.PROMO_ID     = MLS.PROMO_ID                   04140044
041500         AND  MLS.PROMO_INTFC_ID = RF.PROMO_INTFC_ID              04150044
041600         AND  MLS.MDSE_LNE_ID    = RF.MDSE_LNE_ID                 04160044
041700         WITH UR                                                  04170044
041800     END-EXEC.                                                    04180044
041900                                                                  04190044
042000******************************************************************04200044
042100 PROCEDURE DIVISION.                                              04210044
042200******************************************************************04220044
042300                                                                  04230044
042400 0000-MAINLINE.                                                   04240044
042500                                                                  04250044
042600     PERFORM 1000-INITIALIZATION.                                 04260044
042700       IF PS-PROMO-DATA-NOT-FOUND                                 04270044
042800         DISPLAY 'COUNT OF PROMO-DATA IS ZERO HENCE TERMINATING'  04280044
042900         PERFORM Z300-CONTROL                                     04290044
043000         GOBACK                                                   04300044
043100       ELSE                                                       04310044
043200         PERFORM 2000-PROCESS-DATA                                04320044
043300         PERFORM Z300-CONTROL                                     04330044
043400         GOBACK                                                   04340044
043410       END-IF.                                                    04341044
043420                                                                  04342044
043430******************************************************************04343044
043440* - OPENS INPUT CONTROL CARDS                                     04344044
043450* - READS IN TODAYS DATE AND NUMBER OF DAYS BACK TO               04345044
043460*   BEGIN DELETE PROCESS                                          04346044
043470* - CALCULATES NUMBER OF DAYS BACK TO BEGIN DELETING              04347044
043480******************************************************************04348044
043490 1000-INITIALIZATION.                                             04349044
043500                                                                  04350044
043600     OPEN INPUT  TODAYS-DATE-CC                                   04360044
043700                 DAYS-TO-RETAIN-CC                                04370044
043800                                                                  04380044
043900     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 04390044
044000                                                                  04400044
044100     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            04410044
044200     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            04420044
044300                                                                  04430044
044400     MOVE SYS-DATE (1:2) TO SD-CENT.                              04440044
044500     MOVE SYS-DATE (3:2) TO SD-YEAR.                              04450044
044600     MOVE SYS-DATE (5:2) TO SD-MONTH.                             04460044
044700     MOVE SYS-DATE (7:2) TO SD-DAY.                               04470044
044800                                                                  04480044
044900                                                                  04490044
045000     PERFORM 1100-PROCESS-TODAYS-DATE-CC.                         04500044
045100     PERFORM 1200-PROCESS-DAYS-TO-RETAIN-CC.                      04510044
045200     PERFORM 1300-CALC-PURGE-DATE.                                04520044
045300                                                                  04530044
045400     MOVE CC-EPCC171-PURGE-RETAIN-DAYS TO PV-IN-DAYS.             04540044
045500                                                                  04550044
045600       PERFORM 1400-CHECK-PROMO-COUNT.                            04560044
045700                                                                  04570044
045800******************************************************************04580044
045900* - READS INPUT TODAYS DATE CONTROL CARD                          04590044
046000* - CONVERTS FORMAT OF DATE                                       04600044
046100******************************************************************04610044
046200 1100-PROCESS-TODAYS-DATE-CC.                                     04620044
046300                                                                  04630044
046400     READ TODAYS-DATE-CC INTO CC-EPCC170-CONTROL-CARD             04640044
046500        AT END SET PS-END-OF-TODAYS-DATE-FILE TO TRUE.            04650044
046600                                                                  04660044
046700     IF PS-END-OF-TODAYS-DATE-FILE                                04670044
046800         MOVE '1100-PROCESS-TODAYS-DATE'  TO PV-PARAGRAPH-NAME    04680044
046900         MOVE 'EMPTY TODAYS DATE CC '     TO PV-OPERATION-MSG     04690044
047000         SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                 04700044
047100         PERFORM Z100-ABEND                                       04710044
047200     END-IF.                                                      04720044
047300                                                                  04730044
047400     CLOSE TODAYS-DATE-CC.                                        04740044
047500                                                                  04750044
047600******************************************************************04760044
047700* READS NUMBER OF DAYS TO RETAIN DATA ON DATABASE FROM INPUT      04770044
047800* CONTROL CARD                                                    04780044
047900******************************************************************04790044
048000 1200-PROCESS-DAYS-TO-RETAIN-CC.                                  04800044
048100                                                                  04810044
048200     READ DAYS-TO-RETAIN-CC INTO CC-EPCC171-CONTROL-CARD          04820044
048300        AT END SET PS-END-OF-DAYS-TO-RETAIN-FILE TO TRUE.         04830044
048400                                                                  04840044
048500     IF PS-END-OF-DAYS-TO-RETAIN-FILE                             04850044
048600         MOVE '1200-PROCESS-DAYS-TO-RETAIN-CC'                    04860044
048700                                          TO PV-PARAGRAPH-NAME    04870044
048800         MOVE 'EMPTY DAYS TO RETAIN CC'   TO PV-OPERATION-MSG     04880044
048900         SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                 04890044
049000         PERFORM Z100-ABEND                                       04900044
049100     END-IF.                                                      04910044
049200                                                                  04920044
049300     CLOSE DAYS-TO-RETAIN-CC.                                     04930044
049400                                                                  04940044
049500                                                                  04950044
049600******************************************************************04960044
049700* BASED ON CONTROL CARD INPUT FIND X NUMBER PREVIOUS DAYS BACK    04970044
049800******************************************************************04980044
049900 1300-CALC-PURGE-DATE.                                            04990044
050000                                                                  05000044
050100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05010044
050200                                                                  05020044
050300     MOVE CC-EPCC170-TODAY-DATE        TO DPG52-LK-DATE-INPUT.    05030044
050400                                                                  05040044
050500     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   05050044
050600     SET DPG51-ACTUAL-CALENDAR-ONLY    TO TRUE.                   05060044
050700     SET DPG51-DECREMENT-DATE          TO TRUE.                   05070044
050800                                                                  05080044
050900     MOVE CC-EPCC171-PURGE-RETAIN-DAYS TO DPG51-INCR-DECR-DAYS-9. 05090044
051000                                                                  05100044
051100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          05110044
051200                                             DPG53 DPG54          05120044
051300                                             DPG55 DPG56.         05130044
051400                                                                  05140044
051500     EVALUATE TRUE                                                05150044
051600         WHEN DPG54-NO-ERROR                                      05160044
051700          MOVE DPG55-DB2-ISO-DATE-FMT                             05170044
051800                                    TO PV-BEGIN-PURGE-DATE        05180044
051900          DISPLAY 'BEGIN PURGE DATE: ' PV-BEGIN-PURGE-DATE        05190044
052000          MOVE PV-BEGIN-PURGE-DATE  TO PV-PURGE-DATE              05200044
052100          MOVE '-00.00.00.000000'   TO PV-PURGE-TIMESTAMP         05210044
052200          MOVE PV-BEGIN-PURGE-DATE-TIMESTAMP TO                   05220044
052300               PV-BEGIN-PURGE-TIMESTAMP                           05230044
052400          DISPLAY 'BEGIN PURGE TIME: ' PV-BEGIN-PURGE-TIMESTAMP   05240044
052500                                                                  05250044
052600         WHEN DPG54-SEVERE-ERROR                                  05260044
052700         WHEN DPG54-WARNING-ERROR                                 05270044
052800         WHEN DPG54-DATE-INVALID                                  05280044
052900           CONTINUE                                               05290044
053000                                                                  05300044
053100     END-EVALUATE.                                                05310044
053101                                                                  05310144
053102******************************************************************05310200
053103* - CHECKS THE PROMO COUNT. IF IT IS ZERO THEN PROGRAM            05310300
053104* - SHOULD TERMINATE                                              05310400
053105******************************************************************05310500
053106 1400-CHECK-PROMO-COUNT.                                          05310620
053107                                                                  05310744
053108     INITIALIZE PV-PROMO-CNT.                                     05310844
053109     EXEC SQL                                                     05310919
053110       SELECT COUNT(*)                                            05311044
053111        INTO :PV-PROMO-CNT                                        05311144
053112       FROM XST_PROMO                                             05311219
053113        WHERE DATE(ACTL_END_TMST + 500 DAYS) <= CURRENT DATE      05311319
053114       WITH UR                                                    05311419
053115     END-EXEC.                                                    05311519
053116                                                                  05311619
053117     EVALUATE TRUE                                                05311719
053118                                                                  05311844
053119       WHEN SQLCODE = PC-ROW-FOUND                                05311920
053120       WHEN SQLCODE = PC-ROW-NOT-FOUND                            05312020
053121           IF PV-PROMO-CNT = 0                                    05312119
053122              SET PS-PROMO-DATA-NOT-FOUND TO TRUE                 05312220
053123              DISPLAY 'NO PROMO ID FOUND '                        05312344
053124           ELSE                                                   05312419
053125              CONTINUE                                            05312519
053126           END-IF                                                 05312619
053127       WHEN OTHER                                                 05312719
053128           MOVE '1500-PROCESS-COUNT'        TO PV-PARAGRAPH-NAME  05312820
053129           MOVE 'ERROR ON PROCESSING-COUNT' TO PV-OPERATION-MSG   05312919
053130           PERFORM Z200-SQL-ABEND                                 05313019
053131                                                                  05313144
053132     END-EVALUATE.                                                05313219
053133                                                                  05313344
053134******************************************************************05313444
053135* MAIN PROCESS PARA                                               05313544
053136******************************************************************05313644
053137 2000-PROCESS-DATA.                                               05313744
053138                                                                  05313844
053139     PERFORM A000-PROCESS-REBATE.                                 05313944
053140     PERFORM Y100-COMMIT.                                         05314044
053150                                                                  05315044
053160     PERFORM B000-PROCESS-ADHC-STORE.                             05316044
053170     PERFORM Y100-COMMIT.                                         05317044
053180                                                                  05318044
053190     PERFORM C000-PROCESS-PROMO.                                  05319044
053200**   PERFORM Y100-COMMIT.                                         05320053
053300                                                                  05330044
053400******************************************************************05340044
053500* PROCESS-MAIN REBATE CURSOR                                      05350044
053600******************************************************************05360044
053700 A000-PROCESS-REBATE.                                             05370044
053800                                                                  05380044
053900     SET PS-REBATE-DELETE-NO  TO TRUE.                            05390045
054000     SET PS-REBATE-ID-NO-MORE TO TRUE.                            05400045
054100                                                                  05410044
054130                                                                  05413045
054200     PERFORM A110-OPEN-REBATE-CURSOR.                             05420045
054300     PERFORM A120-FETCH-REBATE-CURSOR.                            05430045
054400     PERFORM A130-PROCESS-REBATE-TXT                              05440045
054500       UNTIL PS-REBATE-ID-NO-MORE.                                05450045
054600     PERFORM A140-CLOSE-REBATE-CURSOR.                            05460045
054700                                                                  05470044
054800******************************************************************05480044
054900* OPEN REBATE-CURSOR CURSOR                                       05490044
055000******************************************************************05500044
055100 A110-OPEN-REBATE-CURSOR.                                         05510044
055200                                                                  05520044
055300     EXEC SQL                                                     05530044
055400          OPEN REBATE-CSR                                         05540044
055500     END-EXEC.                                                    05550044
055600                                                                  05560044
055700     EVALUATE TRUE                                                05570044
055800         WHEN SQLCODE = PC-ROW-FOUND                              05580044
055900             CONTINUE                                             05590044
056000         WHEN SQLWARN0 NOT EQUAL SPACE                            05600044
056100         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      05610044
056200             MOVE 'A110-OPEN-REBATE-CURSOR'                       05620044
056300                                            TO PV-PARAGRAPH-NAME  05630044
056400             MOVE 'ERROR ON OPEN OF REBATE-CURSOR'                05640044
056500                                            TO PV-DB2-OPERATION   05650044
056600             PERFORM Z200-SQL-ABEND                               05660044
056700     END-EVALUATE.                                                05670044
056800                                                                  05680044
056900******************************************************************05690044
057000* CHECK IF REBATE ON XST_REBT_FM (XST00130)                       05700044
057100******************************************************************05710044
057200 A120-FETCH-REBATE-CURSOR.                                        05720044
057300                                                                  05730044
057400     INITIALIZE XST00130-REBT-FM-ID.                              05740044
057500                                                                  05750044
057600     EXEC SQL                                                     05760044
057700         FETCH REBATE-CSR                                         05770044
057800             INTO :XST00130-REBT-FM-ID                            05780044
057900     END-EXEC.                                                    05790044
058000                                                                  05800044
058100     EVALUATE TRUE                                                05810045
058300         WHEN SQLCODE = PC-ROW-FOUND                              05830045
058400            SET PS-REBATE-ID-FOUND   TO TRUE                      05840045
058500            SET PS-REBATE-DELETE-YES TO TRUE                      05850045
058600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          05860045
058700            SET PS-REBATE-ID-NO-MORE TO TRUE                      05870045
058800         WHEN OTHER                                               05880045
058900            DISPLAY '                                        '    05890045
059000            DISPLAY '****************************************'    05900045
059100            DISPLAY '* A120-FETCH-REBATE-CURSOR ABEND'            05910045
059200            DISPLAY '*======================================='    05920045
059300            DISPLAY 'REBATE ID        = ' XST00130-REBT-FM-ID     05930045
059400            DISPLAY '                                        '    05940045
059600            MOVE 'A120-FETCH-REBATE-CURSOR' TO PV-PARAGRAPH-NAME  05960045
059700            MOVE 'FETCH  XST00130 TABLE'    TO PV-DB2-OPERATION   05970045
059800            PERFORM Z200-SQL-ABEND                                05980045
059900     END-EVALUATE.                                                05990044
060000                                                                  06000044
060100******************************************************************06010044
060200*  PROCESS THE REBATES                                            06020044
060300******************************************************************06030044
060400 A130-PROCESS-REBATE-TXT.                                         06040044
060500                                                                  06050044
060600     INITIALIZE PV-REBT-FM-ID.                                    06060045
060700     MOVE XST00130-REBT-FM-ID TO PV-REBT-FM-ID.                   06070045
060800                                                                  06080045
060900     PERFORM D100-DELETE-XST00131.                                06090045
061000     IF PS-REBATE-DELETE-YES                                      06100045
061100        PERFORM D200-DELETE-XST00130                              06110045
061200     END-IF.                                                      06120045
061300                                                                  06130044
061400     PERFORM A120-FETCH-REBATE-CURSOR.                            06140045
061500                                                                  06150044
061600******************************************************************06160044
061700*  CLOSE REBATE-CURSOR                                            06170044
061800******************************************************************06180044
061900 A140-CLOSE-REBATE-CURSOR.                                        06190044
062000                                                                  06200044
062100     EXEC SQL                                                     06210044
062200          CLOSE REBATE-CSR                                        06220044
062300     END-EXEC.                                                    06230044
062400                                                                  06240044
062500     EVALUATE TRUE                                                06250044
062600         WHEN SQLCODE = PC-ROW-FOUND                              06260044
062700            CONTINUE                                              06270045
062900         WHEN SQLWARN0 NOT EQUAL SPACE                            06290044
063000         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      06300044
063100            MOVE 'A140-CLOSE-REBATE-CURSOR' TO PV-PARAGRAPH-NAME  06310045
063300            MOVE 'ERROR ON CLOSE OF REBATE-CURSOR'                06330045
063400                                            TO PV-DB2-OPERATION   06340044
063500            PERFORM Z200-SQL-ABEND                                06350045
063600     END-EVALUATE.                                                06360044
063700                                                                  06370044
063800******************************************************************06380044
063900*   PROCESS-MAIN ADHOC STORE GROUP ID CURSOR                      06390044
064000******************************************************************06400044
064100 B000-PROCESS-ADHC-STORE.                                         06410044
064200                                                                  06420044
064230                                                                  06423045
064300     PERFORM B110-OPEN-ADHC-STR-GP-CURSOR.                        06430045
064400     PERFORM B120-FETCH-ADHC-STR-GP-CURSOR.                       06440045
064500     PERFORM B130-PROCESS-ADHC-STR-GP                             06450045
064600       UNTIL PS-EOF-ADHC.                                         06460045
064700     PERFORM B140-CLOSE-ADHC-STR-GP-CURSOR.                       06470045
064800                                                                  06480044
064900******************************************************************06490044
065000*   OPEN ADHOC STORE GROUP ID CURSOR                              06500044
065100******************************************************************06510044
065200 B110-OPEN-ADHC-STR-GP-CURSOR.                                    06520044
065300                                                                  06530044
065400     EXEC SQL                                                     06540044
065500          OPEN ADHC-STR-GP-CSR                                    06550044
065600     END-EXEC.                                                    06560044
065700                                                                  06570044
065800     EVALUATE TRUE                                                06580044
065900         WHEN SQLCODE = PC-ROW-FOUND                              06590044
066000              CONTINUE                                            06600044
066100                                                                  06610044
066200         WHEN SQLWARN0 NOT EQUAL SPACE                            06620044
066300         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      06630044
066400             MOVE 'B110-OPEN-ADHC-STR-GP-CURSOR'                  06640044
066500                                            TO PV-PARAGRAPH-NAME  06650044
066600             MOVE 'ERROR ON OPEN OF ADHOC STR CURSOR'             06660044
066700                                            TO PV-DB2-OPERATION   06670044
066800             PERFORM Z200-SQL-ABEND                               06680044
066900     END-EVALUATE.                                                06690044
067000                                                                  06700044
067100******************************************************************06710044
067200*   FETCH ADHOC STORE GROUP ID                                    06720044
067300******************************************************************06730044
067400 B120-FETCH-ADHC-STR-GP-CURSOR.                                   06740044
067500                                                                  06750044
067600     INITIALIZE XST00031-ADHC-STR-GP-ID.                          06760045
067700                                                                  06770044
067800     EXEC SQL                                                     06780045
067900          FETCH ADHC-STR-GP-CSR                                   06790045
068000           INTO :XST00031-ADHC-STR-GP-ID                          06800045
068100     END-EXEC.                                                    06810045
068200                                                                  06820044
068300     EVALUATE TRUE                                                06830044
068400         WHEN SQLCODE = PC-ROW-FOUND                              06840044
068500             CONTINUE                                             06850044
068600                                                                  06860044
068700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          06870044
068800             MOVE 'Y' TO PS-EOF-ADHC-SW                           06880044
068900                                                                  06890044
069000         WHEN SQLWARN0 NOT EQUAL SPACE                            06900044
069100         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      06910044
069200             MOVE 'B120-FETCH-ADHC-STR-GP-CURSOR'                 06920044
069300                                            TO PV-PARAGRAPH-NAME  06930044
069400             MOVE 'ERROR ON FETCH OF ADHOC STR CURSOR'            06940044
069500                                            TO PV-DB2-OPERATION   06950044
069600             PERFORM Z200-SQL-ABEND                               06960044
069700     END-EVALUATE.                                                06970044
069800                                                                  06980044
069900                                                                  06990044
070000******************************************************************07000044
070100*  PROCESS ADHOC STORE GROUP ID CURSOR                            07010044
070200******************************************************************07020044
070300 B130-PROCESS-ADHC-STR-GP.                                        07030044
070400                                                                  07040044
070500     INITIALIZE PV-ADHC-STR-GP-ID.                                07050045
070600                                                                  07060045
070700     MOVE XST00031-ADHC-STR-GP-ID TO PV-ADHC-STR-GP-ID.           07070045
070800                                                                  07080045
070900     PERFORM D800-DELETE-XST00031.                                07090045
071000     PERFORM D110-DELETE-XST00033.                                07100045
071100     PERFORM D140-DELETE-XST00036.                                07110045
071200                                                                  07120045
071300     PERFORM Y100-COMMIT.                                         07130045
071400                                                                  07140045
071500     PERFORM B120-FETCH-ADHC-STR-GP-CURSOR.                       07150045
071600                                                                  07160044
071700******************************************************************07170044
071800*  CLOSE ADHOC STORE GROUP ID CURSOR                              07180044
071900******************************************************************07190044
072000 B140-CLOSE-ADHC-STR-GP-CURSOR.                                   07200044
072100                                                                  07210044
072200     EXEC SQL                                                     07220044
072300          CLOSE ADHC-STR-GP-CSR                                   07230044
072400     END-EXEC.                                                    07240044
072500                                                                  07250044
072600     EVALUATE TRUE                                                07260044
072700         WHEN SQLCODE = PC-ROW-FOUND                              07270044
072800              CONTINUE                                            07280044
072900                                                                  07290044
073000         WHEN SQLWARN0 NOT EQUAL SPACE                            07300044
073100         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      07310044
073200             MOVE 'B140-CLOSE-ADHC-STR-GP-CURSOR'                 07320044
073300                                            TO PV-PARAGRAPH-NAME  07330044
073400             MOVE 'ERROR ON CLOSE OF ADHOC STR CURSOR'            07340044
073500                                            TO PV-DB2-OPERATION   07350044
073600             PERFORM Z200-SQL-ABEND                               07360044
073700     END-EVALUATE.                                                07370044
073800                                                                  07380044
073900                                                                  07390044
074000******************************************************************07400044
074100*   PROCESS-MAIN PROMO CURSOR                                     07410044
074200******************************************************************07420044
074300 C000-PROCESS-PROMO.                                              07430044
074400                                                                  07440044
074440                                                                  07444045
074500     PERFORM C110-OPEN-PROMO-TABLE-CSR.                           07450045
074600     PERFORM C120-FETCH-PROMO-TABLE-CSR.                          07460045
074700     PERFORM C130-PROCESS-PROMO-TABLE-CSR                         07470045
074800       UNTIL PS-EOF-PROMO.                                        07480045
074900     PERFORM C140-CLOSE-PROMO-TABLE-CSR.                          07490045
075000                                                                  07500044
075100******************************************************************07510044
075200* OPEN PROMO-TABLE-CSR CURSOR                                     07520044
075300******************************************************************07530044
075400 C110-OPEN-PROMO-TABLE-CSR.                                       07540044
075500                                                                  07550044
075600     EXEC SQL                                                     07560044
075700          OPEN PROMO-TABLE-CSR                                    07570044
075800     END-EXEC.                                                    07580044
075900                                                                  07590044
076000     EVALUATE TRUE                                                07600044
076100         WHEN SQLCODE = PC-ROW-FOUND                              07610044
076200              CONTINUE                                            07620044
076300                                                                  07630044
076400         WHEN SQLWARN0 NOT EQUAL SPACE                            07640044
076500         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      07650044
076600             MOVE 'C110-OPEN-PROMO-TABLE-CSR'                     07660044
076700                                            TO PV-PARAGRAPH-NAME  07670044
076800             MOVE 'ERROR ON OPEN OF PROMO-TABLE-CSR'              07680044
076900                                            TO PV-DB2-OPERATION   07690044
077000             PERFORM Z200-SQL-ABEND                               07700044
077100     END-EVALUATE.                                                07710044
077200                                                                  07720044
077300******************************************************************07730044
077400* FETCH THE PROMO TABLE RECORD.                                   07740044
077500******************************************************************07750044
077600 C120-FETCH-PROMO-TABLE-CSR.                                      07760044
077700                                                                  07770044
077800     INITIALIZE XST00026-PROMO-ID                                 07780044
077900                XST00026-AD-EVNT-ID.                              07790044
078000                                                                  07800044
078100     EXEC SQL                                                     07810044
078200         FETCH PROMO-TABLE-CSR                                    07820044
078300             INTO :XST00026-PROMO-ID                              07830044
078400                 ,:XST00026-AD-EVNT-ID :PV-NULL-IND               07840044
078500     END-EXEC.                                                    07850044
078600                                                                  07860044
078700     EVALUATE TRUE                                                07870044
078800         WHEN SQLCODE = PC-ROW-FOUND                              07880044
078900             MOVE 'N' TO PS-EOF-PROMO-SW                          07890044
079000             ADD 1    TO PV-PROMO-READ                            07900044
079100                                                                  07910044
079200         WHEN SQLCODE = PC-ROW-NOT-FOUND                          07920044
079300             MOVE 'Y' TO PS-EOF-PROMO-SW                          07930044
079400                                                                  07940044
079500         WHEN SQLWARN0 NOT EQUAL SPACE                            07950044
079600         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      07960044
079700             MOVE 'C120-FETCH-PROMO-TABLE-CSR'                    07970044
079800                                            TO PV-PARAGRAPH-NAME  07980044
079900             MOVE 'ERROR ON FETCH OF PROMO-TABLE-CSR'             07990044
080000                                            TO PV-DB2-OPERATION   08000044
080100             PERFORM Z200-SQL-ABEND                               08010044
080200     END-EVALUATE.                                                08020044
080300                                                                  08030044
080400******************************************************************08040044
080500* CLOSE PROMO TABLE CURSOR                                        08050044
080600******************************************************************08060044
080700 C140-CLOSE-PROMO-TABLE-CSR.                                      08070044
080800                                                                  08080044
080900     EXEC SQL                                                     08090044
081000          CLOSE PROMO-TABLE-CSR                                   08100044
081100     END-EXEC.                                                    08110044
081200                                                                  08120044
081300     EVALUATE TRUE                                                08130044
081400         WHEN SQLCODE = PC-ROW-FOUND                              08140044
081500              CONTINUE                                            08150044
081600                                                                  08160044
081700         WHEN SQLWARN0 NOT EQUAL SPACE                            08170044
081800         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      08180044
081900             MOVE 'C140-CLOSE-PROMO-TABLE-CSR'                    08190044
082000                                            TO PV-PARAGRAPH-NAME  08200044
082100             MOVE 'ERROR ON CLOSE OF PROMO-TABLE-CSR'             08210044
082200                                            TO PV-DB2-OPERATION   08220044
082300             PERFORM Z200-SQL-ABEND                               08230044
082400     END-EVALUATE.                                                08240044
082500                                                                  08250044
082600******************************************************************08260044
082700* PROCESS PROMO TABLE CURSOR                                      08270044
082800******************************************************************08280044
082900 C130-PROCESS-PROMO-TABLE-CSR.                                    08290044
083000                                                                  08300044
083100     MOVE XST00026-AD-EVNT-ID TO PV-AD-EVNT-ID.                   08310045
083200     MOVE XST00026-PROMO-ID   TO PV-PROMO-ID.                     08320045
083300                                                                  08330045
083400     SET PS-NOT-EOF-MDSE TO TRUE.                                 08340045
083500                                                                  08350045
083530                                                                  08353045
083600     PERFORM C210-OPEN-MDSE-TABLE-CURSOR.                         08360045
083700     PERFORM C220-FETCH-MDSE-TABLE-CURSOR.                        08370045
083800     PERFORM C230-PROCESS-MDSE-TABLE-CURSOR                       08380045
083900             UNTIL PS-EOF-MDSE.                                   08390045
084000     PERFORM C240-CLOSE-MDSE-TABLE-CURSOR.                        08400045
084100                                                                  08410045
084200     PERFORM D900-DELETE-XST00032.                                08420045
084300     PERFORM D300-DELETE-XST00026.                                08430045
084400     PERFORM D400-DELETE-XST00027.                                08440045
084500                                                                  08450045
084600     PERFORM Y100-COMMIT.                                         08460045
084700                                                                  08470045
084800     PERFORM C120-FETCH-PROMO-TABLE-CSR.                          08480045
084900                                                                  08490044
085000******************************************************************08500044
085100* OPEN MDSE-LINE-CSR CURSOR                                       08510044
085200******************************************************************08520044
085300 C210-OPEN-MDSE-TABLE-CURSOR.                                     08530044
085400                                                                  08540044
085500     EXEC SQL                                                     08550044
085600          OPEN MDSE-LINE-CSR                                      08560044
085700     END-EXEC.                                                    08570044
085800                                                                  08580044
085900     EVALUATE TRUE                                                08590044
086000         WHEN SQLCODE = ZERO                                      08600044
086100              CONTINUE                                            08610044
086200                                                                  08620044
086300         WHEN SQLWARN0 NOT EQUAL SPACE                            08630044
086400         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      08640044
086500             MOVE 'C210-OPEN-MDSE-LINE-CSR'                       08650044
086600                                            TO PV-PARAGRAPH-NAME  08660044
086700             MOVE 'ERROR ON OPEN OF MDSE-LINE-CSR'                08670044
086800                                            TO PV-DB2-OPERATION   08680044
086900             PERFORM Z200-SQL-ABEND                               08690044
087000     END-EVALUATE.                                                08700044
087100                                                                  08710044
087200******************************************************************08720044
087300* FETCH THE MDSE TABLE RECORD.                                    08730044
087400******************************************************************08740044
087500 C220-FETCH-MDSE-TABLE-CURSOR.                                    08750044
087600                                                                  08760044
087700     INITIALIZE XST00028-PROMO-INTFC-ID                           08770044
087800                XST00028-MDSE-LNE-ID.                             08780044
087900                                                                  08790044
088000     EXEC SQL                                                     08800044
088100         FETCH MDSE-LINE-CSR                                      08810044
088200             INTO :XST00028-PROMO-INTFC-ID                        08820044
088300                 ,:XST00028-MDSE-LNE-ID                           08830044
088400     END-EXEC.                                                    08840044
088500                                                                  08850044
088600     EVALUATE TRUE                                                08860044
088700         WHEN SQLCODE = PC-ROW-FOUND                              08870044
088800             MOVE 'N' TO PS-EOF-MDSE-SW                           08880044
088900                                                                  08890044
089000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          08900044
089100             MOVE 'Y' TO PS-EOF-MDSE-SW                           08910044
089200                                                                  08920044
089300         WHEN SQLWARN0 NOT EQUAL SPACE                            08930044
089400         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      08940044
089500             MOVE 'C220-FETCH-MDSE-LINE-CSR'                      08950044
089600                                            TO PV-PARAGRAPH-NAME  08960044
089700             MOVE 'ERROR ON FETCH OF MDSE-LINE-CSR'               08970044
089800                                            TO PV-DB2-OPERATION   08980044
089900             PERFORM Z200-SQL-ABEND                               08990044
090000     END-EVALUATE.                                                09000044
090100                                                                  09010044
090200******************************************************************09020044
090300* CLOSE MDSE TABLE CURSOR                                         09030044
090400******************************************************************09040044
090500 C240-CLOSE-MDSE-TABLE-CURSOR.                                    09050044
090600                                                                  09060044
090700     EXEC SQL                                                     09070044
090800          CLOSE MDSE-LINE-CSR                                     09080044
090900     END-EXEC.                                                    09090044
091000                                                                  09100044
091100     EVALUATE TRUE                                                09110044
091200         WHEN SQLCODE = ZERO                                      09120044
091300              CONTINUE                                            09130044
091400                                                                  09140044
091500         WHEN SQLWARN0 NOT EQUAL SPACE                            09150044
091600         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      09160044
091700             MOVE 'C240-CLOSE-MDSE-LINE-CSR'                      09170044
091800                                            TO PV-PARAGRAPH-NAME  09180044
091900             MOVE 'ERROR ON CLOSE OF MDSE-LINE-CSR'               09190044
092000                                            TO PV-DB2-OPERATION   09200044
092100             PERFORM Z200-SQL-ABEND                               09210044
092200     END-EVALUATE.                                                09220044
092300                                                                  09230044
092400                                                                  09240044
092500******************************************************************09250044
092600*                                                                 09260044
092700******************************************************************09270044
092800 C230-PROCESS-MDSE-TABLE-CURSOR.                                  09280044
092900                                                                  09290044
093000     MOVE XST00028-PROMO-INTFC-ID  TO PV-PROMO-INTFC-ID.          09300045
093100     MOVE XST00028-MDSE-LNE-ID     TO PV-MDSE-LNE-ID.             09310045
093200                                                                  09320045
093300     PERFORM D500-DELETE-XST00028.                                09330045
093400     PERFORM C220-FETCH-MDSE-TABLE-CURSOR.                        09340045
093500                                                                  09350044
093600******************************************************************09360044
093700* DELETE XST_REBT_FM_TXT (XST00131)                               09370044
093800******************************************************************09380044
093900 D100-DELETE-XST00131.                                            09390044
094000                                                                  09400044
094100     INITIALIZE PV-RETRY-COUNT.                                   09410044
094200     SET PS-PROCESS-CONTINUE TO TRUE.                             09420044
094300     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           09430044
094400                                                                  09440044
094500     PERFORM  WITH TEST AFTER                                     09450044
094600       UNTIL PS-PROCESS-STOP                                      09460044
094700         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             09470044
094800                                                                  09480044
094900         EXEC SQL                                                 09490044
095000             DELETE FROM XST_REBT_FM_TXT                          09500044
095100             WHERE  REBT_FM_ID  = :PV-REBT-FM-ID                  09510044
095200         END-EXEC                                                 09520044
095300                                                                  09530044
095400         EVALUATE TRUE                                            09540044
095500             WHEN SQLCODE = PC-ROW-FOUND                          09550044
095600                MOVE SQLERRD(3) TO PV-SQLERRD3                    09560044
095700                                                                  09570044
095800                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            09580044
095900                ADD PV-SQL-DELETE-COUNT TO                        09590044
096000                            PV-XST00131-ROW-DELETE-CNTR           09600044
096100                                                                  09610044
096200                SET PS-PROCESS-STOP TO TRUE                       09620044
096300                                                                  09630044
096400             WHEN SQLCODE = PC-ROW-NOT-FOUND                      09640044
096500                SET PS-PROCESS-STOP TO TRUE                       09650044
096600                                                                  09660044
096700*-- REFERENTIAL INTEGRITY ISSUE                                   09670044
096800             WHEN SQLCODE = -530                                  09680044
096900             WHEN SQLCODE = -532                                  09690044
097000                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   09700044
097100                SET PS-PROCESS-STOP TO TRUE                       09710044
097200                                                                  09720044
097300             WHEN SQLCODE = -913                                  09730044
097400                ADD +1   TO PV-RETRY-COUNT                        09740044
097500                                                                  09750044
097600             WHEN OTHER                                           09760044
097700                DISPLAY '                                        '09770044
097800                DISPLAY '****************************************'09780044
097900                DISPLAY '*     CURRENT XST00131 DELETE ABEND     '09790044
098000                DISPLAY '*======================================='09800044
098100                DISPLAY 'REBT FM ID       = ' PV-REBT-FM-ID       09810044
098200                DISPLAY '                                        '09820044
098300                                                                  09830044
098400                MOVE 'D100-DELETE-XST00131'  TO PV-PARAGRAPH-NAME 09840044
098500                MOVE 'DELETE XST00131 TABLE' TO PV-DB2-OPERATION  09850044
098600                PERFORM Z200-SQL-ABEND                            09860044
098700         END-EVALUATE                                             09870044
098800     END-PERFORM.                                                 09880044
098900                                                                  09890044
099000     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   09900044
099100         DISPLAY '** MAX RETRYS ATTEMPTED **'                     09910044
099200         MOVE 'D100-DELETE-XST00131'  TO PV-PARAGRAPH-NAME        09920044
099300         MOVE 'DELETE XST00131 TABLE' TO PV-DB2-OPERATION         09930044
099400                                                                  09940044
099500         PERFORM Z200-SQL-ABEND                                   09950044
099600     END-IF.                                                      09960044
099700                                                                  09970044
099800                                                                  09980044
099900******************************************************************09990044
100000* DELETE XST_REBT_FM (XST00130)                                   10000044
100100******************************************************************10010044
100200 D200-DELETE-XST00130.                                            10020044
100300                                                                  10030044
100400     INITIALIZE PV-RETRY-COUNT.                                   10040044
100500     SET PS-PROCESS-CONTINUE TO TRUE.                             10050044
100600     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           10060044
100700                                                                  10070044
100800     PERFORM  WITH TEST AFTER                                     10080044
100900       UNTIL PS-PROCESS-STOP                                      10090044
101000         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             10100044
101100                                                                  10110044
101200         EXEC SQL                                                 10120044
101300             DELETE FROM XST_REBT_FM                              10130044
101400             WHERE  REBT_FM_ID  = :PV-REBT-FM-ID                  10140044
101500         END-EXEC                                                 10150044
101600                                                                  10160044
101700         EVALUATE TRUE                                            10170044
101800             WHEN SQLCODE = PC-ROW-FOUND                          10180044
101900                MOVE SQLERRD(3) TO PV-SQLERRD3                    10190044
102000                                                                  10200044
102100                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            10210044
102200                ADD PV-SQL-DELETE-COUNT TO                        10220044
102300                            PV-XST00130-ROW-DELETE-CNTR           10230044
102400                                                                  10240044
102500                SET PS-PROCESS-STOP TO TRUE                       10250044
102600                                                                  10260044
102700             WHEN SQLCODE = PC-ROW-NOT-FOUND                      10270044
102800                SET PS-PROCESS-STOP TO TRUE                       10280044
102900                                                                  10290044
103000*-- REFERENTIAL INTEGRITY ISSUE                                   10300044
103100             WHEN SQLCODE = -530                                  10310044
103200             WHEN SQLCODE = -532                                  10320044
103300                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   10330044
103400                SET PS-PROCESS-STOP TO TRUE                       10340044
103500                                                                  10350044
103600             WHEN SQLCODE = -913                                  10360044
103700                ADD +1   TO PV-RETRY-COUNT                        10370044
103800                                                                  10380044
103900             WHEN OTHER                                           10390044
104000                DISPLAY '                                        '10400044
104100                DISPLAY '****************************************'10410044
104200                DISPLAY '*     CURRENT XST00130 DELETE ABEND     '10420044
104300                DISPLAY '*======================================='10430044
104400                DISPLAY 'REBT FM ID       = ' PV-REBT-FM-ID       10440044
104500                DISPLAY '                                        '10450044
104600                                                                  10460044
104700                MOVE 'D200-DELETE-XST00130'  TO PV-PARAGRAPH-NAME 10470044
104800                MOVE 'DELETE XST00130 TABLE' TO PV-DB2-OPERATION  10480044
104900                PERFORM Z200-SQL-ABEND                            10490044
105000     END-EVALUATE                                                 10500044
105100     END-PERFORM.                                                 10510044
105200                                                                  10520044
105300     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   10530044
105400         DISPLAY '** MAX RETRYS ATTEMPTED **'                     10540044
105500         MOVE 'D200-DELETE-XST00130'  TO PV-PARAGRAPH-NAME        10550044
105600         MOVE 'DELETE XST00130 TABLE' TO PV-DB2-OPERATION         10560044
105700                                                                  10570044
105800         PERFORM Z200-SQL-ABEND                                   10580044
105900     END-IF.                                                      10590044
106000                                                                  10600044
106100******************************************************************10610044
106200* DELETE XST_PROMO (XST00026)                                     10620044
106300******************************************************************10630044
106400 D300-DELETE-XST00026.                                            10640044
106500                                                                  10650044
106600     INITIALIZE PV-RETRY-COUNT.                                   10660044
106700     SET PS-PROCESS-CONTINUE TO TRUE.                             10670044
106800     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           10680044
106900                                                                  10690044
107000     PERFORM  WITH TEST AFTER                                     10700044
107100       UNTIL PS-PROCESS-STOP                                      10710044
107200         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             10720044
107300                                                                  10730044
107400         EXEC SQL                                                 10740044
107500             DELETE FROM XST_PROMO                                10750044
107600             WHERE (PROMO_ID = :PV-PROMO-ID)                      10760044
107700         END-EXEC                                                 10770044
107800                                                                  10780044
107900         EVALUATE TRUE                                            10790044
108000             WHEN SQLCODE = PC-ROW-FOUND                          10800044
108100                MOVE SQLERRD(3) TO PV-SQLERRD3                    10810044
108200                                                                  10820044
108300                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            10830044
108400                ADD PV-SQL-DELETE-COUNT TO                        10840044
108500                            PV-XST00026-ROW-DELETE-CNTR           10850044
108600                                                                  10860044
108700                SET PS-PROCESS-STOP TO TRUE                       10870044
108800                                                                  10880044
108900             WHEN SQLCODE = PC-ROW-NOT-FOUND                      10890044
109000                SET PS-PROCESS-STOP TO TRUE                       10900044
109100                                                                  10910044
109200*-- REFERENTIAL INTEGRITY ISSUE                                   10920044
109300             WHEN SQLCODE = -530                                  10930044
109400             WHEN SQLCODE = -532                                  10940044
109500                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   10950044
109600                SET PS-PROCESS-STOP TO TRUE                       10960044
109700                DISPLAY 'REFERENTIAL INTEGRITY ISSUE: '           10970044
109800                DISPLAY 'XST00026 TABLE'                          10980044
109900                                                                  10990044
110000             WHEN SQLCODE = -913                                  11000044
110100                ADD +1   TO PV-RETRY-COUNT                        11010044
110200                                                                  11020044
110300             WHEN OTHER                                           11030044
110400                DISPLAY '                                        '11040044
110500                DISPLAY '****************************************'11050044
110600                DISPLAY '*     CURRENT XST00026 DELETE ABEND     '11060044
110700                DISPLAY '*======================================='11070044
110800                DISPLAY 'PROMO ID = ' PV-PROMO-ID                 11080044
110900                DISPLAY '                                        '11090044
111000                                                                  11100044
111100                MOVE 'D300-DELETE-XST00026' TO PV-PARAGRAPH-NAME  11110044
111200                MOVE 'DELETE XST00026 TABLE' TO PV-DB2-OPERATION  11120044
111300                PERFORM Z200-SQL-ABEND                            11130044
111400         END-EVALUATE                                             11140044
111500     END-PERFORM.                                                 11150044
111600                                                                  11160044
111700     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   11170044
111800         MOVE 'D300-DELETE-XST00026'     TO PV-PARAGRAPH-NAME     11180044
111900         MOVE 'DELETE XST00026 TABLE'    TO PV-DB2-OPERATION      11190044
112000                                                                  11200044
112100         PERFORM Z200-SQL-ABEND                                   11210044
112200     END-IF.                                                      11220044
112300                                                                  11230044
112400******************************************************************11240044
112500* DELETE XST_AD_EVNT (XST00027)                                   11250044
112600******************************************************************11260044
112700 D400-DELETE-XST00027.                                            11270044
112800                                                                  11280044
112900     INITIALIZE PV-RETRY-COUNT.                                   11290044
113000     SET PS-PROCESS-CONTINUE TO TRUE.                             11300044
113100     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           11310044
113200                                                                  11320044
113300      PERFORM  WITH TEST AFTER                                    11330044
113400       UNTIL PS-PROCESS-STOP                                      11340044
113500         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             11350044
113600                                                                  11360044
113700         EXEC SQL                                                 11370044
113800             DELETE FROM XST_AD_EVNT                              11380044
113900             WHERE ((AD_EVNT_ID = :PV-AD-EVNT-ID)                 11390044
114000               AND  (END_DTE   <= :PV-BEGIN-PURGE-DATE))          11400044
114100         END-EXEC                                                 11410044
114200                                                                  11420044
114300         EVALUATE TRUE                                            11430044
114400             WHEN SQLCODE = PC-ROW-FOUND                          11440044
114500                MOVE SQLERRD(3) TO PV-SQLERRD3                    11450044
114600                                                                  11460044
114700                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            11470044
114800                ADD PV-SQL-DELETE-COUNT TO                        11480044
114900                            PV-XST00027-ROW-DELETE-CNTR           11490044
115000                                                                  11500044
115100                SET PS-PROCESS-STOP TO TRUE                       11510044
115200                                                                  11520044
115300             WHEN SQLCODE = PC-ROW-NOT-FOUND                      11530044
115400                SET PS-PROCESS-STOP TO TRUE                       11540044
115500                                                                  11550044
115600*-- REFERENTIAL INTEGRITY ISSUE                                   11560044
115700             WHEN SQLCODE = -530                                  11570044
115800             WHEN SQLCODE = -532                                  11580044
115900                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   11590044
116000                SET PS-PROCESS-STOP TO TRUE                       11600044
116100                DISPLAY 'REFERENTIAL INTEGRITY ISSUE: '           11610044
116200                DISPLAY 'XST00027 TABLE'                          11620044
116300                                                                  11630044
116400             WHEN SQLCODE = -913                                  11640044
116500                ADD +1   TO PV-RETRY-COUNT                        11650044
116600                                                                  11660044
116700             WHEN OTHER                                           11670044
116800                DISPLAY '                                        '11680044
116900                DISPLAY '****************************************'11690044
117000                DISPLAY '*     CURRENT XST00027 DELETE ABEND     '11700044
117100                DISPLAY '*======================================='11710044
117200                DISPLAY 'AD EVENT    = ' PV-AD-EVNT-ID            11720044
117300                DISPLAY 'PURGE DATE  = ' PV-BEGIN-PURGE-DATE      11730044
117400                DISPLAY '                                        '11740044
117500                                                                  11750044
117600                MOVE 'D400-DELETE-XST00027'                       11760044
117700                                             TO PV-PARAGRAPH-NAME 11770044
117800                MOVE 'DELETE XST00027 TABLE' TO PV-DB2-OPERATION  11780044
117900                PERFORM Z200-SQL-ABEND                            11790044
118000         END-EVALUATE                                             11800044
118100      END-PERFORM.                                                11810044
118200                                                                  11820044
118300     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   11830044
118400         MOVE 'D400-DELETE-XST00027'       TO PV-PARAGRAPH-NAME   11840044
118500         MOVE 'DELETE XST00027 TABLE '     TO PV-DB2-OPERATION    11850044
118600                                                                  11860044
118700         PERFORM Z200-SQL-ABEND                                   11870044
118800     END-IF.                                                      11880044
118900                                                                  11890044
119000******************************************************************11900044
119100* DELETE XST_MDSE_LNE_SELN (XST00028)                             11910044
119200******************************************************************11920044
119300 D500-DELETE-XST00028.                                            11930044
119400                                                                  11940044
119500     INITIALIZE PV-RETRY-COUNT.                                   11950044
119600     SET PS-PROCESS-CONTINUE TO TRUE.                             11960044
119700     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           11970044
119800                                                                  11980044
119900     PERFORM  WITH TEST AFTER                                     11990044
120000       UNTIL PS-PROCESS-STOP                                      12000044
120100         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             12010044
120200                                                                  12020044
120300         EXEC SQL                                                 12030044
120400             DELETE FROM XST_MDSE_LNE_SELN                        12040044
120500             WHERE ((PROMO_INTFC_ID = :PV-PROMO-INTFC-ID)         12050044
120600               AND  (MDSE_LNE_ID = :PV-MDSE-LNE-ID))              12060044
120700         END-EXEC                                                 12070044
120800                                                                  12080044
120900         EVALUATE TRUE                                            12090044
121000             WHEN SQLCODE = PC-ROW-FOUND                          12100044
121100                MOVE SQLERRD(3) TO PV-SQLERRD3                    12110044
121300                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            12130044
121400                ADD PV-SQL-DELETE-COUNT TO                        12140044
121500                            PV-XST00028-ROW-DELETE-CNTR           12150044
121510                IF PV-MDSE-LNE-COMMITS > PC-COMMIT-LIMIT          12151049
121600                   PERFORM Y100-COMMIT                            12160049
121610                   MOVE ZERO TO PV-MDSE-LNE-COMMITS               12161049
121620                ELSE                                              12162049
121630                   ADD +1 TO PV-MDSE-LNE-COMMITS                  12163049
121640                END-IF                                            12164049
121700                                                                  12170044
121800                SET PS-PROCESS-STOP TO TRUE                       12180044
121900                                                                  12190044
122000             WHEN SQLCODE = PC-ROW-NOT-FOUND                      12200044
122100                SET PS-PROCESS-STOP TO TRUE                       12210044
122200                                                                  12220044
122300*-- REFERENTIAL INTEGRITY ISSUE                                   12230044
122400             WHEN SQLCODE = -530                                  12240044
122500             WHEN SQLCODE = -532                                  12250044
122600                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   12260044
122700                SET PS-PROCESS-STOP TO TRUE                       12270044
122800                                                                  12280044
122900             WHEN SQLCODE = -913                                  12290044
123000                ADD +1   TO PV-RETRY-COUNT                        12300044
123100                                                                  12310044
123200             WHEN OTHER                                           12320044
123300                DISPLAY '                                        '12330044
123400                DISPLAY '****************************************'12340044
123500                DISPLAY '*     CURRENT XST00028 DELETE ABEND     '12350044
123600                DISPLAY '*======================================='12360044
123700                DISPLAY 'PROMO INTFC ID   = ' PV-PROMO-INTFC-ID   12370044
123800                DISPLAY 'MDSE LNE ID      = ' PV-MDSE-LNE-ID      12380044
123900                DISPLAY 'PROMO ID         = ' PV-PROMO-ID         12390044
124000                DISPLAY '                                        '12400044
124100                                                                  12410044
124200                MOVE 'D500-DELETE-XST00028'  TO PV-PARAGRAPH-NAME 12420044
124300                MOVE 'DELETE XST00028 TABLE' TO PV-DB2-OPERATION  12430044
124400                PERFORM Z200-SQL-ABEND                            12440044
124500         END-EVALUATE                                             12450044
124600     END-PERFORM.                                                 12460044
124700                                                                  12470044
124800     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   12480044
124900         MOVE 'D500-DELETE-XST00028'  TO PV-PARAGRAPH-NAME        12490044
125000         MOVE 'DELETE XST00028 TABLE' TO PV-DB2-OPERATION         12500044
125100                                                                  12510044
125200         PERFORM Z200-SQL-ABEND                                   12520044
125300     END-IF.                                                      12530044
125400                                                                  12540044
125500                                                                  12550044
125600******************************************************************12560044
125700* DELETE XST_PROMO_ADHC_RLT (XST00031)                            12570044
125800******************************************************************12580044
125900 D800-DELETE-XST00031.                                            12590044
126000                                                                  12600044
126100     INITIALIZE PV-RETRY-COUNT.                                   12610044
126200     SET PS-PROCESS-CONTINUE TO TRUE.                             12620044
126300     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           12630044
126400                                                                  12640044
126500     PERFORM  WITH TEST AFTER                                     12650044
126600       UNTIL PS-PROCESS-STOP                                      12660044
126700         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             12670044
126800                                                                  12680044
126900         EXEC SQL                                                 12690044
127000             DELETE FROM XST_PROMO_ADHC_RLT                       12700044
127100             WHERE ADHC_STR_GP_ID = :PV-ADHC-STR-GP-ID            12710044
127200         END-EXEC                                                 12720044
127300                                                                  12730044
127400         EVALUATE TRUE                                            12740044
127500             WHEN SQLCODE = PC-ROW-FOUND                          12750044
127600                MOVE SQLERRD(3) TO PV-SQLERRD3                    12760044
127700                                                                  12770044
127800                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            12780044
127900                ADD PV-SQL-DELETE-COUNT TO                        12790044
128000                            PV-XST00031-ROW-DELETE-CNTR           12800044
128100                                                                  12810044
128200                SET PS-PROCESS-STOP TO TRUE                       12820044
128300                                                                  12830044
128400             WHEN SQLCODE = PC-ROW-NOT-FOUND                      12840044
128500                SET PS-PROCESS-STOP TO TRUE                       12850044
128600                                                                  12860044
128700*-- REFERENTIAL INTEGRITY ISSUE                                   12870044
128800             WHEN SQLCODE = -530                                  12880044
128900             WHEN SQLCODE = -532                                  12890044
129000                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   12900044
129100                SET PS-PROCESS-STOP TO TRUE                       12910044
129200                                                                  12920044
129300             WHEN SQLCODE = -913                                  12930044
129400                ADD +1   TO PV-RETRY-COUNT                        12940044
129500                                                                  12950044
129600             WHEN OTHER                                           12960044
129700                DISPLAY '                                        '12970044
129800                DISPLAY '****************************************'12980044
129900                DISPLAY '*     CURRENT XST00031 DELETE ABEND     '12990044
130000                DISPLAY '*======================================='13000044
130100                DISPLAY 'ADHC_STR_GP_ID   = ' PV-ADHC-STR-GP-ID   13010044
130200                DISPLAY '                                        '13020044
130300                                                                  13030044
130400                MOVE 'D800-DELETE-XST00031'  TO PV-PARAGRAPH-NAME 13040044
130500                MOVE 'DELETE XST00031 TABLE' TO PV-DB2-OPERATION  13050044
130600                PERFORM Z200-SQL-ABEND                            13060044
130700         END-EVALUATE                                             13070044
130800     END-PERFORM.                                                 13080044
130900                                                                  13090044
131000     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   13100044
131100         DISPLAY '** MAX RETRYS ATTEMPTED **'                     13110044
131200         MOVE 'D800-DELETE-XST00031'  TO PV-PARAGRAPH-NAME        13120044
131300         MOVE 'DELETE XST00031 TABLE' TO PV-DB2-OPERATION         13130044
131400                                                                  13140044
131500         PERFORM Z200-SQL-ABEND                                   13150044
131600     END-IF.                                                      13160044
131700                                                                  13170044
131800                                                                  13180044
131900******************************************************************13190044
132000* DELETE XST_PROMO_PRIC_VER (XST00032)                            13200044
132100******************************************************************13210044
132200 D900-DELETE-XST00032.                                            13220044
132300                                                                  13230044
132400     INITIALIZE PV-RETRY-COUNT.                                   13240044
132500     SET PS-PROCESS-CONTINUE TO TRUE.                             13250044
132600     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           13260044
132700                                                                  13270044
132800     PERFORM  WITH TEST AFTER                                     13280044
132900       UNTIL PS-PROCESS-STOP                                      13290044
133000         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             13300044
133100                                                                  13310044
133200         EXEC SQL                                                 13320044
133300             DELETE FROM XST_PROMO_PRIC_VER                       13330044
133400             WHERE  (PROMO_ID = :PV-PROMO-ID)                     13340044
133500         END-EXEC                                                 13350044
133600                                                                  13360044
133700         EVALUATE TRUE                                            13370044
133800             WHEN SQLCODE = PC-ROW-FOUND                          13380044
133900                MOVE SQLERRD(3) TO PV-SQLERRD3                    13390044
134000                                                                  13400044
134100                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            13410044
134200                ADD PV-SQL-DELETE-COUNT TO                        13420044
134300                            PV-XST00032-ROW-DELETE-CNTR           13430044
134400                                                                  13440044
134500                SET PS-PROCESS-STOP TO TRUE                       13450044
134600                                                                  13460044
134700             WHEN SQLCODE = PC-ROW-NOT-FOUND                      13470044
134800                SET PS-PROCESS-STOP TO TRUE                       13480044
134900                                                                  13490044
135000*-- REFERENTIAL INTEGRITY ISSUE                                   13500044
135100             WHEN SQLCODE = -530                                  13510044
135200             WHEN SQLCODE = -532                                  13520044
135300                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   13530044
135400                SET PS-PROCESS-STOP TO TRUE                       13540044
135500                                                                  13550044
135600             WHEN SQLCODE = -913                                  13560044
135700                ADD +1   TO PV-RETRY-COUNT                        13570044
135800                                                                  13580044
135900             WHEN OTHER                                           13590044
136000                DISPLAY '                                        '13600044
136100                DISPLAY '****************************************'13610044
136200                DISPLAY '*     CURRENT XST00032 DELETE ABEND     '13620044
136300                DISPLAY '*======================================='13630044
136400                DISPLAY 'PROMO ID         = ' PV-PROMO-ID         13640044
136500                DISPLAY '                                        '13650044
136600                                                                  13660044
136700                MOVE 'D900-DELETE-XST00032'  TO PV-PARAGRAPH-NAME 13670044
136800                MOVE 'DELETE XST00032 TABLE' TO PV-DB2-OPERATION  13680044
136900                PERFORM Z200-SQL-ABEND                            13690044
137000         END-EVALUATE                                             13700044
137100     END-PERFORM.                                                 13710044
137200                                                                  13720044
137300     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   13730044
137400         DISPLAY '** MAX RETRYS ATTEMPTED **'                     13740044
137500         MOVE 'D900-DELETE-XST00032'  TO PV-PARAGRAPH-NAME        13750044
137600         MOVE 'DELETE XST00032 TABLE' TO PV-DB2-OPERATION         13760044
137700                                                                  13770044
137800         PERFORM Z200-SQL-ABEND                                   13780044
137900     END-IF.                                                      13790044
138000                                                                  13800044
138100                                                                  13810044
138200******************************************************************13820044
138300* DELETE XST_PROMO_ADHC_STR (XST00033)                            13830044
138400******************************************************************13840044
138500 D110-DELETE-XST00033.                                            13850044
138600                                                                  13860044
138700     INITIALIZE PV-RETRY-COUNT.                                   13870044
138800     SET PS-PROCESS-CONTINUE TO TRUE.                             13880044
138900     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           13890044
139000                                                                  13900044
139100     PERFORM  WITH TEST AFTER                                     13910044
139200       UNTIL PS-PROCESS-STOP                                      13920044
139300         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             13930044
139400                                                                  13940044
139500         EXEC SQL                                                 13950044
139600             DELETE FROM XST_PROMO_ADHC_STR                       13960044
139700             WHERE (ADHC_STR_GP_ID = :PV-ADHC-STR-GP-ID)          13970044
139800         END-EXEC                                                 13980044
139900                                                                  13990044
140000         EVALUATE TRUE                                            14000044
140100             WHEN SQLCODE = PC-ROW-FOUND                          14010044
140200                MOVE SQLERRD(3) TO PV-SQLERRD3                    14020044
140300                                                                  14030044
140400                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            14040044
140500                ADD PV-SQL-DELETE-COUNT TO                        14050044
140600                            PV-XST00033-ROW-DELETE-CNTR           14060044
140700                                                                  14070044
140800                SET PS-PROCESS-STOP TO TRUE                       14080044
140900                                                                  14090044
141000             WHEN SQLCODE = PC-ROW-NOT-FOUND                      14100044
141100                SET PS-PROCESS-STOP TO TRUE                       14110044
141200                                                                  14120044
141300*-- REFERENTIAL INTEGRITY ISSUE                                   14130044
141400             WHEN SQLCODE = -530                                  14140044
141500             WHEN SQLCODE = -532                                  14150044
141600                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   14160044
141700                SET PS-PROCESS-STOP TO TRUE                       14170044
141800                                                                  14180044
141900             WHEN SQLCODE = -913                                  14190044
142000                ADD +1   TO PV-RETRY-COUNT                        14200044
142100                                                                  14210044
142200             WHEN OTHER                                           14220044
142300                DISPLAY '                                        '14230044
142400                DISPLAY '****************************************'14240044
142500                DISPLAY '*     CURRENT XST00033 DELETE ABEND     '14250044
142600                DISPLAY '*======================================='14260044
142700                DISPLAY 'ADHC STR GP ID   = ' PV-ADHC-STR-GP-ID   14270044
142800                DISPLAY '                                        '14280044
142900                                                                  14290044
143000                MOVE 'D110-DELETE-XST00033'  TO PV-PARAGRAPH-NAME 14300044
143100                MOVE 'DELETE XST00033 TABLE' TO PV-DB2-OPERATION  14310044
143200                PERFORM Z200-SQL-ABEND                            14320044
143300         END-EVALUATE                                             14330044
143400     END-PERFORM.                                                 14340044
143500                                                                  14350044
143600     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   14360044
143700         DISPLAY '** MAX RETRYS ATTEMPTED **'                     14370044
143800         MOVE 'D110-DELETE-XST00033'  TO PV-PARAGRAPH-NAME        14380044
143900         MOVE 'DELETE XST00033 TABLE' TO PV-DB2-OPERATION         14390044
144000                                                                  14400044
144100         PERFORM Z200-SQL-ABEND                                   14410044
144200     END-IF.                                                      14420044
144300                                                                  14430044
144400******************************************************************14440044
144500* DELETE XST_ADHC_STR_GP (XST00036)                               14450044
144600******************************************************************14460044
144700 D140-DELETE-XST00036.                                            14470044
144800                                                                  14480044
144900     INITIALIZE PV-RETRY-COUNT.                                   14490044
145000     SET PS-PROCESS-CONTINUE TO TRUE.                             14500044
145100     MOVE ZEROS TO PV-SQL-DELETE-COUNT.                           14510044
145200                                                                  14520044
145300     PERFORM  WITH TEST AFTER                                     14530044
145400       UNTIL PS-PROCESS-STOP                                      14540044
145500         OR (PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT)             14550044
145600                                                                  14560044
145700         EXEC SQL                                                 14570044
145800             DELETE FROM XST_ADHC_STR_GP                          14580044
145900             WHERE  (ADHC_STR_GP_ID = :PV-ADHC-STR-GP-ID)         14590044
146000         END-EXEC                                                 14600044
146100                                                                  14610044
146200         EVALUATE TRUE                                            14620044
146300             WHEN SQLCODE = PC-ROW-FOUND                          14630044
146400                MOVE SQLERRD(3) TO PV-SQLERRD3                    14640044
146500                                                                  14650044
146600                ADD PV-SQLERRD3 TO PV-SQL-DELETE-COUNT            14660044
146700                ADD PV-SQL-DELETE-COUNT TO                        14670044
146800                         PV-XST00036-ROW-DELETE-CNTR              14680044
146900                                                                  14690044
147000                SET PS-PROCESS-STOP TO TRUE                       14700044
147100                                                                  14710044
147200             WHEN SQLCODE = PC-ROW-NOT-FOUND                      14720044
147300                SET PS-PROCESS-STOP TO TRUE                       14730044
147400                                                                  14740044
147500*-- REFERENTIAL INTEGRITY ISSUE                                   14750044
147600             WHEN SQLCODE = -530                                  14760044
147700             WHEN SQLCODE = -532                                  14770044
147800                MOVE 'Y' TO PS-INTEGRITY-ERR-SW                   14780044
147900                SET PS-PROCESS-STOP TO TRUE                       14790044
148000                                                                  14800044
148100             WHEN SQLCODE = -913                                  14810044
148200                ADD +1   TO PV-RETRY-COUNT                        14820044
148300                                                                  14830044
148400             WHEN OTHER                                           14840044
148500                DISPLAY '                                        '14850044
148600                DISPLAY '****************************************'14860044
148700                DISPLAY '*     CURRENT XST00036 DELETE ABEND     '14870044
148800                DISPLAY '*======================================='14880044
148900                DISPLAY 'ADHC STR GP ID   = ' PV-ADHC-STR-GP-ID   14890044
149000                DISPLAY '                                        '14900044
149100                                                                  14910044
149200                MOVE 'D140-DELETE-XST00036'  TO PV-PARAGRAPH-NAME 14920044
149300                MOVE 'DELETE XST00036 TABLE' TO PV-DB2-OPERATION  14930044
149400                PERFORM Z200-SQL-ABEND                            14940044
149500         END-EVALUATE                                             14950044
149600     END-PERFORM.                                                 14960044
149700                                                                  14970044
149800     IF PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT                   14980044
149900         DISPLAY '** MAX RETRYS ATTEMPTED **'                     14990044
150000         MOVE 'D140-DELETE-XST00036'  TO PV-PARAGRAPH-NAME        15000044
150100         MOVE 'DELETE XST00036 TABLE' TO PV-DB2-OPERATION         15010044
150200                                                                  15020044
150300         PERFORM Z200-SQL-ABEND                                   15030044
150400     END-IF.                                                      15040044
150500                                                                  15050044
150600******************************************************************15060044
150700* COMMIT                                                          15070044
150800******************************************************************15080044
150900 Y100-COMMIT.                                                     15090044
151000                                                                  15100044
151100      EXEC SQL                                                    15110044
151200        COMMIT                                                    15120044
151300      END-EXEC.                                                   15130044
151400                                                                  15140044
151500     EVALUATE TRUE                                                15150044
151600        WHEN SQLCODE = ZERO                                       15160044
151700           CONTINUE                                               15170044
151800                                                                  15180044
151900        WHEN OTHER                                                15190044
152000           MOVE 'Y100-COMMIT'         TO PV-PARAGRAPH-NAME        15200044
152100           MOVE 'UNSUCCESSFUL COMMIT' TO PV-DB2-OPERATION         15210044
152200         PERFORM Z200-SQL-ABEND                                   15220044
152300     END-EVALUATE.                                                15230044
152400                                                                  15240044
152500******************************************************************15250044
152600* NON-DB2 ABEND                                                   15260044
152700******************************************************************15270044
152800 Z100-ABEND.                                                      15280044
152900                                                                  15290044
153000     PERFORM Z300-CONTROL.                                        15300044
153100                                                                  15310044
153200     DISPLAY '                     '.                             15320044
153300     DISPLAY '** ABEND           **'.                             15330044
153400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          15340044
153500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        15350044
153600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         15360044
153700     DISPLAY '** RETURN CODE     ** = ' PV-RET-CODE.              15370044
153800                                                                  15380044
153900     CALL 'ILBOABN0' USING ABEND-CODE.                            15390044
154000                                                                  15400044
154100                                                                  15410044
154200******************************************************************15420044
154300* ABEND THE PROGRAM IN THE EVENT THAT A SQL ERROR OR WARNING      15430044
154400* CODE OCCURS.                                                    15440044
154500******************************************************************15450044
154600 Z200-SQL-ABEND.                                                  15460044
154700                                                                  15470044
154800     PERFORM Z300-CONTROL.                                        15480044
154900                                                                  15490044
155000     DISPLAY '** ABEND     **'.                                   15500044
155100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                15510044
155200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              15520044
155300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               15530044
155400                                                                  15540044
155500******************************************************************15550044
155600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    15560044
155700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         15570044
155800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     15580044
155900* FORMAT.                                                         15590044
156000******************************************************************15600044
156100     COPY DPPD004.                                                15610044
156200                                                                  15620044
156300     SET ABEND-4013-DB2-ERROR TO TRUE.                            15630044
156400                                                                  15640044
156500     CALL 'ILBOABN0' USING ABEND-CODE.                            15650044
156600                                                                  15660044
156700******************************************************************15670044
156800* DISPLAY CONTROLS FROM THE PROGRAM                               15680044
156900******************************************************************15690044
157000 Z300-CONTROL.                                                    15700044
157100                                                                  15710044
157200     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 15720044
157300                                                                  15730044
157400     MOVE SYS-TIME (1:2) TO ST-END-HR.                            15740044
157500     MOVE SYS-TIME (3:2) TO ST-END-MN.                            15750044
157600                                                                  15760044
157700     DISPLAY '                    '.                              15770044
157800     DISPLAY '**********************'.                            15780044
157900     DISPLAY '   XSKUP073 CONTROLS  '.                            15790044
158000     DISPLAY '**********************'.                            15800044
158100     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         15810044
158200     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          15820044
158300     DISPLAY 'END TIME  = ' ST-END-TIME.                          15830044
158400     DISPLAY '======================'.                            15840044
158500     DISPLAY '               '.                                   15850044
158600     DISPLAY 'TODAYS DATE = '  CC-EPCC170-TODAY-DATE.             15860044
158700     DISPLAY 'PURGE DAYS  = '  CC-EPCC171-PURGE-RETAIN-DAYS.      15870044
158800     DISPLAY '              '.                                    15880044
158900     DISPLAY 'PROMO READ    = ' PV-PROMO-READ.                    15890044
159000     DISPLAY '               '.                                   15900044
159100     DISPLAY 'XST00026 DELETED = ' PV-XST00026-ROW-DELETE-CNTR ' '15910044
159200             'XST_PROMO'                                          15920044
159300     DISPLAY 'XST00027 DELETED = ' PV-XST00027-ROW-DELETE-CNTR ' '15930044
159400             'XST_AD_EVNT'                                        15940044
159500     DISPLAY 'XST00028 DELETED = ' PV-XST00028-ROW-DELETE-CNTR ' '15950044
159600             'XST_MDSE_LNE_SELN'                                  15960044
159700*    DISPLAY 'XST00029 DELETED = ' PV-XST00029-ROW-DELETE-CNTR ' '15970046
159800*            'XST_PROMO_STR_GP'                                   15980046
159900*    DISPLAY 'XST00030 DELETED = ' PV-XST00030-ROW-DELETE-CNTR ' '15990046
160000*            'XST_SMP_PRICG'                                      16000046
160100     DISPLAY 'XST00031 DELETED = ' PV-XST00031-ROW-DELETE-CNTR ' '16010044
160200             'XST_PROMO_ADHC_RLT'                                 16020044
160300     DISPLAY 'XST00032 DELETED = ' PV-XST00032-ROW-DELETE-CNTR ' '16030044
160400             'XST_PROMO_PRIC_VER'                                 16040044
160500     DISPLAY 'XST00033 DELETED = ' PV-XST00033-ROW-DELETE-CNTR ' '16050044
160600             'XST_PROMO_ADHC_STR'                                 16060044
160700*    DISPLAY 'XST00034 DELETED = ' PV-XST00034-ROW-DELETE-CNTR ' '16070046
160800*            'XST_EXCL_MDSE'                                      16080046
160900*    DISPLAY 'XST00035 DELETED = ' PV-XST00035-ROW-DELETE-CNTR ' '16090046
161000*            'XST_TIER_PRICG'                                     16100046
161100     DISPLAY 'XST00036 DELETED = ' PV-XST00036-ROW-DELETE-CNTR ' '16110044
161200             'XST_ADHC_STR_GP'                                    16120044
161300     DISPLAY 'XST00130 DELETED = ' PV-XST00130-ROW-DELETE-CNTR ' '16130044
161400             'XST_REBT_FM    '                                    16140044
161500     DISPLAY 'XST00131 DELETED = ' PV-XST00131-ROW-DELETE-CNTR ' '16150044
161600             'XST_REBT_FM_TXT'                                    16160044
161700     DISPLAY '                   '.                               16170044
161800                                                                  16180044
