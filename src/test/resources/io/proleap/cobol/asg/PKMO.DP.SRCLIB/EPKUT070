000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300******************************************************************00030099
000400 PROGRAM-ID.         EPKUT070.                                    00040099
000500 AUTHOR.             BARB ERTL.                                   00050099
000600 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00060099
000700 DATE-WRITTEN.       OCTOBER 2001.                                00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000******************************************************************00100099
001100* THIS PROGRAM CREATES THE BIN FILE FOR AJB TO USE IN DEBIT CARD *00110099
001200* TRANSACTIONS.                                                  *00120099
001300*                                                                *00130099
001400******************************************************************00140099
001500* PLEASE SEE PROGRAM DOCUMENTATION FOR LIST OF UPDATES.          *00150099
001600******************************************************************00160099
002800*========================== CHANGE LOG ===========================00161099
002900*  AUTH       BY          DATE                 DESCRIPTION        00162099
003000*=================================================================00163099
003100* CHG54864  JPG         07-30-13   MODIFIED PROGRAM TO CHECK FOR  00164399
003100*                                  DISCOVER CHECKCARD BINS ON NEW 00164499
003100*                                  MATRIX BIN FILE FROM VANTIV.   00164599
003100* CHG0147455 NEHA       08-23-16   MODIFIED PROGRAM TO CHECK FOR  00164699
003100*                                  MASTERCARD NEW BIN SERIES      00164799
003100*                                  STARTING 222100-272099.        00164899
001800******************************************************************00180099
001900 ENVIRONMENT DIVISION.                                            00190099
002000******************************************************************00200099
002100                                                                  00210099
002200 CONFIGURATION SECTION.                                           00220099
002300                                                                  00230099
002400 SOURCE-COMPUTER.    IBM-3090.                                    00240099
002500 OBJECT-COMPUTER.    IBM-3090.                                    00250099
002600                                                                  00260099
002700 INPUT-OUTPUT SECTION.                                            00270099
002800                                                                  00280099
002900 FILE-CONTROL.                                                    00290099
003000                                                                  00300099
003100     SELECT INPUT-BIN-FILE       ASSIGN TO INP01.                 00310099
003100     SELECT DISCOVER-BIN-FILE    ASSIGN TO INP02.                 00320099
JPGFX1     SELECT VNTV-BIN-MTRX-FILE   ASSIGN TO INP03.                 00321099
003200     SELECT AJB-BIN-FILE         ASSIGN TO OUT01.                 00330099
003300                                                                  00340099
003400******************************************************************00350099
003500 DATA DIVISION.                                                   00360099
003600******************************************************************00370099
003700                                                                  00380099
003800 FILE SECTION.                                                    00390099
003900                                                                  00400099
004000 FD  INPUT-BIN-FILE                                               00410099
004100     RECORDING MODE IS F                                          00420099
004200     BLOCK CONTAINS 0 RECORDS                                     00430099
004300     LABEL RECORDS ARE OMITTED.                                   00440099
004400                                                                  00450099
004500 01  INPUT-BIN-RECORD            PIC  X(80).                      00460099
004600                                                                  00470099
004000 FD  DISCOVER-BIN-FILE                                            00480099
004100     RECORDING MODE IS F                                          00490099
004200     BLOCK CONTAINS 0 RECORDS                                     00500099
004300     LABEL RECORDS ARE OMITTED.                                   00510099
004400                                                                  00520099
004500 01  DISCOVER-BIN-RECORD         PIC  X(80).                      00530099
004600                                                                  00540099
JPGFX1 FD  VNTV-BIN-MTRX-FILE                                           00541099
JPGFX1     RECORDING MODE IS F                                          00542099
JPGFX1     BLOCK CONTAINS 0 RECORDS                                     00543099
JPGFX1     LABEL RECORDS ARE OMITTED.                                   00544099
JPGFX1                                                                  00545099
JPGFX1 01  VNTV-BIN-MTRX-RECORD        PIC  X(80).                      00546099
JPGFX1                                                                  00547099
004700 FD  AJB-BIN-FILE                                                 00550099
004800     RECORDING MODE IS F                                          00560099
004900     BLOCK CONTAINS 0 RECORDS                                     00570099
005000     LABEL RECORDS ARE OMITTED.                                   00580099
005100                                                                  00590099
005200 01  AJB-BIN-RECORD              PIC  X(80).                      00600099
005300                                                                  00610099
005400 WORKING-STORAGE SECTION.                                         00620099
005500                                                                  00630099
005600 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00640099
005700                                                                  00650099
005800******************************************************************00660099
005900*PC - PROGRAM CONSTANTS                                           00670099
006000******************************************************************00680099
006100 01  PROGRAM-CONSTANTS.                                           00690099
006200     05  PC-PROGRAM-NAME         PIC X(08)   VALUE 'EPKUT070'.    00700099
006300                                                                  00710099
006400******************************************************************00720099
006500*PV - PROGRAM VARIABLES                                           00730099
006600******************************************************************00740099
006700 01  PROGRAM-VARIABLES.                                           00750099
006800     05  PV-PARAGRAPH-NAME       PIC X(30).                       00760099
006900     05  PV-ABEND-CODE           PIC S9(4) COMP VALUE ZERO.       00770099
007000         88  PV-RECS-OUT-OF-SEQ-ERROR           VALUE 4007.       00780099
007100         88  PV-TRAILER-CNT-ERROR               VALUE 4008.       00790099
007200     05  PV-BIN-NO-19            PIC X(19).                       00800099
007300     05  PV-BIN-SPLIT REDEFINES PV-BIN-NO-19.                     00810099
007400         10  PV-BIN-NO OCCURS 19 TIMES.                           00820099
007500             15  PV-BIN-NBR      PIC X(01).                       00830099
007600     05  PV-SUB                  PIC S9(03) COMP-3.               00840099
007600     05  PV-SUB1                 PIC S9(03) COMP-3.               00841099
JPGFX1     05  PV-SUB2                 PIC S9(07) COMP-3.               00841199
JPGFX1     05  PV-SUB2-LAST            PIC S9(07) COMP-3.               00841299
JPGFX1     05  PV-SUB2-MAX             PIC S9(07) VALUE 400000.         00841399
007700     05  PV-BIN-NUMBER           PIC X(19).                       00842099
007800     05  PV-BIN-PREFIX REDEFINES PV-BIN-NUMBER.                   00843099
007900         10  PV-BIN-FIRST-1      PIC X(01).                       00844099
008000             88 PV-VISA-PREFIX       VALUE '4'.                   00845099
008100         10  PV-BIN-LAST-18      PIC X(18).                       00846099
008200     05  FILLER REDEFINES PV-BIN-NUMBER.                          00847099
008300         10  FILLER              PIC X(02).                       00848099
008400             88 PV-MC-PREFIX     VALUES '51' '52' '53' '54' '55'. 00849099
008500         10  FILLER              PIC X(17).                       00850099
           05  PV-CHK-MC-PREFIX-TWO    PIC X(06) VALUE SPACES.          00851099
008400         88 PV-MC-PREFIX-TWO VALUES '222100' THRU '272099'.       00852099
008600     05  PV-PREV-SEQ-NBR         PIC S9(07)  VALUE ZERO.          00860099
008700     05  PV-CMP-SEQ-NBR          PIC S9(07)  VALUE ZERO.          00870099
008700     05  PV-DTL-TMS              PIC S9(07)  VALUE ZERO.          00880099
033300     05  PV-HOLD-PAN-LENGTH      PIC S9(03)  VALUE ZERO.          00890099
JPGFX1     05  PV-CHK-DISCOVER-BIN     PIC  X(08)  VALUE SPACE.         00890199
JPGFX1         88 DISCOVER-BIN                                          00892099
JPGFX1                         VALUE '60110000' THRU '60110999',        00893099
JPGFX1                               '60112000' THRU '60114999',        00894099
JPGFX1                               '60117400' THRU '60117499',        00895099
JPGFX1                               '60117700',                        00896099
JPGFX1                               '60118600' THRU '60119999',        00897099
JPGFX1                               '64400000' THRU '65999999'.        00898099
008800                                                                  00900099
008900******************************************************************00910099
009000*PA - PROGRAM ACCUMULATORS                                        00920099
009100******************************************************************00930099
009200 01  PROGRAM-ACCUMULATORS.                                        00940099
009300     05  PA-BIN-RCDS-READ        PIC  9(11)     VALUE ZEROES.     00950099
009500     05  PA-RECORDS-WRITTEN      PIC  9(11)     VALUE ZEROES.     00960099
009700     05  PA-BIN-DTL-RCDS-READ    PIC  9(6)      VALUE ZEROES.     00970099
009300     05  PA-DIS-BIN-RCDS-READ    PIC  9(10)     VALUE ZEROES.     00980099
009300     05  PA-TOT-RCDS-READ        PIC  9(11)     VALUE ZEROES.     00990099
009700     05  PA-DIS-BIN-DTL-RCDS-READ PIC  9(11)    VALUE ZEROES.     01000099
           05  PA-BIN-RCDS-TOT-READ     PIC  9(11)    VALUE ZEROES.     01010099
009900                                                                  01020099
010000******************************************************************01030099
010100*PS - PROGRAM SWITCHES                                            01040099
010200******************************************************************01050099
010300 01  PROGRAM-SWITCHES.                                            01060099
010400     05  PS-INPUT-BIN-EOF-SW     PIC X(01)      VALUE 'N'.        01070099
010500         88  PS-INPUT-BIN-EOF                   VALUE 'Y'.        01080099
JPGFX1     05  PS-VNTV-MTRX-BIN-EOF-SW  PIC X(01)     VALUE 'N'.        01090099
JPGFX1         88  PS-VNTV-MTRX-BIN-EOF               VALUE 'Y'.        01100099
010400     05  PS-DISCOVER-BIN-EOF-SW  PIC X(01)      VALUE 'N'.        01101099
010500         88  PS-DISCOVER-BIN-EOF                VALUE 'Y'.        01102099
010600     05  PS-VALID-DETAIL-SW  PIC X(01)          VALUE 'N'.        01110099
010700         88  PS-INVALID-DETAIL                  VALUE 'N'.        01120099
010800         88  PS-VALID-DETAIL                    VALUE 'Y'.        01130099
010900     05  PS-TRAILER-PROCESSED-SW PIC X(01)      VALUE 'N'.        01140099
011000         88  PS-TRAILER-NOT-PROCESSED           VALUE 'N'.        01150099
011100         88  PS-TRAILER-PROCESSED               VALUE 'Y'.        01160099
010900     05  PS-HEADER-DEBIT-SW      PIC X(01)      VALUE 'N'.        01170099
011000         88  PS-DEBIT                           VALUE 'Y'.        01180099
011100         88  PS-NOT-DEBIT                       VALUE 'N'.        01190099
010900     05  PS-HEADER-GIFT-SW       PIC X(01)      VALUE 'N'.        01200099
011000         88  PS-GIFT-CARD                       VALUE 'Y'.        01210099
011100         88  PS-NO-GIFT-CARD                    VALUE 'N'.        01220099
JPGFX1     05  PS-CHECK-CARD-SW        PIC X(01)      VALUE 'N'.        01221099
JPGFX1         88  PS-CHECK-CARD-FOUND                VALUE 'Y'.        01222099
JPGFX1         88  PS-CHECK-CARD-NOT-FOUND            VALUE 'N'.        01223099
011200                                                                  01230099
011300******************************************************************01240099
011400*EXCEPTION MESSAGE RECORD LAYOUT                                 *01250099
011500******************************************************************01260099
011600 01  EXCEPTION-MESSAGE-LINE.                                      01270099
011700     05 EXC-MSG-COMMENT          PIC X(40)      VALUE SPACES.     01280099
011800     05 EXC-MSG-REC-NMBR         PIC ZZZZZZ9-   VALUE ZEROES.     01290099
011900     05 EXC-MSG-RECORD           PIC X(60)      VALUE SPACES.     01300099
JPGFX1                                                                  01300199
JPGFX1******************************************************************01301099
JPGFX1*TL - TABLE FOR DISCOVER BINS                                     01302099
JPGFX1******************************************************************01303099
JPGFX1 01  TL-DISCOVER-CHK-CD-BINS-TBL.                                 01304099
JPGFX1     05  TL-DISC-CHK-CD-BIN-NBR OCCURS 400000 TIMES.              01305199
JPGFX1         10  TL-DISC-CHK-CD-BIN-NBR-12 PIC 9(12).                 01306099
JPGFX1                                                                  01310099
012100******************************************************************01320099
012200*  INPUT BIN FILE RECORD LAYOUT                                  *01330099
012300******************************************************************01340099
012400     COPY EPRD036.                                                01350099
012500                                                                  01360099
012100******************************************************************01370099
012200*  DISCOVER BIN FILE RECORD LAYOUT                               *01380099
012300******************************************************************01390099
012400     COPY EPRD037.                                                01400099
012500                                                                  01410099
JPGFX1******************************************************************01411099
JPGFX1*  VANTIV MATRIX BIN FILE RECORD LAYOUT                          *01412099
JPGFX1******************************************************************01413099
JPGFX1     COPY EPRD803.                                                01414099
JPGFX1                                                                  01415099
012600******************************************************************01420099
012700*  AJB BIN FILE RECORD LAYOUT                                    *01430099
012800******************************************************************01440099
012900     COPY EPRD038.                                                01450099
013000                                                                  01460099
012600******************************************************************01470099
012700*  KOHLS DEBIT CARD CONSTANTS                                    *01480099
012800******************************************************************01490099
012900     COPY TCRD012.                                                01500099
013000                                                                  01510099
013100******************************************************************01520099
013200 PROCEDURE DIVISION.                                              01530099
013300******************************************************************01540099
013400* 1000-MAINLINE-PROCESSING                                       *01550099
013500*    CONTROLS FLOW OF THE PROGRAM                                *01560099
013600******************************************************************01570099
013700 1000-MAINLINE-PROCESSING.                                        01580099
013800                                                                  01590099
013900     PERFORM 2000-INITIALIZE.                                     01600099
014000                                                                  01610099
014100     PERFORM 3000-PROCESS-INPUT-BIN-FILE                          01620099
014200         UNTIL PS-INPUT-BIN-EOF.                                  01630099
                                                                        01640099
014400     PERFORM 5000-SWITCH-FILES.                                   01650099
                                                                        01660099
014100     PERFORM 4000-PROCESS-DISCOVER-BIN-FILE                       01670099
014200         UNTIL PS-DISCOVER-BIN-EOF.                               01680099
014300                                                                  01690099
014400     PERFORM 6000-END-OF-JOB-ROUTINE.                             01700099
014500                                                                  01710099
014600     GOBACK.                                                      01720099
014700 EJECT                                                            01730099
014800                                                                  01740099
014900******************************************************************01750099
015000* 2000-INITIALIZE                                                *01760099
015100* OPEN ALL FILES.                                                *01770099
015200* READ THE FIRST RECORD IN THE INPUT BIN FILE AND VERIFY THAT IT *01780099
015300* IS A FILE HEADER RECORD.                                       *01790099
015400******************************************************************01800099
015500 2000-INITIALIZE.                                                 01810099
015600                                                                  01820099
015700     OPEN INPUT INPUT-BIN-FILE                                    01830099
JPGFX1                VNTV-BIN-MTRX-FILE                                01831099
015800         OUTPUT AJB-BIN-FILE.                                     01840099
015900                                                                  01852099
016000     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME              01860099
016100     DISPLAY ' '.                                                 01870099
016200                                                                  01880099
016300     PERFORM 2500-PROCESS-KOHLS-DEBIT-BIN.                        01890099
                                                                        01900099
016300     PERFORM 7000-READ-INPUT-BIN-FILE.                            01910099
016400                                                                  01920099
016500     IF PS-INPUT-BIN-EOF                                          01930099
016600         DISPLAY ' '                                              01940099
016700         DISPLAY 'INPUT BIN FILE IS EMPTY'                        01950099
016800         DISPLAY ' '                                              01960099
016900     ELSE                                                         01970099
017000         IF EP036-HDR-HEADER                                      01980099
017000             CONTINUE                                             01990099
017000         ELSE                                                     02000099
017100             MOVE PA-DIS-BIN-RCDS-READ TO EXC-MSG-REC-NMBR        02010099
017200             MOVE 'BIN FILE HEADER RECORD IS MISSING '            02020099
017300                                       TO EXC-MSG-COMMENT         02030099
017400             MOVE EP037-BIN-FILE-RCD   TO EXC-MSG-RECORD          02040099
017500             DISPLAY EXCEPTION-MESSAGE-LINE                       02050099
017500             PERFORM 9999-ABEND                                   02060099
017600         END-IF                                                   02070099
017700     END-IF.                                                      02080099
017800                                                                  02090099
JPGFX1     PERFORM 7100-READ-VNTV-MTRX-BIN-FILE.                        02090299
JPGFX1     MOVE +1 TO PV-SUB2.                                          02090499
JPGFX1     PERFORM                                                      02091199
JPGFX1         UNTIL PS-VNTV-MTRX-BIN-EOF                               02091299
JPGFX1         IF EP803-HDR-TYPE OR                                     02092299
JPGFX1            EP803-TRL-TYPE                                        02092399
JPGFX1             CONTINUE                                             02092599
JPGFX1         ELSE                                                     02092699
JPGFX1             IF EP803-DISCOVER-BIN                                02094099
JPGFX1                IF EP803-CHECK-CARD                               02094599
JPGFX1                    AND NOT EP803-PREPAID-CARD                    02094699
JPGFX1                    MOVE EP803-DTL-BIN-NBR                        02098999
JPGFX1                         TO TL-DISC-CHK-CD-BIN-NBR-12(PV-SUB2)    02099099
JPGFX1                    COMPUTE PV-SUB2 = PV-SUB2 + 1                 02099199
JPGFX1                    IF PV-SUB2 > PV-SUB2-MAX                      02099299
JPGFX1                        DISPLAY 'ERROR TABLE SIZE EXCEEDED FOR'   02099399
JPGFX1                        DISPLAY 'TL-DISCOVER-CHK-CD-BINS-TBL'     02099499
JPGFX1                    END-IF                                        02099599
JPGFX1                END-IF                                            02099699
JPGFX1             END-IF                                               02099899
JPGFX1         END-IF                                                   02100099
JPGFX1         PERFORM 7100-READ-VNTV-MTRX-BIN-FILE                     02101099
JPGFX1     END-PERFORM.                                                 02103299
JPGFX1     MOVE PV-SUB2 TO PV-SUB2-LAST.                                02103399
JPGFX1                                                                  02103599
014900******************************************************************02105099
015000* 2500-PROCESS-KOHLS-DEBIT-BIN                                    02110099
015400******************************************************************02120099
015500 2500-PROCESS-KOHLS-DEBIT-BIN.                                    02130099
029830     MOVE TC012-KOHLS-DEBIT-BIN-NBR TO PV-BIN-NO-19               02150099
029840                                       PV-BIN-NUMBER.             02160099
030300     COMPUTE PV-SUB = TC012-KOHLS-DEBIT-BIN-LENGTH + 1.           02170099
030400                                                                  02180099
030500     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      02190099
030600       UNTIL PV-SUB > 19                                          02200099
030700              MOVE '0' TO PV-BIN-NBR (PV-SUB)                     02210099
030800     END-PERFORM.                                                 02220099
030900                                                                  02230099
031000     MOVE PV-BIN-NO-19    TO EP038-AJB-BIN-LOW-NO.                02240099
031100                                                                  02250099
031200     MOVE TC012-KOHLS-DEBIT-BIN-NBR TO PV-BIN-NO-19.              02260099
031300                                                                  02270099
031400     COMPUTE PV-SUB = TC012-KOHLS-DEBIT-BIN-LENGTH + 1.           02280099
031500                                                                  02290099
031600     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      02300099
031700       UNTIL PV-SUB > 19                                          02310099
031800              MOVE '9' TO PV-BIN-NBR (PV-SUB)                     02320099
031900     END-PERFORM.                                                 02330099
032000                                                                  02340099
032100     MOVE PV-BIN-NO-19      TO EP038-AJB-BIN-HIGH-NO.             02350099
032200                                                                  02360099
032300     MOVE TC012-KOHLS-DEBIT-BIN-NBR TO PV-BIN-NO-19.              02370099
032400                                                                  02380099
032500     COMPUTE PV-SUB = TC012-KOHLS-DEBIT-BIN-LENGTH + 1.           02390099
032600                                                                  02400099
032700     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      02410099
032800       UNTIL PV-SUB > 19                                          02420099
032900              MOVE ' ' TO PV-BIN-NBR (PV-SUB)                     02430099
033000     END-PERFORM.                                                 02440099
033100                                                                  02450099
033200     MOVE PV-BIN-NO-19       TO EP038-AJB-BIN-BIN-NO.             02460099
003300     MOVE TC012-KOHLS-DEBIT-CARD-LENGTH TO                        02470099
003300                                EP038-AJB-BIN-CARD-LENGTH.        02480099
033400     MOVE TC012-KOHLS-DEBIT-BIN-LENGTH  TO                        02490099
033400                                EP038-AJB-BIN-LENGTH.             02500099
033500                                                                  02510099
034500     MOVE 'D' TO EP038-AJB-BIN-TYPE.                              02520099
034800     MOVE 'E' TO EP038-AJB-END-CHAR.                              02530099
029900                                                                  02540099
029910     PERFORM 9000-WRITE-AJB-BIN-FILE.                             02550099
029915     INITIALIZE EP038-AJB-BIN-FILE-RCD.                           02560099
                                                                        02570099
017900******************************************************************02580099
018000* 3000-PROCESS-INPUT-BIN-FILE                                    *02590099
018100*     CONTROLS PROCESSING OF INPUT BIN FILE RECORDS.             *02600099
018200*     DETERMINES THE PROCESSING REQUIRED FOR RECORDS IN THE BOFA *02610099
018300*     BIN FILE BASED ON RECORD TYPE.                             *02620099
018400******************************************************************02630099
018500 3000-PROCESS-INPUT-BIN-FILE.                                     02640099
018700     EVALUATE TRUE                                                02660099
019800        WHEN EP036-HDR-HEADER                                     02670099
019900            PERFORM 3100-EDIT-BIN-HEADER                          02680099
020000        WHEN EP036-TRL-TRAILER                                    02690099
020100            PERFORM 3200-EDIT-BIN-TRAILER                         02700099
020200        WHEN EP036-BIN-FILE-RCD = SPACES                          02710099
020300            CONTINUE                                              02720099
020400        WHEN OTHER                                                02730099
020500            ADD +1 TO PA-BIN-DTL-RCDS-READ                        02740099
020600            PERFORM 3300-EDIT-BIN-DETAIL                          02750099
020700            IF PS-VALID-DETAIL                                    02760099
020800                PERFORM 3500-FORMAT-OUTPUT                        02770099
020900                PERFORM 9000-WRITE-AJB-BIN-FILE                   02780099
021000            END-IF                                                02790099
021100            MOVE EP036-DTL-SEQ-NBR TO PV-PREV-SEQ-NBR             02800099
021200     END-EVALUATE.                                                02810099
021300                                                                  02820099
021400     PERFORM 7000-READ-INPUT-BIN-FILE.                            02830099
021500 EJECT                                                            02840099
021600                                                                  02850099
021700******************************************************************02860099
021800* 3100-EDIT-BIN-HEADER                                           *02870099
021900*   - THE HEADER MUST BE THE FIRST RECORD IN THE FILE.   CHECK   *02880099
022000*     # OF RECORDS READ TO VERIFY.                               *02890099
022100******************************************************************02900099
022200 3100-EDIT-BIN-HEADER.                                            02910099
022300                                                                  02920099
022400     IF PA-BIN-RCDS-READ = 1                                      02930099
               IF EP036-HDR-BINDISTR                                    02940099
                  SET PS-DEBIT TO TRUE                                  02950099
               ELSE                                                     02960099
                  SET PS-NOT-DEBIT TO TRUE                              02970099
               END-IF                                                   02980099
               IF EP036-HDR-BINVGIFT                                    02990099
                  SET PS-GIFT-CARD TO TRUE                              03000099
022300         ELSE                                                     03010099
                  SET PS-NO-GIFT-CARD TO TRUE                           03020099
022300         END-IF                                                   03030099
               IF EP036-HDR-BINDISTR OR                                 03040099
                  EP036-HDR-BINVGIFT                                    03050099
                  CONTINUE                                              03060099
               ELSE                                                     03070099
022800            MOVE 'HEADER NOT VALID '                              03080099
022900                                 TO EXC-MSG-COMMENT               03090099
023000            MOVE EP036-BIN-FILE-RCD TO EXC-MSG-RECORD             03100099
023100            DISPLAY EXCEPTION-MESSAGE-LINE                        03110099
017500            PERFORM 9999-ABEND                                    03120099
               END-IF                                                   03130099
027100         MOVE ZERO TO PV-CMP-SEQ-NBR                              03140099
008600                      PV-PREV-SEQ-NBR                             03150099
022600     ELSE                                                         03160099
022700         MOVE PA-BIN-RCDS-READ   TO EXC-MSG-REC-NMBR              03170099
022800         MOVE 'BIN FILE HEADER NOT FIRST RECORD'                  03180099
022900                                 TO EXC-MSG-COMMENT               03190099
023000         MOVE EP036-BIN-FILE-RCD TO EXC-MSG-RECORD                03200099
023100         DISPLAY EXCEPTION-MESSAGE-LINE                           03210099
017500         PERFORM 9999-ABEND                                       03220099
023200     END-IF.                                                      03230099
023300                                                                  03240099
023400******************************************************************03250099
023500* 3200-EDIT-BIN-TRAILER                                          *03260099
023600*   - DETAIL RECORD COUNT MUST EQUAL THE TOTAL NUMBER OF DETAIL  *03270099
023700*     RECORDS READ.                                              *03280099
023800*                                                                *03290099
023900*   - THE TRAILER RECORD MUST BE THE LAST RECORD IN THE FILE.    *03300099
024000*     A SWITCH IS SET TO INDICATE THAT THE TRAILER HAS BEEN READ.*03310099
024100******************************************************************03320099
024200 3200-EDIT-BIN-TRAILER.                                           03330099
024300                                                                  03340099
024400     SET PS-TRAILER-PROCESSED TO TRUE.                            03350099
024300                                                                  03360099
024500     IF EP036-TRL-DETAIL-RCD-CNT = PA-BIN-DTL-RCDS-READ           03370099
               CONTINUE                                                 03380099
024800     ELSE                                                         03390099
024900         MOVE PA-BIN-RCDS-READ   TO EXC-MSG-REC-NMBR              03400099
025000         MOVE 'BIN TRAILER COUNT ERROR'                           03410099
025100                                 TO EXC-MSG-COMMENT               03420099
025200         MOVE EP036-BIN-FILE-RCD TO EXC-MSG-RECORD                03430099
025300         DISPLAY EXCEPTION-MESSAGE-LINE                           03440099
025400         MOVE '3200-EDIT-BIN-TRAILER'                             03450099
025500                                 TO PV-PARAGRAPH-NAME             03460099
025600         SET PV-TRAILER-CNT-ERROR TO TRUE                         03470099
025700         PERFORM 9999-ABEND                                       03480099
025800     END-IF.                                                      03490099
025900                                                                  03500099
022800     MOVE 'BIN DTL RCDS READ '  TO EXC-MSG-COMMENT                03510099
022700     MOVE PA-BIN-DTL-RCDS-READ  TO EXC-MSG-REC-NMBR               03520099
022800     MOVE 'BIN RCDS READ '      TO EXC-MSG-COMMENT                03530099
022700     MOVE PA-BIN-RCDS-READ      TO EXC-MSG-REC-NMBR               03540099
023100     DISPLAY EXCEPTION-MESSAGE-LINE                               03550099
           ADD  PA-BIN-RCDS-READ      TO PA-BIN-RCDS-TOT-READ.          03560099
022400     MOVE ZERO TO PA-BIN-DTL-RCDS-READ                            03570099
022400                  PA-BIN-RCDS-READ.                               03580099
025900                                                                  03581099
026000******************************************************************03582099
026100* 3300-EDIT-BIN-DETAIL                                           *03583099
026200*   - THE SEQUENCE NUMBER ON THE FIRST BIN DETAIL RECORD MUST    *03584099
026300*     BE EQUAL TO 1.  THE VALUE OF PV-PREV-SEQ-NBR IS INITIALIZED*03585099
026400*     TO ZERO.                                                   *03586099
026500*                                                                *03587099
026600*   - THE SEQUENCE NUMBER ON SUBSEQUENT DETAILS MUST BE ONE      *03588099
026700*     GREATER THAN THE SEQUENCE NUMBER ON THE PREVIOUS RECORD.   *03589099
026800******************************************************************03590099
026900 3300-EDIT-BIN-DETAIL.                                            03600099
027000                                                                  03610099
027100     COMPUTE PV-CMP-SEQ-NBR = PV-PREV-SEQ-NBR + 1.                03620099
027200                                                                  03630099
027300     IF EP036-DTL-SEQ-NBR = PV-CMP-SEQ-NBR                        03640099
027400         SET PS-VALID-DETAIL   TO TRUE                            03650099
027500     ELSE                                                         03660099
027600         SET PS-INVALID-DETAIL TO TRUE                            03670099
027700         MOVE PA-BIN-RCDS-READ     TO EXC-MSG-REC-NMBR            03680099
027800         MOVE EP036-BIN-FILE-RCD   TO EXC-MSG-RECORD              03690099
027900         IF PV-PREV-SEQ-NBR = ZERO                                03700099
028000             MOVE 'BIN FILE FIRST DETAIL SEQ NOT ONE'             03710099
028100                                     TO EXC-MSG-COMMENT           03720099
028200         ELSE                                                     03730099
028300             MOVE 'BIN FILE DETAILS OUT OF SEQ'                   03740099
028400                                     TO EXC-MSG-COMMENT           03750099
028500         END-IF                                                   03760099
028600         DISPLAY EXCEPTION-MESSAGE-LINE                           03770099
028700         SET PV-RECS-OUT-OF-SEQ-ERROR TO TRUE                     03780099
028800         MOVE '3300-EDIT-BIN-DETAIL'                              03790099
028900                                 TO PV-PARAGRAPH-NAME             03800099
029000         PERFORM 9999-ABEND                                       03810099
029100     END-IF.                                                      03820099
029200                                                                  03830099
029300******************************************************************03840099
029400* 3500-FORMAT-OUTPUT                                             *03850099
029500******************************************************************03860099
029600 3500-FORMAT-OUTPUT.                                              03870099
029700                                                                  03880099
029800     INITIALIZE EP038-AJB-BIN-FILE-RCD.                           03890099
029940                                                                  03900099
030000     MOVE EP036-DTL-BIN        TO PV-BIN-NO-19                    03910099
030100                                  PV-BIN-NUMBER.                  03920099
030200                                                                  03930099
030300     COMPUTE PV-SUB = EP036-DTL-BIN-LENGTH + 1.                   03940099
030400                                                                  03950099
030500     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      03960099
030600         UNTIL PV-SUB > 19                                        03970099
030700             MOVE '0' TO PV-BIN-NBR (PV-SUB)                      03980099
030800     END-PERFORM.                                                 03990099
030900                                                                  04000099
031000     MOVE PV-BIN-NO-19    TO EP038-AJB-BIN-LOW-NO.                04010099
031100                                                                  04020099
031200     MOVE EP036-DTL-BIN   TO PV-BIN-NO-19.                        04030099
031300                                                                  04040099
031400     COMPUTE PV-SUB = EP036-DTL-BIN-LENGTH + 1.                   04050099
031500                                                                  04060099
031600     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      04070099
031700         UNTIL PV-SUB > 19                                        04080099
031800             MOVE '9' TO PV-BIN-NBR (PV-SUB)                      04090099
031900     END-PERFORM.                                                 04100099
032000                                                                  04110099
032100     MOVE PV-BIN-NO-19      TO EP038-AJB-BIN-HIGH-NO.             04120099
032200                                                                  04130099
032300     MOVE EP036-DTL-BIN        TO PV-BIN-NO-19.                   04140099
032400                                                                  04150099
032500     COMPUTE PV-SUB = EP036-DTL-BIN-LENGTH + 1.                   04160099
032600                                                                  04170099
032700     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      04180099
032800         UNTIL PV-SUB > 19                                        04190099
032900             MOVE ' ' TO PV-BIN-NBR (PV-SUB)                      04200099
033000     END-PERFORM.                                                 04210099
033100                                                                  04220099
033200     MOVE PV-BIN-NO-19            TO EP038-AJB-BIN-BIN-NO.        04230099
033300     MOVE EP036-DTL-ACCT-LENGTH   TO EP038-AJB-BIN-CARD-LENGTH.   04240099
033400     MOVE EP036-DTL-BIN-LENGTH    TO EP038-AJB-BIN-LENGTH.        04250099
033500                                                                  04260099
           MOVE PV-BIN-NO-19(1:6) TO  PV-CHK-MC-PREFIX-TWO.             04261099
                                                                        04262099
033600     IF EP036-DTL-ACCT-LENGTH = 16 OR 00                          04270099
033700         EVALUATE TRUE                                            04280099
033800             WHEN PV-VISA-PREFIX                                  04290099
033900             WHEN PV-MC-PREFIX                                    04300099
033900             WHEN PV-MC-PREFIX-TWO                                04301099
034000                 MOVE 'B' TO EP038-AJB-BIN-TYPE                   04310099
034100             WHEN OTHER                                           04320099
034200                 MOVE 'D' TO EP038-AJB-BIN-TYPE                   04330099
034300         END-EVALUATE                                             04340099
034400     ELSE                                                         04350099
034500         MOVE 'D' TO EP038-AJB-BIN-TYPE                           04360099
034600     END-IF.                                                      04370099
034700     IF PS-GIFT-CARD                                              04380099
034200         MOVE 'G' TO EP038-AJB-BIN-TYPE                           04390099
034600     END-IF.                                                      04400099
034700                                                                  04400199
JPGFX1     MOVE PV-BIN-NO-19(1:8) TO PV-CHK-DISCOVER-BIN.               04400299
JPGFX1     IF DISCOVER-BIN                                              04400399
JPGFX1         SET PS-CHECK-CARD-NOT-FOUND TO TRUE                      04400499
JPGFX1         MOVE +1 TO PV-SUB2                                       04403599
JPGFX1         PERFORM VARYING PV-SUB2 FROM 1 BY 1                      04404099
JPGFX1           UNTIL PV-SUB2 > PV-SUB2-LAST                           04404199
JPGFX1              OR PS-CHECK-CARD-FOUND                              04404299
JPGFX1              MOVE TL-DISC-CHK-CD-BIN-NBR-12(PV-SUB2)             04404499
JPGFX1                                TO EP803-DTL-BIN-NBR              04404599
JPGFX1              IF PV-BIN-NO-19(1:EP036-DTL-BIN-LENGTH) =           04406199
JPGFX1                 EP803-DTL-BIN-NBR(1:EP036-DTL-BIN-LENGTH)        04406299
JPGFX1                  MOVE 'B' TO EP038-AJB-BIN-TYPE                  04406399
JPGFX1                  SET PS-CHECK-CARD-FOUND TO TRUE                 04406499
JPGFX1              END-IF                                              04406799
JPGFX1         END-PERFORM                                              04406899
JPGFX1     END-IF.                                                      04406999
JPGFX1                                                                  04407099
034800     MOVE 'E' TO EP038-AJB-END-CHAR.                              04420099
034900                                                                  04430099
017900******************************************************************04440099
018000* 4000-PROCESS-DISCOVER-BIN-FILE                                 *04450099
018100*     CONTROLS PROCESSING OF DISCOVER BIN FILE RECORDS.          *04460099
018200*     DETERMINES THE PROCESSING REQUIRED FOR RECORDS IN THE      *04470099
018300*     BIN FILE BASED ON RECORD TYPE.                             *04480099
018400******************************************************************04490099
018500 4000-PROCESS-DISCOVER-BIN-FILE.                                  04500099
018600                                                                  04510099
010700     SET  PS-INVALID-DETAIL  TO TRUE.                             04520099
018700     EVALUATE TRUE                                                04530099
018800        WHEN PS-TRAILER-PROCESSED                                 04540099
018900            IF EP037-BIN-FILE-RCD = SPACES                        04550099
019000                 CONTINUE                                         04560099
019100            ELSE                                                  04570099
019200                 MOVE PA-DIS-BIN-RCDS-READ TO EXC-MSG-REC-NMBR    04580099
019300                 MOVE 'DISCOVER BIN FILE REC FOUND AFTER TRAILER' 04590099
019400                                           TO EXC-MSG-COMMENT     04600099
019500                 MOVE EP037-BIN-FILE-RCD   TO EXC-MSG-RECORD      04610099
019600                 DISPLAY EXCEPTION-MESSAGE-LINE                   04620099
019700            END-IF                                                04630099
019800        WHEN EP037-HDR-TYPE                                       04640099
019900            PERFORM 4100-EDIT-BIN-HEADER                          04650099
020000        WHEN EP037-TRL-TYPE                                       04660099
020100            PERFORM 4200-EDIT-BIN-TRAILER                         04670099
020200        WHEN EP037-BIN-FILE-RCD = SPACES                          04680099
020300            CONTINUE                                              04690099
020400        WHEN OTHER                                                04700099
020500            ADD +1 TO PA-DIS-BIN-DTL-RCDS-READ                    04710099
020600               PERFORM 4300-EDIT-BIN-DETAIL                       04720099
                  IF EP037-DTL-MIN-PAN-LENGTH =                         04730099
                     EP037-DTL-MAX-PAN-LENGTH                           04740099
020700               IF PS-VALID-DETAIL                                 04750099
                        MOVE EP037-DTL-MIN-PAN-LENGTH                   04751099
                                     TO PV-HOLD-PAN-LENGTH              04752099
020800                  PERFORM 4500-FORMAT-OUTPUT                      04760099
020900                  PERFORM 9000-WRITE-AJB-BIN-FILE                 04770099
021000               END-IF                                             04780099
                  ELSE                                                  04790099
                     MOVE EP037-DTL-MIN-PAN-LENGTH TO PV-SUB1           04800099
                     PERFORM VARYING PV-SUB1                            04810099
                             FROM EP037-DTL-MIN-PAN-LENGTH BY 1         04820099
                        UNTIL PV-SUB1 > EP037-DTL-MAX-PAN-LENGTH        04830099
                        MOVE PV-SUB1 TO PV-HOLD-PAN-LENGTH              04840099
020700                  IF PS-VALID-DETAIL                              04850099
020800                     PERFORM 4500-FORMAT-OUTPUT                   04860099
020900                     PERFORM 9000-WRITE-AJB-BIN-FILE              04870099
021000                  END-IF                                          04880099
                     END-PERFORM                                        04890099
                  END-IF                                                04900099
021100            MOVE EP037-DTL-SEQ-NBR TO PV-PREV-SEQ-NBR             04910099
021200     END-EVALUATE.                                                04920099
021300                                                                  04930099
021400     PERFORM 7500-READ-DISCOVER-BIN-FILE.                         04940099
021500 EJECT                                                            04950099
021600                                                                  04960099
021700******************************************************************04970099
021800* 4100-EDIT-BIN-HEADER                                           *04980099
021900*   - THE HEADER MUST BE THE FIRST RECORD IN THE FILE.   CHECK   *04990099
022000*     # OF RECORDS READ TO VERIFY.                               *05000099
022100******************************************************************05010099
022200 4100-EDIT-BIN-HEADER.                                            05020099
022300                                                                  05030099
022400     IF PA-DIS-BIN-RCDS-READ = 1                                  05040099
022500         CONTINUE                                                 05050099
022600     ELSE                                                         05060099
022700         MOVE PA-DIS-BIN-RCDS-READ   TO EXC-MSG-REC-NMBR          05070099
022800         MOVE 'BIN FILE HEADER NOT FIRST RECORD'                  05080099
022900                                 TO EXC-MSG-COMMENT               05090099
023000         MOVE EP037-BIN-FILE-RCD TO EXC-MSG-RECORD                05100099
023100         DISPLAY EXCEPTION-MESSAGE-LINE                           05110099
023200     END-IF.                                                      05120099
023300                                                                  05130099
027100     MOVE ZERO TO PV-CMP-SEQ-NBR                                  05140099
008600                  PV-PREV-SEQ-NBR.                                05150099
023300                                                                  05160099
023400******************************************************************05170099
023500* 4200-EDIT-BIN-TRAILER                                          *05180099
023600*   - DETAIL RECORD COUNT MUST EQUAL THE TOTAL NUMBER OF DETAIL  *05190099
023700*     RECORDS READ.                                              *05200099
023800*                                                                *05210099
023900*   - THE TRAILER RECORD MUST BE THE LAST RECORD IN THE FILE.    *05220099
024000*     A SWITCH IS SET TO INDICATE THAT THE TRAILER HAS BEEN READ.*05230099
024100******************************************************************05240099
024200 4200-EDIT-BIN-TRAILER.                                           05250099
024300                                                                  05260099
024400     SET PS-TRAILER-PROCESSED TO TRUE.                            05270099
024500                                                                  05280099
024600     IF EP037-TRL-DETAIL-RCD-CNT = PA-DIS-BIN-DTL-RCDS-READ       05290099
024700        CONTINUE                                                  05300099
024800     ELSE                                                         05310099
024900         MOVE PA-DIS-BIN-RCDS-READ   TO EXC-MSG-REC-NMBR          05320099
025000         MOVE 'BIN TRAILER COUNT ERROR'                           05330099
025100                                 TO EXC-MSG-COMMENT               05340099
025200         MOVE EP037-BIN-FILE-RCD TO EXC-MSG-RECORD                05350099
025300         DISPLAY EXCEPTION-MESSAGE-LINE                           05360099
025400         MOVE '3200-EDIT-BIN-TRAILER'                             05370099
025500                                 TO PV-PARAGRAPH-NAME             05380099
025600         SET PV-TRAILER-CNT-ERROR TO TRUE                         05390099
025700         PERFORM 9999-ABEND                                       05400099
025800     END-IF.                                                      05410099
025900                                                                  05420099
026000******************************************************************05430099
026100* 4300-EDIT-BIN-DETAIL                                           *05440099
026200*   - THE SEQUENCE NUMBER ON THE FIRST BIN DETAIL RECORD MUST    *05450099
026300*     BE EQUAL TO 1.  THE VALUE OF PV-PREV-SEQ-NBR IS INITIALIZED*05460099
026400*     TO ZERO.                                                   *05470099
026500*                                                                *05480099
026600*   - THE SEQUENCE NUMBER ON SUBSEQUENT DETAILS MUST BE ONE      *05490099
026700*     GREATER THAN THE SEQUENCE NUMBER ON THE PREVIOUS RECORD.   *05500099
026500*                                                                *05510099
026500*   - ONLY STORED VALUE RANGES WILL BE WRITTEN OUT TO THE OUTPUT *05520099
026500*     FILE.  THESE ARE EP037-DTL-PROD-TYPE = 5 AND 6.            *05521099
026500*                                                                *05522099
026800******************************************************************05523099
026900 4300-EDIT-BIN-DETAIL.                                            05524099
027000                                                                  05525099
027100     COMPUTE PV-CMP-SEQ-NBR = PV-PREV-SEQ-NBR + 1.                05526099
027200                                                                  05527099
027300     IF EP037-DTL-SEQ-NBR = PV-CMP-SEQ-NBR                        05528099
               IF EP037-DTL-PROD-TYPE = 5 OR 6                          05529099
027400            SET PS-VALID-DETAIL   TO TRUE                         05530099
027500         END-IF                                                   05540099
027500     ELSE                                                         05550099
027600         SET PS-INVALID-DETAIL TO TRUE                            05560099
027700         MOVE PA-DIS-BIN-RCDS-READ     TO EXC-MSG-REC-NMBR        05570099
027800         MOVE EP037-BIN-FILE-RCD   TO EXC-MSG-RECORD              05580099
027900         IF PV-PREV-SEQ-NBR = ZERO                                05590099
028000             MOVE 'BIN FILE FIRST DETAIL SEQ NOT ONE'             05600099
028100                                     TO EXC-MSG-COMMENT           05610099
028200         ELSE                                                     05620099
028300             MOVE 'BIN FILE DETAILS OUT OF SEQ'                   05630099
028400                                     TO EXC-MSG-COMMENT           05640099
028500         END-IF                                                   05650099
028600         DISPLAY EXCEPTION-MESSAGE-LINE                           05660099
028700         SET PV-RECS-OUT-OF-SEQ-ERROR TO TRUE                     05670099
028800         MOVE '4300-EDIT-BIN-DETAIL'                              05680099
028900                                 TO PV-PARAGRAPH-NAME             05690099
029000         PERFORM 9999-ABEND                                       05700099
029100     END-IF.                                                      05710099
029200                                                                  05720099
029300******************************************************************05730099
029400* 4500-FORMAT-OUTPUT                                             *05740099
029500******************************************************************05750099
029600 4500-FORMAT-OUTPUT.                                              05760099
029700                                                                  05770099
029800     INITIALIZE EP038-AJB-BIN-FILE-RCD.                           05780099
029940                                                                  05790099
030000     MOVE EP037-DTL-BIN-NBR    TO PV-BIN-NO-19                    05800099
030100                                  PV-BIN-NUMBER.                  05810099
030200                                                                  05820099
030300     COMPUTE PV-SUB = EP037-DTL-BIN-LENGTH + 1.                   05830099
030400                                                                  05840099
030500     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      05850099
030600         UNTIL PV-SUB > 19                                        05860099
030700             MOVE '0' TO PV-BIN-NBR (PV-SUB)                      05870099
030800     END-PERFORM.                                                 05880099
030900                                                                  05890099
031000     MOVE PV-BIN-NO-19    TO EP038-AJB-BIN-LOW-NO.                05900099
031100                                                                  05910099
031200     MOVE EP037-DTL-BIN-NBR   TO PV-BIN-NO-19.                    05920099
031300                                                                  05930099
031400     COMPUTE PV-SUB = EP037-DTL-BIN-LENGTH + 1.                   05940099
031500                                                                  05950099
031600     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      05960099
031700         UNTIL PV-SUB > 19                                        05970099
031800             MOVE '9' TO PV-BIN-NBR (PV-SUB)                      05980099
031900     END-PERFORM.                                                 05990099
032000                                                                  06000099
032100     MOVE PV-BIN-NO-19      TO EP038-AJB-BIN-HIGH-NO.             06010099
032200                                                                  06020099
032300     MOVE EP037-DTL-BIN-NBR    TO PV-BIN-NO-19.                   06030099
032400                                                                  06040099
032500     COMPUTE PV-SUB = EP037-DTL-BIN-LENGTH + 1.                   06050099
032600                                                                  06060099
032700     PERFORM VARYING PV-SUB FROM PV-SUB BY 1                      06070099
032800         UNTIL PV-SUB > 19                                        06080099
032900             MOVE ' ' TO PV-BIN-NBR (PV-SUB)                      06090099
033000     END-PERFORM.                                                 06100099
033100                                                                  06110099
033200     MOVE PV-BIN-NO-19            TO EP038-AJB-BIN-BIN-NO.        06120099
033300     MOVE PV-HOLD-PAN-LENGTH      TO EP038-AJB-BIN-CARD-LENGTH.   06130099
033400     MOVE EP037-DTL-BIN-LENGTH    TO EP038-AJB-BIN-LENGTH.        06140099
033500                                                                  06150099
034500     MOVE 'G' TO EP038-AJB-BIN-TYPE.                              06160099
034700                                                                  06170099
034800     MOVE 'E' TO EP038-AJB-END-CHAR.                              06180099
034900                                                                  06190099
035000******************************************************************06200099
035100* 5000-SWITCH-FILES                                               06210099
035200******************************************************************06220099
035300 5000-SWITCH-FILES.                                               06230099
035400                                                                  06240099
JPGFX1     CLOSE INPUT-BIN-FILE                                         06250099
JPGFX1           VNTV-BIN-MTRX-FILE.                                    06251099
015700     OPEN  INPUT DISCOVER-BIN-FILE.                               06260099
           SET PS-TRAILER-NOT-PROCESSED TO TRUE.                        06270099
016300     PERFORM 7500-READ-DISCOVER-BIN-FILE.                         06280099
016400                                                                  06290099
016500     IF PS-DISCOVER-BIN-EOF                                       06300099
016600         DISPLAY ' '                                              06310099
016700         DISPLAY 'DISCOVER BIN FILE IS EMPTY'                     06320099
016800         DISPLAY ' '                                              06330099
016900     ELSE                                                         06340099
017000         IF NOT EP037-HDR-TYPE                                    06350099
017100             MOVE PA-DIS-BIN-RCDS-READ   TO EXC-MSG-REC-NMBR      06360099
017200             MOVE 'DISCOVER BIN FILE HEADER RECORD IS MISSING '   06370099
017300                                     TO EXC-MSG-COMMENT           06380099
017400             MOVE EP037-BIN-FILE-RCD TO EXC-MSG-RECORD            06390099
017500             DISPLAY EXCEPTION-MESSAGE-LINE                       06400099
017600         END-IF                                                   06410099
017700     END-IF.                                                      06420099
035700                                                                  06430099
035000******************************************************************06440099
035100* 6000-END-OF-JOB-ROUTINE                                        *06450099
035200******************************************************************06460099
035300 6000-END-OF-JOB-ROUTINE.                                         06470099
035400                                                                  06480099
035500     CLOSE DISCOVER-BIN-FILE                                      06490099
035600           AJB-BIN-FILE.                                          06500099
035700                                                                  06510099
035800     DISPLAY ' '.                                                 06520099
035900     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             06530099
036000     DISPLAY 'NUMBER OF INPUT BIN RECORDS READ:            '      06540099
036100*            PA-BIN-RCDS-READ                                     06550099
                   PA-BIN-RCDS-TOT-READ.                                06560099
036000     DISPLAY 'NUMBER OF DISCOVER BIN RECORDS READ:         '      06570099
036100             PA-DIS-BIN-RCDS-READ.                                06580099
           COMPUTE PA-TOT-RCDS-READ =                                   06590099
                   PA-BIN-RCDS-TOT-READ + PA-DIS-BIN-RCDS-READ.         06600099
036000     DISPLAY 'TOTAL NUMBER OF BIN RECORDS READ:           '       06610099
036100             PA-TOT-RCDS-READ.                                    06620099
036200     DISPLAY 'NUMBER OF AJB BIN RECORDS WRITTEN:          '       06630099
036300             PA-RECORDS-WRITTEN.                                  06640099
036400     DISPLAY ' '.                                                 06650099
036500                                                                  06660099
036600******************************************************************06670099
036700* 7000-READ-INPUT-BIN-FILE                                       *06680099
036800******************************************************************06690099
036900 7000-READ-INPUT-BIN-FILE.                                        06700099
037000                                                                  06710099
037100     READ INPUT-BIN-FILE INTO EP036-BIN-FILE-RCD                  06720099
037200         AT END                                                   06730099
037300             SET PS-INPUT-BIN-EOF TO TRUE                         06740099
037400     END-READ.                                                    06750099
037500                                                                  06760099
037600     IF NOT PS-INPUT-BIN-EOF                                      06770099
037700         ADD +1 TO PA-BIN-RCDS-READ                               06780099
037800     END-IF.                                                      06790099
037900                                                                  06800099
JPGFX1******************************************************************06801099
JPGFX1* 7100-READ-VNTV-MTRX-BIN-FILE                                   *06802099
JPGFX1******************************************************************06803099
JPGFX1 7100-READ-VNTV-MTRX-BIN-FILE.                                    06804099
JPGFX1     READ VNTV-BIN-MTRX-FILE INTO EP803-BIN-FILE-RCD              06806099
JPGFX1         AT END                                                   06807099
JPGFX1             SET PS-VNTV-MTRX-BIN-EOF TO TRUE                     06808099
JPGFX1     END-READ.                                                    06809099
JPGFX1                                                                  06809399
036600******************************************************************06810099
036700* 7500-READ-DISCOVER-BIN-FILE                                    *06820099
036800******************************************************************06830099
036900 7500-READ-DISCOVER-BIN-FILE.                                     06840099
037000                                                                  06850099
037100     READ DISCOVER-BIN-FILE INTO EP037-BIN-FILE-RCD               06860099
037200         AT END                                                   06870099
037300             SET PS-DISCOVER-BIN-EOF TO TRUE                      06880099
037400     END-READ.                                                    06890099
037500                                                                  06900099
037600     IF NOT PS-DISCOVER-BIN-EOF                                   06910099
037700         ADD +1 TO PA-DIS-BIN-RCDS-READ                           06920099
037800     END-IF.                                                      06930099
037900                                                                  06940099
038000******************************************************************06950099
038100* 9000-WRITE-AJB-BIN-FILE                                        *06960099
038200******************************************************************06970099
038300 9000-WRITE-AJB-BIN-FILE.                                         06980099
038400                                                                  06990099
038500     WRITE AJB-BIN-RECORD FROM EP038-AJB-BIN-FILE-RCD.            07000099
038600     ADD +1 TO PA-RECORDS-WRITTEN.                                07010099
038700                                                                  07020099
038800******************************************************************07030099
038900* 9999-ABEND.                                                    *07040099
039000******************************************************************07050099
039100 9999-ABEND.                                                      07060099
039200                                                                  07070099
039300     DISPLAY '** ABEND        **'.                                07080099
039400     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             07090099
039500     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           07100099
039600                                                                  07110099
039700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07120099
039800                                                                  07130099
