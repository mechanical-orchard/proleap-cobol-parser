000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    DPKCS046.                                         00040000
000500 AUTHOR.        CAL BUSH.                                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  03-01-96.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Z046 - SAVE COMMAREA LIST PROGRAM.                         * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF RECORDS IN THE SAVED      * 00130000
001400*    COMMAREA VSAM FILE.                                        * 00140000
001500*                                                               * 00150000
262023*  CHANGED 09/28/2021    BY JIM HUNTER      WR: CHG0262023      * 00151030
262023*  CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE  * 00152030
262023*  MAKING THE CALL DYNAMIC VS STATIC                            * 00153030
001600*---------------------------------------------------------------* 00160000
001700 EJECT                                                            00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900                                                                  00190000
002000 DATA DIVISION.                                                   00200000
002100                                                                  00210000
002200 WORKING-STORAGE SECTION.                                         00220000
002300                                                                  00230000
002400                                                                  00240000
002500 01  PC-PROGRAM-CONSTANTS.                                        00250000
002600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00260000
002700                                                    'DP046A  '.   00270000
002800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00280000
002900                                                    'DPKM046 '.   00290000
003000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00300000
003100                                                    'DPKCS046'.   00310000
003101     05  PC-SAVE-COMM-DD                PIC  X(08)  VALUE         00310101
003102                                                    'DPSAVCMK'.   00310201
003103     05  PC-DP515-KEYLENGTH             PIC S9(04)  VALUE 15      00310318
003104                                                    COMP.         00310418
003200     05  PC-LIST-NUM-LENGTH             PIC  9(01)  VALUE 5.      00320003
003210     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00321003
003300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00330000
003400     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00340000
003500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00350000
003600                                                    COMP SYNC.    00360000
003700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00370000
003800                                                    COMP SYNC.    00380000
003900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00390000
004000                                                    +1000000      00400000
004100                                                    COMP-3.       00410000
004200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00420000
004300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00430000
004400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00440000
004500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00450000
004510     05  PC-LOW-KEY                     PIC  X(15)  VALUE         00451015
004520                                                    LOW-VALUES.   00452019
004600*                                                                 00460000
004700     05  PC-TSYMSG-NUMBERS.                                       00470000
004800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00480000
004900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00490000
005000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00500000
005100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00510000
005200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00520000
005300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00530000
005400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00540000
005500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00550000
005600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00560000
005700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00570000
005800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00580000
005900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00590000
006000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00600000
006100         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00610000
006200*                                                                 00620000
006300 01  PS-PROGRAM-SWITCHES.                                         00630000
006400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00640000
006500         88  PS-NO-ERROR                            VALUE 'Y'.    00650000
006600         88  PS-ERROR                               VALUE 'N'.    00660000
006700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00670000
006800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00680000
006900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00690000
007000*                                                                 00700000
007100 01  PV-PROGRAM-VARIABLES.                                        00710000
007200     05  PV-SUB                         PIC S9(04)  VALUE +0      00720000
007300                                                    COMP SYNC.    00730000
007400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00740000
007500                                                    COMP SYNC.    00750000
007510     05  PV-RECORD-LENGTH               PIC S9(04)  VALUE +0      00751018
007520                                                    COMP SYNC.    00752018
007600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00760000
007700                                                    COMP-3.       00770000
007800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00780000
007900                                                    COMP-3.       00790000
008000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00800000
008100                                                    COMP-3.       00810000
008200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00820000
008300                                                    COMP-3.       00830000
008400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00840000
008500                                                    COMP-3.       00850000
008600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00860000
008700                                                    COMP-3.       00870000
008800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      00880000
008900                                                    COMP-3.       00890000
009000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00900000
009100                                                    COMP SYNC.    00910000
009200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00920000
009300                                                    COMP SYNC.    00930000
009400     05  PV-ITEM                        PIC S9(04)  VALUE +0      00940000
009500                                                    COMP SYNC.    00950000
009600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00960000
009700                                                    COMP SYNC.    00970000
009800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00980000
009900                                                    COMP SYNC.    00990000
010000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01000000
010100                                                    COMP SYNC.    01010000
010200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01020000
010300                                                    COMP SYNC.    01030000
010400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01040000
010500                                                    COMP SYNC.    01050000
010600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01060000
010700                                                    COMP SYNC.    01070000
010800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01080000
010900                                                    COMP SYNC.    01090000
011000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01100000
011100                                                    COMP SYNC.    01110000
011200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01120000
011300                                                    COMP SYNC.    01130000
011400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01140000
011500                                                    COMP SYNC.    01150000
011600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01160000
011700                                                    COMP SYNC.    01170000
011800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01180000
011900                                                    COMP SYNC.    01190000
012000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01200000
012100                                                    COMP SYNC.    01210000
012110     05  PV-TIME                        PIC  9(06)  VALUE ZERO.   01211011
012120     05  FILLER                         REDEFINES PV-TIME.        01212011
012130         10  PV-TIME-HH                 PIC  9(02).               01213008
012140         10  PV-TIME-MM                 PIC  9(02).               01214008
012150         10  PV-TIME-SS                 PIC  9(02).               01215008
012160     05  PV-OLD-NETNAME                 PIC  X(08)  VALUE SPACE.  01216023
012170     05  PV-OLD-NETNAME-STATUS          PIC  X(09)  VALUE SPACE.  01217023
012200******************************************************************01220000
012300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01230000
012400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01240000
012500**  APPLICATION-SPECIFIC COMMAREA.                              **01250000
012600******************************************************************01260000
012700 01  LQW-LIST-QUEUE-WORK-AREA.                                    01270000
012800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01280000
012900     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01290000
013000                                        INDEXED BY LQW-IDX.       01300000
013100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01310000
013200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01320000
013300         10  LQW-SELECTED-SW            PIC  X(01).               01330000
013400             88  LQW-SELECT                         VALUE 'S'.    01340000
013500             88  LQW-DESELECT                       VALUE ' '.    01350000
013600         10  LQW-ACTION                 PIC  X(03).               01360000
013700         10  LQW-STATUS                 PIC  X(09).               01370000
013800         10  LQW-NETNAME                PIC  X(08).               01380000
013900         10  LQW-TASK-NUM               PIC  9(07).               01390000
014000         10  LQW-JUL-DAT                PIC  9(05).               01400000
014100         10  LQW-TIME                   PIC  X(08).               01410000
014200         10  LQW-CREATOR                PIC  X(08).               01420000
014300                                                                  01430000
014400     EJECT                                                        01440000
014500*---------------------------------------------------------------* 01450000
014600*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 01460000
014700*---------------------------------------------------------------* 01470000
014800                                                                  01480000
014900*    COPY DPWS057.                                                01490000
015000                                                                  01500000
015100     EJECT                                                        01510000
015200*---------------------------------------------------------------* 01520000
015300*    MAP LAYOUT                                                 * 01530000
015400*---------------------------------------------------------------* 01540000
015500                                                                  01550000
015600     COPY DPKM046.                                                01560000
015700*                                                                 01570000
015800 01  MR-OCCURS-LAYOUT                   REDEFINES  DP046AO.       01580000
015900     05  FILLER                         PIC X(52).                01590000
016000     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01600000
016100         10  MR-SELECTL                 PIC S9(04) COMP.          01610000
016200         10  MR-SELECTA                 PIC  X(01).               01620000
016300         10  MR-SELECTC                 PIC  X(01).               01630000
016400         10  MR-SELECTH                 PIC  X(01).               01640000
016500         10  MR-SELECTI                 PIC  X(01).               01650000
016600                                                                  01660000
016700         10  MR-ACTIONL                 PIC S9(04) COMP.          01670000
016800         10  MR-ACTIONA                 PIC  X(01).               01680000
016900         10  MR-ACTIONC                 PIC  X(01).               01690000
017000         10  MR-ACTIONH                 PIC  X(01).               01700000
017100         10  MR-ACTION                  PIC  X(03).               01710000
017200                                                                  01720000
017300         10  MR-STATUSL                 PIC S9(04) COMP.          01730000
017400         10  MR-STATUSA                 PIC  X(01).               01740000
017500         10  MR-STATUSC                 PIC  X(01).               01750000
017600         10  MR-STATUSH                 PIC  X(01).               01760000
017700         10  MR-STATUS                  PIC  X(09).               01770000
017800                                                                  01780000
017900         10  MR-NETNAMEL                PIC S9(04) COMP.          01790000
018000         10  MR-NETNAMEA                PIC  X(01).               01800000
018100         10  MR-NETNAMEC                PIC  X(01).               01810000
018200         10  MR-NETNAMEH                PIC  X(01).               01820000
018300         10  MR-NETNAME                 PIC  X(08).               01830000
018400                                                                  01840000
018500         10  MR-TASK-NUML               PIC S9(04) COMP.          01850000
018600         10  MR-TASK-NUMA               PIC  X(01).               01860000
018700         10  MR-TASK-NUMC               PIC  X(01).               01870000
018800         10  MR-TASK-NUMH               PIC  X(01).               01880000
018900         10  MR-TASK-NUM-X.                                       01890003
018910             15  MR-TASK-NUM            PIC  9(07).               01891003
019000                                                                  01900000
019100         10  MR-JUL-DATEL               PIC S9(04) COMP.          01910000
019200         10  MR-JUL-DATEA               PIC  X(01).               01920000
019300         10  MR-JUL-DATEC               PIC  X(01).               01930000
019400         10  MR-JUL-DATEH               PIC  X(01).               01940000
019500         10  MR-JUL-DATE                PIC  X(05).               01950000
019600         10  MR-TIMEL                   PIC S9(04) COMP.          01960000
019700         10  MR-TIMEA                   PIC  X(01).               01970000
019800         10  MR-TIMEC                   PIC  X(01).               01980000
019900         10  MR-TIMEH                   PIC  X(01).               01990000
020000         10  MR-TIME.                                             02000000
020100             15  MR-TIME-HH             PIC  9(02).               02010000
020200             15  MR-TIME-COLON-1        PIC  X(01).               02020002
020300             15  MR-TIME-MM             PIC  9(02).               02030000
020400             15  MR-TIME-COLON-2        PIC  X(01).               02040002
020500             15  MR-TIME-SS             PIC  9(02).               02050000
020600         10  MR-CREATORL                PIC S9(04) COMP.          02060000
020700         10  MR-CREATORA                PIC  X(01).               02070000
020800         10  MR-CREATORC                PIC  X(01).               02080000
020900         10  MR-CREATORH                PIC  X(01).               02090000
021000         10  MR-CREATOR                 PIC  X(08).               02100000
021100     EJECT                                                        02110000
021200*---------------------------------------------------------------* 02120000
021300*    VSAM FILE LAYOUT.                                          * 02130000
021400*---------------------------------------------------------------* 02140000
021500                                                                  02150000
021600     COPY DPRD515.                                                02160000
021700*---------------------------------------------------------------* 02170000
021800*    COPYBOOK FOR NUMERIC EDIT ROUTINE.                         * 02180000
021900*---------------------------------------------------------------* 02190000
022000                                                                  02200000
022100     COPY DPWS010I.                                               02210000
022200                                                                  02220000
022210*---------------------------------------------------------------* 02221000
022220*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02222000
022230*---------------------------------------------------------------* 02223000
022240                                                                  02224000
022250     COPY DPWS015.                                                02225000
022260                                                                  02226000
022270*---------------------------------------------------------------* 02227000
022280*    FUNCTION KEYS COPYBOOK.                                    * 02228000
022290*---------------------------------------------------------------* 02229000
022300                                                                  02230000
022400     COPY DPWS016.                                                02240000
022500                                                                  02250000
      *---------------------------------------------------------------* 02270031
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02280031
      *---------------------------------------------------------------* 02290031
                                                                        02300031
           COPY DPWS030.                                                02310031
           COPY DPWS930.                                                02311031
023200                                                                  02320031
023300*---------------------------------------------------------------* 02330000
023400*    STANDARD COMMAREA.                                         * 02340000
023500*---------------------------------------------------------------* 02350000
023600                                                                  02360000
023700     COPY DPWS020.                                                02370000
023800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02380000
023900                                                                  02390000
024000*---------------------------------------------------------------* 02400000
024100* INTER-APPLICATION COMMAREA.                                   * 02410000
024200*---------------------------------------------------------------* 02420000
024300                                                                  02430000
024400         10  INTER-APPL-COMM-AREA       PIC X(200).               02440000
024500*---------------------------------------------------------------* 02450000
024600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02460000
024700*---------------------------------------------------------------* 02470000
024800         10  ASC-SPECIFIC-COMMAREA.                               02480000
024900***          15  ASC-LIST-KEYS.                                   02490004
025000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02500000
025100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02510000
025200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02520000
025300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02530000
025400                                                                  02540000
025500                 20  ASC-ITEM-ARRAY.                              02550000
025600                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02560000
025700                         30  ASC-LIST-ITEM-NUMBER                 02570000
025800                                                     PIC S9(09)   02580000
025900                                                     COMP-3.      02590000
026000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02600000
026100                             88  ASC-VALID-SELECT    VALUE ' '    02610000
026200                                                           'S'    02620000
026300                                                           'B'    02630000
026400                                                           'E'.   02640000
026500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02650000
026600                             88  ASC-TEMP-SELECT     VALUE 'S'.   02660000
026700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02670000
026800                             88  ASC-TEMP-END        VALUE 'E'.   02680000
026900                         30  ASC-SELECTED-SW         PIC  X(01).  02690000
027000                             88  ASC-NO-SELECT       VALUE ' '.   02700000
027100                             88  ASC-SELECT          VALUE 'S'.   02710000
027200                             88  ASC-BEGIN           VALUE 'B'.   02720000
027300                             88  ASC-END             VALUE 'E'.   02730000
027400                         30  ASC-ACTION              PIC  X(03).  02740000
027500                         30  ASC-STATUS              PIC  X(09).  02750000
027510                             88  ASC-STATUS-FND      VALUE        02751026
027520                                                     'ATTACHED'.  02752027
027530                             88  ASC-STATUS-NOT-FND  VALUE        02753026
027540                                                     'NOT FOUND'. 02754026
027600                         30  ASC-NETNAME             PIC  X(08).  02760000
027700                         30  ASC-TASK-NUM            PIC  9(07).  02770000
027800                         30  ASC-JUL-DATE            PIC  9(05).  02780003
027900                         30  ASC-TIME.                            02790004
027910                             35  ASC-TIME-HH         PIC  9(02).  02791004
027911                             35  ASC-TIME-COLON-1    PIC  X(01).  02791112
027920                             35  ASC-TIME-MM         PIC  9(02).  02792004
027921                             35  ASC-TIME-COLON-2    PIC  X(01).  02792112
027930                             35  ASC-TIME-SS         PIC  9(02).  02793004
028000                         30  ASC-CREATOR             PIC  X(08).  02800000
028100                                                                  02810000
028200             15  ASC-BLK-SUB                         PIC S9(04)   02820000
028300                                                          COMP    02830000
028400                                                          SYNC.   02840000
028500             15  ASC-ITEM-SUB                        PIC S9(04)   02850000
028600                                                          COMP    02860000
028700                                                          SYNC.   02870000
028800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02880000
028900                                                          COMP-3. 02890000
029000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02900000
029100                                                          COMP-3. 02910000
029200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02920000
029300                                                          COMP-3. 02930000
029400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02940000
029500                                                          COMP-3. 02950000
029600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02960000
029700                                                          COMP-3. 02970000
029800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02980000
029900                                                          COMP    02990000
030000                                                          SYNC.   03000000
030100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03010000
030200                                                          COMP-3. 03020000
030300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03030000
030400                                                          COMP-3. 03040000
030500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03050000
030600                 88  ASC-ITEMS-LEFT-ON-FILE          VALUE 'Y'.   03060001
030700                 88  ASC-NO-ITEMS-LEFT-ON-FILE       VALUE 'N'.   03070001
030800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03080000
030900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03090000
031000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03100000
031100             15  ASC-LIST-QUEUE-NAME.                             03110000
031200                 20  ASC-LIST-TERM-ID                PIC  X(04).  03120000
031300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03130000
031400                                                          COMP-3. 03140000
031500                 20  ASC-LIST-SEQ                    PIC  9(01).  03150000
031600             15  ASC-SEL-QUEUE-NAME.                              03160000
031700                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03170000
031800                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03180000
031900                                                          COMP-3. 03190000
032000                 20  ASC-SEL-SEQ                     PIC  9(01).  03200000
032100                                                                  03210000
032200             15  ASC-START-ITEM-REQUEST.                          03220000
032300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03230000
032400     EJECT                                                        03240000
032500*---------------------------------------------------------------* 03250000
032600*    ABEND PROCESSING COPYBOOK.                                 * 03260000
032700*---------------------------------------------------------------* 03270000
032800                                                                  03280000
032900     COPY DPWS013.                                                03290000
033000                                                                  03300000
033100 EJECT                                                            03310000
033200 LINKAGE SECTION.                                                 03320000
033300                                                                  03330000
033400 01  DFHCOMMAREA.                                                 03340000
033500     05  FILLER                         OCCURS  1 TO 4072 TIMES   03350000
033600                                        DEPENDING ON EIBCALEN.    03360000
033700         10  FILLER                     PIC X.                    03370000
033800                                                                  03380000
033900 EJECT                                                            03390000
034000 PROCEDURE DIVISION.                                              03400000
034100******************************************************************03410000
034200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **03420000
034300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **03430000
034400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **03440000
034500******************************************************************03450000
034600 0000-MAIN-MODULE.                                                03460000
034700     INITIALIZE DP030-CICS-API-FIELDS.                            03470000
034800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03480000
034900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03490000
035000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03500000
035100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03510000
035200     MOVE LENGTH OF DP046AI        TO DP030-MAP-LENGTH (1).       03520000
035300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03530000
035400     PERFORM 0001-CALL-CICS-ARCH-API.                             03540000
035500*                                                                 03550000
035600     PERFORM 1000-CONTROL-PROCESSING                              03560000
035700*                                                                 03570000
035800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03580000
035900     PERFORM 0001-CALL-CICS-ARCH-API.                             03590000
036000                                                                  03600000
036100******************************************************************03610000
036200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03620000
036300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **03630000
036400******************************************************************03640000
036500 0001-CALL-CICS-ARCH-API.                                         03650000
036600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03660033
036700                                    DFHCOMMAREA                   03670033
036800                                    DP030-CICS-API-FIELDS         03680033
036900                                    DP020-STANDARD-COMMAREA       03690033
037000                                    DP046AI.                      03700033
037100*                                                                 03710000
037200     IF  DP030-RC-CALL-SUCCESSFUL                                 03720000
037300         CONTINUE                                                 03730000
037400     ELSE                                                         03740000
037500         SET DP013-NO-ROLLBACK                                    03750000
037600             DP013-XCTL-DISPLAY-RESTART                           03760000
037700             DP013-CICS-ABEND      TO TRUE                        03770000
037800         MOVE '0001-CALL-CICS-ARCH-API'                           03780000
037900                                   TO DP013-PARAGRAPH             03790000
038000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03800034
038100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03810034
038200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03820000
038300         PERFORM DP013-0000-PROCESS-ABEND                         03830000
038400     END-IF.                                                      03840000
038500*----------------------------------------------------------------*03850000
038600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03860000
038700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03870000
038800*                                                                *03880000
038900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03890000
039000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03900000
039100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03910000
039200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03920000
039300*----------------------------------------------------------------*03930000
039400                                                                  03940000
039500 1000-CONTROL-PROCESSING.                                         03950000
039600                                                                  03960000
039700     EVALUATE TRUE                                                03970000
039800         WHEN DP020-NEXT-ACT-INITIAL                              03980000
039900             INITIALIZE ASC-SPECIFIC-COMMAREA                     03990000
040000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04000000
040100                                      ASC-SEL-TERM-ID             04010000
040200             MOVE DP020-SRC-TASK-NUMBER                           04020000
040300                                   TO ASC-LIST-TASK-NUMBER        04030000
040400                                      ASC-SEL-TASK-NUMBER         04040000
040500             MOVE PC-LIST-QUEUE-SEQ                               04050000
040600                                   TO ASC-LIST-SEQ                04060000
040700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04070000
040800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04080000
040900***-----$TEMPLATE NOTE$-------------------------------------------04090000
041000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04100000
041100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04110000
041200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04120000
041300***---------------------------------------------------------------04130000
041400             IF  PS-COMMAREA-NOT-VALID                            04140000
041500***              MOVE PC-TSYMSG-99901                             04150000
041600***                                TO DP020-MSG-NUMBER            04160000
041700***              SET DP020-MSG-FATAL                              04170000
041800***                                TO TRUE                        04180000
041900                 SET DP020-NEXT-ACT-APPL-ERROR                    04190000
042000                                   TO TRUE                        04200000
042100             ELSE                                                 04210000
042200                 PERFORM 4000-BUILD-INITIAL-PANEL                 04220000
042300             END-IF                                               04230000
042400                                                                  04240000
042500         WHEN DP020-NEXT-ACT-READ-MAP                             04250000
042600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04260000
042700                                   TO PV-TOP-ITEM                 04270000
042800             PERFORM 2000-PROCESS-PANEL                           04280000
042900                                                                  04290000
043000         WHEN DP020-NEXT-ACT-RETURN                               04300000
043100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04310000
043200                                   TO PV-TOP-ITEM                 04320000
043300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04330000
043400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04340000
043500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04350000
043600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04360000
043700                                                                  04370000
043800         WHEN OTHER                                               04380000
043900             SET DP013-LOGIC-ABEND TO TRUE                        04390000
044000             SET DP013-NO-ROLLBACK TO TRUE                        04400000
044100             MOVE '1000-CONTROL-PROCESSING'                       04410000
044200                                   TO DP013-PARAGRAPH             04420000
044300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04430000
044400                                   TO DP013-MESSAGE-TEXT(1)       04440000
044500             PERFORM DP013-0000-PROCESS-ABEND                     04450000
044600     END-EVALUATE.                                                04460000
044700                                                                  04470000
044800 EJECT                                                            04480000
044900*----------------------------------------------------------------*04490000
045000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04500000
045100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04510000
045200*----------------------------------------------------------------*04520000
045300                                                                  04530000
045400 1100-PROCESS-INTER-APPL-COMM.                                    04540000
045500                                                                  04550000
045600     SET PS-COMMAREA-VALID         TO TRUE.                       04560000
045700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04570000
045800*    IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          04580000
045900*  MOVE FROM INTER-APPL COMMAREA                                  04590000
046000*    ELSE                                                         04600000
046100*        IF  DP020-NAV-KEY-DATA > SPACE                           04610000
046200*  USE DATA IN  DP020-NAV-KEY-DATA                                04620000
046300*            MOVE DP020-NAV-KEY-DATA                              04630000
046400*                                  TO DK-MESSAGE-TEXT             04640000
046500*                                     ASC-KEY-MESSAGE-TEXT        04650000
046600*        END-IF                                                   04660000
046700*    END-IF.                                                      04670000
046800                                                                  04680000
046900 EJECT                                                            04690000
047000*----------------------------------------------------------------*04700000
047100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04710000
047200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04720000
047300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04730000
047400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04740000
047500* FUNCTION KEYS CAN GET THIS FAR.                                *04750000
047600*----------------------------------------------------------------*04760000
047700                                                                  04770000
047800 2000-PROCESS-PANEL.                                              04780000
047900     EVALUATE TRUE                                                04790000
048000         WHEN DP020-SRC-AID = DP016-CLEAR                         04800000
048100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04810000
048200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04820000
048300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04830000
048400                                                                  04840000
048500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04850000
048600             PERFORM 2050-DELETE-LIST-QUEUE                       04860000
048700             PERFORM 4000-BUILD-INITIAL-PANEL                     04870000
048800                                                                  04880000
048900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    04890000
049000             PERFORM 2140-DESELECT-ALL-ITEMS                      04900000
049100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04910000
049200                                                                  04920000
049300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  04930000
049400             PERFORM 2150-SELECT-ALL-ITEMS                        04940000
049500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04950000
049600                                                                  04960000
049700         WHEN OTHER                                               04970000
049800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04980000
049900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04990000
050000             IF  PS-NO-ERROR                                      05000000
050100                 SET DP030-CONTINUE-GO                            05010000
050200                                 TO TRUE                          05020000
050300                 PERFORM 2100-CHECK-FUNCTION-KEY                  05030000
050400             ELSE                                                 05040000
050500                 SET DP030-OVERRIDE-GO                            05050000
050600                                 TO TRUE                          05060000
050700             END-IF                                               05070000
050800     END-EVALUATE.                                                05080000
050900 EJECT                                                            05090000
051000*----------------------------------------------------------------*05100000
051100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05110000
051200*----------------------------------------------------------------*05120000
051300 2050-DELETE-LIST-QUEUE.                                          05130000
051400                                                                  05140000
051500     EXEC CICS                                                    05150000
051600         DELETEQ TS                                               05160000
051700             QUEUE (ASC-LIST-QUEUE-NAME)                          05170000
051800             RESP  (PV-CICS-RESP)                                 05180000
051900     END-EXEC.                                                    05190000
052000                                                                  05200000
052100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05210000
052200        (PV-CICS-RESP = DFHRESP(QIDERR))                          05220000
052300         CONTINUE                                                 05230000
052400     ELSE                                                         05240000
052500         SET DP013-CICS-ABEND      TO TRUE                        05250000
052600         SET DP013-NO-ROLLBACK     TO TRUE                        05260000
052700                                                                  05270000
052800         MOVE '2050-DELETE-LIST-QUEUE'                            05280000
052900                                   TO DP013-PARAGRAPH             05290000
053000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05300000
053100                                   TO DP013-MESSAGE-TEXT (1)      05310000
053200         PERFORM DP013-0000-PROCESS-ABEND                         05320000
053300     END-IF.                                                      05330000
053400                                                                  05340000
053500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05350000
053600 EJECT                                                            05360000
053700*----------------------------------------------------------------*05370000
053800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05380000
053900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05390000
054000* CICS ARCHITECTURE API.                                         *05400000
054100*----------------------------------------------------------------*05410000
054200 2100-CHECK-FUNCTION-KEY.                                         05420000
054300     EVALUATE TRUE                                                05430000
054400         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  05440000
054500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              05450000
054600*                INITIALIZE DP056-INTER-APPL-COMMAREA             05460000
054700*                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05470000
054800*                               TO DP056-NUMBER-OF-SELECTED-ITEMS 05480000
054900                 PERFORM 5000-PREPARE-SEL-QUEUE                   05490000
055000             ELSE                                                 05500000
055100                 SET DP030-OVERRIDE-GO                            05510000
055200                                   TO TRUE                        05520000
055300                 MOVE PC-TSYMSG-00057                             05530000
055400                                   TO DP020-MSG-NUMBER            05540000
055500                 SET DP020-MSG-WARNING                            05550000
055600                                   TO TRUE                        05560000
055700             END-IF                                               05570000
055800                                                                  05580000
055900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05590000
056000             MOVE +1               TO PV-TOP-ITEM                 05600000
056100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05610000
056200                                                                  05620000
056300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05630000
056400             PERFORM 2110-BROWSE-BACKWARD                         05640000
056500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05650000
056600                                                                  05660000
056700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05670000
056800             PERFORM 2120-BROWSE-FORWARD                          05680000
056900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05690000
057000                                                                  05700000
057100         WHEN DP020-SRC-AID = DP016-ENTER                         05710000
057200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05720000
057300             IF  PS-ERROR                                         05730000
057400                 CONTINUE                                         05740000
057500             ELSE                                                 05750000
057600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05760000
057700             END-IF                                               05770000
057800                                                                  05780000
057900         WHEN OTHER                                               05790000
058000             SET DP013-NO-ROLLBACK                                05800000
058100                 DP013-XCTL-DISPLAY-RESTART                       05810000
058200                 DP013-CICS-ABEND  TO TRUE                        05820000
058300             MOVE '2100-CHECK-FUNCTION-KEY'                       05830000
058400                                   TO DP013-PARAGRAPH             05840000
058500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05850000
058600                                   TO DP013-MESSAGE-TEXT (1)      05860000
058700             PERFORM DP013-0000-PROCESS-ABEND                     05870000
058800     END-EVALUATE.                                                05880000
058900*                                                                 05890000
059000*----------------------------------------------------------------*05900000
059100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *05910000
059200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *05920000
059300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *05930000
059400*    MESSAGE.                                                    *05940000
059500*----------------------------------------------------------------*05950000
059600                                                                  05960000
059700 2110-BROWSE-BACKWARD.                                            05970000
059800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    05980000
059900         GIVING PV-TOP-ITEM.                                      05990000
060000*                                                                 06000000
060100     IF  ((PV-TOP-ITEM < +1)                                      06010000
060200       OR (PV-TOP-ITEM = +1))                                     06020000
060300         MOVE +1                   TO PV-TOP-ITEM                 06030000
060400*        -- TOP OF LIST --                                        06040000
060500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06050000
060600         SET DP020-MSG-INFORMATIONAL TO TRUE                      06060000
060700     END-IF.                                                      06070000
060800                                                                  06080000
060900 EJECT                                                            06090000
061000*----------------------------------------------------------------*06100000
061100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06110000
061200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06120000
061300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06130000
061400*----------------------------------------------------------------*06140000
061500                                                                  06150000
061600 2120-BROWSE-FORWARD.                                             06160000
061700                                                                  06170000
061800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06180000
061900         GIVING PV-TOP-ITEM.                                      06190000
062000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06200000
062100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06210000
062200                                   TO PV-TOP-ITEM                 06220000
062300*        -- BOTTOM OF LIST --                                     06230000
062400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06240000
062500         SET DP020-MSG-INFORMATIONAL                              06250000
062600                                   TO TRUE                        06260000
062700     ELSE                                                         06270000
062800         COMPUTE PV-BOTTOM-ITEM =                                 06280000
062900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06290000
063000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06300000
063100*            -- BOTTOM OF LIST --                                 06310000
063200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06320000
063300             SET DP020-MSG-INFORMATIONAL                          06330000
063400                                   TO TRUE                        06340000
063500         END-IF                                                   06350000
063600     END-IF.                                                      06360000
063700 EJECT                                                            06370000
063800*----------------------------------------------------------------*06380000
063900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06390000
064000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06400000
064100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06410000
064200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06420000
064300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06430000
064400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06440000
064500*----------------------------------------------------------------*06450000
064600                                                                  06460000
064700 2130-CHECK-FOR-JUMP-BROWSE.                                      06470000
064800     SET PS-NO-ERROR               TO TRUE.                       06480000
064900     IF (ASC-START-ITEM-REQUEST = SPACE)                          06490000
065000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06500000
065100                                   TO PV-TOP-ITEM                 06510000
065200     ELSE                                                         06520000
065300         MOVE ASC-START-ITEM-REQUEST                              06530000
065400                                   TO DP010I-UNEDITED-FIELD       06540000
065500         MOVE PC-LIST-NUM-LENGTH   TO DP010I-MAXIMUM-DIGITS       06550003
065600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06560000
065700         SET DP010I-NEGATIVE-NOT-ALLOWED                          06570000
065800                                   TO TRUE                        06580000
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06591030
262023              USING DP010I-NUMERIC-EDIT-AREA                      06592030
066000                                                                  06600000
066100         IF  NOT DP010I-ERROR-DETECTED                            06610000
066200             MOVE DP010I-NUMERIC-FIELD                            06620000
066300                                   TO  ASC-START-ITEM-REQUEST-N   06630000
066400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06640000
066500                 IF  ASC-START-ITEM-REQUEST-N >                   06650000
066600                                          ASC-NUMBER-OF-ITEMS-READ06660000
066700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06670000
066800                     COMPUTE PV-TOP-ITEM =                        06680000
066900                             ASC-NUMBER-OF-ITEMS-READ             06690000
067000                             - PC-ITEMS-PER-PANEL + 1             06700000
067100                     IF  PV-TOP-ITEM < +1                         06710000
067200                         MOVE +1   TO PV-TOP-ITEM                 06720000
067300                         MOVE PC-TSYMSG-00070                     06730000
067400                                   TO DP020-MSG-NUMBER            06740000
067500                         SET DP020-MSG-INFORMATIONAL              06750000
067600                                   TO TRUE                        06760000
067700                     END-IF                                       06770000
067800                 ELSE                                             06780000
067900                     MOVE ASC-START-ITEM-REQUEST-N                06790000
068000                                   TO PV-TOP-ITEM                 06800000
068100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06810000
068200                     COMPUTE PV-BOTTOM-ITEM =                     06820000
068300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06830000
068400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06840000
068500*                        -- BOTTOM OF LIST --                     06850000
068600                         MOVE PC-TSYMSG-00070                     06860000
068700                                   TO DP020-MSG-NUMBER            06870000
068800                         SET DP020-MSG-INFORMATIONAL              06880000
068900                                   TO TRUE                        06890000
069000                     END-IF                                       06900000
069100                 END-IF                                           06910000
069200             ELSE                                                 06920000
069300*                --- VALUE OUT OF RANGE ----                      06930000
069400                 MOVE PC-TSYMSG-00101                             06940000
069500                                   TO DP020-MSG-NUMBER            06950000
069600                 MOVE -1           TO ASTRTITL                    06960000
069700                 SET DP030-SET-CURSOR-APPL-1                      06970000
069800                                   TO TRUE                        06980000
069900                 MOVE DP015-REVERSE                               06990000
070000                                   TO ASTRTITH                    07000000
070100                 MOVE DP015-RED    TO ASTRTITC                    07010000
070200                 MOVE DP015-UNP-NUM-BRT-MDT                       07020000
070300                                   TO ASTRTITA                    07030000
070400                 SET DP020-MSG-FATAL                              07040000
070500                                   TO TRUE                        07050000
070600                 SET PS-ERROR      TO TRUE                        07060000
070700             END-IF                                               07070000
070800                                                                  07080000
070900         ELSE                                                     07090000
071000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07100000
071100             MOVE -1               TO ASTRTITL                    07110000
071200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07120000
071300             MOVE DP015-REVERSE    TO ASTRTITH                    07130000
071400             MOVE DP015-RED        TO ASTRTITC                    07140000
071500             MOVE DP015-UNP-NUM-BRT-MDT                           07150000
071600                                   TO ASTRTITA                    07160000
071700             SET DP020-MSG-FATAL   TO TRUE                        07170000
071800             SET PS-ERROR          TO TRUE                        07180000
071900         END-IF                                                   07190000
072000     END-IF.                                                      07200000
072100 EJECT                                                            07210000
072200*----------------------------------------------------------------*07220000
072300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07230000
072400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07240000
072500*----------------------------------------------------------------*07250000
072600 2140-DESELECT-ALL-ITEMS.                                         07260000
072700     MOVE +1                       TO ASC-BLK-SUB.                07270000
072800                                                                  07280000
072900     PERFORM 2141-CLEAR-SELECTED-INDS                             07290000
073000         VARYING ASC-ITEM-SUB                                     07300000
073100         FROM 1 BY 1                                              07310000
073200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07320000
073300                                                                  07330000
073400     ADD +1                        TO ASC-BLK-SUB.                07340000
073500                                                                  07350000
073600     PERFORM 2141-CLEAR-SELECTED-INDS                             07360000
073700         VARYING ASC-ITEM-SUB                                     07370000
073800         FROM 1 BY 1                                              07380000
073900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07390000
074000                                                                  07400000
074100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07410000
074200                                   TO PV-LIST-ITEM-NUMBER.        07420000
074300                                                                  07430000
074400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07440000
074500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07450000
074600                                                                  07460000
074700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07470000
074800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07480000
074900         MOVE +1                   TO ASC-BLK-SUB                 07490000
075000                                                                  07500000
075100         PERFORM 5100-WRITE-TEMP-STORAGE                          07510000
075200                                                                  07520000
075300         MOVE +1                   TO PV-BLOCK-NUMBER             07530000
075400                                                                  07540000
075500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07550000
075600             PV-FIRST-BLOCK-IN-ARRAY - 1                          07560000
075700                                                                  07570000
075800         PERFORM                                                  07580000
075900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07590000
076000                                                                  07600000
076100             PERFORM 4410-READ-TEMP-STORAGE                       07610000
076200                                                                  07620000
076300             PERFORM 2141-CLEAR-SELECTED-INDS                     07630000
076400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07640000
076500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07650000
076600                                                                  07660000
076700             PERFORM 5100-WRITE-TEMP-STORAGE                      07670000
076800                                                                  07680000
076900             ADD +1                TO PV-BLOCK-NUMBER             07690000
077000                                                                  07700000
077100         END-PERFORM                                              07710000
077200                                                                  07720000
077300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07730000
077400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07740000
077500                                                                  07750000
077600         PERFORM                                                  07760000
077700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07770000
077800                   ASC-HIGHEST-BLOCK-WRITTEN                      07780000
077900                                                                  07790000
078000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          07800000
078100                                   TO PV-BLOCK-NUMBER             07810000
078200                                                                  07820000
078300             PERFORM 4410-READ-TEMP-STORAGE                       07830000
078400                                                                  07840000
078500             PERFORM 2141-CLEAR-SELECTED-INDS                     07850000
078600                 VARYING ASC-ITEM-SUB                             07860000
078700                 FROM 1 BY 1                                      07870000
078800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07880000
078900                                                                  07890000
079000             PERFORM 5100-WRITE-TEMP-STORAGE                      07900000
079100                                                                  07910000
079200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      07920000
079300                                                                  07930000
079400         END-PERFORM                                              07940000
079500                                                                  07950000
079600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             07960000
079700                                   TO PV-BLOCK-NUMBER             07970000
079800                                                                  07980000
079900         PERFORM 4410-READ-TEMP-STORAGE                           07990000
080000     END-IF.                                                      08000000
080100                                                                  08010000
080200                                                                  08020000
080300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08030000
080400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08040000
080500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08050000
080600                                                                  08060000
080700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08070000
080800                                                                  08080000
080900 EJECT                                                            08090000
081000*----------------------------------------------------------------*08100000
081100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08110000
081200*----------------------------------------------------------------*08120000
081300                                                                  08130000
081400 2141-CLEAR-SELECTED-INDS.                                        08140000
081500                                                                  08150000
081600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08160000
081700             NOT EQUAL ZERO                                       08170000
081800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08180000
081900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08190000
082000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08200000
082100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08210000
082200                                   TO TRUE                        08220000
082300         END-IF                                                   08230000
082400     END-IF.                                                      08240000
082500                                                                  08250000
082600 EJECT                                                            08260000
082700*----------------------------------------------------------------*08270000
082800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08280000
082900*  FOR ALL ITEMS.                                                *08290000
083000*----------------------------------------------------------------*08300000
083100                                                                  08310000
083200 2150-SELECT-ALL-ITEMS.                                           08320000
083300                                                                  08330000
083400     MOVE +1                       TO ASC-BLK-SUB.                08340000
083500                                                                  08350000
083600     PERFORM 2151-SET-SELECTED-INDS                               08360000
083700         VARYING ASC-ITEM-SUB                                     08370000
083800         FROM 1 BY 1                                              08380000
083900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08390000
084000                                                                  08400000
084100     ADD +1                        TO ASC-BLK-SUB.                08410000
084200                                                                  08420000
084300     PERFORM 2151-SET-SELECTED-INDS                               08430000
084400         VARYING ASC-ITEM-SUB                                     08440000
084500         FROM 1 BY 1                                              08450000
084600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08460000
084700                                                                  08470000
084800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08480000
084900                                   TO PV-LIST-ITEM-NUMBER.        08490000
085000                                                                  08500000
085100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08510000
085200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08520000
085300                                                                  08530000
085400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08540000
085500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08550000
085600         MOVE +1                   TO ASC-BLK-SUB                 08560000
085700                                                                  08570000
085800         PERFORM 5100-WRITE-TEMP-STORAGE                          08580000
085900                                                                  08590000
086000         MOVE +1                   TO PV-BLOCK-NUMBER             08600000
086100                                                                  08610000
086200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08620000
086300             PV-FIRST-BLOCK-IN-ARRAY - 1                          08630000
086400                                                                  08640000
086500         PERFORM                                                  08650000
086600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08660000
086700                                                                  08670000
086800             PERFORM 4410-READ-TEMP-STORAGE                       08680000
086900                                                                  08690000
087000             PERFORM 2151-SET-SELECTED-INDS                       08700000
087100                 VARYING ASC-ITEM-SUB                             08710000
087200                 FROM 1 BY 1                                      08720000
087300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08730000
087400                                                                  08740000
087500             PERFORM 5100-WRITE-TEMP-STORAGE                      08750000
087600                                                                  08760000
087700             ADD +1                TO PV-BLOCK-NUMBER             08770000
087800                                                                  08780000
087900         END-PERFORM                                              08790000
088000                                                                  08800000
088100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08810000
088200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08820000
088300                                                                  08830000
088400         PERFORM                                                  08840000
088500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08850000
088600                   ASC-HIGHEST-BLOCK-WRITTEN                      08860000
088700                                                                  08870000
088800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08880000
088900                                   TO PV-BLOCK-NUMBER             08890000
089000                                                                  08900000
089100             PERFORM 4410-READ-TEMP-STORAGE                       08910000
089200                                                                  08920000
089300             PERFORM 2151-SET-SELECTED-INDS                       08930000
089400                 VARYING ASC-ITEM-SUB                             08940000
089500                 FROM 1 BY 1                                      08950000
089600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08960000
089700                                                                  08970000
089800             PERFORM 5100-WRITE-TEMP-STORAGE                      08980000
089900                                                                  08990000
090000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09000000
090100                                                                  09010000
090200         END-PERFORM                                              09020000
090300                                                                  09030000
090400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09040000
090500                                   TO PV-BLOCK-NUMBER             09050000
090600                                                                  09060000
090700         PERFORM 4410-READ-TEMP-STORAGE                           09070000
090800     END-IF.                                                      09080000
090900                                                                  09090000
091000                                                                  09100000
091400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09140000
091500                                                                  09150000
091600 EJECT                                                            09160000
091700*----------------------------------------------------------------*09170000
091800*    MARK EACH ITEM AS BEING SELECTED.                           *09180000
091900*----------------------------------------------------------------*09190000
092000                                                                  09200000
092100 2151-SET-SELECTED-INDS.                                          09210000
092200                                                                  09220000
092300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09230000
092400             NOT EQUAL ZERO                                       09240000
092500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09250000
092510             IF  ASC-STATUS-NOT-FND                               09251026
092520                           (ASC-BLK-SUB ASC-ITEM-SUB)             09252026
092540                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    09254028
092550                                                                  09255028
092600                 SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)         09260026
092700                     ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)    09270026
092800                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              09280026
092900                               TO  TRUE                           09290000
093000             END-IF                                               09300026
093010         END-IF                                                   09301026
093100     END-IF.                                                      09310000
093200******************************************************************09320000
093300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09330000
093400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09340000
093500******************************************************************09350000
093600 2200-MOVE-SCREEN-TO-COMMAREA.                                    09360000
093700                                                                  09370000
093800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09380000
093900     MOVE +1                       TO PV-SUB.                     09390000
094000*                                                                 09400000
094100     PERFORM 3100-SET-SUBSCRIPTS.                                 09410000
094200     IF  ASTRTITL > ZERO                                          09420000
094300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09430000
094400     ELSE                                                         09440000
094500         IF  ASTRTITF = DP015-ERASE-EOF                           09450000
094600             INITIALIZE ASC-START-ITEM-REQUEST                    09460000
094700         END-IF                                                   09470000
094800     END-IF.                                                      09480000
094900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09490000
095000         VARYING PV-SUB                                           09500000
095100         FROM 1 BY 1                                              09510000
095200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09520000
095300******************************************************************09530000
095400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09540000
095500******************************************************************09550000
095600 2210-MOVE-LINES-TO-COMMAREA.                                     09560000
095700     IF  MR-SELECTL (PV-SUB) > ZERO                               09570000
095800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09580000
095900         MOVE MR-SELECTI (PV-SUB)                                 09590000
096000                                   TO ASC-TEMP-SELECTED-SW        09600000
096100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09610000
096200     ELSE                                                         09620000
096300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09630000
096400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09640000
096500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09650000
096600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09660000
096700         END-IF                                                   09670000
096800     END-IF.                                                      09680000
096900     ADD +1                        TO ASC-ITEM-SUB.               09690000
097000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09700000
097100         ADD +1                    TO ASC-BLK-SUB                 09710000
097200         MOVE +1                   TO ASC-ITEM-SUB                09720000
097300     END-IF.                                                      09730000
097400******************************************************************09740000
097500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **09750000
097600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09760000
097700******************************************************************09770000
097800 3000-EDIT-DATA-IN-COMMAREA.                                      09780000
097900     SET PS-NO-ERROR               TO TRUE.                       09790000
098000     PERFORM 3200-RESET-ATTRIBUTES.                               09800000
098100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09810000
098200**                                                                09820000
098300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              09830000
098400* EDITTING IS DONE FROM THE BOTTOM UP.                            09840000
098500**                                                                09850000
098600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09860000
098700         ASC-ITEMS-DISPLAYED - 1.                                 09870000
098800     PERFORM 3100-SET-SUBSCRIPTS.                                 09880000
098900     PERFORM 3300-EDIT-SELECTIONS                                 09890000
099000         VARYING PV-SUB                                           09900000
099100         FROM PV-SUB BY -1                                        09910000
099200         UNTIL PV-SUB < +1                                        09920000
099300*                                                                 09930000
099400     IF  PS-NO-ERROR                                              09940000
099500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        09950000
099600     END-IF.                                                      09960000
099700*                                                                 09970000
099800     IF  ((PS-NO-ERROR)                                           09980000
099900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   09990000
100000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10000000
100100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10010000
100200     END-IF.                                                      10020000
100300 EJECT                                                            10030000
100400*----------------------------------------------------------------*10040000
100500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10050000
100600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10060000
100700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10070000
100800*                                                                *10080000
100900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10090000
101000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10100000
101100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10110000
101200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10120000
101300*----------------------------------------------------------------*10130000
101400                                                                  10140000
101500 3100-SET-SUBSCRIPTS.                                             10150000
101600                                                                  10160000
101700     COMPUTE ASC-ITEM-SUB =                                       10170000
101800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10180000
101900                                                                  10190000
102000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10200000
102100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10210000
102200                                                                  10220000
102300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10230000
102400     ELSE                                                         10240000
102500         MOVE +1                     TO ASC-BLK-SUB               10250000
102600     END-IF.                                                      10260000
102700******************************************************************10270000
102800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **10280000
102900******************************************************************10290000
103000                                                                  10300000
103100 3200-RESET-ATTRIBUTES.                                           10310000
103200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10320000
103300     MOVE DP015-GREEN              TO ASTRTITC.                   10330000
103400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10340000
103500*                                                                 10350000
103600     PERFORM                                                      10360000
103700         VARYING PV-SUB                                           10370000
103800         FROM 1 BY 1                                              10380000
103900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        10390000
104000         MOVE DP015-UNP-ALP-NOR-OFF                               10400000
104100                                   TO MR-SELECTA (PV-SUB)         10410000
104200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         10420000
104300         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         10430000
104400     END-PERFORM.                                                 10440000
104500******************************************************************10450000
104600** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **10460000
104700** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **10470000
104800** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **10480000
104900** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **10490000
105000******************************************************************10500000
105100 3300-EDIT-SELECTIONS.                                            10510000
105200     EVALUATE TRUE                                                10520000
105300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10530000
105400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         10540000
105500                 CONTINUE                                         10550000
105600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         10560000
105700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        10570000
105800                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   10580000
105900                 MOVE ASC-TEMP-SELECTED-SW                        10590000
106000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10600000
106100                                TO ASC-SELECTED-SW                10610000
106200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10620000
106300             END-IF                                               10630000
106400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10640000
106500                 = SPACE                                          10650000
106600             EVALUATE TRUE                                        10660000
106700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       10670000
106800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS10680000
106900                     MOVE SPACE TO ASC-SELECTED-SW                10690000
107000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10700000
107100                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        10710000
107200                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    10720000
107300                     MOVE SPACE TO ASC-SELECTED-SW                10730000
107400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10740000
107500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          10750000
107600                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      10760000
107700                     MOVE SPACE TO ASC-SELECTED-SW                10770000
107800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10780000
107900             END-EVALUATE                                         10790000
108000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           10800000
108100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10810000
108200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10820000
108300             END-IF                                               10830000
108400             PERFORM 3310-EDIT-RANGE                              10840000
108500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             10850000
108600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10860000
108700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10870000
108800             END-IF                                               10880000
108900             PERFORM 3310-EDIT-RANGE                              10890000
109000         WHEN OTHER                                               10900000
109100             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           10910000
109200             SET DP020-MSG-FATAL    TO TRUE                       10920000
109300             MOVE -1                TO MR-SELECTL (PV-SUB)        10930000
109400             SET DP030-SET-CURSOR-APPL-1                          10940000
109500                                    TO TRUE                       10950000
109600             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        10960000
109700             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        10970000
109800             SET PS-ERROR TO TRUE                                 10980000
109900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10990000
110000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     11000000
110100                 MOVE SPACE         TO ASC-SELECTED-SW            11010000
110200                                        (ASC-BLK-SUB ASC-ITEM-SUB)11020000
110300             END-IF                                               11030000
110400     END-EVALUATE.                                                11040000
110500                                                                  11050000
110600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11060000
110700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11070000
110800     IF  ASC-ITEM-SUB < 1                                         11080000
110900         SUBTRACT +1 FROM ASC-BLK-SUB                             11090000
111000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11100000
111100     END-IF.                                                      11110000
111200******************************************************************11120000
111300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **11130000
111400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **11140000
111500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**11150000
111600** THE ENDING.                                                  **11160000
111700******************************************************************11170000
111800 3310-EDIT-RANGE.                                                 11180000
111900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                11190000
112000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   11200000
112100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)11210000
112200                                   TO ASC-SELECTED-SW             11220000
112300                                        (ASC-BLK-SUB ASC-ITEM-SUB)11230000
112400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 11240000
112500         ELSE                                                     11250000
112600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     11260000
112700                 CONTINUE                                         11270000
112800             ELSE                                                 11280000
112900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        11290000
113000                 MOVE PC-TSYMSG-00054                             11300000
113100                                   TO DP020-MSG-NUMBER            11310000
113200                 SET DP020-MSG-FATAL                              11320000
113300                                   TO TRUE                        11330000
113400                 MOVE -1           TO MR-SELECTL (PV-SUB)         11340000
113500                 SET DP030-SET-CURSOR-APPL-1                      11350000
113600                                   TO TRUE                        11360000
113700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         11370000
113800                 MOVE DP015-UNDERLINE                             11380000
113900                                   TO MR-SELECTH (PV-SUB)         11390000
114000                 SET PS-ERROR      TO TRUE                        11400000
114100             END-IF                                               11410000
114200         END-IF                                                   11420000
114300     ELSE                                                         11430000
114400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     11440000
114500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 11450000
114600                                   TO ASC-SELECTED-SW             11460000
114700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11470000
114800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   11480000
114900         ELSE                                                     11490000
115000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       11500000
115100                 CONTINUE                                         11510000
115200             ELSE                                                 11520000
115300*                -- ONLY ONE END-OF-RANGE ALLOWED --              11530000
115400                 MOVE PC-TSYMSG-00055                             11540000
115500                                   TO DP020-MSG-NUMBER            11550000
115600                 SET DP020-MSG-FATAL                              11560000
115700                                   TO TRUE                        11570000
115800                 MOVE -1           TO MR-SELECTL (PV-SUB)         11580000
115900                 SET DP030-SET-CURSOR-APPL-1                      11590000
116000                                   TO TRUE                        11600000
116100                 SET PS-ERROR      TO TRUE                        11610000
116200             END-IF                                               11620000
116300         END-IF                                                   11630000
116400     END-IF.                                                      11640000
116500*                                                                 11650000
116600******************************************************************11660000
116700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **11670000
116800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **11680000
116900******************************************************************11690000
117000 3400-CHECK-RANGE-SEQUENCE.                                       11700000
117100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       11710000
117200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      11720000
117300       AND  ASC-START-OF-SELECTED-RANGE >                         11730000
117400                                         ASC-END-OF-SELECTED-RANGE11740000
117500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                11750000
117600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 11760000
117700         SET DP020-MSG-FATAL TO TRUE                              11770000
117800         SET PS-ERROR TO TRUE                                     11780000
117900         PERFORM 3410-POSITION-AT-ERROR                           11790000
118000     END-IF.                                                      11800000
118100******************************************************************11810000
118200** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **11820000
118300** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **11830000
118400** SHOULD BE POSITIONED ON A RANGE ERROR.                       **11840000
118500******************************************************************11850000
118600 3410-POSITION-AT-ERROR.                                          11860000
118700     SET DP030-SET-CURSOR-APPL-1                                  11870000
118800                                   TO TRUE.                       11880000
118900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 11890000
119000                    - PV-TOP-ITEM + 1.                            11900000
119100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11910000
119200         CONTINUE                                                 11920000
119300     ELSE                                                         11930000
119400         MOVE -1                   TO MR-SELECTL (PV-SUB)         11940000
119500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         11950000
119600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         11960000
119700     END-IF.                                                      11970000
119800*                                                                 11980000
119900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   11990000
120000                    - PV-TOP-ITEM + 1.                            12000000
120100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12010000
120200         CONTINUE                                                 12020000
120300     ELSE                                                         12030000
120400         MOVE -1                   TO MR-SELECTL (PV-SUB)         12040000
120500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12050000
120600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12060000
120700     END-IF.                                                      12070000
120800 EJECT                                                            12080000
120900*----------------------------------------------------------------*12090000
121000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *12100000
121100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *12110000
121200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *12120000
121300*----------------------------------------------------------------*12130000
121400                                                                  12140000
121500 3500-MARK-RANGE-AS-SELECTED.                                     12150000
121600     MOVE +1                       TO  ASC-BLK-SUB.               12160000
121700     PERFORM 3510-MARK-SELECTED-INDS                              12170000
121800         VARYING ASC-ITEM-SUB                                     12180000
121900         FROM 1 BY 1                                              12190000
122000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12200000
122100                                                                  12210000
122200     ADD +1                        TO ASC-BLK-SUB.                12220000
122300     PERFORM 3510-MARK-SELECTED-INDS                              12230000
122400         VARYING ASC-ITEM-SUB                                     12240000
122500         FROM 1 BY 1                                              12250000
122600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12260000
122700                                                                  12270000
122800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12280000
122900                                   TO  PV-LIST-ITEM-NUMBER.       12290000
123000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12300000
123100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         12310000
123200               PC-ITEMS-PER-PANEL).                               12320000
123300                                                                  12330000
123400     MOVE ASC-START-OF-SELECTED-RANGE                             12340000
123500                                   TO PV-START-OF-SELECTED-RANGE. 12350000
123600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            12360000
123700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  12370000
123800               PC-ITEMS-PER-PANEL).                               12380000
123900                                                                  12390000
124000     MOVE ASC-END-OF-SELECTED-RANGE                               12400000
124100                                   TO  PV-END-OF-SELECTED-RANGE.  12410000
124200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             12420000
124300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    12430000
124400               PC-ITEMS-PER-PANEL).                               12440000
124500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             12450000
124600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             12460000
124700                                                                  12470000
124800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    12480000
124900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        12490000
125000         MOVE +1                   TO ASC-BLK-SUB                 12500000
125100         PERFORM 5100-WRITE-TEMP-STORAGE                          12510000
125200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12520000
125300             PV-FIRST-BLOCK-IN-ARRAY - 1                          12530000
125400                                                                  12540000
125500         PERFORM                                                  12550000
125600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      12560000
125700                   PV-PREV-BLOCK-IN-ARRAY                         12570000
125800             MOVE PV-FIRST-BLOCK-IN-RANGE                         12580000
125900                                   TO PV-BLOCK-NUMBER             12590000
126000             PERFORM 4410-READ-TEMP-STORAGE                       12600000
126100             PERFORM 3510-MARK-SELECTED-INDS                      12610000
126200                 VARYING ASC-ITEM-SUB                             12620000
126300                 FROM 1 BY 1                                      12630000
126400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12640000
126500             PERFORM 5100-WRITE-TEMP-STORAGE                      12650000
126600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     12660000
126700         END-PERFORM                                              12670000
126800                                                                  12680000
126900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12690000
127000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12700000
127100         PERFORM                                                  12710000
127200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12720000
127300                   PV-LAST-BLOCK-IN-RANGE                         12730000
127400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12740000
127500                                   TO PV-BLOCK-NUMBER             12750000
127600             PERFORM 4410-READ-TEMP-STORAGE                       12760000
127700             PERFORM 3510-MARK-SELECTED-INDS                      12770000
127800                 VARYING ASC-ITEM-SUB                             12780000
127900                 FROM 1 BY 1                                      12790000
128000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12800000
128100             PERFORM 5100-WRITE-TEMP-STORAGE                      12810000
128200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12820000
128300         END-PERFORM                                              12830000
128400                                                                  12840000
128500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12850000
128600                                   TO PV-BLOCK-NUMBER             12860000
128700         PERFORM 4410-READ-TEMP-STORAGE                           12870000
128800     END-IF.                                                      12880000
128900                                                                  12890000
129000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 12900000
129100                                      ASC-END-OF-SELECTED-RANGE.  12910000
129200                                                                  12920000
129300 EJECT                                                            12930000
129400*----------------------------------------------------------------*12940000
129500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *12950000
129600*----------------------------------------------------------------*12960000
129700                                                                  12970000
129800 3510-MARK-SELECTED-INDS.                                         12980000
129900                                                                  12990000
130000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13000000
130100                                ASC-ITEM-SUB) >                   13010000
130200         ASC-START-OF-SELECTED-RANGE)                             13020000
130300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13030000
130400                                ASC-ITEM-SUB) =                   13040000
130500         ASC-START-OF-SELECTED-RANGE)                             13050000
130600                                                                  13060000
130700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13070000
130800                                    ASC-ITEM-SUB) <               13080000
130900             ASC-END-OF-SELECTED-RANGE)                           13090000
131000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13100000
131100                                    ASC-ITEM-SUB) =               13110000
131200             ASC-END-OF-SELECTED-RANGE)                           13120000
131300                                                                  13130000
131400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13140000
131500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   13150000
131600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   13160000
131700                               TO TRUE                            13170000
131800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              13180000
131900                               TO TRUE                            13190000
132000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    13200000
132100             END-IF                                               13210000
132200         END-IF                                                   13220000
132300     END-IF.                                                      13230000
132400                                                                  13240000
132500 EJECT                                                            13250000
132600*----------------------------------------------------------------*13260000
132700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *13270000
132800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *13280000
132900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13290000
133000*    DISPLAY THE PANEL TO USER.                                  *13300000
133100*----------------------------------------------------------------*13310000
133200                                                                  13320000
133300 4000-BUILD-INITIAL-PANEL.                                        13330000
133400                                                                  13340000
133500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13350000
133600                                 ASC-BLOCK-ENTRIES (2).           13360000
133700     MOVE +1                 TO ASC-BLK-SUB.                      13370000
133800     SET ASC-ITEMS-LEFT-ON-FILE                                   13380001
133900                             TO TRUE.                             13390000
134000                                                                  13400000
134100     MOVE +0                 TO ASC-ITEM-SUB                      13410000
134200                                ASC-NUMBER-OF-ITEMS-READ          13420000
134300                                ASC-NUMBER-OF-SELECTED-ITEMS      13430000
134400                                ASC-HIGHEST-BLOCK-WRITTEN         13440000
134500                                ASC-START-OF-SELECTED-RANGE       13450000
134600                                ASC-END-OF-SELECTED-RANGE         13460000
134700                                ASC-ITEM-AT-TOP-OF-PANEL.         13470000
134800     PERFORM 4100-PREPARE-KEY.                                    13480001
134900                                                                  13490000
135000     PERFORM 4010-START-SAVE-COMM-FILE.                           13500001
135100                                                                  13510000
135200     PERFORM 4300-READ-ITEMS-FROM-VSAM                            13520001
135210         UNTIL ASC-NO-ITEMS-LEFT-ON-FILE.                         13521001
135300                                                                  13530000
135400     PERFORM 4020-END-SAVE-COMM-FILE                              13540001
135500                                                                  13550000
135600     MOVE +1                   TO  PV-TOP-ITEM.                   13560000
135700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          13570000
135800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    13580000
135900         SET DP020-MSG-FATAL   TO  TRUE                           13590000
136000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               13600000
136100     ELSE                                                         13610000
136200         MOVE -1               TO MR-SELECTL (1)                  13620000
136300         SET DP030-SET-CURSOR-APPL-1                              13630000
136400                               TO TRUE                            13640000
136500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     13650000
136600     END-IF.                                                      13660000
136700 EJECT                                                            13670000
136701******************************************************************13670101
136702*  UTILITY PARAGRAPH TO INITIATE THE RETREIVAL OF THE SAVED COMM *13670201
136703*  RECORDS FROM THE VSAM FILE.                                   *13670301
136704******************************************************************13670401
136705                                                                  13670501
136706 4010-START-SAVE-COMM-FILE.                                       13670601
136714     EXEC CICS                                                    13671401
136715         STARTBR                                                  13671501
136716             DATASET (PC-SAVE-COMM-DD)                            13671601
136717             RIDFLD  (DP515-KEY)                                  13671701
136718             KEYLENGTH (PC-DP515-KEYLENGTH)                       13671818
136719             GTEQ                                                 13671916
136721             RESP    (PV-CICS-RESP)                               13672103
136722     END-EXEC.                                                    13672201
136723                                                                  13672301
136724     EVALUATE PV-CICS-RESP                                        13672403
136725         WHEN DFHRESP(NORMAL)                                     13672501
136726             SET ASC-ITEMS-LEFT-ON-FILE TO TRUE                   13672601
136727         WHEN DFHRESP(ENDFILE)                                    13672701
136728         WHEN DFHRESP(NOTFND)                                     13672801
136729             SET ASC-NO-ITEMS-LEFT-ON-FILE TO TRUE                13672901
136730         WHEN OTHER                                               13673001
136731             SET DP013-CICS-ABEND                                 13673101
136732                 DP013-XCTL-DISPLAY-LOGOFF TO TRUE                13673201
136733             MOVE '4010-START-SAVE-COMM-FILE' TO DP013-PARAGRAPH  13673301
136734             STRING 'ATTEMPTING TO START A BROWSE ON SAVE COMM '  13673401
136735                                                DELIMITED BY SIZE 13673501
136736                    'FILE ('                    DELIMITED BY SIZE 13673601
136737                    PC-SAVE-COMM-DD             DELIMITED BY SIZE 13673701
136738                    ')  RIDFLD = ('             DELIMITED BY SIZE 13673801
136739                    DP515-KEY                   DELIMITED BY SIZE 13673901
136740                    ')'                         DELIMITED BY SIZE 13674001
136741                INTO DP013-MESSAGE-TEXT (1)                       13674101
136742             PERFORM DP013-0000-PROCESS-ABEND                     13674201
136743     END-EVALUATE.                                                13674301
136745                                                                  13674501
136746******************************************************************13674601
136747*  UTILITY PARAGRAPH TO END THE BROWSING OF THE DPMNUITM VSAM    *13674701
136748*  FILE.                                                         *13674801
136749******************************************************************13674901
136750                                                                  13675001
136751 4020-END-SAVE-COMM-FILE.                                         13675101
136752     EXEC CICS                                                    13675201
136753         ENDBR                                                    13675301
136754             DATASET (PC-SAVE-COMM-DD)                            13675401
136755             RESP    (PV-CICS-RESP)                               13675503
136756     END-EXEC.                                                    13675601
136757                                                                  13675701
136758     IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                        13675803
136759         SET DP013-CICS-ABEND TO TRUE                             13675901
136760         MOVE '4020-END-SAVE-COMM-FILE' TO DP013-PARAGRAPH        13676001
136761         STRING 'ATTEMPTING TO END A BROWSE ON THE SAVE COMM'     13676101
136762                                                DELIMITED BY SIZE 13676201
136763                'FILE ('                        DELIMITED BY SIZE 13676301
136764                PC-SAVE-COMM-DD                 DELIMITED BY SIZE 13676401
136765                ')'                             DELIMITED BY SIZE 13676501
136766             INTO DP013-MESSAGE-TEXT (1)                          13676601
136767         PERFORM DP013-0000-PROCESS-ABEND                         13676701
136768     END-IF.                                                      13676801
136769                                                                  13676901
136770******************************************************************13677001
136771*  PREPARE THE KEY FIELDS TO START THE READ.                     *13677101
136773******************************************************************13677301
136774 4100-PREPARE-KEY.                                                13677401
136775     MOVE PC-LOW-KEY              TO DP515-KEY.                   13677515
136777                                                                  13677701
136778******************************************************************13677801
136779*  UTILITY PARAGRAPH TO READ THE NEXT RECORD IN THE DPSAVCMK     *13677901
136780*  VSAM FILE.                                                    *13678001
136781******************************************************************13678101
136782 4300-READ-ITEMS-FROM-VSAM.                                       13678201
136788                                                                  13678814
136789     PERFORM 4310-READNEXT-SAVECOMM.                              13678921
136790                                                                  13679014
136791     IF  ASC-ITEMS-LEFT-ON-FILE                                   13679108
136792         IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                    13679214
136793             ADD +1                TO ASC-ITEM-SUB                13679314
136794         ELSE                                                     13679414
136795             ADD +1                TO ASC-BLK-SUB                 13679514
136796             MOVE +1               TO ASC-ITEM-SUB                13679614
136797                                                                  13679714
136798             IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY             13679814
136799                 MOVE +1           TO ASC-BLK-SUB                 13679914
136800                 SET ASC-BLOCK-MODIFIED (1)                       13680014
136801                                   TO TRUE                        13680114
136802                 PERFORM 5100-WRITE-TEMP-STORAGE                  13680214
136803                 MOVE ASC-BLOCK-ENTRIES                           13680314
136804                           (PC-MAX-BLOCKS-IN-ARRAY)               13680414
136805                            TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)     13680514
136806                 ADD +1      TO ASC-BLK-SUB                       13680614
136807                 INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)       13680714
136808                 SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          13680814
136809                             TO TRUE                              13680914
136810             END-IF                                               13681014
136811         END-IF                                                   13681114
136812         ADD +1                TO ASC-NUMBER-OF-ITEMS-READ        13681222
136813         MOVE ASC-NUMBER-OF-ITEMS-READ                            13681314
136814                                      TO ASC-LIST-ITEM-NUMBER     13681414
136815                                    (ASC-BLK-SUB ASC-ITEM-SUB)    13681514
136816         PERFORM 4302-DETERMINE-STATUS                            13681623
136819         MOVE DP515-NETNAME        TO ASC-NETNAME                 13681909
136820                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13682010
136821         MOVE DP515-TASK-NUMBER    TO ASC-TASK-NUM                13682108
136822                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13682210
136823         MOVE DP515-CREATE-EIBDATE TO ASC-JUL-DATE                13682308
136824                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13682410
136825         MOVE DP515-CREATE-EIBTIME TO PV-TIME                     13682508
136826         MOVE PV-TIME-HH           TO ASC-TIME-HH                 13682608
136827                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13682710
136828         MOVE PV-TIME-MM           TO ASC-TIME-MM                 13682808
136829                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13682910
136830         MOVE PV-TIME-SS           TO ASC-TIME-SS                 13683008
136831                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13683110
136832         MOVE ':'                  TO ASC-TIME-COLON-1            13683208
136833                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13683310
136834                                      ASC-TIME-COLON-2            13683408
136835                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13683510
136836         IF  DP515-CREATE-PGM-DPKCS007                            13683608
136837             MOVE 'DPKCS007'       TO ASC-CREATOR                 13683708
136838                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13683810
136839         ELSE                                                     13683908
136840             IF  DP515-CREATE-PGM-DPKCS008                        13684008
136841                 MOVE 'DPKCS008'   TO ASC-CREATOR                 13684108
136842                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13684210
136843             END-IF                                               13684308
136844         END-IF                                                   13684408
136845     END-IF.                                                      13684521
136846******************************************************************13684623
136847*  THIS PARAGRAPH WILL DETERMINE IF THE NETNAME FROM THE DPSAVCMK*13684723
136848*  RECORD IS CURRENTLY KNOWN TO THIS CICS REGION.                *13684823
136849******************************************************************13684923
136850 4302-DETERMINE-STATUS.                                           13685023
136851     IF  DP515-NETNAME = PV-OLD-NETNAME                           13685123
136852         MOVE PV-OLD-NETNAME-STATUS                               13685223
136853                           TO ASC-STATUS                          13685323
136854                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13685423
136855     ELSE                                                         13685523
136857         EXEC CICS                                                13685723
136858             INQUIRE                                              13685823
136859                 NETNAME (DP515-NETNAME)                          13685923
136860             RESP (PV-CICS-RESP)                                  13686023
136861         END-EXEC                                                 13686123
136862                                                                  13686223
136863         IF  PV-CICS-RESP = DFHRESP (NORMAL)                      13686323
136864             SET ASC-STATUS-FND (ASC-BLK-SUB ASC-ITEM-SUB)        13686426
136865                               TO TRUE                            13686526
136869         ELSE                                                     13686923
136870             SET ASC-STATUS-NOT-FND (ASC-BLK-SUB ASC-ITEM-SUB)    13687026
136871                               TO TRUE                            13687126
136875         END-IF                                                   13687523
136876         MOVE DP515-NETNAME    TO PV-OLD-NETNAME                  13687626
136877         MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)               13687726
136878                               TO PV-OLD-NETNAME-STATUS           13687826
136879     END-IF.                                                      13687923
136880******************************************************************13688008
136881*  UTILITY PARAGRAPH TO READ THE NEXT RECORD IN THE DPSAVCMK     *13688108
136882*  VSAM FILE.                                                    *13688208
136883******************************************************************13688308
136884 4310-READNEXT-SAVECOMM.                                          13688408
136885     PERFORM                                                      13688516
136886     WITH TEST AFTER                                              13688616
136887     UNTIL ((DP515-KEY > PC-LOW-KEY)                              13688717
136888        OR (ASC-NO-ITEMS-LEFT-ON-FILE))                           13688817
136889         MOVE LENGTH OF DP515-SAVED-COMMAREA-RECORD               13688918
136890                       TO PV-RECORD-LENGTH                        13689018
136891         EXEC CICS                                                13689116
136892             READNEXT                                             13689216
136893                 DATASET (PC-SAVE-COMM-DD)                        13689316
136894                 RIDFLD  (DP515-KEY)                              13689416
136895                 INTO    (DP515-SAVED-COMMAREA-RECORD)            13689516
136896                 LENGTH  (PV-RECORD-LENGTH)                       13689618
136897                 RESP    (PV-CICS-RESP)                           13689716
136898         END-EXEC                                                 13689816
136899                                                                  13689916
136900         EVALUATE PV-CICS-RESP                                    13690016
136901             WHEN DFHRESP(NORMAL)                                 13690116
136902                 CONTINUE                                         13690222
136903             WHEN DFHRESP(ENDFILE)                                13690316
136904             WHEN DFHRESP(NOTFND)                                 13690416
136905                 SET ASC-NO-ITEMS-LEFT-ON-FILE TO TRUE            13690516
136906             WHEN OTHER                                           13690616
136907                 SET DP013-CICS-ABEND                             13690716
136908                     DP013-XCTL-DISPLAY-LOGOFF TO TRUE            13690816
136909                 MOVE '4310-READNEXT-SAVECOMM'  TO DP013-PARAGRAPH13690916
136910                 STRING 'ATTEMPTING TO READ THE NEXT RECORD '     13691016
136911                                                DELIMITED BY SPACE13691116
136912                        'THE ITEM FILE ('       DELIMITED BY SPACE13691216
136913                        PC-SAVE-COMM-DD         DELIMITED BY SPACE13691316
136914                        ')  RIDFLD = ('         DELIMITED BY SPACE13691416
136915                        DP515-KEY               DELIMITED BY SPACE13691516
136916                        ')'                     DELIMITED BY SPACE13691616
136917                    INTO DP013-MESSAGE-TEXT (1)                   13691716
136918                 PERFORM DP013-0000-PROCESS-ABEND                 13691816
136920         END-EVALUATE                                             13692016
137000     END-PERFORM.                                                 13700016
168500 EJECT                                                            16850000
168600*----------------------------------------------------------------*16860000
168700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16870000
168800*----------------------------------------------------------------*16880000
168900                                                                  16890000
169000 4400-MOVE-COMMAREA-TO-SCREEN.                                    16900000
169010     MOVE EIBDATE               TO AJULDATO.                      16901001
169020*                                                                 16902001
169100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             16910000
169200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          16920000
169300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          16930000
169400             MOVE +1    TO ASC-BLK-SUB                            16940000
169500             PERFORM 5100-WRITE-TEMP-STORAGE                      16950000
169600             ADD +1     TO ASC-BLK-SUB                            16960000
169700             PERFORM 5100-WRITE-TEMP-STORAGE                      16970000
169800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             16980000
169900                 GIVING PV-BLOCK-NUMBER                           16990000
170000                 REMAINDER PV-REMAINDER                           17000000
170100             IF  PV-REMAINDER > ZERO                              17010000
170200                 ADD +1 TO PV-BLOCK-NUMBER                        17020000
170300             END-IF                                               17030000
170400             MOVE +1    TO ASC-BLK-SUB                            17040000
170500             PERFORM 4410-READ-TEMP-STORAGE                       17050000
170600             ADD +1     TO ASC-BLK-SUB                            17060000
170700                           PV-BLOCK-NUMBER                        17070000
170800             PERFORM 4410-READ-TEMP-STORAGE                       17080000
170900     END-IF.                                                      17090000
171000     MOVE +1            TO ASC-BLK-SUB.                           17100000
171100     COMPUTE ASC-ITEM-SUB =                                       17110000
171200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17120000
171300         + PC-ITEMS-PER-PANEL).                                   17130000
171400*                                                                 17140000
171500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17150000
171600         ADD +1         TO ASC-BLK-SUB                            17160000
171700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17170000
171800     END-IF.                                                      17180000
171900*                                                                 17190000
172000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17200000
172100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17210000
172200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17220000
172300     PERFORM 4420-FORMAT-LIST-LINES                               17230000
172400         VARYING PV-SUB                                           17240000
172500         FROM PC-ITEMS-PER-PANEL BY -1                            17250000
172600         UNTIL PV-SUB < +1.                                       17260000
172700*                                                                 17270000
172800     COMPUTE ASC-ITEMS-DISPLAYED =                                17280000
172900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17290000
173000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17300000
173100                                      ASTRTITO.                   17310000
173200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17320000
173300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17330000
173400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17340000
173500                                   TO ASELITO.                    17350000
173600*                                                                 17360000
173700     IF  DP020-MSG-NUMBER-X = SPACE                               17370000
173800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17380000
173900*            --- MORE ITEMS TO DISPLAY ----                       17390000
174000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17400000
174100             SET DP020-MSG-INFORMATIONAL TO TRUE                  17410000
174200         END-IF                                                   17420000
174300     END-IF.                                                      17430000
174400*----------------------------------------------------------------*17440000
174500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17450000
174600*----------------------------------------------------------------*17460000
174700                                                                  17470000
174800 4410-READ-TEMP-STORAGE.                                          17480000
174900                                                                  17490000
175000     EXEC CICS                                                    17500000
175100         READQ TS                                                 17510000
175200             QUEUE (ASC-LIST-QUEUE-NAME)                          17520000
175300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17530000
175400             ITEM  (PV-BLOCK-NUMBER)                              17540000
175500             RESP  (PV-CICS-RESP)                                 17550000
175600     END-EXEC.                                                    17560000
175700                                                                  17570000
175800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17580000
175900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17590000
176000         CONTINUE                                                 17600000
176100     ELSE                                                         17610000
176200         SET DP013-CICS-ABEND     TO TRUE                         17620000
176300         SET DP013-NO-ROLLBACK    TO TRUE                         17630000
176400         MOVE '4410-READ-TEMP-STORAGE'                            17640000
176500                                  TO DP013-PARAGRAPH              17650000
176600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17660000
176700                                  TO DP013-MESSAGE-TEXT(1)        17670000
176800         PERFORM DP013-0000-PROCESS-ABEND                         17680000
176900     END-IF.                                                      17690000
177000                                                                  17700000
177100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17710000
177200*                                                                 17720000
177300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17730000
177400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17740000
177500     END-IF.                                                      17750000
177600 EJECT                                                            17760000
177700*----------------------------------------------------------------*17770000
177800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17780000
177900*----------------------------------------------------------------*17790000
178000                                                                  17800000
178100 4420-FORMAT-LIST-LINES.                                          17810000
178200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17820000
178300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17830000
178400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           17840000
178500         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           17850000
178600         MOVE SPACE              TO MR-SELECTI (PV-SUB)           17860000
178700                                    MR-ACTION (PV-SUB)            17870000
178800                                    MR-STATUS (PV-SUB)            17880001
178900                                    MR-NETNAME(PV-SUB)            17890001
179000                                    MR-TASK-NUM-X (PV-SUB)        17900003
179100                                    MR-JUL-DATE (PV-SUB)          17910001
179110                                    MR-TIME (PV-SUB)              17911001
179120                                    MR-CREATOR (PV-SUB)           17912001
179200     ELSE                                                         17920000
179300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17930000
179400                                                   > SPACE        17940000
179500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17950000
179600                                 TO MR-SELECTI (PV-SUB)           17960000
179700         ELSE                                                     17970000
179800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17980000
179900                                 TO MR-SELECTI (PV-SUB)           17990000
180000         END-IF                                                   18000000
180100*                                                                 18010000
180200         IF  DP030-SET-CURSOR-TRAILER                             18020000
180300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)18030000
180400                 > SPACE)                                         18040000
180500               OR (PV-SUB = 1))                                   18050000
180600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               18060000
180700                MOVE -1          TO MR-SELECTL (PV-SUB)           18070000
180800             END-IF                                               18080000
180900         END-IF                                                   18090000
181000*                                                                 18100000
181100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           18110000
181200             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           18120000
181300                                 TO MR-ACTION (PV-SUB)            18130000
181400             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           18140001
181500                                 TO MR-STATUS (PV-SUB)            18150001
181600             MOVE ASC-NETNAME (ASC-BLK-SUB ASC-ITEM-SUB)          18160001
181700                                 TO MR-NETNAME (PV-SUB)           18170001
181800             MOVE ASC-TASK-NUM (ASC-BLK-SUB ASC-ITEM-SUB)         18180001
181900                                 TO MR-TASK-NUM (PV-SUB)          18190001
182000             MOVE ASC-JUL-DATE (ASC-BLK-SUB ASC-ITEM-SUB)         18200001
182100                                 TO MR-JUL-DATE (PV-SUB)          18210001
182101             MOVE ASC-TIME  (ASC-BLK-SUB ASC-ITEM-SUB)            18210120
182102                                 TO MR-TIME (PV-SUB)              18210220
182109             MOVE ASC-CREATOR (ASC-BLK-SUB ASC-ITEM-SUB)          18210901
182110                                 TO MR-CREATOR (PV-SUB)           18211001
182200         END-IF                                                   18220000
182300     END-IF.                                                      18230000
182400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18240020
182500     IF  ASC-ITEM-SUB < +1                                        18250020
182600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18260000
182700         MOVE +1                 TO ASC-BLK-SUB                   18270000
182800     END-IF.                                                      18280000
182900******************************************************************18290000
183000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18300000
183100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18310000
183200** ISSUE A WARNING.                                             **18320000
183300******************************************************************18330000
183400 4430-CHECK-FOR-BEGIN-AND-END.                                    18340000
183500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18350000
183600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18360000
183700*            -- NO END-OF-RANGE SPECFIED ---                      18370000
183800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18380000
183900             SET DP020-MSG-WARNING TO TRUE                        18390000
184000             PERFORM 4431-POSITION-AT-WARNING                     18400000
184100         END-IF                                                   18410000
184200     ELSE                                                         18420000
184300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18430000
184400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18440000
184500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18450000
184600             SET DP020-MSG-WARNING TO TRUE                        18460000
184700             PERFORM 4431-POSITION-AT-WARNING                     18470000
184800         END-IF                                                   18480000
184900     END-IF.                                                      18490000
185000******************************************************************18500000
185100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18510000
185200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18520000
185300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18530000
185400** POSITION THE CURSOR THERE.                                   **18540000
185500******************************************************************18550000
185600 4431-POSITION-AT-WARNING.                                        18560000
185700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18570000
185800                    - PV-TOP-ITEM + 1.                            18580000
185900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18590000
186000         CONTINUE                                                 18600000
186100     ELSE                                                         18610000
186200         SET DP030-SET-CURSOR-APPL-1                              18620000
186300                                   TO TRUE                        18630000
186400         MOVE -1                   TO MR-SELECTL (PV-SUB)         18640000
186500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18650000
186600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18660000
186700     END-IF.                                                      18670000
186800*                                                                 18680000
186900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18690000
187000                    - PV-TOP-ITEM + 1.                            18700000
187100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18710000
187200         CONTINUE                                                 18720000
187300     ELSE                                                         18730000
187400         SET DP030-SET-CURSOR-APPL-1                              18740000
187500                                   TO TRUE                        18750000
187600         MOVE -1                   TO MR-SELECTL (PV-SUB)         18760000
187700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18770000
187800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18780000
187900     END-IF.                                                      18790000
188000 EJECT                                                            18800000
188100*----------------------------------------------------------------*18810000
188200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18820000
188300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18830000
188400* FOR THE SELECTED ITEMS QUEUE.                                  *18840000
188500*                                                                *18850000
188600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18860000
188700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18870000
188800* THE ARRAY IS FULL.                                             *18880000
188900*----------------------------------------------------------------*18890000
189000                                                                  18900000
189100 5000-PREPARE-SEL-QUEUE.                                          18910000
189200                                                                  18920000
189300     MOVE +1                   TO  ASC-BLK-SUB.                   18930000
189400     PERFORM 5100-WRITE-TEMP-STORAGE.                             18940000
189500     ADD +1                    TO  ASC-BLK-SUB.                   18950000
189600     PERFORM 5100-WRITE-TEMP-STORAGE.                             18960000
189700                                                                  18970000
189800*    MOVE ASC-SEL-QUEUE-NAME   TO  DP056-SEL-QUEUE-NAME.          18980003
189900*    PERFORM 6010-DELETE-SEL-QUEUE.                               18990003
190000                                                                  19000000
190100     SET ASC-UPDATE-TSQ        TO  TRUE.                          19010000
190200                                                                  19020000
190300*    SET DP057-IDX             TO  1.                             19030003
190400*    MOVE ZERO                 TO DP056-NUMBER-OF-TS-ITEMS.       19040003
190500*    INITIALIZE DP057-SELECTED-ITEM-ARRAY.                        19050003
190600                                                                  19060000
190700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           19070000
190800             VARYING PV-ITEM                                      19080000
190900             FROM 1 BY 1                                          19090000
191000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     19100000
191100                                                                  19110000
191200*    IF  DP057-IDX > 1                                            19120001
191300*        PERFORM 5205-WRITE-SEL-QUEUE                             19130001
191400*        ADD +1                TO DP056-NUMBER-OF-TS-ITEMS        19140001
191500*    END-IF.                                                      19150001
191600 EJECT                                                            19160000
191700*----------------------------------------------------------------*19170000
191800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19180000
191900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19190000
192000*----------------------------------------------------------------*19200000
192100                                                                  19210000
192200 5100-WRITE-TEMP-STORAGE.                                         19220000
192300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19230000
192400                                   TO PV-LIST-ITEM-NUMBER.        19240000
192500     COMPUTE PV-BLOCK-NUMBER =                                    19250000
192600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19260000
192700                                                                  19270000
192800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19280000
192900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19290000
193000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19300000
193100             PERFORM 5105-REWRITE-ASC-LISTQ                       19310000
193200         END-IF                                                   19320000
193300     ELSE                                                         19330000
193400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19340000
193500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19350000
193600         PERFORM 5110-WRITE-ASC-LISTQ                             19360000
193700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19370000
193800     END-IF.                                                      19380000
193900                                                                  19390000
194000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19400000
194100******************************************************************19410000
194200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19420000
194300** SPECIFIC COMMAREA.                                           **19430000
194400******************************************************************19440000
194500 5105-REWRITE-ASC-LISTQ.                                          19450000
194600     EXEC CICS                                                    19460000
194700         WRITEQ TS                                                19470000
194800             QUEUE (ASC-LIST-QUEUE-NAME)                          19480000
194900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19490000
195000             ITEM  (PV-BLOCK-NUMBER)                              19500000
195100             REWRITE                                              19510000
195200             RESP  (PV-CICS-RESP)                                 19520000
195300     END-EXEC.                                                    19530000
195400                                                                  19540000
195500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19550000
195600         CONTINUE                                                 19560000
195700     ELSE                                                         19570000
195800         SET DP013-CICS-ABEND            TO TRUE                  19580000
195900         SET DP013-NO-ROLLBACK           TO TRUE                  19590000
196000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19600000
196100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19610000
196200                                         TO DP013-MESSAGE-TEXT(1) 19620000
196300         PERFORM DP013-0000-PROCESS-ABEND                         19630000
196400     END-IF.                                                      19640000
196500                                                                  19650000
196600******************************************************************19660000
196700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19670000
196800** SPECIFIC COMMAREA.                                           **19680000
196900******************************************************************19690000
197000 5110-WRITE-ASC-LISTQ.                                            19700000
197100     EXEC CICS                                                    19710000
197200         WRITEQ TS                                                19720000
197300             QUEUE (ASC-LIST-QUEUE-NAME)                          19730000
197400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19740000
197500             ITEM  (PV-BLOCK-NUMBER)                              19750000
197600             RESP  (PV-CICS-RESP)                                 19760000
197700     END-EXEC.                                                    19770000
197800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      19780000
197900         SET DP013-CICS-ABEND      TO TRUE                        19790000
198000         SET DP013-NO-ROLLBACK     TO TRUE                        19800000
198100         MOVE '5110-WRITE-ASC-LISTQ'                              19810000
198200                                   TO DP013-PARAGRAPH             19820000
198300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19830000
198400                                   TO DP013-MESSAGE-TEXT(1)       19840000
198500         PERFORM DP013-0000-PROCESS-ABEND                         19850000
198600     END-IF.                                                      19860000
198700 EJECT                                                            19870000
198800*----------------------------------------------------------------*19880000
198900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19890000
199000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *19900000
199100*----------------------------------------------------------------*19910000
199200                                                                  19920000
199300 5200-FILL-SEL-QUEUE-RECORD.                                      19930000
199400                                                                  19940000
199500     PERFORM 6112-READ-LIST-QUEUE.                                19950000
199600                                                                  19960000
199700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19970000
199800         PERFORM                                                  19980000
199900         VARYING LQW-IDX                                          19990000
200000         FROM 1 BY 1                                              20000000
200100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            20010000
200200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          20020000
200300                                                                  20030000
200400             IF  LQW-SELECT (LQW-IDX)                             20040000
200500*                MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              20050001
200600*                                  TO DP057-ITEM (DP057-IDX)      20060001
200700*                MOVE LQW-MESSAGE-NUMBER (LQW-IDX)                20070001
200800*                                  TO DP057-MESSAGE-NUMBER        20080001
200900*                                       (DP057-IDX)               20090001
201000*                MOVE SPACE        TO DP057-ACTION-SW (DP057-IDX) 20100001
201100*                SET DP057-IDX UP BY 1                            20110001
201200*                IF  DP057-IDX > DP057-MAX-ITEMS                  20120001
201300*                    PERFORM 5205-WRITE-SEL-QUEUE                 20130001
201400*                    ADD +1        TO DP056-NUMBER-OF-TS-ITEMS    20140001
201500*                    INITIALIZE DP057-SELECTED-ITEM-ARRAY         20150001
201600*                    SET DP057-IDX TO  1                          20160001
201610                 CONTINUE                                         20161001
201700*                END-IF                                           20170003
201800             END-IF                                               20180000
201900         END-PERFORM                                              20190000
202000     END-IF.                                                      20200000
202100                                                                  20210000
202200*----------------------------------------------------------------*20220000
202300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20230000
202400*----------------------------------------------------------------*20240000
202500                                                                  20250000
202600*5205-WRITE-SEL-QUEUE.                                            20260001
202700*                                                                 20270001
202800*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20280001
202900*                                  TO DP057-SELECTED-ITEMS.       20290001
203000*                                                                 20300001
203100*    EXEC CICS                                                    20310001
203200*         WRITEQ TS                                               20320001
203300*             QUEUE (ASC-SEL-QUEUE-NAME)                          20330001
203400*             FROM  (DP057-MESSAGE-SEL-REC)                       20340001
203500*             ITEM  (PV-SEL-QUEUE-ITEM)                           20350001
203600*             RESP  (PV-CICS-RESP)                                20360001
203700*    END-EXEC.                                                    20370001
203800*                                                                 20380001
203900*    IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20390001
204000*        CONTINUE                                                 20400001
204100*    ELSE                                                         20410001
204200*        SET DP013-CICS-ABEND      TO TRUE                        20420001
204300*        SET DP013-NO-ROLLBACK     TO TRUE                        20430001
204400*        MOVE '5205-WRITE-SEL-QUEUE'                              20440001
204500*                                  TO DP013-PARAGRAPH             20450001
204600*        MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20460001
204700*                                  TO DP013-MESSAGE-TEXT(1)       20470001
204800*        PERFORM DP013-0000-PROCESS-ABEND                         20480001
204900*    END-IF.                                                      20490001
205000 EJECT                                                            20500000
205100******************************************************************20510000
205200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20520000
205300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20530000
205400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20540000
205500** THE USER.                                                    **20550000
205600******************************************************************20560000
205700 6000-REFRESH-PANEL-FROM-TEMP.                                    20570000
205800     IF  ASC-UPDATE-TSQ                                           20580000
205900         SET ASC-NO-TSQ-UPDATE TO TRUE                            20590000
206000         MOVE ZERO                 TO PV-SAVE-ITEM                20600000
206100                                      PV-SEL-QUEUE-ITEM           20610000
206200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20620000
206300                                   TO PV-HOLD-SELECTED-ITEMS      20630000
206400         MOVE +1                   TO PV-ITEMS-PROCESSED          20640000
206500         PERFORM 6100-UPDATE-TSQ                                  20650000
206600             UNTIL PV-ITEMS-PROCESSED >                           20660000
206700                                     PV-HOLD-SELECTED-ITEMS       20670000
206800         PERFORM 6010-DELETE-SEL-QUEUE                            20680000
206900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20690000
207000                    ASC-BLOCK-ENTRIES (2)                         20700000
207100     END-IF.                                                      20710000
207200                                                                  20720000
207300*----------------------------------------------------------------*20730000
207400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *20740000
207500*----------------------------------------------------------------*20750000
207600 6010-DELETE-SEL-QUEUE.                                           20760000
207700                                                                  20770000
207800     EXEC CICS                                                    20780000
207900         DELETEQ TS                                               20790000
208000             QUEUE (ASC-SEL-QUEUE-NAME)                           20800000
208100             RESP  (PV-CICS-RESP)                                 20810000
208200     END-EXEC.                                                    20820000
208300*                                                                 20830000
208400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      20840000
208500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         20850000
208600         CONTINUE                                                 20860000
208700     ELSE                                                         20870000
208800         SET DP013-CICS-ABEND TO TRUE                             20880000
208900         SET DP013-NO-ROLLBACK TO TRUE                            20890000
209000         MOVE '6010-DELETE-SEL-QUEUE'                             20900000
209100                        TO DP013-PARAGRAPH                        20910000
209200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20920000
209300                        TO DP013-MESSAGE-TEXT (1)                 20930000
209400         PERFORM DP013-0000-PROCESS-ABEND                         20940000
209500     END-IF.                                                      20950000
209600                                                                  20960000
209700*----------------------------------------------------------------*20970000
209800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *20980000
209900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20990000
210000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *21000000
210100*    THE TEMP QUEUE.                                             *21010000
210200*----------------------------------------------------------------*21020000
210300                                                                  21030000
210400 6100-UPDATE-TSQ.                                                 21040000
210500                                                                  21050000
210600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             21060000
210700*    PERFORM 6105-READ-SEL-QUEUE.                                 21070001
210800*    PERFORM                                                      21080001
210900*        VARYING DP057-IDX                                        21090001
211000*        FROM 1 BY 1                                              21100001
211100*        UNTIL ((PV-ITEMS-PROCESSED >                             21110001
211200*                             PV-HOLD-SELECTED-ITEMS)             21120001
211300*        OR (DP057-IDX GREATER THAN DP057-MAX-ITEMS))             21130001
211400*        IF  DP057-ACTION-SW (DP057-IDX) > SPACE                  21140001
211500*            PERFORM 6110-PROCESS-ITEMS                           21150001
211600*        END-IF                                                   21160001
211700*        ADD +1                TO PV-ITEMS-PROCESSED              21170001
211800*    END-PERFORM.                                                 21180001
211900*    PERFORM 6111-WRITE-LIST-QUEUE.                               21190001
212000*----------------------------------------------------------------*21200000
212100*    READ THE LIST QUEUE RECORD.                                 *21210000
212200*----------------------------------------------------------------*21220000
212300                                                                  21230000
212400*6105-READ-SEL-QUEUE.                                             21240001
212500*                                                                 21250001
212600*    EXEC CICS                                                    21260001
212700*         READQ TS                                                21270001
212800*             QUEUE (ASC-SEL-QUEUE-NAME)                          21280001
212900*             INTO  (DP057-MESSAGE-SEL-REC)                       21290001
213000*             ITEM  (PV-SEL-QUEUE-ITEM)                           21300001
213100*             RESP  (PV-CICS-RESP)                                21310001
213200*    END-EXEC.                                                    21320001
213300*                                                                 21330000
213400*    IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21340001
213500*        CONTINUE                                                 21350001
213600*    ELSE                                                         21360001
213700*        SET DP013-CICS-ABEND      TO  TRUE                       21370001
213800*        SET DP013-NO-ROLLBACK     TO  TRUE                       21380001
213900*        MOVE '6105-READ-SEL-QUEUE'                               21390001
214000*                                  TO  DP013-PARAGRAPH            21400001
214100*        MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21410001
214200*                                  TO  DP013-MESSAGE-TEXT(1)      21420001
214300*        PERFORM DP013-0000-PROCESS-ABEND                         21430001
214400*    END-IF.                                                      21440001
214500 EJECT                                                            21450000
214600*----------------------------------------------------------------*21460000
214700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21470000
214800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21480000
214900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21490000
215000*----------------------------------------------------------------*21500000
215100                                                                  21510000
215200*6110-PROCESS-ITEMS.                                              21520001
215300*                                                                 21530001
215400*    COMPUTE PV-ITEM = 1 + ((DP057-ITEM (DP057-IDX) - 1)          21540001
215500*                    / PC-ITEMS-PER-PANEL).                       21550001
215600*                                                                 21560001
215700*    IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21570001
215800*        IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21580001
215900*            PERFORM 6111-WRITE-LIST-QUEUE                        21590001
216000*        END-IF                                                   21600001
216100*        MOVE PV-ITEM          TO PV-SAVE-ITEM                    21610001
216200*                                                                 21620001
216300*        PERFORM 6112-READ-LIST-QUEUE                             21630001
216400*        IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21640001
216500*            CONTINUE                                             21650001
216600*        END-IF                                                   21660001
216700*    END-IF.                                                      21670001
216800*                                                                 21680001
216900*    COMPUTE PV-SUB = (DP057-ITEM (DP057-IDX)                     21690001
217000*                   - LQW-LIST-ITEM-NUMBER (1)) + 1.              21700001
217100*    SET LQW-DESELECT (PV-SUB) TO    TRUE                         21710001
217200*    MOVE LQW-SELECTED-SW (PV-SUB)                                21720001
217300*                              TO LQW-TEMP-SELECTED-SW (PV-SUB).  21730001
217400*    EVALUATE TRUE                                                21740001
217500*        WHEN DP057-INQ (DP057-IDX)                               21750001
217600*             MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             21760001
217700*                                                                 21770001
217800*        WHEN DP057-UPD (DP057-IDX)                               21780001
217900*             MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             21790001
218000*                                                                 21800001
218100*        WHEN DP057-DEL (DP057-IDX)                               21810001
218200*             MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             21820001
218300*                                                                 21830001
218400*        WHEN DP057-ERR (DP057-IDX)                               21840001
218500*             MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             21850001
218600*    END-EVALUATE.                                                21860001
218700*                                                                 21870001
218800*    SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                21880001
218900                                                                  21890000
219000*----------------------------------------------------------------*21900000
219100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *21910000
219200*----------------------------------------------------------------*21920000
219300                                                                  21930000
219400 6111-WRITE-LIST-QUEUE.                                           21940000
219500                                                                  21950000
219600     EXEC CICS                                                    21960000
219700         WRITEQ TS                                                21970000
219800             QUEUE (ASC-LIST-QUEUE-NAME)                          21980000
219900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     21990000
220000             ITEM  (PV-SAVE-ITEM)                                 22000000
220100             REWRITE                                              22010000
220200             RESP  (PV-CICS-RESP)                                 22020000
220300     END-EXEC.                                                    22030000
220400*                                                                 22040000
220500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22050000
220600         CONTINUE                                                 22060000
220700     ELSE                                                         22070000
220800         SET DP013-CICS-ABEND  TO  TRUE                           22080000
220900         SET DP013-NO-ROLLBACK TO  TRUE                           22090000
221000         MOVE '6111-WRITE-LIST-QUEUE'                             22100000
221100                               TO  DP013-PARAGRAPH                22110000
221200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  22120000
221300                               TO  DP013-MESSAGE-TEXT(1)          22130000
221400         PERFORM DP013-0000-PROCESS-ABEND                         22140000
221500     END-IF.                                                      22150000
221600                                                                  22160000
221700 EJECT                                                            22170000
221800*----------------------------------------------------------------*22180000
221900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*22190000
222000*----------------------------------------------------------------*22200000
222100                                                                  22210000
222200 6112-READ-LIST-QUEUE.                                            22220000
222300                                                                  22230000
222400     EXEC CICS                                                    22240000
222500         READQ TS                                                 22250000
222600             QUEUE (ASC-LIST-QUEUE-NAME)                          22260000
222700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22270000
222800             ITEM  (PV-ITEM)                                      22280000
222900             RESP  (PV-CICS-RESP)                                 22290000
223000     END-EXEC.                                                    22300000
223100*                                                                 22310000
223200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22320000
223300         CONTINUE                                                 22330000
223400     ELSE                                                         22340000
223500         SET DP013-CICS-ABEND        TO TRUE                      22350000
223600         SET DP013-NO-ROLLBACK       TO TRUE                      22360000
223700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22370000
223800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22380000
223900                                     TO DP013-MESSAGE-TEXT(1)     22390000
224000         PERFORM DP013-0000-PROCESS-ABEND                         22400000
224100     END-IF.                                                      22410000
224200                                                                  22420000
224300 EJECT                                                            22430000
224400*----------------------------------------------------------------*22440000
224500*    ABEND PROCESSOR MODULE                                      *22450000
224600*----------------------------------------------------------------*22460000
224700                                                                  22470000
224800     COPY DPPD013.                                                22480000
