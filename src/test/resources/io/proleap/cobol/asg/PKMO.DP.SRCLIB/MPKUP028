000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MPKUP028.                                00050000
000600 AUTHOR.                 JOYCE KNOKE (TCC).                       00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            NOVEMBER 1991.                           00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*    THIS PROGRAM DELETES ROWS FROM THE UPC CERTIFICATION         00120000
001300*    REQUEST TABLE.                                               00130000
001400******************************************************************00140000
001500* CHANGED:                                                        00150000
001600*     DOUG DOUGLAS   STRATAGEM      TKMA377             03/10/98  00151000
001700*          REMOVE OLD DATE ARITHMETIC LOGIC. ADD CALL(S) TO       00152000
001800*          KOHL'S STANDARD DATE ROUTINE.          WR: 5895        00153000
001900******************************************************************00160000
002000 ENVIRONMENT DIVISION.                                            00170000
002100******************************************************************00180000
002200                                                                  00190000
002300 CONFIGURATION SECTION.                                           00200000
002400                                                                  00210000
002500 SOURCE-COMPUTER.        IBM-3090.                                00220000
002600 OBJECT-COMPUTER.        IBM-3090.                                00230000
002700                                                                  00240000
002800 INPUT-OUTPUT SECTION.                                            00250000
002900                                                                  00260000
003000 FILE-CONTROL.                                                    00270000
003100                                                                  00280000
003200     SELECT UPC-CERT-REQUEST-DELETE-REPORT                        00290000
003300         ASSIGN TO RPT01.                                         00300000
003400                                                                  00310000
003500******************************************************************00320000
003600 DATA DIVISION.                                                   00330000
003700******************************************************************00340000
003800                                                                  00350000
003900 FILE SECTION.                                                    00360000
004000                                                                  00370000
004100 FD  UPC-CERT-REQUEST-DELETE-REPORT                               00380000
004200     RECORDING MODE IS F                                          00390000
004300     LABEL RECORDS ARE STANDARD                                   00400000
004400     BLOCK CONTAINS 0 RECORDS.                                    00410000
004500                                                                  00420000
004600 01  UPC-CERT-REQUEST-DELETE-LINE        PIC X(132).              00430000
004700                                                                  00440000
004800******************************************************************00450000
004900 WORKING-STORAGE SECTION.                                         00460000
005000******************************************************************00470000
005100                                                                  00480000
005200 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00490000
005300                                                     COMP SYNC.   00500000
005400     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00510000
005500     88  ABEND-4002-READ-ERROR                       VALUE +4002. 00520000
005600     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00530000
005700     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00540000
005800     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00550000
005900     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00560000
006000     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00570000
006100     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 00580000
006200     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 00590000
006300     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00620000
006400*                                                                 00630000
006500*  STANDARD REPORT HEADER FOR 200 COLUMN REPORT                   00640000
006600*                                                                 00650000
006700     COPY DPWS132O.                                               00660000
006800                                                                  00670000
006900*                                                                 00680000
007000*  STANDARD COPYBOOK FOR STANDARDIZED DATE ROUTINE                00690000
007100*                                                                 00700000
007200     COPY DPWS500.                                                00710000
007300                                                                  00720000
007400 01  CD-CPU-DATE.                                                 00730000
007500     05  CD-YEAR                         PIC  9(02)  VALUE ZEROS. 00740000
007600     05  CD-MONTH                        PIC  9(02)  VALUE ZEROS. 00750000
007700     05  CD-DAY                          PIC  9(02)  VALUE ZEROS. 00760000
007800                                                                  00761000
007900 01  CD-CPU-DATE-CC.                                              00762000
008000     05  CD-YEAR-CC-X.                                            00763000
008100         10  CD-CENTURY-CC               PIC  9(02)  VALUE ZEROS. 00763100
008200             88  CD-20TH-CENTURY                     VALUE 19.    00763200
008300             88  CD-21ST-CENTURY                     VALUE 20.    00763300
008400         10  CD-YEAR-CC                  PIC  9(02)  VALUE ZEROS. 00763400
008500     05  CD-MONTH-CC                     PIC  9(02)  VALUE ZEROS. 00764000
008600     05  CD-DAY-CC                       PIC  9(02)  VALUE ZEROS. 00765000
008700                                                                  00810000
008800 01  CT-CPU-TIME.                                                 00820000
008900     05  CT-HOUR                         PIC  9(02)  VALUE ZEROS. 00830000
009000     05  CT-MINUTE                       PIC  9(02)  VALUE ZEROS. 00840000
009100     05  FILLER                          PIC  9(04)  VALUE ZEROS. 00850000
009200                                                                  00860000
009300 01  CC-CONTROL-CARD.                                             00870000
009400     05  CC-NUM-DELETE-DAYS              PIC  9(03)  VALUE ZEROS. 00880000
009500     05  CC-FILLER                       PIC  X(77)  VALUE SPACE. 00890000
009600                                                                  00900000
009700 01  DL-DETAIL-LINE.                                              00910000
009800     05  DL-PO-NBR                       PIC  ZZZZZZZZ.           00920000
009900     05  FILLER                          PIC  X(01)  VALUE '-'.   00930000
010000     05  DL-REC-SEQ                      PIC  ZZZZ.               00940000
010100     05  FILLER                          PIC  X(03)  VALUE SPACE. 00950000
010200     05  DL-VE-DATE.                                              00960000
010300         10  DL-VE-MONTH                 PIC  9(02)  VALUE ZEROS. 00970000
010400         10  DL-VE-SLASH1                PIC  X(01)  VALUE SPACE. 00980000
010500         10  DL-VE-DAY                   PIC  9(02)  VALUE ZEROS. 00990000
010600         10  DL-VE-SLASH2                PIC  X(01)  VALUE SPACE. 01000000
010700         10  DL-VE-CENTURY               PIC  9(02)  VALUE ZEROS. 01010000
010800         10  DL-VE-YEAR                  PIC  9(02)  VALUE ZEROS. 01010000
010900     05  FILLER                          PIC  X(03)  VALUE SPACE. 01020000
011000     05  DL-LINE-NBR                     PIC  9(03)  VALUE ZEROS. 01030000
011100     05  FILLER                          PIC  X(01)  VALUE SPACE. 01040000
011200     05  DL-MERCH-ITEM-NBR               PIC  ZZZZZZZZZZZZZZZ.    01050000
011300     05  FILLER                          PIC  X(02)  VALUE SPACE. 01060000
011400     05  DL-CREATE-DATE.                                          01070000
011500         10  DL-CRTE-MONTH               PIC  9(02)  VALUE ZEROS. 01080000
011600         10  DL-CRTE-SLASH1              PIC  X(01)  VALUE SPACE. 01090000
011700         10  DL-CRTE-DAY                 PIC  9(02)  VALUE ZEROS. 01100000
011800         10  DL-CRTE-SLASH2              PIC  X(01)  VALUE SPACE. 01110000
011900         10  DL-CRTE-CENTURY             PIC  9(02)  VALUE ZEROS. 01120000
012000         10  DL-CRTE-YEAR                PIC  9(02)  VALUE ZEROS. 01120000
012100     05  FILLER                          PIC  X(01)  VALUE SPACE. 01130000
012200     05  DL-CREATE-TIME.                                          01140000
012300         10  DL-CRTE-HOURS               PIC  9(02)  VALUE ZEROS. 01150000
012400         10  DL-CRTE-COLON1              PIC  X(01)  VALUE SPACE. 01160000
012500         10  DL-CRTE-MINUTES             PIC  9(02)  VALUE ZEROS. 01170000
012600         10  DL-CRTE-COLON2              PIC  X(01)  VALUE SPACE. 01180000
012700         10  DL-CRTE-SECONDS             PIC  9(02)  VALUE ZEROS. 01190000
012800     05  FILLER                          PIC  X(02)  VALUE SPACE. 01200000
012900     05  DL-ACT-CODE                     PIC  X(02)  VALUE SPACE. 01210000
013000     05  FILLER                          PIC  X(02)  VALUE SPACE. 01220000
013100     05  DL-USERID                       PIC  X(08)  VALUE SPACE. 01230000
013200     05  FILLER                          PIC  X(02)  VALUE SPACE. 01240000
013300     05  DL-UPC-NUMBER                   PIC  ZZZZZZZZZZZZZZZ.    01250000
013400     05  FILLER                          PIC  X(03)  VALUE SPACE. 01260000
013500     05  DL-FUNC-CODE                    PIC  X(01)  VALUE SPACE. 01270000
013600     05  FILLER                          PIC  X(03)  VALUE SPACE. 01280000
013700     05  DL-PROC-AREA                    PIC  X(04)  VALUE SPACE. 01290000
013800     05  FILLER                          PIC  X(02)  VALUE SPACE. 01300000
013900     05  DL-SCANN-NBR                    PIC  ZZZZZZZZZZZZZZZ.    01310000
014000                                                                  01320000
014100 01  TOTAL-REPORT-LINE.                                           01330000
014200     05  FILLER                          PIC  X(04)  VALUE SPACE. 01340000
014300     05  FILLER                          PIC  X(55)  VALUE        01350000
014400         'TOTAL NUMBER OF UPC CERTIFICATION REQUESTS DELETED = '. 01360000
014500     05  TL-TOTAL-DELETED                PIC  ZZ,ZZ9 VALUE ZEROS. 01370000
014600     05  FILLER                          PIC  X(67)  VALUE SPACE. 01380000
014700                                                                  01390000
014800 01  END-OF-REPORT-LINE.                                          01400000
014900     05  FILLER                          PIC  X(57)  VALUE SPACE. 01410000
015000     05  FILLER                          PIC  X(21)  VALUE        01420000
015100         '*** END OF REPORT ***'.                                 01430000
015200     05  FILLER                          PIC  X(54)  VALUE SPACE. 01440000
015300                                                                  01450000
015400 01  HL1-HEADING-LINE-1.                                          01460000
015500     05  FILLER                          PIC  X(50)  VALUE SPACE. 01470000
015600     05  FILLER                          PIC  X(32)  VALUE        01480000
015700         'UPC CERTIFICATION REQUEST DELETE'.                      01490000
015800     05  FILLER                          PIC  X(50)  VALUE SPACE. 01500000
015900                                                                  01510000
016000 01  HL12-HEADING-LINE-12.                                        01520000
016100     05  FILLER                          PIC  X(10)  VALUE        01530000
016200         'OPER ID:  '.                                            01540000
016300     05  HL12-OPER-ID                    PIC  9(04)  VALUE ZEROS. 01550000
016400     05  FILLER                          PIC  X(118) VALUE SPACE. 01560000
016500                                                                  01570000
016600 01  HL2-HEADING-LINE-2.                                          01580000
016700     05  FILLER                          PIC  X(46)  VALUE        01590000
016800         '   PO     REC    VERIFIED    LNE  MERCHANDISE '.        01600000
016900     05  FILLER                          PIC  X(24)  VALUE SPACE. 01610000
017000     05  FILLER                          PIC  X(53)  VALUE        01620000
017100         'ACT   CREATE                    FUNC PROC   SCANNING'.  01630000
017200     05  FILLER                          PIC  X(10)  VALUE SPACE. 01640000
017300                                                                  01650000
017400 01  HL3-HEADING-LINE-3.                                          01660000
017500     05  FILLER                          PIC  X(49)  VALUE        01670000
017600         ' NUMBER   SEQ      DATE      NBR  LINE ITEM NMBR '.     01680000
017700     05  FILLER                          PIC  X(49)  VALUE        01690000
017800         '   CREATE DATE/TIME  CDE   USERID      UPC NUMBER'.     01700000
017900     05  FILLER                          PIC  X(27)  VALUE        01710000
018000         '    CODE AREA   ITEM NUMBER'.                           01720000
018100     05  FILLER                          PIC  X(07)  VALUE SPACE. 01730000
018200                                                                  01740000
018300                                                                  01750000
018400 01  PC-PROGRAM-CONSTANTS.                                        01760000
018500     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01770000
018600         'MPKUP028'.                                              01780000
018700     05  PC-PAGE-SIZE                    PIC S9(04)  VALUE +60    01790000
018800                                                     COMP SYNC.   01800000
018900     05  PC-COLON                        PIC  X(01)  VALUE ':'.   01810000
019000     05  PC-SLASH                        PIC  X(01)  VALUE '/'.   01820000
019100     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     01830000
019200                                                     COMP SYNC.   01840000
019300     05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   01850000
019400                                                     COMP SYNC.   01860000
019500     05  PC-CENTURY-PIVOT-YEAR           PIC 9(2)    VALUE 80.    01870000
019600                                                                  01880000
019700 01  PS-PROGRAM-SWITCHES.                                         01890000
019800     05  PS-END-CSR-SW                   PIC  X(01)  VALUE 'N'.   01900000
019900         88  PS-END-CSR-YES                          VALUE 'Y'.   01910000
020000     05  PS-PO-NOT-FOUND-IND             PIC  X(01)  VALUE 'N'.   01900000
020100         88  PS-PO-NOT-FOUND                         VALUE 'Y'.   01910000
020200     05  PS-DELETE-PO-IND                PIC  X(01)  VALUE 'N'.   01920000
020300         88  PS-DELETE-PO                            VALUE 'Y'.   01930000
020400     05  PS-PRINT-PO-IND                 PIC  X(01)  VALUE 'N'.   01940000
020500         88  PS-PRINT-PO                             VALUE 'Y'.   01950000
020600                                                                  01960000
020700 01  PV-PROGRAM-VARIABLES.                                        01970000
020800     05  PV-FETCH-COUNT                  PIC S9(09)  VALUE ZERO           
020900                                                     COMP.        01990000
021000     05  PV-DELETE-COUNT                 PIC S9(09)  VALUE ZERO           
021100                                                     COMP.        01990000
021200     05  PV-COMMIT-TRIGGER               PIC S9(09)  VALUE ZERO           
021300                                                     COMP.        01990000
021400     05  PV-COMMIT-COUNTER               PIC S9(09)  VALUE ZERO           
021500                                                     COMP.        01990000
021600     05  PV-DISP-NBR                     PIC Z,ZZZ,ZZ9.                   
021700     05  PV-DELETE-REQUEST-COUNTER       PIC S9(05)  VALUE +0     02000000
021800                                                     COMP-3.      02010000
021900     05  PV-PAGE-COUNT                   PIC S9(04)  VALUE +0     02020000
022000                                                     COMP.        02030000
022100     05  PV-LINE-COUNT                   PIC S9(04)  VALUE +0     02040000
022200                                                     COMP.        02050000
022300     05  PV-ADVANCE-COUNT                PIC S9(04)  VALUE +0     02060000
022400                                                     COMP.        02070000
022500     05  PV-RETRY-COUNT                  PIC S9(04)  VALUE +0     02100000
022600                                                     COMP SYNC.   02110000
022700     05  PV-VE-DATE                      PIC  X(26)  VALUE ZERO.  02120000
022800     05  PV-VE-DATE-R   REDEFINES   PV-VE-DATE.                   02130000
022900         10  PV-VE-CC                    PIC  99.                 02140000
023000         10  PV-VE-YY                    PIC  99.                 02150000
023100         10  FILLER                      PIC  X(01).              02160000
023200         10  PV-VE-MM                    PIC  99.                 02170000
023300         10  FILLER                      PIC  X(01).              02180000
023400         10  PV-VE-DD                    PIC  99.                 02190000
023500         10  FILLER                      PIC  X(16).              02200000
023600     05  PV-VERIFIED-DTE.                                         02230000
023700         10  PV-VERIFIED-CC              PIC  9(02).              02231000
023800         10  PV-VERIFIED-YY              PIC  9(02).              02232000
023900         10  PV-VERIFIED-MM              PIC  9(02).              02240000
024000         10  PV-VERIFIED-DD              PIC  9(02).              02250000
024100     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 02270000
024200     05  PV-UNPACK-NUMBER                PIC  S9(15) VALUE ZERO.  02280000
024300     05  PV-PO-NBR                       PIC  S9(8)  VALUE ZERO   02290000
024400                                                     COMP.        02300000
024500     05  PV-REC-SEQ                      PIC  S9(4)  VALUE ZERO   02310000
024600                                                     COMP.        02320000
024700     05  PV-OPER-UNT-ID                  PIC  S9(4)  VALUE ZERO   02330000
024800                                                     COMP.        02340000
024900     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 02350000
025000*                                                                 02351014
025100     05  PV-CURR-UPCCER-RECEIVER.                                 02351114
025200         10  PV-CURR-UPCCER-PO-NBR       PIC  9(08)  VALUE ZEROS. 02352013
025300         10  PV-CURR-UPCCER-REC-SEQ      PIC  9(04)  VALUE ZEROS. 02353013
025400*                                                                 02353114
025500     05  PV-COMP-RECEIVER.                                        02354014
025600         10  PV-COMP-PO-NBR              PIC  9(08)  VALUE ZEROS. 02355013
025700         10  PV-COMP-REC-SEQ             PIC  9(04)  VALUE ZEROS. 02356013
025800*                                                                 02357014
025900     05  PV-TIMESTAMP.                                            02360000
026000         10  PV-TMESTP-CENTURY           PIC  X(02).              02370000
026100         10  PV-TMESTP-YEAR              PIC  X(02).              02380000
026200         10  FILLER                      PIC  X(01).              02390000
026300         10  PV-TMESTP-MONTH             PIC  X(02).              02400000
026400         10  FILLER                      PIC  X(01).              02410000
026500         10  PV-TMESTP-DAY               PIC  X(02).              02420000
026600         10  FILLER                      PIC  X(01).              02430000
026700         10  PV-TMESTP-HOUR              PIC  X(02).              02440000
026800         10  FILLER                      PIC  X(01).              02450000
026900         10  PV-TMESTP-MINUTES           PIC  X(02).              02460000
027000         10  FILLER                      PIC  X(01).              02470000
027100         10  PV-TMESTP-SECONDS           PIC  X(02).              02480000
027200         10  FILLER                      PIC  X(07).              02490000
027300                                                                  02710000
027400*                                                                 02720000
027500*  DCLGEN FOR THE DB2 TABLE UPC CERTIFICATION REQUEST             02730000
027600*                                                                 02740000
027700     EXEC SQL                                                     02750000
027800         INCLUDE TUPCCER                                          02760000
027900     END-EXEC.                                                    02770000
028000*                                                                 02780000
028100*  DCLGEN FOR THE DB2 TABLE RECEIVER TABLE                        02790000
028200*                                                                 02800000
028300     EXEC SQL                                                     02810000
028400         INCLUDE TRECEIV                                          02820000
028500     END-EXEC.                                                    02830000
028600*                                                                 02840000
028700*  COMMUNICATION AREA FOR DB2                                     02850000
028800*                                                                 02860000
028900     EXEC SQL                                                     02870000
029000         INCLUDE SQLCA                                            02880000
029100     END-EXEC.                                                    02890000
029200*                                                                 02900000
029300*  DB2 COMMUNICATION AREA 2                                       02910000
029400*                                                                 02920000
029500     COPY SQLCA2.                                                 02930000
029600*                                                                 02940000
029700*  SQL DB2 DISTRIBUTION HEADER TABLE CURSOR DECLARATION           02950000
029800*                                                                 02960000
029900     EXEC SQL                                                     02970000
030000         DECLARE UPC_CURSOR CURSOR WITH HOLD FOR                  02980000
030100             SELECT MDSE_LNE_ITM_NBR,                             02990000
030200                    CRE_TMST,                                     03000000
030300                    ACT_CDE,                                      03010000
030400                    OPER_UNT_ID,                                  03020000
030500                    PO_NBR,                                       03030000
030600                    REC_SEQ_NBR,                                  03040000
030700                    PO_LNE_NBR,                                   03050000
030800                    UID_NBR,                                      03060000
030900                    UPC_NBR,                                      03070000
031000                    FUNC_CDE,                                     03080000
031100                    SCAN_ITM_NBR,                                 03090000
031200                    MDSE_PRC_AREA_CDE                             03100000
031300             FROM TUPCCER                                         03110000
031400             ORDER BY OPER_UNT_ID,                                03120000
031500                      PO_NBR,                                     03130000
031600                      REC_SEQ_NBR,                                03140000
031700                      PO_LNE_NBR                                  03150000
031800     END-EXEC.                                                    03160000
031900*                                                                 03170000
032000*  COPY BOOK FOR DB2-FORMATTED-MESSAGE-AREA                       03180000
032100*                                                                 03190000
032200     COPY DPWS004.                                                03200000
032300                                                                  03210000
032400                                                                  03220000
032500******************************************************************03230000
032600 PROCEDURE DIVISION.                                              03240000
032700******************************************************************03250000
032800                                                                  03260000
032900******************************************************************03270000
033000* 0000-INITIAL-ROUTINE - CONTROLS THE MAIN PROCESSING OF THE      03280000
033100* PROGRAM. INITIALIZES AREAS, OPENS AND CLOSES THE DISTRIBUTION   03290000
033200* TABLE CURSOR, AND FETCHES THE DISTRIBUTION ROWS. FOR EACH       03300000
033300* PO/REC SEQ, THE RECEIPTS DATABASE IS READ TO DETERMINE IF THE   03310000
033400* CONTROL NUMBER IS ELIGIBLE FOR DELETING. IF THE REQUEST IS TO   03320000
033500* BE DELETED THE STORE DETAIL FOR THAT REQUEST IS READ AND AN     03330000
033600* AUDIT TRAIL IS PRINTED.                                         03340000
033700******************************************************************03350000
033800                                                                  03360000
033900 0000-INITIAL-ROUTINE.                                            03370000
034000     PERFORM 1000-INITIALIZE.                                     03380000
034100                                                                  03470000
034200     PERFORM 3000-READ-RECEIPTS-DATABASE.                         03460000
034300     MOVE UPCCER-PO-NBR               TO PV-COMP-PO-NBR           03651013
034400     MOVE UPCCER-REC-SEQ-NBR          TO PV-COMP-REC-SEQ          03661013
034500                                                                  03470000
034600     PERFORM                                                      03480000
034700         UNTIL PS-END-CSR-YES                                     01910000
034800         MOVE SPACES TO DL-DETAIL-LINE                            03500000
034900         IF  UPCCER-OPER-UNT-ID = PV-OPER-UNT-ID                  03510000
035000             CONTINUE                                             03520000
035100         ELSE                                                     03530000
035200            PERFORM 7200-WRITE-END-OF-REPORT-LINE                 03540000
035300            MOVE UPCCER-OPER-UNT-ID TO HL12-OPER-ID               03550000
035400                                       PV-OPER-UNT-ID             03560000
035500            PERFORM 7300-WRITE-HEADING-LINES                      03570000
035600            MOVE ZERO TO PV-DELETE-REQUEST-COUNTER                03580000
035700         END-IF                                                   03590000
035800         IF (PV-CURR-UPCCER-RECEIVER NOT = PV-COMP-RECEIVER)      03602016
035900             IF PS-DELETE-PO                                      03610000
036000                 PERFORM 8000-DELETE-UPC-REQUEST-ROWS             03620000
036100             END-IF                                               03630000
036200             MOVE 'N' TO PS-DELETE-PO-IND                         03640000
036300             MOVE UPCCER-PO-NBR      TO PV-PO-NBR                 03650000
036400                                        PV-COMP-PO-NBR            03651013
036500             MOVE UPCCER-REC-SEQ-NBR TO PV-REC-SEQ                03660000
036600                                        PV-COMP-REC-SEQ           03661013
036700             PERFORM 3000-READ-RECEIPTS-DATABASE                  03670000
036800         END-IF                                                   03680000
036900         IF (PV-CURR-UPCCER-RECEIVER = PV-COMP-RECEIVER)          03701013
037000             IF PS-DELETE-PO                                      03710000
037100                 PERFORM 4000-FORMAT-DETAIL-LINES                 03720000
037200                 ADD 1 TO PV-DELETE-REQUEST-COUNTER               03730000
037300             END-IF                                               03740000
037400         END-IF                                                   03750000
037500         PERFORM 2000-FETCH-UPC-REQUEST-ROWS                      03760000
037600     END-PERFORM.                                                 03770000
037700                                                                  03780000
037800     PERFORM 9200-CLOSE-UPC-CURSOR.                               03790000
037900     PERFORM 7200-WRITE-END-OF-REPORT-LINE.                       03800000
038000                                                                  03810000
038100     PERFORM 9000-EOJ-ROUTINE.                                    03820000
038200     GOBACK.                                                      03830000
038300                                                                  03840000
038400*0000-EXIT.                                                       03850000
038500                                                                  03860000
038600                                                                  03870000
038700******************************************************************03880000
038800* 1000-INITIALIZE - OPENS THE REPORT FILE AND ACCEPTS THE CPU     03890000
038900* DATE AND TIME, ALONG WITH THE PRINTING OF THE REPORT HEADING    03900000
039000* DETAIL LINES.                                                   03910000
039100******************************************************************03920000
039200                                                                  03930000
039300 1000-INITIALIZE.                                                 03940000
039400     ACCEPT CC-CONTROL-CARD.                                      03950000
039500                                                                  03960000
039600     IF CC-NUM-DELETE-DAYS NOT NUMERIC                            03970000
039700         DISPLAY 'CONTROL CARD MUST BE NUMERIC'                   03980000
039800         DISPLAY 'CONTROL CARD = ' CC-CONTROL-CARD                03990000
039900         MOVE +4003 TO ABEND-CODE                                 04000000
040000         CALL 'ILBOABN0' USING ABEND-CODE                         04010000
040100     ELSE                                                         04020000
040200         DISPLAY 'NUMBER OF EXTENDED DAYS FOR DELETES = '         04030000
040300                     CC-CONTROL-CARD                              04040000
040400     END-IF.                                                      04050000
040500                                                                  04060000
040600     OPEN OUTPUT UPC-CERT-REQUEST-DELETE-REPORT.                  04070000
040700                                                                  04080000
040800     ACCEPT CD-CPU-DATE     FROM DATE.                            04090000
040900     MOVE CD-YEAR                  TO  CD-YEAR-CC.                04091000
041000     IF CD-YEAR > PC-CENTURY-PIVOT-YEAR                           04091100
041100         SET CD-20TH-CENTURY       TO  TRUE                       04091200
041200     ELSE                                                         04091300
041300         SET CD-21ST-CENTURY       TO  TRUE                       04091400
041400     END-IF.                                                      04091500
041500     MOVE CD-MONTH                 TO  CD-MONTH-CC.               04092000
041600     MOVE CD-DAY                   TO  CD-DAY-CC.                 04093000
041700     ACCEPT CT-CPU-TIME     FROM TIME.                            04110000
041800                                                                  04120000
041900     MOVE CD-YEAR                  TO  DP132O-RUN-YEAR.           04130000
042000     MOVE CD-MONTH                 TO  DP132O-RUN-MONTH.          04140000
042100     MOVE CD-DAY                   TO  DP132O-RUN-DAY.            04150000
042200     MOVE CT-HOUR                  TO  DP132O-RUN-HOUR.           04160000
042300     MOVE CT-MINUTE                TO  DP132O-RUN-MINUTE.         04170000
042400     MOVE 'MPKUP028'               TO  DP132O-PROGRAM-NAME.       04180000
042500                                                                  04190000
042600     PERFORM 9100-OPEN-UPC-CURSOR.                                04200000
042700     PERFORM 2000-FETCH-UPC-REQUEST-ROWS.                         04210000
042800     MOVE UPCCER-OPER-UNT-ID TO HL12-OPER-ID                      04220000
042900                                PV-OPER-UNT-ID.                   04230000
043000     MOVE UPCCER-PO-NBR      TO PV-PO-NBR.                        04240017
043100     MOVE UPCCER-REC-SEQ-NBR TO PV-REC-SEQ.                       04250017
043200     MOVE 'N'           TO PS-DELETE-PO-IND.                      04260000
043300     PERFORM 7300-WRITE-HEADING-LINES.                            04270000
043400*1000-EXIT.                                                       04280000
043500                                                                  04290000
043600                                                                  04300000
043700******************************************************************04310000
043800* 2000-FETCH-UPC-REQUEST-ROWS - FETCHS THE UPC CERTIFICATION      04320000
043900* REQUEST ROWS AND CHECKS THE DB2 STATUS CODE.                    04330000
044000******************************************************************04340000
044100                                                                  04350000
044200 2000-FETCH-UPC-REQUEST-ROWS.                                     04360000
044300     INITIALIZE DCLTUPCCER.                                       04370000
044400                                                                  04380000
044500     PERFORM                                                      04390000
044600         WITH TEST AFTER                                          04400000
044700             VARYING PV-RETRY-COUNT                               04410000
044800             FROM 1 BY 1                                          04420000
044900             UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES               04430000
045000                OR  SQLCODE = 0                                   04440000
045100                OR  SQLCODE = +100)                               04450000
045200         EXEC SQL                                                 04460000
045300             FETCH UPC_CURSOR                                     04470000
045400             INTO  :UPCCER-MDSE-LNE-ITM-NBR,                      04480000
045500                   :UPCCER-CRE-TMST,                              04490000
045600                   :UPCCER-ACT-CDE,                               04500000
045700                   :UPCCER-OPER-UNT-ID,                           04510000
045800                   :UPCCER-PO-NBR,                                04520000
045900                   :UPCCER-REC-SEQ-NBR,                           04530000
046000                   :UPCCER-PO-LNE-NBR,                            04540000
046100                   :UPCCER-UID-NBR,                               04550000
046200                   :UPCCER-UPC-NBR,                               04560000
046300                   :UPCCER-FUNC-CDE,                              04570000
046400                   :UPCCER-SCAN-ITM-NBR,                          04580000
046500                   :UPCCER-MDSE-PRC-AREA-CDE                      04590000
046600         END-EXEC                                                 04600000
046700                                                                  04610000
046800         EVALUATE TRUE                                            04620000
046900             WHEN SQLCODE = ZERO                                  04621017
047000                 MOVE UPCCER-PO-NBR                               04625117
047100                                   TO PV-CURR-UPCCER-PO-NBR       04625217
047200                 MOVE UPCCER-REC-SEQ-NBR                          04625317
047300                                   TO PV-CURR-UPCCER-REC-SEQ      04626017
047400                 ADD 1             TO PV-FETCH-COUNT                      
047500             WHEN SQLCODE = +100                                  04650000
047600                 SET PS-END-CSR-YES   TO TRUE                     01910000
047700             WHEN SQLCODE = -904                                  04630000
047800             WHEN SQLCODE = -913                                  04640000
047900                 CONTINUE                                         04670000
048000             WHEN SQLCODE < ZERO                                  04680000
048100             WHEN SQLCODE > ZERO                                  04690000
048200             WHEN SQLWARN0 NOT = SPACES                           04700000
048300                 MOVE '2000-FETCH-UPC-REQUEST-ROWS'               04710000
048400                                   TO PV-PARAGRAPH-NAME           04720017
048500                 MOVE 'FETCH OF TUPCCER '                         04730000
048600                                   TO PV-DB2-OPERATION-ATTEMPTED  04740017
048700                 PERFORM 9300-SQL-ERROR                           04750000
048800         END-EVALUATE                                             04760000
048900     END-PERFORM.                                                 04770000
049000                                                                  04780000
049100     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           04790000
049200         MOVE '2000-FETCH-UPC-REQUEST-ROWS'                       04800000
049300             TO PV-PARAGRAPH-NAME                                 04810000
049400         MOVE 'DEADLOCK * FETCH TUPCCER'                          04820000
049500             TO PV-DB2-OPERATION-ATTEMPTED                        04830000
049600         PERFORM 9300-SQL-ERROR                                   04840000
049700     END-IF.                                                      04850000
049800*2000-EXIT.                                                       04860000
049900                                                                  04870000
050000                                                                  04880000
050100******************************************************************04890000
050200* 3000-READ-RECEIPTS-DATABASE - FOR EACH KEYREC IN THE UPC        04900000
050300* CERTIFICATION TABLE, THE RECEIPTS DATABASE IS ACCESSED TO DETER-04910000
050400* MINE IF THE DELETE CRITERA IS MET. UPC CERTIFICATION REQUEST ARE04920000
050500* DELETED WHEN A KEYREC HAS A STATUS OF VOID OR DELETED.  IF THE  04930000
050600* STATUS IS SHIPPED AND THE CLOSE DATE IS A SPECIFIED NUMBER OF   04940000
050700* DAYS LESS THAN THE CURRENT DATE THE KEYREC WILL BE DELETED.     04950000
050800******************************************************************04960000
050900                                                                  04970000
051000 3000-READ-RECEIPTS-DATABASE.                                     04980000
051100                                                                  04990000
051200     INITIALIZE DCLTRECEIV.                                       04370000
051300     MOVE 'N'                      TO PS-PO-NOT-FOUND-IND.        05001000
051400     PERFORM WITH TEST AFTER                                      05010000
051500       UNTIL (SQLCODE = ZERO                                      05020000
051600              OR                                                  05030000
051700              SQLCODE = +100                                      05040000
051800              OR                                                  05050000
051900              PV-RETRY-COUNT > PC-MAX-RETRIES)                    05060000
052000                                                                  05070000
052100         EXEC SQL                                                 05080000
052200              SELECT ORD_NBR,                                     05090000
052300                     REC_SEQ_NBR,                                 05100000
052400                     OPER_UNT_ID,                                 05110000
052500                     STATUS_CDE,                                  05120000
052600                     VERFYD_TMST                                  05130000
052700                INTO :RECEIV-ORD-NBR,                             05140000
052800                     :RECEIV-REC-SEQ-NBR,                         05150000
052900                     :RECEIV-OPER-UNT-ID,                         05160000
053000                     :RECEIV-STATUS-CDE,                          05170000
053100                     :RECEIV-VERFYD-TMST                          05180000
053200                FROM TRECEIV                                      05190000
053300               WHERE ORD_NBR        = :PV-PO-NBR                  05200000
053400                 AND REC_SEQ_NBR    = :PV-REC-SEQ                 05210000
053500                 AND VER_STATUS_CDE = 'A'                         05220000
053600         END-EXEC                                                 05230000
053700*                                                                 05240000
053800         EVALUATE TRUE                                            05250000
053900             WHEN SQLCODE = ZERO                                  05260000
054000                  CONTINUE                                        05270000
054100             WHEN SQLCODE = +100                                  05280000
054200                  SET PS-PO-NOT-FOUND TO TRUE                     05290000
054300             WHEN SQLCODE = -904                                  05300000
054400             WHEN SQLCODE = -911                                  05310000
054500                  ADD 1          TO PV-RETRY-COUNT                05320000
054600             WHEN OTHER                                           05330000
054700                  PERFORM 9300-SQL-ERROR                          05340000
054800         END-EVALUATE                                             05350000
054900     END-PERFORM.                                                 05360000
055000                                                                  05370000
055100     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          05380000
055200         MOVE 'MAX RETRIES EXCEEDED FOR TSK SELECT'               05390000
055300                                 TO PV-DB2-OPERATION-ATTEMPTED    05400000
055400         PERFORM 9300-SQL-ERROR                                   05410000
055500     END-IF.                                                      05420000
055600                                                                  05430000
055700     IF SQLCODE = +100                                            05440000
055800         SET PS-PO-NOT-FOUND TO TRUE                              05450000
055900     END-IF.                                                      05460000
056000                                                                  05470000
056100     IF PS-PO-NOT-FOUND                                           05480000
056200         SET PS-PRINT-PO      TO TRUE                             05490000
056300         SET PS-DELETE-PO TO TRUE                                 05500000
056400         INITIALIZE              PV-VE-DATE                             00
056500     ELSE                                                         05520000
056600       IF RECEIV-STATUS-CDE = 'DE'                                05530000
056700           SET PS-PRINT-PO       TO TRUE                          05540000
056800           SET PS-DELETE-PO      TO TRUE                          05550000
056900           INITIALIZE               PV-VE-DATE                          00
057000       ELSE                                                       05570000
057100         IF RECEIV-STATUS-CDE = 'VE'                              05580000
057200             INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56  05581000
057300             MOVE CD-CPU-DATE    TO DPG51-SYSTEM-DATE             05582019
057400             MOVE RECEIV-VERFYD-TMST TO PV-VE-DATE                05590000
057500             MOVE PV-VE-CC TO PV-VERIFIED-CC                      05591000
057600             MOVE PV-VE-YY TO PV-VERIFIED-YY                      05592000
057700             MOVE PV-VE-MM TO PV-VERIFIED-MM                      05600000
057800             MOVE PV-VE-DD TO PV-VERIFIED-DD                      05610000
057900             SET DPG51-INCREMENT-DATE TO TRUE                     05621000
058000             SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE               05621119
058100             MOVE CC-NUM-DELETE-DAYS TO DPG51-INCR-DECR-DAYS-9    05622000
058200             MOVE PV-VERIFIED-DTE TO DPG52-LK-DATE-INPUT          05630000
058300             SET DPG52-LK-DTE-ISO TO TRUE                         05650000
058400             CALL DP500-KOHLS-CALENDAR-ROUTINE USING              05670000
058500                                       DPG51, DPG52, DPG53,       05671000
058600                                       DPG54, DPG55, DPG56        05672000
058700             IF DPG54-NO-ERROR                                    05673020
058800                CONTINUE                                          05674020
058900             ELSE                                                 05675020
059000                DISPLAY '** ABEND **'                             05676020
059100                DISPLAY PC-CURRENT-PROGRAM-NAME                   05677020
059200                DISPLAY                                           05678020
059300                   'ERROR INCREMENTING TRECEIV VERIFIED TMST'     05678120
059400                DISPLAY 'VERIFY DATE: ' PV-VERIFIED-DTE                 20
059500                DISPLAY ' ERROR CODE: ' DPG54-ERROR-IND                 20
059600                DISPLAY ' ERROR MESG: ' DPG54-ERROR-MESSAGE             20
059700                SET ABEND-4008-DATA-ERROR    TO TRUE              05700020
059800                CALL 'ILBOABN0' USING ABEND-CODE                  05710020
059900             END-IF                                               05720020
060000                                                                  05730020
060100             IF  DPG55-DB2-ISO-DATE < CD-CPU-DATE-CC              05810000
060200                 SET PS-PRINT-PO      TO TRUE                     05820000
060300                 SET PS-DELETE-PO TO TRUE                         05830000
060400             END-IF                                               05840000
060500         END-IF                                                   05850000
060600       END-IF                                                     05860000
060700     END-IF.                                                      05870000
060800                                                                  05880000
060900*3000-EXIT.                                                       05890000
061000                                                                  05900000
061100******************************************************************05910000
061200* 4000-FORMAT-DETAIL-LINES - DETAIL LINES FOR THE UPC CERTIFICAT- 05920000
061300* ION REQUEST REPORT IS FORMATTED AND PRINTED.                    05930000
061400******************************************************************05940000
061500                                                                  05950000
061600 4000-FORMAT-DETAIL-LINES.                                        05960000
061700     MOVE SPACES                     TO DL-DETAIL-LINE.           05970000
061800                                                                  05980000
061900     IF PS-PRINT-PO                                               05990000
062000         MOVE UPCCER-PO-NBR          TO DL-PO-NBR                 06000000
062100         MOVE UPCCER-REC-SEQ-NBR     TO DL-REC-SEQ                06010000
062200         IF  PV-VE-DATE NOT = SPACES                                    02
062300             MOVE PV-VE-MM           TO DL-VE-MONTH               06    02
062400             MOVE PV-VE-DD           TO DL-VE-DAY                 06    03
062500             MOVE PV-VE-CC           TO DL-VE-CENTURY             06    04
062600             MOVE PV-VE-YY           TO DL-VE-YEAR                06    04
062700             MOVE PC-SLASH           TO DL-VE-SLASH1              06    05
062800                                        DL-VE-SLASH2              06    06
062900         ELSE                                                           02
063000             MOVE SPACES             TO DL-VE-DATE                06    02
063100         END-IF                                                         02
063200         MOVE 'N'                    TO PS-PRINT-PO-IND           06070000
063300     END-IF.                                                      06080000
063400                                                                  06090000
063500     MOVE UPCCER-PO-LNE-NBR          TO DL-LINE-NBR.              06110000
063600     MOVE UPCCER-MDSE-LNE-ITM-NBR    TO PV-UNPACK-NUMBER.         06120000
063700     MOVE PV-UNPACK-NUMBER           TO DL-MERCH-ITEM-NBR.        06130000
063800     MOVE UPCCER-CRE-TMST            TO PV-TIMESTAMP.             06140000
063900     MOVE PV-TMESTP-MONTH            TO DL-CRTE-MONTH.            06150000
064000     MOVE PV-TMESTP-DAY              TO DL-CRTE-DAY.              06160000
064100     MOVE PV-TMESTP-CENTURY          TO DL-CRTE-CENTURY.          06170000
064200     MOVE PV-TMESTP-YEAR             TO DL-CRTE-YEAR.             06170000
064300     MOVE PC-SLASH                   TO DL-CRTE-SLASH1            06180000
064400                                        DL-CRTE-SLASH2.           06190000
064500     MOVE PV-TMESTP-HOUR             TO DL-CRTE-HOURS.            06200000
064600     MOVE PV-TMESTP-MINUTES          TO DL-CRTE-MINUTES.          06210000
064700     MOVE PV-TMESTP-SECONDS          TO DL-CRTE-SECONDS.          06220000
064800     MOVE PC-COLON                   TO DL-CRTE-COLON1            06230000
064900                                        DL-CRTE-COLON2.           06240000
065000     MOVE UPCCER-ACT-CDE             TO DL-ACT-CODE.              06250000
065100     MOVE UPCCER-UID-NBR             TO DL-USERID.                06260000
065200     MOVE UPCCER-UPC-NBR             TO PV-UNPACK-NUMBER.         06270000
065300     MOVE PV-UNPACK-NUMBER           TO DL-UPC-NUMBER.            06280000
065400     MOVE UPCCER-FUNC-CDE            TO DL-FUNC-CODE.             06290000
065500     MOVE UPCCER-MDSE-PRC-AREA-CDE   TO DL-PROC-AREA.             06300000
065600     MOVE UPCCER-SCAN-ITM-NBR        TO PV-UNPACK-NUMBER.         06310000
065700     MOVE PV-UNPACK-NUMBER           TO DL-SCANN-NBR.             06320000
065800                                                                  06330000
065900     PERFORM 7000-WRITE-DETAIL-LINE.                              06340000
066000*4000-EXIT.                                                       06350000
066100                                                                  06360000
066200                                                                  06370000
066300                                                                  06380000
066400******************************************************************06390000
066500* 7000-WRITE-DETAIL-LINE1 - WRITES A DETAIL LINE AND COMPUTES THE 06400000
066600* LINE COUNT.  DETERMINES IF A PAGE BREAK IS NECESSARY.           06410000
066700******************************************************************06420000
066800                                                                  06430000
066900 7000-WRITE-DETAIL-LINE.                                          06440000
067000     COMPUTE PV-LINE-COUNT =                                      06450000
067100             PV-LINE-COUNT + PV-ADVANCE-COUNT.                    06460000
067200                                                                  06470000
067300     IF (PV-LINE-COUNT + PV-ADVANCE-COUNT) >                      06480000
067400             PC-PAGE-SIZE                                         06490000
067500         INITIALIZE PV-LINE-COUNT                                 06500000
067600         PERFORM 7300-WRITE-HEADING-LINES                         06510000
067700** THIS CODE IS HERE SO THAT THE RECEIVER INFORMATION                   00
067800** (IE. PO, RECEIVER SEQ. NBR, AND VERIFIED DATE) IS ALWAYS             00
067900** DISPLAYED AT THE TOP OF EACH PAGE. THIS IS ESPECIALLY USEFUL         00
068000** IF THE INFORMATION FOR A SINGLE RECEIVER SPANS SEVERAL PAGES.        00
068100         MOVE UPCCER-PO-NBR          TO DL-PO-NBR                         
068200         MOVE UPCCER-REC-SEQ-NBR     TO DL-REC-SEQ                        
068300                                                                          
068400         IF  PV-VE-DATE NOT = SPACES                                      
068500             MOVE PV-VE-MM           TO DL-VE-MONTH                       
068600             MOVE PV-VE-DD           TO DL-VE-DAY                         
068700             MOVE PV-VE-CC           TO DL-VE-CENTURY                     
068800             MOVE PV-VE-YY           TO DL-VE-YEAR                        
068900             MOVE PC-SLASH           TO DL-VE-SLASH1                      
069000                                        DL-VE-SLASH2                      
069100         ELSE                                                             
069200             MOVE SPACES             TO DL-VE-DATE                        
069300         END-IF                                                           
069400     END-IF.                                                      06520000
069500                                                                        00
069600     WRITE UPC-CERT-REQUEST-DELETE-LINE                           06540000
069700         FROM DL-DETAIL-LINE                                      06550000
069800             AFTER ADVANCING PV-ADVANCE-COUNT LINES.              06560000
069900                                                                  06570000
070000*7000-EXIT.                                                       06580000
070100                                                                  06590000
070200                                                                  06600000
070300******************************************************************06610000
070400* 7200-WRITE-END-OF-REPORT-LINE - WRITES THE TOTAL UPC CERTIFICAT-06620000
070500* ION REQUEST DELETED LINE AND THE KOHLS STANDARD END OF REPORT   06630000
070600* LINE VERIFYING IT WILL STILL FIT ON THE PAGE.                   06640000
070700******************************************************************06650000
070800                                                                  06660000
070900 7200-WRITE-END-OF-REPORT-LINE.                                   06670000
071000     IF (PV-LINE-COUNT + PV-ADVANCE-COUNT) >                      06680000
071100             PC-PAGE-SIZE                                         06690000
071200         INITIALIZE PV-LINE-COUNT                                 06700000
071300         PERFORM 7300-WRITE-HEADING-LINES                         06710000
071400     END-IF.                                                      06720000
071500                                                                  06730000
071600     MOVE SPACES TO UPC-CERT-REQUEST-DELETE-LINE.                 06740000
071700     WRITE UPC-CERT-REQUEST-DELETE-LINE                           06750000
071800             AFTER ADVANCING PV-ADVANCE-COUNT LINES.              06760000
071900                                                                  06770000
072000     MOVE PV-DELETE-REQUEST-COUNTER TO TL-TOTAL-DELETED.          06780000
072100     WRITE UPC-CERT-REQUEST-DELETE-LINE                           06790000
072200         FROM TOTAL-REPORT-LINE                                   06800000
072300             AFTER ADVANCING PV-ADVANCE-COUNT LINES.              06810000
072400                                                                  06820000
072500     MOVE 3 TO PV-ADVANCE-COUNT.                                  06830000
072600     IF (PV-LINE-COUNT + PV-ADVANCE-COUNT) >                      06840000
072700             PC-PAGE-SIZE                                         06850000
072800         INITIALIZE PV-LINE-COUNT                                 06860000
072900         PERFORM 7300-WRITE-HEADING-LINES                         06870000
073000     END-IF.                                                      06880000
073100                                                                  06890000
073200     WRITE UPC-CERT-REQUEST-DELETE-LINE                           06900000
073300         FROM END-OF-REPORT-LINE                                  06910000
073400             AFTER ADVANCING PV-ADVANCE-COUNT LINES.              06920000
073500*7200-EXIT.                                                       06930000
073600                                                                  06940000
073700                                                                  06950000
073800******************************************************************06960000
073900* 7300-WRITE-HEADING-LINES - WRITES ALL HEADING LINES ASSOCIATED  06970000
074000* WITH THE REPORT.                                                06980000
074100******************************************************************06990000
074200                                                                  07000000
074300 7300-WRITE-HEADING-LINES.                                        07010000
074400     MOVE 1             TO DP132O-REPORT-NUMBER.                  07020000
074500     ADD 1              TO PV-PAGE-COUNT.                         07030000
074600     MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    07040000
074700     WRITE UPC-CERT-REQUEST-DELETE-LINE                           07050000
074800         FROM DP132O-STANDRD-HEADER-132-COLS                      07060000
074900             AFTER ADVANCING PAGE.                                07070000
075000                                                                  07080000
075100     WRITE UPC-CERT-REQUEST-DELETE-LINE                           07090000
075200         FROM HL1-HEADING-LINE-1                                  07100000
075300             AFTER ADVANCING 1 LINES.                             07110000
075400                                                                  07120000
075500     WRITE UPC-CERT-REQUEST-DELETE-LINE                           07130000
075600         FROM HL12-HEADING-LINE-12                                07140000
075700             AFTER ADVANCING 2 LINES.                             07150000
075800                                                                  07160000
075900     WRITE UPC-CERT-REQUEST-DELETE-LINE                           07170000
076000         FROM HL2-HEADING-LINE-2                                  07180000
076100             AFTER ADVANCING 2 LINES.                             07190000
076200                                                                  07200000
076300     WRITE UPC-CERT-REQUEST-DELETE-LINE                           07210000
076400         FROM HL3-HEADING-LINE-3                                  07220000
076500             AFTER ADVANCING 1 LINES.                             07230000
076600                                                                  07240000
076700     MOVE SPACES TO UPC-CERT-REQUEST-DELETE-LINE.                 07250000
076800     WRITE UPC-CERT-REQUEST-DELETE-LINE                           07260000
076900             AFTER ADVANCING 1 LINES.                             07270000
077000                                                                  07280000
077100     MOVE 1 TO PV-ADVANCE-COUNT.                                  07290000
077200     MOVE 5 TO PV-LINE-COUNT.                                     07300000
077300*7300-EXIT.                                                       07310000
077400                                                                  07320000
077500******************************************************************07350000
077600* 8000-DELETE-UPC-REQUEST-ROWS - DELETES THE UPC CERTIFICATION    07360009
077700* REQUEST ROWS ALONG WITH CHECKING THE DB2 SQLCODE.               07370000
077800******************************************************************07380000
077900*                                                                 07390000
078000 8000-DELETE-UPC-REQUEST-ROWS.                                    07400009
078100                                                                  07410000
078200     PERFORM                                                      07420000
078300         WITH TEST AFTER                                          07430000
078400         VARYING PV-RETRY-COUNT                                   07440000
078500         FROM 1 BY 1                                              07450000
078600         UNTIL (PV-RETRY-COUNT > PC-MAX-RETRIES                   07460000
078700                   OR SQLCODE = 0                                 07470000
078800                   OR SQLCODE = +100)                             07480000
078900                                                                          
079000         EXEC SQL                                                 07500000
079100             DELETE                                               07510000
079200                 FROM  TUPCCER                                    07520000
079300                 WHERE PO_NBR      = :PV-PO-NBR                   07530000
079400                   AND REC_SEQ_NBR = :PV-REC-SEQ                  07540000
079500         END-EXEC                                                 07550000
079600                                                                  07560000
079700         EVALUATE TRUE                                            07570000
079800             WHEN SQLCODE = 0                                     07580000
079900                 ADD SQLERRD(3)       TO PV-DELETE-COUNT                  
080000                                         PV-COMMIT-TRIGGER                
080100                 IF PV-COMMIT-TRIGGER > 1000                              
080200                     EXEC SQL                                             
080300                         COMMIT                                           
080400                     END-EXEC                                             
080500                     ADD 1            TO PV-COMMIT-COUNTER                
080600                     MOVE ZERO        TO PV-COMMIT-TRIGGER                
080700                 END-IF                                                   
080800             WHEN SQLCODE = -904                                  07600000
080900             WHEN SQLCODE = -913                                  07610000
081000             WHEN SQLCODE = +100                                  07620000
081100                 CONTINUE                                         07630000
081200             WHEN SQLCODE < 0                                     07640000
081300             WHEN SQLCODE > 0                                     07650000
081400             WHEN SQLWARN0 = 'W'                                  07660000
081500                 MOVE '8000-DELETE-UPC-REQUEST-ROWS'              07670009
081600                             TO PV-PARAGRAPH-NAME                 07680000
081700                 MOVE 'DELETE OF TUPCCER'                         07690000
081800                             TO PV-DB2-OPERATION-ATTEMPTED        07700000
081900                 PERFORM 9300-SQL-ERROR                           07710000
082000         END-EVALUATE                                             07720000
082100     END-PERFORM.                                                 07730000
082200                                                                  07740000
082300     IF PV-RETRY-COUNT > PC-MAX-RETRIES                           07750000
082400         MOVE '8000-DELETE-UPC-REQUEST-ROWS'                      07760009
082500             TO PV-PARAGRAPH-NAME                                 07770000
082600         MOVE 'DEADLOCK * DELETE TUPCCER'                         07780000
082700             TO PV-DB2-OPERATION-ATTEMPTED                        07790000
082800         PERFORM 9300-SQL-ERROR                                   07800000
082900     END-IF.                                                      07810000
083000                                                                  07820000
083100*8000-EXIT.                                                       07830009
083200                                                                  07840000
083300                                                                  07850000
083400******************************************************************07860000
083500* 9000-EOJ-ROUTINE - CLOSES THE FILE ASSOCIATED WITH THE JOB.     07870000
083600******************************************************************07880000
083700                                                                  07890000
083800 9000-EOJ-ROUTINE.                                                07900000
083900                                                                          
084000     MOVE PV-FETCH-COUNT              TO PV-DISP-NBR                      
084100     DISPLAY ' UPCCER ROWS FETCHED = ' PV-DISP-NBR                        
084200                                                                          
084300     MOVE PV-DELETE-COUNT             TO PV-DISP-NBR                      
084400     DISPLAY ' UPCCER ROWS DELETED = ' PV-DISP-NBR                        
084500                                                                          
084600     MOVE PV-COMMIT-COUNTER           TO PV-DISP-NBR                      
084700     DISPLAY ' COMMITS TAKEN       = ' PV-DISP-NBR                        
084800                                                                          
084900     CLOSE UPC-CERT-REQUEST-DELETE-REPORT.                        07910000
085000                                                                  07920000
085100*9000-EXIT.                                                       07930000
085200                                                                  07940000
085300                                                                  07950000
085400******************************************************************07960000
085500* 9100-OPEN-UPC-CURSOR - OPENS THE CURSOR FOR THE UPC CERTIFICAT- 07970000
085600*  ION REQUEST TABLE ALONG WITH CHECKING THE DB2 SQLCODE.         07980000
085700******************************************************************07990000
085800                                                                  08000000
085900 9100-OPEN-UPC-CURSOR.                                            08010000
086000     EXEC SQL                                                     08020000
086100         OPEN UPC_CURSOR                                          08030000
086200     END-EXEC.                                                    08040000
086300                                                                  08050000
086400     EVALUATE TRUE                                                08060000
086500         WHEN SQLCODE = ZERO                                      08070000
086600             CONTINUE                                             08080000
086700         WHEN SQLCODE < ZERO                                      08090000
086800         WHEN SQLCODE > ZERO                                      08100000
086900         WHEN SQLWARN0 NOT = SPACES                               08110000
087000             MOVE '9100-OPEN-UPC-CURSOR'                          08120000
087100                 TO PV-PARAGRAPH-NAME                             08130000
087200             MOVE 'OPEN OF TUPCCER'                               08140000
087300                 TO PV-DB2-OPERATION-ATTEMPTED                    08150000
087400             PERFORM 9300-SQL-ERROR                               08160000
087500     END-EVALUATE.                                                08170000
087600*9100-EXIT.                                                       08180000
087700                                                                  08190000
087800                                                                  08200000
087900******************************************************************08210000
088000* 9200-CLOSE-UPC-CURSOR - CLOSES THE CURSOR FOR THE UPC           08220000
088100* CERTIFICATION REQUEST TABLE ALONG WITH CHECKING THE DB2 SQLCODE.08230000
088200******************************************************************08240000
088300                                                                  08250000
088400 9200-CLOSE-UPC-CURSOR.                                           08260000
088500     EXEC SQL                                                     08270000
088600         CLOSE UPC_CURSOR                                         08280000
088700     END-EXEC                                                     08290000
088800                                                                  08300000
088900     EVALUATE TRUE                                                08310000
089000         WHEN SQLCODE = ZERO                                      08320000
089100             CONTINUE                                             08330000
089200         WHEN SQLCODE < ZERO                                      08340000
089300         WHEN SQLCODE > ZERO                                      08350000
089400         WHEN SQLWARN0 NOT = SPACES                               08360000
089500             MOVE '9200-CLOSE-UPC-CURSOR'                         08370000
089600                 TO PV-PARAGRAPH-NAME                             08380000
089700             MOVE 'CLOSE OF TUPCCER'                              08390000
089800                 TO PV-DB2-OPERATION-ATTEMPTED                    08400000
089900                 PERFORM 9300-SQL-ERROR                           08410000
090000     END-EVALUATE.                                                08420000
090100*9200-EXIT.                                                       08430000
090200                                                                  08440000
090300                                                                  08450000
090400******************************************************************08460000
090500* 9300-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      08470000
090600* EVENT THAT AN SQL ERROR CODE OCCURS.                            08480000
090700******************************************************************08490000
090800                                                                  08500000
090900 9300-SQL-ERROR.                                                  08510000
091000     DISPLAY '9300-SQL-ERROR'.                                    08520000
091100     DISPLAY '** ABEND **'.                                       08530000
091200     DISPLAY '** PROGRAM    ** = ' PC-CURRENT-PROGRAM-NAME.       08540000
091300     DISPLAY '** PARAGRAPH  ** = ' PV-PARAGRAPH-NAME.             08550000
091400     DISPLAY '** OPERATON      = ' PV-DB2-OPERATION-ATTEMPTED.    08560000
091500                                                                  08570000
091600     COPY DPPD004.                                                08580000
091700                                                                  08590000
091800     IF SQLCODE NOT = -911                                        08600000
091900         EXEC SQL                                                 08610000
092000             COMMIT                                               08620000
092100         END-EXEC                                                 08630000
092200     END-IF.                                                      08640000
092300                                                                  08650000
092400     MOVE +4013 TO ABEND-CODE.                                    08660000
092500     CALL 'ILBOABN0' USING ABEND-CODE.                            08670000
092600*9300-EXIT.                                                       08680000
092700                                                                  08690000
