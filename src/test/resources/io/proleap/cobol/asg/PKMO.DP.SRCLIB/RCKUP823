000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKUP823.                                         00020000
000300 AUTHOR.        JOE LAROSA.                                       00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  DECEMBER, 2004.                                   00050000
000600 DATE-COMPILED.                                                   00060000
000610                                                                  00061000
000700******************************************************************00070000
000800*    E922 - TROUBLE/PRORATION EDITS                               00080000
000900*           CALLED FROM RCKCS821 USING RCWS823 COMMAREA.          00090000
001000******************************************************************00100000
001001******************************************************************00100100
001002* TOM PRIMEAU 03/12/10 WR#38216                                   00100200
001003*  REMOVED 'PC-E-COMMERCE-DC' VARIABLE FROM WORKING STORAGE       00100300
001004*  ADDED 4 NEW WORKING STORAGE SWITCHED TO HOLD E_BUS_IND         00100400
001005*     FOR THE 4 POTENTIAL LOCATIONS WE WILL BE PROCESSING.        00100500
001006*  ADDED 'XLT_LOC' DCLGEN XLT00010.                               00100600
001007*  ADDED PARAGRAPH 1530-CHECK-FOR-LOCATION TO COLLECT             00100700
001008*     'E_BUS_IND AND LOC_TYPE_CDE.                                00100800
001009*  PARAGRAPH ADDED CHECK FOR THE 4 NEW PS-ECOM SWITCHES WHICH     00100900
001010*      ARE SET BASED ON LOC TYPE INDICATOR 'DC' AND E_BUS_IND     00101000
001020*      ='Y'.                                                      00102000
001030*  MODIFIED 'IF' STATEMENT IN PARAGRAPH 1500- TO NO LONGER USE    00103000
001040*      PC-E-COMMERCE-DC VARIABLE, BUT INSTEAD USE THE NEW         00104000
001050*      SWITCHES:                                                  00105000
001060*        PS-ECOM-SWITCH                                           00106000
001070*        PS-ECOM-SWITCH-CRE                                       00107000
001080*        PS-ECOM-SWITCH-CURR                                      00108000
001090*      THAT HAVE BEEN SET BASED ON THE CALLS TO                   00109000
001100*        XLT_LOC TABLE.                                           00110000
001200*  MODIFIED THE 'IF' STATEMENT IN PARAGRAPH 1510-                 00120000
001300*        TO NO LONGER USE THE PC-E-COMMERCE-DC VARIABLE,          00130000
001400*        BUT INSTEAD USE THE NEW SWITCH PS-ECOM-SWITCH-CURR.      00140000
001500*  ADDED CHECK IN PARA- 3000- TO SEE IF WE NEED TO CALL           00150000
001600*        XLT_LOC FOR THIS UNIT ID.                                00160000
001700*  MODIFIED 'IF' STATEMENT IN PARAGRAPH 3000- TO NO LONGER        00170000
001800*        USE THE HARDCODED 870, BUT INSTEAD USE THE NEW           00180000
001801*        SWITCH PS-ECOM-SWITCH-TM500.                             00180100
001802******************************************************************00180200
001803 ENVIRONMENT DIVISION.                                            00180300
001804 CONFIGURATION SECTION.                                           00180400
001805 SOURCE-COMPUTER.        IBM-3090.                                00180500
001806 OBJECT-COMPUTER.        IBM-3090.                                00180600
001807                                                                  00180700
001808 DATA DIVISION.                                                   00180800
001809******************************************************************00180900
001810 WORKING-STORAGE SECTION.                                         00181000
001900******************************************************************00190000
002000 01  PS-PROGRAM-SWITCHES.                                         00200000
002100     05  PS-DONE-SW                   PIC X(01) VALUE 'N'.        00210000
002200         88  PS-DONE-NO                         VALUE 'N'.        00220000
002300         88  PS-DONE-YES                        VALUE 'Y'.        00230000
002400     05  PS-RULE-DONE-SW              PIC X(01) VALUE 'N'.        00240000
002500         88  PS-RULE-DONE-NO                    VALUE 'N'.        00250000
002600         88  PS-RULE-DONE-YES                   VALUE 'Y'.        00260000
002700     05  PS-END-OF-RULES-SW           PIC X(01) VALUE 'N'.        00270000
002800         88  PS-END-OF-RULES-YES                VALUE 'Y'.        00280000
002900         88  PS-END-OF-RULES-NO                 VALUE 'N'.        00290000
003000     05  PS-END-OF-RULE-ACT-SW        PIC X(01) VALUE 'N'.        00300000
003100         88  PS-END-OF-RULE-ACT-YES             VALUE 'Y'.        00310000
003200         88  PS-END-OF-RULE-ACT-NO              VALUE 'N'.        00320000
003300                                                                  00330000
003400     05  PS-BAD-PACK-RATIO-SW         PIC X(01) VALUE 'N'.        00340000
003500         88  PS-BAD-PACK-RATIO-YES              VALUE 'Y'.        00350000
003600         88  PS-BAD-PACK-RATIO-NO               VALUE 'N'.        00360000
003700     05  PS-BAD-INNER-PACK-SW         PIC X(01) VALUE 'N'.        00370000
003800         88  PS-BAD-INNER-PACK-YES              VALUE 'Y'.        00380000
003900         88  PS-BAD-INNER-PACK-NO               VALUE 'N'.        00390000
004000     05  PS-ANALYST-BAD-PACK-SW       PIC X(01) VALUE 'N'.        00400000
004100         88  PS-ANALYST-BAD-PACK-YES            VALUE 'Y'.        00410000
004200         88  PS-ANALYST-BAD-PACK-NO             VALUE 'N'.        00420000
004300     05  PS-ANALYST-BP-WITHIN-SW      PIC X(01) VALUE 'N'.        00430000
004400         88  PS-ANALYST-BP-WITHIN-YES           VALUE 'Y'.        00440000
004500         88  PS-ANALYST-BP-WITHIN-NO            VALUE 'N'.        00450000
004600     05  PS-PACK-RATIO-MATCH-SW       PIC X(01) VALUE 'N'.        00460000
004700         88  PS-PACK-RATIO-MATCH-NO             VALUE 'N'.        00470000
004800         88  PS-PACK-RATIO-MATCH-YES            VALUE 'Y'.        00480000
004900     05  PS-BEST-CASE-UNITS-SW        PIC X(01) VALUE 'N'.        00490000
005000         88  PS-BEST-CASE-UNITS-NO              VALUE 'N'.        00500000
005100         88  PS-BEST-CASE-UNITS-YES             VALUE 'Y'.        00510000
005200     05  PS-MISS-PACK-LINES-SW        PIC X(01) VALUE 'N'.        00520000
005300         88  PS-MISS-PACK-LINES-NO              VALUE 'N'.        00530000
005400         88  PS-MISS-PACK-LINES-YES             VALUE 'Y'.        00540000
005410     05  PS-PO-RCVR-TRBL-SW           PIC X(01) VALUE 'N'.        00541000
005420         88  PS-PO-RCVR-TRBL-NO                 VALUE 'N'.        00542000
005430         88  PS-PO-RCVR-TRBL-YES                VALUE 'Y'.        00543000
005431     05  PS-ASNS-TO-WMS-SW        PIC X(01) VALUE 'N'.            00543100
005432         88  PS-ASNS-TO-WMS-YES             VALUE 'Y'.            00543200
005433         88  PS-ASNS-TO-WMS-NO              VALUE 'N'.            00543300
005434     05  PS-ECOM-SWITCH           PIC X(01) VALUE SPACES.         00543400
005435         88  PS-ECOM-YES                    VALUE 'Y'.            00543500
005436         88  PS-ECOM-NO                     VALUE 'N'.            00543600
005437     05  PS-ECOM-SWITCH-CRE       PIC X(01) VALUE SPACES.         00543700
005438         88  PS-ECOM-CRE-YES                VALUE 'Y'.            00543800
005439         88  PS-ECOM-CRE-NO                 VALUE 'N'.            00543900
005440     05  PS-ECOM-SWITCH-CURR      PIC X(01) VALUE SPACES.         00544000
005450         88  PS-ECOM-CURR-YES               VALUE 'Y'.            00545000
005460         88  PS-ECOM-CURR-NO                VALUE 'N'.            00546000
005470     05  PS-ECOM-SWITCH-TM500     PIC X(01) VALUE SPACES.         00547000
005480         88  PS-ECOM-TM500-YES              VALUE 'Y'.            00548000
005490         88  PS-ECOM-TM500-NO               VALUE 'N'.            00549000
005500                                                                  00550000
005600 01  PC-PROGRAM-CONSTANTS.                                        00560000
005700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKCS922'. 00570000
005800     05  PC-LOG-QUEUE                 PIC X(04) VALUE 'CSSL'.     00580000
005900                                                                  00590000
006000     05  PC-TMKUP521                  PIC X(08) VALUE 'TMKUP521'. 00600000
006100     05  PC-600                       PIC S9(4) COMP VALUE +600.  00610000
006200     05  PC-OVER                      PIC X(05) VALUE ' OVER'.    00620000
006300     05  PC-SHORT                     PIC X(05) VALUE 'SHORT'.    00630000
006400     05  PC-NEW-STORE                 PIC X(11) VALUE             00640000
006500                                                ' NEW STORE '.    00650000
006600     05  PC-IMPORT                    PIC X(11) VALUE             00660000
006700                                                '   IMPORT  '.    00670000
006800     05  PC-IMPORT-PIC-AD             PIC X(11) VALUE             00680000
006900                                                'IMP PIC AD '.    00690000
006920     05  PC-379                       PIC S9(4) COMP VALUE +379.  00692000
006930     05  PC-406                       PIC S9(4) COMP VALUE +406.  00693000
006940                                                                  00694000
007000                                                                  00700000
007100 01  DK-DATABASE-KEYS.                                            00710000
007200     05  DK-RULE-KEY                  PIC S9(9) COMP.             00720000
007300     05  DK-RULE-SEQ                  PIC S9(4) COMP.             00730000
007400     05  DK-RULE-RESULT               PIC X(01).                  00740000
007500                                                                  00750000
007600 01  PV-PROGRAM-VARIABLES.                                        00760000
007700     05  L                            PIC S9(4) COMP SYNC.        00770000
007800     05  DL                           PIC S9(4) COMP SYNC.        00780000
007900     05  PV-QUEUE-NAME.                                           00790000
008000         10  PV-TERM-ID               PIC X(4).                   00800000
008100         10  PV-TASK-NUMBER           PIC S9(5) COMP-3.           00810000
008200         10  PV-SEQ                   PIC 9.                      00820000
008300     05  PV-NULL-IND1                 PIC S9(4) VALUE ZERO        00830000
008400                                                COMP SYNC.        00840000
008500     05  PV-NULL-IND2                 PIC S9(4) VALUE ZERO        00850000
008600                                                COMP SYNC.        00860000
008700     05  PV-SQLCODE                   PIC Z999-.                  00870000
008800     05  PV-DISP-VALUE                PIC ZZZ9.999-.              00880000
008900     05  PV-DISP-VALUE2               PIC ZZZ,ZZ9.99-.            00890000
009000     05  PV-DISP-VALUE3               PIC ZZZ,ZZ9-.               00900000
009100     05  PV-DISP-RULE-KEY             PIC 9(09).                  00910000
009200     05  PV-DISP-RULE-SEQ             PIC 9(09).                  00920000
009300     05  PV-DISP-TRBL-RSN-CDE         PIC 9(04).                  00930000
009400     05  PV-DISP-ITEM-COUNT           PIC 9(04).                  00940000
009500     05  PV-DISP-PO-NBR               PIC 9(09).                  00950000
009600     05  PV-DISP-STR-NBR              PIC 9(04).                  00960000
009700     05  PV-DISP-NUMERIC-4            PIC 9(04).                  00970000
009800     05  PV-RULE-DISP1                PIC 9(04).                  00980000
009900     05  PV-RULE-DISP2                PIC 9(04).                  00990000
010000     05  PV-ITEM                      PIC S9(4) VALUE ZERO        01000000
010100                                                COMP SYNC.        01010000
010200     05  PV-CICS-RESP                 PIC S9(4) VALUE ZERO        01020000
010300                                                COMP SYNC.        01030000
010400     05  PV-RULE-SEQ                  PIC S9(4).                  01040000
010500     05  PV-RULE-RESULT               PIC X(01).                  01050000
010600         88  PV-RULE-RESULT-TRUE                VALUE 'Y'.        01060000
010700         88  PV-RULE-RESULT-FALSE               VALUE 'N'.        01070000
010710     05  PV-OPER-UNT-ID           PIC S9(04) COMP VALUE +0.       01071000
010800                                                                  01080000
010900** AHP - BEGIN - 04/24/08                                         01090000
011000     05  PV-DB2-COUNT                 PIC S9(09)  VALUE +0        01100000
011100                                                  COMP-3.         01110000
011101** AHP -  END - 04/24/08                                          01110100
011102     05  PV-UNTIED-PACK-LINES         PIC X(01).                  01110200
011103     05  PV-LINE-ODD-UNITS            PIC X(01).                  01110300
011104     05  PV-LINES-MISSING             PIC X(01).                  01110400
011200     05  PV-DIFFERENT-RATIOS          PIC X(01).                  01120000
011300     05  PV-BEST-CASE-ZERO            PIC X(01).                  01130000
011400     05  PV-LINE-ODU-OUT-OF-TOL       PIC X(01).                  01140000
011500     05  PV-PACK-ODU-OUT-OF-TOL       PIC X(01).                  01150000
011600     05  PV-LINE-ODUD-OUT-OF-TOL      PIC X(01).                  01160000
011700     05  PV-PACK-ODUD-OUT-OF-TOL      PIC X(01).                  01170000
011710     05  PV-COPER-UNT-ID          PIC S9(04) COMP VALUE +0.       01171000
011800                                                                  01180000
011900     05  PV-UNIT-PRICE                PIC S9(7)V99.               01190000
012000     05  PV-PACK-PRICE                PIC S9(7)V99.               01200000
012100     05  PV-ITM-RECEIVED              PIC S9(7)V99.               01210000
012200     05  PV-TOT-RECEIVED              PIC S9(7)V99.               01220000
012300     05  PV-TOT-PLAN                  PIC S9(7)V99.               01230000
012400     05  PV-LINE-DOLLARS              PIC S9(7)V99.               01240000
012500     05  PV-PACK-DOLLARS              PIC S9(7)V99.               01250000
012600     05  PV-LINE-OV-AMT               PIC S9(7)V99.               01260000
012700     05  PV-LINE-SH-AMT               PIC S9(7)V99.               01270000
012800     05  PV-TOT-OTR                   PIC 9(07).                  01280000
012900     05  PV-TOTAL-DOLLARS-OVER-SHORT  PIC S9(7)V99.               01290000
013000     05  PV-UNITS-OVER-DOLLARS        PIC S9(7)V99.               01300000
013100     05  PV-UNITS-SHORT-DOLLARS       PIC S9(7)V99.               01310000
013200                                                                  01320000
013300     05  PV-ACCUM-RECD-UNITS          PIC 9(07).                  01330000
013400     05  PV-ACCUM-OTR-UNITS           PIC 9(06).                  01340000
013500     05  PV-ACCUM-RTL-DOLLARS         PIC 9(07)V99.               01350000
013600     05  PV-ACCUM-LINE-OV-QTY         PIC 9(06).                  01360000
013700     05  PV-ACCUM-LINE-OV-AMT         PIC 9(07)V99.               01370000
013800     05  PV-ACCUM-LINE-SH-QTY         PIC 9(06).                  01380000
013900     05  PV-ACCUM-LINE-SH-AMT         PIC 9(07)V99.               01390000
014000     05  PV-ODD-UNIT-DOLLARS          PIC S9(7)V99.               01400000
014100     05  PV-TOT-ODD-UNIT-AMT          PIC S9(7)V99.               01410000
014200     05  PV-TOT-ODD-UNIT-QTY          PIC 9(07).                  01420000
014300     05  PV-TOTAL-LINE-OTR-UNITS      PIC 9(07).                  01430000
014400     05  PV-DISCREPANCY-IND           PIC X(01).                  01440000
014500     05  PV-ALLOC-OUTR-PK-QTY         PIC 9(04).                  01450000
014600     05  PV-ALLOC-OUTR-PACKS          PIC 9(05).                  01460000
014700     05  PV-ALLOC-OUTR-UNITS          PIC 9(04).                  01470000
014800     05  PV-AVG-UNITS                 PIC 9(04)V99.               01480000
014900     05  PV-UNIT-PERCENT              PIC 9(03)V9999.             01490000
015000     05  PV-UNIT-AVERAGE              PIC S9(4)V9999.             01500000
015100     05  PV-RATIO                     PIC 9(03)V99.               01510000
015200     05  PV-ITEM-IDX                  PIC S9(4)  VALUE +0 COMP.   01520000
015300     05  PV-SHIPT-OVRG-PCT            PIC S9(2)V COMP-3.          01530000
015400     05  PV-SHIPT-SHTG-PCT            PIC S9(2)V COMP-3.          01540000
015500     05  PV-TEMP-AMT                  PIC 9(9).                   01550000
015600     05  PV-DC-OPER-UNT-ID            PIC S9(4)  COMP.            01560000
015800     05  PV-PRO-RANDOM                PIC X(03).                  01580000
015900     05  PV-CURRENT-DATE              PIC X(10).                  01590000
016000     05  PV-DISTRO-QTY                PIC 9(07).                  01600000
016100     05  PV-PACKS-GIVEN-OUT           PIC 9(07).                  01610000
016200     05  PV-NUM-STORE-NEED-PACKS      PIC 9(07).                  01620000
016300     05  PV-PACKS-TO-GIVE-OUT         PIC 9(07).                  01630000
016400     05  PV-PACK-REC                  PIC 9(07).                  01640000
016500     05  PV-PACK-OV                   PIC 9(07).                  01650000
016600     05  PV-OLD-STR-CNT               PIC 9(04).                  01660000
016700     05  PV-NEW-STR-CNT               PIC 9(04).                  01670000
016800     05  PV-CS-STR-CNT                PIC 9(04).                  01680000
016900     05  PV-OVRG-STR-CNT              PIC 9(04).                  01690000
017000     05  PV-OVRG-QTY                  PIC 9(07).                  01700000
017100     05  PV-LINE-OV-QTY               PIC 9(07).                  01710000
017200     05  PV-LINE-SH-QTY               PIC 9(07).                  01720000
017300     05  PV-SUM-PACK-UNITS            PIC 9(07).                  01730000
017400     05  PV-SUM-PACK-OTR-UNITS        PIC 9(07).                  01740000
017500     05  PV-MSG-TEXT                  PIC X(17).                  01750000
017600     05  PV-LINE-UNITS                PIC 9(07).                  01760000
017700     05  PV-MISS-LINE-MSG             PIC X(01).                  01770000
017800     05  PV-RATIO-CHG-MSG             PIC X(01).                  01780000
017900     05  PV-TOT-QTY-OV-SH             PIC 9(07).                  01790000
018000     05  PV-ARULAL-STR-CNT            PIC 9(04).                  01800000
018100     05  PV-DISPERSAL-QTY             PIC 9(05).                  01810000
018200     05  PV-PACKS-PLANNED             PIC 9(05).                  01820000
018300     05  PV-REMAINDER                 PIC 9(05)V9999.             01830000
018400                                                                  01840000
018500 01  PV-DISP-REC-COMPONENTS.                                      01850000
018600     05  PV-DISP-REC-LNE-NBR           PIC S9(09)    COMP.        01860000
018700     05  PV-DISP-REC-ITEM-UPC-NBR      PIC S9(15)V   COMP-3.      01870000
018800     05  PV-DISP-REC-ITEM-UPC-INTR-ID  PIC S9(09)    COMP.        01880000
018900     05  PV-DISP-REC-ITEM-UPC-ID       PIC S9(09)    COMP.        01890000
019000     05  PV-DISP-REC-SKU-NBR           PIC S9(08)V   COMP-3.      01900000
019100     05  PV-DISP-REC-CLASS             PIC S9(04)    COMP-3.      01910000
019200     05  PV-DISP-REC-SUBCLASS          PIC S9(04)    COMP-3.      01920000
019300     05  PV-DISP-WEB-ITEM-IND          PIC  X(01).                01930000
019400     05  PV-DISP-REC-ITEM-NBR          PIC S9(15)V   COMP-3.      01940000
019500     05  PV-DISP-REC-CASE-PACK-QTY     PIC S9(04)    COMP.        01950000
019600     05  PV-DISP-REC-PACK-RATO-QTY     PIC S9(04)    COMP.        01960000
019700     05  PV-DISP-REC-INNER-PACK-QTY    PIC S9(04)    COMP.        01970000
019800     05  PV-DISP-ODD-UNIT-QTY          PIC S9(04)    COMP.        01980000
019900     05  PV-DISP-PKSL-ITM-QTY          PIC S9(09)    COMP.        01990000
020000     05  PV-DISP-DTL-CK-ITM-QTY        PIC S9(09)    COMP.        02000000
020100     05  PV-DISP-BEST-CASE-UNITS       PIC S9(09)    COMP.        02010000
020200     05  PV-DISP-DRV-LNE-CDE           PIC  X(01).                02020000
020300*    05  PV-DISP-ODU-PRB-CDE           PIC  X(01).                02030000
020400     05  PV-DISP-PP-NEW-RTL-AMT        PIC S9(07)V99 COMP-3.      02040000
020500     05  PV-DISP-PP-NEW-RTL-GP-AMT     PIC S9(07)V99 COMP-3.      02050000
020600     05  PV-DISP-PP-NEW-RTL-GP-QTY     PIC S9(03)V   COMP-3.      02060000
020700     05  PV-DISP-PP-EFF-DTE            PIC  X(10).                02070000
020800     05  PV-DISP-SK-UNT-RTL-PR-AMT     PIC S9(07)V99 COMP-3.      02080000
020900     05  PV-DISP-SK-GP-RTL-AMT         PIC S9(07)V99 COMP-3.      02090000
021000     05  PV-DISP-SK-GP-QTY             PIC S9(09)    COMP.        02100000
021100     05  PV-DISP-ITEM-DISTRO-QTY       PIC S9(09)    COMP.        02110000
021200     05  PV-DISP-ITEM-DISTRO-OTR-QTY   PIC S9(09)    COMP.        02120000
021300     05  PV-DISP-ITEM-OTR-QTY          PIC S9(09)    COMP.        02130000
021400                                                                  02140000
021500     05  SAVE-TM500-PO-LNE-NBR        PIC S9(9) COMP.             02150000
021600     05  SAVE-TM500-PREPK-ID          PIC S9(4) COMP.             02160000
021700     05  SAVE-TM500-PROCESS-IND       PIC X(03).                  02170000
021800                                                                  02180000
021900 01  RC001-WORK-FIELDS.                                           02190000
022000     05  RC001-LOG-QUEUE              PIC X(04) VALUE 'CSSL'.     02200000
022100     05  RC001-LOG-LINE               PIC X(80) VALUE SPACES.     02210000
022200     05  RC001-CICS-RESPONSE          PIC S9(8) COMP VALUE ZERO.  02220000
022300     05  RC001-SAVE-SQLCODE           PIC S9(8) COMP VALUE ZERO.  02230000
022400                                                                  02240000
022500 01  RC001-ERROR-MESSAGE-LINES.                                   02250000
022600     05  RC001-LINE-01.                                           02260000
022700         10  FILLER                   PIC X(44) VALUE             02270000
022800             '****** RCKCS922 - TROUBLE EDIT ERROR ****** '.      02280000
022900         10  FILLER                   PIC X(03) VALUE SPACES.     02290000
023000         10  FILLER                   PIC X(08) VALUE             02300000
023100                                                'USERID= '.       02310000
023200         10  RC001-USERID             PIC X(07) VALUE SPACES.     02320000
023300         10  FILLER                   PIC X(18) VALUE SPACES.     02330000
023400     05  RC001-LINE-02.                                           02340000
023500         10  RC001-DATE               PIC X(10) VALUE SPACES.     02350000
023600         10  FILLER                   PIC X(02) VALUE SPACES.     02360000
023700         10  RC001-TIME               PIC X(08) VALUE SPACES.     02370000
023800         10  FILLER                   PIC X(02) VALUE SPACES.     02380000
023900         10  FILLER                   PIC X(11) VALUE             02390000
024000                                                'PARAGRAPH= '.    02400000
024100         10  RC001-PARAGRAPH          PIC X(30) VALUE SPACES.     02410000
024200         10  FILLER                   PIC X(02) VALUE SPACES.     02420000
024300         10  FILLER                   PIC X(10) VALUE             02430000
024400                                                ' SQLCODE= '.     02440000
024500         10  RC001-SQLCODE            PIC -999.                   02450000
024600         10  FILLER                   PIC X(01) VALUE SPACES.     02460000
024700     05  RC001-LINE-03.                                           02470000
024800         10  FILLER                   PIC X(14) VALUE             02480000
024900                                                'PO/RCVR/LINE= '. 02490000
025000         10  RC001-PO.                                            02500000
025100             15  RC001-PO-NBR         PIC 9(08) VALUE ZEROES.     02510000
025200         10  FILLER                   PIC X(01) VALUE '/'.        02520000
025300         10  RC001-RCVR.                                          02530000
025400             15  RC001-REC-SEQ-NBR    PIC 9(03) VALUE ZEROES.     02540000
025500         10  FILLER                   PIC X(01) VALUE '/'.        02550000
025600         10  RC001-LINE.                                          02560000
025700             15 RC001-PO-LNE-NBR      PIC 9(03) VALUE ZEROES.     02570000
025800         10  FILLER                   PIC X(03) VALUE SPACES.     02580000
025900         10  FILLER                   PIC X(12) VALUE             02590000
026000                                                'OPER/FCLTY= '.   02600000
026100         10  RC001-OP.                                            02610000
026200             15 RC001-OPER-UNT-ID     PIC 9(04) VALUE ZEROES.     02620000
026300         10  FILLER                   PIC X(01) VALUE '/'.        02630000
026400         10  RC001-FCLTY.                                         02640000
026500             15  RC001-FCLTY-ID       PIC 9(01) VALUE ZEROES.     02650000
026600         10  FILLER                   PIC X(03) VALUE SPACES.     02660000
026700         10  FILLER                   PIC X(06) VALUE             02670000
026800                                                'PACK= '.         02680000
026900         10  RC001-PREPK-ID           PIC 9(04) VALUE ZEROES.     02690000
027000         10  FILLER                   PIC X(03) VALUE SPACES.     02700000
027100         10  FILLER                   PIC X(07) VALUE             02710000
027200                                                'STORE= '.        02720000
027300         10  RC001-STORE-NBR.                                     02730000
027400             15  RC001-STORE-NBR-N    PIC 9(04) VALUE ZEROES.     02740000
027500         10  FILLER                   PIC X(03) VALUE SPACES.     02750000
027600     05  RC001-LINE-04.                                           02760000
027700         10  RC001-SPECIAL-1          PIC X(40) VALUE SPACES.     02770000
027800         10  RC001-SPECIAL-2          PIC X(40) VALUE SPACES.     02780000
027900     05  RC001-LINE-05.                                           02790000
028000         10  FILLER                   PIC X(44) VALUE             02800000
028100             '****** RCKCS922 - TROUBLE EDIT ERROR ****** '.      02810000
028200         10  FILLER                   PIC X(36) VALUE SPACES.     02820000
028300                                                                  02830000
028400 01  TM-TROUBLE-MESSAGES.                                         02840000
028500*MESSAGE FORMAT 1 (PRICE DISCREPANCY).                            02850000
028600*    05  TM-PRICE-DISC-TEXT.                                      02860000
028700*        10  TM-PRICE-DISC-TEXT-1.                                02870000
028800*            15  FILLER               PIC X(15) VALUE             02880000
028900*                                     'PO UNIT RTL  : '.          02890000
029000*            15  TM-MF1-PO-UNT-RTL    PIC ZZZZZZ9.99.             02900000
029100*            15  FILLER               PIC X(15) VALUE             02910000
029200*                                     ' SKU UNIT RTL: '.          02920000
029300*            15  TM-MF1-SKU-UNT-RTL   PIC ZZZZZZ9.99.             02930000
029400*        10  TM-PRICE-DISC-TEXT-2.                                02940000
029500*            15  FILLER               PIC X(21)  VALUE            02950000
029600*                                     'PO GRP QTY   :       '.    02960000
029700*            15  TM-MF1-PO-GP-QTY     PIC ZZZ9.                   02970000
029800*            15  FILLER               PIC X(21)  VALUE            02980000
029900*                                     ' SKU GRP QTY :       '.    02990000
030000*            15  TM-MF1-SKU-GP-QTY    PIC ZZZ9.                   03000000
030100*        10  TM-PRICE-DISC-TEXT-3.                                03010000
030200*            15  FILLER               PIC X(15)  VALUE            03020000
030300*                                     'PO GRP RTL   : '.          03030000
030400*            15  TM-MF1-PO-GP-RTL     PIC ZZZZZZ9.99.             03040000
030500*            15  FILLER               PIC X(15)  VALUE            03050000
030600*                                     ' SKU GRP RTL : '.          03060000
030700*            15  TM-MF1-SKU-GP-RTL    PIC ZZZZZZ9.99.             03070000
030800*        10  FILLER                   PIC X(100) VALUE SPACES.    03080000
030900                                                                  03090000
031000*MESSAGE FORMAT 2 (STORE CLOSED).                                 03100000
031100     05  TM-STR-CLS-TEXT.                                         03110000
031200         10  FILLER                   PIC X(13)  VALUE            03120000
031300                                                 'STORE NUMBER '. 03130000
031400         10  TM-MF2-STR               PIC ZZZ9.                   03140000
031500         10  FILLER                   PIC X(07)  VALUE ' CLOSED'. 03150000
031600         10  FILLER                   PIC X(226) VALUE SPACES.    03160000
031700                                                                  03170000
031800*MESSAGE FORMAT 3 (STORE NOT OPEN).                               03180000
031900     05  TM-STR-NOT-RCVG-TEXT.                                    03190000
032000         10  FILLER                   PIC X(13)  VALUE            03200000
032100                                                 'STORE NUMBER '. 03210000
032200         10  TM-MF3-STR               PIC ZZZ9.                   03220000
032300         10  FILLER                   PIC X(23)  VALUE            03230000
032400             ' NOT OPEN FOR RECEIVING'.                           03240000
032500         10  FILLER                   PIC X(210) VALUE SPACES.    03250000
032600                                                                  03260000
032700*MESSAGE FORMAT 4 (WRONG DC).                                     03270000
032800     05  TM-WRONG-DC-TEXT.                                        03280000
032900         10  FILLER                   PIC X(26)  VALUE            03290000
033000             'WRONG DC FOR STORE NUMBER '.                        03300000
033100         10  TM-MF4-STR               PIC ZZZ9.                   03310000
033200         10  FILLER                   PIC X(220) VALUE SPACES.    03320000
033300                                                                  03330000
033400*MESSAGE FORMAT 5 (LINE STATUS).                                  03340000
033500     05  TM-LINE-STS-TEXT.                                        03350000
033600         10  FILLER                   PIC X(20)  VALUE            03360000
033700             'UNITS RECEIVED:     '.                              03370000
033800         10  TM-MF5-RCVD-QTY          PIC ZZZ9.                   03380000
033900         10  FILLER                   PIC X(226) VALUE SPACES.    03390000
034000                                                                  03400000
034100*MESSAGE FORMAT 6 (ZERO BEST CASE).                               03410000
034200     05  TM-ZERO-BEST-CASE-TEXT.                                  03420000
034300         10  TM-ZERO-BEST-CASE-LINE-1.                            03430000
034400             15  FILLER               PIC X(20)  VALUE            03440000
034500             'ZERO BEST CASE UNITS'.                              03450000
034600             15  FILLER               PIC X(30)  VALUE SPACES.    03460000
034700         10  FILLER                   PIC X(200) VALUE SPACES.    03470000
034800                                                                  03480000
034900*MESSAGE FORMAT 7 (PACK OVER).                                    03490000
035000     05  TM-PACK-OVER-TEXT.                                       03500000
035100         10  TM-PACK-OVER-LINE-1.                                 03510000
035200             15  FILLER               PIC X(09)  VALUE            03520000
035300                                                 'PACK REC:'.     03530000
035400             15  TM-MF7-REC           PIC ZZZZ9.                  03540000
035500             15  FILLER               PIC X(02)  VALUE SPACES.    03550000
035600             15  FILLER               PIC X(09)  VALUE            03560000
035700                                                 'PACK OTR:'.     03570000
035800             15  TM-MF7-OTR           PIC ZZZZ9.                  03580000
035900             15  FILLER               PIC X(03)  VALUE SPACES.    03590000
036000             15  FILLER               PIC X(08)  VALUE            03600000
036100                                                 'PACK OV:'.      03610000
036200             15  TM-MF7-OV-QTY        PIC ZZZ9.                   03620000
036300             15  FILLER               PIC X(01)  VALUE '/'.       03630000
036400             15  TM-MF7-OV-PCT        PIC ZZ9.                    03640000
036500             15  FILLER               PIC X(01)  VALUE '%'.       03650000
036600         10  TM-PACK-OVER-LINE-2.                                 03660000
036700             15  FILLER               PIC X(09)  VALUE            03670000
036800                                                 'PACK RT$:'.     03680000
036900             15  TM-MF7-RT-AMT        PIC $ZZZZ9.99.              03690001
037000             15  FILLER               PIC X(04)  VALUE SPACES.    03700001
037100             15  FILLER               PIC X(18)  VALUE            03710000
037200                                      'TOTAL PACK RT$ OV:'.       03720000
037300             15  TM-MF7-TOT-RT-AMT    PIC $ZZZZZ9.99.             03730001
037400         10  TM-PACK-OVER-LINE-3.                                 03740000
037500             15  FILLER               PIC X(09)  VALUE            03750000
037600                                                 'ODD UNIT:'.     03760000
037700             15  TM-MF7-ODD-QTY       PIC ZZZZ9.                  03770000
037800             15  FILLER               PIC X(10)  VALUE SPACES.    03780001
037900             15  FILLER               PIC X(17)  VALUE            03790000
038000                                      'TOTAL ODD UNIT$: '.        03800000
038100             15  TM-MF7-ODD-AMT       PIC $ZZZZ9.99.              03810001
038200         10  TM-PACK-OVER-LINE-4.                                 03820000
038300             15  TM-MF7-TEXT          PIC X(17).                  03830000
038400             15  FILLER               PIC X(03)  VALUE SPACES.    03840000
038500             15  FILLER               PIC X(20)  VALUE            03850000
038600                                      '#STORES ALLOC/AV UN:'.     03860000
038700             15  TM-MF7-STR-ALLOC     PIC ZZ9.                    03870000
038800             15  FILLER               PIC X(01)  VALUE '/'.       03880000
038900             15  TM-MF7-AVG-UN        PIC ZZ9.99.                 03890000
039000         10  FILLER                   PIC X(50)  VALUE SPACES.    03900000
039100                                                                  03910000
039200*MESSAGE FORMAT 8 (INVALID STORE DISTRO).                         03920000
039300     05  TM-INVALID-STORE-TEXT.                                   03930000
039400         10  TM-BAD-STORE-PLAN-LINE-1.                            03940000
039500             15  FILLER               PIC X(05)  VALUE            03950000
039600                                                 'STR: '.         03960000
039700             15  TM-MF8-STR           PIC ZZZ9.                   03970000
039800             15  FILLER               PIC X(41)  VALUE SPACES.    03980000
039900         10  TM-BAD-STORE-PLAN-LINE-2.                            03990000
040000             15  FILLER               PIC X(20)  VALUE            04000000
040100             'INVALID STORE DISTRO'.                              04010000
040200             15  FILLER               PIC X(30)  VALUE SPACES.    04020000
040300         10  TM-BAD-STORE-PLAN-LINE-3.                            04030000
040400             15  FILLER               PIC X(26)  VALUE            04040000
040500             'CHECK PACKS AND REALLOCATE'.                        04050000
040600             15  FILLER               PIC X(24)  VALUE SPACES.    04060000
040700         10  FILLER                   PIC X(100) VALUE SPACES.    04070000
040800                                                                  04080000
040900*MESSAGE FORMAT 9 (PENDING PRICE CHANGE).                         04090000
041000     05  TM-PRICE-CHG-TEXT.                                       04100000
041100         10  TM-PRICE-CHG-TEXT-1.                                 04110000
041200             15  FILLER               PIC X(15)  VALUE            04120000
041300                                      'PO UNIT RTL  : '.          04130000
041400             15  TM-MF9-PO-UNT-RTL    PIC ZZZZZZ9.99.             04140000
041500             15  FILLER               PIC X(15)  VALUE            04150000
041600                                      ' PPC UNIT RTL: '.          04160000
041700             15  TM-MF9-PTM-UNT-RTL   PIC ZZZZZZ9.99.             04170000
041800         10  TM-PRICE-CHG-TEXT-2.                                 04180000
041900             15  FILLER               PIC X(21)  VALUE            04190000
042000                                      'PO GRP QTY   :       '.    04200000
042100             15  TM-MF9-PO-GP-QTY     PIC ZZZ9.                   04210000
042200             15  FILLER               PIC X(21)  VALUE            04220000
042300                                      ' PPC GRP QTY :       '.    04230000
042400             15  TM-MF9-PPC-GP-QTY    PIC ZZZ9.                   04240000
042500         10  TM-PRICE-CHG-TEXT-3.                                 04250000
042600             15  FILLER               PIC X(15)  VALUE            04260000
042700                                      'PO GRP RTL   : '.          04270000
042800             15  TM-MF9-PO-GP-RTL     PIC ZZZZZZ9.99.             04280000
042900             15  FILLER               PIC X(15)  VALUE            04290000
043000                                      ' PPC GRP RTL : '.          04300000
043100             15  TM-MF9-PPC-GP-RTL    PIC ZZZZZZ9.99.             04310000
043200         10  FILLER                   PIC X(100) VALUE SPACES.    04320000
043300                                                                  04330000
043400*MESSAGE FORMAT 10 (SHORT).                                       04340000
043500     05  TM-SHORT-TEXT.                                           04350000
043600         10  TM-SHORT-TEXT-1.                                     04360000
043700             15  FILLER               PIC X(17)  VALUE            04370000
043800                                      'UNITS RECEIVED:  '.        04380000
043900             15  TM-MF10-RCVD-QTY     PIC ZZZZ9-.                 04390000
044000             15  FILLER               PIC X(04)  VALUE SPACES.    04400000
044100             15  FILLER               PIC X(18)  VALUE            04410000
044200                                      'UNITS OTR:        '.       04420000
044300             15  TM-MF10-OTR-QTY      PIC ZZZZ9.                  04430000
044400         10  TM-SHORT-TEXT-2.                                     04440000
044500             15  FILLER               PIC X(17)  VALUE            04450000
044600                                      'UNITS SHORT   :  '.        04460000
044700             15  TM-MF10-SH-QTY       PIC ZZZZ9-.                 04470000
044800             15  FILLER               PIC X(04)  VALUE SPACES.    04480000
044900             15  FILLER               PIC X(19)  VALUE            04490000
045000                                      'UNITS SHORT %:     '.      04500000
045100             15  TM-MF10-SH-PCT       PIC ZZ9.                    04510000
045200             15  FILLER               PIC X(01)  VALUE '%'.       04520000
045300         10  TM-SHORT-TEXT-3.                                     04530000
045400             15  FILLER               PIC X(19)  VALUE            04540000
045500                                      '#STORES ALLOC :    '.      04550000
045600             15  TM-MF10-STR-ALLOC    PIC ZZ9.                    04560000
045700             15  FILLER               PIC X(05)  VALUE SPACES.    04570000
045800             15  FILLER               PIC X(17)  VALUE            04580000
045900                                      'AV UNITS/STORE:  '.        04590000
046000             15  TM-MF10-AV-UN-STR    PIC ZZ9.99.                 04600000
046100         10  TM-SHORT-TEXT-4.                                     04610000
046200             15  FILLER               PIC X(13)  VALUE            04620000
046300                                      'RTL$/UNIT:   '.            04630000
046400             15  TM-MF10-RTL-UN       PIC $ZZZZ9.99.              04640000
046500             15  FILLER               PIC X(02)  VALUE SPACES.    04650000
046600             15  FILLER               PIC X(15)  VALUE            04660000
046700                                      'TOTAL RTL$ SH: '.          04670000
046800             15  TM-MF10-SH-AMT       PIC $ZZZZZZ9.99.            04680000
046900         10  FILLER                   PIC X(50)  VALUE SPACES.    04690000
047000                                                                  04700000
047100*MESSAGE FORMAT 11 (PACK SHORT).                                  04710000
047200     05  TM-PACK-SHORT-TEXT.                                      04720000
047300         10  TM-PACK-SHORT-LINE-1.                                04730000
047400             15  FILLER               PIC X(09)  VALUE            04740000
047500                                                 'PACK REC:'.     04750000
047600             15  TM-MF11-REC          PIC ZZZZ9.                  04760000
047700             15  FILLER               PIC X(02)  VALUE SPACES.    04770000
047800             15  FILLER               PIC X(09)  VALUE            04780000
047900                                                 'PACK OTR:'.     04790000
048000             15  TM-MF11-OTR          PIC ZZZZ9.                  04800000
048100             15  FILLER               PIC X(03)  VALUE SPACES.    04810000
048200             15  FILLER               PIC X(08)  VALUE            04820000
048300                                                 'PACK SH:'.      04830000
048400             15  TM-MF11-SH-QTY       PIC ZZZ9.                   04840000
048500             15  FILLER               PIC X(01)  VALUE '/'.       04850000
048600             15  TM-MF11-SH-PCT       PIC ZZ9.                    04860000
048700             15  FILLER               PIC X(01)  VALUE '%'.       04870000
048800         10  TM-PACK-SHORT-LINE-2.                                04880000
048900             15  FILLER               PIC X(09)  VALUE            04890000
049000                                                 'PACK RT$:'.     04900000
049100             15  TM-MF11-RT-AMT       PIC $ZZZZ9.99.              04910001
049200             15  FILLER               PIC X(04)  VALUE SPACES.    04920001
049300             15  FILLER               PIC X(18)  VALUE            04930000
049400                                      'TOTAL PACK RT$ SH:'.       04940000
049500             15  TM-MF11-TOT-RT-AMT   PIC $ZZZZZ9.99.             04950001
049600         10  TM-PACK-SHORT-LINE-3.                                04960000
049700             15  FILLER               PIC X(09)  VALUE            04970000
049800                                                 'ODD UNIT:'.     04980000
049900             15  TM-MF11-ODD-QTY      PIC ZZZZ9.                  04990000
050000             15  FILLER               PIC X(10)  VALUE SPACES.    05000001
050100             15  FILLER               PIC X(17)  VALUE            05010000
050200                                      'TOTAL ODD UNIT$: '.        05020000
050300             15  TM-MF11-ODD-AMT      PIC $ZZZZ9.99.              05030001
050400         10  TM-PACK-SHORT-LINE-4.                                05040000
050500             15  TM-MF11-TEXT         PIC X(17).                  05050000
050600             15  FILLER               PIC X(10)  VALUE SPACES.    05060000
050700             15  FILLER               PIC X(20)  VALUE            05070000
050800                                      '#STORES ALLOC:      '.     05080000
050900             15  TM-MF11-STR-ALLOC    PIC ZZ9.                    05090000
051000         10  FILLER                   PIC X(50)  VALUE SPACES.    05100000
051100                                                                  05110000
051200*MESSAGE FORMAT 12 (OVER).                                        05120000
051300     05  TM-OVER-TEXT.                                            05130000
051400         10  TM-OVER-TEXT-1.                                      05140000
051500             15  FILLER               PIC X(17)  VALUE            05150000
051600                                      'UNITS RECEIVED:  '.        05160000
051700             15  TM-MF12-RCVD-QTY     PIC ZZZZ9-.                 05170000
051800             15  FILLER               PIC X(04)  VALUE SPACES.    05180000
051900             15  FILLER               PIC X(18)  VALUE            05190000
052000                                      'UNITS OTR:        '.       05200000
052100             15  TM-MF12-OTR-QTY      PIC ZZZZ9.                  05210000
052200         10  TM-OVER-TEXT-2.                                      05220000
052300             15  FILLER               PIC X(17)  VALUE            05230000
052400                                      'UNITS OVER    :  '.        05240000
052500             15  TM-MF12-OV-QTY       PIC ZZZZ9-.                 05250000
052600             15  FILLER               PIC X(04)  VALUE SPACES.    05260000
052700             15  FILLER               PIC X(19)  VALUE            05270000
052800                                      'UNITS OVER  %:     '.      05280000
052900             15  TM-MF12-OV-PCT       PIC ZZ9.                    05290000
053000             15  FILLER               PIC X(01)  VALUE '%'.       05300000
053100         10  TM-OVER-TEXT-3.                                      05310000
053200             15  FILLER               PIC X(19)  VALUE            05320000
053300                                      '#STORES ALLOC :    '.      05330000
053400             15  TM-MF12-STR-ALLOC    PIC ZZ9.                    05340000
053500             15  FILLER               PIC X(05)  VALUE SPACES.    05350000
053600             15  FILLER               PIC X(17)  VALUE            05360000
053700                                      'AV UNITS/STORE:  '.        05370000
053800             15  TM-MF12-AV-UN-STR    PIC ZZ9.99.                 05380000
053900         10  TM-OVER-TEXT-4.                                      05390000
054000             15  FILLER               PIC X(13)  VALUE            05400000
054100                                      'RTL$/UNIT:   '.            05410000
054200             15  TM-MF12-RTL-UN       PIC $ZZZZ9.99.              05420000
054300             15  FILLER               PIC X(02)  VALUE SPACES.    05430000
054400             15  FILLER               PIC X(15)  VALUE            05440000
054500                                      'TOTAL RTL$ OV: '.          05450000
054600             15  TM-MF12-OV-AMT       PIC $ZZZZZZ9.99.            05460000
054700         10  FILLER                   PIC X(50)  VALUE SPACES.    05470000
054800                                                                  05480000
054900*MESSAGE FORMAT 13 (PACK NO DISTRO).                              05490000
055000     05  TM-PACK-NO-DISTRO-TEXT.                                  05500000
055100         10  TM-PACK-NO-DISTRO-LINE-1.                            05510000
055200             15  FILLER               PIC X(22)  VALUE            05520000
055300                 'PACKS RECEIVED:       '.                        05530000
055400             15  TM-MF13-RCVD-QTY     PIC ZZ9.                    05540000
055500             15  FILLER               PIC X(25)  VALUE SPACES.    05550000
055600         10  FILLER                   PIC X(200) VALUE SPACES.    05560000
055700                                                                  05570000
055800*MESSAGE FORMAT 14 (BAD PACK).                                    05580000
055900     05  TM-BAD-PACK-TEXT.                                        05590000
056000         10  TM-BAD-PACK-LINE-1.                                  05600000
056100             15  FILLER               PIC X(09)  VALUE            05610000
056200                                                 'PACK REC:'.     05620000
056300             15  TM-MF14-REC          PIC ZZZZ9.                  05630000
056400             15  FILLER               PIC X(02)  VALUE SPACES.    05640000
056500             15  FILLER               PIC X(09)  VALUE            05650000
056600                                                 'PACK OTR:'.     05660000
056700             15  TM-MF14-OTR          PIC ZZZZ9.                  05670000
056800             15  FILLER               PIC X(03)  VALUE SPACES.    05680000
056900             15  FILLER               PIC X(05)  VALUE 'PACK '.   05690000
057000             15  TM-MF14-OV-SH-1      PIC X(02).                  05700000
057100             15  FILLER               PIC X(01)  VALUE ':'.       05710000
057200             15  TM-MF14-PK-QTY       PIC ZZZ9.                   05720000
057300             15  FILLER               PIC X(01)  VALUE '/'.       05730000
057400             15  TM-MF14-PK-PCT       PIC ZZ9.                    05740000
057500             15  FILLER               PIC X(01)  VALUE '%'.       05750000
057600                                                                  05760000
057700                                                                  05770000
057800         10  TM-BAD-PACK-LINE-2.                                  05780000
057900             15  FILLER               PIC X(09)  VALUE            05790000
058000                                                 'PACK RT$:'.     05800000
058100             15  TM-MF14-RT-AMT       PIC $ZZZZ9.99.              05810001
058200             15  FILLER               PIC X(04)  VALUE SPACES.    05820001
058300             15  FILLER               PIC X(15)  VALUE            05830000
058400                                      'TOTAL PACK RT$ '.          05840000
058500             15  TM-MF14-OV-SH-2      PIC X(02).                  05850000
058600             15  FILLER               PIC X(01)  VALUE ':'.       05860000
058700             15  TM-MF14-TOT-RT-AMT   PIC $ZZZZZ9.99.             05870001
058800         10  TM-BAD-PACK-LINE-3.                                  05880000
058900             15  FILLER               PIC X(09)  VALUE            05890000
059000                                                 'ODD UNIT:'.     05900000
059100             15  TM-MF14-ODD-QTY      PIC ZZZZ9.                  05910000
059200             15  FILLER               PIC X(10)  VALUE SPACES.    05920001
059300             15  FILLER               PIC X(17)  VALUE            05930000
059400                                      'TOTAL ODD UNIT$: '.        05940000
059500             15  TM-MF14-ODD-AMT      PIC $ZZZZ9.99.              05950001
059600         10  TM-BAD-PACK-LINE-4.                                  05960000
059700             15  TM-MF14-TEXT         PIC X(17).                  05970000
059800             15  FILLER               PIC X(03)  VALUE SPACES.    05980000
059900             15  FILLER               PIC X(20)  VALUE            05990000
060000                                      '#STORES ALLOC/AV UN:'.     06000000
060100             15  TM-MF14-STR-ALLOC    PIC ZZ9.                    06010000
060200             15  FILLER               PIC X(01)  VALUE '/'.       06020000
060300             15  TM-MF14-AVG-UN       PIC ZZ9.99.                 06030000
060400         10  FILLER                   PIC X(50)  VALUE SPACES.    06040000
060500                                                                  06050000
060600*MESSAGE FORMAT 15 (BAD INNER PACK).                              06060000
060700     05  TM-BAD-INNER-PACK-TEXT.                                  06070000
060800         10  TM-BAD-INNER-PACK-LINE-1.                            06080000
060900             15  FILLER               PIC X(17)  VALUE            06090000
061000                 ' INNR PACK QTY : '.                             06100000
061100             15  TM-MF15-PACK-QTY     PIC ZZZZ9.                  06110000
061200             15  FILLER               PIC X(28)  VALUE SPACES.    06120000
061300         10  TM-BAD-INNER-PACK-LINE-2.                            06130000
061400             15  FILLER               PIC X(17)  VALUE            06140000
061500                 'UNITS RECEIVED : '.                             06150000
061600             15  TM-MF15-RCVD-QTY     PIC ZZZZ9.                  06160000
061700             15  FILLER               PIC X(28)  VALUE SPACES.    06170000
061800         10  TM-BAD-INNER-PACK-LINE-3.                            06180000
061900             15  FILLER               PIC X(18)  VALUE            06190000
062000                 '           STR :  '.                            06200000
062100             15  TM-MF15-STR-NBR      PIC ZZZ9.                   06210000
062200             15  FILLER               PIC X(28)  VALUE SPACES.    06220000
062300         10  TM-BAD-INNER-PACK-LINE-4.                            06230000
062400             15  FILLER               PIC X(17)  VALUE            06240000
062500                 ' STR ORDER QTY : '.                             06250000
062600             15  TM-MF15-STR-QTY      PIC ZZZZ9.                  06260000
062700             15  FILLER               PIC X(28)  VALUE SPACES.    06270000
062800         10  FILLER                   PIC X(50)  VALUE SPACES.    06280000
062900                                                                  06290000
063000******************************************************************06300000
063100* COPYBOOK AREAS                                                  06310000
063200******************************************************************06320000
063300* INPUT PASSED FROM RCKCS920                                      06330000
063400     COPY RCWS823.                                                06340000
063500                                                                  06350000
063600* TEMP STORAGE AREA.                                              06360000
063700     COPY RCWS821.                                                06370000
063800                                                                  06380000
063900* OUTPUT PASSED TO TROUBLE.                                       06390000
064000     COPY TMWS500.                                                06400000
064100                                                                  06410000
064200     COPY TMWS501.                                                06420000
064300                                                                  06430000
064301* ERROR DATA PASSED BACK UPSTREAM.                                06430100
064310     COPY TMRD007.                                                06431000
064320                                                                  06432000
064400******************************************************************06440000
064500* DB2 SQL COMMUNICATION AREA                                      06450000
064600******************************************************************06460000
064700     EXEC SQL                                                     06470000
064800         INCLUDE SQLCA                                            06480000
064900     END-EXEC.                                                    06490000
065000                                                                  06500000
065100******************************************************************06510000
065200* DB2 DCLGENS                                                     06520000
065300******************************************************************06530000
065400*XLT_LOC TABLE                                                    06540000
065500     EXEC SQL                                                     06550000
065600         INCLUDE XLT00010                                         06560000
065700     END-EXEC.                                                    06570000
065800                                                                  06580000
065801*TROUBLE REASON TABLE                                             06580100
065802     EXEC SQL                                                     06580200
065803         INCLUDE TTRBRSN                                          06580300
065804     END-EXEC.                                                    06580400
065805                                                                  06580500
065806* PARM TABLE                                                      06580600
065807     EXEC SQL                                                     06580700
065808         INCLUDE TKRPRPM                                          06580800
065809     END-EXEC.                                                    06580900
065810                                                                  06581000
065900*COMPANY CONTROL TABLE                                            06590000
066000     EXEC SQL                                                     06600000
066100          INCLUDE TCOCNTL                                         06610000
066200     END-EXEC.                                                    06620000
066300                                                                  06630000
066400*PRORATION KEY TABLE                                              06640000
066500     EXEC SQL                                                     06650000
066600         INCLUDE RCT00000                                         06660000
066700     END-EXEC.                                                    06670000
066800                                                                  06680000
066900*PRORATION RULE TABLE                                             06690000
067000     EXEC SQL                                                     06700000
067100         INCLUDE RCT00001                                         06710000
067200     END-EXEC.                                                    06720000
067300                                                                  06730000
067400*PRORATION ACTION TABLE                                           06740000
067500     EXEC SQL                                                     06750000
067600         INCLUDE RCT00002                                         06760000
067700     END-EXEC.                                                    06770000
067800                                                                  06780000
067900*PRORATION FUNCTION DESCRIPTTION TABLE                            06790000
068000     EXEC SQL                                                     06800000
068100         INCLUDE RCT00003                                         06810000
068200     END-EXEC.                                                    06820000
068300                                                                  06830000
068301** AHP - BEGIN 04/24/08                                           06830100
068302/                                                                 06830200
068303*----------------------------------------------------------------*06830300
068304*    DB2 DCLGEN FOR THE WST_INTGRTN_TYP TABLE                     06830400
068305*----------------------------------------------------------------*06830500
068306     EXEC SQL                                                     06830600
068307          INCLUDE WST00008                                        06830700
068308     END-EXEC.                                                    06830800
068309/                                                                 06830900
068310*----------------------------------------------------------------*06831000
068311*    DB2 DCLGEN FOR THE WST_ATTR_DEFN TABLE                       06831100
068312*----------------------------------------------------------------*06831200
068313     EXEC SQL                                                     06831300
068314          INCLUDE WST00009                                        06831400
068315     END-EXEC.                                                    06831500
068316/                                                                 06831600
068317*----------------------------------------------------------------*06831700
068318*    DB2 DCLGEN FOR THE WST_ATTR_ELEM TABLE                       06831800
068319*----------------------------------------------------------------*06831900
068320     EXEC SQL                                                     06832000
068321          INCLUDE WST00010                                        06832100
068322     END-EXEC.                                                    06832200
068323/                                                                 06832300
068324** AHP -  END  04/24/08                                           06832400
068325                                                                  06832500
068400******************************************************************06840000
068500* RULE CURSOR                                                     06850000
068600******************************************************************06860000
068700     EXEC SQL                                                     06870000
068800         DECLARE RULE-DETL-CSR CURSOR FOR                         06880000
068900           SELECT PRRTN_RUL_ID                                    06890000
069000                , PRRTN_RUL_SEQ_NBR                               06900000
069100                , PRRTN_RUL_IND                                   06910000
069200                , PRRTN_ACTN_SEQ_NBR                              06920000
069300                , TRBL_RSN_CDE                                    06930000
069400                , MSG_FMT_NBR                                     06940000
069500                , ACTV_IND                                        06950000
069600                , ACTN_RSN_CDE                                    06960000
069700                , ACTN_TXT                                        06970000
069800           FROM RCT_PRRTN_ACTN                                    06980000
069900          WHERE PRRTN_RUL_ID      = :DK-RULE-KEY                  06990000
070000            AND PRRTN_RUL_SEQ_NBR = :DK-RULE-SEQ                  07000000
070100            AND PRRTN_RUL_IND     = :DK-RULE-RESULT               07010000
070200     END-EXEC.                                                    07020000
070300                                                                  07030000
070400******************************************************************07040000
070401* *  OLD LENGTHS                                                  07040100
070410*01  LINK-PO-RECEIVER-CONTENTS       PIC X(179).                  07041000
070420*01  LINK-STORE-COMPONENTS           PIC X(34800).                07042000
070430*01  LINK-ITEM-ARRAY-ALL             PIC X(15600).                07043000
070500******************************************************************07050000
070600 LINKAGE SECTION.                                                 07060000
070700                                                                  07070000
070800 01  LINK-COMMAREA                   PIC X(779).                  07080000
070900 01  LINK-PO-RECEIVER-CONTENTS       PIC X(162).                  07090000
071000 01  LINK-STORE-COMPONENTS           PIC X(18800).                07100000
071100 01  LINK-ITEM-ARRAY-ALL             PIC X(13600).                07110000
071110 01  LINK-TM007-COMMAREA             PIC X(800).                  07111000
071200                                                                  07120000
071300/*****************************************************************07130000
071400 PROCEDURE DIVISION USING LINK-COMMAREA                           07140000
071500                          LINK-PO-RECEIVER-CONTENTS               07150000
071600                          LINK-STORE-COMPONENTS                   07160000
071700                          LINK-ITEM-ARRAY-ALL                     07170000
071710                          LINK-TM007-COMMAREA.                    07171000
071800******************************************************************07180000
071900 0000-MAIN-MODULE.                                                07190000
072000*    DISPLAY '*** START OF RCKUP823 ***'.                         07200000
072100                                                                  07210000
072200*LOAD PASSED DATA.                                                07220000
072300*RC823-COMMAREA                                                   07230000
072400     MOVE LINK-COMMAREA           TO RC823-COMMAREA.              07240000
072500     MOVE RC823-TM500-FIELDS      TO TM500-FIELDS.                07250000
072510     MOVE LINK-TM007-COMMAREA     TO TM007-COMMUNICATIONS-AREA.   07251000
072600                                                                  07260000
072700     EXEC SQL                                                     07270000
072800         SET :PV-CURRENT-DATE = CURRENT DATE                      07280000
072900     END-EXEC.                                                    07290000
073000                                                                  07300000
073100*RC821-PO-RECEIVER-CONTENTS                                       07310000
073200     MOVE LINK-PO-RECEIVER-CONTENTS TO RC821-PO-RECEIVER-CONTENTS.07320000
073300                                                                  07330000
073400*    DISPLAY ' '                                                  07340000
073500*    DISPLAY '---------------------------------'                  07350000
073600*    DISPLAY '       PO RECEIVER CONTENTS      '                  07360000
073700*    DISPLAY '---------------------------------'.                 07370000
073800*    DISPLAY 'ORD-NBR               ' RC821-ORD-NBR.              07380000
073900*    DISPLAY 'OPER-UNT-ID           ' RC821-OPER-UNT-ID.          07390000
074000*    DISPLAY 'FCLTY-ID              ' RC821-FCLTY-ID.             07400000
074100*    DISPLAY 'REC-SEQ-NBR           ' RC821-REC-SEQ-NBR.          07410000
074200*    DISPLAY 'IMPRT-PO-IND          ' RC821-IMPRT-PO-IND.         07420000
074300*    DISPLAY 'NEW-STR-IND           ' RC821-NEW-STR-IND.          07430000
074400*    DISPLAY 'REC-COUNT             ' RC821-REC-COUNT.            07440000
074500*    DISPLAY 'TROUBLE-SHORT-CNT     ' RC821-REC-TROUBLE-SHORT-CNT.07450000
074600*    DISPLAY 'TROUBLE-DCPACK-CNT    ' RC821-REC-TROUBLE-DCPACK-CNT07460000
074700*    DISPLAY 'RMS-PO-IND            ' RC821-RMS-PO-IND.           07470000
074800*    DISPLAY 'DEPT-NBR              ' RC821-DEPT-NBR.             07480000
074900*    DISPLAY 'PKGNG-CDE             ' RC821-PKGNG-CDE.            07490000
075000*    DISPLAY 'PACK-BY-STORE-IND     ' RC821-PACK-BY-STORE-IND.    07500000
075100*    DISPLAY 'OTR-SCOPE-IND         ' RC821-OTR-SCOPE-IND.        07510000
075200*    DISPLAY 'PO-TYP-CDE            ' RC821-PO-TYP-CDE.           07520000
075300*    DISPLAY 'PLAN-NBR              ' RC821-PLAN-NBR.             07530000
075400*    DISPLAY 'CURR-SPLIT-QTY        ' RC821-CURR-SPLIT-QTY.       07540000
075500*    DISPLAY 'PK-SIZE-RND-CDE       ' RC821-PK-SIZE-RND-CDE.      07550000
075600*    DISPLAY 'ALLOC-OUTR-PK-QTY     ' RC821-ALLOC-OUTR-PK-QTY.    07560000
075700*    DISPLAY 'SUM-STR-PLAN-QTY      ' RC821-SUM-STR-PLAN-QTY.     07570000
075800*    DISPLAY 'SUM-STR-OTR-QTY       ' RC821-SUM-STR-OTR-QTY.      07580000
075900*    DISPLAY 'SUM-STR-PLAN-PK       ' RC821-SUM-STR-PLAN-PK.      07590000
076000*    DISPLAY 'SUM-STR-OTR-PK        ' RC821-SUM-STR-OTR-PK.       07600000
076100*    DISPLAY 'VALID-DISTRO-IND      ' RC821-VALID-DISTRO-IND.     07610000
076200*    DISPLAY 'NO-TALLPLN-DISTRO-IND ' RC821-NO-TALLPLN-DISTRO-IND.07620000
076300*    DISPLAY 'NO-TMESTDS-DISTRO-IND ' RC821-NO-TMESTDS-DISTRO-IND.07630000
076400*    DISPLAY 'BAD-PACK-DISTRO-IND   ' RC821-BAD-PACK-DISTRO-IND.  07640000
076500*    DISPLAY 'OVER-PRORATE-CDE      ' RC821-OVER-PRORATE-CDE.     07650000
076600*    DISPLAY 'SHORT-PRORATE-CDE     ' RC821-SHORT-PRORATE-CDE.    07660000
076700*    DISPLAY 'SHORT-USE-EX-RULE-IND ' RC821-SHORT-USE-EX-RULES-IND07670000
076800*    DISPLAY 'OVER-SHORT-CDE        ' RC821-OVER-SHORT-CDE.       07680000
076900*    DISPLAY 'TYPE-CODE             ' RC821-TYPE-CODE.            07690000
077000*    DISPLAY 'DC-NMBR               ' RC821-DC-NMBR.              07700000
077200*    DISPLAY 'DC-RCT-STO-DTE        ' RC821-DC-RCT-STO-DTE.       07720000
077600*    DISPLAY 'STR-COUNT             ' RC821-STR-COUNT.            07760000
077700*    DISPLAY 'ITEM-COUNT            ' RC821-ITEM-COUNT.           07770000
077800*    DISPLAY 'LNE-ODU-TOL-QTY       ' RC821-LNE-ODU-TOL-QTY.      07780000
077900*    DISPLAY 'LNE-ODU-TOL-AMT       ' RC821-LNE-ODU-TOL-AMT.      07790000
078000*    DISPLAY 'PREPK-ODU-TOL-QTY     ' RC821-PREPK-ODU-TOL-QTY.    07800000
078100*    DISPLAY 'PREPK-ODU-TOL-AMT     ' RC821-PREPK-ODU-TOL-AMT.    07810000
078200*    DISPLAY 'DAYS-PR-CHG-NBR       ' RC821-DAYS-PR-CHG-NBR.      07820000
078300*    DISPLAY 'PACK-UPC-NBR          ' RC821-PACK-UPC-NBR.         07830000
078400*    DISPLAY 'PACK-SKU-NBR          ' RC821-PACK-SKU-NBR.         07840000
078500*    DISPLAY 'PREPK-ID              ' RC821-PREPK-ID.             07850000
078600*    DISPLAY 'INPK-UNT-QTY          ' RC821-INPK-UNT-QTY.         07860000
078700*    DISPLAY 'OTPK-UNT-QTY          ' RC821-OTPK-UNT-QTY.         07870000
078800*    DISPLAY 'REC-DRV-LNE-NBR       ' RC821-REC-DRV-LNE-NBR.      07880000
078900*    DISPLAY 'TOTAL-ODD-UNITS       ' RC821-TOTAL-ODD-UNITS.      07890000
079000*    DISPLAY ' '.                                                 07900000
079100                                                                  07910000
079200*RC821-STORE-COMPONENTS                                           07920000
079300     MOVE LINK-STORE-COMPONENTS   TO RC821-STORE-COMPONENTS.      07930000
079400*    DISPLAY 'RC821-STR-NBR = ' RC821-STR-NBR(1)                  07940000
079500*            ' / ' RC821-STR-NBR (2)                              07950000
079600*            ' / ' RC821-STR-NBR (3)                              07960000
079700*            ' / ' RC821-STR-NBR (4)                              07970000
079800*            ' / ' RC821-STR-NBR (5)                              07980000
079900*            ' / ' RC821-STR-NBR (6)                              07990000
080000*            ' / ' RC821-STR-NBR (7)                              08000000
080100*            ' / ' RC821-STR-NBR (8)                              08010000
080200*            ' / ' RC821-STR-NBR (9)                              08020000
080300*            ' / ' RC821-STR-NBR (10).                            08030000
080400                                                                  08040000
080500                                                                  08050000
080600*RC821-ITEM-ARRAY-ALL.                                            08060000
080700     MOVE LINK-ITEM-ARRAY-ALL      TO RC821-ITEM-ARRAY-ALL.       08070000
080800*    DISPLAY 'RC821-REC-LNE-NBR = ' RC821-REC-LNE-NBR(1)          08080000
080900*            ' / ' RC821-REC-LNE-NBR(2)                           08090000
081000*            ' / ' RC821-REC-LNE-NBR(3)                           08100000
081100*            ' / ' RC821-REC-LNE-NBR(4)                           08110000
081200*            ' / ' RC821-REC-LNE-NBR(5).                          08120000
081300                                                                  08130000
081400     PERFORM 0100-ITEM-COMPONENTS                                 08140000
081500       VARYING RC821-ITEM-IDX FROM 1 BY 1                         08150000
081600         UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0             08160000
081700            OR RC821-ITEM-IDX > 100.                              08170000
081800                                                                  08180000
081900*SET DRIVER LINE OCCURRENCE.                                      08190000
082000     MOVE 1 TO DL.                                                08200000
082100     PERFORM                                                      08210000
082200       VARYING RC821-ITEM-IDX FROM 1 BY 1                         08220000
082300         UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0             08230000
082400            OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              08240000
082500                                                                  08250000
082600         IF (RC821-REC-LNE-NBR (RC821-ITEM-IDX) > ZEROES)         08260000
082700           AND (RC821-REC-LNE-NBR (RC821-ITEM-IDX) =              08270000
082800                RC821-REC-DRV-LNE-NBR)                            08280000
082900             SET DL TO RC821-ITEM-IDX                             08290000
083000         END-IF                                                   08300000
083100     END-PERFORM.                                                 08310000
083200*    DISPLAY ' '.                                                 08320000
083300*    DISPLAY 'DL = ' RC821-REC-DRV-LNE-NBR                        08330000
083400*              ' / ' RC821-REC-LNE-NBR (DL).                      08340000
083500                                                                  08350000
083600*SET DISTRIBUTION QTY PER UNIT.                                   08360000
083700     IF RC821-PKGNG-CDE = 'I' OR 'M'                              08370000
083800         MOVE RC821-REC-PACK-RATO-QTY (DL)  TO PV-DISPERSAL-QTY   08380000
083900     ELSE                                                         08390000
084000         MOVE RC821-REC-INNER-PACK-QTY (DL) TO PV-DISPERSAL-QTY   08400000
084100     END-IF.                                                      08410000
084200*    DISPLAY 'PV-DISPERSAL-QTY = ' PV-DISPERSAL-QTY               08420000
084300*            ' / ' RC821-PKGNG-CDE.                               08430000
084400                                                                  08440000
084500*INITIALIZE PROCESSING INDICATORS.                                08450000
084600     SET PS-DONE-NO              TO TRUE.                         08460000
084700     SET PS-ANALYST-BAD-PACK-NO  TO TRUE.                         08470000
084800     SET PS-ANALYST-BP-WITHIN-NO TO TRUE.                         08480000
084900     SET RC823-DO-ALLOCATION-YES TO TRUE.                         08490000
085000     SET TM500-CALL-SUCCESSFUL   TO TRUE.                         08500000
085100*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  08510000
085200     SET PS-RULE-DONE-NO         TO TRUE.                         08520000
085300                                                                  08530000
085400*READ TEMP STORAGE QUEUES.                                        08540000
085500***  PERFORM 1000-READ-TEMP-STORAGE.                              08550000
085600                                                                  08560000
085700     MOVE 'N' TO PV-UNTIED-PACK-LINES.                            08570000
085800     MOVE 'N' TO PV-LINE-ODD-UNITS.                               08580000
085900     MOVE 'N' TO PV-LINES-MISSING.                                08590000
086000     MOVE 'N' TO PV-DIFFERENT-RATIOS.                             08600000
086100     MOVE 'N' TO PV-BEST-CASE-ZERO.                               08610000
086200     MOVE 'N' TO PV-LINE-ODU-OUT-OF-TOL.                          08620000
086300     MOVE 'N' TO PV-PACK-ODU-OUT-OF-TOL.                          08630000
086400     MOVE 'N' TO PV-LINE-ODUD-OUT-OF-TOL.                         08640000
086500     MOVE 'N' TO PV-PACK-ODUD-OUT-OF-TOL.                         08650000
086600     IF RC821-PKGNG-CDE = 'I' OR 'M'                              08660000
086700         PERFORM 0100-SET-ANALYST-FLAGS                           08670000
086800     END-IF.                                                      08680000
086900                                                                  08690000
087000*PROCESS RULE-KEY LOOP.                                           08700000
087100*    DISPLAY ' '.                                                 08710000
087200*    DISPLAY 'RULE KEY01 = ' RC823-RULE-KEY (1)                   08720000
087300*            ' / PRORATE IND = ' RC823-PRORATE-IND (1)            08730000
087400*    DISPLAY 'RULE KEY02 = ' RC823-RULE-KEY (2)                   08740000
087500*            ' / PRORATE IND = ' RC823-PRORATE-IND (2)            08750000
087600*    DISPLAY 'RULE KEY03 = ' RC823-RULE-KEY (3)                   08760000
087700*            ' / PRORATE IND = ' RC823-PRORATE-IND (3)            08770000
087800*    DISPLAY 'RULE KEY04 = ' RC823-RULE-KEY (4)                   08780000
087900*            ' / PRORATE IND = ' RC823-PRORATE-IND (4)            08790000
088000*    DISPLAY 'RULE KEY05 = ' RC823-RULE-KEY (5)                   08800000
088100*            ' / PRORATE IND = ' RC823-PRORATE-IND (5)            08810000
088200*    DISPLAY 'RULE KEY06 = ' RC823-RULE-KEY (6)                   08820000
088300*            ' / PRORATE IND = ' RC823-PRORATE-IND (6)            08830000
088400*    DISPLAY 'RULE KEY07 = ' RC823-RULE-KEY (7)                   08840000
088500*            ' / PRORATE IND = ' RC823-PRORATE-IND (7)            08850000
088600*    DISPLAY 'RULE KEY08 = ' RC823-RULE-KEY (8)                   08860000
088700*            ' / PRORATE IND = ' RC823-PRORATE-IND (8)            08870000
088800*    DISPLAY 'RULE KEY09 = ' RC823-RULE-KEY (9)                   08880000
088900*            ' / PRORATE IND = ' RC823-PRORATE-IND (9)            08890000
089000*    DISPLAY 'RULE KEY10 = ' RC823-RULE-KEY (10)                  08900000
089100*            ' / PRORATE IND = ' RC823-PRORATE-IND (10)           08910000
089200     IF PS-DONE-NO                                                08920000
089300         PERFORM                                                  08930000
089400           VARYING RC823-RULE-IDX FROM 1 BY 1                     08940000
089500             UNTIL PS-DONE-YES                                    08950000
089600                OR RC823-RULE-KEY (RC823-RULE-IDX) NOT > ZEROES   08960000
089700                                                                  08970000
089800*            DISPLAY '**********'                                 08980000
089900*            DISPLAY 'RULE KEY = '                                08990000
090000*                    RC823-RULE-KEY (RC823-RULE-IDX)              09000000
090100*                    ' / ' RC823-TRB-LVL-CDE (RC823-RULE-IDX)     09010000
090200*            DISPLAY '**********'                                 09020000
090300             MOVE RC823-RULE-KEY (RC823-RULE-IDX)                 09030000
090400                     TO DK-RULE-KEY                               09040000
090500             MOVE +1 TO DK-RULE-SEQ                               09050000
090600                        PV-RULE-SEQ                               09060000
090700             PERFORM 2000-SELECT-RULE                             09070000
090800                                                                  09080000
090900*PROCESS RULES ASSOCIATED W/KEY (PRRTN_RUL_ID).                   09090000
091000             IF PS-DONE-NO                                        09100000
091010* SKU LEVEL                                                       09101000
091100                 IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'K'      09110000
091200*10/13/03 DO NOT PROCESS SKU LEVEL TRB IF DONE                    09120000
091300                   AND NOT PS-DONE-YES                            09130000
091400                     PERFORM 2100-PROCESS-SKU-LVL-TRB             09140000
091500                 END-IF                                           09150000
091510* PACK LEVEL                                                      09151000
091600                                                                  09160000
091700                 IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'P'      09170000
091800*10/13/03 DO NOT PROCESS SKU LEVEL TRB IF DONE                    09180000
091900                   AND NOT PS-DONE-YES                            09190000
092000                     PERFORM 2200-PROCESS-PACK-LVL-TRB            09200000
092100                 END-IF                                           09210000
092200                                                                  09220000
092210* STORE LEVEL                                                     09221000
092300                 IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'S'      09230000
092400*10/13/03 DO NOT PROCESS SKU LEVEL TRB IF DONE                    09240000
092500                   AND NOT PS-DONE-YES                            09250000
092600                     PERFORM 2300-PROCESS-STORE-LVL-TRB           09260000
092700                 END-IF                                           09270000
092800             END-IF                                               09280000
092900                                                                  09290000
093000         END-PERFORM                                              09300000
093100     END-IF.                                                      09310000
093200                                                                  09320000
093400     IF RC823-DO-ALLOC-IND = 'N'                                  09340000
093500       AND TM500-IN-TROUBLE                                       09350000
093600         SET TM500-DIDNT-ALLOC-DUE-TO-TRBL TO TRUE                09360000
093700     END-IF.                                                      09370000
093800                                                                  09380000
093810* FOR MONROE ORDERS RECEIVED AT FINDLAY                           09381000
093820     SET PS-DONE-NO                                               09382000
093830         PS-PO-RCVR-TRBL-NO TO TRUE.                              09383000
093840     PERFORM 1500-TRBL-379-406-CHK.                               09384000
093841                                                                  09384100
093850* RETURN TO CALLING PROGRAM.                                      09385000
093860     PERFORM 0000-GOBACK.                                         09386000
093870                                                                  09387000
093880 0000-GOBACK.                                                     09388000
093900     MOVE TM500-FIELDS   TO RC823-TM500-FIELDS.                   09390000
094000     MOVE RC823-COMMAREA TO LINK-COMMAREA                         09400000
094100     MOVE TM007-COMMUNICATIONS-AREA TO LINK-TM007-COMMAREA.       09410000
094500     GOBACK.                                                      09450000
094600                                                                  09460000
094700******************************************************************09470000
094800 0100-SET-ANALYST-FLAGS.                                          09480000
094900*    DISPLAY  '0100-SET-ANALYST-FLAGS'.                           09490000
095000                                                                  09500000
095100*UNTIED LINES.                                                    09510000
095200     IF RC821-PREPK-ID = 99                                       09520000
095300         MOVE 'Y' TO PV-UNTIED-PACK-LINES                         09530000
095400*        DISPLAY '  PV-UNTIED-PACK-LINES = Y'                     09540000
095500     END-IF.                                                      09550000
095600                                                                  09560000
095700*ODD UNITS.                                                       09570000
095800     IF RC821-TOTAL-ODD-UNITS > ZEROES                            09580000
095900         MOVE 'Y' TO PV-LINE-ODD-UNITS                            09590000
096000*        DISPLAY '  PV-LINE-ODD-UNITS = Y'                        09600000
096100     END-IF.                                                      09610000
096200                                                                  09620000
096300*LINE MISSING.                                                    09630000
096400     PERFORM                                                      09640000
096500       VARYING RC821-ITEM-IDX FROM 1 BY 1                         09650000
096600         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              09660000
096700                                                                  09670000
096800         IF (RC821-APP-PO-LNE-NBR (RC821-ITEM-IDX) NOT =          09680000
096900            RC821-REC-LNE-NBR (RC821-ITEM-IDX))                   09690000
097000           OR (RC821-REC-ITEM-NBR (RC821-ITEM-IDX) NOT =          09700000
097100            RC821-PO-ITEM-NBR (RC821-ITEM-IDX))                   09710000
097200             MOVE 'Y' TO PV-LINES-MISSING                         09720000
097300*            DISPLAY '  PV-LINES-MISSING = Y'                     09730000
097400         END-IF                                                   09740000
097500     END-PERFORM.                                                 09750000
097600                                                                  09760000
097700*DIFFERENT RATIOS.                                                09770000
097800     PERFORM                                                      09780000
097900       VARYING RC821-ITEM-IDX FROM 1 BY 1                         09790000
098000         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              09800000
098100                                                                  09810000
098200         IF RC821-PO-PACK-RATO-QTY (RC821-ITEM-IDX) NOT =         09820000
098300            RC821-REC-PACK-RATO-QTY (RC821-ITEM-IDX)              09830000
098400             MOVE 'Y' TO PV-DIFFERENT-RATIOS                      09840000
098500*            DISPLAY '  PV-DIFFERENT-RATIOS = Y'                  09850000
098600         END-IF                                                   09860000
098700     END-PERFORM.                                                 09870000
098800                                                                  09880000
098900*BEST CASE ZERO.                                                  09890000
099000     PERFORM                                                      09900000
099100       VARYING RC821-ITEM-IDX FROM 1 BY 1                         09910000
099200         UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              09920000
099300                                                                  09930000
099400         IF (RC821-REC-LNE-NBR (RC821-ITEM-IDX) > ZEROES)         09940000
099500           AND (RC821-BEST-CASE-UNITS (RC821-ITEM-IDX) = ZEROES)  09950000
099600             MOVE 'Y' TO PV-BEST-CASE-ZERO                        09960000
099700*            DISPLAY '  PV-BEST-CASE-ZERO = Y'                    09970000
099800         END-IF                                                   09980000
099900     END-PERFORM.                                                 09990000
100000                                                                  10000000
100100*SET ANALYST BAD PACK.                                            10010000
100200     IF PV-UNTIED-PACK-LINES  = 'Y'                               10020000
100300       OR PV-BEST-CASE-ZERO   = 'Y'                               10030000
100400       OR PV-DIFFERENT-RATIOS = 'Y'                               10040000
100500       OR PV-LINES-MISSING    = 'Y'                               10050000
100600         SET PS-ANALYST-BAD-PACK-YES TO TRUE                      10060000
100700*        DISPLAY '  PS-ANALYST-BAD-PACK-YES'                      10070000
100800     END-IF.                                                      10080000
100900                                                                  10090000
101000*TEST ODD UNIT QTY VS. TOLERANCE QTY                              10100000
101100     IF PV-LINE-ODD-UNITS = 'Y'                                   10110000
101200         MOVE ZEROES TO PV-TOT-ODD-UNIT-QTY                       10120000
101300         PERFORM                                                  10130000
101400           VARYING RC821-ITEM-IDX FROM 1 BY 1                     10140000
101500             UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT          10150000
101600                                                                  10160000
101700             IF RC821-ODD-UNIT-QTY (RC821-ITEM-IDX) NOT <         10170000
101800                RC821-LNE-ODU-TOL-QTY                             10180000
101900                 SET PS-ANALYST-BAD-PACK-YES TO TRUE              10190000
102000                 MOVE 'Y' TO PV-LINE-ODU-OUT-OF-TOL               10200000
102100             END-IF                                               10210000
102200                                                                  10220000
102300             COMPUTE PV-TOT-ODD-UNIT-QTY                          10230000
102400                   = PV-TOT-ODD-UNIT-QTY                          10240000
102500                   + RC821-ODD-UNIT-QTY (RC821-ITEM-IDX)          10250000
102600         END-PERFORM                                              10260000
102700                                                                  10270000
102800         IF PV-TOT-ODD-UNIT-QTY NOT < RC821-PREPK-ODU-TOL-QTY     10280000
102900             SET PS-ANALYST-BAD-PACK-YES TO TRUE                  10290000
103000             MOVE 'Y' TO PV-PACK-ODU-OUT-OF-TOL                   10300000
103100         END-IF                                                   10310000
103200                                                                  10320000
103300     END-IF.                                                      10330000
103400                                                                  10340000
103500*TEST ODD UNIT DOLLARS.                                           10350000
103600     IF RC821-TOTAL-ODD-UNITS > ZEROES                            10360000
103700         MOVE ZEROES TO PV-TOT-ODD-UNIT-AMT                       10370000
103800         PERFORM                                                  10380000
103900           VARYING RC821-ITEM-IDX FROM 1 BY 1                     10390000
104000             UNTIL RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT          10400000
104100                                                                  10410000
104200             IF RC821-PO-GP-QTY (RC821-ITEM-IDX) > 1              10420000
104300                 COMPUTE PV-UNIT-PRICE =                          10430000
104400                         RC821-PO-GP-RTL-AMT  (RC821-ITEM-IDX)    10440000
104500                       / RC821-PO-GP-QTY      (RC821-ITEM-IDX)    10450000
104600             ELSE                                                 10460000
104700                 MOVE RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX)    10470000
104800                   TO PV-UNIT-PRICE                               10480000
104900             END-IF                                               10490000
105000                                                                  10500000
105100             COMPUTE PV-ODD-UNIT-DOLLARS = PV-UNIT-PRICE          10510000
105200                   * RC821-ODD-UNIT-QTY (RC821-ITEM-IDX)          10520000
105300                                                                  10530000
105400             COMPUTE PV-TOT-ODD-UNIT-AMT = PV-TOT-ODD-UNIT-AMT    10540000
105500                                         + PV-ODD-UNIT-DOLLARS    10550000
105600                                                                  10560000
105700             IF PV-ODD-UNIT-DOLLARS NOT < RC821-LNE-ODU-TOL-AMT   10570000
105800                 SET PS-ANALYST-BAD-PACK-YES TO TRUE              10580000
105900                 MOVE 'Y' TO PV-LINE-ODUD-OUT-OF-TOL              10590000
106000             END-IF                                               10600000
106100                                                                  10610000
106200             COMPUTE PV-TOT-ODD-UNIT-AMT = PV-TOT-ODD-UNIT-AMT    10620000
106300                                         + PV-ODD-UNIT-DOLLARS    10630000
106400         END-PERFORM                                              10640000
106500                                                                  10650000
106600         IF PV-TOT-ODD-UNIT-AMT NOT < RC821-PREPK-ODU-TOL-AMT     10660000
106700             SET PS-ANALYST-BAD-PACK-YES TO TRUE                  10670000
106800             MOVE 'Y' TO PV-PACK-ODUD-OUT-OF-TOL                  10680000
106900         END-IF                                                   10690000
107000     END-IF.                                                      10700000
107100                                                                  10710000
107200*SET ANALYST BAD PACK WITHIN.                                     10720000
107300     SET PS-ANALYST-BP-WITHIN-NO TO TRUE.                         10730000
107400     IF RC821-TOTAL-ODD-UNITS > ZEROES                            10740000
107500       AND NOT PS-ANALYST-BAD-PACK-YES                            10750000
107600       AND PV-LINE-ODU-OUT-OF-TOL  = 'N'                          10760000
107700       AND PV-LINE-ODUD-OUT-OF-TOL = 'N'                          10770000
107800       AND PV-PACK-ODU-OUT-OF-TOL  = 'N'                          10780000
107900       AND PV-PACK-ODUD-OUT-OF-TOL = 'N'                          10790000
108000         SET PS-ANALYST-BP-WITHIN-YES TO TRUE                     10800000
108100*        DISPLAY '  PS-ANALYST-BP-WITHIN-YES'                     10810000
108200     END-IF.                                                      10820000
108300                                                                  10830000
108400******************************************************************10840000
108500 0100-ITEM-COMPONENTS.                                            10850000
108600                                                                  10860000
108700     SET PV-ITEM-IDX TO RC821-ITEM-IDX.                           10870000
108800                                                                  10880000
108900     MOVE RC821-REC-COMPONENTS (RC821-ITEM-IDX)                   10890000
109000       TO PV-DISP-REC-COMPONENTS.                                 10900000
109100                                                                  10910000
109200*    DISPLAY ' '                                                  10920000
109300*    DISPLAY '---------------------------------'                  10930000
109400*    DISPLAY '         REC COMPONENTS          '                  10940000
109500*    DISPLAY '---------------------------------'                  10950000
109600*    DISPLAY ' ITEM INDEX IS       ' PV-ITEM-IDX                  10960000
109700*    DISPLAY ' '                                                  10970000
109800*    DISPLAY 'REC-LNE-NBR          ' PV-DISP-REC-LNE-NBR          10980000
109900*    DISPLAY 'REC-ITEM-UPC-NBR     ' PV-DISP-REC-ITEM-UPC-NBR     10990000
110000*    DISPLAY 'REC-ITEM-UPC-INTR-ID ' PV-DISP-REC-ITEM-UPC-INTR-ID 11000000
110100*    DISPLAY 'REC-ITEM-UPC-ID      ' PV-DISP-REC-ITEM-UPC-ID      11010000
110200*    DISPLAY 'REC-SKU-NBR          ' PV-DISP-REC-SKU-NBR          11020000
110300*    DISPLAY 'REC-CLASS            ' PV-DISP-REC-CLASS            11030000
110400*    DISPLAY 'REC-SUBCLASS         ' PV-DISP-REC-SUBCLASS         11040000
110500*    DISPLAY 'WEB-ITEM-IND         ' PV-DISP-WEB-ITEM-IND         11050000
110600*    DISPLAY 'REC-ITEM-NBR         ' PV-DISP-REC-ITEM-NBR         11060000
110700*    DISPLAY 'REC-CASE-PACK-QTY    ' PV-DISP-REC-CASE-PACK-QTY    11070000
110800*    DISPLAY 'REC-PACK-RATO-QTY    ' PV-DISP-REC-PACK-RATO-QTY    11080000
110900*    DISPLAY 'REC-INNER-PACK-QTY   ' PV-DISP-REC-INNER-PACK-QTY   11090000
111000*    DISPLAY 'ODD-UNIT-QTY         ' PV-DISP-ODD-UNIT-QTY         11100000
111100*    DISPLAY 'PKSL-ITM-QTY         ' PV-DISP-PKSL-ITM-QTY         11110000
111200*    DISPLAY 'DTL-CK-ITM-QTY       ' PV-DISP-DTL-CK-ITM-QTY       11120000
111300*    DISPLAY 'BEST-CASE-UNITS      ' PV-DISP-BEST-CASE-UNITS      11130000
111400*    DISPLAY 'DRV-LNE-CDE          ' PV-DISP-DRV-LNE-CDE          11140000
111500*    DISPLAY 'ODU-PRB-CDE          ' PV-DISP-ODU-PRB-CDE          11150000
111600*    DISPLAY 'PP-NEW-RTL-AMT       ' PV-DISP-PP-NEW-RTL-AMT       11160000
111700*    DISPLAY 'PP-NEW-RTL-GP-AMT    ' PV-DISP-PP-NEW-RTL-GP-AMT    11170000
111800*    DISPLAY 'PP-NEW-RTL-GP-QTY    ' PV-DISP-PP-NEW-RTL-GP-QTY    11180000
111900*    DISPLAY 'PP-EFF-DTE           ' PV-DISP-PP-EFF-DTE           11190000
112000*    DISPLAY 'SK-UNT-RTL-PR-AMT    ' PV-DISP-SK-UNT-RTL-PR-AMT    11200000
112100*    DISPLAY 'SK-GP-RTL-AMT        ' PV-DISP-SK-GP-RTL-AMT        11210000
112200*    DISPLAY 'SK-GP-QTY            ' PV-DISP-SK-GP-QTY            11220000
112300*    DISPLAY 'ITEM-DISTRO-QTY      ' PV-DISP-ITEM-DISTRO-QTY      11230000
112400*    DISPLAY 'ITEM-DISTRO-OTR-QTY  ' PV-DISP-ITEM-DISTRO-OTR-QTY  11240000
112500*    DISPLAY 'ITEM-OTR-QTY         ' PV-DISP-ITEM-OTR-QTY.        11250000
112600                                                                  11260000
112700******************************************************************11270000
112800*                                                                *11280000
112900*        R E A D   T E M P   S T O R A G E   Q U E U E S         *11290000
113000*                                                                *11300000
113100******************************************************************11310000
113200 1000-READ-TEMP-STORAGE.                                          11320000
113300                                                                  11330000
113400     INITIALIZE RC821-DATA-FIELDS.                                11340000
113500     MOVE +1 TO PV-ITEM.                                          11350000
113600                                                                  11360000
113700****************************************                          11370000
113800* READ IN THE RECEIVER QUEUE COMPONENT *                          11380000
113900****************************************                          11390000
114000     MOVE RC823-RECEIVER-QUEUE-NAME TO PV-QUEUE-NAME.             11400000
114100     PERFORM 1100-READ-TEMP-RECEIVER-QUEUE.                       11410000
114200                                                                  11420000
114300*************************************                             11430000
114400* READ IN THE STORE QUEUE COMPONENT *                             11440000
114500*************************************                             11450000
114600     IF PS-DONE-NO                                                11460000
114700         MOVE RC823-STORE-QUEUE-NAME TO PV-QUEUE-NAME             11470000
114800         PERFORM 1200-READ-TEMP-STORE-QUEUE                       11480000
114900     END-IF.                                                      11490000
115000                                                                  11500000
115100************************************                              11510000
115200* READ IN THE ITEM QUEUE COMPONENT *                              11520000
115300************************************                              11530000
115400     IF PS-DONE-NO                                                11540000
115500         MOVE RC823-ITEM-QUEUE-NAME TO PV-QUEUE-NAME              11550000
115600         PERFORM 1300-READ-TEMP-ITEM-QUEUE                        11560000
115700           VARYING PV-ITEM FROM 1 BY 1                            11570000
115800             UNTIL PV-ITEM > RC823-ITEM-QUEUE-COUNT               11580000
115900                OR PS-DONE-YES                                    11590000
116000     END-IF.                                                      11600000
116100                                                                  11610000
116200******************************************************************11620000
116300 1100-READ-TEMP-RECEIVER-QUEUE.                                   11630000
116400*    DISPLAY '1100-READ-TEMP-RECEIVER-QUEUE'.                     11640000
116500                                                                  11650000
116600*READ TEMP STORAGE QUEUE.                                         11660000
116700*    EXEC CICS READQ TS                                           11670000
116800*        QUEUE (PV-QUEUE-NAME)                                    11680000
116900*        INTO  (RC821-PO-RECEIVER-CONTENTS)                       11690000
117000*        RESP  (PV-CICS-RESP)                                     11700000
117100*    END-EXEC.                                                    11710000
117200*                                                                 11720000
117300*    IF PV-CICS-RESP = DFHRESP(NORMAL)                            11730000
117400*        CONTINUE                                                 11740000
117500*    ELSE                                                         11750000
117600*        SET PS-DONE-YES TO TRUE                                  11760000
117700*          MOVE SPACES TO RC001-PGM                               11770000
117800*                         RC001-TM500-RC                          11780000
117900*          MOVE ZEROES TO RC001-TRBL-RSN-CDE                      11790000
118000*          MOVE ZEROES TO RC001-PO-LNE-NBR                        11800000
118100*                         RC001-PREPK-ID                          11810000
118200*                         RC001-STORE-NBR-N                       11820000
118300*        PERFORM RC001-RETURN-MSG                                 11830000
118400*    END-IF.                                                      11840000
118500                                                                  11850000
118600******************************************************************11860000
118700 1200-READ-TEMP-STORE-QUEUE.                                      11870000
118800*    DISPLAY '1200-READ-TEMP-STORE-QUEUE'.                        11880000
118900                                                                  11890000
119000*READ TEMP STORAGE QUEUE.                                         11900000
119100*    EXEC CICS READQ TS                                           11910000
119200*        QUEUE (PV-QUEUE-NAME)                                    11920000
119300*        INTO  (RC821-STORE-COMPONENTS)                           11930000
119400*        RESP  (PV-CICS-RESP)                                     11940000
119500*    END-EXEC.                                                    11950000
119600*                                                                 11960000
119700*    IF PV-CICS-RESP = DFHRESP(NORMAL)                            11970000
119800*        CONTINUE                                                 11980000
119900*    ELSE                                                         11990000
120000*        SET PS-DONE-YES TO TRUE                                  12000000
120100*        MOVE SPACES TO RC001-PGM                                 12010000
120200*                       RC001-TM500-RC                            12020000
120300*        MOVE ZEROES TO RC001-TRBL-RSN-CDE                        12030000
120400*        MOVE ZEROES TO RC001-PO-LNE-NBR                          12040000
120500*                       RC001-PREPK-ID                            12050000
120600*                       RC001-STORE-NBR-N                         12060000
120700*        PERFORM RC001-RETURN-MSG                                 12070000
120800*    END-IF.                                                      12080000
120900                                                                  12090000
121000******************************************************************12100000
121100 1300-READ-TEMP-ITEM-QUEUE.                                       12110000
121200*    DISPLAY '1300-READ-TEMP-ITEM-QUEUE'.                         12120000
121300                                                                  12130000
121400*READ TEMP STORAGE QUEUE.                                         12140000
121500*    EXEC CICS READQ TS                                           12150000
121600*        QUEUE (PV-QUEUE-NAME)                                    12160000
121700*        INTO  (RC821-ITEM-COMPONENTS (PV-ITEM))                  12170000
121800*        ITEM  (PV-ITEM)                                          12180000
121900*        RESP  (PV-CICS-RESP)                                     12190000
122000*    END-EXEC.                                                    12200000
122100*                                                                 12210000
122200*    IF (PV-CICS-RESP = DFHRESP(NORMAL))                          12220000
122300*      OR (PV-CICS-RESP = DFHRESP(ITEMERR))                       12230000
122400*        CONTINUE                                                 12240000
122500*    ELSE                                                         12250000
122600*        SET PS-DONE-YES TO TRUE                                  12260000
122700*        MOVE SPACES TO RC001-PGM                                 12270000
122800*                       RC001-TM500-RC                            12280000
122900*        MOVE ZEROES TO RC001-TRBL-RSN-CDE                        12290000
123000*        MOVE ZEROES TO RC001-PO-LNE-NBR                          12300000
123100*                       RC001-PREPK-ID                            12310000
123200*                       RC001-STORE-NBR-N                         12320000
123300*        PERFORM RC001-RETURN-MSG                                 12330000
123400*    END-IF.                                                      12340000
123500                                                                  12350000
123510 1500-TRBL-379-406-CHK.                                           12351000
123520     MOVE '1500-TRBL-379-406-CHK         ' TO RC001-PARAGRAPH.    12352000
123530                                                                  12353000
123540     MOVE RC821-OPER-UNT-ID TO PV-OPER-UNT-ID.                    12354000
123550     PERFORM 1530-CHECK-FOR-LOCATION.                             12355000
123560     IF XLT00010-E-BUS-IND = 'Y' AND                              12356000
123570        XLT00010-LOC-TYP-CDE = 'DC'                               12357000
123580        SET PS-ECOM-YES TO TRUE                                   12358000
123590     ELSE                                                         12359000
123600     IF RC821-CRE-OPER-UNT-ID NOT = RC821-OPER-UNT-ID             12360000
123700        MOVE RC821-CRE-OPER-UNT-ID TO PV-OPER-UNT-ID              12370000
123800        PERFORM 1530-CHECK-FOR-LOCATION                           12380000
123900        IF XLT00010-E-BUS-IND = 'Y'                               12390000
124000           AND XLT00010-LOC-TYP-CDE = 'DC'                        12400000
124100           SET PS-ECOM-CRE-YES TO TRUE                            12410000
124200     ELSE                                                         12420000
124300     IF RC821-CURR-OPER-UNT-ID NOT = RC821-OPER-UNT-ID            12430000
124400        AND RC821-CURR-OPER-UNT-ID NOT = RC821-CRE-OPER-UNT-ID    12440000
124500        MOVE RC821-CURR-OPER-UNT-ID TO                            12450000
124600           PV-OPER-UNT-ID                                         12460000
124700        PERFORM 1530-CHECK-FOR-LOCATION                           12470000
124800        IF XLT00010-E-BUS-IND = 'Y'                               12480000
124900           AND XLT00010-LOC-TYP-CDE = 'DC'                        12490000
125000           SET PS-ECOM-CURR-YES TO TRUE.                          12500000
125100                                                                  12510000
125200     IF (RC821-PO-TYP-CDE NOT = 'IE')                             12520000
125300       AND PS-ECOM-YES                                            12530000
125400       AND PS-ECOM-CRE-NO                                         12540000
125500       AND PS-ECOM-CURR-NO                                        12550000
125501       AND (RC821-PKGNG-CDE = 'B' OR 'C')                         12550100
125502*LOOP ALL ITEMS FOR THE RULE.                                     12550200
125503         PERFORM                                                  12550300
125504         VARYING RC821-ITEM-IDX FROM 1 BY 1                       12550400
125505         UNTIL (PS-DONE-YES                                       12550500
125506            OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              12550600
125507            OR RC821-REC-LNE-NBR (RC821-ITEM-IDX) NOT > ZEROES)   12550700
125508              IF RC821-SKU-INNER-PACK-QTY (RC821-ITEM-IDX) > 1    12550800
125509                  PERFORM 1510-CREATE-379-406-TRBL                12550900
125510              END-IF                                              12551000
125511         END-PERFORM                                              12551100
125512     END-IF.                                                      12551200
125513 1510-CREATE-379-406-TRBL.                                        12551300
125514** AHP - BEGIN - 04/24/08                                         12551400
125515                                                                  12551500
125516     INITIALIZE PV-DB2-COUNT                                      12551600
125517     PERFORM 1550-CHECK-FOR-REPURP                                12551700
125518                                                                  12551800
125519     IF PV-DB2-COUNT > 0                                          12551900
125520*STILL REPURPING.                                                 12552000
125530         PERFORM 1520-CHECK-TKRPRPM                               12553000
125540         IF PS-ASNS-TO-WMS-YES                                    12554000
125550            IF PS-ECOM-CURR-YES                                   12555000
125560               CONTINUE                                           12556000
125570            ELSE                                                  12557000
125580               MOVE TM500-PO-LNE-NBR   TO SAVE-TM500-PO-LNE-NBR   12558000
125590               MOVE TM500-PREPK-ID     TO SAVE-TM500-PREPK-ID     12559000
125600               MOVE 5                  TO RCT00002-MSG-FMT-NBR    12560000
125700               MOVE PC-406             TO RCT00002-TRBL-RSN-CDE   12570000
125800               SET TM500-LINE-LEVEL    TO TRUE                    12580000
125900               MOVE RC821-REC-LNE-NBR (RC821-ITEM-IDX)            12590000
126000                                       TO TM500-PO-LNE-NBR        12600000
126100               MOVE ZERO               TO TM500-PREPK-ID          12610000
126200               PERFORM 8000-CREATE-TROUBLE                        12620000
126300            END-IF                                                12630000
126400         ELSE                                                     12640000
126500            MOVE TM500-PO-LNE-NBR     TO SAVE-TM500-PO-LNE-NBR    12650000
126600            MOVE TM500-PREPK-ID       TO SAVE-TM500-PREPK-ID      12660000
126700            MOVE 5                    TO RCT00002-MSG-FMT-NBR     12670000
126800            MOVE PC-406               TO RCT00002-TRBL-RSN-CDE    12680000
126900            SET TM500-LINE-LEVEL      TO TRUE                     12690000
127000            MOVE RC821-REC-LNE-NBR (RC821-ITEM-IDX)               12700000
127100                                      TO TM500-PO-LNE-NBR         12710000
127200            MOVE ZERO                 TO TM500-PREPK-ID           12720000
127300            PERFORM 8000-CREATE-TROUBLE                           12730000
127400         END-IF                                                   12740000
127500                                                                  12750000
127600         IF PS-PO-RCVR-TRBL-NO                                    12760000
127700             MOVE TM500-PO-LNE-NBR TO SAVE-TM500-PO-LNE-NBR       12770000
127800             MOVE TM500-PREPK-ID   TO SAVE-TM500-PREPK-ID         12780000
127900             MOVE ZERO             TO TM500-PO-LNE-NBR            12790000
128000                                      TM500-PREPK-ID              12800000
128100             SET TM500-PO-LEVEL    TO TRUE                        12810000
128200             MOVE PC-379           TO RCT00002-TRBL-RSN-CDE       12820000
128300             PERFORM 8000-CREATE-TROUBLE                          12830000
128400             SET PS-PO-RCVR-TRBL-YES                              12840000
128500                                   TO TRUE                        12850000
128600         END-IF                                                   12860000
128700     END-IF.                                                      12870000
128800                                                                  12880000
128801** AHP -  END - 04/24/08                                          12880100
128802                                                                  12880200
132341*----------------------------------------------------------------*13234100
132342*  CHECK PARM TABLE TO SEE IF DC IS TURNED ON TO DOWNLOAD ASN'S   13234200
132343*  TO WMS.                                                        13234300
132344*----------------------------------------------------------------*13234400
132345 1520-CHECK-TKRPRPM.                                              13234500
132346                                                                  13234600
132347     MOVE RC821-CURR-OPER-UNT-ID TO PV-COPER-UNT-ID.              13234700
132348                                                                  13234800
132349     EXEC SQL                                                     13234900
132350          SELECT   FUNC_TXT                                       13235000
132351            INTO  :KRPRPM-FUNC-TXT                                13235100
132352            FROM                                                  13235200
132353                  TKRPRPM A                                       13235300
132354            WHERE                                                 13235400
132355                  LOC_ID            = :PV-COPER-UNT-ID            13235500
132356              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    13235600
132357              AND FUNC_PRC_STAT_CDE = 'AC'                        13235700
132358              AND INTFC_SYS_CDE     = 'KHL'                       13235800
132359              AND FUNC_TXT          = 'Y'                         13235900
132360              AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP           13236000
132361     END-EXEC.                                                    13236100
132362                                                                  13236200
132363     EVALUATE TRUE                                                13236300
132364         WHEN SQLCODE = ZERO                                      13236400
132365             SET PS-ASNS-TO-WMS-YES    TO TRUE                    13236500
132366         WHEN SQLCODE = +100                                      13236600
132367             SET PS-ASNS-TO-WMS-NO     TO TRUE                    13236700
132368         WHEN SQLWARN0 NOT = SPACES                               13236800
132369         WHEN SQLCODE  NOT = ZERO                                 13236900
132370            SET PS-DONE-YES   TO TRUE                             13237000
132380            MOVE SPACES       TO TM501-TM500-RETURN-MSG           13238000
132390            MOVE '1520'       TO TM501-PARA                       13239000
132400            MOVE '823'        TO TM501-PGM                        13240000
132500            MOVE SQLCODE      TO TM500-SQLCODE                    13250000
132600            MOVE SQLCA        TO TM500-SQLCA                      13260000
132700            MOVE 101          TO TM501-PRORATION-ERROR-NBR        13270000
132800            PERFORM TM501-SET-TM500-RETURN-MSG                    13280000
132801            PERFORM RC001-RETURN-MSG                              13280100
132802     END-EVALUATE.                                                13280200
132803                                                                  13280300
132804** AHP - BEGIN 04/24/08                                           13280400
132805*----------------------------------------------------------------*13280500
132806*  READ XLT_LOC LOCATION FOR LOC_TYP_CDE ='DC'                    13280600
132807*      AND E_BUS_IND='Y'.                                         13280700
132808*----------------------------------------------------------------*13280800
132809 1530-CHECK-FOR-LOCATION.                                         13280900
132810                                                                  13281000
132820     EXEC SQL                                                     13282000
132830         SELECT LOC_TYP_CDE                                       13283000
132840              , E_BUS_IND                                         13284000
132850           INTO :XLT00010-LOC-TYP-CDE                             13285000
132860              , :XLT00010-E-BUS-IND                               13286000
132870           FROM XLT_LOC                                           13287000
132880           WHERE LOC_NBR             = :PV-OPER-UNT-ID            13288000
132890            AND LOC_TYP_CDE = 'DC'                                13289000
132900            AND E_BUS_IND = 'Y'                                   13290000
133000           ORDER BY LOC_NBR                                       13300000
133100     END-EXEC.                                                    13310000
133200                                                                  13320000
133300     EVALUATE TRUE                                                13330000
133400        WHEN SQLCODE = ZERO                                       13340000
133500        WHEN SQLCODE = +100                                       13350000
133600            CONTINUE                                              13360000
133700        WHEN OTHER                                                13370000
133800            SET PS-DONE-YES   TO TRUE                             13380000
133900            MOVE SPACES       TO TM501-TM500-RETURN-MSG           13390000
134000            MOVE '1530'       TO TM501-PARA                       13400000
134100            MOVE '823'        TO TM501-PGM                        13410000
134200            MOVE SQLCODE      TO TM500-SQLCODE                    13420000
134300            MOVE SQLCA        TO TM500-SQLCA                      13430000
134400            PERFORM TM501-SET-TM500-RETURN-MSG                    13440000
134500            PERFORM RC001-RETURN-MSG                              13450000
134600     END-EVALUATE.                                                13460000
134700*----------------------------------------------------------------*13470000
134800*  CHECK FOR REPURPOSE                                            13480000
134900*----------------------------------------------------------------*13490000
135000 1550-CHECK-FOR-REPURP.                                           13500000
135100                                                                  13510000
135200     EXEC SQL                                                     13520000
135300        SELECT   COUNT(*)                                         13530000
135400        INTO :PV-DB2-COUNT                                        13540000
135500        FROM                                                      13550000
135600              WST_INTGRTN_TYP  A                                  13560000
135700           ,  WST_ATTR_DEFN    B                                  13570000
135800           ,  WST_ATTR_ELEM    C                                  13580000
135900           ,  WST_ATTR_ELEM    D                                  13590000
136000           ,  WST_ATTR_ELEM    E                                  13600000
136100           ,  WST_ATTR_ELEM    F                                  13610000
136200           ,  WST_ATTR_ELEM    G                                  13620000
136300       WHERE                                                      13630000
136400          A.INTGRTN_TYP_CDE   = 'EFCREPURP'                       13640000
136500         AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE              13650000
136600         AND B.ATTR_DEFN_SEQ_NBR = 1                              13660000
136700         AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE              13670000
136800         AND C.ATTR_DEFN_SEQ_NBR = 1                              13680000
136900         AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE              13690000
137000         AND D.ATTR_DEFN_SEQ_NBR = 2                              13700000
137100         AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE              13710000
137200         AND E.ATTR_DEFN_SEQ_NBR = 3                              13720000
137300         AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE              13730000
137400         AND F.ATTR_DEFN_SEQ_NBR = 4                              13740000
137500         AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE              13750000
137600         AND G.ATTR_DEFN_SEQ_NBR = 5                              13760000
137700         AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR            13770000
137800         AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR            13780000
137900         AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR            13790000
138000         AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR            13800000
138100         AND C.ATTR_ELEM_NBR     = :RC821-CURR-OPER-UNT-ID        13810000
138200         AND D.ATTR_ELEM_NBR     = :TM500-OPER-UNT-ID             13820000
138300         AND E.ATTR_ELEM_TXT     = 'Y'                            13830000
138400         AND F.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP              13840000
138500         AND G.ATTR_ELEM_TMST = '9999-09-09-23.59.59.999999'      13850000
138600     END-EXEC                                                     13860000
138700                                                                  13870000
138800***  C.ATTR_ELEM_NBR = 1 = DC NUMBER                              13880000
138900***  D.ATTR_ELEM_NBR = 2 = EFC NUMBER                             13890000
139000                                                                  13900000
139100***  WHEN 810 PROCESING FOR 870, CURR OPER = 810, CRE OPER = 870  13910000
139200                                                                  13920000
240700     EVALUATE TRUE                                                24070000
240800       WHEN SQLCODE = +0                                          24080000
241100       WHEN SQLCODE = +100                                        24110000
241101           CONTINUE                                               24110100
241102                                                                  24110200
241400       WHEN OTHER                                                 24140000
241500           SET PS-DONE-YES TO TRUE                                24150000
241600           MOVE SPACES     TO TM501-TM500-RETURN-MSG              24160000
241700           MOVE '1550'     TO TM501-PARA                          24170000
241800           MOVE '823'      TO TM501-PGM                           24180000
241900           MOVE SQLCODE    TO TM500-SQLCODE                       24190000
242000           MOVE SQLCA      TO TM500-SQLCA                         24200000
242100           MOVE 106        TO TM501-PRORATION-ERROR-NBR           24210000
242200           PERFORM TM501-SET-TM500-RETURN-MSG                     24220000
242300           PERFORM RC001-RETURN-MSG                               24230000
242400     END-EVALUATE.                                                24240000
242500                                                                  24250000
242600** AHP -  END - 04/24/08                                          24260000
242601                                                                  24260100
242602******************************************************************24260200
242603*                                                                *24260300
242604*           R U L E   T A B L E   P R O C E S S I N G            *24260400
242605*                                                                *24260500
242606******************************************************************24260600
242607 2000-SELECT-RULE.                                                24260700
242608     MOVE '2000-SELECT-RULE'        TO TM007-RETURNED-PARA.       24260800
242609                                                                  24260900
242610     MOVE DK-RULE-KEY TO PV-DISP-RULE-KEY.                        24261000
242611     MOVE DK-RULE-SEQ TO PV-DISP-RULE-SEQ.                        24261100
242612*    DISPLAY ' ==> 2000-SELECT-RULE - KEY = ' PV-DISP-RULE-KEY    24261200
242613*                                       ' / ' PV-DISP-RULE-SEQ.   24261300
242614                                                                  24261400
242615     EXEC SQL                                                     24261500
242616         SELECT A.PRRTN_RUL_ID                                    24261600
242617              , A.PRRTN_RUL_SEQ_NBR                               24261700
242618              , A.PRRTN_FUNC_CDE                                  24261800
242619              , A.PRRTN_OPRN_CDE                                  24261900
242620              , A.PRRTN_VAL_NBR                                   24262000
242621              , A.ACTV_IND                                        24262100
242622              , B.PRRTN_FUNC_DESC                                 24262200
242623           INTO :RCT00001-PRRTN-RUL-ID                            24262300
242624              , :RCT00001-PRRTN-RUL-SEQ-NBR                       24262400
242625              , :RCT00001-PRRTN-FUNC-CDE                          24262500
242626              , :RCT00001-PRRTN-OPRN-CDE                          24262600
242627              , :RCT00001-PRRTN-VAL-NBR                           24262700
242628              , :RCT00001-ACTV-IND                                24262800
242629              , :RCT00003-PRRTN-FUNC-DESC                         24262900
242630           FROM RCT_FUNC_RUL A                                    24263000
242631              , RCT_PRRTN_FUNC B                                  24263100
242632          WHERE A.PRRTN_RUL_ID      = :DK-RULE-KEY                24263200
242633            AND A.PRRTN_RUL_SEQ_NBR = :DK-RULE-SEQ                24263300
242634            AND A.PRRTN_FUNC_CDE    = B.PRRTN_FUNC_CDE            24263400
242635     END-EXEC.                                                    24263500
242636                                                                  24263600
242637     EVALUATE TRUE                                                24263700
242638       WHEN SQLCODE = ZERO                                        24263800
242639           SET PS-END-OF-RULES-NO TO TRUE                         24263900
242640                                                                  24264000
242641       WHEN SQLCODE = +100                                        24264100
242642*          DISPLAY '     2000-SELECT-RULE - NOT FOUND'            24264200
242643           SET PS-DONE-YES   TO TRUE                              24264300
242644           MOVE SPACES       TO TM501-TM500-RETURN-MSG            24264400
242645           MOVE '2000'       TO TM501-PARA                        24264500
242646           MOVE '823'        TO TM501-PGM                         24264600
242647           MOVE SQLCODE      TO TM500-SQLCODE                     24264700
242648                                TM007-SQLCODE                     24264800
242649           MOVE SQLCA        TO TM500-SQLCA                       24264900
242650                                TM007-SQLCA                       24265000
242651           MOVE 62           TO TM501-PRORATION-ERROR-NBR         24265100
242652           PERFORM TM501-SET-TM500-RETURN-MSG                     24265200
242653           MOVE TM500-RETURN-DATA  TO TM007-RETURN-DATA           24265300
242654           MOVE TM500-RETURN-MSG   TO TM007-RETURN-MSG            24265400
242655           PERFORM RC001-RETURN-MSG                               24265500
242656                                                                  24265600
242657       WHEN OTHER                                                 24265700
242658           MOVE SQLCODE TO PV-SQLCODE                             24265800
242659*          DISPLAY '     2000-SELECT-RULE - SQLCODE ='            24265900
242660                   PV-SQLCODE                                     24266000
242661           SET PS-DONE-YES   TO TRUE                              24266100
242662           MOVE SPACES       TO TM501-TM500-RETURN-MSG            24266200
242663           MOVE '2000'       TO TM501-PARA                        24266300
242664           MOVE '823'        TO TM501-PGM                         24266400
242665           MOVE SQLCODE      TO TM500-SQLCODE                     24266500
242666                                TM007-SQLCODE                     24266600
242667           MOVE SQLCA        TO TM500-SQLCA                       24266700
242668                                TM007-SQLCA                       24266800
242669           MOVE 63           TO TM501-PRORATION-ERROR-NBR         24266900
242670           PERFORM TM501-SET-TM500-RETURN-MSG                     24267000
242671           MOVE TM500-RETURN-DATA  TO TM007-RETURN-DATA           24267100
242672           MOVE TM500-RETURN-MSG   TO TM007-RETURN-MSG            24267200
242673           PERFORM RC001-RETURN-MSG                               24267300
242674     END-EVALUATE.                                                24267400
242675                                                                  24267500
242676******************************************************************24267600
242677* SKU LEVEL TROUBLE REQUIRES EVERY ITEM(SKU) TO BE PROCESSED.    *24267700
242678******************************************************************24267800
242679 2100-PROCESS-SKU-LVL-TRB.                                        24267900
242680                                                                  24268000
242681*LOOP ALL ITEMS FOR THE RULE.                                     24268100
242682     PERFORM                                                      24268200
242683       VARYING RC821-ITEM-IDX FROM 1 BY 1                         24268300
242684         UNTIL PS-DONE-YES                                        24268400
242685            OR RC821-REC-LNE-NBR (RC821-ITEM-IDX) NOT > ZEROES    24268500
242686                                                                  24268600
242687*        DISPLAY '  REC LINE KEY = '                              24268700
242688*                RC821-REC-LNE-NBR (RC821-ITEM-IDX)               24268800
242689                                                                  24268900
242690         MOVE +1 TO DK-RULE-SEQ                                   24269000
242691                    PV-RULE-SEQ                                   24269100
242692         SET PS-END-OF-RULES-NO TO TRUE                           24269200
242693         PERFORM                                                  24269300
242694           UNTIL PS-END-OF-RULES-YES                              24269400
242695                                                                  24269500
242696             PERFORM 3000-SET-RULE-RESULT                         24269600
242697                                                                  24269700
242698             PERFORM 6000-PROCESS-RULE-ACTIONS                    24269800
242699                                                                  24269900
242700             MOVE PV-RULE-SEQ TO PV-RULE-DISP1                    24270000
242701             MOVE DK-RULE-SEQ TO PV-RULE-DISP2                    24270100
242702*            DISPLAY '    PV-RULE-SEQ / DK-RULE-SEQ = '           24270200
242703*                    PV-RULE-DISP1 ' / ' PV-RULE-DISP2            24270300
242704                                                                  24270400
242705             IF PV-RULE-SEQ NOT = DK-RULE-SEQ                     24270500
242706                 IF PV-RULE-SEQ > DK-RULE-SEQ                     24270600
242707                     MOVE PV-RULE-SEQ TO DK-RULE-SEQ              24270700
242708                     PERFORM 2000-SELECT-RULE                     24270800
242709                 ELSE                                             24270900
242710                     SET PS-END-OF-RULES-YES TO TRUE              24271000
242711                     SET PS-DONE-YES TO TRUE                      24271100
242712                     MOVE SPACES     TO TM501-TM500-RETURN-MSG    24271200
242713                     MOVE '2100'     TO TM501-PARA                24271300
242714                     MOVE '823'      TO TM501-PGM                 24271400
242715                     MOVE SQLCODE    TO TM500-SQLCODE             24271500
242716                                        TM007-SQLCODE             24271600
242717                     MOVE SQLCA      TO TM500-SQLCA               24271700
242718                                        TM007-SQLCA               24271800
242719                     MOVE 54         TO TM501-PRORATION-ERROR-NBR 24271900
242720                     PERFORM TM501-SET-TM500-RETURN-MSG           24272000
242721                     MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA  24272100
242722                     MOVE TM500-RETURN-MSG TO TM007-RETURN-MSG    24272200
242723                     PERFORM RC001-RETURN-MSG                     24272300
242724                 END-IF                                           24272400
242725             ELSE                                                 24272500
242726                 MOVE +1 TO DK-RULE-SEQ                           24272600
242727                            PV-RULE-SEQ                           24272700
242728                 PERFORM 2000-SELECT-RULE                         24272800
242729                 SET PS-END-OF-RULES-YES TO TRUE                  24272900
242730             END-IF                                               24273000
242731         END-PERFORM                                              24273100
242732                                                                  24273200
242733     END-PERFORM.                                                 24273300
242734                                                                  24273400
242735*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  24273500
242736     IF PS-RULE-DONE-YES                                          24273600
242737         SET PS-DONE-YES TO TRUE                                  24273700
242738     END-IF.                                                      24273800
242739                                                                  24273900
242740******************************************************************24274000
242741* PACK LEVEL TROUBLE REQUIRES EVERY PACK(ONLY 1) TO BE PROCESSED.*24274100
242742******************************************************************24274200
242743 2200-PROCESS-PACK-LVL-TRB.                                       24274300
242744     MOVE '2200-PROCESS-PACK-LVL-TRB'  TO TM007-RETURNED-PARA.    24274400
242745                                                                  24274500
242746     MOVE +1 TO DK-RULE-SEQ                                       24274600
242747                PV-RULE-SEQ                                       24274700
242748     SET PS-END-OF-RULES-NO TO TRUE                               24274800
242749     PERFORM                                                      24274900
242750       UNTIL PS-END-OF-RULES-YES                                  24275000
242751                                                                  24275100
242752         PERFORM 3000-SET-RULE-RESULT                             24275200
242753                                                                  24275300
242754         PERFORM 6000-PROCESS-RULE-ACTIONS                        24275400
242755                                                                  24275500
242756         IF PV-RULE-SEQ NOT = DK-RULE-SEQ                         24275600
242757             IF PV-RULE-SEQ > DK-RULE-SEQ                         24275700
242758                 MOVE PV-RULE-SEQ TO DK-RULE-SEQ                  24275800
242759                 PERFORM 2000-SELECT-RULE                         24275900
242760             ELSE                                                 24276000
242761                 SET PS-END-OF-RULES-YES TO TRUE                  24276100
242762                 SET PS-DONE-YES TO TRUE                          24276200
242763                 MOVE SPACES     TO TM501-TM500-RETURN-MSG        24276300
242764                 MOVE '2200'     TO TM501-PARA                    24276400
242765                 MOVE '823'      TO TM501-PGM                     24276500
242766                 MOVE SQLCODE    TO TM500-SQLCODE                 24276600
242767                                    TM007-SQLCODE                 24276700
242768                 MOVE SQLCA      TO TM500-SQLCA                   24276800
242769                                    TM007-SQLCA                   24276900
242770                 MOVE 65         TO TM501-PRORATION-ERROR-NBR     24277000
242771                 PERFORM TM501-SET-TM500-RETURN-MSG               24277100
242772                 MOVE TM500-RETURN-DATA  TO TM007-RETURN-DATA     24277200
242773                 MOVE TM500-RETURN-MSG   TO TM007-RETURN-MSG      24277300
242774                 PERFORM RC001-RETURN-MSG                         24277400
242775             END-IF                                               24277500
242776         ELSE                                                     24277600
242777             SET PS-END-OF-RULES-YES TO TRUE                      24277700
242778         END-IF                                                   24277800
242779                                                                  24277900
242780     END-PERFORM.                                                 24278000
242781                                                                  24278100
242782*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  24278200
242783     IF PS-RULE-DONE-YES                                          24278300
242784         SET PS-DONE-YES TO TRUE                                  24278400
242785     END-IF.                                                      24278500
242786                                                                  24278600
242787******************************************************************24278700
242788* STORE LEVEL TROUBLE REQUIRES EVERY STORE TO BE PROCESSED.      *24278800
242789******************************************************************24278900
242790 2300-PROCESS-STORE-LVL-TRB.                                      24279000
242791     MOVE '2300-PROCESS-STORE-LVL-TRB'   TO TM007-RETURNED-PARA.  24279100
242792                                                                  24279200
242793     PERFORM                                                      24279300
242794       VARYING RC821-STORE-IDX FROM 1 BY 1                        24279400
242795         UNTIL PS-DONE-YES                                        24279500
242796            OR RC821-STR-NBR (RC821-STORE-IDX) NOT > ZEROES       24279600
242797            OR RC821-STORE-IDX > RC821-MAX-STR-COUNT              24279700
242798                                                                  24279800
242799*        DISPLAY '  STORE NBR KEY = '                             24279900
242800*                RC821-STR-NBR (RC821-STORE-IDX)                  24280000
242801                                                                  24280100
242802         MOVE +1 TO DK-RULE-SEQ                                   24280200
242803                    PV-RULE-SEQ                                   24280300
242804         SET PS-END-OF-RULES-NO TO TRUE                           24280400
242805         PERFORM                                                  24280500
242806           UNTIL PS-END-OF-RULES-YES                              24280600
242807                                                                  24280700
242808             PERFORM 3000-SET-RULE-RESULT                         24280800
242809                                                                  24280900
242810             PERFORM 6000-PROCESS-RULE-ACTIONS                    24281000
242811                                                                  24281100
242812*            MOVE PV-RULE-SEQ TO PV-RULE-DISP1                    24281200
242813*            MOVE DK-RULE-SEQ TO PV-RULE-DISP2                    24281300
242814*            DISPLAY '    PV-RULE-SEQ / DK-RULE-SEQ = '           24281400
242815*                    PV-RULE-DISP1 ' / ' PV-RULE-DISP2            24281500
242816                                                                  24281600
242817             IF PV-RULE-SEQ NOT = DK-RULE-SEQ                     24281700
242818                 IF PV-RULE-SEQ > DK-RULE-SEQ                     24281800
242819                     MOVE PV-RULE-SEQ TO DK-RULE-SEQ              24281900
242820                     PERFORM 2000-SELECT-RULE                     24282000
242821                 ELSE                                             24282100
242822                     SET PS-END-OF-RULES-YES TO TRUE              24282200
242823                     SET PS-DONE-YES TO TRUE                      24282300
242824                     MOVE SPACES     TO TM501-TM500-RETURN-MSG    24282400
242825                     MOVE '2300'     TO TM501-PARA                24282500
242826                     MOVE '823'      TO TM501-PGM                 24282600
242827                     MOVE SQLCODE    TO TM500-SQLCODE             24282700
242828                                        TM007-SQLCODE             24282800
242829                     MOVE SQLCA      TO TM500-SQLCA               24282900
242830                                        TM007-SQLCA               24283000
242831                     MOVE 66         TO TM501-PRORATION-ERROR-NBR 24283100
242832                     PERFORM TM501-SET-TM500-RETURN-MSG           24283200
242833                     MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA  24283300
242834                     MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG   24283400
242835                     PERFORM RC001-RETURN-MSG                     24283500
242836                 END-IF                                           24283600
242837             ELSE                                                 24283700
242838                 MOVE +1 TO DK-RULE-SEQ                           24283800
242839                            PV-RULE-SEQ                           24283900
242840                 PERFORM 2000-SELECT-RULE                         24284000
242841                 SET PS-END-OF-RULES-YES TO TRUE                  24284100
242842             END-IF                                               24284200
242843         END-PERFORM                                              24284300
242844                                                                  24284400
242845     END-PERFORM.                                                 24284500
242846                                                                  24284600
242847*10/13/03 ALLOWS A RULE TO FINISH BUT THAT IS IT                  24284700
242848     IF PS-RULE-DONE-YES                                          24284800
242849         SET PS-DONE-YES TO TRUE                                  24284900
242850     END-IF.                                                      24285000
242851                                                                  24285100
242852******************************************************************24285200
242853*    - DETERMINE FUNCTION VALUE                                   24285300
242854*    - COMPARE FUNCTION VALUE TO TABLE VALUE                      24285400
242855*    - SET PV-RULE-RESULT TO 'Y'(TRUE) OR 'N'(FALSE)              24285500
242856******************************************************************24285600
242857 3000-SET-RULE-RESULT.                                            24285700
242858     MOVE '3000-SET-RULE-RESULT' TO TM007-RETURNED-PARA.          24285800
242859                                                                  24285900
242860     MOVE RCT00001-PRRTN-VAL-NBR TO PV-DISP-VALUE.                24286000
242861*    DISPLAY '    3000-SET-RULE-RESULT   VALUE = '                24286100
242862*                    PV-DISP-VALUE.                               24286200
242863                                                                  24286300
242864     MOVE SPACES TO PV-RULE-RESULT.                               24286400
242865                                                                  24286500
242866* UNITS < STORES ALLOC                                            24286600
242867     IF RCT00001-PRRTN-FUNC-CDE = 'ARULAL'                        24286700
242868         MOVE ZEROES TO PV-ARULAL-STR-CNT                         24286800
242869         PERFORM                                                  24286900
242870           VARYING L FROM 1 BY 1                                  24287000
242871             UNTIL L > RC821-MAX-STR-COUNT                        24287100
242872                                                                  24287200
242873             IF (RC821-STR-NBR (L) > ZEROES)                      24287300
242874               AND (RC821-ST-TYPE-CODE (L) NOT = 'CS')            24287400
242875               AND (RC821-STR-DISTRO-QTY (L) =                    24287500
242876                    RC821-STR-OTR-QTY (L))                        24287600
242877                 ADD 1 TO PV-ARULAL-STR-CNT                       24287700
242878             END-IF                                               24287800
242879         END-PERFORM                                              24287900
242880                                                                  24288000
242881         IF (TM500-UNITS-TO-ALLOC / PV-DISPERSAL-QTY)             24288100
242882                             < PV-ARULAL-STR-CNT                  24288200
242883             MOVE 'Y' TO PV-RULE-RESULT                           24288300
242884         ELSE                                                     24288400
242885             MOVE 'N' TO PV-RULE-RESULT                           24288500
242886         END-IF                                                   24288600
242887     END-IF.                                                      24288700
242888                                                                  24288800
242889* ANY ODD UNITS *                                                 24288900
242890     IF RCT00001-PRRTN-FUNC-CDE = 'LNODUE'                        24289000
242891         IF PV-LINE-ODD-UNITS = 'Y'                               24289100
242892             MOVE 'Y' TO PV-RULE-RESULT                           24289200
242893         ELSE                                                     24289300
242894             MOVE 'N' TO PV-RULE-RESULT                           24289400
242895         END-IF                                                   24289500
242896     END-IF.                                                      24289600
242897                                                                  24289700
242898* TOTAL UNITS OVER / SHORT *                                      24289800
242899     IF RCT00001-PRRTN-FUNC-CDE = 'TOTUOS'                        24289900
242900         MOVE ZEROES TO PV-TOT-QTY-OV-SH                          24290000
242901         PERFORM                                                  24290100
242902           VARYING L FROM 1 BY 1                                  24290200
242903             UNTIL RC821-REC-LNE-NBR (L) = ZEROES                 24290300
242904                OR L > RC821-MAX-ITEM-COUNT                       24290400
242905                                                                  24290500
242906             COMPUTE PV-TOT-QTY-OV-SH = PV-TOT-QTY-OV-SH          24290600
242907                   + (RC821-BEST-CASE-UNITS (L)                   24290700
242908                   - RC821-ITEM-OTR-QTY (L))                      24290800
242909         END-PERFORM                                              24290900
242910                                                                  24291000
242911         IF PV-TOT-QTY-OV-SH > ZEROES                             24291100
242912             MOVE 'Y' TO PV-RULE-RESULT                           24291200
242913         ELSE                                                     24291300
242914             MOVE 'N' TO PV-RULE-RESULT                           24291400
242915         END-IF                                                   24291500
242916     END-IF.                                                      24291600
242917                                                                  24291700
242918* CURRENT LOGIC *                                                 24291800
242919     IF RCT00001-PRRTN-FUNC-CDE = 'USLGTD'                        24291900
242920         IF RC821-SHORT-USE-EX-RULES-IND = 'Y'                    24292000
242921             MOVE 'Y' TO PV-RULE-RESULT                           24292100
242922         ELSE                                                     24292200
242923             MOVE 'N' TO PV-RULE-RESULT                           24292300
242924         END-IF                                                   24292400
242925     END-IF.                                                      24292500
242926                                                                  24292600
242927     IF (TM500-OPER-UNT-ID = RC821-OPER-UNT-ID) OR                24292700
242928        (TM500-OPER-UNT-ID = RC821-CRE-OPER-UNT-ID) OR            24292800
242929        (TM500-OPER-UNT-ID = RC821-CURR-OPER-UNT-ID)              24292900
242930       CONTINUE                                                   24293000
242940     ELSE                                                         24294000
242950       PERFORM 1530-CHECK-FOR-LOCATION                            24295000
242960       IF XLT00010-E-BUS-IND = 'Y' AND                            24296000
242970          XLT00010-LOC-TYP-CDE = 'DC'                             24297000
242971          SET PS-ECOM-TM500-YES TO TRUE.                          24297100
242972* E-COMM FACILITY *                                               24297200
242973     IF RCT00001-PRRTN-FUNC-CDE = 'ISECOM'                        24297300
242974        IF PS-ECOM-TM500-YES                                      24297400
242975            MOVE 'Y' TO PV-RULE-RESULT                            24297500
242976        ELSE                                                      24297600
242977            MOVE 'N' TO PV-RULE-RESULT                            24297700
242978        END-IF                                                    24297800
242979     END-IF.                                                      24297900
242980                                                                  24298000
242981* IS THERE ANY ANALYST BAD PACK *                                 24298100
242982     IF RCT00001-PRRTN-FUNC-CDE = 'ANBDPK'                        24298200
242983         IF PS-ANALYST-BAD-PACK-YES                               24298300
242984           OR PS-ANALYST-BP-WITHIN-YES                            24298400
242985             MOVE 'Y' TO PV-RULE-RESULT                           24298500
242986         ELSE                                                     24298600
242987             MOVE 'N' TO PV-RULE-RESULT                           24298700
242988         END-IF                                                   24298800
242989     END-IF.                                                      24298900
242990                                                                  24299000
242991* IS THERE ANALYST BAD PACK *                                     24299100
242992     IF RCT00001-PRRTN-FUNC-CDE = 'AABDPK'                        24299200
242993         IF PS-ANALYST-BAD-PACK-YES                               24299300
242994           OR PV-DIFFERENT-RATIOS = 'Y'                           24299400
242995           OR PV-LINES-MISSING    = 'Y'                           24299500
242996             MOVE 'Y' TO PV-RULE-RESULT                           24299600
242997         ELSE                                                     24299700
242998             MOVE 'N' TO PV-RULE-RESULT                           24299800
242999         END-IF                                                   24299900
243000     END-IF.                                                      24300000
243001                                                                  24300100
243002* IS THERE BAD PACK WITHIN *                                      24300200
243003     IF RCT00001-PRRTN-FUNC-CDE = 'BDPKWI'                        24300300
243004         IF PS-ANALYST-BAD-PACK-NO                                24300400
243005           AND PS-ANALYST-BP-WITHIN-YES                           24300500
243006             MOVE 'Y' TO PV-RULE-RESULT                           24300600
243007         ELSE                                                     24300700
243008             MOVE 'N' TO PV-RULE-RESULT                           24300800
243009         END-IF                                                   24300900
243010     END-IF.                                                      24301000
243011                                                                  24301100
243012* RESOLVE TROUBLE *                                               24301200
243013     IF RCT00001-PRRTN-FUNC-CDE = 'ISMRST'                        24301300
243014         IF TM500-PROCESS-IND = 'RLA'                             24301400
243015             MOVE 'Y' TO PV-RULE-RESULT                           24301500
243016         ELSE                                                     24301600
243017             MOVE 'N' TO PV-RULE-RESULT                           24301700
243018         END-IF                                                   24301800
243019     END-IF.                                                      24301900
243020                                                                  24302000
243021* DUMMY SKU *                                                     24302100
243022     IF RCT00001-PRRTN-FUNC-CDE = 'ISDMSK'                        24302200
243023         IF RC821-DUMMY-SKU-IND (RC821-ITEM-IDX) = 'Y'            24302300
243024             MOVE 'Y' TO PV-RULE-RESULT                           24302400
243025         ELSE                                                     24302500
243026             MOVE 'N' TO PV-RULE-RESULT                           24302600
243027         END-IF                                                   24302700
243028     END-IF.                                                      24302800
243029                                                                  24302900
243030* WEB ITEM *                                                      24303000
243031     IF RCT00001-PRRTN-FUNC-CDE = 'ISWBIT'                        24303100
243032         IF RC821-WEB-ITEM-IND (RC821-ITEM-IDX) = 'Y'             24303200
243033             MOVE 'Y' TO PV-RULE-RESULT                           24303300
243034         ELSE                                                     24303400
243035             MOVE 'N' TO PV-RULE-RESULT                           24303500
243036         END-IF                                                   24303600
243037     END-IF.                                                      24303700
243038                                                                  24303800
243039* ITEM CANCELLED /REVERSED *                                      24303900
243040     IF RCT00001-PRRTN-FUNC-CDE = 'ISITCR'                        24304000
243041         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) =            24304100
243042                                          'CA' OR 'CB' OR 'RV'    24304200
243043             MOVE 'Y' TO PV-RULE-RESULT                           24304300
243044         ELSE                                                     24304400
243045             MOVE 'N' TO PV-RULE-RESULT                           24304500
243046         END-IF                                                   24304600
243047     END-IF.                                                      24304700
243048                                                                  24304800
243049* ITEM CANCELLED *                                                24304900
243050     IF RCT00001-PRRTN-FUNC-CDE = 'ISITCN'                        24305000
243051         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) = 'CA'       24305100
243052             MOVE 'Y' TO PV-RULE-RESULT                           24305200
243053         ELSE                                                     24305300
243054             MOVE 'N' TO PV-RULE-RESULT                           24305400
243055         END-IF                                                   24305500
243056     END-IF.                                                      24305600
243057                                                                  24305700
243058* ITEM CANCELLED BALANCE *                                        24305800
243059     IF RCT00001-PRRTN-FUNC-CDE = 'ISITCB'                        24305900
243060         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) = 'CB'       24306000
243061             MOVE 'Y' TO PV-RULE-RESULT                           24306100
243062         ELSE                                                     24306200
243063             MOVE 'N' TO PV-RULE-RESULT                           24306300
243064         END-IF                                                   24306400
243065     END-IF.                                                      24306500
243066                                                                  24306600
243067* ITEM REVISED *                                                  24306700
243068     IF RCT00001-PRRTN-FUNC-CDE = 'ISITRV'                        24306800
243069         IF RC821-PO-LNE-STATUS-CDE (RC821-ITEM-IDX) = 'RV'       24306900
243070             MOVE 'Y' TO PV-RULE-RESULT                           24307000
243071         ELSE                                                     24307100
243072             MOVE 'N' TO PV-RULE-RESULT                           24307200
243073         END-IF                                                   24307300
243074     END-IF.                                                      24307400
243075                                                                  24307500
243076* ITEM PREPACK *                                                  24307600
243077     IF RCT00001-PRRTN-FUNC-CDE = 'ISPKRC'                        24307700
243078         IF RC821-PKGNG-CDE = 'M' OR 'I'                          24307800
243079             MOVE 'Y' TO PV-RULE-RESULT                           24307900
243080         ELSE                                                     24308000
243081             MOVE 'N' TO PV-RULE-RESULT                           24308100
243082         END-IF                                                   24308200
243083     END-IF.                                                      24308300
243084                                                                  24308400
243085* DC LINE SPLIT *                                                 24308500
243086     IF RCT00001-PRRTN-FUNC-CDE = 'DCLSPE'                        24308600
243087         IF RC821-NO-TALLPLN-DISTRO-IND = 'Y'                     24308700
243088             MOVE 'N' TO PV-RULE-RESULT                           24308800
243089         ELSE                                                     24308900
243090             MOVE 'Y' TO PV-RULE-RESULT                           24309000
243091         END-IF                                                   24309100
243092     END-IF.                                                      24309200
243093                                                                  24309300
243094* PACK DC SPLIT *                                                 24309400
243095     IF RCT00001-PRRTN-FUNC-CDE = 'DCPSPE'                        24309500
243096         IF RC821-NO-TALLPLN-DISTRO-IND = 'Y'                     24309600
243097             MOVE 'N' TO PV-RULE-RESULT                           24309700
243098         ELSE                                                     24309800
243099             MOVE 'Y' TO PV-RULE-RESULT                           24309900
243100         END-IF                                                   24310000
243101     END-IF.                                                      24310100
243102                                                                  24310200
243103* DC LINE SPLIT & ALLOC *                                         24310300
243104     IF RCT00001-PRRTN-FUNC-CDE = 'DCAALE'                        24310400
243105         IF (RC821-NO-TALLPLN-DISTRO-IND = 'N')                   24310500
243106           AND (RC821-NO-TMESTDS-DISTRO-IND = 'N')                24310600
243107             MOVE 'N' TO PV-RULE-RESULT                           24310700
243108         ELSE                                                     24310800
243109             MOVE 'Y' TO PV-RULE-RESULT                           24310900
243110         END-IF                                                   24311000
243111     END-IF.                                                      24311100
243112                                                                  24311200
243113* LINE ALLOC *                                                    24311300
243114     IF RCT00001-PRRTN-FUNC-CDE = 'DSAALE'                        24311400
243115         IF RC821-NO-TMESTDS-DISTRO-IND = 'Y'                     24311500
243116             MOVE 'N' TO PV-RULE-RESULT                           24311600
243117         ELSE                                                     24311700
243118             MOVE 'Y' TO PV-RULE-RESULT                           24311800
243119         END-IF                                                   24311900
243120     END-IF.                                                      24312000
243121                                                                  24312100
243122* PACK ALLOC *                                                    24312200
243123     IF RCT00001-PRRTN-FUNC-CDE = 'DSPALE'                        24312300
243124         IF RC821-NO-TMESTDS-DISTRO-IND = 'Y'                     24312400
243125             MOVE 'N' TO PV-RULE-RESULT                           24312500
243126         ELSE                                                     24312600
243127             MOVE 'Y' TO PV-RULE-RESULT                           24312700
243128         END-IF                                                   24312800
243129     END-IF.                                                      24312900
243130                                                                  24313000
243131* DO PRORATION *                                                  24313100
243132     IF RCT00001-PRRTN-FUNC-CDE = 'DOPROR'                        24313200
243133         IF RC823-DO-ALLOC-IND = 'Y'                              24313300
243134             MOVE 'Y' TO PV-RULE-RESULT                           24313400
243135         ELSE                                                     24313500
243136             MOVE 'N' TO PV-RULE-RESULT                           24313600
243137         END-IF                                                   24313700
243138     END-IF.                                                      24313800
243139                                                                  24313900
243140* LINE UNTIED *                                                   24314000
243141     IF RCT00001-PRRTN-FUNC-CDE = 'ISPKUN'                        24314100
243142         IF RC821-PREPK-ID = 99                                   24314200
243143             MOVE 'Y' TO PV-RULE-RESULT                           24314300
243144         ELSE                                                     24314400
243145             MOVE 'N' TO PV-RULE-RESULT                           24314500
243146         END-IF                                                   24314600
243147     END-IF.                                                      24314700
243148                                                                  24314800
243149* CHECK FOR BAD INNER PACK *                                      24314900
243150     IF RCT00001-PRRTN-FUNC-CDE = 'BDINPK'                        24315000
243151         SET PS-BAD-INNER-PACK-NO TO TRUE                         24315100
243152         PERFORM 3500-CHECK-STR-PACK                              24315200
243153         IF PS-BAD-INNER-PACK-YES                                 24315300
243154             MOVE 'Y' TO PV-RULE-RESULT                           24315400
243155         ELSE                                                     24315500
243156             MOVE 'N' TO PV-RULE-RESULT                           24315600
243157         END-IF                                                   24315700
243158     END-IF.                                                      24315800
243159                                                                  24315900
243160* PBS RECEIVER *                                                  24316000
243161     IF RCT00001-PRRTN-FUNC-CDE = 'PBSRCV'                        24316100
243162         IF RC821-PACK-BY-STORE-IND = 'Y'                         24316200
243163             MOVE 'Y' TO PV-RULE-RESULT                           24316300
243164         ELSE                                                     24316400
243165             MOVE 'N' TO PV-RULE-RESULT                           24316500
243166         END-IF                                                   24316600
243167     END-IF.                                                      24316700
243168                                                                  24316800
243169* LINE ODU *                                                      24316900
243170***  IF RCT00001-PRRTN-FUNC-CDE = 'LNEODU'                        24317000
243171     IF RCT00001-PRRTN-FUNC-CDE = 'LODUOT'                        24317100
243172         IF PV-LINE-ODU-OUT-OF-TOL = 'Y'                          24317200
243173             MOVE 'Y' TO PV-RULE-RESULT                           24317300
243174         ELSE                                                     24317400
243175             MOVE 'N' TO PV-RULE-RESULT                           24317500
243176         END-IF                                                   24317600
243177     END-IF.                                                      24317700
243178                                                                  24317800
243179* LINE ODUD *                                                     24317900
243180***  IF RCT00001-PRRTN-FUNC-CDE = 'LNODUD'                        24318000
243181     IF RCT00001-PRRTN-FUNC-CDE = 'LODDOT'                        24318100
243182         IF PV-LINE-ODUD-OUT-OF-TOL = 'Y'                         24318200
243183             MOVE 'Y' TO PV-RULE-RESULT                           24318300
243184         ELSE                                                     24318400
243185             MOVE 'N' TO PV-RULE-RESULT                           24318500
243186         END-IF                                                   24318600
243187     END-IF.                                                      24318700
243188                                                                  24318800
243189* PACK ODU *                                                      24318900
243190***  IF RCT00001-PRRTN-FUNC-CDE = 'PKODUD'                        24319000
243191     IF RCT00001-PRRTN-FUNC-CDE = 'PODDOT'                        24319100
243192         IF PV-PACK-ODUD-OUT-OF-TOL = 'Y'                         24319200
243193             MOVE 'Y' TO PV-RULE-RESULT                           24319300
243194         ELSE                                                     24319400
243195             MOVE 'N' TO PV-RULE-RESULT                           24319500
243196         END-IF                                                   24319600
243197     END-IF.                                                      24319700
243198                                                                  24319800
243199* PACK ODU *                                                      24319900
243200***  IF RCT00001-PRRTN-FUNC-CDE = 'PKODUS'                        24320000
243201     IF RCT00001-PRRTN-FUNC-CDE = 'PODUOT'                        24320100
243202         IF PV-PACK-ODU-OUT-OF-TOL = 'Y'                          24320200
243203             MOVE 'Y' TO PV-RULE-RESULT                           24320300
243204         ELSE                                                     24320400
243205             MOVE 'N' TO PV-RULE-RESULT                           24320500
243206         END-IF                                                   24320600
243207     END-IF.                                                      24320700
243208                                                                  24320800
243209* PACK ODU *                                                      24320900
243210     IF RCT00001-PRRTN-FUNC-CDE = 'PKODUE'                        24321000
243211         IF RC821-TOTAL-ODD-UNITS > ZEROES                        24321100
243212             MOVE 'Y' TO PV-RULE-RESULT                           24321200
243213         ELSE                                                     24321300
243214             MOVE 'N' TO PV-RULE-RESULT                           24321400
243215         END-IF                                                   24321500
243216     END-IF.                                                      24321600
243217                                                                  24321700
243218* ODD UNITS OUT OF TOLERANCE                                      24321800
243219     IF RCT00001-PRRTN-FUNC-CDE = 'ODUOOT'                        24321900
243220         IF PV-LINE-ODU-OUT-OF-TOL = 'Y'                          24322000
243221           OR PV-LINE-ODUD-OUT-OF-TOL = 'Y'                       24322100
243222           OR PV-PACK-ODU-OUT-OF-TOL = 'Y'                        24322200
243223           OR PV-PACK-ODUD-OUT-OF-TOL = 'Y'                       24322300
243224             MOVE 'Y' TO PV-RULE-RESULT                           24322400
243225         ELSE                                                     24322500
243226             MOVE 'N' TO PV-RULE-RESULT                           24322600
243227         END-IF                                                   24322700
243228     END-IF.                                                      24322800
243229                                                                  24322900
243230* OVER-SHORT MATCH                                                24323000
243231     IF RCT00001-PRRTN-FUNC-CDE = 'ISOVSH'                        24323100
243232         IF RC821-OVER-SHORT-CDE = 'M'                            24323200
243233             MOVE 'Y' TO PV-RULE-RESULT                           24323300
243234         ELSE                                                     24323400
243235             MOVE 'N' TO PV-RULE-RESULT                           24323500
243236         END-IF                                                   24323600
243237     END-IF.                                                      24323700
243238                                                                  24323800
243239* PACK DC SPLIT & ALLOC *                                         24323900
243240     IF RCT00001-PRRTN-FUNC-CDE = 'PDCALE'                        24324000
243241         IF (RC821-NO-TALLPLN-DISTRO-IND = 'N')                   24324100
243242           AND (RC821-NO-TMESTDS-DISTRO-IND = 'N')                24324200
243243             MOVE 'Y' TO PV-RULE-RESULT                           24324300
243244         ELSE                                                     24324400
243245             MOVE 'N' TO PV-RULE-RESULT                           24324500
243246         END-IF                                                   24324600
243247     END-IF.                                                      24324700
243248                                                                  24324800
243249* STORE CLOSED *                                                  24324900
243250     IF RCT00001-PRRTN-FUNC-CDE = 'STCLSD'                        24325000
243251         IF (PV-CURRENT-DATE > RC821-CLOSED-DATE (RC821-STORE-IDX)24325100
243252           OR PV-CURRENT-DATE =                                   24325200
243253                              RC821-CLOSED-DATE (RC821-STORE-IDX))24325300
243254             MOVE 'Y' TO PV-RULE-RESULT                           24325400
243255         ELSE                                                     24325500
243256             MOVE 'N' TO PV-RULE-RESULT                           24325600
243257         END-IF                                                   24325700
243258     END-IF.                                                      24325800
243259                                                                  24325900
243260* OPEN FOR RECEIPT *                                              24326000
243261     IF RCT00001-PRRTN-FUNC-CDE = 'STOPRC'                        24326100
243262         IF (PV-CURRENT-DATE NOT <                                24326200
243263                 RC821-ST-DC-RCT-STA-DTE (RC821-STORE-IDX)        24326300
243264           AND PV-CURRENT-DATE NOT >                              24326400
243265                 RC821-ST-DC-RCT-STO-DTE (RC821-STORE-IDX))       24326500
243266             MOVE 'Y' TO PV-RULE-RESULT                           24326600
243267         ELSE                                                     24326700
243268             MOVE 'N' TO PV-RULE-RESULT                           24326800
243269         END-IF                                                   24326900
243270     END-IF.                                                      24327000
243271                                                                  24327100
243272* WRONG STORE DC *                                                24327200
243273     IF RCT00001-PRRTN-FUNC-CDE = 'WRDCST'                        24327300
243274         MOVE ZEROES TO PV-DC-OPER-UNT-ID                         24327400
243275         IF PV-CURRENT-DATE =                                     24327500
243276                 RC821-ST-DC-RCT-STA-DTE (RC821-STORE-IDX)        24327600
243277             MOVE RC821-ST-DC-NMBR (RC821-STORE-IDX)              24327700
243278               TO PV-DC-OPER-UNT-ID                               24327800
243279         END-IF                                                   24327900
243280         IF (PV-CURRENT-DATE >                                    24328000
243281                 RC821-ST-DC-RCT-STA-DTE (RC821-STORE-IDX))       24328100
243282           AND (PV-CURRENT-DATE <                                 24328200
243283                 RC821-ST-DC-RCT-STO-DTE (RC821-STORE-IDX))       24328300
243284             MOVE RC821-ST-DC-NMBR (RC821-STORE-IDX)              24328400
243285               TO PV-DC-OPER-UNT-ID                               24328500
243286         END-IF                                                   24328600
243287         IF PV-CURRENT-DATE =                                     24328700
243288                 RC821-ST-DC-RCT-STO-DTE (RC821-STORE-IDX)        24328800
243289             MOVE RC821-ST-DC-NMBR (RC821-STORE-IDX)              24328900
243290               TO PV-DC-OPER-UNT-ID                               24329000
243291         END-IF                                                   24329100
243292                                                                  24329200
243293         IF TM500-OPER-UNT-ID NOT = PV-DC-OPER-UNT-ID             24329300
243294             MOVE 'Y' TO PV-RULE-RESULT                           24329400
243295         ELSE                                                     24329500
243296             MOVE 'N' TO PV-RULE-RESULT                           24329600
243297         END-IF                                                   24329700
243298     END-IF.                                                      24329800
243299                                                                  24329900
243300* PACK RATIO MATCH *                                              24330000
243301     IF RCT00001-PRRTN-FUNC-CDE = 'PKRTMT'                        24330100
243302         IF PV-DIFFERENT-RATIOS = 'Y'                             24330200
243303             MOVE 'N' TO PV-RULE-RESULT                           24330300
243304         ELSE                                                     24330400
243305             MOVE 'Y' TO PV-RULE-RESULT                           24330500
243306         END-IF                                                   24330600
243307     END-IF.                                                      24330700
243308                                                                  24330800
243309* MISSING PACK LINES *                                            24330900
243310     IF RCT00001-PRRTN-FUNC-CDE = 'PKMSLN'                        24331000
243311         IF PV-LINES-MISSING = 'Y'                                24331100
243312             MOVE 'Y' TO PV-RULE-RESULT                           24331200
243313         ELSE                                                     24331300
243314             MOVE 'N' TO PV-RULE-RESULT                           24331400
243315         END-IF                                                   24331500
243316     END-IF.                                                      24331600
243317                                                                  24331700
243318* BEST CASE UNITS *                                               24331800
243319     IF RCT00001-PRRTN-FUNC-CDE = 'PKBCUN'                        24331900
243320                                                                  24332000
243321         SET PS-BEST-CASE-UNITS-YES TO TRUE                       24332100
243322         PERFORM                                                  24332200
243323           VARYING L FROM 1 BY 1                                  24332300
243324             UNTIL L > RC821-MAX-ITEM-COUNT                       24332400
243325                OR PS-BEST-CASE-UNITS-NO                          24332500
243326                                                                  24332600
243327             IF RC821-REC-LNE-NBR (L) > ZEROES                    24332700
243328               AND RC821-BEST-CASE-UNITS (L) = ZEROES             24332800
243329                 SET PS-BEST-CASE-UNITS-NO TO TRUE                24332900
243330             END-IF                                               24333000
243331                                                                  24333100
243332         END-PERFORM                                              24333200
243333                                                                  24333300
243334         IF PS-BEST-CASE-UNITS-NO                                 24333400
243335             MOVE 'Y' TO PV-RULE-RESULT                           24333500
243336         ELSE                                                     24333600
243337             MOVE 'N' TO PV-RULE-RESULT                           24333700
243338         END-IF                                                   24333800
243339     END-IF.                                                      24333900
243340                                                                  24334000
243341* PRICE EDIT *                                                    24334100
243342     IF RCT00001-PRRTN-FUNC-CDE = 'OUNPRC'                        24334200
243343                                                                  24334300
243344         MOVE ZEROES TO PV-UNIT-PRICE                             24334400
243345         PERFORM 3100-CALC-UNIT-PRICE                             24334500
243346         MOVE PV-UNIT-PRICE TO PV-DISP-VALUE                      24334600
243347                                                                  24334700
243348         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24334800
243349             IF PV-UNIT-PRICE >= RCT00001-PRRTN-VAL-NBR           24334900
243350                 MOVE 'Y' TO PV-RULE-RESULT                       24335000
243351             ELSE                                                 24335100
243352                 MOVE 'N' TO PV-RULE-RESULT                       24335200
243353             END-IF                                               24335300
243354         END-IF                                                   24335400
243355                                                                  24335500
243356         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24335600
243357             IF PV-UNIT-PRICE =  RCT00001-PRRTN-VAL-NBR           24335700
243358                 MOVE 'Y' TO PV-RULE-RESULT                       24335800
243359             ELSE                                                 24335900
243360                 MOVE 'N' TO PV-RULE-RESULT                       24336000
243361             END-IF                                               24336100
243362         END-IF                                                   24336200
243363                                                                  24336300
243364         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24336400
243365             IF PV-UNIT-PRICE <= RCT00001-PRRTN-VAL-NBR           24336500
243366                 MOVE 'Y' TO PV-RULE-RESULT                       24336600
243367             ELSE                                                 24336700
243368                 MOVE 'N' TO PV-RULE-RESULT                       24336800
243369             END-IF                                               24336900
243370         END-IF                                                   24337000
243371     END-IF.                                                      24337100
243372                                                                  24337200
243373                                                                  24337300
243374     IF RCT00001-PRRTN-FUNC-CDE = 'OPKPRC'                        24337400
243375                                                                  24337500
243376         MOVE ZEROES TO PV-UNIT-PRICE                             24337600
243377                        PV-PACK-PRICE                             24337700
243378         PERFORM 3110-CALC-PACK-UNIT-PRICE                        24337800
243379         MOVE PV-PACK-PRICE TO PV-DISP-VALUE                      24337900
243380                                                                  24338000
243381         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24338100
243382             IF PV-PACK-PRICE >= RCT00001-PRRTN-VAL-NBR           24338200
243383                 MOVE 'Y' TO PV-RULE-RESULT                       24338300
243384             ELSE                                                 24338400
243385                 MOVE 'N' TO PV-RULE-RESULT                       24338500
243386             END-IF                                               24338600
243387         END-IF                                                   24338700
243388                                                                  24338800
243389         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24338900
243390             IF PV-PACK-PRICE =  RCT00001-PRRTN-VAL-NBR           24339000
243391                 MOVE 'Y' TO PV-RULE-RESULT                       24339100
243392             ELSE                                                 24339200
243393                 MOVE 'N' TO PV-RULE-RESULT                       24339300
243394             END-IF                                               24339400
243395         END-IF                                                   24339500
243396                                                                  24339600
243397         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24339700
243398             IF PV-PACK-PRICE <= RCT00001-PRRTN-VAL-NBR           24339800
243399                 MOVE 'Y' TO PV-RULE-RESULT                       24339900
243400             ELSE                                                 24340000
243401                 MOVE 'N' TO PV-RULE-RESULT                       24340100
243402             END-IF                                               24340200
243403         END-IF                                                   24340300
243404     END-IF.                                                      24340400
243405                                                                  24340500
243406* PERCENTAGE EDIT *                                               24340600
243407     IF RCT00001-PRRTN-FUNC-CDE = 'OUNPCT'                        24340700
243408                                                                  24340800
243409         MOVE ZEROES TO PV-TOT-RECEIVED                           24340900
243410                        PV-TOT-PLAN                               24341000
243411                        PV-UNIT-PERCENT                           24341100
243412                        PV-RATIO                                  24341200
243413         PERFORM 4000-PERCENT-OVER-SHORT                          24341300
243414         MOVE PV-RATIO TO PV-DISP-VALUE                           24341400
243415                                                                  24341500
243416         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24341600
243417             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24341700
243418                 MOVE 'Y' TO PV-RULE-RESULT                       24341800
243419             ELSE                                                 24341900
243420                 MOVE 'N' TO PV-RULE-RESULT                       24342000
243421             END-IF                                               24342100
243422         END-IF                                                   24342200
243423                                                                  24342300
243424         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24342400
243425             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24342500
243426                 MOVE 'Y' TO PV-RULE-RESULT                       24342600
243427             ELSE                                                 24342700
243428                 MOVE 'N' TO PV-RULE-RESULT                       24342800
243429             END-IF                                               24342900
243430         END-IF                                                   24343000
243431                                                                  24343100
243432         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24343200
243433             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24343300
243434                 MOVE 'Y' TO PV-RULE-RESULT                       24343400
243435             ELSE                                                 24343500
243436                 MOVE 'N' TO PV-RULE-RESULT                       24343600
243437             END-IF                                               24343700
243438         END-IF                                                   24343800
243439     END-IF.                                                      24343900
243440                                                                  24344000
243441                                                                  24344100
243442     IF RCT00001-PRRTN-FUNC-CDE = 'OPKPCT'                        24344200
243443                                                                  24344300
243444         MOVE ZEROES TO PV-TOT-RECEIVED                           24344400
243445                        PV-TOT-PLAN                               24344500
243446                        PV-UNIT-PERCENT                           24344600
243447                        PV-RATIO                                  24344700
243448                        PV-TOTAL-LINE-OTR-UNITS                   24344800
243449         PERFORM 4000-PERCENT-OVER-SHORT                          24344900
243450         MOVE PV-RATIO TO PV-DISP-VALUE                           24345000
243451                                                                  24345100
243452         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24345200
243453             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24345300
243454                 MOVE 'Y' TO PV-RULE-RESULT                       24345400
243455             ELSE                                                 24345500
243456                 MOVE 'N' TO PV-RULE-RESULT                       24345600
243457             END-IF                                               24345700
243458         END-IF                                                   24345800
243459                                                                  24345900
243460         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24346000
243461             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24346100
243462                 MOVE 'Y' TO PV-RULE-RESULT                       24346200
243463             ELSE                                                 24346300
243464                 MOVE 'N' TO PV-RULE-RESULT                       24346400
243465             END-IF                                               24346500
243466         END-IF                                                   24346600
243467                                                                  24346700
243468         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24346800
243469             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24346900
243470                 MOVE 'Y' TO PV-RULE-RESULT                       24347000
243471             ELSE                                                 24347100
243472                 MOVE 'N' TO PV-RULE-RESULT                       24347200
243473             END-IF                                               24347300
243474         END-IF                                                   24347400
243475     END-IF.                                                      24347500
243476                                                                  24347600
243477                                                                  24347700
243478     IF RCT00001-PRRTN-FUNC-CDE = 'LNSHRT'                        24347800
243479                                                                  24347900
243480         MOVE ZEROES TO PV-TOT-RECEIVED                           24348000
243481                        PV-TOT-PLAN                               24348100
243482                        PV-UNIT-PERCENT                           24348200
243483                        PV-RATIO                                  24348300
243484         PERFORM 4000-PERCENT-OVER-SHORT                          24348400
243485         MOVE PV-RATIO TO PV-DISP-VALUE                           24348500
243486                                                                  24348600
243487         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24348700
243488             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24348800
243489                 MOVE 'Y' TO PV-RULE-RESULT                       24348900
243490             ELSE                                                 24349000
243491                 MOVE 'N' TO PV-RULE-RESULT                       24349100
243492             END-IF                                               24349200
243493         END-IF                                                   24349300
243494                                                                  24349400
243495         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24349500
243496             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24349600
243497                 MOVE 'Y' TO PV-RULE-RESULT                       24349700
243498             ELSE                                                 24349800
243499                 MOVE 'N' TO PV-RULE-RESULT                       24349900
243500             END-IF                                               24350000
243501         END-IF                                                   24350100
243502                                                                  24350200
243503         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24350300
243504             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24350400
243505                 MOVE 'Y' TO PV-RULE-RESULT                       24350500
243506             ELSE                                                 24350600
243507                 MOVE 'N' TO PV-RULE-RESULT                       24350700
243508             END-IF                                               24350800
243509         END-IF                                                   24350900
243510     END-IF.                                                      24351000
243511                                                                  24351100
243512                                                                  24351200
243513     IF RCT00001-PRRTN-FUNC-CDE = 'PKSHRT'                        24351300
243514                                                                  24351400
243515         MOVE ZEROES TO PV-TOT-RECEIVED                           24351500
243516                        PV-TOT-PLAN                               24351600
243517                        PV-UNIT-PERCENT                           24351700
243518                        PV-RATIO                                  24351800
243519                        PV-TOTAL-LINE-OTR-UNITS                   24351900
243520         PERFORM 4000-PERCENT-OVER-SHORT                          24352000
243521         MOVE PV-RATIO TO PV-DISP-VALUE                           24352100
243522                                                                  24352200
243523         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24352300
243524             IF PV-RATIO >= RCT00001-PRRTN-VAL-NBR                24352400
243525                 MOVE 'Y' TO PV-RULE-RESULT                       24352500
243526             ELSE                                                 24352600
243527                 MOVE 'N' TO PV-RULE-RESULT                       24352700
243528             END-IF                                               24352800
243529         END-IF                                                   24352900
243530                                                                  24353000
243531         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24353100
243532             IF PV-RATIO =  RCT00001-PRRTN-VAL-NBR                24353200
243533                 MOVE 'Y' TO PV-RULE-RESULT                       24353300
243534             ELSE                                                 24353400
243535                 MOVE 'N' TO PV-RULE-RESULT                       24353500
243536             END-IF                                               24353600
243537         END-IF                                                   24353700
243538                                                                  24353800
243539         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24353900
243540             IF PV-RATIO <= RCT00001-PRRTN-VAL-NBR                24354000
243541                 MOVE 'Y' TO PV-RULE-RESULT                       24354100
243542             ELSE                                                 24354200
243543                 MOVE 'N' TO PV-RULE-RESULT                       24354300
243544             END-IF                                               24354400
243545         END-IF                                                   24354500
243546     END-IF.                                                      24354600
243547                                                                  24354700
243548* AVERAGE EDIT *                                                  24354800
243549     IF RCT00001-PRRTN-FUNC-CDE = 'OUNAVG'                        24354900
243550                                                                  24355000
243551         MOVE ZEROES TO PV-TOT-RECEIVED                           24355100
243552                        PV-ALLOC-OUTR-PK-QTY                      24355200
243553                        PV-ALLOC-OUTR-PACKS                       24355300
243554                        PV-ALLOC-OUTR-UNITS                       24355400
243555                        PV-UNIT-AVERAGE                           24355500
243556         PERFORM 3300-CALC-UNIT-AVERAGE                           24355600
243557         MOVE PV-UNIT-AVERAGE TO PV-DISP-VALUE                    24355700
243558                                                                  24355800
243559         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24355900
243560             IF PV-UNIT-AVERAGE >= RCT00001-PRRTN-VAL-NBR         24356000
243561                 MOVE 'Y' TO PV-RULE-RESULT                       24356100
243562             ELSE                                                 24356200
243563                 MOVE 'N' TO PV-RULE-RESULT                       24356300
243564             END-IF                                               24356400
243565         END-IF                                                   24356500
243566                                                                  24356600
243567         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24356700
243568             IF PV-UNIT-AVERAGE =  RCT00001-PRRTN-VAL-NBR         24356800
243569                 MOVE 'Y' TO PV-RULE-RESULT                       24356900
243570             ELSE                                                 24357000
243571                 MOVE 'N' TO PV-RULE-RESULT                       24357100
243572             END-IF                                               24357200
243573         END-IF                                                   24357300
243574                                                                  24357400
243575         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24357500
243576             IF PV-UNIT-AVERAGE <= RCT00001-PRRTN-VAL-NBR         24357600
243577                 MOVE 'Y' TO PV-RULE-RESULT                       24357700
243578             ELSE                                                 24357800
243579                 MOVE 'N' TO PV-RULE-RESULT                       24357900
243580             END-IF                                               24358000
243581         END-IF                                                   24358100
243582     END-IF.                                                      24358200
243583                                                                  24358300
243584                                                                  24358400
243585     IF RCT00001-PRRTN-FUNC-CDE = 'OPKAVG'                        24358500
243586                                                                  24358600
243587         MOVE ZEROES TO PV-TOT-RECEIVED                           24358700
243588                        PV-ALLOC-OUTR-PK-QTY                      24358800
243589                        PV-ALLOC-OUTR-PACKS                       24358900
243590                        PV-ALLOC-OUTR-UNITS                       24359000
243591                        PV-UNIT-AVERAGE                           24359100
243592         PERFORM 3310-CALC-PACK-AVERAGE                           24359200
243593         MOVE PV-UNIT-AVERAGE TO PV-DISP-VALUE                    24359300
243594                                                                  24359400
243595         IF RCT00001-PRRTN-OPRN-CDE = 'GE'                        24359500
243596             IF PV-UNIT-AVERAGE >= RCT00001-PRRTN-VAL-NBR         24359600
243597                 MOVE 'Y' TO PV-RULE-RESULT                       24359700
243598             ELSE                                                 24359800
243599                 MOVE 'N' TO PV-RULE-RESULT                       24359900
243600             END-IF                                               24360000
243601         END-IF                                                   24360100
243602                                                                  24360200
243603         IF RCT00001-PRRTN-OPRN-CDE = 'EQ'                        24360300
243604             IF PV-UNIT-AVERAGE =  RCT00001-PRRTN-VAL-NBR         24360400
243605                 MOVE 'Y' TO PV-RULE-RESULT                       24360500
243606             ELSE                                                 24360600
243607                 MOVE 'N' TO PV-RULE-RESULT                       24360700
243608             END-IF                                               24360800
243609         END-IF                                                   24360900
243610                                                                  24361000
243611         IF RCT00001-PRRTN-OPRN-CDE = 'LE'                        24361100
243612             IF PV-UNIT-AVERAGE <= RCT00001-PRRTN-VAL-NBR         24361200
243613                 MOVE 'Y' TO PV-RULE-RESULT                       24361300
243614             ELSE                                                 24361400
243615                 MOVE 'N' TO PV-RULE-RESULT                       24361500
243616             END-IF                                               24361600
243617         END-IF                                                   24361700
243618     END-IF.                                                      24361800
243619                                                                  24361900
243620* BAD STORE ALLOCATION *                                          24362000
243621     IF RCT00001-PRRTN-FUNC-CDE = 'BDSTAL'                        24362100
243622          SET PS-BAD-PACK-RATIO-NO TO TRUE                        24362200
243623          PERFORM 3400-CHECK-STR-PLAN                             24362300
243624          IF PS-BAD-PACK-RATIO-YES                                24362400
243625             MOVE 'Y' TO PV-RULE-RESULT                           24362500
243626          ELSE                                                    24362600
243627             MOVE 'N' TO PV-RULE-RESULT                           24362700
243628          END-IF                                                  24362800
243629     END-IF.                                                      24362900
243630                                                                  24363000
243631                                                                  24363100
243632*    DISPLAY '    FUNC RESULT = '                                 24363200
243633*            RCT00001-PRRTN-FUNC-CDE ' / '                        24363300
243634*            RCT00003-PRRTN-FUNC-DESC '/ '                        24363400
243635*            RCT00001-PRRTN-OPRN-CDE ' / '                        24363500
243636*            PV-DISP-VALUE '/ ' PV-RULE-RESULT.                   24363600
243637                                                                  24363700
243638********************                                              24363800
243639* UNKNOWN FUNCTION *                                              24363900
243640********************                                              24364000
243641     IF PV-RULE-RESULT NOT > SPACES                               24364100
243642*        DISPLAY '*** UNKNOWN FUNCTION CODE ***'                  24364200
243643*        DISPLAY '       FUNCTION / OPERAND / RESULT = '          24364300
243644*                RCT00001-PRRTN-FUNC-CDE ' / '                    24364400
243645*                RCT00001-PRRTN-OPRN-CDE ' / '                    24364500
243646*                PV-DISP-VALUE                                    24364600
243647         MOVE '*** UNKNOWN FUNCTION CODE ***' TO RC001-SPECIAL-1  24364700
243648         STRING '   FUNCTION = '        DELIMITED BY SIZE         24364800
243649                RCT00001-PRRTN-FUNC-CDE DELIMITED BY SIZE         24364900
243650                                            INTO RC001-SPECIAL-2  24365000
243651         SET PS-DONE-YES TO TRUE                                  24365100
243652         MOVE SPACES     TO TM501-TM500-RETURN-MSG                24365200
243653         MOVE '3000'     TO TM501-PARA                            24365300
243654         MOVE '823'      TO TM501-PGM                             24365400
243655         MOVE SQLCODE    TO TM500-SQLCODE                         24365500
243656                            TM007-SQLCODE                         24365600
243657         MOVE SQLCA      TO TM500-SQLCA                           24365700
243658                            TM007-SQLCA                           24365800
243659         MOVE 67         TO TM501-PRORATION-ERROR-NBR             24365900
243660         PERFORM TM501-SET-TM500-RETURN-MSG                       24366000
243661         MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA              24366100
243662         MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG               24366200
243663         PERFORM RC001-RETURN-MSG                                 24366300
243664     END-IF.                                                      24366400
243665                                                                  24366500
243666******************************************************************24366600
243667******************************************************************24366700
243668 3100-CALC-UNIT-PRICE.                                            24366800
243669                                                                  24366900
243670     PERFORM                                                      24367000
243671       VARYING L FROM 1 BY 1                                      24367100
243672         UNTIL L > RC821-ITEM-COUNT                               24367200
243673                                                                  24367300
243674         IF RC821-PO-GP-QTY (L) > 1                               24367400
243675             COMPUTE PV-UNIT-PRICE =                              24367500
243676                     RC821-PO-GP-RTL-AMT (L)                      24367600
243677                   / RC821-PO-GP-QTY (L)                          24367700
243678         ELSE                                                     24367800
243679             COMPUTE PV-UNIT-PRICE =                              24367900
243680                     RC821-PO-UNT-RTL-PR-AMT (L)                  24368000
243681         END-IF                                                   24368100
243682*        DISPLAY '       PV-UNIT-PRICE = ' PV-UNIT-PRICE          24368200
243683                                                                  24368300
243684     END-PERFORM.                                                 24368400
243685                                                                  24368500
243686******************************************************************24368600
243687 3110-CALC-PACK-UNIT-PRICE.                                       24368700
243688                                                                  24368800
243689     PERFORM                                                      24368900
243690       VARYING L FROM 1 BY 1                                      24369000
243691         UNTIL L > RC821-ITEM-COUNT                               24369100
243692                                                                  24369200
243693         IF RC821-PO-GP-QTY (L) > 1                               24369300
243694             COMPUTE PV-UNIT-PRICE =                              24369400
243695                     RC821-PO-GP-RTL-AMT (L)                      24369500
243696                   / RC821-PO-GP-QTY (L)                          24369600
243697         ELSE                                                     24369700
243698             COMPUTE PV-UNIT-PRICE =                              24369800
243699                     RC821-PO-UNT-RTL-PR-AMT (L)                  24369900
243700         END-IF                                                   24370000
243701         IF PV-UNIT-PRICE > PV-PACK-PRICE                         24370100
243702*            DISPLAY '       PV-PACK-PRICE = ' PV-UNIT-PRICE      24370200
243703             MOVE PV-UNIT-PRICE TO PV-PACK-PRICE                  24370300
243704         END-IF                                                   24370400
243705                                                                  24370500
243706     END-PERFORM.                                                 24370600
243707                                                                  24370700
243708******************************************************************24370800
243709 3300-CALC-UNIT-AVERAGE.                                          24370900
243710                                                                  24371000
243711     PERFORM                                                      24371100
243712       VARYING L FROM 1 BY 1                                      24371200
243713         UNTIL L > RC821-ITEM-COUNT                               24371300
243714                                                                  24371400
243715         IF RC821-DTL-CK-ITM-QTY (L) > +0                         24371500
243716             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            24371600
243717                   + RC821-DTL-CK-ITM-QTY (L)                     24371700
243718         ELSE                                                     24371800
243719             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            24371900
243720                   + RC821-PKSL-ITM-QTY (L)                       24372000
243721         END-IF                                                   24372100
243722     END-PERFORM.                                                 24372200
243723                                                                  24372300
243724*    DISPLAY '3300- PV-TOT-RECEIVED = ' PV-TOT-RECEIVED.          24372400
243725                                                                  24372500
243726     MOVE ZEROES TO PV-NEW-STR-CNT                                24372600
243727                    PV-OLD-STR-CNT                                24372700
243728                    PV-CS-STR-CNT                                 24372800
243729                    PV-OVRG-STR-CNT.                              24372900
243730                                                                  24373000
243731     PERFORM                                                      24373100
243732       VARYING L FROM 1 BY 1                                      24373200
243733         UNTIL L > RC821-MAX-STR-COUNT                            24373300
243734                                                                  24373400
243735         IF (RC821-STR-NBR (L) > ZEROES)                          24373500
243736             IF (RC821-ST-TYPE-CODE (L) = 'CS')                   24373600
243737                 ADD 1 TO PV-CS-STR-CNT                           24373700
243738             ELSE                                                 24373800
243739                 IF RC821-EXISTING-STORE-CDE (L) = '1'            24373900
243740                     ADD 1 TO PV-OLD-STR-CNT                      24374000
243741                 ELSE                                             24374100
243742                     ADD 1 TO PV-NEW-STR-CNT                      24374200
243743                 END-IF                                           24374300
243744             END-IF                                               24374400
243745         END-IF                                                   24374500
243746     END-PERFORM.                                                 24374600
243747                                                                  24374700
243748     IF PV-OLD-STR-CNT > ZEROES                                   24374800
243749         MOVE PV-OLD-STR-CNT TO PV-OVRG-STR-CNT                   24374900
243750     ELSE                                                         24375000
243751         IF PV-NEW-STR-CNT > ZEROES                               24375100
243752             MOVE PV-NEW-STR-CNT TO PV-OVRG-STR-CNT               24375200
243753         ELSE                                                     24375300
243754             MOVE PV-CS-STR-CNT  TO PV-OVRG-STR-CNT               24375400
243755         END-IF                                                   24375500
243756     END-IF.                                                      24375600
243757                                                                  24375700
243758     IF PV-OVRG-STR-CNT NOT > ZEROES                              24375800
243759         MOVE 1 TO PV-OVRG-STR-CNT                                24375900
243760     END-IF.                                                      24376000
243761                                                                  24376100
243762     COMPUTE PV-UNIT-AVERAGE = (PV-TOT-RECEIVED                   24376200
243763                             - RC821-SUM-STR-OTR-QTY)             24376300
243764                             / PV-OVRG-STR-CNT.                   24376400
243765                                                                  24376500
243766******************************************************************24376600
243767 3310-CALC-PACK-AVERAGE.                                          24376700
243768                                                                  24376800
243769     PERFORM                                                      24376900
243770       VARYING L FROM 1 BY 1                                      24377000
243771         UNTIL L > RC821-ITEM-COUNT                               24377100
243772                                                                  24377200
243773         COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED                24377300
243774               + RC821-BEST-CASE-UNITS (L)                        24377400
243775                                                                  24377500
243776         COMPUTE PV-TOT-OTR = PV-TOT-OTR                          24377600
243777               + RC821-ITEM-OTR-QTY (L)                           24377700
243778                                                                  24377800
243779     END-PERFORM.                                                 24377900
243780                                                                  24378000
243781*    MOVE PV-TOT-RECEIVED            TO PV-DISP-VALUE2.           24378100
243782*    DISPLAY '3310- PV-TOT-RECEIVED = ' PV-DISP-VALUE2.           24378200
243783*    DISPLAY '3310- PV-TOT-OTR      = ' PV-TOT-OTR.               24378300
243784                                                                  24378400
243785     MOVE ZEROES TO PV-NEW-STR-CNT                                24378500
243786                    PV-OLD-STR-CNT                                24378600
243787                    PV-CS-STR-CNT                                 24378700
243788                    PV-OVRG-STR-CNT.                              24378800
243789                                                                  24378900
243790     PERFORM                                                      24379000
243791       VARYING L FROM 1 BY 1                                      24379100
243792         UNTIL L > RC821-MAX-STR-COUNT                            24379200
243793                                                                  24379300
243794         IF (RC821-STR-NBR (L) > ZEROES)                          24379400
243795             IF (RC821-ST-TYPE-CODE (L) = 'CS')                   24379500
243796                 ADD 1 TO PV-CS-STR-CNT                           24379600
243797             ELSE                                                 24379700
243798                 IF RC821-EXISTING-STORE-CDE (L) = '1'            24379800
243799                     ADD 1 TO PV-OLD-STR-CNT                      24379900
243800                 ELSE                                             24380000
243801                     ADD 1 TO PV-NEW-STR-CNT                      24380100
243802                 END-IF                                           24380200
243900             END-IF                                               24390000
244000         END-IF                                                   24400000
244100     END-PERFORM.                                                 24410000
244200                                                                  24420000
244300     IF PV-OLD-STR-CNT > ZEROES                                   24430000
244400         MOVE PV-OLD-STR-CNT TO PV-OVRG-STR-CNT                   24440000
244500     ELSE                                                         24450000
244600         IF PV-NEW-STR-CNT > ZEROES                               24460000
244700             MOVE PV-NEW-STR-CNT TO PV-OVRG-STR-CNT               24470000
244800         ELSE                                                     24480000
244900             MOVE PV-CS-STR-CNT  TO PV-OVRG-STR-CNT               24490000
245000         END-IF                                                   24500000
245100     END-IF.                                                      24510000
245200                                                                  24520000
245300     IF PV-OVRG-STR-CNT NOT > ZEROES                              24530000
245400         MOVE 1 TO PV-OVRG-STR-CNT                                24540000
245500     END-IF.                                                      24550000
245600                                                                  24560000
245700     COMPUTE PV-UNIT-AVERAGE = (PV-TOT-RECEIVED                   24570000
245800                             - PV-TOT-OTR)                        24580000
245900                             / PV-OVRG-STR-CNT.                   24590000
246000                                                                  24600000
246100******************************************************************24610000
246200 3400-CHECK-STR-PLAN.                                             24620000
246300                                                                  24630000
246400     PERFORM                                                      24640000
246500       VARYING L FROM 1 BY 1                                      24650000
246600         UNTIL L > RC821-MAX-STR-COUNT                            24660000
246700            OR RC821-STR-NBR (L) NOT > ZEROES                     24670000
246800            OR PS-BAD-PACK-RATIO-YES                              24680000
246900                                                                  24690000
247000         IF RC821-STR-VAL-OOR-IND (L) = 'N'                       24700000
247100          OR RC821-STR-GOOD-PLAN-IND (L) = 'N'                    24710000
247200             SET PS-BAD-PACK-RATIO-YES TO TRUE                    24720000
247300         END-IF                                                   24730000
247400                                                                  24740000
247500     END-PERFORM.                                                 24750000
247600                                                                  24760000
247700******************************************************************24770000
247800  3500-CHECK-STR-PACK.                                            24780000
247900      MOVE '3500-CHECK-STR-PACK           ' TO RC001-PARAGRAPH.   24790000
248000                                                                  24800000
248100      PERFORM                                                     24810000
248200        VARYING L FROM 1 BY 1                                     24820000
248300          UNTIL L > RC821-MAX-STR-COUNT                           24830000
248400             OR RC821-STR-NBR (L) NOT > ZEROES                    24840000
248500             OR PS-BAD-INNER-PACK-YES                             24850000
248600                                                                  24860000
248700          DIVIDE PV-DISPERSAL-QTY                                 24870000
248800            INTO RC821-STR-DISTRO-QTY (L)                         24880000
248900          GIVING PV-PACKS-PLANNED  REMAINDER PV-REMAINDER         24890000
249000          IF PV-REMAINDER > ZEROES                                24900000
249100              SET PS-BAD-INNER-PACK-YES TO TRUE                   24910000
249200          END-IF                                                  24920000
249300                                                                  24930000
249400     END-PERFORM.                                                 24940000
249500                                                                  24950000
249600******************************************************************24960000
249700* COMMON ROUTINE USED TO CALCULATE OVER/SHORT PERCENTAGE          24970000
249800******************************************************************24980000
249900 4000-PERCENT-OVER-SHORT.                                         24990000
250000                                                                  25000000
250100     MOVE ZEROES TO PV-TOT-RECEIVED                               25010000
250200                    PV-TOT-PLAN.                                  25020000
250300                                                                  25030000
250400     PERFORM                                                      25040000
250500       VARYING PV-ITEM-IDX FROM 1 BY 1                            25050000
250600         UNTIL PV-ITEM-IDX > RC821-ITEM-COUNT                     25060000
250700                                                                  25070000
250800         IF RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX) > +0                25080000
250900             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            25090000
251000                   + RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX)            25100000
251100         ELSE                                                     25110000
251200             COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED            25120000
251300                   + RC821-PKSL-ITM-QTY(PV-ITEM-IDX)              25130000
251400         END-IF                                                   25140000
251500                                                                  25150000
251600         COMPUTE PV-TOT-RECEIVED = PV-TOT-RECEIVED                25160000
251700               + RC821-ITEM-DISTRO-QTY(PV-ITEM-IDX)               25170000
251800               - RC821-ITEM-DISTRO-OTR-QTY(PV-ITEM-IDX)           25180000
251900                                                                  25190000
252000         COMPUTE PV-TOT-PLAN = PV-TOT-PLAN                        25200000
252100               + RC821-ITEM-DISTRO-QTY(PV-ITEM-IDX)               25210000
252200                                                                  25220000
252300     END-PERFORM.                                                 25230000
252400                                                                  25240000
252500     IF PV-TOT-PLAN > 0                                           25250000
252600         IF PV-TOT-PLAN > PV-TOT-RECEIVED                         25260000
252700             COMPUTE PV-UNIT-PERCENT ROUNDED = (PV-TOT-PLAN       25270000
252800                                             - PV-TOT-RECEIVED)   25280000
252900                                             / PV-TOT-PLAN        25290000
253000         ELSE                                                     25300000
253100             COMPUTE PV-UNIT-PERCENT ROUNDED = (PV-TOT-RECEIVED   25310000
253200                                             - PV-TOT-PLAN)       25320000
253300                                             / PV-TOT-PLAN        25330000
253400         END-IF                                                   25340000
253500     ELSE                                                         25350000
253600         COMPUTE PV-UNIT-PERCENT = 10                             25360000
253700     END-IF.                                                      25370000
253800                                                                  25380000
253900     IF PV-UNIT-PERCENT < 10                                      25390000
254000         COMPUTE PV-RATIO = PV-UNIT-PERCENT * 100                 25400000
254100     ELSE                                                         25410000
254200         MOVE 999 TO PV-RATIO                                     25420000
254300     END-IF.                                                      25430000
254400                                                                  25440000
254500******************************************************************25450000
254600* COMMON ROUTINE USED TO CALCULATE OVER/SHORT DOLLARS             25460000
254700******************************************************************25470000
254800 4001-PERCENT-OV-SH-DOLLARS.                                      25480000
254900                                                                  25490000
255000     MOVE ZEROES TO PV-TOTAL-DOLLARS-OVER-SHORT                   25500000
255100                    PV-TOT-RECEIVED                               25510000
255200                    PV-TOT-PLAN.                                  25520000
255300                                                                  25530000
255400     PERFORM                                                      25540000
255500       VARYING PV-ITEM-IDX FROM 1 BY 1                            25550000
255600         UNTIL PV-ITEM-IDX > RC821-ITEM-COUNT                     25560000
255700                                                                  25570000
255800         MOVE ZEROES TO PV-TOT-RECEIVED                           25580000
255900                        PV-TOT-PLAN                               25590000
256000                                                                  25600000
256100         IF RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX) > +0                25610000
256200             COMPUTE PV-ITM-RECEIVED =                            25620000
256300                     RC821-DTL-CK-ITM-QTY(PV-ITEM-IDX)            25630000
256400         ELSE                                                     25640000
256500             COMPUTE PV-ITM-RECEIVED =                            25650000
256600                     RC821-PKSL-ITM-QTY(PV-ITEM-IDX)              25660000
256700         END-IF                                                   25670000
256800                                                                  25680000
256900         COMPUTE PV-TOT-RECEIVED = PV-ITM-RECEIVED                25690000
257000               + (RC821-ITEM-DISTRO-QTY (PV-ITEM-IDX)             25700000
257100               - RC821-ITEM-DISTRO-OTR-QTY (PV-ITEM-IDX))         25710000
257200                                                                  25720000
257300         MOVE RC821-ITEM-DISTRO-QTY (PV-ITEM-IDX)                 25730000
257400                                    TO PV-TOT-PLAN                25740000
257500                                                                  25750000
257600         IF RC821-PO-GP-QTY (PV-ITEM-IDX) > 1                     25760000
257700             COMPUTE PV-UNIT-PRICE =                              25770000
257800                     RC821-PO-GP-RTL-AMT (PV-ITEM-IDX)            25780000
257900                   / RC821-PO-GP-QTY  (PV-ITEM-IDX)               25790000
258000         ELSE                                                     25800000
258100             MOVE RC821-PO-UNT-RTL-PR-AMT (PV-ITEM-IDX)           25810000
258200                  TO PV-UNIT-PRICE                                25820000
258300         END-IF                                                   25830000
258400                                                                  25840000
258500         IF PV-TOT-PLAN > 0                                       25850000
258600             IF PV-TOT-PLAN > PV-TOT-RECEIVED                     25860000
258700                 COMPUTE PV-UNITS-SHORT-DOLLARS = (PV-TOT-PLAN    25870000
258800                                               - PV-TOT-RECEIVED) 25880000
258900                                               * PV-UNIT-PRICE    25890000
259000                 COMPUTE PV-TOTAL-DOLLARS-OVER-SHORT =            25900000
259100                         PV-TOTAL-DOLLARS-OVER-SHORT              25910000
259200                       - PV-UNITS-SHORT-DOLLARS                   25920000
259300             END-IF                                               25930000
259400             IF PV-TOT-PLAN < PV-TOT-RECEIVED                     25940000
259500                 COMPUTE PV-UNITS-OVER-DOLLARS = (PV-TOT-RECEIVED 25950000
259600                                               - PV-TOT-PLAN)     25960000
259700                                               * PV-UNIT-PRICE    25970000
259800                 COMPUTE PV-TOTAL-DOLLARS-OVER-SHORT =            25980000
259900                         PV-TOTAL-DOLLARS-OVER-SHORT              25990000
260000                       + PV-UNITS-OVER-DOLLARS                    26000000
260100             END-IF                                               26010000
260200         END-IF                                                   26020000
260300     END-PERFORM.                                                 26030000
260400                                                                  26040000
260500     IF PV-TOTAL-DOLLARS-OVER-SHORT < 0                           26050000
260600         COMPUTE PV-TOTAL-DOLLARS-OVER-SHORT =                    26060000
260700                 PV-TOTAL-DOLLARS-OVER-SHORT * -1                 26070000
260800     END-IF.                                                      26080000
260900                                                                  26090000
261000******************************************************************26100000
261100*                                                                *26110000
261200*         D E T A I L   T A B L E   P R O C E S S I N G          *26120000
261300*                                                                *26130000
261400******************************************************************26140000
261500 6000-PROCESS-RULE-ACTIONS.                                       26150000
261700                                                                  26170000
261800     MOVE PV-RULE-RESULT TO DK-RULE-RESULT.                       26180000
261900                                                                  26190000
262000     PERFORM 6100-OPEN-DETL-CURSOR.                               26200000
262100                                                                  26210000
262200     PERFORM                                                      26220000
262300       UNTIL PS-END-OF-RULE-ACT-YES                               26230000
262400                                                                  26240000
262500         PERFORM 6200-FETCH-DETL-CURSOR                           26250000
262600                                                                  26260000
262700     END-PERFORM.                                                 26270000
262800                                                                  26280000
262900     PERFORM 6300-CLOSE-DETL-CURSOR.                              26290000
263000                                                                  26300000
263100******************************************************************26310000
263200 6100-OPEN-DETL-CURSOR.                                           26320000
263210     MOVE '6100-OPEN-DETL-CURSOR'   TO TM007-RETURNED-PARA.       26321000
263220                                                                  26322000
263300                                                                  26330000
263400     EXEC SQL                                                     26340000
263500         OPEN RULE-DETL-CSR                                       26350000
263600     END-EXEC.                                                    26360000
263700                                                                  26370000
263800     EVALUATE TRUE                                                26380000
263900       WHEN SQLCODE = ZERO                                        26390000
264000           SET PS-END-OF-RULE-ACT-NO TO TRUE                      26400000
264100                                                                  26410000
264200       WHEN OTHER                                                 26420000
264300           SET PS-DONE-YES TO TRUE                                26430000
264400           MOVE SPACES     TO TM501-TM500-RETURN-MSG              26440000
264500           MOVE '6100'     TO TM501-PARA                          26450000
264600           MOVE '823'      TO TM501-PGM                           26460000
264700           MOVE SQLCODE    TO TM500-SQLCODE                       26470000
264710                              TM007-SQLCODE                       26471000
264800           MOVE SQLCA      TO TM500-SQLCA                         26480000
264810                              TM007-SQLCA                         26481000
264900           MOVE 68         TO TM501-PRORATION-ERROR-NBR           26490000
265000           PERFORM TM501-SET-TM500-RETURN-MSG                     26500000
265010           MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA            26501000
265020           MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG             26502000
265100           PERFORM RC001-RETURN-MSG                               26510000
265200     END-EVALUATE.                                                26520000
265300                                                                  26530000
265400******************************************************************26540000
265500 6200-FETCH-DETL-CURSOR.                                          26550000
265600                                                                  26560000
265610     MOVE '6200-FETCH-DETL-CURSOR'    TO TM007-RETURNED-PARA.     26561000
265620                                                                  26562000
265700     EXEC SQL                                                     26570000
265800         FETCH RULE-DETL-CSR                                      26580000
265900          INTO :RCT00002-PRRTN-RUL-ID                             26590000
266000             , :RCT00002-PRRTN-RUL-SEQ-NBR                        26600000
266100             , :RCT00002-PRRTN-RUL-IND                            26610000
266200             , :RCT00002-PRRTN-ACTN-SEQ-NBR                       26620000
266300             , :RCT00002-TRBL-RSN-CDE :PV-NULL-IND1               26630000
266400             , :RCT00002-MSG-FMT-NBR                              26640000
266500             , :RCT00002-ACTV-IND                                 26650000
266600             , :RCT00002-ACTN-RSN-CDE                             26660000
266700             , :RCT00002-ACTN-TXT                                 26670000
266800     END-EXEC.                                                    26680000
266900                                                                  26690000
267000     EVALUATE TRUE                                                26700000
267100       WHEN SQLCODE = ZERO                                        26710000
267200           PERFORM 7000-DETERMINE-ACTION                          26720000
267300                                                                  26730000
267400       WHEN SQLCODE = +100                                        26740000
267500           SET PS-END-OF-RULE-ACT-YES TO TRUE                     26750000
267600                                                                  26760000
267700       WHEN OTHER                                                 26770000
267800           SET PS-DONE-YES TO TRUE                                26780000
267900           MOVE SPACES     TO TM501-TM500-RETURN-MSG              26790000
268000           MOVE '6200'     TO TM501-PARA                          26800000
268100           MOVE '823'      TO TM501-PGM                           26810000
268200           MOVE SQLCODE    TO TM500-SQLCODE                       26820000
268210                              TM007-SQLCODE                       26821000
268300           MOVE SQLCA      TO TM500-SQLCA                         26830000
268310                              TM007-SQLCA                         26831000
268400           MOVE 69         TO TM501-PRORATION-ERROR-NBR           26840000
268500           PERFORM TM501-SET-TM500-RETURN-MSG                     26850000
268510           MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA            26851000
268520           MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG             26852000
268600           PERFORM RC001-RETURN-MSG                               26860000
268700     END-EVALUATE.                                                26870000
268800                                                                  26880000
268900******************************************************************26890000
269000 6300-CLOSE-DETL-CURSOR.                                          26900000
269010     MOVE '6300-CLOSE-DETL-CURSOR'   TO TM007-RETURNED-PARA.      26901000
269020                                                                  26902000
269100                                                                  26910000
269200     EXEC SQL                                                     26920000
269300         CLOSE RULE-DETL-CSR                                      26930000
269400     END-EXEC.                                                    26940000
269500                                                                  26950000
269600     EVALUATE TRUE                                                26960000
269700       WHEN SQLCODE = ZERO                                        26970000
269800           CONTINUE                                               26980000
269900                                                                  26990000
270000       WHEN OTHER                                                 27000000
270100           SET PS-DONE-YES TO TRUE                                27010000
270200           MOVE SPACES     TO TM501-TM500-RETURN-MSG              27020000
270300           MOVE '6300'     TO TM501-PARA                          27030000
270400           MOVE '823'      TO TM501-PGM                           27040000
270500           MOVE SQLCODE    TO TM500-SQLCODE                       27050000
270510                              TM007-SQLCODE                       27051000
270600           MOVE SQLCA      TO TM500-SQLCA                         27060000
270610                              TM007-SQLCA                         27061000
270700           MOVE 70         TO TM501-PRORATION-ERROR-NBR           27070000
270800           PERFORM TM501-SET-TM500-RETURN-MSG                     27080000
270810           MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA            27081000
270820           MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG             27082000
270900           PERFORM RC001-RETURN-MSG                               27090000
271000     END-EVALUATE.                                                27100000
271100                                                                  27110000
271200******************************************************************27120000
271300*                                                                *27130000
271400*     D E T E R M I N E   A C T I O N   P R O C E S S I N G      *27140000
271500*                                                                *27150000
271600******************************************************************27160000
271700 7000-DETERMINE-ACTION.                                           27170000
271710     MOVE '7000-DETERMINE-ACTION'    TO TM007-RETURNED-PARA.      27171000
271720                                                                  27172000
271800*    DISPLAY '    7000-DETERMINE-ACTION - '                       27180000
271900*            RCT00002-ACTN-RSN-CDE ' / ' RCT00002-ACTN-TXT.       27190000
272000                                                                  27200000
272100*RULE ACTION = 'RULE' (READ NEXT RULE)                            27210000
272200     IF RCT00002-ACTN-RSN-CDE = 'RULE    '                        27220000
272300         MOVE RCT00002-ACTN-TXT(1:4) TO PV-RULE-SEQ               27230000
272400     END-IF.                                                      27240000
272500                                                                  27250000
272600*RULE ACTION = 'END   ' (NO ACTION REQUIRED)                      27260000
272700     IF RCT00002-ACTN-RSN-CDE = 'END     '                        27270000
272800         CONTINUE                                                 27280000
272900     END-IF.                                                      27290000
273000                                                                  27300000
273100*RULE ACTION = 'NOPROR' (DO NOT DO PRORATION)                     27310000
273200     IF RCT00002-ACTN-RSN-CDE = 'NOPROR  '                        27320000
273300         MOVE 'N' TO RC823-DO-ALLOC-IND                           27330000
273400***      SET TM500-DIDNT-ALLOC-DUE-TO-TRBL TO TRUE                27340000
273500*10/13/03 - STOP ONCE A RULE IS DONE PROCESSING.                  27350000
273600         SET PS-RULE-DONE-YES TO TRUE                             27360000
273700     END-IF.                                                      27370000
273800                                                                  27380000
273900*RULE ACTION = 'NOTIFY' / 'TROUBLE' (CREATE TROUBLE)              27390000
274000     IF RCT00002-ACTN-RSN-CDE = 'TROUBLE ' OR 'NOTIFY  '          27400000
274010       IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'S'                27401000
274020         PERFORM                                                  27402000
274030           VARYING RC821-ITEM-IDX FROM 1 BY 1                     27403000
274040            UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0          27404000
274050             OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT             27405000
274060               PERFORM 8000-CREATE-TROUBLE                        27406000
274070         END-PERFORM                                              27407000
274080       ELSE                                                       27408000
274100         PERFORM 8000-CREATE-TROUBLE                              27410000
274110       END-IF                                                     27411000
274200     END-IF.                                                      27420000
274300                                                                  27430000
274400*RULE ACTION = 'RESOLVE' (RESOLVE THE TROUBLE)                    27440000
274500     IF RCT00002-ACTN-RSN-CDE = 'RESOLVE '                        27450000
274510       IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'S'                27451000
274520         PERFORM                                                  27452000
274530          VARYING RC821-ITEM-IDX FROM 1 BY 1                      27453000
274540           UNTIL RC821-REC-LNE-NBR (RC821-ITEM-IDX) = 0           27454000
274550            OR RC821-ITEM-IDX > RC821-MAX-ITEM-COUNT              27455000
274560              PERFORM 8100-RESOLVE-TROUBLE                        27456000
274570         END-PERFORM                                              27457000
274580       ELSE                                                       27458000
274600         PERFORM 8100-RESOLVE-TROUBLE                             27460000
274610       END-IF                                                     27461000
274700     END-IF.                                                      27470000
274800                                                                  27480000
274900*INVALID ACTION REQUEST.                                          27490000
275000     IF RCT00002-ACTN-RSN-CDE = 'RULE    '                        27500000
275100       OR RCT00002-ACTN-RSN-CDE = 'END     '                      27510000
275200       OR RCT00002-ACTN-RSN-CDE = 'NOPROR  '                      27520000
275300       OR RCT00002-ACTN-RSN-CDE = 'TROUBLE '                      27530000
275400       OR RCT00002-ACTN-RSN-CDE = 'NOTIFY  '                      27540000
275500       OR RCT00002-ACTN-RSN-CDE = 'RESOLVE '                      27550000
275600         CONTINUE                                                 27560000
275700     ELSE                                                         27570000
275800         DISPLAY '==> 7000-DETERMINE-ACTION - INVALID REQUEST '   27580000
275900                 RCT00002-ACTN-RSN-CDE                            27590000
276000         SET PS-DONE-YES TO TRUE                                  27600000
276100         MOVE SPACES     TO TM501-TM500-RETURN-MSG                27610000
276200         MOVE '7000'     TO TM501-PARA                            27620000
276300         MOVE '823'      TO TM501-PGM                             27630000
276400         MOVE SQLCODE    TO TM500-SQLCODE                         27640000
276410                            TM007-SQLCODE                         27641000
276500         MOVE SQLCA      TO TM500-SQLCA                           27650000
276510                            TM007-SQLCA                           27651000
276600         MOVE 71         TO TM501-PRORATION-ERROR-NBR             27660000
276700         PERFORM TM501-SET-TM500-RETURN-MSG                       27670000
276710         MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA              27671000
276720         MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG               27672000
276800         PERFORM RC001-RETURN-MSG                                 27680000
276900     END-IF.                                                      27690000
277000                                                                  27700000
277100******************************************************************27710000
277200*                                                                *27720000
277300*         C R E A T E   T R O U B L E   M E S S A G E S          *27730000
277400*                                                                *27740000
277500******************************************************************27750000
277600 8000-CREATE-TROUBLE.                                             27760000
277610     MOVE '8000-CREATE-TROUBLE' TO TM007-RETURNED-PARA.           27761000
277620                                                                  27762000
277700*    MOVE RCT00002-TRBL-RSN-CDE TO PV-DISP-TRBL-RSN-CDE.          27770000
277800*    DISPLAY ' ==> 8000-CREATE-TROUBLE - ' PV-DISP-TRBL-RSN-CDE.  27780000
277900                                                                  27790000
278000*    MOVE TM500-PO-LNE-NBR      TO SAVE-TM500-PO-LNE-NBR.         27800000
278100*    MOVE TM500-PREPK-ID        TO SAVE-TM500-PREPK-ID.           27810000
278200                                                                  27820000
278300     MOVE TM500-PROCESS-IND     TO SAVE-TM500-PROCESS-IND.        27830000
278400     MOVE 'CRA'                 TO TM500-PROCESS-IND.             27840000
278500                                                                  27850000
278600     MOVE RCT00002-TRBL-RSN-CDE TO TM500-TRBL-RSN-CDE.            27860000
278700     EXEC SQL                                                     27870000
278800         SELECT NOTIF_IND                                         27880000
278900           INTO :TRBRSN-NOTIF-IND                                 27890000
279000           FROM TTRBRSN                                           27900000
279100          WHERE TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE                27910000
279200     END-EXEC.                                                    27920000
279300                                                                  27930000
279400     EVALUATE SQLCODE                                             27940000
279500       WHEN +0                                                    27950000
279600           CONTINUE                                               27960000
279700                                                                  27970000
279800       WHEN OTHER                                                 27980000
279900           SET PS-DONE-YES      TO TRUE                           27990000
280000           MOVE SPACES          TO TM501-TM500-RETURN-MSG         28000000
280100           MOVE '8000'          TO TM501-PARA                     28010000
280200           MOVE '823'           TO TM501-PGM                      28020000
280300           MOVE SQLCODE         TO TM500-SQLCODE                  28030000
280310                                   TM007-SQLCODE                  28031000
280400           MOVE SQLCA           TO TM500-SQLCA                    28040000
280410                                   TM007-SQLCA                    28041000
280500           MOVE 100             TO TM501-PRORATION-ERROR-NBR      28050000
280600           PERFORM TM501-SET-TM500-RETURN-MSG                     28060000
280610           MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA            28061000
280620           MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG             28062000
280700           PERFORM RC001-RETURN-MSG                               28070000
280800     END-EVALUATE.                                                28080000
280900                                                                  28090000
280910*** TROUBLES 379 AND 406 LINE NBR AND PACK ID ARE SAVED           28091000
280920*** IN PARAGRAPH 1510                                             28092000
280930                                                                  28093000
280940     IF TM500-TRBL-RSN-CDE = PC-379 OR PC-406                     28094000
280950         CONTINUE                                                 28095000
280960     ELSE                                                         28096000
280970         MOVE TM500-PO-LNE-NBR  TO SAVE-TM500-PO-LNE-NBR          28097000
280980         MOVE TM500-PREPK-ID    TO SAVE-TM500-PREPK-ID            28098000
280990     END-IF.                                                      28099000
280991                                                                  28099100
280992     MOVE TM500-PROCESS-IND     TO SAVE-TM500-PROCESS-IND.        28099200
280993     MOVE 'CRA'                 TO TM500-PROCESS-IND.             28099300
280994                                                                  28099400
281000     SET TM500-CREATE           TO TRUE.                          28100000
281100     SET TM500-ADD-DETAILS      TO TRUE.                          28110000
281200     IF TRBRSN-NOTIF-IND = 'T'                                    28120000
281300         SET TM500-IN-TROUBLE   TO TRUE                           28130000
281400     END-IF.                                                      28140000
281500                                                                  28150000
281600     MOVE RC821-DEPT-NBR        TO TM500-DEPT-NBR.                28160000
281700     MOVE 'RCKUP823'            TO TM500-CRE-UID.                 28170000
281710                                                                  28171000
281800     IF TM500-TRBL-RSN-CDE = PC-379 OR PC-406                     28180000
281810         PERFORM 8004-379-406-TRBL                                28181000
281820     ELSE                                                         28182000
281830         PERFORM 8002-NON-379-406-TRBL                            28183000
281840     END-IF.                                                      28184000
281850                                                                  28185000
283700     PERFORM 8010-DETERMINE-MSG-TEXT.                             28370000
283900                                                                  28390000
284000     CALL PC-TMKUP521 USING TM500-FIELDS                          28400000
284010                            TM007-COMMUNICATIONS-AREA.            28401000
284100                                                                  28410000
284800     EVALUATE TRUE                                                28480000
284900       WHEN TM500-CALL-SUCCESSFUL                                 28490000
285000       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          28500000
285100       WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                         28510000
285200           MOVE SAVE-TM500-PO-LNE-NBR  TO TM500-PO-LNE-NBR        28520000
285300           MOVE SAVE-TM500-PREPK-ID    TO TM500-PREPK-ID          28530000
285400           MOVE SAVE-TM500-PROCESS-IND TO TM500-PROCESS-IND       28540000
285500                                                                  28550000
285600       WHEN TM500-CREATE AND TM500-DUPLICATE-TROUBLE              28560000
285700*JPL     AND (TM500-TRBL-RSN-CDE = PC-133 OR                      28570000
285800*JPL          TM500-TRBL-RSN-CDE = PC-134 OR                      28580000
285900*JPL          TM500-TRBL-RSN-CDE = PC-135 OR                      28590000
286000*JPL          TM500-TRBL-RSN-CDE = PC-136)                        28600000
286100           MOVE SAVE-TM500-PO-LNE-NBR  TO TM500-PO-LNE-NBR        28610000
286200           MOVE SAVE-TM500-PREPK-ID    TO TM500-PREPK-ID          28620000
286300           MOVE SAVE-TM500-PROCESS-IND TO TM500-PROCESS-IND       28630000
286400                                                                  28640000
286500       WHEN OTHER                                                 28650000
286600           DISPLAY '  *** BAD RETURN CODE FROM TMKUP521 ***'      28660000
286700           MOVE SAVE-TM500-PO-LNE-NBR  TO TM500-PO-LNE-NBR        28670000
286800           MOVE SAVE-TM500-PREPK-ID    TO TM500-PREPK-ID          28680000
286900           MOVE SAVE-TM500-PROCESS-IND TO TM500-PROCESS-IND       28690000
287000                                                                  28700000
287100           SET PS-DONE-YES TO TRUE                                28710000
287200           MOVE SPACES     TO TM501-TM500-RETURN-MSG              28720000
287300           MOVE '8000'     TO TM501-PARA                          28730000
287400           MOVE '823'      TO TM501-PGM                           28740000
287500           MOVE SQLCODE    TO TM500-SQLCODE                       28750000
287510                              TM007-SQLCODE                       28751000
287600           MOVE SQLCA      TO TM500-SQLCA                         28760000
287610                              TM007-SQLCA                         28761000
287700           MOVE 72         TO TM501-PRORATION-ERROR-NBR           28770000
287800           PERFORM TM501-SET-TM500-RETURN-MSG                     28780000
287810           MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA            28781000
287820           MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG             28782000
287900           PERFORM RC001-RETURN-MSG                               28790000
288000     END-EVALUATE.                                                28800000
288100                                                                  28810000
288110 8002-NON-379-406-TRBL.                                           28811000
288120     IF (RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'K' OR 'S')         28812000
288130         MOVE RC821-REC-LNE-NBR (RC821-ITEM-IDX)                  28813000
288140                                TO TM500-PO-LNE-NBR               28814000
288150         MOVE ZERO              TO TM500-PREPK-ID                 28815000
288160         SET TM500-LINE-LEVEL   TO TRUE                           28816000
288170         IF TRBRSN-NOTIF-IND = 'T'                                28817000
288180             ADD 1 TO TM500-LINES-IN-TRBL-COUNT                   28818000
288190         END-IF                                                   28819000
288191     ELSE                                                         28819100
288192         MOVE ZERO              TO TM500-PO-LNE-NBR               28819200
288193         SET TM500-PACK-LEVEL   TO TRUE                           28819300
288194     END-IF.                                                      28819400
288195                                                                  28819500
288196     IF RC823-PRORATE-IND (RC823-RULE-IDX) = 'O' OR 'S'           28819600
288197         PERFORM 4000-PERCENT-OVER-SHORT                          28819700
288198         MOVE PV-RATIO TO TM500-OVER-SHORT-PCT                    28819800
288199     END-IF.                                                      28819900
288200 8004-379-406-TRBL.                                               28820000
288201     IF TM500-LINE-LEVEL                                          28820100
288202       AND TRBRSN-NOTIF-IND = 'T'                                 28820200
288203          ADD 1 TO TM500-LINES-IN-TRBL-COUNT                      28820300
288204     END-IF.                                                      28820400
288205                                                                  28820500
288210******************************************************************28821000
288300*    THIS PARAGRAPH CREATES THE FREEFORM TEXT OF TROUBLE RECORDS. 28830000
288400******************************************************************28840000
288500 8010-DETERMINE-MSG-TEXT.                                         28850000
288600                                                                  28860000
288700     MOVE SPACES TO TM500-FREEFORM-TEXT.                          28870000
288800                                                                  28880000
288900*MESSAGE FORMAT1.                                                 28890000
289000*    IF RCT00002-MSG-FMT-NBR = 1                                  28900000
289100*        MOVE RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX)            28910000
289200*                                    TO TM-MF1-PO-UNT-RTL         28920000
289300*        MOVE RC821-SK-UNT-RTL-PR-AMT (RC821-ITEM-IDX)            28930000
289400*                                    TO TM-MF1-SKU-UNT-RTL        28940000
289500*        MOVE RC821-PO-GP-QTY (RC821-ITEM-IDX)                    28950000
289600*                                    TO TM-MF1-PO-GP-QTY          28960000
289700*        MOVE RC821-SK-GP-QTY (RC821-ITEM-IDX)                    28970000
289800*                                    TO TM-MF1-SKU-GP-QTY         28980000
289900*        MOVE RC821-PO-GP-RTL-AMT (RC821-ITEM-IDX)                28990000
290000*                                    TO TM-MF1-PO-GP-RTL          29000000
290100*        MOVE RC821-SK-GP-RTL-AMT (RC821-ITEM-IDX)                29010000
290200*                                    TO TM-MF1-SKU-GP-RTL         29020000
290300*        MOVE TM-PRICE-DISC-TEXT     TO TM500-FREEFORM-TEXT       29030000
290400*    END-IF.                                                      29040000
290500                                                                  29050000
290600*MESSAGE FORMAT2.                                                 29060000
290700     IF RCT00002-MSG-FMT-NBR = 2                                  29070000
290800         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     29080000
290900                                     TO TM-MF2-STR                29090000
291000         MOVE TM-STR-CLS-TEXT        TO TM500-FREEFORM-TEXT       29100000
291100     END-IF.                                                      29110000
291200                                                                  29120000
291300*MESSAGE FORMAT3.                                                 29130000
291400     IF RCT00002-MSG-FMT-NBR = 3                                  29140000
291500         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     29150000
291600                                     TO TM-MF3-STR                29160000
291700         MOVE TM-STR-NOT-RCVG-TEXT   TO TM500-FREEFORM-TEXT       29170000
291800     END-IF.                                                      29180000
291900                                                                  29190000
292000*MESSAGE FORMAT4.                                                 29200000
292100     IF RCT00002-MSG-FMT-NBR = 4                                  29210000
292200         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     29220000
292300                                     TO TM-MF4-STR                29230000
292400         MOVE TM-WRONG-DC-TEXT       TO TM500-FREEFORM-TEXT       29240000
292500     END-IF.                                                      29250000
292600                                                                  29260000
292700*MESSAGE FORMAT5.                                                 29270000
292800     IF RCT00002-MSG-FMT-NBR = 5                                  29280000
292900         PERFORM 8011-CALC-ITEM                                   29290000
293000                                                                  29300000
293100         MOVE PV-ACCUM-RECD-UNITS    TO TM-MF5-RCVD-QTY           29310000
293200         MOVE TM-LINE-STS-TEXT       TO TM500-FREEFORM-TEXT       29320000
293300     END-IF.                                                      29330000
293400                                                                  29340000
293500*MESSAGE FORMAT6.                                                 29350000
293600     IF RCT00002-MSG-FMT-NBR = 6                                  29360000
293700         MOVE TM-ZERO-BEST-CASE-TEXT TO TM500-FREEFORM-TEXT       29370000
293800     END-IF.                                                      29380000
293900                                                                  29390000
294000*MESSAGE FORMAT7.                                                 29400000
294100     IF RCT00002-MSG-FMT-NBR = 7                                  29410000
294200         PERFORM 8011-CALC-ITEM                                   29420000
294300                                                                  29430000
294400         COMPUTE PV-PACK-REC = RC821-BEST-CASE-UNITS (DL)         29440000
294500                             / RC821-REC-PACK-RATO-QTY (DL)       29450000
294600         MOVE PV-PACK-REC          TO TM-MF7-REC                  29460000
294700         MOVE RC821-SUM-STR-OTR-PK TO TM-MF7-OTR                  29470000
294800                                                                  29480000
294900         COMPUTE PV-PACK-OV = PV-PACK-REC                         29490000
295000                            - RC821-SUM-STR-OTR-PK                29500000
295100         MOVE PV-PACK-OV           TO TM-MF7-OV-QTY               29510000
295200                                                                  29520000
295300         PERFORM 4000-PERCENT-OVER-SHORT                          29530000
295400         MOVE PV-RATIO TO TM-MF7-OV-PCT                           29540000
295500                                                                  29550000
295600         IF TM-MF7-OV-PCT = '  0'                                 29560000
295700           AND PV-UNIT-PERCENT > ZEROES                           29570000
295800             MOVE 1        TO TM-MF7-OV-PCT                       29580000
295900         END-IF                                                   29590000
296000                                                                  29600000
296100         MOVE PV-PACK-DOLLARS         TO TM-MF7-RT-AMT            29610000
296200         MOVE PV-ACCUM-LINE-OV-AMT    TO TM-MF7-TOT-RT-AMT        29620000
296300         MOVE RC821-TOTAL-ODD-UNITS   TO TM-MF7-ODD-QTY           29630000
296400         IF RC821-TOTAL-ODD-UNITS > ZEROES                        29640000
296500             PERFORM 8012-CALC-ODD-UNIT-AMT                       29650000
296600             MOVE PV-ODD-UNIT-DOLLARS TO TM-MF7-ODD-AMT           29660000
296700         ELSE                                                     29670000
296800             MOVE ZEROES              TO TM-MF7-ODD-AMT           29680000
296900         END-IF                                                   29690000
297000         PERFORM 8013-CALC-MSG-TEXT                               29700000
297100         MOVE PV-MSG-TEXT             TO TM-MF7-TEXT              29710000
297200         MOVE RC821-STR-COUNT         TO TM-MF7-STR-ALLOC         29720000
297300         PERFORM 8014-COUNT-STORES                                29730000
297400         PERFORM 8015-CALC-OVRG-QTY                               29740000
297500         COMPUTE PV-AVG-UNITS = PV-OVRG-QTY                       29750000
297600                              / PV-OVRG-STR-CNT                   29760000
297700         MOVE PV-AVG-UNITS            TO TM-MF7-AVG-UN            29770000
297800         MOVE TM-PACK-OVER-TEXT       TO TM500-FREEFORM-TEXT      29780000
297900     END-IF.                                                      29790000
298000                                                                  29800000
298100*MESSAGE FORMAT8.                                                 29810000
298200     IF RCT00002-MSG-FMT-NBR = 8                                  29820000
298300         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     29830000
298400                                      TO TM-MF8-STR               29840000
298500         MOVE TM-INVALID-STORE-TEXT   TO TM500-FREEFORM-TEXT      29850000
298600     END-IF.                                                      29860000
298700                                                                  29870000
300500*MESSAGE FORMAT10.                                                30050000
300600     IF RCT00002-MSG-FMT-NBR = 10                                 30060000
300700         PERFORM 8011-CALC-ITEM                                   30070000
300800                                                                  30080000
300900         MOVE PV-ACCUM-RECD-UNITS     TO TM-MF10-RCVD-QTY         30090000
301000         MOVE RC821-SUM-STR-OTR-QTY   TO TM-MF10-OTR-QTY          30100000
301100                                                                  30110000
301200         COMPUTE TM-MF10-SH-QTY = RC821-SUM-STR-OTR-QTY           30120000
301300                                - PV-ACCUM-RECD-UNITS             30130000
301400                                                                  30140000
301500         PERFORM 4000-PERCENT-OVER-SHORT                          30150000
301600         MOVE PV-RATIO TO TM-MF10-SH-PCT                          30160000
301700                                                                  30170000
301800         IF TM-MF10-SH-PCT = '  0'                                30180000
301900           AND PV-UNIT-PERCENT > ZEROES                           30190000
302000             MOVE 1        TO TM-MF10-SH-PCT                      30200000
302100         END-IF                                                   30210000
302200                                                                  30220000
302300         MOVE RC821-STR-COUNT      TO TM-MF10-STR-ALLOC           30230000
302400         COMPUTE PV-AVG-UNITS = PV-ACCUM-RECD-UNITS               30240000
302500                              / RC821-STR-COUNT                   30250000
302600         MOVE PV-AVG-UNITS         TO TM-MF10-AV-UN-STR           30260000
302700                                                                  30270000
302800         MOVE PV-UNIT-PRICE        TO TM-MF10-RTL-UN              30280000
302900         MOVE PV-ACCUM-LINE-SH-AMT TO TM-MF10-SH-AMT              30290000
303000                                                                  30300000
303100         MOVE TM-SHORT-TEXT        TO TM500-FREEFORM-TEXT         30310000
303200     END-IF.                                                      30320000
303300                                                                  30330000
303400*MESSAGE FORMAT11.                                                30340000
303500     IF RCT00002-MSG-FMT-NBR = 11                                 30350000
303600         PERFORM 8011-CALC-ITEM                                   30360000
303700                                                                  30370000
303800         COMPUTE PV-PACK-REC = RC821-BEST-CASE-UNITS (DL)         30380000
303900                             / RC821-REC-PACK-RATO-QTY (DL)       30390000
304000         MOVE PV-PACK-REC          TO TM-MF11-REC                 30400000
304100         MOVE RC821-SUM-STR-OTR-PK TO TM-MF11-OTR                 30410000
304200                                                                  30420000
304300         COMPUTE TM-MF11-SH-QTY = RC821-SUM-STR-OTR-PK            30430000
304400                                - PV-PACK-REC                     30440000
304500                                                                  30450000
304600         PERFORM 4000-PERCENT-OVER-SHORT                          30460000
304700         MOVE PV-RATIO TO TM-MF11-SH-PCT                          30470000
304800                                                                  30480000
304900         IF TM-MF11-SH-PCT = '  0'                                30490000
305000           AND PV-UNIT-PERCENT > ZEROES                           30500000
305100             MOVE 1        TO TM-MF11-SH-PCT                      30510000
305200         END-IF                                                   30520000
305300                                                                  30530000
305400         MOVE PV-PACK-DOLLARS         TO TM-MF11-RT-AMT           30540000
305500         MOVE PV-ACCUM-LINE-SH-AMT    TO TM-MF11-TOT-RT-AMT       30550000
305600                                                                  30560000
305700         MOVE RC821-TOTAL-ODD-UNITS   TO TM-MF11-ODD-QTY          30570000
305800         IF RC821-TOTAL-ODD-UNITS > ZEROES                        30580000
305900             PERFORM 8012-CALC-ODD-UNIT-AMT                       30590000
306000             MOVE PV-ODD-UNIT-DOLLARS TO TM-MF11-ODD-AMT          30600000
306100         ELSE                                                     30610000
306200             MOVE ZEROES              TO TM-MF11-ODD-AMT          30620000
306300         END-IF                                                   30630000
306400                                                                  30640000
306500         PERFORM 8013-CALC-MSG-TEXT                               30650000
306600         MOVE PV-MSG-TEXT             TO TM-MF11-TEXT             30660000
306700         MOVE RC821-STR-COUNT         TO TM-MF11-STR-ALLOC        30670000
306800         MOVE TM-PACK-SHORT-TEXT      TO TM500-FREEFORM-TEXT      30680000
306900     END-IF.                                                      30690000
307000                                                                  30700000
307100*MESSAGE FORMAT12.                                                30710000
307200     IF RCT00002-MSG-FMT-NBR = 12                                 30720000
307300         PERFORM 8011-CALC-ITEM                                   30730000
307400                                                                  30740000
307500         MOVE PV-ACCUM-RECD-UNITS   TO TM-MF12-RCVD-QTY           30750000
307600         MOVE RC821-SUM-STR-OTR-QTY TO TM-MF12-OTR-QTY            30760000
307700         COMPUTE TM-MF12-OV-QTY = PV-ACCUM-RECD-UNITS             30770000
307800                                - RC821-SUM-STR-OTR-QTY           30780000
307900                                                                  30790000
308000         PERFORM 4000-PERCENT-OVER-SHORT                          30800000
308100         MOVE PV-RATIO TO TM-MF12-OV-PCT                          30810000
308200                                                                  30820000
308300         IF TM-MF12-OV-PCT = '  0'                                30830000
308400           AND PV-UNIT-PERCENT > ZEROES                           30840000
308500             MOVE 1        TO TM-MF12-OV-PCT                      30850000
308600         END-IF                                                   30860000
308700                                                                  30870000
308800         MOVE RC821-STR-COUNT TO TM-MF12-STR-ALLOC                30880000
308900                                                                  30890000
309000         PERFORM 8014-COUNT-STORES                                30900000
309100         COMPUTE PV-AVG-UNITS = (TM500-UNITS-TO-ALLOC             30910000
309200                               - RC821-SUM-STR-OTR-QTY)           30920000
309300                               / PV-OVRG-STR-CNT                  30930000
309400         MOVE PV-AVG-UNITS         TO TM-MF12-AV-UN-STR           30940000
309500         MOVE PV-UNIT-PRICE        TO TM-MF12-RTL-UN              30950000
309600         MOVE PV-ACCUM-LINE-OV-AMT TO TM-MF12-OV-AMT              30960000
309700         MOVE TM-OVER-TEXT         TO TM500-FREEFORM-TEXT         30970000
309800     END-IF.                                                      30980000
309900                                                                  30990000
310000*MESSAGE FORMAT13.                                                31000000
310100     IF RCT00002-MSG-FMT-NBR = 13                                 31010000
310200         PERFORM 8011-CALC-ITEM                                   31020000
310300                                                                  31030000
310400         MOVE PV-ACCUM-RECD-UNITS    TO TM-MF13-RCVD-QTY          31040000
310500         MOVE TM-PACK-NO-DISTRO-TEXT TO TM500-FREEFORM-TEXT       31050000
310600     END-IF.                                                      31060000
310700                                                                  31070000
310800*MESSAGE FORMAT14.                                                31080000
310900     IF RCT00002-MSG-FMT-NBR = 14                                 31090000
311000         MOVE SPACES TO TM-MF14-OV-SH-1                           31100000
311100                        TM-MF14-OV-SH-2                           31110000
311200                                                                  31120000
311300         PERFORM 8011-CALC-ITEM                                   31130000
311400         PERFORM 8014-COUNT-STORES                                31140000
311500         PERFORM 8015-CALC-OVRG-QTY                               31150000
311600                                                                  31160000
311700         COMPUTE PV-PACK-REC = RC821-BEST-CASE-UNITS (DL)         31170000
311800                             / RC821-REC-PACK-RATO-QTY (DL)       31180000
311900         MOVE PV-PACK-REC          TO TM-MF14-REC                 31190000
312000         MOVE RC821-SUM-STR-OTR-PK TO TM-MF14-OTR                 31200000
312100                                                                  31210000
312200         MOVE PV-PACK-DOLLARS      TO TM-MF14-RT-AMT              31220000
312300         MOVE ZEROES               TO TM-MF14-AVG-UN              31230000
312400                                                                  31240000
312500         PERFORM 4001-PERCENT-OV-SH-DOLLARS                       31250000
312600         PERFORM 4000-PERCENT-OVER-SHORT                          31260000
312700                                                                  31270000
312800         IF PV-TOT-PLAN < PV-TOT-RECEIVED                         31280000
312900           OR PV-TOT-PLAN = PV-TOT-RECEIVED                       31290000
313000             MOVE 'OV' TO TM-MF14-OV-SH-1                         31300000
313100                          TM-MF14-OV-SH-2                         31310000
313200             COMPUTE TM-MF14-PK-QTY = PV-PACK-REC                 31320000
313300                                    - RC821-SUM-STR-OTR-PK        31330000
313400             IF PV-TOT-PLAN = PV-TOT-RECEIVED                     31340000
313500                 MOVE ZEROES TO TM-MF14-PK-QTY                    31350000
313600             END-IF                                               31360000
313700                                                                  31370000
313800             MOVE PV-RATIO TO TM-MF14-PK-PCT                      31380000
313900                                                                  31390000
314000             IF TM-MF14-PK-PCT = '  0'                            31400000
314100               AND PV-UNIT-PERCENT > ZEROES                       31410000
314200                 MOVE 1        TO TM-MF14-PK-PCT                  31420000
314300             END-IF                                               31430000
314400                                                                  31440000
314500             MOVE PV-PACK-DOLLARS      TO TM-MF14-RT-AMT          31450000
314600***          MOVE PV-ACCUM-LINE-OV-AMT TO TM-MF14-TOT-RT-AMT      31460000
314700             MOVE PV-TOTAL-DOLLARS-OVER-SHORT                     31470000
314800                                       TO TM-MF14-TOT-RT-AMT      31480000
314900***          COMPUTE PV-AVG-UNITS = (PV-PACK-REC                  31490000
315000***                               - RC821-SUM-STR-OTR-PK)         31500000
315100             COMPUTE PV-AVG-UNITS = PV-OVRG-QTY                   31510000
315200                                  / PV-OVRG-STR-CNT               31520000
315300             MOVE PV-AVG-UNITS TO TM-MF14-AVG-UN                  31530000
315400         END-IF                                                   31540000
315500                                                                  31550000
315600         IF PV-TOT-PLAN > PV-TOT-RECEIVED                         31560000
315700             MOVE 'SH' TO TM-MF14-OV-SH-1                         31570000
315800                          TM-MF14-OV-SH-2                         31580000
315900             COMPUTE TM-MF14-PK-QTY = RC821-SUM-STR-OTR-PK        31590000
316000                                    - PV-PACK-REC                 31600000
316100                                                                  31610000
316200             MOVE PV-RATIO TO TM-MF14-PK-PCT                      31620000
316300                                                                  31630000
316400             IF TM-MF14-PK-PCT = '  0'                            31640000
316500               AND PV-UNIT-PERCENT > ZEROES                       31650000
316600                 MOVE 1        TO TM-MF14-PK-PCT                  31660000
316700             END-IF                                               31670000
316800                                                                  31680000
316900             MOVE PV-PACK-DOLLARS      TO TM-MF14-RT-AMT          31690000
317000***          MOVE PV-ACCUM-LINE-SH-AMT TO TM-MF14-TOT-RT-AMT      31700000
317100             MOVE PV-TOTAL-DOLLARS-OVER-SHORT                     31710000
317200                                       TO TM-MF14-TOT-RT-AMT      31720000
317300                                                                  31730000
317400***          COMPUTE PV-AVG-UNITS = PV-PACK-REC                   31740000
317500             COMPUTE PV-AVG-UNITS = PV-ACCUM-RECD-UNITS           31750000
317600                                  / RC821-STR-COUNT               31760000
317700             MOVE PV-AVG-UNITS         TO TM-MF14-AVG-UN          31770000
317800         END-IF                                                   31780000
317900                                                                  31790000
318000         MOVE RC821-TOTAL-ODD-UNITS    TO TM-MF14-ODD-QTY         31800000
318100         IF RC821-TOTAL-ODD-UNITS > ZEROES                        31810000
318200             PERFORM 8012-CALC-ODD-UNIT-AMT                       31820000
318300             MOVE PV-ODD-UNIT-DOLLARS  TO TM-MF14-ODD-AMT         31830000
318400         ELSE                                                     31840000
318500             MOVE ZEROES               TO TM-MF14-ODD-AMT         31850000
318600         END-IF                                                   31860000
318700                                                                  31870000
318800         PERFORM 8013-CALC-MSG-TEXT                               31880000
318900         MOVE PV-MSG-TEXT      TO TM-MF14-TEXT                    31890000
319000         MOVE RC821-STR-COUNT  TO TM-MF14-STR-ALLOC               31900000
319100                                                                  31910000
319200         MOVE TM-BAD-PACK-TEXT TO TM500-FREEFORM-TEXT             31920000
319300     END-IF.                                                      31930000
319400                                                                  31940000
319500*MESSAGE FORMAT15.                                                31950000
319600     IF RCT00002-MSG-FMT-NBR = 15                                 31960000
319700         MOVE PV-DISPERSAL-QTY       TO TM-MF15-PACK-QTY          31970000
319800         MOVE TM500-UNITS-TO-ALLOC   TO TM-MF15-RCVD-QTY          31980000
319900         MOVE RC821-STR-NBR (RC821-STORE-IDX)                     31990000
320000                                     TO TM-MF15-STR-NBR           32000000
320100         MOVE RC821-STR-DISTRO-QTY (RC821-STORE-IDX)              32010000
320200                                     TO TM-MF15-STR-QTY           32020000
320300                                                                  32030000
320400         MOVE TM-BAD-INNER-PACK-TEXT TO TM500-FREEFORM-TEXT       32040000
320500     END-IF.                                                      32050000
320600                                                                  32060000
320700                                                                  32070000
320800     DISPLAY '     8100- MSG FORMAT = ' RCT00002-MSG-FMT-NBR.     32080000
320900     DISPLAY TM500-FREEFORM-TEXT(1:50).                           32090000
321000     DISPLAY TM500-FREEFORM-TEXT(51:50).                          32100000
321100     DISPLAY TM500-FREEFORM-TEXT(101:50).                         32110000
321200     DISPLAY TM500-FREEFORM-TEXT(151:50).                         32120000
321300     DISPLAY TM500-FREEFORM-TEXT(201:50).                         32130000
321400                                                                  32140000
321500******************************************************************32150000
321600 8011-CALC-ITEM.                                                  32160000
321700*    DISPLAY '  8011-CALC-ITEM'.                                  32170000
321800                                                                  32180000
321900     MOVE ZEROES TO PV-LINE-UNITS                                 32190000
322000                    PV-UNIT-PRICE                                 32200000
322100                    PV-LINE-DOLLARS                               32210000
322200                    PV-PACK-DOLLARS                               32220000
322300                    PV-ACCUM-OTR-UNITS                            32230000
322400                    PV-ACCUM-RTL-DOLLARS                          32240000
322500                    PV-ACCUM-RECD-UNITS                           32250000
322600                    PV-LINE-OV-QTY                                32260000
322700                    PV-ACCUM-LINE-OV-QTY                          32270000
322800                    PV-LINE-OV-AMT                                32280000
322900                    PV-ACCUM-LINE-OV-AMT                          32290000
323000                    PV-LINE-SH-QTY                                32300000
323100                    PV-ACCUM-LINE-SH-QTY                          32310000
323200                    PV-LINE-SH-AMT                                32320000
323300                    PV-ACCUM-LINE-SH-AMT.                         32330000
323400                                                                  32340000
323500     IF RC823-TRB-LVL-CDE (RC823-RULE-IDX) = 'P' OR 'S'           32350000
323600         PERFORM                                                  32360000
323700           VARYING PV-ITEM-IDX FROM 1 BY 1                        32370000
323800             UNTIL PV-ITEM-IDX > RC821-MAX-ITEM-COUNT             32380000
323900                                                                  32390000
324000             IF RC821-REC-SKU-NBR (PV-ITEM-IDX) > +0              32400000
324100*DETERMINE RECEIVED UNITS                                         32410000
324200                 IF RC821-PKGNG-CDE = 'I' OR 'M'                  32420000
324300                     MOVE RC821-BEST-CASE-UNITS (PV-ITEM-IDX)     32430000
324400                       TO PV-LINE-UNITS                           32440000
324500                 ELSE                                             32450000
324600                     IF RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX) > +0   32460000
324700                         MOVE RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX)  32470000
324800                           TO PV-LINE-UNITS                       32480000
324900                     ELSE                                         32490000
325000                         MOVE RC821-PKSL-ITM-QTY (PV-ITEM-IDX)    32500000
325100                           TO PV-LINE-UNITS                       32510000
325200                     END-IF                                       32520000
325300                 END-IF                                           32530000
325400*CALC RETAIL DOLLARS                                              32540000
325500                 IF RC821-PO-GP-QTY (PV-ITEM-IDX) > 1             32550000
325600                     COMPUTE PV-UNIT-PRICE =                      32560000
325700                         RC821-PO-GP-RTL-AMT  (PV-ITEM-IDX)       32570000
325800                       / RC821-PO-GP-QTY      (PV-ITEM-IDX)       32580000
325900                 ELSE                                             32590000
326000                     MOVE RC821-PO-UNT-RTL-PR-AMT (PV-ITEM-IDX)   32600000
326100                       TO PV-UNIT-PRICE                           32610000
326200                 END-IF                                           32620000
326300*ACCUM RECEIVED UNITS                                             32630000
326400                 COMPUTE PV-ACCUM-RECD-UNITS = PV-ACCUM-RECD-UNITS32640000
326500                                             + PV-LINE-UNITS      32650000
326600*ACCUM OTR UNITS                                                  32660000
326700                 COMPUTE PV-ACCUM-OTR-UNITS = PV-ACCUM-OTR-UNITS  32670000
326800                       + RC821-ITEM-OTR-QTY (PV-ITEM-IDX)         32680000
326900                                                                  32690000
327000*ACCUM PACK DOLLARS                                               32700000
327100                 COMPUTE PV-PACK-DOLLARS = PV-PACK-DOLLARS        32710000
327200                       + (PV-UNIT-PRICE                           32720000
327300                       * RC821-REC-PACK-RATO-QTY (PV-ITEM-IDX))   32730000
327400                                                                  32740000
327500*ACCUM RETAIL DOLLARS                                             32750000
327600                 COMPUTE PV-LINE-DOLLARS = PV-LINE-UNITS          32760000
327700                                         * PV-UNIT-PRICE          32770000
327800                                                                  32780000
327900                 COMPUTE PV-ACCUM-RTL-DOLLARS =                   32790000
328000                                           PV-ACCUM-RTL-DOLLARS   32800000
328100                                         + PV-LINE-DOLLARS        32810000
328200                                                                  32820000
328300                 IF RC821-OVER-SHORT-CDE = 'O' OR 'M'             32830000
328400*CALC OVERAGE QTY/DOLLARS                                         32840000
328500                     COMPUTE PV-LINE-OV-QTY = PV-LINE-UNITS       32850000
328600                           - RC821-ITEM-OTR-QTY (PV-ITEM-IDX)     32860000
328700                     COMPUTE PV-LINE-OV-AMT = PV-LINE-OV-QTY      32870000
328800                                            * PV-UNIT-PRICE       32880000
328900*ACCUM OVERAGE QTY/DOLLARS                                        32890000
329000                     COMPUTE PV-ACCUM-LINE-OV-QTY =               32900000
329100                             PV-ACCUM-LINE-OV-QTY + PV-LINE-OV-QTY32910000
329200                     COMPUTE PV-ACCUM-LINE-OV-AMT =               32920000
329300                             PV-ACCUM-LINE-OV-AMT + PV-LINE-OV-AMT32930000
329400                 END-IF                                           32940000
329500                                                                  32950000
329600                 IF RC821-OVER-SHORT-CDE = 'S'                    32960000
329700*CALC SHORTAGE QTY/DOLLARS                                        32970000
329800                     COMPUTE PV-LINE-SH-QTY =                     32980000
329900                             RC821-ITEM-OTR-QTY (PV-ITEM-IDX)     32990000
330000                           - PV-LINE-UNITS                        33000000
330100                     COMPUTE PV-LINE-SH-AMT = PV-LINE-SH-QTY      33010000
330200                                            * PV-UNIT-PRICE       33020000
330300*ACCUM SHORTAGE QTY/DOLLARS                                       33030000
330400                     COMPUTE PV-ACCUM-LINE-SH-QTY =               33040000
330500                             PV-ACCUM-LINE-SH-QTY + PV-LINE-SH-QTY33050000
330600                     COMPUTE PV-ACCUM-LINE-SH-AMT =               33060000
330700                             PV-ACCUM-LINE-SH-AMT + PV-LINE-SH-AMT33070000
330800                 END-IF                                           33080000
330900             END-IF                                               33090000
331000         END-PERFORM                                              33100000
331100     ELSE                                                         33110000
331200         IF RC821-REC-SKU-NBR (RC821-ITEM-IDX) > +0               33120000
331300*DETERMINE RECEIVED UNITS                                         33130000
331400*10/15/03    IF RC821-PKGNG-CDE = 'I' OR 'M'                      33140000
331500*10/15/03        MOVE RC821-BEST-CASE-UNITS (RC821-ITEM-IDX)      33150000
331600*10/15/03          TO PV-LINE-UNITS                               33160000
331700*10/15/03    ELSE                                                 33170000
331800                 IF RC821-DTL-CK-ITM-QTY (RC821-ITEM-IDX) > +0    33180000
331900                     MOVE RC821-DTL-CK-ITM-QTY (RC821-ITEM-IDX)   33190000
332000                       TO PV-LINE-UNITS                           33200000
332100                 ELSE                                             33210000
332200                     MOVE RC821-PKSL-ITM-QTY (RC821-ITEM-IDX)     33220000
332300                       TO PV-LINE-UNITS                           33230000
332400                 END-IF                                           33240000
332500*10/15/03    END-IF                                               33250000
332600*CALC RETAIL DOLLARS                                              33260000
332700             IF RC821-PO-GP-QTY (RC821-ITEM-IDX) > 1              33270000
332800                 COMPUTE PV-UNIT-PRICE =                          33280000
332900                         RC821-PO-GP-RTL-AMT  (RC821-ITEM-IDX)    33290000
333000                       / RC821-PO-GP-QTY      (RC821-ITEM-IDX)    33300000
333100             ELSE                                                 33310000
333200                 MOVE RC821-PO-UNT-RTL-PR-AMT (RC821-ITEM-IDX)    33320000
333300                   TO PV-UNIT-PRICE                               33330000
333400             END-IF                                               33340000
333500*ACCUM RECEIVED UNITS                                             33350000
333600             COMPUTE PV-ACCUM-RECD-UNITS = PV-ACCUM-RECD-UNITS    33360000
333700                                         + PV-LINE-UNITS          33370000
333800*ACCUM OTR UNITS                                                  33380000
333900             COMPUTE PV-ACCUM-OTR-UNITS = PV-ACCUM-OTR-UNITS      33390000
334000                   + RC821-ITEM-OTR-QTY (RC821-ITEM-IDX)          33400000
334100*ACCUM PACK DOLLARS                                               33410000
334200             COMPUTE PV-PACK-DOLLARS = PV-PACK-DOLLARS            33420000
334300                   + (PV-UNIT-PRICE                               33430000
334400                   * RC821-REC-PACK-RATO-QTY (RC821-ITEM-IDX))    33440000
334500                                                                  33450000
334600*ACCUM RETAIL DOLLARS                                             33460000
334700             COMPUTE PV-LINE-DOLLARS = PV-LINE-UNITS              33470000
334800                                     * PV-UNIT-PRICE              33480000
334900                                                                  33490000
335000             COMPUTE PV-ACCUM-RTL-DOLLARS = PV-ACCUM-RTL-DOLLARS  33500000
335100                                          + PV-LINE-DOLLARS       33510000
335200                                                                  33520000
335300             IF RC821-OVER-SHORT-CDE = 'O' OR 'M'                 33530000
335400*CALC OVERAGE QTY/DOLLARS                                         33540000
335500                 COMPUTE PV-LINE-OV-QTY =                         33550000
335600                         PV-LINE-UNITS                            33560000
335700                       - RC821-ITEM-OTR-QTY (RC821-ITEM-IDX)      33570000
335800                 COMPUTE PV-LINE-OV-AMT = PV-LINE-OV-QTY          33580000
335900                                        * PV-UNIT-PRICE           33590000
336000*ACCUM OVERAGE QTY/DOLLARS                                        33600000
336100                 COMPUTE PV-ACCUM-LINE-OV-QTY =                   33610000
336200                         PV-ACCUM-LINE-OV-QTY + PV-LINE-OV-QTY    33620000
336300                 COMPUTE PV-ACCUM-LINE-OV-AMT =                   33630000
336400                         PV-ACCUM-LINE-OV-AMT + PV-LINE-OV-AMT    33640000
336500             END-IF                                               33650000
336600                                                                  33660000
336700             IF RC821-OVER-SHORT-CDE = 'S'                        33670000
336800*CALC SHORTAGE QTY/DOLLARS                                        33680000
336900                 COMPUTE PV-LINE-SH-QTY =                         33690000
337000                         RC821-ITEM-OTR-QTY (RC821-ITEM-IDX)      33700000
337100                       - PV-LINE-UNITS                            33710000
337200                 COMPUTE PV-LINE-SH-AMT = PV-LINE-SH-QTY          33720000
337300                                        * PV-UNIT-PRICE           33730000
337400*ACCUM SHORTAGE QTY/DOLLARS                                       33740000
337500                 COMPUTE PV-ACCUM-LINE-SH-QTY =                   33750000
337600                         PV-ACCUM-LINE-SH-QTY + PV-LINE-SH-QTY    33760000
337700                 COMPUTE PV-ACCUM-LINE-SH-AMT =                   33770000
337800                         PV-ACCUM-LINE-SH-AMT + PV-LINE-SH-AMT    33780000
337900             END-IF                                               33790000
338000         END-IF                                                   33800000
338100     END-IF.                                                      33810000
338200                                                                  33820000
338300******************************************************************33830000
338400 8012-CALC-ODD-UNIT-AMT.                                          33840000
338500*    DISPLAY '  8012-CALC-ODD-UNIT-AMT'.                          33850000
338600                                                                  33860000
338700     MOVE ZEROES TO PV-UNIT-PRICE                                 33870000
338800                    PV-ODD-UNIT-DOLLARS.                          33880000
338900                                                                  33890000
339000     PERFORM                                                      33900000
339100       VARYING PV-ITEM-IDX FROM 1 BY 1                            33910000
339200         UNTIL PV-ITEM-IDX > RC821-MAX-ITEM-COUNT                 33920000
339300                                                                  33930000
339400         IF RC821-PO-GP-QTY (PV-ITEM-IDX) > 1                     33940000
339500             COMPUTE PV-UNIT-PRICE =                              33950000
339600                     RC821-PO-GP-RTL-AMT  (PV-ITEM-IDX)           33960000
339700                   / RC821-PO-GP-QTY      (PV-ITEM-IDX)           33970000
339800         ELSE                                                     33980000
339900             MOVE RC821-PO-UNT-RTL-PR-AMT (PV-ITEM-IDX)           33990000
340000               TO PV-UNIT-PRICE                                   34000000
340100         END-IF                                                   34010000
340200                                                                  34020000
340300         COMPUTE PV-ODD-UNIT-DOLLARS                              34030000
340400               = PV-ODD-UNIT-DOLLARS                              34040000
340500               + (RC821-ODD-UNIT-QTY (PV-ITEM-IDX)                34050000
340600               * PV-UNIT-PRICE)                                   34060000
340700                                                                  34070000
340800     END-PERFORM.                                                 34080000
340900                                                                  34090000
341000******************************************************************34100000
341100 8013-CALC-MSG-TEXT.                                              34110000
341200*    DISPLAY '  8013-CALC-MSG-TEXT'.                              34120000
341300                                                                  34130000
341400     IF PV-DIFFERENT-RATIOS = 'N'                                 34140000
341500       AND PV-LINES-MISSING = 'N'                                 34150000
341600         MOVE 'PACK IS INTACT   ' TO PV-MSG-TEXT                  34160000
341700     END-IF.                                                      34170000
341800                                                                  34180000
341900     IF PV-DIFFERENT-RATIOS = 'Y'                                 34190000
342000       AND PV-LINES-MISSING = 'Y'                                 34200000
342100         MOVE 'MISS LN/RATIO CHG' TO PV-MSG-TEXT                  34210000
342200     END-IF.                                                      34220000
342300                                                                  34230000
342400     IF PV-DIFFERENT-RATIOS = 'N'                                 34240000
342500       AND PV-LINES-MISSING = 'Y'                                 34250000
342600         MOVE 'MISSING LINES    ' TO PV-MSG-TEXT                  34260000
342700     END-IF.                                                      34270000
342800                                                                  34280000
342900     IF PV-DIFFERENT-RATIOS = 'Y'                                 34290000
343000       AND PV-LINES-MISSING = 'N'                                 34300000
343100         MOVE 'RATIO CHANGES    ' TO PV-MSG-TEXT                  34310000
343200     END-IF.                                                      34320000
343300                                                                  34330000
343400******************************************************************34340000
343500 8014-COUNT-STORES.                                               34350000
343600*    DISPLAY '8014-COUNT-STORES'.                                 34360000
343700                                                                  34370000
343800*OVERAGE STORE COUNT.                                             34380000
343900     MOVE ZEROES TO PV-NEW-STR-CNT                                34390000
344000                    PV-OLD-STR-CNT                                34400000
344100                    PV-CS-STR-CNT                                 34410000
344200                    PV-OVRG-STR-CNT.                              34420000
344300                                                                  34430000
344400     PERFORM                                                      34440000
344500       VARYING L FROM 1 BY 1                                      34450000
344600         UNTIL L > RC821-MAX-STR-COUNT                            34460000
344700                                                                  34470000
344800         IF (RC821-STR-NBR (L) > ZEROES)                          34480000
344900             IF (RC821-ST-TYPE-CODE (L) = 'CS')                   34490000
345000                 ADD 1 TO PV-CS-STR-CNT                           34500000
345100             ELSE                                                 34510000
345200                 IF RC821-EXISTING-STORE-CDE (L) = '1'            34520000
345300                     ADD 1 TO PV-NEW-STR-CNT                      34530000
345400                 ELSE                                             34540000
345500                     ADD 1 TO PV-OLD-STR-CNT                      34550000
345600                 END-IF                                           34560000
345700             END-IF                                               34570000
345800         END-IF                                                   34580000
345900                                                                  34590000
346000     END-PERFORM.                                                 34600000
346100                                                                  34610000
346200*    DISPLAY '  NEW/OLD/CS STORE = ' PV-NEW-STR-CNT               34620000
346300*                              ' / ' PV-OLD-STR-CNT               34630000
346400*                              ' / ' PV-CS-STR-CNT.               34640000
346500                                                                  34650000
346600     IF PV-OLD-STR-CNT > ZEROES                                   34660000
346700         MOVE PV-OLD-STR-CNT TO PV-OVRG-STR-CNT                   34670000
346800     ELSE                                                         34680000
346900         IF PV-NEW-STR-CNT > ZEROES                               34690000
347000             MOVE PV-NEW-STR-CNT TO PV-OVRG-STR-CNT               34700000
347100         ELSE                                                     34710000
347200             MOVE PV-CS-STR-CNT  TO PV-OVRG-STR-CNT               34720000
347300         END-IF                                                   34730000
347400     END-IF.                                                      34740000
347500                                                                  34750000
347600     IF PV-OVRG-STR-CNT NOT > ZEROES                              34760000
347700         MOVE 1 TO PV-OVRG-STR-CNT                                34770000
347800     END-IF.                                                      34780000
347900                                                                  34790000
348000******************************************************************34800000
348100 8015-CALC-OVRG-QTY.                                              34810000
348200*    DISPLAY '8015-CALC-OVRG-QTY'.                                34820000
348300                                                                  34830000
348400*OVERAGE QTY.                                                     34840000
348500     MOVE ZEROES TO PV-OVRG-QTY                                   34850000
348600                    PV-SUM-PACK-UNITS                             34860000
348700                    PV-SUM-PACK-OTR-UNITS.                        34870000
348800                                                                  34880000
348900     PERFORM                                                      34890000
349000       VARYING PV-ITEM-IDX FROM 1 BY 1                            34900000
349100         UNTIL PV-ITEM-IDX > RC821-MAX-ITEM-COUNT                 34910000
349200                                                                  34920000
349300         IF RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX) > +0               34930000
349400             COMPUTE PV-SUM-PACK-UNITS = PV-SUM-PACK-UNITS        34940000
349500                   + RC821-DTL-CK-ITM-QTY (PV-ITEM-IDX)           34950000
349600         ELSE                                                     34960000
349700             COMPUTE PV-SUM-PACK-UNITS = PV-SUM-PACK-UNITS        34970000
349800                   + RC821-PKSL-ITM-QTY (PV-ITEM-IDX)             34980000
349900         END-IF                                                   34990000
350000                                                                  35000000
350100         COMPUTE PV-SUM-PACK-OTR-UNITS = PV-SUM-PACK-OTR-UNITS    35010000
350200               + RC821-ITEM-OTR-QTY (PV-ITEM-IDX)                 35020000
350300                                                                  35030000
350400     END-PERFORM.                                                 35040000
350500                                                                  35050000
350600*    DISPLAY '  PV-SUM-PACK-UNITS     =  ' PV-SUM-PACK-UNITS      35060000
350700*    DISPLAY '  PV-SUM-PACK-OTR-UNITS =  ' PV-SUM-PACK-OTR-UNITS  35070000
350800     COMPUTE PV-OVRG-QTY = (PV-SUM-PACK-UNITS                     35080000
350900                         - PV-SUM-PACK-OTR-UNITS).                35090000
351000*    DISPLAY '  PV-OVRG-QTY = ' PV-OVRG-QTY.                      35100000
351100                                                                  35110000
351200******************************************************************35120000
351300******************************************************************35130000
351400 8100-RESOLVE-TROUBLE.                                            35140000
351410     MOVE '8100-RESOLVE-TROUBLE' TO TM007-RETURNED-PARA.          35141000
351420                                                                  35142000
351500     MOVE RCT00002-TRBL-RSN-CDE TO PV-DISP-TRBL-RSN-CDE.          35150000
351600     DISPLAY ' ==> 8100-RESOLVE-TROUBLE - ' PV-DISP-TRBL-RSN-CDE. 35160000
351700                                                                  35170000
351710     MOVE 'RCKUP823' TO TM500-RESOLVED-UID                        35171000
351800     MOVE 'U'        TO TM500-CRUD-IND.                           35180000
351900                                                                  35190000
352000     CALL PC-TMKUP521 USING TM500-FIELDS                          35200000
352010                            TM007-COMMUNICATIONS-AREA.            35201000
352100                                                                  35210000
352900     EVALUATE TRUE                                                35290000
353000       WHEN TM500-CALL-SUCCESSFUL                                 35300000
353100       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          35310000
353200           CONTINUE                                               35320000
353300                                                                  35330000
353400       WHEN OTHER                                                 35340000
353500           SET PS-DONE-YES TO TRUE                                35350000
353600           MOVE SPACES     TO TM501-TM500-RETURN-MSG              35360000
353700           MOVE '8100'     TO TM501-PARA                          35370000
353800           MOVE '823'      TO TM501-PGM                           35380000
353900           MOVE SQLCODE    TO TM500-SQLCODE                       35390000
353910                              TM007-SQLCODE                       35391000
354000           MOVE SQLCA      TO TM500-SQLCA                         35400000
354010                              TM007-SQLCA                         35401000
354100           MOVE 73         TO TM501-PRORATION-ERROR-NBR           35410000
354200           PERFORM TM501-SET-TM500-RETURN-MSG                     35420000
354210           MOVE TM500-RETURN-DATA TO TM007-RETURN-DATA            35421000
354220           MOVE TM500-RETURN-MSG  TO TM007-RETURN-MSG             35422000
354300           PERFORM RC001-RETURN-MSG                               35430000
354400     END-EVALUATE.                                                35440000
354500                                                                  35450000
354600******************************************************************35460000
354700*                                                                *35470000
354800*        W R I T E   A B E N D S   T O   C I C S   L O G         *35480000
354900*                                                                *35490000
355000******************************************************************35500000
355100* -------------------                                             35510000
355200*    COPY RCPD001.                                                35520000
355300* -------------------                                             35530000
355400 RC001-RETURN-MSG.                                                35540000
355500                                                                  35550000
355600*    EXEC CICS                                                    35560000
355700*        ASSIGN                                                   35570000
355800*        USERID (RC001-USERID)                                    35580000
355900*    END-EXEC.                                                    35590000
356000                                                                  35600000
356100     MOVE SQLCODE TO RC001-SAVE-SQLCODE.                          35610000
356200                                                                  35620000
356300     EXEC SQL                                                     35630000
356400         SELECT CURRENT_DATE                                      35640000
356500              , CURRENT_TIME                                      35650000
356600         INTO  :RC001-DATE                                        35660000
356700             , :RC001-TIME                                        35670000
356800         FROM TCOCNTL                                             35680000
356900     END-EXEC.                                                    35690000
357000                                                                  35700000
357100*GET THE QUEUE.                                                   35710000
357200*    EXEC CICS                                                    35720000
357300*        ENQ                                                      35730000
357400*        RESOURCE (RC001-LOG-QUEUE)                               35740000
357500*    END-EXEC.                                                    35750000
357600                                                                  35760000
357700*WRITE RC001-LINE-01.                                             35770000
357800     MOVE RC001-LINE-01            TO RC001-LOG-LINE.             35780000
357900     PERFORM RC001-WRITE-CSSL.                                    35790000
358000                                                                  35800000
358100*WRITE RC001-LINE-02.                                             35810000
358200     MOVE RC001-SAVE-SQLCODE       TO RC001-SQLCODE.              35820000
358300     MOVE RC001-LINE-02            TO RC001-LOG-LINE.             35830000
358400     PERFORM RC001-WRITE-CSSL.                                    35840000
358500                                                                  35850000
358600*WRITE RC001-LINE-03.                                             35860000
358700     MOVE TM500-PO-NBR             TO RC001-PO-NBR.               35870000
358800     MOVE TM500-REC-SEQ-NBR        TO RC001-REC-SEQ-NBR.          35880000
358900     MOVE RC821-REC-DRV-LNE-NBR    TO RC001-PO-LNE-NBR.           35890000
359000     MOVE TM500-OPER-UNT-ID        TO RC001-OPER-UNT-ID.          35900000
359100     MOVE TM500-FCLTY-ID           TO RC001-FCLTY-ID.             35910000
359200     MOVE RC821-PREPK-ID           TO RC001-PREPK-ID.             35920000
359300                                                                  35930000
359400     MOVE RC001-LINE-03            TO RC001-LOG-LINE.             35940000
359500     PERFORM RC001-WRITE-CSSL.                                    35950000
359600                                                                  35960000
359700*WRITE RC001-LINE-04.                                             35970000
359800     MOVE RC001-LINE-04            TO RC001-LOG-LINE.             35980000
359900     PERFORM RC001-WRITE-CSSL.                                    35990000
360000                                                                  36000000
360100*WRITE RC001-LINE-05.                                             36010000
360200     MOVE RC001-LINE-05            TO RC001-LOG-LINE.             36020000
360300     PERFORM RC001-WRITE-CSSL.                                    36030000
360400                                                                  36040000
360500*RELEASE THE QUEUE.                                               36050000
360600*    EXEC CICS                                                    36060000
360700*        DEQ                                                      36070000
360800*        RESOURCE (RC001-LOG-QUEUE)                               36080000
360900*    END-EXEC.                                                    36090000
361000                                                                  36100000
361100*RETURN TO CALLING PROGRAM                                        36110000
361200     PERFORM RC001-GOBACK.                                        36120000
361300                                                                  36130000
361400******************************************************************36140000
361500 RC001-WRITE-CSSL.                                                36150000
361600*    DISPLAY 'RC001-WRITE-CSSL - ' RC001-LOG-LINE.                36160000
361700                                                                  36170000
361800*    EXEC CICS                                                    36180000
361900*        WRITEQ TD                                                36190000
362000*            QUEUE (RC001-LOG-QUEUE)                              36200000
362100*            FROM  (RC001-LOG-LINE)                               36210000
362200*            RESP  (RC001-CICS-RESPONSE)                          36220000
362300*    END-EXEC.                                                    36230000
362400*                                                                 36240000
362500*    IF RC001-CICS-RESPONSE = DFHRESP(NORMAL)                     36250000
362600*        CONTINUE                                                 36260000
362700*    ELSE                                                         36270000
362800*        EXEC CICS                                                36280000
362900*             ABEND                                               36290000
363000*             ABCODE (EIBTRMID)                                   36300000
363100*        END-EXEC                                                 36310000
363200*    END-IF.                                                      36320000
363300                                                                  36330000
363400******************************************************************36340000
363500 RC001-GOBACK.                                                    36350000
363600                                                                  36360000
363700***  MOVE RC823-COMMAREA TO DFHCOMMAREA.                          36370000
363800     MOVE TM500-FIELDS   TO RC823-TM500-FIELDS.                   36380000
363900     MOVE RC823-COMMAREA TO LINK-COMMAREA                         36390000
363910     MOVE TM007-COMMUNICATIONS-AREA TO LINK-TM007-COMMAREA.       36391000
364000     DISPLAY 'DFHCOMMAREA RETURN = ' RC823-COMMAREA.              36400000
364100     DISPLAY '***  END OF RCKUP823 (ERROR)  ***'.                 36410000
364200     GOBACK.                                                      36420000
364300                                                                  36430000
364400******************************************************************36440000
364500     COPY TMPD501.                                                36450000
364600******************************************************************36460000
