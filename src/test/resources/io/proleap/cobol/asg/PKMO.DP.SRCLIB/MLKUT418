       IDENTIFICATION DIVISION.                                         00010001
       PROGRAM-ID.    MLKUT418.                                         00020001
       AUTHOR.        BARBARA HULL.                                     00030001
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
       DATE-WRITTEN.  07-23-98.                                         00050001
       DATE-COMPILED.                                                   00060001
      ******************************************************************00070001
      *                                                                 00080001
      * MLKUT418 - DESCRIPTION.............                             00090001
      *                                                                 00100001
      * THIS PROGRAM WILL CREATE THE DATA INTEGRITY EXTRACT FILE FOR    00110001
      * DB2 TABLE TWKSCLS.                                              00120001
      *                                                                 00130001
      *CHANGE HISTORY:                                                  00131003
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00132003
      * ------- ---------- ----------- -------------------------------- 00133003
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00134003
      ******************************************************************00140001
      *                                                                 00150001
       ENVIRONMENT DIVISION.                                            00160001
      *                                                                 00170001
       CONFIGURATION SECTION.                                           00180001
      *                                                                 00190001
       SOURCE-COMPUTER.        IBM-3090.                                00200001
       OBJECT-COMPUTER.        IBM-3090.                                00210001
      *                                                                 00220001
       INPUT-OUTPUT SECTION.                                            00230001
       FILE-CONTROL.                                                    00240001
                                                                        00250001
           SELECT DATA-INTEGRITY-CTL-FILE                               00260001
               ASSIGN TO INP01.                                         00270001
                                                                        00280001
           SELECT DATA-INTEGRITY-EXTR-FILE                              00290001
               ASSIGN TO OUT01.                                         00300001
                                                                        00310001
      ******************************************************************00320001
       DATA DIVISION.                                                   00330001
      ******************************************************************00340001
                                                                        00350001
       FILE SECTION.                                                    00360001
                                                                        00370001
       FD  DATA-INTEGRITY-CTL-FILE                                      00380001
           LABEL RECORDS ARE STANDARD                                   00390001
           RECORDING MODE IS F                                          00400001
           BLOCK CONTAINS 0 RECORDS.                                    00410001
       01  DATA-INTEGRITY-CTL-REC      PIC X(80).                       00420001
                                                                        00430001
       FD  DATA-INTEGRITY-EXTR-FILE                                     00440001
           RECORDING MODE IS F                                          00450001
           LABEL RECORDS ARE STANDARD                                   00460001
           BLOCK CONTAINS 0 RECORDS.                                    00470001
                                                                        00480001
W26603 01  DATA-INTEGRITY-EXTR-REC     PIC X(120).                      00490003
                                                                        00500001
      *                                                                 00510001
      ******************************************************************00520001
       WORKING-STORAGE SECTION.                                         00530001
      ******************************************************************00540001
                                                                        00550001
       01  PS-PROGRAM-SWITCHES.                                         00560001
           05  PS-TWKSCLS-DONE         PIC X       VALUE 'N'.           00570001
               88  PS-TWKSCLS-IS-DONE              VALUE 'Y'.           00580001
               88  PS-TWKSCLS-IS-NOT-DONE          VALUE 'N'.           00590001
                                                                        00600001
       01  PA-PROGRAM-ACCUMULATORS                 COMP-3.              00610001
           05  PA-TWKSCLS-ROWS-FETCHED PIC S9(13)  VALUE ZERO.          00620001
           05  PA-TDTATTR-ROWS-SELECTED                                 00630001
                                       PIC S9(13)  VALUE ZERO.          00640001
           05  PA-OUTPUT-RECS-WRITTEN  PIC S9(13)  VALUE ZERO.          00650001
                                                                        00660001
       01  PC-PROGRAM-CONSTANTS.                                        00670001
           05  PC-MAX-TBL-ROWS         PIC S9(03)  VALUE +120.          00680001
                                                                        00690001
       01  PV-PROGRAM-VARIABLES.                                        00700001
           05  PV-OPN-MONTH-FIRST-WEEK PIC X(10).                       00710001
           05  PV-FSCL-WK-END-DTE      PIC X(10).                       00720001
           05  PV-FSCL-MN-END-DTE      PIC X(10).                       00730001
           05  PV-FSCL-MN-NBR          PIC X(02).                       00740001
                                                                        00750001
           05  PV-SPLIT-SUB-CL-NBR.                                     00760001
               10  PV-SPLIT-SUB-CL-NBR-1                                00770001
                                       PIC X.                           00780001
               10  FILLER              PIC X.                           00790001
           05  PV-FRMT-MAJ-CL-NBR.                                      00800001
               10  PV-FRMT-MAJ-CL-NBR-1                                 00810001
                                       PIC X.                           00820001
               10  PV-FRMT-MAJ-CL-NBR-2                                 00830001
                                       PIC X.                           00840001
                                                                        00850001
       01  TABLE-FOR-MONTH-DATA.                                        00860001
           05  TABLE-WEEKEND-ENTRIES   OCCURS 120 TIMES                 00870001
                                       INDEXED BY MTH-IDX.              00880001
               10  TBL-WEEKEND-DTE     PIC X(10).                       00890001
               10  TBL-MONTHEND-DTE    PIC X(10).                       00900001
               10  TBL-MONTHEND-NBR    PIC X(02).                       00910001
                                                                        00920001
       01  CD-COUNTER-DISPLAY.                                          00930001
           05  CD-COUNT-HOLD1          PIC Z,ZZZ,ZZZ,ZZZ,ZZ9.           00940001
                                                                        00950001
       01 ABEND-AREAS.                                                  00960001
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00970001
                                                   COMP SYNC.           00980001
               88  AC-BAD-DATA                     VALUE +4003.         00990001
               88  AC-DB2-ERROR                    VALUE +4013.         01000001
           05  AA-ABEND-LIT            PIC X(40)   VALUE                01010001
                 '*****       ABEND'.                                   01020001
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01030001
                   '*****   PROGRAM: MLKUT418'.                         01040001
           05  AA-PARAGRAPH-LIT.                                        01050001
               10  FILLER              PIC X(17)   VALUE                01060001
                   '***** PARAGRAPH: '.                                 01070001
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01080001
           05  AA-MESSAGE-LINE.                                         01090001
               10  FILLER              PIC X(06)   VALUE '*****'.       01100001
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01110001
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                01120001
                   '*****    DB2 ERROR'.                                01130001
           05  AA-DB2-OPERATION-LIT.                                    01140001
               10  FILLER              PIC X(17)   VALUE                01150001
                   '***** OPERATION: '.                                 01160001
               10  AA-DB2-OPERATION.                                    01170001
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01180001
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01190001
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01200001
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01210001
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01220001
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01230001
                                                                        01240001
       EJECT                                                            01250001
                                                                        01260001
      *** DATA INTEGRITY CONTROL CARD                                   01270001
           COPY MLRD110.                                                01280001
                                                                        01290001
                                                                        01300001
      *** DATA INTEGRITY TWKSCLS EXTRACT FILE                           01310001
W26603     COPY MLRD111.                                                01320003
                                                                        01330001
       EJECT                                                            01340001
                                                                        01350001
      ******************************************************************01360001
      *  DB2 ERROR MESSAGES FORMAT AREA.                                01370001
      ******************************************************************01380001
           COPY DPWS004.                                                01390001
                                                                        01400001
      ******************************************************************01410001
      *  DB2 ERRORS                                                     01420001
      ******************************************************************01430001
           COPY SQLCA2.                                                 01440001
                                                                        01450001
      ******************************************************************01460001
      *  DB2 COMMUNICATION AREA                                         01470001
      ******************************************************************01480001
           EXEC SQL                                                     01490001
                INCLUDE SQLCA                                           01500001
           END-EXEC.                                                    01510001
                                                                        01520001
      ******************************************************************01530001
      *  DB2 TWKSCLS TABLE LAYOUT                                       01540001
      ******************************************************************01550001
           EXEC SQL                                                     01560001
                INCLUDE TWKSCLS                                         01570001
           END-EXEC.                                                    01580001
                                                                        01590001
      ******************************************************************01600001
      *  DB2 TDTATTR TABLE LAYOUT                                       01610001
      ******************************************************************01620001
           EXEC SQL                                                     01630001
                INCLUDE TDTATTR                                         01640001
           END-EXEC.                                                    01650001
                                                                        01660001
      ******************************************************************01670001
      *  DB2 TWKSCLS CURSOR                                             01680001
      ******************************************************************01690001
           EXEC SQL                                                     01700001
               DECLARE TWKSCLS_CURSOR CURSOR FOR                        01710001
                SELECT FSCL_WK_END_DTE,                                 01720001
                       DEPT_NBR,                                        01730001
                       SUB_CL_NBR,                                      01740001
                       STR_NBR,                                         01750001
                       SLS_RTL_AMT,                                     01760001
                       MKDN_RTL_AMT,                                    01770001
                       MKUP_RTL_AMT,                                    01780001
                       XFER_IN_RTL_AMT,                                 01790001
                       XFER_OUT_RTL_AMT,                                01800001
                       RCPT_RTL_AMT,                                    01810001
                       RCPT_NET_COST_AMT,                               01820001
                       PADJ_RTL_AMT,                                    01830001
                       PADJ_NET_COST_AMT,                               01840001
WR5701                 INV_ADJ_RTL_AMT                                  01850001
                  FROM TWKSCLS                                          01860001
WR5701*         WHERE (FSCL_WK_END_DTE >= :ML110-STRT-DTE)              01870001
WR5701           WHERE (FSCL_WK_END_DTE BETWEEN                         01880001
WR5701                                        :PV-OPN-MONTH-FIRST-WEEK  01890001
                                          AND :ML110-END-DTE)           01900001
              ORDER BY FSCL_WK_END_DTE,                                 01910001
                       DEPT_NBR,                                        01920001
                       SUB_CL_NBR,                                      01930001
                       STR_NBR                                          01940001
W26603        WITH UR                                                   01941003
           END-EXEC.                                                    01950001
                                                                        01960001
       EJECT                                                            01970001
                                                                        01980001
      ******************************************************************01990001
       PROCEDURE DIVISION.                                              02000001
      ******************************************************************02010001
                                                                        02020001
      ******************************************************************02030001
       0000-MAINLINE-MLKUT418.                                          02040001
      ******************************************************************02050001
      *                                                                 02060001
           PERFORM 1000-INITIALIZATION.                                 02070001
                                                                        02080001
           PERFORM 2000-MAIN-PROCESS.                                   02090001
                                                                        02100001
           PERFORM 8000-EOJ.                                            02110001
                                                                        02120001
           STOP RUN.                                                    02130001
                                                                        02140001
       EJECT                                                            02150001
                                                                        02160001
      ******************************************************************02170001
       1000-INITIALIZATION.                                             02180001
      ******************************************************************02190001
      *                                                                 02200001
           OPEN INPUT  DATA-INTEGRITY-CTL-FILE.                         02210001
           OPEN OUTPUT DATA-INTEGRITY-EXTR-FILE.                        02220001
      *                                                                 02230001
           PERFORM 4000-READ-CONTROL-CARD.                              02240001
                                                                        02250001
           DISPLAY ' '.                                                 02260001
           DISPLAY '*** MLKUT418 INPUT CONTROL CARD VALUES ***'         02270001
           DISPLAY ML110-DATA-INTEGRITY-CC-REC.                         02280001
                                                                        02290001
           INITIALIZE PA-PROGRAM-ACCUMULATORS.                          02300001
           INITIALIZE PV-PROGRAM-VARIABLES.                             02310001
           INITIALIZE TABLE-FOR-MONTH-DATA.                             02320001
      *                                                                 02330001
WR5701     PERFORM 7000-DATE-RANGE-TO-PROCESS.                          02340001
                                                                        02350001
       EJECT                                                            02360001
                                                                        02370001
      ******************************************************************02380001
       2000-MAIN-PROCESS.                                               02390001
      ******************************************************************02400001
      *                                                                 02410001
           PERFORM 7100-OPEN-CURSOR-TWKSCLS.                            02420001
                                                                        02430001
           PERFORM 7200-FETCH-TWKSCLS.                                  02440001
                                                                        02450001
           PERFORM                                                      02460001
             UNTIL PS-TWKSCLS-IS-DONE                                   02470001
               PERFORM 2100-GET-MONTH-DATA                              02480001
               PERFORM 5000-WRITE-EXTRACT                               02490001
               PERFORM 7200-FETCH-TWKSCLS                               02500001
           END-PERFORM.                                                 02510001
                                                                        02520001
           PERFORM 7300-CLOSE-CURSOR-TWKSCLS.                           02530001
                                                                        02540001
       EJECT                                                            02550001
                                                                        02560001
      ******************************************************************02570001
       2100-GET-MONTH-DATA.                                             02580001
      ******************************************************************02590001
      *                                                                 02600001
           SET MTH-IDX                 TO 1.                            02610001
           SEARCH TABLE-WEEKEND-ENTRIES                                 02620001
               AT END                                                   02630001
                   PERFORM 7400-SELECT-TDTATTR                          02640001
                   ADD 1               TO PA-TDTATTR-ROWS-SELECTED      02650001
                   MOVE DTATTR-FSCL-MN-END-DTE                          02660001
                                       TO PV-FSCL-MN-END-DTE            02670001
                   MOVE DTATTR-FSCL-MN-NBR                              02680001
                                       TO PV-FSCL-MN-NBR                02690001
                   IF PA-TDTATTR-ROWS-SELECTED > PC-MAX-TBL-ROWS        02700001
                       CONTINUE                                         02710001
                   ELSE                                                 02720001
                       SET MTH-IDX     TO PA-TDTATTR-ROWS-SELECTED      02730001
                       MOVE WKSCLS-FSCL-WK-END-DTE                      02740001
                                       TO TBL-WEEKEND-DTE (MTH-IDX)     02750001
                       MOVE DTATTR-FSCL-MN-END-DTE                      02760001
                                       TO TBL-MONTHEND-DTE (MTH-IDX)    02770001
                       MOVE DTATTR-FSCL-MN-NBR                          02780001
                                       TO TBL-MONTHEND-NBR (MTH-IDX)    02790001
                   END-IF                                               02800001
               WHEN TBL-WEEKEND-DTE (MTH-IDX) = WKSCLS-FSCL-WK-END-DTE  02810001
                   MOVE TBL-MONTHEND-DTE (MTH-IDX)                      02820001
                                       TO PV-FSCL-MN-END-DTE            02830001
                   MOVE TBL-MONTHEND-NBR (MTH-IDX)                      02840001
                                       TO PV-FSCL-MN-NBR                02850001
           END-SEARCH.                                                  02860001
                                                                        02870001
       EJECT                                                            02880001
                                                                        02890001
      ******************************************************************02900001
       4000-READ-CONTROL-CARD.                                          02910001
      ******************************************************************02920001
      *                                                                 02930001
           READ DATA-INTEGRITY-CTL-FILE                                 02940001
             INTO ML110-DATA-INTEGRITY-CC-REC                           02950001
               AT END                                                   02960001
                   MOVE '4000-READ-CONTROL-CARD'                        02970001
                                       TO AA-PARAGRAPH-NAME             02980001
                   MOVE 'CONTROL CARD IS MISSING'                       02990001
                                       TO AA-MESSAGE                    03000001
                   MOVE +4001          TO ABEND-CODE                    03010001
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    03020001
           END-READ.                                                    03030001
                                                                        03040001
       EJECT                                                            03050001
                                                                        03060001
      ******************************************************************03070001
       5000-WRITE-EXTRACT.                                              03080001
      ******************************************************************03090001
      *                                                                 03100001
           MOVE PV-FSCL-MN-END-DTE     TO ML111-FSCL-MN-END-DTE.        03110001
           MOVE PV-FSCL-MN-NBR         TO ML111-FSCL-MN-NBR.            03120001
           MOVE WKSCLS-DEPT-NBR        TO ML111-DEPT-NBR.               03130001
           MOVE WKSCLS-SUB-CL-NBR      TO PV-SPLIT-SUB-CL-NBR.          03140001
           MOVE PV-SPLIT-SUB-CL-NBR-1  TO PV-FRMT-MAJ-CL-NBR-1.         03150001
           MOVE 0                      TO PV-FRMT-MAJ-CL-NBR-2.         03160001
           MOVE PV-FRMT-MAJ-CL-NBR     TO ML111-MAJ-CL-NBR.             03170001
           MOVE WKSCLS-SUB-CL-NBR      TO ML111-SUB-CL-NBR.             03180001
           MOVE WKSCLS-STR-NBR         TO ML111-STR-NBR.                03190001
           MOVE WKSCLS-SLS-RTL-AMT     TO ML111-SLS-RTL-AMT.            03200001
           MOVE WKSCLS-MKDN-RTL-AMT    TO ML111-MKDN-RTL-AMT.           03210001
           MOVE WKSCLS-MKUP-RTL-AMT    TO ML111-MKUP-RTL-AMT.           03220001
           MOVE WKSCLS-XFER-IN-RTL-AMT TO ML111-XFER-IN-RTL-AMT.        03230001
           MOVE WKSCLS-XFER-OUT-RTL-AMT                                 03240001
                                       TO ML111-XFER-OUT-RTL-AMT.       03250001
           MOVE WKSCLS-RCPT-RTL-AMT    TO ML111-RCPT-RTL-AMT.           03260001
           MOVE WKSCLS-RCPT-NET-COST-AMT                                03270001
                                       TO ML111-RCPT-NET-COST-AMT.      03280001
           MOVE WKSCLS-PADJ-RTL-AMT    TO ML111-PADJ-RTL-AMT.           03290001
           MOVE WKSCLS-PADJ-NET-COST-AMT                                03300001
                                       TO ML111-PADJ-NET-COST-AMT.      03310001
           MOVE WKSCLS-INV-ADJ-RTL-AMT TO ML111-INV-ADJ-RTL-AMT.        03320001
           MOVE 0                      TO ML111-SHNK-RTL-AMT.           03330001
           MOVE 0                      TO ML111-END-INV-RTL-AMT.        03331001
                                                                        03332001
           WRITE DATA-INTEGRITY-EXTR-REC                                03333001
               FROM ML111-DATA-INTEGRITY-EXTR-REC.                      03334001
           ADD 1                       TO PA-OUTPUT-RECS-WRITTEN.       03335001
                                                                        03336001
                                                                        03337001
       EJECT                                                            03338001
                                                                        03339001
WR5701******************************************************************03340001
       7000-DATE-RANGE-TO-PROCESS.                                      03350001
      ******************************************************************03360001
      *                                                                 03370001
           EXEC SQL                                                     03380001
               SELECT FSCL_MN_BEG_DTE                                   03390001
                 INTO :PV-OPN-MONTH-FIRST-WEEK                          03400001
                 FROM TDTATTR                                           03410001
                WHERE KY_DTE = :ML110-STRT-DTE                          03420001
W26603          WITH UR                                                 03421003
           END-EXEC.                                                    03430001
                                                                        03440001
           EVALUATE TRUE                                                03450001
               WHEN SQLCODE = 0                                         03460001
                   CONTINUE                                             03470001
               WHEN OTHER                                               03480001
                   MOVE '7000-DATE-RANGE-TO-PROCESS'                    03490001
                                       TO AA-PARAGRAPH-NAME             03500001
                   MOVE 'NO TDTATTR MATCH FOUND FOR KY_DTE'             03510001
                                       TO AA-MESSAGE                    03520001
                   MOVE 'SELECT FROM'  TO AA-DB2-OPERATION              03530001
                   PERFORM 9901-SQL-ERROR                               03540001
           END-EVALUATE.                                                03550001
                                                                        03560001
                                                                        03570001
      ******************************************************************03580001
       7100-OPEN-CURSOR-TWKSCLS.                                        03590001
      ******************************************************************03600001
      *                                                                 03610001
           EXEC SQL                                                     03620001
               OPEN TWKSCLS_CURSOR                                      03630001
           END-EXEC.                                                    03640001
                                                                        03650001
           EVALUATE TRUE                                                03660001
               WHEN SQLCODE = 0                                         03670001
                   CONTINUE                                             03680001
               WHEN OTHER                                               03690001
                   MOVE '7100-OPEN-CURSOR-TWKSCLS'                      03700001
                                       TO AA-PARAGRAPH-NAME             03710001
                   MOVE 'TWKSCLS TABLE ERROR'                           03720001
                                       TO AA-MESSAGE                    03730001
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              03740001
                   PERFORM 9901-SQL-ERROR                               03750001
           END-EVALUATE.                                                03760001
                                                                        03770001
       EJECT                                                            03780001
                                                                        03790001
      ******************************************************************03800001
       7200-FETCH-TWKSCLS.                                              03810001
      ******************************************************************03820001
      *                                                                 03830001
           EXEC SQL                                                     03840001
               FETCH TWKSCLS_CURSOR                                     03850001
                INTO :WKSCLS-FSCL-WK-END-DTE,                           03860001
                     :WKSCLS-DEPT-NBR,                                  03870001
                     :WKSCLS-SUB-CL-NBR,                                03880001
                     :WKSCLS-STR-NBR,                                   03890001
                     :WKSCLS-SLS-RTL-AMT,                               03900001
                     :WKSCLS-MKDN-RTL-AMT,                              03910001
                     :WKSCLS-MKUP-RTL-AMT,                              03920001
                     :WKSCLS-XFER-IN-RTL-AMT,                           03930001
                     :WKSCLS-XFER-OUT-RTL-AMT,                          03940001
                     :WKSCLS-RCPT-RTL-AMT,                              03950001
                     :WKSCLS-RCPT-NET-COST-AMT,                         03960001
                     :WKSCLS-PADJ-RTL-AMT,                              03970001
                     :WKSCLS-PADJ-NET-COST-AMT,                         03980001
WR5701               :WKSCLS-INV-ADJ-RTL-AMT                            03990001
           END-EXEC.                                                    04000001
                                                                        04010001
           EVALUATE TRUE                                                04020001
               WHEN SQLCODE = 0                                         04030001
                   ADD +1              TO PA-TWKSCLS-ROWS-FETCHED       04040001
               WHEN SQLCODE = +100                                      04050001
                   MOVE 'Y'            TO PS-TWKSCLS-DONE               04060001
               WHEN OTHER                                               04070001
                   MOVE '7200-FETCH-TWKSCLS'                            04080001
                                       TO AA-PARAGRAPH-NAME             04090001
                   MOVE 'TWKSCLS TABLE ERROR'                           04100001
                                       TO AA-MESSAGE                    04110001
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              04120001
                   PERFORM 9901-SQL-ERROR                               04130001
           END-EVALUATE.                                                04140001
                                                                        04150001
       EJECT                                                            04160001
                                                                        04170001
      ******************************************************************04180001
       7300-CLOSE-CURSOR-TWKSCLS.                                       04190001
      ******************************************************************04200001
      *                                                                 04210001
           EXEC SQL                                                     04220001
               CLOSE TWKSCLS_CURSOR                                     04230001
           END-EXEC.                                                    04240001
                                                                        04250001
           EVALUATE TRUE                                                04260001
               WHEN SQLCODE = 0                                         04270001
                   CONTINUE                                             04280001
               WHEN OTHER                                               04290001
                   MOVE '7300-CLOSE-CURSOR-TWKSCLS'                     04300001
                                       TO AA-PARAGRAPH-NAME             04310001
                   MOVE 'TWKSCLS TABLE ERROR'                           04320001
                                       TO AA-MESSAGE                    04330001
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              04340001
                   PERFORM 9901-SQL-ERROR                               04350001
           END-EVALUATE.                                                04360001
                                                                        04370001
       EJECT                                                            04380001
                                                                        04390001
      ******************************************************************04400001
       7400-SELECT-TDTATTR.                                             04410001
      ******************************************************************04420001
      *                                                                 04430001
           MOVE WKSCLS-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           04440001
                                                                        04450001
           EXEC SQL                                                     04460001
               SELECT FSCL_MN_NBR,                                      04470001
                      FSCL_MN_END_DTE                                   04480001
               INTO  :DTATTR-FSCL-MN-NBR,                               04490001
                     :DTATTR-FSCL-MN-END-DTE                            04500001
               FROM  TDTATTR                                            04510001
               WHERE (KY_DTE = :PV-FSCL-WK-END-DTE)                     04520001
W26603         WITH UR                                                  04521003
           END-EXEC.                                                    04530001
                                                                        04540001
           EVALUATE TRUE                                                04550001
               WHEN SQLCODE = 0                                         04560001
                   CONTINUE                                             04570001
               WHEN OTHER                                               04580001
                   MOVE '7400-SELECT-TDTATTR'                           04590001
                                       TO AA-PARAGRAPH-NAME             04600001
                   MOVE 'TDTATTR ROW NOT FOUND'                         04610001
                                       TO AA-MESSAGE                    04620001
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              04630001
                   PERFORM 9901-SQL-ERROR                               04640001
           END-EVALUATE.                                                04650001
                                                                        04660001
       EJECT                                                            04670001
                                                                        04680001
      ******************************************************************04690001
       8000-EOJ.                                                        04700001
      ******************************************************************04710001
      *                                                                 04720001
           DISPLAY ' '.                                                 04730001
           DISPLAY '  PROGRAM MLKUT418 PROCESSING SUMMARY'.             04740001
           DISPLAY '  -----------------------------------'.             04750001
           DISPLAY ' '.                                                 04760001
      *                                                                 04770001
           MOVE PA-TWKSCLS-ROWS-FETCHED TO CD-COUNT-HOLD1.              04780001
           DISPLAY 'TWKSCLS ROWS FETCHED =      ' CD-COUNT-HOLD1.       04790001
      *                                                                 04800001
           MOVE PA-TDTATTR-ROWS-SELECTED                                04810001
                                        TO CD-COUNT-HOLD1.              04820001
           DISPLAY 'TDTATTR ROWS SELECTED =     ' CD-COUNT-HOLD1.       04830001
      *                                                                 04840001
           MOVE PA-OUTPUT-RECS-WRITTEN TO CD-COUNT-HOLD1.               04850001
           DISPLAY 'EXTRACT RECORDS WRITTEN =   ' CD-COUNT-HOLD1.       04860001
      *                                                                 04870001
           DISPLAY ' '.                                                 04880001
                                                                        04890001
           CLOSE DATA-INTEGRITY-CTL-FILE.                               04900001
           CLOSE DATA-INTEGRITY-EXTR-FILE.                              04910001
                                                                        04920001
       EJECT                                                            04930001
                                                                        04940001
      ******************************************************************04950001
       9900-COMMON-ABEND-ROUTINE.                                       04960001
      ******************************************************************04970001
      *                                                                 04980001
           DISPLAY AA-ABEND-LIT.                                        04990001
           DISPLAY AA-PROGRAM-LIT.                                      05000001
           DISPLAY AA-PARAGRAPH-LIT.                                    05010001
           DISPLAY AA-MESSAGE-LINE.                                     05020001
           DISPLAY ABEND-CODE.                                          05030001
                                                                        05040001
           CALL 'ILBOABN0' USING ABEND-CODE.                            05050001
                                                                        05060001
       EJECT                                                            05070001
                                                                        05080001
      ******************************************************************05090001
       9901-SQL-ERROR.                                                  05100001
      ******************************************************************05110001
      *                                                                 05120001
           CLOSE DATA-INTEGRITY-CTL-FILE                                05130001
                 DATA-INTEGRITY-EXTR-FILE.                              05140001
                                                                        05150001
           DISPLAY AA-ABEND-LIT.                                        05160001
           DISPLAY AA-DB2-ERROR-LIT.                                    05170001
           DISPLAY AA-PROGRAM-LIT.                                      05180001
           DISPLAY AA-PARAGRAPH-LIT.                                    05190001
           DISPLAY AA-MESSAGE-LINE.                                     05200001
           DISPLAY AA-DB2-OPERATION-LIT.                                05210001
           SET AC-DB2-ERROR TO TRUE.                                    05220001
           MOVE +4013                  TO ABEND-CODE.                   05230001
                                                                        05240001
           COPY DPPD004.                                                05250001
           CALL 'ILBOABN0' USING ABEND-CODE.                            05260001
                                                                        05270001
