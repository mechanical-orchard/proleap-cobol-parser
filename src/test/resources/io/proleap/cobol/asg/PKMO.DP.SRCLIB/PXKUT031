000100 IDENTIFICATION DIVISION.                                         00010076
000200 PROGRAM-ID.           PXKUT031.                                  00020077
000300 AUTHOR.               D. WELLER                                  00030077
000400 INSTALLATION.         KOHLS DEPARTMENT STORES.                   00040077
000500 DATE-WRITTEN          03/07/2007.                                00050077
000600 DATE-COMPILED.                                                   00060077
000700                                                                  00070077
000800******************************************************************00080077
000900*   PXKUT031 - LOOK UP DAYS-FR-EVNT-NBR                           00090077
001000*                                                                 00100077
001100*   THIS PROGRAM SEQUENTIALLY READS AN INPUT FILE (PXRD034)       00110077
001200*   AND USES ITS PARAMETERS TO LOOK UP DAYS-FR-EVNT-NBR IN        00120077
001300*   ORACLE.  IT WRITE THIS FIELD TO A BMCUNLOAD PARAMETER CARD    00130077
001400*   IN SQL SYNTAX AND TO AN OUTPUT PARAMETER CARD.                00140077
      ******************** HISTORY OF CHANGES **************************00171091
      * CHG ID/                                                        *00172091
      * WR/PROJ          DATE        DESCRIPTION OF CHANGES            *00173091
      * ---------------  ----------  --------------------------------  *00174091
      *  CHG0215757      01/21/2018  MODIFIED THE PROGRAM TO           *00180090
      *                              EXTERNALIZE ORACLE LOGON          *00181090
      *                              CHANGES TAGGED TO CHG757          *00182090
001900******************************************************************00190077
002000                                                                  00200077
002100 ENVIRONMENT DIVISION.                                            00210077
002200                                                                  00220077
002300 CONFIGURATION SECTION.                                           00230077
002400                                                                  00240077
002500 SOURCE-COMPUTER. IBM-3090.                                       00250077
002600 OBJECT-COMPUTER. IBM-3090.                                       00260077
002700                                                                  00270077
002800 INPUT-OUTPUT SECTION.                                            00280077
002900 FILE-CONTROL.                                                    00290077
003000     SELECT ORACLE-LOGON-FILE                                     00300084
003100         ASSIGN TO ORALOGON.                                      00310084
003200                                                                  00320077
003300     SELECT PARAMETER-IN-FILE                                     00330077
003400         ASSIGN TO INP02.                                         00340077
003500                                                                  00350077
003600     SELECT DATE-CONTROL-CARD                                     00360077
003700         ASSIGN TO INP03.                                         00370077
003800                                                                  00380077
003900     SELECT BMCUNLOAD-OUT-FILE                                    00390077
004000         ASSIGN TO OUT01.                                         00400077
004100                                                                  00410077
004200     SELECT PARAMETER-OUT-FILE                                    00420077
004300         ASSIGN TO OUT02.                                         00430077
004400                                                                  00440077
004500 DATA DIVISION.                                                   00450077
004600                                                                  00460077
004700 FILE SECTION.                                                    00470077
CHG757 FD  ORACLE-LOGON-FILE                                            00480092
CHG757     RECORDING MODE IS F                                          00490092
CHG757     LABEL RECORDS ARE STANDARD                                   00500092
CHG757     BLOCK CONTAINS 0 RECORDS                                     00510092
CHG757     RECORD CONTAINS 80 CHARACTERS                                00520092
CHG757     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00521092
CHG757 01  OL-ORACLE-LOGON-RECORD          PIC X(80).                   00522092
005300                                                                  00530077
005400 FD  PARAMETER-IN-FILE                                            00540077
005500     LABEL RECORDS ARE STANDARD                                   00550077
005600     RECORDING MODE IS F                                          00560077
005700     BLOCK CONTAINS 0 RECORDS.                                    00570077
005800 01  PARAMETER-IN-RECORD             PIC X(80).                   00580077
005900                                                                  00590077
006000 FD  DATE-CONTROL-CARD                                            00600077
006100     LABEL RECORDS ARE STANDARD                                   00610077
006200     RECORDING MODE IS F                                          00620077
006300     BLOCK CONTAINS 0 RECORDS.                                    00630077
006400 01  DATE-CONTROL-RECORD             PIC X(80).                   00640077
006500                                                                  00650077
006600 FD  BMCUNLOAD-OUT-FILE                                           00660077
006700     LABEL RECORDS ARE STANDARD                                   00670077
006800     RECORDING MODE IS F                                          00680077
006900     BLOCK CONTAINS 0 RECORDS.                                    00690077
007000 01  BMCUNLOAD-OUT-RECORD            PIC X(80).                   00700077
007100                                                                  00710077
007200 FD  PARAMETER-OUT-FILE                                           00720077
007300     LABEL RECORDS ARE STANDARD                                   00730077
007400     RECORDING MODE IS F                                          00740077
007500     BLOCK CONTAINS 0 RECORDS.                                    00750077
007600 01  PARAMETER-OUT-RECORD            PIC X(80).                   00760077
007700                                                                  00770077
007800 WORKING-STORAGE SECTION.                                         00780077
007900                                                                  00790077
008000***************************************************************** 00800077
008100*  PARAMETER IN RECORD LAYOUT                                     00810077
008200***************************************************************** 00820077
008300*01  PX034-PARAMETER-IN-RECORD.                                   00830077
008400     COPY PXRD034.                                                00840077
008500                                                                  00850077
009600***************************************************************** 00960077
009700*  BMCUNLOAD OUT RECORD LAYOUT                                    00970077
009800***************************************************************** 00980077
009900*01  PX033-BMCUNLOAD-RECORD.                                      00990077
010000     COPY PXRD033.                                                01000077
010100                                                                  01010077
010200***************************************************************** 01020077
010300*  PARAMETER OUT RECORD LAYOUT                                    01030077
010400***************************************************************** 01040077
010500*01  PX035-PARAMETER-RECORD.                                      01050077
010600     COPY PXRD035.                                                01060077
010700                                                                  01070077
010800******************************************************************01080064
010900* DATE ROUTINE COPY MEMBERS                                       01090064
011000******************************************************************01100064
011100     COPY DPWS500.                                                01110064
011200                                                                  01120064
011300******************************************************************01130062
011400*DATE CONTROL CARD LAYOUT                                        *01140062
011500******************************************************************01150062
011600 01 CC-CONTROL-DATE.                                              01160062
011700    05 CC-DATE                        PIC  X(10) VALUE SPACES.    01170081
011800    05  FILLER                        PIC  X(70) VALUE SPACE.     01180081
CHG757******************************************************************01181092
CHG757*      ORACLE CONNECTION VARIABLES                                01182092
CHG757******************************************************************01183092
CHG757 01  CC-ORACLE-CONNECTION.                                        01184092
CHG757     05  CC-ORACLE-USERID             PIC X(40).                  01185092
CHG757         88 CC-AUTO-LOGON                            VALUE '/'.   01186092
CHG757     05  CC-ORACLE-PASSWORD           PIC X(40).                  01187092
011900***************************************************************** 01190028
012000*  PROGRAM'S CONSTANTS                                          * 01200028
012100***************************************************************** 01210028
012200 01  PC-PROGRAM-CONSTANTS.                                        01220028
012300     05  PC-MAX-DEADLOCKS            PIC S9(04)      VALUE +3.    01230028
012400     05  PC-PROGRAM-NAME             PIC X(08)       VALUE        01240084
012500         'PXKUT031'.                                              01250028
012600     05  PC-AUTO-LOGON               PIC X(1)        VALUE '/'.   01260084
012700     05  PC-ORACLE-PROD-ID-LGTH      PIC 9(02)       VALUE 1.     01270028
012800                                                                  01280028
012900***************************************************************** 01290028
013000*  PROGRAM'S SWITCHES                                           * 01300028
013100***************************************************************** 01310028
013200 01  PS-PROGRAM-SWITCHES.                                         01320028
013300     05  PS-END-OF-PARM-FILE-SW      PIC X(01)       VALUE 'N'.   01330028
013400         88  PS-END-OF-PARM-FILE                     VALUE 'Y'.   01340028
013500         88  PS-NOT-END-OF-PARM-FILE                 VALUE 'N'.   01350028
013600     05  PS-END-OF-CONTROL-CARDS-SW  PIC X(01)       VALUE 'N'.   01360028
013700         88  PS-END-OF-CONTROL-CARDS                 VALUE 'Y'.   01370028
013800         88  PS-NOT-END-OF-CONTROL-CARDS             VALUE 'N'.   01380028
013900     05  PS-END-OF-DATE-CONTROL-SW   PIC  X(01)      VALUE 'N'.   01390068
014000         88  PS-DATE-CONTROL-END                     VALUE 'Y'.   01400066
014100     05  PS-RUN-REPORT-SW            PIC X(01)       VALUE 'N'.   01410028
014200         88  PS-RUN-REPORT                           VALUE 'Y'.   01420028
014300         88  PS-DO-NOT-RUN-REPORT                    VALUE 'N'.   01430028
014400     05  PS-ROW-PROCESSED-SW         PIC X(01)       VALUE 'N'.   01440028
014500         88  PS-ROW-PROCESSED                        VALUE 'Y'.   01450028
014600         88  PS-ROW-NOT-PROCESSED                    VALUE 'N'.   01460028
014700     05  PS-ROW-FOUND-SW             PIC X(01)       VALUE 'N'.   01470028
014800         88  PS-ROW-FOUND                            VALUE 'Y'.   01480028
014900         88  PS-ROW-NOT-FOUND                        VALUE 'N'.   01490028
015000     05  PS-REQUEST-STATUS           PIC X(08)       VALUE SPACES.01500028
015100         88  PS-UPDATE-REQUEST                       VALUE        01510028
015200             'UPDATE  '.                                          01520028
015300         88  PS-INSERT-REQUEST                       VALUE        01530028
015400             'INSERT  '.                                          01540028
015500         88  PS-NEGATIVE-FOUND                       VALUE        01550028
015600             'NEG FND '.                                          01560028
015700     05  PS-OPERATION-ATTEMPTED      PIC X(40)       VALUE SPACES.01570028
015800         88  PS-DEADLOCK-MSG                         VALUE        01580028
015900             'MAXIMUM DEADLOCK COUNT EXCEEDED         '.          01590028
016000         88  PS-CHECK-AVL-FUND-MSG                   VALUE        01600028
016100             'CHECKING AVAILABLE FUND FAILED          '.          01610028
016200         88  PS-CHECKPOINT-UPDATE-MSG                VALUE        01620028
016300             'UPDATE CHECKPOINT FAILED                '.          01630028
016400         88  PS-COMMIT-MSG                           VALUE        01640028
016500             'COMMIT FAILED                           '.          01650028
016600         88  PS-ORA-LOGIN-MSG                        VALUE        01660028
016700             'ORACLE LOGIN FAILED                     '.          01670028
016800         88  PS-UPDATE-AVL-FUND-MSG                  VALUE        01680028
016900             'UPDATE OF AVAILABLE FUND FAILED         '.          01690028
017000         88  PS-INSERT-AVL-FUND-MSG                  VALUE        01700028
017100             'INSERT OF NEW AVAILABLE FUND FAILED     '.          01710028
017200         88  PS-GET-RESTART-MSG                      VALUE        01720028
017300             'GETTING RESTARTING INFORMATION FAILED   '.          01730028
017400         88  PS-CHECK-RESTART-MSG                    VALUE        01740028
017500             'CHECKING RESTARTING CONTROL FAILED      '.          01750028
CHG757     05  PS-END-OF-LOGON-FILE-SW     PIC  X(01)      VALUE 'N'.   01751092
CHG757         88 PS-END-OF-LOGON-FILE                     VALUE 'Y'.   01752092
CHG757     05  PS-ORA-SRC-CTL-DONE-SW      PIC  X(01)      VALUE 'N'.   01753092
CHG757         88  PS-ORA-SRC-EMPTY                        VALUE 'Y'.   01754092
017600                                                                  01760028
017700***************************************************************** 01770028
017800*  PROGRAM'S VARIABLES                                          * 01780028
017900***************************************************************** 01790028
018000 01  PV-PROGRAM-VARIABLES.                                        01800028
018100     05  PV-TABLE-NAME               PIC  X(30)  VALUE SPACES.    01810028
018200     05  PV-RETRY-COUNT              PIC S9(04)      VALUE ZEROES.01820028
018300     05  PV-PARAGRAPH-NAME           PIC X(40)       VALUE SPACES.01830028
018400     05  PV-OPERATION-MSG            PIC  X(60)  VALUE SPACES.    01840072
018500     05  PV-OPERATION-MSG-1          PIC  X(40)  VALUE SPACES.    01850028
018600     05  PV-OPERATION-MSG-2          PIC  X(40)  VALUE SPACES.    01860028
018700     05  PV-NULL-RETURN              PIC S9(04)      VALUE ZEROES 01870028
018800                         COMP.                                    01880028
018900     05  PV-DAYS-FR-EVNT-NBR         PIC S9(04)      VALUE +0.    01890028
019000     05  PV-DATE-FR-EVNT-NBR         PIC X(10)       VALUE SPACE. 01900080
019100     05  PV-RECORDS-READ             PIC 9(04)       VALUE 0.     01910028
019200     05  PV-PARAMETERS-WRITTEN       PIC 9(04)       VALUE 0.     01920028
CHG757     05  PV-ORACLE-USERID-LEN        PIC S9(4)       VALUE ZEROS  01921092
CHG757                                                     COMP SYNC.   01922092
CHG757     05  PV-ORACLE-PASSWORD-LEN      PIC S9(4)       VALUE ZEROS  01923092
CHG757                                                     COMP SYNC.   01930092
019400***************************************************************** 01940028
019500*  ABEND CODE AREA                                              * 01950028
019600***************************************************************** 01960028
019700                                                                  01970028
019800 01  ABEND-CODE                      PIC S9(04)  VALUE +0  COMP.  01980028
019900     88  ABEND-4001-WRITE-ERROR                  VALUE +4001.     01990028
020000     88  ABEND-4002-READ-ERROR                   VALUE +4002.     02000028
020100     88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.     02010028
020200     88  ABEND-4004-TABLE-ERROR                  VALUE +4004.     02020028
020300     88  ABEND-4005-OPEN-ERROR                   VALUE +4005.     02030028
020400     88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.     02040028
020500     88  ABEND-4007-SEQUENCE-ERROR               VALUE +4007.     02050028
020600     88  ABEND-4008-DATA-ERROR                   VALUE +4008.     02060028
020700     88  ABEND-4009-KEY-DATA-ERROR               VALUE +4009.     02070028
020800     88  ABEND-4013-DB-ERROR                     VALUE +4013.     02080028
020900     88  ABEND-4014-ORACLE-LOGON-ERROR           VALUE +4014.     02090028
021000     88  ABEND-4019-DATE-ROUTINE-ERROR           VALUE +4019.     02100028
021100     88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     02110028
021200                                                                  02120028
021300                                                                  02130028
021400 01  WS-MSG-TEXT                     PIC X(512)      VALUE SPACES.02140028
021500 01  WS-MAX-SIZE                     PIC S9(09)      VALUE +512   02150028
021600                         COMP.                                    02160028
021700 01  WS-MSG-LENGTH                   PIC S9(09)      VALUE ZEROES 02170028
021800                         COMP.                                    02180028
021900                                                                  02190028
022000******************************************************************02200028
022100*    ORACLE DECLARE SECTION                                       02210028
022200******************************************************************02220028
022300     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02230028
022400                                                                  02240028
022500 01  PV-ORACLE-ID                    PIC  X(01)  VALUE '/'.       02250028
022600 01  USERNAME                        PIC X(10)      VARYING.      02260028
022700 01  PASSWD                          PIC X(10)      VARYING.      02270028
022800                                                                  02280028
022900******************************************************************02290028
023000* COBOL DECLARATION FOR TABLE PXT_EVNT                           *02300028
023100******************************************************************02310028
023200*    EXEC SQL                                                     02320060
023300*        INCLUDE PXT00007                                         02330060
023400*    END-EXEC.                                                    02340060
023500                                                                  02350028
023600                                                                  02360028
023700******************************************************************02370028
023800* COBOL DECLARATION FOR TABLE PXT_EVNT_CDE_BF                     02380028
023900******************************************************************02390028
024000     EXEC SQL                                                     02400028
024100         INCLUDE PXT00008                                         02410028
024200     END-EXEC.                                                    02420028
024300                                                                  02430028
024400                                                                  02440028
024500     EXEC SQL END DECLARE SECTION END-EXEC.                       02450028
024600*                                                                 02460028
024700* ORA COMMUNICATION AREA                                          02470028
024800*                                                                 02480028
024900  01       SQLCA.                                                 02490028
025000           05  SQLCAID               PIC X(8).                    02500028
025100           05  SQLCABC               PIC S9(9) COMPUTATIONAL.     02510028
025200           05  SQLCODE               PIC S9(9) COMPUTATIONAL.     02520028
025300           05  SQLERRM.                                           02530028
025400               49 SQLERRML           PIC S9(4) COMPUTATIONAL.     02540028
025500               49 SQLERRMC           PIC X(70).                   02550028
025600           05  SQLERRP               PIC X(8).                    02560028
025700           05  SQLERRD OCCURS 6 TIMES                             02570028
025800                                     PIC S9(9) COMPUTATIONAL.     02580028
025900           05  SQLWARN.                                           02590028
026000               10 SQLWARN0           PIC X(1).                    02600028
026100               10 SQLWARN1           PIC X(1).                    02610028
026200               10 SQLWARN2           PIC X(1).                    02620028
026300               10 SQLWARN3           PIC X(1).                    02630028
026400               10 SQLWARN4           PIC X(1).                    02640028
026500               10 SQLWARN5           PIC X(1).                    02650028
026600               10 SQLWARN6           PIC X(1).                    02660028
026700               10 SQLWARN7           PIC X(1).                    02670028
026800           05  SQLEXT                PIC X(8).                    02680028
026900******************************************************************02690028
027000* ORA COMMUNICATION AREA2                                         02700028
027100     COPY SQLCA2.                                                 02710028
027200                                                                  02720028
027300 PROCEDURE DIVISION.                                              02730028
027400                                                                  02740028
027500******************************************************************02750028
027600*    MAINLINE LOGIC                                              *02760028
027700******************************************************************02770028
027800                                                                  02780028
027900 0000-MAINLINE.                                                   02790028
028000                                                                  02800028
028100     PERFORM 1000-INITIALIZATION.                                 02810084
028200                                                                  02820028
028300     PERFORM 2000-PROCESS-INPUT                                   02830028
028400         UNTIL PS-END-OF-PARM-FILE.                               02840028
028500                                                                  02850028
028600     PERFORM 9900-EOJ-LOGIC.                                      02860028
028700                                                                  02870028
028800     GOBACK.                                                      02880028
028900                                                                  02890028
029600******************************************************************02960028
029700*    LOGON TO ORACLE, AND DECLARE THE ORACLE CURSORS.            *02970028
029800******************************************************************02980028
029900 1000-INITIALIZATION.                                             02990028
030000     DISPLAY '1000-INITIALIZATION'.                               03000047
030100                                                                  03010028
030200     OPEN INPUT  ORACLE-LOGON-FILE.                               03020083
CHG757                                                                  03021092
CHG757     DISPLAY 'ORACLE FILE READ'.                                  03022092
CHG757     PERFORM 8000-READ-ORACLE-LOGON.                              03023092
CHG757                                                                  03024092
CHG757     DISPLAY 'ORACLE FILE CLOSE'.                                 03025092
CHG757     CLOSE ORACLE-LOGON-FILE.                                     03026092
CHG757                                                                  03027092
CHG757     IF ((PS-END-OF-LOGON-FILE)                                   03028092
CHG757              OR (CC-ORACLE-CONNECTION = SPACES))                 03029092
CHG757           DISPLAY '** ABEND **'                                  03029192
CHG757           DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '03029292
CHG757               'NOT PROVIDED'                                     03029392
CHG757           SET PS-ORA-SRC-EMPTY TO TRUE                           03029492
CHG757           CALL 'ILBOABN0' USING ABEND-CODE                       03029592
CHG757     END-IF.                                                      03029692
CHG757                                                                  03029792
CHG757         IF CC-AUTO-LOGON                                         03029892
CHG757             DISPLAY PC-PROGRAM-NAME  ' - AUTO LOGON TO ORACLE'   03029992
CHG757             EXEC SQL                                             03030092
CHG757               CONNECT  :PC-AUTO-LOGON                            03030192
CHG757             END-EXEC                                             03030292
CHG757     ELSE                                                         03030392
CHG757         INITIALIZE PV-ORACLE-USERID-LEN                          03030492
CHG757                    PV-ORACLE-PASSWORD-LEN                        03030592
CHG757           INSPECT    CC-ORACLE-USERID                            03030692
CHG757             TALLYING   PV-ORACLE-USERID-LEN                      03030792
CHG757             FOR CHARACTERS BEFORE INITIAL SPACE                  03030892
CHG757           INSPECT    CC-ORACLE-PASSWORD                          03030992
CHG757             TALLYING   PV-ORACLE-PASSWORD-LEN                    03031092
CHG757             FOR CHARACTERS BEFORE INITIAL SPACE                  03031192
CHG757         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO        03031292
CHG757                    USERNAME-ARR                                  03031392
CHG757         MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                03031492
CHG757         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    03031592
CHG757                      PASSWD-ARR                                  03031692
CHG757         MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                03031792
CHG757           DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER ' 03031892
CHG757                      USERNAME-ARR                                03031992
CHG757            EXEC SQL                                              03032092
CHG757                 CONNECT :USERNAME IDENTIFIED BY :PASSWD          03032192
CHG757            END-EXEC                                              03032292
CHG757         INITIALIZE CC-ORACLE-PASSWORD                            03032392
CHG757                    PASSWD                                        03032492
CHG757     END-IF.                                                      03032592
CHG757                                                                  03032692
CHG757         IF SQLCODE NOT = 0                                       03032792
CHG757               DISPLAY '** CONNECTING TO ORACLE BY USERID **'     03032892
CHG757               DISPLAY 'TRIED TO CONNECT TO ORACLE UNDER: '       03032992
CHG757                                  PASSWD                          03033092
CHG757            SET ABEND-4013-DB-ERROR  TO TRUE                      03033192
CHG757               PERFORM Z100-ABEND                                 03033292
264200         END-IF.                                                  03033383
264300                                                                  03033483
030300     OPEN INPUT  PARAMETER-IN-FILE.                               03034028
030400     OPEN INPUT  DATE-CONTROL-CARD.                               03040062
030500     OPEN OUTPUT BMCUNLOAD-OUT-FILE.                              03050028
030600     OPEN OUTPUT PARAMETER-OUT-FILE.                              03060028
030700                                                                  03070083
030900     READ DATE-CONTROL-CARD INTO CC-CONTROL-DATE                  03080088
031000         AT END                                                   03090088
031100             SET PS-DATE-CONTROL-END TO TRUE.                     03100088
031200                                                                  03110088
031300     IF PS-DATE-CONTROL-END                                       03120088
031400             MOVE 'DATE CONTROL CARD MISSING'                     03130088
031500                                 TO PV-OPERATION-MSG-1            03140088
031600             SET ABEND-4003-CTRL-CARD-ERROR TO TRUE               03150088
031700             PERFORM Z100-ABEND                                   03160088
031800     END-IF.                                                      03170088
031900     DISPLAY PC-PROGRAM-NAME ' DATE CONTROL CARD:  '              03180089
032000             CC-CONTROL-DATE.                                     03190088
032300                                                                  03200088
032400     PERFORM 6100-READ-PARAMETER-IN-FILE.                         03240028
032500     IF PS-END-OF-PARM-FILE                                       03250028
032600         DISPLAY ' *** NOTHING TO PROCESS ***'                    03260028
032700         DISPLAY ' '                                              03270028
032800     END-IF.                                                      03280028
032900                                                                  03290028
033000******************************************************************03300028
033100*    2000-PROCESS-INPUT                                          *03310028
033200*      THIS IS PERFORMED ONLY VIA THE 0000-MAINLINE              *03320028
033300*      PURPOSE: READ AND PROCESS THE PURCHASE ADJUSTMENT FILE    *03330028
033400*               TO UPDATE THE DAT_AVL_VND_FUND TABLE             *03340028
033500******************************************************************03350028
033600 2000-PROCESS-INPUT.                                              03360028
033700     DISPLAY '2000-PROCESS-INPUT'.                                03370047
033800     PERFORM 7000-ORACLE-LOOKUPS.                                 03380028
033900                                                                  03390028
034000     PERFORM 6100-READ-PARAMETER-IN-FILE.                         03400028
034100                                                                  03410028
034200******************************************************************03420028
034300*  READ PARAMETER IN FILE                                         03430028
034400******************************************************************03440028
034500 6100-READ-PARAMETER-IN-FILE.                                     03450028
034600     DISPLAY '6100-READ-PARAMETER-IN-FILE'.                       03460047
034700                                                                  03470028
034800     READ PARAMETER-IN-FILE INTO PX034-PARAMETER-IN-RECORD        03480028
034900         AT END SET PS-END-OF-PARM-FILE TO TRUE.                  03490028
035000                                                                  03500051
035100     IF PS-NOT-END-OF-PARM-FILE                                   03510028
035200         ADD 1 TO PV-RECORDS-READ                                 03520028
035300     END-IF.                                                      03530028
035400                                                                  03540028
035500******************************************************************03550028
035600*  WRITE OUT BMCUNLOAD RECORD                                     03560028
035700******************************************************************03570028
035800 6200-WRITE-BMCUNLOAD-OUT-FILE.                                   03580028
035900     DISPLAY '6200-WRITE-BMCUNLOAD-OUT-FILE'.                     03590047
036000                                                                  03600028
036100     PERFORM 6400-COMPUTE-FUTURE-DATE.                            03610078
036200                                                                  03620078
036300     MOVE PV-DATE-FR-EVNT-NBR TO PX033-DATE-FR-EVNT-NBR.          03630082
036400                                                                  03640082
036500     EVALUATE PX034-OUTPUT-FORMAT-CDE                             03650028
036600     WHEN '2'                                                     03660028
036700                                                                  03670082
036800         SET PX033-BMCLOD-COND-2  TO TRUE                         03680082
036900     WHEN '3'                                                     03690028
037000                                                                  03700082
037100         SET PX033-BMCLOD-COND-3  TO TRUE                         03710082
037200     WHEN OTHER                                                   03720028
037300                                                                  03730082
037400         SET PX033-BMCLOD-COND-1  TO TRUE                         03740082
037500     END-EVALUATE.                                                03750028
037600                                                                  03760082
037700     WRITE BMCUNLOAD-OUT-RECORD FROM PX033-BMCUNLOAD-REC.         03770082
037800                                                                  03780082
037900     DISPLAY 'BMCUNLOAD ' PX033-BMCUNLOAD-REC.                    03790079
038000******************************************************************03800028
038100*  WRITE OUT PARAMETER RECORD                                     03810028
038200******************************************************************03820028
038300 6300-WRITE-PARAMETER-OUT-FILE.                                   03830028
038400     DISPLAY '6300-WRITE-PARAMETER-OUT-FILE'.                     03840047
038500                                                                  03850028
038600     MOVE PV-DAYS-FR-EVNT-NBR    TO PX035-DAYS-FR-EVNT-NBR.       03860028
038700                                                                  03870057
038800     DISPLAY 'PX035 DAYS ' PX035-DAYS-FR-EVNT-NBR                 03880048
038900                                                                  03890057
039000     WRITE PARAMETER-OUT-RECORD FROM PX035-PARAMETER-RECORD.      03900028
039100     ADD 1                       TO PV-PARAMETERS-WRITTEN.        03910028
039200                                                                  03920057
039300     DISPLAY 'PX035 ' PX035-PARAMETER-RECORD.                     03930057
039400******************************************************************03940077
039500*    6400-COMPUTE-FUTURE-DATE                                    *03950077
039600******************************************************************03960077
039700 6400-COMPUTE-FUTURE-DATE.                                        03970077
039800                                                                  03980077
039900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03990077
040000     MOVE CC-CONTROL-DATE          TO DPG52-LK-DATE-INPUT.        04000077
040100     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       04010077
040200     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       04020077
040300     IF PV-DAYS-FR-EVNT-NBR > 0                                   04030077
040400         SET DPG51-INCREMENT-DATE      TO TRUE                    04040077
040500     ELSE                                                         04050077
040600         SET DPG51-DECREMENT-DATE      TO TRUE                    04060077
040700     END-IF.                                                      04070077
040800     MOVE PV-DAYS-FR-EVNT-NBR      TO DPG51-INCR-DECR-DAYS-9.     04080077
040900     PERFORM 9999-DATE-ROUTINE.                                   04090077
041000     MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-DATE-FR-EVNT-NBR.        04100077
041100                                                                  04110077
041200     DISPLAY 'PV-DATE-FR-EVNT-NBR: ' PV-DATE-FR-EVNT-NBR.         04120077
041300                                                                  04130077
041400******************************************************************04140028
041500*  DO LOOKUPS IN ORACLE                                           04150028
041600******************************************************************04160028
041700 7000-ORACLE-LOOKUPS.                                             04170028
041800     DISPLAY '7000-ORACLE-LOOKUPS'.                               04180047
041900     MOVE '7000-ORACLE-LOOKUPS' TO PV-PARAGRAPH-NAME.             04190028
042000     PERFORM 7900-SELECT-DAYS-UNCONDIT.                           04200028
042100     IF PS-ROW-FOUND AND PS-ROW-PROCESSED                         04210028
042200* PRODUCE FILE OF BF, EVNT_CDE, DAYS FOR EACH INPUT               04220028
042300         PERFORM 6300-WRITE-PARAMETER-OUT-FILE                    04230028
042400* PRODUCE SQL SYNTAX FOR BMC UNLOAD ONLY FROM THE FIRST INPUT     04240028
042500         IF PV-RECORDS-READ = 1                                   04250028
042600             PERFORM 6200-WRITE-BMCUNLOAD-OUT-FILE                04260028
042700         END-IF                                                   04270028
042800     END-IF.                                                      04280028
042900                                                                  04290028
043000******************************************************************04300028
043100*  SELECT DAYS_FR_EVNT_NBR - WHETHER OR NOT TODAY IS THE DAY      04310028
043200******************************************************************04320028
043300                                                                  04330028
043400 7900-SELECT-DAYS-UNCONDIT.                                       04340028
043500     DISPLAY '7900-SELECT-DAYS-UNCONDIT'.                         04350047
043600     MOVE '7900-SELECT-DAYS-UNCONDIT' TO PV-PARAGRAPH-NAME.       04360028
043700                                                                  04370028
043800     EXEC SQL                                                     04380028
043900           SELECT                                                 04390028
044000                 B.DAYS_FR_EVNT_NBR                               04400028
044100           INTO                                                   04410028
044200                 :PV-DAYS-FR-EVNT-NBR    :PV-NULL-RETURN          04420028
044300           FROM                                                   04430028
044400                 PXT_EVNT_CDE_BF  B                               04440059
044500           WHERE                                                  04450028
044600                 B.EVNT_CDE      =  :PX034-EVNT-CDE               04460028
044700             AND B.BF_CDE        =  :PX034-BF-CDE                 04470028
044800             AND CURRENT_DATE    >= B.EFF_BEG_DTE                 04480028
044900             AND (CURRENT_DATE   <  B.EFF_END_DTE                 04490028
045000              OR B.EFF_END_DTE IS NULL)                           04500028
045100           GROUP BY B.DAYS_FR_EVNT_NBR                            04510028
045200     END-EXEC.                                                    04520028
045300                                                                  04530028
045400     EVALUATE TRUE                                                04540028
045500         WHEN SQLCODE = 0                                         04550028
045600           SET PS-ROW-PROCESSED         TO TRUE                   04560028
045700           IF PV-NULL-RETURN = -1                                 04570028
045800             SET PS-ROW-NOT-FOUND       TO TRUE                   04580028
045900           ELSE                                                   04590028
046000             SET PS-ROW-FOUND             TO TRUE                 04600028
046100           END-IF                                                 04610028
046200         WHEN SQLCODE = 1403                                      04620028
046300             SET PS-ROW-NOT-FOUND       TO TRUE                   04630028
046400             SET PS-ROW-PROCESSED       TO TRUE                   04640028
046500         WHEN SQLCODE = -54                                       04650028
046600             ADD +1                        TO PV-RETRY-COUNT      04660028
046700             DISPLAY 'DEADLOCK ORA-00054 7000-ORACLE-LOOKUPS'     04670028
046800             IF PV-RETRY-COUNT > PC-MAX-DEADLOCKS                 04680028
046900                 SET PS-DEADLOCK-MSG         TO TRUE              04690028
047000                 PERFORM 9990-SQL-ERROR                           04700028
047100             END-IF                                               04710028
047200         WHEN OTHER                                               04720028
047300             DISPLAY '** EVNT-CDE:  '  PX034-EVNT-CDE             04730028
047400             DISPLAY '** BF-CDE:    '  PX034-BF-CDE               04740028
047500             PERFORM 9990-SQL-ERROR                               04750028
047600     END-EVALUATE.                                                04760028
047700                                                                  04770028
CHG757****************************************************************  04771092
CHG757* LOGON TO ORACLE                                                 04772092
CHG757****************************************************************  04773092
CHG757 8000-READ-ORACLE-LOGON.                                          04774092
CHG757                                                                  04775092
CHG757     READ ORACLE-LOGON-FILE                                       04776092
CHG757         INTO CC-ORACLE-CONNECTION                                04777092
CHG757         AT END                                                   04778092
CHG757             SET PS-END-OF-LOGON-FILE TO TRUE                     04779092
CHG757     END-READ.                                                    04779192
CHG757                                                                  04779292
047800******************************************************************04780028
047900*    9900-EOJ-LOGIC.                                              04790028
048000*      THIS IS PERFORMED AT END OF INPUT FILE.                    04800028
048100*      PURPOSE: CLOSE INPUT FILE,                                 04810028
048200*      DISPLAY RECORD COUNTS.                                     04820028
048300******************************************************************04830028
048400 9900-EOJ-LOGIC.                                                  04840028
048500     DISPLAY '9900-EOJ-LOGIC'.                                    04850052
048600                                                                  04860028
048800     CLOSE PARAMETER-IN-FILE.                                     04880028
048900     CLOSE DATE-CONTROL-CARD.                                     04890072
049000     CLOSE PARAMETER-OUT-FILE.                                    04900028
049100     CLOSE BMCUNLOAD-OUT-FILE.                                    04910028
049200                                                                  04920028
049300     DISPLAY ' '.                                                 04930028
049400     DISPLAY 'RECORDS READ       ' PV-RECORDS-READ.               04940028
049500     DISPLAY 'PARAMETERS WRITTEN ' PV-PARAMETERS-WRITTEN.         04950028
049600     DISPLAY '**------ END ' PC-PROGRAM-NAME ' ------**'.         04960084
049700                                                                  04970052
049800                                                                  04980028
049900                                                                  04990028
050000******************************************************************05000028
050100* DISPLAYS ERRORS ENCOUNTERED ON SQL REQUEST                      05010028
050200******************************************************************05020028
050300 9990-SQL-ERROR.                                                  05030028
050400                                                                  05040028
050500     MOVE SQLCODE    TO SQLCODE2.                                 05050028
050600     MOVE SQLERRD(3) TO SQLERRD3.                                 05060028
050700     DISPLAY '** ABEND **       ** = SQLERROR'.                   05070028
050800     DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           05080084
050900     DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         05090028
051000     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05100028
051100     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05110028
051200     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05120028
051300     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05130028
051400     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                05140028
051500     DISPLAY '** OPERATION      ** = ' PS-OPERATION-ATTEMPTED.    05150028
051600                                                                  05160028
051700     MOVE SPACES TO WS-MSG-TEXT.                                  05170028
051800*    GET FULL TEXT OF ERROR MESSAGE                               05180028
051900                                                                  05190028
052000     CALL 'SQLGLM' USING WS-MSG-TEXT,                             05200028
052100                         WS-MAX-SIZE,                             05210028
052200                         WS-MSG-LENGTH.                           05220028
052300     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               05230028
052400                                                                  05240028
052500     EXEC SQL                                                     05250028
052600         ROLLBACK WORK RELEASE                                    05260028
052700     END-EXEC.                                                    05270028
052800                                                                  05280028
052900     SET ABEND-4013-DB-ERROR  TO TRUE.                            05290028
053000                                                                  05300028
053100     PERFORM Z100-ABEND.                                          05310028
053200                                                                  05320028
053300******************************************************************05330072
053400**RUN DATE ROUTINE                                                05340072
053500******************************************************************05350072
053600 9999-DATE-ROUTINE.                                               05360068
053700                                                                  05370068
053800     MOVE '9999-DATE-ROUTINE' TO PV-PARAGRAPH-NAME.               05380076
053900     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05390068
054000                USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.        05400068
054100                                                                  05410068
054200     EVALUATE TRUE                                                05420068
054300          WHEN DPG54-NO-ERROR                                     05430068
054400               CONTINUE                                           05440068
054500          WHEN OTHER                                              05450068
054600             DISPLAY 'RETRIEVING END DATE...'                     05460068
054700             DISPLAY DPG54-ERROR-MESSAGE                          05470068
054800             PERFORM Z100-ABEND                                   05480069
054900     END-EVALUATE.                                                05490068
055000                                                                  05500073
055100*-----------------------------------------------------------      05510028
055200* Z100-ABEND                                                      05520028
055300*  - PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE              05530028
055400*-----------------------------------------------------------      05540028
055500 Z100-ABEND.                                                      05550028
055600                                                                  05560028
055700     DISPLAY '                       '.                           05570028
055800     DISPLAY '** ABEND **       ** = SQLERROR'.                   05580028
055900     DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           05590084
056000     DISPLAY '** SQLCODE        ** = ' SQLCODE.                   05600028
056100     DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                05610028
056200     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05620028
056300     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05630028
056400     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                05640028
056500     DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         05650028
056600     DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.             05660028
056700     DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.          05670028
056800     DISPLAY '                       '.                           05680028
056900                                                                  05690028
057000     CALL 'ILBOABN0' USING ABEND-CODE.                            05700028
057100                                                                  05710028
057200******************************************************************05720028
057300*    END OF SOURCE CODE FOR PXKUT031                             *05730028
057400******************************************************************05740028
