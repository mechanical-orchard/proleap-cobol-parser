000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.         OFKUT010.                                    00020001
000300 AUTHOR.             CHERI PARMLEY.                               00030001
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040001
000500 DATE-WRITTEN.       MARCH  2016                                  00050001
000600******************************************************************00060001
000600*When compiling check 'MQSERIES PROGRAM(Y/N)' with 'Y' on second *00070001
000600*compile screen.                                                 *00080001
000600******************************************************************00090001
000700*        SEND INTRANSIT DATA TO OMS APPLICATION                   00100001
000800* This program will take in a file of INTRANSIT data created in   00110001
000900* job SUK060, create XML to send to a queue to be picked up and   00120001
001000* sent to the OMS application.                                    00130001
001020******************************************************************00140001
001030*  CHANGE LOG                                                     00150001
001040*  DATE       CHANGED BY      DESC                                00160001
001050*  ---------- -------------   ------------------------------------00170001
001060*  03/01/2016 Cheri Parmley   Initial implementation.             00180001
001060*  05/11/2016 Cheri Parmley   Remove EnterpriseCode attribute     00190001
001060*  06/30/2016 Cheri Parmley   Change ItemID to X(08)              00200001
001060*  07/01/2016 Cheri Parmley   Remove displays                     00210001
001060*  07/08/2016 Cheri Parmley   Add fields PO, Recv, Retail and Cost00220001
001060*  08/18/2016 Cheri Parmley   Increase buffer space to 500000     00230002
001070*                                                                 00240002
001103******************************************************************00250002
001060*  02/24/2017 Jim Arendt   Add fields SML-TYPE, MSTR-UNT-ID,      00260015
001070*                          TMST-ON-TRLR, DTE-AT-DC AND TM-AT-DC   00270015
001070*                          to output xml.                         00280015
001070*                          Also, increased input file size to 200 00290015
001103******************************************************************00290123
      *  06/14/2019 Cognizant       Pass value as 'OPC' when            00291025
      *                             OF011-OPC-SET-IND is Y to Text10 and00292024
      *                             SPACE when OF011-OPC-SET-IND is N   00292124
      *                                                                 00292224
      *                             CHG: CHG0227744                     00293023
001103******************************************************************00300009
001110 ENVIRONMENT DIVISION.                                            00310002
001130 CONFIGURATION SECTION.                                           00320002
001140 SOURCE-COMPUTER.    IBM-3090.                                    00330002
001150 OBJECT-COMPUTER.    IBM-3090.                                    00340002
001160                                                                  00350002
001170 INPUT-OUTPUT SECTION.                                            00360002
001180 FILE-CONTROL.                                                    00370002
001190     SELECT INTRANSIT-FILE        ASSIGN TO IN01.                 00380002
001192                                                                  00390002
001193******************************************************************00400002
001194 DATA DIVISION.                                                   00410002
001196 FILE SECTION.                                                    00420002
001197                                                                  00430002
001198 FD  INTRANSIT-FILE                                               00440002
001199     RECORDING MODE IS F                                          00450002
001200     LABEL RECORDS ARE STANDARD                                   00460001
001201     BLOCK CONTAINS 0 RECORDS.                                    00470001
164325*01  INTRANSIT-RECORD            PIC X(125).                      00480018
164325 01  INTRANSIT-RECORD            PIC X(200).                      00490018
001203                                                                  00500001
001237******************************************************************00510001
001238 WORKING-STORAGE SECTION.                                         00520001
001239******************************************************************00530001
001240 01  PS-PROGRAM-SWITCHES.                                         00540001
001250     05  PS-END-OF-INTRANSIT-REC     PIC X(01) VALUE 'N'.         00550001
001260         88  PS-END-OF-INTRANSIT-REC-Y         VALUE 'Y'.         00560001
001270         88  PS-END-OF-INTRANSIT-REC-N         VALUE 'N'.         00570001
001400     05  PS-END-OF-MQ-CSR            PIC X(01) VALUE 'N'.         00580001
001500         88  PS-END-OF-MQ-CSR-Y                VALUE 'Y'.         00590001
001600         88  PS-END-OF-MQ-CSR-N                VALUE 'N'.         00600001
002000     05  PS-MQPUT-SUCCESSFUL-IND     PIC X(01) VALUE SPACES.      00610001
002100         88  PS-MQPUT-SUCCESSFUL               VALUE 'Y'.         00620001
002200                                                                  00630001
002300 01  PA-PROGRAM-ACCUMULATORS.                                     00640001
002500     05  PA-TOTAL-MQ-MSGS-SENT       PIC S9(9) VALUE +0 COMP-3.   00650001
002600                                                                  00660001
002700 01  PV-PROGRAM-VARIABLES.                                        00670001
           05  PV-OTBND-TRIP-ID            PIC  S9(09)  VALUE 0 COMP.   00680001
           05  PV-SHIPT-UNT-ID             PIC 9(18)V VALUE 0 COMP.     00690001
003000     05  PV-COUNTER                  PIC 9(05) VALUE ZEROES.      00700001
003200     05  PV-INTRANSIT-SENT-TO-QUE    PIC 9(05) VALUE ZEROES.      00710001
004000     05  PV-MQ-CNT                   PIC 9(05) VALUE ZEROES.      00720001
004100     05  PV-MQ-TBL-CNT               PIC 9(05) VALUE ZEROES.      00730001
004200     05  PV-MQ-HANDLE-CNT            PIC 9(05) VALUE ZEROES.      00740001
004300     05  PV-CNT                      PIC 9(05) VALUE ZEROES.      00750001
004400     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.00760001
004500     05  PV-HOLD-COMPLETION-CODE     PIC S9(9) BINARY.            00770001
004600     05  PV-HOLD-REASON              PIC S9(9) BINARY.            00780001
004700     05  PV-HOLD-PROCESS-TYPE        PIC X(16) VALUE SPACES.      00790001
004800     05  PV-XML-BANNER               PIC X(39) VALUE              00800001
004900         '<?xml version="1.0" encoding="UTF-8" ?>'.               00810001
004800     05  PV-ORDER-TYPE               PIC X(16) VALUE              00820001
004900         'TRAILER_MANIFEST'.                                      00830001
004800     05  PV-DOCUMENT-TYPE            PIC X(04) VALUE              00840001
004900         '0005'.                                                  00850001
004800     05  PV-BUYER-ORG-CODE           PIC X(09) VALUE              00860001
004900         'KOHLS.COM'.                                             00870001
004800     05  PV-PERSON-INFO-BILL-TO      PIC X(02) VALUE 'US'.        00880001
004800     05  PV-VALIDATE-ITEM            PIC X(01) VALUE 'N'.         00890001
004800     05  PV-PRODUCT-CLASS            PIC X(04) VALUE 'Good'.      00900001
004800     05  PV-UNIT-OF-MEASURE          PIC X(04) VALUE 'EACH'.      00910001
           05  PV-LNE-PRICE-ONLY           PIC X(01) VALUE 'Y'.         00920001
           05  PV-COMBINED-TRIP-SHIPT.                                  00930001
067015         10 PV-OTBND-TRIP-ID-CONC    PIC 9(09).                   00940001
               10 FILLER                   PIC X(01) VALUE '-'.         00950001
067015         10 PV-SHIPT-UNT-ID-CONC     PIC 9(18).                   00960001
005300                                                                  00970001
005400 01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.00980001
005500 01  PV-HOLD-MSGBUFFER.                                           00990001
005600     05  PV-MSGBUFFER-CHAR OCCURS   500000 TIMES                  01000003
005700                                     PIC X(01).                   01010001
005800 01  PV-ABEND-VARIABLES.                                          01020001
005900     05  PV-SQLCODE                  PIC S9(9).                   01030001
006000     05  PV-DISPLAY-SQLCODE          PIC -------999.              01040001
006100     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'OFKUT010'.  01050001
006200     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      01060001
006300     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      01070001
006400     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01080001
006500     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01090001
006600     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.01100001
164325     05  PV-TMST-EXP.                                             01110018
164325         10  PV-PTE-DATE             PIC X(10) VALUE SPACES.      01120018
164325         10  FILLER                  PIC X(01) VALUE SPACES.      01130018
164325         10  PV-PTE-TIME.                                         01140018
164325             15  PV-PTE-HH           PIC X(02) VALUE SPACES.      01150018
164325             15  FILLER              PIC X(01) VALUE SPACES.      01160018
164325             15  PV-PTE-MM           PIC X(02) VALUE SPACES.      01170018
164325             15  FILLER              PIC X(01) VALUE SPACES.      01180018
164325             15  PV-PTE-SS           PIC X(02) VALUE SPACES.      01190018
164325         10  FILLER                  PIC X(07) VALUE SPACES.      01200018
164325     05  PV-ORACLE-TMST.                                          01210018
164325         10  PV-POT-DATE             PIC X(10) VALUE SPACES.      01220018
164325         10  FILLER                  PIC X(01) VALUE 'T'.         01230018
164325         10  PV-POT-TIME.                                         01240018
164325             15  PV-POT-HH           PIC X(02) VALUE SPACES.      01250018
164325             15  FILLER              PIC X(01) VALUE ':'.         01260018
164325             15  PV-POT-MM           PIC X(02) VALUE SPACES.      01270018
164325             15  FILLER              PIC X(01) VALUE ':'.         01280018
164325             15  PV-POT-SS           PIC X(02) VALUE SPACES.      01290018
006700                                                                  01300001
003000     05  DK-PO-RCVR-NBR-N                 PIC 9(09) VALUE ZEROES. 01310001
003100     05  DK-PO-RCVR-NBR-X REDEFINES DK-PO-RCVR-NBR-N.             01320001
003200         10  FILLER                       PIC X(01).              01330001
003200         10  DK-RCVR-NBR-X                PIC X(08).              01340001
003300     05  DK-RCVR-NBR-9                    PIC 9(09) VALUE ZEROES. 01350001
003100     05  DK-PO-RCVR-NBR-9X REDEFINES DK-RCVR-NBR-9.               01360001
003400         10  FILLER                       PIC X(06).              01370001
003500         10  DK-RCVR-NBR-3                PIC X(03).              01380001
                                                                        01390001
015700***************************************************************** 01400001
015800*    SAVE AREA FOR DETAIL INFORMATION TO CREATE XML             * 01410001
015900***************************************************************** 01420001
016000 01  PD-ORD-LNE-NBR                  PIC S9(09) COMP.             01430001
016000 01  PD-COUNT                        PIC 9(05)  VALUE 0.          01440001
016100 01  PD-MAX                          PIC 9(08)  VALUE 0.          01450001
016200 01  PD-DETAIL-AREA.                                              01460001
016300     05  PD-DTL-ENTRIES OCCURS 999 TIMES.                         01470001
016400         10  PD-RECV-NODE            PIC S9(4) VALUE ZERO.        01480001
016500         10  PD-SHIP-NODE            PIC S9(4) VALUE ZERO.        01490001
016600         10  PD-QTY                  PIC S9(4) VALUE ZERO.        01500001
016700         10  PD-VAR1                 PIC 9(18)V VALUE 0 COMP.     01510001
016800         10  PD-VAR2                 PIC 9(09) VALUE ZERO.        01520001
016800         10  PD-VAL-ITEM             PIC X(01).                   01530001
               10  PD-TRN-NBR              PIC 9(08) VALUE ZERO.        01540001
               10  PD-RCVR-SEQ-NBR         PIC 9(03) VALUE ZERO.        01550001
016800         10  PD-ITEM-ID              PIC s9(8)V VALUE 0 COMP.     01560001
016800         10  PD-PROD-CLASS           PIC X(04).                   01570001
016800         10  PD-UNT-MEASUR           PIC X(04).                   01580001
      *clp 07/08/2016                                                   01590001
016800         10  PD-LNE-PRICE-ONLY       PIC X(01).                   01600001
016800         10  PD-RETAIL-PRICE         PIC 9(08)V99 VALUE ZERO.     01610001
016800         10  PD-UNIT-PRICE           PIC 9(07)V99 VALUE ZERO.     01620001
                                                                        01630001
006800***************************************************************** 01640001
006900*    RECORD PURPOSE: INTRANSIT Extract (for XML conversion)       01650001
      * The lines in the next 01 level need to start w/capitol and    * 01660001
      * end with lower case for the XML to work.                        01670001
007000***************************************************************** 01680001
007100                                                                  01690001
007200 01  Manifest.                                                    01700001
007730      05  OrderType                    PIC X(16) VALUE SPACES.    01710001
007720      05  DocumentType                 PIC X(04) VALUE SPACES.    01720001
007721      05  BuyerOrganizationCode        PIC X(09) VALUE SPACES.    01730001
007731      05  OrderNo                      PIC X(28) VALUE SPACES.    01740001
            05  OrderDate                    PIC X(19) VALUE SPACES.    01750001
            05  SearchCriteria1              PIC X(09) VALUE SPACES.    01760001
            05  SearchCriteria2              PIC 9(18)V VALUE 0 COMP.   01770001
007200      05  CustomAttributes.                                       01780001
007750          10  Text1                    PIC X(12) VALUE SPACES.    01790001
007770          10  Text2                    PIC 9(09) VALUE ZERO.      01800001
007770          10  Text3                    PIC X(20) VALUE SPACES.    01810001
010030          10  Text4                    PIC X(04) VALUE SPACES.    01820001
164325          10  Text5                    PIC X(03) VALUE SPACES.    01830018
164325          10  Text6                    PIC 9(18) VALUE ZERO.      01840018
164325          10  Text7                    PIC X(26) VALUE SPACES.    01850018
164325          10  Text8                    PIC X(19) VALUE SPACES.    01860018
      *CHG0227744 START                                                 01860123
                10  Text10                   PIC X(03) VALUE SPACES.    01861023
      *CHG0227744 END                                                   01862023
010030      05  PersonInfoBillTo.                                       01870001
010030          10  Country                  PIC X(02) VALUE SPACES.    01880001
                                                                        01890001
007200      05  OrderLines.                                             01900001
                10  OrderLine occurs 0 to 99999 times                   01910001
                             DEPENDING ON PD-COUNT.                     01920001
007730            15  ReceivingNode           PIC S9(4) VALUE ZERO.     01930001
007730            15  ShipNode                PIC S9(4) VALUE ZERO.     01940001
007720            15  OrderedQty              PIC S9(9)V9 VALUE 0 COMP. 01950001
007721            15  ConditionVariable1      PIC 9(18)V VALUE 0 COMP.  01960001
007721            15  ConditionVariable2      PIC X(09) VALUE SPACES.   01970001
007731            15  ValidateItem            PIC X(01) VALUE SPACE.    01980001
007731            15  CustomerPONo            PIC X(08) VALUE SPACES.   01990001
007731            15  CustomerLinePONo        PIC X(03) VALUE SPACES.   02000001
                  15  Item.                                             02010001
      **clp 06/30/2016                                                  02020001
                    20  ItemID                  PIC X(08) VALUE SPACES. 02030001
007750              20  ProductClass            PIC X(04) VALUE SPACES. 02040001
007770              20  UnitOfMeasure           PIC X(04) VALUE SPACES. 02050001
      **clp 07/08/2016                                                  02060001
                  15  LinePriceInfo.                                    02070001
                    20  IsLinePriceForInformationOnly PIC X(01).        02080001
                    20  RetailPrice                   PIC 9(08)V99.     02090001
                    20  UnitPrice                     PIC 9(07)V999.    02100001
                                                                        02110001
010024 01  PV-XML                      PIC X(500000)   VALUE SPACES.    02120001
010050 01  PV-DISPLAY                  PIC X(132)      VALUE SPACES.    02130001
010200 01  XML-LENGTH                  PIC 9(9)    COMP.                02140001
010300                                                                  02150001
010410     COPY ISWS007.                                                02160001
010500     COPY ISWS008.                                                02170001
010600     COPY ISWS009.                                                02180001
010700                                                                  02190001
010800***************************************************************** 02200001
010900* FILE OPEN STATUS'S ON THE CONTROL CARDS USED FOR GETTING        02210001
011000* MQ-SERIES QUEUE MANAGER AND QUEUE NAME.                         02220001
011100***************************************************************** 02230001
012100                                                                  02240001
012200 01  PE-MQ-ABEND-VARIABLES.                                       02250001
012300     05  PE-MQ-QMANAGER              PIC X(05) VALUE SPACES.      02260001
012400     05  PE-MQ-QMANAGER-REMOTE       PIC X(30) VALUE SPACES.      02270001
012500     05  PE-MQ-QNAME                 PIC X(48) VALUE SPACES.      02280001
012600     05  PE-MQ-COMPLETION-CODE       PIC 9(04) VALUE ZEROES.      02290001
012700     05  PE-MQ-REASON-CODE           PIC 9(04) VALUE ZEROES.      02300001
012800                                                                  02310001
012900******************************************************************02320001
013000*  DB2 FORMATTED MESSAGE AREA                                     02330001
013100******************************************************************02340001
013200     COPY DPWS004.                                                02350001
013300                                                                  02360001
013310******************************************************************02370001
013320*  INPUT FILE                                                     02380001
013330******************************************************************02390001
013340     COPY OFRD011.                                                02400001
013350                                                                  02410001
013400******************************************************************02420001
013500*  COMMUNICATIONS AREA FOR DB2                                    02430001
013600******************************************************************02440001
013700     EXEC SQL                                                     02450001
013800          INCLUDE SQLCA                                           02460001
013900     END-EXEC.                                                    02470001
014000                                                                  02480001
017540******************************************************************02490001
017541*  DB2 DECLARATION - WMOS - Provider Queue information (Put/Write)02500001
017542*      TABLE (WSV_PRVDR_QUE)                                      02510001
017543******************************************************************02520001
017544     EXEC SQL                                                     02530001
017545         INCLUDE WSV00005                                         02540001
017546     END-EXEC.                                                    02550001
017547                                                                  02560001
017548******************************************************************02570001
017549* COBOL CURSOR DELCARATION TO READ MQ INFORMATION                *02580001
017550******************************************************************02590001
017560     EXEC SQL                                                     02600001
017570        DECLARE MQ-CSR CURSOR WITH HOLD FOR                       02610001
017580        SELECT A.INTGRTN_TYP_DESC                                 02620001
017590             , A.LCL_QUE_MGR                                      02630001
017600             , A.RMT_QUE_MGR                                      02640001
017700             , A.QUE_NM                                           02650001
017800          FROM WSV_PRVDR_QUE A                                    02660001
017900         WHERE A.APPL_FUNC_DESC    = 'QUEUE'                      02670001
018000           AND A.INTGRTN_TYP_CDE   = 'OMSTRLRMF'                  02680001
018100     END-EXEC.                                                    02690001
018200                                                                  02700001
018300****************************************************************  02710001
018500**     MQ SERIES WORKING STORAGE                                  02720001
018700**         MQ COPYBOOKS                                           02730001
018900****************************************************************  02740001
019000 01  MQM-OBJECT-DESCRIPTOR.                                       02750001
019100     COPY CMQODV.                                                 02760001
019200                                                                  02770001
019300 01  MQM-MESSAGE-DESCRIPTOR.                                      02780001
019400     COPY CMQMDV.                                                 02790001
019500                                                                  02800001
019600 01  MQM-PUT-MESSAGE-OPTIONS.                                     02810001
019700     COPY CMQPMOV.                                                02820001
019800                                                                  02830001
019900 01  MQM-GET-MESSAGE-OPTIONS.                                     02840001
020000     COPY CMQGMOV.                                                02850001
020100                                                                  02860001
020200 01  MQM-CONSTANTS.                                               02870001
020300     COPY CMQV.                                                   02880001
020400                                                                  02890001
020500****************************************************************  02900001
020600** CONTROL CARDS FOR QUEUE MANAGER AND QUEUE NAME                 02910001
020700****************************************************************  02920001
020800 01  CC-CONTROL-CARD-1.                                           02930001
020900     05  CC-QMGR-NAME-REMOTE         PIC X(50).                   02940001
021000                                                                  02950001
021100 01  CC-CONTROL-CARD-2.                                           02960001
021200     05  CC-TRANS-QUEUE-NAME         PIC X(50).                   02970001
021300                                                                  02980001
021700 01  CC-CONTROL-CARD-4.                                           02990001
021800     05  CC-QMGR-NAME                PIC X(50).                   03000001
021900                                                                  03010001
022000****************************************************************  03020001
022100*  MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS GET AND    **  03030001
022200*  OPEN, CONNECT, DISCONNECT.                                     03040001
022300****************************************************************  03050001
022400 01  MQ-WORKING-STORAGE.                                          03060001
022500     05  PC-MQCONN                   PIC X(08) VALUE 'CSQBCONN'.  03070001
022600     05  PC-MQOPEN                   PIC X(08) VALUE 'CSQBOPEN'.  03080001
022700     05  PC-MQINQ                    PIC X(08) VALUE 'CSQBINQ'.   03090001
022800     05  PC-MQPUT                    PIC X(08) VALUE 'CSQBPUT'.   03100001
022900     05  PC-MQGET                    PIC X(08) VALUE 'CSQBGET'.   03110001
023000     05  PC-MQCMIT                   PIC X(08) VALUE 'CSQBCOMM'.  03120001
023100     05  PC-MQBACK                   PIC X(08) VALUE 'CSQBBACK'.  03130001
023200     05  PC-MQCLOSE                  PIC X(08) VALUE 'CSQBCLOS'.  03140001
023300     05  PC-MQDISC                   PIC X(08) VALUE 'CSQBDISC'.  03150001
023400     05  PC-TRANS-QNAME              PIC X(48) VALUE SPACES.      03160001
023500     05  PC-QMGR-NAME                PIC X(04) VALUE SPACES.      03170001
023600         88  PC-PROD-QMGR-NAME                 VALUE 'QKSP'.      03180001
023700         88  PC-ACCEPT-QMGR-NAME               VALUE 'QKSQ'.      03190001
023800         88  PC-TEST-QMGR-NAME                 VALUE 'QKST'.      03200001
023900                                                                  03210001
024000****************************************************************  03220001
024100** QUEUE MANAGER HANDLE                                           03230001
024200*  QUEUE HANDLE                                                   03240001
024300****************************************************************  03250001
024400 01 PV-MQ-PROGRAM-HANDLES.                                        03260001
024500     05  PV-QM-NAME                  PIC X(48).                   03270001
024600     05  PV-QM-NAME-REMOTE           PIC X(48).                   03280001
024700     05  PV-HCONN                    PIC S9(9) BINARY VALUE 0.    03290001
024800     05  PV-PQ-HANDLE                PIC S9(9) BINARY VALUE 0.    03300001
024900                                                                  03310001
025000****************************************************************  03320001
025100* ERROR PROCESSING VARIABLES                                      03330001
025200* CODES FROM CALLS ARE STORED HERE                                03340001
025300****************************************************************  03350001
025400 01 PV-MQ-PROGRAM-VARIABLES.                                      03360001
025500     05  PV-COMPLETION-CODE          PIC S9(9) BINARY.            03370001
025600     05  PV-REASON                   PIC S9(9) BINARY.            03380001
025700     05  PV-CON-REASON               PIC S9(9) BINARY.            03390001
025800     05  PV-MQCHECK                  PIC X(08) VALUE 'MQR2C'.     03400001
025900     05  PV-ERROR-MESSAGE            PIC X(48) VALUE SPACES.      03410001
026000     05  PV-OPEN-OPTIONS             PIC S9(9) BINARY.            03420001
026100     05  PV-MQ-REASON-TEXT           PIC X(30) VALUE SPACES.      03430001
           05  PV-SHIPPED-TMST-OUT         PIC X(19).                   03440001
           05  PV-SHIPPED-TMST-OUT-R       REDEFINES                    03450001
               PV-SHIPPED-TMST-OUT.                                     03460001
               10  PV-SHIPPED-DATE         PIC X(10).                   03470001
               10  PV-T                    PIC X(01).                   03480001
               10  PV-SHIPPED-TIME         PIC X(08).                   03490001
                                                                        03500001
026300     05  PV-SHIPPED-TMST             PIC X(26).                   03510001
026310     05  PV-SHIPPED-TMST-DATE-HHMM   REDEFINES                    03520001
026320         PV-SHIPPED-TMST.                                         03530001
0263MP         10  PV-SHIPPED-CCYY         PIC X(04).                   03540001
026340         10  FILLER                  PIC X(01).                   03550001
026340         10  PV-SHIPPED-MM           PIC X(02).                   03560001
026340         10  FILLER                  PIC X(01).                   03570001
026340         10  PV-SHIPPED-DD           PIC X(02).                   03580001
026340         10  FILLER                  PIC X(01).                   03590001
026340         10  PV-SHIPPED-HH           PIC X(02).                   03600001
026340         10  FILLER                  PIC X(01).                   03610001
026340         10  PV-SHIPPED-MN           PIC X(02).                   03620001
026340         10  FILLER                  PIC X(01).                   03630001
026340         10  PV-SHIPPED-SC           PIC X(02).                   03640001
026340         10  FILLER                  PIC X(07).                   03650001
026400     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.03660001
026500     05  PV-PARAGRAPH                PIC X(48) VALUE SPACES.      03670001
026600     05  PV-MSG-LENGTH               PIC S9(9) BINARY.            03680001
026700     05  PV-DC-NBR                   PIC 9(04).                   03690001
026800     05  PV-MSG-LENGTH-DISPLAY       PIC S9(9).                   03700001
026900     05  PV-MSGBUFFER.                                            03710001
027000         10  PV-MSGBUFFER-banner     PIC X(39) VALUE SPACES.      03720001
027100         10  PV-MSGBUFFER-data       PIC X(999999) VALUE SPACES.  03730001
027200                                                                  03740001
027300 01  PC-PROGRAM-CONSTANTS.                                        03750001
027400     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'OFKUT010'.  03760001
027500     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   03770001
027600     05  PC-READY                    PIC X(06) VALUE 'READY '.    03780001
027700     05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.    03790001
027800     05  PC-WAIT-15-SECS             PIC S9(9) VALUE 1500.        03800001
027900     05  PC-MQPUT-RETRY-COUNTER      PIC 9(3)  VALUE ZERO.        03810001
028000     05  PC-DELAY-INTERVAL.                                       03820001
028100         10  FILLER                  PIC X(2)  VALUE SPACES.      03830001
028200         10  PC-DELAY-TIME           PIC 9(8)  VALUE 3000.        03840001
028300****************************************************************  03850001
028400* RETURN CODES ARE EVALUATED AND THIS SWITCH IS USED TO           03860001
028500* INDICATE ANY ERRORS (THIS SWITCH MAY NOT BE USED SINCE THE      03870001
028600* PROGRAM ABENDS BEFORE IT IS USED ANYWHERE)                      03880001
028700****************************************************************  03890001
028800 01 PV-MQ-PROGRAM-SWITCHES.                                       03900001
028900     05  PS-MQ-ERROR-SW              PIC X(01) VALUE 'N'.         03910001
029000         88  PS-NO-MQ-ERROR                    VALUE 'N'.         03920001
029100         88  PS-MQ-ERROR                       VALUE 'Y'.         03930001
029200 01  PV-MQ-INFO-FOR-DIFF-DCS.                                     03940001
029300     05  MQ-INFO OCCURS 1 TO 20 TIMES                             03950001
029400                      DEPENDING ON PV-MQ-CNT.                     03960001
029500        10 MQ-INTGRTN-TYP-DESC        PIC X(50).                  03970001
029600        10 MQ-QMGR-NAME               PIC X(50).                  03980001
029700        10 MQ-QMGR-NAME-REMOTE        PIC X(50).                  03990001
029800        10 MQ-TRANS-QUEUE-NAME        PIC X(50).                  04000001
030000 01  PV-MQ-HANDLE-FOR-DIFF-DCS.                                   04010001
030100     05  PV-MQ-HANDLE-INFO OCCURS 1 TO 20 TIMES                   04020001
030200                      DEPENDING ON PV-MQ-HANDLE-CNT.              04030001
030300        10 PV-MQ-HANDLE-HOLD  PIC S9(9) BINARY VALUE 0.           04040001
030400                                                                  04050001
030500****************************************************************  04060001
031800 PROCEDURE DIVISION.                                              04070001
031900*                                                                 04080001
032000 0000-MAINLINE.                                                   04090001
032100     DISPLAY '************ START OF OFKUT010 ***************'     04100001
032300                                                                  04110001
032400     PERFORM 1000-INITIALIZE.                                     04120001
032500                                                                  04130001
032600     MOVE ZEROES TO PV-COUNTER                                    04140001
032710                    PV-INTRANSIT-SENT-TO-QUE                      04150001
032800                    PV-MQ-CNT.                                    04160001
032900                                                                  04170001
033000     SET PS-END-OF-INTRANSIT-REC-N                                04180001
033100         PS-END-OF-MQ-CSR-N TO TRUE.                              04190001
033110                                                                  04200001
033111     READ INTRANSIT-FILE INTO OF011-EXTRACT-RECORD                04210001
033112          AT END SET PS-END-OF-INTRANSIT-REC-Y TO TRUE.           04220001
                                                                        04230001
033200     PERFORM 1100-SET-FIRST-TRIP.                                 04240001
                                                                        04250001
033300     PERFORM 2000-PROCESS-INTRANSIT-RECORDS                       04260001
033400       UNTIL PS-END-OF-INTRANSIT-REC-Y.                           04270001
033500                                                                  04280001
033800*CLOSE THE MULTIPLE OPEN QUEUES.                                  04290001
033900     PERFORM 1500-MQ-QUEUE-CLOSE.                                 04300001
034000                                                                  04310001
034100*DISCONNECT FROM THE QMGR.                                        04320001
034200     PERFORM 1600-DISCONNECT-QMGR.                                04330001
034300                                                                  04340001
034400* END OF JOB ROUTINE.                                             04350001
034500     PERFORM 9000-EOJ-ROUTINE.                                    04360001
034600                                                                  04370001
034700     DISPLAY '************  END OF OFKUT010  ***************'     04380001
034800     STOP RUN.                                                    04390001
034900                                                                  04400001
035000******************************************************************04410001
035200*           INITIALIZATION                                        04420001
035400******************************************************************04430001
035500 1000-INITIALIZE.                                                 04440001
035900                                                                  04450001
036000*READ MQ CONTROL CARDS.                                           04460001
036001                                                                  04470001
036100     PERFORM 1200-GET-MQ-QUEUE-INFO.                              04480001
036160     MOVE WSV00005-INTGRTN-TYP-DESC                               04490001
036170            TO MQ-INTGRTN-TYP-DESC(PV-MQ-CNT).                    04500001
036180     MOVE CC-QMGR-NAME                                            04510001
036190            TO MQ-QMGR-NAME(PV-MQ-CNT).                           04520001
036191     MOVE CC-QMGR-NAME-REMOTE                                     04530001
036192            TO MQ-QMGR-NAME-REMOTE(PV-MQ-CNT).                    04540001
036193     MOVE CC-TRANS-QUEUE-NAME                                     04550001
036194            TO MQ-TRANS-QUEUE-NAME(PV-MQ-CNT).                    04560001
036200                                                                  04570001
036300*CONNECT TO QUEUE MANAGER ONLY ONCE.                              04580001
036400                                                                  04590001
036500     PERFORM 1300-MQ-CONNECT-TO-QMGR.                             04600001
036600                                                                  04610001
036700*OPEN THE MULTIPLE QUEUES FOR PUTS                                04620001
036800                                                                  04630001
036900     PERFORM 1400-MQ-QUEUE-OPEN.                                  04640001
037000                                                                  04650001
037400     OPEN  INPUT INTRANSIT-FILE.                                  04660001
037700                                                                  04670001
       1100-SET-FIRST-TRIP.                                             04680001
                                                                        04690001
065600     MOVE OF011-OTBND-TRIP-ID TO PV-OTBND-TRIP-ID.                04700001
065600     MOVE OF011-SHIPT-UNT-ID  TO PV-SHIPT-UNT-ID.                 04710001
065600     PERFORM 2050-MOVE-HEADER.                                    04720001
                                                                        04730001
           MOVE 0 TO PD-COUNT.                                          04740001
           MOVE 0 TO PD-ORD-LNE-NBR.                                    04750001
                                                                        04760001
039800****************************************************************  04770001
039900* GET MQ INFORMATION FROM DB2 TABLES.                             04780001
040000****************************************************************  04790001
040100 1200-GET-MQ-QUEUE-INFO.                                          04800001
040200                                                                  04810001
040300     PERFORM 1210-OPEN-MQ-CSR.                                    04820001
040400                                                                  04830001
040500     PERFORM 1220-FETCH-MQ-CURSOR UNTIL                           04840001
040600           PS-END-OF-MQ-CSR-Y.                                    04850001
040700                                                                  04860001
040800     PERFORM 1225-CLOSE-MQ-CURSOR.                                04870001
040900                                                                  04880001
041000****************************************************************  04890001
041100* OPEN MQ CURSOR.                                                 04900001
041200****************************************************************  04910001
041300 1210-OPEN-MQ-CSR.                                                04920001
041400                                                                  04930001
041500     EXEC SQL                                                     04940001
041600         OPEN MQ-CSR                                              04950001
041700     END-EXEC.                                                    04960001
041800                                                                  04970001
041900     EVALUATE TRUE                                                04980001
042000       WHEN SQLCODE = ZERO                                        04990001
042100           SET PS-END-OF-MQ-CSR-N TO TRUE                         05000001
042200                                                                  05010001
042300       WHEN OTHER                                                 05020001
042400           MOVE '1210-OPEN-MQ-CURSOR' TO PV-ABEND-PARAGRAPH       05030001
042500           MOVE 'OPEN MQ-CSR'         TO PV-ABEND-OPERATION       05040001
042600           PERFORM 9900-DB2-ABEND                                 05050001
042700     END-EVALUATE.                                                05060001
042800                                                                  05070001
042900****************************************************************  05080001
043000* FETCH MQ INFORMATION FOR PUTS.                                  05090001
043100****************************************************************  05100001
043200 1220-FETCH-MQ-CURSOR.                                            05110001
043400                                                                  05120001
043500     EXEC SQL                                                     05130001
043600         FETCH MQ-CSR                                             05140001
043700          INTO                                                    05150001
043800              :WSV00005-INTGRTN-TYP-DESC                          05160001
043900             ,:CC-QMGR-NAME                                       05170001
044000             ,:CC-QMGR-NAME-REMOTE                                05180001
044100             ,:CC-TRANS-QUEUE-NAME                                05190001
044200     END-EXEC.                                                    05200001
044300                                                                  05210001
044400     EVALUATE TRUE                                                05220001
044500       WHEN SQLCODE = ZERO                                        05230001
044600                                                                  05240001
044700           DISPLAY 'QMGR-NAME-REMOTE:' CC-QMGR-NAME-REMOTE        05250001
044800           DISPLAY 'TRANS-QUEUE-NAME:' CC-TRANS-QUEUE-NAME        05260001
044900                                                                  05270001
045000           ADD 1 TO PV-MQ-CNT                                     05280001
045100                                                                  05290001
045200                                                                  05300001
045300           MOVE WSV00005-INTGRTN-TYP-DESC                         05310001
045400                  TO MQ-INTGRTN-TYP-DESC(PV-MQ-CNT)               05320001
045500           MOVE CC-QMGR-NAME                                      05330001
045600                  TO MQ-QMGR-NAME(PV-MQ-CNT)                      05340001
045700           MOVE CC-QMGR-NAME-REMOTE                               05350001
045800                  TO MQ-QMGR-NAME-REMOTE(PV-MQ-CNT)               05360001
045900           MOVE CC-TRANS-QUEUE-NAME                               05370001
046000                  TO MQ-TRANS-QUEUE-NAME(PV-MQ-CNT)               05380001
046300                                                                  05390001
046400       WHEN SQLCODE = +100                                        05400001
046500           SET PS-END-OF-MQ-CSR-Y TO TRUE                         05410001
046600                                                                  05420001
046700       WHEN OTHER                                                 05430001
046800           MOVE '1220-FETCH-MQ-CURSOR' TO PV-ABEND-PARAGRAPH      05440001
046900           MOVE 'FETCH MQ-CSR'         TO PV-ABEND-OPERATION      05450001
047000           PERFORM 9900-DB2-ABEND                                 05460001
047100     END-EVALUATE.                                                05470001
047200                                                                  05480001
047300******************************************************************05490001
047400 1225-CLOSE-MQ-CURSOR.                                            05500001
047500                                                                  05510001
047600     EXEC SQL                                                     05520001
047700         CLOSE MQ-CSR                                             05530001
047800     END-EXEC.                                                    05540001
047900                                                                  05550001
048000     EVALUATE TRUE                                                05560001
048100       WHEN SQLCODE = ZERO                                        05570001
048200       DISPLAY ' TOTAL MQ PUTS:' PV-MQ-CNT                        05580001
048300           CONTINUE                                               05590001
048400                                                                  05600001
048500       WHEN OTHER                                                 05610001
048600           MOVE '1225-CLOSE-MQ-CURSOR' TO PV-ABEND-PARAGRAPH      05620001
048700           MOVE 'CLOSE MQ-CSR'         TO PV-ABEND-OPERATION      05630001
048800           PERFORM 9900-DB2-ABEND                                 05640001
048900     END-EVALUATE.                                                05650001
049000                                                                  05660001
049100****************************************************************  05670001
049200** CONNECT TO THE MULTIPLE QUEUE MANAGERS.                        05680001
049300** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                 05690001
049400****************************************************************  05700001
049500 1300-MQ-CONNECT-TO-QMGR.                                         05710001
049700                                                                  05720001
049800     MOVE '1300-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.              05730001
049900     MOVE 1 TO PV-MQ-TBL-CNT.                                     05740001
050100                                                                  05750001
050200     MOVE MQ-QMGR-NAME(PV-MQ-TBL-CNT) TO PV-QM-NAME.              05760001
050300                                                                  05770001
050400     CALL PC-MQCONN USING PV-QM-NAME                              05780001
050500                          PV-HCONN                                05790001
050600                          PV-COMPLETION-CODE                      05800001
050700                          PV-REASON.                              05810001
050800                                                                  05820001
051200     MOVE PV-REASON TO PV-CON-REASON.                             05830001
051300     IF PV-COMPLETION-CODE = MQCC-OK                              05840001
051400        ADD 1 TO PV-MQ-TBL-CNT                                    05850001
051500        DISPLAY 'CONNECTED TO QM -' MQ-QMGR-NAME(PV-MQ-TBL-CNT)   05860001
051600         CONTINUE                                                 05870001
051700     ELSE                                                         05880001
051800         CALL PV-MQCHECK USING PV-REASON                          05890001
051900                               PV-MQ-REASON-TEXT                  05900001
052000         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              05910001
052100         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       05920001
052200         MOVE PV-REASON            TO PE-MQ-REASON-CODE           05930001
052300         MOVE '1300-MQ-CONNECT-TO-QMGR'                           05940001
052400                                   TO PV-ERROR-MESSAGE            05950001
052500         PERFORM 9200-MQ-ABEND                                    05960001
052600     END-IF.                                                      05970001
052700                                                                  05980001
052800****************************************************************  05990001
052900** OPEN MULTIPLE QUEUES FOR 'PUT'                                 06000001
053000****************************************************************  06010001
053100 1400-MQ-QUEUE-OPEN.                                              06020001
053200                                                                  06030001
053300     MOVE 1 TO PV-MQ-TBL-CNT.                                     06040001
053400     PERFORM 1410-MULTI-MQ-OPEN PV-MQ-CNT TIMES.                  06050001
053500                                                                  06060001
053600****************************************************************  06070001
053700** OPEN MULTIPLE QUEUES FOR 'PUT'                                 06080001
053800****************************************************************  06090001
053900 1410-MULTI-MQ-OPEN.                                              06100001
054000                                                                  06110001
054100     MOVE '1410-MUTI-MQ-OPEN' TO PV-PARAGRAPH.                    06120001
054200                                                                  06130001
054300* CONTROL CARD 2 - QUEUE NAME                                     06140001
054400     MOVE MQ-TRANS-QUEUE-NAME(PV-MQ-TBL-CNT)  TO PC-TRANS-QNAME.  06150001
054500     COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT                        06160001
054600                             + MQOO-SET-IDENTITY-CONTEXT          06170001
054700                             + MQOO-FAIL-IF-QUIESCING.            06180001
054800     MOVE PC-TRANS-QNAME       TO MQOD-OBJECTNAME.                06190001
054900                                                                  06200001
055000     DISPLAY 'PC-TRANS-QNAME:' PC-TRANS-QNAME                     06210001
055100     DISPLAY 'MQOD-OBJECTNAME:' MQOD-OBJECTNAME                   06220001
055200                                                                  06230001
055300* CONTROL CARD 3 - REMOTE QMGR NAME                               06240001
055400     MOVE MQ-QMGR-NAME-REMOTE(PV-MQ-TBL-CNT)                      06250001
055500                          TO MQOD-OBJECTQMGRNAME.                 06260001
055600                                                                  06270001
055700******************************************************************06280001
055800*REPLACE REMOTE QMGR NAME WITH LOCAL QMGR NAME TO WRITE TO LOCAL Q06290001
055900******************************************************************06300001
056300                                                                  06310001
056400     DISPLAY 'MQOD-OBJECTQMGRNAME:' MQOD-OBJECTQMGRNAME           06320001
056500     DISPLAY 'MQOD-OBJECTNAME    :' MQOD-OBJECTNAME               06330001
056600     DISPLAY 'PV-HCONN:' PV-HCONN                                 06340001
056700     DISPLAY 'MQM-OBJECT-DESCRIPTOR:' MQM-OBJECT-DESCRIPTOR       06350001
056800     DISPLAY 'PV-OPEN-OPTIONS:' PV-OPEN-OPTIONS                   06360001
056900     DISPLAY 'PV-PQ-HANDLE:' PV-PQ-HANDLE                         06370001
057000                                                                  06380001
057100     CALL PC-MQOPEN USING PV-HCONN                                06390001
057200                          MQM-OBJECT-DESCRIPTOR                   06400001
057300                          PV-OPEN-OPTIONS                         06410001
057400                          PV-PQ-HANDLE                            06420001
057500                          PV-COMPLETION-CODE                      06430001
057600                          PV-REASON.                              06440001
057700                                                                  06450001
057800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06460001
057900         ADD 1 TO PV-MQ-TBL-CNT                                   06470001
058000                  PV-MQ-HANDLE-CNT                                06480001
058100         MOVE  PV-PQ-HANDLE TO PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)06490001
058200         DISPLAY 'OPEN COMPLETE'                                  06500001
058300         CONTINUE                                                 06510001
058400     ELSE                                                         06520001
058500         CALL PV-MQCHECK USING PV-REASON                          06530001
058600                               PV-MQ-REASON-TEXT                  06540001
058700         MOVE PV-QM-NAME-REMOTE    TO PE-MQ-QMANAGER-REMOTE       06550001
058800         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 06560001
058900         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       06570001
059000         MOVE PV-REASON            TO PE-MQ-REASON-CODE           06580001
059100         MOVE '1410-MULTI-MQ-OPEN' TO PV-ERROR-MESSAGE            06590001
059200         PERFORM 9200-MQ-ABEND                                    06600001
059300     END-IF.                                                      06610001
059400                                                                  06620001
059500****************************************************************  06630001
059600** CLOSES THE MQ QUEUE.                                           06640001
059700****************************************************************  06650001
059800 1500-MQ-QUEUE-CLOSE.                                             06660001
059900                                                                  06670001
060000     MOVE 1 TO PV-MQ-HANDLE-CNT.                                  06680001
060100     PERFORM 1510-MQ-MULTI-QUEUE-CLOSE PV-MQ-CNT TIMES.           06690001
060200                                                                  06700001
060300 1510-MQ-MULTI-QUEUE-CLOSE.                                       06710001
060400                                                                  06720001
060500     MOVE '1510-MQ-MULTI-QUEUE-CLOSE' TO PV-PARAGRAPH.            06730001
060600                                                                  06740001
060700     CALL PC-MQCLOSE USING PV-HCONN                               06750001
060800                           PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)    06760001
060900                           MQCO-NONE                              06770001
061000                           PV-COMPLETION-CODE                     06780001
061100                           PV-REASON.                             06790001
061200                                                                  06800001
061300     IF PV-COMPLETION-CODE = MQCC-OK                              06810001
061400         CONTINUE                                                 06820001
061500     ELSE                                                         06830001
061600         CALL PV-MQCHECK USING PV-REASON                          06840001
061700                               PV-MQ-REASON-TEXT                  06850001
061800         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              06860001
061900         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 06870001
062000         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       06880001
062100         MOVE PV-REASON            TO PE-MQ-REASON-CODE           06890001
062200         MOVE 'MQ-CLOSE'           TO PV-ERROR-MESSAGE            06900001
062300         PERFORM 9200-MQ-ABEND                                    06910001
062400     END-IF.                                                      06920001
062500                                                                  06930001
062600****************************************************************  06940001
062700** DISCONNECT FROM THE QUEUE MANAGER                              06950001
062800****************************************************************  06960001
062900 1600-DISCONNECT-QMGR.                                            06970001
063000     MOVE '1600-DISCONNECT-QMGR' TO PV-PARAGRAPH.                 06980001
063100                                                                  06990001
063200     CALL PC-MQDISC USING PV-HCONN                                07000001
063300                          PV-COMPLETION-CODE                      07010001
063400                          PV-REASON                               07020001
063500                                                                  07030001
063600     IF PV-COMPLETION-CODE = MQCC-OK                              07040001
063700        CONTINUE                                                  07050001
063800     ELSE                                                         07060001
063900        CALL PV-MQCHECK USING PV-REASON                           07070001
064000                              PV-MQ-REASON-TEXT                   07080001
064100        MOVE PV-QM-NAME             TO PE-MQ-QMANAGER             07090001
064200        MOVE PC-TRANS-QNAME         TO PE-MQ-QNAME                07100001
064300        MOVE PV-COMPLETION-CODE     TO PE-MQ-COMPLETION-CODE      07110001
064400        MOVE PV-REASON              TO PE-MQ-REASON-CODE          07120001
064500        MOVE '1600-DISCONNECT-QMGR' TO PV-ERROR-MESSAGE           07130001
064600        PERFORM 9200-MQ-ABEND                                     07140001
064700     END-IF.                                                      07150001
064800                                                                  07160001
064900******************************************************************07170001
065100*     PROCESS RDC INVENTORY ADJUSTMENTS                           07180001
065300******************************************************************07190001
065500 2000-PROCESS-INTRANSIT-RECORDS.                                  07200001
                                                                        07210001
065700     PERFORM 2020-FORMAT-OUTPUT.                                  07220001
065800                                                                  07230001
065900     READ INTRANSIT-FILE INTO OF011-EXTRACT-RECORD                07240001
066000          AT END SET PS-END-OF-INTRANSIT-REC-Y TO TRUE.           07250001
066100     ADD +1 TO PV-COUNTER.                                        07260001
           IF PS-END-OF-INTRANSIT-REC-Y                                 07270001
      *        LAST TRIP                                                07280001
               MOVE PD-COUNT TO PD-MAX                                  07290001
               MOVE 0 TO PD-ORD-LNE-NBR                                 07300001
                         PD-COUNT                                       07310001
               PERFORM 3100-MOVE-DETAIL VARYING PD-ORD-LNE-NBR          07320001
                               FROM 1 BY 1 UNTIL PD-ORD-LNE-NBR >       07330001
                                                 PD-MAX                 07340001
077200         PERFORM 4000-CREATE-MSGS                                 07350001
           END-IF.                                                      07360001
066120                                                                  07370001
066200******************************************************************07380001
066300* BUILD MQ OUTPUT                                                 07390001
066400******************************************************************07400001
066500 2020-FORMAT-OUTPUT.                                              07410001
066600                                                                  07420001
                                                                        07430001
           IF OF011-OTBND-TRIP-ID = PV-OTBND-TRIP-ID                    07440001
              IF OF011-SHIPT-UNT-ID  = PV-SHIPT-UNT-ID                  07450001
067000            PERFORM 3000-BUILD-WS-DETAIL                          07460001
              ELSE                                                      07470001
      *           NEW CARTON                                            07480001
                  MOVE PD-COUNT TO PD-MAX                               07490001
                  MOVE 0 TO PD-ORD-LNE-NBR                              07500001
                            PD-COUNT                                    07510001
                  PERFORM 3100-MOVE-DETAIL VARYING PD-ORD-LNE-NBR       07520001
                                  FROM 1 BY 1 UNTIL PD-ORD-LNE-NBR >    07530001
                                                    PD-MAX              07540001
077200            PERFORM 4000-CREATE-MSGS                              07550001
                  MOVE OF011-OTBND-TRIP-ID TO PV-OTBND-TRIP-ID          07560001
                  MOVE OF011-SHIPT-UNT-ID  TO PV-SHIPT-UNT-ID           07570001
065600            PERFORM 2050-MOVE-HEADER                              07580001
                  MOVE 0 TO PD-COUNT                                    07590001
                            PD-MAX                                      07600001
                            PD-ORD-LNE-NBR                              07610001
067000            PERFORM 3000-BUILD-WS-DETAIL                          07620001
              END-IF                                                    07630001
           ELSE                                                         07640001
      *        NEW TRIP                                                 07650001
               MOVE PD-COUNT TO PD-MAX                                  07660001
               MOVE 0 TO PD-ORD-LNE-NBR                                 07670001
                         PD-COUNT                                       07680001
               PERFORM 3100-MOVE-DETAIL VARYING PD-ORD-LNE-NBR          07690001
                               FROM 1 BY 1 UNTIL PD-ORD-LNE-NBR >       07700001
                                                 PD-MAX                 07710001
077200         PERFORM 4000-CREATE-MSGS                                 07720001
               MOVE OF011-OTBND-TRIP-ID TO PV-OTBND-TRIP-ID             07730001
               MOVE OF011-SHIPT-UNT-ID  TO PV-SHIPT-UNT-ID              07740001
065600         PERFORM 2050-MOVE-HEADER                                 07750001
               MOVE 0 TO PD-COUNT                                       07760001
                         PD-MAX                                         07770001
                         PD-ORD-LNE-NBR                                 07780001
067000         PERFORM 3000-BUILD-WS-DETAIL                             07790001
           END-IF.                                                      07800001
                                                                        07810001
077350                                                                  07820001
066200******************************************************************07830001
066300* BUILD HEADER                                                    07840001
066400******************************************************************07850001
       2050-MOVE-HEADER.                                                07860001
                                                                        07870001
067011     MOVE PV-ORDER-TYPE           TO OrderType                    07880001
           MOVE PV-DOCUMENT-TYPE        TO DocumentType.                07890001
067015     MOVE PV-BUYER-ORG-CODE       TO BuyerOrganizationCode.       07900001
067015     MOVE OF011-OTBND-TRIP-ID     TO PV-OTBND-TRIP-ID-CONC        07910001
067015                                     SearchCriteria1.             07920001
067015     MOVE OF011-SHIPT-UNT-ID      TO PV-SHIPT-UNT-ID-CONC         07930001
067015                                     SearchCriteria2.             07940001
067015     MOVE PV-COMBINED-TRIP-SHIPT  TO OrderNo.                     07950001
                                                                        07960001
           INITIALIZE PV-SHIPPED-TMST-OUT.                              07970001
           MOVE OF011-SHIPPED-TMST    TO PV-SHIPPED-TMST.               07980001
           MOVE PV-SHIPPED-TMST(1:10) TO PV-SHIPPED-DATE.               07990001
           MOVE PV-SHIPPED-HH         TO PV-SHIPPED-TIME(1:2).          08000001
           MOVE ':'                   TO PV-SHIPPED-TIME(3:1)           08010001
                                         PV-SHIPPED-TIME(6:1).          08020001
           MOVE 'T'                   TO PV-T.                          08030001
           MOVE PV-SHIPPED-MN         TO PV-SHIPPED-TIME(4:2).          08040001
           MOVE PV-SHIPPED-SC         TO PV-SHIPPED-TIME(7:2).          08050001
067015     MOVE PV-SHIPPED-TMST-OUT     TO OrderDate.                   08060001
067015     MOVE OF011-TRLR-ID           TO Text1.                       08070001
067015     MOVE OF011-TRLR-SRL-NBR      TO Text2.                       08080001
067015     MOVE OF011-TRLR-SEAL-ID      TO Text3.                       08090001
067015     MOVE OF011-SHIP-SCAC-CDE     TO Text4.                       08100001
164325     MOVE OF011-SML-TYPE          TO Text5.                       08110018
164325     MOVE OF011-MSTR-UNT-ID       TO Text6.                       08120018
164325                                                                  08130018
164325     MOVE OF011-TMST-ON-TRLR      TO PV-TMST-EXP.                 08140018
164325     MOVE PV-PTE-DATE             TO PV-POT-DATE.                 08150018
164325     MOVE PV-PTE-HH               TO PV-POT-HH.                   08160018
164325     MOVE PV-PTE-MM               TO PV-POT-MM.                   08170018
164325     MOVE PV-PTE-SS               TO PV-POT-SS.                   08180018
164325     MOVE PV-ORACLE-TMST          TO Text7.                       08190018
164325                                                                  08200018
164325     MOVE OF011-TM-AT-DC          TO PV-PTE-TIME.                 08210018
164325     MOVE PV-PTE-HH               TO PV-POT-HH.                   08220018
164325     MOVE PV-PTE-MM               TO PV-POT-MM.                   08230018
164325     MOVE PV-PTE-SS               TO PV-POT-SS.                   08240018
164325     MOVE OF011-DTE-AT-DC         TO PV-POT-DATE.                 08250018
164325     MOVE PV-ORACLE-TMST          TO Text8.                       08260018
      *CHG0227744 START                                                 08260123
           IF OF011-OPC-SET-IND = 'Y'                                   08261019
              MOVE 'OPC'                TO Text10                       08262019
           ELSE                                                         08263019
              MOVE SPACES               TO Text10                       08264019
           END-IF.                                                      08265019
      *CHG0227744 END                                                   08266023
004800     MOVE PV-PERSON-INFO-BILL-TO  TO Country.                     08270001
076900                                                                  08280001
082300                                                                  08290001
       3000-BUILD-WS-DETAIL.                                            08300001
           ADD 1 TO PD-ORD-LNE-NBR                                      08310001
                    PD-COUNT.                                           08320001
067001     MOVE OF011-DEST-LOC-NBR     TO PD-RECV-NODE(PD-ORD-LNE-NBR). 08330001
067001     MOVE OF011-ORGN-OPER-UNT-ID TO PD-SHIP-NODE(PD-ORD-LNE-NBR). 08340001
067010     MOVE OF011-SHPD-UNT-QTY     TO PD-QTY(PD-ORD-LNE-NBR).       08350001
067011     MOVE OF011-SHIPT-UNT-ID     TO PD-VAR1(PD-ORD-LNE-NBR).      08360001
067011     MOVE OF011-OTBND-TRIP-ID    TO PD-VAR2(PD-ORD-LNE-NBR).      08370001
           MOVE PV-VALIDATE-ITEM       TO PD-VAL-ITEM(PD-ORD-LNE-NBR).  08380001
           MOVE OF011-TRN-NBR          TO DK-PO-RCVR-NBR-N.             08390001
           MOVE DK-RCVR-NBR-X          TO PD-TRN-NBR(PD-ORD-LNE-NBR).   08400001
           MOVE OF011-RCVR-SEQ-NBR     TO DK-RCVR-NBR-9.                08410001
           MOVE DK-RCVR-NBR-3        TO PD-RCVR-SEQ-NBR(PD-ORD-LNE-NBR).08420001
067015     MOVE OF011-SKU-NBR          TO PD-ITEM-ID(PD-ORD-LNE-NBR).   08430001
067015     MOVE PV-PRODUCT-CLASS       TO PD-PROD-CLASS(PD-ORD-LNE-NBR).08440001
067015     MOVE PV-UNIT-OF-MEASURE     TO PD-UNT-MEASUR(PD-ORD-LNE-NBR).08450001
067015     MOVE PV-LNE-PRICE-ONLY      TO                               08460001
067015                         PD-LNE-PRICE-ONLY(PD-ORD-LNE-NBR).       08470001
067015     MOVE OF011-UNIT-RETAIL      TO                               08480001
067015                         PD-RETAIL-PRICE(PD-ORD-LNE-NBR).         08490001
067015     MOVE OF011-COST-AMT         TO                               08500001
067015                         PD-UNIT-PRICE(PD-ORD-LNE-NBR).           08510001
                                                                        08520001
       3100-MOVE-DETAIL.                                                08530001
           ADD 1 TO PD-COUNT.                                           08540001
                                                                        08550001
067001     MOVE PD-RECV-NODE(PD-ORD-LNE-NBR)        TO                  08560001
067001          ReceivingNode(PD-COUNT).                                08570001
067001     MOVE PD-SHIP-NODE(PD-ORD-LNE-NBR)        TO                  08580001
067001          ShipNode(PD-COUNT).                                     08590001
067010     MOVE PD-QTY(PD-ORD-LNE-NBR)              TO                  08600001
067010          OrderedQty(PD-COUNT).                                   08610001
067011     MOVE PD-VAR1(PD-ORD-LNE-NBR)             TO                  08620001
067011          ConditionVariable1(PD-COUNT).                           08630001
067011     MOVE PD-VAR2(PD-ORD-LNE-NBR)             TO                  08640001
067011          ConditionVariable2(PD-COUNT).                           08650001
           MOVE PD-VAL-ITEM(PD-ORD-LNE-NBR)         TO                  08660001
                ValidateItem(PD-COUNT).                                 08670001
           MOVE PD-TRN-NBR(PD-ORD-LNE-NBR)         TO                   08680001
                CustomerPONo(PD-COUNT).                                 08690001
           MOVE PD-RCVR-SEQ-NBR(PD-ORD-LNE-NBR)     TO                  08700001
                CustomerLinePONo(PD-COUNT).                             08710001
067015     MOVE PD-ITEM-ID(PD-ORD-LNE-NBR)          TO                  08720001
067015          ItemID(PD-COUNT).                                       08730001
067015     MOVE PD-PROD-CLASS(PD-ORD-LNE-NBR)       TO                  08740001
067015          ProductClass(PD-COUNT).                                 08750001
067015     MOVE PD-UNT-MEASUR(PD-ORD-LNE-NBR)       TO                  08760001
067015          UnitofMeasure(PD-COUNT).                                08770001
      *CLP 07/08/2016                                                   08780001
067015     MOVE PD-LNE-PRICE-ONLY(PD-ORD-LNE-NBR)   TO                  08790001
067015          IsLinePriceForInformationOnly(PD-COUNT).                08800001
067015     MOVE PD-RETAIL-PRICE(PD-ORD-LNE-NBR)     TO                  08810001
                RetailPrice(PD-COUNT).                                  08820001
067015     MOVE PD-UNIT-PRICE(PD-ORD-LNE-NBR)       TO                  08830001
                UnitPrice(PD-COUNT).                                    08840001
076900                                                                  08850001
082400****************************************************************  08860001
082500* CREATE XML FOR RDC AND OUTPUT TO MQ                             08870001
082600****************************************************************  08880001
094233 4000-CREATE-MSGS.                                                08890001
094234                                                                  08900001
094235     PERFORM 4100-GENERATE-XML.                                   08910001
094236     ADD +1 TO PV-INTRANSIT-SENT-TO-QUE.                          08920001
094237                                                                  08930001
094238     MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.      08940001
094239     MOVE PV-XML(1:XML-LENGTH)       TO PV-MSGBUFFER-data.        08950001
      *****display pv-msgbuffer-banner.                                 08960022
      *****display pv-msgbuffer-data.                                   08970022
      *****display 'XML-LENGTH'  XML-LENGTH                             08980022
094240     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           08990001
094241                           + LENGTH OF PV-XML-BANNER.             09000001
      *****DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    09010018
094242     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 09020001
094260     INITIALIZE PS-MQPUT-SUCCESSFUL-IND                           09030001
094270                PC-MQPUT-RETRY-COUNTER.                           09040001
                                                                        09050001
094280     PERFORM 5000-MQ-PUT-TO-QUEUE                                 09060001
094290       UNTIL PS-MQPUT-SUCCESSFUL.                                 09070001
094300                                                                  09080001
094310     IF PV-INTRANSIT-SENT-TO-QUE = 5000                           09090001
094400         PERFORM 5100-MQ-COMMIT                                   09100001
094410         MOVE ZEROS TO PV-INTRANSIT-SENT-TO-QUE                   09110001
094420     END-IF.                                                      09120001
094500                                                                  09130001
094500                                                                  09140001
094500                                                                  09150001
094600**********************************Manifest*********************   09160001
094700 4100-GENERATE-XML.                                               09170001
094800                                                                  09180001
094900     MOVE SPACES TO PV-XML.                                       09190001
095100     XML GENERATE PV-XML                                          09200001
095200         FROM Manifest                                            09210001
095320         COUNT IN XML-LENGTH                                      09220001
095330         WITH ATTRIBUTES                                          09230001
095400         ON EXCEPTION                                             09240001
095410             DISPLAY Manifest ' PV=' PV-XML                       09250001
095500             PERFORM 4110-XML-ERROR                               09260001
095600         NOT ON EXCEPTION                                         09270001
095700             CONTINUE                                             09280001
095900     END-XML.                                                     09290001
096000                                                                  09300001
096100***************************************************************   09310001
096200 4110-XML-ERROR.                                                  09320001
096300                                                                  09330001
096400     PERFORM 9000-EXPLAIN-XML-RESPONSE                            09340001
096500     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    09350001
096600                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           09360001
096800     END-PERFORM.                                                 09370001
096900     MOVE +4018         TO ABEND-CODE.                            09380001
097000     CALL 'ILBOABN0' USING ABEND-CODE.                            09390001
098700                                                                  09400001
098800     COPY ISPD007.                                                09410001
098900     COPY ISPD008.                                                09420001
099000     COPY ISPD009.                                                09430001
099100                                                                  09440001
100000******************************************************************09450001
100200*      PUT MQ MESSAGE                                             09460001
100400******************************************************************09470001
100500 5000-MQ-PUT-TO-QUEUE.                                            09480001
100600                                                                  09490001
100700     MOVE ZEROES TO PV-CNT.                                       09500001
100800     PERFORM 5100-MQ-MULTI-PUTS PV-MQ-HANDLE-CNT TIMES.           09510001
100900                                                                  09520001
101000 5100-MQ-MULTI-PUTS.                                              09530001
101100                                                                  09540001
101200     ADD 1 TO PV-CNT.                                             09550001
101300     MOVE MQMI-NONE    TO MQMD-MSGID.                             09560001
101400     MOVE MQCI-NONE    TO MQMD-CORRELID.                          09570001
101500     MOVE MQFMT-STRING TO MQMD-FORMAT.                            09580001
101600                                                                  09590001
101800     COMPUTE MQPMO-OPTIONS  = MQPMO-SYNCPOINT                     09600001
101900                            + MQPMO-SET-IDENTITY-CONTEXT.         09610001
102000     PERFORM 5010-LOW-VALUES.                                     09620001
102100                                                                  09630001
102400     CALL PC-MQPUT USING PV-HCONN                                 09640001
102500                         PV-MQ-HANDLE-HOLD(PV-CNT)                09650001
102600                         MQM-MESSAGE-DESCRIPTOR                   09660001
102700                         MQM-PUT-MESSAGE-OPTIONS                  09670001
102800                         PV-MSG-LENGTH                            09680001
102900                         PV-MSGBUFFER                             09690001
103000                         PV-COMPLETION-CODE                       09700001
103100                         PV-REASON.                               09710001
103200                                                                  09720001
103300*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         09730001
103400     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        09740001
103500         IF (PV-REASON NOT = MQRC-PAGESET-FULL                    09750001
103600           AND PV-REASON NOT = MQRC-Q-FULL                        09760001
103700           AND PV-REASON NOT = MQRC-Q-SPACE-NOT-AVAILABLE )       09770001
103800             CALL PV-MQCHECK USING PV-REASON                      09780001
103900                                   PV-MQ-REASON-TEXT              09790001
104000             DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER                 09800001
104100             MOVE '5000-MQ-PUT-TO-QUEUE'  TO PV-PARAGRAPH         09810001
104200             MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE     09820001
104300             MOVE PV-COMPLETION-CODE  TO PV-HOLD-COMPLETION-CODE  09830001
104400                                         PE-MQ-COMPLETION-CODE    09840001
104500             MOVE PV-REASON               TO PV-HOLD-REASON       09850001
104600                                             PE-MQ-REASON-CODE    09860001
104700             PERFORM 5200-BACK-OUT-MQ                             09870001
104800             MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE   09880001
104900             MOVE PV-HOLD-REASON          TO PV-REASON            09890001
105000             PERFORM 9200-MQ-ABEND                                09900001
105100         ELSE                                                     09910001
105200             ADD 1 TO PC-MQPUT-RETRY-COUNTER                      09920001
105300             IF PC-MQPUT-RETRY-COUNTER >= 60                      09930001
1015rm                 CALL PV-MQCHECK USING PV-REASON                  09940001
1015rm                                       PV-MQ-REASON-TEXT          09950001
105400                 DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER             09960001
105500                 MOVE '5000-MQ-PUT-TO-QUEUE' TO PV-PARAGRAPH      09970001
105600                 MOVE 'MQPUT ERROR- RETRY > 60 '                  09980001
105700                      TO PV-ERROR-MESSAGE                         09990001
105800                 MOVE PV-COMPLETION-CODE                          10000001
105900                      TO PV-HOLD-COMPLETION-CODE                  10010001
1015RM                         PE-MQ-COMPLETION-CODE                    10020001
106000                 MOVE PV-REASON TO PV-HOLD-REASON                 10030001
1015RM                                   PE-MQ-REASON-CODE              10040001
106100                 PERFORM 5200-BACK-OUT-MQ                         10050001
106200                 MOVE PV-HOLD-COMPLETION-CODE                     10060001
106300                      TO PV-COMPLETION-CODE                       10070001
106400                 MOVE PV-HOLD-REASON TO PV-REASON                 10080001
106500                 PERFORM 9200-MQ-ABEND                            10090001
106600             ELSE                                                 10100001
106700*WAIT FOR 30 SECONDS AND TRY AGAIN                                10110001
106800                 CALL 'SYSWAIT' USING PC-DELAY-INTERVAL           10120001
106900             END-IF                                               10130001
107000         END-IF                                                   10140001
107100     ELSE                                                         10150001
107200         ADD 1 TO PA-TOTAL-MQ-MSGS-SENT                           10160001
107300         SET PS-MQPUT-SUCCESSFUL TO TRUE                          10170001
107400     END-IF.                                                      10180001
107500                                                                  10190001
107600******************************************************************10200001
107700 5010-LOW-VALUES.                                                 10210001
107800                                                                  10220001
107900     MOVE PV-MSGBUFFER TO PV-HOLD-MSGBUFFER.                      10230001
109100     MOVE PV-HOLD-MSGBUFFER TO PV-MSGBUFFER.                      10240001
109200                                                                  10250001
109300******************************************************************10260001
109400*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        10270001
109500******************************************************************10280001
109600 5100-MQ-COMMIT.                                                  10290001
109800                                                                  10300001
109900     CALL PC-MQCMIT USING PV-HCONN                                10310001
110000                          PV-COMPLETION-CODE                      10320001
110100                          PV-REASON.                              10330001
110200                                                                  10340001
110300     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        10350001
110400        CALL PV-MQCHECK USING PV-REASON                           10360001
110500                              PV-MQ-REASON-TEXT                   10370001
110600        MOVE '5100-COMMIT-MQ'   TO PV-PARAGRAPH                   10380001
110700        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               10390001
110800        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        10400001
110900                                   PE-MQ-COMPLETION-CODE          10410001
111000        MOVE PV-REASON          TO PV-HOLD-REASON                 10420001
111100                                   PE-MQ-REASON-CODE              10430001
111200        PERFORM 5200-BACK-OUT-MQ                                  10440001
111300        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        10450001
111400        MOVE PV-HOLD-REASON          TO PV-REASON                 10460001
111500        PERFORM 9200-MQ-ABEND                                     10470001
111600     END-IF.                                                      10480001
111700                                                                  10490001
111800******************************************************************10500001
111900* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       10510001
112000******************************************************************10520001
112100 5200-BACK-OUT-MQ.                                                10530001
112200                                                                  10540001
112300     CALL PC-MQBACK USING PV-HCONN                                10550001
112400                          PV-COMPLETION-CODE                      10560001
112500                          PV-REASON.                              10570001
112600                                                                  10580001
112700     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        10590001
112800        CALL PV-MQCHECK USING PV-REASON                           10600001
112900                              PV-MQ-REASON-TEXT                   10610001
113000        MOVE '5200-BACK-OUT-MQ'  TO PV-PARAGRAPH                  10620001
113100        MOVE 'MQBACK ERROR'    TO PV-ERROR-MESSAGE                10630001
113200        PERFORM 9200-MQ-ABEND                                     10640001
113300     END-IF.                                                      10650001
113400                                                                  10660001
113500******************************************************************10670001
113600* DISPLAY STATISTICS FOR THE PROGRAM                              10680001
113700******************************************************************10690001
113800 9000-EOJ-ROUTINE.                                                10700001
113900                                                                  10710001
114000     CLOSE INTRANSIT-FILE.                                        10720001
114100                                                                  10730001
114200     DISPLAY ' '                                                  10740001
114300     DISPLAY ' ********************************************'      10750001
114400     DISPLAY '     * OFKUT010 SUMMARY STATISTICS *         '      10760001
114600     DISPLAY '       ---------------------------           '      10770001
114700     DISPLAY '          EXPECT   EXTRACT VIA MQ            '      10780001
114800     DISPLAY '       ---------------------------           '      10790001
115000     DISPLAY '   TOTAL EXPECT   RECORDS READ:   '                 10800001
115100                                    PV-COUNTER                    10810001
115300     DISPLAY '   TOTAL MQ MESSAGES SENT:   '                      10820001
115400                                    PA-TOTAL-MQ-MSGS-SENT         10830001
115700     DISPLAY ' ********************************************'.     10840001
115800                                                                  10850001
115900****************************************************************  10860001
116000** PERFORM MQ-SERIES ABEND PROCESSING                             10870001
116100****************************************************************  10880001
116200 9200-MQ-ABEND.                                                   10890001
116300                                                                  10900001
116400     DISPLAY '****************** A B E N D ******************'.   10910001
116500     DISPLAY '** MQSERIES ERROR **'.                              10920001
116600     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          10930001
116700     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    10940001
116800     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     10950001
116900     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 10960001
117000     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            10970001
117100     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                10980001
117200     DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                10990001
117300     DISPLAY '***********************************************'.   11000001
115300     DISPLAY '   TOTAL MQ MESSAGES SENT:   '                      11010001
115400                                    PA-TOTAL-MQ-MSGS-SENT         11020001
117400     MOVE +4013 TO ABEND-CODE.                                    11030001
117500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11040001
117600                                                                  11050001
117700******************************************************************11060001
117800* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      11070001
117900* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 11080001
118000******************************************************************11090001
118100 9900-DB2-ABEND.                                                  11100001
118200                                                                  11110001
118300     MOVE SQLCODE    TO PV-SQLCODE.                               11120001
118400     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       11130001
118500     DISPLAY '*** DB2 ERROR ***'.                                 11140001
118600     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               11150001
118700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 11160001
118800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               11170001
118900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               11180001
119000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       11190001
119100     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             11200001
115300     DISPLAY '   TOTAL MQ MESSAGES SENT:   '                      11210001
115400                                    PA-TOTAL-MQ-MSGS-SENT         11220001
119200                                                                  11230001
119300******************************************************************11240001
119400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    11250001
119500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         11260001
119600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     11270001
119700* FORMAT.                                                         11280001
119800******************************************************************11290001
119900     COPY DPPD004.                                                11300001
120000                                                                  11310001
120100     IF SQLCODE NOT = -911                                        11320001
120200         EXEC SQL                                                 11330001
120300             ROLLBACK                                             11340001
120400         END-EXEC                                                 11350001
120500     END-IF.                                                      11360001
120600                                                                  11370001
120700     MOVE +4013         TO PV-ABEND-CODE.                         11380001
120800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11390001
120900******************************************************************11400001
