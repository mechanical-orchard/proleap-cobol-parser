000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             WSKUT042.                                00050001
000600 AUTHOR.                 RANDY DELAURA.                           00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            JUNE 2009.                               00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200 ENVIRONMENT DIVISION.                                            00120001
001300******************************************************************00130001
001400                                                                  00140001
001500 CONFIGURATION SECTION.                                           00150001
001600 SOURCE-COMPUTER.        IBM-3090.                                00160001
001700 OBJECT-COMPUTER.        IBM-3090.                                00170001
001800 INPUT-OUTPUT SECTION.                                            00180001
001900                                                                  00190001
002000 FILE-CONTROL.                                                    00200001
002100                                                                  00210001
002300     SELECT OUTPUT01-FILE   ASSIGN TO OUT01.                      00230001
002500                                                                  00250001
002600******************************************************************00260001
002700 DATA DIVISION.                                                   00270001
002800******************************************************************00280001
002900                                                                  00290001
003000 FILE SECTION.                                                    00300001
003100                                                                  00310001
003900 FD  OUTPUT01-FILE                                                00390001
004000     RECORDING MODE IS F                                          00400001
004100     LABEL RECORDS ARE STANDARD                                   00410001
004200     BLOCK CONTAINS 0 RECORDS.                                    00420001
004300                                                                  00430001
004400 01  OUTPUT01-RECORD                  PIC X(130).                 00440018
005200/                                                                 00520001
005300******************************************************************00530001
005400 WORKING-STORAGE SECTION.                                         00540001
005500******************************************************************00550001
005600                                                                  00560001
005700 01  FILLER.                                                      00570001
005800     05  FILLER                       PIC  X(36)   VALUE          00580001
005900         ' ***** WORKING STORAGE PGM=WSKUT042 '.                  00590001
006000                                                                  00600001
006010 01  ABEND-CODE                       PIC S9(04)   VALUE +0       00601001
006020                                                   COMP SYNC.     00602001
006030     88  ABEND-4013-DB2-ERROR                      VALUE +4013.   00603001
006040                                                                  00604001
006050 01  DK-VARIABLES.                                                00605001
006060     05 DK-PO-NBR                     PIC S9(9)  COMP   VALUE +0. 00606004
006061     05 DK-PO-LINE-NBR                PIC S9(9)  COMP   VALUE +0. 00606112
006063     05 DK-PREPK-ID                   PIC S9(9)  COMP   VALUE +0. 00606312
006064     05 DK-REC-SEQ-NBR                PIC S9(9)  COMP   VALUE +0. 00606412
006070     05 DK-INTR-TRIP-ID               PIC S9(9)  COMP   VALUE +0. 00607004
006071* JAK START 08/20/2009 CR#1X0                                     00607199
006080     05 DK-OPER-UNT-ID                PIC S9(4)  COMP   VALUE +0. 00608099
006081     05 DK-RECITM-PREPK-ID            PIC S9(4)  COMP   VALUE +0. 00608199
006082     05 DK-SHIPT-UNT-ID               PIC S9(18)V COMP-3 VALUE +0.00608299
006090* JAK END   08/20/2009 CR#1X0                                     00609099
006100                                                                  00610001
006200 01  PS-SWITCHES.                                                 00620001
006500     05  PS-CURSOR-EOF-SW             PIC X(01)    VALUE 'N'.     00650001
006600         88  PS-CURSOR-EOF                         VALUE 'Y'.     00660001
006700     05  PS-UCC128-DATA-SW            PIC X(01)    VALUE 'N'.     00670026
006800         88  PS-UCC128-DATA-YES                    VALUE 'Y'.     00680026
006900         88  PS-UCC128-DATA-NO                     VALUE 'N'.     00690026
007000     05  PS-LINE-UCC128-SW            PIC X(01)    VALUE 'N'.     00700027
007100         88  PS-LINE-UCC128-YES                    VALUE 'Y'.     00710027
007110         88  PS-LINE-UCC128-NO                     VALUE 'N'.     00711027
007120     05  PS-UCC128-CRTN-MLT-LINES-SW  PIC X(01)    VALUE 'N'.     00712027
007130         88  PS-UCC128-CRTN-MLT-LINES-YES          VALUE 'Y'.     00713027
007140         88  PS-UCC128-CRTN-MLT-LINES-NO           VALUE 'N'.     00714027
007200                                                                  00720001
007210 01  DN-DB2-NULL-INDICATORS.                                      00721053
007220     05  DN-REC-DISTR               PIC S9(04) COMP VALUE ZEROES. 00722053
007230                                                                  00723053
007300 01  PV-VARIABLES.                                                00730001
007400     05  PV-DISPLAY                  PIC ZZ,ZZ9-.                 00740001
007500     05  PV-SQL-CODE                 PIC 9(04)      VALUE ZERO.   00750001
007600     05  PV-ABEND-PARAGRAPH          PIC X(30)      VALUE SPACES. 00760001
007700     05  PV-ABEND-OPERATION          PIC X(20)      VALUE SPACES. 00770001
007800     05  PV-ABEND-STRUCTURE          PIC X(20)      VALUE SPACES. 00780001
007900     05  PV-INTR-TRIP-ID             PIC S9(9) COMP   VALUE +0.   00790001
008200     05  PV-OUTPUT01-COUNT           PIC S9(5) COMP-3 VALUE +0.   00820001
008300     05  PV-UCC128-COUNT             PIC S9(9) COMP-3 VALUE +0.   00830009
008310     05  PV-UCC128-CRTN-COUNT        PIC S9(9) COMP-3 VALUE +0.   00831009
008320     05  PV-UCC128-TOTL-UNITS        PIC S9(9) COMP-3 VALUE +0.   00832010
008330     05  PV-UCC128-TOTL-OTPK-QTY     PIC S9(9) COMP-3 VALUE +0.   00833010
008340     05  PV-UCC128-LINES-PER-CRTN    PIC S9(9) COMP-3 VALUE +0.   00834010
008360     05  PV-PROCESS-QTY              PIC S9(9) COMP-3 VALUE +0.   00836029
008370     05  PV-TRANSC-QTY               PIC S9(9) COMP-3 VALUE +0.   00837029
008380     05  PV-RCVD-SHPMT-COUNT         PIC S9(9) COMP-3 VALUE +0.   00838054
008390     05  PV-EXPCTD-CRTN-COUNT        PIC S9(9) COMP-3 VALUE +0.   00839072
008391     05  PV-EXPCTD-CRTN-TRLR         PIC S9(9) COMP-3 VALUE +0.   00839178
008392     05  PV-PO-NBR                   PIC 9(08)         VALUE 0.   00839278
008393     05  PV-REC-SEQ-NBR              PIC 9(04)         VALUE 0.   00839378
008394* START CR#1X0  JAK  08/20/2009                                   00839499
008395     05  PV-PREPK-RATO-QTY           PIC S9(04) COMP   VALUE 0.   00839599
008402     05  PV-PACK-COUNT               PIC  9(04)        VALUE 0.   00840299
008403     05  PV-REMAINDER                PIC  9(04)        VALUE 0.   00840399
008404     05  PV-SHPD-QTY                 PIC S9(09) COMP   VALUE 0.   00840499
008405     05  PV-NULL-IND                 PIC S9(04) COMP VALUE ZEROES.00840599
008406     05  PV-PREPK-CNT                PIC S9(04) COMP VALUE ZEROES.00840699
008407     05  PV-SHIPD-CNT                PIC S9(04) COMP VALUE ZEROES.00840799
008409* END   CR#1X0  JAK  08/20/2009                                   00840999
008410                                                                  00841099
008500 01  PC-CONSTANTS.                                                00850001
008600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00860001
008700                                                   'WSKUT042'.    00870001
008800     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00880001
008900                                                   'ILBOABN0'.    00890001
008910     05  PC-DEFAULT-TMST             PIC  X(26)    VALUE          00891050
008920                                    '9999-09-09-09.09.09.999999'. 00892051
009000/                                                                 00900001
009700***************************************************************** 00970001
009800* OUTPUT COPYBOOK(S)                                            * 00980001
009900***************************************************************** 00990001
010000     COPY WSRD056.                                                01000001
010200/                                                                 01020001
010300***************************************************************** 01030001
010400* DCLGEN TABLE(WST_SHPMT_XREF_HDR)                              * 01040001
010500***************************************************************** 01050001
010600     EXEC SQL                                                     01060001
010700         INCLUDE WST00001                                         01070001
010800     END-EXEC.                                                    01080001
010900/                                                                 01090001
011000***************************************************************** 01100001
011100* DCLGEN TABLE(WST_SHPMT_XREF_DTL)                              * 01110001
011200***************************************************************** 01120001
011300     EXEC SQL                                                     01130001
011400         INCLUDE WST00002                                         01140001
011500     END-EXEC.                                                    01150001
011600/                                                                 01160001
011700***************************************************************** 01170001
011800* DCLGEN TABLE(TVHTRIP)                                         * 01180002
011900***************************************************************** 01190001
012000     EXEC SQL                                                     01200001
012100         INCLUDE TVHTRIP                                          01210002
012200     END-EXEC.                                                    01220001
012300/                                                                 01230001
012310***************************************************************** 01231066
012320* DCLGEN TABLE(TTRISPT)                                         * 01232066
012330***************************************************************** 01233066
012340     EXEC SQL                                                     01234066
012350         INCLUDE TTRIPST                                          01235066
012360     END-EXEC.                                                    01236066
012370/                                                                 01237066
012400***************************************************************** 01240001
012500* DCLGEN TABLE(TPURCHS)                                         * 01250002
012600***************************************************************** 01260001
012700     EXEC SQL                                                     01270001
012800         INCLUDE TPURCHS                                          01280002
012900     END-EXEC.                                                    01290001
013000/                                                                 01300001
013100***************************************************************** 01310001
013200* DCLGEN TABLE(TRECEIV)                                         * 01320002
013300***************************************************************** 01330001
013400     EXEC SQL                                                     01340001
013500         INCLUDE TRECEIV                                          01350002
013600     END-EXEC.                                                    01360001
013700/                                                                 01370001
013710***************************************************************** 01371002
013720* DCLGEN TABLE(TRECITM)                                         * 01372002
013730***************************************************************** 01373002
013740     EXEC SQL                                                     01374002
013750         INCLUDE TRECITM                                          01375002
013760     END-EXEC.                                                    01376002
013770/                                                                 01377002
013780***************************************************************** 01378002
013790* DCLGEN TABLE(XLT_SKU)                                         * 01379002
013791***************************************************************** 01379102
013792     EXEC SQL                                                     01379202
013793         INCLUDE XLT00003                                         01379302
013794     END-EXEC.                                                    01379402
013795/                                                                 01379502
013796***************************************************************** 01379602
013797* DCLGEN TABLE(TPKSLIP)                                         * 01379702
013798***************************************************************** 01379802
013799     EXEC SQL                                                     01379902
013800         INCLUDE TPKSLIP                                          01380002
013801     END-EXEC.                                                    01380102
013802/                                                                 01380202
013803***************************************************************** 01380399
013804* DCLGEN TABLE(TSHPUNT)                                         * 01380499
013805***************************************************************** 01380599
013806     EXEC SQL                                                     01380699
013807         INCLUDE TSHPUNT                                          01380799
013808     END-EXEC.                                                    01380899
013809/                                                                 01380999
013810***************************************************************** 01381002
013811* DCLGEN TABLE(TINPKSU)                                         * 01381102
013812***************************************************************** 01381202
013813     EXEC SQL                                                     01381302
013814         INCLUDE TINPKSU                                          01381402
013815     END-EXEC.                                                    01381502
013816/                                                                 01381602
013817***************************************************************** 01381702
013818* DCLGEN TABLE(TSHUUPC)                                         * 01381802
013819***************************************************************** 01381902
013820     EXEC SQL                                                     01382002
013821         INCLUDE TSHUUPC                                          01382102
013822     END-EXEC.                                                    01382202
013823/                                                                 01382302
013824***************************************************************** 01382402
013825* DCLGEN TABLE(TRECDIS)                                         * 01382502
013826***************************************************************** 01382602
013827     EXEC SQL                                                     01382702
013828         INCLUDE TRECDIS                                          01382802
013829     END-EXEC.                                                    01382902
013830/                                                                 01383002
013831***************************************************************** 01383146
013832* DCLGEN TABLE(TKRPRPM)                                         * 01383246
013833***************************************************************** 01383346
013834     EXEC SQL                                                     01383446
013835         INCLUDE TKRPRPM                                          01383546
013836     END-EXEC.                                                    01383646
013837/                                                                 01383746
013838***************************************************************** 01383872
013839* DCLGEN TABLE(TSHPTPO)                                         * 01383972
013840***************************************************************** 01384072
013841     EXEC SQL                                                     01384172
013842         INCLUDE TSHPTPO                                          01384272
013843     END-EXEC.                                                    01384372
013844/                                                                 01384472
013845***************************************************************** 01384580
013846* DCLGEN TABLE(TSHIPMT)                                         * 01384680
013847***************************************************************** 01384780
013848     EXEC SQL                                                     01384880
013849         INCLUDE TSHIPMT                                          01384980
013850     END-EXEC.                                                    01385080
013851/                                                                 01385180
013860***************************************************************** 01386080
013900*    DOWNLOAD_ERROR_CURSOR                                      * 01390001
014000***************************************************************** 01400001
014001* 12/10/09   ADDED "OR B.DWNLD_CDE = 'N'" TO INCLUDE CASES NOT    01400199
014002* DOWNLOADED.  MARJ HOEFS                                         01400299
014010***************************************************************** 01401099
014100     EXEC SQL                                                     01410001
014200         DECLARE DOWNLOAD_ERROR_CURSOR CURSOR                     01420001
014300          FOR SELECT  DISTINCT A.EXT_SHP_ID                       01430014
014400                            ,  A.INTR_TRIP_ID                     01440014
014500                            ,  B.PO_NBR                           01450014
014600                            ,  B.RCVR_SEQ_NBR                     01460014
014700                            ,  B.PO_LNE_NBR                       01470014
014710                            ,  B.PREPK_ID                         01471014
014720                            ,  B.DWNLD_CDE                        01472014
014721                            ,  A.DEST_LOC_NBR                     01472119
014730              FROM  WST_SHPMT_XREF_HDR A                          01473001
014740                 ,  WST_SHPMT_XREF_DTL B                          01474001
014750             WHERE  A.EXT_SHP_ID     = B.EXT_SHP_ID               01475001
014760               AND  A.PRC_CDE       <> 'V'                        01476070
014761***            AND  A.PRC_CDE        = 'N'                        01476171
014770               AND  A.SOR_CDE        = 'RC'                       01477001
014780               AND  B.ACTV_CDE       = 'A'                        01478001
014790               AND (B.ASN_LVL_CDE    = 'S'                        01479001
014791                OR  B.DWNLD_CDE      = 'T'                        01479199
014792                OR  B.DWNLD_CDE      = 'N')                       01479299
014793**             AND  A.DWNLD_CDE     <> 'C'                        01479399
014794               AND  A.RCPT_TMST     =  :PC-DEFAULT-TMST           01479499
014795               AND  DATE(A.CRE_TMST) >                            01479599
014796                         (CURRENT DATE - :KRPRPM-FUNC-QTY DAYS)   01479699
014797              ORDER BY 1,2,3                                      01479799
014798             WITH UR                                              01479899
014799     END-EXEC.                                                    01479999
014800/                                                                 01480099
014801***************************************************************** 01480199
014802*  COMMUNICATIONS AREA FOR DB2                                  * 01480299
014803***************************************************************** 01480399
014804     EXEC SQL                                                     01480499
014805         INCLUDE SQLCA                                            01480599
014810     END-EXEC.                                                    01481001
014900                                                                  01490001
015000     COPY SQLCA2.                                                 01500001
015100/                                                                 01510001
015200***************************************************************** 01520001
015300*  DB2 FORMATTED MESSAGE AREA                                   * 01530001
015400***************************************************************** 01540001
015500     COPY DPWS004.                                                01550001
015600/                                                                 01560001
015700***************************************************************** 01570001
015800 PROCEDURE DIVISION.                                              01580001
015900***************************************************************** 01590001
016000                                                                  01600001
016200     OPEN OUTPUT OUTPUT01-FILE.                                   01620001
016400     PERFORM 0100-SELECT-PARM-DAYS.                               01640048
016410     PERFORM 1010-OPEN-CURSOR.                                    01641001
016420                                                                  01642001
016500     PERFORM 1000-PROCESS-MAIN-CURSOR                             01650001
016600        THRU 1000-PROCESS-MAIN-CURSOR-EXIT                        01660001
016700            UNTIL ( PS-CURSOR-EOF ).                              01670001
016701                                                                  01670101
016710     PERFORM 1020-CLOSE-CURSOR.                                   01671001
016800                                                                  01680001
017100     MOVE PV-OUTPUT01-COUNT TO PV-DISPLAY.                        01710001
017200     DISPLAY 'OUTPUT 01 WRITTEN: ' PV-DISPLAY.                    01720001
017500                                                                  01750001
017510     CLOSE OUTPUT01-FILE.                                         01751001
017540                                                                  01754001
017550     GOBACK.                                                      01755001
017560/                                                                 01756001
017570***************************************************************** 01757001
017580* SELECT PARM FOR NUMBER OF DAYS BACK TO CREATE THE REPORT        01758046
017590***************************************************************** 01759001
017600 0100-SELECT-PARM-DAYS.                                           01760046
017601                                                                  01760146
017602     INITIALIZE DCLTKRPRPM.                                       01760246
017603                                                                  01760346
017604     EXEC SQL                                                     01760446
017605         SELECT  FUNC_QTY                                         01760546
017607           INTO  :KRPRPM-FUNC-QTY                                 01760746
017609           FROM  TKRPRPM                                          01760946
017610          WHERE  LOC_ID            = 90                           01761046
017611            AND  INTFC_SYS_CDE     = 'KHL'                        01761146
017612            AND  SYS_PRC_FUNC_CDE  = 'DNLRPT'                     01761246
017613            AND  FUNC_PRC_STAT_CDE = 'AC'                         01761346
017614     END-EXEC                                                     01761447
017615                                                                  01761546
017616     EVALUATE TRUE                                                01761647
017617         WHEN SQLCODE = +0                                        01761747
017618             CONTINUE                                             01761847
017619         WHEN SQLCODE = +100                                      01761947
017620             MOVE +10 TO KRPRPM-FUNC-QTY                          01762081
017621         WHEN OTHER                                               01762147
017622            MOVE '0100-SELECT-PARM-DAYS '                         01762247
017623                               TO PV-ABEND-PARAGRAPH              01762347
017624            MOVE SQLCODE       TO PV-SQL-CODE                     01762447
017625            MOVE 'SELECT'      TO PV-ABEND-OPERATION              01762547
017626            MOVE 'TKRPRPM'     TO PV-ABEND-STRUCTURE              01762647
017627            PERFORM 9900-SQL-ERROR                                01762747
017628     END-EVALUATE.                                                01762847
017629                                                                  01762946
017630                                                                  01763046
017631                                                                  01763146
017632***************************************************************** 01763246
017633* 1000-PROCESS-MAIN-CURSOR.                                       01763346
017634***************************************************************** 01763446
017640 1000-PROCESS-MAIN-CURSOR.                                        01764046
017700                                                                  01770001
017701     PERFORM 1005-FETCH-CURSOR.                                   01770118
017702                                                                  01770218
017706     IF ( PS-CURSOR-EOF )                                         01770618
017707         GO TO 1000-PROCESS-MAIN-CURSOR-EXIT                      01770718
017708     END-IF.                                                      01770818
017709                                                                  01770918
017710     INITIALIZE WS056-DOWNLOAD-ERRORS-RECORD.                     01771034
017711                                                                  01771134
017712     MOVE +0 TO PV-PROCESS-QTY                                    01771229
017720                PV-TRANSC-QTY.                                    01772055
017721*GB                                                               01772157
017730     MOVE +0 TO PV-UCC128-TOTL-UNITS                              01773057
017731                PV-UCC128-CRTN-COUNT                              01773158
017732                PV-UCC128-TOTL-OTPK-QTY.                          01773257
017734*GB                                                               01773457
017740                                                                  01774054
017811     IF ( WST00001-INTR-TRIP-ID NOT = DK-INTR-TRIP-ID )           01781118
017812         MOVE WST00001-INTR-TRIP-ID TO DK-INTR-TRIP-ID            01781218
017813         MOVE +0                    TO DK-PO-NBR                  01781338
017818         PERFORM 2990-SELECT-FROM-TTRIPST                         01781865
017819         PERFORM 3000-SELECT-FROM-TVHTRIP                         01781965
017820         PERFORM 3002-CHECK-RCVD-DUMMY-TRIP                       01782065
017821         PERFORM 4200-SELECT-EXPTD-CRTNS-TRLR                     01782178
017827     END-IF.                                                      01782723
017828                                                                  01782823
017829     IF ( WST00002-PO-NBR       NOT = DK-PO-NBR )                 01782926
017840         MOVE WST00002-PO-NBR       TO DK-PO-NBR                  01784026
017842         MOVE +0                    TO DK-REC-SEQ-NBR             01784238
017845         PERFORM 3005-SELECT-FROM-TPURCHS                         01784526
017853     END-IF.                                                      01785326
017854                                                                  01785499
017855     IF  PV-RCVD-SHPMT-COUNT = 0                                  01785554
017857                                                                  01785754
017858       IF ( WST00002-RCVR-SEQ-NBR NOT = DK-REC-SEQ-NBR )          01785854
017859           MOVE WST00002-RCVR-SEQ-NBR TO DK-REC-SEQ-NBR           01785954
017860           PERFORM 3010-SELECT-FROM-TRECEIV                       01786054
017861           PERFORM 4000-SELECT-UCC128-COUNT                       01786154
017862       END-IF                                                     01786254
017863                                                                  01786354
017864       MOVE WST00002-PO-LNE-NBR TO DK-PO-LINE-NBR                 01786499
017865* START CR#1X0  JAK  08/20/2009                                   01786599
017867*      IF ( PS-UCC128-DATA-YES )                                  01786798
017868*          MOVE 'Y' TO WS056-UCC128-IND                           01786898
017869*      ELSE                                                       01786998
017870*          MOVE 'N' TO WS056-UCC128-IND                           01787098
017871*      END-IF                                                     01787198
017872*                                                                 01787298
017876       IF RECEIV-PKGNG-CDE = 'M'                                  01787699
017877       OR RECEIV-PKGNG-CDE = 'I'                                  01787799
017879           PERFORM 3030-SELECT-FROM-TRECITM                       01787999
017882           PERFORM 3040-SELECT-FROM-TSHUUPC                       01788299
017886           IF PV-SHPD-QTY = 0                                     01788699
017887               IF PS-UCC128-DATA-YES                              01788799
017888                   MOVE 'Y' TO WS056-UCC128-IND                   01788899
017889               ELSE                                               01788999
017890                   MOVE 'N' TO WS056-UCC128-IND                   01789099
017891               END-IF                                             01789199
017892           ELSE                                                   01789299
017893               IF PV-PREPK-RATO-QTY > PV-SHPD-QTY                 01789399
017894                   MOVE 'Q' TO WS056-UCC128-IND                   01789499
017895               ELSE                                               01789599
017896                   DIVIDE PV-SHPD-QTY BY PV-PREPK-RATO-QTY        01789699
017897                      GIVING PV-PACK-COUNT REMAINDER PV-REMAINDER 01789799
017898                   IF PV-REMAINDER = 0                            01789899
017899                        PERFORM 3050-SELECT-COUNT-TRECITM         01789999
017900                        PERFORM 3060-SELECT-COUNT-TSHUUPC         01790099
017905                        IF PV-PREPK-CNT NOT = PV-SHIPD-CNT        01790599
017906                            MOVE 'Q' TO WS056-UCC128-IND          01790699
017907                        ELSE                                      01790799
017908                            MOVE 'Y' TO WS056-UCC128-IND          01790899
017909                        END-IF                                    01790999
017910                   ELSE                                           01791099
017911                        MOVE 'Q' TO WS056-UCC128-IND              01791199
017912                   END-IF                                         01791299
017913               END-IF                                             01791399
017914           END-IF                                                 01791499
017915       ELSE                                                       01791599
017916           IF ( PS-UCC128-DATA-YES )                              01791699
017917               MOVE 'Y' TO WS056-UCC128-IND                       01791799
017918           ELSE                                                   01791899
017919               MOVE 'N' TO WS056-UCC128-IND                       01791999
017920           END-IF                                                 01792099
017921       END-IF                                                     01792199
017922* END   CR#1X0  JAK  08/20/2009                                   01792299
017923                                                                  01792399
017924       MOVE WST00002-PREPK-ID   TO DK-PREPK-ID                    01792499
017925                                                                  01792599
017926       IF ( DK-PO-LINE-NBR > +0 )                                 01792699
017927           PERFORM 3015-SELECT-FROM-XLTSKU                        01792799
017928       ELSE                                                       01792899
017929           PERFORM 3020-SELECT-FROM-XLTSKU                        01792999
017930       END-IF                                                     01793099
017931                                                                  01793199
017932                                                                  01793299
017935       IF ( RECEIV-PACK-BY-ST-IND = 'Y' )                         01793599
017936         IF ( DK-PO-NBR   = PV-PO-NBR) AND                        01793699
017937            ( DK-REC-SEQ-NBR  = PV-REC-SEQ-NBR)                   01793799
017938            CONTINUE                                              01793899
017939         ELSE                                                     01793999
017940            MOVE DK-PO-NBR TO PV-PO-NBR                           01794099
017941            MOVE DK-REC-SEQ-NBR  TO PV-REC-SEQ-NBR                01794199
017942            PERFORM 2000-PACK-BY-STORE                            01794299
017943            IF  RECEIV-REC-TYP-CDE NOT = 'AP'                     01794399
017944            AND RECEIV-REC-TYP-CDE NOT = 'CR'                     01794499
017945            AND (WST00002-DWNLD-CDE = 'T'                         01794599
017946            OR  (WST00002-DWNLD-CDE NOT = 'T'                     01794699
017947                AND NOT PS-LINE-UCC128-YES                        01794799
017949                AND WS056-CASEPACK-TYPE NOT = 'U'))               01794999
017953               PERFORM 7000-WRITE-OUTPUT                          01795399
017954            END-IF                                                01795499
017955       ELSE                                                       01795599
017956         PERFORM 2050-NON-PACK-BY-STORE                           01795699
017957         IF  RECEIV-REC-TYP-CDE NOT = 'AP'                        01795799
017958         AND RECEIV-REC-TYP-CDE NOT = 'CR'                        01795899
017959         AND (WST00002-DWNLD-CDE = 'T'                            01795999
017960         OR  (WST00002-DWNLD-CDE NOT = 'T'                        01796099
017961             AND NOT PS-LINE-UCC128-YES                           01796199
017962             AND WS056-CASEPACK-TYPE NOT = 'U'))                  01796299
017966            PERFORM 7000-WRITE-OUTPUT                             01796699
017967         END-IF                                                   01796799
017968       END-IF                                                     01796899
017969                                                                  01796999
017970     END-IF.                                                      01797099
018000                                                                  01800054
018100                                                                  01810054
022016 1000-PROCESS-MAIN-CURSOR-EXIT.                                   02201601
022017     EXIT.                                                        02201701
022018/                                                                 02201801
022019***************************************************************** 02201918
022020* 1005-FETCH-CURSOR.                                              02202018
022021***************************************************************** 02202118
022022 1005-FETCH-CURSOR.                                               02202218
022023                                                                  02202318
022024     EXEC SQL                                                     02202418
022025         FETCH DOWNLOAD_ERROR_CURSOR                              02202518
022026          INTO   :WST00001-EXT-SHP-ID                             02202618
022027               , :WST00001-INTR-TRIP-ID                           02202718
022028               , :WST00002-PO-NBR                                 02202818
022029               , :WST00002-RCVR-SEQ-NBR                           02202918
022030               , :WST00002-PO-LNE-NBR                             02203018
022031               , :WST00002-PREPK-ID                               02203118
022032               , :WST00002-DWNLD-CDE                              02203299
022033               , :WST00001-DEST-LOC-NBR                           02203319
022034     END-EXEC.                                                    02203419
022035                                                                  02203519
022036     EVALUATE TRUE                                                02203619
022037         WHEN SQLCODE = +0                                        02203719
022038             CONTINUE                                             02203819
022039         WHEN SQLCODE = +100                                      02203919
022040             SET PS-CURSOR-EOF  TO TRUE                           02204019
022041         WHEN OTHER                                               02204118
022042            MOVE '1005-FETCH-CURSOR'        TO PV-ABEND-PARAGRAPH 02204218
022043            MOVE SQLCODE                    TO PV-SQL-CODE        02204318
022044            MOVE 'FETCH'                    TO PV-ABEND-OPERATION 02204418
022045            MOVE 'DOWNLOAD_ERROR_CURSOR'    TO PV-ABEND-STRUCTURE 02204518
022046            PERFORM 9900-SQL-ERROR                                02204618
022047     END-EVALUATE.                                                02204718
022048                                                                  02204818
022049                                                                  02204918
022050/                                                                 02205018
022051***************************************************************** 02205101
022052* 1010-OPEN-CURSOR.                                               02205201
022053***************************************************************** 02205301
022054 1010-OPEN-CURSOR.                                                02205401
022055                                                                  02205501
022060     EXEC SQL                                                     02206001
022070         OPEN DOWNLOAD_ERROR_CURSOR                               02207001
022080     END-EXEC.                                                    02208001
022090                                                                  02209001
022100     EVALUATE TRUE                                                02210001
022200         WHEN SQLCODE = +0                                        02220001
022300             CONTINUE                                             02230001
022400         WHEN OTHER                                               02240001
022410            MOVE '1010-OPEN-CURSOR'      TO PV-ABEND-PARAGRAPH    02241001
022411            MOVE SQLCODE                 TO PV-SQL-CODE           02241101
022412            MOVE 'OPEN'                  TO PV-ABEND-OPERATION    02241201
022413            MOVE 'DOWNLOAD_ERROR_CURSOR' TO PV-ABEND-STRUCTURE    02241301
022414            PERFORM 9900-SQL-ERROR                                02241401
022415     END-EVALUATE.                                                02241501
022416/                                                                 02241601
022417***************************************************************** 02241701
022418* 1020-CLOSE-CURSOR.                                              02241801
022419***************************************************************** 02241901
022420 1020-CLOSE-CURSOR.                                               02242001
022421                                                                  02242101
022422     EXEC SQL                                                     02242201
022423         CLOSE DOWNLOAD_ERROR_CURSOR                              02242301
022424     END-EXEC.                                                    02242401
022425                                                                  02242501
022426     EVALUATE TRUE                                                02242601
022427         WHEN SQLCODE = +0                                        02242701
022428             CONTINUE                                             02242801
022429         WHEN OTHER                                               02242901
022430            MOVE '1020-CLOSE-CURSOR'     TO PV-ABEND-PARAGRAPH    02243001
022431            MOVE SQLCODE                 TO PV-SQL-CODE           02243101
022432            MOVE 'CLOSE'                 TO PV-ABEND-OPERATION    02243201
022433            MOVE 'DOWNLOAD_ERROR_CURSOR' TO PV-ABEND-STRUCTURE    02243301
022434            PERFORM 9900-SQL-ERROR                                02243401
022435     END-EVALUATE.                                                02243501
022436/                                                                 02243601
022437***************************************************************** 02243727
022438* 2000-PACK-BY-STORE.                                             02243827
022440***************************************************************** 02244027
022441 2000-PACK-BY-STORE.                                              02244127
022442                                                                  02244227
022443     PERFORM 4025-SELECT-UCC128-TOTL-UNITS.                       02244332
022444     PERFORM 4030-SELECT-EXPECTED-ITM-QTY.                        02244432
022445                                                                  02244532
022446     MOVE PV-UCC128-TOTL-UNITS TO PV-PROCESS-QTY.                 02244632
022447                                                                  02244732
022448     IF ( PV-PROCESS-QTY NOT = PV-TRANSC-QTY )                    02244833
022452         MOVE 'S' TO WS056-CASEPACK-TYPE                          02245232
022453     ELSE                                                         02245332
022454         MOVE 'U' TO WS056-CASEPACK-TYPE                          02245432
022455     END-IF.                                                      02245532
022456/                                                                 02245627
022457***************************************************************** 02245727
022458* 2050-NON-PACK-BY-STORE.                                         02245827
022459***************************************************************** 02245927
022460 2050-NON-PACK-BY-STORE.                                          02246027
022461                                                                  02246127
022462     IF ( PS-UCC128-DATA-YES )                                    02246227
022463         PERFORM 4005-SELECT-UCC128-CRTN-COUNT                    02246327
022464         EVALUATE TRUE                                            02246427
022465             WHEN SQLCODE = +0                                    02246527
022466                 IF ( PV-UCC128-CRTN-COUNT > +0 )                 02246627
022467                     SET PS-LINE-UCC128-NO  TO TRUE               02246728
022468                     PERFORM 4010-SELECT-UCC128-CRTN-COUNT        02246827
022469                     IF ( SQLCODE = +0 )                          02246928
022470                         SET PS-LINE-UCC128-YES TO TRUE           02247028
022471                     END-IF                                       02247128
022472                     IF ( DK-PREPK-ID > +0 )                      02247228
022473                         CONTINUE                                 02247327
022474                     ELSE                                         02247427
022475                         SET PS-UCC128-CRTN-MLT-LINES-NO TO TRUE  02247529
022476                         PERFORM 4015-SELECT-UCC128-LINES-CRTN    02247627
022477                         IF ( PV-UCC128-LINES-PER-CRTN > +1 )     02247749
022478                             SET PS-UCC128-CRTN-MLT-LINES-YES     02247827
022479                              TO TRUE                             02247927
022480                         END-IF                                   02248027
022481                     END-IF                                       02248127
022482                 ELSE                                             02248227
022483                     SET PS-LINE-UCC128-NO  TO TRUE               02248327
022484                 END-IF                                           02248427
022485         END-EVALUATE                                             02248527
022486     END-IF.                                                      02248627
022487                                                                  02248729
022488     IF ( PS-LINE-UCC128-YES )                                    02248829
022489         MOVE PV-UCC128-TOTL-UNITS TO PV-PROCESS-QTY              02248931
022490     ELSE                                                         02249029
022491*GB  5/7/12 BEG                                                   02249199
022492                                                                  02249299
022500* WHEN THE PS-LINE-UCC128-NO THE PV-UCC128-CRTN-COUNT AND         02250099
022501* PV-UCC128-TOTL-OTPK-QTY WILL ALWAYS                             02250199
022502* BE ZERO SO CALCULATION BELOW WILL ALWAYS RESULT IN ZERO         02250299
022503* CHANGED CODE TO MOVE +0 TO PROCESS QTY                          02250399
022504*        MOVE XLT00003-OUTR-PK-QTY TO PV-UCC128-TOTL-OTPK-QTY     02250499
022505*        IF ( PV-UCC128-CRTN-COUNT    > +0  AND                   02250599
022506*             PV-UCC128-TOTL-OTPK-QTY > +0 )                      02250699
022507*            COMPUTE PV-PROCESS-QTY = PV-UCC128-CRTN-COUNT        02250799
022508*                                   * PV-UCC128-TOTL-OTPK-QTY     02250899
022509*        END-IF                                                   02250999
022510                                                                  02251099
022511         MOVE +0 TO   PV-PROCESS-QTY                              02251199
022512*GB  5/7/12 END                                                   02251299
022513     END-IF.                                                      02251399
022514                                                                  02251499
022515     PERFORM 4020-SELECT-EXPECTED-ITM-QTY.                        02251599
022516                                                                  02251699
022517     IF ( PV-PROCESS-QTY NOT = PV-TRANSC-QTY ) OR                 02251799
022518        ( PS-UCC128-DATA-NO                  ) OR                 02251899
022519        ( PS-LINE-UCC128-NO                  ) OR                 02251999
022520        ( PS-UCC128-CRTN-MLT-LINES-YES       )                    02252099
022521         MOVE 'S' TO WS056-CASEPACK-TYPE                          02252199
022522     ELSE                                                         02252244
022523         MOVE 'U' TO WS056-CASEPACK-TYPE                          02252344
022524     END-IF.                                                      02252444
022525/                                                                 02252544
022526***************************************************************** 02252644
022527* 2990-SELECT-FROM-TTRIPST.                                       02252764
022528*     SELECT CURRENT TRIP STATUS FOR TRIP                         02252864
022529***************************************************************** 02252944
022530 2990-SELECT-FROM-TTRIPST.                                        02253063
022531                                                                  02253144
022532     INITIALIZE DCLTTRIPST.                                       02253263
022533                                                                  02253303
022540     EXEC SQL                                                     02254001
022550         SELECT DISTINCT                                          02255063
022551                A.TRIP_STATUS_CDE                                 02255163
022552         INTO  :TRIPST-TRIP-STATUS-CDE                            02255264
022553         FROM   TTRIPST A                                         02255363
022554         WHERE A.TRIP_ID       = :DK-INTR-TRIP-ID                 02255463
022555           AND  A.STATUS_TME =                                    02255563
022556              (SELECT MAX(B.STATUS_TME)                           02255663
022557                FROM  TTRIPST B                                   02255763
022558                WHERE B.TRIP_ID       = :DK-INTR-TRIP-ID          02255863
022559                  AND B.STATUS_DTE =                              02255963
022560                   (SELECT MAX(C.STATUS_DTE)                      02256063
022561                     FROM   TTRIPST C                             02256163
022562                    WHERE C.TRIP_ID       = :DK-INTR-TRIP-ID))    02256263
022960     END-EXEC.                                                    02296001
022970                                                                  02297001
022980     EVALUATE TRUE                                                02298001
022990         WHEN SQLCODE = +0                                        02299001
022991         WHEN SQLCODE = -811                                      02299164
023000             CONTINUE                                             02300003
023200         WHEN SQLCODE = +100                                      02320001
023300             CONTINUE                                             02330003
023400         WHEN OTHER                                               02340001
023500            MOVE '2990-SELECT-FROM-TTRIPST'                       02350064
023600                               TO PV-ABEND-PARAGRAPH              02360001
023700            MOVE SQLCODE       TO PV-SQL-CODE                     02370001
023800            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02380001
023810            MOVE 'TTRIPST'     TO PV-ABEND-STRUCTURE              02381064
023820            PERFORM 9900-SQL-ERROR                                02382001
023830     END-EVALUATE.                                                02383001
023840/                                                                 02384001
023841***************************************************************** 02384163
023842* 3000-SELECT-FROM-TVHTRIP.                                       02384263
023843*     SELECT SCAC ID, VEHICLE NUMBER                              02384363
023844***************************************************************** 02384463
023845 3000-SELECT-FROM-TVHTRIP.                                        02384563
023846                                                                  02384663
023847     INITIALIZE DCLTVHTRIP.                                       02384763
023848                                                                  02384863
023849     EXEC SQL                                                     02384963
023850         SELECT OWNER_SCAC_ID                                     02385063
023851              , VEH_NBR                                           02385163
023852           INTO :VHTRIP-OWNER-SCAC-ID                             02385263
023853              , :VHTRIP-VEH-NBR                                   02385363
023854         FROM   TVHTRIP                                           02385463
023855         WHERE  TRIP_ID  = :DK-INTR-TRIP-ID                       02385563
023856     END-EXEC.                                                    02385663
023857                                                                  02385763
023858     EVALUATE TRUE                                                02385863
023859         WHEN SQLCODE = +0                                        02385963
023860             CONTINUE                                             02386063
023861         WHEN SQLCODE = +100                                      02386163
023862             CONTINUE                                             02386263
023863         WHEN OTHER                                               02386363
023864            MOVE '3000-SELECT-FROM-TVHTRIP'                       02386463
023865                               TO PV-ABEND-PARAGRAPH              02386563
023866            MOVE SQLCODE       TO PV-SQL-CODE                     02386663
023867            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02386763
023868            MOVE 'TVHTRIP'     TO PV-ABEND-STRUCTURE              02386863
023869            PERFORM 9900-SQL-ERROR                                02386963
023870     END-EVALUATE.                                                02387063
023871/                                                                 02387163
023872***************************************************************** 02387263
023873* 3002-CHECK-RCVD-DUMMY-TRIP.                                     02387363
023874*     SELECT SCAC ID, VEHICLE NUMBER                              02387463
023875***************************************************************** 02387563
023876 3002-CHECK-RCVD-DUMMY-TRIP.                                      02387663
023877                                                                  02387763
023878     MOVE ZEROES TO PV-RCVD-SHPMT-COUNT.                          02387863
023879                                                                  02387963
023880     EXEC SQL                                                     02388063
023881         SELECT COUNT(*)                                          02388163
023882           INTO :PV-RCVD-SHPMT-COUNT                              02388263
023883         FROM   WST_SHPMT_XREF_HDR                                02388363
023884         WHERE INTR_TRIP_ID = :DK-INTR-TRIP-ID                    02388463
023885           AND RCPT_TMST  <>  :PC-DEFAULT-TMST                    02388563
023886     END-EXEC.                                                    02388663
023887                                                                  02388763
023888     EVALUATE TRUE                                                02388863
023889         WHEN SQLCODE = +0                                        02388963
023890             CONTINUE                                             02389063
023891         WHEN OTHER                                               02389163
023892            MOVE '3002-CHECK-RCVD-DUMY-TRIP'                      02389263
023893                               TO PV-ABEND-PARAGRAPH              02389363
023894            MOVE SQLCODE       TO PV-SQL-CODE                     02389463
023895            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02389563
023896            MOVE 'WST_SHPMT_XREF_HDR' TO PV-ABEND-STRUCTURE       02389663
023897            PERFORM 9900-SQL-ERROR                                02389763
023898     END-EVALUATE.                                                02389863
023899/                                                                 02389963
023900***************************************************************** 02390063
023901* 3005-SELECT-FROM-TPURCHS.                                       02390163
023902*     SELECT PACKAGING CODE                                       02390263
023903***************************************************************** 02390363
023904 3005-SELECT-FROM-TPURCHS.                                        02390463
023905                                                                  02390563
023906     INITIALIZE DCLTPURCHS.                                       02390663
023907                                                                  02390763
023908     EXEC SQL                                                     02390863
023909         SELECT PKGNG_CDE                                         02390963
023910           INTO :PURCHS-PKGNG-CDE                                 02391063
023911           FROM TPURCHS                                           02391163
023912          WHERE PO_NBR         = :DK-PO-NBR                       02391263
023920            AND VER_STATUS_CDE = 'A'                              02392063
024009     END-EXEC.                                                    02400901
024010                                                                  02401001
024020     EVALUATE TRUE                                                02402001
024021         WHEN SQLCODE = +0                                        02402104
024022             CONTINUE                                             02402204
024023         WHEN SQLCODE = +100                                      02402304
024024             CONTINUE                                             02402404
024025         WHEN OTHER                                               02402504
024026            MOVE '3005-SELECT-FROM-TPURCHS'                       02402604
024027                               TO PV-ABEND-PARAGRAPH              02402704
024028            MOVE SQLCODE       TO PV-SQL-CODE                     02402804
024029            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02402904
024030            MOVE 'TPURCHS'     TO PV-ABEND-STRUCTURE              02403006
024031            PERFORM 9900-SQL-ERROR                                02403104
024096     END-EVALUATE.                                                02409601
024097/                                                                 02409701
024098***************************************************************** 02409806
024099* 3010-SELECT-FROM-TRECEIV.                                       02409906
024100*     SELECT PACKAGING CODE                                       02410006
024200***************************************************************** 02420006
024300 3010-SELECT-FROM-TRECEIV.                                        02430006
024400                                                                  02440006
024500     INITIALIZE DCLTRECEIV.                                       02450006
024700                                                                  02470006
024800     EXEC SQL                                                     02480006
024900         SELECT PKGNG_CDE                                         02490006
025000              , PACK_BY_ST_IND                                    02500006
025001              , REC_TYP_CDE                                       02500184
025010           INTO :RECEIV-PKGNG-CDE                                 02501006
025020              , :RECEIV-PACK-BY-ST-IND                            02502006
025030              , :RECEIV-REC-TYP-CDE                               02503084
025100           FROM TRECEIV                                           02510006
025200          WHERE ORD_NBR       =  :DK-PO-NBR                       02520006
025210            AND REC_SEQ_NBR   =  :DK-REC-SEQ-NBR                  02521006
025220            AND VER_STATUS_CDE = 'A'                              02522006
025300     END-EXEC.                                                    02530006
025400                                                                  02540006
025500     EVALUATE TRUE                                                02550006
025600         WHEN SQLCODE = +0                                        02560006
025720             CONTINUE                                             02572091
025800         WHEN SQLCODE = +100                                      02580006
025900             CONTINUE                                             02590006
026000         WHEN OTHER                                               02600006
026100            MOVE '3010-SELECT-FROM-TRECEIV'                       02610006
026200                               TO PV-ABEND-PARAGRAPH              02620006
026300            MOVE SQLCODE       TO PV-SQL-CODE                     02630006
026400            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02640006
026500            MOVE 'TRECEIV'     TO PV-ABEND-STRUCTURE              02650006
026600            PERFORM 9900-SQL-ERROR                                02660006
026700     END-EVALUATE.                                                02670006
026800/                                                                 02680006
026900***************************************************************** 02690006
027000* 3015-SELECT-FROM-XLTSKU.                                        02700006
027100*     SELECT SKU NUMBER USING PO-LINE NBR                         02710007
027200***************************************************************** 02720006
027300 3015-SELECT-FROM-XLTSKU.                                         02730006
027400                                                                  02740006
027500     INITIALIZE DCLTRECITM                                        02750006
027510                DCLXLT00003.                                      02751006
027520                                                                  02752006
027900     EXEC SQL                                                     02790006
028000         SELECT  B.SKU_NBR                                        02800006
028010           INTO  :XLT00003-SKU-NBR                                02801013
028100           FROM  TRECITM A                                        02810006
028200               , XLT_SKU B                                        02820006
028300          WHERE  A.ORD_NBR      =  :DK-PO-NBR                     02830012
028500            AND  A.ORD_LNE_NBR  =  :DK-PO-LINE-NBR                02850012
028501            AND  A.REC_SEQ_NBR  =  :DK-REC-SEQ-NBR                02850106
028510            AND  A.ITM_NBR      =  B.ITM_NBR                      02851006
028530     END-EXEC.                                                    02853006
028540                                                                  02854006
028550     EVALUATE TRUE                                                02855006
028560         WHEN SQLCODE = +0                                        02856006
028570             CONTINUE                                             02857006
028571         WHEN SQLCODE = +100                                      02857106
028572             CONTINUE                                             02857206
028573         WHEN OTHER                                               02857306
028574            MOVE '3015-SELECT-FROM-XLTSKU'                        02857406
028575                               TO PV-ABEND-PARAGRAPH              02857506
028576            MOVE SQLCODE       TO PV-SQL-CODE                     02857606
028577            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02857706
028578            MOVE 'XLT_SKU'     TO PV-ABEND-STRUCTURE              02857806
028579            PERFORM 9900-SQL-ERROR                                02857906
028580     END-EVALUATE.                                                02858006
028581/                                                                 02858106
028582***************************************************************** 02858207
028583* 3020-SELECT-FROM-XLTSKU.                                        02858307
028584*     SELECT SKU NUMBER USING PREPACK ID                          02858407
028585***************************************************************** 02858507
028586 3020-SELECT-FROM-XLTSKU.                                         02858607
028587                                                                  02858707
028588     INITIALIZE DCLTRECITM                                        02858807
028589                DCLXLT00003.                                      02858907
028595     EXEC SQL                                                     02859507
028596         SELECT  B.SKU_NBR                                        02859607
028599           INTO  :XLT00003-SKU-NBR                                02859999
028601           FROM  TRECITM A                                        02860107
028602               , XLT_SKU B                                        02860207
028603          WHERE  A.ORD_NBR           =  :DK-PO-NBR                02860312
028604            AND  A.PREPK_ID          =  :DK-PREPK-ID              02860407
028605            AND  A.REC_SEQ_NBR       =  :DK-REC-SEQ-NBR           02860507
028606            AND  A.ITM_NBR           =  B.ITM_NBR                 02860607
028607            AND  A.PREPK_DRV_LNE_CDE =  'A'                       02860707
028608     END-EXEC.                                                    02860807
028609                                                                  02860907
028610     EVALUATE TRUE                                                02861007
028611         WHEN SQLCODE = +0                                        02861107
028612             CONTINUE                                             02861207
028613         WHEN SQLCODE = +100                                      02861307
028614             CONTINUE                                             02861407
028615         WHEN OTHER                                               02861507
028616            MOVE '3020-SELECT-FROM-XLTSKU'                        02861607
028617                               TO PV-ABEND-PARAGRAPH              02861707
028618            MOVE SQLCODE       TO PV-SQL-CODE                     02861807
028619            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02861907
028620            MOVE 'XLT_SKU'     TO PV-ABEND-STRUCTURE              02862007
028621            PERFORM 9900-SQL-ERROR                                02862107
028622     END-EVALUATE.                                                02862207
028623/                                                                 02862307
028625* START CR#1X0  JAK  08/20/2009                                   02862599
028627***************************************************************** 02862799
028628* 3030-SELECT-FROM-TRECITM.                                       02862899
028629*     SELECT PREPK RATIO                                          02862999
028630***************************************************************** 02863099
028631 3030-SELECT-FROM-TRECITM.                                        02863199
028632                                                                  02863299
028633     MOVE 0 TO PV-PREPK-RATO-QTY.                                 02863399
028634                                                                  02863499
028635     EXEC SQL                                                     02863599
028636         SELECT PREPK_RATO_QTY                                    02863699
028637              , OPER_UNT_ID                                       02863799
028638              , PREPK_ID                                          02863899
028639           INTO :PV-PREPK-RATO-QTY                                02863999
028640              , :RECITM-OPER-UNT-ID                               02864099
028641              , :RECITM-PREPK-ID                                  02864199
028642           FROM TRECITM                                           02864299
028643          WHERE ORD_NBR       =  :DK-PO-NBR                       02864399
028644            AND REC_SEQ_NBR   =  :DK-REC-SEQ-NBR                  02864499
028645            AND ORD_LNE_NBR   =  :DK-PO-LINE-NBR                  02864599
028646            AND VER_STATUS_CDE = 'A'                              02864699
028647     END-EXEC.                                                    02864799
028648                                                                  02864899
028649     EVALUATE TRUE                                                02864999
028650         WHEN SQLCODE = +0                                        02865099
028651             CONTINUE                                             02865199
028652         WHEN SQLCODE = +100                                      02865299
028653             CONTINUE                                             02865399
028654         WHEN OTHER                                               02865499
028655            MOVE '3030-SELECT-FROM-TRECITM'                       02865599
028656                               TO PV-ABEND-PARAGRAPH              02865699
028657            MOVE SQLCODE       TO PV-SQL-CODE                     02865799
028658            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02865899
028659            MOVE 'TRECEIV'     TO PV-ABEND-STRUCTURE              02865999
028660            PERFORM 9900-SQL-ERROR                                02866099
028661     END-EVALUATE.                                                02866199
028662/                                                                 02866299
028663***************************************************************** 02866399
028664* 3040-SELECT-FROM-TSHUUPC.                                       02866499
028665*     SELECT CARTON RATIO                                         02866599
028666***************************************************************** 02866699
028667 3040-SELECT-FROM-TSHUUPC.                                        02866799
028668                                                                  02866899
028669     MOVE 0 TO PV-SHPD-QTY.                                       02866999
028670     MOVE RECITM-OPER-UNT-ID    TO DK-OPER-UNT-ID.                02867099
028671                                                                  02867199
028672     EXEC SQL                                                     02867299
028673         SELECT A.SHPD_QTY                                        02867399
028674              , A.SHIPT_UNT_ID                                    02867499
028675           INTO :PV-SHPD-QTY                                      02867599
028676              , :SHUUPC-SHIPT-UNT-ID                              02867699
028677           FROM TSHUUPC A                                         02867799
028678              , TSHPUNT B                                         02867899
028679              , TINPKSU C                                         02867999
028680              , TPKSLIP D                                         02868099
028681              , TSHPTPO E                                         02868199
028682*             , TSHIPMT F                                         02868299
028683          WHERE A.TRN_LNE_NBR      =  :DK-PO-LINE-NBR             02868399
028684            AND A.TRN_NBR          =  :DK-PO-NBR                  02868499
028685            AND E.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             02868599
028686            AND B.ORGN_OPER_UNT_ID =  :DK-OPER-UNT-ID             02868699
028687            AND E.PO_NBR           =  A.TRN_NBR                   02868799
028688*           AND E.SHIPT_ID         =  F.SHIPT_ID                  02868899
028689            AND E.PO_NBR           =  D.PO_NBR                    02868999
028690            AND E.REC_SEQ_NBR      =  D.REC_SEQ_NBR               02869099
028691            AND D.VER_STAT_CDE     =  'A'                         02869199
028692            AND E.PO_NBR           =  C.PO_NBR                    02869299
028693            AND D.SEQ_NBR          =  C.SEQ_NBR                   02869399
028694            AND C.SHIPT_UNT_ID     =  B.SHIPT_UNT_ID              02869499
028695            AND C.SHIPT_UNT_ID     =  A.SHIPT_UNT_ID              02869599
028696            AND B.ACTV_IND         =  'A'                         02869699
028697            AND A.SHIPT_UNT_ID =                                  02869799
028698                (SELECT MAX (G.SHIPT_UNT_ID)                      02869899
028699                   FROM TSHUUPC G                                 02869999
028700                      , TSHPUNT H                                 02870099
028701                  WHERE G.TRN_NBR          = A.TRN_NBR            02870199
028702                    AND G.TRN_LNE_NBR      = A.TRN_LNE_NBR        02870299
028703                    AND G.SHIPT_UNT_ID     = H.SHIPT_UNT_ID       02870399
028704                    AND H.ACTV_IND         = 'A'                  02870499
028705                    AND H.ORGN_OPER_UNT_ID = B.ORGN_OPER_UNT_ID)  02870599
028706     END-EXEC.                                                    02870699
028707                                                                  02870799
028708     EVALUATE TRUE                                                02870899
028709         WHEN SQLCODE = +0                                        02870999
028710             CONTINUE                                             02871099
028711         WHEN SQLCODE = +100                                      02871199
028712             CONTINUE                                             02871299
028713         WHEN OTHER                                               02871399
028714            MOVE '3040-SELECT-FROM-TSHUUPC'                       02871499
028715                               TO PV-ABEND-PARAGRAPH              02871599
028716            MOVE SQLCODE       TO PV-SQL-CODE                     02871699
028717            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02871799
028718            MOVE 'TSHUUPC'     TO PV-ABEND-STRUCTURE              02871899
028719            PERFORM 9900-SQL-ERROR                                02871999
028720     END-EVALUATE.                                                02872099
028721/                                                                 02872199
028722***************************************************************** 02872299
028723* 3050-SELECT-COUNT-TRECITM.                                      02872399
028724***************************************************************** 02872499
028725 3050-SELECT-COUNT-TRECITM.                                       02872599
028726                                                                  02872699
028727     MOVE 0                      TO PV-PREPK-CNT.                 02872799
028728     MOVE RECITM-PREPK-ID        TO DK-RECITM-PREPK-ID.           02872899
028729                                                                  02872999
028730     EXEC SQL                                                     02873099
028731         SELECT COUNT(*)                                          02873199
028732           INTO :PV-PREPK-CNT  :PV-NULL-IND                       02873299
028733           FROM TRECITM                                           02873399
028734          WHERE ORD_NBR       =  :DK-PO-NBR                       02873499
028735            AND REC_SEQ_NBR   =  :DK-REC-SEQ-NBR                  02873599
028736            AND PREPK_ID      =  :DK-RECITM-PREPK-ID              02873699
028737            AND VER_STATUS_CDE = 'A'                              02873799
028738     END-EXEC.                                                    02873899
028739                                                                  02873999
028740     EVALUATE TRUE                                                02874099
028741         WHEN SQLCODE = +0                                        02874199
028742             CONTINUE                                             02874299
028743         WHEN SQLCODE = +100                                      02874399
028744             CONTINUE                                             02874499
028745         WHEN OTHER                                               02874599
028746            MOVE '3050-SELECT-COUNT-TRECITM'                      02874699
028747                               TO PV-ABEND-PARAGRAPH              02874799
028748            MOVE SQLCODE       TO PV-SQL-CODE                     02874899
028749            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02874999
028750            MOVE 'TRECEIV'     TO PV-ABEND-STRUCTURE              02875099
028751            PERFORM 9900-SQL-ERROR                                02875199
028752     END-EVALUATE.                                                02875299
028753/                                                                 02875399
028754***************************************************************** 02875499
028755* 3060-SELECT-COUNT-TSHUUPC.                                      02875599
028756*     SELECT CARTON RATIO                                         02875699
028757***************************************************************** 02875799
028758 3060-SELECT-COUNT-TSHUUPC.                                       02875899
028759                                                                  02875999
028760     MOVE 0                      TO PV-SHIPD-CNT.                 02876099
028761     MOVE SHUUPC-SHIPT-UNT-ID    TO DK-SHIPT-UNT-ID.              02876199
028762                                                                  02876299
028763     EXEC SQL                                                     02876399
028764         SELECT COUNT(TRN_LNE_NBR)                                02876499
028765           INTO :PV-SHIPD-CNT  :PV-NULL-IND                       02876599
028766           FROM TSHUUPC                                           02876699
028772          WHERE SHIPT_UNT_ID     =  :DK-SHIPT-UNT-ID              02877299
028795     END-EXEC.                                                    02879599
028796                                                                  02879699
028797     EVALUATE TRUE                                                02879799
028798         WHEN SQLCODE = +0                                        02879899
028799             CONTINUE                                             02879999
028800         WHEN SQLCODE = +100                                      02880099
028801             CONTINUE                                             02880199
028802         WHEN OTHER                                               02880299
028803            MOVE '3060-SELECT-COUNT-TSHUUPC'                      02880399
028804                               TO PV-ABEND-PARAGRAPH              02880499
028805            MOVE SQLCODE       TO PV-SQL-CODE                     02880599
028806            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02880699
028807            MOVE 'TSHUUPC'     TO PV-ABEND-STRUCTURE              02880799
028808            PERFORM 9900-SQL-ERROR                                02880899
028809     END-EVALUATE.                                                02880999
028810/                                                                 02881099
028811* END   CR#1X0  JAK  08/20/2009                                   02881199
028812***************************************************************** 02881299
028813* 4000-SELECT-UCC128-COUNT.                                       02881399
028814*     COUNT AT PO/RECEIVER LEVEL                                  02881499
028815***************************************************************** 02881599
028816 4000-SELECT-UCC128-COUNT.                                        02881699
028817                                                                  02881799
028818     MOVE +0 TO PV-UCC128-COUNT.                                  02881899
028819                                                                  02881999
028820     EXEC SQL                                                     02882099
028821         SELECT  COUNT(*)                                         02882199
028822           INTO  :PV-UCC128-COUNT                                 02882299
028823           FROM  TPKSLIP A                                        02882399
028824                ,TINPKSU B                                        02882499
028825                ,TSHUUPC C                                        02882599
028826          WHERE  A.PO_NBR         = :DK-PO-NBR                    02882699
028827            AND  A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR               02882799
028828            AND  A.VER_STAT_CDE   = 'A'                           02882899
028829            AND  A.PKSL_STAT_CDE  = 'AC'                          02882999
028830            AND  B.PO_NBR         = A.PO_NBR                      02883099
028831            AND  B.SEQ_NBR        = A.SEQ_NBR                     02883199
028832            AND  C.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                02883299
028833            AND  C.TRN_NBR        = B.PO_NBR                      02883399
028834            AND  C.TRN_LNE_NBR    > 0                             02883499
028835            AND  C.SHPD_QTY       > 0                             02883599
028836     END-EXEC.                                                    02883699
028837                                                                  02883799
028838     EVALUATE TRUE                                                02883899
028839         WHEN SQLCODE = +0                                        02883999
028840             CONTINUE                                             02884099
028841         WHEN SQLCODE = +100                                      02884199
028842             CONTINUE                                             02884299
028843         WHEN OTHER                                               02884399
028844            MOVE '4000-SELECT-UCC128-COUNT'                       02884499
028845                               TO PV-ABEND-PARAGRAPH              02884599
028846            MOVE SQLCODE       TO PV-SQL-CODE                     02884699
028847            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02884799
028848            MOVE 'TPKSLIP'     TO PV-ABEND-STRUCTURE              02884899
028849            PERFORM 9900-SQL-ERROR                                02884999
028850     END-EVALUATE.                                                02885099
028851                                                                  02885199
028852     IF ( PV-UCC128-COUNT > +0 )                                  02885299
028853         SET PS-UCC128-DATA-YES TO TRUE                           02885399
028854     ELSE                                                         02885499
028855         SET PS-UCC128-DATA-NO  TO TRUE                           02885599
028856     END-IF.                                                      02885699
028857/                                                                 02885799
028858***************************************************************** 02885899
028859* 4005-SELECT-UCC128-CRTN-COUNT.                                  02885999
028860*     COUNT AT PO/RECEIVER/LINE LEVEL                             02886099
028861***************************************************************** 02886199
028862 4005-SELECT-UCC128-CRTN-COUNT.                                   02886299
028863                                                                  02886399
028864     MOVE +0 TO PV-UCC128-CRTN-COUNT.                             02886499
028865                                                                  02886599
028866     EXEC SQL                                                     02886699
028867         SELECT  COUNT(DISTINCT C.SHIPT_UNT_ID)                   02886799
028868           INTO  :PV-UCC128-CRTN-COUNT                            02886899
028869           FROM  TPKSLIP A                                        02886999
028870                ,TINPKSU B                                        02887099
028871                ,TSHUUPC C                                        02887199
028872          WHERE  A.PO_NBR         = :DK-PO-NBR                    02887299
028873            AND  A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR               02887399
028874            AND  A.VER_STAT_CDE   = 'A'                           02887499
028875            AND  A.PKSL_STAT_CDE  = 'AC'                          02887599
028876            AND  B.PO_NBR         = A.PO_NBR                      02887699
028877            AND  B.SEQ_NBR        = A.SEQ_NBR                     02887799
028878            AND  C.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                02887899
028879            AND  C.TRN_NBR        = A.PO_NBR                      02887999
028880            AND  C.TRN_LNE_NBR    = :DK-PO-LINE-NBR               02888099
028881     END-EXEC.                                                    02888199
028882                                                                  02888299
028883     EVALUATE TRUE                                                02888399
028884         WHEN SQLCODE = +0                                        02888499
028885             CONTINUE                                             02888599
028886         WHEN SQLCODE = +100                                      02888699
028887             CONTINUE                                             02888799
028888         WHEN OTHER                                               02888899
028889            MOVE '4005-SELECT-UCC128-CRTN-COUNT'                  02888999
028890                               TO PV-ABEND-PARAGRAPH              02889099
028891            MOVE SQLCODE       TO PV-SQL-CODE                     02889199
028892            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02889299
028893            MOVE 'TPKSLIP'     TO PV-ABEND-STRUCTURE              02889399
028894            PERFORM 9900-SQL-ERROR                                02889499
028895     END-EVALUATE.                                                02889599
028896/                                                                 02889699
028897***************************************************************** 02889799
028898* 4010-SELECT-UCC128-TOTL-UNITS.                                  02889899
028899*     SUMM UCC128 TOTAL UNITS                                     02889999
028900***************************************************************** 02890099
028901 4010-SELECT-UCC128-CRTN-COUNT.                                   02890199
028902                                                                  02890299
028903     MOVE +0 TO PV-UCC128-TOTL-UNITS                              02890399
028904                PV-UCC128-TOTL-OTPK-QTY.                          02890499
028905                                                                  02890599
028906     EXEC SQL                                                     02890699
028907         SELECT SUM(C.SHPD_QTY)                                   02890799
028908               ,COUNT(DISTINCT C.SHPD_QTY)                        02890899
028909           INTO :PV-UCC128-TOTL-UNITS                             02890999
028910               ,:PV-UCC128-TOTL-OTPK-QTY                          02891099
028911           FROM TPKSLIP A                                         02891199
028912               ,TINPKSU B                                         02891299
028913               ,TSHUUPC C                                         02891399
028914          WHERE A.PO_NBR        = :DK-PO-NBR                      02891499
028915            AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 02891599
028916            AND A.VER_STAT_CDE  = 'A'                             02891699
028917            AND A.PKSL_STAT_CDE = 'AC'                            02891799
028918            AND B.PO_NBR        = A.PO_NBR                        02891899
028919            AND B.SEQ_NBR       = A.SEQ_NBR                       02891999
028920            AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  02892099
028921            AND C.TRN_NBR       = A.PO_NBR                        02892199
028922            AND C.TRN_LNE_NBR   = :DK-PO-LINE-NBR                 02892299
028923     END-EXEC.                                                    02892399
028924                                                                  02892499
028925     EVALUATE TRUE                                                02892599
028926         WHEN SQLCODE = +0                                        02892699
028927             CONTINUE                                             02892799
028928         WHEN SQLCODE = +100                                      02892899
028929             CONTINUE                                             02892999
028930         WHEN OTHER                                               02893099
028931            MOVE '4010-SELECT-UCC128-CRTN-COUNT'                  02893199
028932                               TO PV-ABEND-PARAGRAPH              02893299
028933            MOVE SQLCODE       TO PV-SQL-CODE                     02893399
028934            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02893499
028935            MOVE 'TPKSLIP'     TO PV-ABEND-STRUCTURE              02893599
028936            PERFORM 9900-SQL-ERROR                                02893699
028937     END-EVALUATE.                                                02893799
028938/                                                                 02893899
028939***************************************************************** 02893999
028940* 4015-SELECT-UCC128-LINES-CRTN.                                  02894099
028941*     SUMM UCC128 LINES PER CARTON                                02894199
028942***************************************************************** 02894299
028943 4015-SELECT-UCC128-LINES-CRTN.                                   02894399
028944                                                                  02894499
028945     MOVE +0 TO PV-UCC128-LINES-PER-CRTN.                         02894599
028946                                                                  02894699
028947     EXEC SQL                                                     02894799
028948         SELECT COUNT(DISTINCT D.TRN_LNE_NBR)                     02894899
028949           INTO :PV-UCC128-LINES-PER-CRTN                         02894999
028950           FROM TPKSLIP A                                         02895099
028951               ,TINPKSU B                                         02895199
028952               ,TSHUUPC C                                         02895299
028953               ,TSHUUPC D                                         02895399
028954          WHERE A.PO_NBR        = :DK-PO-NBR                      02895499
028955            AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 02895599
028956            AND A.VER_STAT_CDE  = 'A'                             02895699
028957            AND A.PKSL_STAT_CDE = 'AC'                            02895799
028958            AND B.PO_NBR        = A.PO_NBR                        02895899
028959            AND B.SEQ_NBR       = A.SEQ_NBR                       02895999
028960            AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  02896099
028961            AND C.TRN_NBR       = B.PO_NBR                        02896199
028962            AND C.TRN_LNE_NBR   = :DK-PO-LINE-NBR                 02896299
028963            AND D.SHIPT_UNT_ID  = C.SHIPT_UNT_ID                  02896399
028964            AND D.TRN_NBR       = B.PO_NBR                        02896499
028965     END-EXEC.                                                    02896599
028966                                                                  02896699
028967     EVALUATE TRUE                                                02896799
028968         WHEN SQLCODE = +0                                        02896899
028969             CONTINUE                                             02896999
028970         WHEN SQLCODE = +100                                      02897099
028971             CONTINUE                                             02897199
028972         WHEN OTHER                                               02897299
028973            MOVE '4015-SELECT-UCC128-LINES-CRTN'                  02897399
028974                               TO PV-ABEND-PARAGRAPH              02897499
028975            MOVE SQLCODE       TO PV-SQL-CODE                     02897599
028976            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02897699
028977            MOVE 'TPKSLIP'     TO PV-ABEND-STRUCTURE              02897799
028978            PERFORM 9900-SQL-ERROR                                02897899
028979     END-EVALUATE.                                                02897999
028980/                                                                 02898099
028981***************************************************************** 02898199
028982* 4020-SELECT-EXPECTED-ITM-QTY.                                   02898299
028983*     SUMM EXPECTED ITEM QUANTITY                                 02898399
028984***************************************************************** 02898499
028985 4020-SELECT-EXPECTED-ITM-QTY.                                    02898599
028986                                                                  02898699
028987     EXEC SQL                                                     02898799
028988         SELECT  SUM(EXPTED_ITM_QTY)                              02898899
028989           INTO :PV-TRANSC-QTY :DN-REC-DISTR                      02898999
028990           FROM  TRECDIS                                          02899099
028991          WHERE ORD_NBR        = :DK-PO-NBR                       02899199
028992            AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  02899299
028993            AND ORD_LNE_NBR    = :DK-PO-LINE-NBR                  02899399
028994     END-EXEC.                                                    02899499
028995                                                                  02899599
028996     EVALUATE TRUE                                                02899699
028997         WHEN SQLCODE = +0                                        02899799
028998             IF DN-REC-DISTR = 1                                  02899899
028999                MOVE ZEROES TO PV-TRANSC-QTY                      02899999
029000             END-IF                                               02900099
029001         WHEN SQLCODE = +100                                      02900199
029002             CONTINUE                                             02900299
029003         WHEN OTHER                                               02900399
029004            MOVE '4020-SELECT-EXPECTED-ITM-QTY'                   02900499
029005                               TO PV-ABEND-PARAGRAPH              02900599
029006            MOVE SQLCODE       TO PV-SQL-CODE                     02900699
029007            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02900799
029008            MOVE 'TRECDIS'     TO PV-ABEND-STRUCTURE              02900899
029009            PERFORM 9900-SQL-ERROR                                02900999
029010     END-EVALUATE.                                                02901099
029011/                                                                 02901199
029012***************************************************************** 02901299
029013* 4025-SELECT-UCC128-TOTL-UNITS                                   02901399
029014*     SUMM UCC128 TOTAL UNITS                                     02901499
029015***************************************************************** 02901599
029016 4025-SELECT-UCC128-TOTL-UNITS.                                   02901699
029017                                                                  02901799
029018     MOVE +0 TO PV-UCC128-TOTL-UNITS.                             02901899
029019                                                                  02901999
029020     EXEC SQL                                                     02902099
029021         SELECT SUM(C.SHPD_QTY)                                   02902199
029022           INTO :PV-UCC128-TOTL-UNITS                             02902299
029023           FROM TPKSLIP A                                         02902399
029024               ,TINPKSU B                                         02902499
029025               ,TSHUUPC C                                         02902599
029026          WHERE A.PO_NBR        = :DK-PO-NBR                      02902699
029027            AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 02902799
029028            AND A.VER_STAT_CDE  = 'A'                             02902899
029029            AND A.PKSL_STAT_CDE = 'AC'                            02902999
029030            AND B.PO_NBR        = A.PO_NBR                        02903099
029031            AND B.SEQ_NBR       = A.SEQ_NBR                       02903199
029032            AND C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  02903299
029033            AND C.TRN_NBR       = A.PO_NBR                        02903399
029034****GB      AND C.TRN_LNE_NBR   = :DK-PO-LINE-NBR                 02903499
029035     END-EXEC.                                                    02903599
029036                                                                  02903699
029037     EVALUATE TRUE                                                02903799
029038         WHEN SQLCODE = +0                                        02903899
029039         WHEN SQLCODE = +100                                      02903999
029040         WHEN SQLCODE = -305                                      02904099
029041             CONTINUE                                             02904199
029042         WHEN OTHER                                               02904299
029043            MOVE '4025-SELECT-UCC128-TOTL-UNITS'                  02904399
029044                               TO PV-ABEND-PARAGRAPH              02904499
029045            MOVE SQLCODE       TO PV-SQL-CODE                     02904599
029046            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02904699
029047            MOVE 'TPKSLIP'     TO PV-ABEND-STRUCTURE              02904799
029048            PERFORM 9900-SQL-ERROR                                02904899
029049     END-EVALUATE.                                                02904999
029050/                                                                 02905099
029051***************************************************************** 02905199
029052* 4030-SELECT-EXPECTED-ITM-QTY.                                   02905299
029053*     SUMM EXPECTED ITEM QUANTITY                                 02905399
029054***************************************************************** 02905499
029055 4030-SELECT-EXPECTED-ITM-QTY.                                    02905599
029056                                                                  02905699
029057     EXEC SQL                                                     02905799
029058         SELECT  SUM(EXPTED_ITM_QTY)                              02905899
029059           INTO :PV-TRANSC-QTY                                    02905999
029060           FROM  TRECDIS                                          02906099
029061          WHERE ORD_NBR        = :DK-PO-NBR                       02906199
029062            AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  02906299
029063***GB       AND ORD_LNE_NBR    = :DK-PO-LINE-NBR                  02906399
029064     END-EXEC.                                                    02906499
029065                                                                  02906599
029066     EVALUATE TRUE                                                02906699
029067         WHEN SQLCODE = +0                                        02906799
029068         WHEN SQLCODE = +100                                      02906899
029069         WHEN SQLCODE = -305                                      02906999
029070             CONTINUE                                             02907099
029071         WHEN OTHER                                               02907199
029072            MOVE '4030-SELECT-EXPECTED-ITM-QTY'                   02907299
029073                               TO PV-ABEND-PARAGRAPH              02907399
029074            MOVE SQLCODE       TO PV-SQL-CODE                     02907499
029075            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02907599
029076            MOVE 'TRECDIS'     TO PV-ABEND-STRUCTURE              02907699
029077            PERFORM 9900-SQL-ERROR                                02907799
029078     END-EVALUATE.                                                02907899
029079/                                                                 02907999
029080***************************************************************** 02908099
029081* 4100-SELECT-EXPECTED-CARTONS.                                   02908199
029082*     WHEN CARTON COUNT IS ZERO FROM CHECK OF UCC128 DATA, SELECT 02908299
029083*     EXPECTED CARTON COUNT FROM SHIPMENT TO PO TABLE             02908399
029084***************************************************************** 02908499
029085 4100-SELECT-EXPECTED-CARTONS.                                    02908599
029086                                                                  02908699
029087     MOVE +0   TO PV-EXPCTD-CRTN-COUNT.                           02908799
029088                                                                  02908899
029089     EXEC SQL                                                     02908999
029090         SELECT  SUM(EXPTED_CART_CNT)                             02909099
029091           INTO :PV-EXPCTD-CRTN-COUNT                             02909199
029092           FROM  TSHPTPO                                          02909299
029093           WHERE PO_NBR      = :DK-PO-NBR                         02909399
029094             AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                    02909499
029095     END-EXEC.                                                    02909599
029096                                                                  02909699
029097     EVALUATE TRUE                                                02909799
029098         WHEN SQLCODE = +0                                        02909899
029099         WHEN SQLCODE = +100                                      02909999
029100         WHEN SQLCODE = -305                                      02910099
029101             CONTINUE                                             02910199
029102         WHEN OTHER                                               02910299
029103            MOVE '4100-SELECT-EXPECTED-CARTONS'                   02910399
029104                               TO PV-ABEND-PARAGRAPH              02910499
029105            MOVE SQLCODE       TO PV-SQL-CODE                     02910599
029106            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02910699
029107            MOVE 'TSHPTPO'     TO PV-ABEND-STRUCTURE              02910799
029108            PERFORM 9900-SQL-ERROR                                02910899
029109     END-EVALUATE.                                                02910999
029110/                                                                 02911099
029111***************************************************************** 02911199
029112* 4200-SELECT-EXPTD-CRTNS-TRLR                                    02911299
029113*     SELECT TOTAL EXPECTED CARTONS ON A TRAILER                  02911399
029114***************************************************************** 02911499
029115 4200-SELECT-EXPTD-CRTNS-TRLR.                                    02911599
029116                                                                  02911699
029117     MOVE +0   TO PV-EXPCTD-CRTN-TRLR.                            02911799
029118                                                                  02911899
029119     EXEC SQL                                                     02911999
029120         SELECT SUM(D.EXPTED_CART_CNT)                            02912099
029121           INTO :PV-EXPCTD-CRTN-TRLR                              02912199
029122         FROM  TVHTRIP A                                          02912299
029123             , TSHIPMT B                                          02912399
029124             , TSHPTPO C                                          02912499
029125             , TRECEIV D                                          02912599
029126         WHERE A.TRIP_ID           = :DK-INTR-TRIP-ID             02912699
029127           AND A.TRIP_ID           = B.TRIP_ID                    02912799
029128           AND C.SHIPT_ID          = B.SHIPT_ID                   02912899
029129           AND C.PO_NBR          = D.ORD_NBR                      02912999
029130           AND C.REC_SEQ_NBR     = D.REC_SEQ_NBR                  02913099
029131           AND D.VER_STATUS_CDE  = 'A'                            02913199
029132     END-EXEC.                                                    02913299
029133                                                                  02913399
029134     EVALUATE TRUE                                                02913499
029135         WHEN SQLCODE = +0                                        02913599
029136         WHEN SQLCODE = +100                                      02913699
029137         WHEN SQLCODE = -305                                      02913799
029138             CONTINUE                                             02913899
029139         WHEN OTHER                                               02913999
029140            MOVE '4200-SELECT-EXPTD-CRTNS-TRLR'                   02914099
029141                               TO PV-ABEND-PARAGRAPH              02914199
029142            MOVE SQLCODE       TO PV-SQL-CODE                     02914299
029143            MOVE 'SELECT'      TO PV-ABEND-OPERATION              02914399
029144            MOVE 'TRECEIV'     TO PV-ABEND-STRUCTURE              02914499
029145            PERFORM 9900-SQL-ERROR                                02914599
029146     END-EVALUATE.                                                02914699
029147/                                                                 02914799
029148******************************************************************02914899
029149* 7000-WRITE-OUTPUT.                                             *02914999
029150******************************************************************02915099
029151 7000-WRITE-OUTPUT.                                               02915199
029152                                                                  02915299
029153     MOVE WST00001-DEST-LOC-NBR TO WS056-DEST-LOC-NBR.            02915399
029154     MOVE WST00001-EXT-SHP-ID   TO WS056-ORIG-SHIPMT-NBR.         02915499
029155     MOVE DK-INTR-TRIP-ID       TO WS056-TRIP-ID.                 02915599
029156     MOVE VHTRIP-OWNER-SCAC-ID  TO WS056-SCAC.                    02915699
029157     MOVE VHTRIP-VEH-NBR        TO WS056-VEHICLE.                 02915799
029158     MOVE TRIPST-TRIP-STATUS-CDE TO WS056-TRIP-STATUS.            02915899
029159     MOVE DK-PO-NBR             TO WS056-PO-NUMBER.               02915999
029160     MOVE DK-REC-SEQ-NBR        TO WS056-REC-SEQ-NUMBER.          02916099
029161     MOVE DK-PO-LINE-NBR        TO WS056-LINE-NUMBER.             02916199
029162     MOVE DK-PREPK-ID           TO WS056-PACK-ID.                 02916299
029163     MOVE PURCHS-PKGNG-CDE      TO WS056-PO-PACK-TYPE.            02916399
029164                                                                  02916499
029165     IF PV-UCC128-CRTN-COUNT > 0                                  02916599
029166        MOVE PV-UCC128-CRTN-COUNT  TO WS056-CARTON-CNT            02916699
029167     ELSE                                                         02916799
029168        PERFORM 4100-SELECT-EXPECTED-CARTONS                      02916899
029169        MOVE PV-EXPCTD-CRTN-COUNT  TO WS056-CARTON-CNT            02916999
029170     END-IF                                                       02917099
029171                                                                  02917199
029172     IF ( RECEIV-PACK-BY-ST-IND = 'Y' )                           02917299
029173         MOVE 'K'               TO WS056-PO-RCVR-PACK-TYPE        02917399
029174     ELSE                                                         02917499
029175         MOVE RECEIV-PKGNG-CDE  TO WS056-PO-RCVR-PACK-TYPE        02917599
029176     END-IF.                                                      02917699
029177     MOVE PV-EXPCTD-CRTN-TRLR   TO WS056-TOT-CRTNS-BY-SHPMT.      02917799
029178     MOVE XLT00003-SKU-NBR      TO WS056-SKU-NUMBER.              02917899
029179                                                                  02917999
029180     IF ( WST00002-DWNLD-CDE = 'T' )                              02918099
029181         MOVE 'Y'               TO WS056-TROUBLE-IND              02918199
029182     ELSE                                                         02918299
029183         MOVE 'N'               TO WS056-TROUBLE-IND              02918399
029184     END-IF.                                                      02918499
029185                                                                  02918599
029186     MOVE PV-PROCESS-QTY        TO WS056-PROCESS-QTY.             02918699
029187     MOVE PV-TRANSC-QTY         TO WS056-TRANSC-QTY.              02918799
029188                                                                  02918899
029189     WRITE OUTPUT01-RECORD                                        02918999
029190          FROM WS056-DOWNLOAD-ERRORS-RECORD.                      02919099
029191                                                                  02919199
029192     ADD  +1 TO PV-OUTPUT01-COUNT.                                02919299
029200/                                                                 02920078
033100******************************************************************03310001
033200* 9900-SQL-ERROR.                                                *03320001
033300******************************************************************03330001
033400 9900-SQL-ERROR.                                                  03340001
033500                                                                  03350001
033600     MOVE SQLCODE               TO SQLCODE2.                      03360001
033700     DISPLAY '** ABEND **       ** = SQLERROR'.                   03370001
033800     DISPLAY '** PROGRAM        ** = WSKUT042'.                   03380001
033900     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        03390001
034000     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION.        03400001
034100     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE.        03410001
034200     DISPLAY SPACES                                               03420001
034300                                                                  03430001
034400     COPY DPPD004.                                                03440001
034500     SET ABEND-4013-DB2-ERROR   TO TRUE                           03450001
034600     CALL 'ILBOABN0' USING ABEND-CODE.                            03460001
