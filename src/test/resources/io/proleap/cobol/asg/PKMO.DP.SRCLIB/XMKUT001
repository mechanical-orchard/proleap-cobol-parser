      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.       XMKUT001.                                      00050000
       AUTHOR.           MARIA KLAMIK.                                  00060000
       INSTALLATION.     KOHLS.                                         00070000
       DATE-WRITTEN      JULY, 2004.                                    00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      *  PROGRAM REQUESTS FOR SKU/STORE ONHAND AND ONORDER:             00120000
      *      PROGRAMS WILL CALL THIS MODULE TO REQUEST ON-HAND          00130000
      *      AND ON-ORDER DATA.                                         00140000
      *                                                                 00151000
      *  PLEASE NOTE THAT WHEN CALLING THIS MODULE THE CALLING          00152000
      *  PROGRAM'S DB2 PLAN MUST INCLUDE THE XM COLLECTION ID.          00153000
      *                                                                 00154000
      *  CHANGE LOG:                                                    00155000
      *                                                                 00156000
      *  07/28/04 - MARIA KLAMIK                                        00157000
      *             (WR #26354) NEW SUBROUTINE FOR MERCHANDISING        00158002
      *             INFORMATION.                                        00159000
      ******************************************************************00160000
                                                                        00170000
      ******************************************************************00180000
       ENVIRONMENT DIVISION.                                            00190000
      ******************************************************************00200000
       CONFIGURATION SECTION.                                           00201000
                                                                        00202000
       SOURCE-COMPUTER. IBM-3090.                                       00203000
       OBJECT-COMPUTER. IBM-3090.                                       00204000
      *                                                                 00205000
      ******************************************************************00220000
       DATA DIVISION.                                                   00230000
      ******************************************************************00240000
                                                                        00250000
       WORKING-STORAGE SECTION.                                         00260000
                                                                        00280000
       01  PC-PROGRAM-CONSTANTS.                                        00330000
           05 PC-PROGRAM-NAME                PIC  X(08)  VALUE          00340000
                                                         'XMKUT001'.    00350000
       01  PV-PROGRAM-VARIABLES.                                        00390000
           05  PV-SKU                 PIC S9(8)V  VALUE ZEROS           00400000
                                                  COMP-3.               00410000
           05  PV-ITEM-NBR            PIC S9(15)  VALUE ZEROS           00460000
                                                  COMP-3.               00470000
           05  PV-STR-NBR             PIC S9(04)  VALUE ZEROS           00480000
                                                  COMP.                 00481000
           05  PV-ONORD-UNT-QTY       PIC S9(07)  VALUE ZEROS           00482000
                                                  COMP.                 00483000
           05  PV-NULL-IND            PIC S9(04)  COMP.                 00484000
           05  PV-DATE-YMD             PIC 9(6)     VALUE ZERO.         00484500
           05  FILLER                  REDEFINES PV-DATE-YMD.           00484600
               10  PV-DATE-YY          PIC 9(2).                        00484700
               10  PV-DATE-MM          PIC 9(2).                        00484800
               10  PV-DATE-DD          PIC 9(2).                        00484900
           05  PV-DATE-DB2.                                             00485000
               10  PV-DATE-CC-DB2      PIC X(2).                        00485100
               10  PV-DATE-YY-DB2      PIC X(2).                        00485200
               10  FILLER              PIC X(1)  VALUE '-'.             00485300
               10  PV-DATE-MM-DB2      PIC X(2).                        00485400
               10  FILLER              PIC X(1)  VALUE '-'.             00485500
               10  PV-DATE-DD-DB2      PIC X(2).                        00485600
                                                                        00485700
      *---------------------------------------------------------------  00581000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE NI-SKU XREF TABLE  00582000
      *---------------------------------------------------------------  00583000
           EXEC SQL                                                     00584000
               INCLUDE TSKXREF                                          00585000
           END-EXEC.                                                    00586000
                                                                        00587000
      *---------------------------------------------------------------  00588000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SKU STORE          00589000
      *  ON-HAND TABLE                                                  00589100
      *---------------------------------------------------------------  00590000
           EXEC SQL                                                     00600000
               INCLUDE TSKST                                            00610000
           END-EXEC.                                                    00620000
                                                                        00630000
      *---------------------------------------------------------------  00640000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR ON-ORDER QTY TABLE     00650000
      *---------------------------------------------------------------  00660000
           EXEC SQL                                                     00670000
               INCLUDE TSKSTOO                                          00680000
           END-EXEC.                                                    00690000
                                                                        00700000
      *---------------------------------------------------------------  00810000
      *  COMMUNICATIONS AREA FOR DB2                                    00820000
      *---------------------------------------------------------------  00830000
           EXEC SQL                                                     00840000
               INCLUDE SQLCA                                            00850000
           END-EXEC.                                                    00860000
                                                                        00861000
      *----------------------------------------------------------------*00870000
      * COMMON COPYBOOK USED TO CALL THIS MODULE.                       00871000
      *----------------------------------------------------------------*00872000
           COPY XMWS004.                                                00873000
                                                                        00880000
       LINKAGE SECTION.                                                 00890000
                                                                        00900000
      * ************************************************************** *00901000
      * * MATCHES LENGTH OF COPYBOOK XMWS004.                           00902000
      * * COPYBOOK XMWS004 CONTAINS THE INPUT / OUTPUT PARAMETERS.      00903000
      * ************************************************************** *00904000
       01  LS-XMWS004                PIC X(200).                        00910000
                                                                        00920000
      ******************************************************************00960000
       PROCEDURE DIVISION USING LS-XMWS004.                             00970000
      ******************************************************************00980000
                                                                        00990000
           PERFORM 1000-HOUSEKEEPING.                                   00991000
                                                                        01050100
           PERFORM 2000-SELECT-TSKXREF.                                 01051000
                                                                        01051100
           IF XM004-SUCCESSFUL                                          01052000
              IF XM004-ONORDER-YES                                      01053000
                   PERFORM 3000-SELECT-ONORDER                          01055000
              END-IF                                                    01057000
              IF XM004-ONHAND-YES                                       01057100
                   PERFORM 4000-SELECT-ONHAND                           01057300
              END-IF                                                    01057500
           ELSE                                                         01058000
              IF XM004-ONORDER-YES                                      01070000
                  SET XM004-ONORDER-ERROR-Y TO TRUE                     01071000
              END-IF                                                    01072000
              IF XM004-ONHAND-YES                                       01073000
                  SET XM004-ONHAND-ERROR-Y TO TRUE                      01074000
              END-IF                                                    01075000
           END-IF.                                                      01076000
                                                                        01077000
           MOVE  XM004-CURR-POSITION-DATA TO LS-XMWS004.                01410000
                                                                        01420000
           GOBACK.                                                      01430000
                                                                        01440000
      *---------------------------------------------------------------  01440100
      *  INITIALIZE VALUES FOR PROCESSING.                              01440200
      *---------------------------------------------------------------  01440300
       1000-HOUSEKEEPING.                                               01441000
                                                                        01441200
           MOVE LS-XMWS004 TO XM004-CURR-POSITION-DATA.                 01442000
                                                                        01444000
           INITIALIZE  PV-PROGRAM-VARIABLES.                            01444100
                                                                        01445000
           SET XM004-SUCCESSFUL        TO TRUE.                         01445100
           SET XM004-ONORDER-ERROR-N   TO TRUE.                         01445200
           SET XM004-ONHAND-ERROR-N    TO TRUE.                         01445300
                                                                        01446000
      *---------------------------------------------------------------  01450000
      *  SELECT ITEM NUMBER FROM TSKXREF.                               01460000
      *---------------------------------------------------------------  01470000
       2000-SELECT-TSKXREF.                                             01820100
                                                                        01820200
           INITIALIZE DCLTSKXREF.                                       01820300
           MOVE XM004-KEY-SKU     TO PV-SKU.                            01820400
                                                                        01820500
           EXEC SQL                                                     01821000
               SELECT  ITM_NBR                                          01822000
                 INTO  :SKXREF-ITM-NBR                                  01825000
                 FROM  TSKXREF                                          01828000
                WHERE  SKU  =  :PV-SKU                                  01829000
           END-EXEC.                                                    01829100
                                                                        01829200
           EVALUATE TRUE                                                01830000
               WHEN SQLCODE = ZERO                                      01840000
                   SET XM004-SUCCESSFUL    TO TRUE                      01850000
               WHEN SQLCODE = +100                                      01860000
                   SET XM004-NOT-SUCCESSFUL TO TRUE                     01870000
                   MOVE SQLCODE            TO XM004-RETURN-SQLCODE      01871000
               WHEN SQLWARN0 NOT = SPACES                               01880000
               WHEN SQLCODE < ZERO                                      01890000
               WHEN SQLCODE > ZERO                                      01900000
                   SET XM004-NOT-SUCCESSFUL TO TRUE                     01910000
                   MOVE SQLCODE            TO XM004-RETURN-SQLCODE      01911000
           END-EVALUATE.                                                01920000
                                                                        01930000
      *---------------------------------------------------------------  02181000
      *  SELECT/SUM THE ON-ORDER DATA IN TSKSTOO.                       02182000
      *  PLESE NOTE THAT THE REQUESTER COULD SEND EITHER A SPECIFIC     02182100
      *  STORE NUMBER OR THE CORPORATE STORE ZERO.                      02182200
      *  TSKSTOO DOES NOT HAVE A SUMMARY ROW AVAILABLE ON THE TABLE.    02182300
      *---------------------------------------------------------------  02183000
       3000-SELECT-ONORDER.                                             02190000
                                                                        02200000
           MOVE SKXREF-ITM-NBR       TO PV-ITEM-NBR.                    02231000
           IF XM004-KEY-STR-NBR       > ZERO                            02760300
               MOVE XM004-KEY-STR-NBR TO  PV-STR-NBR                    02760400
                                                                        02760500
               EXEC SQL                                                 02760600
                   SELECT SUM(ONORD_UNT_QTY)                            02760700
                   INTO :PV-ONORD-UNT-QTY:PV-NULL-IND                   02760800
                   FROM TSKSTOO                                         02760900
                  WHERE ITM_NBR   = :PV-ITEM-NBR                        02761000
                    AND STR_NBR   = :PV-STR-NBR                         02761100
               END-EXEC                                                 02761200
                                                                        02761300
           ELSE                                                         02761400
                                                                        02761500
               EXEC SQL                                                 02761600
                   SELECT SUM(ONORD_UNT_QTY)                            02761700
                   INTO :PV-ONORD-UNT-QTY:PV-NULL-IND                   02761800
                   FROM TSKSTOO                                         02761900
                  WHERE ITM_NBR   = :PV-ITEM-NBR                        02762000
               END-EXEC                                                 02762100
           END-IF.                                                      02762200
                                                                        02762300
           EVALUATE TRUE                                                02762400
               WHEN SQLCODE = ZERO                                      02762500
                   IF (PV-NULL-IND = -1)                                02762600
                      MOVE ZERO            TO PV-ONORD-UNT-QTY          02762700
                   ELSE                                                 02762800
                      MOVE PV-ONORD-UNT-QTY                             02762900
                                           TO XM004-ONORDER             02763000
                   END-IF                                               02763100
               WHEN SQLCODE = +100                                      02763200
                   MOVE 0                  TO XM004-ONORDER             02763300
                   MOVE SQLCODE            TO XM004-RETURN-SQLCODE      02763400
               WHEN SQLWARN0 NOT = SPACES                               02763500
               WHEN SQLCODE < ZERO                                      02763600
               WHEN SQLCODE > ZERO                                      02763700
                   SET XM004-ONORDER-ERROR-Y                            02763800
                                           TO TRUE                      02763900
                   MOVE SQLCODE            TO XM004-RETURN-SQLCODE      02764000
           END-EVALUATE.                                                02764100
                                                                        02764200
      *---------------------------------------------------------------  02764300
      *  SELECT THE ON-HAND DATA IN TSKST.                              02764400
      *---------------------------------------------------------------  02764500
       4000-SELECT-ONHAND.                                              02764600
                                                                        02764700
           MOVE SKXREF-ITM-NBR       TO PV-ITEM-NBR.                    02764800
           MOVE XM004-KEY-STR-NBR    TO PV-STR-NBR.                     02764900
                                                                        02765000
            EXEC SQL                                                    02765100
               SELECT  LAST_SALE_DATE                                   02765200
                    ,  LAST_RCVD_DATE                                   02765300
                    ,  ONHAND_QTY                                       02765400
                    ,  FIRST_RCVD_DATE                                  02765500
                    ,  FIRST_SALE_DATE                                  02765600
                    ,  YTD_SALES_UNIT_QTY                               02765700
                    ,  YTD_SALES_AMT                                    02765800
                    ,  LAST_UPD_TMST                                    02765900
                 INTO  :TSKST-LAST-SALE-DATE                            02766000
                     , :TSKST-LAST-RCVD-DATE                            02766100
                     , :TSKST-ONHAND-QTY                                02766200
                     , :TSKST-FIRST-RCVD-DATE                           02766300
                     , :TSKST-FIRST-SALE-DATE                           02766400
                     , :TSKST-YTD-SALES-UNIT-QTY                        02766500
                     , :TSKST-YTD-SALES-AMT                             02766600
                     , :TSKST-LAST-UPD-TMST                             02766700
                 FROM  TSKST                                            02766800
                WHERE  ITEM_NMBR  = :PV-ITEM-NBR                        02766900
                  AND  LOC_NBR    = :PV-STR-NBR                         02767000
            END-EXEC.                                                   02767100
                                                                        02767200
           EVALUATE TRUE                                                02767300
               WHEN SQLCODE = ZERO                                      02767400
                   MOVE TSKST-ONHAND-QTY   TO XM004-ONHAND              02767500
                   PERFORM 5000-CONVERT-SALE-RCVD-DATES                 02767600
                   MOVE TSKST-YTD-SALES-AMT                             02767700
                                           TO XM004-YTD-SALES-AMT       02767800
                   MOVE TSKST-YTD-SALES-UNIT-QTY                        02767900
                                           TO XM004-YTD-SALES-UNIT-QTY  02768000
                   MOVE TSKST-LAST-UPD-TMST                             02768100
                                           TO XM004-LAST-UPD-TMST       02768200
               WHEN SQLCODE = +100                                      02768300
                   MOVE 0                  TO XM004-ONHAND              02768400
                                              XM004-YTD-SALES-AMT       02768900
                                              XM004-YTD-SALES-UNIT-QTY  02769000
                   MOVE SPACES             TO XM004-LAST-SALE-DATE      02769103
                                              XM004-FIRST-RCVD-DATE     02769203
                                              XM004-FIRST-SALE-DATE     02769303
                                              XM004-LAST-RCVD-DATE      02769403
                   MOVE SQLCODE             TO XM004-RETURN-SQLCODE     02769500
               WHEN SQLWARN0 NOT = SPACES                               02769600
               WHEN SQLCODE < ZERO                                      02769700
               WHEN SQLCODE > ZERO                                      02769800
                   SET XM004-ONHAND-ERROR-Y TO TRUE                     02769900
                   MOVE SQLCODE             TO XM004-RETURN-SQLCODE     02770000
           END-EVALUATE.                                                02780000
                                                                        03021000
      *---------------------------------------------------------------  03030000
      * CONVERT THE TSKST SALES AND RECEIVED DATES TO STANDARD          03031000
      * DB2 DATE FORMAT.                                                03032000
      *---------------------------------------------------------------  03050000
       5000-CONVERT-SALE-RCVD-DATES.                                    03060000
                                                                        03061000
      *- FIRST RECEIPT DATE                                             03070000
           INITIALIZE   PV-DATE-YMD                                     03080000
                        PV-DATE-DB2.                                    03090000
                                                                        03100000
           MOVE TSKST-FIRST-RCVD-DATE  TO PV-DATE-YMD.                  03110000
                                                                        03120000
           IF PV-DATE-YY > 80                                           03130000
               MOVE 19             TO PV-DATE-CC-DB2                    03140000
           ELSE                                                         03150000
               MOVE 20             TO PV-DATE-CC-DB2                    03160000
           END-IF.                                                      03170000
                                                                        03180000
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   03190000
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   03200000
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   03210000
                                                                        03220000
           MOVE PV-DATE-DB2        TO XM004-FIRST-RCVD-DATE.            03230000
                                                                        03240000
      *- FIRST SALE DATE                                                03250000
           INITIALIZE   PV-DATE-YMD                                     03260000
                        PV-DATE-DB2.                                    03270000
                                                                        03280000
           MOVE TSKST-FIRST-SALE-DATE  TO PV-DATE-YMD.                  03290000
                                                                        03300000
           IF PV-DATE-YY > 80                                           03310000
               MOVE 19             TO PV-DATE-CC-DB2                    03320000
           ELSE                                                         03330000
               MOVE 20             TO PV-DATE-CC-DB2                    03340000
           END-IF.                                                      03350000
                                                                        03360000
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   03370000
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   03380000
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   03390000
                                                                        03400000
           MOVE PV-DATE-DB2        TO XM004-FIRST-SALE-DATE.            03410000
                                                                        03420000
      *- LAST RECEIPT DATE                                              03430000
           INITIALIZE   PV-DATE-YMD                                     03440000
                        PV-DATE-DB2.                                    03450000
                                                                        03460000
           MOVE TSKST-LAST-RCVD-DATE   TO PV-DATE-YMD.                  03470000
                                                                        03480000
           IF PV-DATE-YY > 80                                           03490000
               MOVE 19             TO PV-DATE-CC-DB2                    03500000
           ELSE                                                         03510000
               MOVE 20             TO PV-DATE-CC-DB2                    03520000
           END-IF.                                                      03530000
                                                                        03540000
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   03550000
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   03560000
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   03570000
                                                                        03580000
           MOVE PV-DATE-DB2        TO XM004-LAST-RCVD-DATE.             03590000
                                                                        03600000
      *- LAST SALE DATE                                                 03610000
           INITIALIZE   PV-DATE-YMD                                     03620000
                        PV-DATE-DB2.                                    03630000
                                                                        03640000
           MOVE TSKST-LAST-SALE-DATE   TO PV-DATE-YMD.                  03650000
                                                                        03660000
           IF PV-DATE-YY > 80                                           03670000
               MOVE 19             TO PV-DATE-CC-DB2                    03680000
           ELSE                                                         03690000
               MOVE 20             TO PV-DATE-CC-DB2                    03700000
           END-IF.                                                      03710000
                                                                        03720000
           MOVE PV-DATE-YY         TO PV-DATE-YY-DB2.                   03730000
           MOVE PV-DATE-MM         TO PV-DATE-MM-DB2.                   03740000
           MOVE PV-DATE-DD         TO PV-DATE-DD-DB2.                   03750000
                                                                        03760000
           MOVE PV-DATE-DB2        TO XM004-LAST-SALE-DATE.             03770000
                                                                        03780000
