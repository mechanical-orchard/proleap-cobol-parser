000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             BCKUT015.                                00050008
000600 AUTHOR.                 RICK TULLOCH.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           11-07-19.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*       PREPARE A PLAN OWNER/KEY CONTACT CSV FILE FOR SELECTED   *00120009
001210*  PLAN OWNER (MANAGER) EMPLOYEE IDS.  THE FILE WILL BE USED     *00121009
001220*  FOR ANALYSIS PURPOSES ONLY TO ALIGN WITH FUSION ROSTER        *00122009
001230*  DETAILS BECAUSE OF CHANGES IN HOW THE SUPERVISOR HIERARCHY    *00123009
001231*  INFORMATION WILL BE MANAGED IN FUSION.  THE FILE WILL         *00123110
001232*  CONTAIN A CSV RECORDS FOR EACH DIRECT OR INDIRECT REPORT      *00123210
001233*  TO A REQUESTED PLAN OWNER.  WHEN THERE ARE NO REQUESTS,       *00123310
001234*  THE SELECTION LIST WILL BE EMPTY, AND ONLY THE CSV HEADER     *00123410
001235*  RECORD WILL BE WRITTEN TO THE FILE.                           *00123510
001236*                                                                *00123610
001237*       THE SELECTED PLAN OWNER FILE AND SUPERVISOR ALL REPORTS  *00123710
001238*  FILES MUST BE IN ASCENDING SUPERVISOR EMPLOYEE ID SEQUENCE.   *00123810
001300******************************************************************00130000
001400                                                                  00140000
001500******************************************************************00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700******************************************************************00170000
001800                                                                  00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
003220     SELECT SUPERVISOR-ALL-EMPL-FILE                              00322000
003230         ASSIGN TO INP01.                                         00323000
003240                                                                  00324000
003241     SELECT BC-PLAN-OWNER-FILE                                    00324103
003242         ASSIGN TO INP02.                                         00324203
003243                                                                  00324303
003244     SELECT PLAN-OWNER-CONTACT-FILE                               00324403
003245         ASSIGN TO OUT01.                                         00324503
003246                                                                  00324603
003250******************************************************************00325000
003260 DATA DIVISION.                                                   00326000
003270******************************************************************00327000
003280                                                                  00328000
003290 FILE SECTION.                                                    00329000
005200                                                                  00520000
005300 FD  SUPERVISOR-ALL-EMPL-FILE                                     00530000
005400     RECORDING MODE IS F                                          00540000
005500     LABEL RECORDS ARE STANDARD                                   00550000
005600     BLOCK CONTAINS 0 RECORDS                                     00560000
005610     RECORD CONTAINS 14 CHARACTERS                                00561000
005620     DATA RECORDS IS SA-SUPERVISOR-ALL-EMPL-RECORD.               00562002
005630                                                                  00563000
005640 01  SA-SUPERVISOR-ALL-EMPL-RECORD                                00564000
005650                                 PIC X(14).                       00565000
005651                                                                  00565103
005652 FD  BC-PLAN-OWNER-FILE                                           00565203
005653     RECORDING MODE IS F                                          00565303
005654     LABEL RECORDS ARE STANDARD                                   00565403
005655     BLOCK CONTAINS 0 RECORDS                                     00565503
005656     RECORD CONTAINS 80 CHARACTERS                                00565606
005657     DATA RECORDS IS BP-BC-PLAN-OWNER-RECORD.                     00565703
005658                                                                  00565803
005659 01  BP-BC-PLAN-OWNER-RECORD     PIC X(80).                       00565906
005661                                                                  00566103
005662 FD  PLAN-OWNER-CONTACT-FILE                                      00566203
005663     RECORDING MODE IS F                                          00566303
005664     LABEL RECORDS ARE STANDARD                                   00566403
005665     BLOCK CONTAINS 0 RECORDS                                     00566503
005666     RECORD CONTAINS 19 CHARACTERS                                00566603
005667     DATA RECORDS IS PO-PLAN-OWNER-CONTACT-RECORD.                00566703
005668                                                                  00566803
005669 01  PO-PLAN-OWNER-CONTACT-RECORD                                 00566903
005670                                 PIC X(19).                       00567003
005671                                                                  00567103
005672 WORKING-STORAGE SECTION.                                         00567203
005680                                                                  00568000
005690 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO          00569000
005700                                              COMP SYNC.          00570000
005750     88  AC-TABLE-OVERFLOW-ERROR              VALUE +4004.        00575004
005760     88  AC-FILE-SEQUENCE-ERROR               VALUE +4007.        00576004
005800                                                                  00580000
005900 01  PS-PROGRAM-SWITCHES.                                         00590000
006000     05  PS-END-OF-SUPER-FILE-SW                                  00600000
006100                                 PIC X(1)     VALUE 'N'.          00610000
006200         88  PS-END-OF-SUPER-FILE             VALUE 'Y'.          00620000
006201     05  PS-END-OF-OWNER-FILE-SW                                  00620103
006202                                 PIC X(1)     VALUE 'N'.          00620203
006203         88  PS-END-OF-OWNER-FILE             VALUE 'Y'.          00620303
006210     05  PS-PLAN-OWNER-SW        PIC X(1)     VALUE 'N'.          00621001
006230         88  PS-NOT-A-PLAN-OWNER              VALUE 'N'.          00623007
006240         88  PS-PLAN-OWNER                    VALUE 'Y'.          00624001
006300                                                                  00630000
006400 01  PC-PROGRAM-CONSTANTS.                                        00640000
006500     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'BCKUT014'.   00650000
006600     05  PC-MAXIMUM-PLAN-OWNER-CNT                                00660004
006700                                 PIC S9(4)    VALUE +1000         00670004
006800                                              COMP SYNC.          00680004
006900                                                                  00690000
007000 01  PV-PROGRAM-VARIABLES.                                        00700000
007100     05  PV-CURRENT-SUPERVISOR   PIC X(7)     VALUE SPACES.       00710000
007110     05  PV-PLAN-OWNER-COUNT     PIC S9(4)    VALUE ZEROS         00711004
007120                                              COMP SYNC.          00712004
007200                                                                  00720004
007300 01  PO-PLAN-OWNER-TABLE.                                         00730004
007310     05  PO-PLAN-OWNER-ENTRY     OCCURS 1000 TIMES                00731004
007320                                 ASCENDING KEY PO-PLAN-OWNER-ID   00732004
007330                                 INDEXED BY PO-INDEX.             00733004
007340         10  PO-PLAN-OWNER-ID    PIC X(7).                        00734004
007400                                                                  00740000
007500 01  SR-SUPERVISOR-RECORD.                                        00750000
007800     05  SR-SUPERVISOR-EMPLOYEE-ID                                00780000
007900                                 PIC X(7)     VALUE SPACES.       00790000
008000     05  SR-REPORT-EMPLOYEE-ID   PIC X(7)     VALUE SPACES.       00800000
008200                                                                  00820000
008220 01  BP-PLAN-OWNER-RECORD.                                        00822004
008230     05  BP-PLAN-OWNER-EMPLOYEE-ID                                00823004
008240                                 PIC X(7)     VALUE SPACES.       00824004
008241     05  FILLER                  PIC X(73)    VALUE SPACES.       00824106
008250                                                                  00825004
008300 01  CH-CSV-HEADER-RECORD.                                        00830000
008400     05  FILLER                  PIC X(1)     VALUE '"'.          00840000
008500     05  FILLER                  PIC X(7)     VALUE 'TEAMID'.     00850000
008600     05  FILLER                  PIC X(3)     VALUE '","'.        00860000
008700     05  FILLER                  PIC X(7)     VALUE 'CONTACT'.    00870000
010600     05  FILLER                  PIC X(1)     VALUE '"'.          01060000
010700                                                                  01070000
010800 01  CD-CSV-DETAIL-RECORD.                                        01080000
010900     05  FILLER                  PIC X(1)     VALUE '"'.          01090000
011000     05  CD-SUPERVISOR-EMPLOYEE-ID                                01100001
011010                                 PIC X(7)     VALUE SPACES.       01101001
011100     05  FILLER                  PIC X(3)     VALUE '","'.        01110000
011200     05  CD-KEY-CONTACT-EMPLOYEE-ID                               01120001
011300                                 PIC X(7)     VALUE SPACES.       01130000
011400     05  FILLER                  PIC X(1)     VALUE '"'.          01140001
013699                                                                  01369900
013700******************************************************************01370000
013800 PROCEDURE DIVISION.                                              01380000
013900******************************************************************01390000
014000                                                                  01400000
014100 0000-MAINLINE.                                                   01410000
014200                                                                  01420000
014300     PERFORM 1000-INITIALIZE.                                     01430000
014400                                                                  01440000
014500     PERFORM 2000-PROCESS-SUPERVISOR                              01450001
014600         UNTIL PS-END-OF-SUPER-FILE.                              01460000
014700                                                                  01470000
014800     PERFORM 9000-EOJ-ROUTINE.                                    01480000
014900                                                                  01490000
015000     GOBACK.                                                      01500000
015100                                                                  01510000
015200******************************************************************01520000
015300*  INITIALIZE FOR PROGRAM PROCESSING.  OPEN ALL FILES.  LOAD THE *01530003
015310*  PLAN OWNER TABLE.  READ THE FIRST SUPERVISOR ALL REPORTS      *01531003
015400*  RECORD.  WRITE THE CSV PLAN OWNER/KEY CONTACT HEADER RECORD.  *01540003
015600******************************************************************01560000
015700                                                                  01570000
015800 1000-INITIALIZE.                                                 01580000
015900     OPEN INPUT  SUPERVISOR-ALL-EMPL-FILE                         01590001
015910                 BC-PLAN-OWNER-FILE                               01591003
016000          OUTPUT PLAN-OWNER-CONTACT-FILE.                         01600001
016200                                                                  01620000
016210     PERFORM 1100-LOAD-PLAN-OWNER-TABLE.                          01621004
016366                                                                  01636604
016370     PERFORM 7000-READ-SUPERVISOR-FILE.                           01637003
016400                                                                  01640000
016500     PERFORM 8000-WRITE-CSV-HEADER-RECORD.                        01650000
016600*1000-EXIT.                                                       01660000
016700                                                                  01670000
016800******************************************************************01680000
016900*  LOAD THE SELECTED PLAN OWNER TABLE.  SET ALL DATA TO HIGH     *01690010
016910*  VALUES.  READ A SELECTED PLAN OWNER RECORD.  IF THE FILE      *01691010
016920*  IS NOT IN ASCENDING SEQUENCE, ABEND WITH A FILE SEQUENCE      *01692010
016930*  ERROR.  IF THE ENTRY WOULD EXCEED THE MAXIMUM TABLE SIZE,     *01693010
016940*  ABEND WITH A TABLE OVERFLOW ERROR.  LOAD ALL SELECTED PLAN    *01694010
016950*  OWNER RECORDS UNTIL END OF FILE.                              *01695010
017000******************************************************************01700000
017100                                                                  01710000
017200 1100-LOAD-PLAN-OWNER-TABLE.                                      01720004
017230     INITIALIZE PO-PLAN-OWNER-TABLE                               01723004
017240         REPLACING ALPHANUMERIC DATA BY HIGH-VALUES.              01724004
017250     INITIALIZE PV-PLAN-OWNER-COUNT.                              01725004
017251                                                                  01725104
017252     PERFORM 7100-READ-PLAN-OWNER-FILE.                           01725204
017253                                                                  01725304
017260     PERFORM                                                      01726004
017270             VARYING PO-INDEX                                     01727004
017280             FROM 1 BY 1                                          01728004
017290             UNTIL ((PO-INDEX > PC-MAXIMUM-PLAN-OWNER-CNT)        01729004
017291                     OR (PS-END-OF-OWNER-FILE))                   01729104
017292         IF ((PO-INDEX > 1)                                       01729204
017293                 AND (BP-PLAN-OWNER-EMPLOYEE-ID <=                01729304
017294                              PO-PLAN-OWNER-ID (PO-INDEX - 1)))   01729404
017295             DISPLAY '** ABEND **'                                01729504
017296             DISPLAY PC-CURRENT-PROGRAM-NAME  ' - PLAN OWNER '    01729604
017297                       'FILE IS NOT IN ASCENDING EMPLOYEE ID '    01729704
017298                       'SEQUENCE'                                 01729804
017299             DISPLAY PC-CURRENT-PROGRAM-NAME  ' - ERROR OCCURS '  01729904
017300                       'AT PLAN OWNER EMPLOYEE ID '               01730005
017301                       BP-PLAN-OWNER-EMPLOYEE-ID                  01730104
017302             SET AC-FILE-SEQUENCE-ERROR TO TRUE                   01730204
017303             CALL 'ILBOABN0' USING ABEND-CODE                     01730304
017304         END-IF                                                   01730404
017305         MOVE BP-PLAN-OWNER-EMPLOYEE-ID TO                        01730504
017306                   PO-PLAN-OWNER-ID (PO-INDEX)                    01730604
017325         ADD +1 TO PV-PLAN-OWNER-COUNT                            01732504
017326         PERFORM 7100-READ-PLAN-OWNER-FILE                        01732605
017327     END-PERFORM.                                                 01732704
017328                                                                  01732804
017329     IF PO-INDEX > PC-MAXIMUM-PLAN-OWNER-CNT                      01732904
017330         DISPLAY '** ABEND **'                                    01733004
017331         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - MAXIMUM NUMBER OF ' 01733104
017332                   'PLAN OWNER ENTRIES EXCEEDED'                  01733204
017334         DISPLAY PC-CURRENT-PROGRAM-NAME  ' - EXPAND THE TABLE '  01733404
017335                   'AND RERUN'                                    01733504
017336         SET AC-TABLE-OVERFLOW-ERROR TO TRUE                      01733604
017337         CALL 'ILBOABN0' USING ABEND-CODE                         01733704
017338     END-IF.                                                      01733804
017340*1100-EXIT.                                                       01734004
017400                                                                  01740004
017410******************************************************************01741004
017420*  PROCESS A SUPERVISOR.  PERFORM A BINARY SEARCH ON THE         *01742010
017421*  SELECTED PLAN OWNER TABLE.  FOR ALL MATCHING SUPERVISOR ALL   *01742110
017422*  REPORTS RECORDS, IF THE SUPERVISOR EMPLOYEE ID WAS FOUND      *01742210
017423*  ON THE TABLE, WRITE OUT A PLAN OWNER/KEY CONTACT CSV RECORD.  *01742310
017430******************************************************************01743004
017440                                                                  01744004
017450 2000-PROCESS-SUPERVISOR.                                         01745004
017500     MOVE SR-SUPERVISOR-EMPLOYEE-ID TO PV-CURRENT-SUPERVISOR.     01750001
017700                                                                  01770000
017710     SEARCH ALL PO-PLAN-OWNER-ENTRY                               01771004
017720         AT END                                                   01772004
017730             SET PS-NOT-A-PLAN-OWNER TO TRUE                      01773004
017750         WHEN PO-PLAN-OWNER-ID (PO-INDEX) = PV-CURRENT-SUPERVISOR 01775004
017760             SET PS-PLAN-OWNER TO TRUE                            01776004
017799     END-SEARCH.                                                  01779904
017800                                                                  01780004
017810     PERFORM                                                      01781001
017900             UNTIL ((PS-END-OF-SUPER-FILE)                        01790001
018000                     OR (SR-SUPERVISOR-EMPLOYEE-ID NOT =          01800001
018100                                  PV-CURRENT-SUPERVISOR))         01810001
018101         IF PS-PLAN-OWNER                                         01810101
018102             MOVE SR-SUPERVISOR-EMPLOYEE-ID TO                    01810201
018103                       CD-SUPERVISOR-EMPLOYEE-ID                  01810301
018104             MOVE SR-REPORT-EMPLOYEE-ID TO                        01810401
018105                       CD-KEY-CONTACT-EMPLOYEE-ID                 01810501
018106             PERFORM 8100-WRITE-CSV-DETAIL-RECORD                 01810601
018107         END-IF                                                   01810701
018108         PERFORM 7000-READ-SUPERVISOR-FILE                        01810801
018110     END-PERFORM.                                                 01811001
018400*2000-EXIT.                                                       01840000
020500                                                                  02050000
020600******************************************************************02060000
020700*  READ A SUPERVISOR TO ALL DIRECT AND INDIRECT REPORTS RECORD.  *02070001
020800******************************************************************02080000
020900                                                                  02090000
021000 7000-READ-SUPERVISOR-FILE.                                       02100001
021100     READ SUPERVISOR-ALL-EMPL-FILE                                02110001
021200         INTO SR-SUPERVISOR-RECORD                                02120001
021300         AT END                                                   02130000
021400             SET PS-END-OF-SUPER-FILE TO TRUE                     02140000
021500     END-READ.                                                    02150000
021600*7000-EXIT.                                                       02160000
021610                                                                  02161003
021620******************************************************************02162003
021630*  READ A SUPERVISOR TO ALL DIRECT AND INDIRECT REPORTS RECORD.  *02163003
021640******************************************************************02164003
021650                                                                  02165003
021660 7100-READ-PLAN-OWNER-FILE.                                       02166003
021670     READ BC-PLAN-OWNER-FILE                                      02167003
021680         INTO BP-PLAN-OWNER-RECORD                                02168003
021690         AT END                                                   02169003
021691             SET PS-END-OF-OWNER-FILE TO TRUE                     02169103
021692     END-READ.                                                    02169203
021693*7100-EXIT.                                                       02169303
021700                                                                  02170000
021800******************************************************************02180000
021900*  WRITE A CSV SUPERVISOR HEADER RECORD.                         *02190000
022000******************************************************************02200000
022100                                                                  02210000
022200 8000-WRITE-CSV-HEADER-RECORD.                                    02220000
022300     WRITE PO-PLAN-OWNER-CONTACT-RECORD                           02230001
022400         FROM CH-CSV-HEADER-RECORD.                               02240000
022500*8000-EXIT.                                                       02250000
022600                                                                  02260000
022700******************************************************************02270000
022800*  WRITE A CSV SUPERVISOR DETAIL RECORD.                         *02280000
022900******************************************************************02290000
023000                                                                  02300000
023100 8100-WRITE-CSV-DETAIL-RECORD.                                    02310000
023200     WRITE PO-PLAN-OWNER-CONTACT-RECORD                           02320001
023300         FROM CD-CSV-DETAIL-RECORD.                               02330000
023400*8100-EXIT.                                                       02340000
024400                                                                  02440000
024500******************************************************************02450000
024600*  CLOSE ALL FILES.                                              *02460000
024700******************************************************************02470000
024800                                                                  02480000
024900 9000-EOJ-ROUTINE.                                                02490000
025000     CLOSE SUPERVISOR-ALL-EMPL-FILE                               02500001
025010           BC-PLAN-OWNER-FILE                                     02501003
025100           PLAN-OWNER-CONTACT-FILE.                               02510001
025300*9000-EXIT.                                                       02530000
