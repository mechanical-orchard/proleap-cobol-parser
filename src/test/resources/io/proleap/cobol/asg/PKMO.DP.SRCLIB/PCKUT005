000100****************************************************************  00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300****************************************************************  00030011
000400 PROGRAM-ID.    PCKUT005.                                         00040011
000500 AUTHOR.        DAN HINTZ.                                        00050011
000600 DATE-WRITTEN.  APRIL 1997.                                       00060011
000700                                                                  00070011
000800****************************************************************  00080011
000900*   THIS PROGRAM EXTRACTS RECEIPT ITEM INFORMATION FOR LINES      00090011
001000*   PROCESSED IN THE PACK TO LIGHT SYSTEM THAT WERE NOT VERIFIED  00100011
001100*   AUTOMATICALLY AS PART OF THE PACK TO LIGHT VERIFICATION       00110011
001200*   PROCESS.                                                      00120011
001300****************************************************************  00130011
001400                                                                  00140011
001500****************************************************************  00150011
001600 ENVIRONMENT DIVISION.                                            00160011
001700****************************************************************  00170011
001800                                                                  00180011
001900****************************************************************  00190011
002000 INPUT-OUTPUT SECTION.                                            00200011
002100****************************************************************  00210011
002200                                                                  00220011
002300****************************************************************  00230011
002400 FILE-CONTROL.                                                    00240011
002500****************************************************************  00250011
002600     SELECT EXTRACT-FILE                                          00260011
002700         ASSIGN TO OUT01.                                         00270011
002800                                                                  00280011
002900     SELECT ERROR-FILE                                            00290011
003000         ASSIGN TO OUT02.                                         00300011
003100                                                                  00310011
003200****************************************************************  00320011
003300 DATA DIVISION.                                                   00330011
003400****************************************************************  00340011
003500                                                                  00350011
003600****************************************************************  00360011
003700 FILE SECTION.                                                    00370011
003800****************************************************************  00380011
003900                                                                  00390011
004000 FD  EXTRACT-FILE                                                 00400011
004100     RECORDING MODE IS F                                          00410011
004200     LABEL RECORDS ARE STANDARD                                   00420011
004300     RECORD CONTAINS 200                                          00430011
004400     BLOCK CONTAINS 0 RECORDS                                     00440011
004500     DATA RECORD IS EXTRACT-RECORD.                               00450011
004600 01  EXTRACT-RECORD                      PIC  X(200).             00460011
004700*** 2ND OUTPUT FILE FOR RCVR/LINE DELETE ERROR MSGS               00470011
004800 FD  ERROR-FILE                                                   00480011
004900     RECORDING MODE IS F                                          00490011
005000     LABEL RECORDS ARE STANDARD                                   00500011
005100     RECORD CONTAINS 200                                          00510011
005200     BLOCK CONTAINS 0 RECORDS                                     00520011
005300     DATA RECORD IS ERROR-RECORD.                                 00530011
005400 01  ERROR-RECORD                        PIC  X(200).             00540011
005500                                                                  00550011
005600/                                                                 00560011
005700 WORKING-STORAGE SECTION.                                         00570011
005800                                                                  00580011
005900 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   00590011
006000                                                     COMP SYNC.   00600011
006100 01  PV-PROGRAM-VARIABLES.                                        00610011
006200     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     00620011
006300                                                     COMP SYNC.   00630011
006400     05  PV-P2L-QTY                      PIC S9(09)  VALUE ZERO   00640011
006500                                                     COMP SYNC.   00650011
006600     05  PV-FCSE-QTY                     PIC S9(09)  VALUE ZERO   00660011
006700                                                     COMP SYNC.   00670011
006800     05  PV-STORE-COUNT                  PIC S9(09)  VALUE ZERO   00680011
006900                                                     COMP SYNC.   00690011
007000     05  PV-STORE-MSG-POINTER            PIC S9(04)  VALUE ZERO   00700011
007100                                                     COMP SYNC.   00710011
007200     05  PV-STORE-MSG-POINTER-PHYINV     PIC S9(04)  VALUE ZERO   00720011
007300                                                     COMP SYNC.   00730011
007400     05  WS-COUNT                        PIC S9(09)  VALUE +0     00740011
007500                                                     COMP SYNC.   00750011
007600     05  PV-DB2-FREIGHT-COUNT            PIC S9(09)  VALUE ZEROS  00760011
007700                                                     COMP-3.      00770011
007800     05  PV-NBR-OF-STR-MSG-LINES         PIC  9(03)  VALUE ZERO   00780011
007900                                                     COMP-3.      00790011
008000     05  PV-NBR-OF-STRS-ON-MSG-LINE      PIC 9(01) VALUE ZERO.    00800011
008100     05  PV-NBR-OF-STR-MSG-LINES-PHYINV  PIC  9(03)  VALUE ZERO   00810011
008200                                                     COMP-3.      00820011
008300     05  PV-NBROFSTRS-ON-MSGLINE-PHYINV  PIC 9(01) VALUE ZERO.    00830011
008400     05  PV-OTHER-ISSUES-COUNT           PIC 9(03) VALUE ZERO.    00840011
008500     05  PV-PHYINV-COUNT                 PIC 9(03) VALUE ZERO.    00850011
008600     05  PV-OPEN-AUDIT-COUNT             PIC S9(09)  VALUE ZEROS  00860048
008700                                                     COMP-3.      00870048
008800     05  WS-TMSTMP                       PIC  X(26)  VALUE SPACES.00880011
008900     05  PV-CHECK-IN-COUNT               PIC S9(9)   VALUE +0     00890070
009000                                                     COMP-3.      00900070
009100     05  PV-MANIFESTED-COUNT             PIC S9(9)   VALUE +0     00910070
009200                                                     COMP-3.      00920070
009300     05  PV-TMST                         PIC  X(26)  VALUE SPACE. 00930072
009400     05  FILLER  REDEFINES  PV-TMST.                              00940011
009500         10  PV-DATE.                                             00950011
009600             15  PV-TMST-DATE.                                    00960011
009700                 20  PV-TMST-DATE-CC     PIC  X(02).              00970011
009800                 20  PV-TMST-DATE-YY     PIC  X(02).              00980011
009900             15  FILLER                  PIC  X(01).              00990011
010000             15  PV-TMST-DATE-MM         PIC  X(02).              01000011
010100             15  FILLER                  PIC  X(01).              01010011
010200             15  PV-TMST-DATE-DD         PIC  X(02).              01020011
010300         10  FILLER                      PIC  X(16).              01030011
010400     05  PV-DATE2.                                                01040011
010500             15  PV-TMST-DATE-MM2        PIC  X(02).              01050011
010600             15  PV-SLASH1               PIC  X(01).              01060011
010700             15  PV-TMST-DATE-DD2        PIC  X(02).              01070011
010800             15  PV-SLASH2               PIC  X(01).              01080011
010900             15  PV-TMST-DATE2.                                   01090011
011000                 20  PV-TMST-DATE-CC2    PIC  X(02).              01100011
011100                 20  PV-TMST-DATE-YY2    PIC  X(02).              01110011
011200     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 01120011
011300     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(40)  VALUE SPACE. 01130011
011400     05  PV-DISPLAY-KEYS.                                         01140011
011500         10  PV-DISPLAY-ORD-NBR          PIC  9(09)  VALUE ZEROS  01150011
011600                                                 BLANK WHEN ZEROS.01160011
011700         10  FILLER                      PIC  X(02)  VALUE SPACE. 01170011
011800         10  PV-DISPLAY-RCVR-SEQ-NBR     PIC  9(09)  VALUE ZEROS  01180011
011900                                                 BLANK WHEN ZEROS.01190011
012000         10  FILLER                      PIC  X(02)  VALUE SPACE. 01200011
012100         10  PV-DISPLAY-ORD-LNE-NBR      PIC  9(04)  VALUE ZEROS  01210011
012200                                                 BLANK WHEN ZEROS.01220011
012300         10  FILLER                      PIC  X(02)  VALUE SPACE. 01230011
012400         10  PV-DISPLAY-WORK-ORD-SEQ-NBR                          01240011
012500                                         PIC  9(04)  VALUE ZEROS  01250011
012600                                                 BLANK WHEN ZEROS.01260011
012700         10  FILLER                      PIC  X(02)  VALUE SPACE. 01270011
012800         10  PV-DISPLAY-OPER-UNT-ID      PIC  9(04)  VALUE ZEROS  01280011
012900                                                 BLANK WHEN ZEROS.01290011
013000         10  FILLER                      PIC  X(02)  VALUE SPACE. 01300011
013100         10  PV-DISPLAY-FCLTY-ID         PIC  9(04)  VALUE ZEROS  01310011
013200                                                 BLANK WHEN ZEROS.01320011
013300     05  PV-STORE-NUM.                                            01330011
013400         10  PV-NUM-STORE-NUM            PIC  9(03)  VALUE ZEROS. 01340011
013500     05  PV-DETAIL-STATUS.                                        01350011
013600         10  FILLER                      PIC  X(01)  VALUE 'D'.   01360011
013700         10  PV-DETAIL-LINE              PIC  9(02)  VALUE ZEROS. 01370011
013800     05  PV-CURRENT-OPER                 PIC  9(04)  VALUE ZEROS. 01380019
013900     05  PV-DISPLAY-ENT-ID               PIC  9(09)  VALUE ZEROS. 01390011
014000     05  PV-DISPLAY-DEPT-NBR             PIC  9(03)  VALUE ZEROS. 01400011
014100     05  PV-PREV-OPER-EXTRACT            PIC  9(04)  VALUE ZEROS. 01410011
014200     05  PV-PREV-OPER-OLD-RCVR           PIC  9(04)  VALUE ZEROS. 01420011
014300     05  PV-TODAYS-DATE.                                          01430011
014400         10  PV-TODAYS-YY                PIC 9(02)   VALUE ZERO.  01440011
014500         10  PV-TODAYS-MM                PIC 9(02)   VALUE ZERO.  01450011
014600         10  PV-TODAYS-DD                PIC 9(02)   VALUE ZERO.  01460011
014700     05  PV-CURR-COMP-DATE.                                       01470011
014800         10  PV-CURR-COMP-DATE-CC        PIC 9(02)   VALUE ZEROES.01480011
014900         10  PV-CURR-COMP-DATE-YY        PIC 9(02)   VALUE ZEROES.01490011
015000         10  FILLER                      PIC X(01)   VALUE '-'.   01500011
015100         10  PV-CURR-COMP-DATE-MM        PIC 9(02)   VALUE ZEROES.01510011
015200         10  FILLER                      PIC X(01)   VALUE '-'.   01520011
015300         10  PV-CURR-COMP-DATE-DD        PIC 9(02)   VALUE ZEROES.01530011
015400     05  PV-TSTR-COMP-DATE               PIC X(10)   VALUE SPACES.01540011
015500     05  PV-DATE-MMDDYY.                                          01550011
015600         10  PV-MM                       PIC 9(02)   VALUE ZEROES.01560011
015700         10  PV-DD                       PIC 9(02)   VALUE ZEROES.01570011
015800         10  PV-YY                       PIC 9(02)   VALUE ZEROES.01580011
015900         10  FILLER                      PIC X(04)   VALUE SPACES.01590011
016000     05  PV-COMPARE-DATE.                                         01600011
016100         10  PV-COMPARE-YY               PIC 9(04)   VALUE ZEROES.01610011
016200         10  FILLER REDEFINES PV-COMPARE-YY.                      01620011
016300             15  PV-COMPARE-CC           PIC 9(02).               01630011
016400             15  PV-COMPARE-CY           PIC 9(02).               01640011
016500         10  PV-COMPARE-MM               PIC 9(02)   VALUE ZEROES.01650011
016600         10  PV-COMPARE-DD               PIC 9(02)   VALUE ZEROES.01660011
016700     05  PV-WRITE-DATE.                                           01670011
016800         10  PV-WRITE-MM                 PIC 9(02)   VALUE ZEROES.01680011
016900         10  FILLER                      PIC X(01)   VALUE '/'.   01690011
017000         10  PV-WRITE-DD                 PIC 9(02)   VALUE ZEROES.01700011
017100         10  FILLER                      PIC X(01)   VALUE '/'.   01710011
017200         10  PV-WRITE-YY                 PIC 9(02)   VALUE ZEROES.01720011
017300     05  PV-REC-DATE.                                             01730011
017400         10  PV-REC-YY                   PIC 9(04)   VALUE ZEROES.01740011
017500         10  PV-REC-MM                   PIC 9(02)   VALUE ZEROES.01750011
017600         10  PV-REC-DD                   PIC 9(02)   VALUE ZEROES.01760011
017700     05  PV-HOLD-CURR-DATE.                                       01770011
017800         10  PV-HOLD-CURR-CC             PIC 9(02)   VALUE ZEROES.01780011
017900         10  PV-HOLD-CURR-YY             PIC 9(02)   VALUE ZEROES.01790011
018000         10  PV-HOLD-CURR-MM             PIC 9(02)   VALUE ZEROES.01800011
018100         10  PV-HOLD-CURR-DD             PIC 9(02)   VALUE ZEROES.01810011
018200     05  PV-HOLD-CUTOFF-DATE.                                     01820011
018300         10  PV-HOLD-CUTOFF-CC           PIC 9(02)   VALUE ZEROES.01830011
018400         10  PV-HOLD-CUTOFF-YY           PIC 9(02)   VALUE ZEROES.01840011
018500         10  PV-HOLD-CUTOFF-MM           PIC 9(02)   VALUE ZEROES.01850011
018600         10  PV-HOLD-CUTOFF-DD           PIC 9(02)   VALUE ZEROES.01860011
018700     05  PV-HOLD-CALC-DATE.                                       01870015
018800         10  PV-HOLD-CALC-YYYY           PIC X(04).               01880015
018900         10  FILLER                      PIC X(01).               01890011
019000         10  PV-HOLD-CALC-MM             PIC X(02).               01900015
019100         10  FILLER                      PIC X(01).               01910011
019200         10  PV-HOLD-CALC-DD             PIC X(02).               01920015
019300     05  PV-HOLD-FORMAT-DATE.                                     01930015
019400         10  PV-HOLD-FORMAT-MM           PIC X(02).               01940015
019500         10  PV-HOLD-FORMAT-SLASH1       PIC X(01)  VALUE '/'.    01950017
019600         10  PV-HOLD-FORMAT-DD           PIC X(02).               01960015
019700         10  FILLERD-FORMAT-SLASH2       PIC X(01)  VALUE '/'.    01970017
019800         10  PV-HOLD-FORMAT-YYYY         PIC X(04).               01980015
019900     05  PV-WORK-DATE                    PIC X(10)   VALUE ZEROES.01990018
020000     05  FILLER REDEFINES PV-WORK-DATE.                           02000015
020100         10  PV-WORK-CC                  PIC X(02).               02010015
020200         10  PV-WORK-YY                  PIC X(02).               02020015
020300         10  FILLER                      PIC X(01).               02030015
020400         10  PV-WORK-MM                  PIC X(02).               02040015
020500         10  FILLER                      PIC X(01).               02050015
020600         10  PV-WORK-DD                  PIC X(02).               02060015
020700     05  PV-HOLD-WORK-DATE.                                       02070011
020800         10  PV-HOLD-WORK-CC             PIC 9(02)   VALUE ZEROES.02080011
020900         10  PV-HOLD-WORK-YY             PIC 9(02)   VALUE ZEROES.02090011
021000         10  PV-HOLD-WORK-MM             PIC 9(02)   VALUE ZEROES.02100011
021100         10  PV-HOLD-WORK-DD             PIC 9(02)   VALUE ZEROES.02110011
021200                                                                  02120058
021300                                                                  02130058
021400 01  CC-CONTROL-CARD.                                             02140045
021500     05  CC-CONSTANT                 PIC  X(07)      VALUE SPACE. 02150046
021600     05  FILLER                      PIC  X(01)      VALUE SPACE. 02160046
021700     05  CC-TIME-ZONE                PIC  X(25)      VALUE SPACE. 02170046
021800     05  FILLER                      PIC  X(44)      VALUE SPACE. 02180046
021900                                                                  02190046
022000 01  WS-TABLE-AREA.                                               02200011
022100     05  WS-DC-TABLE                 OCCURS 50 TIMES              02210011
022200                                     INDEXED BY DCT-IDX           02220011
022300                                                DCT-MAX-IDX.      02230011
022400         10  WS-DCT-OPER-UNIT-ID     PIC S9(04)    COMP.          02240011
022500         10  WS-DCT-DATA-IND         PIC  X(01).                  02250046
022600             88  WS-DCT-DATA-PROCESSED              VALUE 'Y'.    02260046
022700         10  WS-DCT-OPEN-DATE        PIC  X(10).                  02270046
022800         10  WS-DCT-CLOSE-DATE       PIC  X(10).                  02280046
022900         10  WS-DCT-SPLT-PRC-QTY     PIC S9(5).                   02290046
023000         10  WS-DCT-SPLT-PRC-DATE    PIC  X(10).                  02300046
023100                                                                  02310046
023200     05  WS-OTHER-ISSUES-TABLE       OCCURS 99 TIMES              02320046
023300                                     INDEXED BY MSG-IDX           02330046
023400                                                MSG-MAX-IDX.      02340046
023500         10  WS-OTHER-ISSUES-MSG     PIC  X(35).                  02350046
023600** USED FOR PHY INVENTORY ERROR MSGS ONLY                         02360046
023700     05  WS-PHYINV-MSG-TABLE         OCCURS 99 TIMES              02370046
023800                                     INDEXED BY PHY-IDX           02380046
023900                                                PHY-MAX-IDX.      02390046
024000         10  WS-PHYINV-MSG           PIC  X(30).                  02400046
024100                                                                  02410058
024200 01  DK-DB-KEYS.                                                  02420058
024300     05  DK-STR-NBR                      PIC 9(04).               02430060
024400     05  DK-STR-NBR-X REDEFINES                                   02440058
024500         DK-STR-NBR                      PIC X(04).               02450060
024600                                                                  02460046
024700 01  PC-PROGRAM-CONSTANTS.                                        02470046
024800     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE 3      02480046
024900                                                     COMP-3.      02490046
025000     05  PC-0001-COMP                    PIC S9(04)  VALUE 1      02500046
025100                                                     COMP SYNC.   02510046
025200     05  PC-0001-COMP9                   PIC S9(09)  VALUE 1      02520046
025300                                                     COMP SYNC.   02530046
025400     05  PC-C                            PIC  X(01)  VALUE 'C'.   02540046
025500     05  PC-D                            PIC  X(01)  VALUE 'D'.   02550046
025600     05  PC-I                            PIC  X(01)  VALUE 'I'.   02560046
025700     05  PC-N                            PIC  X(01)  VALUE 'N'.   02570046
025800     05  PC-Y                            PIC  X(01)  VALUE 'Y'.   02580046
025900                                                                  02590046
026000     05  PC-READY-TO-VERIFY              PIC  X(01)  VALUE 'R'.   02600046
026100     05  PC-ERROR-STATUS                 PIC  X(01)  VALUE 'E'.   02610046
026200     05  PC-INV-CYC-STATUS               PIC  X(01)  VALUE 'I'.   02620046
026300     05  PC-ERROR-NO-PRO                 PIC  X(01)  VALUE 'F'.   02630046
026400     05  PC-WAIT-FOR-SPLIT               PIC  X(01)  VALUE 'B'.   02640046
026500     05  PC-PREPK-BAD-RATIO              PIC  X(01)  VALUE 'A'.   02650046
026600     05  PC-NOT-ARRIVED                  PIC  X(01)  VALUE 'G'.   02660046
026700     05  PC-OPEN-SYSTEM-AUDIT            PIC  X(01)  VALUE 'H'.   02670046
026800                                                                  02680046
026900     05  PC-IP                           PIC  X(02)  VALUE 'IP'.  02690046
027000     05  PC-DE                           PIC  X(02)  VALUE 'DE'.  02700046
027100     05  PC-VE                           PIC  X(02)  VALUE 'VE'.  02710046
027200     05  PC-HDR                          PIC  X(03)  VALUE 'HDR'. 02720046
027300     05  PC-0001                         PIC  9(04)  VALUE 1.     02730046
027400     05  PC-19                           PIC  9(02)  VALUE 19.    02740046
027500     05  PC-20                           PIC  9(02)  VALUE 20.    02750046
027600     05  PC-90                           PIC  9(02)  VALUE 90.    02760046
027700     05  PC-85                           PIC  9(04)  VALUE 85.    02770046
027800     05  PC-CORP-OFFICE                  PIC  9(04)  VALUE 90.    02780046
027900     05  PC-SPACES                       PIC  X(22)  VALUE SPACES.02790046
028000     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        02800046
028100         'PCKUT005'.                                              02810046
028200     05  PC-INIT-DATE-YYYYMMDD           PIC  X(10)  VALUE        02820046
028300         '9999-09-09'.                                            02830046
028400     05  PC-INIT-DATE                    PIC  X(10)  VALUE        02840046
028500         '09-09-9999'.                                            02850046
028600     05  PC-INIT-01-DATE                 PIC  X(10)  VALUE        02860046
028700         '01-01-1111'.                                            02870046
028800     05  PC-INIT-DATE-SL                 PIC  X(10)  VALUE        02880046
028900         '09/09/9999'.                                            02890046
029000     05  PC-DEFAULT-DATE                 PIC  X(26)  VALUE        02900046
029100         '9999-00-00-00.00.00.000000'.                            02910046
029200     05  PC-DEFAULT-TMST                 PIC  X(26)  VALUE        02920046
029300         '9999-09-09-09.09.09.999999'.                            02930046
029400                                                                  02940046
029500 01  PC-OTHER-ISSUE-MSGS.                                         02950046
029600     05  PC-MISSING-STORES-TXT           PIC  X(15)  VALUE        02960046
029700         'MISSING STORES:'.                                       02970046
029800     05  PC-VERIFY-MSG-TXT               PIC  X(21)  VALUE        02980046
029900         'LINE WILL BE VERIFIED'.                                 02990046
030000     05  PC-TRBL-MSG-TXT                 PIC  X(30)  VALUE        03000046
030100         'LINE NOT VERIFIED - IN TROUBLE'.                        03010046
030200     05  PC-NO-PRO-MSG-TXT               PIC  X(30)  VALUE        03020046
030300         'LINE NOT VERIFIED - NO PRO NBR'.                        03030046
030400     05  PC-INV-CUT-STORES-TXT           PIC  X(14)  VALUE        03040046
030500         'CUTOFF STORES:'.                                        03050046
030600     05  PC-PHY-INV-MSG-TXT              PIC  X(30)  VALUE        03060046
030700         'LINE NOT VERFD- PHY INV CUTOFF'.                        03070046
030800     05  PC-RCVR-DLT-TEXT                PIC  X(30)  VALUE        03080046
030900         'RCVR DELETED - VERFY OBSOLETED'.                        03090046
031000     05  PC-LINE-DLT-TEXT                PIC  X(30)  VALUE        03100046
031100         'RCV/LNE DELTD- VERFY OBSOLETED'.                        03110046
031200     05  PC-SPLIT-TEXT-FCSE              PIC  X(30)  VALUE        03120046
031300         'WAIT FOR FCSE PRCS TO COMPLETE'.                        03130046
031400     05  PC-SPLIT-TEXT-P2L               PIC  X(30)  VALUE        03140046
031500         'WAIT FOR P2L PRCS TO COMPLETE '.                        03150046
031600     05  PC-PREPK-BAD-RATIO-TXT          PIC  X(30)  VALUE        03160046
031700         'LNE NOT VERFD- BAD PRPAK RATIO'.                        03170046
031800     05  PC-NOT-ARRIVED-TXT              PIC  X(30)  VALUE        03180046
031900         'LNE NOT VERFD - NOT ARRIVED   '.                        03190046
032000     05  PC-P2L-BAD-RATIO-TXT            PIC  X(30)  VALUE        03200046
032100         'BAD P2L RATIO NEED MANUAL VRFY'.                        03210046
032200     05  PC-OPEN-PRMPT-AUDIT-TXT         PIC  X(30)  VALUE        03220047
032300         'OPEN SYSTEM PROMPTED AUDIT    '.                        03230047
032400     05  PC-PBS-NOT-MANIFESTD-TXT        PIC  X(30)  VALUE        03240070
032500         'CHECKED IN NOT ACTIVE         '.                        03250074
032600                                                                  03260046
032700 01  PS-PROGRAM-SWITCHES.                                         03270046
032800     05  PS-LOCATION-CURSOR-SW           PIC  X(01)  VALUE 'N'.   03280055
032900         88  PS-EOF-LOCATION-CSR                      VALUE 'Y'.  03290055
033000     05  PS-END-OF-TDISTHD-CSR-SW        PIC  X(01)  VALUE 'N'.   03300046
033100         88  PS-END-OF-TDISTHD-CSR                   VALUE 'Y'.   03310046
033200         88  PS-NOT-END-OF-TDISTHD-CSR               VALUE 'N'.   03320046
033300     05  PS-END-OF-TDISTDT-CSR-SW        PIC  X(01)  VALUE 'N'.   03330046
033400         88  PS-END-OF-TDISTDT-CSR                   VALUE 'Y'.   03340046
033500         88  PS-NOT-END-OF-TDISTDT-CSR               VALUE 'N'.   03350046
033600     05  PS-ERROR-FOUND-SW               PIC  X(01)  VALUE 'N'.   03360046
033700         88  PS-ERROR-FOUND                          VALUE 'Y'.   03370046
033800         88  PS-ERROR-NOT-FOUND                      VALUE 'N'.   03380046
033900     05  PS-SPLIT-ERROR-SW               PIC  X(01)  VALUE 'N'.   03390046
034000         88  PS-SPLIT-ERROR                          VALUE 'Y'.   03400046
034100         88  PS-SPLIT-ERROR-NOT-FOUND                VALUE 'N'.   03410046
034200     05  PS-FIRST-TABLE-ENTRY-SW         PIC  X(01)  VALUE 'Y'.   03420046
034300         88  PS-FIRST-TABLE-ENTRY                    VALUE 'Y'.   03430046
034400         88  PS-NOT-FIRST-TABLE-ENTRY                VALUE 'N'.   03440046
034500     05  PS-FIRST-STR-MSG-LINE-SW        PIC  X(01)  VALUE 'Y'.   03450046
034600         88  PS-FIRST-STR-MSG-LINE                   VALUE 'Y'.   03460046
034700         88  PS-NOT-FIRST-STR-MSG-LINE               VALUE 'N'.   03470046
034800     05  PS-FIRST-STORE-ERROR-SW         PIC  X(01)  VALUE 'Y'.   03480046
034900         88  PS-FIRST-STORE-ERROR                    VALUE 'Y'.   03490046
035000         88  PS-NOT-FIRST-STORE-ERROR                VALUE 'N'.   03500046
035100     05  PS-FIRST-TABLE-ENTRY-PHYINV-SW  PIC  X(01)  VALUE 'Y'.   03510046
035200         88  PS-FIRST-TABLE-ENTRY-PHYINV             VALUE 'Y'.   03520046
035300         88  PS-NOT-1ST-TABLE-ENTRY-PHYINV           VALUE 'N'.   03530046
035400     05  PS-1ST-STR-MSG-LINE-PHYINV-SW   PIC  X(01)  VALUE 'Y'.   03540046
035500         88  PS-FIRST-STR-MSG-LINE-PHYINV            VALUE 'Y'.   03550046
035600         88  PS-NOT-1ST-STR-MSG-LINE-PHYINV          VALUE 'N'.   03560046
035700     05  PS-FIRST-STORE-ERROR-PHYINV-SW  PIC  X(01)  VALUE 'Y'.   03570046
035800         88  PS-FIRST-STORE-ERROR-PHYINV             VALUE 'Y'.   03580046
035900         88  PS-NOT-1ST-STORE-ERROR-PHYINV           VALUE 'N'.   03590046
036000     05  PS-VALID-DC-SW                  PIC  X(01)  VALUE 'I'.   03600046
036100         88  PS-VALID-DC                             VALUE 'V'.   03610046
036200         88  PS-INVALID-DC                           VALUE 'I'.   03620046
036300     05  PS-TABLE-MATCH-SW               PIC  X(01)  VALUE 'N'.   03630046
036400         88  PS-TABLE-MATCH-FOUND                    VALUE 'Y'.   03640046
036500         88  PS-TABLE-MATCH-NOTFOUND                 VALUE 'N'.   03650046
036600     05  PS-FREIGHT-BILL-SW              PIC  X(01)  VALUE 'N'.   03660046
036700         88  PS-FREIGHT-BILL-FOUND                   VALUE 'Y'.   03670046
036800         88  PS-NO-FREIGHT-BILL                      VALUE 'N'.   03680046
036900     05  PS-ARRIVED-SW                   PIC  X(01)  VALUE 'Y'.   03690046
037000         88  PS-ARRIVED                              VALUE 'Y'.   03700046
037100         88  PS-NOT-ARRIVED                          VALUE 'N'.   03710046
037200     05  PS-P2L-BAD-RATIO-SW             PIC  X(01)  VALUE 'Y'.   03720046
037300         88  PS-NOT-P2L-BAD-RATIO                    VALUE 'Y'.   03730046
037400         88  PS-P2L-BAD-RATIO                        VALUE 'N'.   03740046
037500     05  PS-INV-ERR-SW                   PIC  X(01)  VALUE 'N'.   03750046
037600         88  PS-NO-INV-ERR                           VALUE 'N'.   03760046
037700         88  PS-INV-ERR                              VALUE 'Y'.   03770046
037800     05  PS-INV-CYC-SW                   PIC  X(01)  VALUE 'N'.   03780046
037900         88  PS-INV-CYC-NOT-FOUND                    VALUE 'N'.   03790046
038000         88  PS-INV-CYC-FOUND                        VALUE 'Y'.   03800046
038100     05  PS-STR-INV-CYC-SW               PIC  X(01)  VALUE 'N'.   03810046
038200         88  PS-STR-INV-CYC-NOT-FOUND                VALUE 'N'.   03820046
038300         88  PS-STR-INV-CYC-FOUND                    VALUE 'Y'.   03830046
038310     05  PS-DC-FLUSH-SW                  PIC  X(01)  VALUE 'N'.   03831093
038320         88  PS-DC-FLUSH-YES                         VALUE 'Y'.   03832090
038330         88  PS-DC-FLUSH-NO                          VALUE 'N'.   03833090
038400     05  PS-TRECEIV-SW                   PIC  X(01)  VALUE 'N'.   03840046
038500         88  PS-TRECEIV-NOT-FOUND                    VALUE 'N'.   03850046
038600         88  PS-TRECEIV-FOUND                        VALUE 'Y'.   03860046
038700     05  PS-TPURITM-SW                   PIC  X(01)  VALUE 'N'.   03870046
038800         88  PS-TPURITM-NOT-FOUND                    VALUE 'N'.   03880046
038900         88  PS-TPURITM-FOUND                        VALUE 'Y'.   03890046
039000     05  PS-TRECITM-SW                   PIC  X(01)  VALUE 'N'.   03900046
039100         88  PS-TRECITM-NOT-FOUND                    VALUE 'N'.   03910046
039200         88  PS-TRECITM-FOUND                        VALUE 'Y'.   03920046
039300     05  PS-TKRPRPM-CURSOR-SW            PIC  X(01)  VALUE 'N'.   03930046
039400         88  PS-EOF-TKRPRPM-CSR                      VALUE 'Y'.   03940046
039500     05  PS-OPEN-AUDIT-SW                PIC  X(01)  VALUE 'N'.   03950048
039600         88  PS-OPEN-AUDITS                          VALUE 'Y'.   03960048
039700         88  PS-NO-OPEN-AUDITS                       VALUE 'N'.   03970048
039800                                                                  03980046
039900*                                                                 03990046
040000*  COPY BOOK FOR DATE ROUTINE - DPKUT500                          04000046
040100*                                                                 04010046
040200     COPY DPWS500.                                                04020046
040300                                                                  04030054
040400*                                                                 04040046
040500*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       04050046
040600*                                                                 04060046
040700     COPY DPWS004.                                                04070046
040800                                                                  04080046
040900*                                                                 04090046
041000*  COPY BOOK FOR THE RECEIPT ITEM EXTRACT FILE                    04100046
041100*                                                                 04110046
041200     COPY PCRD003.                                                04120046
041300/                                                                 04130046
041400*  DOMAIN ITEM MODULE                                             04140046
041500     COPY XLWS001.                                                04150046
041600/                                                                 04160046
041700                                                                  04170046
041800*                                                                 04180046
041900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPMENT TABLE     04190046
042000*                                                                 04200046
042100     EXEC SQL                                                     04210046
042200          INCLUDE TSHIPMT                                         04220046
042300     END-EXEC.                                                    04230046
042400                                                                  04240046
042500*                                                                 04250046
042600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CARTON LABEL       04260084
042700*  CROSS REFERENCE TABLE                                          04270084
042800*                                                                 04280046
042900     EXEC SQL                                                     04290046
043000          INCLUDE TSULBXF                                         04300084
043100     END-EXEC.                                                    04310046
043200                                                                  04320046
043300*                                                                 04330084
043400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPMENT/PO TABLE  04340084
043500*                                                                 04350084
043600     EXEC SQL                                                     04360084
043700          INCLUDE TSHPTPO                                         04370084
043800     END-EXEC.                                                    04380084
043900                                                                  04390084
044000*---------------------------------------------------------------* 04400088
044100     EXEC SQL                                                     04410088
044200         INCLUDE TPKSLIP                                          04420088
044300     END-EXEC.                                                    04430088
044400*---------------------------------------------------------------* 04440070
044500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CARTON LOCATION    04450070
044600*  (TSHUNLO)                                                      04460070
044700*---------------------------------------------------------------* 04470070
044800     EXEC SQL                                                     04480070
044900         INCLUDE TSHUNLO                                          04490070
045000     END-EXEC.                                                    04500070
045100                                                                  04510070
045200*---------------------------------------------------------------* 04520070
045300     EXEC SQL                                                     04530070
045400         INCLUDE TINPKSU                                          04540070
045500     END-EXEC.                                                    04550070
045600*                                                                 04560046
045700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     04570046
045800*  HEADER TABLE                                                   04580046
045900*                                                                 04590046
046000     EXEC SQL                                                     04600046
046100          INCLUDE TPURCHS                                         04610046
046200     END-EXEC.                                                    04620046
046300                                                                  04630046
046400*                                                                 04640046
046500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     04650046
046600*  ITEM TABLE                                                     04660046
046700*                                                                 04670046
046800     EXEC SQL                                                     04680046
046900          INCLUDE TPURITM                                         04690046
047000     END-EXEC.                                                    04700046
047100                                                                  04710046
047200*                                                                 04720046
047300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE ENTERPRIZE NAME    04730046
047400*  TABLE.                                                         04740046
047500*                                                                 04750046
047600     EXEC SQL                                                     04760046
047700          INCLUDE TENTNME                                         04770046
047800     END-EXEC.                                                    04780046
047900                                                                  04790046
048000*                                                                 04800046
048100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVER TABLE     04810046
048200*                                                                 04820046
048300     EXEC SQL                                                     04830046
048400          INCLUDE TRECEIV                                         04840046
048500     END-EXEC.                                                    04850046
048600                                                                  04860046
048700*                                                                 04870046
048800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIPT ITEM TABLE 04880046
048900*                                                                 04890046
049000     EXEC SQL                                                     04900046
049100          INCLUDE TRECITM                                         04910046
049200     END-EXEC.                                                    04920046
049300                                                                  04930046
049400*                                                                 04940046
049500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIPT            04950046
049600*  DISTRIBUTION TABLE                                             04960046
049700*                                                                 04970046
049800     EXEC SQL                                                     04980046
049900          INCLUDE TRECDIS                                         04990046
050000     END-EXEC.                                                    05000046
050100                                                                  05010046
050200*                                                                 05020046
050300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TROUBLE NOTIFICATIO05030046
050400*                                                                 05040046
050500     EXEC SQL                                                     05050046
050600          INCLUDE TTRBNTF                                         05060046
050700     END-EXEC.                                                    05070046
050800                                                                  05080046
050900*                                                                 05090046
051000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE LOGISTICS          05100055
051100*  LOCATION TABLE                                                 05110055
051200*  (XLT_LOC)                                                      05120055
051300*                                                                 05130055
051400     EXEC SQL                                                     05140046
051500          INCLUDE XLT00010                                        05150055
051600     END-EXEC.                                                    05160046
051700                                                                  05170046
051800*                                                                 05180046
051900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE DC CNTL TABLE      05190046
052000*                                                                 05200046
052100     EXEC SQL                                                     05210046
052200          INCLUDE TCOCNTL                                         05220046
052300     END-EXEC.                                                    05230046
052400                                                                  05240046
052500*                                                                 05250046
052600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TROUBLE REASON CODE05260046
052700*  TABLE.                                                         05270046
052800*                                                                 05280046
052900     EXEC SQL                                                     05290046
053000          INCLUDE TTRBRSN                                         05300046
053100     END-EXEC.                                                    05310046
053200                                                                  05320046
053300*                                                                 05330046
053400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE DISTRIBUTION       05340046
053500*  HEADER TABLE.                                                  05350046
053600*                                                                 05360046
053700     EXEC SQL                                                     05370046
053800          INCLUDE TDISTHD                                         05380046
053900     END-EXEC.                                                    05390046
054000                                                                  05400046
054100*                                                                 05410046
054200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE DISTRIBUTION       05420046
054300*  DETAIL TABLE.                                                  05430046
054400*                                                                 05440046
054500     EXEC SQL                                                     05450046
054600          INCLUDE TDISTDT                                         05460046
054700     END-EXEC.                                                    05470046
054800                                                                  05480046
054900*                                                                 05490046
055000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE INVENTORY          05500046
055100*  PARAMETER TABLE.                                               05510046
055200*                                                                 05520046
055300     EXEC SQL                                                     05530046
055400          INCLUDE XLT00025                                        05540098
055500     END-EXEC.                                                    05550046
055600                                                                  05560046
055700*                                                                 05570046
055800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PARM TABLE.        05580046
055900*                                                                 05590046
056000     EXEC SQL                                                     05600046
056100          INCLUDE TKRPRPM                                         05610046
056200     END-EXEC.                                                    05620046
056300*                                                                 05630046
056400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                    05640048
056500*  PURCHASE ORDER AUDIT REQUEST TABLE                             05650048
056600*SUT_PO_AUD_REQ                                                   05660048
056700     EXEC SQL                                                     05670048
056800          INCLUDE SUT00015                                        05680048
056900     END-EXEC.                                                    05690048
057000*---------------------------------------------------------------* 05700089
057100*    DB2 AREA FOR OUTBOUND SHIPPING UPC TABLE (SUT_OTBND_UPC)   * 05710089
057200*---------------------------------------------------------------* 05720089
057300     EXEC SQL                                                     05730089
057400          INCLUDE SUT00028                                        05740089
057500     END-EXEC.                                                    05750089
057600*---------------------------------------------------------------* 05760089
057700* DB2 AREA FOR THE OUBOUND SHIPPPING UNIT TABLE (SUT_OTBND_CART)  05770089
057800*---------------------------------------------------------------* 05780089
057900     EXEC SQL                                                     05790089
058000          INCLUDE SUT00024                                        05800089
058100     END-EXEC.                                                    05810089
058200                                                                  05820089
058500*  COMMUNICATION AREAS FOR DB2                                    05850046
058600*                                                                 05860046
058700     EXEC SQL                                                     05870046
058800         INCLUDE SQLCA                                            05880046
058900     END-EXEC.                                                    05890046
059000                                                                  05900046
059200******************************************************************05920046
059300*  TDISTHD CURSOR                                                *05930046
059400******************************************************************05940046
059500     EXEC SQL                                                     05950046
059600          DECLARE TDISTHD_CSR CURSOR FOR                          05960046
059700          SELECT ORD_NBR,                                         05970046
059800                 RCVR_SEQ_NBR,                                    05980046
059900                 ORD_LNE_NBR,                                     05990046
060000                 OPER_UNT_ID,                                     06000046
060100                 PRCG_STAT_CDE,                                   06010046
060200                 PRC_AREA_MODU_ID,                                06020046
060300                 P2L_CART_CNT,                                    06030046
060400                 FCSE_CART_CNT,                                   06040046
060500                 INPK_CART_CNT,                                   06050046
060600                 RSLTS_RCVD_TMST,                                 06060046
060700                 FCSE_CNFRMN_TMST                                 06070046
060800           FROM  TDISTHD                                          06080046
060900          WHERE (PRCG_STAT_CDE NOT IN ('C', 'P', 'V', 'D', 'B'))  06090083
061000             OR (PRCG_STAT_CDE = 'B'  AND                         06100070
061100               (RSLTS_RCVD_TMST = :PC-DEFAULT-TMST OR            06110046
061200                FCSE_CNFRMN_TMST = :PC-DEFAULT-TMST))            06120046
061300            WITH UR                                               06130046
061400     END-EXEC.                                                    06140046
061500                                                                  06150046
061600******************************************************************06160046
061700*  TDISTDT CURSOR                                                *06170046
061800******************************************************************06180046
061900     EXEC SQL                                                     06190046
062000          DECLARE TDISTDT_CSR CURSOR FOR                          06200046
062100           SELECT STR_NBR,                                        06210046
062200                  ACTL_ALLOC_QTY,                                 06220046
062300                  P2L_SPLT_UNT_QTY,                               06230046
062400                  FCSE_SPLT_UNT_QTY,                              06240046
062500                  INPK_SPLT_UNT_QTY,                              06250046
062600                  FCSE_ACTL_UNT_QTY                               06260046
062700             FROM TDISTDT                                         06270046
062800            WHERE ORD_NBR          =  :DISTHD-ORD-NBR             06280046
062900              AND RCVR_SEQ_NBR     =  :DISTHD-RCVR-SEQ-NBR        06290046
063000              AND ORD_LNE_NBR      =  :DISTHD-ORD-LNE-NBR         06300046
063100            WITH UR                                               06310046
063200     END-EXEC.                                                    06320046
063300                                                                  06330046
063400******************************************************************06340046
063500*  LOCATION CURSOR - PICKUP VALID DC'S TO BE REPORTED ON         *06350055
063600*  XLT_LOC (XLT00010)                                             06360085
063700******************************************************************06370055
063800     EXEC SQL                                                     06380055
063900          DECLARE LOCATION_CSR CURSOR FOR                         06390055
064000            SELECT LOC_NBR,                                       06400058
064100                   OPN_DTE,                                       06410055
064200                   CLO_DTE,                                       06420055
064300                   SPLT_PRC_DAYS_QTY                              06430055
064400            FROM   XLT_LOC,                                       06440055
064500                   TCOCNTL                                        06450055
064600            WHERE  LOC_TYP_CDE = 'DC' AND                         06460055
064700                   LOC_NBR     = OPER_UNT_ID                      06470058
064800            ORDER BY 1                                            06480055
064900            WITH UR                                               06490055
065000     END-EXEC.                                                    06500055
065100                                                                  06510055
065200******************************************************************06520055
065300*  TKRPRPM CURSOR - PICKUP VALID DC'S TO BE REPORTED ON          *06530055
065400*  XLT_LOC (XLT00010)                                             06540085
065500******************************************************************06550055
065600     EXEC SQL                                                     06560055
065700          DECLARE TKRPRPM_CSR CURSOR FOR                          06570055
065800            SELECT A.LOC_NBR,                                     06580056
065900                   A.OPN_DTE,                                     06590056
066000                   A.CLO_DTE,                                     06600056
066100                   C.SPLT_PRC_DAYS_QTY                            06610055
066200            FROM   XLT_LOC A,                                     06620056
066300                   TKRPRPM B,                                     06630055
066400                   TCOCNTL C                                      06640055
066500            WHERE  A.LOC_TYP_CDE      = 'DC'                      06650056
066600              AND  A.LOC_NBR          = C.OPER_UNT_ID             06660056
066700              AND  A.LOC_NBR          = B.LOC_ID                  06670056
066800              AND  B.SYS_PRC_FUNC_CDE = 'STATZN'                  06680055
066900              AND  B.FUNC_TXT         = :CC-TIME-ZONE             06690055
067000            ORDER BY 1                                            06700055
067100            WITH UR                                               06710055
067200     END-EXEC.                                                    06720055
067300                                                                  06730055
067400******************************************************************06740055
067500 PROCEDURE DIVISION.                                              06750055
067600******************************************************************06760055
067700                                                                  06770055
067800 0000-MAINLINE.                                                   06780055
067900     OPEN OUTPUT EXTRACT-FILE                                     06790055
068000                 ERROR-FILE.                                      06800055
068100     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           06810055
068200         DISPLAY '** TIMEZONE = ' CC-TIME-ZONE.                   06820055
068300     ACCEPT PV-TODAYS-DATE FROM DATE.                             06830055
068400     IF  PV-TODAYS-YY > PC-90                                     06840055
068500         MOVE PC-19    TO PV-CURR-COMP-DATE-CC                    06850055
068600                          PV-HOLD-CURR-CC                         06860055
068700     ELSE                                                         06870055
068800         MOVE PC-20    TO PV-CURR-COMP-DATE-CC                    06880055
068900                          PV-HOLD-CURR-CC.                        06890055
069000                                                                  06900055
069100     PERFORM 0900-VALIDATE-CONTROL-CARD.                          06910055
069200     MOVE PV-TODAYS-MM TO PV-MM                                   06920055
069300                          PV-CURR-COMP-DATE-MM                    06930055
069400                          PV-HOLD-CURR-MM.                        06940055
069500     MOVE PV-TODAYS-DD TO PV-DD                                   06950055
069600                          PV-CURR-COMP-DATE-DD                    06960055
069700                          PV-HOLD-CURR-DD.                        06970055
069800     MOVE PV-TODAYS-YY TO PV-YY                                   06980055
069900                          PV-CURR-COMP-DATE-YY                    06990055
070000                          PV-HOLD-CURR-YY.                        07000055
070100     MOVE PV-CURR-COMP-DATE TO                                    07010055
070200          PV-TSTR-COMP-DATE.                                      07020055
070300                                                                  07030055
070400*** CHECK FIRST TO SEE IF THE DC'S NEED TO FLUSH THEIR BUILDINGS. 07040090
070410*** IF YES,                                                       07041090
070420*** CHECK IF THERE ARE ANY STORES IN THE PHYSICAL INVENTORY CYCLE 07042090
070500     PERFORM 0100A-CHK4-DC-FLUSH-PARM.                            07050092
070501     IF PS-DC-FLUSH-YES                                           07050192
070510         PERFORM 0100-CHK4-INV-CYCLE                              07051090
070520     END-IF.                                                      07052092
070600                                                                  07060055
070700     IF CC-TIME-ZONE  = 'ALL'                                     07070055
070800         PERFORM 1000-LOAD-DC-TABLE                               07080055
070900     ELSE                                                         07090055
071000         PERFORM 1050-LOAD-DC-TABLE.                              07100055
071100                                                                  07110055
071200     PERFORM 2000-OPEN-TDISTHD-CSR.                               07120055
071300                                                                  07130055
071400     PERFORM 2100-FETCH-TDISTHD-CSR.                              07140055
071500     PERFORM 2200-PROCESS-CSR                                     07150055
071600       UNTIL PS-END-OF-TDISTHD-CSR.                               07160055
071700                                                                  07170055
071800     PERFORM 2300-CLOSE-TDISTHD-CSR.                              07180055
071900                                                                  07190055
072000     PERFORM 8000-CHECK-DC-ENTRIES                                07200055
072100         VARYING DCT-IDX FROM 1 BY 1                              07210055
072200             UNTIL DCT-IDX > DCT-MAX-IDX.                         07220055
072300                                                                  07230055
072400     CLOSE EXTRACT-FILE                                           07240055
072500           ERROR-FILE.                                            07250055
072600                                                                  07260055
072700     GOBACK.                                                      07270055
072800                                                                  07280055
072900******************************************************************07290055
073000*  CHECK TKRPRPM TO SEE IF THE DC'S NEED TO BE FLUSHED.           07300090
073200******************************************************************07320055
073300 0100A-CHK4-DC-FLUSH-PARM.                                        07330090
074300                                                                  07430055
074310     EXEC SQL                                                     07431090
074320          SELECT  FUNC_TXT                                        07432090
074330          INTO   :KRPRPM-FUNC-TXT                                 07433090
074340          FROM  TKRPRPM                                           07434090
074350          WHERE LOC_ID            =  90                           07435090
074360            AND SYS_PRC_FUNC_CDE  =  'FLUSH'                      07436090
074370            AND FUNC_PRC_STAT_CDE =  'AC'                         07437090
074371          WITH UR                                                 07437194
074380     END-EXEC.                                                    07438090
074390                                                                  07439090
074391     EVALUATE TRUE                                                07439190
074392         WHEN SQLCODE = +0                                        07439290
074393            IF KRPRPM-FUNC-TXT = 'N'                              07439390
074394                SET PS-DC-FLUSH-NO  TO TRUE                       07439490
074395            ELSE                                                  07439590
074396                SET PS-DC-FLUSH-YES TO TRUE                       07439690
074397            END-IF                                                07439790
074398         WHEN OTHER                                               07439890
074399                SET PS-DC-FLUSH-NO  TO TRUE                       07439990
074400     END-EVALUATE.                                                07440090
074401                                                                  07440190
077910******************************************************************07791090
077920*  CHECK XLT_MDSE_INV_PARM  FOR ANY STORES THAT MAY BE IN THE    *07792090
077930*  INVENTORY CYCLE                                               *07793090
077940******************************************************************07794090
077950 0100-CHK4-INV-CYCLE.                                             07795090
077960     INITIALIZE DCLXLT00025.                                      07796090
077970     PERFORM                                                      07797090
077980         WITH TEST AFTER                                          07798090
077990         VARYING PV-RETRY-COUNTER                                 07799090
077991         FROM 1 BY 1                                              07799190
077992         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                07799290
077993            OR (SQLCODE = +0)                                     07799390
077994            OR (SQLCODE = +100)                                   07799490
077995            OR (SQLCODE = -811)                                   07799590
077996                                                                  07799690
077997         EXEC SQL                                                 07799790
077998             SELECT LOC_NBR                                       07799890
077999                  , INV_DTE                                       07799990
078000                  , PLND_INV_DTE                                  07800090
078001                  , DC_CTOFF_DTE                                  07800190
078002               INTO :XLT00025-LOC-NBR                             07800290
078003                  , :XLT00025-INV-DTE                             07800390
078004                  , :XLT00025-PLND-INV-DTE                        07800490
078005                  , :XLT00025-DC-CTOFF-DTE                        07800590
078006               FROM XLT_MDSE_INV_PARM                             07800698
078007              WHERE DC_CTOFF_DTE >= (CURRENT_DATE - 7 DAYS)       07800790
078008                AND DC_CTOFF_DTE <= (CURRENT_DATE + 7 DAYS)       07800890
078009                AND ACTV_IND         = 'Y'                        07800997
078010                AND LOC_INV_STAT_CDE = 'IN'                       07801095
078011              WITH UR                                             07801190
078012         END-EXEC                                                 07801290
078013                                                                  07801390
078014         EVALUATE TRUE                                            07801490
078015             WHEN SQLCODE = +0                                    07801590
078016             WHEN SQLCODE = -811                                  07801690
078017                 SET PS-INV-CYC-FOUND      TO TRUE                07801790
078018             WHEN SQLCODE = +100                                  07801890
078019                 SET PS-INV-CYC-NOT-FOUND  TO TRUE                07801990
078020             WHEN SQLCODE = -904                                  07802090
078021             WHEN SQLCODE = -911                                  07802190
078022             WHEN SQLCODE = -913                                  07802290
078023                 CONTINUE                                         07802390
078024             WHEN SQLWARN0 NOT = SPACES                           07802490
078025             WHEN SQLCODE < 0                                     07802590
078026             WHEN SQLCODE > 0                                     07802690
078027                 MOVE '0100-CHK4-INV-CYCLE'                       07802790
078028                              TO PV-ABEND-PARAGRAPH               07802890
078029                 MOVE 'UNABLE TO CHECK FOR INVENTORY CYCLE'       07802990
078030                              TO PV-DB2-OPERATION-ATTEMPTED       07803090
078031                 PERFORM 9100-SQL-ABEND                           07803190
078032         END-EVALUATE                                             07803290
078033     END-PERFORM.                                                 07803390
078034                                                                  07803490
078040     IF (PV-RETRY-COUNTER > PC-MAX-RETRIES)  AND                  07804090
078100       (SQLCODE NOT = +0 AND SQLCODE NOT = +100 AND               07810055
078200        SQLCODE NOT = -811)                                       07820055
078300        MOVE '0100-CHK4-INV-CYCLE' TO PV-ABEND-PARAGRAPH          07830055
078400        MOVE 'MAX RETRIES EXCEEDED FOR INV.CYCLE CHECK'           07840078
078500                              TO PV-DB2-OPERATION-ATTEMPTED       07850055
078600        PERFORM 9100-SQL-ABEND                                    07860055
078700     END-IF.                                                      07870055
078800                                                                  07880055
078900                                                                  07890055
079000******************************************************************07900055
079100*  VALIDATE THE CONTROL CARD.                                     07910055
079200******************************************************************07920055
079300 0900-VALIDATE-CONTROL-CARD.                                      07930055
079400     IF  CC-CONSTANT = 'CONTROL'                                  07940055
079500         CONTINUE                                                 07950055
079600     ELSE                                                         07960055
079700         DISPLAY '** ABEND **'                                    07970055
079800         DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME     07980055
079900         DISPLAY '** PARAGRAPH ** = 0900-VALIDATE-CONTROL-CARD'   07990055
080000         DISPLAY '** CONTROL CONSTANT INVALID'                    08000055
080100         DISPLAY '** CONTROL CONSTANT = ' CC-CONSTANT             08010055
080200         DISPLAY '** CHANGE TO CONTROL'                           08020055
080300         MOVE +4003              TO ABEND-CODE                    08030055
080400         CALL 'ILBOABN0' USING ABEND-CODE                         08040055
080500     END-IF.                                                      08050055
080600                                                                  08060055
080700     EVALUATE TRUE                                                08070055
080800         WHEN CC-TIME-ZONE  = 'ETZ'                               08080055
080900         WHEN CC-TIME-ZONE  = 'CTZ'                               08090055
081000         WHEN CC-TIME-ZONE  = 'MTZ'                               08100055
081100         WHEN CC-TIME-ZONE  = 'PTZ'                               08110055
081200         WHEN CC-TIME-ZONE  = 'ALL'                               08120055
081300             CONTINUE                                             08130055
081400         WHEN OTHER                                               08140055
081500             DISPLAY '** ABEND **'                                08150055
081600             DISPLAY '** PROGRAM   = ' PC-CURRENT-PROGRAM-NAME    08160055
081700             DISPLAY '** PARAGRAPH = 0900-VALIDATE-CONTROL-CARD'  08170055
081800             DISPLAY '** TIMEZONE NOT VALID '                     08180055
081900             DISPLAY '** TIMEZONE = ' CC-TIME-ZONE                08190055
082000             MOVE +4003          TO ABEND-CODE                    08200055
082100             CALL 'ILBOABN0' USING ABEND-CODE                     08210055
082200     END-EVALUATE.                                                08220055
082300                                                                  08230055
082400******************************************************************08240055
082500 1000-LOAD-DC-TABLE.                                              08250055
082600                                                                  08260055
082700     PERFORM 1100-INIT-DC-TABLE                                   08270055
082800         VARYING DCT-IDX FROM 1 BY 1                              08280055
082900             UNTIL DCT-IDX > 50.                                  08290055
083000                                                                  08300055
083100     PERFORM 1200-OPEN-LOCATION.                                  08310055
083200     SET DCT-IDX TO 1.                                            08320055
083300     SET DCT-MAX-IDX TO 1.                                        08330055
083400     PERFORM 1300-LOAD-DC-TABLE                                   08340055
083500         UNTIL PS-EOF-LOCATION-CSR.                               08350055
083600     PERFORM 1500-CLOSE-LOCATION.                                 08360055
083700                                                                  08370055
083800                                                                  08380055
083900 1050-LOAD-DC-TABLE.                                              08390055
084000                                                                  08400055
084100     PERFORM 1100-INIT-DC-TABLE                                   08410055
084200         VARYING DCT-IDX FROM 1 BY 1                              08420055
084300             UNTIL DCT-IDX > 50.                                  08430055
084400                                                                  08440055
084500     PERFORM 1600-OPEN-TKRPRPM.                                   08450055
084600     SET DCT-IDX TO 1.                                            08460055
084700     SET DCT-MAX-IDX TO 1.                                        08470055
084800     PERFORM 1700-LOAD-DC-TABLE                                   08480055
084900         UNTIL PS-EOF-TKRPRPM-CSR.                                08490055
085000     PERFORM 1900-CLOSE-TKRPRPM.                                  08500055
085100                                                                  08510055
085200                                                                  08520055
085300 1100-INIT-DC-TABLE.                                              08530055
085400                                                                  08540055
085500     MOVE ZEROS TO WS-DCT-OPER-UNIT-ID (DCT-IDX)                  08550055
085600                   WS-DCT-SPLT-PRC-QTY (DCT-IDX).                 08560055
085700     MOVE SPACES TO WS-DCT-DATA-IND (DCT-IDX).                    08570055
085800     MOVE PC-INIT-DATE-YYYYMMDD TO WS-DCT-OPEN-DATE (DCT-IDX)     08580055
085900                                   WS-DCT-CLOSE-DATE (DCT-IDX).   08590055
086000     MOVE PC-INIT-01-DATE                                         08600055
086100       TO WS-DCT-SPLT-PRC-DATE (DCT-IDX).                         08610055
086200                                                                  08620055
086300                                                                  08630055
086400 1200-OPEN-LOCATION.                                              08640055
086500                                                                  08650055
086600     MOVE '1200-OPEN-LOCATION'                                    08660055
086700         TO PV-ABEND-PARAGRAPH.                                   08670055
086800     MOVE 'OPEN THE LOCATION_CSR'                                 08680055
086900         TO PV-DB2-OPERATION-ATTEMPTED.                           08690055
087000                                                                  08700055
087100     EXEC SQL                                                     08710055
087200         OPEN LOCATION_CSR                                        08720055
087300     END-EXEC.                                                    08730055
087400                                                                  08740055
087500     EVALUATE TRUE                                                08750055
087600         WHEN SQLWARN0 NOT = SPACE                                08760055
087700         WHEN SQLCODE < ZERO                                      08770055
087800         WHEN SQLCODE > ZERO                                      08780055
087900             PERFORM 9100-SQL-ABEND                               08790055
088000         WHEN SQLCODE = ZEROS                                     08800055
088100              CONTINUE                                            08810055
088200     END-EVALUATE.                                                08820055
088300                                                                  08830055
088400                                                                  08840055
088500 1300-LOAD-DC-TABLE.                                              08850055
088600                                                                  08860055
088700     PERFORM 1400-FETCH-LOCATION-LOOP.                            08870055
088800                                                                  08880055
088900     IF  PS-EOF-LOCATION-CSR                                      08890055
089000         SET DCT-MAX-IDX DOWN BY 1                                08900055
089100     ELSE                                                         08910055
089200         MOVE XLT00010-LOC-NBR                                    08920057
089300                              TO WS-DCT-OPER-UNIT-ID (DCT-IDX)    08930055
089400         MOVE XLT00010-OPN-DTE TO                                 08940055
089500              WS-DCT-OPEN-DATE (DCT-IDX)                          08950055
089600         MOVE XLT00010-CLO-DTE TO                                 08960055
089700              WS-DCT-CLOSE-DATE (DCT-IDX)                         08970055
089800         MOVE COCNTL-SPLT-PRC-DAYS-QTY TO                         08980055
089900              WS-DCT-SPLT-PRC-QTY (DCT-IDX)                       08990055
090000         IF WS-DCT-SPLT-PRC-QTY (DCT-IDX) NOT = 0                 09000055
090100             PERFORM 1350-CALC-SPLT-PRC-DATE                      09010055
090200         END-IF                                                   09020055
090300         SET DCT-IDX UP BY 1                                      09030055
090400         SET DCT-MAX-IDX UP BY 1.                                 09040055
090500                                                                  09050055
090600 1350-CALC-SPLT-PRC-DATE.                                         09060055
090700         MOVE PV-TODAYS-YY TO DPG51-SYSTEM-DATE-YR.               09070055
090800         MOVE PV-TODAYS-MM TO DPG51-SYSTEM-DATE-MO.               09080055
090900         MOVE PV-TODAYS-DD TO DPG51-SYSTEM-DATE-DY.               09090055
091000         SET DPG51-FISCAL-454-CALENDAR                            09100055
091100             DPG51-DECREMENT-DATE         TO TRUE.                09110055
091200         MOVE WS-DCT-SPLT-PRC-QTY (DCT-IDX)                       09120055
091300           TO DPG51-INCR-DECR-DAYS-9.                             09130055
091400         SET DPG52-LK-DTE-ISO-FMT TO TRUE.                        09140055
091500         MOVE PV-CURR-COMP-DATE TO DPG52-LK-DATE-INPUT.           09150055
091600         DISPLAY 'DECREMENTED DAYS = ' DPG51-INCR-DECR-DAYS-9.    09160055
091700         DISPLAY 'DATE IN = ' DPG52-LK-DATE-INPUT.                09170055
091800                                                                  09180055
091900         CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51            09190055
092000                                                 DPG52            09200055
092100                                                 DPG53            09210055
092200                                                 DPG54            09220055
092300                                                 DPG55            09230055
092400                                                 DPG56.           09240055
092500                                                                  09250055
092600         MOVE DPG55-DB2-ISO-DATE-FMT TO                           09260055
092700              PV-HOLD-CALC-DATE.                                  09270055
092800         MOVE PV-HOLD-CALC-YYYY TO                                09280055
092900              PV-HOLD-FORMAT-YYYY.                                09290055
093000         MOVE PV-HOLD-CALC-MM TO                                  09300055
093100              PV-HOLD-FORMAT-MM.                                  09310055
093200         MOVE PV-HOLD-CALC-DD TO                                  09320055
093300              PV-HOLD-FORMAT-DD.                                  09330055
093400         MOVE PV-HOLD-FORMAT-DATE TO                              09340055
093500              WS-DCT-SPLT-PRC-DATE (DCT-IDX).                     09350055
093600         DISPLAY 'DECREMENTED DATE = ' DPG55-DB2-ISO-DATE-FMT.    09360055
093700                                                                  09370055
093800 1400-FETCH-LOCATION-LOOP.                                        09380055
093900                                                                  09390055
094000     MOVE '1400-FETCH-LOCATION'                                   09400055
094100         TO PV-ABEND-PARAGRAPH.                                   09410055
094200     MOVE 'FETCH THE LOCATION_CSR'                                09420055
094300         TO PV-DB2-OPERATION-ATTEMPTED.                           09430055
094400                                                                  09440055
094500     EXEC SQL                                                     09450055
094600          FETCH LOCATION_CSR                                      09460055
094700             INTO  :XLT00010-LOC-NBR,                             09470057
094800                   :XLT00010-OPN-DTE,                             09480055
094900                   :XLT00010-CLO-DTE,                             09490055
095000                   :COCNTL-SPLT-PRC-DAYS-QTY                      09500055
095100     END-EXEC.                                                    09510055
095200                                                                  09520055
095300     EVALUATE TRUE                                                09530055
095400         WHEN SQLCODE = +0                                        09540055
095500              MOVE XLT00010-LOC-NBR TO DK-STR-NBR                 09550058
095600         WHEN SQLCODE = +100                                      09560055
095700              SET PS-EOF-LOCATION-CSR TO TRUE                     09570055
095800         WHEN SQLWARN0 NOT = SPACE                                09580055
095900         WHEN SQLCODE < ZERO                                      09590055
096000         WHEN SQLCODE > ZERO                                      09600055
096100             PERFORM 9100-SQL-ABEND                               09610055
096200     END-EVALUATE.                                                09620055
096300                                                                  09630055
096400                                                                  09640055
096500 1500-CLOSE-LOCATION.                                             09650055
096600                                                                  09660055
096700     MOVE '1500-CLOSE-LOCATION'                                   09670055
096800         TO PV-ABEND-PARAGRAPH.                                   09680055
096900     MOVE 'CLOSE THE LOCATION_CSR'                                09690055
097000         TO PV-DB2-OPERATION-ATTEMPTED.                           09700055
097100                                                                  09710055
097200     EXEC SQL                                                     09720055
097300         CLOSE LOCATION_CSR                                       09730055
097400     END-EXEC.                                                    09740055
097500                                                                  09750055
097600     EVALUATE TRUE                                                09760055
097700         WHEN SQLWARN0 NOT = SPACE                                09770055
097800         WHEN SQLCODE < ZERO                                      09780055
097900         WHEN SQLCODE > ZERO                                      09790055
098000             PERFORM 9100-SQL-ABEND                               09800055
098100         WHEN SQLCODE = ZEROS                                     09810055
098200             CONTINUE                                             09820055
098300     END-EVALUATE.                                                09830055
098400                                                                  09840055
098500******************************************************************09850055
098600 1600-OPEN-TKRPRPM.                                               09860055
098700                                                                  09870055
098800     MOVE '1600-OPEN-TKRPRPM'                                     09880055
098900         TO PV-ABEND-PARAGRAPH.                                   09890055
099000     MOVE 'OPEN THE TKRPRPM_CSR'                                  09900055
099100         TO PV-DB2-OPERATION-ATTEMPTED.                           09910055
099200                                                                  09920055
099300     EXEC SQL                                                     09930055
099400         OPEN TKRPRPM_CSR                                         09940055
099500     END-EXEC.                                                    09950055
099600                                                                  09960055
099700     EVALUATE TRUE                                                09970055
099800         WHEN SQLWARN0 NOT = SPACE                                09980055
099900         WHEN SQLCODE < ZERO                                      09990055
100000         WHEN SQLCODE > ZERO                                      10000055
100100             PERFORM 9100-SQL-ABEND                               10010055
100200         WHEN SQLCODE = ZEROS                                     10020055
100300              CONTINUE                                            10030055
100400     END-EVALUATE.                                                10040055
100500                                                                  10050055
100600                                                                  10060055
100700 1700-LOAD-DC-TABLE.                                              10070055
100800                                                                  10080055
100900     PERFORM 1800-FETCH-TKRPRPM-LOOP.                             10090055
101000                                                                  10100055
101100     IF  PS-EOF-TKRPRPM-CSR                                       10110055
101200         SET DCT-MAX-IDX DOWN BY 1                                10120055
101300     ELSE                                                         10130055
101400         MOVE XLT00010-LOC-NBR                                    10140057
101500                      TO WS-DCT-OPER-UNIT-ID (DCT-IDX)            10150055
101600         MOVE XLT00010-OPN-DTE TO                                 10160055
101700              WS-DCT-OPEN-DATE (DCT-IDX)                          10170055
101800         MOVE XLT00010-CLO-DTE TO                                 10180055
101900              WS-DCT-CLOSE-DATE (DCT-IDX)                         10190055
102000         MOVE COCNTL-SPLT-PRC-DAYS-QTY TO                         10200055
102100              WS-DCT-SPLT-PRC-QTY (DCT-IDX)                       10210055
102200         IF WS-DCT-SPLT-PRC-QTY (DCT-IDX) NOT = 0                 10220055
102300             PERFORM 1350-CALC-SPLT-PRC-DATE                      10230055
102400         END-IF                                                   10240055
102500         SET DCT-IDX UP BY 1                                      10250055
102600         SET DCT-MAX-IDX UP BY 1.                                 10260055
102700                                                                  10270055
102800 1800-FETCH-TKRPRPM-LOOP.                                         10280055
102900                                                                  10290055
103000     MOVE '1800-FETCH-TKRPRPM'                                    10300055
103100         TO PV-ABEND-PARAGRAPH.                                   10310055
103200     MOVE 'FETCH THE TKRPRPM_CSR'                                 10320055
103300         TO PV-DB2-OPERATION-ATTEMPTED.                           10330055
103400                                                                  10340055
103500     EXEC SQL                                                     10350055
103600          FETCH TKRPRPM_CSR                                       10360055
103700             INTO  :XLT00010-LOC-NBR,                             10370057
103800                   :XLT00010-OPN-DTE,                             10380055
103900                   :XLT00010-CLO-DTE,                             10390055
104000                   :COCNTL-SPLT-PRC-DAYS-QTY                      10400055
104100     END-EXEC.                                                    10410055
104200                                                                  10420055
104300     EVALUATE TRUE                                                10430055
104400         WHEN SQLCODE = +0                                        10440055
104500              MOVE XLT00010-LOC-NBR TO DK-STR-NBR                 10450058
104600         WHEN SQLCODE = +100                                      10460055
104700              SET PS-EOF-TKRPRPM-CSR TO TRUE                      10470055
104800         WHEN SQLWARN0 NOT = SPACE                                10480055
104900         WHEN SQLCODE < ZERO                                      10490055
105000         WHEN SQLCODE > ZERO                                      10500055
105100             PERFORM 9100-SQL-ABEND                               10510055
105200     END-EVALUATE.                                                10520055
105300                                                                  10530055
105400                                                                  10540055
105500 1900-CLOSE-TKRPRPM.                                              10550055
105600                                                                  10560055
105700     MOVE '1900-CLOSE-TKRPRPM'                                    10570055
105800         TO PV-ABEND-PARAGRAPH.                                   10580055
105900     MOVE 'CLOSE THE TKRPRPM_CSR'                                 10590055
106000         TO PV-DB2-OPERATION-ATTEMPTED.                           10600055
106100                                                                  10610055
106200     EXEC SQL                                                     10620055
106300         CLOSE TKRPRPM_CSR                                        10630055
106400     END-EXEC.                                                    10640055
106500                                                                  10650055
106600     EVALUATE TRUE                                                10660055
106700         WHEN SQLWARN0 NOT = SPACE                                10670055
106800         WHEN SQLCODE < ZERO                                      10680055
106900         WHEN SQLCODE > ZERO                                      10690055
107000             PERFORM 9100-SQL-ABEND                               10700055
107100         WHEN SQLCODE = ZEROS                                     10710055
107200             CONTINUE                                             10720055
107300     END-EVALUATE.                                                10730055
107400                                                                  10740055
107500******************************************************************10750055
107600 2000-OPEN-TDISTHD-CSR.                                           10760055
107700     MOVE '2000-OPEN-TDISTHD-CSR'                                 10770055
107800         TO PV-ABEND-PARAGRAPH.                                   10780055
107900     MOVE 'OPEN THE TDISTHD_CSR'                                  10790055
108000         TO PV-DB2-OPERATION-ATTEMPTED.                           10800055
108100                                                                  10810055
108200     EXEC SQL                                                     10820055
108300         OPEN TDISTHD_CSR                                         10830055
108400     END-EXEC.                                                    10840055
108500                                                                  10850055
108600     EVALUATE TRUE                                                10860055
108700         WHEN SQLWARN0 NOT = SPACE                                10870055
108800         WHEN SQLCODE < ZERO                                      10880055
108900         WHEN SQLCODE > ZERO                                      10890055
109000             PERFORM 9100-SQL-ABEND                               10900055
109100         WHEN SQLCODE = ZERO                                      10910055
109200             CONTINUE                                             10920055
109300     END-EVALUATE.                                                10930055
109400                                                                  10940055
109500                                                                  10950055
109600 2100-FETCH-TDISTHD-CSR.                                          10960055
109700     MOVE '2100-FETCH-TDISTHD-CSR'                                10970055
109800         TO PV-ABEND-PARAGRAPH.                                   10980055
109900     MOVE 'FETCH THE TDISTHD_CSR'                                 10990055
110000         TO PV-DB2-OPERATION-ATTEMPTED.                           11000055
110100                                                                  11010055
110200     INITIALIZE DCLTDISTHD.                                       11020055
110300                                                                  11030055
110400     EXEC SQL                                                     11040055
110500         FETCH  TDISTHD_CSR                                       11050055
110600          INTO  :DISTHD-ORD-NBR,                                  11060055
110700                :DISTHD-RCVR-SEQ-NBR,                             11070055
110800                :DISTHD-ORD-LNE-NBR,                              11080055
110900                :DISTHD-OPER-UNT-ID,                              11090055
111000                :DISTHD-PRCG-STAT-CDE,                            11100055
111100                :DISTHD-PRC-AREA-MODU-ID,                         11110055
111200                :DISTHD-P2L-CART-CNT,                             11120055
111300                :DISTHD-FCSE-CART-CNT,                            11130055
111400                :DISTHD-INPK-CART-CNT,                            11140055
111500                :DISTHD-RSLTS-RCVD-TMST,                          11150055
111600                :DISTHD-FCSE-CNFRMN-TMST                          11160055
111700     END-EXEC.                                                    11170055
111800                                                                  11180055
111900     EVALUATE TRUE                                                11190055
112000         WHEN SQLCODE = +100                                      11200055
112100             SET PS-END-OF-TDISTHD-CSR TO TRUE                    11210055
112200         WHEN SQLWARN0 NOT = SPACE                                11220055
112300         WHEN SQLCODE < ZERO                                      11230055
112400         WHEN SQLCODE > ZERO                                      11240055
112500             PERFORM 9100-SQL-ABEND                               11250055
112600         WHEN SQLCODE = ZERO                                      11260055
112700             CONTINUE                                             11270055
112800     END-EVALUATE.                                                11280055
112900                                                                  11290055
113000                                                                  11300055
113100 2200-PROCESS-CSR.                                                11310055
113200                                                                  11320055
113300     INITIALIZE PC003-RECEIVER-EXT-RECORD                         11330055
113400                PV-DETAIL-LINE.                                   11340055
113500     SET PS-ERROR-NOT-FOUND                                       11350055
113600         PS-SPLIT-ERROR-NOT-FOUND                                 11360055
113700         PS-TRECEIV-FOUND                                         11370055
113800         PS-TRECITM-FOUND                                         11380055
113900         PS-FIRST-TABLE-ENTRY                                     11390055
114000         PS-FIRST-STORE-ERROR                                     11400055
114100         PS-FIRST-TABLE-ENTRY-PHYINV                              11410055
114200         PS-FIRST-STORE-ERROR-PHYINV  TO TRUE.                    11420055
114300                                                                  11430055
114400     MOVE DISTHD-ORD-NBR           TO PC003-PO-NBR.               11440055
114500     MOVE DISTHD-RCVR-SEQ-NBR      TO PC003-REC-SEQ-NBR.          11450055
114600     MOVE DISTHD-ORD-LNE-NBR       TO PC003-ORD-LNE-NBR.          11460055
114700     MOVE DISTHD-OPER-UNT-ID       TO PC003-CURRENT-OPER.         11470055
114800     MOVE PC-0001                  TO PC003-CURRENT-FCLTY.        11480055
114900     MOVE DISTHD-PRC-AREA-MODU-ID  TO PC003-PRC-AREA-MODU-ID.     11490055
115000                                                                  11500055
115100     MOVE DISTHD-RSLTS-RCVD-TMST  TO PV-TMST.                     11510055
115200     MOVE '/' TO PV-SLASH1                                        11520055
115300                 PV-SLASH2.                                       11530055
115400     MOVE PV-TMST-DATE-MM         TO PV-TMST-DATE-MM2.            11540055
115500     MOVE PV-TMST-DATE-DD         TO PV-TMST-DATE-DD2.            11550055
115600     MOVE PV-TMST-DATE-CC         TO PV-TMST-DATE-CC2.            11560055
115700     MOVE PV-TMST-DATE-YY         TO PV-TMST-DATE-YY2.            11570055
115800                                                                  11580055
115900     IF  DISTHD-P2L-CART-CNT = 0                                  11590055
116000         MOVE PC-INIT-DATE-SL      TO PC003-P2L-DATE              11600055
116100     ELSE                                                         11610055
116200         MOVE PV-DATE2             TO PC003-P2L-DATE.             11620055
116300                                                                  11630055
116400     MOVE DISTHD-FCSE-CNFRMN-TMST TO PV-TMST.                     11640055
116500     MOVE PV-TMST-DATE-MM         TO PV-TMST-DATE-MM2.            11650055
116600     MOVE PV-TMST-DATE-DD         TO PV-TMST-DATE-DD2.            11660055
116700     MOVE PV-TMST-DATE-CC         TO PV-TMST-DATE-CC2.            11670055
116800     MOVE PV-TMST-DATE-YY         TO PV-TMST-DATE-YY2.            11680055
116900     MOVE PV-DATE2                TO PC003-FCSE-DATE.             11690055
117000                                                                  11700055
117100     IF PC003-P2L-DATE = PC-INIT-DATE-SL                          11710055
117200         IF DISTHD-P2L-CART-CNT = 0                               11720055
117300             MOVE PC-N TO PC003-P2L-PRCS-CDE                      11730055
117400         ELSE                                                     11740055
117500             MOVE PC-D TO PC003-P2L-PRCS-CDE                      11750055
117600         END-IF                                                   11760055
117700     ELSE                                                         11770055
117800         MOVE PC-C TO PC003-P2L-PRCS-CDE                          11780055
117900     END-IF.                                                      11790055
118000                                                                  11800055
118100     IF PC003-FCSE-DATE = PC-INIT-DATE-SL                         11810055
118200         IF DISTHD-FCSE-CART-CNT = 0 AND                          11820055
118300            DISTHD-INPK-CART-CNT = 0                              11830055
118400            MOVE PC-N TO PC003-FCSE-PRCS-CDE                      11840055
118500         ELSE                                                     11850055
118600            MOVE PC-I TO PC003-FCSE-PRCS-CDE                      11860055
118700         END-IF                                                   11870055
118800     ELSE                                                         11880055
118900         MOVE PC-C TO PC003-FCSE-PRCS-CDE                         11890055
119000     END-IF.                                                      11900055
119100                                                                  11910055
119200     PERFORM 2350-GET-TRECEIV-INFO.                               11920055
119300                                                                  11930055
119400     IF PS-TRECEIV-FOUND                                          11940055
119500         IF RECEIV-STATUS-CDE NOT = PC-DE                         11950055
119600             PERFORM 2400-GET-TRECITM-INFO                        11960055
119700         ELSE                                                     11970055
119800             MOVE SPACES TO PC003-REC-DATE                        11980055
119900             MOVE ZEROS  TO PC003-P2L-UNT-QTY                     11990055
120000                            PC003-FCSE-UNT-QTY                    12000055
120100         END-IF                                                   12010055
120200     ELSE                                                         12020055
120300         MOVE SPACES TO PC003-REC-DATE                            12030055
120400         MOVE ZEROS  TO PC003-P2L-UNT-QTY                         12040055
120500                        PC003-FCSE-UNT-QTY                        12050055
120600     END-IF.                                                      12060055
120700                                                                  12070055
120800     IF PS-TRECEIV-FOUND                                          12080055
120900         IF RECEIV-STATUS-CDE NOT = PC-DE                         12090055
121000             MOVE RECEIV-REC-TMST          TO PV-TMST             12100055
121100             MOVE '/' TO PV-SLASH1                                12110055
121200                         PV-SLASH2                                12120055
121300             MOVE PV-TMST-DATE-MM  TO PV-TMST-DATE-MM2            12130055
121400             MOVE PV-TMST-DATE-DD  TO PV-TMST-DATE-DD2            12140055
121500             MOVE PV-TMST-DATE-CC  TO PV-TMST-DATE-CC2            12150055
121600             MOVE PV-TMST-DATE-YY  TO PV-TMST-DATE-YY2            12160055
121700             MOVE PV-DATE2         TO PC003-REC-DATE              12170055
121800         ELSE                                                     12180055
121900             MOVE PC-INIT-DATE-SL  TO PC003-REC-DATE              12190055
122000         END-IF                                                   12200055
122100     ELSE                                                         12210055
122200         MOVE PC-INIT-DATE-SL  TO PC003-REC-DATE                  12220055
122300     END-IF.                                                      12230055
122400                                                                  12240055
122500     IF PS-TRECEIV-NOT-FOUND OR RECEIV-STATUS-CDE = PC-DE OR      12250055
122600        PS-TRECITM-NOT-FOUND OR RECITM-VER-STATUS-CDE = PC-I      12260055
122700         MOVE ZEROS TO PC003-CART-CNT                             12270055
122800     ELSE                                                         12280055
122900         IF  RECITM-ACTL-CART-CNT > 0                             12290055
123000             MOVE RECITM-ACTL-CART-CNT   TO PC003-CART-CNT        12300055
123100         ELSE                                                     12310055
123200             MOVE RECITM-EXPTED-CART-CNT TO PC003-CART-CNT        12320055
123300         END-IF                                                   12330055
123400     END-IF.                                                      12340055
123500                                                                  12350055
123600     PERFORM 2360-GET-TPURITM-INFO.                               12360055
123700                                                                  12370055
123800     IF PS-TPURITM-FOUND                                          12380055
123900         PERFORM 8600-CALL-XLKUT001                               12390055
124000         IF XL001-SKU-NOT-FOUND OR XL001-VND-STYL-NOT-FOUND       12400055
124100             MOVE ZEROES         TO PC003-SKU-NBR                 12410055
124200             MOVE SPACES         TO PC003-DEPT-NBR                12420055
124300                                    PC003-SUB-CL-NBR              12430055
124400         ELSE                                                     12440055
124500             MOVE XL001-SKU-NBR  TO PC003-SKU-NBR                 12450055
124600             MOVE XL001-DEPT-NBR-3CH                              12460055
124700                                 TO PC003-DEPT-NBR                12470055
124800             MOVE XL001-SUB-CL-NBR-2CH                            12480055
124900                                 TO PC003-SUB-CL-NBR              12490055
125000         END-IF                                                   12500055
125100     ELSE                                                         12510055
125200         MOVE ZEROES             TO PC003-SKU-NBR                 12520055
125300         MOVE SPACES             TO PC003-DEPT-NBR                12530055
125400                                    PC003-SUB-CL-NBR              12540055
125500     END-IF.                                                      12550055
125600                                                                  12560055
125700     PERFORM 2450-GET-TPURCHS-INFO.                               12570055
125800                                                                  12580055
125900     PERFORM 2500-GET-PRIMARY-VNDR-NME.                           12590055
126000     MOVE ENTNME-ENT-NAME-DESC       TO PC003-VNDR-NME.           12600055
126100                                                                  12610055
126200     IF PS-TRECEIV-NOT-FOUND OR RECEIV-STATUS-CDE = PC-DE OR      12620055
126300        PS-TRECITM-NOT-FOUND OR RECITM-VER-STATUS-CDE = PC-I      12630055
126400         SET PS-ERROR-FOUND TO TRUE                               12640055
126500     ELSE                                                         12650055
126600         IF DISTHD-PRCG-STAT-CDE = PC-WAIT-FOR-SPLIT              12660055
126700            CONTINUE                                              12670055
126800         ELSE                                                     12680055
126900             PERFORM 7040-GET-TROUBLE                             12690055
127000             PERFORM 7500-CHECK-FOR-PRO-NUMBER                    12700055
127100             PERFORM 7560-CHECK-IF-ARRIVED                        12710055
127200             PERFORM 7570-CHECK-BAD-RATIO                         12720055
127300             PERFORM 7580-CHECK-OPEN-SYSTEM-AUDIT                 12730055
127400             PERFORM 7590-CHECK-CRTN-NOT-MANIFESTD                12740076
127500         END-IF                                                   12750055
127600         SET PS-NOT-END-OF-TDISTDT-CSR                            12760055
127700              PS-FIRST-STR-MSG-LINE                               12770055
127800              PS-NO-INV-ERR                                       12780055
127900              PS-FIRST-STR-MSG-LINE-PHYINV TO TRUE                12790055
128000         INITIALIZE PV-FCSE-QTY                                   12800055
128100         INITIALIZE PV-P2L-QTY                                    12810055
128200              PV-NBR-OF-STR-MSG-LINES                             12820055
128300              PV-NBR-OF-STRS-ON-MSG-LINE                          12830055
128400              PV-NBR-OF-STR-MSG-LINES-PHYINV                      12840055
128500              PV-NBROFSTRS-ON-MSGLINE-PHYINV                      12850055
128600         PERFORM 3000-OPEN-TDISTDT-CSR                            12860055
128700         PERFORM 3100-FETCH-TDISTDT-CSR                           12870055
128800         PERFORM 3200-PROCESS-TDISTDT-CSR                         12880055
128900             UNTIL PS-END-OF-TDISTDT-CSR                          12890055
129000         PERFORM 3300-CLOSE-TDISTDT-CSR                           12900055
129100     END-IF.                                                      12910055
129200                                                                  12920055
129300     MOVE PV-P2L-QTY            TO PC003-P2L-UNT-QTY.             12930055
129400     MOVE PV-FCSE-QTY           TO PC003-FCSE-UNT-QTY.            12940055
129500                                                                  12950055
129600     PERFORM 2600-WRITE-FOR-DC.                                   12960055
129700     IF PS-TABLE-MATCH-FOUND                                      12970066
129800        PERFORM 2250-FORMAT-AND-WRITE                             12980066
129900     ELSE                                                         12990067
130000         NEXT SENTENCE.                                           13000067
130100                                                                  13010066
130200     PERFORM 2100-FETCH-TDISTHD-CSR.                              13020068
130300                                                                  13030055
130400 2250-FORMAT-AND-WRITE.                                           13040066
130500     IF DISTHD-PRCG-STAT-CDE = PC-WAIT-FOR-SPLIT                  13050066
130600       IF PC003-P2L-DATE = PC-INIT-DATE-SL                        13060066
130700         IF PC003-FCSE-DATE >= WS-DCT-SPLT-PRC-DATE (DCT-IDX)     13070066
130800            CONTINUE                                              13080066
130900         ELSE                                                     13090066
131000            SET PS-ERROR-FOUND TO TRUE                            13100066
131100            SET PS-SPLIT-ERROR TO TRUE                            13110066
131200            MOVE PC-SPLIT-TEXT-P2L TO PC003-OTHER-ISSUES          13120066
131300*           MOVE PC-SPLIT-TEXT-FCSE TO PC003-OTHER-ISSUES         13130066
131400         END-IF                                                   13140066
131500       ELSE                                                       13150066
131600         IF PC003-P2L-DATE >= WS-DCT-SPLT-PRC-DATE (DCT-IDX)      13160066
131700            CONTINUE                                              13170066
131800         ELSE                                                     13180066
131900            SET PS-ERROR-FOUND TO TRUE                            13190066
132000            SET PS-SPLIT-ERROR TO TRUE                            13200066
132100            MOVE PC-SPLIT-TEXT-FCSE TO PC003-OTHER-ISSUES         13210066
132200*           MOVE PC-SPLIT-TEXT-P2L TO PC003-OTHER-ISSUES          13220066
132300        END-IF                                                    13230066
132400      END-IF                                                      13240066
132500     END-IF.                                                      13250066
132600                                                                  13260066
132700     IF  PS-ERROR-FOUND                                           13270066
132800         IF RECEIV-STATUS-CDE = PC-DE OR PS-TRECEIV-NOT-FOUND     13280066
132900            OR (PS-TRECITM-FOUND AND                              13290066
133000                                  RECITM-STATUS-CDE = PC-VE)      13300066
133100             ADD 1 TO PV-DETAIL-LINE                              13310066
133200             MOVE PC-RCVR-DLT-TEXT TO PC003-OTHER-ISSUES          13320066
133300             MOVE PV-DETAIL-STATUS TO PC003-RECORD-TYPE-IND       13330066
133400             PERFORM 2900-WRITE-OUTPUT-FILE                       13340066
133500             PERFORM 2910-WRITE-ERROR-FILE                        13350066
133600         ELSE                                                     13360066
133700           IF PS-SPLIT-ERROR                                      13370066
133800               ADD 1 TO PV-DETAIL-LINE                            13380066
133900               MOVE PV-DETAIL-STATUS TO PC003-RECORD-TYPE-IND     13390066
134000               PERFORM 2900-WRITE-OUTPUT-FILE                     13400066
134100           ELSE                                                   13410066
134200             IF PS-TRECITM-NOT-FOUND                              13420066
134300                     OR RECITM-VER-STATUS-CDE = PC-I              13430066
134400                 ADD 1 TO PV-DETAIL-LINE                          13440066
134500                 MOVE PC-LINE-DLT-TEXT TO PC003-OTHER-ISSUES      13450066
134600                 MOVE PV-DETAIL-STATUS TO PC003-RECORD-TYPE-IND   13460066
134700                 PERFORM 2900-WRITE-OUTPUT-FILE                   13470066
134800                 PERFORM 2910-WRITE-ERROR-FILE                    13480066
134900             ELSE                                                 13490066
135000                 IF PV-OTHER-ISSUES-COUNT > 0                     13500066
135100                     PERFORM 2800-WRITE-ERROR-DETAILS             13510066
135200                         VARYING MSG-IDX FROM 1 BY 1              13520066
135300                             UNTIL MSG-IDX > MSG-MAX-IDX          13530066
135400                 END-IF                                           13540066
135500**** IF PHYINV ERROR NEED TO DO DIFFERENT WRITE PARAGRAPH         13550066
135600**** SO THAT PHY INV ERRORS COME OUT LAST FOR THE LINE            13560066
135700                 IF PV-PHYINV-COUNT > 0                           13570066
135800                     PERFORM 4400-WRITE-ERR-DETAILS-PHYINV        13580066
135900                         VARYING PHY-IDX FROM 1 BY 1              13590066
136000                             UNTIL PHY-IDX > PHY-MAX-IDX          13600066
136100                 END-IF                                           13610066
136200             END-IF                                               13620066
136300           END-IF                                                 13630066
136400         END-IF                                                   13640066
136500     ELSE                                                         13650066
136600         IF  DISTHD-PRCG-STAT-CDE = PC-WAIT-FOR-SPLIT             13660066
136700             CONTINUE                                             13670066
136800         ELSE                                                     13680066
136900             ADD 1 TO PV-DETAIL-LINE                              13690066
137000             MOVE PC-VERIFY-MSG-TXT TO PC003-OTHER-ISSUES         13700066
137100             MOVE PV-DETAIL-STATUS  TO PC003-RECORD-TYPE-IND      13710066
137200             PERFORM 2900-WRITE-OUTPUT-FILE                       13720066
137300             IF  PS-TRECITM-FOUND AND                             13730066
137400                 RECITM-STATUS-CDE = PC-VE                        13740066
137500                 PERFORM 2910-WRITE-ERROR-FILE                    13750066
137600             END-IF                                               13760066
137700         END-IF                                                   13770066
137800     END-IF.                                                      13780066
137900                                                                  13790066
138000                                                                  13800066
138100 2300-CLOSE-TDISTHD-CSR.                                          13810055
138200     MOVE '2300-CLOSE-TDISTHD-CSR'                                13820055
138300         TO PV-ABEND-PARAGRAPH.                                   13830055
138400     MOVE 'CLOSE THE TDISTHD_CSR'                                 13840055
138500         TO PV-DB2-OPERATION-ATTEMPTED.                           13850055
138600                                                                  13860055
138700     EXEC SQL                                                     13870055
138800         CLOSE TDISTHD_CSR                                        13880055
138900     END-EXEC.                                                    13890055
139000                                                                  13900055
139100     EVALUATE TRUE                                                13910055
139200         WHEN SQLWARN0 NOT = SPACE                                13920055
139300         WHEN SQLCODE < ZERO                                      13930055
139400         WHEN SQLCODE > ZERO                                      13940055
139500             PERFORM 9100-SQL-ABEND                               13950055
139600         WHEN SQLCODE = ZERO                                      13960055
139700             CONTINUE                                             13970055
139800     END-EVALUATE.                                                13980055
139900                                                                  13990055
140000                                                                  14000055
140100 2350-GET-TRECEIV-INFO.                                           14010055
140200     MOVE '2350-GET-TRECEIV-INFO'                                 14020055
140300         TO PV-ABEND-PARAGRAPH.                                   14030055
140400     MOVE 'SELECT INFO FROM TRECEIV'                              14040055
140500         TO PV-DB2-OPERATION-ATTEMPTED.                           14050055
140600                                                                  14060055
140700     INITIALIZE DCLTRECEIV.                                       14070055
140800                                                                  14080055
140900     EXEC SQL                                                     14090055
141000         SELECT  PO_VER_NBR,                                      14100055
141100                 REC_TMST,                                        14110055
141200                 STATUS_CDE,                                      14120055
141300                 PKGNG_CDE,                                       14130061
141400                 ORD_NBR,                                         14140061
141500                 REC_SEQ_NBR,                                     14150070
141600                 PACK_BY_ST_IND                                   14160070
141700           INTO  :RECEIV-PO-VER-NBR,                              14170055
141800                 :RECEIV-REC-TMST,                                14180055
141900                 :RECEIV-STATUS-CDE,                              14190055
142000                 :RECEIV-PKGNG-CDE,                               14200061
142100                 :RECEIV-ORD-NBR,                                 14210061
142200                 :RECEIV-REC-SEQ-NBR,                             14220070
142300                 :RECEIV-PACK-BY-ST-IND                           14230070
142400           FROM  TRECEIV                                          14240055
142500          WHERE  ORD_NBR              =  :DISTHD-ORD-NBR          14250055
142600            AND  REC_SEQ_NBR          =  :DISTHD-RCVR-SEQ-NBR     14260055
142700            WITH UR                                               14270055
142800     END-EXEC.                                                    14280055
142900                                                                  14290055
143000     EVALUATE TRUE                                                14300055
143100         WHEN SQLCODE = ZERO                                      14310055
143200              SET PS-TRECEIV-FOUND  TO TRUE                       14320055
143300         WHEN SQLCODE = +100                                      14330055
143400              SET PS-TRECEIV-NOT-FOUND TO TRUE                    14340055
143500         WHEN SQLWARN0 NOT = SPACE                                14350055
143600         WHEN SQLCODE < ZERO                                      14360055
143700         WHEN SQLCODE > ZERO                                      14370055
143800             PERFORM 9100-SQL-ABEND                               14380055
143900     END-EVALUATE.                                                14390055
144000                                                                  14400055
144100 2360-GET-TPURITM-INFO.                                           14410055
144200     MOVE '2360-GET-TPURITM-INFO'                                 14420055
144300         TO PV-ABEND-PARAGRAPH.                                   14430055
144400     MOVE 'SELECT INFO FROM TPURITM'                              14440055
144500         TO PV-DB2-OPERATION-ATTEMPTED.                           14450055
144600     IF  RECITM-PO-VER-NBR EQUAL ZEROS                            14460055
144700         MOVE PC-0001-COMP9 TO RECITM-PO-VER-NBR.                 14470055
144800                                                                  14480055
144900     INITIALIZE DCLTPURITM.                                       14490055
145000                                                                  14500055
145100     EXEC SQL                                                     14510055
145200         SELECT  ITM_NBR                                          14520055
145300           INTO  :PURITM-ITM-NBR                                  14530055
145400           FROM  TPURITM                                          14540055
145500          WHERE  PO_NBR          =  :DISTHD-ORD-NBR               14550055
145600            AND  VER_NBR         =  :RECITM-PO-VER-NBR            14560055
145700            AND  APP_PO_LNE_NBR  =  :DISTHD-ORD-LNE-NBR           14570055
145800            WITH UR                                               14580055
145900     END-EXEC.                                                    14590055
146000                                                                  14600055
146100     EVALUATE TRUE                                                14610055
146200         WHEN SQLCODE = ZERO                                      14620055
146300              SET PS-TPURITM-FOUND  TO TRUE                       14630055
146400         WHEN SQLCODE = +100                                      14640055
146500              SET PS-TPURITM-NOT-FOUND TO TRUE                    14650055
146600         WHEN SQLWARN0 NOT = SPACE                                14660055
146700         WHEN SQLCODE < ZERO                                      14670055
146800         WHEN SQLCODE > ZERO                                      14680055
146900             PERFORM 9100-SQL-ABEND                               14690055
147000     END-EVALUATE.                                                14700055
147100                                                                  14710055
147200 2400-GET-TRECITM-INFO.                                           14720055
147300                                                                  14730087
147400******************************************************************14740087
147500*  REMOVED THE FOLLOWING LINE FROM THE WHERE STATEMENT:           14750087
147600*     AND  OPER_UNT_ID          =  :DISTHD-OPER-UNT-ID            14760087
147700*                                                                 14770087
147800*  THIS WAS DONE BECAUSE THE OPERATING UNIT FROM THE TDISTHD      14780087
147900*  ROW WAS DIFFERENT THAN THE OPERATING UNIT ON TRECITM.          14790087
148000*  OPERATING UNIT SHOULD NOT BE IN THE WHERE CLAUSE, PO/RECEIVER/ 14800087
148100*  LINE IS ALL THAT IS NEEDED.                                    14810087
148200*                                                                 14820087
148300*  CHANGED BY RON KRIER ON 09/27/2005                             14830087
148400******************************************************************14840087
148500                                                                  14850087
148600     MOVE '2400-GET-TRECITM-INFO'                                 14860055
148700         TO PV-ABEND-PARAGRAPH.                                   14870055
148800     MOVE 'SELECT INFO FROM TRECITM'                              14880055
148900         TO PV-DB2-OPERATION-ATTEMPTED.                           14890055
149000                                                                  14900055
149100     INITIALIZE DCLTRECITM.                                       14910055
149200                                                                  14920055
149300     EXEC SQL                                                     14930055
149400         SELECT  EXPTED_CART_CNT,                                 14940055
149500                 ACTL_CART_CNT,                                   14950055
149600                 VER_STATUS_CDE,                                  14960055
149700                 PO_VER_NBR,                                      14970055
149800                 STATUS_CDE,                                      14980055
149900                 ORD_LNE_NBR,                                     14990055
150000                 PREPK_ID                                         15000055
150100           INTO  :RECITM-EXPTED-CART-CNT,                         15010055
150200                 :RECITM-ACTL-CART-CNT,                           15020055
150300                 :RECITM-VER-STATUS-CDE,                          15030055
150400                 :RECITM-PO-VER-NBR,                              15040055
150500                 :RECITM-STATUS-CDE,                              15050055
150600                 :RECITM-ORD-LNE-NBR,                             15060055
150700                 :RECITM-PREPK-ID                                 15070055
150800           FROM  TRECITM                                          15080055
150900          WHERE  ORD_NBR              =  :DISTHD-ORD-NBR          15090055
151000            AND  ORD_LNE_NBR          =  :DISTHD-ORD-LNE-NBR      15100055
151100            AND  REC_SEQ_NBR          =  :DISTHD-RCVR-SEQ-NBR     15110055
151200          WITH UR                                                 15120055
151300     END-EXEC.                                                    15130055
151400                                                                  15140055
151500     EVALUATE TRUE                                                15150055
151600         WHEN SQLCODE = ZERO                                      15160055
151700              SET PS-TRECITM-FOUND  TO TRUE                       15170055
151800         WHEN SQLCODE = +100                                      15180055
151900              SET PS-TRECITM-NOT-FOUND TO TRUE                    15190055
152000              MOVE SPACES TO PC003-REC-DATE                       15200055
152100              MOVE ZEROS  TO PC003-P2L-UNT-QTY                    15210055
152200                             PC003-FCSE-UNT-QTY                   15220055
152300         WHEN SQLWARN0 NOT = SPACE                                15230055
152400         WHEN SQLCODE < ZERO                                      15240055
152500         WHEN SQLCODE > ZERO                                      15250055
152501             DISPLAY '** DISPLAY KEYS **'                         15250193
152510             MOVE DISTHD-ORD-NBR      TO PV-DISPLAY-ORD-NBR       15251093
152520             MOVE DISTHD-ORD-LNE-NBR  TO PV-DISPLAY-ORD-LNE-NBR   15252093
152530             MOVE DISTHD-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR  15253093
152540             DISPLAY PV-DISPLAY-KEYS                              15254093
152600             PERFORM 9100-SQL-ABEND                               15260055
152700     END-EVALUATE.                                                15270055
152800                                                                  15280055
152900                                                                  15290055
153000 2450-GET-TPURCHS-INFO.                                           15300055
153100     MOVE '2450-GET-TPURCHS-INFO'                                 15310055
153200         TO PV-ABEND-PARAGRAPH.                                   15320055
153300     MOVE 'GET INFO FROM TPURCHS'                                 15330055
153400         TO PV-DB2-OPERATION-ATTEMPTED.                           15340055
153500                                                                  15350055
153600     INITIALIZE DCLTPURCHS.                                       15360055
153700                                                                  15370055
153800     EXEC SQL                                                     15380055
153900         SELECT                                                   15390055
154000                 ENT_ID                                           15400055
154100           INTO                                                   15410055
154200                 :PURCHS-ENT-ID                                   15420055
154300           FROM  TPURCHS                                          15430055
154400          WHERE  PO_NBR          =  :DISTHD-ORD-NBR               15440055
154500            AND  VER_NBR         =  :RECEIV-PO-VER-NBR            15450055
154600            AND  PO_CATEG_CDE    =  'MR'                          15460055
154700          WITH UR                                                 15470055
154800     END-EXEC.                                                    15480055
154900                                                                  15490055
155000     EVALUATE TRUE                                                15500055
155100         WHEN SQLCODE = ZERO                                      15510055
155200         WHEN SQLCODE = +100                                      15520055
155300              CONTINUE                                            15530055
155400         WHEN SQLWARN0 NOT = SPACE                                15540055
155500         WHEN SQLCODE < ZERO                                      15550055
155600         WHEN SQLCODE > ZERO                                      15560055
155700             PERFORM 9100-SQL-ABEND                               15570055
155800     END-EVALUATE.                                                15580055
155900                                                                  15590055
156000                                                                  15600055
156100 2500-GET-PRIMARY-VNDR-NME.                                       15610055
156200     MOVE '2500-GET-PRIMARY-VNDR-NME'                             15620055
156300         TO PV-ABEND-PARAGRAPH.                                   15630055
156400     MOVE 'SELECT PRIMARY VNDR NAME'                              15640055
156500         TO PV-DB2-OPERATION-ATTEMPTED.                           15650055
156600                                                                  15660055
156700     INITIALIZE DCLTENTNME.                                       15670055
156800                                                                  15680055
156900     EXEC SQL                                                     15690055
157000         SELECT  ENT_NAME_DESC                                    15700055
157100           INTO  :ENTNME-ENT-NAME-DESC                            15710055
157200           FROM  TENTNME                                          15720055
157300          WHERE  (ENT_ID    =  :PURCHS-ENT-ID                     15730055
157400            AND   TYPE_CDE  =  '01')                              15740055
157500          WITH UR                                                 15750055
157600     END-EXEC.                                                    15760055
157700                                                                  15770055
157800     EVALUATE TRUE                                                15780055
157900         WHEN SQLCODE = ZERO                                      15790055
158000              MOVE ENTNME-ENT-NAME-DESC TO PC003-VNDR-NME         15800055
158100         WHEN SQLCODE = +100                                      15810055
158200              MOVE SPACES               TO PC003-VNDR-NME         15820055
158300         WHEN SQLWARN0 NOT = SPACE                                15830055
158400         WHEN SQLCODE < ZERO                                      15840055
158500         WHEN SQLCODE > ZERO                                      15850055
158600             PERFORM 9100-SQL-ABEND                               15860055
158700     END-EVALUATE.                                                15870055
158800                                                                  15880055
158900                                                                  15890055
159000 2600-WRITE-FOR-DC.                                               15900055
159100                                                                  15910055
159200     SET PS-TABLE-MATCH-NOTFOUND TO TRUE.                         15920055
159300     PERFORM 2700-CHECK-TABLE                                     15930055
159400         VARYING DCT-IDX FROM 1 BY 1                              15940055
159500             UNTIL DCT-IDX IS > DCT-MAX-IDX                       15950055
159600                OR PS-TABLE-MATCH-FOUND.                          15960055
159700                                                                  15970055
159800                                                                  15980055
159900 2700-CHECK-TABLE.                                                15990055
160000                                                                  16000055
160100*  THE FOLLOWING CODE WAS PUT IN BY RON KRIER ON 10/16/1998       16010055
160200*  TO HANDLE THE CASE WHERE THE TEST DATA HAS AN OPERATING        16020055
160300*  UNIT OF 90 (BECAUSE THE TEST DATA WAS BUILT AT THE CORP        16030055
160400*  OFFICE), TO MAKE THE PROGRAM USE THE DATES IN THE TABLE        16040055
160500*  THAT ARE SET-UP FOR THE MENOMONEE FALLS DC.                    16050055
160600                                                                  16060055
160700     IF  PC003-CURRENT-OPER = PC-CORP-OFFICE                      16070055
160800         MOVE PC-85 TO PV-CURRENT-OPER                            16080055
160900     ELSE                                                         16090055
161000         MOVE PC003-CURRENT-OPER TO PV-CURRENT-OPER               16100055
161100     END-IF.                                                      16110055
161200                                                                  16120055
161300     IF  PV-CURRENT-OPER = WS-DCT-OPER-UNIT-ID (DCT-IDX)          16130055
161400         SET PS-TABLE-MATCH-FOUND                                 16140055
161500             WS-DCT-DATA-PROCESSED (DCT-IDX) TO TRUE              16150055
161600     END-IF.                                                      16160055
161700                                                                  16170055
161800                                                                  16180055
161900 2800-WRITE-ERROR-DETAILS.                                        16190055
162000     ADD 1 TO PV-DETAIL-LINE.                                     16200055
162100     MOVE PV-DETAIL-STATUS           TO PC003-RECORD-TYPE-IND.    16210055
162200     MOVE WS-OTHER-ISSUES-MSG (MSG-IDX)                           16220055
162300                                     TO PC003-OTHER-ISSUES.       16230055
162400     PERFORM 2900-WRITE-OUTPUT-FILE.                              16240055
162500                                                                  16250055
162600                                                                  16260055
162700 2900-WRITE-OUTPUT-FILE.                                          16270055
162800     WRITE EXTRACT-RECORD FROM PC003-RECEIVER-EXT-RECORD.         16280055
162900                                                                  16290055
163000                                                                  16300055
163100 2910-WRITE-ERROR-FILE.                                           16310055
163200     WRITE ERROR-RECORD FROM PC003-RECEIVER-EXT-RECORD.           16320055
163300                                                                  16330055
163400                                                                  16340055
163500 3000-OPEN-TDISTDT-CSR.                                           16350055
163600     MOVE '3000-OPEN-TDISTDT-CSR'                                 16360055
163700         TO PV-ABEND-PARAGRAPH.                                   16370055
163800     MOVE 'OPEN THE TDISTDT_CSR'                                  16380055
163900         TO PV-DB2-OPERATION-ATTEMPTED.                           16390055
164000                                                                  16400055
164100     EXEC SQL                                                     16410055
164200         OPEN TDISTDT_CSR                                         16420055
164300     END-EXEC.                                                    16430055
164400                                                                  16440055
164500     EVALUATE TRUE                                                16450055
164600         WHEN SQLWARN0 NOT = SPACE                                16460055
164700         WHEN SQLCODE < ZERO                                      16470055
164800         WHEN SQLCODE > ZERO                                      16480055
164900             PERFORM 9100-SQL-ABEND                               16490055
165000         WHEN SQLCODE = ZERO                                      16500055
165100             CONTINUE                                             16510055
165200     END-EVALUATE.                                                16520055
165300                                                                  16530055
165400                                                                  16540055
165500 3100-FETCH-TDISTDT-CSR.                                          16550055
165600     MOVE '3100-FETCH-TDISTDT-CSR'                                16560055
165700         TO PV-ABEND-PARAGRAPH.                                   16570055
165800     MOVE 'FETCH THE TDISTDT_CSR'                                 16580055
165900         TO PV-DB2-OPERATION-ATTEMPTED.                           16590055
166000                                                                  16600055
166100     INITIALIZE DCLTDISTDT.                                       16610055
166200                                                                  16620055
166300     EXEC SQL                                                     16630055
166400         FETCH  TDISTDT_CSR                                       16640055
166500          INTO  :DISTDT-STR-NBR,                                  16650055
166600                :DISTDT-ACTL-ALLOC-QTY,                           16660055
166700                :DISTDT-P2L-SPLT-UNT-QTY,                         16670055
166800                :DISTDT-FCSE-SPLT-UNT-QTY,                        16680055
166900                :DISTDT-INPK-SPLT-UNT-QTY,                        16690055
167000                :DISTDT-FCSE-ACTL-UNT-QTY                         16700055
167100     END-EXEC.                                                    16710055
167200                                                                  16720055
167300     EVALUATE TRUE                                                16730055
167400         WHEN SQLCODE = +100                                      16740055
167500             SET PS-END-OF-TDISTDT-CSR TO TRUE                    16750055
167600         WHEN SQLWARN0 NOT = SPACE                                16760055
167700         WHEN SQLCODE < ZERO                                      16770055
167800         WHEN SQLCODE > ZERO                                      16780055
167900             PERFORM 9100-SQL-ABEND                               16790055
168000         WHEN SQLCODE = ZERO                                      16800055
168100             CONTINUE                                             16810055
168200     END-EVALUATE.                                                16820055
168300                                                                  16830055
168400                                                                  16840055
168500 3200-PROCESS-TDISTDT-CSR.                                        16850055
168600                                                                  16860055
168700                                                                  16870055
168800     IF PC003-P2L-DATE = PC-INIT-DATE-SL                          16880055
168900         ADD DISTDT-P2L-SPLT-UNT-QTY TO PV-P2L-QTY                16890055
169000     ELSE                                                         16900055
169100         ADD DISTDT-ACTL-ALLOC-QTY TO PV-P2L-QTY                  16910055
169200     END-IF.                                                      16920055
169300                                                                  16930055
169400     IF PC003-FCSE-DATE = PC-INIT-DATE-SL                         16940055
169500         ADD DISTDT-FCSE-SPLT-UNT-QTY TO PV-FCSE-QTY              16950055
169600         ADD DISTDT-INPK-SPLT-UNT-QTY TO PV-FCSE-QTY              16960055
169700     ELSE                                                         16970055
169800         ADD DISTDT-FCSE-ACTL-UNT-QTY TO PV-FCSE-QTY              16980055
169900     END-IF.                                                      16990055
170000                                                                  17000055
170100     IF  DISTHD-PRCG-STAT-CDE = PC-WAIT-FOR-SPLIT                 17010055
170200         CONTINUE                                                 17020055
170300     ELSE                                                         17030055
170400         IF  DISTHD-PRCG-STAT-CDE = PC-ERROR-STATUS               17040055
170500                 OR  PC-ERROR-NO-PRO OR PC-INV-CYC-STATUS         17050055
170600             PERFORM 3210-CHECK-TRECDIS-PRESENT                   17060055
170700             IF  PV-STORE-COUNT > 0                               17070055
170800                 CONTINUE                                         17080055
170900             ELSE                                                 17090055
171000                 SET PS-ERROR-FOUND TO TRUE                       17100055
171100                 PERFORM 3220-ADD-STR-TO-MESSAGE-LINE             17110055
171200             END-IF                                               17120055
171300             IF PS-INV-CYC-FOUND                                  17130055
171400                 PERFORM 4000-CHK4-STORE-INV-CYCLE                17140055
171500                 IF  PS-NO-INV-ERR                                17150055
171600                     CONTINUE                                     17160055
171700                 ELSE                                             17170055
171800                     SET PS-ERROR-FOUND TO TRUE                   17180055
171900                     PERFORM 4300-ADD-STR-TO-INV-MSG-LINE         17190055
172000                END-IF                                            17200055
172100             END-IF                                               17210055
172200         END-IF                                                   17220055
172300     END-IF.                                                      17230055
172400                                                                  17240055
172500     PERFORM 3100-FETCH-TDISTDT-CSR.                              17250055
172600                                                                  17260055
172700                                                                  17270055
172800 3210-CHECK-TRECDIS-PRESENT.                                      17280055
172900     MOVE '3210-CHECK-TRECDIS-PRESENT'                            17290055
173000         TO PV-ABEND-PARAGRAPH.                                   17300055
173100     MOVE 'CHECK IF STORE IS ON TRECDIS'                          17310055
173200         TO PV-DB2-OPERATION-ATTEMPTED.                           17320055
173300                                                                  17330055
173400     INITIALIZE PV-STORE-COUNT.                                   17340055
173500                                                                  17350055
173600     EXEC SQL                                                     17360055
173700         SELECT  COUNT(*)                                         17370055
173800           INTO  :PV-STORE-COUNT                                  17380055
173900           FROM  TRECDIS                                          17390055
174000          WHERE  ORD_NBR         =  :DISTHD-ORD-NBR               17400055
174100            AND  REC_SEQ_NBR     =  :DISTHD-RCVR-SEQ-NBR          17410055
174200            AND  ORD_LNE_NBR     =  :DISTHD-ORD-LNE-NBR           17420055
174300            AND  STR_NBR         =  :DISTDT-STR-NBR               17430055
174400          WITH UR                                                 17440055
174500     END-EXEC.                                                    17450055
174600                                                                  17460055
174700     EVALUATE TRUE                                                17470055
174800         WHEN SQLCODE = ZERO                                      17480055
174900              CONTINUE                                            17490055
175000         WHEN SQLWARN0 NOT = SPACE                                17500055
175100         WHEN SQLCODE < ZERO                                      17510055
175200         WHEN SQLCODE > ZERO                                      17520055
175300             PERFORM 9100-SQL-ABEND                               17530055
175400     END-EVALUATE.                                                17540055
175500                                                                  17550055
175600                                                                  17560055
175700 3220-ADD-STR-TO-MESSAGE-LINE.                                    17570055
175800                                                                  17580055
175900     IF  PS-FIRST-TABLE-ENTRY                                     17590055
176000         SET PS-NOT-FIRST-TABLE-ENTRY                             17600055
176100             PS-NOT-FIRST-STORE-ERROR TO TRUE                     17610055
176200         SET MSG-IDX                                              17620055
176300             MSG-MAX-IDX TO 1                                     17630055
176400     ELSE                                                         17640055
176500         IF  PS-FIRST-STORE-ERROR                                 17650055
176600             SET PS-NOT-FIRST-STORE-ERROR TO TRUE                 17660055
176700             SET MSG-IDX     UP BY 1                              17670055
176800             SET MSG-MAX-IDX UP BY 1                              17680055
176900         END-IF                                                   17690055
177000     END-IF.                                                      17700055
177100                                                                  17710055
177200     IF  PS-FIRST-STR-MSG-LINE                                    17720055
177300         SET PS-NOT-FIRST-STR-MSG-LINE TO TRUE                    17730055
177400         MOVE 1      TO PV-STORE-MSG-POINTER                      17740055
177500         MOVE SPACES TO WS-OTHER-ISSUES-MSG(MSG-IDX)              17750055
177600         STRING      PC-MISSING-STORES-TXT DELIMITED BY SIZE      17760055
177700             INTO    WS-OTHER-ISSUES-MSG (MSG-IDX)                17770055
177800             POINTER PV-STORE-MSG-POINTER                         17780055
177900     END-IF.                                                      17790055
178000                                                                  17800055
178100     ADD 1 TO PV-NBR-OF-STRS-ON-MSG-LINE.                         17810055
178200                                                                  17820055
178300     IF  PV-NBR-OF-STRS-ON-MSG-LINE > 5                           17830055
178400         STRING      ','               DELIMITED BY SIZE          17840055
178500             INTO    WS-OTHER-ISSUES-MSG (MSG-IDX)                17850055
178600             POINTER PV-STORE-MSG-POINTER                         17860055
178700         SET MSG-IDX     UP BY 1                                  17870055
178800         SET MSG-MAX-IDX UP BY 1                                  17880055
178900         MOVE SPACES TO WS-OTHER-ISSUES-MSG(MSG-IDX)              17890055
179000         MOVE LENGTH OF PC-MISSING-STORES-TXT TO                  17900055
179100                        PV-STORE-MSG-POINTER                      17910055
179200         ADD 1       TO PV-STORE-MSG-POINTER                      17920055
179300         MOVE DISTDT-STR-NBR TO PV-NUM-STORE-NUM                  17930055
179400         STRING      PV-NUM-STORE-NUM      DELIMITED BY SIZE      17940055
179500             INTO    WS-OTHER-ISSUES-MSG (MSG-IDX)                17950055
179600             POINTER PV-STORE-MSG-POINTER                         17960055
179700         MOVE 1 TO PV-NBR-OF-STRS-ON-MSG-LINE                     17970055
179800         ADD 1 TO   PV-OTHER-ISSUES-COUNT                         17980055
179900     ELSE                                                         17990055
180000         IF  PV-NBR-OF-STRS-ON-MSG-LINE = 1                       18000055
180100             MOVE DISTDT-STR-NBR TO PV-NUM-STORE-NUM              18010055
180200             STRING      PV-NUM-STORE-NUM  DELIMITED BY SIZE      18020055
180300                 INTO    WS-OTHER-ISSUES-MSG (MSG-IDX)            18030055
180400                 POINTER PV-STORE-MSG-POINTER                     18040055
180500             ADD 1 TO   PV-OTHER-ISSUES-COUNT                     18050055
180600         ELSE                                                     18060055
180700             MOVE DISTDT-STR-NBR TO PV-NUM-STORE-NUM              18070055
180800             STRING      ','               DELIMITED BY SIZE      18080055
180900                         PV-NUM-STORE-NUM  DELIMITED BY SIZE      18090055
181000                 INTO    WS-OTHER-ISSUES-MSG (MSG-IDX)            18100055
181100                 POINTER PV-STORE-MSG-POINTER                     18110055
181200             ADD 1 TO   PV-OTHER-ISSUES-COUNT                     18120055
181300         END-IF                                                   18130055
181400     END-IF.                                                      18140055
181500                                                                  18150055
181600                                                                  18160055
181700 3300-CLOSE-TDISTDT-CSR.                                          18170055
181800     MOVE '3300-CLOSE-TDISTDT-CSR'                                18180055
181900         TO PV-ABEND-PARAGRAPH.                                   18190055
182000     MOVE 'CLOSE THE TDISTDT_CSR'                                 18200055
182100         TO PV-DB2-OPERATION-ATTEMPTED.                           18210055
182200                                                                  18220055
182300     EXEC SQL                                                     18230055
182400         CLOSE TDISTDT_CSR                                        18240055
182500     END-EXEC.                                                    18250055
182600                                                                  18260055
182700     EVALUATE TRUE                                                18270055
182800         WHEN SQLWARN0 NOT = SPACE                                18280055
182900         WHEN SQLCODE < ZERO                                      18290055
183000         WHEN SQLCODE > ZERO                                      18300055
183100             PERFORM 9100-SQL-ABEND                               18310055
183200         WHEN SQLCODE = ZERO                                      18320055
183300             CONTINUE                                             18330055
183400     END-EVALUATE.                                                18340055
183500                                                                  18350055
183600                                                                  18360055
183700 4000-CHK4-STORE-INV-CYCLE.                                       18370055
183800     SET PS-NO-INV-ERR                                            18380055
183900         PS-STR-INV-CYC-NOT-FOUND TO TRUE.                        18390055
184000     PERFORM 4100-CHK-INV-PARM.                                   18400078
184100     IF PS-STR-INV-CYC-FOUND                                      18410055
184200         PERFORM 4200-CHK-INV-CYCLE.                              18420055
184300                                                                  18430055
184400*----------------------------------------------------------------*18440055
184500*    CHECK IF STORE IS IN INVENTORY PROCESS                      *18450058
184600*    XLT_LOC (XLT00010)                                           18460085
184700*----------------------------------------------------------------*18470055
184800                                                                  18480055
184900 4100-CHK-INV-PARM.                                               18490078
185000     INITIALIZE DCLXLT00025                                       18500078
185100                DCLXLT00010.                                      18510058
185200                                                                  18520055
185300     PERFORM WITH TEST AFTER                                      18530055
185400         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    18540055
185500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18550055
185600              OR (SQLCODE = +0)                                   18560055
185700              OR (SQLCODE = +100)                                 18570055
185800              OR (SQLCODE = -811))                                18580055
185900                                                                  18590055
186000         EXEC SQL                                                 18600055
186100              SELECT                                              18610055
186200                    A.LOC_NBR                                     18620077
186300                  , A.INV_DTE                                     18630080
186400                  , A.PLND_INV_DTE                                18640055
186500                  , A.DC_CTOFF_DTE                                18650080
186600                  , B.LOC_NBR                                     18660058
186700              INTO  :XLT00025-LOC-NBR                             18670078
186800                  , :XLT00025-INV-DTE                             18680079
186900                  , :XLT00025-PLND-INV-DTE                        18690078
187000                  , :XLT00025-DC-CTOFF-DTE                        18700079
187100                  , :XLT00010-LOC-NBR                             18710058
187200              FROM                                                18720055
187300                    XLT_MDSE_INV_PARM A                           18730098
187400                  , XLT_LOC B                                     18740058
187500              WHERE                                               18750055
187600                   A.DC_CTOFF_DTE >= (CURRENT_DATE - 7 DAYS)      18760081
187700              AND  A.DC_CTOFF_DTE <= (CURRENT_DATE + 7 DAYS)      18770081
187800              AND  A.LOC_NBR           =  B.LOC_NBR               18780069
187810              AND  A.ACTV_IND          =  'Y'                     18781097
187820              AND  A.LOC_INV_STAT_CDE  =  'IN'                    18782095
187900              AND  B.LOC_NBR           =  :DISTDT-STR-NBR         18790058
188000              WITH UR                                             18800055
188100         END-EXEC                                                 18810055
188200                                                                  18820055
188300         EVALUATE TRUE                                            18830055
188400             WHEN SQLCODE = +0                                    18840055
188500             WHEN SQLCODE = -811                                  18850055
188600                  SET PS-STR-INV-CYC-FOUND TO TRUE                18860055
188700             WHEN SQLCODE = +100                                  18870055
188800                  SET PS-STR-INV-CYC-NOT-FOUND TO TRUE            18880055
188900             WHEN SQLCODE = -904                                  18890055
189000             WHEN SQLCODE = -911                                  18900055
189100             WHEN SQLCODE = -913                                  18910055
189200                  CONTINUE                                        18920055
189300             WHEN SQLWARN0 NOT = SPACE                            18930055
189400             WHEN SQLCODE NOT = ZERO                              18940055
189500                  MOVE '4100-CHK-INV-PARM'                        18950078
189600                                   TO PV-ABEND-PARAGRAPH          18960055
189700                  MOVE 'SELECT XLT_MDSE_INV_PARM'                 18970078
189800                                   TO PV-DB2-OPERATION-ATTEMPTED  18980055
189900                  PERFORM 9100-SQL-ABEND                          18990055
190000         END-EVALUATE                                             19000055
190100     END-PERFORM.                                                 19010055
190200                                                                  19020055
190300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES AND (SQLCODE NOT = +0   19030055
190400           AND SQLCODE NOT = +100 AND SQLCODE NOT = -811)         19040055
190500         MOVE '4100-CHK-INV-PARM'                                 19050078
190600                                 TO PV-ABEND-PARAGRAPH            19060055
190700        MOVE 'MAX RETRIES EXCEEDED ON SELECT OF XLT_MDSE_INV_PARM'19070078
190800                                 TO PV-DB2-OPERATION-ATTEMPTED    19080055
190900         PERFORM 9100-SQL-ABEND                                   19090055
191000     END-IF.                                                      19100055
191100/                                                                 19110055
191200 4200-CHK-INV-CYCLE.                                              19120055
191300     MOVE XLT00025-DC-CTOFF-DTE TO PV-WORK-DATE.                  19130079
191400     MOVE PV-WORK-CC        TO PV-HOLD-WORK-CC.                   19140055
191500     MOVE PV-WORK-YY        TO PV-HOLD-WORK-YY.                   19150055
191600     MOVE PV-WORK-MM        TO PV-HOLD-WORK-MM.                   19160055
191700     MOVE PV-WORK-DD        TO PV-HOLD-WORK-DD.                   19170055
191800     IF PV-HOLD-CURR-DATE < PV-HOLD-WORK-DATE  OR                 19180055
191900        PV-HOLD-CURR-DATE = PV-HOLD-WORK-DATE                     19190055
192000**** STORE NOT IN INVENTORY CYCLE                                 19200055
192100         CONTINUE                                                 19210055
192200     ELSE                                                         19220055
192300         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           19230055
192400         SET DPG51-FISCAL-454-CALENDAR                            19240055
192500             DPG51-INCREMENT-DATE         TO TRUE                 19250055
192600         MOVE 7             TO DPG51-INCR-DECR-DAYS-9             19260055
192700         SET DPG52-LK-DTE-ISO-FMT TO TRUE                         19270055
192800         MOVE XLT00025-DC-CTOFF-DTE TO DPG52-LK-DATE-INPUT        19280079
192900                                                                  19290055
193000         CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51            19300055
193100                                                 DPG52            19310055
193200                                                 DPG53            19320055
193300                                                 DPG54            19330055
193400                                                 DPG55            19340055
193500                                                 DPG56            19350055
193600         MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO PV-WORK-DATE           19360055
193700         MOVE PV-WORK-CC                TO PV-HOLD-WORK-CC        19370055
193800         MOVE PV-WORK-YY                TO PV-HOLD-WORK-YY        19380055
193900         MOVE PV-WORK-MM                TO PV-HOLD-WORK-MM        19390055
194000         MOVE PV-WORK-DD                TO PV-HOLD-WORK-DD        19400055
194100         IF PV-HOLD-CURR-DATE > PV-HOLD-WORK-DATE                 19410055
194200**** STORE NOT IN INVENTORY CYCLE                                 19420055
194300             SET PS-NO-INV-ERR      TO TRUE                       19430055
194400         ELSE                                                     19440055
194500             SET PS-INV-ERR         TO TRUE                       19450055
194600         END-IF                                                   19460055
194700     END-IF.                                                      19470055
194800                                                                  19480055
194900 4300-ADD-STR-TO-INV-MSG-LINE.                                    19490055
195000                                                                  19500055
195100     IF  PS-FIRST-TABLE-ENTRY-PHYINV                              19510055
195200         SET PS-NOT-1ST-TABLE-ENTRY-PHYINV                        19520055
195300             PS-NOT-1ST-STORE-ERROR-PHYINV TO TRUE                19530055
195400         SET PHY-IDX                                              19540055
195500             PHY-MAX-IDX TO 1                                     19550055
195600     ELSE                                                         19560055
195700         IF  PS-FIRST-STORE-ERROR-PHYINV                          19570055
195800             SET PS-NOT-1ST-STORE-ERROR-PHYINV TO TRUE            19580055
195900             SET PHY-IDX     UP BY 1                              19590055
196000             SET PHY-MAX-IDX UP BY 1                              19600055
196100         END-IF                                                   19610055
196200     END-IF.                                                      19620055
196300                                                                  19630055
196400     IF  PS-FIRST-STR-MSG-LINE-PHYINV                             19640055
196500         SET PS-NOT-1ST-STR-MSG-LINE-PHYINV TO TRUE               19650055
196600         MOVE SPACES TO WS-PHYINV-MSG(PHY-IDX)                    19660055
196700         MOVE PC-PHY-INV-MSG-TXT TO WS-PHYINV-MSG(PHY-IDX)        19670055
196800         ADD 1 TO PV-PHYINV-COUNT                                 19680055
196900         SET PHY-IDX     UP BY 1                                  19690055
197000         SET PHY-MAX-IDX UP BY 1                                  19700055
197100         MOVE 1      TO PV-STORE-MSG-POINTER-PHYINV               19710055
197200         MOVE SPACES TO WS-PHYINV-MSG(PHY-IDX)                    19720055
197300         STRING      PC-INV-CUT-STORES-TXT DELIMITED BY SIZE      19730055
197400             INTO    WS-PHYINV-MSG (PHY-IDX)                      19740055
197500             POINTER PV-STORE-MSG-POINTER-PHYINV                  19750055
197600     END-IF.                                                      19760055
197700                                                                  19770055
197800     ADD 1 TO PV-NBROFSTRS-ON-MSGLINE-PHYINV.                     19780055
197900                                                                  19790055
198000     IF  PV-NBROFSTRS-ON-MSGLINE-PHYINV > 5                       19800055
198100         STRING      ','               DELIMITED BY SIZE          19810055
198200             INTO    WS-PHYINV-MSG (PHY-IDX)                      19820055
198300             POINTER PV-STORE-MSG-POINTER-PHYINV                  19830055
198400         SET PHY-IDX     UP BY 1                                  19840055
198500         SET PHY-MAX-IDX UP BY 1                                  19850055
198600         MOVE SPACES TO WS-PHYINV-MSG(PHY-IDX)                    19860055
198700         MOVE LENGTH OF PC-INV-CUT-STORES-TXT TO                  19870055
198800                        PV-STORE-MSG-POINTER-PHYINV               19880055
198900         ADD 1       TO PV-STORE-MSG-POINTER-PHYINV               19890055
199000         MOVE DISTDT-STR-NBR TO PV-NUM-STORE-NUM                  19900055
199100         STRING      PV-NUM-STORE-NUM      DELIMITED BY SIZE      19910055
199200             INTO    WS-PHYINV-MSG (PHY-IDX)                      19920055
199300             POINTER PV-STORE-MSG-POINTER-PHYINV                  19930055
199400         MOVE 1 TO PV-NBROFSTRS-ON-MSGLINE-PHYINV                 19940055
199500         ADD 1 TO PV-PHYINV-COUNT                                 19950055
199600     ELSE                                                         19960055
199700         IF  PV-NBROFSTRS-ON-MSGLINE-PHYINV = 1                   19970055
199800             MOVE DISTDT-STR-NBR TO PV-NUM-STORE-NUM              19980055
199900             STRING      PV-NUM-STORE-NUM  DELIMITED BY SIZE      19990055
200000                 INTO    WS-PHYINV-MSG (PHY-IDX)                  20000055
200100                 POINTER PV-STORE-MSG-POINTER-PHYINV              20010055
200200             ADD 1 TO PV-PHYINV-COUNT                             20020055
200300         ELSE                                                     20030055
200400             MOVE DISTDT-STR-NBR TO PV-NUM-STORE-NUM              20040055
200500             STRING      ','               DELIMITED BY SIZE      20050055
200600                         PV-NUM-STORE-NUM  DELIMITED BY SIZE      20060055
200700                 INTO    WS-PHYINV-MSG (PHY-IDX)                  20070055
200800                 POINTER PV-STORE-MSG-POINTER-PHYINV              20080055
200900             ADD 1 TO PV-PHYINV-COUNT                             20090055
201000         END-IF                                                   20100055
201100     END-IF.                                                      20110055
201200                                                                  20120055
201300 4400-WRITE-ERR-DETAILS-PHYINV.                                   20130055
201400     ADD 1 TO PV-DETAIL-LINE.                                     20140055
201500     MOVE PV-DETAIL-STATUS           TO PC003-RECORD-TYPE-IND.    20150055
201600     MOVE WS-PHYINV-MSG (PHY-IDX) TO PC003-OTHER-ISSUES.          20160055
201700     PERFORM 2900-WRITE-OUTPUT-FILE.                              20170055
201800                                                                  20180055
201900                                                                  20190055
202000                                                                  20200055
202100                                                                  20210055
202200                                                                  20220055
202300 7040-GET-TROUBLE.                                                20230055
202400     MOVE '7040-GET-TROUBLE'                                      20240055
202500         TO PV-ABEND-PARAGRAPH.                                   20250055
202600     MOVE 'GET TROUBLE'                                           20260055
202700         TO PV-DB2-OPERATION-ATTEMPTED.                           20270055
202800                                                                  20280055
202900     MOVE SPACES TO PC003-UNRESOLVED-TROUBLE                      20290055
203000                    PC003-MULTI-TROUBLE                           20300055
203100                    PC003-LATEST-TROUBLE.                         20310055
203200                                                                  20320055
203300     PERFORM 7042-CALL-ALL-TROUBLE.                               20330055
203400                                                                  20340055
203500     IF WS-COUNT GREATER THAN 1                                   20350055
203600         MOVE '*' TO PC003-MULTI-TROUBLE                          20360055
203700     END-IF.                                                      20370055
203800                                                                  20380055
203900     IF WS-COUNT GREATER THAN ZERO                                20390055
204000         SET PS-ERROR-FOUND TO TRUE                               20400055
204100         IF  PS-FIRST-TABLE-ENTRY                                 20410055
204200             SET PS-NOT-FIRST-TABLE-ENTRY TO TRUE                 20420055
204300             SET MSG-MAX-IDX                                      20430055
204400                 MSG-IDX               TO 1                       20440055
204500         ELSE                                                     20450055
204600             SET MSG-IDX     UP BY 1                              20460055
204700             SET MSG-MAX-IDX UP BY 1                              20470055
204800         END-IF                                                   20480055
204900                                                                  20490055
205000         MOVE SPACES          TO WS-OTHER-ISSUES-MSG(MSG-IDX)     20500055
205100         MOVE PC-TRBL-MSG-TXT TO WS-OTHER-ISSUES-MSG(MSG-IDX)     20510055
205200         ADD 1 TO PV-OTHER-ISSUES-COUNT                           20520055
205300                                                                  20530055
205400         PERFORM 7046-CALL-LATEST-TROUBLE                         20540055
205500         MOVE TRBRSN-TRBL-SHT-DESC TO                             20550055
205600              PC003-LATEST-TROUBLE                                20560055
205700     ELSE                                                         20570055
205800         MOVE SPACES TO PC003-UNRESOLVED-TROUBLE                  20580055
205900                        PC003-MULTI-TROUBLE                       20590055
206000     END-IF.                                                      20600055
206100                                                                  20610055
206200 7042-CALL-ALL-TROUBLE.                                           20620055
206300                                                                  20630055
206400******************************************************************20640055
206500*  REMOVED THE FOLLOWING 2 LINES FROM THE WHERE STATMENT:         20650055
206600*     AND TRB.OPER_UNT_ID =  :DISTHD-OPER-UNT-ID                  20660055
206700*     AND TRB.FCLTY_ID    =  :PC-0001-COMP                        20670055
206800*                                                                 20680055
206900*  THIS WAS DONE BECAUSE THE OPERATING UNIT ASSOCIATED WITH THE   20690055
207000*  TROUBLE MAY NOT BE THE OPERATING UNIT ASSOCIATED TO THE ROW    20700055
207100*  ON TDISTHD                                                     20710055
207200*                                                                 20720055
207300*  THIS WAS ALSO DONE TO THE SQL FOUND IN:                        20730055
207400*     7046-CALL-LATEST-TROUBLE (BOTH THE SELECT AND SUB-SELECT    20740055
207500*                                                                 20750055
207600*  CHANGED BY RON KRIER ON 10/16/1998                             20760055
207700******************************************************************20770055
207800                                                                  20780055
207900     MOVE '7042-CALL-ALL-TROUBLE'                                 20790055
208000         TO PV-ABEND-PARAGRAPH.                                   20800055
208100     EXEC SQL                                                     20810055
208200               SELECT                                             20820055
208300                    COUNT(*)                                      20830055
208400               INTO                                               20840055
208500                    :WS-COUNT                                     20850055
208600               FROM                                               20860055
208700                     TTRBNTF A                                    20870055
208800                    ,TTRBRSN B                                    20880055
208900               WHERE                                              20890055
209000                     A.PO_NBR      =  :DISTHD-ORD-NBR             20900055
209100                 AND A.REC_SEQ_NBR =  :DISTHD-RCVR-SEQ-NBR        20910055
209200                 AND A.RESOLVED_IND IN ('N','I','R')              20920055
209300                 AND B.TRBL_RSN_CDE    =  A.TRBL_RSN_CDE          20930055
209400                 AND B.NOTIF_IND       = 'T'                      20940055
209500               WITH UR                                            20950055
209600                                                                  20960055
209700     END-EXEC.                                                    20970055
209800                                                                  20980055
209900     EVALUATE TRUE                                                20990055
210000         WHEN SQLCODE = +100                                      21000055
210100              CONTINUE                                            21010055
210200         WHEN SQLWARN0 NOT = SPACE                                21020055
210300         WHEN SQLCODE < ZERO                                      21030055
210400         WHEN SQLCODE > ZERO                                      21040055
210500             PERFORM 9100-SQL-ABEND                               21050055
210600         WHEN SQLCODE = ZERO                                      21060055
210700             CONTINUE                                             21070055
210800     END-EVALUATE.                                                21080055
210900                                                                  21090055
211000                                                                  21100055
211100 7046-CALL-LATEST-TROUBLE.                                        21110055
211200     MOVE '7046-CALL-LATEST-TROUBLE'                              21120055
211300         TO PV-ABEND-PARAGRAPH.                                   21130055
211400     EXEC SQL                                                     21140055
211500         SELECT                                                   21150055
211600               RSN.TRBL_SHT_DESC                                  21160055
211700         INTO                                                     21170055
211800               :TRBRSN-TRBL-SHT-DESC                              21180055
211900         FROM                                                     21190055
212000               TTRBNTF TRB                                        21200055
212100             , TTRBRSN RSN                                        21210055
212200         WHERE                                                    21220055
212300                TRB.PO_NBR              = :DISTHD-ORD-NBR         21230055
212400            AND TRB.REC_SEQ_NBR         = :DISTHD-RCVR-SEQ-NBR    21240055
212500            AND TRB.TRBL_RSN_CDE        = RSN.TRBL_RSN_CDE        21250055
212600            AND RSN.NOTIF_IND           = 'T'                     21260055
212700            AND TRB.NOTIF_TMST          =                         21270055
212800                (SELECT MAX(A.NOTIF_TMST)                         21280055
212900                    FROM TTRBNTF A                                21290055
213000                 WHERE                                            21300055
213100                        A.PO_NBR        = :DISTHD-ORD-NBR         21310055
213200                    AND A.REC_SEQ_NBR   = :DISTHD-RCVR-SEQ-NBR    21320055
213300                    AND A.RESOLVED_IND IN ('N','I','R'))          21330055
213400         WITH UR                                                  21340055
213500                                                                  21350055
213600     END-EXEC.                                                    21360055
213700                                                                  21370055
213800     EVALUATE TRUE                                                21380055
213900         WHEN SQLCODE = +100                                      21390055
214000              CONTINUE                                            21400055
214100         WHEN SQLCODE = -811                                      21410055
214200              CONTINUE                                            21420055
214300         WHEN SQLWARN0 NOT = SPACE                                21430055
214400         WHEN SQLCODE < ZERO                                      21440055
214500         WHEN SQLCODE > ZERO                                      21450055
214600             PERFORM 9100-SQL-ABEND                               21460055
214700         WHEN SQLCODE = ZERO                                      21470055
214800             CONTINUE                                             21480055
214900     END-EVALUATE.                                                21490055
215000                                                                  21500055
215100                                                                  21510055
215200 7500-CHECK-FOR-PRO-NUMBER.                                       21520055
215300     MOVE '7500-CHECK-FOR-PRO-NUMBER'                             21530055
215400         TO PV-ABEND-PARAGRAPH.                                   21540055
215500     MOVE 'GET PRO NUMBER'                                        21550055
215600         TO PV-DB2-OPERATION-ATTEMPTED.                           21560055
215700     INITIALIZE PV-DB2-FREIGHT-COUNT.                             21570055
215800     SET PS-NO-FREIGHT-BILL TO TRUE.                              21580055
215900                                                                  21590055
216000     EXEC SQL                                                     21600055
216100          SELECT COUNT(*)                                         21610055
216200            INTO :PV-DB2-FREIGHT-COUNT                            21620055
216300            FROM TSHIPMT A,                                       21630055
216400                 TSHPTPO B                                        21640055
216500           WHERE B.PO_NBR      = :DISTHD-ORD-NBR                  21650055
216600             AND B.REC_SEQ_NBR = :DISTHD-RCVR-SEQ-NBR             21660055
216700             AND A.SHIPT_ID    = B.SHIPT_ID                       21670055
216800             AND A.PRO_NBR = :PC-SPACES                          21680055
216900           WITH UR                                                21690055
217000     END-EXEC.                                                    21700055
217100                                                                  21710055
217200     EVALUATE TRUE                                                21720055
217300         WHEN SQLCODE = +100                                      21730055
217400              SET PS-NO-FREIGHT-BILL TO TRUE                      21740055
217500         WHEN SQLWARN0 NOT = SPACE                                21750055
217600         WHEN SQLCODE < ZERO                                      21760055
217700         WHEN SQLCODE > ZERO                                      21770055
217800              PERFORM 9100-SQL-ABEND                              21780055
217900         WHEN SQLCODE = ZERO                                      21790055
218000              IF PV-DB2-FREIGHT-COUNT > 0                         21800055
218100                 SET PS-FREIGHT-BILL-FOUND TO TRUE                21810055
218200              ELSE                                                21820055
218300                 SET PS-NO-FREIGHT-BILL TO TRUE                   21830055
218400              END-IF                                              21840055
218500     END-EVALUATE.                                                21850055
218600                                                                  21860055
218700     IF PS-NO-FREIGHT-BILL                                        21870055
218800         SET PS-ERROR-FOUND TO TRUE                               21880055
218900         IF  PS-FIRST-TABLE-ENTRY                                 21890055
219000             SET PS-NOT-FIRST-TABLE-ENTRY TO TRUE                 21900055
219100             SET MSG-MAX-IDX                                      21910055
219200                 MSG-IDX               TO 1                       21920055
219300         ELSE                                                     21930055
219400             SET MSG-IDX     UP BY 1                              21940055
219500             SET MSG-MAX-IDX UP BY 1                              21950055
219600         END-IF                                                   21960055
219700                                                                  21970055
219800         MOVE SPACES            TO WS-OTHER-ISSUES-MSG(MSG-IDX)   21980055
219900         MOVE PC-NO-PRO-MSG-TXT TO WS-OTHER-ISSUES-MSG(MSG-IDX)   21990055
220000         ADD 1 TO PV-OTHER-ISSUES-COUNT                           22000055
220100     END-IF.                                                      22010055
220200                                                                  22020055
220300                                                                  22030055
220400***************************************************************** 22040055
220500* CHECK TO SEE IF ARRIVED                                       * 22050055
220600***************************************************************** 22060055
220700 7560-CHECK-IF-ARRIVED.                                           22070055
220800                                                                  22080055
220900     MOVE '7560-CHECK-IF-ARRIVED    '                             22090055
221000         TO PV-ABEND-PARAGRAPH.                                   22100055
221100     MOVE 'CHECK ARRIVED '                                        22110055
221200         TO PV-DB2-OPERATION-ATTEMPTED.                           22120055
221300                                                                  22130055
221400     SET PS-ARRIVED  TO  TRUE.                                    22140055
221500                                                                  22150055
221600     EXEC SQL                                                     22160055
221700          SELECT REC_TMST                                         22170055
221800            INTO :RECEIV-REC-TMST                                 22180055
221900            FROM TRECEIV                                          22190055
222000           WHERE ORD_NBR       = :DISTHD-ORD-NBR                  22200055
222100             AND REC_SEQ_NBR   = :DISTHD-RCVR-SEQ-NBR             22210055
222200           WITH UR                                                22220055
222300     END-EXEC.                                                    22230055
222400                                                                  22240055
222500     EVALUATE TRUE                                                22250055
222600         WHEN SQLCODE = +0                                        22260055
222700              IF  RECEIV-REC-TMST  =  PC-DEFAULT-TMST             22270055
222800                  SET PS-NOT-ARRIVED        TO  TRUE              22280055
222900              ELSE                                                22290055
223000                  SET PS-ARRIVED      TO TRUE                     22300055
223100              END-IF                                              22310055
223200                                                                  22320055
223300         WHEN SQLCODE = +100                                      22330055
223400              SET PS-NOT-ARRIVED     TO TRUE                      22340055
223500                                                                  22350055
223600         WHEN SQLWARN0 NOT = SPACE                                22360055
223700         WHEN SQLCODE < ZERO                                      22370055
223800         WHEN SQLCODE > ZERO                                      22380055
223900              PERFORM 9100-SQL-ABEND                              22390055
224000     END-EVALUATE.                                                22400055
224100                                                                  22410055
224200     IF PS-NOT-ARRIVED                                            22420055
224300         SET PS-ERROR-FOUND TO TRUE                               22430055
224400         IF  PS-FIRST-TABLE-ENTRY                                 22440055
224500             SET PS-NOT-FIRST-TABLE-ENTRY TO TRUE                 22450055
224600             SET MSG-MAX-IDX                                      22460055
224700                 MSG-IDX               TO 1                       22470055
224800         ELSE                                                     22480055
224900             SET MSG-IDX     UP BY 1                              22490055
225000             SET MSG-MAX-IDX UP BY 1                              22500055
225100         END-IF                                                   22510055
225200                                                                  22520055
225300         MOVE SPACES             TO WS-OTHER-ISSUES-MSG(MSG-IDX)  22530055
225400         MOVE PC-NOT-ARRIVED-TXT TO WS-OTHER-ISSUES-MSG(MSG-IDX)  22540055
225500         ADD 1 TO PV-OTHER-ISSUES-COUNT                           22550055
225600     END-IF.                                                      22560055
225700                                                                  22570055
225800                                                                  22580055
225900***************************************************************** 22590055
226000* CHECK TO SEE IF P2L BAD RATIO                                 * 22600055
226100***************************************************************** 22610055
226200 7570-CHECK-BAD-RATIO.                                            22620055
226300                                                                  22630055
226400     MOVE '7570-CHECK-BAD-RATIO     '                             22640055
226500         TO PV-ABEND-PARAGRAPH.                                   22650055
226600                                                                  22660055
226700     IF  DISTHD-PRCG-STAT-CDE  =  'A'                             22670055
226800         SET PS-P2L-BAD-RATIO      TO  TRUE                       22680055
226900     ELSE                                                         22690055
227000         SET PS-NOT-P2L-BAD-RATIO  TO TRUE                        22700055
227100     END-IF.                                                      22710055
227200                                                                  22720055
227300     IF PS-P2L-BAD-RATIO                                          22730055
227400         SET PS-ERROR-FOUND TO TRUE                               22740055
227500         IF  PS-FIRST-TABLE-ENTRY                                 22750055
227600             SET PS-NOT-FIRST-TABLE-ENTRY TO TRUE                 22760055
227700             SET MSG-MAX-IDX                                      22770055
227800                 MSG-IDX               TO 1                       22780055
227900         ELSE                                                     22790055
228000             SET MSG-IDX     UP BY 1                              22800055
228100             SET MSG-MAX-IDX UP BY 1                              22810055
228200         END-IF                                                   22820055
228300                                                                  22830055
228400         MOVE SPACES               TO WS-OTHER-ISSUES-MSG(MSG-IDX)22840055
228500         MOVE PC-P2L-BAD-RATIO-TXT TO WS-OTHER-ISSUES-MSG(MSG-IDX)22850055
228600         ADD 1 TO PV-OTHER-ISSUES-COUNT                           22860055
228700     END-IF.                                                      22870055
228800                                                                  22880055
228900 7580-CHECK-OPEN-SYSTEM-AUDIT.                                    22890055
229000     IF RECEIV-PKGNG-CDE = SPACES                                 22900055
229100        MOVE 0                        TO SUT00015-PO-LNE-NBR      22910055
229200        MOVE 0                        TO SUT00015-PO-PREPK-ID     22920055
229300     ELSE                                                         22930055
229400        IF RECEIV-PKGNG-CDE = 'B' OR 'C'                          22940055
229500           MOVE RECITM-ORD-LNE-NBR    TO SUT00015-PO-LNE-NBR      22950055
229600           MOVE 0                     TO SUT00015-PO-PREPK-ID     22960055
229700        ELSE                                                      22970055
229800           MOVE 0                     TO SUT00015-PO-LNE-NBR      22980055
229900           MOVE RECITM-PREPK-ID       TO SUT00015-PO-PREPK-ID     22990055
230000        END-IF                                                    23000055
230100     END-IF.                                                      23010055
230200                                                                  23020055
230300     EXEC SQL                                                     23030055
230400        SELECT COUNT(*)                                           23040055
230500          INTO :PV-OPEN-AUDIT-COUNT                               23050055
230600          FROM  SUT_PO_AUD_REQ                                    23060055
230700         WHERE  PO_NBR       = :RECEIV-ORD-NBR                    23070055
230800           AND  RCVR_SEQ_NBR = :RECEIV-REC-SEQ-NBR                23080055
230900           AND (PO_LNE_NBR   = :SUT00015-PO-LNE-NBR               23090055
231000            OR  PO_PREPK_ID  = :SUT00015-PO-PREPK-ID)             23100055
231100           AND AUD_STAT_CDE  = :PC-I                              23110055
231110          WITH UR                                                 23111094
231200     END-EXEC.                                                    23120055
231300                                                                  23130055
231400     EVALUATE TRUE                                                23140055
231500        WHEN SQLCODE = ZERO                                       23150055
231600           IF PV-OPEN-AUDIT-COUNT > 0                             23160055
231700              SET PS-OPEN-AUDITS         TO TRUE                  23170055
231800           ELSE                                                   23180055
231900              SET PS-NO-OPEN-AUDITS      TO TRUE                  23190055
232000           END-IF                                                 23200055
232100        WHEN SQLCODE = +100                                       23210055
232200        WHEN SQLCODE = -305                                       23220055
232300             SET PS-NO-OPEN-AUDITS       TO TRUE                  23230055
232400        WHEN SQLWARN0 NOT = SPACE                                 23240055
232500        WHEN SQLCODE < ZERO                                       23250055
232600        WHEN SQLCODE > ZERO                                       23260055
232700             MOVE '7580-CHECK-OPEN-SYSTEM-AUDIT'                  23270071
232800                                          TO PV-ABEND-PARAGRAPH   23280071
232900             PERFORM 9100-SQL-ABEND                               23290055
233000     END-EVALUATE.                                                23300055
233100                                                                  23310055
233200     IF PS-OPEN-AUDITS                                            23320062
233300        SET PS-ERROR-FOUND TO TRUE                                23330055
233400        IF PS-FIRST-TABLE-ENTRY                                   23340055
233500           SET PS-NOT-FIRST-TABLE-ENTRY TO TRUE                   23350055
233600           SET MSG-MAX-IDX                                        23360055
233700               MSG-IDX                    TO 1                    23370055
233800        ELSE                                                      23380055
233900           SET MSG-IDX      UP BY 1                               23390055
234000           SET MSG-MAX-IDX  UP BY 1                               23400055
234100        END-IF                                                    23410055
234200                                                                  23420055
234300        MOVE SPACES       TO WS-OTHER-ISSUES-MSG(MSG-IDX)         23430055
234400        MOVE PC-OPEN-PRMPT-AUDIT-TXT                              23440055
234500                          TO WS-OTHER-ISSUES-MSG(MSG-IDX)         23450055
234600        ADD 1 TO PV-OTHER-ISSUES-COUNT                            23460055
234700     END-IF.                                                      23470055
234800                                                                  23480055
234900 7590-CHECK-CRTN-NOT-MANIFESTD.                                   23490076
235000                                                                  23500070
235100     PERFORM 7600-COUNT-CHECK-IN.                                 23510070
235200     IF PV-CHECK-IN-COUNT > 0                                     23520070
235300         PERFORM 7610-COUNT-MANIFESTED                            23530070
235400         IF PV-MANIFESTED-COUNT > 0                               23540070
235500             SET PS-ERROR-FOUND TO TRUE                           23550070
235600             IF PS-FIRST-TABLE-ENTRY                              23560070
235700                SET PS-NOT-FIRST-TABLE-ENTRY TO TRUE              23570070
235800                SET MSG-MAX-IDX                                   23580070
235900                    MSG-IDX                    TO 1               23590070
236000             ELSE                                                 23600070
236100                SET MSG-IDX      UP BY 1                          23610070
236200                SET MSG-MAX-IDX  UP BY 1                          23620070
236300             END-IF                                               23630070
236400                                                                  23640070
236500             MOVE SPACES       TO WS-OTHER-ISSUES-MSG(MSG-IDX)    23650070
236600             MOVE PC-PBS-NOT-MANIFESTD-TXT                        23660070
236700                               TO WS-OTHER-ISSUES-MSG(MSG-IDX)    23670070
236800             ADD 1 TO PV-OTHER-ISSUES-COUNT                       23680070
236900         END-IF                                                   23690070
237000     END-IF.                                                      23700070
237100                                                                  23710070
237200 7600-COUNT-CHECK-IN.                                             23720070
237300     EXEC SQL                                                     23730070
237400          SELECT   COUNT (DISTINCT C.SHIPT_UNT_ID)                23740070
237500            INTO  :PV-CHECK-IN-COUNT                              23750070
237600            FROM  TPKSLIP A                                       23760088
237700                , TINPKSU B                                       23770088
237800                , TSHUNLO C                                       23780088
237900           WHERE                                                  23790088
238000                  A.PO_NBR        = :DISTHD-ORD-NBR               23800088
238100             AND  A.REC_SEQ_NBR   = :DISTHD-RCVR-SEQ-NBR          23810088
238200             AND  A.PO_NBR        = B.PO_NBR                      23820088
238300             AND  A.SEQ_NBR       = B.SEQ_NBR                     23830088
238400             AND  C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                23840088
238500             AND  C.ACTV_CDE      = 'A'                           23850088
238600             AND  C.SCN_LOC_ID    = 'RECV'                        23860088
238610          WITH UR                                                 23861094
238700     END-EXEC.                                                    23870070
238800                                                                  23880070
238900     EVALUATE TRUE                                                23890071
239000        WHEN SQLCODE = ZERO                                       23900071
239100        WHEN SQLCODE = +100                                       23910071
239200        WHEN SQLCODE = -305                                       23920071
239300           CONTINUE                                               23930071
239400        WHEN SQLWARN0 NOT = SPACE                                 23940071
239500        WHEN SQLCODE < ZERO                                       23950071
239600        WHEN SQLCODE > ZERO                                       23960071
239700             MOVE '7600-COUNT-CHECK-IN' TO PV-ABEND-PARAGRAPH     23970071
239800             PERFORM 9100-SQL-ABEND                               23980071
239900     END-EVALUATE.                                                23990071
240000                                                                  24000071
240100 7610-COUNT-MANIFESTED.                                           24010070
240200                                                                  24020070
240300     EXEC SQL                                                     24030070
240400          SELECT   COUNT (DISTINCT C.SHIPT_UNT_ID)                24040070
240500            INTO  :PV-MANIFESTED-COUNT                            24050070
240600            FROM  TPKSLIP A                                       24060088
240700                , TINPKSU B                                       24070070
240800                , TSHUNLO C                                       24080070
240900           WHERE                                                  24090070
241000                  A.PO_NBR        = :DISTHD-ORD-NBR               24100073
241100             AND  A.REC_SEQ_NBR   = :DISTHD-RCVR-SEQ-NBR          24110073
241200             AND  A.PO_NBR        = B.PO_NBR                      24120070
241300             AND  A.SEQ_NBR       = B.SEQ_NBR                     24130088
241400             AND  C.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                24140070
241500             AND  A.VER_STAT_CDE  = 'A'                           24150088
241600             AND  C.ACTV_CDE      = 'A'                           24160070
241700             AND  C.SCN_LOC_ID    = 'RECV'                        24170070
241800             AND NOT EXISTS                                       24180070
241900             (SELECT *                                            24190088
242000               FROM TSULBXF D                                     24200088
242100               WHERE  C.SHIPT_UNT_ID  = D.SHIPT_UNT_ID)           24210088
242200             AND NOT EXISTS                                       24220088
242300             (SELECT *                                            24230088
242400               FROM SUT_OTBND_CART Z                              24240088
242500                   ,SUT_OTBND_UPC  Y                              24250088
242600               WHERE  Y.TRN_NBR = A.PO_NBR                        24260088
242700                 AND  Y.RCVR_SEQ_NBR = A.REC_SEQ_NBR              24270088
242800                 AND  A.STR_DEST_NBR = Z.DEST_LOC_NBR             24280088
242900                 AND  Z.SHIPT_UNT_ID = Y.SHIPT_UNT_ID             24290088
243000                 AND  Z.CART_SRC_CDE = 'SMO'                      24300088
243100                 AND  Z.ACTV_IND     = 'Y'  )                     24310088
243110          WITH UR                                                 24311094
243200     END-EXEC.                                                    24320070
243300                                                                  24330070
243400     EVALUATE TRUE                                                24340071
243500        WHEN SQLCODE = ZERO                                       24350071
243600        WHEN SQLCODE = +100                                       24360071
243700        WHEN SQLCODE = -305                                       24370071
243800           CONTINUE                                               24380071
243900        WHEN SQLWARN0 NOT = SPACE                                 24390071
244000        WHEN SQLCODE < ZERO                                       24400071
244100        WHEN SQLCODE > ZERO                                       24410071
244200             MOVE '7610-COUNT-MANIFESTED' TO PV-ABEND-PARAGRAPH   24420071
244300             PERFORM 9100-SQL-ABEND                               24430071
244400     END-EVALUATE.                                                24440071
244500                                                                  24450071
244600 8000-CHECK-DC-ENTRIES.                                           24460055
244700                                                                  24470055
244800     IF  WS-DCT-OPER-UNIT-ID (DCT-IDX) NOT EQUAL TO ZEROS         24480055
244900         IF  WS-DCT-OPEN-DATE (DCT-IDX) <= PV-TSTR-COMP-DATE      24490055
245000         AND WS-DCT-CLOSE-DATE (DCT-IDX) >= PV-TSTR-COMP-DATE     24500055
245100             INITIALIZE PC003-RECEIVER-EXT-RECORD                 24510055
245200             MOVE WS-DCT-OPER-UNIT-ID (DCT-IDX) TO                24520055
245300                  PC003-CURRENT-OPER                              24530055
245400             MOVE PC-0001 TO PC003-CURRENT-FCLTY                  24540055
245500             MOVE PC-HDR  TO PC003-RECORD-TYPE-IND                24550055
245600             IF  WS-DCT-DATA-PROCESSED (DCT-IDX)                  24560055
245700                 CONTINUE                                         24570055
245800             ELSE                                                 24580055
245900                 WRITE EXTRACT-RECORD FROM                        24590055
246000                       PC003-RECEIVER-EXT-RECORD                  24600055
246100             END-IF                                               24610055
246200         END-IF                                                   24620055
246300     END-IF.                                                      24630055
246400/                                                                 24640055
246500 8600-CALL-XLKUT001.                                              24650055
246600                                                                  24660055
246700     MOVE '8600-CALL-XLKUT001'   TO PV-ABEND-PARAGRAPH            24670055
246800     MOVE 'CALL XLUT0001'        TO PV-DB2-OPERATION-ATTEMPTED.   24680055
246900                                                                  24690055
247000                                                                  24700055
247100     INITIALIZE XL001-ITEM-COMMAREA                               24710055
247200     SET XL001-SELECT-SKU                                         24720055
247300         XL001-SELECT-VND-STYL                                    24730055
247400         XL001-BY-ITEM                TO TRUE                     24740055
247500                                                                  24750055
247600     MOVE PURITM-ITM-NBR              TO XL001-KEY-ITM-NBR        24760055
247700                                                                  24770055
247800     CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.                24780055
247900                                                                  24790055
248000     EVALUATE TRUE                                                24800055
248100         WHEN XL001-SUCCESSFUL                                    24810055
248200         WHEN XL001-SKU-NOT-FOUND                                 24820055
248300         WHEN XL001-VND-STYL-NOT-FOUND                            24830055
248400             CONTINUE                                             24840055
248500         WHEN XL001-SQL-ERROR                                     24850055
248600         WHEN XL001-INVALID-ACCESS                                24860055
248700             PERFORM 9200-XL-ABEND                                24870055
248800         WHEN OTHER                                               24880055
248900             PERFORM 9200-XL-ABEND                                24890055
249000     END-EVALUATE.                                                24900055
249100                                                                  24910055
249200 9100-SQL-ABEND.                                                  24920055
249300******************************************************************24930055
249400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    24940055
249500*  ERROR OR WARNING CODE OCCURS.                                  24950055
249600******************************************************************24960055
249700     DISPLAY '9100-SQL-ABEND'.                                    24970055
249800     DISPLAY '** ABEND     **'.                                   24980055
249900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        24990055
250000     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             25000055
250100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     25010055
250200     COPY DPPD004.                                                25020055
250300                                                                  25030055
250400     MOVE +4013                  TO ABEND-CODE.                   25040055
250500     CALL 'ILBOABN0' USING ABEND-CODE.                            25050055
250600                                                                  25060055
250700 9200-XL-ABEND.                                                   25070055
250800     DISPLAY '9200-XL-ABEND'.                                     25080055
250900     DISPLAY '** ABEND     **'.                                   25090055
251000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        25100055
251100     DISPLAY '** PARAGRAPH ** = ' XL001-ERROR-PARAGRAPH-NBR       25110055
251200     DISPLAY '** OPERATION ** =  ERROR INSIDE XLKUT001'.          25120055
251300     MOVE XL001-SQLCA         TO SQLCA                            25130055
251400                                                                  25140055
251500     COPY DPPD004.                                                25150055
251600                                                                  25160055
251700     MOVE +4013                  TO ABEND-CODE.                   25170055
251800     CALL 'ILBOABN0' USING ABEND-CODE.                            25180055
251900*9100-EXIT.                                                       25190055
